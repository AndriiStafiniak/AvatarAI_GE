var bd=Object.defineProperty;var yd=(X,Z,_)=>Z in X?bd(X,Z,{enumerable:!0,configurable:!0,writable:!0,value:_}):X[Z]=_;var hu=(X,Z,_)=>yd(X,typeof Z!="symbol"?Z+"":Z,_);function _mergeNamespaces(X,Z){for(var _=0;_<Z.length;_++){const K=Z[_];if(typeof K!="string"&&!Array.isArray(K)){for(const te in K)if(te!=="default"&&!(te in X)){const ne=Object.getOwnPropertyDescriptor(K,te);ne&&Object.defineProperty(X,te,ne.get?ne:{enumerable:!0,get:()=>K[te]})}}}return Object.freeze(Object.defineProperty(X,Symbol.toStringTag,{value:"Module"}))}(function(){const Z=document.createElement("link").relList;if(Z&&Z.supports&&Z.supports("modulepreload"))return;for(const te of document.querySelectorAll('link[rel="modulepreload"]'))K(te);new MutationObserver(te=>{for(const ne of te)if(ne.type==="childList")for(const oe of ne.addedNodes)oe.tagName==="LINK"&&oe.rel==="modulepreload"&&K(oe)}).observe(document,{childList:!0,subtree:!0});function _(te){const ne={};return te.integrity&&(ne.integrity=te.integrity),te.referrerPolicy&&(ne.referrerPolicy=te.referrerPolicy),te.crossOrigin==="use-credentials"?ne.credentials="include":te.crossOrigin==="anonymous"?ne.credentials="omit":ne.credentials="same-origin",ne}function K(te){if(te.ep)return;te.ep=!0;const ne=_(te);fetch(te.href,ne)}})();function getDefaultExportFromCjs(X){return X&&X.__esModule&&Object.prototype.hasOwnProperty.call(X,"default")?X.default:X}function getAugmentedNamespace(X){if(Object.prototype.hasOwnProperty.call(X,"__esModule"))return X;var Z=X.default;if(typeof Z=="function"){var _=function K(){return this instanceof K?Reflect.construct(Z,arguments,this.constructor):Z.apply(this,arguments)};_.prototype=Z.prototype}else _={};return Object.defineProperty(_,"__esModule",{value:!0}),Object.keys(X).forEach(function(K){var te=Object.getOwnPropertyDescriptor(X,K);Object.defineProperty(_,K,te.get?te:{enumerable:!0,get:function(){return X[K]}})}),_}var jsxRuntime={exports:{}},reactJsxRuntime_production_min={},react={exports:{}},react_production_min={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var hasRequiredReact_production_min;function requireReact_production_min(){if(hasRequiredReact_production_min)return react_production_min;hasRequiredReact_production_min=1;var X=Symbol.for("react.element"),Z=Symbol.for("react.portal"),_=Symbol.for("react.fragment"),K=Symbol.for("react.strict_mode"),te=Symbol.for("react.profiler"),ne=Symbol.for("react.provider"),oe=Symbol.for("react.context"),ie=Symbol.for("react.forward_ref"),se=Symbol.for("react.suspense"),ae=Symbol.for("react.memo"),ge=Symbol.for("react.lazy"),ce=Symbol.iterator;function de(Te){return Te===null||typeof Te!="object"?null:(Te=ce&&Te[ce]||Te["@@iterator"],typeof Te=="function"?Te:null)}var pe={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},fe=Object.assign,be={};function me(Te,De,ot){this.props=Te,this.context=De,this.refs=be,this.updater=ot||pe}me.prototype.isReactComponent={},me.prototype.setState=function(Te,De){if(typeof Te!="object"&&typeof Te!="function"&&Te!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,Te,De,"setState")},me.prototype.forceUpdate=function(Te){this.updater.enqueueForceUpdate(this,Te,"forceUpdate")};function ye(){}ye.prototype=me.prototype;function ve(Te,De,ot){this.props=Te,this.context=De,this.refs=be,this.updater=ot||pe}var Be=ve.prototype=new ye;Be.constructor=ve,fe(Be,me.prototype),Be.isPureReactComponent=!0;var Re=Array.isArray,Ee=Object.prototype.hasOwnProperty,We={current:null},Ze={key:!0,ref:!0,__self:!0,__source:!0};function Ve(Te,De,ot){var ct,gt={},pt=null,ht=null;if(De!=null)for(ct in De.ref!==void 0&&(ht=De.ref),De.key!==void 0&&(pt=""+De.key),De)Ee.call(De,ct)&&!Ze.hasOwnProperty(ct)&&(gt[ct]=De[ct]);var At=arguments.length-2;if(At===1)gt.children=ot;else if(1<At){for(var Kt=Array(At),en=0;en<At;en++)Kt[en]=arguments[en+2];gt.children=Kt}if(Te&&Te.defaultProps)for(ct in At=Te.defaultProps,At)gt[ct]===void 0&&(gt[ct]=At[ct]);return{$$typeof:X,type:Te,key:pt,ref:ht,props:gt,_owner:We.current}}function _e(Te,De){return{$$typeof:X,type:Te.type,key:De,ref:Te.ref,props:Te.props,_owner:Te._owner}}function Xe(Te){return typeof Te=="object"&&Te!==null&&Te.$$typeof===X}function Pe(Te){var De={"=":"=0",":":"=2"};return"$"+Te.replace(/[=:]/g,function(ot){return De[ot]})}var He=/\/+/g;function Ke(Te,De){return typeof Te=="object"&&Te!==null&&Te.key!=null?Pe(""+Te.key):De.toString(36)}function Ue(Te,De,ot,ct,gt){var pt=typeof Te;(pt==="undefined"||pt==="boolean")&&(Te=null);var ht=!1;if(Te===null)ht=!0;else switch(pt){case"string":case"number":ht=!0;break;case"object":switch(Te.$$typeof){case X:case Z:ht=!0}}if(ht)return ht=Te,gt=gt(ht),Te=ct===""?"."+Ke(ht,0):ct,Re(gt)?(ot="",Te!=null&&(ot=Te.replace(He,"$&/")+"/"),Ue(gt,De,ot,"",function(en){return en})):gt!=null&&(Xe(gt)&&(gt=_e(gt,ot+(!gt.key||ht&&ht.key===gt.key?"":(""+gt.key).replace(He,"$&/")+"/")+Te)),De.push(gt)),1;if(ht=0,ct=ct===""?".":ct+":",Re(Te))for(var At=0;At<Te.length;At++){pt=Te[At];var Kt=ct+Ke(pt,At);ht+=Ue(pt,De,ot,Kt,gt)}else if(Kt=de(Te),typeof Kt=="function")for(Te=Kt.call(Te),At=0;!(pt=Te.next()).done;)pt=pt.value,Kt=ct+Ke(pt,At++),ht+=Ue(pt,De,ot,Kt,gt);else if(pt==="object")throw De=String(Te),Error("Objects are not valid as a React child (found: "+(De==="[object Object]"?"object with keys {"+Object.keys(Te).join(", ")+"}":De)+"). If you meant to render a collection of children, use an array instead.");return ht}function tt(Te,De,ot){if(Te==null)return Te;var ct=[],gt=0;return Ue(Te,ct,"","",function(pt){return De.call(ot,pt,gt++)}),ct}function rt(Te){if(Te._status===-1){var De=Te._result;De=De(),De.then(function(ot){(Te._status===0||Te._status===-1)&&(Te._status=1,Te._result=ot)},function(ot){(Te._status===0||Te._status===-1)&&(Te._status=2,Te._result=ot)}),Te._status===-1&&(Te._status=0,Te._result=De)}if(Te._status===1)return Te._result.default;throw Te._result}var at={current:null},Oe={transition:null},$e={ReactCurrentDispatcher:at,ReactCurrentBatchConfig:Oe,ReactCurrentOwner:We};function je(){throw Error("act(...) is not supported in production builds of React.")}return react_production_min.Children={map:tt,forEach:function(Te,De,ot){tt(Te,function(){De.apply(this,arguments)},ot)},count:function(Te){var De=0;return tt(Te,function(){De++}),De},toArray:function(Te){return tt(Te,function(De){return De})||[]},only:function(Te){if(!Xe(Te))throw Error("React.Children.only expected to receive a single React element child.");return Te}},react_production_min.Component=me,react_production_min.Fragment=_,react_production_min.Profiler=te,react_production_min.PureComponent=ve,react_production_min.StrictMode=K,react_production_min.Suspense=se,react_production_min.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=$e,react_production_min.act=je,react_production_min.cloneElement=function(Te,De,ot){if(Te==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+Te+".");var ct=fe({},Te.props),gt=Te.key,pt=Te.ref,ht=Te._owner;if(De!=null){if(De.ref!==void 0&&(pt=De.ref,ht=We.current),De.key!==void 0&&(gt=""+De.key),Te.type&&Te.type.defaultProps)var At=Te.type.defaultProps;for(Kt in De)Ee.call(De,Kt)&&!Ze.hasOwnProperty(Kt)&&(ct[Kt]=De[Kt]===void 0&&At!==void 0?At[Kt]:De[Kt])}var Kt=arguments.length-2;if(Kt===1)ct.children=ot;else if(1<Kt){At=Array(Kt);for(var en=0;en<Kt;en++)At[en]=arguments[en+2];ct.children=At}return{$$typeof:X,type:Te.type,key:gt,ref:pt,props:ct,_owner:ht}},react_production_min.createContext=function(Te){return Te={$$typeof:oe,_currentValue:Te,_currentValue2:Te,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},Te.Provider={$$typeof:ne,_context:Te},Te.Consumer=Te},react_production_min.createElement=Ve,react_production_min.createFactory=function(Te){var De=Ve.bind(null,Te);return De.type=Te,De},react_production_min.createRef=function(){return{current:null}},react_production_min.forwardRef=function(Te){return{$$typeof:ie,render:Te}},react_production_min.isValidElement=Xe,react_production_min.lazy=function(Te){return{$$typeof:ge,_payload:{_status:-1,_result:Te},_init:rt}},react_production_min.memo=function(Te,De){return{$$typeof:ae,type:Te,compare:De===void 0?null:De}},react_production_min.startTransition=function(Te){var De=Oe.transition;Oe.transition={};try{Te()}finally{Oe.transition=De}},react_production_min.unstable_act=je,react_production_min.useCallback=function(Te,De){return at.current.useCallback(Te,De)},react_production_min.useContext=function(Te){return at.current.useContext(Te)},react_production_min.useDebugValue=function(){},react_production_min.useDeferredValue=function(Te){return at.current.useDeferredValue(Te)},react_production_min.useEffect=function(Te,De){return at.current.useEffect(Te,De)},react_production_min.useId=function(){return at.current.useId()},react_production_min.useImperativeHandle=function(Te,De,ot){return at.current.useImperativeHandle(Te,De,ot)},react_production_min.useInsertionEffect=function(Te,De){return at.current.useInsertionEffect(Te,De)},react_production_min.useLayoutEffect=function(Te,De){return at.current.useLayoutEffect(Te,De)},react_production_min.useMemo=function(Te,De){return at.current.useMemo(Te,De)},react_production_min.useReducer=function(Te,De,ot){return at.current.useReducer(Te,De,ot)},react_production_min.useRef=function(Te){return at.current.useRef(Te)},react_production_min.useState=function(Te){return at.current.useState(Te)},react_production_min.useSyncExternalStore=function(Te,De,ot){return at.current.useSyncExternalStore(Te,De,ot)},react_production_min.useTransition=function(){return at.current.useTransition()},react_production_min.version="18.3.1",react_production_min}var hasRequiredReact;function requireReact(){return hasRequiredReact||(hasRequiredReact=1,react.exports=requireReact_production_min()),react.exports}/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var hasRequiredReactJsxRuntime_production_min;function requireReactJsxRuntime_production_min(){if(hasRequiredReactJsxRuntime_production_min)return reactJsxRuntime_production_min;hasRequiredReactJsxRuntime_production_min=1;var X=requireReact(),Z=Symbol.for("react.element"),_=Symbol.for("react.fragment"),K=Object.prototype.hasOwnProperty,te=X.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,ne={key:!0,ref:!0,__self:!0,__source:!0};function oe(ie,se,ae){var ge,ce={},de=null,pe=null;ae!==void 0&&(de=""+ae),se.key!==void 0&&(de=""+se.key),se.ref!==void 0&&(pe=se.ref);for(ge in se)K.call(se,ge)&&!ne.hasOwnProperty(ge)&&(ce[ge]=se[ge]);if(ie&&ie.defaultProps)for(ge in se=ie.defaultProps,se)ce[ge]===void 0&&(ce[ge]=se[ge]);return{$$typeof:Z,type:ie,key:de,ref:pe,props:ce,_owner:te.current}}return reactJsxRuntime_production_min.Fragment=_,reactJsxRuntime_production_min.jsx=oe,reactJsxRuntime_production_min.jsxs=oe,reactJsxRuntime_production_min}var hasRequiredJsxRuntime;function requireJsxRuntime(){return hasRequiredJsxRuntime||(hasRequiredJsxRuntime=1,jsxRuntime.exports=requireReactJsxRuntime_production_min()),jsxRuntime.exports}var jsxRuntimeExports=requireJsxRuntime(),reactExports=requireReact();const React=getDefaultExportFromCjs(reactExports),$2AODx$react=_mergeNamespaces({__proto__:null,default:React},[reactExports]);var client={},reactDom={exports:{}},reactDom_production_min={},scheduler$2={exports:{}},scheduler_production_min$2={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var hasRequiredScheduler_production_min$2;function requireScheduler_production_min$2(){return hasRequiredScheduler_production_min$2||(hasRequiredScheduler_production_min$2=1,function(X){function Z(Oe,$e){var je=Oe.length;Oe.push($e);e:for(;0<je;){var Te=je-1>>>1,De=Oe[Te];if(0<te(De,$e))Oe[Te]=$e,Oe[je]=De,je=Te;else break e}}function _(Oe){return Oe.length===0?null:Oe[0]}function K(Oe){if(Oe.length===0)return null;var $e=Oe[0],je=Oe.pop();if(je!==$e){Oe[0]=je;e:for(var Te=0,De=Oe.length,ot=De>>>1;Te<ot;){var ct=2*(Te+1)-1,gt=Oe[ct],pt=ct+1,ht=Oe[pt];if(0>te(gt,je))pt<De&&0>te(ht,gt)?(Oe[Te]=ht,Oe[pt]=je,Te=pt):(Oe[Te]=gt,Oe[ct]=je,Te=ct);else if(pt<De&&0>te(ht,je))Oe[Te]=ht,Oe[pt]=je,Te=pt;else break e}}return $e}function te(Oe,$e){var je=Oe.sortIndex-$e.sortIndex;return je!==0?je:Oe.id-$e.id}if(typeof performance=="object"&&typeof performance.now=="function"){var ne=performance;X.unstable_now=function(){return ne.now()}}else{var oe=Date,ie=oe.now();X.unstable_now=function(){return oe.now()-ie}}var se=[],ae=[],ge=1,ce=null,de=3,pe=!1,fe=!1,be=!1,me=typeof setTimeout=="function"?setTimeout:null,ye=typeof clearTimeout=="function"?clearTimeout:null,ve=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function Be(Oe){for(var $e=_(ae);$e!==null;){if($e.callback===null)K(ae);else if($e.startTime<=Oe)K(ae),$e.sortIndex=$e.expirationTime,Z(se,$e);else break;$e=_(ae)}}function Re(Oe){if(be=!1,Be(Oe),!fe)if(_(se)!==null)fe=!0,rt(Ee);else{var $e=_(ae);$e!==null&&at(Re,$e.startTime-Oe)}}function Ee(Oe,$e){fe=!1,be&&(be=!1,ye(Ve),Ve=-1),pe=!0;var je=de;try{for(Be($e),ce=_(se);ce!==null&&(!(ce.expirationTime>$e)||Oe&&!Pe());){var Te=ce.callback;if(typeof Te=="function"){ce.callback=null,de=ce.priorityLevel;var De=Te(ce.expirationTime<=$e);$e=X.unstable_now(),typeof De=="function"?ce.callback=De:ce===_(se)&&K(se),Be($e)}else K(se);ce=_(se)}if(ce!==null)var ot=!0;else{var ct=_(ae);ct!==null&&at(Re,ct.startTime-$e),ot=!1}return ot}finally{ce=null,de=je,pe=!1}}var We=!1,Ze=null,Ve=-1,_e=5,Xe=-1;function Pe(){return!(X.unstable_now()-Xe<_e)}function He(){if(Ze!==null){var Oe=X.unstable_now();Xe=Oe;var $e=!0;try{$e=Ze(!0,Oe)}finally{$e?Ke():(We=!1,Ze=null)}}else We=!1}var Ke;if(typeof ve=="function")Ke=function(){ve(He)};else if(typeof MessageChannel<"u"){var Ue=new MessageChannel,tt=Ue.port2;Ue.port1.onmessage=He,Ke=function(){tt.postMessage(null)}}else Ke=function(){me(He,0)};function rt(Oe){Ze=Oe,We||(We=!0,Ke())}function at(Oe,$e){Ve=me(function(){Oe(X.unstable_now())},$e)}X.unstable_IdlePriority=5,X.unstable_ImmediatePriority=1,X.unstable_LowPriority=4,X.unstable_NormalPriority=3,X.unstable_Profiling=null,X.unstable_UserBlockingPriority=2,X.unstable_cancelCallback=function(Oe){Oe.callback=null},X.unstable_continueExecution=function(){fe||pe||(fe=!0,rt(Ee))},X.unstable_forceFrameRate=function(Oe){0>Oe||125<Oe?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):_e=0<Oe?Math.floor(1e3/Oe):5},X.unstable_getCurrentPriorityLevel=function(){return de},X.unstable_getFirstCallbackNode=function(){return _(se)},X.unstable_next=function(Oe){switch(de){case 1:case 2:case 3:var $e=3;break;default:$e=de}var je=de;de=$e;try{return Oe()}finally{de=je}},X.unstable_pauseExecution=function(){},X.unstable_requestPaint=function(){},X.unstable_runWithPriority=function(Oe,$e){switch(Oe){case 1:case 2:case 3:case 4:case 5:break;default:Oe=3}var je=de;de=Oe;try{return $e()}finally{de=je}},X.unstable_scheduleCallback=function(Oe,$e,je){var Te=X.unstable_now();switch(typeof je=="object"&&je!==null?(je=je.delay,je=typeof je=="number"&&0<je?Te+je:Te):je=Te,Oe){case 1:var De=-1;break;case 2:De=250;break;case 5:De=1073741823;break;case 4:De=1e4;break;default:De=5e3}return De=je+De,Oe={id:ge++,callback:$e,priorityLevel:Oe,startTime:je,expirationTime:De,sortIndex:-1},je>Te?(Oe.sortIndex=je,Z(ae,Oe),_(se)===null&&Oe===_(ae)&&(be?(ye(Ve),Ve=-1):be=!0,at(Re,je-Te))):(Oe.sortIndex=De,Z(se,Oe),fe||pe||(fe=!0,rt(Ee))),Oe},X.unstable_shouldYield=Pe,X.unstable_wrapCallback=function(Oe){var $e=de;return function(){var je=de;de=$e;try{return Oe.apply(this,arguments)}finally{de=je}}}}(scheduler_production_min$2)),scheduler_production_min$2}var hasRequiredScheduler$2;function requireScheduler$2(){return hasRequiredScheduler$2||(hasRequiredScheduler$2=1,scheduler$2.exports=requireScheduler_production_min$2()),scheduler$2.exports}/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var hasRequiredReactDom_production_min;function requireReactDom_production_min(){if(hasRequiredReactDom_production_min)return reactDom_production_min;hasRequiredReactDom_production_min=1;var X=requireReact(),Z=requireScheduler$2();function _(le){for(var ue="https://reactjs.org/docs/error-decoder.html?invariant="+le,Ae=1;Ae<arguments.length;Ae++)ue+="&args[]="+encodeURIComponent(arguments[Ae]);return"Minified React error #"+le+"; visit "+ue+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var K=new Set,te={};function ne(le,ue){oe(le,ue),oe(le+"Capture",ue)}function oe(le,ue){for(te[le]=ue,le=0;le<ue.length;le++)K.add(ue[le])}var ie=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),se=Object.prototype.hasOwnProperty,ae=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,ge={},ce={};function de(le){return se.call(ce,le)?!0:se.call(ge,le)?!1:ae.test(le)?ce[le]=!0:(ge[le]=!0,!1)}function pe(le,ue,Ae,Se){if(Ae!==null&&Ae.type===0)return!1;switch(typeof ue){case"function":case"symbol":return!0;case"boolean":return Se?!1:Ae!==null?!Ae.acceptsBooleans:(le=le.toLowerCase().slice(0,5),le!=="data-"&&le!=="aria-");default:return!1}}function fe(le,ue,Ae,Se){if(ue===null||typeof ue>"u"||pe(le,ue,Ae,Se))return!0;if(Se)return!1;if(Ae!==null)switch(Ae.type){case 3:return!ue;case 4:return ue===!1;case 5:return isNaN(ue);case 6:return isNaN(ue)||1>ue}return!1}function be(le,ue,Ae,Se,Fe,Ye,nt){this.acceptsBooleans=ue===2||ue===3||ue===4,this.attributeName=Se,this.attributeNamespace=Fe,this.mustUseProperty=Ae,this.propertyName=le,this.type=ue,this.sanitizeURL=Ye,this.removeEmptyString=nt}var me={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(le){me[le]=new be(le,0,!1,le,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(le){var ue=le[0];me[ue]=new be(ue,1,!1,le[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(le){me[le]=new be(le,2,!1,le.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(le){me[le]=new be(le,2,!1,le,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(le){me[le]=new be(le,3,!1,le.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(le){me[le]=new be(le,3,!0,le,null,!1,!1)}),["capture","download"].forEach(function(le){me[le]=new be(le,4,!1,le,null,!1,!1)}),["cols","rows","size","span"].forEach(function(le){me[le]=new be(le,6,!1,le,null,!1,!1)}),["rowSpan","start"].forEach(function(le){me[le]=new be(le,5,!1,le.toLowerCase(),null,!1,!1)});var ye=/[\-:]([a-z])/g;function ve(le){return le[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(le){var ue=le.replace(ye,ve);me[ue]=new be(ue,1,!1,le,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(le){var ue=le.replace(ye,ve);me[ue]=new be(ue,1,!1,le,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(le){var ue=le.replace(ye,ve);me[ue]=new be(ue,1,!1,le,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(le){me[le]=new be(le,1,!1,le.toLowerCase(),null,!1,!1)}),me.xlinkHref=new be("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(le){me[le]=new be(le,1,!1,le.toLowerCase(),null,!0,!0)});function Be(le,ue,Ae,Se){var Fe=me.hasOwnProperty(ue)?me[ue]:null;(Fe!==null?Fe.type!==0:Se||!(2<ue.length)||ue[0]!=="o"&&ue[0]!=="O"||ue[1]!=="n"&&ue[1]!=="N")&&(fe(ue,Ae,Fe,Se)&&(Ae=null),Se||Fe===null?de(ue)&&(Ae===null?le.removeAttribute(ue):le.setAttribute(ue,""+Ae)):Fe.mustUseProperty?le[Fe.propertyName]=Ae===null?Fe.type===3?!1:"":Ae:(ue=Fe.attributeName,Se=Fe.attributeNamespace,Ae===null?le.removeAttribute(ue):(Fe=Fe.type,Ae=Fe===3||Fe===4&&Ae===!0?"":""+Ae,Se?le.setAttributeNS(Se,ue,Ae):le.setAttribute(ue,Ae))))}var Re=X.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,Ee=Symbol.for("react.element"),We=Symbol.for("react.portal"),Ze=Symbol.for("react.fragment"),Ve=Symbol.for("react.strict_mode"),_e=Symbol.for("react.profiler"),Xe=Symbol.for("react.provider"),Pe=Symbol.for("react.context"),He=Symbol.for("react.forward_ref"),Ke=Symbol.for("react.suspense"),Ue=Symbol.for("react.suspense_list"),tt=Symbol.for("react.memo"),rt=Symbol.for("react.lazy"),at=Symbol.for("react.offscreen"),Oe=Symbol.iterator;function $e(le){return le===null||typeof le!="object"?null:(le=Oe&&le[Oe]||le["@@iterator"],typeof le=="function"?le:null)}var je=Object.assign,Te;function De(le){if(Te===void 0)try{throw Error()}catch(Ae){var ue=Ae.stack.trim().match(/\n( *(at )?)/);Te=ue&&ue[1]||""}return`
`+Te+le}var ot=!1;function ct(le,ue){if(!le||ot)return"";ot=!0;var Ae=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(ue)if(ue=function(){throw Error()},Object.defineProperty(ue.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(ue,[])}catch(Yt){var Se=Yt}Reflect.construct(le,[],ue)}else{try{ue.call()}catch(Yt){Se=Yt}le.call(ue.prototype)}else{try{throw Error()}catch(Yt){Se=Yt}le()}}catch(Yt){if(Yt&&Se&&typeof Yt.stack=="string"){for(var Fe=Yt.stack.split(`
`),Ye=Se.stack.split(`
`),nt=Fe.length-1,Ct=Ye.length-1;1<=nt&&0<=Ct&&Fe[nt]!==Ye[Ct];)Ct--;for(;1<=nt&&0<=Ct;nt--,Ct--)if(Fe[nt]!==Ye[Ct]){if(nt!==1||Ct!==1)do if(nt--,Ct--,0>Ct||Fe[nt]!==Ye[Ct]){var bt=`
`+Fe[nt].replace(" at new "," at ");return le.displayName&&bt.includes("<anonymous>")&&(bt=bt.replace("<anonymous>",le.displayName)),bt}while(1<=nt&&0<=Ct);break}}}finally{ot=!1,Error.prepareStackTrace=Ae}return(le=le?le.displayName||le.name:"")?De(le):""}function gt(le){switch(le.tag){case 5:return De(le.type);case 16:return De("Lazy");case 13:return De("Suspense");case 19:return De("SuspenseList");case 0:case 2:case 15:return le=ct(le.type,!1),le;case 11:return le=ct(le.type.render,!1),le;case 1:return le=ct(le.type,!0),le;default:return""}}function pt(le){if(le==null)return null;if(typeof le=="function")return le.displayName||le.name||null;if(typeof le=="string")return le;switch(le){case Ze:return"Fragment";case We:return"Portal";case _e:return"Profiler";case Ve:return"StrictMode";case Ke:return"Suspense";case Ue:return"SuspenseList"}if(typeof le=="object")switch(le.$$typeof){case Pe:return(le.displayName||"Context")+".Consumer";case Xe:return(le._context.displayName||"Context")+".Provider";case He:var ue=le.render;return le=le.displayName,le||(le=ue.displayName||ue.name||"",le=le!==""?"ForwardRef("+le+")":"ForwardRef"),le;case tt:return ue=le.displayName||null,ue!==null?ue:pt(le.type)||"Memo";case rt:ue=le._payload,le=le._init;try{return pt(le(ue))}catch{}}return null}function ht(le){var ue=le.type;switch(le.tag){case 24:return"Cache";case 9:return(ue.displayName||"Context")+".Consumer";case 10:return(ue._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return le=ue.render,le=le.displayName||le.name||"",ue.displayName||(le!==""?"ForwardRef("+le+")":"ForwardRef");case 7:return"Fragment";case 5:return ue;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return pt(ue);case 8:return ue===Ve?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof ue=="function")return ue.displayName||ue.name||null;if(typeof ue=="string")return ue}return null}function At(le){switch(typeof le){case"boolean":case"number":case"string":case"undefined":return le;case"object":return le;default:return""}}function Kt(le){var ue=le.type;return(le=le.nodeName)&&le.toLowerCase()==="input"&&(ue==="checkbox"||ue==="radio")}function en(le){var ue=Kt(le)?"checked":"value",Ae=Object.getOwnPropertyDescriptor(le.constructor.prototype,ue),Se=""+le[ue];if(!le.hasOwnProperty(ue)&&typeof Ae<"u"&&typeof Ae.get=="function"&&typeof Ae.set=="function"){var Fe=Ae.get,Ye=Ae.set;return Object.defineProperty(le,ue,{configurable:!0,get:function(){return Fe.call(this)},set:function(nt){Se=""+nt,Ye.call(this,nt)}}),Object.defineProperty(le,ue,{enumerable:Ae.enumerable}),{getValue:function(){return Se},setValue:function(nt){Se=""+nt},stopTracking:function(){le._valueTracker=null,delete le[ue]}}}}function Zt(le){le._valueTracker||(le._valueTracker=en(le))}function st(le){if(!le)return!1;var ue=le._valueTracker;if(!ue)return!0;var Ae=ue.getValue(),Se="";return le&&(Se=Kt(le)?le.checked?"true":"false":le.value),le=Se,le!==Ae?(ue.setValue(le),!0):!1}function Vt(le){if(le=le||(typeof document<"u"?document:void 0),typeof le>"u")return null;try{return le.activeElement||le.body}catch{return le.body}}function wt(le,ue){var Ae=ue.checked;return je({},ue,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:Ae??le._wrapperState.initialChecked})}function St(le,ue){var Ae=ue.defaultValue==null?"":ue.defaultValue,Se=ue.checked!=null?ue.checked:ue.defaultChecked;Ae=At(ue.value!=null?ue.value:Ae),le._wrapperState={initialChecked:Se,initialValue:Ae,controlled:ue.type==="checkbox"||ue.type==="radio"?ue.checked!=null:ue.value!=null}}function Rt(le,ue){ue=ue.checked,ue!=null&&Be(le,"checked",ue,!1)}function jt(le,ue){Rt(le,ue);var Ae=At(ue.value),Se=ue.type;if(Ae!=null)Se==="number"?(Ae===0&&le.value===""||le.value!=Ae)&&(le.value=""+Ae):le.value!==""+Ae&&(le.value=""+Ae);else if(Se==="submit"||Se==="reset"){le.removeAttribute("value");return}ue.hasOwnProperty("value")?Ht(le,ue.type,Ae):ue.hasOwnProperty("defaultValue")&&Ht(le,ue.type,At(ue.defaultValue)),ue.checked==null&&ue.defaultChecked!=null&&(le.defaultChecked=!!ue.defaultChecked)}function Wt(le,ue,Ae){if(ue.hasOwnProperty("value")||ue.hasOwnProperty("defaultValue")){var Se=ue.type;if(!(Se!=="submit"&&Se!=="reset"||ue.value!==void 0&&ue.value!==null))return;ue=""+le._wrapperState.initialValue,Ae||ue===le.value||(le.value=ue),le.defaultValue=ue}Ae=le.name,Ae!==""&&(le.name=""),le.defaultChecked=!!le._wrapperState.initialChecked,Ae!==""&&(le.name=Ae)}function Ht(le,ue,Ae){(ue!=="number"||Vt(le.ownerDocument)!==le)&&(Ae==null?le.defaultValue=""+le._wrapperState.initialValue:le.defaultValue!==""+Ae&&(le.defaultValue=""+Ae))}var Pt=Array.isArray;function Mt(le,ue,Ae,Se){if(le=le.options,ue){ue={};for(var Fe=0;Fe<Ae.length;Fe++)ue["$"+Ae[Fe]]=!0;for(Ae=0;Ae<le.length;Ae++)Fe=ue.hasOwnProperty("$"+le[Ae].value),le[Ae].selected!==Fe&&(le[Ae].selected=Fe),Fe&&Se&&(le[Ae].defaultSelected=!0)}else{for(Ae=""+At(Ae),ue=null,Fe=0;Fe<le.length;Fe++){if(le[Fe].value===Ae){le[Fe].selected=!0,Se&&(le[Fe].defaultSelected=!0);return}ue!==null||le[Fe].disabled||(ue=le[Fe])}ue!==null&&(ue.selected=!0)}}function un(le,ue){if(ue.dangerouslySetInnerHTML!=null)throw Error(_(91));return je({},ue,{value:void 0,defaultValue:void 0,children:""+le._wrapperState.initialValue})}function qe(le,ue){var Ae=ue.value;if(Ae==null){if(Ae=ue.children,ue=ue.defaultValue,Ae!=null){if(ue!=null)throw Error(_(92));if(Pt(Ae)){if(1<Ae.length)throw Error(_(93));Ae=Ae[0]}ue=Ae}ue==null&&(ue=""),Ae=ue}le._wrapperState={initialValue:At(Ae)}}function Je(le,ue){var Ae=At(ue.value),Se=At(ue.defaultValue);Ae!=null&&(Ae=""+Ae,Ae!==le.value&&(le.value=Ae),ue.defaultValue==null&&le.defaultValue!==Ae&&(le.defaultValue=Ae)),Se!=null&&(le.defaultValue=""+Se)}function mt(le){var ue=le.textContent;ue===le._wrapperState.initialValue&&ue!==""&&ue!==null&&(le.value=ue)}function Dt(le){switch(le){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function _t(le,ue){return le==null||le==="http://www.w3.org/1999/xhtml"?Dt(ue):le==="http://www.w3.org/2000/svg"&&ue==="foreignObject"?"http://www.w3.org/1999/xhtml":le}var zt,nn=function(le){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(ue,Ae,Se,Fe){MSApp.execUnsafeLocalFunction(function(){return le(ue,Ae,Se,Fe)})}:le}(function(le,ue){if(le.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in le)le.innerHTML=ue;else{for(zt=zt||document.createElement("div"),zt.innerHTML="<svg>"+ue.valueOf().toString()+"</svg>",ue=zt.firstChild;le.firstChild;)le.removeChild(le.firstChild);for(;ue.firstChild;)le.appendChild(ue.firstChild)}});function tn(le,ue){if(ue){var Ae=le.firstChild;if(Ae&&Ae===le.lastChild&&Ae.nodeType===3){Ae.nodeValue=ue;return}}le.textContent=ue}var Ft={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},pn=["Webkit","ms","Moz","O"];Object.keys(Ft).forEach(function(le){pn.forEach(function(ue){ue=ue+le.charAt(0).toUpperCase()+le.substring(1),Ft[ue]=Ft[le]})});function sn(le,ue,Ae){return ue==null||typeof ue=="boolean"||ue===""?"":Ae||typeof ue!="number"||ue===0||Ft.hasOwnProperty(le)&&Ft[le]?(""+ue).trim():ue+"px"}function rn(le,ue){le=le.style;for(var Ae in ue)if(ue.hasOwnProperty(Ae)){var Se=Ae.indexOf("--")===0,Fe=sn(Ae,ue[Ae],Se);Ae==="float"&&(Ae="cssFloat"),Se?le.setProperty(Ae,Fe):le[Ae]=Fe}}var $t=je({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function on(le,ue){if(ue){if($t[le]&&(ue.children!=null||ue.dangerouslySetInnerHTML!=null))throw Error(_(137,le));if(ue.dangerouslySetInnerHTML!=null){if(ue.children!=null)throw Error(_(60));if(typeof ue.dangerouslySetInnerHTML!="object"||!("__html"in ue.dangerouslySetInnerHTML))throw Error(_(61))}if(ue.style!=null&&typeof ue.style!="object")throw Error(_(62))}}function An(le,ue){if(le.indexOf("-")===-1)return typeof ue.is=="string";switch(le){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var wn=null;function ft(le){return le=le.target||le.srcElement||window,le.correspondingUseElement&&(le=le.correspondingUseElement),le.nodeType===3?le.parentNode:le}var vt=null,Et=null,gn=null;function an(le){if(le=Qo(le)){if(typeof vt!="function")throw Error(_(280));var ue=le.stateNode;ue&&(ue=Kl(ue),vt(le.stateNode,le.type,ue))}}function vn(le){Et?gn?gn.push(le):gn=[le]:Et=le}function zn(){if(Et){var le=Et,ue=gn;if(gn=Et=null,an(le),ue)for(le=0;le<ue.length;le++)an(ue[le])}}function On(le,ue){return le(ue)}function Tn(){}var Xn=!1;function dr(le,ue,Ae){if(Xn)return le(ue,Ae);Xn=!0;try{return On(le,ue,Ae)}finally{Xn=!1,(Et!==null||gn!==null)&&(Tn(),zn())}}function rr(le,ue){var Ae=le.stateNode;if(Ae===null)return null;var Se=Kl(Ae);if(Se===null)return null;Ae=Se[ue];e:switch(ue){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(Se=!Se.disabled)||(le=le.type,Se=!(le==="button"||le==="input"||le==="select"||le==="textarea")),le=!Se;break e;default:le=!1}if(le)return null;if(Ae&&typeof Ae!="function")throw Error(_(231,ue,typeof Ae));return Ae}var fr=!1;if(ie)try{var Nr={};Object.defineProperty(Nr,"passive",{get:function(){fr=!0}}),window.addEventListener("test",Nr,Nr),window.removeEventListener("test",Nr,Nr)}catch{fr=!1}function ei(le,ue,Ae,Se,Fe,Ye,nt,Ct,bt){var Yt=Array.prototype.slice.call(arguments,3);try{ue.apply(Ae,Yt)}catch(cn){this.onError(cn)}}var Er=!1,Lr=null,br=!1,kn=null,Hr={onError:function(le){Er=!0,Lr=le}};function Yi(le,ue,Ae,Se,Fe,Ye,nt,Ct,bt){Er=!1,Lr=null,ei.apply(Hr,arguments)}function Qe(le,ue,Ae,Se,Fe,Ye,nt,Ct,bt){if(Yi.apply(this,arguments),Er){if(Er){var Yt=Lr;Er=!1,Lr=null}else throw Error(_(198));br||(br=!0,kn=Yt)}}function ke(le){var ue=le,Ae=le;if(le.alternate)for(;ue.return;)ue=ue.return;else{le=ue;do ue=le,(ue.flags&4098)!==0&&(Ae=ue.return),le=ue.return;while(le)}return ue.tag===3?Ae:null}function it(le){if(le.tag===13){var ue=le.memoizedState;if(ue===null&&(le=le.alternate,le!==null&&(ue=le.memoizedState)),ue!==null)return ue.dehydrated}return null}function ut(le){if(ke(le)!==le)throw Error(_(188))}function lt(le){var ue=le.alternate;if(!ue){if(ue=ke(le),ue===null)throw Error(_(188));return ue!==le?null:le}for(var Ae=le,Se=ue;;){var Fe=Ae.return;if(Fe===null)break;var Ye=Fe.alternate;if(Ye===null){if(Se=Fe.return,Se!==null){Ae=Se;continue}break}if(Fe.child===Ye.child){for(Ye=Fe.child;Ye;){if(Ye===Ae)return ut(Fe),le;if(Ye===Se)return ut(Fe),ue;Ye=Ye.sibling}throw Error(_(188))}if(Ae.return!==Se.return)Ae=Fe,Se=Ye;else{for(var nt=!1,Ct=Fe.child;Ct;){if(Ct===Ae){nt=!0,Ae=Fe,Se=Ye;break}if(Ct===Se){nt=!0,Se=Fe,Ae=Ye;break}Ct=Ct.sibling}if(!nt){for(Ct=Ye.child;Ct;){if(Ct===Ae){nt=!0,Ae=Ye,Se=Fe;break}if(Ct===Se){nt=!0,Se=Ye,Ae=Fe;break}Ct=Ct.sibling}if(!nt)throw Error(_(189))}}if(Ae.alternate!==Se)throw Error(_(190))}if(Ae.tag!==3)throw Error(_(188));return Ae.stateNode.current===Ae?le:ue}function It(le){return le=lt(le),le!==null?Nt(le):null}function Nt(le){if(le.tag===5||le.tag===6)return le;for(le=le.child;le!==null;){var ue=Nt(le);if(ue!==null)return ue;le=le.sibling}return null}var Xt=Z.unstable_scheduleCallback,Ot=Z.unstable_cancelCallback,Jt=Z.unstable_shouldYield,qt=Z.unstable_requestPaint,yt=Z.unstable_now,yn=Z.unstable_getCurrentPriorityLevel,Cn=Z.unstable_ImmediatePriority,hn=Z.unstable_UserBlockingPriority,xn=Z.unstable_NormalPriority,Hn=Z.unstable_LowPriority,Wn=Z.unstable_IdlePriority,bn=null,_n=null;function Zn(le){if(_n&&typeof _n.onCommitFiberRoot=="function")try{_n.onCommitFiberRoot(bn,le,void 0,(le.current.flags&128)===128)}catch{}}var Nn=Math.clz32?Math.clz32:cr,gr=Math.log,Dn=Math.LN2;function cr(le){return le>>>=0,le===0?32:31-(gr(le)/Dn|0)|0}var tr=64,sr=4194304;function Ir(le){switch(le&-le){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return le&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return le&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return le}}function Kn(le,ue){var Ae=le.pendingLanes;if(Ae===0)return 0;var Se=0,Fe=le.suspendedLanes,Ye=le.pingedLanes,nt=Ae&268435455;if(nt!==0){var Ct=nt&~Fe;Ct!==0?Se=Ir(Ct):(Ye&=nt,Ye!==0&&(Se=Ir(Ye)))}else nt=Ae&~Fe,nt!==0?Se=Ir(nt):Ye!==0&&(Se=Ir(Ye));if(Se===0)return 0;if(ue!==0&&ue!==Se&&(ue&Fe)===0&&(Fe=Se&-Se,Ye=ue&-ue,Fe>=Ye||Fe===16&&(Ye&4194240)!==0))return ue;if((Se&4)!==0&&(Se|=Ae&16),ue=le.entangledLanes,ue!==0)for(le=le.entanglements,ue&=Se;0<ue;)Ae=31-Nn(ue),Fe=1<<Ae,Se|=le[Ae],ue&=~Fe;return Se}function yr(le,ue){switch(le){case 1:case 2:case 4:return ue+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return ue+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function ar(le,ue){for(var Ae=le.suspendedLanes,Se=le.pingedLanes,Fe=le.expirationTimes,Ye=le.pendingLanes;0<Ye;){var nt=31-Nn(Ye),Ct=1<<nt,bt=Fe[nt];bt===-1?((Ct&Ae)===0||(Ct&Se)!==0)&&(Fe[nt]=yr(Ct,ue)):bt<=ue&&(le.expiredLanes|=Ct),Ye&=~Ct}}function jn(le){return le=le.pendingLanes&-1073741825,le!==0?le:le&1073741824?1073741824:0}function vr(){var le=tr;return tr<<=1,(tr&4194240)===0&&(tr=64),le}function mi(le){for(var ue=[],Ae=0;31>Ae;Ae++)ue.push(le);return ue}function wr(le,ue,Ae){le.pendingLanes|=ue,ue!==536870912&&(le.suspendedLanes=0,le.pingedLanes=0),le=le.eventTimes,ue=31-Nn(ue),le[ue]=Ae}function Ki(le,ue){var Ae=le.pendingLanes&~ue;le.pendingLanes=ue,le.suspendedLanes=0,le.pingedLanes=0,le.expiredLanes&=ue,le.mutableReadLanes&=ue,le.entangledLanes&=ue,ue=le.entanglements;var Se=le.eventTimes;for(le=le.expirationTimes;0<Ae;){var Fe=31-Nn(Ae),Ye=1<<Fe;ue[Fe]=0,Se[Fe]=-1,le[Fe]=-1,Ae&=~Ye}}function ho(le,ue){var Ae=le.entangledLanes|=ue;for(le=le.entanglements;Ae;){var Se=31-Nn(Ae),Fe=1<<Se;Fe&ue|le[Se]&ue&&(le[Se]|=ue),Ae&=~Fe}}var or=0;function xo(le){return le&=-le,1<le?4<le?(le&268435455)!==0?16:536870912:4:1}var Cs,aa,la,Zo,Ws,ro=!1,fo=[],ui=null,Jn=null,io=null,zi=new Map,Eo=new Map,oo=[],Al="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function _r(le,ue){switch(le){case"focusin":case"focusout":ui=null;break;case"dragenter":case"dragleave":Jn=null;break;case"mouseover":case"mouseout":io=null;break;case"pointerover":case"pointerout":zi.delete(ue.pointerId);break;case"gotpointercapture":case"lostpointercapture":Eo.delete(ue.pointerId)}}function Ao(le,ue,Ae,Se,Fe,Ye){return le===null||le.nativeEvent!==Ye?(le={blockedOn:ue,domEventName:Ae,eventSystemFlags:Se,nativeEvent:Ye,targetContainers:[Fe]},ue!==null&&(ue=Qo(ue),ue!==null&&aa(ue)),le):(le.eventSystemFlags|=Se,ue=le.targetContainers,Fe!==null&&ue.indexOf(Fe)===-1&&ue.push(Fe),le)}function ml(le,ue,Ae,Se,Fe){switch(ue){case"focusin":return ui=Ao(ui,le,ue,Ae,Se,Fe),!0;case"dragenter":return Jn=Ao(Jn,le,ue,Ae,Se,Fe),!0;case"mouseover":return io=Ao(io,le,ue,Ae,Se,Fe),!0;case"pointerover":var Ye=Fe.pointerId;return zi.set(Ye,Ao(zi.get(Ye)||null,le,ue,Ae,Se,Fe)),!0;case"gotpointercapture":return Ye=Fe.pointerId,Eo.set(Ye,Ao(Eo.get(Ye)||null,le,ue,Ae,Se,Fe)),!0}return!1}function bi(le){var ue=ws(le.target);if(ue!==null){var Ae=ke(ue);if(Ae!==null){if(ue=Ae.tag,ue===13){if(ue=it(Ae),ue!==null){le.blockedOn=ue,Ws(le.priority,function(){la(Ae)});return}}else if(ue===3&&Ae.stateNode.current.memoizedState.isDehydrated){le.blockedOn=Ae.tag===3?Ae.stateNode.containerInfo:null;return}}}le.blockedOn=null}function hs(le){if(le.blockedOn!==null)return!1;for(var ue=le.targetContainers;0<ue.length;){var Ae=yi(le.domEventName,le.eventSystemFlags,ue[0],le.nativeEvent);if(Ae===null){Ae=le.nativeEvent;var Se=new Ae.constructor(Ae.type,Ae);wn=Se,Ae.target.dispatchEvent(Se),wn=null}else return ue=Qo(Ae),ue!==null&&aa(ue),le.blockedOn=Ae,!1;ue.shift()}return!0}function fs(le,ue,Ae){hs(le)&&Ae.delete(ue)}function Di(){ro=!1,ui!==null&&hs(ui)&&(ui=null),Jn!==null&&hs(Jn)&&(Jn=null),io!==null&&hs(io)&&(io=null),zi.forEach(fs),Eo.forEach(fs)}function Xo(le,ue){le.blockedOn===ue&&(le.blockedOn=null,ro||(ro=!0,Z.unstable_scheduleCallback(Z.unstable_NormalPriority,Di)))}function As(le){function ue(Fe){return Xo(Fe,le)}if(0<fo.length){Xo(fo[0],le);for(var Ae=1;Ae<fo.length;Ae++){var Se=fo[Ae];Se.blockedOn===le&&(Se.blockedOn=null)}}for(ui!==null&&Xo(ui,le),Jn!==null&&Xo(Jn,le),io!==null&&Xo(io,le),zi.forEach(ue),Eo.forEach(ue),Ae=0;Ae<oo.length;Ae++)Se=oo[Ae],Se.blockedOn===le&&(Se.blockedOn=null);for(;0<oo.length&&(Ae=oo[0],Ae.blockedOn===null);)bi(Ae),Ae.blockedOn===null&&oo.shift()}var ti=Re.ReactCurrentBatchConfig,ni=!0;function _o(le,ue,Ae,Se){var Fe=or,Ye=ti.transition;ti.transition=null;try{or=1,Fs(le,ue,Ae,Se)}finally{or=Fe,ti.transition=Ye}}function so(le,ue,Ae,Se){var Fe=or,Ye=ti.transition;ti.transition=null;try{or=4,Fs(le,ue,Ae,Se)}finally{or=Fe,ti.transition=Ye}}function Fs(le,ue,Ae,Se){if(ni){var Fe=yi(le,ue,Ae,Se);if(Fe===null)Nl(le,ue,Se,ms,Ae),_r(le,Se);else if(ml(Fe,le,ue,Ae,Se))Se.stopPropagation();else if(_r(le,Se),ue&4&&-1<Al.indexOf(le)){for(;Fe!==null;){var Ye=Qo(Fe);if(Ye!==null&&Cs(Ye),Ye=yi(le,ue,Ae,Se),Ye===null&&Nl(le,ue,Se,ms,Ae),Ye===Fe)break;Fe=Ye}Fe!==null&&Se.stopPropagation()}else Nl(le,ue,Se,null,Ae)}}var ms=null;function yi(le,ue,Ae,Se){if(ms=null,le=ft(Se),le=ws(le),le!==null)if(ue=ke(le),ue===null)le=null;else if(Ae=ue.tag,Ae===13){if(le=it(ue),le!==null)return le;le=null}else if(Ae===3){if(ue.stateNode.current.memoizedState.isDehydrated)return ue.tag===3?ue.stateNode.containerInfo:null;le=null}else ue!==le&&(le=null);return ms=le,null}function bs(le){switch(le){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(yn()){case Cn:return 1;case hn:return 4;case xn:case Hn:return 16;case Wn:return 536870912;default:return 16}default:return 16}}var Vi=null,ko=null,ri=null;function Jr(){if(ri)return ri;var le,ue=ko,Ae=ue.length,Se,Fe="value"in Vi?Vi.value:Vi.textContent,Ye=Fe.length;for(le=0;le<Ae&&ue[le]===Fe[le];le++);var nt=Ae-le;for(Se=1;Se<=nt&&ue[Ae-Se]===Fe[Ye-Se];Se++);return ri=Fe.slice(le,1<Se?1-Se:void 0)}function Yo(le){var ue=le.keyCode;return"charCode"in le?(le=le.charCode,le===0&&ue===13&&(le=13)):le=ue,le===10&&(le=13),32<=le||le===13?le:0}function Ti(){return!0}function Ko(){return!1}function ii(le){function ue(Ae,Se,Fe,Ye,nt){this._reactName=Ae,this._targetInst=Fe,this.type=Se,this.nativeEvent=Ye,this.target=nt,this.currentTarget=null;for(var Ct in le)le.hasOwnProperty(Ct)&&(Ae=le[Ct],this[Ct]=Ae?Ae(Ye):Ye[Ct]);return this.isDefaultPrevented=(Ye.defaultPrevented!=null?Ye.defaultPrevented:Ye.returnValue===!1)?Ti:Ko,this.isPropagationStopped=Ko,this}return je(ue.prototype,{preventDefault:function(){this.defaultPrevented=!0;var Ae=this.nativeEvent;Ae&&(Ae.preventDefault?Ae.preventDefault():typeof Ae.returnValue!="unknown"&&(Ae.returnValue=!1),this.isDefaultPrevented=Ti)},stopPropagation:function(){var Ae=this.nativeEvent;Ae&&(Ae.stopPropagation?Ae.stopPropagation():typeof Ae.cancelBubble!="unknown"&&(Ae.cancelBubble=!0),this.isPropagationStopped=Ti)},persist:function(){},isPersistent:Ti}),ue}var zo={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(le){return le.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Ur=ii(zo),Qr=je({},zo,{view:0,detail:0}),Kr=ii(Qr),Fr,wi,ao,ga=je({},Qr,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:vs,button:0,buttons:0,relatedTarget:function(le){return le.relatedTarget===void 0?le.fromElement===le.srcElement?le.toElement:le.fromElement:le.relatedTarget},movementX:function(le){return"movementX"in le?le.movementX:(le!==ao&&(ao&&le.type==="mousemove"?(Fr=le.screenX-ao.screenX,wi=le.screenY-ao.screenY):wi=Fr=0,ao=le),Fr)},movementY:function(le){return"movementY"in le?le.movementY:wi}}),lg=ii(ga),Do=je({},ga,{dataTransfer:0}),ys=ii(Do),bl=je({},Qr,{relatedTarget:0}),yl=ii(bl),vl=je({},zo,{animationName:0,elapsedTime:0,pseudoElement:0}),qg=ii(vl),ec=je({},zo,{clipboardData:function(le){return"clipboardData"in le?le.clipboardData:window.clipboardData}}),gg=ii(ec),Bl=je({},zo,{data:0}),cg=ii(Bl),tc={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},nc={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},ug={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function ca(le){var ue=this.nativeEvent;return ue.getModifierState?ue.getModifierState(le):(le=ug[le])?!!ue[le]:!1}function vs(){return ca}var Gl=je({},Qr,{key:function(le){if(le.key){var ue=tc[le.key]||le.key;if(ue!=="Unidentified")return ue}return le.type==="keypress"?(le=Yo(le),le===13?"Enter":String.fromCharCode(le)):le.type==="keydown"||le.type==="keyup"?nc[le.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:vs,charCode:function(le){return le.type==="keypress"?Yo(le):0},keyCode:function(le){return le.type==="keydown"||le.type==="keyup"?le.keyCode:0},which:function(le){return le.type==="keypress"?Yo(le):le.type==="keydown"||le.type==="keyup"?le.keyCode:0}}),Sl=ii(Gl),lo=je({},ga,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Ui=ii(lo),Vs=je({},Qr,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:vs}),Uo=ii(Vs),Po=je({},zo,{propertyName:0,elapsedTime:0,pseudoElement:0}),Ts=ii(Po),rc=je({},ga,{deltaX:function(le){return"deltaX"in le?le.deltaX:"wheelDeltaX"in le?-le.wheelDeltaX:0},deltaY:function(le){return"deltaY"in le?le.deltaY:"wheelDeltaY"in le?-le.wheelDeltaY:"wheelDelta"in le?-le.wheelDelta:0},deltaZ:0,deltaMode:0}),dg=ii(rc),Ig=[9,13,27,32],xi=ie&&"CompositionEvent"in window,di=null;ie&&"documentMode"in document&&(di=document.documentMode);var Mr=ie&&"TextEvent"in window&&!di,ua=ie&&(!xi||di&&8<di&&11>=di),go=" ",pg=!1;function Cg(le,ue){switch(le){case"keyup":return Ig.indexOf(ue.keyCode)!==-1;case"keydown":return ue.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Rl(le){return le=le.detail,typeof le=="object"&&"data"in le?le.data:null}var Bs=!1;function ic(le,ue){switch(le){case"compositionend":return Rl(ue);case"keypress":return ue.which!==32?null:(pg=!0,go);case"textInput":return le=ue.data,le===go&&pg?null:le;default:return null}}function La(le,ue){if(Bs)return le==="compositionend"||!xi&&Cg(le,ue)?(le=Jr(),ri=ko=Vi=null,Bs=!1,le):null;switch(le){case"paste":return null;case"keypress":if(!(ue.ctrlKey||ue.altKey||ue.metaKey)||ue.ctrlKey&&ue.altKey){if(ue.char&&1<ue.char.length)return ue.char;if(ue.which)return String.fromCharCode(ue.which)}return null;case"compositionend":return ua&&ue.locale!=="ko"?null:ue.data;default:return null}}var da={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function wl(le){var ue=le&&le.nodeName&&le.nodeName.toLowerCase();return ue==="input"?!!da[le.type]:ue==="textarea"}function Ia(le,ue,Ae,Se){vn(Se),ue=Ll(ue,"onChange"),0<ue.length&&(Ae=new Ur("onChange","change",null,Ae,Se),le.push({event:Ae,listeners:ue}))}var Gs=null,pa=null;function oc(le){Aa(le,0)}function Oo(le){var ue=zr(le);if(st(ue))return le}function sc(le,ue){if(le==="change")return ue}var Ca=!1;if(ie){var Ni;if(ie){var Ns="oninput"in document;if(!Ns){var Ls=document.createElement("div");Ls.setAttribute("oninput","return;"),Ns=typeof Ls.oninput=="function"}Ni=Ns}else Ni=!1;Ca=Ni&&(!document.documentMode||9<document.documentMode)}function mo(){Gs&&(Gs.detachEvent("onpropertychange",xl),pa=Gs=null)}function xl(le){if(le.propertyName==="value"&&Oo(pa)){var ue=[];Ia(ue,pa,le,ft(le)),dr(oc,ue)}}function ha(le,ue,Ae){le==="focusin"?(mo(),Gs=ue,pa=Ae,Gs.attachEvent("onpropertychange",xl)):le==="focusout"&&mo()}function ac(le){if(le==="selectionchange"||le==="keyup"||le==="keydown")return Oo(pa)}function hg(le,ue){if(le==="click")return Oo(ue)}function Vr(le,ue){if(le==="input"||le==="change")return Oo(ue)}function Zl(le,ue){return le===ue&&(le!==0||1/le===1/ue)||le!==le&&ue!==ue}var Pi=typeof Object.is=="function"?Object.is:Zl;function Hs(le,ue){if(Pi(le,ue))return!0;if(typeof le!="object"||le===null||typeof ue!="object"||ue===null)return!1;var Ae=Object.keys(le),Se=Object.keys(ue);if(Ae.length!==Se.length)return!1;for(Se=0;Se<Ae.length;Se++){var Fe=Ae[Se];if(!se.call(ue,Fe)||!Pi(le[Fe],ue[Fe]))return!1}return!0}function Ha(le){for(;le&&le.firstChild;)le=le.firstChild;return le}function Oi(le,ue){var Ae=Ha(le);le=0;for(var Se;Ae;){if(Ae.nodeType===3){if(Se=le+Ae.textContent.length,le<=ue&&Se>=ue)return{node:Ae,offset:ue-le};le=Se}e:{for(;Ae;){if(Ae.nextSibling){Ae=Ae.nextSibling;break e}Ae=Ae.parentNode}Ae=void 0}Ae=Ha(Ae)}}function Xs(le,ue){return le&&ue?le===ue?!0:le&&le.nodeType===3?!1:ue&&ue.nodeType===3?Xs(le,ue.parentNode):"contains"in le?le.contains(ue):le.compareDocumentPosition?!!(le.compareDocumentPosition(ue)&16):!1:!1}function Tr(){for(var le=window,ue=Vt();ue instanceof le.HTMLIFrameElement;){try{var Ae=typeof ue.contentWindow.location.href=="string"}catch{Ae=!1}if(Ae)le=ue.contentWindow;else break;ue=Vt(le.document)}return ue}function oi(le){var ue=le&&le.nodeName&&le.nodeName.toLowerCase();return ue&&(ue==="input"&&(le.type==="text"||le.type==="search"||le.type==="tel"||le.type==="url"||le.type==="password")||ue==="textarea"||le.contentEditable==="true")}function si(le){var ue=Tr(),Ae=le.focusedElem,Se=le.selectionRange;if(ue!==Ae&&Ae&&Ae.ownerDocument&&Xs(Ae.ownerDocument.documentElement,Ae)){if(Se!==null&&oi(Ae)){if(ue=Se.start,le=Se.end,le===void 0&&(le=ue),"selectionStart"in Ae)Ae.selectionStart=ue,Ae.selectionEnd=Math.min(le,Ae.value.length);else if(le=(ue=Ae.ownerDocument||document)&&ue.defaultView||window,le.getSelection){le=le.getSelection();var Fe=Ae.textContent.length,Ye=Math.min(Se.start,Fe);Se=Se.end===void 0?Ye:Math.min(Se.end,Fe),!le.extend&&Ye>Se&&(Fe=Se,Se=Ye,Ye=Fe),Fe=Oi(Ae,Ye);var nt=Oi(Ae,Se);Fe&&nt&&(le.rangeCount!==1||le.anchorNode!==Fe.node||le.anchorOffset!==Fe.offset||le.focusNode!==nt.node||le.focusOffset!==nt.offset)&&(ue=ue.createRange(),ue.setStart(Fe.node,Fe.offset),le.removeAllRanges(),Ye>Se?(le.addRange(ue),le.extend(nt.node,nt.offset)):(ue.setEnd(nt.node,nt.offset),le.addRange(ue)))}}for(ue=[],le=Ae;le=le.parentNode;)le.nodeType===1&&ue.push({element:le,left:le.scrollLeft,top:le.scrollTop});for(typeof Ae.focus=="function"&&Ae.focus(),Ae=0;Ae<ue.length;Ae++)le=ue[Ae],le.element.scrollLeft=le.left,le.element.scrollTop=le.top}}var El=ie&&"documentMode"in document&&11>=document.documentMode,Mo=null,ks=null,Xa=null,ai=!1;function _l(le,ue,Ae){var Se=Ae.window===Ae?Ae.document:Ae.nodeType===9?Ae:Ae.ownerDocument;ai||Mo==null||Mo!==Vt(Se)||(Se=Mo,"selectionStart"in Se&&oi(Se)?Se={start:Se.selectionStart,end:Se.selectionEnd}:(Se=(Se.ownerDocument&&Se.ownerDocument.defaultView||window).getSelection(),Se={anchorNode:Se.anchorNode,anchorOffset:Se.anchorOffset,focusNode:Se.focusNode,focusOffset:Se.focusOffset}),Xa&&Hs(Xa,Se)||(Xa=Se,Se=Ll(ks,"onSelect"),0<Se.length&&(ue=new Ur("onSelect","select",null,ue,Ae),le.push({event:ue,listeners:Se}),ue.target=Mo)))}function fa(le,ue){var Ae={};return Ae[le.toLowerCase()]=ue.toLowerCase(),Ae["Webkit"+le]="webkit"+ue,Ae["Moz"+le]="moz"+ue,Ae}var Ss={animationend:fa("Animation","AnimationEnd"),animationiteration:fa("Animation","AnimationIteration"),animationstart:fa("Animation","AnimationStart"),transitionend:fa("Transition","TransitionEnd")},bo={},yo={};ie&&(yo=document.createElement("div").style,"AnimationEvent"in window||(delete Ss.animationend.animation,delete Ss.animationiteration.animation,delete Ss.animationstart.animation),"TransitionEvent"in window||delete Ss.transitionend.transition);function Wo(le){if(bo[le])return bo[le];if(!Ss[le])return le;var ue=Ss[le],Ae;for(Ae in ue)if(ue.hasOwnProperty(Ae)&&Ae in yo)return bo[le]=ue[Ae];return le}var ka=Wo("animationend"),Ya=Wo("animationiteration"),fg=Wo("animationstart"),Ag=Wo("transitionend"),mg=new Map,bg="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function jo(le,ue){mg.set(le,ue),ne(ue,[le])}for(var Ml=0;Ml<bg.length;Ml++){var Ka=bg[Ml],za=Ka.toLowerCase(),lc=Ka[0].toUpperCase()+Ka.slice(1);jo(za,"on"+lc)}jo(ka,"onAnimationEnd"),jo(Ya,"onAnimationIteration"),jo(fg,"onAnimationStart"),jo("dblclick","onDoubleClick"),jo("focusin","onFocus"),jo("focusout","onBlur"),jo(Ag,"onTransitionEnd"),oe("onMouseEnter",["mouseout","mouseover"]),oe("onMouseLeave",["mouseout","mouseover"]),oe("onPointerEnter",["pointerout","pointerover"]),oe("onPointerLeave",["pointerout","pointerover"]),ne("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),ne("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),ne("onBeforeInput",["compositionend","keypress","textInput","paste"]),ne("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),ne("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),ne("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Rs="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Wl=new Set("cancel close invalid load scroll toggle".split(" ").concat(Rs));function Fl(le,ue,Ae){var Se=le.type||"unknown-event";le.currentTarget=Ae,Qe(Se,ue,void 0,le),le.currentTarget=null}function Aa(le,ue){ue=(ue&4)!==0;for(var Ae=0;Ae<le.length;Ae++){var Se=le[Ae],Fe=Se.event;Se=Se.listeners;e:{var Ye=void 0;if(ue)for(var nt=Se.length-1;0<=nt;nt--){var Ct=Se[nt],bt=Ct.instance,Yt=Ct.currentTarget;if(Ct=Ct.listener,bt!==Ye&&Fe.isPropagationStopped())break e;Fl(Fe,Ct,Yt),Ye=bt}else for(nt=0;nt<Se.length;nt++){if(Ct=Se[nt],bt=Ct.instance,Yt=Ct.currentTarget,Ct=Ct.listener,bt!==Ye&&Fe.isPropagationStopped())break e;Fl(Fe,Ct,Yt),Ye=bt}}}if(br)throw le=kn,br=!1,kn=null,le}function Gr(le,ue){var Ae=ue[zs];Ae===void 0&&(Ae=ue[zs]=new Set);var Se=le+"__bubble";Ae.has(Se)||(Tl(ue,le,2,!1),Ae.add(Se))}function Vl(le,ue,Ae){var Se=0;ue&&(Se|=4),Tl(Ae,le,Se,ue)}var Da="_reactListening"+Math.random().toString(36).slice(2);function ma(le){if(!le[Da]){le[Da]=!0,K.forEach(function(Ae){Ae!=="selectionchange"&&(Wl.has(Ae)||Vl(Ae,!1,le),Vl(Ae,!0,le))});var ue=le.nodeType===9?le:le.ownerDocument;ue===null||ue[Da]||(ue[Da]=!0,Vl("selectionchange",!1,ue))}}function Tl(le,ue,Ae,Se){switch(bs(ue)){case 1:var Fe=_o;break;case 4:Fe=so;break;default:Fe=Fs}Ae=Fe.bind(null,ue,Ae,le),Fe=void 0,!fr||ue!=="touchstart"&&ue!=="touchmove"&&ue!=="wheel"||(Fe=!0),Se?Fe!==void 0?le.addEventListener(ue,Ae,{capture:!0,passive:Fe}):le.addEventListener(ue,Ae,!0):Fe!==void 0?le.addEventListener(ue,Ae,{passive:Fe}):le.addEventListener(ue,Ae,!1)}function Nl(le,ue,Ae,Se,Fe){var Ye=Se;if((ue&1)===0&&(ue&2)===0&&Se!==null)e:for(;;){if(Se===null)return;var nt=Se.tag;if(nt===3||nt===4){var Ct=Se.stateNode.containerInfo;if(Ct===Fe||Ct.nodeType===8&&Ct.parentNode===Fe)break;if(nt===4)for(nt=Se.return;nt!==null;){var bt=nt.tag;if((bt===3||bt===4)&&(bt=nt.stateNode.containerInfo,bt===Fe||bt.nodeType===8&&bt.parentNode===Fe))return;nt=nt.return}for(;Ct!==null;){if(nt=ws(Ct),nt===null)return;if(bt=nt.tag,bt===5||bt===6){Se=Ye=nt;continue e}Ct=Ct.parentNode}}Se=Se.return}dr(function(){var Yt=Ye,cn=ft(Ae),dn=[];e:{var ln=mg.get(le);if(ln!==void 0){var Sn=Ur,Mn=le;switch(le){case"keypress":if(Yo(Ae)===0)break e;case"keydown":case"keyup":Sn=Sl;break;case"focusin":Mn="focus",Sn=yl;break;case"focusout":Mn="blur",Sn=yl;break;case"beforeblur":case"afterblur":Sn=yl;break;case"click":if(Ae.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":Sn=lg;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":Sn=ys;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":Sn=Uo;break;case ka:case Ya:case fg:Sn=qg;break;case Ag:Sn=Ts;break;case"scroll":Sn=Kr;break;case"wheel":Sn=dg;break;case"copy":case"cut":case"paste":Sn=gg;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":Sn=Ui}var Fn=(ue&4)!==0,qr=!Fn&&le==="scroll",Tt=Fn?ln!==null?ln+"Capture":null:ln;Fn=[];for(var Bt=Yt,Lt;Bt!==null;){Lt=Bt;var fn=Lt.stateNode;if(Lt.tag===5&&fn!==null&&(Lt=fn,Tt!==null&&(fn=rr(Bt,Tt),fn!=null&&Fn.push(ba(Bt,fn,Lt)))),qr)break;Bt=Bt.return}0<Fn.length&&(ln=new Sn(ln,Mn,null,Ae,cn),dn.push({event:ln,listeners:Fn}))}}if((ue&7)===0){e:{if(ln=le==="mouseover"||le==="pointerover",Sn=le==="mouseout"||le==="pointerout",ln&&Ae!==wn&&(Mn=Ae.relatedTarget||Ae.fromElement)&&(ws(Mn)||Mn[ji]))break e;if((Sn||ln)&&(ln=cn.window===cn?cn:(ln=cn.ownerDocument)?ln.defaultView||ln.parentWindow:window,Sn?(Mn=Ae.relatedTarget||Ae.toElement,Sn=Yt,Mn=Mn?ws(Mn):null,Mn!==null&&(qr=ke(Mn),Mn!==qr||Mn.tag!==5&&Mn.tag!==6)&&(Mn=null)):(Sn=null,Mn=Yt),Sn!==Mn)){if(Fn=lg,fn="onMouseLeave",Tt="onMouseEnter",Bt="mouse",(le==="pointerout"||le==="pointerover")&&(Fn=Ui,fn="onPointerLeave",Tt="onPointerEnter",Bt="pointer"),qr=Sn==null?ln:zr(Sn),Lt=Mn==null?ln:zr(Mn),ln=new Fn(fn,Bt+"leave",Sn,Ae,cn),ln.target=qr,ln.relatedTarget=Lt,fn=null,ws(cn)===Yt&&(Fn=new Fn(Tt,Bt+"enter",Mn,Ae,cn),Fn.target=Lt,Fn.relatedTarget=qr,fn=Fn),qr=fn,Sn&&Mn)t:{for(Fn=Sn,Tt=Mn,Bt=0,Lt=Fn;Lt;Lt=Ys(Lt))Bt++;for(Lt=0,fn=Tt;fn;fn=Ys(fn))Lt++;for(;0<Bt-Lt;)Fn=Ys(Fn),Bt--;for(;0<Lt-Bt;)Tt=Ys(Tt),Lt--;for(;Bt--;){if(Fn===Tt||Tt!==null&&Fn===Tt.alternate)break t;Fn=Ys(Fn),Tt=Ys(Tt)}Fn=null}else Fn=null;Sn!==null&&gc(dn,ln,Sn,Fn,!1),Mn!==null&&qr!==null&&gc(dn,qr,Mn,Fn,!0)}}e:{if(ln=Yt?zr(Yt):window,Sn=ln.nodeName&&ln.nodeName.toLowerCase(),Sn==="select"||Sn==="input"&&ln.type==="file")var Ln=sc;else if(wl(ln))if(Ca)Ln=Vr;else{Ln=ac;var Un=ha}else(Sn=ln.nodeName)&&Sn.toLowerCase()==="input"&&(ln.type==="checkbox"||ln.type==="radio")&&(Ln=hg);if(Ln&&(Ln=Ln(le,Yt))){Ia(dn,Ln,Ae,cn);break e}Un&&Un(le,ln,Yt),le==="focusout"&&(Un=ln._wrapperState)&&Un.controlled&&ln.type==="number"&&Ht(ln,"number",ln.value)}switch(Un=Yt?zr(Yt):window,le){case"focusin":(wl(Un)||Un.contentEditable==="true")&&(Mo=Un,ks=Yt,Xa=null);break;case"focusout":Xa=ks=Mo=null;break;case"mousedown":ai=!0;break;case"contextmenu":case"mouseup":case"dragend":ai=!1,_l(dn,Ae,cn);break;case"selectionchange":if(El)break;case"keydown":case"keyup":_l(dn,Ae,cn)}var Pn;if(xi)e:{switch(le){case"compositionstart":var Qn="onCompositionStart";break e;case"compositionend":Qn="onCompositionEnd";break e;case"compositionupdate":Qn="onCompositionUpdate";break e}Qn=void 0}else Bs?Cg(le,Ae)&&(Qn="onCompositionEnd"):le==="keydown"&&Ae.keyCode===229&&(Qn="onCompositionStart");Qn&&(ua&&Ae.locale!=="ko"&&(Bs||Qn!=="onCompositionStart"?Qn==="onCompositionEnd"&&Bs&&(Pn=Jr()):(Vi=cn,ko="value"in Vi?Vi.value:Vi.textContent,Bs=!0)),Un=Ll(Yt,Qn),0<Un.length&&(Qn=new cg(Qn,le,null,Ae,cn),dn.push({event:Qn,listeners:Un}),Pn?Qn.data=Pn:(Pn=Rl(Ae),Pn!==null&&(Qn.data=Pn)))),(Pn=Mr?ic(le,Ae):La(le,Ae))&&(Yt=Ll(Yt,"onBeforeInput"),0<Yt.length&&(cn=new cg("onBeforeInput","beforeinput",null,Ae,cn),dn.push({event:cn,listeners:Yt}),cn.data=Pn))}Aa(dn,ue)})}function ba(le,ue,Ae){return{instance:le,listener:ue,currentTarget:Ae}}function Ll(le,ue){for(var Ae=ue+"Capture",Se=[];le!==null;){var Fe=le,Ye=Fe.stateNode;Fe.tag===5&&Ye!==null&&(Fe=Ye,Ye=rr(le,Ae),Ye!=null&&Se.unshift(ba(le,Ye,Fe)),Ye=rr(le,ue),Ye!=null&&Se.push(ba(le,Ye,Fe))),le=le.return}return Se}function Ys(le){if(le===null)return null;do le=le.return;while(le&&le.tag!==5);return le||null}function gc(le,ue,Ae,Se,Fe){for(var Ye=ue._reactName,nt=[];Ae!==null&&Ae!==Se;){var Ct=Ae,bt=Ct.alternate,Yt=Ct.stateNode;if(bt!==null&&bt===Se)break;Ct.tag===5&&Yt!==null&&(Ct=Yt,Fe?(bt=rr(Ae,Ye),bt!=null&&nt.unshift(ba(Ae,bt,Ct))):Fe||(bt=rr(Ae,Ye),bt!=null&&nt.push(ba(Ae,bt,Ct)))),Ae=Ae.return}nt.length!==0&&le.push({event:ue,listeners:nt})}var Kc=/\r\n?/g,cc=/\u0000|\uFFFD/g;function yg(le){return(typeof le=="string"?le:""+le).replace(Kc,`
`).replace(cc,"")}function Ua(le,ue,Ae){if(ue=yg(ue),yg(le)!==ue&&Ae)throw Error(_(425))}function Pa(){}var ya=null,vg=null;function Bg(le,ue){return le==="textarea"||le==="noscript"||typeof ue.children=="string"||typeof ue.children=="number"||typeof ue.dangerouslySetInnerHTML=="object"&&ue.dangerouslySetInnerHTML!==null&&ue.dangerouslySetInnerHTML.__html!=null}var Gg=typeof setTimeout=="function"?setTimeout:void 0,Sg=typeof clearTimeout=="function"?clearTimeout:void 0,Hl=typeof Promise=="function"?Promise:void 0,zc=typeof queueMicrotask=="function"?queueMicrotask:typeof Hl<"u"?function(le){return Hl.resolve(null).then(le).catch(uc)}:Gg;function uc(le){setTimeout(function(){throw le})}function Xl(le,ue){var Ae=ue,Se=0;do{var Fe=Ae.nextSibling;if(le.removeChild(Ae),Fe&&Fe.nodeType===8)if(Ae=Fe.data,Ae==="/$"){if(Se===0){le.removeChild(Fe),As(ue);return}Se--}else Ae!=="$"&&Ae!=="$?"&&Ae!=="$!"||Se++;Ae=Fe}while(Ae);As(ue)}function Jo(le){for(;le!=null;le=le.nextSibling){var ue=le.nodeType;if(ue===1||ue===3)break;if(ue===8){if(ue=le.data,ue==="$"||ue==="$!"||ue==="$?")break;if(ue==="/$")return null}}return le}function Rg(le){le=le.previousSibling;for(var ue=0;le;){if(le.nodeType===8){var Ae=le.data;if(Ae==="$"||Ae==="$!"||Ae==="$?"){if(ue===0)return le;ue--}else Ae==="/$"&&ue++}le=le.previousSibling}return null}var Ks=Math.random().toString(36).slice(2),$r="__reactFiber$"+Ks,va="__reactProps$"+Ks,ji="__reactContainer$"+Ks,zs="__reactEvents$"+Ks,kl="__reactListeners$"+Ks,Yl="__reactHandles$"+Ks;function ws(le){var ue=le[$r];if(ue)return ue;for(var Ae=le.parentNode;Ae;){if(ue=Ae[ji]||Ae[$r]){if(Ae=ue.alternate,ue.child!==null||Ae!==null&&Ae.child!==null)for(le=Rg(le);le!==null;){if(Ae=le[$r])return Ae;le=Rg(le)}return ue}le=Ae,Ae=le.parentNode}return null}function Qo(le){return le=le[$r]||le[ji],!le||le.tag!==5&&le.tag!==6&&le.tag!==13&&le.tag!==3?null:le}function zr(le){if(le.tag===5||le.tag===6)return le.stateNode;throw Error(_(33))}function Kl(le){return le[va]||null}var wg=[],li=-1;function Xr(le){return{current:le}}function Sr(le){0>li||(le.current=wg[li],wg[li]=null,li--)}function Br(le,ue){li++,wg[li]=le.current,le.current=ue}var $o={},Ii=Xr($o),Zi=Xr(!1),qo=$o;function Ds(le,ue){var Ae=le.type.contextTypes;if(!Ae)return $o;var Se=le.stateNode;if(Se&&Se.__reactInternalMemoizedUnmaskedChildContext===ue)return Se.__reactInternalMemoizedMaskedChildContext;var Fe={},Ye;for(Ye in Ae)Fe[Ye]=ue[Ye];return Se&&(le=le.stateNode,le.__reactInternalMemoizedUnmaskedChildContext=ue,le.__reactInternalMemoizedMaskedChildContext=Fe),Fe}function vi(le){return le=le.childContextTypes,le!=null}function Oa(){Sr(Zi),Sr(Ii)}function xg(le,ue,Ae){if(Ii.current!==$o)throw Error(_(168));Br(Ii,ue),Br(Zi,Ae)}function ja(le,ue,Ae){var Se=le.stateNode;if(ue=ue.childContextTypes,typeof Se.getChildContext!="function")return Ae;Se=Se.getChildContext();for(var Fe in Se)if(!(Fe in ue))throw Error(_(108,ht(le)||"Unknown",Fe));return je({},Ae,Se)}function Us(le){return le=(le=le.stateNode)&&le.__reactInternalMemoizedMergedChildContext||$o,qo=Ii.current,Br(Ii,le),Br(Zi,Zi.current),!0}function Zg(le,ue,Ae){var Se=le.stateNode;if(!Se)throw Error(_(169));Ae?(le=ja(le,ue,qo),Se.__reactInternalMemoizedMergedChildContext=le,Sr(Zi),Sr(Ii),Br(Ii,le)):Sr(Zi),Br(Zi,Ae)}var vo=null,Ja=!1,zl=!1;function Qa(le){vo===null?vo=[le]:vo.push(le)}function dc(le){Ja=!0,Qa(le)}function Fo(){if(!zl&&vo!==null){zl=!0;var le=0,ue=or;try{var Ae=vo;for(or=1;le<Ae.length;le++){var Se=Ae[le];do Se=Se(!0);while(Se!==null)}vo=null,Ja=!1}catch(Fe){throw vo!==null&&(vo=vo.slice(le+1)),Xt(Cn,Fo),Fe}finally{or=ue,zl=!1}}return null}var Ps=[],Li=0,Dl=null,Ul=0,Ei=[],gi=0,Os=null,mn=1,co="";function ns(le,ue){Ps[Li++]=Ul,Ps[Li++]=Dl,Dl=le,Ul=ue}function Eg(le,ue,Ae){Ei[gi++]=mn,Ei[gi++]=co,Ei[gi++]=Os,Os=le;var Se=mn;le=co;var Fe=32-Nn(Se)-1;Se&=~(1<<Fe),Ae+=1;var Ye=32-Nn(ue)+Fe;if(30<Ye){var nt=Fe-Fe%5;Ye=(Se&(1<<nt)-1).toString(32),Se>>=nt,Fe-=nt,mn=1<<32-Nn(ue)+Fe|Ae<<Fe|Se,co=Ye+le}else mn=1<<Ye|Ae<<Fe|Se,co=le}function _g(le){le.return!==null&&(ns(le,1),Eg(le,1,0))}function rs(le){for(;le===Dl;)Dl=Ps[--Li],Ps[Li]=null,Ul=Ps[--Li],Ps[Li]=null;for(;le===Os;)Os=Ei[--gi],Ei[gi]=null,co=Ei[--gi],Ei[gi]=null,mn=Ei[--gi],Ei[gi]=null}var pi=null,_i=null,xr=!1,uo=null;function Mg(le,ue){var Ae=Ho(5,null,null,0);Ae.elementType="DELETED",Ae.stateNode=ue,Ae.return=le,ue=le.deletions,ue===null?(le.deletions=[Ae],le.flags|=16):ue.push(Ae)}function Wg(le,ue){switch(le.tag){case 5:var Ae=le.type;return ue=ue.nodeType!==1||Ae.toLowerCase()!==ue.nodeName.toLowerCase()?null:ue,ue!==null?(le.stateNode=ue,pi=le,_i=Jo(ue.firstChild),!0):!1;case 6:return ue=le.pendingProps===""||ue.nodeType!==3?null:ue,ue!==null?(le.stateNode=ue,pi=le,_i=null,!0):!1;case 13:return ue=ue.nodeType!==8?null:ue,ue!==null?(Ae=Os!==null?{id:mn,overflow:co}:null,le.memoizedState={dehydrated:ue,treeContext:Ae,retryLane:1073741824},Ae=Ho(18,null,null,0),Ae.stateNode=ue,Ae.return=le,le.child=Ae,pi=le,_i=null,!0):!1;default:return!1}}function Pl(le){return(le.mode&1)!==0&&(le.flags&128)===0}function Ol(le){if(xr){var ue=_i;if(ue){var Ae=ue;if(!Wg(le,ue)){if(Pl(le))throw Error(_(418));ue=Jo(Ae.nextSibling);var Se=pi;ue&&Wg(le,ue)?Mg(Se,Ae):(le.flags=le.flags&-4097|2,xr=!1,pi=le)}}else{if(Pl(le))throw Error(_(418));le.flags=le.flags&-4097|2,xr=!1,pi=le}}}function jl(le){for(le=le.return;le!==null&&le.tag!==5&&le.tag!==3&&le.tag!==13;)le=le.return;pi=le}function Ba(le){if(le!==pi)return!1;if(!xr)return jl(le),xr=!0,!1;var ue;if((ue=le.tag!==3)&&!(ue=le.tag!==5)&&(ue=le.type,ue=ue!=="head"&&ue!=="body"&&!Bg(le.type,le.memoizedProps)),ue&&(ue=_i)){if(Pl(le))throw Fg(),Error(_(418));for(;ue;)Mg(le,ue),ue=Jo(ue.nextSibling)}if(jl(le),le.tag===13){if(le=le.memoizedState,le=le!==null?le.dehydrated:null,!le)throw Error(_(317));e:{for(le=le.nextSibling,ue=0;le;){if(le.nodeType===8){var Ae=le.data;if(Ae==="/$"){if(ue===0){_i=Jo(le.nextSibling);break e}ue--}else Ae!=="$"&&Ae!=="$!"&&Ae!=="$?"||ue++}le=le.nextSibling}_i=null}}else _i=pi?Jo(le.stateNode.nextSibling):null;return!0}function Fg(){for(var le=_i;le;)le=Jo(le.nextSibling)}function xs(){_i=pi=null,xr=!1}function Ga(le){uo===null?uo=[le]:uo.push(le)}var Dc=Re.ReactCurrentBatchConfig;function $a(le,ue,Ae){if(le=Ae.ref,le!==null&&typeof le!="function"&&typeof le!="object"){if(Ae._owner){if(Ae=Ae._owner,Ae){if(Ae.tag!==1)throw Error(_(309));var Se=Ae.stateNode}if(!Se)throw Error(_(147,le));var Fe=Se,Ye=""+le;return ue!==null&&ue.ref!==null&&typeof ue.ref=="function"&&ue.ref._stringRef===Ye?ue.ref:(ue=function(nt){var Ct=Fe.refs;nt===null?delete Ct[Ye]:Ct[Ye]=nt},ue._stringRef=Ye,ue)}if(typeof le!="string")throw Error(_(284));if(!Ae._owner)throw Error(_(290,le))}return le}function qa(le,ue){throw le=Object.prototype.toString.call(ue),Error(_(31,le==="[object Object]"?"object with keys {"+Object.keys(ue).join(", ")+"}":le))}function Vg(le){var ue=le._init;return ue(le._payload)}function Tg(le){function ue(Tt,Bt){if(le){var Lt=Tt.deletions;Lt===null?(Tt.deletions=[Bt],Tt.flags|=16):Lt.push(Bt)}}function Ae(Tt,Bt){if(!le)return null;for(;Bt!==null;)ue(Tt,Bt),Bt=Bt.sibling;return null}function Se(Tt,Bt){for(Tt=new Map;Bt!==null;)Bt.key!==null?Tt.set(Bt.key,Bt):Tt.set(Bt.index,Bt),Bt=Bt.sibling;return Tt}function Fe(Tt,Bt){return Tt=Ta(Tt,Bt),Tt.index=0,Tt.sibling=null,Tt}function Ye(Tt,Bt,Lt){return Tt.index=Lt,le?(Lt=Tt.alternate,Lt!==null?(Lt=Lt.index,Lt<Bt?(Tt.flags|=2,Bt):Lt):(Tt.flags|=2,Bt)):(Tt.flags|=1048576,Bt)}function nt(Tt){return le&&Tt.alternate===null&&(Tt.flags|=2),Tt}function Ct(Tt,Bt,Lt,fn){return Bt===null||Bt.tag!==6?(Bt=cu(Lt,Tt.mode,fn),Bt.return=Tt,Bt):(Bt=Fe(Bt,Lt),Bt.return=Tt,Bt)}function bt(Tt,Bt,Lt,fn){var Ln=Lt.type;return Ln===Ze?cn(Tt,Bt,Lt.props.children,fn,Lt.key):Bt!==null&&(Bt.elementType===Ln||typeof Ln=="object"&&Ln!==null&&Ln.$$typeof===rt&&Vg(Ln)===Bt.type)?(fn=Fe(Bt,Lt.props),fn.ref=$a(Tt,Bt,Lt),fn.return=Tt,fn):(fn=Vc(Lt.type,Lt.key,Lt.props,null,Tt.mode,fn),fn.ref=$a(Tt,Bt,Lt),fn.return=Tt,fn)}function Yt(Tt,Bt,Lt,fn){return Bt===null||Bt.tag!==4||Bt.stateNode.containerInfo!==Lt.containerInfo||Bt.stateNode.implementation!==Lt.implementation?(Bt=uu(Lt,Tt.mode,fn),Bt.return=Tt,Bt):(Bt=Fe(Bt,Lt.children||[]),Bt.return=Tt,Bt)}function cn(Tt,Bt,Lt,fn,Ln){return Bt===null||Bt.tag!==7?(Bt=hl(Lt,Tt.mode,fn,Ln),Bt.return=Tt,Bt):(Bt=Fe(Bt,Lt),Bt.return=Tt,Bt)}function dn(Tt,Bt,Lt){if(typeof Bt=="string"&&Bt!==""||typeof Bt=="number")return Bt=cu(""+Bt,Tt.mode,Lt),Bt.return=Tt,Bt;if(typeof Bt=="object"&&Bt!==null){switch(Bt.$$typeof){case Ee:return Lt=Vc(Bt.type,Bt.key,Bt.props,null,Tt.mode,Lt),Lt.ref=$a(Tt,null,Bt),Lt.return=Tt,Lt;case We:return Bt=uu(Bt,Tt.mode,Lt),Bt.return=Tt,Bt;case rt:var fn=Bt._init;return dn(Tt,fn(Bt._payload),Lt)}if(Pt(Bt)||$e(Bt))return Bt=hl(Bt,Tt.mode,Lt,null),Bt.return=Tt,Bt;qa(Tt,Bt)}return null}function ln(Tt,Bt,Lt,fn){var Ln=Bt!==null?Bt.key:null;if(typeof Lt=="string"&&Lt!==""||typeof Lt=="number")return Ln!==null?null:Ct(Tt,Bt,""+Lt,fn);if(typeof Lt=="object"&&Lt!==null){switch(Lt.$$typeof){case Ee:return Lt.key===Ln?bt(Tt,Bt,Lt,fn):null;case We:return Lt.key===Ln?Yt(Tt,Bt,Lt,fn):null;case rt:return Ln=Lt._init,ln(Tt,Bt,Ln(Lt._payload),fn)}if(Pt(Lt)||$e(Lt))return Ln!==null?null:cn(Tt,Bt,Lt,fn,null);qa(Tt,Lt)}return null}function Sn(Tt,Bt,Lt,fn,Ln){if(typeof fn=="string"&&fn!==""||typeof fn=="number")return Tt=Tt.get(Lt)||null,Ct(Bt,Tt,""+fn,Ln);if(typeof fn=="object"&&fn!==null){switch(fn.$$typeof){case Ee:return Tt=Tt.get(fn.key===null?Lt:fn.key)||null,bt(Bt,Tt,fn,Ln);case We:return Tt=Tt.get(fn.key===null?Lt:fn.key)||null,Yt(Bt,Tt,fn,Ln);case rt:var Un=fn._init;return Sn(Tt,Bt,Lt,Un(fn._payload),Ln)}if(Pt(fn)||$e(fn))return Tt=Tt.get(Lt)||null,cn(Bt,Tt,fn,Ln,null);qa(Bt,fn)}return null}function Mn(Tt,Bt,Lt,fn){for(var Ln=null,Un=null,Pn=Bt,Qn=Bt=0,Ri=null;Pn!==null&&Qn<Lt.length;Qn++){Pn.index>Qn?(Ri=Pn,Pn=null):Ri=Pn.sibling;var hr=ln(Tt,Pn,Lt[Qn],fn);if(hr===null){Pn===null&&(Pn=Ri);break}le&&Pn&&hr.alternate===null&&ue(Tt,Pn),Bt=Ye(hr,Bt,Qn),Un===null?Ln=hr:Un.sibling=hr,Un=hr,Pn=Ri}if(Qn===Lt.length)return Ae(Tt,Pn),xr&&ns(Tt,Qn),Ln;if(Pn===null){for(;Qn<Lt.length;Qn++)Pn=dn(Tt,Lt[Qn],fn),Pn!==null&&(Bt=Ye(Pn,Bt,Qn),Un===null?Ln=Pn:Un.sibling=Pn,Un=Pn);return xr&&ns(Tt,Qn),Ln}for(Pn=Se(Tt,Pn);Qn<Lt.length;Qn++)Ri=Sn(Pn,Tt,Qn,Lt[Qn],fn),Ri!==null&&(le&&Ri.alternate!==null&&Pn.delete(Ri.key===null?Qn:Ri.key),Bt=Ye(Ri,Bt,Qn),Un===null?Ln=Ri:Un.sibling=Ri,Un=Ri);return le&&Pn.forEach(function(Na){return ue(Tt,Na)}),xr&&ns(Tt,Qn),Ln}function Fn(Tt,Bt,Lt,fn){var Ln=$e(Lt);if(typeof Ln!="function")throw Error(_(150));if(Lt=Ln.call(Lt),Lt==null)throw Error(_(151));for(var Un=Ln=null,Pn=Bt,Qn=Bt=0,Ri=null,hr=Lt.next();Pn!==null&&!hr.done;Qn++,hr=Lt.next()){Pn.index>Qn?(Ri=Pn,Pn=null):Ri=Pn.sibling;var Na=ln(Tt,Pn,hr.value,fn);if(Na===null){Pn===null&&(Pn=Ri);break}le&&Pn&&Na.alternate===null&&ue(Tt,Pn),Bt=Ye(Na,Bt,Qn),Un===null?Ln=Na:Un.sibling=Na,Un=Na,Pn=Ri}if(hr.done)return Ae(Tt,Pn),xr&&ns(Tt,Qn),Ln;if(Pn===null){for(;!hr.done;Qn++,hr=Lt.next())hr=dn(Tt,hr.value,fn),hr!==null&&(Bt=Ye(hr,Bt,Qn),Un===null?Ln=hr:Un.sibling=hr,Un=hr);return xr&&ns(Tt,Qn),Ln}for(Pn=Se(Tt,Pn);!hr.done;Qn++,hr=Lt.next())hr=Sn(Pn,Tt,Qn,hr.value,fn),hr!==null&&(le&&hr.alternate!==null&&Pn.delete(hr.key===null?Qn:hr.key),Bt=Ye(hr,Bt,Qn),Un===null?Ln=hr:Un.sibling=hr,Un=hr);return le&&Pn.forEach(function(md){return ue(Tt,md)}),xr&&ns(Tt,Qn),Ln}function qr(Tt,Bt,Lt,fn){if(typeof Lt=="object"&&Lt!==null&&Lt.type===Ze&&Lt.key===null&&(Lt=Lt.props.children),typeof Lt=="object"&&Lt!==null){switch(Lt.$$typeof){case Ee:e:{for(var Ln=Lt.key,Un=Bt;Un!==null;){if(Un.key===Ln){if(Ln=Lt.type,Ln===Ze){if(Un.tag===7){Ae(Tt,Un.sibling),Bt=Fe(Un,Lt.props.children),Bt.return=Tt,Tt=Bt;break e}}else if(Un.elementType===Ln||typeof Ln=="object"&&Ln!==null&&Ln.$$typeof===rt&&Vg(Ln)===Un.type){Ae(Tt,Un.sibling),Bt=Fe(Un,Lt.props),Bt.ref=$a(Tt,Un,Lt),Bt.return=Tt,Tt=Bt;break e}Ae(Tt,Un);break}else ue(Tt,Un);Un=Un.sibling}Lt.type===Ze?(Bt=hl(Lt.props.children,Tt.mode,fn,Lt.key),Bt.return=Tt,Tt=Bt):(fn=Vc(Lt.type,Lt.key,Lt.props,null,Tt.mode,fn),fn.ref=$a(Tt,Bt,Lt),fn.return=Tt,Tt=fn)}return nt(Tt);case We:e:{for(Un=Lt.key;Bt!==null;){if(Bt.key===Un)if(Bt.tag===4&&Bt.stateNode.containerInfo===Lt.containerInfo&&Bt.stateNode.implementation===Lt.implementation){Ae(Tt,Bt.sibling),Bt=Fe(Bt,Lt.children||[]),Bt.return=Tt,Tt=Bt;break e}else{Ae(Tt,Bt);break}else ue(Tt,Bt);Bt=Bt.sibling}Bt=uu(Lt,Tt.mode,fn),Bt.return=Tt,Tt=Bt}return nt(Tt);case rt:return Un=Lt._init,qr(Tt,Bt,Un(Lt._payload),fn)}if(Pt(Lt))return Mn(Tt,Bt,Lt,fn);if($e(Lt))return Fn(Tt,Bt,Lt,fn);qa(Tt,Lt)}return typeof Lt=="string"&&Lt!==""||typeof Lt=="number"?(Lt=""+Lt,Bt!==null&&Bt.tag===6?(Ae(Tt,Bt.sibling),Bt=Fe(Bt,Lt),Bt.return=Tt,Tt=Bt):(Ae(Tt,Bt),Bt=cu(Lt,Tt.mode,fn),Bt.return=Tt,Tt=Bt),nt(Tt)):Ae(Tt,Bt)}return qr}var js=Tg(!0),el=Tg(!1),Js=Xr(null),Qs=null,os=null,Sa=null;function $s(){Sa=os=Qs=null}function tl(le){var ue=Js.current;Sr(Js),le._currentValue=ue}function nl(le,ue,Ae){for(;le!==null;){var Se=le.alternate;if((le.childLanes&ue)!==ue?(le.childLanes|=ue,Se!==null&&(Se.childLanes|=ue)):Se!==null&&(Se.childLanes&ue)!==ue&&(Se.childLanes|=ue),le===Ae)break;le=le.return}}function Zs(le,ue){Qs=le,Sa=os=null,le=le.dependencies,le!==null&&le.firstContext!==null&&((le.lanes&ue)!==0&&(ir=!0),le.firstContext=null)}function Ji(le){var ue=le._currentValue;if(Sa!==le)if(le={context:le,memoizedValue:ue,next:null},os===null){if(Qs===null)throw Error(_(308));os=le,Qs.dependencies={lanes:0,firstContext:le}}else os=os.next=le;return ue}var ss=null;function Ng(le){ss===null?ss=[le]:ss.push(le)}function rl(le,ue,Ae,Se){var Fe=ue.interleaved;return Fe===null?(Ae.next=Ae,Ng(ue)):(Ae.next=Fe.next,Fe.next=Ae),ue.interleaved=Ae,Bo(le,Se)}function Bo(le,ue){le.lanes|=ue;var Ae=le.alternate;for(Ae!==null&&(Ae.lanes|=ue),Ae=le,le=le.return;le!==null;)le.childLanes|=ue,Ae=le.alternate,Ae!==null&&(Ae.childLanes|=ue),Ae=le,le=le.return;return Ae.tag===3?Ae.stateNode:null}var Ar=!1;function nr(le){le.updateQueue={baseState:le.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Dr(le,ue){le=le.updateQueue,ue.updateQueue===le&&(ue.updateQueue={baseState:le.baseState,firstBaseUpdate:le.firstBaseUpdate,lastBaseUpdate:le.lastBaseUpdate,shared:le.shared,effects:le.effects})}function mr(le,ue){return{eventTime:le,lane:ue,tag:0,payload:null,callback:null,next:null}}function Wr(le,ue,Ae){var Se=le.updateQueue;if(Se===null)return null;if(Se=Se.shared,(Cr&2)!==0){var Fe=Se.pending;return Fe===null?ue.next=ue:(ue.next=Fe.next,Fe.next=ue),Se.pending=ue,Bo(le,Ae)}return Fe=Se.interleaved,Fe===null?(ue.next=ue,Ng(Se)):(ue.next=Fe.next,Fe.next=ue),Se.interleaved=ue,Bo(le,Ae)}function Bi(le,ue,Ae){if(ue=ue.updateQueue,ue!==null&&(ue=ue.shared,(Ae&4194240)!==0)){var Se=ue.lanes;Se&=le.pendingLanes,Ae|=Se,ue.lanes=Ae,ho(le,Ae)}}function qs(le,ue){var Ae=le.updateQueue,Se=le.alternate;if(Se!==null&&(Se=Se.updateQueue,Ae===Se)){var Fe=null,Ye=null;if(Ae=Ae.firstBaseUpdate,Ae!==null){do{var nt={eventTime:Ae.eventTime,lane:Ae.lane,tag:Ae.tag,payload:Ae.payload,callback:Ae.callback,next:null};Ye===null?Fe=Ye=nt:Ye=Ye.next=nt,Ae=Ae.next}while(Ae!==null);Ye===null?Fe=Ye=ue:Ye=Ye.next=ue}else Fe=Ye=ue;Ae={baseState:Se.baseState,firstBaseUpdate:Fe,lastBaseUpdate:Ye,shared:Se.shared,effects:Se.effects},le.updateQueue=Ae;return}le=Ae.lastBaseUpdate,le===null?Ae.firstBaseUpdate=ue:le.next=ue,Ae.lastBaseUpdate=ue}function kr(le,ue,Ae,Se){var Fe=le.updateQueue;Ar=!1;var Ye=Fe.firstBaseUpdate,nt=Fe.lastBaseUpdate,Ct=Fe.shared.pending;if(Ct!==null){Fe.shared.pending=null;var bt=Ct,Yt=bt.next;bt.next=null,nt===null?Ye=Yt:nt.next=Yt,nt=bt;var cn=le.alternate;cn!==null&&(cn=cn.updateQueue,Ct=cn.lastBaseUpdate,Ct!==nt&&(Ct===null?cn.firstBaseUpdate=Yt:Ct.next=Yt,cn.lastBaseUpdate=bt))}if(Ye!==null){var dn=Fe.baseState;nt=0,cn=Yt=bt=null,Ct=Ye;do{var ln=Ct.lane,Sn=Ct.eventTime;if((Se&ln)===ln){cn!==null&&(cn=cn.next={eventTime:Sn,lane:0,tag:Ct.tag,payload:Ct.payload,callback:Ct.callback,next:null});e:{var Mn=le,Fn=Ct;switch(ln=ue,Sn=Ae,Fn.tag){case 1:if(Mn=Fn.payload,typeof Mn=="function"){dn=Mn.call(Sn,dn,ln);break e}dn=Mn;break e;case 3:Mn.flags=Mn.flags&-65537|128;case 0:if(Mn=Fn.payload,ln=typeof Mn=="function"?Mn.call(Sn,dn,ln):Mn,ln==null)break e;dn=je({},dn,ln);break e;case 2:Ar=!0}}Ct.callback!==null&&Ct.lane!==0&&(le.flags|=64,ln=Fe.effects,ln===null?Fe.effects=[Ct]:ln.push(Ct))}else Sn={eventTime:Sn,lane:ln,tag:Ct.tag,payload:Ct.payload,callback:Ct.callback,next:null},cn===null?(Yt=cn=Sn,bt=dn):cn=cn.next=Sn,nt|=ln;if(Ct=Ct.next,Ct===null){if(Ct=Fe.shared.pending,Ct===null)break;ln=Ct,Ct=ln.next,ln.next=null,Fe.lastBaseUpdate=ln,Fe.shared.pending=null}}while(!0);if(cn===null&&(bt=dn),Fe.baseState=bt,Fe.firstBaseUpdate=Yt,Fe.lastBaseUpdate=cn,ue=Fe.shared.interleaved,ue!==null){Fe=ue;do nt|=Fe.lane,Fe=Fe.next;while(Fe!==ue)}else Ye===null&&(Fe.shared.lanes=0);dl|=nt,le.lanes=nt,le.memoizedState=dn}}function Ra(le,ue,Ae){if(le=ue.effects,ue.effects=null,le!==null)for(ue=0;ue<le.length;ue++){var Se=le[ue],Fe=Se.callback;if(Fe!==null){if(Se.callback=null,Se=Ae,typeof Fe!="function")throw Error(_(191,Fe));Fe.call(Se)}}}var Vo={},Qi=Xr(Vo),ea=Xr(Vo),as=Xr(Vo);function Pr(le){if(le===Vo)throw Error(_(174));return le}function il(le,ue){switch(Br(as,ue),Br(ea,le),Br(Qi,Vo),le=ue.nodeType,le){case 9:case 11:ue=(ue=ue.documentElement)?ue.namespaceURI:_t(null,"");break;default:le=le===8?ue.parentNode:ue,ue=le.namespaceURI||null,le=le.tagName,ue=_t(ue,le)}Sr(Qi),Br(Qi,ue)}function Es(){Sr(Qi),Sr(ea),Sr(as)}function ta(le){Pr(as.current);var ue=Pr(Qi.current),Ae=_t(ue,le.type);ue!==Ae&&(Br(ea,le),Br(Qi,Ae))}function wa(le){ea.current===le&&(Sr(Qi),Sr(ea))}var Zr=Xr(0);function Go(le){for(var ue=le;ue!==null;){if(ue.tag===13){var Ae=ue.memoizedState;if(Ae!==null&&(Ae=Ae.dehydrated,Ae===null||Ae.data==="$?"||Ae.data==="$!"))return ue}else if(ue.tag===19&&ue.memoizedProps.revealOrder!==void 0){if((ue.flags&128)!==0)return ue}else if(ue.child!==null){ue.child.return=ue,ue=ue.child;continue}if(ue===le)break;for(;ue.sibling===null;){if(ue.return===null||ue.return===le)return null;ue=ue.return}ue.sibling.return=ue.return,ue=ue.sibling}return null}var xa=[];function To(){for(var le=0;le<xa.length;le++)xa[le]._workInProgressVersionPrimary=null;xa.length=0}var na=Re.ReactCurrentDispatcher,ra=Re.ReactCurrentBatchConfig,ls=0,Rr=null,Yr=null,pr=null,So=!1,Gi=!1,_s=0,Hi=0;function Ci(){throw Error(_(321))}function ol(le,ue){if(ue===null)return!1;for(var Ae=0;Ae<ue.length&&Ae<le.length;Ae++)if(!Pi(le[Ae],ue[Ae]))return!1;return!0}function sl(le,ue,Ae,Se,Fe,Ye){if(ls=Ye,Rr=ue,ue.memoizedState=null,ue.updateQueue=null,ue.lanes=0,na.current=le===null||le.memoizedState===null?mc:bc,le=Ae(Se,Fe),Gi){Ye=0;do{if(Gi=!1,_s=0,25<=Ye)throw Error(_(301));Ye+=1,pr=Yr=null,ue.updateQueue=null,na.current=yc,le=Ae(Se,Fe)}while(Gi)}if(na.current=ng,ue=Yr!==null&&Yr.next!==null,ls=0,pr=Yr=Rr=null,So=!1,ue)throw Error(_(300));return le}function Lg(){var le=_s!==0;return _s=0,le}function hi(){var le={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return pr===null?Rr.memoizedState=pr=le:pr=pr.next=le,pr}function $i(){if(Yr===null){var le=Rr.alternate;le=le!==null?le.memoizedState:null}else le=Yr.next;var ue=pr===null?Rr.memoizedState:pr.next;if(ue!==null)pr=ue,Yr=le;else{if(le===null)throw Error(_(310));Yr=le,le={memoizedState:Yr.memoizedState,baseState:Yr.baseState,baseQueue:Yr.baseQueue,queue:Yr.queue,next:null},pr===null?Rr.memoizedState=pr=le:pr=pr.next=le}return pr}function Za(le,ue){return typeof ue=="function"?ue(le):ue}function al(le){var ue=$i(),Ae=ue.queue;if(Ae===null)throw Error(_(311));Ae.lastRenderedReducer=le;var Se=Yr,Fe=Se.baseQueue,Ye=Ae.pending;if(Ye!==null){if(Fe!==null){var nt=Fe.next;Fe.next=Ye.next,Ye.next=nt}Se.baseQueue=Fe=Ye,Ae.pending=null}if(Fe!==null){Ye=Fe.next,Se=Se.baseState;var Ct=nt=null,bt=null,Yt=Ye;do{var cn=Yt.lane;if((ls&cn)===cn)bt!==null&&(bt=bt.next={lane:0,action:Yt.action,hasEagerState:Yt.hasEagerState,eagerState:Yt.eagerState,next:null}),Se=Yt.hasEagerState?Yt.eagerState:le(Se,Yt.action);else{var dn={lane:cn,action:Yt.action,hasEagerState:Yt.hasEagerState,eagerState:Yt.eagerState,next:null};bt===null?(Ct=bt=dn,nt=Se):bt=bt.next=dn,Rr.lanes|=cn,dl|=cn}Yt=Yt.next}while(Yt!==null&&Yt!==Ye);bt===null?nt=Se:bt.next=Ct,Pi(Se,ue.memoizedState)||(ir=!0),ue.memoizedState=Se,ue.baseState=nt,ue.baseQueue=bt,Ae.lastRenderedState=Se}if(le=Ae.interleaved,le!==null){Fe=le;do Ye=Fe.lane,Rr.lanes|=Ye,dl|=Ye,Fe=Fe.next;while(Fe!==le)}else Fe===null&&(Ae.lanes=0);return[ue.memoizedState,Ae.dispatch]}function gs(le){var ue=$i(),Ae=ue.queue;if(Ae===null)throw Error(_(311));Ae.lastRenderedReducer=le;var Se=Ae.dispatch,Fe=Ae.pending,Ye=ue.memoizedState;if(Fe!==null){Ae.pending=null;var nt=Fe=Fe.next;do Ye=le(Ye,nt.action),nt=nt.next;while(nt!==Fe);Pi(Ye,ue.memoizedState)||(ir=!0),ue.memoizedState=Ye,ue.baseQueue===null&&(ue.baseState=Ye),Ae.lastRenderedState=Ye}return[Ye,Se]}function Hg(){}function Xg(le,ue){var Ae=Rr,Se=$i(),Fe=ue(),Ye=!Pi(Se.memoizedState,Fe);if(Ye&&(Se.memoizedState=Fe,ir=!0),Se=Se.queue,Kg(Ic.bind(null,Ae,Se,le),[le]),Se.getSnapshot!==ue||Ye||pr!==null&&pr.memoizedState.tag&1){if(Ae.flags|=2048,Ro(9,ll.bind(null,Ae,Se,Fe,ue),void 0,null),Si===null)throw Error(_(349));(ls&30)!==0||Jl(Ae,ue,Fe)}return Fe}function Jl(le,ue,Ae){le.flags|=16384,le={getSnapshot:ue,value:Ae},ue=Rr.updateQueue,ue===null?(ue={lastEffect:null,stores:null},Rr.updateQueue=ue,ue.stores=[le]):(Ae=ue.stores,Ae===null?ue.stores=[le]:Ae.push(le))}function ll(le,ue,Ae,Se){ue.value=Ae,ue.getSnapshot=Se,pc(ue)&&kg(le)}function Ic(le,ue,Ae){return Ae(function(){pc(ue)&&kg(le)})}function pc(le){var ue=le.getSnapshot;le=le.value;try{var Ae=ue();return!Pi(le,Ae)}catch{return!0}}function kg(le){var ue=Bo(le,1);ue!==null&&ps(ue,le,1,-1)}function Yg(le){var ue=hi();return typeof le=="function"&&(le=le()),ue.memoizedState=ue.baseState=le,le={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Za,lastRenderedState:le},ue.queue=le,le=le.dispatch=ia.bind(null,Rr,le),[ue.memoizedState,le]}function Ro(le,ue,Ae,Se){return le={tag:le,create:ue,destroy:Ae,deps:Se,next:null},ue=Rr.updateQueue,ue===null?(ue={lastEffect:null,stores:null},Rr.updateQueue=ue,ue.lastEffect=le.next=le):(Ae=ue.lastEffect,Ae===null?ue.lastEffect=le.next=le:(Se=Ae.next,Ae.next=le,le.next=Se,ue.lastEffect=le)),le}function Cc(){return $i().memoizedState}function No(le,ue,Ae,Se){var Fe=hi();Rr.flags|=le,Fe.memoizedState=Ro(1|ue,Ae,void 0,Se===void 0?null:Se)}function gl(le,ue,Ae,Se){var Fe=$i();Se=Se===void 0?null:Se;var Ye=void 0;if(Yr!==null){var nt=Yr.memoizedState;if(Ye=nt.destroy,Se!==null&&ol(Se,nt.deps)){Fe.memoizedState=Ro(ue,Ae,Ye,Se);return}}Rr.flags|=le,Fe.memoizedState=Ro(1|ue,Ae,Ye,Se)}function Mi(le,ue){return No(8390656,8,le,ue)}function Kg(le,ue){return gl(2048,8,le,ue)}function zg(le,ue){return gl(4,2,le,ue)}function hc(le,ue){return gl(4,4,le,ue)}function fc(le,ue){if(typeof ue=="function")return le=le(),ue(le),function(){ue(null)};if(ue!=null)return le=le(),ue.current=le,function(){ue.current=null}}function Dg(le,ue,Ae){return Ae=Ae!=null?Ae.concat([le]):null,gl(4,4,fc.bind(null,ue,le),Ae)}function Ql(){}function Ac(le,ue){var Ae=$i();ue=ue===void 0?null:ue;var Se=Ae.memoizedState;return Se!==null&&ue!==null&&ol(ue,Se[1])?Se[0]:(Ae.memoizedState=[le,ue],le)}function qi(le,ue){var Ae=$i();ue=ue===void 0?null:ue;var Se=Ae.memoizedState;return Se!==null&&ue!==null&&ol(ue,Se[1])?Se[0]:(le=le(),Ae.memoizedState=[le,ue],le)}function $l(le,ue,Ae){return(ls&21)===0?(le.baseState&&(le.baseState=!1,ir=!0),le.memoizedState=Ae):(Pi(Ae,ue)||(Ae=vr(),Rr.lanes|=Ae,dl|=Ae,le.baseState=!0),ue)}function Uc(le,ue){var Ae=or;or=Ae!==0&&4>Ae?Ae:4,le(!0);var Se=ra.transition;ra.transition={};try{le(!1),ue()}finally{or=Ae,ra.transition=Se}}function cs(){return $i().memoizedState}function ql(le,ue,Ae){var Se=Fa(le);if(Ae={lane:Se,action:Ae,hasEagerState:!1,eagerState:null,next:null},cl(le))eg(ue,Ae);else if(Ae=rl(le,ue,Ae,Se),Ae!==null){var Fe=no();ps(Ae,le,Se,Fe),tg(Ae,ue,Se)}}function ia(le,ue,Ae){var Se=Fa(le),Fe={lane:Se,action:Ae,hasEagerState:!1,eagerState:null,next:null};if(cl(le))eg(ue,Fe);else{var Ye=le.alternate;if(le.lanes===0&&(Ye===null||Ye.lanes===0)&&(Ye=ue.lastRenderedReducer,Ye!==null))try{var nt=ue.lastRenderedState,Ct=Ye(nt,Ae);if(Fe.hasEagerState=!0,Fe.eagerState=Ct,Pi(Ct,nt)){var bt=ue.interleaved;bt===null?(Fe.next=Fe,Ng(ue)):(Fe.next=bt.next,bt.next=Fe),ue.interleaved=Fe;return}}catch{}finally{}Ae=rl(le,ue,Fe,Se),Ae!==null&&(Fe=no(),ps(Ae,le,Se,Fe),tg(Ae,ue,Se))}}function cl(le){var ue=le.alternate;return le===Rr||ue!==null&&ue===Rr}function eg(le,ue){Gi=So=!0;var Ae=le.pending;Ae===null?ue.next=ue:(ue.next=Ae.next,Ae.next=ue),le.pending=ue}function tg(le,ue,Ae){if((Ae&4194240)!==0){var Se=ue.lanes;Se&=le.pendingLanes,Ae|=Se,ue.lanes=Ae,ho(le,Ae)}}var ng={readContext:Ji,useCallback:Ci,useContext:Ci,useEffect:Ci,useImperativeHandle:Ci,useInsertionEffect:Ci,useLayoutEffect:Ci,useMemo:Ci,useReducer:Ci,useRef:Ci,useState:Ci,useDebugValue:Ci,useDeferredValue:Ci,useTransition:Ci,useMutableSource:Ci,useSyncExternalStore:Ci,useId:Ci,unstable_isNewReconciler:!1},mc={readContext:Ji,useCallback:function(le,ue){return hi().memoizedState=[le,ue===void 0?null:ue],le},useContext:Ji,useEffect:Mi,useImperativeHandle:function(le,ue,Ae){return Ae=Ae!=null?Ae.concat([le]):null,No(4194308,4,fc.bind(null,ue,le),Ae)},useLayoutEffect:function(le,ue){return No(4194308,4,le,ue)},useInsertionEffect:function(le,ue){return No(4,2,le,ue)},useMemo:function(le,ue){var Ae=hi();return ue=ue===void 0?null:ue,le=le(),Ae.memoizedState=[le,ue],le},useReducer:function(le,ue,Ae){var Se=hi();return ue=Ae!==void 0?Ae(ue):ue,Se.memoizedState=Se.baseState=ue,le={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:le,lastRenderedState:ue},Se.queue=le,le=le.dispatch=ql.bind(null,Rr,le),[Se.memoizedState,le]},useRef:function(le){var ue=hi();return le={current:le},ue.memoizedState=le},useState:Yg,useDebugValue:Ql,useDeferredValue:function(le){return hi().memoizedState=le},useTransition:function(){var le=Yg(!1),ue=le[0];return le=Uc.bind(null,le[1]),hi().memoizedState=le,[ue,le]},useMutableSource:function(){},useSyncExternalStore:function(le,ue,Ae){var Se=Rr,Fe=hi();if(xr){if(Ae===void 0)throw Error(_(407));Ae=Ae()}else{if(Ae=ue(),Si===null)throw Error(_(349));(ls&30)!==0||Jl(Se,ue,Ae)}Fe.memoizedState=Ae;var Ye={value:Ae,getSnapshot:ue};return Fe.queue=Ye,Mi(Ic.bind(null,Se,Ye,le),[le]),Se.flags|=2048,Ro(9,ll.bind(null,Se,Ye,Ae,ue),void 0,null),Ae},useId:function(){var le=hi(),ue=Si.identifierPrefix;if(xr){var Ae=co,Se=mn;Ae=(Se&~(1<<32-Nn(Se)-1)).toString(32)+Ae,ue=":"+ue+"R"+Ae,Ae=_s++,0<Ae&&(ue+="H"+Ae.toString(32)),ue+=":"}else Ae=Hi++,ue=":"+ue+"r"+Ae.toString(32)+":";return le.memoizedState=ue},unstable_isNewReconciler:!1},bc={readContext:Ji,useCallback:Ac,useContext:Ji,useEffect:Kg,useImperativeHandle:Dg,useInsertionEffect:zg,useLayoutEffect:hc,useMemo:qi,useReducer:al,useRef:Cc,useState:function(){return al(Za)},useDebugValue:Ql,useDeferredValue:function(le){var ue=$i();return $l(ue,Yr.memoizedState,le)},useTransition:function(){var le=al(Za)[0],ue=$i().memoizedState;return[le,ue]},useMutableSource:Hg,useSyncExternalStore:Xg,useId:cs,unstable_isNewReconciler:!1},yc={readContext:Ji,useCallback:Ac,useContext:Ji,useEffect:Kg,useImperativeHandle:Dg,useInsertionEffect:zg,useLayoutEffect:hc,useMemo:qi,useReducer:gs,useRef:Cc,useState:function(){return gs(Za)},useDebugValue:Ql,useDeferredValue:function(le){var ue=$i();return Yr===null?ue.memoizedState=le:$l(ue,Yr.memoizedState,le)},useTransition:function(){var le=gs(Za)[0],ue=$i().memoizedState;return[le,ue]},useMutableSource:Hg,useSyncExternalStore:Xg,useId:cs,unstable_isNewReconciler:!1};function Io(le,ue){if(le&&le.defaultProps){ue=je({},ue),le=le.defaultProps;for(var Ae in le)ue[Ae]===void 0&&(ue[Ae]=le[Ae]);return ue}return ue}function ul(le,ue,Ae,Se){ue=le.memoizedState,Ae=Ae(Se,ue),Ae=Ae==null?ue:je({},ue,Ae),le.memoizedState=Ae,le.lanes===0&&(le.updateQueue.baseState=Ae)}var rg={isMounted:function(le){return(le=le._reactInternals)?ke(le)===le:!1},enqueueSetState:function(le,ue,Ae){le=le._reactInternals;var Se=no(),Fe=Fa(le),Ye=mr(Se,Fe);Ye.payload=ue,Ae!=null&&(Ye.callback=Ae),ue=Wr(le,Ye,Fe),ue!==null&&(ps(ue,le,Fe,Se),Bi(ue,le,Fe))},enqueueReplaceState:function(le,ue,Ae){le=le._reactInternals;var Se=no(),Fe=Fa(le),Ye=mr(Se,Fe);Ye.tag=1,Ye.payload=ue,Ae!=null&&(Ye.callback=Ae),ue=Wr(le,Ye,Fe),ue!==null&&(ps(ue,le,Fe,Se),Bi(ue,le,Fe))},enqueueForceUpdate:function(le,ue){le=le._reactInternals;var Ae=no(),Se=Fa(le),Fe=mr(Ae,Se);Fe.tag=2,ue!=null&&(Fe.callback=ue),ue=Wr(le,Fe,Se),ue!==null&&(ps(ue,le,Se,Ae),Bi(ue,le,Se))}};function vc(le,ue,Ae,Se,Fe,Ye,nt){return le=le.stateNode,typeof le.shouldComponentUpdate=="function"?le.shouldComponentUpdate(Se,Ye,nt):ue.prototype&&ue.prototype.isPureReactComponent?!Hs(Ae,Se)||!Hs(Fe,Ye):!0}function Ie(le,ue,Ae){var Se=!1,Fe=$o,Ye=ue.contextType;return typeof Ye=="object"&&Ye!==null?Ye=Ji(Ye):(Fe=vi(ue)?qo:Ii.current,Se=ue.contextTypes,Ye=(Se=Se!=null)?Ds(le,Fe):$o),ue=new ue(Ae,Ye),le.memoizedState=ue.state!==null&&ue.state!==void 0?ue.state:null,ue.updater=rg,le.stateNode=ue,ue._reactInternals=le,Se&&(le=le.stateNode,le.__reactInternalMemoizedUnmaskedChildContext=Fe,le.__reactInternalMemoizedMaskedChildContext=Ye),ue}function he(le,ue,Ae,Se){le=ue.state,typeof ue.componentWillReceiveProps=="function"&&ue.componentWillReceiveProps(Ae,Se),typeof ue.UNSAFE_componentWillReceiveProps=="function"&&ue.UNSAFE_componentWillReceiveProps(Ae,Se),ue.state!==le&&rg.enqueueReplaceState(ue,ue.state,null)}function Ge(le,ue,Ae,Se){var Fe=le.stateNode;Fe.props=Ae,Fe.state=le.memoizedState,Fe.refs={},nr(le);var Ye=ue.contextType;typeof Ye=="object"&&Ye!==null?Fe.context=Ji(Ye):(Ye=vi(ue)?qo:Ii.current,Fe.context=Ds(le,Ye)),Fe.state=le.memoizedState,Ye=ue.getDerivedStateFromProps,typeof Ye=="function"&&(ul(le,ue,Ye,Ae),Fe.state=le.memoizedState),typeof ue.getDerivedStateFromProps=="function"||typeof Fe.getSnapshotBeforeUpdate=="function"||typeof Fe.UNSAFE_componentWillMount!="function"&&typeof Fe.componentWillMount!="function"||(ue=Fe.state,typeof Fe.componentWillMount=="function"&&Fe.componentWillMount(),typeof Fe.UNSAFE_componentWillMount=="function"&&Fe.UNSAFE_componentWillMount(),ue!==Fe.state&&rg.enqueueReplaceState(Fe,Fe.state,null),kr(le,Ae,Fe,Se),Fe.state=le.memoizedState),typeof Fe.componentDidMount=="function"&&(le.flags|=4194308)}function we(le,ue){try{var Ae="",Se=ue;do Ae+=gt(Se),Se=Se.return;while(Se);var Fe=Ae}catch(Ye){Fe=`
Error generating stack: `+Ye.message+`
`+Ye.stack}return{value:le,source:ue,stack:Fe,digest:null}}function Le(le,ue,Ae){return{value:le,source:null,stack:Ae??null,digest:ue??null}}function ze(le,ue){try{console.error(ue.value)}catch(Ae){setTimeout(function(){throw Ae})}}var dt=typeof WeakMap=="function"?WeakMap:Map;function Gt(le,ue,Ae){Ae=mr(-1,Ae),Ae.tag=3,Ae.payload={element:null};var Se=ue.value;return Ae.callback=function(){Zc||(Zc=!0,nu=Se),ze(le,ue)},Ae}function Qt(le,ue,Ae){Ae=mr(-1,Ae),Ae.tag=3;var Se=le.type.getDerivedStateFromError;if(typeof Se=="function"){var Fe=ue.value;Ae.payload=function(){return Se(Fe)},Ae.callback=function(){ze(le,ue)}}var Ye=le.stateNode;return Ye!==null&&typeof Ye.componentDidCatch=="function"&&(Ae.callback=function(){ze(le,ue),typeof Se!="function"&&(Ma===null?Ma=new Set([this]):Ma.add(this));var nt=ue.stack;this.componentDidCatch(ue.value,{componentStack:nt!==null?nt:""})}),Ae}function In(le,ue,Ae){var Se=le.pingCache;if(Se===null){Se=le.pingCache=new dt;var Fe=new Set;Se.set(ue,Fe)}else Fe=Se.get(ue),Fe===void 0&&(Fe=new Set,Se.set(ue,Fe));Fe.has(Ae)||(Fe.add(Ae),le=ld.bind(null,le,ue,Ae),ue.then(le,le))}function Rn(le){do{var ue;if((ue=le.tag===13)&&(ue=le.memoizedState,ue=ue!==null?ue.dehydrated!==null:!0),ue)return le;le=le.return}while(le!==null);return null}function $n(le,ue,Ae,Se,Fe){return(le.mode&1)===0?(le===ue?le.flags|=65536:(le.flags|=128,Ae.flags|=131072,Ae.flags&=-52805,Ae.tag===1&&(Ae.alternate===null?Ae.tag=17:(ue=mr(-1,1),ue.tag=2,Wr(Ae,ue,1))),Ae.lanes|=1),le):(le.flags|=65536,le.lanes=Fe,le)}var Yn=Re.ReactCurrentOwner,ir=!1;function Gn(le,ue,Ae,Se){ue.child=le===null?el(ue,null,Ae,Se):js(ue,le.child,Ae,Se)}function fi(le,ue,Ae,Se,Fe){Ae=Ae.render;var Ye=ue.ref;return Zs(ue,Fe),Se=sl(le,ue,Ae,Se,Ye,Fe),Ae=Lg(),le!==null&&!ir?(ue.updateQueue=le.updateQueue,ue.flags&=-2053,le.lanes&=~Fe,oa(le,ue,Fe)):(xr&&Ae&&_g(ue),ue.flags|=1,Gn(le,ue,Se,Fe),ue.child)}function eo(le,ue,Ae,Se,Fe){if(le===null){var Ye=Ae.type;return typeof Ye=="function"&&!gu(Ye)&&Ye.defaultProps===void 0&&Ae.compare===null&&Ae.defaultProps===void 0?(ue.tag=15,ue.type=Ye,kt(le,ue,Ye,Se,Fe)):(le=Vc(Ae.type,null,Se,ue,ue.mode,Fe),le.ref=ue.ref,le.return=ue,ue.child=le)}if(Ye=le.child,(le.lanes&Fe)===0){var nt=Ye.memoizedProps;if(Ae=Ae.compare,Ae=Ae!==null?Ae:Hs,Ae(nt,Se)&&le.ref===ue.ref)return oa(le,ue,Fe)}return ue.flags|=1,le=Ta(Ye,Se),le.ref=ue.ref,le.return=ue,ue.child=le}function kt(le,ue,Ae,Se,Fe){if(le!==null){var Ye=le.memoizedProps;if(Hs(Ye,Se)&&le.ref===ue.ref)if(ir=!1,ue.pendingProps=Se=Ye,(le.lanes&Fe)!==0)(le.flags&131072)!==0&&(ir=!0);else return ue.lanes=le.lanes,oa(le,ue,Fe)}return Bn(le,ue,Ae,Se,Fe)}function xt(le,ue,Ae){var Se=ue.pendingProps,Fe=Se.children,Ye=le!==null?le.memoizedState:null;if(Se.mode==="hidden")if((ue.mode&1)===0)ue.memoizedState={baseLanes:0,cachePool:null,transitions:null},Br(og,wo),wo|=Ae;else{if((Ae&1073741824)===0)return le=Ye!==null?Ye.baseLanes|Ae:Ae,ue.lanes=ue.childLanes=1073741824,ue.memoizedState={baseLanes:le,cachePool:null,transitions:null},ue.updateQueue=null,Br(og,wo),wo|=le,null;ue.memoizedState={baseLanes:0,cachePool:null,transitions:null},Se=Ye!==null?Ye.baseLanes:Ae,Br(og,wo),wo|=Se}else Ye!==null?(Se=Ye.baseLanes|Ae,ue.memoizedState=null):Se=Ae,Br(og,wo),wo|=Se;return Gn(le,ue,Fe,Ae),ue.child}function Ut(le,ue){var Ae=ue.ref;(le===null&&Ae!==null||le!==null&&le.ref!==Ae)&&(ue.flags|=512,ue.flags|=2097152)}function Bn(le,ue,Ae,Se,Fe){var Ye=vi(Ae)?qo:Ii.current;return Ye=Ds(ue,Ye),Zs(ue,Fe),Ae=sl(le,ue,Ae,Se,Ye,Fe),Se=Lg(),le!==null&&!ir?(ue.updateQueue=le.updateQueue,ue.flags&=-2053,le.lanes&=~Fe,oa(le,ue,Fe)):(xr&&Se&&_g(ue),ue.flags|=1,Gn(le,ue,Ae,Fe),ue.child)}function Vn(le,ue,Ae,Se,Fe){if(vi(Ae)){var Ye=!0;Us(ue)}else Ye=!1;if(Zs(ue,Fe),ue.stateNode===null)Gc(le,ue),Ie(ue,Ae,Se),Ge(ue,Ae,Se,Fe),Se=!0;else if(le===null){var nt=ue.stateNode,Ct=ue.memoizedProps;nt.props=Ct;var bt=nt.context,Yt=Ae.contextType;typeof Yt=="object"&&Yt!==null?Yt=Ji(Yt):(Yt=vi(Ae)?qo:Ii.current,Yt=Ds(ue,Yt));var cn=Ae.getDerivedStateFromProps,dn=typeof cn=="function"||typeof nt.getSnapshotBeforeUpdate=="function";dn||typeof nt.UNSAFE_componentWillReceiveProps!="function"&&typeof nt.componentWillReceiveProps!="function"||(Ct!==Se||bt!==Yt)&&he(ue,nt,Se,Yt),Ar=!1;var ln=ue.memoizedState;nt.state=ln,kr(ue,Se,nt,Fe),bt=ue.memoizedState,Ct!==Se||ln!==bt||Zi.current||Ar?(typeof cn=="function"&&(ul(ue,Ae,cn,Se),bt=ue.memoizedState),(Ct=Ar||vc(ue,Ae,Ct,Se,ln,bt,Yt))?(dn||typeof nt.UNSAFE_componentWillMount!="function"&&typeof nt.componentWillMount!="function"||(typeof nt.componentWillMount=="function"&&nt.componentWillMount(),typeof nt.UNSAFE_componentWillMount=="function"&&nt.UNSAFE_componentWillMount()),typeof nt.componentDidMount=="function"&&(ue.flags|=4194308)):(typeof nt.componentDidMount=="function"&&(ue.flags|=4194308),ue.memoizedProps=Se,ue.memoizedState=bt),nt.props=Se,nt.state=bt,nt.context=Yt,Se=Ct):(typeof nt.componentDidMount=="function"&&(ue.flags|=4194308),Se=!1)}else{nt=ue.stateNode,Dr(le,ue),Ct=ue.memoizedProps,Yt=ue.type===ue.elementType?Ct:Io(ue.type,Ct),nt.props=Yt,dn=ue.pendingProps,ln=nt.context,bt=Ae.contextType,typeof bt=="object"&&bt!==null?bt=Ji(bt):(bt=vi(Ae)?qo:Ii.current,bt=Ds(ue,bt));var Sn=Ae.getDerivedStateFromProps;(cn=typeof Sn=="function"||typeof nt.getSnapshotBeforeUpdate=="function")||typeof nt.UNSAFE_componentWillReceiveProps!="function"&&typeof nt.componentWillReceiveProps!="function"||(Ct!==dn||ln!==bt)&&he(ue,nt,Se,bt),Ar=!1,ln=ue.memoizedState,nt.state=ln,kr(ue,Se,nt,Fe);var Mn=ue.memoizedState;Ct!==dn||ln!==Mn||Zi.current||Ar?(typeof Sn=="function"&&(ul(ue,Ae,Sn,Se),Mn=ue.memoizedState),(Yt=Ar||vc(ue,Ae,Yt,Se,ln,Mn,bt)||!1)?(cn||typeof nt.UNSAFE_componentWillUpdate!="function"&&typeof nt.componentWillUpdate!="function"||(typeof nt.componentWillUpdate=="function"&&nt.componentWillUpdate(Se,Mn,bt),typeof nt.UNSAFE_componentWillUpdate=="function"&&nt.UNSAFE_componentWillUpdate(Se,Mn,bt)),typeof nt.componentDidUpdate=="function"&&(ue.flags|=4),typeof nt.getSnapshotBeforeUpdate=="function"&&(ue.flags|=1024)):(typeof nt.componentDidUpdate!="function"||Ct===le.memoizedProps&&ln===le.memoizedState||(ue.flags|=4),typeof nt.getSnapshotBeforeUpdate!="function"||Ct===le.memoizedProps&&ln===le.memoizedState||(ue.flags|=1024),ue.memoizedProps=Se,ue.memoizedState=Mn),nt.props=Se,nt.state=Mn,nt.context=bt,Se=Yt):(typeof nt.componentDidUpdate!="function"||Ct===le.memoizedProps&&ln===le.memoizedState||(ue.flags|=4),typeof nt.getSnapshotBeforeUpdate!="function"||Ct===le.memoizedProps&&ln===le.memoizedState||(ue.flags|=1024),Se=!1)}return er(le,ue,Ae,Se,Ye,Fe)}function er(le,ue,Ae,Se,Fe,Ye){Ut(le,ue);var nt=(ue.flags&128)!==0;if(!Se&&!nt)return Fe&&Zg(ue,Ae,!1),oa(le,ue,Ye);Se=ue.stateNode,Yn.current=ue;var Ct=nt&&typeof Ae.getDerivedStateFromError!="function"?null:Se.render();return ue.flags|=1,le!==null&&nt?(ue.child=js(ue,le.child,null,Ye),ue.child=js(ue,null,Ct,Ye)):Gn(le,ue,Ct,Ye),ue.memoizedState=Se.state,Fe&&Zg(ue,Ae,!0),ue.child}function qn(le){var ue=le.stateNode;ue.pendingContext?xg(le,ue.pendingContext,ue.pendingContext!==ue.context):ue.context&&xg(le,ue.context,!1),il(le,ue.containerInfo)}function ur(le,ue,Ae,Se,Fe){return xs(),Ga(Fe),ue.flags|=256,Gn(le,ue,Ae,Se),ue.child}var Or={dehydrated:null,treeContext:null,retryLane:0};function lr(le){return{baseLanes:le,cachePool:null,transitions:null}}function us(le,ue,Ae){var Se=ue.pendingProps,Fe=Zr.current,Ye=!1,nt=(ue.flags&128)!==0,Ct;if((Ct=nt)||(Ct=le!==null&&le.memoizedState===null?!1:(Fe&2)!==0),Ct?(Ye=!0,ue.flags&=-129):(le===null||le.memoizedState!==null)&&(Fe|=1),Br(Zr,Fe&1),le===null)return Ol(ue),le=ue.memoizedState,le!==null&&(le=le.dehydrated,le!==null)?((ue.mode&1)===0?ue.lanes=1:le.data==="$!"?ue.lanes=8:ue.lanes=1073741824,null):(nt=Se.children,le=Se.fallback,Ye?(Se=ue.mode,Ye=ue.child,nt={mode:"hidden",children:nt},(Se&1)===0&&Ye!==null?(Ye.childLanes=0,Ye.pendingProps=nt):Ye=Tc(nt,Se,0,null),le=hl(le,Se,Ae,null),Ye.return=ue,le.return=ue,Ye.sibling=le,ue.child=Ye,ue.child.memoizedState=lr(Ae),ue.memoizedState=Or,le):Ug(ue,nt));if(Fe=le.memoizedState,Fe!==null&&(Ct=Fe.dehydrated,Ct!==null))return Ou(le,ue,nt,Se,Ct,Fe,Ae);if(Ye){Ye=Se.fallback,nt=ue.mode,Fe=le.child,Ct=Fe.sibling;var bt={mode:"hidden",children:Se.children};return(nt&1)===0&&ue.child!==Fe?(Se=ue.child,Se.childLanes=0,Se.pendingProps=bt,ue.deletions=null):(Se=Ta(Fe,bt),Se.subtreeFlags=Fe.subtreeFlags&14680064),Ct!==null?Ye=Ta(Ct,Ye):(Ye=hl(Ye,nt,Ae,null),Ye.flags|=2),Ye.return=ue,Se.return=ue,Se.sibling=Ye,ue.child=Se,Se=Ye,Ye=ue.child,nt=le.child.memoizedState,nt=nt===null?lr(Ae):{baseLanes:nt.baseLanes|Ae,cachePool:null,transitions:nt.transitions},Ye.memoizedState=nt,Ye.childLanes=le.childLanes&~Ae,ue.memoizedState=Or,Se}return Ye=le.child,le=Ye.sibling,Se=Ta(Ye,{mode:"visible",children:Se.children}),(ue.mode&1)===0&&(Se.lanes=Ae),Se.return=ue,Se.sibling=null,le!==null&&(Ae=ue.deletions,Ae===null?(ue.deletions=[le],ue.flags|=16):Ae.push(le)),ue.child=Se,ue.memoizedState=null,Se}function Ug(le,ue){return ue=Tc({mode:"visible",children:ue},le.mode,0,null),ue.return=le,le.child=ue}function Bc(le,ue,Ae,Se){return Se!==null&&Ga(Se),js(ue,le.child,null,Ae),le=Ug(ue,ue.pendingProps.children),le.flags|=2,ue.memoizedState=null,le}function Ou(le,ue,Ae,Se,Fe,Ye,nt){if(Ae)return ue.flags&256?(ue.flags&=-257,Se=Le(Error(_(422))),Bc(le,ue,nt,Se)):ue.memoizedState!==null?(ue.child=le.child,ue.flags|=128,null):(Ye=Se.fallback,Fe=ue.mode,Se=Tc({mode:"visible",children:Se.children},Fe,0,null),Ye=hl(Ye,Fe,nt,null),Ye.flags|=2,Se.return=ue,Ye.return=ue,Se.sibling=Ye,ue.child=Se,(ue.mode&1)!==0&&js(ue,le.child,null,nt),ue.child.memoizedState=lr(nt),ue.memoizedState=Or,Ye);if((ue.mode&1)===0)return Bc(le,ue,nt,null);if(Fe.data==="$!"){if(Se=Fe.nextSibling&&Fe.nextSibling.dataset,Se)var Ct=Se.dgst;return Se=Ct,Ye=Error(_(419)),Se=Le(Ye,Se,void 0),Bc(le,ue,nt,Se)}if(Ct=(nt&le.childLanes)!==0,ir||Ct){if(Se=Si,Se!==null){switch(nt&-nt){case 4:Fe=2;break;case 16:Fe=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:Fe=32;break;case 536870912:Fe=268435456;break;default:Fe=0}Fe=(Fe&(Se.suspendedLanes|nt))!==0?0:Fe,Fe!==0&&Fe!==Ye.retryLane&&(Ye.retryLane=Fe,Bo(le,Fe),ps(Se,le,Fe,-1))}return lu(),Se=Le(Error(_(421))),Bc(le,ue,nt,Se)}return Fe.data==="$?"?(ue.flags|=128,ue.child=le.child,ue=gd.bind(null,le),Fe._reactRetry=ue,null):(le=Ye.treeContext,_i=Jo(Fe.nextSibling),pi=ue,xr=!0,uo=null,le!==null&&(Ei[gi++]=mn,Ei[gi++]=co,Ei[gi++]=Os,mn=le.id,co=le.overflow,Os=ue),ue=Ug(ue,Se.children),ue.flags|=4096,ue)}function fu(le,ue,Ae){le.lanes|=ue;var Se=le.alternate;Se!==null&&(Se.lanes|=ue),nl(le.return,ue,Ae)}function Pc(le,ue,Ae,Se,Fe){var Ye=le.memoizedState;Ye===null?le.memoizedState={isBackwards:ue,rendering:null,renderingStartTime:0,last:Se,tail:Ae,tailMode:Fe}:(Ye.isBackwards=ue,Ye.rendering=null,Ye.renderingStartTime=0,Ye.last=Se,Ye.tail=Ae,Ye.tailMode=Fe)}function Au(le,ue,Ae){var Se=ue.pendingProps,Fe=Se.revealOrder,Ye=Se.tail;if(Gn(le,ue,Se.children,Ae),Se=Zr.current,(Se&2)!==0)Se=Se&1|2,ue.flags|=128;else{if(le!==null&&(le.flags&128)!==0)e:for(le=ue.child;le!==null;){if(le.tag===13)le.memoizedState!==null&&fu(le,Ae,ue);else if(le.tag===19)fu(le,Ae,ue);else if(le.child!==null){le.child.return=le,le=le.child;continue}if(le===ue)break e;for(;le.sibling===null;){if(le.return===null||le.return===ue)break e;le=le.return}le.sibling.return=le.return,le=le.sibling}Se&=1}if(Br(Zr,Se),(ue.mode&1)===0)ue.memoizedState=null;else switch(Fe){case"forwards":for(Ae=ue.child,Fe=null;Ae!==null;)le=Ae.alternate,le!==null&&Go(le)===null&&(Fe=Ae),Ae=Ae.sibling;Ae=Fe,Ae===null?(Fe=ue.child,ue.child=null):(Fe=Ae.sibling,Ae.sibling=null),Pc(ue,!1,Fe,Ae,Ye);break;case"backwards":for(Ae=null,Fe=ue.child,ue.child=null;Fe!==null;){if(le=Fe.alternate,le!==null&&Go(le)===null){ue.child=Fe;break}le=Fe.sibling,Fe.sibling=Ae,Ae=Fe,Fe=le}Pc(ue,!0,Ae,null,Ye);break;case"together":Pc(ue,!1,null,null,void 0);break;default:ue.memoizedState=null}return ue.child}function Gc(le,ue){(ue.mode&1)===0&&le!==null&&(le.alternate=null,ue.alternate=null,ue.flags|=2)}function oa(le,ue,Ae){if(le!==null&&(ue.dependencies=le.dependencies),dl|=ue.lanes,(Ae&ue.childLanes)===0)return null;if(le!==null&&ue.child!==le.child)throw Error(_(153));if(ue.child!==null){for(le=ue.child,Ae=Ta(le,le.pendingProps),ue.child=Ae,Ae.return=ue;le.sibling!==null;)le=le.sibling,Ae=Ae.sibling=Ta(le,le.pendingProps),Ae.return=ue;Ae.sibling=null}return ue.child}function ju(le,ue,Ae){switch(ue.tag){case 3:qn(ue),xs();break;case 5:ta(ue);break;case 1:vi(ue.type)&&Us(ue);break;case 4:il(ue,ue.stateNode.containerInfo);break;case 10:var Se=ue.type._context,Fe=ue.memoizedProps.value;Br(Js,Se._currentValue),Se._currentValue=Fe;break;case 13:if(Se=ue.memoizedState,Se!==null)return Se.dehydrated!==null?(Br(Zr,Zr.current&1),ue.flags|=128,null):(Ae&ue.child.childLanes)!==0?us(le,ue,Ae):(Br(Zr,Zr.current&1),le=oa(le,ue,Ae),le!==null?le.sibling:null);Br(Zr,Zr.current&1);break;case 19:if(Se=(Ae&ue.childLanes)!==0,(le.flags&128)!==0){if(Se)return Au(le,ue,Ae);ue.flags|=128}if(Fe=ue.memoizedState,Fe!==null&&(Fe.rendering=null,Fe.tail=null,Fe.lastEffect=null),Br(Zr,Zr.current),Se)break;return null;case 22:case 23:return ue.lanes=0,xt(le,ue,Ae)}return oa(le,ue,Ae)}var mu,Oc,bu,yu;mu=function(le,ue){for(var Ae=ue.child;Ae!==null;){if(Ae.tag===5||Ae.tag===6)le.appendChild(Ae.stateNode);else if(Ae.tag!==4&&Ae.child!==null){Ae.child.return=Ae,Ae=Ae.child;continue}if(Ae===ue)break;for(;Ae.sibling===null;){if(Ae.return===null||Ae.return===ue)return;Ae=Ae.return}Ae.sibling.return=Ae.return,Ae=Ae.sibling}},Oc=function(){},bu=function(le,ue,Ae,Se){var Fe=le.memoizedProps;if(Fe!==Se){le=ue.stateNode,Pr(Qi.current);var Ye=null;switch(Ae){case"input":Fe=wt(le,Fe),Se=wt(le,Se),Ye=[];break;case"select":Fe=je({},Fe,{value:void 0}),Se=je({},Se,{value:void 0}),Ye=[];break;case"textarea":Fe=un(le,Fe),Se=un(le,Se),Ye=[];break;default:typeof Fe.onClick!="function"&&typeof Se.onClick=="function"&&(le.onclick=Pa)}on(Ae,Se);var nt;Ae=null;for(Yt in Fe)if(!Se.hasOwnProperty(Yt)&&Fe.hasOwnProperty(Yt)&&Fe[Yt]!=null)if(Yt==="style"){var Ct=Fe[Yt];for(nt in Ct)Ct.hasOwnProperty(nt)&&(Ae||(Ae={}),Ae[nt]="")}else Yt!=="dangerouslySetInnerHTML"&&Yt!=="children"&&Yt!=="suppressContentEditableWarning"&&Yt!=="suppressHydrationWarning"&&Yt!=="autoFocus"&&(te.hasOwnProperty(Yt)?Ye||(Ye=[]):(Ye=Ye||[]).push(Yt,null));for(Yt in Se){var bt=Se[Yt];if(Ct=Fe!=null?Fe[Yt]:void 0,Se.hasOwnProperty(Yt)&&bt!==Ct&&(bt!=null||Ct!=null))if(Yt==="style")if(Ct){for(nt in Ct)!Ct.hasOwnProperty(nt)||bt&&bt.hasOwnProperty(nt)||(Ae||(Ae={}),Ae[nt]="");for(nt in bt)bt.hasOwnProperty(nt)&&Ct[nt]!==bt[nt]&&(Ae||(Ae={}),Ae[nt]=bt[nt])}else Ae||(Ye||(Ye=[]),Ye.push(Yt,Ae)),Ae=bt;else Yt==="dangerouslySetInnerHTML"?(bt=bt?bt.__html:void 0,Ct=Ct?Ct.__html:void 0,bt!=null&&Ct!==bt&&(Ye=Ye||[]).push(Yt,bt)):Yt==="children"?typeof bt!="string"&&typeof bt!="number"||(Ye=Ye||[]).push(Yt,""+bt):Yt!=="suppressContentEditableWarning"&&Yt!=="suppressHydrationWarning"&&(te.hasOwnProperty(Yt)?(bt!=null&&Yt==="onScroll"&&Gr("scroll",le),Ye||Ct===bt||(Ye=[])):(Ye=Ye||[]).push(Yt,bt))}Ae&&(Ye=Ye||[]).push("style",Ae);var Yt=Ye;(ue.updateQueue=Yt)&&(ue.flags|=4)}},yu=function(le,ue,Ae,Se){Ae!==Se&&(ue.flags|=4)};function Pg(le,ue){if(!xr)switch(le.tailMode){case"hidden":ue=le.tail;for(var Ae=null;ue!==null;)ue.alternate!==null&&(Ae=ue),ue=ue.sibling;Ae===null?le.tail=null:Ae.sibling=null;break;case"collapsed":Ae=le.tail;for(var Se=null;Ae!==null;)Ae.alternate!==null&&(Se=Ae),Ae=Ae.sibling;Se===null?ue||le.tail===null?le.tail=null:le.tail.sibling=null:Se.sibling=null}}function Xi(le){var ue=le.alternate!==null&&le.alternate.child===le.child,Ae=0,Se=0;if(ue)for(var Fe=le.child;Fe!==null;)Ae|=Fe.lanes|Fe.childLanes,Se|=Fe.subtreeFlags&14680064,Se|=Fe.flags&14680064,Fe.return=le,Fe=Fe.sibling;else for(Fe=le.child;Fe!==null;)Ae|=Fe.lanes|Fe.childLanes,Se|=Fe.subtreeFlags,Se|=Fe.flags,Fe.return=le,Fe=Fe.sibling;return le.subtreeFlags|=Se,le.childLanes=Ae,ue}function Ju(le,ue,Ae){var Se=ue.pendingProps;switch(rs(ue),ue.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Xi(ue),null;case 1:return vi(ue.type)&&Oa(),Xi(ue),null;case 3:return Se=ue.stateNode,Es(),Sr(Zi),Sr(Ii),To(),Se.pendingContext&&(Se.context=Se.pendingContext,Se.pendingContext=null),(le===null||le.child===null)&&(Ba(ue)?ue.flags|=4:le===null||le.memoizedState.isDehydrated&&(ue.flags&256)===0||(ue.flags|=1024,uo!==null&&(ou(uo),uo=null))),Oc(le,ue),Xi(ue),null;case 5:wa(ue);var Fe=Pr(as.current);if(Ae=ue.type,le!==null&&ue.stateNode!=null)bu(le,ue,Ae,Se,Fe),le.ref!==ue.ref&&(ue.flags|=512,ue.flags|=2097152);else{if(!Se){if(ue.stateNode===null)throw Error(_(166));return Xi(ue),null}if(le=Pr(Qi.current),Ba(ue)){Se=ue.stateNode,Ae=ue.type;var Ye=ue.memoizedProps;switch(Se[$r]=ue,Se[va]=Ye,le=(ue.mode&1)!==0,Ae){case"dialog":Gr("cancel",Se),Gr("close",Se);break;case"iframe":case"object":case"embed":Gr("load",Se);break;case"video":case"audio":for(Fe=0;Fe<Rs.length;Fe++)Gr(Rs[Fe],Se);break;case"source":Gr("error",Se);break;case"img":case"image":case"link":Gr("error",Se),Gr("load",Se);break;case"details":Gr("toggle",Se);break;case"input":St(Se,Ye),Gr("invalid",Se);break;case"select":Se._wrapperState={wasMultiple:!!Ye.multiple},Gr("invalid",Se);break;case"textarea":qe(Se,Ye),Gr("invalid",Se)}on(Ae,Ye),Fe=null;for(var nt in Ye)if(Ye.hasOwnProperty(nt)){var Ct=Ye[nt];nt==="children"?typeof Ct=="string"?Se.textContent!==Ct&&(Ye.suppressHydrationWarning!==!0&&Ua(Se.textContent,Ct,le),Fe=["children",Ct]):typeof Ct=="number"&&Se.textContent!==""+Ct&&(Ye.suppressHydrationWarning!==!0&&Ua(Se.textContent,Ct,le),Fe=["children",""+Ct]):te.hasOwnProperty(nt)&&Ct!=null&&nt==="onScroll"&&Gr("scroll",Se)}switch(Ae){case"input":Zt(Se),Wt(Se,Ye,!0);break;case"textarea":Zt(Se),mt(Se);break;case"select":case"option":break;default:typeof Ye.onClick=="function"&&(Se.onclick=Pa)}Se=Fe,ue.updateQueue=Se,Se!==null&&(ue.flags|=4)}else{nt=Fe.nodeType===9?Fe:Fe.ownerDocument,le==="http://www.w3.org/1999/xhtml"&&(le=Dt(Ae)),le==="http://www.w3.org/1999/xhtml"?Ae==="script"?(le=nt.createElement("div"),le.innerHTML="<script><\/script>",le=le.removeChild(le.firstChild)):typeof Se.is=="string"?le=nt.createElement(Ae,{is:Se.is}):(le=nt.createElement(Ae),Ae==="select"&&(nt=le,Se.multiple?nt.multiple=!0:Se.size&&(nt.size=Se.size))):le=nt.createElementNS(le,Ae),le[$r]=ue,le[va]=Se,mu(le,ue,!1,!1),ue.stateNode=le;e:{switch(nt=An(Ae,Se),Ae){case"dialog":Gr("cancel",le),Gr("close",le),Fe=Se;break;case"iframe":case"object":case"embed":Gr("load",le),Fe=Se;break;case"video":case"audio":for(Fe=0;Fe<Rs.length;Fe++)Gr(Rs[Fe],le);Fe=Se;break;case"source":Gr("error",le),Fe=Se;break;case"img":case"image":case"link":Gr("error",le),Gr("load",le),Fe=Se;break;case"details":Gr("toggle",le),Fe=Se;break;case"input":St(le,Se),Fe=wt(le,Se),Gr("invalid",le);break;case"option":Fe=Se;break;case"select":le._wrapperState={wasMultiple:!!Se.multiple},Fe=je({},Se,{value:void 0}),Gr("invalid",le);break;case"textarea":qe(le,Se),Fe=un(le,Se),Gr("invalid",le);break;default:Fe=Se}on(Ae,Fe),Ct=Fe;for(Ye in Ct)if(Ct.hasOwnProperty(Ye)){var bt=Ct[Ye];Ye==="style"?rn(le,bt):Ye==="dangerouslySetInnerHTML"?(bt=bt?bt.__html:void 0,bt!=null&&nn(le,bt)):Ye==="children"?typeof bt=="string"?(Ae!=="textarea"||bt!=="")&&tn(le,bt):typeof bt=="number"&&tn(le,""+bt):Ye!=="suppressContentEditableWarning"&&Ye!=="suppressHydrationWarning"&&Ye!=="autoFocus"&&(te.hasOwnProperty(Ye)?bt!=null&&Ye==="onScroll"&&Gr("scroll",le):bt!=null&&Be(le,Ye,bt,nt))}switch(Ae){case"input":Zt(le),Wt(le,Se,!1);break;case"textarea":Zt(le),mt(le);break;case"option":Se.value!=null&&le.setAttribute("value",""+At(Se.value));break;case"select":le.multiple=!!Se.multiple,Ye=Se.value,Ye!=null?Mt(le,!!Se.multiple,Ye,!1):Se.defaultValue!=null&&Mt(le,!!Se.multiple,Se.defaultValue,!0);break;default:typeof Fe.onClick=="function"&&(le.onclick=Pa)}switch(Ae){case"button":case"input":case"select":case"textarea":Se=!!Se.autoFocus;break e;case"img":Se=!0;break e;default:Se=!1}}Se&&(ue.flags|=4)}ue.ref!==null&&(ue.flags|=512,ue.flags|=2097152)}return Xi(ue),null;case 6:if(le&&ue.stateNode!=null)yu(le,ue,le.memoizedProps,Se);else{if(typeof Se!="string"&&ue.stateNode===null)throw Error(_(166));if(Ae=Pr(as.current),Pr(Qi.current),Ba(ue)){if(Se=ue.stateNode,Ae=ue.memoizedProps,Se[$r]=ue,(Ye=Se.nodeValue!==Ae)&&(le=pi,le!==null))switch(le.tag){case 3:Ua(Se.nodeValue,Ae,(le.mode&1)!==0);break;case 5:le.memoizedProps.suppressHydrationWarning!==!0&&Ua(Se.nodeValue,Ae,(le.mode&1)!==0)}Ye&&(ue.flags|=4)}else Se=(Ae.nodeType===9?Ae:Ae.ownerDocument).createTextNode(Se),Se[$r]=ue,ue.stateNode=Se}return Xi(ue),null;case 13:if(Sr(Zr),Se=ue.memoizedState,le===null||le.memoizedState!==null&&le.memoizedState.dehydrated!==null){if(xr&&_i!==null&&(ue.mode&1)!==0&&(ue.flags&128)===0)Fg(),xs(),ue.flags|=98560,Ye=!1;else if(Ye=Ba(ue),Se!==null&&Se.dehydrated!==null){if(le===null){if(!Ye)throw Error(_(318));if(Ye=ue.memoizedState,Ye=Ye!==null?Ye.dehydrated:null,!Ye)throw Error(_(317));Ye[$r]=ue}else xs(),(ue.flags&128)===0&&(ue.memoizedState=null),ue.flags|=4;Xi(ue),Ye=!1}else uo!==null&&(ou(uo),uo=null),Ye=!0;if(!Ye)return ue.flags&65536?ue:null}return(ue.flags&128)!==0?(ue.lanes=Ae,ue):(Se=Se!==null,Se!==(le!==null&&le.memoizedState!==null)&&Se&&(ue.child.flags|=8192,(ue.mode&1)!==0&&(le===null||(Zr.current&1)!==0?Ai===0&&(Ai=3):lu())),ue.updateQueue!==null&&(ue.flags|=4),Xi(ue),null);case 4:return Es(),Oc(le,ue),le===null&&ma(ue.stateNode.containerInfo),Xi(ue),null;case 10:return tl(ue.type._context),Xi(ue),null;case 17:return vi(ue.type)&&Oa(),Xi(ue),null;case 19:if(Sr(Zr),Ye=ue.memoizedState,Ye===null)return Xi(ue),null;if(Se=(ue.flags&128)!==0,nt=Ye.rendering,nt===null)if(Se)Pg(Ye,!1);else{if(Ai!==0||le!==null&&(le.flags&128)!==0)for(le=ue.child;le!==null;){if(nt=Go(le),nt!==null){for(ue.flags|=128,Pg(Ye,!1),Se=nt.updateQueue,Se!==null&&(ue.updateQueue=Se,ue.flags|=4),ue.subtreeFlags=0,Se=Ae,Ae=ue.child;Ae!==null;)Ye=Ae,le=Se,Ye.flags&=14680066,nt=Ye.alternate,nt===null?(Ye.childLanes=0,Ye.lanes=le,Ye.child=null,Ye.subtreeFlags=0,Ye.memoizedProps=null,Ye.memoizedState=null,Ye.updateQueue=null,Ye.dependencies=null,Ye.stateNode=null):(Ye.childLanes=nt.childLanes,Ye.lanes=nt.lanes,Ye.child=nt.child,Ye.subtreeFlags=0,Ye.deletions=null,Ye.memoizedProps=nt.memoizedProps,Ye.memoizedState=nt.memoizedState,Ye.updateQueue=nt.updateQueue,Ye.type=nt.type,le=nt.dependencies,Ye.dependencies=le===null?null:{lanes:le.lanes,firstContext:le.firstContext}),Ae=Ae.sibling;return Br(Zr,Zr.current&1|2),ue.child}le=le.sibling}Ye.tail!==null&&yt()>sg&&(ue.flags|=128,Se=!0,Pg(Ye,!1),ue.lanes=4194304)}else{if(!Se)if(le=Go(nt),le!==null){if(ue.flags|=128,Se=!0,Ae=le.updateQueue,Ae!==null&&(ue.updateQueue=Ae,ue.flags|=4),Pg(Ye,!0),Ye.tail===null&&Ye.tailMode==="hidden"&&!nt.alternate&&!xr)return Xi(ue),null}else 2*yt()-Ye.renderingStartTime>sg&&Ae!==1073741824&&(ue.flags|=128,Se=!0,Pg(Ye,!1),ue.lanes=4194304);Ye.isBackwards?(nt.sibling=ue.child,ue.child=nt):(Ae=Ye.last,Ae!==null?Ae.sibling=nt:ue.child=nt,Ye.last=nt)}return Ye.tail!==null?(ue=Ye.tail,Ye.rendering=ue,Ye.tail=ue.sibling,Ye.renderingStartTime=yt(),ue.sibling=null,Ae=Zr.current,Br(Zr,Se?Ae&1|2:Ae&1),ue):(Xi(ue),null);case 22:case 23:return au(),Se=ue.memoizedState!==null,le!==null&&le.memoizedState!==null!==Se&&(ue.flags|=8192),Se&&(ue.mode&1)!==0?(wo&1073741824)!==0&&(Xi(ue),ue.subtreeFlags&6&&(ue.flags|=8192)):Xi(ue),null;case 24:return null;case 25:return null}throw Error(_(156,ue.tag))}function Qu(le,ue){switch(rs(ue),ue.tag){case 1:return vi(ue.type)&&Oa(),le=ue.flags,le&65536?(ue.flags=le&-65537|128,ue):null;case 3:return Es(),Sr(Zi),Sr(Ii),To(),le=ue.flags,(le&65536)!==0&&(le&128)===0?(ue.flags=le&-65537|128,ue):null;case 5:return wa(ue),null;case 13:if(Sr(Zr),le=ue.memoizedState,le!==null&&le.dehydrated!==null){if(ue.alternate===null)throw Error(_(340));xs()}return le=ue.flags,le&65536?(ue.flags=le&-65537|128,ue):null;case 19:return Sr(Zr),null;case 4:return Es(),null;case 10:return tl(ue.type._context),null;case 22:case 23:return au(),null;case 24:return null;default:return null}}var Sc=!1,ki=!1,$u=typeof WeakSet=="function"?WeakSet:Set,En=null;function ig(le,ue){var Ae=le.ref;if(Ae!==null)if(typeof Ae=="function")try{Ae(null)}catch(Se){jr(le,ue,Se)}else Ae.current=null}function jc(le,ue,Ae){try{Ae()}catch(Se){jr(le,ue,Se)}}var vu=!1;function qu(le,ue){if(ya=ni,le=Tr(),oi(le)){if("selectionStart"in le)var Ae={start:le.selectionStart,end:le.selectionEnd};else e:{Ae=(Ae=le.ownerDocument)&&Ae.defaultView||window;var Se=Ae.getSelection&&Ae.getSelection();if(Se&&Se.rangeCount!==0){Ae=Se.anchorNode;var Fe=Se.anchorOffset,Ye=Se.focusNode;Se=Se.focusOffset;try{Ae.nodeType,Ye.nodeType}catch{Ae=null;break e}var nt=0,Ct=-1,bt=-1,Yt=0,cn=0,dn=le,ln=null;t:for(;;){for(var Sn;dn!==Ae||Fe!==0&&dn.nodeType!==3||(Ct=nt+Fe),dn!==Ye||Se!==0&&dn.nodeType!==3||(bt=nt+Se),dn.nodeType===3&&(nt+=dn.nodeValue.length),(Sn=dn.firstChild)!==null;)ln=dn,dn=Sn;for(;;){if(dn===le)break t;if(ln===Ae&&++Yt===Fe&&(Ct=nt),ln===Ye&&++cn===Se&&(bt=nt),(Sn=dn.nextSibling)!==null)break;dn=ln,ln=dn.parentNode}dn=Sn}Ae=Ct===-1||bt===-1?null:{start:Ct,end:bt}}else Ae=null}Ae=Ae||{start:0,end:0}}else Ae=null;for(vg={focusedElem:le,selectionRange:Ae},ni=!1,En=ue;En!==null;)if(ue=En,le=ue.child,(ue.subtreeFlags&1028)!==0&&le!==null)le.return=ue,En=le;else for(;En!==null;){ue=En;try{var Mn=ue.alternate;if((ue.flags&1024)!==0)switch(ue.tag){case 0:case 11:case 15:break;case 1:if(Mn!==null){var Fn=Mn.memoizedProps,qr=Mn.memoizedState,Tt=ue.stateNode,Bt=Tt.getSnapshotBeforeUpdate(ue.elementType===ue.type?Fn:Io(ue.type,Fn),qr);Tt.__reactInternalSnapshotBeforeUpdate=Bt}break;case 3:var Lt=ue.stateNode.containerInfo;Lt.nodeType===1?Lt.textContent="":Lt.nodeType===9&&Lt.documentElement&&Lt.removeChild(Lt.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(_(163))}}catch(fn){jr(ue,ue.return,fn)}if(le=ue.sibling,le!==null){le.return=ue.return,En=le;break}En=ue.return}return Mn=vu,vu=!1,Mn}function Og(le,ue,Ae){var Se=ue.updateQueue;if(Se=Se!==null?Se.lastEffect:null,Se!==null){var Fe=Se=Se.next;do{if((Fe.tag&le)===le){var Ye=Fe.destroy;Fe.destroy=void 0,Ye!==void 0&&jc(ue,Ae,Ye)}Fe=Fe.next}while(Fe!==Se)}}function Rc(le,ue){if(ue=ue.updateQueue,ue=ue!==null?ue.lastEffect:null,ue!==null){var Ae=ue=ue.next;do{if((Ae.tag&le)===le){var Se=Ae.create;Ae.destroy=Se()}Ae=Ae.next}while(Ae!==ue)}}function Jc(le){var ue=le.ref;if(ue!==null){var Ae=le.stateNode;switch(le.tag){case 5:le=Ae;break;default:le=Ae}typeof ue=="function"?ue(le):ue.current=le}}function Bu(le){var ue=le.alternate;ue!==null&&(le.alternate=null,Bu(ue)),le.child=null,le.deletions=null,le.sibling=null,le.tag===5&&(ue=le.stateNode,ue!==null&&(delete ue[$r],delete ue[va],delete ue[zs],delete ue[kl],delete ue[Yl])),le.stateNode=null,le.return=null,le.dependencies=null,le.memoizedProps=null,le.memoizedState=null,le.pendingProps=null,le.stateNode=null,le.updateQueue=null}function Gu(le){return le.tag===5||le.tag===3||le.tag===4}function Su(le){e:for(;;){for(;le.sibling===null;){if(le.return===null||Gu(le.return))return null;le=le.return}for(le.sibling.return=le.return,le=le.sibling;le.tag!==5&&le.tag!==6&&le.tag!==18;){if(le.flags&2||le.child===null||le.tag===4)continue e;le.child.return=le,le=le.child}if(!(le.flags&2))return le.stateNode}}function Qc(le,ue,Ae){var Se=le.tag;if(Se===5||Se===6)le=le.stateNode,ue?Ae.nodeType===8?Ae.parentNode.insertBefore(le,ue):Ae.insertBefore(le,ue):(Ae.nodeType===8?(ue=Ae.parentNode,ue.insertBefore(le,Ae)):(ue=Ae,ue.appendChild(le)),Ae=Ae._reactRootContainer,Ae!=null||ue.onclick!==null||(ue.onclick=Pa));else if(Se!==4&&(le=le.child,le!==null))for(Qc(le,ue,Ae),le=le.sibling;le!==null;)Qc(le,ue,Ae),le=le.sibling}function $c(le,ue,Ae){var Se=le.tag;if(Se===5||Se===6)le=le.stateNode,ue?Ae.insertBefore(le,ue):Ae.appendChild(le);else if(Se!==4&&(le=le.child,le!==null))for($c(le,ue,Ae),le=le.sibling;le!==null;)$c(le,ue,Ae),le=le.sibling}var Wi=null,ds=!1;function Ea(le,ue,Ae){for(Ae=Ae.child;Ae!==null;)Ru(le,ue,Ae),Ae=Ae.sibling}function Ru(le,ue,Ae){if(_n&&typeof _n.onCommitFiberUnmount=="function")try{_n.onCommitFiberUnmount(bn,Ae)}catch{}switch(Ae.tag){case 5:ki||ig(Ae,ue);case 6:var Se=Wi,Fe=ds;Wi=null,Ea(le,ue,Ae),Wi=Se,ds=Fe,Wi!==null&&(ds?(le=Wi,Ae=Ae.stateNode,le.nodeType===8?le.parentNode.removeChild(Ae):le.removeChild(Ae)):Wi.removeChild(Ae.stateNode));break;case 18:Wi!==null&&(ds?(le=Wi,Ae=Ae.stateNode,le.nodeType===8?Xl(le.parentNode,Ae):le.nodeType===1&&Xl(le,Ae),As(le)):Xl(Wi,Ae.stateNode));break;case 4:Se=Wi,Fe=ds,Wi=Ae.stateNode.containerInfo,ds=!0,Ea(le,ue,Ae),Wi=Se,ds=Fe;break;case 0:case 11:case 14:case 15:if(!ki&&(Se=Ae.updateQueue,Se!==null&&(Se=Se.lastEffect,Se!==null))){Fe=Se=Se.next;do{var Ye=Fe,nt=Ye.destroy;Ye=Ye.tag,nt!==void 0&&((Ye&2)!==0||(Ye&4)!==0)&&jc(Ae,ue,nt),Fe=Fe.next}while(Fe!==Se)}Ea(le,ue,Ae);break;case 1:if(!ki&&(ig(Ae,ue),Se=Ae.stateNode,typeof Se.componentWillUnmount=="function"))try{Se.props=Ae.memoizedProps,Se.state=Ae.memoizedState,Se.componentWillUnmount()}catch(Ct){jr(Ae,ue,Ct)}Ea(le,ue,Ae);break;case 21:Ea(le,ue,Ae);break;case 22:Ae.mode&1?(ki=(Se=ki)||Ae.memoizedState!==null,Ea(le,ue,Ae),ki=Se):Ea(le,ue,Ae);break;default:Ea(le,ue,Ae)}}function wu(le){var ue=le.updateQueue;if(ue!==null){le.updateQueue=null;var Ae=le.stateNode;Ae===null&&(Ae=le.stateNode=new $u),ue.forEach(function(Se){var Fe=cd.bind(null,le,Se);Ae.has(Se)||(Ae.add(Se),Se.then(Fe,Fe))})}}function Is(le,ue){var Ae=ue.deletions;if(Ae!==null)for(var Se=0;Se<Ae.length;Se++){var Fe=Ae[Se];try{var Ye=le,nt=ue,Ct=nt;e:for(;Ct!==null;){switch(Ct.tag){case 5:Wi=Ct.stateNode,ds=!1;break e;case 3:Wi=Ct.stateNode.containerInfo,ds=!0;break e;case 4:Wi=Ct.stateNode.containerInfo,ds=!0;break e}Ct=Ct.return}if(Wi===null)throw Error(_(160));Ru(Ye,nt,Fe),Wi=null,ds=!1;var bt=Fe.alternate;bt!==null&&(bt.return=null),Fe.return=null}catch(Yt){jr(Fe,ue,Yt)}}if(ue.subtreeFlags&12854)for(ue=ue.child;ue!==null;)xu(ue,le),ue=ue.sibling}function xu(le,ue){var Ae=le.alternate,Se=le.flags;switch(le.tag){case 0:case 11:case 14:case 15:if(Is(ue,le),Ms(le),Se&4){try{Og(3,le,le.return),Rc(3,le)}catch(Fn){jr(le,le.return,Fn)}try{Og(5,le,le.return)}catch(Fn){jr(le,le.return,Fn)}}break;case 1:Is(ue,le),Ms(le),Se&512&&Ae!==null&&ig(Ae,Ae.return);break;case 5:if(Is(ue,le),Ms(le),Se&512&&Ae!==null&&ig(Ae,Ae.return),le.flags&32){var Fe=le.stateNode;try{tn(Fe,"")}catch(Fn){jr(le,le.return,Fn)}}if(Se&4&&(Fe=le.stateNode,Fe!=null)){var Ye=le.memoizedProps,nt=Ae!==null?Ae.memoizedProps:Ye,Ct=le.type,bt=le.updateQueue;if(le.updateQueue=null,bt!==null)try{Ct==="input"&&Ye.type==="radio"&&Ye.name!=null&&Rt(Fe,Ye),An(Ct,nt);var Yt=An(Ct,Ye);for(nt=0;nt<bt.length;nt+=2){var cn=bt[nt],dn=bt[nt+1];cn==="style"?rn(Fe,dn):cn==="dangerouslySetInnerHTML"?nn(Fe,dn):cn==="children"?tn(Fe,dn):Be(Fe,cn,dn,Yt)}switch(Ct){case"input":jt(Fe,Ye);break;case"textarea":Je(Fe,Ye);break;case"select":var ln=Fe._wrapperState.wasMultiple;Fe._wrapperState.wasMultiple=!!Ye.multiple;var Sn=Ye.value;Sn!=null?Mt(Fe,!!Ye.multiple,Sn,!1):ln!==!!Ye.multiple&&(Ye.defaultValue!=null?Mt(Fe,!!Ye.multiple,Ye.defaultValue,!0):Mt(Fe,!!Ye.multiple,Ye.multiple?[]:"",!1))}Fe[va]=Ye}catch(Fn){jr(le,le.return,Fn)}}break;case 6:if(Is(ue,le),Ms(le),Se&4){if(le.stateNode===null)throw Error(_(162));Fe=le.stateNode,Ye=le.memoizedProps;try{Fe.nodeValue=Ye}catch(Fn){jr(le,le.return,Fn)}}break;case 3:if(Is(ue,le),Ms(le),Se&4&&Ae!==null&&Ae.memoizedState.isDehydrated)try{As(ue.containerInfo)}catch(Fn){jr(le,le.return,Fn)}break;case 4:Is(ue,le),Ms(le);break;case 13:Is(ue,le),Ms(le),Fe=le.child,Fe.flags&8192&&(Ye=Fe.memoizedState!==null,Fe.stateNode.isHidden=Ye,!Ye||Fe.alternate!==null&&Fe.alternate.memoizedState!==null||(tu=yt())),Se&4&&wu(le);break;case 22:if(cn=Ae!==null&&Ae.memoizedState!==null,le.mode&1?(ki=(Yt=ki)||cn,Is(ue,le),ki=Yt):Is(ue,le),Ms(le),Se&8192){if(Yt=le.memoizedState!==null,(le.stateNode.isHidden=Yt)&&!cn&&(le.mode&1)!==0)for(En=le,cn=le.child;cn!==null;){for(dn=En=cn;En!==null;){switch(ln=En,Sn=ln.child,ln.tag){case 0:case 11:case 14:case 15:Og(4,ln,ln.return);break;case 1:ig(ln,ln.return);var Mn=ln.stateNode;if(typeof Mn.componentWillUnmount=="function"){Se=ln,Ae=ln.return;try{ue=Se,Mn.props=ue.memoizedProps,Mn.state=ue.memoizedState,Mn.componentWillUnmount()}catch(Fn){jr(Se,Ae,Fn)}}break;case 5:ig(ln,ln.return);break;case 22:if(ln.memoizedState!==null){_u(dn);continue}}Sn!==null?(Sn.return=ln,En=Sn):_u(dn)}cn=cn.sibling}e:for(cn=null,dn=le;;){if(dn.tag===5){if(cn===null){cn=dn;try{Fe=dn.stateNode,Yt?(Ye=Fe.style,typeof Ye.setProperty=="function"?Ye.setProperty("display","none","important"):Ye.display="none"):(Ct=dn.stateNode,bt=dn.memoizedProps.style,nt=bt!=null&&bt.hasOwnProperty("display")?bt.display:null,Ct.style.display=sn("display",nt))}catch(Fn){jr(le,le.return,Fn)}}}else if(dn.tag===6){if(cn===null)try{dn.stateNode.nodeValue=Yt?"":dn.memoizedProps}catch(Fn){jr(le,le.return,Fn)}}else if((dn.tag!==22&&dn.tag!==23||dn.memoizedState===null||dn===le)&&dn.child!==null){dn.child.return=dn,dn=dn.child;continue}if(dn===le)break e;for(;dn.sibling===null;){if(dn.return===null||dn.return===le)break e;cn===dn&&(cn=null),dn=dn.return}cn===dn&&(cn=null),dn.sibling.return=dn.return,dn=dn.sibling}}break;case 19:Is(ue,le),Ms(le),Se&4&&wu(le);break;case 21:break;default:Is(ue,le),Ms(le)}}function Ms(le){var ue=le.flags;if(ue&2){try{e:{for(var Ae=le.return;Ae!==null;){if(Gu(Ae)){var Se=Ae;break e}Ae=Ae.return}throw Error(_(160))}switch(Se.tag){case 5:var Fe=Se.stateNode;Se.flags&32&&(tn(Fe,""),Se.flags&=-33);var Ye=Su(le);$c(le,Ye,Fe);break;case 3:case 4:var nt=Se.stateNode.containerInfo,Ct=Su(le);Qc(le,Ct,nt);break;default:throw Error(_(161))}}catch(bt){jr(le,le.return,bt)}le.flags&=-3}ue&4096&&(le.flags&=-4097)}function ed(le,ue,Ae){En=le,Zu(le)}function Zu(le,ue,Ae){for(var Se=(le.mode&1)!==0;En!==null;){var Fe=En,Ye=Fe.child;if(Fe.tag===22&&Se){var nt=Fe.memoizedState!==null||Sc;if(!nt){var Ct=Fe.alternate,bt=Ct!==null&&Ct.memoizedState!==null||ki;Ct=Sc;var Yt=ki;if(Sc=nt,(ki=bt)&&!Yt)for(En=Fe;En!==null;)nt=En,bt=nt.child,nt.tag===22&&nt.memoizedState!==null?Mu(Fe):bt!==null?(bt.return=nt,En=bt):Mu(Fe);for(;Ye!==null;)En=Ye,Zu(Ye),Ye=Ye.sibling;En=Fe,Sc=Ct,ki=Yt}Eu(le)}else(Fe.subtreeFlags&8772)!==0&&Ye!==null?(Ye.return=Fe,En=Ye):Eu(le)}}function Eu(le){for(;En!==null;){var ue=En;if((ue.flags&8772)!==0){var Ae=ue.alternate;try{if((ue.flags&8772)!==0)switch(ue.tag){case 0:case 11:case 15:ki||Rc(5,ue);break;case 1:var Se=ue.stateNode;if(ue.flags&4&&!ki)if(Ae===null)Se.componentDidMount();else{var Fe=ue.elementType===ue.type?Ae.memoizedProps:Io(ue.type,Ae.memoizedProps);Se.componentDidUpdate(Fe,Ae.memoizedState,Se.__reactInternalSnapshotBeforeUpdate)}var Ye=ue.updateQueue;Ye!==null&&Ra(ue,Ye,Se);break;case 3:var nt=ue.updateQueue;if(nt!==null){if(Ae=null,ue.child!==null)switch(ue.child.tag){case 5:Ae=ue.child.stateNode;break;case 1:Ae=ue.child.stateNode}Ra(ue,nt,Ae)}break;case 5:var Ct=ue.stateNode;if(Ae===null&&ue.flags&4){Ae=Ct;var bt=ue.memoizedProps;switch(ue.type){case"button":case"input":case"select":case"textarea":bt.autoFocus&&Ae.focus();break;case"img":bt.src&&(Ae.src=bt.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(ue.memoizedState===null){var Yt=ue.alternate;if(Yt!==null){var cn=Yt.memoizedState;if(cn!==null){var dn=cn.dehydrated;dn!==null&&As(dn)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(_(163))}ki||ue.flags&512&&Jc(ue)}catch(ln){jr(ue,ue.return,ln)}}if(ue===le){En=null;break}if(Ae=ue.sibling,Ae!==null){Ae.return=ue.return,En=Ae;break}En=ue.return}}function _u(le){for(;En!==null;){var ue=En;if(ue===le){En=null;break}var Ae=ue.sibling;if(Ae!==null){Ae.return=ue.return,En=Ae;break}En=ue.return}}function Mu(le){for(;En!==null;){var ue=En;try{switch(ue.tag){case 0:case 11:case 15:var Ae=ue.return;try{Rc(4,ue)}catch(bt){jr(ue,Ae,bt)}break;case 1:var Se=ue.stateNode;if(typeof Se.componentDidMount=="function"){var Fe=ue.return;try{Se.componentDidMount()}catch(bt){jr(ue,Fe,bt)}}var Ye=ue.return;try{Jc(ue)}catch(bt){jr(ue,Ye,bt)}break;case 5:var nt=ue.return;try{Jc(ue)}catch(bt){jr(ue,nt,bt)}}}catch(bt){jr(ue,ue.return,bt)}if(ue===le){En=null;break}var Ct=ue.sibling;if(Ct!==null){Ct.return=ue.return,En=Ct;break}En=ue.return}}var nd=Math.ceil,wc=Re.ReactCurrentDispatcher,qc=Re.ReactCurrentOwner,Lo=Re.ReactCurrentBatchConfig,Cr=0,Si=null,ci=null,Fi=0,wo=0,og=Xr(0),Ai=0,jg=null,dl=0,xc=0,eu=0,Jg=null,po=null,tu=0,sg=1/0,sa=null,Zc=!1,nu=null,Ma=null,Ec=!1,Wa=null,_c=0,Qg=0,ru=null,Mc=-1,Wc=0;function no(){return(Cr&6)!==0?yt():Mc!==-1?Mc:Mc=yt()}function Fa(le){return(le.mode&1)===0?1:(Cr&2)!==0&&Fi!==0?Fi&-Fi:Dc.transition!==null?(Wc===0&&(Wc=vr()),Wc):(le=or,le!==0||(le=window.event,le=le===void 0?16:bs(le.type)),le)}function ps(le,ue,Ae,Se){if(50<Qg)throw Qg=0,ru=null,Error(_(185));wr(le,Ae,Se),((Cr&2)===0||le!==Si)&&(le===Si&&((Cr&2)===0&&(xc|=Ae),Ai===4&&Va(le,Fi)),Co(le,Se),Ae===1&&Cr===0&&(ue.mode&1)===0&&(sg=yt()+500,Ja&&Fo()))}function Co(le,ue){var Ae=le.callbackNode;ar(le,ue);var Se=Kn(le,le===Si?Fi:0);if(Se===0)Ae!==null&&Ot(Ae),le.callbackNode=null,le.callbackPriority=0;else if(ue=Se&-Se,le.callbackPriority!==ue){if(Ae!=null&&Ot(Ae),ue===1)le.tag===0?dc(Fu.bind(null,le)):Qa(Fu.bind(null,le)),zc(function(){(Cr&6)===0&&Fo()}),Ae=null;else{switch(xo(Se)){case 1:Ae=Cn;break;case 4:Ae=hn;break;case 16:Ae=xn;break;case 536870912:Ae=Wn;break;default:Ae=xn}Ae=Yu(Ae,Wu.bind(null,le))}le.callbackPriority=ue,le.callbackNode=Ae}}function Wu(le,ue){if(Mc=-1,Wc=0,(Cr&6)!==0)throw Error(_(327));var Ae=le.callbackNode;if(ag()&&le.callbackNode!==Ae)return null;var Se=Kn(le,le===Si?Fi:0);if(Se===0)return null;if((Se&30)!==0||(Se&le.expiredLanes)!==0||ue)ue=Fc(le,Se);else{ue=Se;var Fe=Cr;Cr|=2;var Ye=Tu();(Si!==le||Fi!==ue)&&(sa=null,sg=yt()+500,pl(le,ue));do try{sd();break}catch(Ct){Vu(le,Ct)}while(!0);$s(),wc.current=Ye,Cr=Fe,ci!==null?ue=0:(Si=null,Fi=0,ue=Ai)}if(ue!==0){if(ue===2&&(Fe=jn(le),Fe!==0&&(Se=Fe,ue=iu(le,Fe))),ue===1)throw Ae=jg,pl(le,0),Va(le,Se),Co(le,yt()),Ae;if(ue===6)Va(le,Se);else{if(Fe=le.current.alternate,(Se&30)===0&&!rd(Fe)&&(ue=Fc(le,Se),ue===2&&(Ye=jn(le),Ye!==0&&(Se=Ye,ue=iu(le,Ye))),ue===1))throw Ae=jg,pl(le,0),Va(le,Se),Co(le,yt()),Ae;switch(le.finishedWork=Fe,le.finishedLanes=Se,ue){case 0:case 1:throw Error(_(345));case 2:Cl(le,po,sa);break;case 3:if(Va(le,Se),(Se&130023424)===Se&&(ue=tu+500-yt(),10<ue)){if(Kn(le,0)!==0)break;if(Fe=le.suspendedLanes,(Fe&Se)!==Se){no(),le.pingedLanes|=le.suspendedLanes&Fe;break}le.timeoutHandle=Gg(Cl.bind(null,le,po,sa),ue);break}Cl(le,po,sa);break;case 4:if(Va(le,Se),(Se&4194240)===Se)break;for(ue=le.eventTimes,Fe=-1;0<Se;){var nt=31-Nn(Se);Ye=1<<nt,nt=ue[nt],nt>Fe&&(Fe=nt),Se&=~Ye}if(Se=Fe,Se=yt()-Se,Se=(120>Se?120:480>Se?480:1080>Se?1080:1920>Se?1920:3e3>Se?3e3:4320>Se?4320:1960*nd(Se/1960))-Se,10<Se){le.timeoutHandle=Gg(Cl.bind(null,le,po,sa),Se);break}Cl(le,po,sa);break;case 5:Cl(le,po,sa);break;default:throw Error(_(329))}}}return Co(le,yt()),le.callbackNode===Ae?Wu.bind(null,le):null}function iu(le,ue){var Ae=Jg;return le.current.memoizedState.isDehydrated&&(pl(le,ue).flags|=256),le=Fc(le,ue),le!==2&&(ue=po,po=Ae,ue!==null&&ou(ue)),le}function ou(le){po===null?po=le:po.push.apply(po,le)}function rd(le){for(var ue=le;;){if(ue.flags&16384){var Ae=ue.updateQueue;if(Ae!==null&&(Ae=Ae.stores,Ae!==null))for(var Se=0;Se<Ae.length;Se++){var Fe=Ae[Se],Ye=Fe.getSnapshot;Fe=Fe.value;try{if(!Pi(Ye(),Fe))return!1}catch{return!1}}}if(Ae=ue.child,ue.subtreeFlags&16384&&Ae!==null)Ae.return=ue,ue=Ae;else{if(ue===le)break;for(;ue.sibling===null;){if(ue.return===null||ue.return===le)return!0;ue=ue.return}ue.sibling.return=ue.return,ue=ue.sibling}}return!0}function Va(le,ue){for(ue&=~eu,ue&=~xc,le.suspendedLanes|=ue,le.pingedLanes&=~ue,le=le.expirationTimes;0<ue;){var Ae=31-Nn(ue),Se=1<<Ae;le[Ae]=-1,ue&=~Se}}function Fu(le){if((Cr&6)!==0)throw Error(_(327));ag();var ue=Kn(le,0);if((ue&1)===0)return Co(le,yt()),null;var Ae=Fc(le,ue);if(le.tag!==0&&Ae===2){var Se=jn(le);Se!==0&&(ue=Se,Ae=iu(le,Se))}if(Ae===1)throw Ae=jg,pl(le,0),Va(le,ue),Co(le,yt()),Ae;if(Ae===6)throw Error(_(345));return le.finishedWork=le.current.alternate,le.finishedLanes=ue,Cl(le,po,sa),Co(le,yt()),null}function su(le,ue){var Ae=Cr;Cr|=1;try{return le(ue)}finally{Cr=Ae,Cr===0&&(sg=yt()+500,Ja&&Fo())}}function Il(le){Wa!==null&&Wa.tag===0&&(Cr&6)===0&&ag();var ue=Cr;Cr|=1;var Ae=Lo.transition,Se=or;try{if(Lo.transition=null,or=1,le)return le()}finally{or=Se,Lo.transition=Ae,Cr=ue,(Cr&6)===0&&Fo()}}function au(){wo=og.current,Sr(og)}function pl(le,ue){le.finishedWork=null,le.finishedLanes=0;var Ae=le.timeoutHandle;if(Ae!==-1&&(le.timeoutHandle=-1,Sg(Ae)),ci!==null)for(Ae=ci.return;Ae!==null;){var Se=Ae;switch(rs(Se),Se.tag){case 1:Se=Se.type.childContextTypes,Se!=null&&Oa();break;case 3:Es(),Sr(Zi),Sr(Ii),To();break;case 5:wa(Se);break;case 4:Es();break;case 13:Sr(Zr);break;case 19:Sr(Zr);break;case 10:tl(Se.type._context);break;case 22:case 23:au()}Ae=Ae.return}if(Si=le,ci=le=Ta(le.current,null),Fi=wo=ue,Ai=0,jg=null,eu=xc=dl=0,po=Jg=null,ss!==null){for(ue=0;ue<ss.length;ue++)if(Ae=ss[ue],Se=Ae.interleaved,Se!==null){Ae.interleaved=null;var Fe=Se.next,Ye=Ae.pending;if(Ye!==null){var nt=Ye.next;Ye.next=Fe,Se.next=nt}Ae.pending=Se}ss=null}return le}function Vu(le,ue){do{var Ae=ci;try{if($s(),na.current=ng,So){for(var Se=Rr.memoizedState;Se!==null;){var Fe=Se.queue;Fe!==null&&(Fe.pending=null),Se=Se.next}So=!1}if(ls=0,pr=Yr=Rr=null,Gi=!1,_s=0,qc.current=null,Ae===null||Ae.return===null){Ai=1,jg=ue,ci=null;break}e:{var Ye=le,nt=Ae.return,Ct=Ae,bt=ue;if(ue=Fi,Ct.flags|=32768,bt!==null&&typeof bt=="object"&&typeof bt.then=="function"){var Yt=bt,cn=Ct,dn=cn.tag;if((cn.mode&1)===0&&(dn===0||dn===11||dn===15)){var ln=cn.alternate;ln?(cn.updateQueue=ln.updateQueue,cn.memoizedState=ln.memoizedState,cn.lanes=ln.lanes):(cn.updateQueue=null,cn.memoizedState=null)}var Sn=Rn(nt);if(Sn!==null){Sn.flags&=-257,$n(Sn,nt,Ct,Ye,ue),Sn.mode&1&&In(Ye,Yt,ue),ue=Sn,bt=Yt;var Mn=ue.updateQueue;if(Mn===null){var Fn=new Set;Fn.add(bt),ue.updateQueue=Fn}else Mn.add(bt);break e}else{if((ue&1)===0){In(Ye,Yt,ue),lu();break e}bt=Error(_(426))}}else if(xr&&Ct.mode&1){var qr=Rn(nt);if(qr!==null){(qr.flags&65536)===0&&(qr.flags|=256),$n(qr,nt,Ct,Ye,ue),Ga(we(bt,Ct));break e}}Ye=bt=we(bt,Ct),Ai!==4&&(Ai=2),Jg===null?Jg=[Ye]:Jg.push(Ye),Ye=nt;do{switch(Ye.tag){case 3:Ye.flags|=65536,ue&=-ue,Ye.lanes|=ue;var Tt=Gt(Ye,bt,ue);qs(Ye,Tt);break e;case 1:Ct=bt;var Bt=Ye.type,Lt=Ye.stateNode;if((Ye.flags&128)===0&&(typeof Bt.getDerivedStateFromError=="function"||Lt!==null&&typeof Lt.componentDidCatch=="function"&&(Ma===null||!Ma.has(Lt)))){Ye.flags|=65536,ue&=-ue,Ye.lanes|=ue;var fn=Qt(Ye,Ct,ue);qs(Ye,fn);break e}}Ye=Ye.return}while(Ye!==null)}Lu(Ae)}catch(Ln){ue=Ln,ci===Ae&&Ae!==null&&(ci=Ae=Ae.return);continue}break}while(!0)}function Tu(){var le=wc.current;return wc.current=ng,le===null?ng:le}function lu(){(Ai===0||Ai===3||Ai===2)&&(Ai=4),Si===null||(dl&268435455)===0&&(xc&268435455)===0||Va(Si,Fi)}function Fc(le,ue){var Ae=Cr;Cr|=2;var Se=Tu();(Si!==le||Fi!==ue)&&(sa=null,pl(le,ue));do try{od();break}catch(Fe){Vu(le,Fe)}while(!0);if($s(),Cr=Ae,wc.current=Se,ci!==null)throw Error(_(261));return Si=null,Fi=0,Ai}function od(){for(;ci!==null;)Nu(ci)}function sd(){for(;ci!==null&&!Jt();)Nu(ci)}function Nu(le){var ue=ku(le.alternate,le,wo);le.memoizedProps=le.pendingProps,ue===null?Lu(le):ci=ue,qc.current=null}function Lu(le){var ue=le;do{var Ae=ue.alternate;if(le=ue.return,(ue.flags&32768)===0){if(Ae=Ju(Ae,ue,wo),Ae!==null){ci=Ae;return}}else{if(Ae=Qu(Ae,ue),Ae!==null){Ae.flags&=32767,ci=Ae;return}if(le!==null)le.flags|=32768,le.subtreeFlags=0,le.deletions=null;else{Ai=6,ci=null;return}}if(ue=ue.sibling,ue!==null){ci=ue;return}ci=ue=le}while(ue!==null);Ai===0&&(Ai=5)}function Cl(le,ue,Ae){var Se=or,Fe=Lo.transition;try{Lo.transition=null,or=1,ad(le,ue,Ae,Se)}finally{Lo.transition=Fe,or=Se}return null}function ad(le,ue,Ae,Se){do ag();while(Wa!==null);if((Cr&6)!==0)throw Error(_(327));Ae=le.finishedWork;var Fe=le.finishedLanes;if(Ae===null)return null;if(le.finishedWork=null,le.finishedLanes=0,Ae===le.current)throw Error(_(177));le.callbackNode=null,le.callbackPriority=0;var Ye=Ae.lanes|Ae.childLanes;if(Ki(le,Ye),le===Si&&(ci=Si=null,Fi=0),(Ae.subtreeFlags&2064)===0&&(Ae.flags&2064)===0||Ec||(Ec=!0,Yu(xn,function(){return ag(),null})),Ye=(Ae.flags&15990)!==0,(Ae.subtreeFlags&15990)!==0||Ye){Ye=Lo.transition,Lo.transition=null;var nt=or;or=1;var Ct=Cr;Cr|=4,qc.current=null,qu(le,Ae),xu(Ae,le),si(vg),ni=!!ya,vg=ya=null,le.current=Ae,ed(Ae),qt(),Cr=Ct,or=nt,Lo.transition=Ye}else le.current=Ae;if(Ec&&(Ec=!1,Wa=le,_c=Fe),Ye=le.pendingLanes,Ye===0&&(Ma=null),Zn(Ae.stateNode),Co(le,yt()),ue!==null)for(Se=le.onRecoverableError,Ae=0;Ae<ue.length;Ae++)Fe=ue[Ae],Se(Fe.value,{componentStack:Fe.stack,digest:Fe.digest});if(Zc)throw Zc=!1,le=nu,nu=null,le;return(_c&1)!==0&&le.tag!==0&&ag(),Ye=le.pendingLanes,(Ye&1)!==0?le===ru?Qg++:(Qg=0,ru=le):Qg=0,Fo(),null}function ag(){if(Wa!==null){var le=xo(_c),ue=Lo.transition,Ae=or;try{if(Lo.transition=null,or=16>le?16:le,Wa===null)var Se=!1;else{if(le=Wa,Wa=null,_c=0,(Cr&6)!==0)throw Error(_(331));var Fe=Cr;for(Cr|=4,En=le.current;En!==null;){var Ye=En,nt=Ye.child;if((En.flags&16)!==0){var Ct=Ye.deletions;if(Ct!==null){for(var bt=0;bt<Ct.length;bt++){var Yt=Ct[bt];for(En=Yt;En!==null;){var cn=En;switch(cn.tag){case 0:case 11:case 15:Og(8,cn,Ye)}var dn=cn.child;if(dn!==null)dn.return=cn,En=dn;else for(;En!==null;){cn=En;var ln=cn.sibling,Sn=cn.return;if(Bu(cn),cn===Yt){En=null;break}if(ln!==null){ln.return=Sn,En=ln;break}En=Sn}}}var Mn=Ye.alternate;if(Mn!==null){var Fn=Mn.child;if(Fn!==null){Mn.child=null;do{var qr=Fn.sibling;Fn.sibling=null,Fn=qr}while(Fn!==null)}}En=Ye}}if((Ye.subtreeFlags&2064)!==0&&nt!==null)nt.return=Ye,En=nt;else e:for(;En!==null;){if(Ye=En,(Ye.flags&2048)!==0)switch(Ye.tag){case 0:case 11:case 15:Og(9,Ye,Ye.return)}var Tt=Ye.sibling;if(Tt!==null){Tt.return=Ye.return,En=Tt;break e}En=Ye.return}}var Bt=le.current;for(En=Bt;En!==null;){nt=En;var Lt=nt.child;if((nt.subtreeFlags&2064)!==0&&Lt!==null)Lt.return=nt,En=Lt;else e:for(nt=Bt;En!==null;){if(Ct=En,(Ct.flags&2048)!==0)try{switch(Ct.tag){case 0:case 11:case 15:Rc(9,Ct)}}catch(Ln){jr(Ct,Ct.return,Ln)}if(Ct===nt){En=null;break e}var fn=Ct.sibling;if(fn!==null){fn.return=Ct.return,En=fn;break e}En=Ct.return}}if(Cr=Fe,Fo(),_n&&typeof _n.onPostCommitFiberRoot=="function")try{_n.onPostCommitFiberRoot(bn,le)}catch{}Se=!0}return Se}finally{or=Ae,Lo.transition=ue}}return!1}function Hu(le,ue,Ae){ue=we(Ae,ue),ue=Gt(le,ue,1),le=Wr(le,ue,1),ue=no(),le!==null&&(wr(le,1,ue),Co(le,ue))}function jr(le,ue,Ae){if(le.tag===3)Hu(le,le,Ae);else for(;ue!==null;){if(ue.tag===3){Hu(ue,le,Ae);break}else if(ue.tag===1){var Se=ue.stateNode;if(typeof ue.type.getDerivedStateFromError=="function"||typeof Se.componentDidCatch=="function"&&(Ma===null||!Ma.has(Se))){le=we(Ae,le),le=Qt(ue,le,1),ue=Wr(ue,le,1),le=no(),ue!==null&&(wr(ue,1,le),Co(ue,le));break}}ue=ue.return}}function ld(le,ue,Ae){var Se=le.pingCache;Se!==null&&Se.delete(ue),ue=no(),le.pingedLanes|=le.suspendedLanes&Ae,Si===le&&(Fi&Ae)===Ae&&(Ai===4||Ai===3&&(Fi&130023424)===Fi&&500>yt()-tu?pl(le,0):eu|=Ae),Co(le,ue)}function Xu(le,ue){ue===0&&((le.mode&1)===0?ue=1:(ue=sr,sr<<=1,(sr&130023424)===0&&(sr=4194304)));var Ae=no();le=Bo(le,ue),le!==null&&(wr(le,ue,Ae),Co(le,Ae))}function gd(le){var ue=le.memoizedState,Ae=0;ue!==null&&(Ae=ue.retryLane),Xu(le,Ae)}function cd(le,ue){var Ae=0;switch(le.tag){case 13:var Se=le.stateNode,Fe=le.memoizedState;Fe!==null&&(Ae=Fe.retryLane);break;case 19:Se=le.stateNode;break;default:throw Error(_(314))}Se!==null&&Se.delete(ue),Xu(le,Ae)}var ku;ku=function(le,ue,Ae){if(le!==null)if(le.memoizedProps!==ue.pendingProps||Zi.current)ir=!0;else{if((le.lanes&Ae)===0&&(ue.flags&128)===0)return ir=!1,ju(le,ue,Ae);ir=(le.flags&131072)!==0}else ir=!1,xr&&(ue.flags&1048576)!==0&&Eg(ue,Ul,ue.index);switch(ue.lanes=0,ue.tag){case 2:var Se=ue.type;Gc(le,ue),le=ue.pendingProps;var Fe=Ds(ue,Ii.current);Zs(ue,Ae),Fe=sl(null,ue,Se,le,Fe,Ae);var Ye=Lg();return ue.flags|=1,typeof Fe=="object"&&Fe!==null&&typeof Fe.render=="function"&&Fe.$$typeof===void 0?(ue.tag=1,ue.memoizedState=null,ue.updateQueue=null,vi(Se)?(Ye=!0,Us(ue)):Ye=!1,ue.memoizedState=Fe.state!==null&&Fe.state!==void 0?Fe.state:null,nr(ue),Fe.updater=rg,ue.stateNode=Fe,Fe._reactInternals=ue,Ge(ue,Se,le,Ae),ue=er(null,ue,Se,!0,Ye,Ae)):(ue.tag=0,xr&&Ye&&_g(ue),Gn(null,ue,Fe,Ae),ue=ue.child),ue;case 16:Se=ue.elementType;e:{switch(Gc(le,ue),le=ue.pendingProps,Fe=Se._init,Se=Fe(Se._payload),ue.type=Se,Fe=ue.tag=dd(Se),le=Io(Se,le),Fe){case 0:ue=Bn(null,ue,Se,le,Ae);break e;case 1:ue=Vn(null,ue,Se,le,Ae);break e;case 11:ue=fi(null,ue,Se,le,Ae);break e;case 14:ue=eo(null,ue,Se,Io(Se.type,le),Ae);break e}throw Error(_(306,Se,""))}return ue;case 0:return Se=ue.type,Fe=ue.pendingProps,Fe=ue.elementType===Se?Fe:Io(Se,Fe),Bn(le,ue,Se,Fe,Ae);case 1:return Se=ue.type,Fe=ue.pendingProps,Fe=ue.elementType===Se?Fe:Io(Se,Fe),Vn(le,ue,Se,Fe,Ae);case 3:e:{if(qn(ue),le===null)throw Error(_(387));Se=ue.pendingProps,Ye=ue.memoizedState,Fe=Ye.element,Dr(le,ue),kr(ue,Se,null,Ae);var nt=ue.memoizedState;if(Se=nt.element,Ye.isDehydrated)if(Ye={element:Se,isDehydrated:!1,cache:nt.cache,pendingSuspenseBoundaries:nt.pendingSuspenseBoundaries,transitions:nt.transitions},ue.updateQueue.baseState=Ye,ue.memoizedState=Ye,ue.flags&256){Fe=we(Error(_(423)),ue),ue=ur(le,ue,Se,Ae,Fe);break e}else if(Se!==Fe){Fe=we(Error(_(424)),ue),ue=ur(le,ue,Se,Ae,Fe);break e}else for(_i=Jo(ue.stateNode.containerInfo.firstChild),pi=ue,xr=!0,uo=null,Ae=el(ue,null,Se,Ae),ue.child=Ae;Ae;)Ae.flags=Ae.flags&-3|4096,Ae=Ae.sibling;else{if(xs(),Se===Fe){ue=oa(le,ue,Ae);break e}Gn(le,ue,Se,Ae)}ue=ue.child}return ue;case 5:return ta(ue),le===null&&Ol(ue),Se=ue.type,Fe=ue.pendingProps,Ye=le!==null?le.memoizedProps:null,nt=Fe.children,Bg(Se,Fe)?nt=null:Ye!==null&&Bg(Se,Ye)&&(ue.flags|=32),Ut(le,ue),Gn(le,ue,nt,Ae),ue.child;case 6:return le===null&&Ol(ue),null;case 13:return us(le,ue,Ae);case 4:return il(ue,ue.stateNode.containerInfo),Se=ue.pendingProps,le===null?ue.child=js(ue,null,Se,Ae):Gn(le,ue,Se,Ae),ue.child;case 11:return Se=ue.type,Fe=ue.pendingProps,Fe=ue.elementType===Se?Fe:Io(Se,Fe),fi(le,ue,Se,Fe,Ae);case 7:return Gn(le,ue,ue.pendingProps,Ae),ue.child;case 8:return Gn(le,ue,ue.pendingProps.children,Ae),ue.child;case 12:return Gn(le,ue,ue.pendingProps.children,Ae),ue.child;case 10:e:{if(Se=ue.type._context,Fe=ue.pendingProps,Ye=ue.memoizedProps,nt=Fe.value,Br(Js,Se._currentValue),Se._currentValue=nt,Ye!==null)if(Pi(Ye.value,nt)){if(Ye.children===Fe.children&&!Zi.current){ue=oa(le,ue,Ae);break e}}else for(Ye=ue.child,Ye!==null&&(Ye.return=ue);Ye!==null;){var Ct=Ye.dependencies;if(Ct!==null){nt=Ye.child;for(var bt=Ct.firstContext;bt!==null;){if(bt.context===Se){if(Ye.tag===1){bt=mr(-1,Ae&-Ae),bt.tag=2;var Yt=Ye.updateQueue;if(Yt!==null){Yt=Yt.shared;var cn=Yt.pending;cn===null?bt.next=bt:(bt.next=cn.next,cn.next=bt),Yt.pending=bt}}Ye.lanes|=Ae,bt=Ye.alternate,bt!==null&&(bt.lanes|=Ae),nl(Ye.return,Ae,ue),Ct.lanes|=Ae;break}bt=bt.next}}else if(Ye.tag===10)nt=Ye.type===ue.type?null:Ye.child;else if(Ye.tag===18){if(nt=Ye.return,nt===null)throw Error(_(341));nt.lanes|=Ae,Ct=nt.alternate,Ct!==null&&(Ct.lanes|=Ae),nl(nt,Ae,ue),nt=Ye.sibling}else nt=Ye.child;if(nt!==null)nt.return=Ye;else for(nt=Ye;nt!==null;){if(nt===ue){nt=null;break}if(Ye=nt.sibling,Ye!==null){Ye.return=nt.return,nt=Ye;break}nt=nt.return}Ye=nt}Gn(le,ue,Fe.children,Ae),ue=ue.child}return ue;case 9:return Fe=ue.type,Se=ue.pendingProps.children,Zs(ue,Ae),Fe=Ji(Fe),Se=Se(Fe),ue.flags|=1,Gn(le,ue,Se,Ae),ue.child;case 14:return Se=ue.type,Fe=Io(Se,ue.pendingProps),Fe=Io(Se.type,Fe),eo(le,ue,Se,Fe,Ae);case 15:return kt(le,ue,ue.type,ue.pendingProps,Ae);case 17:return Se=ue.type,Fe=ue.pendingProps,Fe=ue.elementType===Se?Fe:Io(Se,Fe),Gc(le,ue),ue.tag=1,vi(Se)?(le=!0,Us(ue)):le=!1,Zs(ue,Ae),Ie(ue,Se,Fe),Ge(ue,Se,Fe,Ae),er(null,ue,Se,!0,le,Ae);case 19:return Au(le,ue,Ae);case 22:return xt(le,ue,Ae)}throw Error(_(156,ue.tag))};function Yu(le,ue){return Xt(le,ue)}function ud(le,ue,Ae,Se){this.tag=le,this.key=Ae,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=ue,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=Se,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Ho(le,ue,Ae,Se){return new ud(le,ue,Ae,Se)}function gu(le){return le=le.prototype,!(!le||!le.isReactComponent)}function dd(le){if(typeof le=="function")return gu(le)?1:0;if(le!=null){if(le=le.$$typeof,le===He)return 11;if(le===tt)return 14}return 2}function Ta(le,ue){var Ae=le.alternate;return Ae===null?(Ae=Ho(le.tag,ue,le.key,le.mode),Ae.elementType=le.elementType,Ae.type=le.type,Ae.stateNode=le.stateNode,Ae.alternate=le,le.alternate=Ae):(Ae.pendingProps=ue,Ae.type=le.type,Ae.flags=0,Ae.subtreeFlags=0,Ae.deletions=null),Ae.flags=le.flags&14680064,Ae.childLanes=le.childLanes,Ae.lanes=le.lanes,Ae.child=le.child,Ae.memoizedProps=le.memoizedProps,Ae.memoizedState=le.memoizedState,Ae.updateQueue=le.updateQueue,ue=le.dependencies,Ae.dependencies=ue===null?null:{lanes:ue.lanes,firstContext:ue.firstContext},Ae.sibling=le.sibling,Ae.index=le.index,Ae.ref=le.ref,Ae}function Vc(le,ue,Ae,Se,Fe,Ye){var nt=2;if(Se=le,typeof le=="function")gu(le)&&(nt=1);else if(typeof le=="string")nt=5;else e:switch(le){case Ze:return hl(Ae.children,Fe,Ye,ue);case Ve:nt=8,Fe|=8;break;case _e:return le=Ho(12,Ae,ue,Fe|2),le.elementType=_e,le.lanes=Ye,le;case Ke:return le=Ho(13,Ae,ue,Fe),le.elementType=Ke,le.lanes=Ye,le;case Ue:return le=Ho(19,Ae,ue,Fe),le.elementType=Ue,le.lanes=Ye,le;case at:return Tc(Ae,Fe,Ye,ue);default:if(typeof le=="object"&&le!==null)switch(le.$$typeof){case Xe:nt=10;break e;case Pe:nt=9;break e;case He:nt=11;break e;case tt:nt=14;break e;case rt:nt=16,Se=null;break e}throw Error(_(130,le==null?le:typeof le,""))}return ue=Ho(nt,Ae,ue,Fe),ue.elementType=le,ue.type=Se,ue.lanes=Ye,ue}function hl(le,ue,Ae,Se){return le=Ho(7,le,Se,ue),le.lanes=Ae,le}function Tc(le,ue,Ae,Se){return le=Ho(22,le,Se,ue),le.elementType=at,le.lanes=Ae,le.stateNode={isHidden:!1},le}function cu(le,ue,Ae){return le=Ho(6,le,null,ue),le.lanes=Ae,le}function uu(le,ue,Ae){return ue=Ho(4,le.children!==null?le.children:[],le.key,ue),ue.lanes=Ae,ue.stateNode={containerInfo:le.containerInfo,pendingChildren:null,implementation:le.implementation},ue}function Id(le,ue,Ae,Se,Fe){this.tag=ue,this.containerInfo=le,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=mi(0),this.expirationTimes=mi(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=mi(0),this.identifierPrefix=Se,this.onRecoverableError=Fe,this.mutableSourceEagerHydrationData=null}function du(le,ue,Ae,Se,Fe,Ye,nt,Ct,bt){return le=new Id(le,ue,Ae,Ct,bt),ue===1?(ue=1,Ye===!0&&(ue|=8)):ue=0,Ye=Ho(3,null,null,ue),le.current=Ye,Ye.stateNode=le,Ye.memoizedState={element:Se,isDehydrated:Ae,cache:null,transitions:null,pendingSuspenseBoundaries:null},nr(Ye),le}function pd(le,ue,Ae){var Se=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:We,key:Se==null?null:""+Se,children:le,containerInfo:ue,implementation:Ae}}function Ku(le){if(!le)return $o;le=le._reactInternals;e:{if(ke(le)!==le||le.tag!==1)throw Error(_(170));var ue=le;do{switch(ue.tag){case 3:ue=ue.stateNode.context;break e;case 1:if(vi(ue.type)){ue=ue.stateNode.__reactInternalMemoizedMergedChildContext;break e}}ue=ue.return}while(ue!==null);throw Error(_(171))}if(le.tag===1){var Ae=le.type;if(vi(Ae))return ja(le,Ae,ue)}return ue}function zu(le,ue,Ae,Se,Fe,Ye,nt,Ct,bt){return le=du(Ae,Se,!0,le,Fe,Ye,nt,Ct,bt),le.context=Ku(null),Ae=le.current,Se=no(),Fe=Fa(Ae),Ye=mr(Se,Fe),Ye.callback=ue??null,Wr(Ae,Ye,Fe),le.current.lanes=Fe,wr(le,Fe,Se),Co(le,Se),le}function Nc(le,ue,Ae,Se){var Fe=ue.current,Ye=no(),nt=Fa(Fe);return Ae=Ku(Ae),ue.context===null?ue.context=Ae:ue.pendingContext=Ae,ue=mr(Ye,nt),ue.payload={element:le},Se=Se===void 0?null:Se,Se!==null&&(ue.callback=Se),le=Wr(Fe,ue,nt),le!==null&&(ps(le,Fe,nt,Ye),Bi(le,Fe,nt)),nt}function Lc(le){if(le=le.current,!le.child)return null;switch(le.child.tag){case 5:return le.child.stateNode;default:return le.child.stateNode}}function Du(le,ue){if(le=le.memoizedState,le!==null&&le.dehydrated!==null){var Ae=le.retryLane;le.retryLane=Ae!==0&&Ae<ue?Ae:ue}}function Iu(le,ue){Du(le,ue),(le=le.alternate)&&Du(le,ue)}var Uu=typeof reportError=="function"?reportError:function(le){console.error(le)};function pu(le){this._internalRoot=le}Hc.prototype.render=pu.prototype.render=function(le){var ue=this._internalRoot;if(ue===null)throw Error(_(409));Nc(le,ue,null,null)},Hc.prototype.unmount=pu.prototype.unmount=function(){var le=this._internalRoot;if(le!==null){this._internalRoot=null;var ue=le.containerInfo;Il(function(){Nc(null,le,null,null)}),ue[ji]=null}};function Hc(le){this._internalRoot=le}Hc.prototype.unstable_scheduleHydration=function(le){if(le){var ue=Zo();le={blockedOn:null,target:le,priority:ue};for(var Ae=0;Ae<oo.length&&ue!==0&&ue<oo[Ae].priority;Ae++);oo.splice(Ae,0,le),Ae===0&&bi(le)}};function Cu(le){return!(!le||le.nodeType!==1&&le.nodeType!==9&&le.nodeType!==11)}function Xc(le){return!(!le||le.nodeType!==1&&le.nodeType!==9&&le.nodeType!==11&&(le.nodeType!==8||le.nodeValue!==" react-mount-point-unstable "))}function Pu(){}function Cd(le,ue,Ae,Se,Fe){if(Fe){if(typeof Se=="function"){var Ye=Se;Se=function(){var Yt=Lc(nt);Ye.call(Yt)}}var nt=zu(ue,Se,le,0,null,!1,!1,"",Pu);return le._reactRootContainer=nt,le[ji]=nt.current,ma(le.nodeType===8?le.parentNode:le),Il(),nt}for(;Fe=le.lastChild;)le.removeChild(Fe);if(typeof Se=="function"){var Ct=Se;Se=function(){var Yt=Lc(bt);Ct.call(Yt)}}var bt=du(le,0,!1,null,null,!1,!1,"",Pu);return le._reactRootContainer=bt,le[ji]=bt.current,ma(le.nodeType===8?le.parentNode:le),Il(function(){Nc(ue,bt,Ae,Se)}),bt}function kc(le,ue,Ae,Se,Fe){var Ye=Ae._reactRootContainer;if(Ye){var nt=Ye;if(typeof Fe=="function"){var Ct=Fe;Fe=function(){var bt=Lc(nt);Ct.call(bt)}}Nc(ue,nt,le,Fe)}else nt=Cd(Ae,ue,le,Fe,Se);return Lc(nt)}Cs=function(le){switch(le.tag){case 3:var ue=le.stateNode;if(ue.current.memoizedState.isDehydrated){var Ae=Ir(ue.pendingLanes);Ae!==0&&(ho(ue,Ae|1),Co(ue,yt()),(Cr&6)===0&&(sg=yt()+500,Fo()))}break;case 13:Il(function(){var Se=Bo(le,1);if(Se!==null){var Fe=no();ps(Se,le,1,Fe)}}),Iu(le,1)}},aa=function(le){if(le.tag===13){var ue=Bo(le,134217728);if(ue!==null){var Ae=no();ps(ue,le,134217728,Ae)}Iu(le,134217728)}},la=function(le){if(le.tag===13){var ue=Fa(le),Ae=Bo(le,ue);if(Ae!==null){var Se=no();ps(Ae,le,ue,Se)}Iu(le,ue)}},Zo=function(){return or},Ws=function(le,ue){var Ae=or;try{return or=le,ue()}finally{or=Ae}},vt=function(le,ue,Ae){switch(ue){case"input":if(jt(le,Ae),ue=Ae.name,Ae.type==="radio"&&ue!=null){for(Ae=le;Ae.parentNode;)Ae=Ae.parentNode;for(Ae=Ae.querySelectorAll("input[name="+JSON.stringify(""+ue)+'][type="radio"]'),ue=0;ue<Ae.length;ue++){var Se=Ae[ue];if(Se!==le&&Se.form===le.form){var Fe=Kl(Se);if(!Fe)throw Error(_(90));st(Se),jt(Se,Fe)}}}break;case"textarea":Je(le,Ae);break;case"select":ue=Ae.value,ue!=null&&Mt(le,!!Ae.multiple,ue,!1)}},On=su,Tn=Il;var hd={usingClientEntryPoint:!1,Events:[Qo,zr,Kl,vn,zn,su]},$g={findFiberByHostInstance:ws,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},Ad={bundleType:$g.bundleType,version:$g.version,rendererPackageName:$g.rendererPackageName,rendererConfig:$g.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Re.ReactCurrentDispatcher,findHostInstanceByFiber:function(le){return le=It(le),le===null?null:le.stateNode},findFiberByHostInstance:$g.findFiberByHostInstance,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Yc=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Yc.isDisabled&&Yc.supportsFiber)try{bn=Yc.inject(Ad),_n=Yc}catch{}}return reactDom_production_min.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=hd,reactDom_production_min.createPortal=function(le,ue){var Ae=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Cu(ue))throw Error(_(200));return pd(le,ue,null,Ae)},reactDom_production_min.createRoot=function(le,ue){if(!Cu(le))throw Error(_(299));var Ae=!1,Se="",Fe=Uu;return ue!=null&&(ue.unstable_strictMode===!0&&(Ae=!0),ue.identifierPrefix!==void 0&&(Se=ue.identifierPrefix),ue.onRecoverableError!==void 0&&(Fe=ue.onRecoverableError)),ue=du(le,1,!1,null,null,Ae,!1,Se,Fe),le[ji]=ue.current,ma(le.nodeType===8?le.parentNode:le),new pu(ue)},reactDom_production_min.findDOMNode=function(le){if(le==null)return null;if(le.nodeType===1)return le;var ue=le._reactInternals;if(ue===void 0)throw typeof le.render=="function"?Error(_(188)):(le=Object.keys(le).join(","),Error(_(268,le)));return le=It(ue),le=le===null?null:le.stateNode,le},reactDom_production_min.flushSync=function(le){return Il(le)},reactDom_production_min.hydrate=function(le,ue,Ae){if(!Xc(ue))throw Error(_(200));return kc(null,le,ue,!0,Ae)},reactDom_production_min.hydrateRoot=function(le,ue,Ae){if(!Cu(le))throw Error(_(405));var Se=Ae!=null&&Ae.hydratedSources||null,Fe=!1,Ye="",nt=Uu;if(Ae!=null&&(Ae.unstable_strictMode===!0&&(Fe=!0),Ae.identifierPrefix!==void 0&&(Ye=Ae.identifierPrefix),Ae.onRecoverableError!==void 0&&(nt=Ae.onRecoverableError)),ue=zu(ue,null,le,1,Ae??null,Fe,!1,Ye,nt),le[ji]=ue.current,ma(le),Se)for(le=0;le<Se.length;le++)Ae=Se[le],Fe=Ae._getVersion,Fe=Fe(Ae._source),ue.mutableSourceEagerHydrationData==null?ue.mutableSourceEagerHydrationData=[Ae,Fe]:ue.mutableSourceEagerHydrationData.push(Ae,Fe);return new Hc(ue)},reactDom_production_min.render=function(le,ue,Ae){if(!Xc(ue))throw Error(_(200));return kc(null,le,ue,!1,Ae)},reactDom_production_min.unmountComponentAtNode=function(le){if(!Xc(le))throw Error(_(40));return le._reactRootContainer?(Il(function(){kc(null,null,le,!1,function(){le._reactRootContainer=null,le[ji]=null})}),!0):!1},reactDom_production_min.unstable_batchedUpdates=su,reactDom_production_min.unstable_renderSubtreeIntoContainer=function(le,ue,Ae,Se){if(!Xc(Ae))throw Error(_(200));if(le==null||le._reactInternals===void 0)throw Error(_(38));return kc(le,ue,Ae,!1,Se)},reactDom_production_min.version="18.3.1-next-f1338f8080-20240426",reactDom_production_min}var hasRequiredReactDom;function requireReactDom(){if(hasRequiredReactDom)return reactDom.exports;hasRequiredReactDom=1;function X(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(X)}catch(Z){console.error(Z)}}return X(),reactDom.exports=requireReactDom_production_min(),reactDom.exports}var hasRequiredClient;function requireClient(){if(hasRequiredClient)return client;hasRequiredClient=1;var X=requireReactDom();return client.createRoot=X.createRoot,client.hydrateRoot=X.hydrateRoot,client}var clientExports=requireClient();const ReactDOM=getDefaultExportFromCjs(clientExports);/**
 * @license
 * Copyright 2010-2023 Three.js Authors
 * SPDX-License-Identifier: MIT
 */const REVISION="154",MOUSE={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},TOUCH={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},CullFaceNone=0,CullFaceBack=1,CullFaceFront=2,CullFaceFrontBack=3,BasicShadowMap=0,PCFShadowMap=1,PCFSoftShadowMap=2,VSMShadowMap=3,FrontSide=0,BackSide=1,DoubleSide=2,TwoPassDoubleSide=2,NoBlending=0,NormalBlending=1,AdditiveBlending=2,SubtractiveBlending=3,MultiplyBlending=4,CustomBlending=5,AddEquation=100,SubtractEquation=101,ReverseSubtractEquation=102,MinEquation=103,MaxEquation=104,ZeroFactor=200,OneFactor=201,SrcColorFactor=202,OneMinusSrcColorFactor=203,SrcAlphaFactor=204,OneMinusSrcAlphaFactor=205,DstAlphaFactor=206,OneMinusDstAlphaFactor=207,DstColorFactor=208,OneMinusDstColorFactor=209,SrcAlphaSaturateFactor=210,NeverDepth=0,AlwaysDepth=1,LessDepth=2,LessEqualDepth=3,EqualDepth=4,GreaterEqualDepth=5,GreaterDepth=6,NotEqualDepth=7,MultiplyOperation=0,MixOperation=1,AddOperation=2,NoToneMapping=0,LinearToneMapping=1,ReinhardToneMapping=2,CineonToneMapping=3,ACESFilmicToneMapping=4,CustomToneMapping=5,UVMapping=300,CubeReflectionMapping=301,CubeRefractionMapping=302,EquirectangularReflectionMapping=303,EquirectangularRefractionMapping=304,CubeUVReflectionMapping=306,RepeatWrapping=1e3,ClampToEdgeWrapping=1001,MirroredRepeatWrapping=1002,NearestFilter=1003,NearestMipmapNearestFilter=1004,NearestMipMapNearestFilter=1004,NearestMipmapLinearFilter=1005,NearestMipMapLinearFilter=1005,LinearFilter=1006,LinearMipmapNearestFilter=1007,LinearMipMapNearestFilter=1007,LinearMipmapLinearFilter=1008,LinearMipMapLinearFilter=1008,UnsignedByteType=1009,ByteType=1010,ShortType=1011,UnsignedShortType=1012,IntType=1013,UnsignedIntType=1014,FloatType=1015,HalfFloatType=1016,UnsignedShort4444Type=1017,UnsignedShort5551Type=1018,UnsignedInt248Type=1020,AlphaFormat=1021,RGBAFormat=1023,LuminanceFormat=1024,LuminanceAlphaFormat=1025,DepthFormat=1026,DepthStencilFormat=1027,RedFormat=1028,RedIntegerFormat=1029,RGFormat=1030,RGIntegerFormat=1031,RGBAIntegerFormat=1033,RGB_S3TC_DXT1_Format=33776,RGBA_S3TC_DXT1_Format=33777,RGBA_S3TC_DXT3_Format=33778,RGBA_S3TC_DXT5_Format=33779,RGB_PVRTC_4BPPV1_Format=35840,RGB_PVRTC_2BPPV1_Format=35841,RGBA_PVRTC_4BPPV1_Format=35842,RGBA_PVRTC_2BPPV1_Format=35843,RGB_ETC1_Format=36196,RGB_ETC2_Format=37492,RGBA_ETC2_EAC_Format=37496,RGBA_ASTC_4x4_Format=37808,RGBA_ASTC_5x4_Format=37809,RGBA_ASTC_5x5_Format=37810,RGBA_ASTC_6x5_Format=37811,RGBA_ASTC_6x6_Format=37812,RGBA_ASTC_8x5_Format=37813,RGBA_ASTC_8x6_Format=37814,RGBA_ASTC_8x8_Format=37815,RGBA_ASTC_10x5_Format=37816,RGBA_ASTC_10x6_Format=37817,RGBA_ASTC_10x8_Format=37818,RGBA_ASTC_10x10_Format=37819,RGBA_ASTC_12x10_Format=37820,RGBA_ASTC_12x12_Format=37821,RGBA_BPTC_Format=36492,RED_RGTC1_Format=36283,SIGNED_RED_RGTC1_Format=36284,RED_GREEN_RGTC2_Format=36285,SIGNED_RED_GREEN_RGTC2_Format=36286,LoopOnce=2200,LoopRepeat=2201,LoopPingPong=2202,InterpolateDiscrete=2300,InterpolateLinear=2301,InterpolateSmooth=2302,ZeroCurvatureEnding=2400,ZeroSlopeEnding=2401,WrapAroundEnding=2402,NormalAnimationBlendMode=2500,AdditiveAnimationBlendMode=2501,TrianglesDrawMode=0,TriangleStripDrawMode=1,TriangleFanDrawMode=2,LinearEncoding$2=3e3,sRGBEncoding$2=3001,BasicDepthPacking=3200,RGBADepthPacking=3201,TangentSpaceNormalMap=0,ObjectSpaceNormalMap=1,NoColorSpace="",SRGBColorSpace$1="srgb",LinearSRGBColorSpace$1="srgb-linear",DisplayP3ColorSpace="display-p3",ZeroStencilOp=0,KeepStencilOp=7680,ReplaceStencilOp=7681,IncrementStencilOp=7682,DecrementStencilOp=7683,IncrementWrapStencilOp=34055,DecrementWrapStencilOp=34056,InvertStencilOp=5386,NeverStencilFunc=512,LessStencilFunc=513,EqualStencilFunc=514,LessEqualStencilFunc=515,GreaterStencilFunc=516,NotEqualStencilFunc=517,GreaterEqualStencilFunc=518,AlwaysStencilFunc=519,NeverCompare=512,LessCompare=513,EqualCompare=514,LessEqualCompare=515,GreaterCompare=516,NotEqualCompare=517,GreaterEqualCompare=518,AlwaysCompare=519,StaticDrawUsage=35044,DynamicDrawUsage=35048,StreamDrawUsage=35040,StaticReadUsage=35045,DynamicReadUsage=35049,StreamReadUsage=35041,StaticCopyUsage=35046,DynamicCopyUsage=35050,StreamCopyUsage=35042,GLSL1="100",GLSL3="300 es",_SRGBAFormat=1035,WebGLCoordinateSystem=2e3,WebGPUCoordinateSystem=2001;class EventDispatcher{addEventListener(Z,_){this._listeners===void 0&&(this._listeners={});const K=this._listeners;K[Z]===void 0&&(K[Z]=[]),K[Z].indexOf(_)===-1&&K[Z].push(_)}hasEventListener(Z,_){if(this._listeners===void 0)return!1;const K=this._listeners;return K[Z]!==void 0&&K[Z].indexOf(_)!==-1}removeEventListener(Z,_){if(this._listeners===void 0)return;const te=this._listeners[Z];if(te!==void 0){const ne=te.indexOf(_);ne!==-1&&te.splice(ne,1)}}dispatchEvent(Z){if(this._listeners===void 0)return;const K=this._listeners[Z.type];if(K!==void 0){Z.target=this;const te=K.slice(0);for(let ne=0,oe=te.length;ne<oe;ne++)te[ne].call(this,Z);Z.target=null}}}const _lut$1=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let _seed=1234567;const DEG2RAD=Math.PI/180,RAD2DEG=180/Math.PI;function generateUUID$1(){const X=Math.random()*4294967295|0,Z=Math.random()*4294967295|0,_=Math.random()*4294967295|0,K=Math.random()*4294967295|0;return(_lut$1[X&255]+_lut$1[X>>8&255]+_lut$1[X>>16&255]+_lut$1[X>>24&255]+"-"+_lut$1[Z&255]+_lut$1[Z>>8&255]+"-"+_lut$1[Z>>16&15|64]+_lut$1[Z>>24&255]+"-"+_lut$1[_&63|128]+_lut$1[_>>8&255]+"-"+_lut$1[_>>16&255]+_lut$1[_>>24&255]+_lut$1[K&255]+_lut$1[K>>8&255]+_lut$1[K>>16&255]+_lut$1[K>>24&255]).toLowerCase()}function clamp$3(X,Z,_){return Math.max(Z,Math.min(_,X))}function euclideanModulo(X,Z){return(X%Z+Z)%Z}function mapLinear(X,Z,_,K,te){return K+(X-Z)*(te-K)/(_-Z)}function inverseLerp(X,Z,_){return X!==Z?(_-X)/(Z-X):0}function lerp(X,Z,_){return(1-_)*X+_*Z}function damp(X,Z,_,K){return lerp(X,Z,1-Math.exp(-_*K))}function pingpong(X,Z=1){return Z-Math.abs(euclideanModulo(X,Z*2)-Z)}function smoothstep(X,Z,_){return X<=Z?0:X>=_?1:(X=(X-Z)/(_-Z),X*X*(3-2*X))}function smootherstep(X,Z,_){return X<=Z?0:X>=_?1:(X=(X-Z)/(_-Z),X*X*X*(X*(X*6-15)+10))}function randInt(X,Z){return X+Math.floor(Math.random()*(Z-X+1))}function randFloat(X,Z){return X+Math.random()*(Z-X)}function randFloatSpread(X){return X*(.5-Math.random())}function seededRandom(X){X!==void 0&&(_seed=X);let Z=_seed+=1831565813;return Z=Math.imul(Z^Z>>>15,Z|1),Z^=Z+Math.imul(Z^Z>>>7,Z|61),((Z^Z>>>14)>>>0)/4294967296}function degToRad(X){return X*DEG2RAD}function radToDeg(X){return X*RAD2DEG}function isPowerOfTwo(X){return(X&X-1)===0&&X!==0}function ceilPowerOfTwo(X){return Math.pow(2,Math.ceil(Math.log(X)/Math.LN2))}function floorPowerOfTwo(X){return Math.pow(2,Math.floor(Math.log(X)/Math.LN2))}function setQuaternionFromProperEuler(X,Z,_,K,te){const ne=Math.cos,oe=Math.sin,ie=ne(_/2),se=oe(_/2),ae=ne((Z+K)/2),ge=oe((Z+K)/2),ce=ne((Z-K)/2),de=oe((Z-K)/2),pe=ne((K-Z)/2),fe=oe((K-Z)/2);switch(te){case"XYX":X.set(ie*ge,se*ce,se*de,ie*ae);break;case"YZY":X.set(se*de,ie*ge,se*ce,ie*ae);break;case"ZXZ":X.set(se*ce,se*de,ie*ge,ie*ae);break;case"XZX":X.set(ie*ge,se*fe,se*pe,ie*ae);break;case"YXY":X.set(se*pe,ie*ge,se*fe,ie*ae);break;case"ZYZ":X.set(se*fe,se*pe,ie*ge,ie*ae);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+te)}}function denormalize(X,Z){switch(Z.constructor){case Float32Array:return X;case Uint32Array:return X/4294967295;case Uint16Array:return X/65535;case Uint8Array:return X/255;case Int32Array:return Math.max(X/2147483647,-1);case Int16Array:return Math.max(X/32767,-1);case Int8Array:return Math.max(X/127,-1);default:throw new Error("Invalid component type.")}}function normalize$5(X,Z){switch(Z.constructor){case Float32Array:return X;case Uint32Array:return Math.round(X*4294967295);case Uint16Array:return Math.round(X*65535);case Uint8Array:return Math.round(X*255);case Int32Array:return Math.round(X*2147483647);case Int16Array:return Math.round(X*32767);case Int8Array:return Math.round(X*127);default:throw new Error("Invalid component type.")}}const MathUtils={DEG2RAD,RAD2DEG,generateUUID:generateUUID$1,clamp:clamp$3,euclideanModulo,mapLinear,inverseLerp,lerp,damp,pingpong,smoothstep,smootherstep,randInt,randFloat,randFloatSpread,seededRandom,degToRad,radToDeg,isPowerOfTwo,ceilPowerOfTwo,floorPowerOfTwo,setQuaternionFromProperEuler,normalize:normalize$5,denormalize};class Vector2{constructor(Z=0,_=0){Vector2.prototype.isVector2=!0,this.x=Z,this.y=_}get width(){return this.x}set width(Z){this.x=Z}get height(){return this.y}set height(Z){this.y=Z}set(Z,_){return this.x=Z,this.y=_,this}setScalar(Z){return this.x=Z,this.y=Z,this}setX(Z){return this.x=Z,this}setY(Z){return this.y=Z,this}setComponent(Z,_){switch(Z){case 0:this.x=_;break;case 1:this.y=_;break;default:throw new Error("index is out of range: "+Z)}return this}getComponent(Z){switch(Z){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+Z)}}clone(){return new this.constructor(this.x,this.y)}copy(Z){return this.x=Z.x,this.y=Z.y,this}add(Z){return this.x+=Z.x,this.y+=Z.y,this}addScalar(Z){return this.x+=Z,this.y+=Z,this}addVectors(Z,_){return this.x=Z.x+_.x,this.y=Z.y+_.y,this}addScaledVector(Z,_){return this.x+=Z.x*_,this.y+=Z.y*_,this}sub(Z){return this.x-=Z.x,this.y-=Z.y,this}subScalar(Z){return this.x-=Z,this.y-=Z,this}subVectors(Z,_){return this.x=Z.x-_.x,this.y=Z.y-_.y,this}multiply(Z){return this.x*=Z.x,this.y*=Z.y,this}multiplyScalar(Z){return this.x*=Z,this.y*=Z,this}divide(Z){return this.x/=Z.x,this.y/=Z.y,this}divideScalar(Z){return this.multiplyScalar(1/Z)}applyMatrix3(Z){const _=this.x,K=this.y,te=Z.elements;return this.x=te[0]*_+te[3]*K+te[6],this.y=te[1]*_+te[4]*K+te[7],this}min(Z){return this.x=Math.min(this.x,Z.x),this.y=Math.min(this.y,Z.y),this}max(Z){return this.x=Math.max(this.x,Z.x),this.y=Math.max(this.y,Z.y),this}clamp(Z,_){return this.x=Math.max(Z.x,Math.min(_.x,this.x)),this.y=Math.max(Z.y,Math.min(_.y,this.y)),this}clampScalar(Z,_){return this.x=Math.max(Z,Math.min(_,this.x)),this.y=Math.max(Z,Math.min(_,this.y)),this}clampLength(Z,_){const K=this.length();return this.divideScalar(K||1).multiplyScalar(Math.max(Z,Math.min(_,K)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(Z){return this.x*Z.x+this.y*Z.y}cross(Z){return this.x*Z.y-this.y*Z.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(Z){const _=Math.sqrt(this.lengthSq()*Z.lengthSq());if(_===0)return Math.PI/2;const K=this.dot(Z)/_;return Math.acos(clamp$3(K,-1,1))}distanceTo(Z){return Math.sqrt(this.distanceToSquared(Z))}distanceToSquared(Z){const _=this.x-Z.x,K=this.y-Z.y;return _*_+K*K}manhattanDistanceTo(Z){return Math.abs(this.x-Z.x)+Math.abs(this.y-Z.y)}setLength(Z){return this.normalize().multiplyScalar(Z)}lerp(Z,_){return this.x+=(Z.x-this.x)*_,this.y+=(Z.y-this.y)*_,this}lerpVectors(Z,_,K){return this.x=Z.x+(_.x-Z.x)*K,this.y=Z.y+(_.y-Z.y)*K,this}equals(Z){return Z.x===this.x&&Z.y===this.y}fromArray(Z,_=0){return this.x=Z[_],this.y=Z[_+1],this}toArray(Z=[],_=0){return Z[_]=this.x,Z[_+1]=this.y,Z}fromBufferAttribute(Z,_){return this.x=Z.getX(_),this.y=Z.getY(_),this}rotateAround(Z,_){const K=Math.cos(_),te=Math.sin(_),ne=this.x-Z.x,oe=this.y-Z.y;return this.x=ne*K-oe*te+Z.x,this.y=ne*te+oe*K+Z.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class Matrix3{constructor(Z,_,K,te,ne,oe,ie,se,ae){Matrix3.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],Z!==void 0&&this.set(Z,_,K,te,ne,oe,ie,se,ae)}set(Z,_,K,te,ne,oe,ie,se,ae){const ge=this.elements;return ge[0]=Z,ge[1]=te,ge[2]=ie,ge[3]=_,ge[4]=ne,ge[5]=se,ge[6]=K,ge[7]=oe,ge[8]=ae,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(Z){const _=this.elements,K=Z.elements;return _[0]=K[0],_[1]=K[1],_[2]=K[2],_[3]=K[3],_[4]=K[4],_[5]=K[5],_[6]=K[6],_[7]=K[7],_[8]=K[8],this}extractBasis(Z,_,K){return Z.setFromMatrix3Column(this,0),_.setFromMatrix3Column(this,1),K.setFromMatrix3Column(this,2),this}setFromMatrix4(Z){const _=Z.elements;return this.set(_[0],_[4],_[8],_[1],_[5],_[9],_[2],_[6],_[10]),this}multiply(Z){return this.multiplyMatrices(this,Z)}premultiply(Z){return this.multiplyMatrices(Z,this)}multiplyMatrices(Z,_){const K=Z.elements,te=_.elements,ne=this.elements,oe=K[0],ie=K[3],se=K[6],ae=K[1],ge=K[4],ce=K[7],de=K[2],pe=K[5],fe=K[8],be=te[0],me=te[3],ye=te[6],ve=te[1],Be=te[4],Re=te[7],Ee=te[2],We=te[5],Ze=te[8];return ne[0]=oe*be+ie*ve+se*Ee,ne[3]=oe*me+ie*Be+se*We,ne[6]=oe*ye+ie*Re+se*Ze,ne[1]=ae*be+ge*ve+ce*Ee,ne[4]=ae*me+ge*Be+ce*We,ne[7]=ae*ye+ge*Re+ce*Ze,ne[2]=de*be+pe*ve+fe*Ee,ne[5]=de*me+pe*Be+fe*We,ne[8]=de*ye+pe*Re+fe*Ze,this}multiplyScalar(Z){const _=this.elements;return _[0]*=Z,_[3]*=Z,_[6]*=Z,_[1]*=Z,_[4]*=Z,_[7]*=Z,_[2]*=Z,_[5]*=Z,_[8]*=Z,this}determinant(){const Z=this.elements,_=Z[0],K=Z[1],te=Z[2],ne=Z[3],oe=Z[4],ie=Z[5],se=Z[6],ae=Z[7],ge=Z[8];return _*oe*ge-_*ie*ae-K*ne*ge+K*ie*se+te*ne*ae-te*oe*se}invert(){const Z=this.elements,_=Z[0],K=Z[1],te=Z[2],ne=Z[3],oe=Z[4],ie=Z[5],se=Z[6],ae=Z[7],ge=Z[8],ce=ge*oe-ie*ae,de=ie*se-ge*ne,pe=ae*ne-oe*se,fe=_*ce+K*de+te*pe;if(fe===0)return this.set(0,0,0,0,0,0,0,0,0);const be=1/fe;return Z[0]=ce*be,Z[1]=(te*ae-ge*K)*be,Z[2]=(ie*K-te*oe)*be,Z[3]=de*be,Z[4]=(ge*_-te*se)*be,Z[5]=(te*ne-ie*_)*be,Z[6]=pe*be,Z[7]=(K*se-ae*_)*be,Z[8]=(oe*_-K*ne)*be,this}transpose(){let Z;const _=this.elements;return Z=_[1],_[1]=_[3],_[3]=Z,Z=_[2],_[2]=_[6],_[6]=Z,Z=_[5],_[5]=_[7],_[7]=Z,this}getNormalMatrix(Z){return this.setFromMatrix4(Z).invert().transpose()}transposeIntoArray(Z){const _=this.elements;return Z[0]=_[0],Z[1]=_[3],Z[2]=_[6],Z[3]=_[1],Z[4]=_[4],Z[5]=_[7],Z[6]=_[2],Z[7]=_[5],Z[8]=_[8],this}setUvTransform(Z,_,K,te,ne,oe,ie){const se=Math.cos(ne),ae=Math.sin(ne);return this.set(K*se,K*ae,-K*(se*oe+ae*ie)+oe+Z,-te*ae,te*se,-te*(-ae*oe+se*ie)+ie+_,0,0,1),this}scale(Z,_){return this.premultiply(_m3.makeScale(Z,_)),this}rotate(Z){return this.premultiply(_m3.makeRotation(-Z)),this}translate(Z,_){return this.premultiply(_m3.makeTranslation(Z,_)),this}makeTranslation(Z,_){return Z.isVector2?this.set(1,0,Z.x,0,1,Z.y,0,0,1):this.set(1,0,Z,0,1,_,0,0,1),this}makeRotation(Z){const _=Math.cos(Z),K=Math.sin(Z);return this.set(_,-K,0,K,_,0,0,0,1),this}makeScale(Z,_){return this.set(Z,0,0,0,_,0,0,0,1),this}equals(Z){const _=this.elements,K=Z.elements;for(let te=0;te<9;te++)if(_[te]!==K[te])return!1;return!0}fromArray(Z,_=0){for(let K=0;K<9;K++)this.elements[K]=Z[K+_];return this}toArray(Z=[],_=0){const K=this.elements;return Z[_]=K[0],Z[_+1]=K[1],Z[_+2]=K[2],Z[_+3]=K[3],Z[_+4]=K[4],Z[_+5]=K[5],Z[_+6]=K[6],Z[_+7]=K[7],Z[_+8]=K[8],Z}clone(){return new this.constructor().fromArray(this.elements)}}const _m3=new Matrix3;function arrayNeedsUint32(X){for(let Z=X.length-1;Z>=0;--Z)if(X[Z]>=65535)return!0;return!1}const TYPED_ARRAYS={Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array};function getTypedArray(X,Z){return new TYPED_ARRAYS[X](Z)}function createElementNS(X){return document.createElementNS("http://www.w3.org/1999/xhtml",X)}const _cache={};function warnOnce(X){X in _cache||(_cache[X]=!0,console.warn(X))}function SRGBToLinear(X){return X<.04045?X*.0773993808:Math.pow(X*.9478672986+.0521327014,2.4)}function LinearToSRGB(X){return X<.0031308?X*12.92:1.055*Math.pow(X,.41666)-.055}const LINEAR_SRGB_TO_LINEAR_DISPLAY_P3=new Matrix3().fromArray([.8224621,.0331941,.0170827,.177538,.9668058,.0723974,-1e-7,1e-7,.9105199]),LINEAR_DISPLAY_P3_TO_LINEAR_SRGB=new Matrix3().fromArray([1.2249401,-.0420569,-.0196376,-.2249404,1.0420571,-.0786361,1e-7,0,1.0982735]);function DisplayP3ToLinearSRGB(X){return X.convertSRGBToLinear().applyMatrix3(LINEAR_DISPLAY_P3_TO_LINEAR_SRGB)}function LinearSRGBToDisplayP3(X){return X.applyMatrix3(LINEAR_SRGB_TO_LINEAR_DISPLAY_P3).convertLinearToSRGB()}const TO_LINEAR={[LinearSRGBColorSpace$1]:X=>X,[SRGBColorSpace$1]:X=>X.convertSRGBToLinear(),[DisplayP3ColorSpace]:DisplayP3ToLinearSRGB},FROM_LINEAR={[LinearSRGBColorSpace$1]:X=>X,[SRGBColorSpace$1]:X=>X.convertLinearToSRGB(),[DisplayP3ColorSpace]:LinearSRGBToDisplayP3},ColorManagement={enabled:!0,get legacyMode(){return console.warn("THREE.ColorManagement: .legacyMode=false renamed to .enabled=true in r150."),!this.enabled},set legacyMode(X){console.warn("THREE.ColorManagement: .legacyMode=false renamed to .enabled=true in r150."),this.enabled=!X},get workingColorSpace(){return LinearSRGBColorSpace$1},set workingColorSpace(X){console.warn("THREE.ColorManagement: .workingColorSpace is readonly.")},convert:function(X,Z,_){if(this.enabled===!1||Z===_||!Z||!_)return X;const K=TO_LINEAR[Z],te=FROM_LINEAR[_];if(K===void 0||te===void 0)throw new Error(`Unsupported color space conversion, "${Z}" to "${_}".`);return te(K(X))},fromWorkingColorSpace:function(X,Z){return this.convert(X,this.workingColorSpace,Z)},toWorkingColorSpace:function(X,Z){return this.convert(X,Z,this.workingColorSpace)}};let _canvas;class ImageUtils{static getDataURL(Z){if(/^data:/i.test(Z.src)||typeof HTMLCanvasElement>"u")return Z.src;let _;if(Z instanceof HTMLCanvasElement)_=Z;else{_canvas===void 0&&(_canvas=createElementNS("canvas")),_canvas.width=Z.width,_canvas.height=Z.height;const K=_canvas.getContext("2d");Z instanceof ImageData?K.putImageData(Z,0,0):K.drawImage(Z,0,0,Z.width,Z.height),_=_canvas}return _.width>2048||_.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",Z),_.toDataURL("image/jpeg",.6)):_.toDataURL("image/png")}static sRGBToLinear(Z){if(typeof HTMLImageElement<"u"&&Z instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&Z instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&Z instanceof ImageBitmap){const _=createElementNS("canvas");_.width=Z.width,_.height=Z.height;const K=_.getContext("2d");K.drawImage(Z,0,0,Z.width,Z.height);const te=K.getImageData(0,0,Z.width,Z.height),ne=te.data;for(let oe=0;oe<ne.length;oe++)ne[oe]=SRGBToLinear(ne[oe]/255)*255;return K.putImageData(te,0,0),_}else if(Z.data){const _=Z.data.slice(0);for(let K=0;K<_.length;K++)_ instanceof Uint8Array||_ instanceof Uint8ClampedArray?_[K]=Math.floor(SRGBToLinear(_[K]/255)*255):_[K]=SRGBToLinear(_[K]);return{data:_,width:Z.width,height:Z.height}}else return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),Z}}let sourceId=0;class Source{constructor(Z=null){this.isSource=!0,Object.defineProperty(this,"id",{value:sourceId++}),this.uuid=generateUUID$1(),this.data=Z,this.version=0}set needsUpdate(Z){Z===!0&&this.version++}toJSON(Z){const _=Z===void 0||typeof Z=="string";if(!_&&Z.images[this.uuid]!==void 0)return Z.images[this.uuid];const K={uuid:this.uuid,url:""},te=this.data;if(te!==null){let ne;if(Array.isArray(te)){ne=[];for(let oe=0,ie=te.length;oe<ie;oe++)te[oe].isDataTexture?ne.push(serializeImage(te[oe].image)):ne.push(serializeImage(te[oe]))}else ne=serializeImage(te);K.url=ne}return _||(Z.images[this.uuid]=K),K}}function serializeImage(X){return typeof HTMLImageElement<"u"&&X instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&X instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&X instanceof ImageBitmap?ImageUtils.getDataURL(X):X.data?{data:Array.from(X.data),width:X.width,height:X.height,type:X.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let textureId=0;class Texture extends EventDispatcher{constructor(Z=Texture.DEFAULT_IMAGE,_=Texture.DEFAULT_MAPPING,K=ClampToEdgeWrapping,te=ClampToEdgeWrapping,ne=LinearFilter,oe=LinearMipmapLinearFilter,ie=RGBAFormat,se=UnsignedByteType,ae=Texture.DEFAULT_ANISOTROPY,ge=NoColorSpace){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:textureId++}),this.uuid=generateUUID$1(),this.name="",this.source=new Source(Z),this.mipmaps=[],this.mapping=_,this.channel=0,this.wrapS=K,this.wrapT=te,this.magFilter=ne,this.minFilter=oe,this.anisotropy=ae,this.format=ie,this.internalFormat=null,this.type=se,this.offset=new Vector2(0,0),this.repeat=new Vector2(1,1),this.center=new Vector2(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Matrix3,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,typeof ge=="string"?this.colorSpace=ge:(warnOnce("THREE.Texture: Property .encoding has been replaced by .colorSpace."),this.colorSpace=ge===sRGBEncoding$2?SRGBColorSpace$1:NoColorSpace),this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.needsPMREMUpdate=!1}get image(){return this.source.data}set image(Z=null){this.source.data=Z}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(Z){return this.name=Z.name,this.source=Z.source,this.mipmaps=Z.mipmaps.slice(0),this.mapping=Z.mapping,this.channel=Z.channel,this.wrapS=Z.wrapS,this.wrapT=Z.wrapT,this.magFilter=Z.magFilter,this.minFilter=Z.minFilter,this.anisotropy=Z.anisotropy,this.format=Z.format,this.internalFormat=Z.internalFormat,this.type=Z.type,this.offset.copy(Z.offset),this.repeat.copy(Z.repeat),this.center.copy(Z.center),this.rotation=Z.rotation,this.matrixAutoUpdate=Z.matrixAutoUpdate,this.matrix.copy(Z.matrix),this.generateMipmaps=Z.generateMipmaps,this.premultiplyAlpha=Z.premultiplyAlpha,this.flipY=Z.flipY,this.unpackAlignment=Z.unpackAlignment,this.colorSpace=Z.colorSpace,this.userData=JSON.parse(JSON.stringify(Z.userData)),this.needsUpdate=!0,this}toJSON(Z){const _=Z===void 0||typeof Z=="string";if(!_&&Z.textures[this.uuid]!==void 0)return Z.textures[this.uuid];const K={metadata:{version:4.6,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(Z).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(K.userData=this.userData),_||(Z.textures[this.uuid]=K),K}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(Z){if(this.mapping!==UVMapping)return Z;if(Z.applyMatrix3(this.matrix),Z.x<0||Z.x>1)switch(this.wrapS){case RepeatWrapping:Z.x=Z.x-Math.floor(Z.x);break;case ClampToEdgeWrapping:Z.x=Z.x<0?0:1;break;case MirroredRepeatWrapping:Math.abs(Math.floor(Z.x)%2)===1?Z.x=Math.ceil(Z.x)-Z.x:Z.x=Z.x-Math.floor(Z.x);break}if(Z.y<0||Z.y>1)switch(this.wrapT){case RepeatWrapping:Z.y=Z.y-Math.floor(Z.y);break;case ClampToEdgeWrapping:Z.y=Z.y<0?0:1;break;case MirroredRepeatWrapping:Math.abs(Math.floor(Z.y)%2)===1?Z.y=Math.ceil(Z.y)-Z.y:Z.y=Z.y-Math.floor(Z.y);break}return this.flipY&&(Z.y=1-Z.y),Z}set needsUpdate(Z){Z===!0&&(this.version++,this.source.needsUpdate=!0)}get encoding(){return warnOnce("THREE.Texture: Property .encoding has been replaced by .colorSpace."),this.colorSpace===SRGBColorSpace$1?sRGBEncoding$2:LinearEncoding$2}set encoding(Z){warnOnce("THREE.Texture: Property .encoding has been replaced by .colorSpace."),this.colorSpace=Z===sRGBEncoding$2?SRGBColorSpace$1:NoColorSpace}}Texture.DEFAULT_IMAGE=null;Texture.DEFAULT_MAPPING=UVMapping;Texture.DEFAULT_ANISOTROPY=1;class Vector4{constructor(Z=0,_=0,K=0,te=1){Vector4.prototype.isVector4=!0,this.x=Z,this.y=_,this.z=K,this.w=te}get width(){return this.z}set width(Z){this.z=Z}get height(){return this.w}set height(Z){this.w=Z}set(Z,_,K,te){return this.x=Z,this.y=_,this.z=K,this.w=te,this}setScalar(Z){return this.x=Z,this.y=Z,this.z=Z,this.w=Z,this}setX(Z){return this.x=Z,this}setY(Z){return this.y=Z,this}setZ(Z){return this.z=Z,this}setW(Z){return this.w=Z,this}setComponent(Z,_){switch(Z){case 0:this.x=_;break;case 1:this.y=_;break;case 2:this.z=_;break;case 3:this.w=_;break;default:throw new Error("index is out of range: "+Z)}return this}getComponent(Z){switch(Z){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+Z)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(Z){return this.x=Z.x,this.y=Z.y,this.z=Z.z,this.w=Z.w!==void 0?Z.w:1,this}add(Z){return this.x+=Z.x,this.y+=Z.y,this.z+=Z.z,this.w+=Z.w,this}addScalar(Z){return this.x+=Z,this.y+=Z,this.z+=Z,this.w+=Z,this}addVectors(Z,_){return this.x=Z.x+_.x,this.y=Z.y+_.y,this.z=Z.z+_.z,this.w=Z.w+_.w,this}addScaledVector(Z,_){return this.x+=Z.x*_,this.y+=Z.y*_,this.z+=Z.z*_,this.w+=Z.w*_,this}sub(Z){return this.x-=Z.x,this.y-=Z.y,this.z-=Z.z,this.w-=Z.w,this}subScalar(Z){return this.x-=Z,this.y-=Z,this.z-=Z,this.w-=Z,this}subVectors(Z,_){return this.x=Z.x-_.x,this.y=Z.y-_.y,this.z=Z.z-_.z,this.w=Z.w-_.w,this}multiply(Z){return this.x*=Z.x,this.y*=Z.y,this.z*=Z.z,this.w*=Z.w,this}multiplyScalar(Z){return this.x*=Z,this.y*=Z,this.z*=Z,this.w*=Z,this}applyMatrix4(Z){const _=this.x,K=this.y,te=this.z,ne=this.w,oe=Z.elements;return this.x=oe[0]*_+oe[4]*K+oe[8]*te+oe[12]*ne,this.y=oe[1]*_+oe[5]*K+oe[9]*te+oe[13]*ne,this.z=oe[2]*_+oe[6]*K+oe[10]*te+oe[14]*ne,this.w=oe[3]*_+oe[7]*K+oe[11]*te+oe[15]*ne,this}divideScalar(Z){return this.multiplyScalar(1/Z)}setAxisAngleFromQuaternion(Z){this.w=2*Math.acos(Z.w);const _=Math.sqrt(1-Z.w*Z.w);return _<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=Z.x/_,this.y=Z.y/_,this.z=Z.z/_),this}setAxisAngleFromRotationMatrix(Z){let _,K,te,ne;const se=Z.elements,ae=se[0],ge=se[4],ce=se[8],de=se[1],pe=se[5],fe=se[9],be=se[2],me=se[6],ye=se[10];if(Math.abs(ge-de)<.01&&Math.abs(ce-be)<.01&&Math.abs(fe-me)<.01){if(Math.abs(ge+de)<.1&&Math.abs(ce+be)<.1&&Math.abs(fe+me)<.1&&Math.abs(ae+pe+ye-3)<.1)return this.set(1,0,0,0),this;_=Math.PI;const Be=(ae+1)/2,Re=(pe+1)/2,Ee=(ye+1)/2,We=(ge+de)/4,Ze=(ce+be)/4,Ve=(fe+me)/4;return Be>Re&&Be>Ee?Be<.01?(K=0,te=.707106781,ne=.707106781):(K=Math.sqrt(Be),te=We/K,ne=Ze/K):Re>Ee?Re<.01?(K=.707106781,te=0,ne=.707106781):(te=Math.sqrt(Re),K=We/te,ne=Ve/te):Ee<.01?(K=.707106781,te=.707106781,ne=0):(ne=Math.sqrt(Ee),K=Ze/ne,te=Ve/ne),this.set(K,te,ne,_),this}let ve=Math.sqrt((me-fe)*(me-fe)+(ce-be)*(ce-be)+(de-ge)*(de-ge));return Math.abs(ve)<.001&&(ve=1),this.x=(me-fe)/ve,this.y=(ce-be)/ve,this.z=(de-ge)/ve,this.w=Math.acos((ae+pe+ye-1)/2),this}min(Z){return this.x=Math.min(this.x,Z.x),this.y=Math.min(this.y,Z.y),this.z=Math.min(this.z,Z.z),this.w=Math.min(this.w,Z.w),this}max(Z){return this.x=Math.max(this.x,Z.x),this.y=Math.max(this.y,Z.y),this.z=Math.max(this.z,Z.z),this.w=Math.max(this.w,Z.w),this}clamp(Z,_){return this.x=Math.max(Z.x,Math.min(_.x,this.x)),this.y=Math.max(Z.y,Math.min(_.y,this.y)),this.z=Math.max(Z.z,Math.min(_.z,this.z)),this.w=Math.max(Z.w,Math.min(_.w,this.w)),this}clampScalar(Z,_){return this.x=Math.max(Z,Math.min(_,this.x)),this.y=Math.max(Z,Math.min(_,this.y)),this.z=Math.max(Z,Math.min(_,this.z)),this.w=Math.max(Z,Math.min(_,this.w)),this}clampLength(Z,_){const K=this.length();return this.divideScalar(K||1).multiplyScalar(Math.max(Z,Math.min(_,K)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(Z){return this.x*Z.x+this.y*Z.y+this.z*Z.z+this.w*Z.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(Z){return this.normalize().multiplyScalar(Z)}lerp(Z,_){return this.x+=(Z.x-this.x)*_,this.y+=(Z.y-this.y)*_,this.z+=(Z.z-this.z)*_,this.w+=(Z.w-this.w)*_,this}lerpVectors(Z,_,K){return this.x=Z.x+(_.x-Z.x)*K,this.y=Z.y+(_.y-Z.y)*K,this.z=Z.z+(_.z-Z.z)*K,this.w=Z.w+(_.w-Z.w)*K,this}equals(Z){return Z.x===this.x&&Z.y===this.y&&Z.z===this.z&&Z.w===this.w}fromArray(Z,_=0){return this.x=Z[_],this.y=Z[_+1],this.z=Z[_+2],this.w=Z[_+3],this}toArray(Z=[],_=0){return Z[_]=this.x,Z[_+1]=this.y,Z[_+2]=this.z,Z[_+3]=this.w,Z}fromBufferAttribute(Z,_){return this.x=Z.getX(_),this.y=Z.getY(_),this.z=Z.getZ(_),this.w=Z.getW(_),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class WebGLRenderTarget extends EventDispatcher{constructor(Z=1,_=1,K={}){super(),this.isWebGLRenderTarget=!0,this.width=Z,this.height=_,this.depth=1,this.scissor=new Vector4(0,0,Z,_),this.scissorTest=!1,this.viewport=new Vector4(0,0,Z,_);const te={width:Z,height:_,depth:1};K.encoding!==void 0&&(warnOnce("THREE.WebGLRenderTarget: option.encoding has been replaced by option.colorSpace."),K.colorSpace=K.encoding===sRGBEncoding$2?SRGBColorSpace$1:NoColorSpace),this.texture=new Texture(te,K.mapping,K.wrapS,K.wrapT,K.magFilter,K.minFilter,K.format,K.type,K.anisotropy,K.colorSpace),this.texture.isRenderTargetTexture=!0,this.texture.flipY=!1,this.texture.generateMipmaps=K.generateMipmaps!==void 0?K.generateMipmaps:!1,this.texture.internalFormat=K.internalFormat!==void 0?K.internalFormat:null,this.texture.minFilter=K.minFilter!==void 0?K.minFilter:LinearFilter,this.depthBuffer=K.depthBuffer!==void 0?K.depthBuffer:!0,this.stencilBuffer=K.stencilBuffer!==void 0?K.stencilBuffer:!1,this.depthTexture=K.depthTexture!==void 0?K.depthTexture:null,this.samples=K.samples!==void 0?K.samples:0}setSize(Z,_,K=1){(this.width!==Z||this.height!==_||this.depth!==K)&&(this.width=Z,this.height=_,this.depth=K,this.texture.image.width=Z,this.texture.image.height=_,this.texture.image.depth=K,this.dispose()),this.viewport.set(0,0,Z,_),this.scissor.set(0,0,Z,_)}clone(){return new this.constructor().copy(this)}copy(Z){this.width=Z.width,this.height=Z.height,this.depth=Z.depth,this.scissor.copy(Z.scissor),this.scissorTest=Z.scissorTest,this.viewport.copy(Z.viewport),this.texture=Z.texture.clone(),this.texture.isRenderTargetTexture=!0;const _=Object.assign({},Z.texture.image);return this.texture.source=new Source(_),this.depthBuffer=Z.depthBuffer,this.stencilBuffer=Z.stencilBuffer,Z.depthTexture!==null&&(this.depthTexture=Z.depthTexture.clone()),this.samples=Z.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class DataArrayTexture extends Texture{constructor(Z=null,_=1,K=1,te=1){super(null),this.isDataArrayTexture=!0,this.image={data:Z,width:_,height:K,depth:te},this.magFilter=NearestFilter,this.minFilter=NearestFilter,this.wrapR=ClampToEdgeWrapping,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class WebGLArrayRenderTarget extends WebGLRenderTarget{constructor(Z=1,_=1,K=1){super(Z,_),this.isWebGLArrayRenderTarget=!0,this.depth=K,this.texture=new DataArrayTexture(null,Z,_,K),this.texture.isRenderTargetTexture=!0}}class Data3DTexture extends Texture{constructor(Z=null,_=1,K=1,te=1){super(null),this.isData3DTexture=!0,this.image={data:Z,width:_,height:K,depth:te},this.magFilter=NearestFilter,this.minFilter=NearestFilter,this.wrapR=ClampToEdgeWrapping,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class WebGL3DRenderTarget extends WebGLRenderTarget{constructor(Z=1,_=1,K=1){super(Z,_),this.isWebGL3DRenderTarget=!0,this.depth=K,this.texture=new Data3DTexture(null,Z,_,K),this.texture.isRenderTargetTexture=!0}}class WebGLMultipleRenderTargets extends WebGLRenderTarget{constructor(Z=1,_=1,K=1,te={}){super(Z,_,te),this.isWebGLMultipleRenderTargets=!0;const ne=this.texture;this.texture=[];for(let oe=0;oe<K;oe++)this.texture[oe]=ne.clone(),this.texture[oe].isRenderTargetTexture=!0}setSize(Z,_,K=1){if(this.width!==Z||this.height!==_||this.depth!==K){this.width=Z,this.height=_,this.depth=K;for(let te=0,ne=this.texture.length;te<ne;te++)this.texture[te].image.width=Z,this.texture[te].image.height=_,this.texture[te].image.depth=K;this.dispose()}return this.viewport.set(0,0,Z,_),this.scissor.set(0,0,Z,_),this}copy(Z){this.dispose(),this.width=Z.width,this.height=Z.height,this.depth=Z.depth,this.scissor.copy(Z.scissor),this.scissorTest=Z.scissorTest,this.viewport.copy(Z.viewport),this.depthBuffer=Z.depthBuffer,this.stencilBuffer=Z.stencilBuffer,Z.depthTexture!==null&&(this.depthTexture=Z.depthTexture.clone()),this.texture.length=0;for(let _=0,K=Z.texture.length;_<K;_++)this.texture[_]=Z.texture[_].clone(),this.texture[_].isRenderTargetTexture=!0;return this}}let Quaternion$2=class{constructor(Z=0,_=0,K=0,te=1){this.isQuaternion=!0,this._x=Z,this._y=_,this._z=K,this._w=te}static slerpFlat(Z,_,K,te,ne,oe,ie){let se=K[te+0],ae=K[te+1],ge=K[te+2],ce=K[te+3];const de=ne[oe+0],pe=ne[oe+1],fe=ne[oe+2],be=ne[oe+3];if(ie===0){Z[_+0]=se,Z[_+1]=ae,Z[_+2]=ge,Z[_+3]=ce;return}if(ie===1){Z[_+0]=de,Z[_+1]=pe,Z[_+2]=fe,Z[_+3]=be;return}if(ce!==be||se!==de||ae!==pe||ge!==fe){let me=1-ie;const ye=se*de+ae*pe+ge*fe+ce*be,ve=ye>=0?1:-1,Be=1-ye*ye;if(Be>Number.EPSILON){const Ee=Math.sqrt(Be),We=Math.atan2(Ee,ye*ve);me=Math.sin(me*We)/Ee,ie=Math.sin(ie*We)/Ee}const Re=ie*ve;if(se=se*me+de*Re,ae=ae*me+pe*Re,ge=ge*me+fe*Re,ce=ce*me+be*Re,me===1-ie){const Ee=1/Math.sqrt(se*se+ae*ae+ge*ge+ce*ce);se*=Ee,ae*=Ee,ge*=Ee,ce*=Ee}}Z[_]=se,Z[_+1]=ae,Z[_+2]=ge,Z[_+3]=ce}static multiplyQuaternionsFlat(Z,_,K,te,ne,oe){const ie=K[te],se=K[te+1],ae=K[te+2],ge=K[te+3],ce=ne[oe],de=ne[oe+1],pe=ne[oe+2],fe=ne[oe+3];return Z[_]=ie*fe+ge*ce+se*pe-ae*de,Z[_+1]=se*fe+ge*de+ae*ce-ie*pe,Z[_+2]=ae*fe+ge*pe+ie*de-se*ce,Z[_+3]=ge*fe-ie*ce-se*de-ae*pe,Z}get x(){return this._x}set x(Z){this._x=Z,this._onChangeCallback()}get y(){return this._y}set y(Z){this._y=Z,this._onChangeCallback()}get z(){return this._z}set z(Z){this._z=Z,this._onChangeCallback()}get w(){return this._w}set w(Z){this._w=Z,this._onChangeCallback()}set(Z,_,K,te){return this._x=Z,this._y=_,this._z=K,this._w=te,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(Z){return this._x=Z.x,this._y=Z.y,this._z=Z.z,this._w=Z.w,this._onChangeCallback(),this}setFromEuler(Z,_){const K=Z._x,te=Z._y,ne=Z._z,oe=Z._order,ie=Math.cos,se=Math.sin,ae=ie(K/2),ge=ie(te/2),ce=ie(ne/2),de=se(K/2),pe=se(te/2),fe=se(ne/2);switch(oe){case"XYZ":this._x=de*ge*ce+ae*pe*fe,this._y=ae*pe*ce-de*ge*fe,this._z=ae*ge*fe+de*pe*ce,this._w=ae*ge*ce-de*pe*fe;break;case"YXZ":this._x=de*ge*ce+ae*pe*fe,this._y=ae*pe*ce-de*ge*fe,this._z=ae*ge*fe-de*pe*ce,this._w=ae*ge*ce+de*pe*fe;break;case"ZXY":this._x=de*ge*ce-ae*pe*fe,this._y=ae*pe*ce+de*ge*fe,this._z=ae*ge*fe+de*pe*ce,this._w=ae*ge*ce-de*pe*fe;break;case"ZYX":this._x=de*ge*ce-ae*pe*fe,this._y=ae*pe*ce+de*ge*fe,this._z=ae*ge*fe-de*pe*ce,this._w=ae*ge*ce+de*pe*fe;break;case"YZX":this._x=de*ge*ce+ae*pe*fe,this._y=ae*pe*ce+de*ge*fe,this._z=ae*ge*fe-de*pe*ce,this._w=ae*ge*ce-de*pe*fe;break;case"XZY":this._x=de*ge*ce-ae*pe*fe,this._y=ae*pe*ce-de*ge*fe,this._z=ae*ge*fe+de*pe*ce,this._w=ae*ge*ce+de*pe*fe;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+oe)}return _!==!1&&this._onChangeCallback(),this}setFromAxisAngle(Z,_){const K=_/2,te=Math.sin(K);return this._x=Z.x*te,this._y=Z.y*te,this._z=Z.z*te,this._w=Math.cos(K),this._onChangeCallback(),this}setFromRotationMatrix(Z){const _=Z.elements,K=_[0],te=_[4],ne=_[8],oe=_[1],ie=_[5],se=_[9],ae=_[2],ge=_[6],ce=_[10],de=K+ie+ce;if(de>0){const pe=.5/Math.sqrt(de+1);this._w=.25/pe,this._x=(ge-se)*pe,this._y=(ne-ae)*pe,this._z=(oe-te)*pe}else if(K>ie&&K>ce){const pe=2*Math.sqrt(1+K-ie-ce);this._w=(ge-se)/pe,this._x=.25*pe,this._y=(te+oe)/pe,this._z=(ne+ae)/pe}else if(ie>ce){const pe=2*Math.sqrt(1+ie-K-ce);this._w=(ne-ae)/pe,this._x=(te+oe)/pe,this._y=.25*pe,this._z=(se+ge)/pe}else{const pe=2*Math.sqrt(1+ce-K-ie);this._w=(oe-te)/pe,this._x=(ne+ae)/pe,this._y=(se+ge)/pe,this._z=.25*pe}return this._onChangeCallback(),this}setFromUnitVectors(Z,_){let K=Z.dot(_)+1;return K<Number.EPSILON?(K=0,Math.abs(Z.x)>Math.abs(Z.z)?(this._x=-Z.y,this._y=Z.x,this._z=0,this._w=K):(this._x=0,this._y=-Z.z,this._z=Z.y,this._w=K)):(this._x=Z.y*_.z-Z.z*_.y,this._y=Z.z*_.x-Z.x*_.z,this._z=Z.x*_.y-Z.y*_.x,this._w=K),this.normalize()}angleTo(Z){return 2*Math.acos(Math.abs(clamp$3(this.dot(Z),-1,1)))}rotateTowards(Z,_){const K=this.angleTo(Z);if(K===0)return this;const te=Math.min(1,_/K);return this.slerp(Z,te),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(Z){return this._x*Z._x+this._y*Z._y+this._z*Z._z+this._w*Z._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let Z=this.length();return Z===0?(this._x=0,this._y=0,this._z=0,this._w=1):(Z=1/Z,this._x=this._x*Z,this._y=this._y*Z,this._z=this._z*Z,this._w=this._w*Z),this._onChangeCallback(),this}multiply(Z){return this.multiplyQuaternions(this,Z)}premultiply(Z){return this.multiplyQuaternions(Z,this)}multiplyQuaternions(Z,_){const K=Z._x,te=Z._y,ne=Z._z,oe=Z._w,ie=_._x,se=_._y,ae=_._z,ge=_._w;return this._x=K*ge+oe*ie+te*ae-ne*se,this._y=te*ge+oe*se+ne*ie-K*ae,this._z=ne*ge+oe*ae+K*se-te*ie,this._w=oe*ge-K*ie-te*se-ne*ae,this._onChangeCallback(),this}slerp(Z,_){if(_===0)return this;if(_===1)return this.copy(Z);const K=this._x,te=this._y,ne=this._z,oe=this._w;let ie=oe*Z._w+K*Z._x+te*Z._y+ne*Z._z;if(ie<0?(this._w=-Z._w,this._x=-Z._x,this._y=-Z._y,this._z=-Z._z,ie=-ie):this.copy(Z),ie>=1)return this._w=oe,this._x=K,this._y=te,this._z=ne,this;const se=1-ie*ie;if(se<=Number.EPSILON){const pe=1-_;return this._w=pe*oe+_*this._w,this._x=pe*K+_*this._x,this._y=pe*te+_*this._y,this._z=pe*ne+_*this._z,this.normalize(),this._onChangeCallback(),this}const ae=Math.sqrt(se),ge=Math.atan2(ae,ie),ce=Math.sin((1-_)*ge)/ae,de=Math.sin(_*ge)/ae;return this._w=oe*ce+this._w*de,this._x=K*ce+this._x*de,this._y=te*ce+this._y*de,this._z=ne*ce+this._z*de,this._onChangeCallback(),this}slerpQuaternions(Z,_,K){return this.copy(Z).slerp(_,K)}random(){const Z=Math.random(),_=Math.sqrt(1-Z),K=Math.sqrt(Z),te=2*Math.PI*Math.random(),ne=2*Math.PI*Math.random();return this.set(_*Math.cos(te),K*Math.sin(ne),K*Math.cos(ne),_*Math.sin(te))}equals(Z){return Z._x===this._x&&Z._y===this._y&&Z._z===this._z&&Z._w===this._w}fromArray(Z,_=0){return this._x=Z[_],this._y=Z[_+1],this._z=Z[_+2],this._w=Z[_+3],this._onChangeCallback(),this}toArray(Z=[],_=0){return Z[_]=this._x,Z[_+1]=this._y,Z[_+2]=this._z,Z[_+3]=this._w,Z}fromBufferAttribute(Z,_){return this._x=Z.getX(_),this._y=Z.getY(_),this._z=Z.getZ(_),this._w=Z.getW(_),this}toJSON(){return this.toArray()}_onChange(Z){return this._onChangeCallback=Z,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}};class Vector3{constructor(Z=0,_=0,K=0){Vector3.prototype.isVector3=!0,this.x=Z,this.y=_,this.z=K}set(Z,_,K){return K===void 0&&(K=this.z),this.x=Z,this.y=_,this.z=K,this}setScalar(Z){return this.x=Z,this.y=Z,this.z=Z,this}setX(Z){return this.x=Z,this}setY(Z){return this.y=Z,this}setZ(Z){return this.z=Z,this}setComponent(Z,_){switch(Z){case 0:this.x=_;break;case 1:this.y=_;break;case 2:this.z=_;break;default:throw new Error("index is out of range: "+Z)}return this}getComponent(Z){switch(Z){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+Z)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(Z){return this.x=Z.x,this.y=Z.y,this.z=Z.z,this}add(Z){return this.x+=Z.x,this.y+=Z.y,this.z+=Z.z,this}addScalar(Z){return this.x+=Z,this.y+=Z,this.z+=Z,this}addVectors(Z,_){return this.x=Z.x+_.x,this.y=Z.y+_.y,this.z=Z.z+_.z,this}addScaledVector(Z,_){return this.x+=Z.x*_,this.y+=Z.y*_,this.z+=Z.z*_,this}sub(Z){return this.x-=Z.x,this.y-=Z.y,this.z-=Z.z,this}subScalar(Z){return this.x-=Z,this.y-=Z,this.z-=Z,this}subVectors(Z,_){return this.x=Z.x-_.x,this.y=Z.y-_.y,this.z=Z.z-_.z,this}multiply(Z){return this.x*=Z.x,this.y*=Z.y,this.z*=Z.z,this}multiplyScalar(Z){return this.x*=Z,this.y*=Z,this.z*=Z,this}multiplyVectors(Z,_){return this.x=Z.x*_.x,this.y=Z.y*_.y,this.z=Z.z*_.z,this}applyEuler(Z){return this.applyQuaternion(_quaternion$4.setFromEuler(Z))}applyAxisAngle(Z,_){return this.applyQuaternion(_quaternion$4.setFromAxisAngle(Z,_))}applyMatrix3(Z){const _=this.x,K=this.y,te=this.z,ne=Z.elements;return this.x=ne[0]*_+ne[3]*K+ne[6]*te,this.y=ne[1]*_+ne[4]*K+ne[7]*te,this.z=ne[2]*_+ne[5]*K+ne[8]*te,this}applyNormalMatrix(Z){return this.applyMatrix3(Z).normalize()}applyMatrix4(Z){const _=this.x,K=this.y,te=this.z,ne=Z.elements,oe=1/(ne[3]*_+ne[7]*K+ne[11]*te+ne[15]);return this.x=(ne[0]*_+ne[4]*K+ne[8]*te+ne[12])*oe,this.y=(ne[1]*_+ne[5]*K+ne[9]*te+ne[13])*oe,this.z=(ne[2]*_+ne[6]*K+ne[10]*te+ne[14])*oe,this}applyQuaternion(Z){const _=this.x,K=this.y,te=this.z,ne=Z.x,oe=Z.y,ie=Z.z,se=Z.w,ae=se*_+oe*te-ie*K,ge=se*K+ie*_-ne*te,ce=se*te+ne*K-oe*_,de=-ne*_-oe*K-ie*te;return this.x=ae*se+de*-ne+ge*-ie-ce*-oe,this.y=ge*se+de*-oe+ce*-ne-ae*-ie,this.z=ce*se+de*-ie+ae*-oe-ge*-ne,this}project(Z){return this.applyMatrix4(Z.matrixWorldInverse).applyMatrix4(Z.projectionMatrix)}unproject(Z){return this.applyMatrix4(Z.projectionMatrixInverse).applyMatrix4(Z.matrixWorld)}transformDirection(Z){const _=this.x,K=this.y,te=this.z,ne=Z.elements;return this.x=ne[0]*_+ne[4]*K+ne[8]*te,this.y=ne[1]*_+ne[5]*K+ne[9]*te,this.z=ne[2]*_+ne[6]*K+ne[10]*te,this.normalize()}divide(Z){return this.x/=Z.x,this.y/=Z.y,this.z/=Z.z,this}divideScalar(Z){return this.multiplyScalar(1/Z)}min(Z){return this.x=Math.min(this.x,Z.x),this.y=Math.min(this.y,Z.y),this.z=Math.min(this.z,Z.z),this}max(Z){return this.x=Math.max(this.x,Z.x),this.y=Math.max(this.y,Z.y),this.z=Math.max(this.z,Z.z),this}clamp(Z,_){return this.x=Math.max(Z.x,Math.min(_.x,this.x)),this.y=Math.max(Z.y,Math.min(_.y,this.y)),this.z=Math.max(Z.z,Math.min(_.z,this.z)),this}clampScalar(Z,_){return this.x=Math.max(Z,Math.min(_,this.x)),this.y=Math.max(Z,Math.min(_,this.y)),this.z=Math.max(Z,Math.min(_,this.z)),this}clampLength(Z,_){const K=this.length();return this.divideScalar(K||1).multiplyScalar(Math.max(Z,Math.min(_,K)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(Z){return this.x*Z.x+this.y*Z.y+this.z*Z.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(Z){return this.normalize().multiplyScalar(Z)}lerp(Z,_){return this.x+=(Z.x-this.x)*_,this.y+=(Z.y-this.y)*_,this.z+=(Z.z-this.z)*_,this}lerpVectors(Z,_,K){return this.x=Z.x+(_.x-Z.x)*K,this.y=Z.y+(_.y-Z.y)*K,this.z=Z.z+(_.z-Z.z)*K,this}cross(Z){return this.crossVectors(this,Z)}crossVectors(Z,_){const K=Z.x,te=Z.y,ne=Z.z,oe=_.x,ie=_.y,se=_.z;return this.x=te*se-ne*ie,this.y=ne*oe-K*se,this.z=K*ie-te*oe,this}projectOnVector(Z){const _=Z.lengthSq();if(_===0)return this.set(0,0,0);const K=Z.dot(this)/_;return this.copy(Z).multiplyScalar(K)}projectOnPlane(Z){return _vector$b.copy(this).projectOnVector(Z),this.sub(_vector$b)}reflect(Z){return this.sub(_vector$b.copy(Z).multiplyScalar(2*this.dot(Z)))}angleTo(Z){const _=Math.sqrt(this.lengthSq()*Z.lengthSq());if(_===0)return Math.PI/2;const K=this.dot(Z)/_;return Math.acos(clamp$3(K,-1,1))}distanceTo(Z){return Math.sqrt(this.distanceToSquared(Z))}distanceToSquared(Z){const _=this.x-Z.x,K=this.y-Z.y,te=this.z-Z.z;return _*_+K*K+te*te}manhattanDistanceTo(Z){return Math.abs(this.x-Z.x)+Math.abs(this.y-Z.y)+Math.abs(this.z-Z.z)}setFromSpherical(Z){return this.setFromSphericalCoords(Z.radius,Z.phi,Z.theta)}setFromSphericalCoords(Z,_,K){const te=Math.sin(_)*Z;return this.x=te*Math.sin(K),this.y=Math.cos(_)*Z,this.z=te*Math.cos(K),this}setFromCylindrical(Z){return this.setFromCylindricalCoords(Z.radius,Z.theta,Z.y)}setFromCylindricalCoords(Z,_,K){return this.x=Z*Math.sin(_),this.y=K,this.z=Z*Math.cos(_),this}setFromMatrixPosition(Z){const _=Z.elements;return this.x=_[12],this.y=_[13],this.z=_[14],this}setFromMatrixScale(Z){const _=this.setFromMatrixColumn(Z,0).length(),K=this.setFromMatrixColumn(Z,1).length(),te=this.setFromMatrixColumn(Z,2).length();return this.x=_,this.y=K,this.z=te,this}setFromMatrixColumn(Z,_){return this.fromArray(Z.elements,_*4)}setFromMatrix3Column(Z,_){return this.fromArray(Z.elements,_*3)}setFromEuler(Z){return this.x=Z._x,this.y=Z._y,this.z=Z._z,this}setFromColor(Z){return this.x=Z.r,this.y=Z.g,this.z=Z.b,this}equals(Z){return Z.x===this.x&&Z.y===this.y&&Z.z===this.z}fromArray(Z,_=0){return this.x=Z[_],this.y=Z[_+1],this.z=Z[_+2],this}toArray(Z=[],_=0){return Z[_]=this.x,Z[_+1]=this.y,Z[_+2]=this.z,Z}fromBufferAttribute(Z,_){return this.x=Z.getX(_),this.y=Z.getY(_),this.z=Z.getZ(_),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const Z=(Math.random()-.5)*2,_=Math.random()*Math.PI*2,K=Math.sqrt(1-Z**2);return this.x=K*Math.cos(_),this.y=K*Math.sin(_),this.z=Z,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const _vector$b=new Vector3,_quaternion$4=new Quaternion$2;class Box3{constructor(Z=new Vector3(1/0,1/0,1/0),_=new Vector3(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=Z,this.max=_}set(Z,_){return this.min.copy(Z),this.max.copy(_),this}setFromArray(Z){this.makeEmpty();for(let _=0,K=Z.length;_<K;_+=3)this.expandByPoint(_vector$a.fromArray(Z,_));return this}setFromBufferAttribute(Z){this.makeEmpty();for(let _=0,K=Z.count;_<K;_++)this.expandByPoint(_vector$a.fromBufferAttribute(Z,_));return this}setFromPoints(Z){this.makeEmpty();for(let _=0,K=Z.length;_<K;_++)this.expandByPoint(Z[_]);return this}setFromCenterAndSize(Z,_){const K=_vector$a.copy(_).multiplyScalar(.5);return this.min.copy(Z).sub(K),this.max.copy(Z).add(K),this}setFromObject(Z,_=!1){return this.makeEmpty(),this.expandByObject(Z,_)}clone(){return new this.constructor().copy(this)}copy(Z){return this.min.copy(Z.min),this.max.copy(Z.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(Z){return this.isEmpty()?Z.set(0,0,0):Z.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(Z){return this.isEmpty()?Z.set(0,0,0):Z.subVectors(this.max,this.min)}expandByPoint(Z){return this.min.min(Z),this.max.max(Z),this}expandByVector(Z){return this.min.sub(Z),this.max.add(Z),this}expandByScalar(Z){return this.min.addScalar(-Z),this.max.addScalar(Z),this}expandByObject(Z,_=!1){if(Z.updateWorldMatrix(!1,!1),Z.boundingBox!==void 0)Z.boundingBox===null&&Z.computeBoundingBox(),_box$3.copy(Z.boundingBox),_box$3.applyMatrix4(Z.matrixWorld),this.union(_box$3);else{const te=Z.geometry;if(te!==void 0)if(_&&te.attributes!==void 0&&te.attributes.position!==void 0){const ne=te.attributes.position;for(let oe=0,ie=ne.count;oe<ie;oe++)_vector$a.fromBufferAttribute(ne,oe).applyMatrix4(Z.matrixWorld),this.expandByPoint(_vector$a)}else te.boundingBox===null&&te.computeBoundingBox(),_box$3.copy(te.boundingBox),_box$3.applyMatrix4(Z.matrixWorld),this.union(_box$3)}const K=Z.children;for(let te=0,ne=K.length;te<ne;te++)this.expandByObject(K[te],_);return this}containsPoint(Z){return!(Z.x<this.min.x||Z.x>this.max.x||Z.y<this.min.y||Z.y>this.max.y||Z.z<this.min.z||Z.z>this.max.z)}containsBox(Z){return this.min.x<=Z.min.x&&Z.max.x<=this.max.x&&this.min.y<=Z.min.y&&Z.max.y<=this.max.y&&this.min.z<=Z.min.z&&Z.max.z<=this.max.z}getParameter(Z,_){return _.set((Z.x-this.min.x)/(this.max.x-this.min.x),(Z.y-this.min.y)/(this.max.y-this.min.y),(Z.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(Z){return!(Z.max.x<this.min.x||Z.min.x>this.max.x||Z.max.y<this.min.y||Z.min.y>this.max.y||Z.max.z<this.min.z||Z.min.z>this.max.z)}intersectsSphere(Z){return this.clampPoint(Z.center,_vector$a),_vector$a.distanceToSquared(Z.center)<=Z.radius*Z.radius}intersectsPlane(Z){let _,K;return Z.normal.x>0?(_=Z.normal.x*this.min.x,K=Z.normal.x*this.max.x):(_=Z.normal.x*this.max.x,K=Z.normal.x*this.min.x),Z.normal.y>0?(_+=Z.normal.y*this.min.y,K+=Z.normal.y*this.max.y):(_+=Z.normal.y*this.max.y,K+=Z.normal.y*this.min.y),Z.normal.z>0?(_+=Z.normal.z*this.min.z,K+=Z.normal.z*this.max.z):(_+=Z.normal.z*this.max.z,K+=Z.normal.z*this.min.z),_<=-Z.constant&&K>=-Z.constant}intersectsTriangle(Z){if(this.isEmpty())return!1;this.getCenter(_center),_extents.subVectors(this.max,_center),_v0$2.subVectors(Z.a,_center),_v1$7.subVectors(Z.b,_center),_v2$4.subVectors(Z.c,_center),_f0.subVectors(_v1$7,_v0$2),_f1.subVectors(_v2$4,_v1$7),_f2.subVectors(_v0$2,_v2$4);let _=[0,-_f0.z,_f0.y,0,-_f1.z,_f1.y,0,-_f2.z,_f2.y,_f0.z,0,-_f0.x,_f1.z,0,-_f1.x,_f2.z,0,-_f2.x,-_f0.y,_f0.x,0,-_f1.y,_f1.x,0,-_f2.y,_f2.x,0];return!satForAxes(_,_v0$2,_v1$7,_v2$4,_extents)||(_=[1,0,0,0,1,0,0,0,1],!satForAxes(_,_v0$2,_v1$7,_v2$4,_extents))?!1:(_triangleNormal.crossVectors(_f0,_f1),_=[_triangleNormal.x,_triangleNormal.y,_triangleNormal.z],satForAxes(_,_v0$2,_v1$7,_v2$4,_extents))}clampPoint(Z,_){return _.copy(Z).clamp(this.min,this.max)}distanceToPoint(Z){return this.clampPoint(Z,_vector$a).distanceTo(Z)}getBoundingSphere(Z){return this.isEmpty()?Z.makeEmpty():(this.getCenter(Z.center),Z.radius=this.getSize(_vector$a).length()*.5),Z}intersect(Z){return this.min.max(Z.min),this.max.min(Z.max),this.isEmpty()&&this.makeEmpty(),this}union(Z){return this.min.min(Z.min),this.max.max(Z.max),this}applyMatrix4(Z){return this.isEmpty()?this:(_points[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(Z),_points[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(Z),_points[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(Z),_points[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(Z),_points[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(Z),_points[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(Z),_points[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(Z),_points[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(Z),this.setFromPoints(_points),this)}translate(Z){return this.min.add(Z),this.max.add(Z),this}equals(Z){return Z.min.equals(this.min)&&Z.max.equals(this.max)}}const _points=[new Vector3,new Vector3,new Vector3,new Vector3,new Vector3,new Vector3,new Vector3,new Vector3],_vector$a=new Vector3,_box$3=new Box3,_v0$2=new Vector3,_v1$7=new Vector3,_v2$4=new Vector3,_f0=new Vector3,_f1=new Vector3,_f2=new Vector3,_center=new Vector3,_extents=new Vector3,_triangleNormal=new Vector3,_testAxis=new Vector3;function satForAxes(X,Z,_,K,te){for(let ne=0,oe=X.length-3;ne<=oe;ne+=3){_testAxis.fromArray(X,ne);const ie=te.x*Math.abs(_testAxis.x)+te.y*Math.abs(_testAxis.y)+te.z*Math.abs(_testAxis.z),se=Z.dot(_testAxis),ae=_.dot(_testAxis),ge=K.dot(_testAxis);if(Math.max(-Math.max(se,ae,ge),Math.min(se,ae,ge))>ie)return!1}return!0}const _box$2=new Box3,_v1$6=new Vector3,_v2$3=new Vector3;class Sphere{constructor(Z=new Vector3,_=-1){this.center=Z,this.radius=_}set(Z,_){return this.center.copy(Z),this.radius=_,this}setFromPoints(Z,_){const K=this.center;_!==void 0?K.copy(_):_box$2.setFromPoints(Z).getCenter(K);let te=0;for(let ne=0,oe=Z.length;ne<oe;ne++)te=Math.max(te,K.distanceToSquared(Z[ne]));return this.radius=Math.sqrt(te),this}copy(Z){return this.center.copy(Z.center),this.radius=Z.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(Z){return Z.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(Z){return Z.distanceTo(this.center)-this.radius}intersectsSphere(Z){const _=this.radius+Z.radius;return Z.center.distanceToSquared(this.center)<=_*_}intersectsBox(Z){return Z.intersectsSphere(this)}intersectsPlane(Z){return Math.abs(Z.distanceToPoint(this.center))<=this.radius}clampPoint(Z,_){const K=this.center.distanceToSquared(Z);return _.copy(Z),K>this.radius*this.radius&&(_.sub(this.center).normalize(),_.multiplyScalar(this.radius).add(this.center)),_}getBoundingBox(Z){return this.isEmpty()?(Z.makeEmpty(),Z):(Z.set(this.center,this.center),Z.expandByScalar(this.radius),Z)}applyMatrix4(Z){return this.center.applyMatrix4(Z),this.radius=this.radius*Z.getMaxScaleOnAxis(),this}translate(Z){return this.center.add(Z),this}expandByPoint(Z){if(this.isEmpty())return this.center.copy(Z),this.radius=0,this;_v1$6.subVectors(Z,this.center);const _=_v1$6.lengthSq();if(_>this.radius*this.radius){const K=Math.sqrt(_),te=(K-this.radius)*.5;this.center.addScaledVector(_v1$6,te/K),this.radius+=te}return this}union(Z){return Z.isEmpty()?this:this.isEmpty()?(this.copy(Z),this):(this.center.equals(Z.center)===!0?this.radius=Math.max(this.radius,Z.radius):(_v2$3.subVectors(Z.center,this.center).setLength(Z.radius),this.expandByPoint(_v1$6.copy(Z.center).add(_v2$3)),this.expandByPoint(_v1$6.copy(Z.center).sub(_v2$3))),this)}equals(Z){return Z.center.equals(this.center)&&Z.radius===this.radius}clone(){return new this.constructor().copy(this)}}const _vector$9=new Vector3,_segCenter=new Vector3,_segDir=new Vector3,_diff=new Vector3,_edge1=new Vector3,_edge2=new Vector3,_normal$1=new Vector3;let Ray$2=class{constructor(Z=new Vector3,_=new Vector3(0,0,-1)){this.origin=Z,this.direction=_}set(Z,_){return this.origin.copy(Z),this.direction.copy(_),this}copy(Z){return this.origin.copy(Z.origin),this.direction.copy(Z.direction),this}at(Z,_){return _.copy(this.origin).addScaledVector(this.direction,Z)}lookAt(Z){return this.direction.copy(Z).sub(this.origin).normalize(),this}recast(Z){return this.origin.copy(this.at(Z,_vector$9)),this}closestPointToPoint(Z,_){_.subVectors(Z,this.origin);const K=_.dot(this.direction);return K<0?_.copy(this.origin):_.copy(this.origin).addScaledVector(this.direction,K)}distanceToPoint(Z){return Math.sqrt(this.distanceSqToPoint(Z))}distanceSqToPoint(Z){const _=_vector$9.subVectors(Z,this.origin).dot(this.direction);return _<0?this.origin.distanceToSquared(Z):(_vector$9.copy(this.origin).addScaledVector(this.direction,_),_vector$9.distanceToSquared(Z))}distanceSqToSegment(Z,_,K,te){_segCenter.copy(Z).add(_).multiplyScalar(.5),_segDir.copy(_).sub(Z).normalize(),_diff.copy(this.origin).sub(_segCenter);const ne=Z.distanceTo(_)*.5,oe=-this.direction.dot(_segDir),ie=_diff.dot(this.direction),se=-_diff.dot(_segDir),ae=_diff.lengthSq(),ge=Math.abs(1-oe*oe);let ce,de,pe,fe;if(ge>0)if(ce=oe*se-ie,de=oe*ie-se,fe=ne*ge,ce>=0)if(de>=-fe)if(de<=fe){const be=1/ge;ce*=be,de*=be,pe=ce*(ce+oe*de+2*ie)+de*(oe*ce+de+2*se)+ae}else de=ne,ce=Math.max(0,-(oe*de+ie)),pe=-ce*ce+de*(de+2*se)+ae;else de=-ne,ce=Math.max(0,-(oe*de+ie)),pe=-ce*ce+de*(de+2*se)+ae;else de<=-fe?(ce=Math.max(0,-(-oe*ne+ie)),de=ce>0?-ne:Math.min(Math.max(-ne,-se),ne),pe=-ce*ce+de*(de+2*se)+ae):de<=fe?(ce=0,de=Math.min(Math.max(-ne,-se),ne),pe=de*(de+2*se)+ae):(ce=Math.max(0,-(oe*ne+ie)),de=ce>0?ne:Math.min(Math.max(-ne,-se),ne),pe=-ce*ce+de*(de+2*se)+ae);else de=oe>0?-ne:ne,ce=Math.max(0,-(oe*de+ie)),pe=-ce*ce+de*(de+2*se)+ae;return K&&K.copy(this.origin).addScaledVector(this.direction,ce),te&&te.copy(_segCenter).addScaledVector(_segDir,de),pe}intersectSphere(Z,_){_vector$9.subVectors(Z.center,this.origin);const K=_vector$9.dot(this.direction),te=_vector$9.dot(_vector$9)-K*K,ne=Z.radius*Z.radius;if(te>ne)return null;const oe=Math.sqrt(ne-te),ie=K-oe,se=K+oe;return se<0?null:ie<0?this.at(se,_):this.at(ie,_)}intersectsSphere(Z){return this.distanceSqToPoint(Z.center)<=Z.radius*Z.radius}distanceToPlane(Z){const _=Z.normal.dot(this.direction);if(_===0)return Z.distanceToPoint(this.origin)===0?0:null;const K=-(this.origin.dot(Z.normal)+Z.constant)/_;return K>=0?K:null}intersectPlane(Z,_){const K=this.distanceToPlane(Z);return K===null?null:this.at(K,_)}intersectsPlane(Z){const _=Z.distanceToPoint(this.origin);return _===0||Z.normal.dot(this.direction)*_<0}intersectBox(Z,_){let K,te,ne,oe,ie,se;const ae=1/this.direction.x,ge=1/this.direction.y,ce=1/this.direction.z,de=this.origin;return ae>=0?(K=(Z.min.x-de.x)*ae,te=(Z.max.x-de.x)*ae):(K=(Z.max.x-de.x)*ae,te=(Z.min.x-de.x)*ae),ge>=0?(ne=(Z.min.y-de.y)*ge,oe=(Z.max.y-de.y)*ge):(ne=(Z.max.y-de.y)*ge,oe=(Z.min.y-de.y)*ge),K>oe||ne>te||((ne>K||isNaN(K))&&(K=ne),(oe<te||isNaN(te))&&(te=oe),ce>=0?(ie=(Z.min.z-de.z)*ce,se=(Z.max.z-de.z)*ce):(ie=(Z.max.z-de.z)*ce,se=(Z.min.z-de.z)*ce),K>se||ie>te)||((ie>K||K!==K)&&(K=ie),(se<te||te!==te)&&(te=se),te<0)?null:this.at(K>=0?K:te,_)}intersectsBox(Z){return this.intersectBox(Z,_vector$9)!==null}intersectTriangle(Z,_,K,te,ne){_edge1.subVectors(_,Z),_edge2.subVectors(K,Z),_normal$1.crossVectors(_edge1,_edge2);let oe=this.direction.dot(_normal$1),ie;if(oe>0){if(te)return null;ie=1}else if(oe<0)ie=-1,oe=-oe;else return null;_diff.subVectors(this.origin,Z);const se=ie*this.direction.dot(_edge2.crossVectors(_diff,_edge2));if(se<0)return null;const ae=ie*this.direction.dot(_edge1.cross(_diff));if(ae<0||se+ae>oe)return null;const ge=-ie*_diff.dot(_normal$1);return ge<0?null:this.at(ge/oe,ne)}applyMatrix4(Z){return this.origin.applyMatrix4(Z),this.direction.transformDirection(Z),this}equals(Z){return Z.origin.equals(this.origin)&&Z.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}};class Matrix4{constructor(Z,_,K,te,ne,oe,ie,se,ae,ge,ce,de,pe,fe,be,me){Matrix4.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],Z!==void 0&&this.set(Z,_,K,te,ne,oe,ie,se,ae,ge,ce,de,pe,fe,be,me)}set(Z,_,K,te,ne,oe,ie,se,ae,ge,ce,de,pe,fe,be,me){const ye=this.elements;return ye[0]=Z,ye[4]=_,ye[8]=K,ye[12]=te,ye[1]=ne,ye[5]=oe,ye[9]=ie,ye[13]=se,ye[2]=ae,ye[6]=ge,ye[10]=ce,ye[14]=de,ye[3]=pe,ye[7]=fe,ye[11]=be,ye[15]=me,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new Matrix4().fromArray(this.elements)}copy(Z){const _=this.elements,K=Z.elements;return _[0]=K[0],_[1]=K[1],_[2]=K[2],_[3]=K[3],_[4]=K[4],_[5]=K[5],_[6]=K[6],_[7]=K[7],_[8]=K[8],_[9]=K[9],_[10]=K[10],_[11]=K[11],_[12]=K[12],_[13]=K[13],_[14]=K[14],_[15]=K[15],this}copyPosition(Z){const _=this.elements,K=Z.elements;return _[12]=K[12],_[13]=K[13],_[14]=K[14],this}setFromMatrix3(Z){const _=Z.elements;return this.set(_[0],_[3],_[6],0,_[1],_[4],_[7],0,_[2],_[5],_[8],0,0,0,0,1),this}extractBasis(Z,_,K){return Z.setFromMatrixColumn(this,0),_.setFromMatrixColumn(this,1),K.setFromMatrixColumn(this,2),this}makeBasis(Z,_,K){return this.set(Z.x,_.x,K.x,0,Z.y,_.y,K.y,0,Z.z,_.z,K.z,0,0,0,0,1),this}extractRotation(Z){const _=this.elements,K=Z.elements,te=1/_v1$5.setFromMatrixColumn(Z,0).length(),ne=1/_v1$5.setFromMatrixColumn(Z,1).length(),oe=1/_v1$5.setFromMatrixColumn(Z,2).length();return _[0]=K[0]*te,_[1]=K[1]*te,_[2]=K[2]*te,_[3]=0,_[4]=K[4]*ne,_[5]=K[5]*ne,_[6]=K[6]*ne,_[7]=0,_[8]=K[8]*oe,_[9]=K[9]*oe,_[10]=K[10]*oe,_[11]=0,_[12]=0,_[13]=0,_[14]=0,_[15]=1,this}makeRotationFromEuler(Z){const _=this.elements,K=Z.x,te=Z.y,ne=Z.z,oe=Math.cos(K),ie=Math.sin(K),se=Math.cos(te),ae=Math.sin(te),ge=Math.cos(ne),ce=Math.sin(ne);if(Z.order==="XYZ"){const de=oe*ge,pe=oe*ce,fe=ie*ge,be=ie*ce;_[0]=se*ge,_[4]=-se*ce,_[8]=ae,_[1]=pe+fe*ae,_[5]=de-be*ae,_[9]=-ie*se,_[2]=be-de*ae,_[6]=fe+pe*ae,_[10]=oe*se}else if(Z.order==="YXZ"){const de=se*ge,pe=se*ce,fe=ae*ge,be=ae*ce;_[0]=de+be*ie,_[4]=fe*ie-pe,_[8]=oe*ae,_[1]=oe*ce,_[5]=oe*ge,_[9]=-ie,_[2]=pe*ie-fe,_[6]=be+de*ie,_[10]=oe*se}else if(Z.order==="ZXY"){const de=se*ge,pe=se*ce,fe=ae*ge,be=ae*ce;_[0]=de-be*ie,_[4]=-oe*ce,_[8]=fe+pe*ie,_[1]=pe+fe*ie,_[5]=oe*ge,_[9]=be-de*ie,_[2]=-oe*ae,_[6]=ie,_[10]=oe*se}else if(Z.order==="ZYX"){const de=oe*ge,pe=oe*ce,fe=ie*ge,be=ie*ce;_[0]=se*ge,_[4]=fe*ae-pe,_[8]=de*ae+be,_[1]=se*ce,_[5]=be*ae+de,_[9]=pe*ae-fe,_[2]=-ae,_[6]=ie*se,_[10]=oe*se}else if(Z.order==="YZX"){const de=oe*se,pe=oe*ae,fe=ie*se,be=ie*ae;_[0]=se*ge,_[4]=be-de*ce,_[8]=fe*ce+pe,_[1]=ce,_[5]=oe*ge,_[9]=-ie*ge,_[2]=-ae*ge,_[6]=pe*ce+fe,_[10]=de-be*ce}else if(Z.order==="XZY"){const de=oe*se,pe=oe*ae,fe=ie*se,be=ie*ae;_[0]=se*ge,_[4]=-ce,_[8]=ae*ge,_[1]=de*ce+be,_[5]=oe*ge,_[9]=pe*ce-fe,_[2]=fe*ce-pe,_[6]=ie*ge,_[10]=be*ce+de}return _[3]=0,_[7]=0,_[11]=0,_[12]=0,_[13]=0,_[14]=0,_[15]=1,this}makeRotationFromQuaternion(Z){return this.compose(_zero,Z,_one)}lookAt(Z,_,K){const te=this.elements;return _z.subVectors(Z,_),_z.lengthSq()===0&&(_z.z=1),_z.normalize(),_x.crossVectors(K,_z),_x.lengthSq()===0&&(Math.abs(K.z)===1?_z.x+=1e-4:_z.z+=1e-4,_z.normalize(),_x.crossVectors(K,_z)),_x.normalize(),_y.crossVectors(_z,_x),te[0]=_x.x,te[4]=_y.x,te[8]=_z.x,te[1]=_x.y,te[5]=_y.y,te[9]=_z.y,te[2]=_x.z,te[6]=_y.z,te[10]=_z.z,this}multiply(Z){return this.multiplyMatrices(this,Z)}premultiply(Z){return this.multiplyMatrices(Z,this)}multiplyMatrices(Z,_){const K=Z.elements,te=_.elements,ne=this.elements,oe=K[0],ie=K[4],se=K[8],ae=K[12],ge=K[1],ce=K[5],de=K[9],pe=K[13],fe=K[2],be=K[6],me=K[10],ye=K[14],ve=K[3],Be=K[7],Re=K[11],Ee=K[15],We=te[0],Ze=te[4],Ve=te[8],_e=te[12],Xe=te[1],Pe=te[5],He=te[9],Ke=te[13],Ue=te[2],tt=te[6],rt=te[10],at=te[14],Oe=te[3],$e=te[7],je=te[11],Te=te[15];return ne[0]=oe*We+ie*Xe+se*Ue+ae*Oe,ne[4]=oe*Ze+ie*Pe+se*tt+ae*$e,ne[8]=oe*Ve+ie*He+se*rt+ae*je,ne[12]=oe*_e+ie*Ke+se*at+ae*Te,ne[1]=ge*We+ce*Xe+de*Ue+pe*Oe,ne[5]=ge*Ze+ce*Pe+de*tt+pe*$e,ne[9]=ge*Ve+ce*He+de*rt+pe*je,ne[13]=ge*_e+ce*Ke+de*at+pe*Te,ne[2]=fe*We+be*Xe+me*Ue+ye*Oe,ne[6]=fe*Ze+be*Pe+me*tt+ye*$e,ne[10]=fe*Ve+be*He+me*rt+ye*je,ne[14]=fe*_e+be*Ke+me*at+ye*Te,ne[3]=ve*We+Be*Xe+Re*Ue+Ee*Oe,ne[7]=ve*Ze+Be*Pe+Re*tt+Ee*$e,ne[11]=ve*Ve+Be*He+Re*rt+Ee*je,ne[15]=ve*_e+Be*Ke+Re*at+Ee*Te,this}multiplyScalar(Z){const _=this.elements;return _[0]*=Z,_[4]*=Z,_[8]*=Z,_[12]*=Z,_[1]*=Z,_[5]*=Z,_[9]*=Z,_[13]*=Z,_[2]*=Z,_[6]*=Z,_[10]*=Z,_[14]*=Z,_[3]*=Z,_[7]*=Z,_[11]*=Z,_[15]*=Z,this}determinant(){const Z=this.elements,_=Z[0],K=Z[4],te=Z[8],ne=Z[12],oe=Z[1],ie=Z[5],se=Z[9],ae=Z[13],ge=Z[2],ce=Z[6],de=Z[10],pe=Z[14],fe=Z[3],be=Z[7],me=Z[11],ye=Z[15];return fe*(+ne*se*ce-te*ae*ce-ne*ie*de+K*ae*de+te*ie*pe-K*se*pe)+be*(+_*se*pe-_*ae*de+ne*oe*de-te*oe*pe+te*ae*ge-ne*se*ge)+me*(+_*ae*ce-_*ie*pe-ne*oe*ce+K*oe*pe+ne*ie*ge-K*ae*ge)+ye*(-te*ie*ge-_*se*ce+_*ie*de+te*oe*ce-K*oe*de+K*se*ge)}transpose(){const Z=this.elements;let _;return _=Z[1],Z[1]=Z[4],Z[4]=_,_=Z[2],Z[2]=Z[8],Z[8]=_,_=Z[6],Z[6]=Z[9],Z[9]=_,_=Z[3],Z[3]=Z[12],Z[12]=_,_=Z[7],Z[7]=Z[13],Z[13]=_,_=Z[11],Z[11]=Z[14],Z[14]=_,this}setPosition(Z,_,K){const te=this.elements;return Z.isVector3?(te[12]=Z.x,te[13]=Z.y,te[14]=Z.z):(te[12]=Z,te[13]=_,te[14]=K),this}invert(){const Z=this.elements,_=Z[0],K=Z[1],te=Z[2],ne=Z[3],oe=Z[4],ie=Z[5],se=Z[6],ae=Z[7],ge=Z[8],ce=Z[9],de=Z[10],pe=Z[11],fe=Z[12],be=Z[13],me=Z[14],ye=Z[15],ve=ce*me*ae-be*de*ae+be*se*pe-ie*me*pe-ce*se*ye+ie*de*ye,Be=fe*de*ae-ge*me*ae-fe*se*pe+oe*me*pe+ge*se*ye-oe*de*ye,Re=ge*be*ae-fe*ce*ae+fe*ie*pe-oe*be*pe-ge*ie*ye+oe*ce*ye,Ee=fe*ce*se-ge*be*se-fe*ie*de+oe*be*de+ge*ie*me-oe*ce*me,We=_*ve+K*Be+te*Re+ne*Ee;if(We===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const Ze=1/We;return Z[0]=ve*Ze,Z[1]=(be*de*ne-ce*me*ne-be*te*pe+K*me*pe+ce*te*ye-K*de*ye)*Ze,Z[2]=(ie*me*ne-be*se*ne+be*te*ae-K*me*ae-ie*te*ye+K*se*ye)*Ze,Z[3]=(ce*se*ne-ie*de*ne-ce*te*ae+K*de*ae+ie*te*pe-K*se*pe)*Ze,Z[4]=Be*Ze,Z[5]=(ge*me*ne-fe*de*ne+fe*te*pe-_*me*pe-ge*te*ye+_*de*ye)*Ze,Z[6]=(fe*se*ne-oe*me*ne-fe*te*ae+_*me*ae+oe*te*ye-_*se*ye)*Ze,Z[7]=(oe*de*ne-ge*se*ne+ge*te*ae-_*de*ae-oe*te*pe+_*se*pe)*Ze,Z[8]=Re*Ze,Z[9]=(fe*ce*ne-ge*be*ne-fe*K*pe+_*be*pe+ge*K*ye-_*ce*ye)*Ze,Z[10]=(oe*be*ne-fe*ie*ne+fe*K*ae-_*be*ae-oe*K*ye+_*ie*ye)*Ze,Z[11]=(ge*ie*ne-oe*ce*ne-ge*K*ae+_*ce*ae+oe*K*pe-_*ie*pe)*Ze,Z[12]=Ee*Ze,Z[13]=(ge*be*te-fe*ce*te+fe*K*de-_*be*de-ge*K*me+_*ce*me)*Ze,Z[14]=(fe*ie*te-oe*be*te-fe*K*se+_*be*se+oe*K*me-_*ie*me)*Ze,Z[15]=(oe*ce*te-ge*ie*te+ge*K*se-_*ce*se-oe*K*de+_*ie*de)*Ze,this}scale(Z){const _=this.elements,K=Z.x,te=Z.y,ne=Z.z;return _[0]*=K,_[4]*=te,_[8]*=ne,_[1]*=K,_[5]*=te,_[9]*=ne,_[2]*=K,_[6]*=te,_[10]*=ne,_[3]*=K,_[7]*=te,_[11]*=ne,this}getMaxScaleOnAxis(){const Z=this.elements,_=Z[0]*Z[0]+Z[1]*Z[1]+Z[2]*Z[2],K=Z[4]*Z[4]+Z[5]*Z[5]+Z[6]*Z[6],te=Z[8]*Z[8]+Z[9]*Z[9]+Z[10]*Z[10];return Math.sqrt(Math.max(_,K,te))}makeTranslation(Z,_,K){return Z.isVector3?this.set(1,0,0,Z.x,0,1,0,Z.y,0,0,1,Z.z,0,0,0,1):this.set(1,0,0,Z,0,1,0,_,0,0,1,K,0,0,0,1),this}makeRotationX(Z){const _=Math.cos(Z),K=Math.sin(Z);return this.set(1,0,0,0,0,_,-K,0,0,K,_,0,0,0,0,1),this}makeRotationY(Z){const _=Math.cos(Z),K=Math.sin(Z);return this.set(_,0,K,0,0,1,0,0,-K,0,_,0,0,0,0,1),this}makeRotationZ(Z){const _=Math.cos(Z),K=Math.sin(Z);return this.set(_,-K,0,0,K,_,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(Z,_){const K=Math.cos(_),te=Math.sin(_),ne=1-K,oe=Z.x,ie=Z.y,se=Z.z,ae=ne*oe,ge=ne*ie;return this.set(ae*oe+K,ae*ie-te*se,ae*se+te*ie,0,ae*ie+te*se,ge*ie+K,ge*se-te*oe,0,ae*se-te*ie,ge*se+te*oe,ne*se*se+K,0,0,0,0,1),this}makeScale(Z,_,K){return this.set(Z,0,0,0,0,_,0,0,0,0,K,0,0,0,0,1),this}makeShear(Z,_,K,te,ne,oe){return this.set(1,K,ne,0,Z,1,oe,0,_,te,1,0,0,0,0,1),this}compose(Z,_,K){const te=this.elements,ne=_._x,oe=_._y,ie=_._z,se=_._w,ae=ne+ne,ge=oe+oe,ce=ie+ie,de=ne*ae,pe=ne*ge,fe=ne*ce,be=oe*ge,me=oe*ce,ye=ie*ce,ve=se*ae,Be=se*ge,Re=se*ce,Ee=K.x,We=K.y,Ze=K.z;return te[0]=(1-(be+ye))*Ee,te[1]=(pe+Re)*Ee,te[2]=(fe-Be)*Ee,te[3]=0,te[4]=(pe-Re)*We,te[5]=(1-(de+ye))*We,te[6]=(me+ve)*We,te[7]=0,te[8]=(fe+Be)*Ze,te[9]=(me-ve)*Ze,te[10]=(1-(de+be))*Ze,te[11]=0,te[12]=Z.x,te[13]=Z.y,te[14]=Z.z,te[15]=1,this}decompose(Z,_,K){const te=this.elements;let ne=_v1$5.set(te[0],te[1],te[2]).length();const oe=_v1$5.set(te[4],te[5],te[6]).length(),ie=_v1$5.set(te[8],te[9],te[10]).length();this.determinant()<0&&(ne=-ne),Z.x=te[12],Z.y=te[13],Z.z=te[14],_m1$2.copy(this);const ae=1/ne,ge=1/oe,ce=1/ie;return _m1$2.elements[0]*=ae,_m1$2.elements[1]*=ae,_m1$2.elements[2]*=ae,_m1$2.elements[4]*=ge,_m1$2.elements[5]*=ge,_m1$2.elements[6]*=ge,_m1$2.elements[8]*=ce,_m1$2.elements[9]*=ce,_m1$2.elements[10]*=ce,_.setFromRotationMatrix(_m1$2),K.x=ne,K.y=oe,K.z=ie,this}makePerspective(Z,_,K,te,ne,oe,ie=WebGLCoordinateSystem){const se=this.elements,ae=2*ne/(_-Z),ge=2*ne/(K-te),ce=(_+Z)/(_-Z),de=(K+te)/(K-te);let pe,fe;if(ie===WebGLCoordinateSystem)pe=-(oe+ne)/(oe-ne),fe=-2*oe*ne/(oe-ne);else if(ie===WebGPUCoordinateSystem)pe=-oe/(oe-ne),fe=-oe*ne/(oe-ne);else throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+ie);return se[0]=ae,se[4]=0,se[8]=ce,se[12]=0,se[1]=0,se[5]=ge,se[9]=de,se[13]=0,se[2]=0,se[6]=0,se[10]=pe,se[14]=fe,se[3]=0,se[7]=0,se[11]=-1,se[15]=0,this}makeOrthographic(Z,_,K,te,ne,oe,ie=WebGLCoordinateSystem){const se=this.elements,ae=1/(_-Z),ge=1/(K-te),ce=1/(oe-ne),de=(_+Z)*ae,pe=(K+te)*ge;let fe,be;if(ie===WebGLCoordinateSystem)fe=(oe+ne)*ce,be=-2*ce;else if(ie===WebGPUCoordinateSystem)fe=ne*ce,be=-1*ce;else throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+ie);return se[0]=2*ae,se[4]=0,se[8]=0,se[12]=-de,se[1]=0,se[5]=2*ge,se[9]=0,se[13]=-pe,se[2]=0,se[6]=0,se[10]=be,se[14]=-fe,se[3]=0,se[7]=0,se[11]=0,se[15]=1,this}equals(Z){const _=this.elements,K=Z.elements;for(let te=0;te<16;te++)if(_[te]!==K[te])return!1;return!0}fromArray(Z,_=0){for(let K=0;K<16;K++)this.elements[K]=Z[K+_];return this}toArray(Z=[],_=0){const K=this.elements;return Z[_]=K[0],Z[_+1]=K[1],Z[_+2]=K[2],Z[_+3]=K[3],Z[_+4]=K[4],Z[_+5]=K[5],Z[_+6]=K[6],Z[_+7]=K[7],Z[_+8]=K[8],Z[_+9]=K[9],Z[_+10]=K[10],Z[_+11]=K[11],Z[_+12]=K[12],Z[_+13]=K[13],Z[_+14]=K[14],Z[_+15]=K[15],Z}}const _v1$5=new Vector3,_m1$2=new Matrix4,_zero=new Vector3(0,0,0),_one=new Vector3(1,1,1),_x=new Vector3,_y=new Vector3,_z=new Vector3,_matrix=new Matrix4,_quaternion$3=new Quaternion$2;class Euler{constructor(Z=0,_=0,K=0,te=Euler.DEFAULT_ORDER){this.isEuler=!0,this._x=Z,this._y=_,this._z=K,this._order=te}get x(){return this._x}set x(Z){this._x=Z,this._onChangeCallback()}get y(){return this._y}set y(Z){this._y=Z,this._onChangeCallback()}get z(){return this._z}set z(Z){this._z=Z,this._onChangeCallback()}get order(){return this._order}set order(Z){this._order=Z,this._onChangeCallback()}set(Z,_,K,te=this._order){return this._x=Z,this._y=_,this._z=K,this._order=te,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(Z){return this._x=Z._x,this._y=Z._y,this._z=Z._z,this._order=Z._order,this._onChangeCallback(),this}setFromRotationMatrix(Z,_=this._order,K=!0){const te=Z.elements,ne=te[0],oe=te[4],ie=te[8],se=te[1],ae=te[5],ge=te[9],ce=te[2],de=te[6],pe=te[10];switch(_){case"XYZ":this._y=Math.asin(clamp$3(ie,-1,1)),Math.abs(ie)<.9999999?(this._x=Math.atan2(-ge,pe),this._z=Math.atan2(-oe,ne)):(this._x=Math.atan2(de,ae),this._z=0);break;case"YXZ":this._x=Math.asin(-clamp$3(ge,-1,1)),Math.abs(ge)<.9999999?(this._y=Math.atan2(ie,pe),this._z=Math.atan2(se,ae)):(this._y=Math.atan2(-ce,ne),this._z=0);break;case"ZXY":this._x=Math.asin(clamp$3(de,-1,1)),Math.abs(de)<.9999999?(this._y=Math.atan2(-ce,pe),this._z=Math.atan2(-oe,ae)):(this._y=0,this._z=Math.atan2(se,ne));break;case"ZYX":this._y=Math.asin(-clamp$3(ce,-1,1)),Math.abs(ce)<.9999999?(this._x=Math.atan2(de,pe),this._z=Math.atan2(se,ne)):(this._x=0,this._z=Math.atan2(-oe,ae));break;case"YZX":this._z=Math.asin(clamp$3(se,-1,1)),Math.abs(se)<.9999999?(this._x=Math.atan2(-ge,ae),this._y=Math.atan2(-ce,ne)):(this._x=0,this._y=Math.atan2(ie,pe));break;case"XZY":this._z=Math.asin(-clamp$3(oe,-1,1)),Math.abs(oe)<.9999999?(this._x=Math.atan2(de,ae),this._y=Math.atan2(ie,ne)):(this._x=Math.atan2(-ge,pe),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+_)}return this._order=_,K===!0&&this._onChangeCallback(),this}setFromQuaternion(Z,_,K){return _matrix.makeRotationFromQuaternion(Z),this.setFromRotationMatrix(_matrix,_,K)}setFromVector3(Z,_=this._order){return this.set(Z.x,Z.y,Z.z,_)}reorder(Z){return _quaternion$3.setFromEuler(this),this.setFromQuaternion(_quaternion$3,Z)}equals(Z){return Z._x===this._x&&Z._y===this._y&&Z._z===this._z&&Z._order===this._order}fromArray(Z){return this._x=Z[0],this._y=Z[1],this._z=Z[2],Z[3]!==void 0&&(this._order=Z[3]),this._onChangeCallback(),this}toArray(Z=[],_=0){return Z[_]=this._x,Z[_+1]=this._y,Z[_+2]=this._z,Z[_+3]=this._order,Z}_onChange(Z){return this._onChangeCallback=Z,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}Euler.DEFAULT_ORDER="XYZ";class Layers{constructor(){this.mask=1}set(Z){this.mask=(1<<Z|0)>>>0}enable(Z){this.mask|=1<<Z|0}enableAll(){this.mask=-1}toggle(Z){this.mask^=1<<Z|0}disable(Z){this.mask&=~(1<<Z|0)}disableAll(){this.mask=0}test(Z){return(this.mask&Z.mask)!==0}isEnabled(Z){return(this.mask&(1<<Z|0))!==0}}let _object3DId=0;const _v1$4=new Vector3,_q1=new Quaternion$2,_m1$1=new Matrix4,_target=new Vector3,_position$3=new Vector3,_scale$2=new Vector3,_quaternion$2=new Quaternion$2,_xAxis=new Vector3(1,0,0),_yAxis=new Vector3(0,1,0),_zAxis=new Vector3(0,0,1),_addedEvent={type:"added"},_removedEvent={type:"removed"};class Object3D extends EventDispatcher{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:_object3DId++}),this.uuid=generateUUID$1(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Object3D.DEFAULT_UP.clone();const Z=new Vector3,_=new Euler,K=new Quaternion$2,te=new Vector3(1,1,1);function ne(){K.setFromEuler(_,!1)}function oe(){_.setFromQuaternion(K,void 0,!1)}_._onChange(ne),K._onChange(oe),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:Z},rotation:{configurable:!0,enumerable:!0,value:_},quaternion:{configurable:!0,enumerable:!0,value:K},scale:{configurable:!0,enumerable:!0,value:te},modelViewMatrix:{value:new Matrix4},normalMatrix:{value:new Matrix3}}),this.matrix=new Matrix4,this.matrixWorld=new Matrix4,this.matrixAutoUpdate=Object3D.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.matrixWorldAutoUpdate=Object3D.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.layers=new Layers,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeRender(){}onAfterRender(){}applyMatrix4(Z){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(Z),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(Z){return this.quaternion.premultiply(Z),this}setRotationFromAxisAngle(Z,_){this.quaternion.setFromAxisAngle(Z,_)}setRotationFromEuler(Z){this.quaternion.setFromEuler(Z,!0)}setRotationFromMatrix(Z){this.quaternion.setFromRotationMatrix(Z)}setRotationFromQuaternion(Z){this.quaternion.copy(Z)}rotateOnAxis(Z,_){return _q1.setFromAxisAngle(Z,_),this.quaternion.multiply(_q1),this}rotateOnWorldAxis(Z,_){return _q1.setFromAxisAngle(Z,_),this.quaternion.premultiply(_q1),this}rotateX(Z){return this.rotateOnAxis(_xAxis,Z)}rotateY(Z){return this.rotateOnAxis(_yAxis,Z)}rotateZ(Z){return this.rotateOnAxis(_zAxis,Z)}translateOnAxis(Z,_){return _v1$4.copy(Z).applyQuaternion(this.quaternion),this.position.add(_v1$4.multiplyScalar(_)),this}translateX(Z){return this.translateOnAxis(_xAxis,Z)}translateY(Z){return this.translateOnAxis(_yAxis,Z)}translateZ(Z){return this.translateOnAxis(_zAxis,Z)}localToWorld(Z){return this.updateWorldMatrix(!0,!1),Z.applyMatrix4(this.matrixWorld)}worldToLocal(Z){return this.updateWorldMatrix(!0,!1),Z.applyMatrix4(_m1$1.copy(this.matrixWorld).invert())}lookAt(Z,_,K){Z.isVector3?_target.copy(Z):_target.set(Z,_,K);const te=this.parent;this.updateWorldMatrix(!0,!1),_position$3.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?_m1$1.lookAt(_position$3,_target,this.up):_m1$1.lookAt(_target,_position$3,this.up),this.quaternion.setFromRotationMatrix(_m1$1),te&&(_m1$1.extractRotation(te.matrixWorld),_q1.setFromRotationMatrix(_m1$1),this.quaternion.premultiply(_q1.invert()))}add(Z){if(arguments.length>1){for(let _=0;_<arguments.length;_++)this.add(arguments[_]);return this}return Z===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",Z),this):(Z&&Z.isObject3D?(Z.parent!==null&&Z.parent.remove(Z),Z.parent=this,this.children.push(Z),Z.dispatchEvent(_addedEvent)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",Z),this)}remove(Z){if(arguments.length>1){for(let K=0;K<arguments.length;K++)this.remove(arguments[K]);return this}const _=this.children.indexOf(Z);return _!==-1&&(Z.parent=null,this.children.splice(_,1),Z.dispatchEvent(_removedEvent)),this}removeFromParent(){const Z=this.parent;return Z!==null&&Z.remove(this),this}clear(){for(let Z=0;Z<this.children.length;Z++){const _=this.children[Z];_.parent=null,_.dispatchEvent(_removedEvent)}return this.children.length=0,this}attach(Z){return this.updateWorldMatrix(!0,!1),_m1$1.copy(this.matrixWorld).invert(),Z.parent!==null&&(Z.parent.updateWorldMatrix(!0,!1),_m1$1.multiply(Z.parent.matrixWorld)),Z.applyMatrix4(_m1$1),this.add(Z),Z.updateWorldMatrix(!1,!0),this}getObjectById(Z){return this.getObjectByProperty("id",Z)}getObjectByName(Z){return this.getObjectByProperty("name",Z)}getObjectByProperty(Z,_){if(this[Z]===_)return this;for(let K=0,te=this.children.length;K<te;K++){const oe=this.children[K].getObjectByProperty(Z,_);if(oe!==void 0)return oe}}getObjectsByProperty(Z,_){let K=[];this[Z]===_&&K.push(this);for(let te=0,ne=this.children.length;te<ne;te++){const oe=this.children[te].getObjectsByProperty(Z,_);oe.length>0&&(K=K.concat(oe))}return K}getWorldPosition(Z){return this.updateWorldMatrix(!0,!1),Z.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(Z){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(_position$3,Z,_scale$2),Z}getWorldScale(Z){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(_position$3,_quaternion$2,Z),Z}getWorldDirection(Z){this.updateWorldMatrix(!0,!1);const _=this.matrixWorld.elements;return Z.set(_[8],_[9],_[10]).normalize()}raycast(){}traverse(Z){Z(this);const _=this.children;for(let K=0,te=_.length;K<te;K++)_[K].traverse(Z)}traverseVisible(Z){if(this.visible===!1)return;Z(this);const _=this.children;for(let K=0,te=_.length;K<te;K++)_[K].traverseVisible(Z)}traverseAncestors(Z){const _=this.parent;_!==null&&(Z(_),_.traverseAncestors(Z))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(Z){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||Z)&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,Z=!0);const _=this.children;for(let K=0,te=_.length;K<te;K++){const ne=_[K];(ne.matrixWorldAutoUpdate===!0||Z===!0)&&ne.updateMatrixWorld(Z)}}updateWorldMatrix(Z,_){const K=this.parent;if(Z===!0&&K!==null&&K.matrixWorldAutoUpdate===!0&&K.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),_===!0){const te=this.children;for(let ne=0,oe=te.length;ne<oe;ne++){const ie=te[ne];ie.matrixWorldAutoUpdate===!0&&ie.updateWorldMatrix(!1,!0)}}}toJSON(Z){const _=Z===void 0||typeof Z=="string",K={};_&&(Z={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},K.metadata={version:4.6,type:"Object",generator:"Object3D.toJSON"});const te={};te.uuid=this.uuid,te.type=this.type,this.name!==""&&(te.name=this.name),this.castShadow===!0&&(te.castShadow=!0),this.receiveShadow===!0&&(te.receiveShadow=!0),this.visible===!1&&(te.visible=!1),this.frustumCulled===!1&&(te.frustumCulled=!1),this.renderOrder!==0&&(te.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(te.userData=this.userData),te.layers=this.layers.mask,te.matrix=this.matrix.toArray(),te.up=this.up.toArray(),this.matrixAutoUpdate===!1&&(te.matrixAutoUpdate=!1),this.isInstancedMesh&&(te.type="InstancedMesh",te.count=this.count,te.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(te.instanceColor=this.instanceColor.toJSON()));function ne(ie,se){return ie[se.uuid]===void 0&&(ie[se.uuid]=se.toJSON(Z)),se.uuid}if(this.isScene)this.background&&(this.background.isColor?te.background=this.background.toJSON():this.background.isTexture&&(te.background=this.background.toJSON(Z).uuid)),this.environment&&this.environment.isTexture&&this.environment.isRenderTargetTexture!==!0&&(te.environment=this.environment.toJSON(Z).uuid);else if(this.isMesh||this.isLine||this.isPoints){te.geometry=ne(Z.geometries,this.geometry);const ie=this.geometry.parameters;if(ie!==void 0&&ie.shapes!==void 0){const se=ie.shapes;if(Array.isArray(se))for(let ae=0,ge=se.length;ae<ge;ae++){const ce=se[ae];ne(Z.shapes,ce)}else ne(Z.shapes,se)}}if(this.isSkinnedMesh&&(te.bindMode=this.bindMode,te.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(ne(Z.skeletons,this.skeleton),te.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){const ie=[];for(let se=0,ae=this.material.length;se<ae;se++)ie.push(ne(Z.materials,this.material[se]));te.material=ie}else te.material=ne(Z.materials,this.material);if(this.children.length>0){te.children=[];for(let ie=0;ie<this.children.length;ie++)te.children.push(this.children[ie].toJSON(Z).object)}if(this.animations.length>0){te.animations=[];for(let ie=0;ie<this.animations.length;ie++){const se=this.animations[ie];te.animations.push(ne(Z.animations,se))}}if(_){const ie=oe(Z.geometries),se=oe(Z.materials),ae=oe(Z.textures),ge=oe(Z.images),ce=oe(Z.shapes),de=oe(Z.skeletons),pe=oe(Z.animations),fe=oe(Z.nodes);ie.length>0&&(K.geometries=ie),se.length>0&&(K.materials=se),ae.length>0&&(K.textures=ae),ge.length>0&&(K.images=ge),ce.length>0&&(K.shapes=ce),de.length>0&&(K.skeletons=de),pe.length>0&&(K.animations=pe),fe.length>0&&(K.nodes=fe)}return K.object=te,K;function oe(ie){const se=[];for(const ae in ie){const ge=ie[ae];delete ge.metadata,se.push(ge)}return se}}clone(Z){return new this.constructor().copy(this,Z)}copy(Z,_=!0){if(this.name=Z.name,this.up.copy(Z.up),this.position.copy(Z.position),this.rotation.order=Z.rotation.order,this.quaternion.copy(Z.quaternion),this.scale.copy(Z.scale),this.matrix.copy(Z.matrix),this.matrixWorld.copy(Z.matrixWorld),this.matrixAutoUpdate=Z.matrixAutoUpdate,this.matrixWorldNeedsUpdate=Z.matrixWorldNeedsUpdate,this.matrixWorldAutoUpdate=Z.matrixWorldAutoUpdate,this.layers.mask=Z.layers.mask,this.visible=Z.visible,this.castShadow=Z.castShadow,this.receiveShadow=Z.receiveShadow,this.frustumCulled=Z.frustumCulled,this.renderOrder=Z.renderOrder,this.animations=Z.animations,this.userData=JSON.parse(JSON.stringify(Z.userData)),_===!0)for(let K=0;K<Z.children.length;K++){const te=Z.children[K];this.add(te.clone())}return this}}Object3D.DEFAULT_UP=new Vector3(0,1,0);Object3D.DEFAULT_MATRIX_AUTO_UPDATE=!0;Object3D.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;const _v0$1=new Vector3,_v1$3=new Vector3,_v2$2=new Vector3,_v3$1=new Vector3,_vab=new Vector3,_vac=new Vector3,_vbc=new Vector3,_vap=new Vector3,_vbp=new Vector3,_vcp=new Vector3;let warnedGetUV=!1;class Triangle{constructor(Z=new Vector3,_=new Vector3,K=new Vector3){this.a=Z,this.b=_,this.c=K}static getNormal(Z,_,K,te){te.subVectors(K,_),_v0$1.subVectors(Z,_),te.cross(_v0$1);const ne=te.lengthSq();return ne>0?te.multiplyScalar(1/Math.sqrt(ne)):te.set(0,0,0)}static getBarycoord(Z,_,K,te,ne){_v0$1.subVectors(te,_),_v1$3.subVectors(K,_),_v2$2.subVectors(Z,_);const oe=_v0$1.dot(_v0$1),ie=_v0$1.dot(_v1$3),se=_v0$1.dot(_v2$2),ae=_v1$3.dot(_v1$3),ge=_v1$3.dot(_v2$2),ce=oe*ae-ie*ie;if(ce===0)return ne.set(-2,-1,-1);const de=1/ce,pe=(ae*se-ie*ge)*de,fe=(oe*ge-ie*se)*de;return ne.set(1-pe-fe,fe,pe)}static containsPoint(Z,_,K,te){return this.getBarycoord(Z,_,K,te,_v3$1),_v3$1.x>=0&&_v3$1.y>=0&&_v3$1.x+_v3$1.y<=1}static getUV(Z,_,K,te,ne,oe,ie,se){return warnedGetUV===!1&&(console.warn("THREE.Triangle.getUV() has been renamed to THREE.Triangle.getInterpolation()."),warnedGetUV=!0),this.getInterpolation(Z,_,K,te,ne,oe,ie,se)}static getInterpolation(Z,_,K,te,ne,oe,ie,se){return this.getBarycoord(Z,_,K,te,_v3$1),se.setScalar(0),se.addScaledVector(ne,_v3$1.x),se.addScaledVector(oe,_v3$1.y),se.addScaledVector(ie,_v3$1.z),se}static isFrontFacing(Z,_,K,te){return _v0$1.subVectors(K,_),_v1$3.subVectors(Z,_),_v0$1.cross(_v1$3).dot(te)<0}set(Z,_,K){return this.a.copy(Z),this.b.copy(_),this.c.copy(K),this}setFromPointsAndIndices(Z,_,K,te){return this.a.copy(Z[_]),this.b.copy(Z[K]),this.c.copy(Z[te]),this}setFromAttributeAndIndices(Z,_,K,te){return this.a.fromBufferAttribute(Z,_),this.b.fromBufferAttribute(Z,K),this.c.fromBufferAttribute(Z,te),this}clone(){return new this.constructor().copy(this)}copy(Z){return this.a.copy(Z.a),this.b.copy(Z.b),this.c.copy(Z.c),this}getArea(){return _v0$1.subVectors(this.c,this.b),_v1$3.subVectors(this.a,this.b),_v0$1.cross(_v1$3).length()*.5}getMidpoint(Z){return Z.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(Z){return Triangle.getNormal(this.a,this.b,this.c,Z)}getPlane(Z){return Z.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(Z,_){return Triangle.getBarycoord(Z,this.a,this.b,this.c,_)}getUV(Z,_,K,te,ne){return warnedGetUV===!1&&(console.warn("THREE.Triangle.getUV() has been renamed to THREE.Triangle.getInterpolation()."),warnedGetUV=!0),Triangle.getInterpolation(Z,this.a,this.b,this.c,_,K,te,ne)}getInterpolation(Z,_,K,te,ne){return Triangle.getInterpolation(Z,this.a,this.b,this.c,_,K,te,ne)}containsPoint(Z){return Triangle.containsPoint(Z,this.a,this.b,this.c)}isFrontFacing(Z){return Triangle.isFrontFacing(this.a,this.b,this.c,Z)}intersectsBox(Z){return Z.intersectsTriangle(this)}closestPointToPoint(Z,_){const K=this.a,te=this.b,ne=this.c;let oe,ie;_vab.subVectors(te,K),_vac.subVectors(ne,K),_vap.subVectors(Z,K);const se=_vab.dot(_vap),ae=_vac.dot(_vap);if(se<=0&&ae<=0)return _.copy(K);_vbp.subVectors(Z,te);const ge=_vab.dot(_vbp),ce=_vac.dot(_vbp);if(ge>=0&&ce<=ge)return _.copy(te);const de=se*ce-ge*ae;if(de<=0&&se>=0&&ge<=0)return oe=se/(se-ge),_.copy(K).addScaledVector(_vab,oe);_vcp.subVectors(Z,ne);const pe=_vab.dot(_vcp),fe=_vac.dot(_vcp);if(fe>=0&&pe<=fe)return _.copy(ne);const be=pe*ae-se*fe;if(be<=0&&ae>=0&&fe<=0)return ie=ae/(ae-fe),_.copy(K).addScaledVector(_vac,ie);const me=ge*fe-pe*ce;if(me<=0&&ce-ge>=0&&pe-fe>=0)return _vbc.subVectors(ne,te),ie=(ce-ge)/(ce-ge+(pe-fe)),_.copy(te).addScaledVector(_vbc,ie);const ye=1/(me+be+de);return oe=be*ye,ie=de*ye,_.copy(K).addScaledVector(_vab,oe).addScaledVector(_vac,ie)}equals(Z){return Z.a.equals(this.a)&&Z.b.equals(this.b)&&Z.c.equals(this.c)}}let materialId=0;class Material extends EventDispatcher{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:materialId++}),this.uuid=generateUUID$1(),this.name="",this.type="Material",this.blending=NormalBlending,this.side=FrontSide,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.alphaHash=!1,this.blendSrc=SrcAlphaFactor,this.blendDst=OneMinusSrcAlphaFactor,this.blendEquation=AddEquation,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=LessEqualDepth,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=AlwaysStencilFunc,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=KeepStencilOp,this.stencilZFail=KeepStencilOp,this.stencilZPass=KeepStencilOp,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(Z){this._alphaTest>0!=Z>0&&this.version++,this._alphaTest=Z}onBuild(){}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(Z){if(Z!==void 0)for(const _ in Z){const K=Z[_];if(K===void 0){console.warn(`THREE.Material: parameter '${_}' has value of undefined.`);continue}const te=this[_];if(te===void 0){console.warn(`THREE.Material: '${_}' is not a property of THREE.${this.type}.`);continue}te&&te.isColor?te.set(K):te&&te.isVector3&&K&&K.isVector3?te.copy(K):this[_]=K}}toJSON(Z){const _=Z===void 0||typeof Z=="string";_&&(Z={textures:{},images:{}});const K={metadata:{version:4.6,type:"Material",generator:"Material.toJSON"}};K.uuid=this.uuid,K.type=this.type,this.name!==""&&(K.name=this.name),this.color&&this.color.isColor&&(K.color=this.color.getHex()),this.roughness!==void 0&&(K.roughness=this.roughness),this.metalness!==void 0&&(K.metalness=this.metalness),this.sheen!==void 0&&(K.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(K.sheenColor=this.sheenColor.getHex()),this.sheenRoughness!==void 0&&(K.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(K.emissive=this.emissive.getHex()),this.emissiveIntensity&&this.emissiveIntensity!==1&&(K.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(K.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(K.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(K.specularColor=this.specularColor.getHex()),this.shininess!==void 0&&(K.shininess=this.shininess),this.clearcoat!==void 0&&(K.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(K.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(K.clearcoatMap=this.clearcoatMap.toJSON(Z).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(K.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(Z).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(K.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(Z).uuid,K.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.iridescence!==void 0&&(K.iridescence=this.iridescence),this.iridescenceIOR!==void 0&&(K.iridescenceIOR=this.iridescenceIOR),this.iridescenceThicknessRange!==void 0&&(K.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(K.iridescenceMap=this.iridescenceMap.toJSON(Z).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(K.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(Z).uuid),this.anisotropy!==void 0&&(K.anisotropy=this.anisotropy),this.anisotropyRotation!==void 0&&(K.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(K.anisotropyMap=this.anisotropyMap.toJSON(Z).uuid),this.map&&this.map.isTexture&&(K.map=this.map.toJSON(Z).uuid),this.matcap&&this.matcap.isTexture&&(K.matcap=this.matcap.toJSON(Z).uuid),this.alphaMap&&this.alphaMap.isTexture&&(K.alphaMap=this.alphaMap.toJSON(Z).uuid),this.lightMap&&this.lightMap.isTexture&&(K.lightMap=this.lightMap.toJSON(Z).uuid,K.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(K.aoMap=this.aoMap.toJSON(Z).uuid,K.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(K.bumpMap=this.bumpMap.toJSON(Z).uuid,K.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(K.normalMap=this.normalMap.toJSON(Z).uuid,K.normalMapType=this.normalMapType,K.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(K.displacementMap=this.displacementMap.toJSON(Z).uuid,K.displacementScale=this.displacementScale,K.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(K.roughnessMap=this.roughnessMap.toJSON(Z).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(K.metalnessMap=this.metalnessMap.toJSON(Z).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(K.emissiveMap=this.emissiveMap.toJSON(Z).uuid),this.specularMap&&this.specularMap.isTexture&&(K.specularMap=this.specularMap.toJSON(Z).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(K.specularIntensityMap=this.specularIntensityMap.toJSON(Z).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(K.specularColorMap=this.specularColorMap.toJSON(Z).uuid),this.envMap&&this.envMap.isTexture&&(K.envMap=this.envMap.toJSON(Z).uuid,this.combine!==void 0&&(K.combine=this.combine)),this.envMapIntensity!==void 0&&(K.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(K.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(K.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(K.gradientMap=this.gradientMap.toJSON(Z).uuid),this.transmission!==void 0&&(K.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(K.transmissionMap=this.transmissionMap.toJSON(Z).uuid),this.thickness!==void 0&&(K.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(K.thicknessMap=this.thicknessMap.toJSON(Z).uuid),this.attenuationDistance!==void 0&&this.attenuationDistance!==1/0&&(K.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&(K.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&(K.size=this.size),this.shadowSide!==null&&(K.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(K.sizeAttenuation=this.sizeAttenuation),this.blending!==NormalBlending&&(K.blending=this.blending),this.side!==FrontSide&&(K.side=this.side),this.vertexColors&&(K.vertexColors=!0),this.opacity<1&&(K.opacity=this.opacity),this.transparent===!0&&(K.transparent=this.transparent),K.depthFunc=this.depthFunc,K.depthTest=this.depthTest,K.depthWrite=this.depthWrite,K.colorWrite=this.colorWrite,K.stencilWrite=this.stencilWrite,K.stencilWriteMask=this.stencilWriteMask,K.stencilFunc=this.stencilFunc,K.stencilRef=this.stencilRef,K.stencilFuncMask=this.stencilFuncMask,K.stencilFail=this.stencilFail,K.stencilZFail=this.stencilZFail,K.stencilZPass=this.stencilZPass,this.rotation!==void 0&&this.rotation!==0&&(K.rotation=this.rotation),this.polygonOffset===!0&&(K.polygonOffset=!0),this.polygonOffsetFactor!==0&&(K.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(K.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth!==void 0&&this.linewidth!==1&&(K.linewidth=this.linewidth),this.dashSize!==void 0&&(K.dashSize=this.dashSize),this.gapSize!==void 0&&(K.gapSize=this.gapSize),this.scale!==void 0&&(K.scale=this.scale),this.dithering===!0&&(K.dithering=!0),this.alphaTest>0&&(K.alphaTest=this.alphaTest),this.alphaHash===!0&&(K.alphaHash=this.alphaHash),this.alphaToCoverage===!0&&(K.alphaToCoverage=this.alphaToCoverage),this.premultipliedAlpha===!0&&(K.premultipliedAlpha=this.premultipliedAlpha),this.forceSinglePass===!0&&(K.forceSinglePass=this.forceSinglePass),this.wireframe===!0&&(K.wireframe=this.wireframe),this.wireframeLinewidth>1&&(K.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(K.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(K.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(K.flatShading=this.flatShading),this.visible===!1&&(K.visible=!1),this.toneMapped===!1&&(K.toneMapped=!1),this.fog===!1&&(K.fog=!1),Object.keys(this.userData).length>0&&(K.userData=this.userData);function te(ne){const oe=[];for(const ie in ne){const se=ne[ie];delete se.metadata,oe.push(se)}return oe}if(_){const ne=te(Z.textures),oe=te(Z.images);ne.length>0&&(K.textures=ne),oe.length>0&&(K.images=oe)}return K}clone(){return new this.constructor().copy(this)}copy(Z){this.name=Z.name,this.blending=Z.blending,this.side=Z.side,this.vertexColors=Z.vertexColors,this.opacity=Z.opacity,this.transparent=Z.transparent,this.blendSrc=Z.blendSrc,this.blendDst=Z.blendDst,this.blendEquation=Z.blendEquation,this.blendSrcAlpha=Z.blendSrcAlpha,this.blendDstAlpha=Z.blendDstAlpha,this.blendEquationAlpha=Z.blendEquationAlpha,this.depthFunc=Z.depthFunc,this.depthTest=Z.depthTest,this.depthWrite=Z.depthWrite,this.stencilWriteMask=Z.stencilWriteMask,this.stencilFunc=Z.stencilFunc,this.stencilRef=Z.stencilRef,this.stencilFuncMask=Z.stencilFuncMask,this.stencilFail=Z.stencilFail,this.stencilZFail=Z.stencilZFail,this.stencilZPass=Z.stencilZPass,this.stencilWrite=Z.stencilWrite;const _=Z.clippingPlanes;let K=null;if(_!==null){const te=_.length;K=new Array(te);for(let ne=0;ne!==te;++ne)K[ne]=_[ne].clone()}return this.clippingPlanes=K,this.clipIntersection=Z.clipIntersection,this.clipShadows=Z.clipShadows,this.shadowSide=Z.shadowSide,this.colorWrite=Z.colorWrite,this.precision=Z.precision,this.polygonOffset=Z.polygonOffset,this.polygonOffsetFactor=Z.polygonOffsetFactor,this.polygonOffsetUnits=Z.polygonOffsetUnits,this.dithering=Z.dithering,this.alphaTest=Z.alphaTest,this.alphaHash=Z.alphaHash,this.alphaToCoverage=Z.alphaToCoverage,this.premultipliedAlpha=Z.premultipliedAlpha,this.forceSinglePass=Z.forceSinglePass,this.visible=Z.visible,this.toneMapped=Z.toneMapped,this.userData=JSON.parse(JSON.stringify(Z.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(Z){Z===!0&&this.version++}}const _colorKeywords={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},_hslA={h:0,s:0,l:0},_hslB={h:0,s:0,l:0};function hue2rgb$1(X,Z,_){return _<0&&(_+=1),_>1&&(_-=1),_<1/6?X+(Z-X)*6*_:_<1/2?Z:_<2/3?X+(Z-X)*6*(2/3-_):X}let Color$1=class{constructor(Z,_,K){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(Z,_,K)}set(Z,_,K){if(_===void 0&&K===void 0){const te=Z;te&&te.isColor?this.copy(te):typeof te=="number"?this.setHex(te):typeof te=="string"&&this.setStyle(te)}else this.setRGB(Z,_,K);return this}setScalar(Z){return this.r=Z,this.g=Z,this.b=Z,this}setHex(Z,_=SRGBColorSpace$1){return Z=Math.floor(Z),this.r=(Z>>16&255)/255,this.g=(Z>>8&255)/255,this.b=(Z&255)/255,ColorManagement.toWorkingColorSpace(this,_),this}setRGB(Z,_,K,te=ColorManagement.workingColorSpace){return this.r=Z,this.g=_,this.b=K,ColorManagement.toWorkingColorSpace(this,te),this}setHSL(Z,_,K,te=ColorManagement.workingColorSpace){if(Z=euclideanModulo(Z,1),_=clamp$3(_,0,1),K=clamp$3(K,0,1),_===0)this.r=this.g=this.b=K;else{const ne=K<=.5?K*(1+_):K+_-K*_,oe=2*K-ne;this.r=hue2rgb$1(oe,ne,Z+1/3),this.g=hue2rgb$1(oe,ne,Z),this.b=hue2rgb$1(oe,ne,Z-1/3)}return ColorManagement.toWorkingColorSpace(this,te),this}setStyle(Z,_=SRGBColorSpace$1){function K(ne){ne!==void 0&&parseFloat(ne)<1&&console.warn("THREE.Color: Alpha component of "+Z+" will be ignored.")}let te;if(te=/^(\w+)\(([^\)]*)\)/.exec(Z)){let ne;const oe=te[1],ie=te[2];switch(oe){case"rgb":case"rgba":if(ne=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(ie))return K(ne[4]),this.setRGB(Math.min(255,parseInt(ne[1],10))/255,Math.min(255,parseInt(ne[2],10))/255,Math.min(255,parseInt(ne[3],10))/255,_);if(ne=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(ie))return K(ne[4]),this.setRGB(Math.min(100,parseInt(ne[1],10))/100,Math.min(100,parseInt(ne[2],10))/100,Math.min(100,parseInt(ne[3],10))/100,_);break;case"hsl":case"hsla":if(ne=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(ie))return K(ne[4]),this.setHSL(parseFloat(ne[1])/360,parseFloat(ne[2])/100,parseFloat(ne[3])/100,_);break;default:console.warn("THREE.Color: Unknown color model "+Z)}}else if(te=/^\#([A-Fa-f\d]+)$/.exec(Z)){const ne=te[1],oe=ne.length;if(oe===3)return this.setRGB(parseInt(ne.charAt(0),16)/15,parseInt(ne.charAt(1),16)/15,parseInt(ne.charAt(2),16)/15,_);if(oe===6)return this.setHex(parseInt(ne,16),_);console.warn("THREE.Color: Invalid hex color "+Z)}else if(Z&&Z.length>0)return this.setColorName(Z,_);return this}setColorName(Z,_=SRGBColorSpace$1){const K=_colorKeywords[Z.toLowerCase()];return K!==void 0?this.setHex(K,_):console.warn("THREE.Color: Unknown color "+Z),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(Z){return this.r=Z.r,this.g=Z.g,this.b=Z.b,this}copySRGBToLinear(Z){return this.r=SRGBToLinear(Z.r),this.g=SRGBToLinear(Z.g),this.b=SRGBToLinear(Z.b),this}copyLinearToSRGB(Z){return this.r=LinearToSRGB(Z.r),this.g=LinearToSRGB(Z.g),this.b=LinearToSRGB(Z.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(Z=SRGBColorSpace$1){return ColorManagement.fromWorkingColorSpace(_color.copy(this),Z),Math.round(clamp$3(_color.r*255,0,255))*65536+Math.round(clamp$3(_color.g*255,0,255))*256+Math.round(clamp$3(_color.b*255,0,255))}getHexString(Z=SRGBColorSpace$1){return("000000"+this.getHex(Z).toString(16)).slice(-6)}getHSL(Z,_=ColorManagement.workingColorSpace){ColorManagement.fromWorkingColorSpace(_color.copy(this),_);const K=_color.r,te=_color.g,ne=_color.b,oe=Math.max(K,te,ne),ie=Math.min(K,te,ne);let se,ae;const ge=(ie+oe)/2;if(ie===oe)se=0,ae=0;else{const ce=oe-ie;switch(ae=ge<=.5?ce/(oe+ie):ce/(2-oe-ie),oe){case K:se=(te-ne)/ce+(te<ne?6:0);break;case te:se=(ne-K)/ce+2;break;case ne:se=(K-te)/ce+4;break}se/=6}return Z.h=se,Z.s=ae,Z.l=ge,Z}getRGB(Z,_=ColorManagement.workingColorSpace){return ColorManagement.fromWorkingColorSpace(_color.copy(this),_),Z.r=_color.r,Z.g=_color.g,Z.b=_color.b,Z}getStyle(Z=SRGBColorSpace$1){ColorManagement.fromWorkingColorSpace(_color.copy(this),Z);const _=_color.r,K=_color.g,te=_color.b;return Z!==SRGBColorSpace$1?`color(${Z} ${_.toFixed(3)} ${K.toFixed(3)} ${te.toFixed(3)})`:`rgb(${Math.round(_*255)},${Math.round(K*255)},${Math.round(te*255)})`}offsetHSL(Z,_,K){return this.getHSL(_hslA),_hslA.h+=Z,_hslA.s+=_,_hslA.l+=K,this.setHSL(_hslA.h,_hslA.s,_hslA.l),this}add(Z){return this.r+=Z.r,this.g+=Z.g,this.b+=Z.b,this}addColors(Z,_){return this.r=Z.r+_.r,this.g=Z.g+_.g,this.b=Z.b+_.b,this}addScalar(Z){return this.r+=Z,this.g+=Z,this.b+=Z,this}sub(Z){return this.r=Math.max(0,this.r-Z.r),this.g=Math.max(0,this.g-Z.g),this.b=Math.max(0,this.b-Z.b),this}multiply(Z){return this.r*=Z.r,this.g*=Z.g,this.b*=Z.b,this}multiplyScalar(Z){return this.r*=Z,this.g*=Z,this.b*=Z,this}lerp(Z,_){return this.r+=(Z.r-this.r)*_,this.g+=(Z.g-this.g)*_,this.b+=(Z.b-this.b)*_,this}lerpColors(Z,_,K){return this.r=Z.r+(_.r-Z.r)*K,this.g=Z.g+(_.g-Z.g)*K,this.b=Z.b+(_.b-Z.b)*K,this}lerpHSL(Z,_){this.getHSL(_hslA),Z.getHSL(_hslB);const K=lerp(_hslA.h,_hslB.h,_),te=lerp(_hslA.s,_hslB.s,_),ne=lerp(_hslA.l,_hslB.l,_);return this.setHSL(K,te,ne),this}setFromVector3(Z){return this.r=Z.x,this.g=Z.y,this.b=Z.z,this}applyMatrix3(Z){const _=this.r,K=this.g,te=this.b,ne=Z.elements;return this.r=ne[0]*_+ne[3]*K+ne[6]*te,this.g=ne[1]*_+ne[4]*K+ne[7]*te,this.b=ne[2]*_+ne[5]*K+ne[8]*te,this}equals(Z){return Z.r===this.r&&Z.g===this.g&&Z.b===this.b}fromArray(Z,_=0){return this.r=Z[_],this.g=Z[_+1],this.b=Z[_+2],this}toArray(Z=[],_=0){return Z[_]=this.r,Z[_+1]=this.g,Z[_+2]=this.b,Z}fromBufferAttribute(Z,_){return this.r=Z.getX(_),this.g=Z.getY(_),this.b=Z.getZ(_),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}};const _color=new Color$1;Color$1.NAMES=_colorKeywords;class MeshBasicMaterial extends Material{constructor(Z){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new Color$1(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(Z)}copy(Z){return super.copy(Z),this.color.copy(Z.color),this.map=Z.map,this.lightMap=Z.lightMap,this.lightMapIntensity=Z.lightMapIntensity,this.aoMap=Z.aoMap,this.aoMapIntensity=Z.aoMapIntensity,this.specularMap=Z.specularMap,this.alphaMap=Z.alphaMap,this.envMap=Z.envMap,this.combine=Z.combine,this.reflectivity=Z.reflectivity,this.refractionRatio=Z.refractionRatio,this.wireframe=Z.wireframe,this.wireframeLinewidth=Z.wireframeLinewidth,this.wireframeLinecap=Z.wireframeLinecap,this.wireframeLinejoin=Z.wireframeLinejoin,this.fog=Z.fog,this}}const _tables=_generateTables();function _generateTables(){const X=new ArrayBuffer(4),Z=new Float32Array(X),_=new Uint32Array(X),K=new Uint32Array(512),te=new Uint32Array(512);for(let se=0;se<256;++se){const ae=se-127;ae<-27?(K[se]=0,K[se|256]=32768,te[se]=24,te[se|256]=24):ae<-14?(K[se]=1024>>-ae-14,K[se|256]=1024>>-ae-14|32768,te[se]=-ae-1,te[se|256]=-ae-1):ae<=15?(K[se]=ae+15<<10,K[se|256]=ae+15<<10|32768,te[se]=13,te[se|256]=13):ae<128?(K[se]=31744,K[se|256]=64512,te[se]=24,te[se|256]=24):(K[se]=31744,K[se|256]=64512,te[se]=13,te[se|256]=13)}const ne=new Uint32Array(2048),oe=new Uint32Array(64),ie=new Uint32Array(64);for(let se=1;se<1024;++se){let ae=se<<13,ge=0;for(;(ae&8388608)===0;)ae<<=1,ge-=8388608;ae&=-8388609,ge+=947912704,ne[se]=ae|ge}for(let se=1024;se<2048;++se)ne[se]=939524096+(se-1024<<13);for(let se=1;se<31;++se)oe[se]=se<<23;oe[31]=1199570944,oe[32]=2147483648;for(let se=33;se<63;++se)oe[se]=2147483648+(se-32<<23);oe[63]=3347054592;for(let se=1;se<64;++se)se!==32&&(ie[se]=1024);return{floatView:Z,uint32View:_,baseTable:K,shiftTable:te,mantissaTable:ne,exponentTable:oe,offsetTable:ie}}function toHalfFloat(X){Math.abs(X)>65504&&console.warn("THREE.DataUtils.toHalfFloat(): Value out of range."),X=clamp$3(X,-65504,65504),_tables.floatView[0]=X;const Z=_tables.uint32View[0],_=Z>>23&511;return _tables.baseTable[_]+((Z&8388607)>>_tables.shiftTable[_])}function fromHalfFloat(X){const Z=X>>10;return _tables.uint32View[0]=_tables.mantissaTable[_tables.offsetTable[Z]+(X&1023)]+_tables.exponentTable[Z],_tables.floatView[0]}const DataUtils={toHalfFloat,fromHalfFloat},_vector$8=new Vector3,_vector2$1=new Vector2;class BufferAttribute{constructor(Z,_,K=!1){if(Array.isArray(Z))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=Z,this.itemSize=_,this.count=Z!==void 0?Z.length/_:0,this.normalized=K,this.usage=StaticDrawUsage,this.updateRange={offset:0,count:-1},this.gpuType=FloatType,this.version=0}onUploadCallback(){}set needsUpdate(Z){Z===!0&&this.version++}setUsage(Z){return this.usage=Z,this}copy(Z){return this.name=Z.name,this.array=new Z.array.constructor(Z.array),this.itemSize=Z.itemSize,this.count=Z.count,this.normalized=Z.normalized,this.usage=Z.usage,this.gpuType=Z.gpuType,this}copyAt(Z,_,K){Z*=this.itemSize,K*=_.itemSize;for(let te=0,ne=this.itemSize;te<ne;te++)this.array[Z+te]=_.array[K+te];return this}copyArray(Z){return this.array.set(Z),this}applyMatrix3(Z){if(this.itemSize===2)for(let _=0,K=this.count;_<K;_++)_vector2$1.fromBufferAttribute(this,_),_vector2$1.applyMatrix3(Z),this.setXY(_,_vector2$1.x,_vector2$1.y);else if(this.itemSize===3)for(let _=0,K=this.count;_<K;_++)_vector$8.fromBufferAttribute(this,_),_vector$8.applyMatrix3(Z),this.setXYZ(_,_vector$8.x,_vector$8.y,_vector$8.z);return this}applyMatrix4(Z){for(let _=0,K=this.count;_<K;_++)_vector$8.fromBufferAttribute(this,_),_vector$8.applyMatrix4(Z),this.setXYZ(_,_vector$8.x,_vector$8.y,_vector$8.z);return this}applyNormalMatrix(Z){for(let _=0,K=this.count;_<K;_++)_vector$8.fromBufferAttribute(this,_),_vector$8.applyNormalMatrix(Z),this.setXYZ(_,_vector$8.x,_vector$8.y,_vector$8.z);return this}transformDirection(Z){for(let _=0,K=this.count;_<K;_++)_vector$8.fromBufferAttribute(this,_),_vector$8.transformDirection(Z),this.setXYZ(_,_vector$8.x,_vector$8.y,_vector$8.z);return this}set(Z,_=0){return this.array.set(Z,_),this}getX(Z){let _=this.array[Z*this.itemSize];return this.normalized&&(_=denormalize(_,this.array)),_}setX(Z,_){return this.normalized&&(_=normalize$5(_,this.array)),this.array[Z*this.itemSize]=_,this}getY(Z){let _=this.array[Z*this.itemSize+1];return this.normalized&&(_=denormalize(_,this.array)),_}setY(Z,_){return this.normalized&&(_=normalize$5(_,this.array)),this.array[Z*this.itemSize+1]=_,this}getZ(Z){let _=this.array[Z*this.itemSize+2];return this.normalized&&(_=denormalize(_,this.array)),_}setZ(Z,_){return this.normalized&&(_=normalize$5(_,this.array)),this.array[Z*this.itemSize+2]=_,this}getW(Z){let _=this.array[Z*this.itemSize+3];return this.normalized&&(_=denormalize(_,this.array)),_}setW(Z,_){return this.normalized&&(_=normalize$5(_,this.array)),this.array[Z*this.itemSize+3]=_,this}setXY(Z,_,K){return Z*=this.itemSize,this.normalized&&(_=normalize$5(_,this.array),K=normalize$5(K,this.array)),this.array[Z+0]=_,this.array[Z+1]=K,this}setXYZ(Z,_,K,te){return Z*=this.itemSize,this.normalized&&(_=normalize$5(_,this.array),K=normalize$5(K,this.array),te=normalize$5(te,this.array)),this.array[Z+0]=_,this.array[Z+1]=K,this.array[Z+2]=te,this}setXYZW(Z,_,K,te,ne){return Z*=this.itemSize,this.normalized&&(_=normalize$5(_,this.array),K=normalize$5(K,this.array),te=normalize$5(te,this.array),ne=normalize$5(ne,this.array)),this.array[Z+0]=_,this.array[Z+1]=K,this.array[Z+2]=te,this.array[Z+3]=ne,this}onUpload(Z){return this.onUploadCallback=Z,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const Z={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return this.name!==""&&(Z.name=this.name),this.usage!==StaticDrawUsage&&(Z.usage=this.usage),(this.updateRange.offset!==0||this.updateRange.count!==-1)&&(Z.updateRange=this.updateRange),Z}}class Int8BufferAttribute extends BufferAttribute{constructor(Z,_,K){super(new Int8Array(Z),_,K)}}class Uint8BufferAttribute extends BufferAttribute{constructor(Z,_,K){super(new Uint8Array(Z),_,K)}}class Uint8ClampedBufferAttribute extends BufferAttribute{constructor(Z,_,K){super(new Uint8ClampedArray(Z),_,K)}}class Int16BufferAttribute extends BufferAttribute{constructor(Z,_,K){super(new Int16Array(Z),_,K)}}class Uint16BufferAttribute extends BufferAttribute{constructor(Z,_,K){super(new Uint16Array(Z),_,K)}}class Int32BufferAttribute extends BufferAttribute{constructor(Z,_,K){super(new Int32Array(Z),_,K)}}class Uint32BufferAttribute extends BufferAttribute{constructor(Z,_,K){super(new Uint32Array(Z),_,K)}}class Float16BufferAttribute extends BufferAttribute{constructor(Z,_,K){super(new Uint16Array(Z),_,K),this.isFloat16BufferAttribute=!0}getX(Z){let _=fromHalfFloat(this.array[Z*this.itemSize]);return this.normalized&&(_=denormalize(_,this.array)),_}setX(Z,_){return this.normalized&&(_=normalize$5(_,this.array)),this.array[Z*this.itemSize]=toHalfFloat(_),this}getY(Z){let _=fromHalfFloat(this.array[Z*this.itemSize+1]);return this.normalized&&(_=denormalize(_,this.array)),_}setY(Z,_){return this.normalized&&(_=normalize$5(_,this.array)),this.array[Z*this.itemSize+1]=toHalfFloat(_),this}getZ(Z){let _=fromHalfFloat(this.array[Z*this.itemSize+2]);return this.normalized&&(_=denormalize(_,this.array)),_}setZ(Z,_){return this.normalized&&(_=normalize$5(_,this.array)),this.array[Z*this.itemSize+2]=toHalfFloat(_),this}getW(Z){let _=fromHalfFloat(this.array[Z*this.itemSize+3]);return this.normalized&&(_=denormalize(_,this.array)),_}setW(Z,_){return this.normalized&&(_=normalize$5(_,this.array)),this.array[Z*this.itemSize+3]=toHalfFloat(_),this}setXY(Z,_,K){return Z*=this.itemSize,this.normalized&&(_=normalize$5(_,this.array),K=normalize$5(K,this.array)),this.array[Z+0]=toHalfFloat(_),this.array[Z+1]=toHalfFloat(K),this}setXYZ(Z,_,K,te){return Z*=this.itemSize,this.normalized&&(_=normalize$5(_,this.array),K=normalize$5(K,this.array),te=normalize$5(te,this.array)),this.array[Z+0]=toHalfFloat(_),this.array[Z+1]=toHalfFloat(K),this.array[Z+2]=toHalfFloat(te),this}setXYZW(Z,_,K,te,ne){return Z*=this.itemSize,this.normalized&&(_=normalize$5(_,this.array),K=normalize$5(K,this.array),te=normalize$5(te,this.array),ne=normalize$5(ne,this.array)),this.array[Z+0]=toHalfFloat(_),this.array[Z+1]=toHalfFloat(K),this.array[Z+2]=toHalfFloat(te),this.array[Z+3]=toHalfFloat(ne),this}}class Float32BufferAttribute extends BufferAttribute{constructor(Z,_,K){super(new Float32Array(Z),_,K)}}class Float64BufferAttribute extends BufferAttribute{constructor(Z,_,K){super(new Float64Array(Z),_,K)}}let _id$1=0;const _m1=new Matrix4,_obj=new Object3D,_offset=new Vector3,_box$1=new Box3,_boxMorphTargets=new Box3,_vector$7=new Vector3;class BufferGeometry extends EventDispatcher{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:_id$1++}),this.uuid=generateUUID$1(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(Z){return Array.isArray(Z)?this.index=new(arrayNeedsUint32(Z)?Uint32BufferAttribute:Uint16BufferAttribute)(Z,1):this.index=Z,this}getAttribute(Z){return this.attributes[Z]}setAttribute(Z,_){return this.attributes[Z]=_,this}deleteAttribute(Z){return delete this.attributes[Z],this}hasAttribute(Z){return this.attributes[Z]!==void 0}addGroup(Z,_,K=0){this.groups.push({start:Z,count:_,materialIndex:K})}clearGroups(){this.groups=[]}setDrawRange(Z,_){this.drawRange.start=Z,this.drawRange.count=_}applyMatrix4(Z){const _=this.attributes.position;_!==void 0&&(_.applyMatrix4(Z),_.needsUpdate=!0);const K=this.attributes.normal;if(K!==void 0){const ne=new Matrix3().getNormalMatrix(Z);K.applyNormalMatrix(ne),K.needsUpdate=!0}const te=this.attributes.tangent;return te!==void 0&&(te.transformDirection(Z),te.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(Z){return _m1.makeRotationFromQuaternion(Z),this.applyMatrix4(_m1),this}rotateX(Z){return _m1.makeRotationX(Z),this.applyMatrix4(_m1),this}rotateY(Z){return _m1.makeRotationY(Z),this.applyMatrix4(_m1),this}rotateZ(Z){return _m1.makeRotationZ(Z),this.applyMatrix4(_m1),this}translate(Z,_,K){return _m1.makeTranslation(Z,_,K),this.applyMatrix4(_m1),this}scale(Z,_,K){return _m1.makeScale(Z,_,K),this.applyMatrix4(_m1),this}lookAt(Z){return _obj.lookAt(Z),_obj.updateMatrix(),this.applyMatrix4(_obj.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(_offset).negate(),this.translate(_offset.x,_offset.y,_offset.z),this}setFromPoints(Z){const _=[];for(let K=0,te=Z.length;K<te;K++){const ne=Z[K];_.push(ne.x,ne.y,ne.z||0)}return this.setAttribute("position",new Float32BufferAttribute(_,3)),this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new Box3);const Z=this.attributes.position,_=this.morphAttributes.position;if(Z&&Z.isGLBufferAttribute){console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),this.boundingBox.set(new Vector3(-1/0,-1/0,-1/0),new Vector3(1/0,1/0,1/0));return}if(Z!==void 0){if(this.boundingBox.setFromBufferAttribute(Z),_)for(let K=0,te=_.length;K<te;K++){const ne=_[K];_box$1.setFromBufferAttribute(ne),this.morphTargetsRelative?(_vector$7.addVectors(this.boundingBox.min,_box$1.min),this.boundingBox.expandByPoint(_vector$7),_vector$7.addVectors(this.boundingBox.max,_box$1.max),this.boundingBox.expandByPoint(_vector$7)):(this.boundingBox.expandByPoint(_box$1.min),this.boundingBox.expandByPoint(_box$1.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new Sphere);const Z=this.attributes.position,_=this.morphAttributes.position;if(Z&&Z.isGLBufferAttribute){console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),this.boundingSphere.set(new Vector3,1/0);return}if(Z){const K=this.boundingSphere.center;if(_box$1.setFromBufferAttribute(Z),_)for(let ne=0,oe=_.length;ne<oe;ne++){const ie=_[ne];_boxMorphTargets.setFromBufferAttribute(ie),this.morphTargetsRelative?(_vector$7.addVectors(_box$1.min,_boxMorphTargets.min),_box$1.expandByPoint(_vector$7),_vector$7.addVectors(_box$1.max,_boxMorphTargets.max),_box$1.expandByPoint(_vector$7)):(_box$1.expandByPoint(_boxMorphTargets.min),_box$1.expandByPoint(_boxMorphTargets.max))}_box$1.getCenter(K);let te=0;for(let ne=0,oe=Z.count;ne<oe;ne++)_vector$7.fromBufferAttribute(Z,ne),te=Math.max(te,K.distanceToSquared(_vector$7));if(_)for(let ne=0,oe=_.length;ne<oe;ne++){const ie=_[ne],se=this.morphTargetsRelative;for(let ae=0,ge=ie.count;ae<ge;ae++)_vector$7.fromBufferAttribute(ie,ae),se&&(_offset.fromBufferAttribute(Z,ae),_vector$7.add(_offset)),te=Math.max(te,K.distanceToSquared(_vector$7))}this.boundingSphere.radius=Math.sqrt(te),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const Z=this.index,_=this.attributes;if(Z===null||_.position===void 0||_.normal===void 0||_.uv===void 0){console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}const K=Z.array,te=_.position.array,ne=_.normal.array,oe=_.uv.array,ie=te.length/3;this.hasAttribute("tangent")===!1&&this.setAttribute("tangent",new BufferAttribute(new Float32Array(4*ie),4));const se=this.getAttribute("tangent").array,ae=[],ge=[];for(let Xe=0;Xe<ie;Xe++)ae[Xe]=new Vector3,ge[Xe]=new Vector3;const ce=new Vector3,de=new Vector3,pe=new Vector3,fe=new Vector2,be=new Vector2,me=new Vector2,ye=new Vector3,ve=new Vector3;function Be(Xe,Pe,He){ce.fromArray(te,Xe*3),de.fromArray(te,Pe*3),pe.fromArray(te,He*3),fe.fromArray(oe,Xe*2),be.fromArray(oe,Pe*2),me.fromArray(oe,He*2),de.sub(ce),pe.sub(ce),be.sub(fe),me.sub(fe);const Ke=1/(be.x*me.y-me.x*be.y);isFinite(Ke)&&(ye.copy(de).multiplyScalar(me.y).addScaledVector(pe,-be.y).multiplyScalar(Ke),ve.copy(pe).multiplyScalar(be.x).addScaledVector(de,-me.x).multiplyScalar(Ke),ae[Xe].add(ye),ae[Pe].add(ye),ae[He].add(ye),ge[Xe].add(ve),ge[Pe].add(ve),ge[He].add(ve))}let Re=this.groups;Re.length===0&&(Re=[{start:0,count:K.length}]);for(let Xe=0,Pe=Re.length;Xe<Pe;++Xe){const He=Re[Xe],Ke=He.start,Ue=He.count;for(let tt=Ke,rt=Ke+Ue;tt<rt;tt+=3)Be(K[tt+0],K[tt+1],K[tt+2])}const Ee=new Vector3,We=new Vector3,Ze=new Vector3,Ve=new Vector3;function _e(Xe){Ze.fromArray(ne,Xe*3),Ve.copy(Ze);const Pe=ae[Xe];Ee.copy(Pe),Ee.sub(Ze.multiplyScalar(Ze.dot(Pe))).normalize(),We.crossVectors(Ve,Pe);const Ke=We.dot(ge[Xe])<0?-1:1;se[Xe*4]=Ee.x,se[Xe*4+1]=Ee.y,se[Xe*4+2]=Ee.z,se[Xe*4+3]=Ke}for(let Xe=0,Pe=Re.length;Xe<Pe;++Xe){const He=Re[Xe],Ke=He.start,Ue=He.count;for(let tt=Ke,rt=Ke+Ue;tt<rt;tt+=3)_e(K[tt+0]),_e(K[tt+1]),_e(K[tt+2])}}computeVertexNormals(){const Z=this.index,_=this.getAttribute("position");if(_!==void 0){let K=this.getAttribute("normal");if(K===void 0)K=new BufferAttribute(new Float32Array(_.count*3),3),this.setAttribute("normal",K);else for(let de=0,pe=K.count;de<pe;de++)K.setXYZ(de,0,0,0);const te=new Vector3,ne=new Vector3,oe=new Vector3,ie=new Vector3,se=new Vector3,ae=new Vector3,ge=new Vector3,ce=new Vector3;if(Z)for(let de=0,pe=Z.count;de<pe;de+=3){const fe=Z.getX(de+0),be=Z.getX(de+1),me=Z.getX(de+2);te.fromBufferAttribute(_,fe),ne.fromBufferAttribute(_,be),oe.fromBufferAttribute(_,me),ge.subVectors(oe,ne),ce.subVectors(te,ne),ge.cross(ce),ie.fromBufferAttribute(K,fe),se.fromBufferAttribute(K,be),ae.fromBufferAttribute(K,me),ie.add(ge),se.add(ge),ae.add(ge),K.setXYZ(fe,ie.x,ie.y,ie.z),K.setXYZ(be,se.x,se.y,se.z),K.setXYZ(me,ae.x,ae.y,ae.z)}else for(let de=0,pe=_.count;de<pe;de+=3)te.fromBufferAttribute(_,de+0),ne.fromBufferAttribute(_,de+1),oe.fromBufferAttribute(_,de+2),ge.subVectors(oe,ne),ce.subVectors(te,ne),ge.cross(ce),K.setXYZ(de+0,ge.x,ge.y,ge.z),K.setXYZ(de+1,ge.x,ge.y,ge.z),K.setXYZ(de+2,ge.x,ge.y,ge.z);this.normalizeNormals(),K.needsUpdate=!0}}normalizeNormals(){const Z=this.attributes.normal;for(let _=0,K=Z.count;_<K;_++)_vector$7.fromBufferAttribute(Z,_),_vector$7.normalize(),Z.setXYZ(_,_vector$7.x,_vector$7.y,_vector$7.z)}toNonIndexed(){function Z(ie,se){const ae=ie.array,ge=ie.itemSize,ce=ie.normalized,de=new ae.constructor(se.length*ge);let pe=0,fe=0;for(let be=0,me=se.length;be<me;be++){ie.isInterleavedBufferAttribute?pe=se[be]*ie.data.stride+ie.offset:pe=se[be]*ge;for(let ye=0;ye<ge;ye++)de[fe++]=ae[pe++]}return new BufferAttribute(de,ge,ce)}if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const _=new BufferGeometry,K=this.index.array,te=this.attributes;for(const ie in te){const se=te[ie],ae=Z(se,K);_.setAttribute(ie,ae)}const ne=this.morphAttributes;for(const ie in ne){const se=[],ae=ne[ie];for(let ge=0,ce=ae.length;ge<ce;ge++){const de=ae[ge],pe=Z(de,K);se.push(pe)}_.morphAttributes[ie]=se}_.morphTargetsRelative=this.morphTargetsRelative;const oe=this.groups;for(let ie=0,se=oe.length;ie<se;ie++){const ae=oe[ie];_.addGroup(ae.start,ae.count,ae.materialIndex)}return _}toJSON(){const Z={metadata:{version:4.6,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(Z.uuid=this.uuid,Z.type=this.type,this.name!==""&&(Z.name=this.name),Object.keys(this.userData).length>0&&(Z.userData=this.userData),this.parameters!==void 0){const se=this.parameters;for(const ae in se)se[ae]!==void 0&&(Z[ae]=se[ae]);return Z}Z.data={attributes:{}};const _=this.index;_!==null&&(Z.data.index={type:_.array.constructor.name,array:Array.prototype.slice.call(_.array)});const K=this.attributes;for(const se in K){const ae=K[se];Z.data.attributes[se]=ae.toJSON(Z.data)}const te={};let ne=!1;for(const se in this.morphAttributes){const ae=this.morphAttributes[se],ge=[];for(let ce=0,de=ae.length;ce<de;ce++){const pe=ae[ce];ge.push(pe.toJSON(Z.data))}ge.length>0&&(te[se]=ge,ne=!0)}ne&&(Z.data.morphAttributes=te,Z.data.morphTargetsRelative=this.morphTargetsRelative);const oe=this.groups;oe.length>0&&(Z.data.groups=JSON.parse(JSON.stringify(oe)));const ie=this.boundingSphere;return ie!==null&&(Z.data.boundingSphere={center:ie.center.toArray(),radius:ie.radius}),Z}clone(){return new this.constructor().copy(this)}copy(Z){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const _={};this.name=Z.name;const K=Z.index;K!==null&&this.setIndex(K.clone(_));const te=Z.attributes;for(const ae in te){const ge=te[ae];this.setAttribute(ae,ge.clone(_))}const ne=Z.morphAttributes;for(const ae in ne){const ge=[],ce=ne[ae];for(let de=0,pe=ce.length;de<pe;de++)ge.push(ce[de].clone(_));this.morphAttributes[ae]=ge}this.morphTargetsRelative=Z.morphTargetsRelative;const oe=Z.groups;for(let ae=0,ge=oe.length;ae<ge;ae++){const ce=oe[ae];this.addGroup(ce.start,ce.count,ce.materialIndex)}const ie=Z.boundingBox;ie!==null&&(this.boundingBox=ie.clone());const se=Z.boundingSphere;return se!==null&&(this.boundingSphere=se.clone()),this.drawRange.start=Z.drawRange.start,this.drawRange.count=Z.drawRange.count,this.userData=Z.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}const _inverseMatrix$3=new Matrix4,_ray$3=new Ray$2,_sphere$5=new Sphere,_sphereHitAt=new Vector3,_vA$1=new Vector3,_vB$1=new Vector3,_vC$1=new Vector3,_tempA=new Vector3,_morphA=new Vector3,_uvA$1=new Vector2,_uvB$1=new Vector2,_uvC$1=new Vector2,_normalA=new Vector3,_normalB=new Vector3,_normalC=new Vector3,_intersectionPoint=new Vector3,_intersectionPointWorld=new Vector3;class Mesh extends Object3D{constructor(Z=new BufferGeometry,_=new MeshBasicMaterial){super(),this.isMesh=!0,this.type="Mesh",this.geometry=Z,this.material=_,this.updateMorphTargets()}copy(Z,_){return super.copy(Z,_),Z.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=Z.morphTargetInfluences.slice()),Z.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},Z.morphTargetDictionary)),this.material=Z.material,this.geometry=Z.geometry,this}updateMorphTargets(){const _=this.geometry.morphAttributes,K=Object.keys(_);if(K.length>0){const te=_[K[0]];if(te!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let ne=0,oe=te.length;ne<oe;ne++){const ie=te[ne].name||String(ne);this.morphTargetInfluences.push(0),this.morphTargetDictionary[ie]=ne}}}}getVertexPosition(Z,_){const K=this.geometry,te=K.attributes.position,ne=K.morphAttributes.position,oe=K.morphTargetsRelative;_.fromBufferAttribute(te,Z);const ie=this.morphTargetInfluences;if(ne&&ie){_morphA.set(0,0,0);for(let se=0,ae=ne.length;se<ae;se++){const ge=ie[se],ce=ne[se];ge!==0&&(_tempA.fromBufferAttribute(ce,Z),oe?_morphA.addScaledVector(_tempA,ge):_morphA.addScaledVector(_tempA.sub(_),ge))}_.add(_morphA)}return _}raycast(Z,_){const K=this.geometry,te=this.material,ne=this.matrixWorld;te!==void 0&&(K.boundingSphere===null&&K.computeBoundingSphere(),_sphere$5.copy(K.boundingSphere),_sphere$5.applyMatrix4(ne),_ray$3.copy(Z.ray).recast(Z.near),!(_sphere$5.containsPoint(_ray$3.origin)===!1&&(_ray$3.intersectSphere(_sphere$5,_sphereHitAt)===null||_ray$3.origin.distanceToSquared(_sphereHitAt)>(Z.far-Z.near)**2))&&(_inverseMatrix$3.copy(ne).invert(),_ray$3.copy(Z.ray).applyMatrix4(_inverseMatrix$3),!(K.boundingBox!==null&&_ray$3.intersectsBox(K.boundingBox)===!1)&&this._computeIntersections(Z,_,_ray$3)))}_computeIntersections(Z,_,K){let te;const ne=this.geometry,oe=this.material,ie=ne.index,se=ne.attributes.position,ae=ne.attributes.uv,ge=ne.attributes.uv1,ce=ne.attributes.normal,de=ne.groups,pe=ne.drawRange;if(ie!==null)if(Array.isArray(oe))for(let fe=0,be=de.length;fe<be;fe++){const me=de[fe],ye=oe[me.materialIndex],ve=Math.max(me.start,pe.start),Be=Math.min(ie.count,Math.min(me.start+me.count,pe.start+pe.count));for(let Re=ve,Ee=Be;Re<Ee;Re+=3){const We=ie.getX(Re),Ze=ie.getX(Re+1),Ve=ie.getX(Re+2);te=checkGeometryIntersection(this,ye,Z,K,ae,ge,ce,We,Ze,Ve),te&&(te.faceIndex=Math.floor(Re/3),te.face.materialIndex=me.materialIndex,_.push(te))}}else{const fe=Math.max(0,pe.start),be=Math.min(ie.count,pe.start+pe.count);for(let me=fe,ye=be;me<ye;me+=3){const ve=ie.getX(me),Be=ie.getX(me+1),Re=ie.getX(me+2);te=checkGeometryIntersection(this,oe,Z,K,ae,ge,ce,ve,Be,Re),te&&(te.faceIndex=Math.floor(me/3),_.push(te))}}else if(se!==void 0)if(Array.isArray(oe))for(let fe=0,be=de.length;fe<be;fe++){const me=de[fe],ye=oe[me.materialIndex],ve=Math.max(me.start,pe.start),Be=Math.min(se.count,Math.min(me.start+me.count,pe.start+pe.count));for(let Re=ve,Ee=Be;Re<Ee;Re+=3){const We=Re,Ze=Re+1,Ve=Re+2;te=checkGeometryIntersection(this,ye,Z,K,ae,ge,ce,We,Ze,Ve),te&&(te.faceIndex=Math.floor(Re/3),te.face.materialIndex=me.materialIndex,_.push(te))}}else{const fe=Math.max(0,pe.start),be=Math.min(se.count,pe.start+pe.count);for(let me=fe,ye=be;me<ye;me+=3){const ve=me,Be=me+1,Re=me+2;te=checkGeometryIntersection(this,oe,Z,K,ae,ge,ce,ve,Be,Re),te&&(te.faceIndex=Math.floor(me/3),_.push(te))}}}}function checkIntersection(X,Z,_,K,te,ne,oe,ie){let se;if(Z.side===BackSide?se=K.intersectTriangle(oe,ne,te,!0,ie):se=K.intersectTriangle(te,ne,oe,Z.side===FrontSide,ie),se===null)return null;_intersectionPointWorld.copy(ie),_intersectionPointWorld.applyMatrix4(X.matrixWorld);const ae=_.ray.origin.distanceTo(_intersectionPointWorld);return ae<_.near||ae>_.far?null:{distance:ae,point:_intersectionPointWorld.clone(),object:X}}function checkGeometryIntersection(X,Z,_,K,te,ne,oe,ie,se,ae){X.getVertexPosition(ie,_vA$1),X.getVertexPosition(se,_vB$1),X.getVertexPosition(ae,_vC$1);const ge=checkIntersection(X,Z,_,K,_vA$1,_vB$1,_vC$1,_intersectionPoint);if(ge){te&&(_uvA$1.fromBufferAttribute(te,ie),_uvB$1.fromBufferAttribute(te,se),_uvC$1.fromBufferAttribute(te,ae),ge.uv=Triangle.getInterpolation(_intersectionPoint,_vA$1,_vB$1,_vC$1,_uvA$1,_uvB$1,_uvC$1,new Vector2)),ne&&(_uvA$1.fromBufferAttribute(ne,ie),_uvB$1.fromBufferAttribute(ne,se),_uvC$1.fromBufferAttribute(ne,ae),ge.uv1=Triangle.getInterpolation(_intersectionPoint,_vA$1,_vB$1,_vC$1,_uvA$1,_uvB$1,_uvC$1,new Vector2),ge.uv2=ge.uv1),oe&&(_normalA.fromBufferAttribute(oe,ie),_normalB.fromBufferAttribute(oe,se),_normalC.fromBufferAttribute(oe,ae),ge.normal=Triangle.getInterpolation(_intersectionPoint,_vA$1,_vB$1,_vC$1,_normalA,_normalB,_normalC,new Vector3),ge.normal.dot(K.direction)>0&&ge.normal.multiplyScalar(-1));const ce={a:ie,b:se,c:ae,normal:new Vector3,materialIndex:0};Triangle.getNormal(_vA$1,_vB$1,_vC$1,ce.normal),ge.face=ce}return ge}class BoxGeometry extends BufferGeometry{constructor(Z=1,_=1,K=1,te=1,ne=1,oe=1){super(),this.type="BoxGeometry",this.parameters={width:Z,height:_,depth:K,widthSegments:te,heightSegments:ne,depthSegments:oe};const ie=this;te=Math.floor(te),ne=Math.floor(ne),oe=Math.floor(oe);const se=[],ae=[],ge=[],ce=[];let de=0,pe=0;fe("z","y","x",-1,-1,K,_,Z,oe,ne,0),fe("z","y","x",1,-1,K,_,-Z,oe,ne,1),fe("x","z","y",1,1,Z,K,_,te,oe,2),fe("x","z","y",1,-1,Z,K,-_,te,oe,3),fe("x","y","z",1,-1,Z,_,K,te,ne,4),fe("x","y","z",-1,-1,Z,_,-K,te,ne,5),this.setIndex(se),this.setAttribute("position",new Float32BufferAttribute(ae,3)),this.setAttribute("normal",new Float32BufferAttribute(ge,3)),this.setAttribute("uv",new Float32BufferAttribute(ce,2));function fe(be,me,ye,ve,Be,Re,Ee,We,Ze,Ve,_e){const Xe=Re/Ze,Pe=Ee/Ve,He=Re/2,Ke=Ee/2,Ue=We/2,tt=Ze+1,rt=Ve+1;let at=0,Oe=0;const $e=new Vector3;for(let je=0;je<rt;je++){const Te=je*Pe-Ke;for(let De=0;De<tt;De++){const ot=De*Xe-He;$e[be]=ot*ve,$e[me]=Te*Be,$e[ye]=Ue,ae.push($e.x,$e.y,$e.z),$e[be]=0,$e[me]=0,$e[ye]=We>0?1:-1,ge.push($e.x,$e.y,$e.z),ce.push(De/Ze),ce.push(1-je/Ve),at+=1}}for(let je=0;je<Ve;je++)for(let Te=0;Te<Ze;Te++){const De=de+Te+tt*je,ot=de+Te+tt*(je+1),ct=de+(Te+1)+tt*(je+1),gt=de+(Te+1)+tt*je;se.push(De,ot,gt),se.push(ot,ct,gt),Oe+=6}ie.addGroup(pe,Oe,_e),pe+=Oe,de+=at}}copy(Z){return super.copy(Z),this.parameters=Object.assign({},Z.parameters),this}static fromJSON(Z){return new BoxGeometry(Z.width,Z.height,Z.depth,Z.widthSegments,Z.heightSegments,Z.depthSegments)}}function cloneUniforms(X){const Z={};for(const _ in X){Z[_]={};for(const K in X[_]){const te=X[_][K];te&&(te.isColor||te.isMatrix3||te.isMatrix4||te.isVector2||te.isVector3||te.isVector4||te.isTexture||te.isQuaternion)?te.isRenderTargetTexture?(console.warn("UniformsUtils: Textures of render targets cannot be cloned via cloneUniforms() or mergeUniforms()."),Z[_][K]=null):Z[_][K]=te.clone():Array.isArray(te)?Z[_][K]=te.slice():Z[_][K]=te}}return Z}function mergeUniforms(X){const Z={};for(let _=0;_<X.length;_++){const K=cloneUniforms(X[_]);for(const te in K)Z[te]=K[te]}return Z}function cloneUniformsGroups(X){const Z=[];for(let _=0;_<X.length;_++)Z.push(X[_].clone());return Z}function getUnlitUniformColorSpace(X){return X.getRenderTarget()===null?X.outputColorSpace:LinearSRGBColorSpace$1}const UniformsUtils={clone:cloneUniforms,merge:mergeUniforms};var default_vertex=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,default_fragment=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`;class ShaderMaterial extends Material{constructor(Z){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader=default_vertex,this.fragmentShader=default_fragment,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.forceSinglePass=!0,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv1:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,Z!==void 0&&this.setValues(Z)}copy(Z){return super.copy(Z),this.fragmentShader=Z.fragmentShader,this.vertexShader=Z.vertexShader,this.uniforms=cloneUniforms(Z.uniforms),this.uniformsGroups=cloneUniformsGroups(Z.uniformsGroups),this.defines=Object.assign({},Z.defines),this.wireframe=Z.wireframe,this.wireframeLinewidth=Z.wireframeLinewidth,this.fog=Z.fog,this.lights=Z.lights,this.clipping=Z.clipping,this.extensions=Object.assign({},Z.extensions),this.glslVersion=Z.glslVersion,this}toJSON(Z){const _=super.toJSON(Z);_.glslVersion=this.glslVersion,_.uniforms={};for(const te in this.uniforms){const oe=this.uniforms[te].value;oe&&oe.isTexture?_.uniforms[te]={type:"t",value:oe.toJSON(Z).uuid}:oe&&oe.isColor?_.uniforms[te]={type:"c",value:oe.getHex()}:oe&&oe.isVector2?_.uniforms[te]={type:"v2",value:oe.toArray()}:oe&&oe.isVector3?_.uniforms[te]={type:"v3",value:oe.toArray()}:oe&&oe.isVector4?_.uniforms[te]={type:"v4",value:oe.toArray()}:oe&&oe.isMatrix3?_.uniforms[te]={type:"m3",value:oe.toArray()}:oe&&oe.isMatrix4?_.uniforms[te]={type:"m4",value:oe.toArray()}:_.uniforms[te]={value:oe}}Object.keys(this.defines).length>0&&(_.defines=this.defines),_.vertexShader=this.vertexShader,_.fragmentShader=this.fragmentShader,_.lights=this.lights,_.clipping=this.clipping;const K={};for(const te in this.extensions)this.extensions[te]===!0&&(K[te]=!0);return Object.keys(K).length>0&&(_.extensions=K),_}}class Camera extends Object3D{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new Matrix4,this.projectionMatrix=new Matrix4,this.projectionMatrixInverse=new Matrix4,this.coordinateSystem=WebGLCoordinateSystem}copy(Z,_){return super.copy(Z,_),this.matrixWorldInverse.copy(Z.matrixWorldInverse),this.projectionMatrix.copy(Z.projectionMatrix),this.projectionMatrixInverse.copy(Z.projectionMatrixInverse),this.coordinateSystem=Z.coordinateSystem,this}getWorldDirection(Z){this.updateWorldMatrix(!0,!1);const _=this.matrixWorld.elements;return Z.set(-_[8],-_[9],-_[10]).normalize()}updateMatrixWorld(Z){super.updateMatrixWorld(Z),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(Z,_){super.updateWorldMatrix(Z,_),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}}class PerspectiveCamera extends Camera{constructor(Z=50,_=1,K=.1,te=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=Z,this.zoom=1,this.near=K,this.far=te,this.focus=10,this.aspect=_,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(Z,_){return super.copy(Z,_),this.fov=Z.fov,this.zoom=Z.zoom,this.near=Z.near,this.far=Z.far,this.focus=Z.focus,this.aspect=Z.aspect,this.view=Z.view===null?null:Object.assign({},Z.view),this.filmGauge=Z.filmGauge,this.filmOffset=Z.filmOffset,this}setFocalLength(Z){const _=.5*this.getFilmHeight()/Z;this.fov=RAD2DEG*2*Math.atan(_),this.updateProjectionMatrix()}getFocalLength(){const Z=Math.tan(DEG2RAD*.5*this.fov);return .5*this.getFilmHeight()/Z}getEffectiveFOV(){return RAD2DEG*2*Math.atan(Math.tan(DEG2RAD*.5*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}setViewOffset(Z,_,K,te,ne,oe){this.aspect=Z/_,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=Z,this.view.fullHeight=_,this.view.offsetX=K,this.view.offsetY=te,this.view.width=ne,this.view.height=oe,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const Z=this.near;let _=Z*Math.tan(DEG2RAD*.5*this.fov)/this.zoom,K=2*_,te=this.aspect*K,ne=-.5*te;const oe=this.view;if(this.view!==null&&this.view.enabled){const se=oe.fullWidth,ae=oe.fullHeight;ne+=oe.offsetX*te/se,_-=oe.offsetY*K/ae,te*=oe.width/se,K*=oe.height/ae}const ie=this.filmOffset;ie!==0&&(ne+=Z*ie/this.getFilmWidth()),this.projectionMatrix.makePerspective(ne,ne+te,_,_-K,Z,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(Z){const _=super.toJSON(Z);return _.object.fov=this.fov,_.object.zoom=this.zoom,_.object.near=this.near,_.object.far=this.far,_.object.focus=this.focus,_.object.aspect=this.aspect,this.view!==null&&(_.object.view=Object.assign({},this.view)),_.object.filmGauge=this.filmGauge,_.object.filmOffset=this.filmOffset,_}}const fov=-90,aspect=1;class CubeCamera extends Object3D{constructor(Z,_,K){super(),this.type="CubeCamera",this.renderTarget=K,this.coordinateSystem=null;const te=new PerspectiveCamera(fov,aspect,Z,_);te.layers=this.layers,this.add(te);const ne=new PerspectiveCamera(fov,aspect,Z,_);ne.layers=this.layers,this.add(ne);const oe=new PerspectiveCamera(fov,aspect,Z,_);oe.layers=this.layers,this.add(oe);const ie=new PerspectiveCamera(fov,aspect,Z,_);ie.layers=this.layers,this.add(ie);const se=new PerspectiveCamera(fov,aspect,Z,_);se.layers=this.layers,this.add(se);const ae=new PerspectiveCamera(fov,aspect,Z,_);ae.layers=this.layers,this.add(ae)}updateCoordinateSystem(){const Z=this.coordinateSystem,_=this.children.concat(),[K,te,ne,oe,ie,se]=_;for(const ae of _)this.remove(ae);if(Z===WebGLCoordinateSystem)K.up.set(0,1,0),K.lookAt(1,0,0),te.up.set(0,1,0),te.lookAt(-1,0,0),ne.up.set(0,0,-1),ne.lookAt(0,1,0),oe.up.set(0,0,1),oe.lookAt(0,-1,0),ie.up.set(0,1,0),ie.lookAt(0,0,1),se.up.set(0,1,0),se.lookAt(0,0,-1);else if(Z===WebGPUCoordinateSystem)K.up.set(0,-1,0),K.lookAt(-1,0,0),te.up.set(0,-1,0),te.lookAt(1,0,0),ne.up.set(0,0,1),ne.lookAt(0,1,0),oe.up.set(0,0,-1),oe.lookAt(0,-1,0),ie.up.set(0,-1,0),ie.lookAt(0,0,1),se.up.set(0,-1,0),se.lookAt(0,0,-1);else throw new Error("THREE.CubeCamera.updateCoordinateSystem(): Invalid coordinate system: "+Z);for(const ae of _)this.add(ae),ae.updateMatrixWorld()}update(Z,_){this.parent===null&&this.updateMatrixWorld();const K=this.renderTarget;this.coordinateSystem!==Z.coordinateSystem&&(this.coordinateSystem=Z.coordinateSystem,this.updateCoordinateSystem());const[te,ne,oe,ie,se,ae]=this.children,ge=Z.getRenderTarget(),ce=Z.toneMapping,de=Z.xr.enabled;Z.toneMapping=NoToneMapping,Z.xr.enabled=!1;const pe=K.texture.generateMipmaps;K.texture.generateMipmaps=!1,Z.setRenderTarget(K,0),Z.render(_,te),Z.setRenderTarget(K,1),Z.render(_,ne),Z.setRenderTarget(K,2),Z.render(_,oe),Z.setRenderTarget(K,3),Z.render(_,ie),Z.setRenderTarget(K,4),Z.render(_,se),K.texture.generateMipmaps=pe,Z.setRenderTarget(K,5),Z.render(_,ae),Z.setRenderTarget(ge),Z.toneMapping=ce,Z.xr.enabled=de,K.texture.needsPMREMUpdate=!0}}class CubeTexture extends Texture{constructor(Z,_,K,te,ne,oe,ie,se,ae,ge){Z=Z!==void 0?Z:[],_=_!==void 0?_:CubeReflectionMapping,super(Z,_,K,te,ne,oe,ie,se,ae,ge),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(Z){this.image=Z}}class WebGLCubeRenderTarget extends WebGLRenderTarget{constructor(Z=1,_={}){super(Z,Z,_),this.isWebGLCubeRenderTarget=!0;const K={width:Z,height:Z,depth:1},te=[K,K,K,K,K,K];_.encoding!==void 0&&(warnOnce("THREE.WebGLCubeRenderTarget: option.encoding has been replaced by option.colorSpace."),_.colorSpace=_.encoding===sRGBEncoding$2?SRGBColorSpace$1:NoColorSpace),this.texture=new CubeTexture(te,_.mapping,_.wrapS,_.wrapT,_.magFilter,_.minFilter,_.format,_.type,_.anisotropy,_.colorSpace),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=_.generateMipmaps!==void 0?_.generateMipmaps:!1,this.texture.minFilter=_.minFilter!==void 0?_.minFilter:LinearFilter}fromEquirectangularTexture(Z,_){this.texture.type=_.type,this.texture.colorSpace=_.colorSpace,this.texture.generateMipmaps=_.generateMipmaps,this.texture.minFilter=_.minFilter,this.texture.magFilter=_.magFilter;const K={uniforms:{tEquirect:{value:null}},vertexShader:`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,fragmentShader:`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`},te=new BoxGeometry(5,5,5),ne=new ShaderMaterial({name:"CubemapFromEquirect",uniforms:cloneUniforms(K.uniforms),vertexShader:K.vertexShader,fragmentShader:K.fragmentShader,side:BackSide,blending:NoBlending});ne.uniforms.tEquirect.value=_;const oe=new Mesh(te,ne),ie=_.minFilter;return _.minFilter===LinearMipmapLinearFilter&&(_.minFilter=LinearFilter),new CubeCamera(1,10,this).update(Z,oe),_.minFilter=ie,oe.geometry.dispose(),oe.material.dispose(),this}clear(Z,_,K,te){const ne=Z.getRenderTarget();for(let oe=0;oe<6;oe++)Z.setRenderTarget(this,oe),Z.clear(_,K,te);Z.setRenderTarget(ne)}}const _vector1=new Vector3,_vector2=new Vector3,_normalMatrix=new Matrix3;class Plane{constructor(Z=new Vector3(1,0,0),_=0){this.isPlane=!0,this.normal=Z,this.constant=_}set(Z,_){return this.normal.copy(Z),this.constant=_,this}setComponents(Z,_,K,te){return this.normal.set(Z,_,K),this.constant=te,this}setFromNormalAndCoplanarPoint(Z,_){return this.normal.copy(Z),this.constant=-_.dot(this.normal),this}setFromCoplanarPoints(Z,_,K){const te=_vector1.subVectors(K,_).cross(_vector2.subVectors(Z,_)).normalize();return this.setFromNormalAndCoplanarPoint(te,Z),this}copy(Z){return this.normal.copy(Z.normal),this.constant=Z.constant,this}normalize(){const Z=1/this.normal.length();return this.normal.multiplyScalar(Z),this.constant*=Z,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(Z){return this.normal.dot(Z)+this.constant}distanceToSphere(Z){return this.distanceToPoint(Z.center)-Z.radius}projectPoint(Z,_){return _.copy(Z).addScaledVector(this.normal,-this.distanceToPoint(Z))}intersectLine(Z,_){const K=Z.delta(_vector1),te=this.normal.dot(K);if(te===0)return this.distanceToPoint(Z.start)===0?_.copy(Z.start):null;const ne=-(Z.start.dot(this.normal)+this.constant)/te;return ne<0||ne>1?null:_.copy(Z.start).addScaledVector(K,ne)}intersectsLine(Z){const _=this.distanceToPoint(Z.start),K=this.distanceToPoint(Z.end);return _<0&&K>0||K<0&&_>0}intersectsBox(Z){return Z.intersectsPlane(this)}intersectsSphere(Z){return Z.intersectsPlane(this)}coplanarPoint(Z){return Z.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(Z,_){const K=_||_normalMatrix.getNormalMatrix(Z),te=this.coplanarPoint(_vector1).applyMatrix4(Z),ne=this.normal.applyMatrix3(K).normalize();return this.constant=-te.dot(ne),this}translate(Z){return this.constant-=Z.dot(this.normal),this}equals(Z){return Z.normal.equals(this.normal)&&Z.constant===this.constant}clone(){return new this.constructor().copy(this)}}const _sphere$4=new Sphere,_vector$6=new Vector3;class Frustum{constructor(Z=new Plane,_=new Plane,K=new Plane,te=new Plane,ne=new Plane,oe=new Plane){this.planes=[Z,_,K,te,ne,oe]}set(Z,_,K,te,ne,oe){const ie=this.planes;return ie[0].copy(Z),ie[1].copy(_),ie[2].copy(K),ie[3].copy(te),ie[4].copy(ne),ie[5].copy(oe),this}copy(Z){const _=this.planes;for(let K=0;K<6;K++)_[K].copy(Z.planes[K]);return this}setFromProjectionMatrix(Z,_=WebGLCoordinateSystem){const K=this.planes,te=Z.elements,ne=te[0],oe=te[1],ie=te[2],se=te[3],ae=te[4],ge=te[5],ce=te[6],de=te[7],pe=te[8],fe=te[9],be=te[10],me=te[11],ye=te[12],ve=te[13],Be=te[14],Re=te[15];if(K[0].setComponents(se-ne,de-ae,me-pe,Re-ye).normalize(),K[1].setComponents(se+ne,de+ae,me+pe,Re+ye).normalize(),K[2].setComponents(se+oe,de+ge,me+fe,Re+ve).normalize(),K[3].setComponents(se-oe,de-ge,me-fe,Re-ve).normalize(),K[4].setComponents(se-ie,de-ce,me-be,Re-Be).normalize(),_===WebGLCoordinateSystem)K[5].setComponents(se+ie,de+ce,me+be,Re+Be).normalize();else if(_===WebGPUCoordinateSystem)K[5].setComponents(ie,ce,be,Be).normalize();else throw new Error("THREE.Frustum.setFromProjectionMatrix(): Invalid coordinate system: "+_);return this}intersectsObject(Z){if(Z.boundingSphere!==void 0)Z.boundingSphere===null&&Z.computeBoundingSphere(),_sphere$4.copy(Z.boundingSphere).applyMatrix4(Z.matrixWorld);else{const _=Z.geometry;_.boundingSphere===null&&_.computeBoundingSphere(),_sphere$4.copy(_.boundingSphere).applyMatrix4(Z.matrixWorld)}return this.intersectsSphere(_sphere$4)}intersectsSprite(Z){return _sphere$4.center.set(0,0,0),_sphere$4.radius=.7071067811865476,_sphere$4.applyMatrix4(Z.matrixWorld),this.intersectsSphere(_sphere$4)}intersectsSphere(Z){const _=this.planes,K=Z.center,te=-Z.radius;for(let ne=0;ne<6;ne++)if(_[ne].distanceToPoint(K)<te)return!1;return!0}intersectsBox(Z){const _=this.planes;for(let K=0;K<6;K++){const te=_[K];if(_vector$6.x=te.normal.x>0?Z.max.x:Z.min.x,_vector$6.y=te.normal.y>0?Z.max.y:Z.min.y,_vector$6.z=te.normal.z>0?Z.max.z:Z.min.z,te.distanceToPoint(_vector$6)<0)return!1}return!0}containsPoint(Z){const _=this.planes;for(let K=0;K<6;K++)if(_[K].distanceToPoint(Z)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}}function WebGLAnimation(){let X=null,Z=!1,_=null,K=null;function te(ne,oe){_(ne,oe),K=X.requestAnimationFrame(te)}return{start:function(){Z!==!0&&_!==null&&(K=X.requestAnimationFrame(te),Z=!0)},stop:function(){X.cancelAnimationFrame(K),Z=!1},setAnimationLoop:function(ne){_=ne},setContext:function(ne){X=ne}}}function WebGLAttributes(X,Z){const _=Z.isWebGL2,K=new WeakMap;function te(ae,ge){const ce=ae.array,de=ae.usage,pe=X.createBuffer();X.bindBuffer(ge,pe),X.bufferData(ge,ce,de),ae.onUploadCallback();let fe;if(ce instanceof Float32Array)fe=X.FLOAT;else if(ce instanceof Uint16Array)if(ae.isFloat16BufferAttribute)if(_)fe=X.HALF_FLOAT;else throw new Error("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2.");else fe=X.UNSIGNED_SHORT;else if(ce instanceof Int16Array)fe=X.SHORT;else if(ce instanceof Uint32Array)fe=X.UNSIGNED_INT;else if(ce instanceof Int32Array)fe=X.INT;else if(ce instanceof Int8Array)fe=X.BYTE;else if(ce instanceof Uint8Array)fe=X.UNSIGNED_BYTE;else if(ce instanceof Uint8ClampedArray)fe=X.UNSIGNED_BYTE;else throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+ce);return{buffer:pe,type:fe,bytesPerElement:ce.BYTES_PER_ELEMENT,version:ae.version}}function ne(ae,ge,ce){const de=ge.array,pe=ge.updateRange;X.bindBuffer(ce,ae),pe.count===-1?X.bufferSubData(ce,0,de):(_?X.bufferSubData(ce,pe.offset*de.BYTES_PER_ELEMENT,de,pe.offset,pe.count):X.bufferSubData(ce,pe.offset*de.BYTES_PER_ELEMENT,de.subarray(pe.offset,pe.offset+pe.count)),pe.count=-1),ge.onUploadCallback()}function oe(ae){return ae.isInterleavedBufferAttribute&&(ae=ae.data),K.get(ae)}function ie(ae){ae.isInterleavedBufferAttribute&&(ae=ae.data);const ge=K.get(ae);ge&&(X.deleteBuffer(ge.buffer),K.delete(ae))}function se(ae,ge){if(ae.isGLBufferAttribute){const de=K.get(ae);(!de||de.version<ae.version)&&K.set(ae,{buffer:ae.buffer,type:ae.type,bytesPerElement:ae.elementSize,version:ae.version});return}ae.isInterleavedBufferAttribute&&(ae=ae.data);const ce=K.get(ae);ce===void 0?K.set(ae,te(ae,ge)):ce.version<ae.version&&(ne(ce.buffer,ae,ge),ce.version=ae.version)}return{get:oe,remove:ie,update:se}}class PlaneGeometry extends BufferGeometry{constructor(Z=1,_=1,K=1,te=1){super(),this.type="PlaneGeometry",this.parameters={width:Z,height:_,widthSegments:K,heightSegments:te};const ne=Z/2,oe=_/2,ie=Math.floor(K),se=Math.floor(te),ae=ie+1,ge=se+1,ce=Z/ie,de=_/se,pe=[],fe=[],be=[],me=[];for(let ye=0;ye<ge;ye++){const ve=ye*de-oe;for(let Be=0;Be<ae;Be++){const Re=Be*ce-ne;fe.push(Re,-ve,0),be.push(0,0,1),me.push(Be/ie),me.push(1-ye/se)}}for(let ye=0;ye<se;ye++)for(let ve=0;ve<ie;ve++){const Be=ve+ae*ye,Re=ve+ae*(ye+1),Ee=ve+1+ae*(ye+1),We=ve+1+ae*ye;pe.push(Be,Re,We),pe.push(Re,Ee,We)}this.setIndex(pe),this.setAttribute("position",new Float32BufferAttribute(fe,3)),this.setAttribute("normal",new Float32BufferAttribute(be,3)),this.setAttribute("uv",new Float32BufferAttribute(me,2))}copy(Z){return super.copy(Z),this.parameters=Object.assign({},Z.parameters),this}static fromJSON(Z){return new PlaneGeometry(Z.width,Z.height,Z.widthSegments,Z.heightSegments)}}var alphahash_fragment=`#ifdef USE_ALPHAHASH
	if ( diffuseColor.a < getAlphaHashThreshold( vPosition ) ) discard;
#endif`,alphahash_pars_fragment=`#ifdef USE_ALPHAHASH
	const float ALPHA_HASH_SCALE = 0.05;
	float hash2D( vec2 value ) {
		return fract( 1.0e4 * sin( 17.0 * value.x + 0.1 * value.y ) * ( 0.1 + abs( sin( 13.0 * value.y + value.x ) ) ) );
	}
	float hash3D( vec3 value ) {
		return hash2D( vec2( hash2D( value.xy ), value.z ) );
	}
	float getAlphaHashThreshold( vec3 position ) {
		float maxDeriv = max(
			length( dFdx( position.xyz ) ),
			length( dFdy( position.xyz ) )
		);
		float pixScale = 1.0 / ( ALPHA_HASH_SCALE * maxDeriv );
		vec2 pixScales = vec2(
			exp2( floor( log2( pixScale ) ) ),
			exp2( ceil( log2( pixScale ) ) )
		);
		vec2 alpha = vec2(
			hash3D( floor( pixScales.x * position.xyz ) ),
			hash3D( floor( pixScales.y * position.xyz ) )
		);
		float lerpFactor = fract( log2( pixScale ) );
		float x = ( 1.0 - lerpFactor ) * alpha.x + lerpFactor * alpha.y;
		float a = min( lerpFactor, 1.0 - lerpFactor );
		vec3 cases = vec3(
			x * x / ( 2.0 * a * ( 1.0 - a ) ),
			( x - 0.5 * a ) / ( 1.0 - a ),
			1.0 - ( ( 1.0 - x ) * ( 1.0 - x ) / ( 2.0 * a * ( 1.0 - a ) ) )
		);
		float threshold = ( x < ( 1.0 - a ) )
			? ( ( x < a ) ? cases.x : cases.y )
			: cases.z;
		return clamp( threshold , 1.0e-6, 1.0 );
	}
#endif`,alphamap_fragment=`#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, vAlphaMapUv ).g;
#endif`,alphamap_pars_fragment=`#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,alphatest_fragment=`#ifdef USE_ALPHATEST
	if ( diffuseColor.a < alphaTest ) discard;
#endif`,alphatest_pars_fragment=`#ifdef USE_ALPHATEST
	uniform float alphaTest;
#endif`,aomap_fragment=`#ifdef USE_AOMAP
	float ambientOcclusion = ( texture2D( aoMap, vAoMapUv ).r - 1.0 ) * aoMapIntensity + 1.0;
	reflectedLight.indirectDiffuse *= ambientOcclusion;
	#if defined( USE_ENVMAP ) && defined( STANDARD )
		float dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );
		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );
	#endif
#endif`,aomap_pars_fragment=`#ifdef USE_AOMAP
	uniform sampler2D aoMap;
	uniform float aoMapIntensity;
#endif`,begin_vertex=`vec3 transformed = vec3( position );
#ifdef USE_ALPHAHASH
	vPosition = vec3( position );
#endif`,beginnormal_vertex=`vec3 objectNormal = vec3( normal );
#ifdef USE_TANGENT
	vec3 objectTangent = vec3( tangent.xyz );
#endif`,bsdfs=`float G_BlinnPhong_Implicit( ) {
	return 0.25;
}
float D_BlinnPhong( const in float shininess, const in float dotNH ) {
	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );
}
vec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( specularColor, 1.0, dotVH );
	float G = G_BlinnPhong_Implicit( );
	float D = D_BlinnPhong( shininess, dotNH );
	return F * ( G * D );
} // validated`,iridescence_fragment=`#ifdef USE_IRIDESCENCE
	const mat3 XYZ_TO_REC709 = mat3(
		 3.2404542, -0.9692660,  0.0556434,
		-1.5371385,  1.8760108, -0.2040259,
		-0.4985314,  0.0415560,  1.0572252
	);
	vec3 Fresnel0ToIor( vec3 fresnel0 ) {
		vec3 sqrtF0 = sqrt( fresnel0 );
		return ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );
	}
	vec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );
	}
	float IorToFresnel0( float transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));
	}
	vec3 evalSensitivity( float OPD, vec3 shift ) {
		float phase = 2.0 * PI * OPD * 1.0e-9;
		vec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );
		vec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );
		vec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );
		vec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );
		xyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );
		xyz /= 1.0685e-7;
		vec3 rgb = XYZ_TO_REC709 * xyz;
		return rgb;
	}
	vec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {
		vec3 I;
		float iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );
		float sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );
		float cosTheta2Sq = 1.0 - sinTheta2Sq;
		if ( cosTheta2Sq < 0.0 ) {
			 return vec3( 1.0 );
		}
		float cosTheta2 = sqrt( cosTheta2Sq );
		float R0 = IorToFresnel0( iridescenceIOR, outsideIOR );
		float R12 = F_Schlick( R0, 1.0, cosTheta1 );
		float R21 = R12;
		float T121 = 1.0 - R12;
		float phi12 = 0.0;
		if ( iridescenceIOR < outsideIOR ) phi12 = PI;
		float phi21 = PI - phi12;
		vec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );		vec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );
		vec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );
		vec3 phi23 = vec3( 0.0 );
		if ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;
		if ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;
		if ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;
		float OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;
		vec3 phi = vec3( phi21 ) + phi23;
		vec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );
		vec3 r123 = sqrt( R123 );
		vec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );
		vec3 C0 = R12 + Rs;
		I = C0;
		vec3 Cm = Rs - T121;
		for ( int m = 1; m <= 2; ++ m ) {
			Cm *= r123;
			vec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );
			I += Cm * Sm;
		}
		return max( I, vec3( 0.0 ) );
	}
#endif`,bumpmap_pars_fragment=`#ifdef USE_BUMPMAP
	uniform sampler2D bumpMap;
	uniform float bumpScale;
	vec2 dHdxy_fwd() {
		vec2 dSTdx = dFdx( vBumpMapUv );
		vec2 dSTdy = dFdy( vBumpMapUv );
		float Hll = bumpScale * texture2D( bumpMap, vBumpMapUv ).x;
		float dBx = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdx ).x - Hll;
		float dBy = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdy ).x - Hll;
		return vec2( dBx, dBy );
	}
	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {
		vec3 vSigmaX = dFdx( surf_pos.xyz );
		vec3 vSigmaY = dFdy( surf_pos.xyz );
		vec3 vN = surf_norm;
		vec3 R1 = cross( vSigmaY, vN );
		vec3 R2 = cross( vN, vSigmaX );
		float fDet = dot( vSigmaX, R1 ) * faceDirection;
		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
		return normalize( abs( fDet ) * surf_norm - vGrad );
	}
#endif`,clipping_planes_fragment=`#if NUM_CLIPPING_PLANES > 0
	vec4 plane;
	#pragma unroll_loop_start
	for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
		plane = clippingPlanes[ i ];
		if ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;
	}
	#pragma unroll_loop_end
	#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
		bool clipped = true;
		#pragma unroll_loop_start
		for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			clipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;
		}
		#pragma unroll_loop_end
		if ( clipped ) discard;
	#endif
#endif`,clipping_planes_pars_fragment=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];
#endif`,clipping_planes_pars_vertex=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
#endif`,clipping_planes_vertex=`#if NUM_CLIPPING_PLANES > 0
	vClipPosition = - mvPosition.xyz;
#endif`,color_fragment=`#if defined( USE_COLOR_ALPHA )
	diffuseColor *= vColor;
#elif defined( USE_COLOR )
	diffuseColor.rgb *= vColor;
#endif`,color_pars_fragment=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR )
	varying vec3 vColor;
#endif`,color_pars_vertex=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	varying vec3 vColor;
#endif`,color_vertex=`#if defined( USE_COLOR_ALPHA )
	vColor = vec4( 1.0 );
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	vColor = vec3( 1.0 );
#endif
#ifdef USE_COLOR
	vColor *= color;
#endif
#ifdef USE_INSTANCING_COLOR
	vColor.xyz *= instanceColor.xyz;
#endif`,common=`#define PI 3.141592653589793
#define PI2 6.283185307179586
#define PI_HALF 1.5707963267948966
#define RECIPROCAL_PI 0.3183098861837907
#define RECIPROCAL_PI2 0.15915494309189535
#define EPSILON 1e-6
#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
#define whiteComplement( a ) ( 1.0 - saturate( a ) )
float pow2( const in float x ) { return x*x; }
vec3 pow2( const in vec3 x ) { return x*x; }
float pow3( const in float x ) { return x*x*x; }
float pow4( const in float x ) { float x2 = x*x; return x2*x2; }
float max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }
float average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }
highp float rand( const in vec2 uv ) {
	const highp float a = 12.9898, b = 78.233, c = 43758.5453;
	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );
	return fract( sin( sn ) * c );
}
#ifdef HIGH_PRECISION
	float precisionSafeLength( vec3 v ) { return length( v ); }
#else
	float precisionSafeLength( vec3 v ) {
		float maxComponent = max3( abs( v ) );
		return length( v / maxComponent ) * maxComponent;
	}
#endif
struct IncidentLight {
	vec3 color;
	vec3 direction;
	bool visible;
};
struct ReflectedLight {
	vec3 directDiffuse;
	vec3 directSpecular;
	vec3 indirectDiffuse;
	vec3 indirectSpecular;
};
struct GeometricContext {
	vec3 position;
	vec3 normal;
	vec3 viewDir;
#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal;
#endif
};
#ifdef USE_ALPHAHASH
	varying vec3 vPosition;
#endif
vec3 transformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
}
vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );
}
mat3 transposeMat3( const in mat3 m ) {
	mat3 tmp;
	tmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );
	tmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );
	tmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );
	return tmp;
}
float luminance( const in vec3 rgb ) {
	const vec3 weights = vec3( 0.2126729, 0.7151522, 0.0721750 );
	return dot( weights, rgb );
}
bool isPerspectiveMatrix( mat4 m ) {
	return m[ 2 ][ 3 ] == - 1.0;
}
vec2 equirectUv( in vec3 dir ) {
	float u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;
	float v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
	return vec2( u, v );
}
vec3 BRDF_Lambert( const in vec3 diffuseColor ) {
	return RECIPROCAL_PI * diffuseColor;
}
vec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
float F_Schlick( const in float f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
} // validated`,cube_uv_reflection_fragment=`#ifdef ENVMAP_TYPE_CUBE_UV
	#define cubeUV_minMipLevel 4.0
	#define cubeUV_minTileSize 16.0
	float getFace( vec3 direction ) {
		vec3 absDirection = abs( direction );
		float face = - 1.0;
		if ( absDirection.x > absDirection.z ) {
			if ( absDirection.x > absDirection.y )
				face = direction.x > 0.0 ? 0.0 : 3.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		} else {
			if ( absDirection.z > absDirection.y )
				face = direction.z > 0.0 ? 2.0 : 5.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		}
		return face;
	}
	vec2 getUV( vec3 direction, float face ) {
		vec2 uv;
		if ( face == 0.0 ) {
			uv = vec2( direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 1.0 ) {
			uv = vec2( - direction.x, - direction.z ) / abs( direction.y );
		} else if ( face == 2.0 ) {
			uv = vec2( - direction.x, direction.y ) / abs( direction.z );
		} else if ( face == 3.0 ) {
			uv = vec2( - direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 4.0 ) {
			uv = vec2( - direction.x, direction.z ) / abs( direction.y );
		} else {
			uv = vec2( direction.x, direction.y ) / abs( direction.z );
		}
		return 0.5 * ( uv + 1.0 );
	}
	vec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {
		float face = getFace( direction );
		float filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );
		mipInt = max( mipInt, cubeUV_minMipLevel );
		float faceSize = exp2( mipInt );
		highp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;
		if ( face > 2.0 ) {
			uv.y += faceSize;
			face -= 3.0;
		}
		uv.x += face * faceSize;
		uv.x += filterInt * 3.0 * cubeUV_minTileSize;
		uv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );
		uv.x *= CUBEUV_TEXEL_WIDTH;
		uv.y *= CUBEUV_TEXEL_HEIGHT;
		#ifdef texture2DGradEXT
			return texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;
		#else
			return texture2D( envMap, uv ).rgb;
		#endif
	}
	#define cubeUV_r0 1.0
	#define cubeUV_v0 0.339
	#define cubeUV_m0 - 2.0
	#define cubeUV_r1 0.8
	#define cubeUV_v1 0.276
	#define cubeUV_m1 - 1.0
	#define cubeUV_r4 0.4
	#define cubeUV_v4 0.046
	#define cubeUV_m4 2.0
	#define cubeUV_r5 0.305
	#define cubeUV_v5 0.016
	#define cubeUV_m5 3.0
	#define cubeUV_r6 0.21
	#define cubeUV_v6 0.0038
	#define cubeUV_m6 4.0
	float roughnessToMip( float roughness ) {
		float mip = 0.0;
		if ( roughness >= cubeUV_r1 ) {
			mip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;
		} else if ( roughness >= cubeUV_r4 ) {
			mip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;
		} else if ( roughness >= cubeUV_r5 ) {
			mip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;
		} else if ( roughness >= cubeUV_r6 ) {
			mip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;
		} else {
			mip = - 2.0 * log2( 1.16 * roughness );		}
		return mip;
	}
	vec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {
		float mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );
		float mipF = fract( mip );
		float mipInt = floor( mip );
		vec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );
		if ( mipF == 0.0 ) {
			return vec4( color0, 1.0 );
		} else {
			vec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );
			return vec4( mix( color0, color1, mipF ), 1.0 );
		}
	}
#endif`,defaultnormal_vertex=`vec3 transformedNormal = objectNormal;
#ifdef USE_INSTANCING
	mat3 m = mat3( instanceMatrix );
	transformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );
	transformedNormal = m * transformedNormal;
#endif
transformedNormal = normalMatrix * transformedNormal;
#ifdef FLIP_SIDED
	transformedNormal = - transformedNormal;
#endif
#ifdef USE_TANGENT
	vec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#ifdef FLIP_SIDED
		transformedTangent = - transformedTangent;
	#endif
#endif`,displacementmap_pars_vertex=`#ifdef USE_DISPLACEMENTMAP
	uniform sampler2D displacementMap;
	uniform float displacementScale;
	uniform float displacementBias;
#endif`,displacementmap_vertex=`#ifdef USE_DISPLACEMENTMAP
	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, vDisplacementMapUv ).x * displacementScale + displacementBias );
#endif`,emissivemap_fragment=`#ifdef USE_EMISSIVEMAP
	vec4 emissiveColor = texture2D( emissiveMap, vEmissiveMapUv );
	totalEmissiveRadiance *= emissiveColor.rgb;
#endif`,emissivemap_pars_fragment=`#ifdef USE_EMISSIVEMAP
	uniform sampler2D emissiveMap;
#endif`,colorspace_fragment="gl_FragColor = linearToOutputTexel( gl_FragColor );",colorspace_pars_fragment=`vec4 LinearToLinear( in vec4 value ) {
	return value;
}
vec4 LinearTosRGB( in vec4 value ) {
	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );
}`,envmap_fragment=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vec3 cameraToFrag;
		if ( isOrthographic ) {
			cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToFrag = normalize( vWorldPosition - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( cameraToFrag, worldNormal );
		#else
			vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );
		#endif
	#else
		vec3 reflectVec = vReflect;
	#endif
	#ifdef ENVMAP_TYPE_CUBE
		vec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );
	#else
		vec4 envColor = vec4( 0.0 );
	#endif
	#ifdef ENVMAP_BLENDING_MULTIPLY
		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_MIX )
		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_ADD )
		outgoingLight += envColor.xyz * specularStrength * reflectivity;
	#endif
#endif`,envmap_common_pars_fragment=`#ifdef USE_ENVMAP
	uniform float envMapIntensity;
	uniform float flipEnvMap;
	#ifdef ENVMAP_TYPE_CUBE
		uniform samplerCube envMap;
	#else
		uniform sampler2D envMap;
	#endif
	
#endif`,envmap_pars_fragment=`#ifdef USE_ENVMAP
	uniform float reflectivity;
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		varying vec3 vWorldPosition;
		uniform float refractionRatio;
	#else
		varying vec3 vReflect;
	#endif
#endif`,envmap_pars_vertex=`#ifdef USE_ENVMAP
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		
		varying vec3 vWorldPosition;
	#else
		varying vec3 vReflect;
		uniform float refractionRatio;
	#endif
#endif`,envmap_vertex=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vWorldPosition = worldPosition.xyz;
	#else
		vec3 cameraToVertex;
		if ( isOrthographic ) {
			cameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToVertex = normalize( worldPosition.xyz - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vReflect = reflect( cameraToVertex, worldNormal );
		#else
			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );
		#endif
	#endif
#endif`,fog_vertex=`#ifdef USE_FOG
	vFogDepth = - mvPosition.z;
#endif`,fog_pars_vertex=`#ifdef USE_FOG
	varying float vFogDepth;
#endif`,fog_fragment=`#ifdef USE_FOG
	#ifdef FOG_EXP2
		float fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );
	#else
		float fogFactor = smoothstep( fogNear, fogFar, vFogDepth );
	#endif
	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );
#endif`,fog_pars_fragment=`#ifdef USE_FOG
	uniform vec3 fogColor;
	varying float vFogDepth;
	#ifdef FOG_EXP2
		uniform float fogDensity;
	#else
		uniform float fogNear;
		uniform float fogFar;
	#endif
#endif`,gradientmap_pars_fragment=`#ifdef USE_GRADIENTMAP
	uniform sampler2D gradientMap;
#endif
vec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {
	float dotNL = dot( normal, lightDirection );
	vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );
	#ifdef USE_GRADIENTMAP
		return vec3( texture2D( gradientMap, coord ).r );
	#else
		vec2 fw = fwidth( coord ) * 0.5;
		return mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );
	#endif
}`,lightmap_fragment=`#ifdef USE_LIGHTMAP
	vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
	vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
	reflectedLight.indirectDiffuse += lightMapIrradiance;
#endif`,lightmap_pars_fragment=`#ifdef USE_LIGHTMAP
	uniform sampler2D lightMap;
	uniform float lightMapIntensity;
#endif`,lights_lambert_fragment=`LambertMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularStrength = specularStrength;`,lights_lambert_pars_fragment=`varying vec3 vViewPosition;
struct LambertMaterial {
	vec3 diffuseColor;
	float specularStrength;
};
void RE_Direct_Lambert( const in IncidentLight directLight, const in GeometricContext geometry, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in GeometricContext geometry, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Lambert
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Lambert`,lights_pars_begin=`uniform bool receiveShadow;
uniform vec3 ambientLightColor;
uniform vec3 lightProbe[ 9 ];
vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {
	float x = normal.x, y = normal.y, z = normal.z;
	vec3 result = shCoefficients[ 0 ] * 0.886227;
	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;
	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;
	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;
	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;
	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;
	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );
	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;
	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );
	return result;
}
vec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {
	vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );
	return irradiance;
}
vec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {
	vec3 irradiance = ambientLightColor;
	return irradiance;
}
float getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {
	#if defined ( LEGACY_LIGHTS )
		if ( cutoffDistance > 0.0 && decayExponent > 0.0 ) {
			return pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );
		}
		return 1.0;
	#else
		float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );
		if ( cutoffDistance > 0.0 ) {
			distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );
		}
		return distanceFalloff;
	#endif
}
float getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {
	return smoothstep( coneCosine, penumbraCosine, angleCosine );
}
#if NUM_DIR_LIGHTS > 0
	struct DirectionalLight {
		vec3 direction;
		vec3 color;
	};
	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];
	void getDirectionalLightInfo( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight light ) {
		light.color = directionalLight.color;
		light.direction = directionalLight.direction;
		light.visible = true;
	}
#endif
#if NUM_POINT_LIGHTS > 0
	struct PointLight {
		vec3 position;
		vec3 color;
		float distance;
		float decay;
	};
	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];
	void getPointLightInfo( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight light ) {
		vec3 lVector = pointLight.position - geometry.position;
		light.direction = normalize( lVector );
		float lightDistance = length( lVector );
		light.color = pointLight.color;
		light.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );
		light.visible = ( light.color != vec3( 0.0 ) );
	}
#endif
#if NUM_SPOT_LIGHTS > 0
	struct SpotLight {
		vec3 position;
		vec3 direction;
		vec3 color;
		float distance;
		float decay;
		float coneCos;
		float penumbraCos;
	};
	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];
	void getSpotLightInfo( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight light ) {
		vec3 lVector = spotLight.position - geometry.position;
		light.direction = normalize( lVector );
		float angleCos = dot( light.direction, spotLight.direction );
		float spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );
		if ( spotAttenuation > 0.0 ) {
			float lightDistance = length( lVector );
			light.color = spotLight.color * spotAttenuation;
			light.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );
			light.visible = ( light.color != vec3( 0.0 ) );
		} else {
			light.color = vec3( 0.0 );
			light.visible = false;
		}
	}
#endif
#if NUM_RECT_AREA_LIGHTS > 0
	struct RectAreaLight {
		vec3 color;
		vec3 position;
		vec3 halfWidth;
		vec3 halfHeight;
	};
	uniform sampler2D ltc_1;	uniform sampler2D ltc_2;
	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];
#endif
#if NUM_HEMI_LIGHTS > 0
	struct HemisphereLight {
		vec3 direction;
		vec3 skyColor;
		vec3 groundColor;
	};
	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];
	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {
		float dotNL = dot( normal, hemiLight.direction );
		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;
		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );
		return irradiance;
	}
#endif`,envmap_physical_pars_fragment=`#ifdef USE_ENVMAP
	vec3 getIBLIrradiance( const in vec3 normal ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );
			return PI * envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	vec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 reflectVec = reflect( - viewDir, normal );
			reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );
			reflectVec = inverseTransformDirection( reflectVec, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );
			return envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	#ifdef USE_ANISOTROPY
		vec3 getIBLAnisotropyRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in vec3 bitangent, const in float anisotropy ) {
			#ifdef ENVMAP_TYPE_CUBE_UV
				vec3 bentNormal = cross( bitangent, viewDir );
				bentNormal = normalize( cross( bentNormal, bitangent ) );
				bentNormal = normalize( mix( bentNormal, normal, pow2( pow2( 1.0 - anisotropy * ( 1.0 - roughness ) ) ) ) );
				return getIBLRadiance( viewDir, bentNormal, roughness );
			#else
				return vec3( 0.0 );
			#endif
		}
	#endif
#endif`,lights_toon_fragment=`ToonMaterial material;
material.diffuseColor = diffuseColor.rgb;`,lights_toon_pars_fragment=`varying vec3 vViewPosition;
struct ToonMaterial {
	vec3 diffuseColor;
};
void RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	vec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Toon
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon`,lights_phong_fragment=`BlinnPhongMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;`,lights_phong_pars_fragment=`varying vec3 vViewPosition;
struct BlinnPhongMaterial {
	vec3 diffuseColor;
	vec3 specularColor;
	float specularShininess;
	float specularStrength;
};
void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularShininess ) * material.specularStrength;
}
void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong`,lights_physical_fragment=`PhysicalMaterial material;
material.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );
vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );
float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );
material.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;
material.roughness = min( material.roughness, 1.0 );
#ifdef IOR
	material.ior = ior;
	#ifdef USE_SPECULAR
		float specularIntensityFactor = specularIntensity;
		vec3 specularColorFactor = specularColor;
		#ifdef USE_SPECULAR_COLORMAP
			specularColorFactor *= texture2D( specularColorMap, vSpecularColorMapUv ).rgb;
		#endif
		#ifdef USE_SPECULAR_INTENSITYMAP
			specularIntensityFactor *= texture2D( specularIntensityMap, vSpecularIntensityMapUv ).a;
		#endif
		material.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );
	#else
		float specularIntensityFactor = 1.0;
		vec3 specularColorFactor = vec3( 1.0 );
		material.specularF90 = 1.0;
	#endif
	material.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );
#else
	material.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );
	material.specularF90 = 1.0;
#endif
#ifdef USE_CLEARCOAT
	material.clearcoat = clearcoat;
	material.clearcoatRoughness = clearcoatRoughness;
	material.clearcoatF0 = vec3( 0.04 );
	material.clearcoatF90 = 1.0;
	#ifdef USE_CLEARCOATMAP
		material.clearcoat *= texture2D( clearcoatMap, vClearcoatMapUv ).x;
	#endif
	#ifdef USE_CLEARCOAT_ROUGHNESSMAP
		material.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vClearcoatRoughnessMapUv ).y;
	#endif
	material.clearcoat = saturate( material.clearcoat );	material.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );
	material.clearcoatRoughness += geometryRoughness;
	material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );
#endif
#ifdef USE_IRIDESCENCE
	material.iridescence = iridescence;
	material.iridescenceIOR = iridescenceIOR;
	#ifdef USE_IRIDESCENCEMAP
		material.iridescence *= texture2D( iridescenceMap, vIridescenceMapUv ).r;
	#endif
	#ifdef USE_IRIDESCENCE_THICKNESSMAP
		material.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vIridescenceThicknessMapUv ).g + iridescenceThicknessMinimum;
	#else
		material.iridescenceThickness = iridescenceThicknessMaximum;
	#endif
#endif
#ifdef USE_SHEEN
	material.sheenColor = sheenColor;
	#ifdef USE_SHEEN_COLORMAP
		material.sheenColor *= texture2D( sheenColorMap, vSheenColorMapUv ).rgb;
	#endif
	material.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );
	#ifdef USE_SHEEN_ROUGHNESSMAP
		material.sheenRoughness *= texture2D( sheenRoughnessMap, vSheenRoughnessMapUv ).a;
	#endif
#endif
#ifdef USE_ANISOTROPY
	#ifdef USE_ANISOTROPYMAP
		mat2 anisotropyMat = mat2( anisotropyVector.x, anisotropyVector.y, - anisotropyVector.y, anisotropyVector.x );
		vec3 anisotropyPolar = texture2D( anisotropyMap, vAnisotropyMapUv ).rgb;
		vec2 anisotropyV = anisotropyMat * normalize( 2.0 * anisotropyPolar.rg - vec2( 1.0 ) ) * anisotropyPolar.b;
	#else
		vec2 anisotropyV = anisotropyVector;
	#endif
	material.anisotropy = length( anisotropyV );
	anisotropyV /= material.anisotropy;
	material.anisotropy = saturate( material.anisotropy );
	material.alphaT = mix( pow2( material.roughness ), 1.0, pow2( material.anisotropy ) );
	material.anisotropyT = tbn[ 0 ] * anisotropyV.x - tbn[ 1 ] * anisotropyV.y;
	material.anisotropyB = tbn[ 1 ] * anisotropyV.x + tbn[ 0 ] * anisotropyV.y;
#endif`,lights_physical_pars_fragment=`struct PhysicalMaterial {
	vec3 diffuseColor;
	float roughness;
	vec3 specularColor;
	float specularF90;
	#ifdef USE_CLEARCOAT
		float clearcoat;
		float clearcoatRoughness;
		vec3 clearcoatF0;
		float clearcoatF90;
	#endif
	#ifdef USE_IRIDESCENCE
		float iridescence;
		float iridescenceIOR;
		float iridescenceThickness;
		vec3 iridescenceFresnel;
		vec3 iridescenceF0;
	#endif
	#ifdef USE_SHEEN
		vec3 sheenColor;
		float sheenRoughness;
	#endif
	#ifdef IOR
		float ior;
	#endif
	#ifdef USE_TRANSMISSION
		float transmission;
		float transmissionAlpha;
		float thickness;
		float attenuationDistance;
		vec3 attenuationColor;
	#endif
	#ifdef USE_ANISOTROPY
		float anisotropy;
		float alphaT;
		vec3 anisotropyT;
		vec3 anisotropyB;
	#endif
};
vec3 clearcoatSpecular = vec3( 0.0 );
vec3 sheenSpecular = vec3( 0.0 );
vec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {
    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );
    float x2 = x * x;
    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );
    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );
}
float V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	return 0.5 / max( gv + gl, EPSILON );
}
float D_GGX( const in float alpha, const in float dotNH ) {
	float a2 = pow2( alpha );
	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;
	return RECIPROCAL_PI * a2 / pow2( denom );
}
#ifdef USE_ANISOTROPY
	float V_GGX_SmithCorrelated_Anisotropic( const in float alphaT, const in float alphaB, const in float dotTV, const in float dotBV, const in float dotTL, const in float dotBL, const in float dotNV, const in float dotNL ) {
		float gv = dotNL * length( vec3( alphaT * dotTV, alphaB * dotBV, dotNV ) );
		float gl = dotNV * length( vec3( alphaT * dotTL, alphaB * dotBL, dotNL ) );
		float v = 0.5 / ( gv + gl );
		return saturate(v);
	}
	float D_GGX_Anisotropic( const in float alphaT, const in float alphaB, const in float dotNH, const in float dotTH, const in float dotBH ) {
		float a2 = alphaT * alphaB;
		highp vec3 v = vec3( alphaB * dotTH, alphaT * dotBH, a2 * dotNH );
		highp float v2 = dot( v, v );
		float w2 = a2 / v2;
		return RECIPROCAL_PI * a2 * pow2 ( w2 );
	}
#endif
#ifdef USE_CLEARCOAT
	vec3 BRDF_GGX_Clearcoat( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material) {
		vec3 f0 = material.clearcoatF0;
		float f90 = material.clearcoatF90;
		float roughness = material.clearcoatRoughness;
		float alpha = pow2( roughness );
		vec3 halfDir = normalize( lightDir + viewDir );
		float dotNL = saturate( dot( normal, lightDir ) );
		float dotNV = saturate( dot( normal, viewDir ) );
		float dotNH = saturate( dot( normal, halfDir ) );
		float dotVH = saturate( dot( viewDir, halfDir ) );
		vec3 F = F_Schlick( f0, f90, dotVH );
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
		return F * ( V * D );
	}
#endif
vec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material ) {
	vec3 f0 = material.specularColor;
	float f90 = material.specularF90;
	float roughness = material.roughness;
	float alpha = pow2( roughness );
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( f0, f90, dotVH );
	#ifdef USE_IRIDESCENCE
		F = mix( F, material.iridescenceFresnel, material.iridescence );
	#endif
	#ifdef USE_ANISOTROPY
		float dotTL = dot( material.anisotropyT, lightDir );
		float dotTV = dot( material.anisotropyT, viewDir );
		float dotTH = dot( material.anisotropyT, halfDir );
		float dotBL = dot( material.anisotropyB, lightDir );
		float dotBV = dot( material.anisotropyB, viewDir );
		float dotBH = dot( material.anisotropyB, halfDir );
		float V = V_GGX_SmithCorrelated_Anisotropic( material.alphaT, alpha, dotTV, dotBV, dotTL, dotBL, dotNV, dotNL );
		float D = D_GGX_Anisotropic( material.alphaT, alpha, dotNH, dotTH, dotBH );
	#else
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
	#endif
	return F * ( V * D );
}
vec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {
	const float LUT_SIZE = 64.0;
	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;
	const float LUT_BIAS = 0.5 / LUT_SIZE;
	float dotNV = saturate( dot( N, V ) );
	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );
	uv = uv * LUT_SCALE + LUT_BIAS;
	return uv;
}
float LTC_ClippedSphereFormFactor( const in vec3 f ) {
	float l = length( f );
	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );
}
vec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {
	float x = dot( v1, v2 );
	float y = abs( x );
	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;
	float b = 3.4175940 + ( 4.1616724 + y ) * y;
	float v = a / b;
	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;
	return cross( v1, v2 ) * theta_sintheta;
}
vec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {
	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];
	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];
	vec3 lightNormal = cross( v1, v2 );
	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );
	vec3 T1, T2;
	T1 = normalize( V - N * dot( V, N ) );
	T2 = - cross( N, T1 );
	mat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );
	vec3 coords[ 4 ];
	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );
	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );
	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );
	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );
	coords[ 0 ] = normalize( coords[ 0 ] );
	coords[ 1 ] = normalize( coords[ 1 ] );
	coords[ 2 ] = normalize( coords[ 2 ] );
	coords[ 3 ] = normalize( coords[ 3 ] );
	vec3 vectorFormFactor = vec3( 0.0 );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );
	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );
	return vec3( result );
}
#if defined( USE_SHEEN )
float D_Charlie( float roughness, float dotNH ) {
	float alpha = pow2( roughness );
	float invAlpha = 1.0 / alpha;
	float cos2h = dotNH * dotNH;
	float sin2h = max( 1.0 - cos2h, 0.0078125 );
	return ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );
}
float V_Neubelt( float dotNV, float dotNL ) {
	return saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );
}
vec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float D = D_Charlie( sheenRoughness, dotNH );
	float V = V_Neubelt( dotNV, dotNL );
	return sheenColor * ( D * V );
}
#endif
float IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	float r2 = roughness * roughness;
	float a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;
	float b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;
	float DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );
	return saturate( DG * RECIPROCAL_PI );
}
vec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	const vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );
	const vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );
	vec4 r = roughness * c0 + c1;
	float a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;
	vec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;
	return fab;
}
vec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	return specularColor * fab.x + specularF90 * fab.y;
}
#ifdef USE_IRIDESCENCE
void computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#else
void computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#endif
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	#ifdef USE_IRIDESCENCE
		vec3 Fr = mix( specularColor, iridescenceF0, iridescence );
	#else
		vec3 Fr = specularColor;
	#endif
	vec3 FssEss = Fr * fab.x + specularF90 * fab.y;
	float Ess = fab.x + fab.y;
	float Ems = 1.0 - Ess;
	vec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );
	singleScatter += FssEss;
	multiScatter += Fms * Ems;
}
#if NUM_RECT_AREA_LIGHTS > 0
	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
		vec3 normal = geometry.normal;
		vec3 viewDir = geometry.viewDir;
		vec3 position = geometry.position;
		vec3 lightPos = rectAreaLight.position;
		vec3 halfWidth = rectAreaLight.halfWidth;
		vec3 halfHeight = rectAreaLight.halfHeight;
		vec3 lightColor = rectAreaLight.color;
		float roughness = material.roughness;
		vec3 rectCoords[ 4 ];
		rectCoords[ 0 ] = lightPos + halfWidth - halfHeight;		rectCoords[ 1 ] = lightPos - halfWidth - halfHeight;
		rectCoords[ 2 ] = lightPos - halfWidth + halfHeight;
		rectCoords[ 3 ] = lightPos + halfWidth + halfHeight;
		vec2 uv = LTC_Uv( normal, viewDir, roughness );
		vec4 t1 = texture2D( ltc_1, uv );
		vec4 t2 = texture2D( ltc_2, uv );
		mat3 mInv = mat3(
			vec3( t1.x, 0, t1.y ),
			vec3(    0, 1,    0 ),
			vec3( t1.z, 0, t1.w )
		);
		vec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );
		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );
		reflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );
	}
#endif
void RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifdef USE_CLEARCOAT
		float dotNLcc = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );
		vec3 ccIrradiance = dotNLcc * directLight.color;
		clearcoatSpecular += ccIrradiance * BRDF_GGX_Clearcoat( directLight.direction, geometry.viewDir, geometry.clearcoatNormal, material );
	#endif
	#ifdef USE_SHEEN
		sheenSpecular += irradiance * BRDF_Sheen( directLight.direction, geometry.viewDir, geometry.normal, material.sheenColor, material.sheenRoughness );
	#endif
	reflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.normal, material );
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
	#ifdef USE_CLEARCOAT
		clearcoatSpecular += clearcoatRadiance * EnvironmentBRDF( geometry.clearcoatNormal, geometry.viewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecular += irradiance * material.sheenColor * IBLSheenBRDF( geometry.normal, geometry.viewDir, material.sheenRoughness );
	#endif
	vec3 singleScattering = vec3( 0.0 );
	vec3 multiScattering = vec3( 0.0 );
	vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;
	#ifdef USE_IRIDESCENCE
		computeMultiscatteringIridescence( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );
	#else
		computeMultiscattering( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );
	#endif
	vec3 totalScattering = singleScattering + multiScattering;
	vec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );
	reflectedLight.indirectSpecular += radiance * singleScattering;
	reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;
	reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;
}
#define RE_Direct				RE_Direct_Physical
#define RE_Direct_RectArea		RE_Direct_RectArea_Physical
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical
#define RE_IndirectSpecular		RE_IndirectSpecular_Physical
float computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {
	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );
}`,lights_fragment_begin=`
GeometricContext geometry;
geometry.position = - vViewPosition;
geometry.normal = normal;
geometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );
#ifdef USE_CLEARCOAT
	geometry.clearcoatNormal = clearcoatNormal;
#endif
#ifdef USE_IRIDESCENCE
	float dotNVi = saturate( dot( normal, geometry.viewDir ) );
	if ( material.iridescenceThickness == 0.0 ) {
		material.iridescence = 0.0;
	} else {
		material.iridescence = saturate( material.iridescence );
	}
	if ( material.iridescence > 0.0 ) {
		material.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );
		material.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );
	}
#endif
IncidentLight directLight;
#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )
	PointLight pointLight;
	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		pointLight = pointLights[ i ];
		getPointLightInfo( pointLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )
		pointLightShadow = pointLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )
	SpotLight spotLight;
	vec4 spotColor;
	vec3 spotLightCoord;
	bool inSpotLightMap;
	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		spotLight = spotLights[ i ];
		getSpotLightInfo( spotLight, geometry, directLight );
		#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX
		#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS
		#else
		#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#endif
		#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )
			spotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;
			inSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );
			spotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );
			directLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;
		#endif
		#undef SPOT_LIGHT_MAP_INDEX
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		spotLightShadow = spotLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )
	DirectionalLight directionalLight;
	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		directionalLight = directionalLights[ i ];
		getDirectionalLightInfo( directionalLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
		directionalLightShadow = directionalLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )
	RectAreaLight rectAreaLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {
		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if defined( RE_IndirectDiffuse )
	vec3 iblIrradiance = vec3( 0.0 );
	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );
	irradiance += getLightProbeIrradiance( lightProbe, geometry.normal );
	#if ( NUM_HEMI_LIGHTS > 0 )
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );
		}
		#pragma unroll_loop_end
	#endif
#endif
#if defined( RE_IndirectSpecular )
	vec3 radiance = vec3( 0.0 );
	vec3 clearcoatRadiance = vec3( 0.0 );
#endif`,lights_fragment_maps=`#if defined( RE_IndirectDiffuse )
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
		irradiance += lightMapIrradiance;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )
		iblIrradiance += getIBLIrradiance( geometry.normal );
	#endif
#endif
#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )
	#ifdef USE_ANISOTROPY
		radiance += getIBLAnisotropyRadiance( geometry.viewDir, geometry.normal, material.roughness, material.anisotropyB, material.anisotropy );
	#else
		radiance += getIBLRadiance( geometry.viewDir, geometry.normal, material.roughness );
	#endif
	#ifdef USE_CLEARCOAT
		clearcoatRadiance += getIBLRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness );
	#endif
#endif`,lights_fragment_end=`#if defined( RE_IndirectDiffuse )
	RE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );
#endif
#if defined( RE_IndirectSpecular )
	RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );
#endif`,logdepthbuf_fragment=`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	gl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;
#endif`,logdepthbuf_pars_fragment=`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	uniform float logDepthBufFC;
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,logdepthbuf_pars_vertex=`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		varying float vFragDepth;
		varying float vIsPerspective;
	#else
		uniform float logDepthBufFC;
	#endif
#endif`,logdepthbuf_vertex=`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		vFragDepth = 1.0 + gl_Position.w;
		vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );
	#else
		if ( isPerspectiveMatrix( projectionMatrix ) ) {
			gl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;
			gl_Position.z *= gl_Position.w;
		}
	#endif
#endif`,map_fragment=`#ifdef USE_MAP
	diffuseColor *= texture2D( map, vMapUv );
#endif`,map_pars_fragment=`#ifdef USE_MAP
	uniform sampler2D map;
#endif`,map_particle_fragment=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	#if defined( USE_POINTS_UV )
		vec2 uv = vUv;
	#else
		vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;
	#endif
#endif
#ifdef USE_MAP
	diffuseColor *= texture2D( map, uv );
#endif
#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, uv ).g;
#endif`,map_particle_pars_fragment=`#if defined( USE_POINTS_UV )
	varying vec2 vUv;
#else
	#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
		uniform mat3 uvTransform;
	#endif
#endif
#ifdef USE_MAP
	uniform sampler2D map;
#endif
#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,metalnessmap_fragment=`float metalnessFactor = metalness;
#ifdef USE_METALNESSMAP
	vec4 texelMetalness = texture2D( metalnessMap, vMetalnessMapUv );
	metalnessFactor *= texelMetalness.b;
#endif`,metalnessmap_pars_fragment=`#ifdef USE_METALNESSMAP
	uniform sampler2D metalnessMap;
#endif`,morphcolor_vertex=`#if defined( USE_MORPHCOLORS ) && defined( MORPHTARGETS_TEXTURE )
	vColor *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		#if defined( USE_COLOR_ALPHA )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];
		#elif defined( USE_COLOR )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];
		#endif
	}
#endif`,morphnormal_vertex=`#ifdef USE_MORPHNORMALS
	objectNormal *= morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
			if ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];
		}
	#else
		objectNormal += morphNormal0 * morphTargetInfluences[ 0 ];
		objectNormal += morphNormal1 * morphTargetInfluences[ 1 ];
		objectNormal += morphNormal2 * morphTargetInfluences[ 2 ];
		objectNormal += morphNormal3 * morphTargetInfluences[ 3 ];
	#endif
#endif`,morphtarget_pars_vertex=`#ifdef USE_MORPHTARGETS
	uniform float morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		uniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];
		uniform sampler2DArray morphTargetsTexture;
		uniform ivec2 morphTargetsTextureSize;
		vec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {
			int texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;
			int y = texelIndex / morphTargetsTextureSize.x;
			int x = texelIndex - y * morphTargetsTextureSize.x;
			ivec3 morphUV = ivec3( x, y, morphTargetIndex );
			return texelFetch( morphTargetsTexture, morphUV, 0 );
		}
	#else
		#ifndef USE_MORPHNORMALS
			uniform float morphTargetInfluences[ 8 ];
		#else
			uniform float morphTargetInfluences[ 4 ];
		#endif
	#endif
#endif`,morphtarget_vertex=`#ifdef USE_MORPHTARGETS
	transformed *= morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
			if ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];
		}
	#else
		transformed += morphTarget0 * morphTargetInfluences[ 0 ];
		transformed += morphTarget1 * morphTargetInfluences[ 1 ];
		transformed += morphTarget2 * morphTargetInfluences[ 2 ];
		transformed += morphTarget3 * morphTargetInfluences[ 3 ];
		#ifndef USE_MORPHNORMALS
			transformed += morphTarget4 * morphTargetInfluences[ 4 ];
			transformed += morphTarget5 * morphTargetInfluences[ 5 ];
			transformed += morphTarget6 * morphTargetInfluences[ 6 ];
			transformed += morphTarget7 * morphTargetInfluences[ 7 ];
		#endif
	#endif
#endif`,normal_fragment_begin=`float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;
#ifdef FLAT_SHADED
	vec3 fdx = dFdx( vViewPosition );
	vec3 fdy = dFdy( vViewPosition );
	vec3 normal = normalize( cross( fdx, fdy ) );
#else
	vec3 normal = normalize( vNormal );
	#ifdef DOUBLE_SIDED
		normal *= faceDirection;
	#endif
#endif
#if defined( USE_NORMALMAP_TANGENTSPACE ) || defined( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY )
	#ifdef USE_TANGENT
		mat3 tbn = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn = getTangentFrame( - vViewPosition, normal,
		#if defined( USE_NORMALMAP )
			vNormalMapUv
		#elif defined( USE_CLEARCOAT_NORMALMAP )
			vClearcoatNormalMapUv
		#else
			vUv
		#endif
		);
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn[0] *= faceDirection;
		tbn[1] *= faceDirection;
	#endif
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	#ifdef USE_TANGENT
		mat3 tbn2 = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn2 = getTangentFrame( - vViewPosition, normal, vClearcoatNormalMapUv );
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn2[0] *= faceDirection;
		tbn2[1] *= faceDirection;
	#endif
#endif
vec3 geometryNormal = normal;`,normal_fragment_maps=`#ifdef USE_NORMALMAP_OBJECTSPACE
	normal = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	#ifdef FLIP_SIDED
		normal = - normal;
	#endif
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	normal = normalize( normalMatrix * normal );
#elif defined( USE_NORMALMAP_TANGENTSPACE )
	vec3 mapN = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	mapN.xy *= normalScale;
	normal = normalize( tbn * mapN );
#elif defined( USE_BUMPMAP )
	normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );
#endif`,normal_pars_fragment=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,normal_pars_vertex=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,normal_vertex=`#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif`,normalmap_pars_fragment=`#ifdef USE_NORMALMAP
	uniform sampler2D normalMap;
	uniform vec2 normalScale;
#endif
#ifdef USE_NORMALMAP_OBJECTSPACE
	uniform mat3 normalMatrix;
#endif
#if ! defined ( USE_TANGENT ) && ( defined ( USE_NORMALMAP_TANGENTSPACE ) || defined ( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY ) )
	mat3 getTangentFrame( vec3 eye_pos, vec3 surf_norm, vec2 uv ) {
		vec3 q0 = dFdx( eye_pos.xyz );
		vec3 q1 = dFdy( eye_pos.xyz );
		vec2 st0 = dFdx( uv.st );
		vec2 st1 = dFdy( uv.st );
		vec3 N = surf_norm;
		vec3 q1perp = cross( q1, N );
		vec3 q0perp = cross( N, q0 );
		vec3 T = q1perp * st0.x + q0perp * st1.x;
		vec3 B = q1perp * st0.y + q0perp * st1.y;
		float det = max( dot( T, T ), dot( B, B ) );
		float scale = ( det == 0.0 ) ? 0.0 : inversesqrt( det );
		return mat3( T * scale, B * scale, N );
	}
#endif`,clearcoat_normal_fragment_begin=`#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal = geometryNormal;
#endif`,clearcoat_normal_fragment_maps=`#ifdef USE_CLEARCOAT_NORMALMAP
	vec3 clearcoatMapN = texture2D( clearcoatNormalMap, vClearcoatNormalMapUv ).xyz * 2.0 - 1.0;
	clearcoatMapN.xy *= clearcoatNormalScale;
	clearcoatNormal = normalize( tbn2 * clearcoatMapN );
#endif`,clearcoat_pars_fragment=`#ifdef USE_CLEARCOATMAP
	uniform sampler2D clearcoatMap;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform sampler2D clearcoatNormalMap;
	uniform vec2 clearcoatNormalScale;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform sampler2D clearcoatRoughnessMap;
#endif`,iridescence_pars_fragment=`#ifdef USE_IRIDESCENCEMAP
	uniform sampler2D iridescenceMap;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform sampler2D iridescenceThicknessMap;
#endif`,opaque_fragment=`#ifdef OPAQUE
diffuseColor.a = 1.0;
#endif
#ifdef USE_TRANSMISSION
diffuseColor.a *= material.transmissionAlpha;
#endif
gl_FragColor = vec4( outgoingLight, diffuseColor.a );`,packing=`vec3 packNormalToRGB( const in vec3 normal ) {
	return normalize( normal ) * 0.5 + 0.5;
}
vec3 unpackRGBToNormal( const in vec3 rgb ) {
	return 2.0 * rgb.xyz - 1.0;
}
const float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;
const vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );
const vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );
const float ShiftRight8 = 1. / 256.;
vec4 packDepthToRGBA( const in float v ) {
	vec4 r = vec4( fract( v * PackFactors ), v );
	r.yzw -= r.xyz * ShiftRight8;	return r * PackUpscale;
}
float unpackRGBAToDepth( const in vec4 v ) {
	return dot( v, UnpackFactors );
}
vec2 packDepthToRG( in highp float v ) {
	return packDepthToRGBA( v ).yx;
}
float unpackRGToDepth( const in highp vec2 v ) {
	return unpackRGBAToDepth( vec4( v.xy, 0.0, 0.0 ) );
}
vec4 pack2HalfToRGBA( vec2 v ) {
	vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );
	return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );
}
vec2 unpackRGBATo2Half( vec4 v ) {
	return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );
}
float viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {
	return ( viewZ + near ) / ( near - far );
}
float orthographicDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return depth * ( near - far ) - near;
}
float viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {
	return ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );
}
float perspectiveDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return ( near * far ) / ( ( far - near ) * depth - far );
}`,premultiplied_alpha_fragment=`#ifdef PREMULTIPLIED_ALPHA
	gl_FragColor.rgb *= gl_FragColor.a;
#endif`,project_vertex=`vec4 mvPosition = vec4( transformed, 1.0 );
#ifdef USE_INSTANCING
	mvPosition = instanceMatrix * mvPosition;
#endif
mvPosition = modelViewMatrix * mvPosition;
gl_Position = projectionMatrix * mvPosition;`,dithering_fragment=`#ifdef DITHERING
	gl_FragColor.rgb = dithering( gl_FragColor.rgb );
#endif`,dithering_pars_fragment=`#ifdef DITHERING
	vec3 dithering( vec3 color ) {
		float grid_position = rand( gl_FragCoord.xy );
		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );
		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );
		return color + dither_shift_RGB;
	}
#endif`,roughnessmap_fragment=`float roughnessFactor = roughness;
#ifdef USE_ROUGHNESSMAP
	vec4 texelRoughness = texture2D( roughnessMap, vRoughnessMapUv );
	roughnessFactor *= texelRoughness.g;
#endif`,roughnessmap_pars_fragment=`#ifdef USE_ROUGHNESSMAP
	uniform sampler2D roughnessMap;
#endif`,shadowmap_pars_fragment=`#if NUM_SPOT_LIGHT_COORDS > 0
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#if NUM_SPOT_LIGHT_MAPS > 0
	uniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
	float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {
		return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );
	}
	vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {
		return unpackRGBATo2Half( texture2D( shadow, uv ) );
	}
	float VSMShadow (sampler2D shadow, vec2 uv, float compare ){
		float occlusion = 1.0;
		vec2 distribution = texture2DDistribution( shadow, uv );
		float hard_shadow = step( compare , distribution.x );
		if (hard_shadow != 1.0 ) {
			float distance = compare - distribution.x ;
			float variance = max( 0.00000, distribution.y * distribution.y );
			float softness_probability = variance / (variance + distance * distance );			softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );			occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );
		}
		return occlusion;
	}
	float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
		float shadow = 1.0;
		shadowCoord.xyz /= shadowCoord.w;
		shadowCoord.z += shadowBias;
		bool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;
		bool frustumTest = inFrustum && shadowCoord.z <= 1.0;
		if ( frustumTest ) {
		#if defined( SHADOWMAP_TYPE_PCF )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx0 = - texelSize.x * shadowRadius;
			float dy0 = - texelSize.y * shadowRadius;
			float dx1 = + texelSize.x * shadowRadius;
			float dy1 = + texelSize.y * shadowRadius;
			float dx2 = dx0 / 2.0;
			float dy2 = dy0 / 2.0;
			float dx3 = dx1 / 2.0;
			float dy3 = dy1 / 2.0;
			shadow = (
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )
			) * ( 1.0 / 17.0 );
		#elif defined( SHADOWMAP_TYPE_PCF_SOFT )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx = texelSize.x;
			float dy = texelSize.y;
			vec2 uv = shadowCoord.xy;
			vec2 f = fract( uv * shadowMapSize + 0.5 );
			uv -= f * texelSize;
			shadow = (
				texture2DCompare( shadowMap, uv, shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),
						  f.x ),
					 mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),
						  f.x ),
					 f.y )
			) * ( 1.0 / 9.0 );
		#elif defined( SHADOWMAP_TYPE_VSM )
			shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );
		#else
			shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );
		#endif
		}
		return shadow;
	}
	vec2 cubeToUV( vec3 v, float texelSizeY ) {
		vec3 absV = abs( v );
		float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
		absV *= scaleToCube;
		v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );
		vec2 planar = v.xy;
		float almostATexel = 1.5 * texelSizeY;
		float almostOne = 1.0 - almostATexel;
		if ( absV.z >= almostOne ) {
			if ( v.z > 0.0 )
				planar.x = 4.0 - v.x;
		} else if ( absV.x >= almostOne ) {
			float signX = sign( v.x );
			planar.x = v.z * signX + 2.0 * signX;
		} else if ( absV.y >= almostOne ) {
			float signY = sign( v.y );
			planar.x = v.x + 2.0 * signY + 2.0;
			planar.y = v.z * signY - 2.0;
		}
		return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );
	}
	float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
		vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );
		vec3 lightToPosition = shadowCoord.xyz;
		float dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );		dp += shadowBias;
		vec3 bd3D = normalize( lightToPosition );
		#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )
			vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;
			return (
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )
			) * ( 1.0 / 9.0 );
		#else
			return texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );
		#endif
	}
#endif`,shadowmap_pars_vertex=`#if NUM_SPOT_LIGHT_COORDS > 0
	uniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
#endif`,shadowmap_vertex=`#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )
	vec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
	vec4 shadowWorldPosition;
#endif
#if defined( USE_SHADOWMAP )
	#if NUM_DIR_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );
			vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );
			vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
#endif
#if NUM_SPOT_LIGHT_COORDS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {
		shadowWorldPosition = worldPosition;
		#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
			shadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;
		#endif
		vSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
#endif`,shadowmask_pars_fragment=`float getShadowMask() {
	float shadow = 1.0;
	#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		directionalLight = directionalLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		spotLight = spotLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		pointLight = pointLightShadows[ i ];
		shadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#endif
	return shadow;
}`,skinbase_vertex=`#ifdef USE_SKINNING
	mat4 boneMatX = getBoneMatrix( skinIndex.x );
	mat4 boneMatY = getBoneMatrix( skinIndex.y );
	mat4 boneMatZ = getBoneMatrix( skinIndex.z );
	mat4 boneMatW = getBoneMatrix( skinIndex.w );
#endif`,skinning_pars_vertex=`#ifdef USE_SKINNING
	uniform mat4 bindMatrix;
	uniform mat4 bindMatrixInverse;
	uniform highp sampler2D boneTexture;
	uniform int boneTextureSize;
	mat4 getBoneMatrix( const in float i ) {
		float j = i * 4.0;
		float x = mod( j, float( boneTextureSize ) );
		float y = floor( j / float( boneTextureSize ) );
		float dx = 1.0 / float( boneTextureSize );
		float dy = 1.0 / float( boneTextureSize );
		y = dy * ( y + 0.5 );
		vec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );
		vec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );
		vec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );
		vec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );
		mat4 bone = mat4( v1, v2, v3, v4 );
		return bone;
	}
#endif`,skinning_vertex=`#ifdef USE_SKINNING
	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );
	vec4 skinned = vec4( 0.0 );
	skinned += boneMatX * skinVertex * skinWeight.x;
	skinned += boneMatY * skinVertex * skinWeight.y;
	skinned += boneMatZ * skinVertex * skinWeight.z;
	skinned += boneMatW * skinVertex * skinWeight.w;
	transformed = ( bindMatrixInverse * skinned ).xyz;
#endif`,skinnormal_vertex=`#ifdef USE_SKINNING
	mat4 skinMatrix = mat4( 0.0 );
	skinMatrix += skinWeight.x * boneMatX;
	skinMatrix += skinWeight.y * boneMatY;
	skinMatrix += skinWeight.z * boneMatZ;
	skinMatrix += skinWeight.w * boneMatW;
	skinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;
	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;
	#ifdef USE_TANGENT
		objectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#endif
#endif`,specularmap_fragment=`float specularStrength;
#ifdef USE_SPECULARMAP
	vec4 texelSpecular = texture2D( specularMap, vSpecularMapUv );
	specularStrength = texelSpecular.r;
#else
	specularStrength = 1.0;
#endif`,specularmap_pars_fragment=`#ifdef USE_SPECULARMAP
	uniform sampler2D specularMap;
#endif`,tonemapping_fragment=`#if defined( TONE_MAPPING )
	gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );
#endif`,tonemapping_pars_fragment=`#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
uniform float toneMappingExposure;
vec3 LinearToneMapping( vec3 color ) {
	return saturate( toneMappingExposure * color );
}
vec3 ReinhardToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( color / ( vec3( 1.0 ) + color ) );
}
vec3 OptimizedCineonToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	color = max( vec3( 0.0 ), color - 0.004 );
	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );
}
vec3 RRTAndODTFit( vec3 v ) {
	vec3 a = v * ( v + 0.0245786 ) - 0.000090537;
	vec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;
	return a / b;
}
vec3 ACESFilmicToneMapping( vec3 color ) {
	const mat3 ACESInputMat = mat3(
		vec3( 0.59719, 0.07600, 0.02840 ),		vec3( 0.35458, 0.90834, 0.13383 ),
		vec3( 0.04823, 0.01566, 0.83777 )
	);
	const mat3 ACESOutputMat = mat3(
		vec3(  1.60475, -0.10208, -0.00327 ),		vec3( -0.53108,  1.10813, -0.07276 ),
		vec3( -0.07367, -0.00605,  1.07602 )
	);
	color *= toneMappingExposure / 0.6;
	color = ACESInputMat * color;
	color = RRTAndODTFit( color );
	color = ACESOutputMat * color;
	return saturate( color );
}
vec3 CustomToneMapping( vec3 color ) { return color; }`,transmission_fragment=`#ifdef USE_TRANSMISSION
	material.transmission = transmission;
	material.transmissionAlpha = 1.0;
	material.thickness = thickness;
	material.attenuationDistance = attenuationDistance;
	material.attenuationColor = attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		material.transmission *= texture2D( transmissionMap, vTransmissionMapUv ).r;
	#endif
	#ifdef USE_THICKNESSMAP
		material.thickness *= texture2D( thicknessMap, vThicknessMapUv ).g;
	#endif
	vec3 pos = vWorldPosition;
	vec3 v = normalize( cameraPosition - pos );
	vec3 n = inverseTransformDirection( normal, viewMatrix );
	vec4 transmitted = getIBLVolumeRefraction(
		n, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,
		pos, modelMatrix, viewMatrix, projectionMatrix, material.ior, material.thickness,
		material.attenuationColor, material.attenuationDistance );
	material.transmissionAlpha = mix( material.transmissionAlpha, transmitted.a, material.transmission );
	totalDiffuse = mix( totalDiffuse, transmitted.rgb, material.transmission );
#endif`,transmission_pars_fragment=`#ifdef USE_TRANSMISSION
	uniform float transmission;
	uniform float thickness;
	uniform float attenuationDistance;
	uniform vec3 attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		uniform sampler2D transmissionMap;
	#endif
	#ifdef USE_THICKNESSMAP
		uniform sampler2D thicknessMap;
	#endif
	uniform vec2 transmissionSamplerSize;
	uniform sampler2D transmissionSamplerMap;
	uniform mat4 modelMatrix;
	uniform mat4 projectionMatrix;
	varying vec3 vWorldPosition;
	float w0( float a ) {
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );
	}
	float w1( float a ) {
		return ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );
	}
	float w2( float a ){
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );
	}
	float w3( float a ) {
		return ( 1.0 / 6.0 ) * ( a * a * a );
	}
	float g0( float a ) {
		return w0( a ) + w1( a );
	}
	float g1( float a ) {
		return w2( a ) + w3( a );
	}
	float h0( float a ) {
		return - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );
	}
	float h1( float a ) {
		return 1.0 + w3( a ) / ( w2( a ) + w3( a ) );
	}
	vec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, float lod ) {
		uv = uv * texelSize.zw + 0.5;
		vec2 iuv = floor( uv );
		vec2 fuv = fract( uv );
		float g0x = g0( fuv.x );
		float g1x = g1( fuv.x );
		float h0x = h0( fuv.x );
		float h1x = h1( fuv.x );
		float h0y = h0( fuv.y );
		float h1y = h1( fuv.y );
		vec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		vec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		return g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) +
			g1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );
	}
	vec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {
		vec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );
		vec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );
		vec2 fLodSizeInv = 1.0 / fLodSize;
		vec2 cLodSizeInv = 1.0 / cLodSize;
		vec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), floor( lod ) );
		vec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), ceil( lod ) );
		return mix( fSample, cSample, fract( lod ) );
	}
	vec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {
		vec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );
		vec3 modelScale;
		modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );
		modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );
		modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );
		return normalize( refractionVector ) * thickness * modelScale;
	}
	float applyIorToRoughness( const in float roughness, const in float ior ) {
		return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );
	}
	vec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {
		float lod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );
		return textureBicubic( transmissionSamplerMap, fragCoord.xy, lod );
	}
	vec3 volumeAttenuation( const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {
		if ( isinf( attenuationDistance ) ) {
			return vec3( 1.0 );
		} else {
			vec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;
			vec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );			return transmittance;
		}
	}
	vec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,
		const in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,
		const in mat4 viewMatrix, const in mat4 projMatrix, const in float ior, const in float thickness,
		const in vec3 attenuationColor, const in float attenuationDistance ) {
		vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );
		vec3 refractedRayExit = position + transmissionRay;
		vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
		vec2 refractionCoords = ndcPos.xy / ndcPos.w;
		refractionCoords += 1.0;
		refractionCoords /= 2.0;
		vec4 transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );
		vec3 transmittance = diffuseColor * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance );
		vec3 attenuatedColor = transmittance * transmittedLight.rgb;
		vec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );
		float transmittanceFactor = ( transmittance.r + transmittance.g + transmittance.b ) / 3.0;
		return vec4( ( 1.0 - F ) * attenuatedColor, 1.0 - ( 1.0 - transmittedLight.a ) * transmittanceFactor );
	}
#endif`,uv_pars_fragment=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_SPECULARMAP
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,uv_pars_vertex=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	uniform mat3 mapTransform;
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	uniform mat3 alphaMapTransform;
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	uniform mat3 lightMapTransform;
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	uniform mat3 aoMapTransform;
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	uniform mat3 bumpMapTransform;
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	uniform mat3 normalMapTransform;
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_DISPLACEMENTMAP
	uniform mat3 displacementMapTransform;
	varying vec2 vDisplacementMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	uniform mat3 emissiveMapTransform;
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	uniform mat3 metalnessMapTransform;
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	uniform mat3 roughnessMapTransform;
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	uniform mat3 anisotropyMapTransform;
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	uniform mat3 clearcoatMapTransform;
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform mat3 clearcoatNormalMapTransform;
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform mat3 clearcoatRoughnessMapTransform;
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	uniform mat3 sheenColorMapTransform;
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	uniform mat3 sheenRoughnessMapTransform;
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	uniform mat3 iridescenceMapTransform;
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform mat3 iridescenceThicknessMapTransform;
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SPECULARMAP
	uniform mat3 specularMapTransform;
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	uniform mat3 specularColorMapTransform;
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	uniform mat3 specularIntensityMapTransform;
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,uv_vertex=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	vUv = vec3( uv, 1 ).xy;
#endif
#ifdef USE_MAP
	vMapUv = ( mapTransform * vec3( MAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ALPHAMAP
	vAlphaMapUv = ( alphaMapTransform * vec3( ALPHAMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_LIGHTMAP
	vLightMapUv = ( lightMapTransform * vec3( LIGHTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_AOMAP
	vAoMapUv = ( aoMapTransform * vec3( AOMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_BUMPMAP
	vBumpMapUv = ( bumpMapTransform * vec3( BUMPMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_NORMALMAP
	vNormalMapUv = ( normalMapTransform * vec3( NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_DISPLACEMENTMAP
	vDisplacementMapUv = ( displacementMapTransform * vec3( DISPLACEMENTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_EMISSIVEMAP
	vEmissiveMapUv = ( emissiveMapTransform * vec3( EMISSIVEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_METALNESSMAP
	vMetalnessMapUv = ( metalnessMapTransform * vec3( METALNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ROUGHNESSMAP
	vRoughnessMapUv = ( roughnessMapTransform * vec3( ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ANISOTROPYMAP
	vAnisotropyMapUv = ( anisotropyMapTransform * vec3( ANISOTROPYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOATMAP
	vClearcoatMapUv = ( clearcoatMapTransform * vec3( CLEARCOATMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	vClearcoatNormalMapUv = ( clearcoatNormalMapTransform * vec3( CLEARCOAT_NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	vClearcoatRoughnessMapUv = ( clearcoatRoughnessMapTransform * vec3( CLEARCOAT_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCEMAP
	vIridescenceMapUv = ( iridescenceMapTransform * vec3( IRIDESCENCEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	vIridescenceThicknessMapUv = ( iridescenceThicknessMapTransform * vec3( IRIDESCENCE_THICKNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_COLORMAP
	vSheenColorMapUv = ( sheenColorMapTransform * vec3( SHEEN_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	vSheenRoughnessMapUv = ( sheenRoughnessMapTransform * vec3( SHEEN_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULARMAP
	vSpecularMapUv = ( specularMapTransform * vec3( SPECULARMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_COLORMAP
	vSpecularColorMapUv = ( specularColorMapTransform * vec3( SPECULAR_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	vSpecularIntensityMapUv = ( specularIntensityMapTransform * vec3( SPECULAR_INTENSITYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_TRANSMISSIONMAP
	vTransmissionMapUv = ( transmissionMapTransform * vec3( TRANSMISSIONMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_THICKNESSMAP
	vThicknessMapUv = ( thicknessMapTransform * vec3( THICKNESSMAP_UV, 1 ) ).xy;
#endif`,worldpos_vertex=`#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0
	vec4 worldPosition = vec4( transformed, 1.0 );
	#ifdef USE_INSTANCING
		worldPosition = instanceMatrix * worldPosition;
	#endif
	worldPosition = modelMatrix * worldPosition;
#endif`;const vertex$h=`varying vec2 vUv;
uniform mat3 uvTransform;
void main() {
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	gl_Position = vec4( position.xy, 1.0, 1.0 );
}`,fragment$h=`uniform sampler2D t2D;
uniform float backgroundIntensity;
varying vec2 vUv;
void main() {
	vec4 texColor = texture2D( t2D, vUv );
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,vertex$g=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,fragment$g=`#ifdef ENVMAP_TYPE_CUBE
	uniform samplerCube envMap;
#elif defined( ENVMAP_TYPE_CUBE_UV )
	uniform sampler2D envMap;
#endif
uniform float flipEnvMap;
uniform float backgroundBlurriness;
uniform float backgroundIntensity;
varying vec3 vWorldDirection;
#include <cube_uv_reflection_fragment>
void main() {
	#ifdef ENVMAP_TYPE_CUBE
		vec4 texColor = textureCube( envMap, vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );
	#elif defined( ENVMAP_TYPE_CUBE_UV )
		vec4 texColor = textureCubeUV( envMap, vWorldDirection, backgroundBlurriness );
	#else
		vec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,vertex$f=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,fragment$f=`uniform samplerCube tCube;
uniform float tFlip;
uniform float opacity;
varying vec3 vWorldDirection;
void main() {
	vec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );
	gl_FragColor = texColor;
	gl_FragColor.a *= opacity;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,vertex$e=`#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec2 vHighPrecisionZW;
void main() {
	#include <uv_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vHighPrecisionZW = gl_Position.zw;
}`,fragment$e=`#if DEPTH_PACKING == 3200
	uniform float opacity;
#endif
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
varying vec2 vHighPrecisionZW;
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#if DEPTH_PACKING == 3200
		diffuseColor.a = opacity;
	#endif
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <logdepthbuf_fragment>
	float fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;
	#if DEPTH_PACKING == 3200
		gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );
	#elif DEPTH_PACKING == 3201
		gl_FragColor = packDepthToRGBA( fragCoordZ );
	#endif
}`,vertex$d=`#define DISTANCE
varying vec3 vWorldPosition;
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	vWorldPosition = worldPosition.xyz;
}`,fragment$d=`#define DISTANCE
uniform vec3 referencePosition;
uniform float nearDistance;
uniform float farDistance;
varying vec3 vWorldPosition;
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <clipping_planes_pars_fragment>
void main () {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	float dist = length( vWorldPosition - referencePosition );
	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );
	dist = saturate( dist );
	gl_FragColor = packDepthToRGBA( dist );
}`,vertex$c=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
}`,fragment$c=`uniform sampler2D tEquirect;
varying vec3 vWorldDirection;
#include <common>
void main() {
	vec3 direction = normalize( vWorldDirection );
	vec2 sampleUV = equirectUv( direction );
	gl_FragColor = texture2D( tEquirect, sampleUV );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,vertex$b=`uniform float scale;
attribute float lineDistance;
varying float vLineDistance;
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	vLineDistance = scale * lineDistance;
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,fragment$b=`uniform vec3 diffuse;
uniform float opacity;
uniform float dashSize;
uniform float totalSize;
varying float vLineDistance;
#include <common>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	if ( mod( vLineDistance, totalSize ) > dashSize ) {
		discard;
	}
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,vertex$a=`#include <common>
#include <uv_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinbase_vertex>
		#include <skinnormal_vertex>
		#include <defaultnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <fog_vertex>
}`,fragment$a=`uniform vec3 diffuse;
uniform float opacity;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		reflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;
	#else
		reflectedLight.indirectDiffuse += vec3( 1.0 );
	#endif
	#include <aomap_fragment>
	reflectedLight.indirectDiffuse *= diffuseColor.rgb;
	vec3 outgoingLight = reflectedLight.indirectDiffuse;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,vertex$9=`#define LAMBERT
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,fragment$9=`#define LAMBERT
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_lambert_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_lambert_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,vertex$8=`#define MATCAP
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <displacementmap_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
	vViewPosition = - mvPosition.xyz;
}`,fragment$8=`#define MATCAP
uniform vec3 diffuse;
uniform float opacity;
uniform sampler2D matcap;
varying vec3 vViewPosition;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	vec3 viewDir = normalize( vViewPosition );
	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
	vec3 y = cross( viewDir, x );
	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;
	#ifdef USE_MATCAP
		vec4 matcapColor = texture2D( matcap, uv );
	#else
		vec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );
	#endif
	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,vertex$7=`#define NORMAL
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	vViewPosition = - mvPosition.xyz;
#endif
}`,fragment$7=`#define NORMAL
uniform float opacity;
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <packing>
#include <uv_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	gl_FragColor = vec4( packNormalToRGB( normal ), opacity );
	#ifdef OPAQUE
		gl_FragColor.a = 1.0;
	#endif
}`,vertex$6=`#define PHONG
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,fragment$6=`#define PHONG
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_phong_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_phong_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,vertex$5=`#define STANDARD
varying vec3 vViewPosition;
#ifdef USE_TRANSMISSION
	varying vec3 vWorldPosition;
#endif
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
#ifdef USE_TRANSMISSION
	vWorldPosition = worldPosition.xyz;
#endif
}`,fragment$5=`#define STANDARD
#ifdef PHYSICAL
	#define IOR
	#define USE_SPECULAR
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
#ifdef IOR
	uniform float ior;
#endif
#ifdef USE_SPECULAR
	uniform float specularIntensity;
	uniform vec3 specularColor;
	#ifdef USE_SPECULAR_COLORMAP
		uniform sampler2D specularColorMap;
	#endif
	#ifdef USE_SPECULAR_INTENSITYMAP
		uniform sampler2D specularIntensityMap;
	#endif
#endif
#ifdef USE_CLEARCOAT
	uniform float clearcoat;
	uniform float clearcoatRoughness;
#endif
#ifdef USE_IRIDESCENCE
	uniform float iridescence;
	uniform float iridescenceIOR;
	uniform float iridescenceThicknessMinimum;
	uniform float iridescenceThicknessMaximum;
#endif
#ifdef USE_SHEEN
	uniform vec3 sheenColor;
	uniform float sheenRoughness;
	#ifdef USE_SHEEN_COLORMAP
		uniform sampler2D sheenColorMap;
	#endif
	#ifdef USE_SHEEN_ROUGHNESSMAP
		uniform sampler2D sheenRoughnessMap;
	#endif
#endif
#ifdef USE_ANISOTROPY
	uniform vec2 anisotropyVector;
	#ifdef USE_ANISOTROPYMAP
		uniform sampler2D anisotropyMap;
	#endif
#endif
varying vec3 vViewPosition;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <iridescence_fragment>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_physical_pars_fragment>
#include <transmission_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <iridescence_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <roughnessmap_fragment>
	#include <metalnessmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <clearcoat_normal_fragment_begin>
	#include <clearcoat_normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_physical_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;
	vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;
	#include <transmission_fragment>
	vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;
	#ifdef USE_SHEEN
		float sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );
		outgoingLight = outgoingLight * sheenEnergyComp + sheenSpecular;
	#endif
	#ifdef USE_CLEARCOAT
		float dotNVcc = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );
		vec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );
		outgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + clearcoatSpecular * material.clearcoat;
	#endif
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,vertex$4=`#define TOON
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,fragment$4=`#define TOON
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <gradientmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_toon_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_toon_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,vertex$3=`uniform float size;
uniform float scale;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
#ifdef USE_POINTS_UV
	varying vec2 vUv;
	uniform mat3 uvTransform;
#endif
void main() {
	#ifdef USE_POINTS_UV
		vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	#endif
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	gl_PointSize = size;
	#ifdef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );
	#endif
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <fog_vertex>
}`,fragment$3=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <color_pars_fragment>
#include <map_particle_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_particle_fragment>
	#include <color_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,vertex$2=`#include <common>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <shadowmap_pars_vertex>
void main() {
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,fragment$2=`uniform vec3 color;
uniform float opacity;
#include <common>
#include <packing>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <logdepthbuf_pars_fragment>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
void main() {
	#include <logdepthbuf_fragment>
	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`,vertex$1=`uniform float rotation;
uniform vec2 center;
#include <common>
#include <uv_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
	vec2 scale;
	scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
	scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );
	#ifndef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) scale *= - mvPosition.z;
	#endif
	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;
	vec2 rotatedPosition;
	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
	mvPosition.xy += rotatedPosition;
	gl_Position = projectionMatrix * mvPosition;
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,fragment$1=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`,ShaderChunk={alphahash_fragment,alphahash_pars_fragment,alphamap_fragment,alphamap_pars_fragment,alphatest_fragment,alphatest_pars_fragment,aomap_fragment,aomap_pars_fragment,begin_vertex,beginnormal_vertex,bsdfs,iridescence_fragment,bumpmap_pars_fragment,clipping_planes_fragment,clipping_planes_pars_fragment,clipping_planes_pars_vertex,clipping_planes_vertex,color_fragment,color_pars_fragment,color_pars_vertex,color_vertex,common,cube_uv_reflection_fragment,defaultnormal_vertex,displacementmap_pars_vertex,displacementmap_vertex,emissivemap_fragment,emissivemap_pars_fragment,colorspace_fragment,colorspace_pars_fragment,envmap_fragment,envmap_common_pars_fragment,envmap_pars_fragment,envmap_pars_vertex,envmap_physical_pars_fragment,envmap_vertex,fog_vertex,fog_pars_vertex,fog_fragment,fog_pars_fragment,gradientmap_pars_fragment,lightmap_fragment,lightmap_pars_fragment,lights_lambert_fragment,lights_lambert_pars_fragment,lights_pars_begin,lights_toon_fragment,lights_toon_pars_fragment,lights_phong_fragment,lights_phong_pars_fragment,lights_physical_fragment,lights_physical_pars_fragment,lights_fragment_begin,lights_fragment_maps,lights_fragment_end,logdepthbuf_fragment,logdepthbuf_pars_fragment,logdepthbuf_pars_vertex,logdepthbuf_vertex,map_fragment,map_pars_fragment,map_particle_fragment,map_particle_pars_fragment,metalnessmap_fragment,metalnessmap_pars_fragment,morphcolor_vertex,morphnormal_vertex,morphtarget_pars_vertex,morphtarget_vertex,normal_fragment_begin,normal_fragment_maps,normal_pars_fragment,normal_pars_vertex,normal_vertex,normalmap_pars_fragment,clearcoat_normal_fragment_begin,clearcoat_normal_fragment_maps,clearcoat_pars_fragment,iridescence_pars_fragment,opaque_fragment,packing,premultiplied_alpha_fragment,project_vertex,dithering_fragment,dithering_pars_fragment,roughnessmap_fragment,roughnessmap_pars_fragment,shadowmap_pars_fragment,shadowmap_pars_vertex,shadowmap_vertex,shadowmask_pars_fragment,skinbase_vertex,skinning_pars_vertex,skinning_vertex,skinnormal_vertex,specularmap_fragment,specularmap_pars_fragment,tonemapping_fragment,tonemapping_pars_fragment,transmission_fragment,transmission_pars_fragment,uv_pars_fragment,uv_pars_vertex,uv_vertex,worldpos_vertex,background_vert:vertex$h,background_frag:fragment$h,backgroundCube_vert:vertex$g,backgroundCube_frag:fragment$g,cube_vert:vertex$f,cube_frag:fragment$f,depth_vert:vertex$e,depth_frag:fragment$e,distanceRGBA_vert:vertex$d,distanceRGBA_frag:fragment$d,equirect_vert:vertex$c,equirect_frag:fragment$c,linedashed_vert:vertex$b,linedashed_frag:fragment$b,meshbasic_vert:vertex$a,meshbasic_frag:fragment$a,meshlambert_vert:vertex$9,meshlambert_frag:fragment$9,meshmatcap_vert:vertex$8,meshmatcap_frag:fragment$8,meshnormal_vert:vertex$7,meshnormal_frag:fragment$7,meshphong_vert:vertex$6,meshphong_frag:fragment$6,meshphysical_vert:vertex$5,meshphysical_frag:fragment$5,meshtoon_vert:vertex$4,meshtoon_frag:fragment$4,points_vert:vertex$3,points_frag:fragment$3,shadow_vert:vertex$2,shadow_frag:fragment$2,sprite_vert:vertex$1,sprite_frag:fragment$1},UniformsLib={common:{diffuse:{value:new Color$1(16777215)},opacity:{value:1},map:{value:null},mapTransform:{value:new Matrix3},alphaMap:{value:null},alphaMapTransform:{value:new Matrix3},alphaTest:{value:0}},specularmap:{specularMap:{value:null},specularMapTransform:{value:new Matrix3}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1},aoMapTransform:{value:new Matrix3}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1},lightMapTransform:{value:new Matrix3}},bumpmap:{bumpMap:{value:null},bumpMapTransform:{value:new Matrix3},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalMapTransform:{value:new Matrix3},normalScale:{value:new Vector2(1,1)}},displacementmap:{displacementMap:{value:null},displacementMapTransform:{value:new Matrix3},displacementScale:{value:1},displacementBias:{value:0}},emissivemap:{emissiveMap:{value:null},emissiveMapTransform:{value:new Matrix3}},metalnessmap:{metalnessMap:{value:null},metalnessMapTransform:{value:new Matrix3}},roughnessmap:{roughnessMap:{value:null},roughnessMapTransform:{value:new Matrix3}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new Color$1(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new Color$1(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaMapTransform:{value:new Matrix3},alphaTest:{value:0},uvTransform:{value:new Matrix3}},sprite:{diffuse:{value:new Color$1(16777215)},opacity:{value:1},center:{value:new Vector2(.5,.5)},rotation:{value:0},map:{value:null},mapTransform:{value:new Matrix3},alphaMap:{value:null},alphaMapTransform:{value:new Matrix3},alphaTest:{value:0}}},ShaderLib={basic:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.specularmap,UniformsLib.envmap,UniformsLib.aomap,UniformsLib.lightmap,UniformsLib.fog]),vertexShader:ShaderChunk.meshbasic_vert,fragmentShader:ShaderChunk.meshbasic_frag},lambert:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.specularmap,UniformsLib.envmap,UniformsLib.aomap,UniformsLib.lightmap,UniformsLib.emissivemap,UniformsLib.bumpmap,UniformsLib.normalmap,UniformsLib.displacementmap,UniformsLib.fog,UniformsLib.lights,{emissive:{value:new Color$1(0)}}]),vertexShader:ShaderChunk.meshlambert_vert,fragmentShader:ShaderChunk.meshlambert_frag},phong:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.specularmap,UniformsLib.envmap,UniformsLib.aomap,UniformsLib.lightmap,UniformsLib.emissivemap,UniformsLib.bumpmap,UniformsLib.normalmap,UniformsLib.displacementmap,UniformsLib.fog,UniformsLib.lights,{emissive:{value:new Color$1(0)},specular:{value:new Color$1(1118481)},shininess:{value:30}}]),vertexShader:ShaderChunk.meshphong_vert,fragmentShader:ShaderChunk.meshphong_frag},standard:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.envmap,UniformsLib.aomap,UniformsLib.lightmap,UniformsLib.emissivemap,UniformsLib.bumpmap,UniformsLib.normalmap,UniformsLib.displacementmap,UniformsLib.roughnessmap,UniformsLib.metalnessmap,UniformsLib.fog,UniformsLib.lights,{emissive:{value:new Color$1(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:ShaderChunk.meshphysical_vert,fragmentShader:ShaderChunk.meshphysical_frag},toon:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.aomap,UniformsLib.lightmap,UniformsLib.emissivemap,UniformsLib.bumpmap,UniformsLib.normalmap,UniformsLib.displacementmap,UniformsLib.gradientmap,UniformsLib.fog,UniformsLib.lights,{emissive:{value:new Color$1(0)}}]),vertexShader:ShaderChunk.meshtoon_vert,fragmentShader:ShaderChunk.meshtoon_frag},matcap:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.bumpmap,UniformsLib.normalmap,UniformsLib.displacementmap,UniformsLib.fog,{matcap:{value:null}}]),vertexShader:ShaderChunk.meshmatcap_vert,fragmentShader:ShaderChunk.meshmatcap_frag},points:{uniforms:mergeUniforms([UniformsLib.points,UniformsLib.fog]),vertexShader:ShaderChunk.points_vert,fragmentShader:ShaderChunk.points_frag},dashed:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:ShaderChunk.linedashed_vert,fragmentShader:ShaderChunk.linedashed_frag},depth:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.displacementmap]),vertexShader:ShaderChunk.depth_vert,fragmentShader:ShaderChunk.depth_frag},normal:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.bumpmap,UniformsLib.normalmap,UniformsLib.displacementmap,{opacity:{value:1}}]),vertexShader:ShaderChunk.meshnormal_vert,fragmentShader:ShaderChunk.meshnormal_frag},sprite:{uniforms:mergeUniforms([UniformsLib.sprite,UniformsLib.fog]),vertexShader:ShaderChunk.sprite_vert,fragmentShader:ShaderChunk.sprite_frag},background:{uniforms:{uvTransform:{value:new Matrix3},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:ShaderChunk.background_vert,fragmentShader:ShaderChunk.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1}},vertexShader:ShaderChunk.backgroundCube_vert,fragmentShader:ShaderChunk.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:ShaderChunk.cube_vert,fragmentShader:ShaderChunk.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:ShaderChunk.equirect_vert,fragmentShader:ShaderChunk.equirect_frag},distanceRGBA:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.displacementmap,{referencePosition:{value:new Vector3},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:ShaderChunk.distanceRGBA_vert,fragmentShader:ShaderChunk.distanceRGBA_frag},shadow:{uniforms:mergeUniforms([UniformsLib.lights,UniformsLib.fog,{color:{value:new Color$1(0)},opacity:{value:1}}]),vertexShader:ShaderChunk.shadow_vert,fragmentShader:ShaderChunk.shadow_frag}};ShaderLib.physical={uniforms:mergeUniforms([ShaderLib.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatMapTransform:{value:new Matrix3},clearcoatNormalMap:{value:null},clearcoatNormalMapTransform:{value:new Matrix3},clearcoatNormalScale:{value:new Vector2(1,1)},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatRoughnessMapTransform:{value:new Matrix3},iridescence:{value:0},iridescenceMap:{value:null},iridescenceMapTransform:{value:new Matrix3},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},iridescenceThicknessMapTransform:{value:new Matrix3},sheen:{value:0},sheenColor:{value:new Color$1(0)},sheenColorMap:{value:null},sheenColorMapTransform:{value:new Matrix3},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},sheenRoughnessMapTransform:{value:new Matrix3},transmission:{value:0},transmissionMap:{value:null},transmissionMapTransform:{value:new Matrix3},transmissionSamplerSize:{value:new Vector2},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},thicknessMapTransform:{value:new Matrix3},attenuationDistance:{value:0},attenuationColor:{value:new Color$1(0)},specularColor:{value:new Color$1(1,1,1)},specularColorMap:{value:null},specularColorMapTransform:{value:new Matrix3},specularIntensity:{value:1},specularIntensityMap:{value:null},specularIntensityMapTransform:{value:new Matrix3},anisotropyVector:{value:new Vector2},anisotropyMap:{value:null},anisotropyMapTransform:{value:new Matrix3}}]),vertexShader:ShaderChunk.meshphysical_vert,fragmentShader:ShaderChunk.meshphysical_frag};const _rgb={r:0,b:0,g:0};function WebGLBackground(X,Z,_,K,te,ne,oe){const ie=new Color$1(0);let se=ne===!0?0:1,ae,ge,ce=null,de=0,pe=null;function fe(me,ye){let ve=!1,Be=ye.isScene===!0?ye.background:null;switch(Be&&Be.isTexture&&(Be=(ye.backgroundBlurriness>0?_:Z).get(Be)),Be===null?be(ie,se):Be&&Be.isColor&&(be(Be,1),ve=!0),X.xr.getEnvironmentBlendMode()){case"opaque":ve=!0;break;case"additive":K.buffers.color.setClear(0,0,0,1,oe),ve=!0;break;case"alpha-blend":K.buffers.color.setClear(0,0,0,0,oe),ve=!0;break}(X.autoClear||ve)&&X.clear(X.autoClearColor,X.autoClearDepth,X.autoClearStencil),Be&&(Be.isCubeTexture||Be.mapping===CubeUVReflectionMapping)?(ge===void 0&&(ge=new Mesh(new BoxGeometry(1,1,1),new ShaderMaterial({name:"BackgroundCubeMaterial",uniforms:cloneUniforms(ShaderLib.backgroundCube.uniforms),vertexShader:ShaderLib.backgroundCube.vertexShader,fragmentShader:ShaderLib.backgroundCube.fragmentShader,side:BackSide,depthTest:!1,depthWrite:!1,fog:!1})),ge.geometry.deleteAttribute("normal"),ge.geometry.deleteAttribute("uv"),ge.onBeforeRender=function(We,Ze,Ve){this.matrixWorld.copyPosition(Ve.matrixWorld)},Object.defineProperty(ge.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),te.update(ge)),ge.material.uniforms.envMap.value=Be,ge.material.uniforms.flipEnvMap.value=Be.isCubeTexture&&Be.isRenderTargetTexture===!1?-1:1,ge.material.uniforms.backgroundBlurriness.value=ye.backgroundBlurriness,ge.material.uniforms.backgroundIntensity.value=ye.backgroundIntensity,ge.material.toneMapped=Be.colorSpace!==SRGBColorSpace$1,(ce!==Be||de!==Be.version||pe!==X.toneMapping)&&(ge.material.needsUpdate=!0,ce=Be,de=Be.version,pe=X.toneMapping),ge.layers.enableAll(),me.unshift(ge,ge.geometry,ge.material,0,0,null)):Be&&Be.isTexture&&(ae===void 0&&(ae=new Mesh(new PlaneGeometry(2,2),new ShaderMaterial({name:"BackgroundMaterial",uniforms:cloneUniforms(ShaderLib.background.uniforms),vertexShader:ShaderLib.background.vertexShader,fragmentShader:ShaderLib.background.fragmentShader,side:FrontSide,depthTest:!1,depthWrite:!1,fog:!1})),ae.geometry.deleteAttribute("normal"),Object.defineProperty(ae.material,"map",{get:function(){return this.uniforms.t2D.value}}),te.update(ae)),ae.material.uniforms.t2D.value=Be,ae.material.uniforms.backgroundIntensity.value=ye.backgroundIntensity,ae.material.toneMapped=Be.colorSpace!==SRGBColorSpace$1,Be.matrixAutoUpdate===!0&&Be.updateMatrix(),ae.material.uniforms.uvTransform.value.copy(Be.matrix),(ce!==Be||de!==Be.version||pe!==X.toneMapping)&&(ae.material.needsUpdate=!0,ce=Be,de=Be.version,pe=X.toneMapping),ae.layers.enableAll(),me.unshift(ae,ae.geometry,ae.material,0,0,null))}function be(me,ye){me.getRGB(_rgb,getUnlitUniformColorSpace(X)),K.buffers.color.setClear(_rgb.r,_rgb.g,_rgb.b,ye,oe)}return{getClearColor:function(){return ie},setClearColor:function(me,ye=1){ie.set(me),se=ye,be(ie,se)},getClearAlpha:function(){return se},setClearAlpha:function(me){se=me,be(ie,se)},render:fe}}function WebGLBindingStates(X,Z,_,K){const te=X.getParameter(X.MAX_VERTEX_ATTRIBS),ne=K.isWebGL2?null:Z.get("OES_vertex_array_object"),oe=K.isWebGL2||ne!==null,ie={},se=me(null);let ae=se,ge=!1;function ce(Ue,tt,rt,at,Oe){let $e=!1;if(oe){const je=be(at,rt,tt);ae!==je&&(ae=je,pe(ae.object)),$e=ye(Ue,at,rt,Oe),$e&&ve(Ue,at,rt,Oe)}else{const je=tt.wireframe===!0;(ae.geometry!==at.id||ae.program!==rt.id||ae.wireframe!==je)&&(ae.geometry=at.id,ae.program=rt.id,ae.wireframe=je,$e=!0)}Oe!==null&&_.update(Oe,X.ELEMENT_ARRAY_BUFFER),($e||ge)&&(ge=!1,Ve(Ue,tt,rt,at),Oe!==null&&X.bindBuffer(X.ELEMENT_ARRAY_BUFFER,_.get(Oe).buffer))}function de(){return K.isWebGL2?X.createVertexArray():ne.createVertexArrayOES()}function pe(Ue){return K.isWebGL2?X.bindVertexArray(Ue):ne.bindVertexArrayOES(Ue)}function fe(Ue){return K.isWebGL2?X.deleteVertexArray(Ue):ne.deleteVertexArrayOES(Ue)}function be(Ue,tt,rt){const at=rt.wireframe===!0;let Oe=ie[Ue.id];Oe===void 0&&(Oe={},ie[Ue.id]=Oe);let $e=Oe[tt.id];$e===void 0&&($e={},Oe[tt.id]=$e);let je=$e[at];return je===void 0&&(je=me(de()),$e[at]=je),je}function me(Ue){const tt=[],rt=[],at=[];for(let Oe=0;Oe<te;Oe++)tt[Oe]=0,rt[Oe]=0,at[Oe]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:tt,enabledAttributes:rt,attributeDivisors:at,object:Ue,attributes:{},index:null}}function ye(Ue,tt,rt,at){const Oe=ae.attributes,$e=tt.attributes;let je=0;const Te=rt.getAttributes();for(const De in Te)if(Te[De].location>=0){const ct=Oe[De];let gt=$e[De];if(gt===void 0&&(De==="instanceMatrix"&&Ue.instanceMatrix&&(gt=Ue.instanceMatrix),De==="instanceColor"&&Ue.instanceColor&&(gt=Ue.instanceColor)),ct===void 0||ct.attribute!==gt||gt&&ct.data!==gt.data)return!0;je++}return ae.attributesNum!==je||ae.index!==at}function ve(Ue,tt,rt,at){const Oe={},$e=tt.attributes;let je=0;const Te=rt.getAttributes();for(const De in Te)if(Te[De].location>=0){let ct=$e[De];ct===void 0&&(De==="instanceMatrix"&&Ue.instanceMatrix&&(ct=Ue.instanceMatrix),De==="instanceColor"&&Ue.instanceColor&&(ct=Ue.instanceColor));const gt={};gt.attribute=ct,ct&&ct.data&&(gt.data=ct.data),Oe[De]=gt,je++}ae.attributes=Oe,ae.attributesNum=je,ae.index=at}function Be(){const Ue=ae.newAttributes;for(let tt=0,rt=Ue.length;tt<rt;tt++)Ue[tt]=0}function Re(Ue){Ee(Ue,0)}function Ee(Ue,tt){const rt=ae.newAttributes,at=ae.enabledAttributes,Oe=ae.attributeDivisors;rt[Ue]=1,at[Ue]===0&&(X.enableVertexAttribArray(Ue),at[Ue]=1),Oe[Ue]!==tt&&((K.isWebGL2?X:Z.get("ANGLE_instanced_arrays"))[K.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](Ue,tt),Oe[Ue]=tt)}function We(){const Ue=ae.newAttributes,tt=ae.enabledAttributes;for(let rt=0,at=tt.length;rt<at;rt++)tt[rt]!==Ue[rt]&&(X.disableVertexAttribArray(rt),tt[rt]=0)}function Ze(Ue,tt,rt,at,Oe,$e,je){je===!0?X.vertexAttribIPointer(Ue,tt,rt,Oe,$e):X.vertexAttribPointer(Ue,tt,rt,at,Oe,$e)}function Ve(Ue,tt,rt,at){if(K.isWebGL2===!1&&(Ue.isInstancedMesh||at.isInstancedBufferGeometry)&&Z.get("ANGLE_instanced_arrays")===null)return;Be();const Oe=at.attributes,$e=rt.getAttributes(),je=tt.defaultAttributeValues;for(const Te in $e){const De=$e[Te];if(De.location>=0){let ot=Oe[Te];if(ot===void 0&&(Te==="instanceMatrix"&&Ue.instanceMatrix&&(ot=Ue.instanceMatrix),Te==="instanceColor"&&Ue.instanceColor&&(ot=Ue.instanceColor)),ot!==void 0){const ct=ot.normalized,gt=ot.itemSize,pt=_.get(ot);if(pt===void 0)continue;const ht=pt.buffer,At=pt.type,Kt=pt.bytesPerElement,en=K.isWebGL2===!0&&(At===X.INT||At===X.UNSIGNED_INT||ot.gpuType===IntType);if(ot.isInterleavedBufferAttribute){const Zt=ot.data,st=Zt.stride,Vt=ot.offset;if(Zt.isInstancedInterleavedBuffer){for(let wt=0;wt<De.locationSize;wt++)Ee(De.location+wt,Zt.meshPerAttribute);Ue.isInstancedMesh!==!0&&at._maxInstanceCount===void 0&&(at._maxInstanceCount=Zt.meshPerAttribute*Zt.count)}else for(let wt=0;wt<De.locationSize;wt++)Re(De.location+wt);X.bindBuffer(X.ARRAY_BUFFER,ht);for(let wt=0;wt<De.locationSize;wt++)Ze(De.location+wt,gt/De.locationSize,At,ct,st*Kt,(Vt+gt/De.locationSize*wt)*Kt,en)}else{if(ot.isInstancedBufferAttribute){for(let Zt=0;Zt<De.locationSize;Zt++)Ee(De.location+Zt,ot.meshPerAttribute);Ue.isInstancedMesh!==!0&&at._maxInstanceCount===void 0&&(at._maxInstanceCount=ot.meshPerAttribute*ot.count)}else for(let Zt=0;Zt<De.locationSize;Zt++)Re(De.location+Zt);X.bindBuffer(X.ARRAY_BUFFER,ht);for(let Zt=0;Zt<De.locationSize;Zt++)Ze(De.location+Zt,gt/De.locationSize,At,ct,gt*Kt,gt/De.locationSize*Zt*Kt,en)}}else if(je!==void 0){const ct=je[Te];if(ct!==void 0)switch(ct.length){case 2:X.vertexAttrib2fv(De.location,ct);break;case 3:X.vertexAttrib3fv(De.location,ct);break;case 4:X.vertexAttrib4fv(De.location,ct);break;default:X.vertexAttrib1fv(De.location,ct)}}}}We()}function _e(){He();for(const Ue in ie){const tt=ie[Ue];for(const rt in tt){const at=tt[rt];for(const Oe in at)fe(at[Oe].object),delete at[Oe];delete tt[rt]}delete ie[Ue]}}function Xe(Ue){if(ie[Ue.id]===void 0)return;const tt=ie[Ue.id];for(const rt in tt){const at=tt[rt];for(const Oe in at)fe(at[Oe].object),delete at[Oe];delete tt[rt]}delete ie[Ue.id]}function Pe(Ue){for(const tt in ie){const rt=ie[tt];if(rt[Ue.id]===void 0)continue;const at=rt[Ue.id];for(const Oe in at)fe(at[Oe].object),delete at[Oe];delete rt[Ue.id]}}function He(){Ke(),ge=!0,ae!==se&&(ae=se,pe(ae.object))}function Ke(){se.geometry=null,se.program=null,se.wireframe=!1}return{setup:ce,reset:He,resetDefaultState:Ke,dispose:_e,releaseStatesOfGeometry:Xe,releaseStatesOfProgram:Pe,initAttributes:Be,enableAttribute:Re,disableUnusedAttributes:We}}function WebGLBufferRenderer(X,Z,_,K){const te=K.isWebGL2;let ne;function oe(ae){ne=ae}function ie(ae,ge){X.drawArrays(ne,ae,ge),_.update(ge,ne,1)}function se(ae,ge,ce){if(ce===0)return;let de,pe;if(te)de=X,pe="drawArraysInstanced";else if(de=Z.get("ANGLE_instanced_arrays"),pe="drawArraysInstancedANGLE",de===null){console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}de[pe](ne,ae,ge,ce),_.update(ge,ne,ce)}this.setMode=oe,this.render=ie,this.renderInstances=se}function WebGLCapabilities(X,Z,_){let K;function te(){if(K!==void 0)return K;if(Z.has("EXT_texture_filter_anisotropic")===!0){const Ze=Z.get("EXT_texture_filter_anisotropic");K=X.getParameter(Ze.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else K=0;return K}function ne(Ze){if(Ze==="highp"){if(X.getShaderPrecisionFormat(X.VERTEX_SHADER,X.HIGH_FLOAT).precision>0&&X.getShaderPrecisionFormat(X.FRAGMENT_SHADER,X.HIGH_FLOAT).precision>0)return"highp";Ze="mediump"}return Ze==="mediump"&&X.getShaderPrecisionFormat(X.VERTEX_SHADER,X.MEDIUM_FLOAT).precision>0&&X.getShaderPrecisionFormat(X.FRAGMENT_SHADER,X.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}const oe=typeof WebGL2RenderingContext<"u"&&X.constructor.name==="WebGL2RenderingContext";let ie=_.precision!==void 0?_.precision:"highp";const se=ne(ie);se!==ie&&(console.warn("THREE.WebGLRenderer:",ie,"not supported, using",se,"instead."),ie=se);const ae=oe||Z.has("WEBGL_draw_buffers"),ge=_.logarithmicDepthBuffer===!0,ce=X.getParameter(X.MAX_TEXTURE_IMAGE_UNITS),de=X.getParameter(X.MAX_VERTEX_TEXTURE_IMAGE_UNITS),pe=X.getParameter(X.MAX_TEXTURE_SIZE),fe=X.getParameter(X.MAX_CUBE_MAP_TEXTURE_SIZE),be=X.getParameter(X.MAX_VERTEX_ATTRIBS),me=X.getParameter(X.MAX_VERTEX_UNIFORM_VECTORS),ye=X.getParameter(X.MAX_VARYING_VECTORS),ve=X.getParameter(X.MAX_FRAGMENT_UNIFORM_VECTORS),Be=de>0,Re=oe||Z.has("OES_texture_float"),Ee=Be&&Re,We=oe?X.getParameter(X.MAX_SAMPLES):0;return{isWebGL2:oe,drawBuffers:ae,getMaxAnisotropy:te,getMaxPrecision:ne,precision:ie,logarithmicDepthBuffer:ge,maxTextures:ce,maxVertexTextures:de,maxTextureSize:pe,maxCubemapSize:fe,maxAttributes:be,maxVertexUniforms:me,maxVaryings:ye,maxFragmentUniforms:ve,vertexTextures:Be,floatFragmentTextures:Re,floatVertexTextures:Ee,maxSamples:We}}function WebGLClipping(X){const Z=this;let _=null,K=0,te=!1,ne=!1;const oe=new Plane,ie=new Matrix3,se={value:null,needsUpdate:!1};this.uniform=se,this.numPlanes=0,this.numIntersection=0,this.init=function(ce,de){const pe=ce.length!==0||de||K!==0||te;return te=de,K=ce.length,pe},this.beginShadows=function(){ne=!0,ge(null)},this.endShadows=function(){ne=!1},this.setGlobalState=function(ce,de){_=ge(ce,de,0)},this.setState=function(ce,de,pe){const fe=ce.clippingPlanes,be=ce.clipIntersection,me=ce.clipShadows,ye=X.get(ce);if(!te||fe===null||fe.length===0||ne&&!me)ne?ge(null):ae();else{const ve=ne?0:K,Be=ve*4;let Re=ye.clippingState||null;se.value=Re,Re=ge(fe,de,Be,pe);for(let Ee=0;Ee!==Be;++Ee)Re[Ee]=_[Ee];ye.clippingState=Re,this.numIntersection=be?this.numPlanes:0,this.numPlanes+=ve}};function ae(){se.value!==_&&(se.value=_,se.needsUpdate=K>0),Z.numPlanes=K,Z.numIntersection=0}function ge(ce,de,pe,fe){const be=ce!==null?ce.length:0;let me=null;if(be!==0){if(me=se.value,fe!==!0||me===null){const ye=pe+be*4,ve=de.matrixWorldInverse;ie.getNormalMatrix(ve),(me===null||me.length<ye)&&(me=new Float32Array(ye));for(let Be=0,Re=pe;Be!==be;++Be,Re+=4)oe.copy(ce[Be]).applyMatrix4(ve,ie),oe.normal.toArray(me,Re),me[Re+3]=oe.constant}se.value=me,se.needsUpdate=!0}return Z.numPlanes=be,Z.numIntersection=0,me}}function WebGLCubeMaps(X){let Z=new WeakMap;function _(oe,ie){return ie===EquirectangularReflectionMapping?oe.mapping=CubeReflectionMapping:ie===EquirectangularRefractionMapping&&(oe.mapping=CubeRefractionMapping),oe}function K(oe){if(oe&&oe.isTexture&&oe.isRenderTargetTexture===!1){const ie=oe.mapping;if(ie===EquirectangularReflectionMapping||ie===EquirectangularRefractionMapping)if(Z.has(oe)){const se=Z.get(oe).texture;return _(se,oe.mapping)}else{const se=oe.image;if(se&&se.height>0){const ae=new WebGLCubeRenderTarget(se.height/2);return ae.fromEquirectangularTexture(X,oe),Z.set(oe,ae),oe.addEventListener("dispose",te),_(ae.texture,oe.mapping)}else return null}}return oe}function te(oe){const ie=oe.target;ie.removeEventListener("dispose",te);const se=Z.get(ie);se!==void 0&&(Z.delete(ie),se.dispose())}function ne(){Z=new WeakMap}return{get:K,dispose:ne}}class OrthographicCamera extends Camera{constructor(Z=-1,_=1,K=1,te=-1,ne=.1,oe=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=Z,this.right=_,this.top=K,this.bottom=te,this.near=ne,this.far=oe,this.updateProjectionMatrix()}copy(Z,_){return super.copy(Z,_),this.left=Z.left,this.right=Z.right,this.top=Z.top,this.bottom=Z.bottom,this.near=Z.near,this.far=Z.far,this.zoom=Z.zoom,this.view=Z.view===null?null:Object.assign({},Z.view),this}setViewOffset(Z,_,K,te,ne,oe){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=Z,this.view.fullHeight=_,this.view.offsetX=K,this.view.offsetY=te,this.view.width=ne,this.view.height=oe,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const Z=(this.right-this.left)/(2*this.zoom),_=(this.top-this.bottom)/(2*this.zoom),K=(this.right+this.left)/2,te=(this.top+this.bottom)/2;let ne=K-Z,oe=K+Z,ie=te+_,se=te-_;if(this.view!==null&&this.view.enabled){const ae=(this.right-this.left)/this.view.fullWidth/this.zoom,ge=(this.top-this.bottom)/this.view.fullHeight/this.zoom;ne+=ae*this.view.offsetX,oe=ne+ae*this.view.width,ie-=ge*this.view.offsetY,se=ie-ge*this.view.height}this.projectionMatrix.makeOrthographic(ne,oe,ie,se,this.near,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(Z){const _=super.toJSON(Z);return _.object.zoom=this.zoom,_.object.left=this.left,_.object.right=this.right,_.object.top=this.top,_.object.bottom=this.bottom,_.object.near=this.near,_.object.far=this.far,this.view!==null&&(_.object.view=Object.assign({},this.view)),_}}const LOD_MIN=4,EXTRA_LOD_SIGMA=[.125,.215,.35,.446,.526,.582],MAX_SAMPLES=20,_flatCamera=new OrthographicCamera,_clearColor=new Color$1;let _oldTarget=null;const PHI=(1+Math.sqrt(5))/2,INV_PHI=1/PHI,_axisDirections=[new Vector3(1,1,1),new Vector3(-1,1,1),new Vector3(1,1,-1),new Vector3(-1,1,-1),new Vector3(0,PHI,INV_PHI),new Vector3(0,PHI,-INV_PHI),new Vector3(INV_PHI,0,PHI),new Vector3(-INV_PHI,0,PHI),new Vector3(PHI,INV_PHI,0),new Vector3(-PHI,INV_PHI,0)];class PMREMGenerator{constructor(Z){this._renderer=Z,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(Z,_=0,K=.1,te=100){_oldTarget=this._renderer.getRenderTarget(),this._setSize(256);const ne=this._allocateTargets();return ne.depthBuffer=!0,this._sceneToCubeUV(Z,K,te,ne),_>0&&this._blur(ne,0,0,_),this._applyPMREM(ne),this._cleanup(ne),ne}fromEquirectangular(Z,_=null){return this._fromTexture(Z,_)}fromCubemap(Z,_=null){return this._fromTexture(Z,_)}compileCubemapShader(){this._cubemapMaterial===null&&(this._cubemapMaterial=_getCubemapMaterial(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){this._equirectMaterial===null&&(this._equirectMaterial=_getEquirectMaterial(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),this._cubemapMaterial!==null&&this._cubemapMaterial.dispose(),this._equirectMaterial!==null&&this._equirectMaterial.dispose()}_setSize(Z){this._lodMax=Math.floor(Math.log2(Z)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){this._blurMaterial!==null&&this._blurMaterial.dispose(),this._pingPongRenderTarget!==null&&this._pingPongRenderTarget.dispose();for(let Z=0;Z<this._lodPlanes.length;Z++)this._lodPlanes[Z].dispose()}_cleanup(Z){this._renderer.setRenderTarget(_oldTarget),Z.scissorTest=!1,_setViewport(Z,0,0,Z.width,Z.height)}_fromTexture(Z,_){Z.mapping===CubeReflectionMapping||Z.mapping===CubeRefractionMapping?this._setSize(Z.image.length===0?16:Z.image[0].width||Z.image[0].image.width):this._setSize(Z.image.width/4),_oldTarget=this._renderer.getRenderTarget();const K=_||this._allocateTargets();return this._textureToCubeUV(Z,K),this._applyPMREM(K),this._cleanup(K),K}_allocateTargets(){const Z=3*Math.max(this._cubeSize,112),_=4*this._cubeSize,K={magFilter:LinearFilter,minFilter:LinearFilter,generateMipmaps:!1,type:HalfFloatType,format:RGBAFormat,colorSpace:LinearSRGBColorSpace$1,depthBuffer:!1},te=_createRenderTarget(Z,_,K);if(this._pingPongRenderTarget===null||this._pingPongRenderTarget.width!==Z||this._pingPongRenderTarget.height!==_){this._pingPongRenderTarget!==null&&this._dispose(),this._pingPongRenderTarget=_createRenderTarget(Z,_,K);const{_lodMax:ne}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=_createPlanes(ne)),this._blurMaterial=_getBlurShader(ne,Z,_)}return te}_compileMaterial(Z){const _=new Mesh(this._lodPlanes[0],Z);this._renderer.compile(_,_flatCamera)}_sceneToCubeUV(Z,_,K,te){const ie=new PerspectiveCamera(90,1,_,K),se=[1,-1,1,1,1,1],ae=[1,1,1,-1,-1,-1],ge=this._renderer,ce=ge.autoClear,de=ge.toneMapping;ge.getClearColor(_clearColor),ge.toneMapping=NoToneMapping,ge.autoClear=!1;const pe=new MeshBasicMaterial({name:"PMREM.Background",side:BackSide,depthWrite:!1,depthTest:!1}),fe=new Mesh(new BoxGeometry,pe);let be=!1;const me=Z.background;me?me.isColor&&(pe.color.copy(me),Z.background=null,be=!0):(pe.color.copy(_clearColor),be=!0);for(let ye=0;ye<6;ye++){const ve=ye%3;ve===0?(ie.up.set(0,se[ye],0),ie.lookAt(ae[ye],0,0)):ve===1?(ie.up.set(0,0,se[ye]),ie.lookAt(0,ae[ye],0)):(ie.up.set(0,se[ye],0),ie.lookAt(0,0,ae[ye]));const Be=this._cubeSize;_setViewport(te,ve*Be,ye>2?Be:0,Be,Be),ge.setRenderTarget(te),be&&ge.render(fe,ie),ge.render(Z,ie)}fe.geometry.dispose(),fe.material.dispose(),ge.toneMapping=de,ge.autoClear=ce,Z.background=me}_textureToCubeUV(Z,_){const K=this._renderer,te=Z.mapping===CubeReflectionMapping||Z.mapping===CubeRefractionMapping;te?(this._cubemapMaterial===null&&(this._cubemapMaterial=_getCubemapMaterial()),this._cubemapMaterial.uniforms.flipEnvMap.value=Z.isRenderTargetTexture===!1?-1:1):this._equirectMaterial===null&&(this._equirectMaterial=_getEquirectMaterial());const ne=te?this._cubemapMaterial:this._equirectMaterial,oe=new Mesh(this._lodPlanes[0],ne),ie=ne.uniforms;ie.envMap.value=Z;const se=this._cubeSize;_setViewport(_,0,0,3*se,2*se),K.setRenderTarget(_),K.render(oe,_flatCamera)}_applyPMREM(Z){const _=this._renderer,K=_.autoClear;_.autoClear=!1;for(let te=1;te<this._lodPlanes.length;te++){const ne=Math.sqrt(this._sigmas[te]*this._sigmas[te]-this._sigmas[te-1]*this._sigmas[te-1]),oe=_axisDirections[(te-1)%_axisDirections.length];this._blur(Z,te-1,te,ne,oe)}_.autoClear=K}_blur(Z,_,K,te,ne){const oe=this._pingPongRenderTarget;this._halfBlur(Z,oe,_,K,te,"latitudinal",ne),this._halfBlur(oe,Z,K,K,te,"longitudinal",ne)}_halfBlur(Z,_,K,te,ne,oe,ie){const se=this._renderer,ae=this._blurMaterial;oe!=="latitudinal"&&oe!=="longitudinal"&&console.error("blur direction must be either latitudinal or longitudinal!");const ge=3,ce=new Mesh(this._lodPlanes[te],ae),de=ae.uniforms,pe=this._sizeLods[K]-1,fe=isFinite(ne)?Math.PI/(2*pe):2*Math.PI/(2*MAX_SAMPLES-1),be=ne/fe,me=isFinite(ne)?1+Math.floor(ge*be):MAX_SAMPLES;me>MAX_SAMPLES&&console.warn(`sigmaRadians, ${ne}, is too large and will clip, as it requested ${me} samples when the maximum is set to ${MAX_SAMPLES}`);const ye=[];let ve=0;for(let Ze=0;Ze<MAX_SAMPLES;++Ze){const Ve=Ze/be,_e=Math.exp(-Ve*Ve/2);ye.push(_e),Ze===0?ve+=_e:Ze<me&&(ve+=2*_e)}for(let Ze=0;Ze<ye.length;Ze++)ye[Ze]=ye[Ze]/ve;de.envMap.value=Z.texture,de.samples.value=me,de.weights.value=ye,de.latitudinal.value=oe==="latitudinal",ie&&(de.poleAxis.value=ie);const{_lodMax:Be}=this;de.dTheta.value=fe,de.mipInt.value=Be-K;const Re=this._sizeLods[te],Ee=3*Re*(te>Be-LOD_MIN?te-Be+LOD_MIN:0),We=4*(this._cubeSize-Re);_setViewport(_,Ee,We,3*Re,2*Re),se.setRenderTarget(_),se.render(ce,_flatCamera)}}function _createPlanes(X){const Z=[],_=[],K=[];let te=X;const ne=X-LOD_MIN+1+EXTRA_LOD_SIGMA.length;for(let oe=0;oe<ne;oe++){const ie=Math.pow(2,te);_.push(ie);let se=1/ie;oe>X-LOD_MIN?se=EXTRA_LOD_SIGMA[oe-X+LOD_MIN-1]:oe===0&&(se=0),K.push(se);const ae=1/(ie-2),ge=-ae,ce=1+ae,de=[ge,ge,ce,ge,ce,ce,ge,ge,ce,ce,ge,ce],pe=6,fe=6,be=3,me=2,ye=1,ve=new Float32Array(be*fe*pe),Be=new Float32Array(me*fe*pe),Re=new Float32Array(ye*fe*pe);for(let We=0;We<pe;We++){const Ze=We%3*2/3-1,Ve=We>2?0:-1,_e=[Ze,Ve,0,Ze+2/3,Ve,0,Ze+2/3,Ve+1,0,Ze,Ve,0,Ze+2/3,Ve+1,0,Ze,Ve+1,0];ve.set(_e,be*fe*We),Be.set(de,me*fe*We);const Xe=[We,We,We,We,We,We];Re.set(Xe,ye*fe*We)}const Ee=new BufferGeometry;Ee.setAttribute("position",new BufferAttribute(ve,be)),Ee.setAttribute("uv",new BufferAttribute(Be,me)),Ee.setAttribute("faceIndex",new BufferAttribute(Re,ye)),Z.push(Ee),te>LOD_MIN&&te--}return{lodPlanes:Z,sizeLods:_,sigmas:K}}function _createRenderTarget(X,Z,_){const K=new WebGLRenderTarget(X,Z,_);return K.texture.mapping=CubeUVReflectionMapping,K.texture.name="PMREM.cubeUv",K.scissorTest=!0,K}function _setViewport(X,Z,_,K,te){X.viewport.set(Z,_,K,te),X.scissor.set(Z,_,K,te)}function _getBlurShader(X,Z,_){const K=new Float32Array(MAX_SAMPLES),te=new Vector3(0,1,0);return new ShaderMaterial({name:"SphericalGaussianBlur",defines:{n:MAX_SAMPLES,CUBEUV_TEXEL_WIDTH:1/Z,CUBEUV_TEXEL_HEIGHT:1/_,CUBEUV_MAX_MIP:`${X}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:K},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:te}},vertexShader:_getCommonVertexShader(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform int samples;
			uniform float weights[ n ];
			uniform bool latitudinal;
			uniform float dTheta;
			uniform float mipInt;
			uniform vec3 poleAxis;

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			vec3 getSample( float theta, vec3 axis ) {

				float cosTheta = cos( theta );
				// Rodrigues' axis-angle rotation
				vec3 sampleDirection = vOutputDirection * cosTheta
					+ cross( axis, vOutputDirection ) * sin( theta )
					+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );

				return bilinearCubeUV( envMap, sampleDirection, mipInt );

			}

			void main() {

				vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );

				if ( all( equal( axis, vec3( 0.0 ) ) ) ) {

					axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );

				}

				axis = normalize( axis );

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );

				for ( int i = 1; i < n; i++ ) {

					if ( i >= samples ) {

						break;

					}

					float theta = dTheta * float( i );
					gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );
					gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );

				}

			}
		`,blending:NoBlending,depthTest:!1,depthWrite:!1})}function _getEquirectMaterial(){return new ShaderMaterial({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:_getCommonVertexShader(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;

			#include <common>

			void main() {

				vec3 outputDirection = normalize( vOutputDirection );
				vec2 uv = equirectUv( outputDirection );

				gl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );

			}
		`,blending:NoBlending,depthTest:!1,depthWrite:!1})}function _getCubemapMaterial(){return new ShaderMaterial({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:_getCommonVertexShader(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			uniform float flipEnvMap;

			varying vec3 vOutputDirection;

			uniform samplerCube envMap;

			void main() {

				gl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );

			}
		`,blending:NoBlending,depthTest:!1,depthWrite:!1})}function _getCommonVertexShader(){return`

		precision mediump float;
		precision mediump int;

		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`}function WebGLCubeUVMaps(X){let Z=new WeakMap,_=null;function K(ie){if(ie&&ie.isTexture){const se=ie.mapping,ae=se===EquirectangularReflectionMapping||se===EquirectangularRefractionMapping,ge=se===CubeReflectionMapping||se===CubeRefractionMapping;if(ae||ge)if(ie.isRenderTargetTexture&&ie.needsPMREMUpdate===!0){ie.needsPMREMUpdate=!1;let ce=Z.get(ie);return _===null&&(_=new PMREMGenerator(X)),ce=ae?_.fromEquirectangular(ie,ce):_.fromCubemap(ie,ce),Z.set(ie,ce),ce.texture}else{if(Z.has(ie))return Z.get(ie).texture;{const ce=ie.image;if(ae&&ce&&ce.height>0||ge&&ce&&te(ce)){_===null&&(_=new PMREMGenerator(X));const de=ae?_.fromEquirectangular(ie):_.fromCubemap(ie);return Z.set(ie,de),ie.addEventListener("dispose",ne),de.texture}else return null}}}return ie}function te(ie){let se=0;const ae=6;for(let ge=0;ge<ae;ge++)ie[ge]!==void 0&&se++;return se===ae}function ne(ie){const se=ie.target;se.removeEventListener("dispose",ne);const ae=Z.get(se);ae!==void 0&&(Z.delete(se),ae.dispose())}function oe(){Z=new WeakMap,_!==null&&(_.dispose(),_=null)}return{get:K,dispose:oe}}function WebGLExtensions(X){const Z={};function _(K){if(Z[K]!==void 0)return Z[K];let te;switch(K){case"WEBGL_depth_texture":te=X.getExtension("WEBGL_depth_texture")||X.getExtension("MOZ_WEBGL_depth_texture")||X.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":te=X.getExtension("EXT_texture_filter_anisotropic")||X.getExtension("MOZ_EXT_texture_filter_anisotropic")||X.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":te=X.getExtension("WEBGL_compressed_texture_s3tc")||X.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||X.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":te=X.getExtension("WEBGL_compressed_texture_pvrtc")||X.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:te=X.getExtension(K)}return Z[K]=te,te}return{has:function(K){return _(K)!==null},init:function(K){K.isWebGL2?_("EXT_color_buffer_float"):(_("WEBGL_depth_texture"),_("OES_texture_float"),_("OES_texture_half_float"),_("OES_texture_half_float_linear"),_("OES_standard_derivatives"),_("OES_element_index_uint"),_("OES_vertex_array_object"),_("ANGLE_instanced_arrays")),_("OES_texture_float_linear"),_("EXT_color_buffer_half_float"),_("WEBGL_multisampled_render_to_texture")},get:function(K){const te=_(K);return te===null&&console.warn("THREE.WebGLRenderer: "+K+" extension not supported."),te}}}function WebGLGeometries(X,Z,_,K){const te={},ne=new WeakMap;function oe(ce){const de=ce.target;de.index!==null&&Z.remove(de.index);for(const fe in de.attributes)Z.remove(de.attributes[fe]);for(const fe in de.morphAttributes){const be=de.morphAttributes[fe];for(let me=0,ye=be.length;me<ye;me++)Z.remove(be[me])}de.removeEventListener("dispose",oe),delete te[de.id];const pe=ne.get(de);pe&&(Z.remove(pe),ne.delete(de)),K.releaseStatesOfGeometry(de),de.isInstancedBufferGeometry===!0&&delete de._maxInstanceCount,_.memory.geometries--}function ie(ce,de){return te[de.id]===!0||(de.addEventListener("dispose",oe),te[de.id]=!0,_.memory.geometries++),de}function se(ce){const de=ce.attributes;for(const fe in de)Z.update(de[fe],X.ARRAY_BUFFER);const pe=ce.morphAttributes;for(const fe in pe){const be=pe[fe];for(let me=0,ye=be.length;me<ye;me++)Z.update(be[me],X.ARRAY_BUFFER)}}function ae(ce){const de=[],pe=ce.index,fe=ce.attributes.position;let be=0;if(pe!==null){const ve=pe.array;be=pe.version;for(let Be=0,Re=ve.length;Be<Re;Be+=3){const Ee=ve[Be+0],We=ve[Be+1],Ze=ve[Be+2];de.push(Ee,We,We,Ze,Ze,Ee)}}else{const ve=fe.array;be=fe.version;for(let Be=0,Re=ve.length/3-1;Be<Re;Be+=3){const Ee=Be+0,We=Be+1,Ze=Be+2;de.push(Ee,We,We,Ze,Ze,Ee)}}const me=new(arrayNeedsUint32(de)?Uint32BufferAttribute:Uint16BufferAttribute)(de,1);me.version=be;const ye=ne.get(ce);ye&&Z.remove(ye),ne.set(ce,me)}function ge(ce){const de=ne.get(ce);if(de){const pe=ce.index;pe!==null&&de.version<pe.version&&ae(ce)}else ae(ce);return ne.get(ce)}return{get:ie,update:se,getWireframeAttribute:ge}}function WebGLIndexedBufferRenderer(X,Z,_,K){const te=K.isWebGL2;let ne;function oe(de){ne=de}let ie,se;function ae(de){ie=de.type,se=de.bytesPerElement}function ge(de,pe){X.drawElements(ne,pe,ie,de*se),_.update(pe,ne,1)}function ce(de,pe,fe){if(fe===0)return;let be,me;if(te)be=X,me="drawElementsInstanced";else if(be=Z.get("ANGLE_instanced_arrays"),me="drawElementsInstancedANGLE",be===null){console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}be[me](ne,pe,ie,de*se,fe),_.update(pe,ne,fe)}this.setMode=oe,this.setIndex=ae,this.render=ge,this.renderInstances=ce}function WebGLInfo(X){const Z={geometries:0,textures:0},_={frame:0,calls:0,triangles:0,points:0,lines:0};function K(ne,oe,ie){switch(_.calls++,oe){case X.TRIANGLES:_.triangles+=ie*(ne/3);break;case X.LINES:_.lines+=ie*(ne/2);break;case X.LINE_STRIP:_.lines+=ie*(ne-1);break;case X.LINE_LOOP:_.lines+=ie*ne;break;case X.POINTS:_.points+=ie*ne;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",oe);break}}function te(){_.calls=0,_.triangles=0,_.points=0,_.lines=0}return{memory:Z,render:_,programs:null,autoReset:!0,reset:te,update:K}}function numericalSort(X,Z){return X[0]-Z[0]}function absNumericalSort(X,Z){return Math.abs(Z[1])-Math.abs(X[1])}function WebGLMorphtargets(X,Z,_){const K={},te=new Float32Array(8),ne=new WeakMap,oe=new Vector4,ie=[];for(let ae=0;ae<8;ae++)ie[ae]=[ae,0];function se(ae,ge,ce){const de=ae.morphTargetInfluences;if(Z.isWebGL2===!0){const fe=ge.morphAttributes.position||ge.morphAttributes.normal||ge.morphAttributes.color,be=fe!==void 0?fe.length:0;let me=ne.get(ge);if(me===void 0||me.count!==be){let tt=function(){Ke.dispose(),ne.delete(ge),ge.removeEventListener("dispose",tt)};var pe=tt;me!==void 0&&me.texture.dispose();const Be=ge.morphAttributes.position!==void 0,Re=ge.morphAttributes.normal!==void 0,Ee=ge.morphAttributes.color!==void 0,We=ge.morphAttributes.position||[],Ze=ge.morphAttributes.normal||[],Ve=ge.morphAttributes.color||[];let _e=0;Be===!0&&(_e=1),Re===!0&&(_e=2),Ee===!0&&(_e=3);let Xe=ge.attributes.position.count*_e,Pe=1;Xe>Z.maxTextureSize&&(Pe=Math.ceil(Xe/Z.maxTextureSize),Xe=Z.maxTextureSize);const He=new Float32Array(Xe*Pe*4*be),Ke=new DataArrayTexture(He,Xe,Pe,be);Ke.type=FloatType,Ke.needsUpdate=!0;const Ue=_e*4;for(let rt=0;rt<be;rt++){const at=We[rt],Oe=Ze[rt],$e=Ve[rt],je=Xe*Pe*4*rt;for(let Te=0;Te<at.count;Te++){const De=Te*Ue;Be===!0&&(oe.fromBufferAttribute(at,Te),He[je+De+0]=oe.x,He[je+De+1]=oe.y,He[je+De+2]=oe.z,He[je+De+3]=0),Re===!0&&(oe.fromBufferAttribute(Oe,Te),He[je+De+4]=oe.x,He[je+De+5]=oe.y,He[je+De+6]=oe.z,He[je+De+7]=0),Ee===!0&&(oe.fromBufferAttribute($e,Te),He[je+De+8]=oe.x,He[je+De+9]=oe.y,He[je+De+10]=oe.z,He[je+De+11]=$e.itemSize===4?oe.w:1)}}me={count:be,texture:Ke,size:new Vector2(Xe,Pe)},ne.set(ge,me),ge.addEventListener("dispose",tt)}let ye=0;for(let Be=0;Be<de.length;Be++)ye+=de[Be];const ve=ge.morphTargetsRelative?1:1-ye;ce.getUniforms().setValue(X,"morphTargetBaseInfluence",ve),ce.getUniforms().setValue(X,"morphTargetInfluences",de),ce.getUniforms().setValue(X,"morphTargetsTexture",me.texture,_),ce.getUniforms().setValue(X,"morphTargetsTextureSize",me.size)}else{const fe=de===void 0?0:de.length;let be=K[ge.id];if(be===void 0||be.length!==fe){be=[];for(let Re=0;Re<fe;Re++)be[Re]=[Re,0];K[ge.id]=be}for(let Re=0;Re<fe;Re++){const Ee=be[Re];Ee[0]=Re,Ee[1]=de[Re]}be.sort(absNumericalSort);for(let Re=0;Re<8;Re++)Re<fe&&be[Re][1]?(ie[Re][0]=be[Re][0],ie[Re][1]=be[Re][1]):(ie[Re][0]=Number.MAX_SAFE_INTEGER,ie[Re][1]=0);ie.sort(numericalSort);const me=ge.morphAttributes.position,ye=ge.morphAttributes.normal;let ve=0;for(let Re=0;Re<8;Re++){const Ee=ie[Re],We=Ee[0],Ze=Ee[1];We!==Number.MAX_SAFE_INTEGER&&Ze?(me&&ge.getAttribute("morphTarget"+Re)!==me[We]&&ge.setAttribute("morphTarget"+Re,me[We]),ye&&ge.getAttribute("morphNormal"+Re)!==ye[We]&&ge.setAttribute("morphNormal"+Re,ye[We]),te[Re]=Ze,ve+=Ze):(me&&ge.hasAttribute("morphTarget"+Re)===!0&&ge.deleteAttribute("morphTarget"+Re),ye&&ge.hasAttribute("morphNormal"+Re)===!0&&ge.deleteAttribute("morphNormal"+Re),te[Re]=0)}const Be=ge.morphTargetsRelative?1:1-ve;ce.getUniforms().setValue(X,"morphTargetBaseInfluence",Be),ce.getUniforms().setValue(X,"morphTargetInfluences",te)}}return{update:se}}function WebGLObjects(X,Z,_,K){let te=new WeakMap;function ne(se){const ae=K.render.frame,ge=se.geometry,ce=Z.get(se,ge);if(te.get(ce)!==ae&&(Z.update(ce),te.set(ce,ae)),se.isInstancedMesh&&(se.hasEventListener("dispose",ie)===!1&&se.addEventListener("dispose",ie),te.get(se)!==ae&&(_.update(se.instanceMatrix,X.ARRAY_BUFFER),se.instanceColor!==null&&_.update(se.instanceColor,X.ARRAY_BUFFER),te.set(se,ae))),se.isSkinnedMesh){const de=se.skeleton;te.get(de)!==ae&&(de.update(),te.set(de,ae))}return ce}function oe(){te=new WeakMap}function ie(se){const ae=se.target;ae.removeEventListener("dispose",ie),_.remove(ae.instanceMatrix),ae.instanceColor!==null&&_.remove(ae.instanceColor)}return{update:ne,dispose:oe}}const emptyTexture=new Texture,emptyArrayTexture=new DataArrayTexture,empty3dTexture=new Data3DTexture,emptyCubeTexture=new CubeTexture,arrayCacheF32=[],arrayCacheI32=[],mat4array=new Float32Array(16),mat3array=new Float32Array(9),mat2array=new Float32Array(4);function flatten$1(X,Z,_){const K=X[0];if(K<=0||K>0)return X;const te=Z*_;let ne=arrayCacheF32[te];if(ne===void 0&&(ne=new Float32Array(te),arrayCacheF32[te]=ne),Z!==0){K.toArray(ne,0);for(let oe=1,ie=0;oe!==Z;++oe)ie+=_,X[oe].toArray(ne,ie)}return ne}function arraysEqual(X,Z){if(X.length!==Z.length)return!1;for(let _=0,K=X.length;_<K;_++)if(X[_]!==Z[_])return!1;return!0}function copyArray(X,Z){for(let _=0,K=Z.length;_<K;_++)X[_]=Z[_]}function allocTexUnits(X,Z){let _=arrayCacheI32[Z];_===void 0&&(_=new Int32Array(Z),arrayCacheI32[Z]=_);for(let K=0;K!==Z;++K)_[K]=X.allocateTextureUnit();return _}function setValueV1f(X,Z){const _=this.cache;_[0]!==Z&&(X.uniform1f(this.addr,Z),_[0]=Z)}function setValueV2f(X,Z){const _=this.cache;if(Z.x!==void 0)(_[0]!==Z.x||_[1]!==Z.y)&&(X.uniform2f(this.addr,Z.x,Z.y),_[0]=Z.x,_[1]=Z.y);else{if(arraysEqual(_,Z))return;X.uniform2fv(this.addr,Z),copyArray(_,Z)}}function setValueV3f(X,Z){const _=this.cache;if(Z.x!==void 0)(_[0]!==Z.x||_[1]!==Z.y||_[2]!==Z.z)&&(X.uniform3f(this.addr,Z.x,Z.y,Z.z),_[0]=Z.x,_[1]=Z.y,_[2]=Z.z);else if(Z.r!==void 0)(_[0]!==Z.r||_[1]!==Z.g||_[2]!==Z.b)&&(X.uniform3f(this.addr,Z.r,Z.g,Z.b),_[0]=Z.r,_[1]=Z.g,_[2]=Z.b);else{if(arraysEqual(_,Z))return;X.uniform3fv(this.addr,Z),copyArray(_,Z)}}function setValueV4f(X,Z){const _=this.cache;if(Z.x!==void 0)(_[0]!==Z.x||_[1]!==Z.y||_[2]!==Z.z||_[3]!==Z.w)&&(X.uniform4f(this.addr,Z.x,Z.y,Z.z,Z.w),_[0]=Z.x,_[1]=Z.y,_[2]=Z.z,_[3]=Z.w);else{if(arraysEqual(_,Z))return;X.uniform4fv(this.addr,Z),copyArray(_,Z)}}function setValueM2(X,Z){const _=this.cache,K=Z.elements;if(K===void 0){if(arraysEqual(_,Z))return;X.uniformMatrix2fv(this.addr,!1,Z),copyArray(_,Z)}else{if(arraysEqual(_,K))return;mat2array.set(K),X.uniformMatrix2fv(this.addr,!1,mat2array),copyArray(_,K)}}function setValueM3(X,Z){const _=this.cache,K=Z.elements;if(K===void 0){if(arraysEqual(_,Z))return;X.uniformMatrix3fv(this.addr,!1,Z),copyArray(_,Z)}else{if(arraysEqual(_,K))return;mat3array.set(K),X.uniformMatrix3fv(this.addr,!1,mat3array),copyArray(_,K)}}function setValueM4(X,Z){const _=this.cache,K=Z.elements;if(K===void 0){if(arraysEqual(_,Z))return;X.uniformMatrix4fv(this.addr,!1,Z),copyArray(_,Z)}else{if(arraysEqual(_,K))return;mat4array.set(K),X.uniformMatrix4fv(this.addr,!1,mat4array),copyArray(_,K)}}function setValueV1i(X,Z){const _=this.cache;_[0]!==Z&&(X.uniform1i(this.addr,Z),_[0]=Z)}function setValueV2i(X,Z){const _=this.cache;if(Z.x!==void 0)(_[0]!==Z.x||_[1]!==Z.y)&&(X.uniform2i(this.addr,Z.x,Z.y),_[0]=Z.x,_[1]=Z.y);else{if(arraysEqual(_,Z))return;X.uniform2iv(this.addr,Z),copyArray(_,Z)}}function setValueV3i(X,Z){const _=this.cache;if(Z.x!==void 0)(_[0]!==Z.x||_[1]!==Z.y||_[2]!==Z.z)&&(X.uniform3i(this.addr,Z.x,Z.y,Z.z),_[0]=Z.x,_[1]=Z.y,_[2]=Z.z);else{if(arraysEqual(_,Z))return;X.uniform3iv(this.addr,Z),copyArray(_,Z)}}function setValueV4i(X,Z){const _=this.cache;if(Z.x!==void 0)(_[0]!==Z.x||_[1]!==Z.y||_[2]!==Z.z||_[3]!==Z.w)&&(X.uniform4i(this.addr,Z.x,Z.y,Z.z,Z.w),_[0]=Z.x,_[1]=Z.y,_[2]=Z.z,_[3]=Z.w);else{if(arraysEqual(_,Z))return;X.uniform4iv(this.addr,Z),copyArray(_,Z)}}function setValueV1ui(X,Z){const _=this.cache;_[0]!==Z&&(X.uniform1ui(this.addr,Z),_[0]=Z)}function setValueV2ui(X,Z){const _=this.cache;if(Z.x!==void 0)(_[0]!==Z.x||_[1]!==Z.y)&&(X.uniform2ui(this.addr,Z.x,Z.y),_[0]=Z.x,_[1]=Z.y);else{if(arraysEqual(_,Z))return;X.uniform2uiv(this.addr,Z),copyArray(_,Z)}}function setValueV3ui(X,Z){const _=this.cache;if(Z.x!==void 0)(_[0]!==Z.x||_[1]!==Z.y||_[2]!==Z.z)&&(X.uniform3ui(this.addr,Z.x,Z.y,Z.z),_[0]=Z.x,_[1]=Z.y,_[2]=Z.z);else{if(arraysEqual(_,Z))return;X.uniform3uiv(this.addr,Z),copyArray(_,Z)}}function setValueV4ui(X,Z){const _=this.cache;if(Z.x!==void 0)(_[0]!==Z.x||_[1]!==Z.y||_[2]!==Z.z||_[3]!==Z.w)&&(X.uniform4ui(this.addr,Z.x,Z.y,Z.z,Z.w),_[0]=Z.x,_[1]=Z.y,_[2]=Z.z,_[3]=Z.w);else{if(arraysEqual(_,Z))return;X.uniform4uiv(this.addr,Z),copyArray(_,Z)}}function setValueT1(X,Z,_){const K=this.cache,te=_.allocateTextureUnit();K[0]!==te&&(X.uniform1i(this.addr,te),K[0]=te),_.setTexture2D(Z||emptyTexture,te)}function setValueT3D1(X,Z,_){const K=this.cache,te=_.allocateTextureUnit();K[0]!==te&&(X.uniform1i(this.addr,te),K[0]=te),_.setTexture3D(Z||empty3dTexture,te)}function setValueT6(X,Z,_){const K=this.cache,te=_.allocateTextureUnit();K[0]!==te&&(X.uniform1i(this.addr,te),K[0]=te),_.setTextureCube(Z||emptyCubeTexture,te)}function setValueT2DArray1(X,Z,_){const K=this.cache,te=_.allocateTextureUnit();K[0]!==te&&(X.uniform1i(this.addr,te),K[0]=te),_.setTexture2DArray(Z||emptyArrayTexture,te)}function getSingularSetter(X){switch(X){case 5126:return setValueV1f;case 35664:return setValueV2f;case 35665:return setValueV3f;case 35666:return setValueV4f;case 35674:return setValueM2;case 35675:return setValueM3;case 35676:return setValueM4;case 5124:case 35670:return setValueV1i;case 35667:case 35671:return setValueV2i;case 35668:case 35672:return setValueV3i;case 35669:case 35673:return setValueV4i;case 5125:return setValueV1ui;case 36294:return setValueV2ui;case 36295:return setValueV3ui;case 36296:return setValueV4ui;case 35678:case 36198:case 36298:case 36306:case 35682:return setValueT1;case 35679:case 36299:case 36307:return setValueT3D1;case 35680:case 36300:case 36308:case 36293:return setValueT6;case 36289:case 36303:case 36311:case 36292:return setValueT2DArray1}}function setValueV1fArray(X,Z){X.uniform1fv(this.addr,Z)}function setValueV2fArray(X,Z){const _=flatten$1(Z,this.size,2);X.uniform2fv(this.addr,_)}function setValueV3fArray(X,Z){const _=flatten$1(Z,this.size,3);X.uniform3fv(this.addr,_)}function setValueV4fArray(X,Z){const _=flatten$1(Z,this.size,4);X.uniform4fv(this.addr,_)}function setValueM2Array(X,Z){const _=flatten$1(Z,this.size,4);X.uniformMatrix2fv(this.addr,!1,_)}function setValueM3Array(X,Z){const _=flatten$1(Z,this.size,9);X.uniformMatrix3fv(this.addr,!1,_)}function setValueM4Array(X,Z){const _=flatten$1(Z,this.size,16);X.uniformMatrix4fv(this.addr,!1,_)}function setValueV1iArray(X,Z){X.uniform1iv(this.addr,Z)}function setValueV2iArray(X,Z){X.uniform2iv(this.addr,Z)}function setValueV3iArray(X,Z){X.uniform3iv(this.addr,Z)}function setValueV4iArray(X,Z){X.uniform4iv(this.addr,Z)}function setValueV1uiArray(X,Z){X.uniform1uiv(this.addr,Z)}function setValueV2uiArray(X,Z){X.uniform2uiv(this.addr,Z)}function setValueV3uiArray(X,Z){X.uniform3uiv(this.addr,Z)}function setValueV4uiArray(X,Z){X.uniform4uiv(this.addr,Z)}function setValueT1Array(X,Z,_){const K=this.cache,te=Z.length,ne=allocTexUnits(_,te);arraysEqual(K,ne)||(X.uniform1iv(this.addr,ne),copyArray(K,ne));for(let oe=0;oe!==te;++oe)_.setTexture2D(Z[oe]||emptyTexture,ne[oe])}function setValueT3DArray(X,Z,_){const K=this.cache,te=Z.length,ne=allocTexUnits(_,te);arraysEqual(K,ne)||(X.uniform1iv(this.addr,ne),copyArray(K,ne));for(let oe=0;oe!==te;++oe)_.setTexture3D(Z[oe]||empty3dTexture,ne[oe])}function setValueT6Array(X,Z,_){const K=this.cache,te=Z.length,ne=allocTexUnits(_,te);arraysEqual(K,ne)||(X.uniform1iv(this.addr,ne),copyArray(K,ne));for(let oe=0;oe!==te;++oe)_.setTextureCube(Z[oe]||emptyCubeTexture,ne[oe])}function setValueT2DArrayArray(X,Z,_){const K=this.cache,te=Z.length,ne=allocTexUnits(_,te);arraysEqual(K,ne)||(X.uniform1iv(this.addr,ne),copyArray(K,ne));for(let oe=0;oe!==te;++oe)_.setTexture2DArray(Z[oe]||emptyArrayTexture,ne[oe])}function getPureArraySetter(X){switch(X){case 5126:return setValueV1fArray;case 35664:return setValueV2fArray;case 35665:return setValueV3fArray;case 35666:return setValueV4fArray;case 35674:return setValueM2Array;case 35675:return setValueM3Array;case 35676:return setValueM4Array;case 5124:case 35670:return setValueV1iArray;case 35667:case 35671:return setValueV2iArray;case 35668:case 35672:return setValueV3iArray;case 35669:case 35673:return setValueV4iArray;case 5125:return setValueV1uiArray;case 36294:return setValueV2uiArray;case 36295:return setValueV3uiArray;case 36296:return setValueV4uiArray;case 35678:case 36198:case 36298:case 36306:case 35682:return setValueT1Array;case 35679:case 36299:case 36307:return setValueT3DArray;case 35680:case 36300:case 36308:case 36293:return setValueT6Array;case 36289:case 36303:case 36311:case 36292:return setValueT2DArrayArray}}class SingleUniform{constructor(Z,_,K){this.id=Z,this.addr=K,this.cache=[],this.setValue=getSingularSetter(_.type)}}class PureArrayUniform{constructor(Z,_,K){this.id=Z,this.addr=K,this.cache=[],this.size=_.size,this.setValue=getPureArraySetter(_.type)}}class StructuredUniform{constructor(Z){this.id=Z,this.seq=[],this.map={}}setValue(Z,_,K){const te=this.seq;for(let ne=0,oe=te.length;ne!==oe;++ne){const ie=te[ne];ie.setValue(Z,_[ie.id],K)}}}const RePathPart=/(\w+)(\])?(\[|\.)?/g;function addUniform(X,Z){X.seq.push(Z),X.map[Z.id]=Z}function parseUniform(X,Z,_){const K=X.name,te=K.length;for(RePathPart.lastIndex=0;;){const ne=RePathPart.exec(K),oe=RePathPart.lastIndex;let ie=ne[1];const se=ne[2]==="]",ae=ne[3];if(se&&(ie=ie|0),ae===void 0||ae==="["&&oe+2===te){addUniform(_,ae===void 0?new SingleUniform(ie,X,Z):new PureArrayUniform(ie,X,Z));break}else{let ce=_.map[ie];ce===void 0&&(ce=new StructuredUniform(ie),addUniform(_,ce)),_=ce}}}class WebGLUniforms{constructor(Z,_){this.seq=[],this.map={};const K=Z.getProgramParameter(_,Z.ACTIVE_UNIFORMS);for(let te=0;te<K;++te){const ne=Z.getActiveUniform(_,te),oe=Z.getUniformLocation(_,ne.name);parseUniform(ne,oe,this)}}setValue(Z,_,K,te){const ne=this.map[_];ne!==void 0&&ne.setValue(Z,K,te)}setOptional(Z,_,K){const te=_[K];te!==void 0&&this.setValue(Z,K,te)}static upload(Z,_,K,te){for(let ne=0,oe=_.length;ne!==oe;++ne){const ie=_[ne],se=K[ie.id];se.needsUpdate!==!1&&ie.setValue(Z,se.value,te)}}static seqWithValue(Z,_){const K=[];for(let te=0,ne=Z.length;te!==ne;++te){const oe=Z[te];oe.id in _&&K.push(oe)}return K}}function WebGLShader(X,Z,_){const K=X.createShader(Z);return X.shaderSource(K,_),X.compileShader(K),K}let programIdCount=0;function handleSource(X,Z){const _=X.split(`
`),K=[],te=Math.max(Z-6,0),ne=Math.min(Z+6,_.length);for(let oe=te;oe<ne;oe++){const ie=oe+1;K.push(`${ie===Z?">":" "} ${ie}: ${_[oe]}`)}return K.join(`
`)}function getEncodingComponents(X){switch(X){case LinearSRGBColorSpace$1:return["Linear","( value )"];case SRGBColorSpace$1:return["sRGB","( value )"];default:return console.warn("THREE.WebGLProgram: Unsupported color space:",X),["Linear","( value )"]}}function getShaderErrors(X,Z,_){const K=X.getShaderParameter(Z,X.COMPILE_STATUS),te=X.getShaderInfoLog(Z).trim();if(K&&te==="")return"";const ne=/ERROR: 0:(\d+)/.exec(te);if(ne){const oe=parseInt(ne[1]);return _.toUpperCase()+`

`+te+`

`+handleSource(X.getShaderSource(Z),oe)}else return te}function getTexelEncodingFunction(X,Z){const _=getEncodingComponents(Z);return"vec4 "+X+"( vec4 value ) { return LinearTo"+_[0]+_[1]+"; }"}function getToneMappingFunction(X,Z){let _;switch(Z){case LinearToneMapping:_="Linear";break;case ReinhardToneMapping:_="Reinhard";break;case CineonToneMapping:_="OptimizedCineon";break;case ACESFilmicToneMapping:_="ACESFilmic";break;case CustomToneMapping:_="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",Z),_="Linear"}return"vec3 "+X+"( vec3 color ) { return "+_+"ToneMapping( color ); }"}function generateExtensions(X){return[X.extensionDerivatives||X.envMapCubeUVHeight||X.bumpMap||X.normalMapTangentSpace||X.clearcoatNormalMap||X.flatShading||X.shaderID==="physical"?"#extension GL_OES_standard_derivatives : enable":"",(X.extensionFragDepth||X.logarithmicDepthBuffer)&&X.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",X.extensionDrawBuffers&&X.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(X.extensionShaderTextureLOD||X.envMap||X.transmission)&&X.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(filterEmptyLine).join(`
`)}function generateDefines(X){const Z=[];for(const _ in X){const K=X[_];K!==!1&&Z.push("#define "+_+" "+K)}return Z.join(`
`)}function fetchAttributeLocations(X,Z){const _={},K=X.getProgramParameter(Z,X.ACTIVE_ATTRIBUTES);for(let te=0;te<K;te++){const ne=X.getActiveAttrib(Z,te),oe=ne.name;let ie=1;ne.type===X.FLOAT_MAT2&&(ie=2),ne.type===X.FLOAT_MAT3&&(ie=3),ne.type===X.FLOAT_MAT4&&(ie=4),_[oe]={type:ne.type,location:X.getAttribLocation(Z,oe),locationSize:ie}}return _}function filterEmptyLine(X){return X!==""}function replaceLightNums(X,Z){const _=Z.numSpotLightShadows+Z.numSpotLightMaps-Z.numSpotLightShadowsWithMaps;return X.replace(/NUM_DIR_LIGHTS/g,Z.numDirLights).replace(/NUM_SPOT_LIGHTS/g,Z.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,Z.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,_).replace(/NUM_RECT_AREA_LIGHTS/g,Z.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,Z.numPointLights).replace(/NUM_HEMI_LIGHTS/g,Z.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,Z.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,Z.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,Z.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,Z.numPointLightShadows)}function replaceClippingPlaneNums(X,Z){return X.replace(/NUM_CLIPPING_PLANES/g,Z.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,Z.numClippingPlanes-Z.numClipIntersection)}const includePattern=/^[ \t]*#include +<([\w\d./]+)>/gm;function resolveIncludes(X){return X.replace(includePattern,includeReplacer)}const shaderChunkMap=new Map([["encodings_fragment","colorspace_fragment"],["encodings_pars_fragment","colorspace_pars_fragment"],["output_fragment","opaque_fragment"]]);function includeReplacer(X,Z){let _=ShaderChunk[Z];if(_===void 0){const K=shaderChunkMap.get(Z);if(K!==void 0)_=ShaderChunk[K],console.warn('THREE.WebGLRenderer: Shader chunk "%s" has been deprecated. Use "%s" instead.',Z,K);else throw new Error("Can not resolve #include <"+Z+">")}return resolveIncludes(_)}const unrollLoopPattern=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function unrollLoops(X){return X.replace(unrollLoopPattern,loopReplacer)}function loopReplacer(X,Z,_,K){let te="";for(let ne=parseInt(Z);ne<parseInt(_);ne++)te+=K.replace(/\[\s*i\s*\]/g,"[ "+ne+" ]").replace(/UNROLLED_LOOP_INDEX/g,ne);return te}function generatePrecision(X){let Z="precision "+X.precision+` float;
precision `+X.precision+" int;";return X.precision==="highp"?Z+=`
#define HIGH_PRECISION`:X.precision==="mediump"?Z+=`
#define MEDIUM_PRECISION`:X.precision==="lowp"&&(Z+=`
#define LOW_PRECISION`),Z}function generateShadowMapTypeDefine(X){let Z="SHADOWMAP_TYPE_BASIC";return X.shadowMapType===PCFShadowMap?Z="SHADOWMAP_TYPE_PCF":X.shadowMapType===PCFSoftShadowMap?Z="SHADOWMAP_TYPE_PCF_SOFT":X.shadowMapType===VSMShadowMap&&(Z="SHADOWMAP_TYPE_VSM"),Z}function generateEnvMapTypeDefine(X){let Z="ENVMAP_TYPE_CUBE";if(X.envMap)switch(X.envMapMode){case CubeReflectionMapping:case CubeRefractionMapping:Z="ENVMAP_TYPE_CUBE";break;case CubeUVReflectionMapping:Z="ENVMAP_TYPE_CUBE_UV";break}return Z}function generateEnvMapModeDefine(X){let Z="ENVMAP_MODE_REFLECTION";if(X.envMap)switch(X.envMapMode){case CubeRefractionMapping:Z="ENVMAP_MODE_REFRACTION";break}return Z}function generateEnvMapBlendingDefine(X){let Z="ENVMAP_BLENDING_NONE";if(X.envMap)switch(X.combine){case MultiplyOperation:Z="ENVMAP_BLENDING_MULTIPLY";break;case MixOperation:Z="ENVMAP_BLENDING_MIX";break;case AddOperation:Z="ENVMAP_BLENDING_ADD";break}return Z}function generateCubeUVSize(X){const Z=X.envMapCubeUVHeight;if(Z===null)return null;const _=Math.log2(Z)-2,K=1/Z;return{texelWidth:1/(3*Math.max(Math.pow(2,_),7*16)),texelHeight:K,maxMip:_}}function WebGLProgram(X,Z,_,K){const te=X.getContext(),ne=_.defines;let oe=_.vertexShader,ie=_.fragmentShader;const se=generateShadowMapTypeDefine(_),ae=generateEnvMapTypeDefine(_),ge=generateEnvMapModeDefine(_),ce=generateEnvMapBlendingDefine(_),de=generateCubeUVSize(_),pe=_.isWebGL2?"":generateExtensions(_),fe=generateDefines(ne),be=te.createProgram();let me,ye,ve=_.glslVersion?"#version "+_.glslVersion+`
`:"";_.isRawShaderMaterial?(me=["#define SHADER_TYPE "+_.shaderType,"#define SHADER_NAME "+_.shaderName,fe].filter(filterEmptyLine).join(`
`),me.length>0&&(me+=`
`),ye=[pe,"#define SHADER_TYPE "+_.shaderType,"#define SHADER_NAME "+_.shaderName,fe].filter(filterEmptyLine).join(`
`),ye.length>0&&(ye+=`
`)):(me=[generatePrecision(_),"#define SHADER_TYPE "+_.shaderType,"#define SHADER_NAME "+_.shaderName,fe,_.instancing?"#define USE_INSTANCING":"",_.instancingColor?"#define USE_INSTANCING_COLOR":"",_.useFog&&_.fog?"#define USE_FOG":"",_.useFog&&_.fogExp2?"#define FOG_EXP2":"",_.map?"#define USE_MAP":"",_.envMap?"#define USE_ENVMAP":"",_.envMap?"#define "+ge:"",_.lightMap?"#define USE_LIGHTMAP":"",_.aoMap?"#define USE_AOMAP":"",_.bumpMap?"#define USE_BUMPMAP":"",_.normalMap?"#define USE_NORMALMAP":"",_.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",_.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",_.displacementMap?"#define USE_DISPLACEMENTMAP":"",_.emissiveMap?"#define USE_EMISSIVEMAP":"",_.anisotropyMap?"#define USE_ANISOTROPYMAP":"",_.clearcoatMap?"#define USE_CLEARCOATMAP":"",_.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",_.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",_.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",_.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",_.specularMap?"#define USE_SPECULARMAP":"",_.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",_.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",_.roughnessMap?"#define USE_ROUGHNESSMAP":"",_.metalnessMap?"#define USE_METALNESSMAP":"",_.alphaMap?"#define USE_ALPHAMAP":"",_.alphaHash?"#define USE_ALPHAHASH":"",_.transmission?"#define USE_TRANSMISSION":"",_.transmissionMap?"#define USE_TRANSMISSIONMAP":"",_.thicknessMap?"#define USE_THICKNESSMAP":"",_.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",_.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",_.mapUv?"#define MAP_UV "+_.mapUv:"",_.alphaMapUv?"#define ALPHAMAP_UV "+_.alphaMapUv:"",_.lightMapUv?"#define LIGHTMAP_UV "+_.lightMapUv:"",_.aoMapUv?"#define AOMAP_UV "+_.aoMapUv:"",_.emissiveMapUv?"#define EMISSIVEMAP_UV "+_.emissiveMapUv:"",_.bumpMapUv?"#define BUMPMAP_UV "+_.bumpMapUv:"",_.normalMapUv?"#define NORMALMAP_UV "+_.normalMapUv:"",_.displacementMapUv?"#define DISPLACEMENTMAP_UV "+_.displacementMapUv:"",_.metalnessMapUv?"#define METALNESSMAP_UV "+_.metalnessMapUv:"",_.roughnessMapUv?"#define ROUGHNESSMAP_UV "+_.roughnessMapUv:"",_.anisotropyMapUv?"#define ANISOTROPYMAP_UV "+_.anisotropyMapUv:"",_.clearcoatMapUv?"#define CLEARCOATMAP_UV "+_.clearcoatMapUv:"",_.clearcoatNormalMapUv?"#define CLEARCOAT_NORMALMAP_UV "+_.clearcoatNormalMapUv:"",_.clearcoatRoughnessMapUv?"#define CLEARCOAT_ROUGHNESSMAP_UV "+_.clearcoatRoughnessMapUv:"",_.iridescenceMapUv?"#define IRIDESCENCEMAP_UV "+_.iridescenceMapUv:"",_.iridescenceThicknessMapUv?"#define IRIDESCENCE_THICKNESSMAP_UV "+_.iridescenceThicknessMapUv:"",_.sheenColorMapUv?"#define SHEEN_COLORMAP_UV "+_.sheenColorMapUv:"",_.sheenRoughnessMapUv?"#define SHEEN_ROUGHNESSMAP_UV "+_.sheenRoughnessMapUv:"",_.specularMapUv?"#define SPECULARMAP_UV "+_.specularMapUv:"",_.specularColorMapUv?"#define SPECULAR_COLORMAP_UV "+_.specularColorMapUv:"",_.specularIntensityMapUv?"#define SPECULAR_INTENSITYMAP_UV "+_.specularIntensityMapUv:"",_.transmissionMapUv?"#define TRANSMISSIONMAP_UV "+_.transmissionMapUv:"",_.thicknessMapUv?"#define THICKNESSMAP_UV "+_.thicknessMapUv:"",_.vertexTangents&&_.flatShading===!1?"#define USE_TANGENT":"",_.vertexColors?"#define USE_COLOR":"",_.vertexAlphas?"#define USE_COLOR_ALPHA":"",_.vertexUv1s?"#define USE_UV1":"",_.vertexUv2s?"#define USE_UV2":"",_.vertexUv3s?"#define USE_UV3":"",_.pointsUvs?"#define USE_POINTS_UV":"",_.flatShading?"#define FLAT_SHADED":"",_.skinning?"#define USE_SKINNING":"",_.morphTargets?"#define USE_MORPHTARGETS":"",_.morphNormals&&_.flatShading===!1?"#define USE_MORPHNORMALS":"",_.morphColors&&_.isWebGL2?"#define USE_MORPHCOLORS":"",_.morphTargetsCount>0&&_.isWebGL2?"#define MORPHTARGETS_TEXTURE":"",_.morphTargetsCount>0&&_.isWebGL2?"#define MORPHTARGETS_TEXTURE_STRIDE "+_.morphTextureStride:"",_.morphTargetsCount>0&&_.isWebGL2?"#define MORPHTARGETS_COUNT "+_.morphTargetsCount:"",_.doubleSided?"#define DOUBLE_SIDED":"",_.flipSided?"#define FLIP_SIDED":"",_.shadowMapEnabled?"#define USE_SHADOWMAP":"",_.shadowMapEnabled?"#define "+se:"",_.sizeAttenuation?"#define USE_SIZEATTENUATION":"",_.useLegacyLights?"#define LEGACY_LIGHTS":"",_.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",_.logarithmicDepthBuffer&&_.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","	attribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","	attribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_UV1","	attribute vec2 uv1;","#endif","#ifdef USE_UV2","	attribute vec2 uv2;","#endif","#ifdef USE_UV3","	attribute vec2 uv3;","#endif","#ifdef USE_TANGENT","	attribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","	attribute vec4 color;","#elif defined( USE_COLOR )","	attribute vec3 color;","#endif","#if ( defined( USE_MORPHTARGETS ) && ! defined( MORPHTARGETS_TEXTURE ) )","	attribute vec3 morphTarget0;","	attribute vec3 morphTarget1;","	attribute vec3 morphTarget2;","	attribute vec3 morphTarget3;","	#ifdef USE_MORPHNORMALS","		attribute vec3 morphNormal0;","		attribute vec3 morphNormal1;","		attribute vec3 morphNormal2;","		attribute vec3 morphNormal3;","	#else","		attribute vec3 morphTarget4;","		attribute vec3 morphTarget5;","		attribute vec3 morphTarget6;","		attribute vec3 morphTarget7;","	#endif","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif",`
`].filter(filterEmptyLine).join(`
`),ye=[pe,generatePrecision(_),"#define SHADER_TYPE "+_.shaderType,"#define SHADER_NAME "+_.shaderName,fe,_.useFog&&_.fog?"#define USE_FOG":"",_.useFog&&_.fogExp2?"#define FOG_EXP2":"",_.map?"#define USE_MAP":"",_.matcap?"#define USE_MATCAP":"",_.envMap?"#define USE_ENVMAP":"",_.envMap?"#define "+ae:"",_.envMap?"#define "+ge:"",_.envMap?"#define "+ce:"",de?"#define CUBEUV_TEXEL_WIDTH "+de.texelWidth:"",de?"#define CUBEUV_TEXEL_HEIGHT "+de.texelHeight:"",de?"#define CUBEUV_MAX_MIP "+de.maxMip+".0":"",_.lightMap?"#define USE_LIGHTMAP":"",_.aoMap?"#define USE_AOMAP":"",_.bumpMap?"#define USE_BUMPMAP":"",_.normalMap?"#define USE_NORMALMAP":"",_.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",_.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",_.emissiveMap?"#define USE_EMISSIVEMAP":"",_.anisotropy?"#define USE_ANISOTROPY":"",_.anisotropyMap?"#define USE_ANISOTROPYMAP":"",_.clearcoat?"#define USE_CLEARCOAT":"",_.clearcoatMap?"#define USE_CLEARCOATMAP":"",_.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",_.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",_.iridescence?"#define USE_IRIDESCENCE":"",_.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",_.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",_.specularMap?"#define USE_SPECULARMAP":"",_.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",_.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",_.roughnessMap?"#define USE_ROUGHNESSMAP":"",_.metalnessMap?"#define USE_METALNESSMAP":"",_.alphaMap?"#define USE_ALPHAMAP":"",_.alphaTest?"#define USE_ALPHATEST":"",_.alphaHash?"#define USE_ALPHAHASH":"",_.sheen?"#define USE_SHEEN":"",_.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",_.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",_.transmission?"#define USE_TRANSMISSION":"",_.transmissionMap?"#define USE_TRANSMISSIONMAP":"",_.thicknessMap?"#define USE_THICKNESSMAP":"",_.vertexTangents&&_.flatShading===!1?"#define USE_TANGENT":"",_.vertexColors||_.instancingColor?"#define USE_COLOR":"",_.vertexAlphas?"#define USE_COLOR_ALPHA":"",_.vertexUv1s?"#define USE_UV1":"",_.vertexUv2s?"#define USE_UV2":"",_.vertexUv3s?"#define USE_UV3":"",_.pointsUvs?"#define USE_POINTS_UV":"",_.gradientMap?"#define USE_GRADIENTMAP":"",_.flatShading?"#define FLAT_SHADED":"",_.doubleSided?"#define DOUBLE_SIDED":"",_.flipSided?"#define FLIP_SIDED":"",_.shadowMapEnabled?"#define USE_SHADOWMAP":"",_.shadowMapEnabled?"#define "+se:"",_.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",_.useLegacyLights?"#define LEGACY_LIGHTS":"",_.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",_.logarithmicDepthBuffer&&_.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",_.toneMapping!==NoToneMapping?"#define TONE_MAPPING":"",_.toneMapping!==NoToneMapping?ShaderChunk.tonemapping_pars_fragment:"",_.toneMapping!==NoToneMapping?getToneMappingFunction("toneMapping",_.toneMapping):"",_.dithering?"#define DITHERING":"",_.opaque?"#define OPAQUE":"",ShaderChunk.colorspace_pars_fragment,getTexelEncodingFunction("linearToOutputTexel",_.outputColorSpace),_.useDepthPacking?"#define DEPTH_PACKING "+_.depthPacking:"",`
`].filter(filterEmptyLine).join(`
`)),oe=resolveIncludes(oe),oe=replaceLightNums(oe,_),oe=replaceClippingPlaneNums(oe,_),ie=resolveIncludes(ie),ie=replaceLightNums(ie,_),ie=replaceClippingPlaneNums(ie,_),oe=unrollLoops(oe),ie=unrollLoops(ie),_.isWebGL2&&_.isRawShaderMaterial!==!0&&(ve=`#version 300 es
`,me=["precision mediump sampler2DArray;","#define attribute in","#define varying out","#define texture2D texture"].join(`
`)+`
`+me,ye=["#define varying in",_.glslVersion===GLSL3?"":"layout(location = 0) out highp vec4 pc_fragColor;",_.glslVersion===GLSL3?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join(`
`)+`
`+ye);const Be=ve+me+oe,Re=ve+ye+ie,Ee=WebGLShader(te,te.VERTEX_SHADER,Be),We=WebGLShader(te,te.FRAGMENT_SHADER,Re);if(te.attachShader(be,Ee),te.attachShader(be,We),_.index0AttributeName!==void 0?te.bindAttribLocation(be,0,_.index0AttributeName):_.morphTargets===!0&&te.bindAttribLocation(be,0,"position"),te.linkProgram(be),X.debug.checkShaderErrors){const _e=te.getProgramInfoLog(be).trim(),Xe=te.getShaderInfoLog(Ee).trim(),Pe=te.getShaderInfoLog(We).trim();let He=!0,Ke=!0;if(te.getProgramParameter(be,te.LINK_STATUS)===!1)if(He=!1,typeof X.debug.onShaderError=="function")X.debug.onShaderError(te,be,Ee,We);else{const Ue=getShaderErrors(te,Ee,"vertex"),tt=getShaderErrors(te,We,"fragment");console.error("THREE.WebGLProgram: Shader Error "+te.getError()+" - VALIDATE_STATUS "+te.getProgramParameter(be,te.VALIDATE_STATUS)+`

Program Info Log: `+_e+`
`+Ue+`
`+tt)}else _e!==""?console.warn("THREE.WebGLProgram: Program Info Log:",_e):(Xe===""||Pe==="")&&(Ke=!1);Ke&&(this.diagnostics={runnable:He,programLog:_e,vertexShader:{log:Xe,prefix:me},fragmentShader:{log:Pe,prefix:ye}})}te.deleteShader(Ee),te.deleteShader(We);let Ze;this.getUniforms=function(){return Ze===void 0&&(Ze=new WebGLUniforms(te,be)),Ze};let Ve;return this.getAttributes=function(){return Ve===void 0&&(Ve=fetchAttributeLocations(te,be)),Ve},this.destroy=function(){K.releaseStatesOfProgram(this),te.deleteProgram(be),this.program=void 0},this.type=_.shaderType,this.name=_.shaderName,this.id=programIdCount++,this.cacheKey=Z,this.usedTimes=1,this.program=be,this.vertexShader=Ee,this.fragmentShader=We,this}let _id=0;class WebGLShaderCache{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(Z){const _=Z.vertexShader,K=Z.fragmentShader,te=this._getShaderStage(_),ne=this._getShaderStage(K),oe=this._getShaderCacheForMaterial(Z);return oe.has(te)===!1&&(oe.add(te),te.usedTimes++),oe.has(ne)===!1&&(oe.add(ne),ne.usedTimes++),this}remove(Z){const _=this.materialCache.get(Z);for(const K of _)K.usedTimes--,K.usedTimes===0&&this.shaderCache.delete(K.code);return this.materialCache.delete(Z),this}getVertexShaderID(Z){return this._getShaderStage(Z.vertexShader).id}getFragmentShaderID(Z){return this._getShaderStage(Z.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(Z){const _=this.materialCache;let K=_.get(Z);return K===void 0&&(K=new Set,_.set(Z,K)),K}_getShaderStage(Z){const _=this.shaderCache;let K=_.get(Z);return K===void 0&&(K=new WebGLShaderStage(Z),_.set(Z,K)),K}}class WebGLShaderStage{constructor(Z){this.id=_id++,this.code=Z,this.usedTimes=0}}function WebGLPrograms(X,Z,_,K,te,ne,oe){const ie=new Layers,se=new WebGLShaderCache,ae=[],ge=te.isWebGL2,ce=te.logarithmicDepthBuffer,de=te.vertexTextures;let pe=te.precision;const fe={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function be(_e){return _e===0?"uv":`uv${_e}`}function me(_e,Xe,Pe,He,Ke){const Ue=He.fog,tt=Ke.geometry,rt=_e.isMeshStandardMaterial?He.environment:null,at=(_e.isMeshStandardMaterial?_:Z).get(_e.envMap||rt),Oe=at&&at.mapping===CubeUVReflectionMapping?at.image.height:null,$e=fe[_e.type];_e.precision!==null&&(pe=te.getMaxPrecision(_e.precision),pe!==_e.precision&&console.warn("THREE.WebGLProgram.getParameters:",_e.precision,"not supported, using",pe,"instead."));const je=tt.morphAttributes.position||tt.morphAttributes.normal||tt.morphAttributes.color,Te=je!==void 0?je.length:0;let De=0;tt.morphAttributes.position!==void 0&&(De=1),tt.morphAttributes.normal!==void 0&&(De=2),tt.morphAttributes.color!==void 0&&(De=3);let ot,ct,gt,pt;if($e){const Tn=ShaderLib[$e];ot=Tn.vertexShader,ct=Tn.fragmentShader}else ot=_e.vertexShader,ct=_e.fragmentShader,se.update(_e),gt=se.getVertexShaderID(_e),pt=se.getFragmentShaderID(_e);const ht=X.getRenderTarget(),At=Ke.isInstancedMesh===!0,Kt=!!_e.map,en=!!_e.matcap,Zt=!!at,st=!!_e.aoMap,Vt=!!_e.lightMap,wt=!!_e.bumpMap,St=!!_e.normalMap,Rt=!!_e.displacementMap,jt=!!_e.emissiveMap,Wt=!!_e.metalnessMap,Ht=!!_e.roughnessMap,Pt=_e.anisotropy>0,Mt=_e.clearcoat>0,un=_e.iridescence>0,qe=_e.sheen>0,Je=_e.transmission>0,mt=Pt&&!!_e.anisotropyMap,Dt=Mt&&!!_e.clearcoatMap,_t=Mt&&!!_e.clearcoatNormalMap,zt=Mt&&!!_e.clearcoatRoughnessMap,nn=un&&!!_e.iridescenceMap,tn=un&&!!_e.iridescenceThicknessMap,Ft=qe&&!!_e.sheenColorMap,pn=qe&&!!_e.sheenRoughnessMap,sn=!!_e.specularMap,rn=!!_e.specularColorMap,$t=!!_e.specularIntensityMap,on=Je&&!!_e.transmissionMap,An=Je&&!!_e.thicknessMap,wn=!!_e.gradientMap,ft=!!_e.alphaMap,vt=_e.alphaTest>0,Et=!!_e.alphaHash,gn=!!_e.extensions,an=!!tt.attributes.uv1,vn=!!tt.attributes.uv2,zn=!!tt.attributes.uv3;return{isWebGL2:ge,shaderID:$e,shaderType:_e.type,shaderName:_e.name,vertexShader:ot,fragmentShader:ct,defines:_e.defines,customVertexShaderID:gt,customFragmentShaderID:pt,isRawShaderMaterial:_e.isRawShaderMaterial===!0,glslVersion:_e.glslVersion,precision:pe,instancing:At,instancingColor:At&&Ke.instanceColor!==null,supportsVertexTextures:de,outputColorSpace:ht===null?X.outputColorSpace:ht.isXRRenderTarget===!0?ht.texture.colorSpace:LinearSRGBColorSpace$1,map:Kt,matcap:en,envMap:Zt,envMapMode:Zt&&at.mapping,envMapCubeUVHeight:Oe,aoMap:st,lightMap:Vt,bumpMap:wt,normalMap:St,displacementMap:de&&Rt,emissiveMap:jt,normalMapObjectSpace:St&&_e.normalMapType===ObjectSpaceNormalMap,normalMapTangentSpace:St&&_e.normalMapType===TangentSpaceNormalMap,metalnessMap:Wt,roughnessMap:Ht,anisotropy:Pt,anisotropyMap:mt,clearcoat:Mt,clearcoatMap:Dt,clearcoatNormalMap:_t,clearcoatRoughnessMap:zt,iridescence:un,iridescenceMap:nn,iridescenceThicknessMap:tn,sheen:qe,sheenColorMap:Ft,sheenRoughnessMap:pn,specularMap:sn,specularColorMap:rn,specularIntensityMap:$t,transmission:Je,transmissionMap:on,thicknessMap:An,gradientMap:wn,opaque:_e.transparent===!1&&_e.blending===NormalBlending,alphaMap:ft,alphaTest:vt,alphaHash:Et,combine:_e.combine,mapUv:Kt&&be(_e.map.channel),aoMapUv:st&&be(_e.aoMap.channel),lightMapUv:Vt&&be(_e.lightMap.channel),bumpMapUv:wt&&be(_e.bumpMap.channel),normalMapUv:St&&be(_e.normalMap.channel),displacementMapUv:Rt&&be(_e.displacementMap.channel),emissiveMapUv:jt&&be(_e.emissiveMap.channel),metalnessMapUv:Wt&&be(_e.metalnessMap.channel),roughnessMapUv:Ht&&be(_e.roughnessMap.channel),anisotropyMapUv:mt&&be(_e.anisotropyMap.channel),clearcoatMapUv:Dt&&be(_e.clearcoatMap.channel),clearcoatNormalMapUv:_t&&be(_e.clearcoatNormalMap.channel),clearcoatRoughnessMapUv:zt&&be(_e.clearcoatRoughnessMap.channel),iridescenceMapUv:nn&&be(_e.iridescenceMap.channel),iridescenceThicknessMapUv:tn&&be(_e.iridescenceThicknessMap.channel),sheenColorMapUv:Ft&&be(_e.sheenColorMap.channel),sheenRoughnessMapUv:pn&&be(_e.sheenRoughnessMap.channel),specularMapUv:sn&&be(_e.specularMap.channel),specularColorMapUv:rn&&be(_e.specularColorMap.channel),specularIntensityMapUv:$t&&be(_e.specularIntensityMap.channel),transmissionMapUv:on&&be(_e.transmissionMap.channel),thicknessMapUv:An&&be(_e.thicknessMap.channel),alphaMapUv:ft&&be(_e.alphaMap.channel),vertexTangents:!!tt.attributes.tangent&&(St||Pt),vertexColors:_e.vertexColors,vertexAlphas:_e.vertexColors===!0&&!!tt.attributes.color&&tt.attributes.color.itemSize===4,vertexUv1s:an,vertexUv2s:vn,vertexUv3s:zn,pointsUvs:Ke.isPoints===!0&&!!tt.attributes.uv&&(Kt||ft),fog:!!Ue,useFog:_e.fog===!0,fogExp2:Ue&&Ue.isFogExp2,flatShading:_e.flatShading===!0,sizeAttenuation:_e.sizeAttenuation===!0,logarithmicDepthBuffer:ce,skinning:Ke.isSkinnedMesh===!0,morphTargets:tt.morphAttributes.position!==void 0,morphNormals:tt.morphAttributes.normal!==void 0,morphColors:tt.morphAttributes.color!==void 0,morphTargetsCount:Te,morphTextureStride:De,numDirLights:Xe.directional.length,numPointLights:Xe.point.length,numSpotLights:Xe.spot.length,numSpotLightMaps:Xe.spotLightMap.length,numRectAreaLights:Xe.rectArea.length,numHemiLights:Xe.hemi.length,numDirLightShadows:Xe.directionalShadowMap.length,numPointLightShadows:Xe.pointShadowMap.length,numSpotLightShadows:Xe.spotShadowMap.length,numSpotLightShadowsWithMaps:Xe.numSpotLightShadowsWithMaps,numClippingPlanes:oe.numPlanes,numClipIntersection:oe.numIntersection,dithering:_e.dithering,shadowMapEnabled:X.shadowMap.enabled&&Pe.length>0,shadowMapType:X.shadowMap.type,toneMapping:_e.toneMapped?X.toneMapping:NoToneMapping,useLegacyLights:X.useLegacyLights,premultipliedAlpha:_e.premultipliedAlpha,doubleSided:_e.side===DoubleSide,flipSided:_e.side===BackSide,useDepthPacking:_e.depthPacking>=0,depthPacking:_e.depthPacking||0,index0AttributeName:_e.index0AttributeName,extensionDerivatives:gn&&_e.extensions.derivatives===!0,extensionFragDepth:gn&&_e.extensions.fragDepth===!0,extensionDrawBuffers:gn&&_e.extensions.drawBuffers===!0,extensionShaderTextureLOD:gn&&_e.extensions.shaderTextureLOD===!0,rendererExtensionFragDepth:ge||K.has("EXT_frag_depth"),rendererExtensionDrawBuffers:ge||K.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:ge||K.has("EXT_shader_texture_lod"),customProgramCacheKey:_e.customProgramCacheKey()}}function ye(_e){const Xe=[];if(_e.shaderID?Xe.push(_e.shaderID):(Xe.push(_e.customVertexShaderID),Xe.push(_e.customFragmentShaderID)),_e.defines!==void 0)for(const Pe in _e.defines)Xe.push(Pe),Xe.push(_e.defines[Pe]);return _e.isRawShaderMaterial===!1&&(ve(Xe,_e),Be(Xe,_e),Xe.push(X.outputColorSpace)),Xe.push(_e.customProgramCacheKey),Xe.join()}function ve(_e,Xe){_e.push(Xe.precision),_e.push(Xe.outputColorSpace),_e.push(Xe.envMapMode),_e.push(Xe.envMapCubeUVHeight),_e.push(Xe.mapUv),_e.push(Xe.alphaMapUv),_e.push(Xe.lightMapUv),_e.push(Xe.aoMapUv),_e.push(Xe.bumpMapUv),_e.push(Xe.normalMapUv),_e.push(Xe.displacementMapUv),_e.push(Xe.emissiveMapUv),_e.push(Xe.metalnessMapUv),_e.push(Xe.roughnessMapUv),_e.push(Xe.anisotropyMapUv),_e.push(Xe.clearcoatMapUv),_e.push(Xe.clearcoatNormalMapUv),_e.push(Xe.clearcoatRoughnessMapUv),_e.push(Xe.iridescenceMapUv),_e.push(Xe.iridescenceThicknessMapUv),_e.push(Xe.sheenColorMapUv),_e.push(Xe.sheenRoughnessMapUv),_e.push(Xe.specularMapUv),_e.push(Xe.specularColorMapUv),_e.push(Xe.specularIntensityMapUv),_e.push(Xe.transmissionMapUv),_e.push(Xe.thicknessMapUv),_e.push(Xe.combine),_e.push(Xe.fogExp2),_e.push(Xe.sizeAttenuation),_e.push(Xe.morphTargetsCount),_e.push(Xe.morphAttributeCount),_e.push(Xe.numDirLights),_e.push(Xe.numPointLights),_e.push(Xe.numSpotLights),_e.push(Xe.numSpotLightMaps),_e.push(Xe.numHemiLights),_e.push(Xe.numRectAreaLights),_e.push(Xe.numDirLightShadows),_e.push(Xe.numPointLightShadows),_e.push(Xe.numSpotLightShadows),_e.push(Xe.numSpotLightShadowsWithMaps),_e.push(Xe.shadowMapType),_e.push(Xe.toneMapping),_e.push(Xe.numClippingPlanes),_e.push(Xe.numClipIntersection),_e.push(Xe.depthPacking)}function Be(_e,Xe){ie.disableAll(),Xe.isWebGL2&&ie.enable(0),Xe.supportsVertexTextures&&ie.enable(1),Xe.instancing&&ie.enable(2),Xe.instancingColor&&ie.enable(3),Xe.matcap&&ie.enable(4),Xe.envMap&&ie.enable(5),Xe.normalMapObjectSpace&&ie.enable(6),Xe.normalMapTangentSpace&&ie.enable(7),Xe.clearcoat&&ie.enable(8),Xe.iridescence&&ie.enable(9),Xe.alphaTest&&ie.enable(10),Xe.vertexColors&&ie.enable(11),Xe.vertexAlphas&&ie.enable(12),Xe.vertexUv1s&&ie.enable(13),Xe.vertexUv2s&&ie.enable(14),Xe.vertexUv3s&&ie.enable(15),Xe.vertexTangents&&ie.enable(16),Xe.anisotropy&&ie.enable(17),_e.push(ie.mask),ie.disableAll(),Xe.fog&&ie.enable(0),Xe.useFog&&ie.enable(1),Xe.flatShading&&ie.enable(2),Xe.logarithmicDepthBuffer&&ie.enable(3),Xe.skinning&&ie.enable(4),Xe.morphTargets&&ie.enable(5),Xe.morphNormals&&ie.enable(6),Xe.morphColors&&ie.enable(7),Xe.premultipliedAlpha&&ie.enable(8),Xe.shadowMapEnabled&&ie.enable(9),Xe.useLegacyLights&&ie.enable(10),Xe.doubleSided&&ie.enable(11),Xe.flipSided&&ie.enable(12),Xe.useDepthPacking&&ie.enable(13),Xe.dithering&&ie.enable(14),Xe.transmission&&ie.enable(15),Xe.sheen&&ie.enable(16),Xe.opaque&&ie.enable(17),Xe.pointsUvs&&ie.enable(18),_e.push(ie.mask)}function Re(_e){const Xe=fe[_e.type];let Pe;if(Xe){const He=ShaderLib[Xe];Pe=UniformsUtils.clone(He.uniforms)}else Pe=_e.uniforms;return Pe}function Ee(_e,Xe){let Pe;for(let He=0,Ke=ae.length;He<Ke;He++){const Ue=ae[He];if(Ue.cacheKey===Xe){Pe=Ue,++Pe.usedTimes;break}}return Pe===void 0&&(Pe=new WebGLProgram(X,Xe,_e,ne),ae.push(Pe)),Pe}function We(_e){if(--_e.usedTimes===0){const Xe=ae.indexOf(_e);ae[Xe]=ae[ae.length-1],ae.pop(),_e.destroy()}}function Ze(_e){se.remove(_e)}function Ve(){se.dispose()}return{getParameters:me,getProgramCacheKey:ye,getUniforms:Re,acquireProgram:Ee,releaseProgram:We,releaseShaderCache:Ze,programs:ae,dispose:Ve}}function WebGLProperties(){let X=new WeakMap;function Z(ne){let oe=X.get(ne);return oe===void 0&&(oe={},X.set(ne,oe)),oe}function _(ne){X.delete(ne)}function K(ne,oe,ie){X.get(ne)[oe]=ie}function te(){X=new WeakMap}return{get:Z,remove:_,update:K,dispose:te}}function painterSortStable(X,Z){return X.groupOrder!==Z.groupOrder?X.groupOrder-Z.groupOrder:X.renderOrder!==Z.renderOrder?X.renderOrder-Z.renderOrder:X.material.id!==Z.material.id?X.material.id-Z.material.id:X.z!==Z.z?X.z-Z.z:X.id-Z.id}function reversePainterSortStable(X,Z){return X.groupOrder!==Z.groupOrder?X.groupOrder-Z.groupOrder:X.renderOrder!==Z.renderOrder?X.renderOrder-Z.renderOrder:X.z!==Z.z?Z.z-X.z:X.id-Z.id}function WebGLRenderList(){const X=[];let Z=0;const _=[],K=[],te=[];function ne(){Z=0,_.length=0,K.length=0,te.length=0}function oe(ce,de,pe,fe,be,me){let ye=X[Z];return ye===void 0?(ye={id:ce.id,object:ce,geometry:de,material:pe,groupOrder:fe,renderOrder:ce.renderOrder,z:be,group:me},X[Z]=ye):(ye.id=ce.id,ye.object=ce,ye.geometry=de,ye.material=pe,ye.groupOrder=fe,ye.renderOrder=ce.renderOrder,ye.z=be,ye.group=me),Z++,ye}function ie(ce,de,pe,fe,be,me){const ye=oe(ce,de,pe,fe,be,me);pe.transmission>0?K.push(ye):pe.transparent===!0?te.push(ye):_.push(ye)}function se(ce,de,pe,fe,be,me){const ye=oe(ce,de,pe,fe,be,me);pe.transmission>0?K.unshift(ye):pe.transparent===!0?te.unshift(ye):_.unshift(ye)}function ae(ce,de){_.length>1&&_.sort(ce||painterSortStable),K.length>1&&K.sort(de||reversePainterSortStable),te.length>1&&te.sort(de||reversePainterSortStable)}function ge(){for(let ce=Z,de=X.length;ce<de;ce++){const pe=X[ce];if(pe.id===null)break;pe.id=null,pe.object=null,pe.geometry=null,pe.material=null,pe.group=null}}return{opaque:_,transmissive:K,transparent:te,init:ne,push:ie,unshift:se,finish:ge,sort:ae}}function WebGLRenderLists(){let X=new WeakMap;function Z(K,te){const ne=X.get(K);let oe;return ne===void 0?(oe=new WebGLRenderList,X.set(K,[oe])):te>=ne.length?(oe=new WebGLRenderList,ne.push(oe)):oe=ne[te],oe}function _(){X=new WeakMap}return{get:Z,dispose:_}}function UniformsCache(){const X={};return{get:function(Z){if(X[Z.id]!==void 0)return X[Z.id];let _;switch(Z.type){case"DirectionalLight":_={direction:new Vector3,color:new Color$1};break;case"SpotLight":_={position:new Vector3,direction:new Vector3,color:new Color$1,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":_={position:new Vector3,color:new Color$1,distance:0,decay:0};break;case"HemisphereLight":_={direction:new Vector3,skyColor:new Color$1,groundColor:new Color$1};break;case"RectAreaLight":_={color:new Color$1,position:new Vector3,halfWidth:new Vector3,halfHeight:new Vector3};break}return X[Z.id]=_,_}}}function ShadowUniformsCache(){const X={};return{get:function(Z){if(X[Z.id]!==void 0)return X[Z.id];let _;switch(Z.type){case"DirectionalLight":_={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Vector2};break;case"SpotLight":_={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Vector2};break;case"PointLight":_={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Vector2,shadowCameraNear:1,shadowCameraFar:1e3};break}return X[Z.id]=_,_}}}let nextVersion=0;function shadowCastingAndTexturingLightsFirst(X,Z){return(Z.castShadow?2:0)-(X.castShadow?2:0)+(Z.map?1:0)-(X.map?1:0)}function WebGLLights(X,Z){const _=new UniformsCache,K=ShadowUniformsCache(),te={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0};for(let ge=0;ge<9;ge++)te.probe.push(new Vector3);const ne=new Vector3,oe=new Matrix4,ie=new Matrix4;function se(ge,ce){let de=0,pe=0,fe=0;for(let Pe=0;Pe<9;Pe++)te.probe[Pe].set(0,0,0);let be=0,me=0,ye=0,ve=0,Be=0,Re=0,Ee=0,We=0,Ze=0,Ve=0;ge.sort(shadowCastingAndTexturingLightsFirst);const _e=ce===!0?Math.PI:1;for(let Pe=0,He=ge.length;Pe<He;Pe++){const Ke=ge[Pe],Ue=Ke.color,tt=Ke.intensity,rt=Ke.distance,at=Ke.shadow&&Ke.shadow.map?Ke.shadow.map.texture:null;if(Ke.isAmbientLight)de+=Ue.r*tt*_e,pe+=Ue.g*tt*_e,fe+=Ue.b*tt*_e;else if(Ke.isLightProbe)for(let Oe=0;Oe<9;Oe++)te.probe[Oe].addScaledVector(Ke.sh.coefficients[Oe],tt);else if(Ke.isDirectionalLight){const Oe=_.get(Ke);if(Oe.color.copy(Ke.color).multiplyScalar(Ke.intensity*_e),Ke.castShadow){const $e=Ke.shadow,je=K.get(Ke);je.shadowBias=$e.bias,je.shadowNormalBias=$e.normalBias,je.shadowRadius=$e.radius,je.shadowMapSize=$e.mapSize,te.directionalShadow[be]=je,te.directionalShadowMap[be]=at,te.directionalShadowMatrix[be]=Ke.shadow.matrix,Re++}te.directional[be]=Oe,be++}else if(Ke.isSpotLight){const Oe=_.get(Ke);Oe.position.setFromMatrixPosition(Ke.matrixWorld),Oe.color.copy(Ue).multiplyScalar(tt*_e),Oe.distance=rt,Oe.coneCos=Math.cos(Ke.angle),Oe.penumbraCos=Math.cos(Ke.angle*(1-Ke.penumbra)),Oe.decay=Ke.decay,te.spot[ye]=Oe;const $e=Ke.shadow;if(Ke.map&&(te.spotLightMap[Ze]=Ke.map,Ze++,$e.updateMatrices(Ke),Ke.castShadow&&Ve++),te.spotLightMatrix[ye]=$e.matrix,Ke.castShadow){const je=K.get(Ke);je.shadowBias=$e.bias,je.shadowNormalBias=$e.normalBias,je.shadowRadius=$e.radius,je.shadowMapSize=$e.mapSize,te.spotShadow[ye]=je,te.spotShadowMap[ye]=at,We++}ye++}else if(Ke.isRectAreaLight){const Oe=_.get(Ke);Oe.color.copy(Ue).multiplyScalar(tt),Oe.halfWidth.set(Ke.width*.5,0,0),Oe.halfHeight.set(0,Ke.height*.5,0),te.rectArea[ve]=Oe,ve++}else if(Ke.isPointLight){const Oe=_.get(Ke);if(Oe.color.copy(Ke.color).multiplyScalar(Ke.intensity*_e),Oe.distance=Ke.distance,Oe.decay=Ke.decay,Ke.castShadow){const $e=Ke.shadow,je=K.get(Ke);je.shadowBias=$e.bias,je.shadowNormalBias=$e.normalBias,je.shadowRadius=$e.radius,je.shadowMapSize=$e.mapSize,je.shadowCameraNear=$e.camera.near,je.shadowCameraFar=$e.camera.far,te.pointShadow[me]=je,te.pointShadowMap[me]=at,te.pointShadowMatrix[me]=Ke.shadow.matrix,Ee++}te.point[me]=Oe,me++}else if(Ke.isHemisphereLight){const Oe=_.get(Ke);Oe.skyColor.copy(Ke.color).multiplyScalar(tt*_e),Oe.groundColor.copy(Ke.groundColor).multiplyScalar(tt*_e),te.hemi[Be]=Oe,Be++}}ve>0&&(Z.isWebGL2||X.has("OES_texture_float_linear")===!0?(te.rectAreaLTC1=UniformsLib.LTC_FLOAT_1,te.rectAreaLTC2=UniformsLib.LTC_FLOAT_2):X.has("OES_texture_half_float_linear")===!0?(te.rectAreaLTC1=UniformsLib.LTC_HALF_1,te.rectAreaLTC2=UniformsLib.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),te.ambient[0]=de,te.ambient[1]=pe,te.ambient[2]=fe;const Xe=te.hash;(Xe.directionalLength!==be||Xe.pointLength!==me||Xe.spotLength!==ye||Xe.rectAreaLength!==ve||Xe.hemiLength!==Be||Xe.numDirectionalShadows!==Re||Xe.numPointShadows!==Ee||Xe.numSpotShadows!==We||Xe.numSpotMaps!==Ze)&&(te.directional.length=be,te.spot.length=ye,te.rectArea.length=ve,te.point.length=me,te.hemi.length=Be,te.directionalShadow.length=Re,te.directionalShadowMap.length=Re,te.pointShadow.length=Ee,te.pointShadowMap.length=Ee,te.spotShadow.length=We,te.spotShadowMap.length=We,te.directionalShadowMatrix.length=Re,te.pointShadowMatrix.length=Ee,te.spotLightMatrix.length=We+Ze-Ve,te.spotLightMap.length=Ze,te.numSpotLightShadowsWithMaps=Ve,Xe.directionalLength=be,Xe.pointLength=me,Xe.spotLength=ye,Xe.rectAreaLength=ve,Xe.hemiLength=Be,Xe.numDirectionalShadows=Re,Xe.numPointShadows=Ee,Xe.numSpotShadows=We,Xe.numSpotMaps=Ze,te.version=nextVersion++)}function ae(ge,ce){let de=0,pe=0,fe=0,be=0,me=0;const ye=ce.matrixWorldInverse;for(let ve=0,Be=ge.length;ve<Be;ve++){const Re=ge[ve];if(Re.isDirectionalLight){const Ee=te.directional[de];Ee.direction.setFromMatrixPosition(Re.matrixWorld),ne.setFromMatrixPosition(Re.target.matrixWorld),Ee.direction.sub(ne),Ee.direction.transformDirection(ye),de++}else if(Re.isSpotLight){const Ee=te.spot[fe];Ee.position.setFromMatrixPosition(Re.matrixWorld),Ee.position.applyMatrix4(ye),Ee.direction.setFromMatrixPosition(Re.matrixWorld),ne.setFromMatrixPosition(Re.target.matrixWorld),Ee.direction.sub(ne),Ee.direction.transformDirection(ye),fe++}else if(Re.isRectAreaLight){const Ee=te.rectArea[be];Ee.position.setFromMatrixPosition(Re.matrixWorld),Ee.position.applyMatrix4(ye),ie.identity(),oe.copy(Re.matrixWorld),oe.premultiply(ye),ie.extractRotation(oe),Ee.halfWidth.set(Re.width*.5,0,0),Ee.halfHeight.set(0,Re.height*.5,0),Ee.halfWidth.applyMatrix4(ie),Ee.halfHeight.applyMatrix4(ie),be++}else if(Re.isPointLight){const Ee=te.point[pe];Ee.position.setFromMatrixPosition(Re.matrixWorld),Ee.position.applyMatrix4(ye),pe++}else if(Re.isHemisphereLight){const Ee=te.hemi[me];Ee.direction.setFromMatrixPosition(Re.matrixWorld),Ee.direction.transformDirection(ye),me++}}}return{setup:se,setupView:ae,state:te}}function WebGLRenderState(X,Z){const _=new WebGLLights(X,Z),K=[],te=[];function ne(){K.length=0,te.length=0}function oe(ce){K.push(ce)}function ie(ce){te.push(ce)}function se(ce){_.setup(K,ce)}function ae(ce){_.setupView(K,ce)}return{init:ne,state:{lightsArray:K,shadowsArray:te,lights:_},setupLights:se,setupLightsView:ae,pushLight:oe,pushShadow:ie}}function WebGLRenderStates(X,Z){let _=new WeakMap;function K(ne,oe=0){const ie=_.get(ne);let se;return ie===void 0?(se=new WebGLRenderState(X,Z),_.set(ne,[se])):oe>=ie.length?(se=new WebGLRenderState(X,Z),ie.push(se)):se=ie[oe],se}function te(){_=new WeakMap}return{get:K,dispose:te}}class MeshDepthMaterial extends Material{constructor(Z){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=BasicDepthPacking,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(Z)}copy(Z){return super.copy(Z),this.depthPacking=Z.depthPacking,this.map=Z.map,this.alphaMap=Z.alphaMap,this.displacementMap=Z.displacementMap,this.displacementScale=Z.displacementScale,this.displacementBias=Z.displacementBias,this.wireframe=Z.wireframe,this.wireframeLinewidth=Z.wireframeLinewidth,this}}class MeshDistanceMaterial extends Material{constructor(Z){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(Z)}copy(Z){return super.copy(Z),this.map=Z.map,this.alphaMap=Z.alphaMap,this.displacementMap=Z.displacementMap,this.displacementScale=Z.displacementScale,this.displacementBias=Z.displacementBias,this}}const vertex=`void main() {
	gl_Position = vec4( position, 1.0 );
}`,fragment=`uniform sampler2D shadow_pass;
uniform vec2 resolution;
uniform float radius;
#include <packing>
void main() {
	const float samples = float( VSM_SAMPLES );
	float mean = 0.0;
	float squared_mean = 0.0;
	float uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );
	float uvStart = samples <= 1.0 ? 0.0 : - 1.0;
	for ( float i = 0.0; i < samples; i ++ ) {
		float uvOffset = uvStart + i * uvStride;
		#ifdef HORIZONTAL_PASS
			vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );
			mean += distribution.x;
			squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;
		#else
			float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );
			mean += depth;
			squared_mean += depth * depth;
		#endif
	}
	mean = mean / samples;
	squared_mean = squared_mean / samples;
	float std_dev = sqrt( squared_mean - mean * mean );
	gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );
}`;function WebGLShadowMap(X,Z,_){let K=new Frustum;const te=new Vector2,ne=new Vector2,oe=new Vector4,ie=new MeshDepthMaterial({depthPacking:RGBADepthPacking}),se=new MeshDistanceMaterial,ae={},ge=_.maxTextureSize,ce={[FrontSide]:BackSide,[BackSide]:FrontSide,[DoubleSide]:DoubleSide},de=new ShaderMaterial({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new Vector2},radius:{value:4}},vertexShader:vertex,fragmentShader:fragment}),pe=de.clone();pe.defines.HORIZONTAL_PASS=1;const fe=new BufferGeometry;fe.setAttribute("position",new BufferAttribute(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const be=new Mesh(fe,de),me=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=PCFShadowMap;let ye=this.type;this.render=function(Ee,We,Ze){if(me.enabled===!1||me.autoUpdate===!1&&me.needsUpdate===!1||Ee.length===0)return;const Ve=X.getRenderTarget(),_e=X.getActiveCubeFace(),Xe=X.getActiveMipmapLevel(),Pe=X.state;Pe.setBlending(NoBlending),Pe.buffers.color.setClear(1,1,1,1),Pe.buffers.depth.setTest(!0),Pe.setScissorTest(!1);const He=ye!==VSMShadowMap&&this.type===VSMShadowMap,Ke=ye===VSMShadowMap&&this.type!==VSMShadowMap;for(let Ue=0,tt=Ee.length;Ue<tt;Ue++){const rt=Ee[Ue],at=rt.shadow;if(at===void 0){console.warn("THREE.WebGLShadowMap:",rt,"has no shadow.");continue}if(at.autoUpdate===!1&&at.needsUpdate===!1)continue;te.copy(at.mapSize);const Oe=at.getFrameExtents();if(te.multiply(Oe),ne.copy(at.mapSize),(te.x>ge||te.y>ge)&&(te.x>ge&&(ne.x=Math.floor(ge/Oe.x),te.x=ne.x*Oe.x,at.mapSize.x=ne.x),te.y>ge&&(ne.y=Math.floor(ge/Oe.y),te.y=ne.y*Oe.y,at.mapSize.y=ne.y)),at.map===null||He===!0||Ke===!0){const je=this.type!==VSMShadowMap?{minFilter:NearestFilter,magFilter:NearestFilter}:{};at.map!==null&&at.map.dispose(),at.map=new WebGLRenderTarget(te.x,te.y,je),at.map.texture.name=rt.name+".shadowMap",at.camera.updateProjectionMatrix()}X.setRenderTarget(at.map),X.clear();const $e=at.getViewportCount();for(let je=0;je<$e;je++){const Te=at.getViewport(je);oe.set(ne.x*Te.x,ne.y*Te.y,ne.x*Te.z,ne.y*Te.w),Pe.viewport(oe),at.updateMatrices(rt,je),K=at.getFrustum(),Re(We,Ze,at.camera,rt,this.type)}at.isPointLightShadow!==!0&&this.type===VSMShadowMap&&ve(at,Ze),at.needsUpdate=!1}ye=this.type,me.needsUpdate=!1,X.setRenderTarget(Ve,_e,Xe)};function ve(Ee,We){const Ze=Z.update(be);de.defines.VSM_SAMPLES!==Ee.blurSamples&&(de.defines.VSM_SAMPLES=Ee.blurSamples,pe.defines.VSM_SAMPLES=Ee.blurSamples,de.needsUpdate=!0,pe.needsUpdate=!0),Ee.mapPass===null&&(Ee.mapPass=new WebGLRenderTarget(te.x,te.y)),de.uniforms.shadow_pass.value=Ee.map.texture,de.uniforms.resolution.value=Ee.mapSize,de.uniforms.radius.value=Ee.radius,X.setRenderTarget(Ee.mapPass),X.clear(),X.renderBufferDirect(We,null,Ze,de,be,null),pe.uniforms.shadow_pass.value=Ee.mapPass.texture,pe.uniforms.resolution.value=Ee.mapSize,pe.uniforms.radius.value=Ee.radius,X.setRenderTarget(Ee.map),X.clear(),X.renderBufferDirect(We,null,Ze,pe,be,null)}function Be(Ee,We,Ze,Ve){let _e=null;const Xe=Ze.isPointLight===!0?Ee.customDistanceMaterial:Ee.customDepthMaterial;if(Xe!==void 0)_e=Xe;else if(_e=Ze.isPointLight===!0?se:ie,X.localClippingEnabled&&We.clipShadows===!0&&Array.isArray(We.clippingPlanes)&&We.clippingPlanes.length!==0||We.displacementMap&&We.displacementScale!==0||We.alphaMap&&We.alphaTest>0||We.map&&We.alphaTest>0){const Pe=_e.uuid,He=We.uuid;let Ke=ae[Pe];Ke===void 0&&(Ke={},ae[Pe]=Ke);let Ue=Ke[He];Ue===void 0&&(Ue=_e.clone(),Ke[He]=Ue),_e=Ue}if(_e.visible=We.visible,_e.wireframe=We.wireframe,Ve===VSMShadowMap?_e.side=We.shadowSide!==null?We.shadowSide:We.side:_e.side=We.shadowSide!==null?We.shadowSide:ce[We.side],_e.alphaMap=We.alphaMap,_e.alphaTest=We.alphaTest,_e.map=We.map,_e.clipShadows=We.clipShadows,_e.clippingPlanes=We.clippingPlanes,_e.clipIntersection=We.clipIntersection,_e.displacementMap=We.displacementMap,_e.displacementScale=We.displacementScale,_e.displacementBias=We.displacementBias,_e.wireframeLinewidth=We.wireframeLinewidth,_e.linewidth=We.linewidth,Ze.isPointLight===!0&&_e.isMeshDistanceMaterial===!0){const Pe=X.properties.get(_e);Pe.light=Ze}return _e}function Re(Ee,We,Ze,Ve,_e){if(Ee.visible===!1)return;if(Ee.layers.test(We.layers)&&(Ee.isMesh||Ee.isLine||Ee.isPoints)&&(Ee.castShadow||Ee.receiveShadow&&_e===VSMShadowMap)&&(!Ee.frustumCulled||K.intersectsObject(Ee))){Ee.modelViewMatrix.multiplyMatrices(Ze.matrixWorldInverse,Ee.matrixWorld);const He=Z.update(Ee),Ke=Ee.material;if(Array.isArray(Ke)){const Ue=He.groups;for(let tt=0,rt=Ue.length;tt<rt;tt++){const at=Ue[tt],Oe=Ke[at.materialIndex];if(Oe&&Oe.visible){const $e=Be(Ee,Oe,Ve,_e);X.renderBufferDirect(Ze,null,He,$e,Ee,at)}}}else if(Ke.visible){const Ue=Be(Ee,Ke,Ve,_e);X.renderBufferDirect(Ze,null,He,Ue,Ee,null)}}const Pe=Ee.children;for(let He=0,Ke=Pe.length;He<Ke;He++)Re(Pe[He],We,Ze,Ve,_e)}}function WebGLState(X,Z,_){const K=_.isWebGL2;function te(){let ft=!1;const vt=new Vector4;let Et=null;const gn=new Vector4(0,0,0,0);return{setMask:function(an){Et!==an&&!ft&&(X.colorMask(an,an,an,an),Et=an)},setLocked:function(an){ft=an},setClear:function(an,vn,zn,On,Tn){Tn===!0&&(an*=On,vn*=On,zn*=On),vt.set(an,vn,zn,On),gn.equals(vt)===!1&&(X.clearColor(an,vn,zn,On),gn.copy(vt))},reset:function(){ft=!1,Et=null,gn.set(-1,0,0,0)}}}function ne(){let ft=!1,vt=null,Et=null,gn=null;return{setTest:function(an){an?ht(X.DEPTH_TEST):At(X.DEPTH_TEST)},setMask:function(an){vt!==an&&!ft&&(X.depthMask(an),vt=an)},setFunc:function(an){if(Et!==an){switch(an){case NeverDepth:X.depthFunc(X.NEVER);break;case AlwaysDepth:X.depthFunc(X.ALWAYS);break;case LessDepth:X.depthFunc(X.LESS);break;case LessEqualDepth:X.depthFunc(X.LEQUAL);break;case EqualDepth:X.depthFunc(X.EQUAL);break;case GreaterEqualDepth:X.depthFunc(X.GEQUAL);break;case GreaterDepth:X.depthFunc(X.GREATER);break;case NotEqualDepth:X.depthFunc(X.NOTEQUAL);break;default:X.depthFunc(X.LEQUAL)}Et=an}},setLocked:function(an){ft=an},setClear:function(an){gn!==an&&(X.clearDepth(an),gn=an)},reset:function(){ft=!1,vt=null,Et=null,gn=null}}}function oe(){let ft=!1,vt=null,Et=null,gn=null,an=null,vn=null,zn=null,On=null,Tn=null;return{setTest:function(Xn){ft||(Xn?ht(X.STENCIL_TEST):At(X.STENCIL_TEST))},setMask:function(Xn){vt!==Xn&&!ft&&(X.stencilMask(Xn),vt=Xn)},setFunc:function(Xn,dr,rr){(Et!==Xn||gn!==dr||an!==rr)&&(X.stencilFunc(Xn,dr,rr),Et=Xn,gn=dr,an=rr)},setOp:function(Xn,dr,rr){(vn!==Xn||zn!==dr||On!==rr)&&(X.stencilOp(Xn,dr,rr),vn=Xn,zn=dr,On=rr)},setLocked:function(Xn){ft=Xn},setClear:function(Xn){Tn!==Xn&&(X.clearStencil(Xn),Tn=Xn)},reset:function(){ft=!1,vt=null,Et=null,gn=null,an=null,vn=null,zn=null,On=null,Tn=null}}}const ie=new te,se=new ne,ae=new oe,ge=new WeakMap,ce=new WeakMap;let de={},pe={},fe=new WeakMap,be=[],me=null,ye=!1,ve=null,Be=null,Re=null,Ee=null,We=null,Ze=null,Ve=null,_e=!1,Xe=null,Pe=null,He=null,Ke=null,Ue=null;const tt=X.getParameter(X.MAX_COMBINED_TEXTURE_IMAGE_UNITS);let rt=!1,at=0;const Oe=X.getParameter(X.VERSION);Oe.indexOf("WebGL")!==-1?(at=parseFloat(/^WebGL (\d)/.exec(Oe)[1]),rt=at>=1):Oe.indexOf("OpenGL ES")!==-1&&(at=parseFloat(/^OpenGL ES (\d)/.exec(Oe)[1]),rt=at>=2);let $e=null,je={};const Te=X.getParameter(X.SCISSOR_BOX),De=X.getParameter(X.VIEWPORT),ot=new Vector4().fromArray(Te),ct=new Vector4().fromArray(De);function gt(ft,vt,Et,gn){const an=new Uint8Array(4),vn=X.createTexture();X.bindTexture(ft,vn),X.texParameteri(ft,X.TEXTURE_MIN_FILTER,X.NEAREST),X.texParameteri(ft,X.TEXTURE_MAG_FILTER,X.NEAREST);for(let zn=0;zn<Et;zn++)K&&(ft===X.TEXTURE_3D||ft===X.TEXTURE_2D_ARRAY)?X.texImage3D(vt,0,X.RGBA,1,1,gn,0,X.RGBA,X.UNSIGNED_BYTE,an):X.texImage2D(vt+zn,0,X.RGBA,1,1,0,X.RGBA,X.UNSIGNED_BYTE,an);return vn}const pt={};pt[X.TEXTURE_2D]=gt(X.TEXTURE_2D,X.TEXTURE_2D,1),pt[X.TEXTURE_CUBE_MAP]=gt(X.TEXTURE_CUBE_MAP,X.TEXTURE_CUBE_MAP_POSITIVE_X,6),K&&(pt[X.TEXTURE_2D_ARRAY]=gt(X.TEXTURE_2D_ARRAY,X.TEXTURE_2D_ARRAY,1,1),pt[X.TEXTURE_3D]=gt(X.TEXTURE_3D,X.TEXTURE_3D,1,1)),ie.setClear(0,0,0,1),se.setClear(1),ae.setClear(0),ht(X.DEPTH_TEST),se.setFunc(LessEqualDepth),Rt(!1),jt(CullFaceBack),ht(X.CULL_FACE),wt(NoBlending);function ht(ft){de[ft]!==!0&&(X.enable(ft),de[ft]=!0)}function At(ft){de[ft]!==!1&&(X.disable(ft),de[ft]=!1)}function Kt(ft,vt){return pe[ft]!==vt?(X.bindFramebuffer(ft,vt),pe[ft]=vt,K&&(ft===X.DRAW_FRAMEBUFFER&&(pe[X.FRAMEBUFFER]=vt),ft===X.FRAMEBUFFER&&(pe[X.DRAW_FRAMEBUFFER]=vt)),!0):!1}function en(ft,vt){let Et=be,gn=!1;if(ft)if(Et=fe.get(vt),Et===void 0&&(Et=[],fe.set(vt,Et)),ft.isWebGLMultipleRenderTargets){const an=ft.texture;if(Et.length!==an.length||Et[0]!==X.COLOR_ATTACHMENT0){for(let vn=0,zn=an.length;vn<zn;vn++)Et[vn]=X.COLOR_ATTACHMENT0+vn;Et.length=an.length,gn=!0}}else Et[0]!==X.COLOR_ATTACHMENT0&&(Et[0]=X.COLOR_ATTACHMENT0,gn=!0);else Et[0]!==X.BACK&&(Et[0]=X.BACK,gn=!0);gn&&(_.isWebGL2?X.drawBuffers(Et):Z.get("WEBGL_draw_buffers").drawBuffersWEBGL(Et))}function Zt(ft){return me!==ft?(X.useProgram(ft),me=ft,!0):!1}const st={[AddEquation]:X.FUNC_ADD,[SubtractEquation]:X.FUNC_SUBTRACT,[ReverseSubtractEquation]:X.FUNC_REVERSE_SUBTRACT};if(K)st[MinEquation]=X.MIN,st[MaxEquation]=X.MAX;else{const ft=Z.get("EXT_blend_minmax");ft!==null&&(st[MinEquation]=ft.MIN_EXT,st[MaxEquation]=ft.MAX_EXT)}const Vt={[ZeroFactor]:X.ZERO,[OneFactor]:X.ONE,[SrcColorFactor]:X.SRC_COLOR,[SrcAlphaFactor]:X.SRC_ALPHA,[SrcAlphaSaturateFactor]:X.SRC_ALPHA_SATURATE,[DstColorFactor]:X.DST_COLOR,[DstAlphaFactor]:X.DST_ALPHA,[OneMinusSrcColorFactor]:X.ONE_MINUS_SRC_COLOR,[OneMinusSrcAlphaFactor]:X.ONE_MINUS_SRC_ALPHA,[OneMinusDstColorFactor]:X.ONE_MINUS_DST_COLOR,[OneMinusDstAlphaFactor]:X.ONE_MINUS_DST_ALPHA};function wt(ft,vt,Et,gn,an,vn,zn,On){if(ft===NoBlending){ye===!0&&(At(X.BLEND),ye=!1);return}if(ye===!1&&(ht(X.BLEND),ye=!0),ft!==CustomBlending){if(ft!==ve||On!==_e){if((Be!==AddEquation||We!==AddEquation)&&(X.blendEquation(X.FUNC_ADD),Be=AddEquation,We=AddEquation),On)switch(ft){case NormalBlending:X.blendFuncSeparate(X.ONE,X.ONE_MINUS_SRC_ALPHA,X.ONE,X.ONE_MINUS_SRC_ALPHA);break;case AdditiveBlending:X.blendFunc(X.ONE,X.ONE);break;case SubtractiveBlending:X.blendFuncSeparate(X.ZERO,X.ONE_MINUS_SRC_COLOR,X.ZERO,X.ONE);break;case MultiplyBlending:X.blendFuncSeparate(X.ZERO,X.SRC_COLOR,X.ZERO,X.SRC_ALPHA);break;default:console.error("THREE.WebGLState: Invalid blending: ",ft);break}else switch(ft){case NormalBlending:X.blendFuncSeparate(X.SRC_ALPHA,X.ONE_MINUS_SRC_ALPHA,X.ONE,X.ONE_MINUS_SRC_ALPHA);break;case AdditiveBlending:X.blendFunc(X.SRC_ALPHA,X.ONE);break;case SubtractiveBlending:X.blendFuncSeparate(X.ZERO,X.ONE_MINUS_SRC_COLOR,X.ZERO,X.ONE);break;case MultiplyBlending:X.blendFunc(X.ZERO,X.SRC_COLOR);break;default:console.error("THREE.WebGLState: Invalid blending: ",ft);break}Re=null,Ee=null,Ze=null,Ve=null,ve=ft,_e=On}return}an=an||vt,vn=vn||Et,zn=zn||gn,(vt!==Be||an!==We)&&(X.blendEquationSeparate(st[vt],st[an]),Be=vt,We=an),(Et!==Re||gn!==Ee||vn!==Ze||zn!==Ve)&&(X.blendFuncSeparate(Vt[Et],Vt[gn],Vt[vn],Vt[zn]),Re=Et,Ee=gn,Ze=vn,Ve=zn),ve=ft,_e=!1}function St(ft,vt){ft.side===DoubleSide?At(X.CULL_FACE):ht(X.CULL_FACE);let Et=ft.side===BackSide;vt&&(Et=!Et),Rt(Et),ft.blending===NormalBlending&&ft.transparent===!1?wt(NoBlending):wt(ft.blending,ft.blendEquation,ft.blendSrc,ft.blendDst,ft.blendEquationAlpha,ft.blendSrcAlpha,ft.blendDstAlpha,ft.premultipliedAlpha),se.setFunc(ft.depthFunc),se.setTest(ft.depthTest),se.setMask(ft.depthWrite),ie.setMask(ft.colorWrite);const gn=ft.stencilWrite;ae.setTest(gn),gn&&(ae.setMask(ft.stencilWriteMask),ae.setFunc(ft.stencilFunc,ft.stencilRef,ft.stencilFuncMask),ae.setOp(ft.stencilFail,ft.stencilZFail,ft.stencilZPass)),Ht(ft.polygonOffset,ft.polygonOffsetFactor,ft.polygonOffsetUnits),ft.alphaToCoverage===!0?ht(X.SAMPLE_ALPHA_TO_COVERAGE):At(X.SAMPLE_ALPHA_TO_COVERAGE)}function Rt(ft){Xe!==ft&&(ft?X.frontFace(X.CW):X.frontFace(X.CCW),Xe=ft)}function jt(ft){ft!==CullFaceNone?(ht(X.CULL_FACE),ft!==Pe&&(ft===CullFaceBack?X.cullFace(X.BACK):ft===CullFaceFront?X.cullFace(X.FRONT):X.cullFace(X.FRONT_AND_BACK))):At(X.CULL_FACE),Pe=ft}function Wt(ft){ft!==He&&(rt&&X.lineWidth(ft),He=ft)}function Ht(ft,vt,Et){ft?(ht(X.POLYGON_OFFSET_FILL),(Ke!==vt||Ue!==Et)&&(X.polygonOffset(vt,Et),Ke=vt,Ue=Et)):At(X.POLYGON_OFFSET_FILL)}function Pt(ft){ft?ht(X.SCISSOR_TEST):At(X.SCISSOR_TEST)}function Mt(ft){ft===void 0&&(ft=X.TEXTURE0+tt-1),$e!==ft&&(X.activeTexture(ft),$e=ft)}function un(ft,vt,Et){Et===void 0&&($e===null?Et=X.TEXTURE0+tt-1:Et=$e);let gn=je[Et];gn===void 0&&(gn={type:void 0,texture:void 0},je[Et]=gn),(gn.type!==ft||gn.texture!==vt)&&($e!==Et&&(X.activeTexture(Et),$e=Et),X.bindTexture(ft,vt||pt[ft]),gn.type=ft,gn.texture=vt)}function qe(){const ft=je[$e];ft!==void 0&&ft.type!==void 0&&(X.bindTexture(ft.type,null),ft.type=void 0,ft.texture=void 0)}function Je(){try{X.compressedTexImage2D.apply(X,arguments)}catch(ft){console.error("THREE.WebGLState:",ft)}}function mt(){try{X.compressedTexImage3D.apply(X,arguments)}catch(ft){console.error("THREE.WebGLState:",ft)}}function Dt(){try{X.texSubImage2D.apply(X,arguments)}catch(ft){console.error("THREE.WebGLState:",ft)}}function _t(){try{X.texSubImage3D.apply(X,arguments)}catch(ft){console.error("THREE.WebGLState:",ft)}}function zt(){try{X.compressedTexSubImage2D.apply(X,arguments)}catch(ft){console.error("THREE.WebGLState:",ft)}}function nn(){try{X.compressedTexSubImage3D.apply(X,arguments)}catch(ft){console.error("THREE.WebGLState:",ft)}}function tn(){try{X.texStorage2D.apply(X,arguments)}catch(ft){console.error("THREE.WebGLState:",ft)}}function Ft(){try{X.texStorage3D.apply(X,arguments)}catch(ft){console.error("THREE.WebGLState:",ft)}}function pn(){try{X.texImage2D.apply(X,arguments)}catch(ft){console.error("THREE.WebGLState:",ft)}}function sn(){try{X.texImage3D.apply(X,arguments)}catch(ft){console.error("THREE.WebGLState:",ft)}}function rn(ft){ot.equals(ft)===!1&&(X.scissor(ft.x,ft.y,ft.z,ft.w),ot.copy(ft))}function $t(ft){ct.equals(ft)===!1&&(X.viewport(ft.x,ft.y,ft.z,ft.w),ct.copy(ft))}function on(ft,vt){let Et=ce.get(vt);Et===void 0&&(Et=new WeakMap,ce.set(vt,Et));let gn=Et.get(ft);gn===void 0&&(gn=X.getUniformBlockIndex(vt,ft.name),Et.set(ft,gn))}function An(ft,vt){const gn=ce.get(vt).get(ft);ge.get(vt)!==gn&&(X.uniformBlockBinding(vt,gn,ft.__bindingPointIndex),ge.set(vt,gn))}function wn(){X.disable(X.BLEND),X.disable(X.CULL_FACE),X.disable(X.DEPTH_TEST),X.disable(X.POLYGON_OFFSET_FILL),X.disable(X.SCISSOR_TEST),X.disable(X.STENCIL_TEST),X.disable(X.SAMPLE_ALPHA_TO_COVERAGE),X.blendEquation(X.FUNC_ADD),X.blendFunc(X.ONE,X.ZERO),X.blendFuncSeparate(X.ONE,X.ZERO,X.ONE,X.ZERO),X.colorMask(!0,!0,!0,!0),X.clearColor(0,0,0,0),X.depthMask(!0),X.depthFunc(X.LESS),X.clearDepth(1),X.stencilMask(4294967295),X.stencilFunc(X.ALWAYS,0,4294967295),X.stencilOp(X.KEEP,X.KEEP,X.KEEP),X.clearStencil(0),X.cullFace(X.BACK),X.frontFace(X.CCW),X.polygonOffset(0,0),X.activeTexture(X.TEXTURE0),X.bindFramebuffer(X.FRAMEBUFFER,null),K===!0&&(X.bindFramebuffer(X.DRAW_FRAMEBUFFER,null),X.bindFramebuffer(X.READ_FRAMEBUFFER,null)),X.useProgram(null),X.lineWidth(1),X.scissor(0,0,X.canvas.width,X.canvas.height),X.viewport(0,0,X.canvas.width,X.canvas.height),de={},$e=null,je={},pe={},fe=new WeakMap,be=[],me=null,ye=!1,ve=null,Be=null,Re=null,Ee=null,We=null,Ze=null,Ve=null,_e=!1,Xe=null,Pe=null,He=null,Ke=null,Ue=null,ot.set(0,0,X.canvas.width,X.canvas.height),ct.set(0,0,X.canvas.width,X.canvas.height),ie.reset(),se.reset(),ae.reset()}return{buffers:{color:ie,depth:se,stencil:ae},enable:ht,disable:At,bindFramebuffer:Kt,drawBuffers:en,useProgram:Zt,setBlending:wt,setMaterial:St,setFlipSided:Rt,setCullFace:jt,setLineWidth:Wt,setPolygonOffset:Ht,setScissorTest:Pt,activeTexture:Mt,bindTexture:un,unbindTexture:qe,compressedTexImage2D:Je,compressedTexImage3D:mt,texImage2D:pn,texImage3D:sn,updateUBOMapping:on,uniformBlockBinding:An,texStorage2D:tn,texStorage3D:Ft,texSubImage2D:Dt,texSubImage3D:_t,compressedTexSubImage2D:zt,compressedTexSubImage3D:nn,scissor:rn,viewport:$t,reset:wn}}function WebGLTextures(X,Z,_,K,te,ne,oe){const ie=te.isWebGL2,se=te.maxTextures,ae=te.maxCubemapSize,ge=te.maxTextureSize,ce=te.maxSamples,de=Z.has("WEBGL_multisampled_render_to_texture")?Z.get("WEBGL_multisampled_render_to_texture"):null,pe=typeof navigator>"u"?!1:/OculusBrowser/g.test(navigator.userAgent),fe=new WeakMap;let be;const me=new WeakMap;let ye=!1;try{ye=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")!==null}catch{}function ve(qe,Je){return ye?new OffscreenCanvas(qe,Je):createElementNS("canvas")}function Be(qe,Je,mt,Dt){let _t=1;if((qe.width>Dt||qe.height>Dt)&&(_t=Dt/Math.max(qe.width,qe.height)),_t<1||Je===!0)if(typeof HTMLImageElement<"u"&&qe instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&qe instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&qe instanceof ImageBitmap){const zt=Je?floorPowerOfTwo:Math.floor,nn=zt(_t*qe.width),tn=zt(_t*qe.height);be===void 0&&(be=ve(nn,tn));const Ft=mt?ve(nn,tn):be;return Ft.width=nn,Ft.height=tn,Ft.getContext("2d").drawImage(qe,0,0,nn,tn),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+qe.width+"x"+qe.height+") to ("+nn+"x"+tn+")."),Ft}else return"data"in qe&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+qe.width+"x"+qe.height+")."),qe;return qe}function Re(qe){return isPowerOfTwo(qe.width)&&isPowerOfTwo(qe.height)}function Ee(qe){return ie?!1:qe.wrapS!==ClampToEdgeWrapping||qe.wrapT!==ClampToEdgeWrapping||qe.minFilter!==NearestFilter&&qe.minFilter!==LinearFilter}function We(qe,Je){return qe.generateMipmaps&&Je&&qe.minFilter!==NearestFilter&&qe.minFilter!==LinearFilter}function Ze(qe){X.generateMipmap(qe)}function Ve(qe,Je,mt,Dt,_t=!1){if(ie===!1)return Je;if(qe!==null){if(X[qe]!==void 0)return X[qe];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+qe+"'")}let zt=Je;return Je===X.RED&&(mt===X.FLOAT&&(zt=X.R32F),mt===X.HALF_FLOAT&&(zt=X.R16F),mt===X.UNSIGNED_BYTE&&(zt=X.R8)),Je===X.RG&&(mt===X.FLOAT&&(zt=X.RG32F),mt===X.HALF_FLOAT&&(zt=X.RG16F),mt===X.UNSIGNED_BYTE&&(zt=X.RG8)),Je===X.RGBA&&(mt===X.FLOAT&&(zt=X.RGBA32F),mt===X.HALF_FLOAT&&(zt=X.RGBA16F),mt===X.UNSIGNED_BYTE&&(zt=Dt===SRGBColorSpace$1&&_t===!1?X.SRGB8_ALPHA8:X.RGBA8),mt===X.UNSIGNED_SHORT_4_4_4_4&&(zt=X.RGBA4),mt===X.UNSIGNED_SHORT_5_5_5_1&&(zt=X.RGB5_A1)),(zt===X.R16F||zt===X.R32F||zt===X.RG16F||zt===X.RG32F||zt===X.RGBA16F||zt===X.RGBA32F)&&Z.get("EXT_color_buffer_float"),zt}function _e(qe,Je,mt){return We(qe,mt)===!0||qe.isFramebufferTexture&&qe.minFilter!==NearestFilter&&qe.minFilter!==LinearFilter?Math.log2(Math.max(Je.width,Je.height))+1:qe.mipmaps!==void 0&&qe.mipmaps.length>0?qe.mipmaps.length:qe.isCompressedTexture&&Array.isArray(qe.image)?Je.mipmaps.length:1}function Xe(qe){return qe===NearestFilter||qe===NearestMipmapNearestFilter||qe===NearestMipmapLinearFilter?X.NEAREST:X.LINEAR}function Pe(qe){const Je=qe.target;Je.removeEventListener("dispose",Pe),Ke(Je),Je.isVideoTexture&&fe.delete(Je)}function He(qe){const Je=qe.target;Je.removeEventListener("dispose",He),tt(Je)}function Ke(qe){const Je=K.get(qe);if(Je.__webglInit===void 0)return;const mt=qe.source,Dt=me.get(mt);if(Dt){const _t=Dt[Je.__cacheKey];_t.usedTimes--,_t.usedTimes===0&&Ue(qe),Object.keys(Dt).length===0&&me.delete(mt)}K.remove(qe)}function Ue(qe){const Je=K.get(qe);X.deleteTexture(Je.__webglTexture);const mt=qe.source,Dt=me.get(mt);delete Dt[Je.__cacheKey],oe.memory.textures--}function tt(qe){const Je=qe.texture,mt=K.get(qe),Dt=K.get(Je);if(Dt.__webglTexture!==void 0&&(X.deleteTexture(Dt.__webglTexture),oe.memory.textures--),qe.depthTexture&&qe.depthTexture.dispose(),qe.isWebGLCubeRenderTarget)for(let _t=0;_t<6;_t++)X.deleteFramebuffer(mt.__webglFramebuffer[_t]),mt.__webglDepthbuffer&&X.deleteRenderbuffer(mt.__webglDepthbuffer[_t]);else{if(X.deleteFramebuffer(mt.__webglFramebuffer),mt.__webglDepthbuffer&&X.deleteRenderbuffer(mt.__webglDepthbuffer),mt.__webglMultisampledFramebuffer&&X.deleteFramebuffer(mt.__webglMultisampledFramebuffer),mt.__webglColorRenderbuffer)for(let _t=0;_t<mt.__webglColorRenderbuffer.length;_t++)mt.__webglColorRenderbuffer[_t]&&X.deleteRenderbuffer(mt.__webglColorRenderbuffer[_t]);mt.__webglDepthRenderbuffer&&X.deleteRenderbuffer(mt.__webglDepthRenderbuffer)}if(qe.isWebGLMultipleRenderTargets)for(let _t=0,zt=Je.length;_t<zt;_t++){const nn=K.get(Je[_t]);nn.__webglTexture&&(X.deleteTexture(nn.__webglTexture),oe.memory.textures--),K.remove(Je[_t])}K.remove(Je),K.remove(qe)}let rt=0;function at(){rt=0}function Oe(){const qe=rt;return qe>=se&&console.warn("THREE.WebGLTextures: Trying to use "+qe+" texture units while this GPU supports only "+se),rt+=1,qe}function $e(qe){const Je=[];return Je.push(qe.wrapS),Je.push(qe.wrapT),Je.push(qe.wrapR||0),Je.push(qe.magFilter),Je.push(qe.minFilter),Je.push(qe.anisotropy),Je.push(qe.internalFormat),Je.push(qe.format),Je.push(qe.type),Je.push(qe.generateMipmaps),Je.push(qe.premultiplyAlpha),Je.push(qe.flipY),Je.push(qe.unpackAlignment),Je.push(qe.colorSpace),Je.join()}function je(qe,Je){const mt=K.get(qe);if(qe.isVideoTexture&&Mt(qe),qe.isRenderTargetTexture===!1&&qe.version>0&&mt.__version!==qe.version){const Dt=qe.image;if(Dt===null)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else if(Dt.complete===!1)console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete");else{Kt(mt,qe,Je);return}}_.bindTexture(X.TEXTURE_2D,mt.__webglTexture,X.TEXTURE0+Je)}function Te(qe,Je){const mt=K.get(qe);if(qe.version>0&&mt.__version!==qe.version){Kt(mt,qe,Je);return}_.bindTexture(X.TEXTURE_2D_ARRAY,mt.__webglTexture,X.TEXTURE0+Je)}function De(qe,Je){const mt=K.get(qe);if(qe.version>0&&mt.__version!==qe.version){Kt(mt,qe,Je);return}_.bindTexture(X.TEXTURE_3D,mt.__webglTexture,X.TEXTURE0+Je)}function ot(qe,Je){const mt=K.get(qe);if(qe.version>0&&mt.__version!==qe.version){en(mt,qe,Je);return}_.bindTexture(X.TEXTURE_CUBE_MAP,mt.__webglTexture,X.TEXTURE0+Je)}const ct={[RepeatWrapping]:X.REPEAT,[ClampToEdgeWrapping]:X.CLAMP_TO_EDGE,[MirroredRepeatWrapping]:X.MIRRORED_REPEAT},gt={[NearestFilter]:X.NEAREST,[NearestMipmapNearestFilter]:X.NEAREST_MIPMAP_NEAREST,[NearestMipmapLinearFilter]:X.NEAREST_MIPMAP_LINEAR,[LinearFilter]:X.LINEAR,[LinearMipmapNearestFilter]:X.LINEAR_MIPMAP_NEAREST,[LinearMipmapLinearFilter]:X.LINEAR_MIPMAP_LINEAR},pt={[NeverCompare]:X.NEVER,[AlwaysCompare]:X.ALWAYS,[LessCompare]:X.LESS,[LessEqualCompare]:X.LEQUAL,[EqualCompare]:X.EQUAL,[GreaterEqualCompare]:X.GEQUAL,[GreaterCompare]:X.GREATER,[NotEqualCompare]:X.NOTEQUAL};function ht(qe,Je,mt){if(mt?(X.texParameteri(qe,X.TEXTURE_WRAP_S,ct[Je.wrapS]),X.texParameteri(qe,X.TEXTURE_WRAP_T,ct[Je.wrapT]),(qe===X.TEXTURE_3D||qe===X.TEXTURE_2D_ARRAY)&&X.texParameteri(qe,X.TEXTURE_WRAP_R,ct[Je.wrapR]),X.texParameteri(qe,X.TEXTURE_MAG_FILTER,gt[Je.magFilter]),X.texParameteri(qe,X.TEXTURE_MIN_FILTER,gt[Je.minFilter])):(X.texParameteri(qe,X.TEXTURE_WRAP_S,X.CLAMP_TO_EDGE),X.texParameteri(qe,X.TEXTURE_WRAP_T,X.CLAMP_TO_EDGE),(qe===X.TEXTURE_3D||qe===X.TEXTURE_2D_ARRAY)&&X.texParameteri(qe,X.TEXTURE_WRAP_R,X.CLAMP_TO_EDGE),(Je.wrapS!==ClampToEdgeWrapping||Je.wrapT!==ClampToEdgeWrapping)&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),X.texParameteri(qe,X.TEXTURE_MAG_FILTER,Xe(Je.magFilter)),X.texParameteri(qe,X.TEXTURE_MIN_FILTER,Xe(Je.minFilter)),Je.minFilter!==NearestFilter&&Je.minFilter!==LinearFilter&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),Je.compareFunction&&(X.texParameteri(qe,X.TEXTURE_COMPARE_MODE,X.COMPARE_REF_TO_TEXTURE),X.texParameteri(qe,X.TEXTURE_COMPARE_FUNC,pt[Je.compareFunction])),Z.has("EXT_texture_filter_anisotropic")===!0){const Dt=Z.get("EXT_texture_filter_anisotropic");if(Je.magFilter===NearestFilter||Je.minFilter!==NearestMipmapLinearFilter&&Je.minFilter!==LinearMipmapLinearFilter||Je.type===FloatType&&Z.has("OES_texture_float_linear")===!1||ie===!1&&Je.type===HalfFloatType&&Z.has("OES_texture_half_float_linear")===!1)return;(Je.anisotropy>1||K.get(Je).__currentAnisotropy)&&(X.texParameterf(qe,Dt.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(Je.anisotropy,te.getMaxAnisotropy())),K.get(Je).__currentAnisotropy=Je.anisotropy)}}function At(qe,Je){let mt=!1;qe.__webglInit===void 0&&(qe.__webglInit=!0,Je.addEventListener("dispose",Pe));const Dt=Je.source;let _t=me.get(Dt);_t===void 0&&(_t={},me.set(Dt,_t));const zt=$e(Je);if(zt!==qe.__cacheKey){_t[zt]===void 0&&(_t[zt]={texture:X.createTexture(),usedTimes:0},oe.memory.textures++,mt=!0),_t[zt].usedTimes++;const nn=_t[qe.__cacheKey];nn!==void 0&&(_t[qe.__cacheKey].usedTimes--,nn.usedTimes===0&&Ue(Je)),qe.__cacheKey=zt,qe.__webglTexture=_t[zt].texture}return mt}function Kt(qe,Je,mt){let Dt=X.TEXTURE_2D;(Je.isDataArrayTexture||Je.isCompressedArrayTexture)&&(Dt=X.TEXTURE_2D_ARRAY),Je.isData3DTexture&&(Dt=X.TEXTURE_3D);const _t=At(qe,Je),zt=Je.source;_.bindTexture(Dt,qe.__webglTexture,X.TEXTURE0+mt);const nn=K.get(zt);if(zt.version!==nn.__version||_t===!0){_.activeTexture(X.TEXTURE0+mt),X.pixelStorei(X.UNPACK_FLIP_Y_WEBGL,Je.flipY),X.pixelStorei(X.UNPACK_PREMULTIPLY_ALPHA_WEBGL,Je.premultiplyAlpha),X.pixelStorei(X.UNPACK_ALIGNMENT,Je.unpackAlignment),X.pixelStorei(X.UNPACK_COLORSPACE_CONVERSION_WEBGL,X.NONE);const tn=Ee(Je)&&Re(Je.image)===!1;let Ft=Be(Je.image,tn,!1,ge);Ft=un(Je,Ft);const pn=Re(Ft)||ie,sn=ne.convert(Je.format,Je.colorSpace);let rn=ne.convert(Je.type),$t=Ve(Je.internalFormat,sn,rn,Je.colorSpace);ht(Dt,Je,pn);let on;const An=Je.mipmaps,wn=ie&&Je.isVideoTexture!==!0,ft=nn.__version===void 0||_t===!0,vt=_e(Je,Ft,pn);if(Je.isDepthTexture)$t=X.DEPTH_COMPONENT,ie?Je.type===FloatType?$t=X.DEPTH_COMPONENT32F:Je.type===UnsignedIntType?$t=X.DEPTH_COMPONENT24:Je.type===UnsignedInt248Type?$t=X.DEPTH24_STENCIL8:$t=X.DEPTH_COMPONENT16:Je.type===FloatType&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),Je.format===DepthFormat&&$t===X.DEPTH_COMPONENT&&Je.type!==UnsignedShortType&&Je.type!==UnsignedIntType&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),Je.type=UnsignedIntType,rn=ne.convert(Je.type)),Je.format===DepthStencilFormat&&$t===X.DEPTH_COMPONENT&&($t=X.DEPTH_STENCIL,Je.type!==UnsignedInt248Type&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),Je.type=UnsignedInt248Type,rn=ne.convert(Je.type))),ft&&(wn?_.texStorage2D(X.TEXTURE_2D,1,$t,Ft.width,Ft.height):_.texImage2D(X.TEXTURE_2D,0,$t,Ft.width,Ft.height,0,sn,rn,null));else if(Je.isDataTexture)if(An.length>0&&pn){wn&&ft&&_.texStorage2D(X.TEXTURE_2D,vt,$t,An[0].width,An[0].height);for(let Et=0,gn=An.length;Et<gn;Et++)on=An[Et],wn?_.texSubImage2D(X.TEXTURE_2D,Et,0,0,on.width,on.height,sn,rn,on.data):_.texImage2D(X.TEXTURE_2D,Et,$t,on.width,on.height,0,sn,rn,on.data);Je.generateMipmaps=!1}else wn?(ft&&_.texStorage2D(X.TEXTURE_2D,vt,$t,Ft.width,Ft.height),_.texSubImage2D(X.TEXTURE_2D,0,0,0,Ft.width,Ft.height,sn,rn,Ft.data)):_.texImage2D(X.TEXTURE_2D,0,$t,Ft.width,Ft.height,0,sn,rn,Ft.data);else if(Je.isCompressedTexture)if(Je.isCompressedArrayTexture){wn&&ft&&_.texStorage3D(X.TEXTURE_2D_ARRAY,vt,$t,An[0].width,An[0].height,Ft.depth);for(let Et=0,gn=An.length;Et<gn;Et++)on=An[Et],Je.format!==RGBAFormat?sn!==null?wn?_.compressedTexSubImage3D(X.TEXTURE_2D_ARRAY,Et,0,0,0,on.width,on.height,Ft.depth,sn,on.data,0,0):_.compressedTexImage3D(X.TEXTURE_2D_ARRAY,Et,$t,on.width,on.height,Ft.depth,0,on.data,0,0):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):wn?_.texSubImage3D(X.TEXTURE_2D_ARRAY,Et,0,0,0,on.width,on.height,Ft.depth,sn,rn,on.data):_.texImage3D(X.TEXTURE_2D_ARRAY,Et,$t,on.width,on.height,Ft.depth,0,sn,rn,on.data)}else{wn&&ft&&_.texStorage2D(X.TEXTURE_2D,vt,$t,An[0].width,An[0].height);for(let Et=0,gn=An.length;Et<gn;Et++)on=An[Et],Je.format!==RGBAFormat?sn!==null?wn?_.compressedTexSubImage2D(X.TEXTURE_2D,Et,0,0,on.width,on.height,sn,on.data):_.compressedTexImage2D(X.TEXTURE_2D,Et,$t,on.width,on.height,0,on.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):wn?_.texSubImage2D(X.TEXTURE_2D,Et,0,0,on.width,on.height,sn,rn,on.data):_.texImage2D(X.TEXTURE_2D,Et,$t,on.width,on.height,0,sn,rn,on.data)}else if(Je.isDataArrayTexture)wn?(ft&&_.texStorage3D(X.TEXTURE_2D_ARRAY,vt,$t,Ft.width,Ft.height,Ft.depth),_.texSubImage3D(X.TEXTURE_2D_ARRAY,0,0,0,0,Ft.width,Ft.height,Ft.depth,sn,rn,Ft.data)):_.texImage3D(X.TEXTURE_2D_ARRAY,0,$t,Ft.width,Ft.height,Ft.depth,0,sn,rn,Ft.data);else if(Je.isData3DTexture)wn?(ft&&_.texStorage3D(X.TEXTURE_3D,vt,$t,Ft.width,Ft.height,Ft.depth),_.texSubImage3D(X.TEXTURE_3D,0,0,0,0,Ft.width,Ft.height,Ft.depth,sn,rn,Ft.data)):_.texImage3D(X.TEXTURE_3D,0,$t,Ft.width,Ft.height,Ft.depth,0,sn,rn,Ft.data);else if(Je.isFramebufferTexture){if(ft)if(wn)_.texStorage2D(X.TEXTURE_2D,vt,$t,Ft.width,Ft.height);else{let Et=Ft.width,gn=Ft.height;for(let an=0;an<vt;an++)_.texImage2D(X.TEXTURE_2D,an,$t,Et,gn,0,sn,rn,null),Et>>=1,gn>>=1}}else if(An.length>0&&pn){wn&&ft&&_.texStorage2D(X.TEXTURE_2D,vt,$t,An[0].width,An[0].height);for(let Et=0,gn=An.length;Et<gn;Et++)on=An[Et],wn?_.texSubImage2D(X.TEXTURE_2D,Et,0,0,sn,rn,on):_.texImage2D(X.TEXTURE_2D,Et,$t,sn,rn,on);Je.generateMipmaps=!1}else wn?(ft&&_.texStorage2D(X.TEXTURE_2D,vt,$t,Ft.width,Ft.height),_.texSubImage2D(X.TEXTURE_2D,0,0,0,sn,rn,Ft)):_.texImage2D(X.TEXTURE_2D,0,$t,sn,rn,Ft);We(Je,pn)&&Ze(Dt),nn.__version=zt.version,Je.onUpdate&&Je.onUpdate(Je)}qe.__version=Je.version}function en(qe,Je,mt){if(Je.image.length!==6)return;const Dt=At(qe,Je),_t=Je.source;_.bindTexture(X.TEXTURE_CUBE_MAP,qe.__webglTexture,X.TEXTURE0+mt);const zt=K.get(_t);if(_t.version!==zt.__version||Dt===!0){_.activeTexture(X.TEXTURE0+mt),X.pixelStorei(X.UNPACK_FLIP_Y_WEBGL,Je.flipY),X.pixelStorei(X.UNPACK_PREMULTIPLY_ALPHA_WEBGL,Je.premultiplyAlpha),X.pixelStorei(X.UNPACK_ALIGNMENT,Je.unpackAlignment),X.pixelStorei(X.UNPACK_COLORSPACE_CONVERSION_WEBGL,X.NONE);const nn=Je.isCompressedTexture||Je.image[0].isCompressedTexture,tn=Je.image[0]&&Je.image[0].isDataTexture,Ft=[];for(let Et=0;Et<6;Et++)!nn&&!tn?Ft[Et]=Be(Je.image[Et],!1,!0,ae):Ft[Et]=tn?Je.image[Et].image:Je.image[Et],Ft[Et]=un(Je,Ft[Et]);const pn=Ft[0],sn=Re(pn)||ie,rn=ne.convert(Je.format,Je.colorSpace),$t=ne.convert(Je.type),on=Ve(Je.internalFormat,rn,$t,Je.colorSpace),An=ie&&Je.isVideoTexture!==!0,wn=zt.__version===void 0||Dt===!0;let ft=_e(Je,pn,sn);ht(X.TEXTURE_CUBE_MAP,Je,sn);let vt;if(nn){An&&wn&&_.texStorage2D(X.TEXTURE_CUBE_MAP,ft,on,pn.width,pn.height);for(let Et=0;Et<6;Et++){vt=Ft[Et].mipmaps;for(let gn=0;gn<vt.length;gn++){const an=vt[gn];Je.format!==RGBAFormat?rn!==null?An?_.compressedTexSubImage2D(X.TEXTURE_CUBE_MAP_POSITIVE_X+Et,gn,0,0,an.width,an.height,rn,an.data):_.compressedTexImage2D(X.TEXTURE_CUBE_MAP_POSITIVE_X+Et,gn,on,an.width,an.height,0,an.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):An?_.texSubImage2D(X.TEXTURE_CUBE_MAP_POSITIVE_X+Et,gn,0,0,an.width,an.height,rn,$t,an.data):_.texImage2D(X.TEXTURE_CUBE_MAP_POSITIVE_X+Et,gn,on,an.width,an.height,0,rn,$t,an.data)}}}else{vt=Je.mipmaps,An&&wn&&(vt.length>0&&ft++,_.texStorage2D(X.TEXTURE_CUBE_MAP,ft,on,Ft[0].width,Ft[0].height));for(let Et=0;Et<6;Et++)if(tn){An?_.texSubImage2D(X.TEXTURE_CUBE_MAP_POSITIVE_X+Et,0,0,0,Ft[Et].width,Ft[Et].height,rn,$t,Ft[Et].data):_.texImage2D(X.TEXTURE_CUBE_MAP_POSITIVE_X+Et,0,on,Ft[Et].width,Ft[Et].height,0,rn,$t,Ft[Et].data);for(let gn=0;gn<vt.length;gn++){const vn=vt[gn].image[Et].image;An?_.texSubImage2D(X.TEXTURE_CUBE_MAP_POSITIVE_X+Et,gn+1,0,0,vn.width,vn.height,rn,$t,vn.data):_.texImage2D(X.TEXTURE_CUBE_MAP_POSITIVE_X+Et,gn+1,on,vn.width,vn.height,0,rn,$t,vn.data)}}else{An?_.texSubImage2D(X.TEXTURE_CUBE_MAP_POSITIVE_X+Et,0,0,0,rn,$t,Ft[Et]):_.texImage2D(X.TEXTURE_CUBE_MAP_POSITIVE_X+Et,0,on,rn,$t,Ft[Et]);for(let gn=0;gn<vt.length;gn++){const an=vt[gn];An?_.texSubImage2D(X.TEXTURE_CUBE_MAP_POSITIVE_X+Et,gn+1,0,0,rn,$t,an.image[Et]):_.texImage2D(X.TEXTURE_CUBE_MAP_POSITIVE_X+Et,gn+1,on,rn,$t,an.image[Et])}}}We(Je,sn)&&Ze(X.TEXTURE_CUBE_MAP),zt.__version=_t.version,Je.onUpdate&&Je.onUpdate(Je)}qe.__version=Je.version}function Zt(qe,Je,mt,Dt,_t){const zt=ne.convert(mt.format,mt.colorSpace),nn=ne.convert(mt.type),tn=Ve(mt.internalFormat,zt,nn,mt.colorSpace);K.get(Je).__hasExternalTextures||(_t===X.TEXTURE_3D||_t===X.TEXTURE_2D_ARRAY?_.texImage3D(_t,0,tn,Je.width,Je.height,Je.depth,0,zt,nn,null):_.texImage2D(_t,0,tn,Je.width,Je.height,0,zt,nn,null)),_.bindFramebuffer(X.FRAMEBUFFER,qe),Pt(Je)?de.framebufferTexture2DMultisampleEXT(X.FRAMEBUFFER,Dt,_t,K.get(mt).__webglTexture,0,Ht(Je)):(_t===X.TEXTURE_2D||_t>=X.TEXTURE_CUBE_MAP_POSITIVE_X&&_t<=X.TEXTURE_CUBE_MAP_NEGATIVE_Z)&&X.framebufferTexture2D(X.FRAMEBUFFER,Dt,_t,K.get(mt).__webglTexture,0),_.bindFramebuffer(X.FRAMEBUFFER,null)}function st(qe,Je,mt){if(X.bindRenderbuffer(X.RENDERBUFFER,qe),Je.depthBuffer&&!Je.stencilBuffer){let Dt=X.DEPTH_COMPONENT16;if(mt||Pt(Je)){const _t=Je.depthTexture;_t&&_t.isDepthTexture&&(_t.type===FloatType?Dt=X.DEPTH_COMPONENT32F:_t.type===UnsignedIntType&&(Dt=X.DEPTH_COMPONENT24));const zt=Ht(Je);Pt(Je)?de.renderbufferStorageMultisampleEXT(X.RENDERBUFFER,zt,Dt,Je.width,Je.height):X.renderbufferStorageMultisample(X.RENDERBUFFER,zt,Dt,Je.width,Je.height)}else X.renderbufferStorage(X.RENDERBUFFER,Dt,Je.width,Je.height);X.framebufferRenderbuffer(X.FRAMEBUFFER,X.DEPTH_ATTACHMENT,X.RENDERBUFFER,qe)}else if(Je.depthBuffer&&Je.stencilBuffer){const Dt=Ht(Je);mt&&Pt(Je)===!1?X.renderbufferStorageMultisample(X.RENDERBUFFER,Dt,X.DEPTH24_STENCIL8,Je.width,Je.height):Pt(Je)?de.renderbufferStorageMultisampleEXT(X.RENDERBUFFER,Dt,X.DEPTH24_STENCIL8,Je.width,Je.height):X.renderbufferStorage(X.RENDERBUFFER,X.DEPTH_STENCIL,Je.width,Je.height),X.framebufferRenderbuffer(X.FRAMEBUFFER,X.DEPTH_STENCIL_ATTACHMENT,X.RENDERBUFFER,qe)}else{const Dt=Je.isWebGLMultipleRenderTargets===!0?Je.texture:[Je.texture];for(let _t=0;_t<Dt.length;_t++){const zt=Dt[_t],nn=ne.convert(zt.format,zt.colorSpace),tn=ne.convert(zt.type),Ft=Ve(zt.internalFormat,nn,tn,zt.colorSpace),pn=Ht(Je);mt&&Pt(Je)===!1?X.renderbufferStorageMultisample(X.RENDERBUFFER,pn,Ft,Je.width,Je.height):Pt(Je)?de.renderbufferStorageMultisampleEXT(X.RENDERBUFFER,pn,Ft,Je.width,Je.height):X.renderbufferStorage(X.RENDERBUFFER,Ft,Je.width,Je.height)}}X.bindRenderbuffer(X.RENDERBUFFER,null)}function Vt(qe,Je){if(Je&&Je.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(_.bindFramebuffer(X.FRAMEBUFFER,qe),!(Je.depthTexture&&Je.depthTexture.isDepthTexture))throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");(!K.get(Je.depthTexture).__webglTexture||Je.depthTexture.image.width!==Je.width||Je.depthTexture.image.height!==Je.height)&&(Je.depthTexture.image.width=Je.width,Je.depthTexture.image.height=Je.height,Je.depthTexture.needsUpdate=!0),je(Je.depthTexture,0);const Dt=K.get(Je.depthTexture).__webglTexture,_t=Ht(Je);if(Je.depthTexture.format===DepthFormat)Pt(Je)?de.framebufferTexture2DMultisampleEXT(X.FRAMEBUFFER,X.DEPTH_ATTACHMENT,X.TEXTURE_2D,Dt,0,_t):X.framebufferTexture2D(X.FRAMEBUFFER,X.DEPTH_ATTACHMENT,X.TEXTURE_2D,Dt,0);else if(Je.depthTexture.format===DepthStencilFormat)Pt(Je)?de.framebufferTexture2DMultisampleEXT(X.FRAMEBUFFER,X.DEPTH_STENCIL_ATTACHMENT,X.TEXTURE_2D,Dt,0,_t):X.framebufferTexture2D(X.FRAMEBUFFER,X.DEPTH_STENCIL_ATTACHMENT,X.TEXTURE_2D,Dt,0);else throw new Error("Unknown depthTexture format")}function wt(qe){const Je=K.get(qe),mt=qe.isWebGLCubeRenderTarget===!0;if(qe.depthTexture&&!Je.__autoAllocateDepthBuffer){if(mt)throw new Error("target.depthTexture not supported in Cube render targets");Vt(Je.__webglFramebuffer,qe)}else if(mt){Je.__webglDepthbuffer=[];for(let Dt=0;Dt<6;Dt++)_.bindFramebuffer(X.FRAMEBUFFER,Je.__webglFramebuffer[Dt]),Je.__webglDepthbuffer[Dt]=X.createRenderbuffer(),st(Je.__webglDepthbuffer[Dt],qe,!1)}else _.bindFramebuffer(X.FRAMEBUFFER,Je.__webglFramebuffer),Je.__webglDepthbuffer=X.createRenderbuffer(),st(Je.__webglDepthbuffer,qe,!1);_.bindFramebuffer(X.FRAMEBUFFER,null)}function St(qe,Je,mt){const Dt=K.get(qe);Je!==void 0&&Zt(Dt.__webglFramebuffer,qe,qe.texture,X.COLOR_ATTACHMENT0,X.TEXTURE_2D),mt!==void 0&&wt(qe)}function Rt(qe){const Je=qe.texture,mt=K.get(qe),Dt=K.get(Je);qe.addEventListener("dispose",He),qe.isWebGLMultipleRenderTargets!==!0&&(Dt.__webglTexture===void 0&&(Dt.__webglTexture=X.createTexture()),Dt.__version=Je.version,oe.memory.textures++);const _t=qe.isWebGLCubeRenderTarget===!0,zt=qe.isWebGLMultipleRenderTargets===!0,nn=Re(qe)||ie;if(_t){mt.__webglFramebuffer=[];for(let tn=0;tn<6;tn++)mt.__webglFramebuffer[tn]=X.createFramebuffer()}else{if(mt.__webglFramebuffer=X.createFramebuffer(),zt)if(te.drawBuffers){const tn=qe.texture;for(let Ft=0,pn=tn.length;Ft<pn;Ft++){const sn=K.get(tn[Ft]);sn.__webglTexture===void 0&&(sn.__webglTexture=X.createTexture(),oe.memory.textures++)}}else console.warn("THREE.WebGLRenderer: WebGLMultipleRenderTargets can only be used with WebGL2 or WEBGL_draw_buffers extension.");if(ie&&qe.samples>0&&Pt(qe)===!1){const tn=zt?Je:[Je];mt.__webglMultisampledFramebuffer=X.createFramebuffer(),mt.__webglColorRenderbuffer=[],_.bindFramebuffer(X.FRAMEBUFFER,mt.__webglMultisampledFramebuffer);for(let Ft=0;Ft<tn.length;Ft++){const pn=tn[Ft];mt.__webglColorRenderbuffer[Ft]=X.createRenderbuffer(),X.bindRenderbuffer(X.RENDERBUFFER,mt.__webglColorRenderbuffer[Ft]);const sn=ne.convert(pn.format,pn.colorSpace),rn=ne.convert(pn.type),$t=Ve(pn.internalFormat,sn,rn,pn.colorSpace,qe.isXRRenderTarget===!0),on=Ht(qe);X.renderbufferStorageMultisample(X.RENDERBUFFER,on,$t,qe.width,qe.height),X.framebufferRenderbuffer(X.FRAMEBUFFER,X.COLOR_ATTACHMENT0+Ft,X.RENDERBUFFER,mt.__webglColorRenderbuffer[Ft])}X.bindRenderbuffer(X.RENDERBUFFER,null),qe.depthBuffer&&(mt.__webglDepthRenderbuffer=X.createRenderbuffer(),st(mt.__webglDepthRenderbuffer,qe,!0)),_.bindFramebuffer(X.FRAMEBUFFER,null)}}if(_t){_.bindTexture(X.TEXTURE_CUBE_MAP,Dt.__webglTexture),ht(X.TEXTURE_CUBE_MAP,Je,nn);for(let tn=0;tn<6;tn++)Zt(mt.__webglFramebuffer[tn],qe,Je,X.COLOR_ATTACHMENT0,X.TEXTURE_CUBE_MAP_POSITIVE_X+tn);We(Je,nn)&&Ze(X.TEXTURE_CUBE_MAP),_.unbindTexture()}else if(zt){const tn=qe.texture;for(let Ft=0,pn=tn.length;Ft<pn;Ft++){const sn=tn[Ft],rn=K.get(sn);_.bindTexture(X.TEXTURE_2D,rn.__webglTexture),ht(X.TEXTURE_2D,sn,nn),Zt(mt.__webglFramebuffer,qe,sn,X.COLOR_ATTACHMENT0+Ft,X.TEXTURE_2D),We(sn,nn)&&Ze(X.TEXTURE_2D)}_.unbindTexture()}else{let tn=X.TEXTURE_2D;(qe.isWebGL3DRenderTarget||qe.isWebGLArrayRenderTarget)&&(ie?tn=qe.isWebGL3DRenderTarget?X.TEXTURE_3D:X.TEXTURE_2D_ARRAY:console.error("THREE.WebGLTextures: THREE.Data3DTexture and THREE.DataArrayTexture only supported with WebGL2.")),_.bindTexture(tn,Dt.__webglTexture),ht(tn,Je,nn),Zt(mt.__webglFramebuffer,qe,Je,X.COLOR_ATTACHMENT0,tn),We(Je,nn)&&Ze(tn),_.unbindTexture()}qe.depthBuffer&&wt(qe)}function jt(qe){const Je=Re(qe)||ie,mt=qe.isWebGLMultipleRenderTargets===!0?qe.texture:[qe.texture];for(let Dt=0,_t=mt.length;Dt<_t;Dt++){const zt=mt[Dt];if(We(zt,Je)){const nn=qe.isWebGLCubeRenderTarget?X.TEXTURE_CUBE_MAP:X.TEXTURE_2D,tn=K.get(zt).__webglTexture;_.bindTexture(nn,tn),Ze(nn),_.unbindTexture()}}}function Wt(qe){if(ie&&qe.samples>0&&Pt(qe)===!1){const Je=qe.isWebGLMultipleRenderTargets?qe.texture:[qe.texture],mt=qe.width,Dt=qe.height;let _t=X.COLOR_BUFFER_BIT;const zt=[],nn=qe.stencilBuffer?X.DEPTH_STENCIL_ATTACHMENT:X.DEPTH_ATTACHMENT,tn=K.get(qe),Ft=qe.isWebGLMultipleRenderTargets===!0;if(Ft)for(let pn=0;pn<Je.length;pn++)_.bindFramebuffer(X.FRAMEBUFFER,tn.__webglMultisampledFramebuffer),X.framebufferRenderbuffer(X.FRAMEBUFFER,X.COLOR_ATTACHMENT0+pn,X.RENDERBUFFER,null),_.bindFramebuffer(X.FRAMEBUFFER,tn.__webglFramebuffer),X.framebufferTexture2D(X.DRAW_FRAMEBUFFER,X.COLOR_ATTACHMENT0+pn,X.TEXTURE_2D,null,0);_.bindFramebuffer(X.READ_FRAMEBUFFER,tn.__webglMultisampledFramebuffer),_.bindFramebuffer(X.DRAW_FRAMEBUFFER,tn.__webglFramebuffer);for(let pn=0;pn<Je.length;pn++){zt.push(X.COLOR_ATTACHMENT0+pn),qe.depthBuffer&&zt.push(nn);const sn=tn.__ignoreDepthValues!==void 0?tn.__ignoreDepthValues:!1;if(sn===!1&&(qe.depthBuffer&&(_t|=X.DEPTH_BUFFER_BIT),qe.stencilBuffer&&(_t|=X.STENCIL_BUFFER_BIT)),Ft&&X.framebufferRenderbuffer(X.READ_FRAMEBUFFER,X.COLOR_ATTACHMENT0,X.RENDERBUFFER,tn.__webglColorRenderbuffer[pn]),sn===!0&&(X.invalidateFramebuffer(X.READ_FRAMEBUFFER,[nn]),X.invalidateFramebuffer(X.DRAW_FRAMEBUFFER,[nn])),Ft){const rn=K.get(Je[pn]).__webglTexture;X.framebufferTexture2D(X.DRAW_FRAMEBUFFER,X.COLOR_ATTACHMENT0,X.TEXTURE_2D,rn,0)}X.blitFramebuffer(0,0,mt,Dt,0,0,mt,Dt,_t,X.NEAREST),pe&&X.invalidateFramebuffer(X.READ_FRAMEBUFFER,zt)}if(_.bindFramebuffer(X.READ_FRAMEBUFFER,null),_.bindFramebuffer(X.DRAW_FRAMEBUFFER,null),Ft)for(let pn=0;pn<Je.length;pn++){_.bindFramebuffer(X.FRAMEBUFFER,tn.__webglMultisampledFramebuffer),X.framebufferRenderbuffer(X.FRAMEBUFFER,X.COLOR_ATTACHMENT0+pn,X.RENDERBUFFER,tn.__webglColorRenderbuffer[pn]);const sn=K.get(Je[pn]).__webglTexture;_.bindFramebuffer(X.FRAMEBUFFER,tn.__webglFramebuffer),X.framebufferTexture2D(X.DRAW_FRAMEBUFFER,X.COLOR_ATTACHMENT0+pn,X.TEXTURE_2D,sn,0)}_.bindFramebuffer(X.DRAW_FRAMEBUFFER,tn.__webglMultisampledFramebuffer)}}function Ht(qe){return Math.min(ce,qe.samples)}function Pt(qe){const Je=K.get(qe);return ie&&qe.samples>0&&Z.has("WEBGL_multisampled_render_to_texture")===!0&&Je.__useRenderToTexture!==!1}function Mt(qe){const Je=oe.render.frame;fe.get(qe)!==Je&&(fe.set(qe,Je),qe.update())}function un(qe,Je){const mt=qe.colorSpace,Dt=qe.format,_t=qe.type;return qe.isCompressedTexture===!0||qe.format===_SRGBAFormat||mt!==LinearSRGBColorSpace$1&&mt!==NoColorSpace&&(mt===SRGBColorSpace$1?ie===!1?Z.has("EXT_sRGB")===!0&&Dt===RGBAFormat?(qe.format=_SRGBAFormat,qe.minFilter=LinearFilter,qe.generateMipmaps=!1):Je=ImageUtils.sRGBToLinear(Je):(Dt!==RGBAFormat||_t!==UnsignedByteType)&&console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture color space:",mt)),Je}this.allocateTextureUnit=Oe,this.resetTextureUnits=at,this.setTexture2D=je,this.setTexture2DArray=Te,this.setTexture3D=De,this.setTextureCube=ot,this.rebindTextures=St,this.setupRenderTarget=Rt,this.updateRenderTargetMipmap=jt,this.updateMultisampleRenderTarget=Wt,this.setupDepthRenderbuffer=wt,this.setupFrameBufferTexture=Zt,this.useMultisampledRTT=Pt}function WebGLUtils(X,Z,_){const K=_.isWebGL2;function te(ne,oe=NoColorSpace){let ie;if(ne===UnsignedByteType)return X.UNSIGNED_BYTE;if(ne===UnsignedShort4444Type)return X.UNSIGNED_SHORT_4_4_4_4;if(ne===UnsignedShort5551Type)return X.UNSIGNED_SHORT_5_5_5_1;if(ne===ByteType)return X.BYTE;if(ne===ShortType)return X.SHORT;if(ne===UnsignedShortType)return X.UNSIGNED_SHORT;if(ne===IntType)return X.INT;if(ne===UnsignedIntType)return X.UNSIGNED_INT;if(ne===FloatType)return X.FLOAT;if(ne===HalfFloatType)return K?X.HALF_FLOAT:(ie=Z.get("OES_texture_half_float"),ie!==null?ie.HALF_FLOAT_OES:null);if(ne===AlphaFormat)return X.ALPHA;if(ne===RGBAFormat)return X.RGBA;if(ne===LuminanceFormat)return X.LUMINANCE;if(ne===LuminanceAlphaFormat)return X.LUMINANCE_ALPHA;if(ne===DepthFormat)return X.DEPTH_COMPONENT;if(ne===DepthStencilFormat)return X.DEPTH_STENCIL;if(ne===_SRGBAFormat)return ie=Z.get("EXT_sRGB"),ie!==null?ie.SRGB_ALPHA_EXT:null;if(ne===RedFormat)return X.RED;if(ne===RedIntegerFormat)return X.RED_INTEGER;if(ne===RGFormat)return X.RG;if(ne===RGIntegerFormat)return X.RG_INTEGER;if(ne===RGBAIntegerFormat)return X.RGBA_INTEGER;if(ne===RGB_S3TC_DXT1_Format||ne===RGBA_S3TC_DXT1_Format||ne===RGBA_S3TC_DXT3_Format||ne===RGBA_S3TC_DXT5_Format)if(oe===SRGBColorSpace$1)if(ie=Z.get("WEBGL_compressed_texture_s3tc_srgb"),ie!==null){if(ne===RGB_S3TC_DXT1_Format)return ie.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(ne===RGBA_S3TC_DXT1_Format)return ie.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(ne===RGBA_S3TC_DXT3_Format)return ie.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(ne===RGBA_S3TC_DXT5_Format)return ie.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else return null;else if(ie=Z.get("WEBGL_compressed_texture_s3tc"),ie!==null){if(ne===RGB_S3TC_DXT1_Format)return ie.COMPRESSED_RGB_S3TC_DXT1_EXT;if(ne===RGBA_S3TC_DXT1_Format)return ie.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(ne===RGBA_S3TC_DXT3_Format)return ie.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(ne===RGBA_S3TC_DXT5_Format)return ie.COMPRESSED_RGBA_S3TC_DXT5_EXT}else return null;if(ne===RGB_PVRTC_4BPPV1_Format||ne===RGB_PVRTC_2BPPV1_Format||ne===RGBA_PVRTC_4BPPV1_Format||ne===RGBA_PVRTC_2BPPV1_Format)if(ie=Z.get("WEBGL_compressed_texture_pvrtc"),ie!==null){if(ne===RGB_PVRTC_4BPPV1_Format)return ie.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(ne===RGB_PVRTC_2BPPV1_Format)return ie.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(ne===RGBA_PVRTC_4BPPV1_Format)return ie.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(ne===RGBA_PVRTC_2BPPV1_Format)return ie.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}else return null;if(ne===RGB_ETC1_Format)return ie=Z.get("WEBGL_compressed_texture_etc1"),ie!==null?ie.COMPRESSED_RGB_ETC1_WEBGL:null;if(ne===RGB_ETC2_Format||ne===RGBA_ETC2_EAC_Format)if(ie=Z.get("WEBGL_compressed_texture_etc"),ie!==null){if(ne===RGB_ETC2_Format)return oe===SRGBColorSpace$1?ie.COMPRESSED_SRGB8_ETC2:ie.COMPRESSED_RGB8_ETC2;if(ne===RGBA_ETC2_EAC_Format)return oe===SRGBColorSpace$1?ie.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:ie.COMPRESSED_RGBA8_ETC2_EAC}else return null;if(ne===RGBA_ASTC_4x4_Format||ne===RGBA_ASTC_5x4_Format||ne===RGBA_ASTC_5x5_Format||ne===RGBA_ASTC_6x5_Format||ne===RGBA_ASTC_6x6_Format||ne===RGBA_ASTC_8x5_Format||ne===RGBA_ASTC_8x6_Format||ne===RGBA_ASTC_8x8_Format||ne===RGBA_ASTC_10x5_Format||ne===RGBA_ASTC_10x6_Format||ne===RGBA_ASTC_10x8_Format||ne===RGBA_ASTC_10x10_Format||ne===RGBA_ASTC_12x10_Format||ne===RGBA_ASTC_12x12_Format)if(ie=Z.get("WEBGL_compressed_texture_astc"),ie!==null){if(ne===RGBA_ASTC_4x4_Format)return oe===SRGBColorSpace$1?ie.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:ie.COMPRESSED_RGBA_ASTC_4x4_KHR;if(ne===RGBA_ASTC_5x4_Format)return oe===SRGBColorSpace$1?ie.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:ie.COMPRESSED_RGBA_ASTC_5x4_KHR;if(ne===RGBA_ASTC_5x5_Format)return oe===SRGBColorSpace$1?ie.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:ie.COMPRESSED_RGBA_ASTC_5x5_KHR;if(ne===RGBA_ASTC_6x5_Format)return oe===SRGBColorSpace$1?ie.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:ie.COMPRESSED_RGBA_ASTC_6x5_KHR;if(ne===RGBA_ASTC_6x6_Format)return oe===SRGBColorSpace$1?ie.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:ie.COMPRESSED_RGBA_ASTC_6x6_KHR;if(ne===RGBA_ASTC_8x5_Format)return oe===SRGBColorSpace$1?ie.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:ie.COMPRESSED_RGBA_ASTC_8x5_KHR;if(ne===RGBA_ASTC_8x6_Format)return oe===SRGBColorSpace$1?ie.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:ie.COMPRESSED_RGBA_ASTC_8x6_KHR;if(ne===RGBA_ASTC_8x8_Format)return oe===SRGBColorSpace$1?ie.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:ie.COMPRESSED_RGBA_ASTC_8x8_KHR;if(ne===RGBA_ASTC_10x5_Format)return oe===SRGBColorSpace$1?ie.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:ie.COMPRESSED_RGBA_ASTC_10x5_KHR;if(ne===RGBA_ASTC_10x6_Format)return oe===SRGBColorSpace$1?ie.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:ie.COMPRESSED_RGBA_ASTC_10x6_KHR;if(ne===RGBA_ASTC_10x8_Format)return oe===SRGBColorSpace$1?ie.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:ie.COMPRESSED_RGBA_ASTC_10x8_KHR;if(ne===RGBA_ASTC_10x10_Format)return oe===SRGBColorSpace$1?ie.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:ie.COMPRESSED_RGBA_ASTC_10x10_KHR;if(ne===RGBA_ASTC_12x10_Format)return oe===SRGBColorSpace$1?ie.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:ie.COMPRESSED_RGBA_ASTC_12x10_KHR;if(ne===RGBA_ASTC_12x12_Format)return oe===SRGBColorSpace$1?ie.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:ie.COMPRESSED_RGBA_ASTC_12x12_KHR}else return null;if(ne===RGBA_BPTC_Format)if(ie=Z.get("EXT_texture_compression_bptc"),ie!==null){if(ne===RGBA_BPTC_Format)return oe===SRGBColorSpace$1?ie.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:ie.COMPRESSED_RGBA_BPTC_UNORM_EXT}else return null;if(ne===RED_RGTC1_Format||ne===SIGNED_RED_RGTC1_Format||ne===RED_GREEN_RGTC2_Format||ne===SIGNED_RED_GREEN_RGTC2_Format)if(ie=Z.get("EXT_texture_compression_rgtc"),ie!==null){if(ne===RGBA_BPTC_Format)return ie.COMPRESSED_RED_RGTC1_EXT;if(ne===SIGNED_RED_RGTC1_Format)return ie.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(ne===RED_GREEN_RGTC2_Format)return ie.COMPRESSED_RED_GREEN_RGTC2_EXT;if(ne===SIGNED_RED_GREEN_RGTC2_Format)return ie.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}else return null;return ne===UnsignedInt248Type?K?X.UNSIGNED_INT_24_8:(ie=Z.get("WEBGL_depth_texture"),ie!==null?ie.UNSIGNED_INT_24_8_WEBGL:null):X[ne]!==void 0?X[ne]:null}return{convert:te}}class ArrayCamera extends PerspectiveCamera{constructor(Z=[]){super(),this.isArrayCamera=!0,this.cameras=Z}}class Group extends Object3D{constructor(){super(),this.isGroup=!0,this.type="Group"}}const _moveEvent={type:"move"};class WebXRController{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return this._hand===null&&(this._hand=new Group,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return this._targetRay===null&&(this._targetRay=new Group,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new Vector3,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new Vector3),this._targetRay}getGripSpace(){return this._grip===null&&(this._grip=new Group,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new Vector3,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new Vector3),this._grip}dispatchEvent(Z){return this._targetRay!==null&&this._targetRay.dispatchEvent(Z),this._grip!==null&&this._grip.dispatchEvent(Z),this._hand!==null&&this._hand.dispatchEvent(Z),this}connect(Z){if(Z&&Z.hand){const _=this._hand;if(_)for(const K of Z.hand.values())this._getHandJoint(_,K)}return this.dispatchEvent({type:"connected",data:Z}),this}disconnect(Z){return this.dispatchEvent({type:"disconnected",data:Z}),this._targetRay!==null&&(this._targetRay.visible=!1),this._grip!==null&&(this._grip.visible=!1),this._hand!==null&&(this._hand.visible=!1),this}update(Z,_,K){let te=null,ne=null,oe=null;const ie=this._targetRay,se=this._grip,ae=this._hand;if(Z&&_.session.visibilityState!=="visible-blurred"){if(ae&&Z.hand){oe=!0;for(const be of Z.hand.values()){const me=_.getJointPose(be,K),ye=this._getHandJoint(ae,be);me!==null&&(ye.matrix.fromArray(me.transform.matrix),ye.matrix.decompose(ye.position,ye.rotation,ye.scale),ye.matrixWorldNeedsUpdate=!0,ye.jointRadius=me.radius),ye.visible=me!==null}const ge=ae.joints["index-finger-tip"],ce=ae.joints["thumb-tip"],de=ge.position.distanceTo(ce.position),pe=.02,fe=.005;ae.inputState.pinching&&de>pe+fe?(ae.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:Z.handedness,target:this})):!ae.inputState.pinching&&de<=pe-fe&&(ae.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:Z.handedness,target:this}))}else se!==null&&Z.gripSpace&&(ne=_.getPose(Z.gripSpace,K),ne!==null&&(se.matrix.fromArray(ne.transform.matrix),se.matrix.decompose(se.position,se.rotation,se.scale),se.matrixWorldNeedsUpdate=!0,ne.linearVelocity?(se.hasLinearVelocity=!0,se.linearVelocity.copy(ne.linearVelocity)):se.hasLinearVelocity=!1,ne.angularVelocity?(se.hasAngularVelocity=!0,se.angularVelocity.copy(ne.angularVelocity)):se.hasAngularVelocity=!1));ie!==null&&(te=_.getPose(Z.targetRaySpace,K),te===null&&ne!==null&&(te=ne),te!==null&&(ie.matrix.fromArray(te.transform.matrix),ie.matrix.decompose(ie.position,ie.rotation,ie.scale),ie.matrixWorldNeedsUpdate=!0,te.linearVelocity?(ie.hasLinearVelocity=!0,ie.linearVelocity.copy(te.linearVelocity)):ie.hasLinearVelocity=!1,te.angularVelocity?(ie.hasAngularVelocity=!0,ie.angularVelocity.copy(te.angularVelocity)):ie.hasAngularVelocity=!1,this.dispatchEvent(_moveEvent)))}return ie!==null&&(ie.visible=te!==null),se!==null&&(se.visible=ne!==null),ae!==null&&(ae.visible=oe!==null),this}_getHandJoint(Z,_){if(Z.joints[_.jointName]===void 0){const K=new Group;K.matrixAutoUpdate=!1,K.visible=!1,Z.joints[_.jointName]=K,Z.add(K)}return Z.joints[_.jointName]}}class DepthTexture extends Texture{constructor(Z,_,K,te,ne,oe,ie,se,ae,ge){if(ge=ge!==void 0?ge:DepthFormat,ge!==DepthFormat&&ge!==DepthStencilFormat)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");K===void 0&&ge===DepthFormat&&(K=UnsignedIntType),K===void 0&&ge===DepthStencilFormat&&(K=UnsignedInt248Type),super(null,te,ne,oe,ie,se,ge,K,ae),this.isDepthTexture=!0,this.image={width:Z,height:_},this.magFilter=ie!==void 0?ie:NearestFilter,this.minFilter=se!==void 0?se:NearestFilter,this.flipY=!1,this.generateMipmaps=!1,this.compareFunction=null}copy(Z){return super.copy(Z),this.compareFunction=Z.compareFunction,this}toJSON(Z){const _=super.toJSON(Z);return this.compareFunction!==null&&(_.compareFunction=this.compareFunction),_}}class WebXRManager extends EventDispatcher{constructor(Z,_){super();const K=this;let te=null,ne=1,oe=null,ie="local-floor",se=1,ae=null,ge=null,ce=null,de=null,pe=null,fe=null;const be=_.getContextAttributes();let me=null,ye=null;const ve=[],Be=[],Re=new PerspectiveCamera;Re.layers.enable(1),Re.viewport=new Vector4;const Ee=new PerspectiveCamera;Ee.layers.enable(2),Ee.viewport=new Vector4;const We=[Re,Ee],Ze=new ArrayCamera;Ze.layers.enable(1),Ze.layers.enable(2);let Ve=null,_e=null;this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(Te){let De=ve[Te];return De===void 0&&(De=new WebXRController,ve[Te]=De),De.getTargetRaySpace()},this.getControllerGrip=function(Te){let De=ve[Te];return De===void 0&&(De=new WebXRController,ve[Te]=De),De.getGripSpace()},this.getHand=function(Te){let De=ve[Te];return De===void 0&&(De=new WebXRController,ve[Te]=De),De.getHandSpace()};function Xe(Te){const De=Be.indexOf(Te.inputSource);if(De===-1)return;const ot=ve[De];ot!==void 0&&(ot.update(Te.inputSource,Te.frame,ae||oe),ot.dispatchEvent({type:Te.type,data:Te.inputSource}))}function Pe(){te.removeEventListener("select",Xe),te.removeEventListener("selectstart",Xe),te.removeEventListener("selectend",Xe),te.removeEventListener("squeeze",Xe),te.removeEventListener("squeezestart",Xe),te.removeEventListener("squeezeend",Xe),te.removeEventListener("end",Pe),te.removeEventListener("inputsourceschange",He);for(let Te=0;Te<ve.length;Te++){const De=Be[Te];De!==null&&(Be[Te]=null,ve[Te].disconnect(De))}Ve=null,_e=null,Z.setRenderTarget(me),pe=null,de=null,ce=null,te=null,ye=null,je.stop(),K.isPresenting=!1,K.dispatchEvent({type:"sessionend"})}this.setFramebufferScaleFactor=function(Te){ne=Te,K.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(Te){ie=Te,K.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return ae||oe},this.setReferenceSpace=function(Te){ae=Te},this.getBaseLayer=function(){return de!==null?de:pe},this.getBinding=function(){return ce},this.getFrame=function(){return fe},this.getSession=function(){return te},this.setSession=async function(Te){if(te=Te,te!==null){if(me=Z.getRenderTarget(),te.addEventListener("select",Xe),te.addEventListener("selectstart",Xe),te.addEventListener("selectend",Xe),te.addEventListener("squeeze",Xe),te.addEventListener("squeezestart",Xe),te.addEventListener("squeezeend",Xe),te.addEventListener("end",Pe),te.addEventListener("inputsourceschange",He),be.xrCompatible!==!0&&await _.makeXRCompatible(),te.renderState.layers===void 0||Z.capabilities.isWebGL2===!1){const De={antialias:te.renderState.layers===void 0?be.antialias:!0,alpha:!0,depth:be.depth,stencil:be.stencil,framebufferScaleFactor:ne};pe=new XRWebGLLayer(te,_,De),te.updateRenderState({baseLayer:pe}),ye=new WebGLRenderTarget(pe.framebufferWidth,pe.framebufferHeight,{format:RGBAFormat,type:UnsignedByteType,colorSpace:Z.outputColorSpace,stencilBuffer:be.stencil})}else{let De=null,ot=null,ct=null;be.depth&&(ct=be.stencil?_.DEPTH24_STENCIL8:_.DEPTH_COMPONENT24,De=be.stencil?DepthStencilFormat:DepthFormat,ot=be.stencil?UnsignedInt248Type:UnsignedIntType);const gt={colorFormat:_.RGBA8,depthFormat:ct,scaleFactor:ne};ce=new XRWebGLBinding(te,_),de=ce.createProjectionLayer(gt),te.updateRenderState({layers:[de]}),ye=new WebGLRenderTarget(de.textureWidth,de.textureHeight,{format:RGBAFormat,type:UnsignedByteType,depthTexture:new DepthTexture(de.textureWidth,de.textureHeight,ot,void 0,void 0,void 0,void 0,void 0,void 0,De),stencilBuffer:be.stencil,colorSpace:Z.outputColorSpace,samples:be.antialias?4:0});const pt=Z.properties.get(ye);pt.__ignoreDepthValues=de.ignoreDepthValues}ye.isXRRenderTarget=!0,this.setFoveation(se),ae=null,oe=await te.requestReferenceSpace(ie),je.setContext(te),je.start(),K.isPresenting=!0,K.dispatchEvent({type:"sessionstart"})}},this.getEnvironmentBlendMode=function(){if(te!==null)return te.environmentBlendMode};function He(Te){for(let De=0;De<Te.removed.length;De++){const ot=Te.removed[De],ct=Be.indexOf(ot);ct>=0&&(Be[ct]=null,ve[ct].disconnect(ot))}for(let De=0;De<Te.added.length;De++){const ot=Te.added[De];let ct=Be.indexOf(ot);if(ct===-1){for(let pt=0;pt<ve.length;pt++)if(pt>=Be.length){Be.push(ot),ct=pt;break}else if(Be[pt]===null){Be[pt]=ot,ct=pt;break}if(ct===-1)break}const gt=ve[ct];gt&&gt.connect(ot)}}const Ke=new Vector3,Ue=new Vector3;function tt(Te,De,ot){Ke.setFromMatrixPosition(De.matrixWorld),Ue.setFromMatrixPosition(ot.matrixWorld);const ct=Ke.distanceTo(Ue),gt=De.projectionMatrix.elements,pt=ot.projectionMatrix.elements,ht=gt[14]/(gt[10]-1),At=gt[14]/(gt[10]+1),Kt=(gt[9]+1)/gt[5],en=(gt[9]-1)/gt[5],Zt=(gt[8]-1)/gt[0],st=(pt[8]+1)/pt[0],Vt=ht*Zt,wt=ht*st,St=ct/(-Zt+st),Rt=St*-Zt;De.matrixWorld.decompose(Te.position,Te.quaternion,Te.scale),Te.translateX(Rt),Te.translateZ(St),Te.matrixWorld.compose(Te.position,Te.quaternion,Te.scale),Te.matrixWorldInverse.copy(Te.matrixWorld).invert();const jt=ht+St,Wt=At+St,Ht=Vt-Rt,Pt=wt+(ct-Rt),Mt=Kt*At/Wt*jt,un=en*At/Wt*jt;Te.projectionMatrix.makePerspective(Ht,Pt,Mt,un,jt,Wt),Te.projectionMatrixInverse.copy(Te.projectionMatrix).invert()}function rt(Te,De){De===null?Te.matrixWorld.copy(Te.matrix):Te.matrixWorld.multiplyMatrices(De.matrixWorld,Te.matrix),Te.matrixWorldInverse.copy(Te.matrixWorld).invert()}this.updateCamera=function(Te){if(te===null)return;Ze.near=Ee.near=Re.near=Te.near,Ze.far=Ee.far=Re.far=Te.far,(Ve!==Ze.near||_e!==Ze.far)&&(te.updateRenderState({depthNear:Ze.near,depthFar:Ze.far}),Ve=Ze.near,_e=Ze.far);const De=Te.parent,ot=Ze.cameras;rt(Ze,De);for(let ct=0;ct<ot.length;ct++)rt(ot[ct],De);ot.length===2?tt(Ze,Re,Ee):Ze.projectionMatrix.copy(Re.projectionMatrix),at(Te,Ze,De)};function at(Te,De,ot){ot===null?Te.matrix.copy(De.matrixWorld):(Te.matrix.copy(ot.matrixWorld),Te.matrix.invert(),Te.matrix.multiply(De.matrixWorld)),Te.matrix.decompose(Te.position,Te.quaternion,Te.scale),Te.updateMatrixWorld(!0);const ct=Te.children;for(let gt=0,pt=ct.length;gt<pt;gt++)ct[gt].updateMatrixWorld(!0);Te.projectionMatrix.copy(De.projectionMatrix),Te.projectionMatrixInverse.copy(De.projectionMatrixInverse),Te.isPerspectiveCamera&&(Te.fov=RAD2DEG*2*Math.atan(1/Te.projectionMatrix.elements[5]),Te.zoom=1)}this.getCamera=function(){return Ze},this.getFoveation=function(){if(!(de===null&&pe===null))return se},this.setFoveation=function(Te){se=Te,de!==null&&(de.fixedFoveation=Te),pe!==null&&pe.fixedFoveation!==void 0&&(pe.fixedFoveation=Te)};let Oe=null;function $e(Te,De){if(ge=De.getViewerPose(ae||oe),fe=De,ge!==null){const ot=ge.views;pe!==null&&(Z.setRenderTargetFramebuffer(ye,pe.framebuffer),Z.setRenderTarget(ye));let ct=!1;ot.length!==Ze.cameras.length&&(Ze.cameras.length=0,ct=!0);for(let gt=0;gt<ot.length;gt++){const pt=ot[gt];let ht=null;if(pe!==null)ht=pe.getViewport(pt);else{const Kt=ce.getViewSubImage(de,pt);ht=Kt.viewport,gt===0&&(Z.setRenderTargetTextures(ye,Kt.colorTexture,de.ignoreDepthValues?void 0:Kt.depthStencilTexture),Z.setRenderTarget(ye))}let At=We[gt];At===void 0&&(At=new PerspectiveCamera,At.layers.enable(gt),At.viewport=new Vector4,We[gt]=At),At.matrix.fromArray(pt.transform.matrix),At.matrix.decompose(At.position,At.quaternion,At.scale),At.projectionMatrix.fromArray(pt.projectionMatrix),At.projectionMatrixInverse.copy(At.projectionMatrix).invert(),At.viewport.set(ht.x,ht.y,ht.width,ht.height),gt===0&&(Ze.matrix.copy(At.matrix),Ze.matrix.decompose(Ze.position,Ze.quaternion,Ze.scale)),ct===!0&&Ze.cameras.push(At)}}for(let ot=0;ot<ve.length;ot++){const ct=Be[ot],gt=ve[ot];ct!==null&&gt!==void 0&&gt.update(ct,De,ae||oe)}Oe&&Oe(Te,De),De.detectedPlanes&&K.dispatchEvent({type:"planesdetected",data:De}),fe=null}const je=new WebGLAnimation;je.setAnimationLoop($e),this.setAnimationLoop=function(Te){Oe=Te},this.dispose=function(){}}}function WebGLMaterials(X,Z){function _(me,ye){me.matrixAutoUpdate===!0&&me.updateMatrix(),ye.value.copy(me.matrix)}function K(me,ye){ye.color.getRGB(me.fogColor.value,getUnlitUniformColorSpace(X)),ye.isFog?(me.fogNear.value=ye.near,me.fogFar.value=ye.far):ye.isFogExp2&&(me.fogDensity.value=ye.density)}function te(me,ye,ve,Be,Re){ye.isMeshBasicMaterial||ye.isMeshLambertMaterial?ne(me,ye):ye.isMeshToonMaterial?(ne(me,ye),ce(me,ye)):ye.isMeshPhongMaterial?(ne(me,ye),ge(me,ye)):ye.isMeshStandardMaterial?(ne(me,ye),de(me,ye),ye.isMeshPhysicalMaterial&&pe(me,ye,Re)):ye.isMeshMatcapMaterial?(ne(me,ye),fe(me,ye)):ye.isMeshDepthMaterial?ne(me,ye):ye.isMeshDistanceMaterial?(ne(me,ye),be(me,ye)):ye.isMeshNormalMaterial?ne(me,ye):ye.isLineBasicMaterial?(oe(me,ye),ye.isLineDashedMaterial&&ie(me,ye)):ye.isPointsMaterial?se(me,ye,ve,Be):ye.isSpriteMaterial?ae(me,ye):ye.isShadowMaterial?(me.color.value.copy(ye.color),me.opacity.value=ye.opacity):ye.isShaderMaterial&&(ye.uniformsNeedUpdate=!1)}function ne(me,ye){me.opacity.value=ye.opacity,ye.color&&me.diffuse.value.copy(ye.color),ye.emissive&&me.emissive.value.copy(ye.emissive).multiplyScalar(ye.emissiveIntensity),ye.map&&(me.map.value=ye.map,_(ye.map,me.mapTransform)),ye.alphaMap&&(me.alphaMap.value=ye.alphaMap,_(ye.alphaMap,me.alphaMapTransform)),ye.bumpMap&&(me.bumpMap.value=ye.bumpMap,_(ye.bumpMap,me.bumpMapTransform),me.bumpScale.value=ye.bumpScale,ye.side===BackSide&&(me.bumpScale.value*=-1)),ye.normalMap&&(me.normalMap.value=ye.normalMap,_(ye.normalMap,me.normalMapTransform),me.normalScale.value.copy(ye.normalScale),ye.side===BackSide&&me.normalScale.value.negate()),ye.displacementMap&&(me.displacementMap.value=ye.displacementMap,_(ye.displacementMap,me.displacementMapTransform),me.displacementScale.value=ye.displacementScale,me.displacementBias.value=ye.displacementBias),ye.emissiveMap&&(me.emissiveMap.value=ye.emissiveMap,_(ye.emissiveMap,me.emissiveMapTransform)),ye.specularMap&&(me.specularMap.value=ye.specularMap,_(ye.specularMap,me.specularMapTransform)),ye.alphaTest>0&&(me.alphaTest.value=ye.alphaTest);const ve=Z.get(ye).envMap;if(ve&&(me.envMap.value=ve,me.flipEnvMap.value=ve.isCubeTexture&&ve.isRenderTargetTexture===!1?-1:1,me.reflectivity.value=ye.reflectivity,me.ior.value=ye.ior,me.refractionRatio.value=ye.refractionRatio),ye.lightMap){me.lightMap.value=ye.lightMap;const Be=X.useLegacyLights===!0?Math.PI:1;me.lightMapIntensity.value=ye.lightMapIntensity*Be,_(ye.lightMap,me.lightMapTransform)}ye.aoMap&&(me.aoMap.value=ye.aoMap,me.aoMapIntensity.value=ye.aoMapIntensity,_(ye.aoMap,me.aoMapTransform))}function oe(me,ye){me.diffuse.value.copy(ye.color),me.opacity.value=ye.opacity,ye.map&&(me.map.value=ye.map,_(ye.map,me.mapTransform))}function ie(me,ye){me.dashSize.value=ye.dashSize,me.totalSize.value=ye.dashSize+ye.gapSize,me.scale.value=ye.scale}function se(me,ye,ve,Be){me.diffuse.value.copy(ye.color),me.opacity.value=ye.opacity,me.size.value=ye.size*ve,me.scale.value=Be*.5,ye.map&&(me.map.value=ye.map,_(ye.map,me.uvTransform)),ye.alphaMap&&(me.alphaMap.value=ye.alphaMap,_(ye.alphaMap,me.alphaMapTransform)),ye.alphaTest>0&&(me.alphaTest.value=ye.alphaTest)}function ae(me,ye){me.diffuse.value.copy(ye.color),me.opacity.value=ye.opacity,me.rotation.value=ye.rotation,ye.map&&(me.map.value=ye.map,_(ye.map,me.mapTransform)),ye.alphaMap&&(me.alphaMap.value=ye.alphaMap,_(ye.alphaMap,me.alphaMapTransform)),ye.alphaTest>0&&(me.alphaTest.value=ye.alphaTest)}function ge(me,ye){me.specular.value.copy(ye.specular),me.shininess.value=Math.max(ye.shininess,1e-4)}function ce(me,ye){ye.gradientMap&&(me.gradientMap.value=ye.gradientMap)}function de(me,ye){me.metalness.value=ye.metalness,ye.metalnessMap&&(me.metalnessMap.value=ye.metalnessMap,_(ye.metalnessMap,me.metalnessMapTransform)),me.roughness.value=ye.roughness,ye.roughnessMap&&(me.roughnessMap.value=ye.roughnessMap,_(ye.roughnessMap,me.roughnessMapTransform)),Z.get(ye).envMap&&(me.envMapIntensity.value=ye.envMapIntensity)}function pe(me,ye,ve){me.ior.value=ye.ior,ye.sheen>0&&(me.sheenColor.value.copy(ye.sheenColor).multiplyScalar(ye.sheen),me.sheenRoughness.value=ye.sheenRoughness,ye.sheenColorMap&&(me.sheenColorMap.value=ye.sheenColorMap,_(ye.sheenColorMap,me.sheenColorMapTransform)),ye.sheenRoughnessMap&&(me.sheenRoughnessMap.value=ye.sheenRoughnessMap,_(ye.sheenRoughnessMap,me.sheenRoughnessMapTransform))),ye.clearcoat>0&&(me.clearcoat.value=ye.clearcoat,me.clearcoatRoughness.value=ye.clearcoatRoughness,ye.clearcoatMap&&(me.clearcoatMap.value=ye.clearcoatMap,_(ye.clearcoatMap,me.clearcoatMapTransform)),ye.clearcoatRoughnessMap&&(me.clearcoatRoughnessMap.value=ye.clearcoatRoughnessMap,_(ye.clearcoatRoughnessMap,me.clearcoatRoughnessMapTransform)),ye.clearcoatNormalMap&&(me.clearcoatNormalMap.value=ye.clearcoatNormalMap,_(ye.clearcoatNormalMap,me.clearcoatNormalMapTransform),me.clearcoatNormalScale.value.copy(ye.clearcoatNormalScale),ye.side===BackSide&&me.clearcoatNormalScale.value.negate())),ye.iridescence>0&&(me.iridescence.value=ye.iridescence,me.iridescenceIOR.value=ye.iridescenceIOR,me.iridescenceThicknessMinimum.value=ye.iridescenceThicknessRange[0],me.iridescenceThicknessMaximum.value=ye.iridescenceThicknessRange[1],ye.iridescenceMap&&(me.iridescenceMap.value=ye.iridescenceMap,_(ye.iridescenceMap,me.iridescenceMapTransform)),ye.iridescenceThicknessMap&&(me.iridescenceThicknessMap.value=ye.iridescenceThicknessMap,_(ye.iridescenceThicknessMap,me.iridescenceThicknessMapTransform))),ye.transmission>0&&(me.transmission.value=ye.transmission,me.transmissionSamplerMap.value=ve.texture,me.transmissionSamplerSize.value.set(ve.width,ve.height),ye.transmissionMap&&(me.transmissionMap.value=ye.transmissionMap,_(ye.transmissionMap,me.transmissionMapTransform)),me.thickness.value=ye.thickness,ye.thicknessMap&&(me.thicknessMap.value=ye.thicknessMap,_(ye.thicknessMap,me.thicknessMapTransform)),me.attenuationDistance.value=ye.attenuationDistance,me.attenuationColor.value.copy(ye.attenuationColor)),ye.anisotropy>0&&(me.anisotropyVector.value.set(ye.anisotropy*Math.cos(ye.anisotropyRotation),ye.anisotropy*Math.sin(ye.anisotropyRotation)),ye.anisotropyMap&&(me.anisotropyMap.value=ye.anisotropyMap,_(ye.anisotropyMap,me.anisotropyMapTransform))),me.specularIntensity.value=ye.specularIntensity,me.specularColor.value.copy(ye.specularColor),ye.specularColorMap&&(me.specularColorMap.value=ye.specularColorMap,_(ye.specularColorMap,me.specularColorMapTransform)),ye.specularIntensityMap&&(me.specularIntensityMap.value=ye.specularIntensityMap,_(ye.specularIntensityMap,me.specularIntensityMapTransform))}function fe(me,ye){ye.matcap&&(me.matcap.value=ye.matcap)}function be(me,ye){const ve=Z.get(ye).light;me.referencePosition.value.setFromMatrixPosition(ve.matrixWorld),me.nearDistance.value=ve.shadow.camera.near,me.farDistance.value=ve.shadow.camera.far}return{refreshFogUniforms:K,refreshMaterialUniforms:te}}function WebGLUniformsGroups(X,Z,_,K){let te={},ne={},oe=[];const ie=_.isWebGL2?X.getParameter(X.MAX_UNIFORM_BUFFER_BINDINGS):0;function se(ve,Be){const Re=Be.program;K.uniformBlockBinding(ve,Re)}function ae(ve,Be){let Re=te[ve.id];Re===void 0&&(fe(ve),Re=ge(ve),te[ve.id]=Re,ve.addEventListener("dispose",me));const Ee=Be.program;K.updateUBOMapping(ve,Ee);const We=Z.render.frame;ne[ve.id]!==We&&(de(ve),ne[ve.id]=We)}function ge(ve){const Be=ce();ve.__bindingPointIndex=Be;const Re=X.createBuffer(),Ee=ve.__size,We=ve.usage;return X.bindBuffer(X.UNIFORM_BUFFER,Re),X.bufferData(X.UNIFORM_BUFFER,Ee,We),X.bindBuffer(X.UNIFORM_BUFFER,null),X.bindBufferBase(X.UNIFORM_BUFFER,Be,Re),Re}function ce(){for(let ve=0;ve<ie;ve++)if(oe.indexOf(ve)===-1)return oe.push(ve),ve;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}function de(ve){const Be=te[ve.id],Re=ve.uniforms,Ee=ve.__cache;X.bindBuffer(X.UNIFORM_BUFFER,Be);for(let We=0,Ze=Re.length;We<Ze;We++){const Ve=Re[We];if(pe(Ve,We,Ee)===!0){const _e=Ve.__offset,Xe=Array.isArray(Ve.value)?Ve.value:[Ve.value];let Pe=0;for(let He=0;He<Xe.length;He++){const Ke=Xe[He],Ue=be(Ke);typeof Ke=="number"?(Ve.__data[0]=Ke,X.bufferSubData(X.UNIFORM_BUFFER,_e+Pe,Ve.__data)):Ke.isMatrix3?(Ve.__data[0]=Ke.elements[0],Ve.__data[1]=Ke.elements[1],Ve.__data[2]=Ke.elements[2],Ve.__data[3]=Ke.elements[0],Ve.__data[4]=Ke.elements[3],Ve.__data[5]=Ke.elements[4],Ve.__data[6]=Ke.elements[5],Ve.__data[7]=Ke.elements[0],Ve.__data[8]=Ke.elements[6],Ve.__data[9]=Ke.elements[7],Ve.__data[10]=Ke.elements[8],Ve.__data[11]=Ke.elements[0]):(Ke.toArray(Ve.__data,Pe),Pe+=Ue.storage/Float32Array.BYTES_PER_ELEMENT)}X.bufferSubData(X.UNIFORM_BUFFER,_e,Ve.__data)}}X.bindBuffer(X.UNIFORM_BUFFER,null)}function pe(ve,Be,Re){const Ee=ve.value;if(Re[Be]===void 0){if(typeof Ee=="number")Re[Be]=Ee;else{const We=Array.isArray(Ee)?Ee:[Ee],Ze=[];for(let Ve=0;Ve<We.length;Ve++)Ze.push(We[Ve].clone());Re[Be]=Ze}return!0}else if(typeof Ee=="number"){if(Re[Be]!==Ee)return Re[Be]=Ee,!0}else{const We=Array.isArray(Re[Be])?Re[Be]:[Re[Be]],Ze=Array.isArray(Ee)?Ee:[Ee];for(let Ve=0;Ve<We.length;Ve++){const _e=We[Ve];if(_e.equals(Ze[Ve])===!1)return _e.copy(Ze[Ve]),!0}}return!1}function fe(ve){const Be=ve.uniforms;let Re=0;const Ee=16;let We=0;for(let Ze=0,Ve=Be.length;Ze<Ve;Ze++){const _e=Be[Ze],Xe={boundary:0,storage:0},Pe=Array.isArray(_e.value)?_e.value:[_e.value];for(let He=0,Ke=Pe.length;He<Ke;He++){const Ue=Pe[He],tt=be(Ue);Xe.boundary+=tt.boundary,Xe.storage+=tt.storage}if(_e.__data=new Float32Array(Xe.storage/Float32Array.BYTES_PER_ELEMENT),_e.__offset=Re,Ze>0){We=Re%Ee;const He=Ee-We;We!==0&&He-Xe.boundary<0&&(Re+=Ee-We,_e.__offset=Re)}Re+=Xe.storage}return We=Re%Ee,We>0&&(Re+=Ee-We),ve.__size=Re,ve.__cache={},this}function be(ve){const Be={boundary:0,storage:0};return typeof ve=="number"?(Be.boundary=4,Be.storage=4):ve.isVector2?(Be.boundary=8,Be.storage=8):ve.isVector3||ve.isColor?(Be.boundary=16,Be.storage=12):ve.isVector4?(Be.boundary=16,Be.storage=16):ve.isMatrix3?(Be.boundary=48,Be.storage=48):ve.isMatrix4?(Be.boundary=64,Be.storage=64):ve.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",ve),Be}function me(ve){const Be=ve.target;Be.removeEventListener("dispose",me);const Re=oe.indexOf(Be.__bindingPointIndex);oe.splice(Re,1),X.deleteBuffer(te[Be.id]),delete te[Be.id],delete ne[Be.id]}function ye(){for(const ve in te)X.deleteBuffer(te[ve]);oe=[],te={},ne={}}return{bind:se,update:ae,dispose:ye}}function createCanvasElement(){const X=createElementNS("canvas");return X.style.display="block",X}class WebGLRenderer{constructor(Z={}){const{canvas:_=createCanvasElement(),context:K=null,depth:te=!0,stencil:ne=!0,alpha:oe=!1,antialias:ie=!1,premultipliedAlpha:se=!0,preserveDrawingBuffer:ae=!1,powerPreference:ge="default",failIfMajorPerformanceCaveat:ce=!1}=Z;this.isWebGLRenderer=!0;let de;K!==null?de=K.getContextAttributes().alpha:de=oe;const pe=new Uint32Array(4),fe=new Int32Array(4);let be=null,me=null;const ye=[],ve=[];this.domElement=_,this.debug={checkShaderErrors:!0,onShaderError:null},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.outputColorSpace=SRGBColorSpace$1,this.useLegacyLights=!0,this.toneMapping=NoToneMapping,this.toneMappingExposure=1;const Be=this;let Re=!1,Ee=0,We=0,Ze=null,Ve=-1,_e=null;const Xe=new Vector4,Pe=new Vector4;let He=null;const Ke=new Color$1(0);let Ue=0,tt=_.width,rt=_.height,at=1,Oe=null,$e=null;const je=new Vector4(0,0,tt,rt),Te=new Vector4(0,0,tt,rt);let De=!1;const ot=new Frustum;let ct=!1,gt=!1,pt=null;const ht=new Matrix4,At=new Vector2,Kt=new Vector3,en={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function Zt(){return Ze===null?at:1}let st=K;function Vt(ke,it){for(let ut=0;ut<ke.length;ut++){const lt=ke[ut],It=_.getContext(lt,it);if(It!==null)return It}return null}try{const ke={alpha:!0,depth:te,stencil:ne,antialias:ie,premultipliedAlpha:se,preserveDrawingBuffer:ae,powerPreference:ge,failIfMajorPerformanceCaveat:ce};if("setAttribute"in _&&_.setAttribute("data-engine",`three.js r${REVISION}`),_.addEventListener("webglcontextlost",vt,!1),_.addEventListener("webglcontextrestored",Et,!1),_.addEventListener("webglcontextcreationerror",gn,!1),st===null){const it=["webgl2","webgl","experimental-webgl"];if(Be.isWebGL1Renderer===!0&&it.shift(),st=Vt(it,ke),st===null)throw Vt(it)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}typeof WebGLRenderingContext<"u"&&st instanceof WebGLRenderingContext&&console.warn("THREE.WebGLRenderer: WebGL 1 support was deprecated in r153 and will be removed in r163."),st.getShaderPrecisionFormat===void 0&&(st.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(ke){throw console.error("THREE.WebGLRenderer: "+ke.message),ke}let wt,St,Rt,jt,Wt,Ht,Pt,Mt,un,qe,Je,mt,Dt,_t,zt,nn,tn,Ft,pn,sn,rn,$t,on,An;function wn(){wt=new WebGLExtensions(st),St=new WebGLCapabilities(st,wt,Z),wt.init(St),$t=new WebGLUtils(st,wt,St),Rt=new WebGLState(st,wt,St),jt=new WebGLInfo(st),Wt=new WebGLProperties,Ht=new WebGLTextures(st,wt,Rt,Wt,St,$t,jt),Pt=new WebGLCubeMaps(Be),Mt=new WebGLCubeUVMaps(Be),un=new WebGLAttributes(st,St),on=new WebGLBindingStates(st,wt,un,St),qe=new WebGLGeometries(st,un,jt,on),Je=new WebGLObjects(st,qe,un,jt),pn=new WebGLMorphtargets(st,St,Ht),nn=new WebGLClipping(Wt),mt=new WebGLPrograms(Be,Pt,Mt,wt,St,on,nn),Dt=new WebGLMaterials(Be,Wt),_t=new WebGLRenderLists,zt=new WebGLRenderStates(wt,St),Ft=new WebGLBackground(Be,Pt,Mt,Rt,Je,de,se),tn=new WebGLShadowMap(Be,Je,St),An=new WebGLUniformsGroups(st,jt,St,Rt),sn=new WebGLBufferRenderer(st,wt,jt,St),rn=new WebGLIndexedBufferRenderer(st,wt,jt,St),jt.programs=mt.programs,Be.capabilities=St,Be.extensions=wt,Be.properties=Wt,Be.renderLists=_t,Be.shadowMap=tn,Be.state=Rt,Be.info=jt}wn();const ft=new WebXRManager(Be,st);this.xr=ft,this.getContext=function(){return st},this.getContextAttributes=function(){return st.getContextAttributes()},this.forceContextLoss=function(){const ke=wt.get("WEBGL_lose_context");ke&&ke.loseContext()},this.forceContextRestore=function(){const ke=wt.get("WEBGL_lose_context");ke&&ke.restoreContext()},this.getPixelRatio=function(){return at},this.setPixelRatio=function(ke){ke!==void 0&&(at=ke,this.setSize(tt,rt,!1))},this.getSize=function(ke){return ke.set(tt,rt)},this.setSize=function(ke,it,ut=!0){if(ft.isPresenting){console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting.");return}tt=ke,rt=it,_.width=Math.floor(ke*at),_.height=Math.floor(it*at),ut===!0&&(_.style.width=ke+"px",_.style.height=it+"px"),this.setViewport(0,0,ke,it)},this.getDrawingBufferSize=function(ke){return ke.set(tt*at,rt*at).floor()},this.setDrawingBufferSize=function(ke,it,ut){tt=ke,rt=it,at=ut,_.width=Math.floor(ke*ut),_.height=Math.floor(it*ut),this.setViewport(0,0,ke,it)},this.getCurrentViewport=function(ke){return ke.copy(Xe)},this.getViewport=function(ke){return ke.copy(je)},this.setViewport=function(ke,it,ut,lt){ke.isVector4?je.set(ke.x,ke.y,ke.z,ke.w):je.set(ke,it,ut,lt),Rt.viewport(Xe.copy(je).multiplyScalar(at).floor())},this.getScissor=function(ke){return ke.copy(Te)},this.setScissor=function(ke,it,ut,lt){ke.isVector4?Te.set(ke.x,ke.y,ke.z,ke.w):Te.set(ke,it,ut,lt),Rt.scissor(Pe.copy(Te).multiplyScalar(at).floor())},this.getScissorTest=function(){return De},this.setScissorTest=function(ke){Rt.setScissorTest(De=ke)},this.setOpaqueSort=function(ke){Oe=ke},this.setTransparentSort=function(ke){$e=ke},this.getClearColor=function(ke){return ke.copy(Ft.getClearColor())},this.setClearColor=function(){Ft.setClearColor.apply(Ft,arguments)},this.getClearAlpha=function(){return Ft.getClearAlpha()},this.setClearAlpha=function(){Ft.setClearAlpha.apply(Ft,arguments)},this.clear=function(ke=!0,it=!0,ut=!0){let lt=0;if(ke){let It=!1;if(Ze!==null){const Nt=Ze.texture.format;It=Nt===RGBAIntegerFormat||Nt===RGIntegerFormat||Nt===RedIntegerFormat}if(It){const Nt=Ze.texture.type,Xt=Nt===UnsignedByteType||Nt===UnsignedIntType||Nt===UnsignedShortType||Nt===UnsignedInt248Type||Nt===UnsignedShort4444Type||Nt===UnsignedShort5551Type,Ot=Ft.getClearColor(),Jt=Ft.getClearAlpha(),qt=Ot.r,yt=Ot.g,yn=Ot.b;Xt?(pe[0]=qt,pe[1]=yt,pe[2]=yn,pe[3]=Jt,st.clearBufferuiv(st.COLOR,0,pe)):(fe[0]=qt,fe[1]=yt,fe[2]=yn,fe[3]=Jt,st.clearBufferiv(st.COLOR,0,fe))}else lt|=st.COLOR_BUFFER_BIT}it&&(lt|=st.DEPTH_BUFFER_BIT),ut&&(lt|=st.STENCIL_BUFFER_BIT),st.clear(lt)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){_.removeEventListener("webglcontextlost",vt,!1),_.removeEventListener("webglcontextrestored",Et,!1),_.removeEventListener("webglcontextcreationerror",gn,!1),_t.dispose(),zt.dispose(),Wt.dispose(),Pt.dispose(),Mt.dispose(),Je.dispose(),on.dispose(),An.dispose(),mt.dispose(),ft.dispose(),ft.removeEventListener("sessionstart",Xn),ft.removeEventListener("sessionend",dr),pt&&(pt.dispose(),pt=null),rr.stop()};function vt(ke){ke.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),Re=!0}function Et(){console.log("THREE.WebGLRenderer: Context Restored."),Re=!1;const ke=jt.autoReset,it=tn.enabled,ut=tn.autoUpdate,lt=tn.needsUpdate,It=tn.type;wn(),jt.autoReset=ke,tn.enabled=it,tn.autoUpdate=ut,tn.needsUpdate=lt,tn.type=It}function gn(ke){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",ke.statusMessage)}function an(ke){const it=ke.target;it.removeEventListener("dispose",an),vn(it)}function vn(ke){zn(ke),Wt.remove(ke)}function zn(ke){const it=Wt.get(ke).programs;it!==void 0&&(it.forEach(function(ut){mt.releaseProgram(ut)}),ke.isShaderMaterial&&mt.releaseShaderCache(ke))}this.renderBufferDirect=function(ke,it,ut,lt,It,Nt){it===null&&(it=en);const Xt=It.isMesh&&It.matrixWorld.determinant()<0,Ot=Hr(ke,it,ut,lt,It);Rt.setMaterial(lt,Xt);let Jt=ut.index,qt=1;lt.wireframe===!0&&(Jt=qe.getWireframeAttribute(ut),qt=2);const yt=ut.drawRange,yn=ut.attributes.position;let Cn=yt.start*qt,hn=(yt.start+yt.count)*qt;Nt!==null&&(Cn=Math.max(Cn,Nt.start*qt),hn=Math.min(hn,(Nt.start+Nt.count)*qt)),Jt!==null?(Cn=Math.max(Cn,0),hn=Math.min(hn,Jt.count)):yn!=null&&(Cn=Math.max(Cn,0),hn=Math.min(hn,yn.count));const xn=hn-Cn;if(xn<0||xn===1/0)return;on.setup(It,lt,Ot,ut,Jt);let Hn,Wn=sn;if(Jt!==null&&(Hn=un.get(Jt),Wn=rn,Wn.setIndex(Hn)),It.isMesh)lt.wireframe===!0?(Rt.setLineWidth(lt.wireframeLinewidth*Zt()),Wn.setMode(st.LINES)):Wn.setMode(st.TRIANGLES);else if(It.isLine){let bn=lt.linewidth;bn===void 0&&(bn=1),Rt.setLineWidth(bn*Zt()),It.isLineSegments?Wn.setMode(st.LINES):It.isLineLoop?Wn.setMode(st.LINE_LOOP):Wn.setMode(st.LINE_STRIP)}else It.isPoints?Wn.setMode(st.POINTS):It.isSprite&&Wn.setMode(st.TRIANGLES);if(It.isInstancedMesh)Wn.renderInstances(Cn,xn,It.count);else if(ut.isInstancedBufferGeometry){const bn=ut._maxInstanceCount!==void 0?ut._maxInstanceCount:1/0,_n=Math.min(ut.instanceCount,bn);Wn.renderInstances(Cn,xn,_n)}else Wn.render(Cn,xn)},this.compile=function(ke,it){function ut(lt,It,Nt){lt.transparent===!0&&lt.side===DoubleSide&&lt.forceSinglePass===!1?(lt.side=BackSide,lt.needsUpdate=!0,br(lt,It,Nt),lt.side=FrontSide,lt.needsUpdate=!0,br(lt,It,Nt),lt.side=DoubleSide):br(lt,It,Nt)}me=zt.get(ke),me.init(),ve.push(me),ke.traverseVisible(function(lt){lt.isLight&&lt.layers.test(it.layers)&&(me.pushLight(lt),lt.castShadow&&me.pushShadow(lt))}),me.setupLights(Be.useLegacyLights),ke.traverse(function(lt){const It=lt.material;if(It)if(Array.isArray(It))for(let Nt=0;Nt<It.length;Nt++){const Xt=It[Nt];ut(Xt,ke,lt)}else ut(It,ke,lt)}),ve.pop(),me=null};let On=null;function Tn(ke){On&&On(ke)}function Xn(){rr.stop()}function dr(){rr.start()}const rr=new WebGLAnimation;rr.setAnimationLoop(Tn),typeof self<"u"&&rr.setContext(self),this.setAnimationLoop=function(ke){On=ke,ft.setAnimationLoop(ke),ke===null?rr.stop():rr.start()},ft.addEventListener("sessionstart",Xn),ft.addEventListener("sessionend",dr),this.render=function(ke,it){if(it!==void 0&&it.isCamera!==!0){console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");return}if(Re===!0)return;ke.matrixWorldAutoUpdate===!0&&ke.updateMatrixWorld(),it.parent===null&&it.matrixWorldAutoUpdate===!0&&it.updateMatrixWorld(),ft.enabled===!0&&ft.isPresenting===!0&&(ft.cameraAutoUpdate===!0&&ft.updateCamera(it),it=ft.getCamera()),ke.isScene===!0&&ke.onBeforeRender(Be,ke,it,Ze),me=zt.get(ke,ve.length),me.init(),ve.push(me),ht.multiplyMatrices(it.projectionMatrix,it.matrixWorldInverse),ot.setFromProjectionMatrix(ht),gt=this.localClippingEnabled,ct=nn.init(this.clippingPlanes,gt),be=_t.get(ke,ye.length),be.init(),ye.push(be),fr(ke,it,0,Be.sortObjects),be.finish(),Be.sortObjects===!0&&be.sort(Oe,$e),this.info.render.frame++,ct===!0&&nn.beginShadows();const ut=me.state.shadowsArray;if(tn.render(ut,ke,it),ct===!0&&nn.endShadows(),this.info.autoReset===!0&&this.info.reset(),Ft.render(be,ke),me.setupLights(Be.useLegacyLights),it.isArrayCamera){const lt=it.cameras;for(let It=0,Nt=lt.length;It<Nt;It++){const Xt=lt[It];Nr(be,ke,Xt,Xt.viewport)}}else Nr(be,ke,it);Ze!==null&&(Ht.updateMultisampleRenderTarget(Ze),Ht.updateRenderTargetMipmap(Ze)),ke.isScene===!0&&ke.onAfterRender(Be,ke,it),on.resetDefaultState(),Ve=-1,_e=null,ve.pop(),ve.length>0?me=ve[ve.length-1]:me=null,ye.pop(),ye.length>0?be=ye[ye.length-1]:be=null};function fr(ke,it,ut,lt){if(ke.visible===!1)return;if(ke.layers.test(it.layers)){if(ke.isGroup)ut=ke.renderOrder;else if(ke.isLOD)ke.autoUpdate===!0&&ke.update(it);else if(ke.isLight)me.pushLight(ke),ke.castShadow&&me.pushShadow(ke);else if(ke.isSprite){if(!ke.frustumCulled||ot.intersectsSprite(ke)){lt&&Kt.setFromMatrixPosition(ke.matrixWorld).applyMatrix4(ht);const Xt=Je.update(ke),Ot=ke.material;Ot.visible&&be.push(ke,Xt,Ot,ut,Kt.z,null)}}else if((ke.isMesh||ke.isLine||ke.isPoints)&&(!ke.frustumCulled||ot.intersectsObject(ke))){const Xt=Je.update(ke),Ot=ke.material;if(lt&&(ke.boundingSphere!==void 0?(ke.boundingSphere===null&&ke.computeBoundingSphere(),Kt.copy(ke.boundingSphere.center)):(Xt.boundingSphere===null&&Xt.computeBoundingSphere(),Kt.copy(Xt.boundingSphere.center)),Kt.applyMatrix4(ke.matrixWorld).applyMatrix4(ht)),Array.isArray(Ot)){const Jt=Xt.groups;for(let qt=0,yt=Jt.length;qt<yt;qt++){const yn=Jt[qt],Cn=Ot[yn.materialIndex];Cn&&Cn.visible&&be.push(ke,Xt,Cn,ut,Kt.z,yn)}}else Ot.visible&&be.push(ke,Xt,Ot,ut,Kt.z,null)}}const Nt=ke.children;for(let Xt=0,Ot=Nt.length;Xt<Ot;Xt++)fr(Nt[Xt],it,ut,lt)}function Nr(ke,it,ut,lt){const It=ke.opaque,Nt=ke.transmissive,Xt=ke.transparent;me.setupLightsView(ut),ct===!0&&nn.setGlobalState(Be.clippingPlanes,ut),Nt.length>0&&ei(It,Nt,it,ut),lt&&Rt.viewport(Xe.copy(lt)),It.length>0&&Er(It,it,ut),Nt.length>0&&Er(Nt,it,ut),Xt.length>0&&Er(Xt,it,ut),Rt.buffers.depth.setTest(!0),Rt.buffers.depth.setMask(!0),Rt.buffers.color.setMask(!0),Rt.setPolygonOffset(!1)}function ei(ke,it,ut,lt){const It=St.isWebGL2;pt===null&&(pt=new WebGLRenderTarget(1,1,{generateMipmaps:!0,type:wt.has("EXT_color_buffer_half_float")?HalfFloatType:UnsignedByteType,minFilter:LinearMipmapLinearFilter,samples:It?4:0})),Be.getDrawingBufferSize(At),It?pt.setSize(At.x,At.y):pt.setSize(floorPowerOfTwo(At.x),floorPowerOfTwo(At.y));const Nt=Be.getRenderTarget();Be.setRenderTarget(pt),Be.getClearColor(Ke),Ue=Be.getClearAlpha(),Ue<1&&Be.setClearColor(16777215,.5),Be.clear();const Xt=Be.toneMapping;Be.toneMapping=NoToneMapping,Er(ke,ut,lt),Ht.updateMultisampleRenderTarget(pt),Ht.updateRenderTargetMipmap(pt);let Ot=!1;for(let Jt=0,qt=it.length;Jt<qt;Jt++){const yt=it[Jt],yn=yt.object,Cn=yt.geometry,hn=yt.material,xn=yt.group;if(hn.side===DoubleSide&&yn.layers.test(lt.layers)){const Hn=hn.side;hn.side=BackSide,hn.needsUpdate=!0,Lr(yn,ut,lt,Cn,hn,xn),hn.side=Hn,hn.needsUpdate=!0,Ot=!0}}Ot===!0&&(Ht.updateMultisampleRenderTarget(pt),Ht.updateRenderTargetMipmap(pt)),Be.setRenderTarget(Nt),Be.setClearColor(Ke,Ue),Be.toneMapping=Xt}function Er(ke,it,ut){const lt=it.isScene===!0?it.overrideMaterial:null;for(let It=0,Nt=ke.length;It<Nt;It++){const Xt=ke[It],Ot=Xt.object,Jt=Xt.geometry,qt=lt===null?Xt.material:lt,yt=Xt.group;Ot.layers.test(ut.layers)&&Lr(Ot,it,ut,Jt,qt,yt)}}function Lr(ke,it,ut,lt,It,Nt){ke.onBeforeRender(Be,it,ut,lt,It,Nt),ke.modelViewMatrix.multiplyMatrices(ut.matrixWorldInverse,ke.matrixWorld),ke.normalMatrix.getNormalMatrix(ke.modelViewMatrix),It.onBeforeRender(Be,it,ut,lt,ke,Nt),It.transparent===!0&&It.side===DoubleSide&&It.forceSinglePass===!1?(It.side=BackSide,It.needsUpdate=!0,Be.renderBufferDirect(ut,it,lt,It,ke,Nt),It.side=FrontSide,It.needsUpdate=!0,Be.renderBufferDirect(ut,it,lt,It,ke,Nt),It.side=DoubleSide):Be.renderBufferDirect(ut,it,lt,It,ke,Nt),ke.onAfterRender(Be,it,ut,lt,It,Nt)}function br(ke,it,ut){it.isScene!==!0&&(it=en);const lt=Wt.get(ke),It=me.state.lights,Nt=me.state.shadowsArray,Xt=It.state.version,Ot=mt.getParameters(ke,It.state,Nt,it,ut),Jt=mt.getProgramCacheKey(Ot);let qt=lt.programs;lt.environment=ke.isMeshStandardMaterial?it.environment:null,lt.fog=it.fog,lt.envMap=(ke.isMeshStandardMaterial?Mt:Pt).get(ke.envMap||lt.environment),qt===void 0&&(ke.addEventListener("dispose",an),qt=new Map,lt.programs=qt);let yt=qt.get(Jt);if(yt!==void 0){if(lt.currentProgram===yt&&lt.lightsStateVersion===Xt)return kn(ke,Ot),yt}else Ot.uniforms=mt.getUniforms(ke),ke.onBuild(ut,Ot,Be),ke.onBeforeCompile(Ot,Be),yt=mt.acquireProgram(Ot,Jt),qt.set(Jt,yt),lt.uniforms=Ot.uniforms;const yn=lt.uniforms;(!ke.isShaderMaterial&&!ke.isRawShaderMaterial||ke.clipping===!0)&&(yn.clippingPlanes=nn.uniform),kn(ke,Ot),lt.needsLights=Qe(ke),lt.lightsStateVersion=Xt,lt.needsLights&&(yn.ambientLightColor.value=It.state.ambient,yn.lightProbe.value=It.state.probe,yn.directionalLights.value=It.state.directional,yn.directionalLightShadows.value=It.state.directionalShadow,yn.spotLights.value=It.state.spot,yn.spotLightShadows.value=It.state.spotShadow,yn.rectAreaLights.value=It.state.rectArea,yn.ltc_1.value=It.state.rectAreaLTC1,yn.ltc_2.value=It.state.rectAreaLTC2,yn.pointLights.value=It.state.point,yn.pointLightShadows.value=It.state.pointShadow,yn.hemisphereLights.value=It.state.hemi,yn.directionalShadowMap.value=It.state.directionalShadowMap,yn.directionalShadowMatrix.value=It.state.directionalShadowMatrix,yn.spotShadowMap.value=It.state.spotShadowMap,yn.spotLightMatrix.value=It.state.spotLightMatrix,yn.spotLightMap.value=It.state.spotLightMap,yn.pointShadowMap.value=It.state.pointShadowMap,yn.pointShadowMatrix.value=It.state.pointShadowMatrix);const Cn=yt.getUniforms(),hn=WebGLUniforms.seqWithValue(Cn.seq,yn);return lt.currentProgram=yt,lt.uniformsList=hn,yt}function kn(ke,it){const ut=Wt.get(ke);ut.outputColorSpace=it.outputColorSpace,ut.instancing=it.instancing,ut.skinning=it.skinning,ut.morphTargets=it.morphTargets,ut.morphNormals=it.morphNormals,ut.morphColors=it.morphColors,ut.morphTargetsCount=it.morphTargetsCount,ut.numClippingPlanes=it.numClippingPlanes,ut.numIntersection=it.numClipIntersection,ut.vertexAlphas=it.vertexAlphas,ut.vertexTangents=it.vertexTangents,ut.toneMapping=it.toneMapping}function Hr(ke,it,ut,lt,It){it.isScene!==!0&&(it=en),Ht.resetTextureUnits();const Nt=it.fog,Xt=lt.isMeshStandardMaterial?it.environment:null,Ot=Ze===null?Be.outputColorSpace:Ze.isXRRenderTarget===!0?Ze.texture.colorSpace:LinearSRGBColorSpace$1,Jt=(lt.isMeshStandardMaterial?Mt:Pt).get(lt.envMap||Xt),qt=lt.vertexColors===!0&&!!ut.attributes.color&&ut.attributes.color.itemSize===4,yt=!!ut.attributes.tangent&&(!!lt.normalMap||lt.anisotropy>0),yn=!!ut.morphAttributes.position,Cn=!!ut.morphAttributes.normal,hn=!!ut.morphAttributes.color,xn=lt.toneMapped?Be.toneMapping:NoToneMapping,Hn=ut.morphAttributes.position||ut.morphAttributes.normal||ut.morphAttributes.color,Wn=Hn!==void 0?Hn.length:0,bn=Wt.get(lt),_n=me.state.lights;if(ct===!0&&(gt===!0||ke!==_e)){const Kn=ke===_e&&lt.id===Ve;nn.setState(lt,ke,Kn)}let Zn=!1;lt.version===bn.__version?(bn.needsLights&&bn.lightsStateVersion!==_n.state.version||bn.outputColorSpace!==Ot||It.isInstancedMesh&&bn.instancing===!1||!It.isInstancedMesh&&bn.instancing===!0||It.isSkinnedMesh&&bn.skinning===!1||!It.isSkinnedMesh&&bn.skinning===!0||bn.envMap!==Jt||lt.fog===!0&&bn.fog!==Nt||bn.numClippingPlanes!==void 0&&(bn.numClippingPlanes!==nn.numPlanes||bn.numIntersection!==nn.numIntersection)||bn.vertexAlphas!==qt||bn.vertexTangents!==yt||bn.morphTargets!==yn||bn.morphNormals!==Cn||bn.morphColors!==hn||bn.toneMapping!==xn||St.isWebGL2===!0&&bn.morphTargetsCount!==Wn)&&(Zn=!0):(Zn=!0,bn.__version=lt.version);let Nn=bn.currentProgram;Zn===!0&&(Nn=br(lt,it,It));let gr=!1,Dn=!1,cr=!1;const tr=Nn.getUniforms(),sr=bn.uniforms;if(Rt.useProgram(Nn.program)&&(gr=!0,Dn=!0,cr=!0),lt.id!==Ve&&(Ve=lt.id,Dn=!0),gr||_e!==ke){if(tr.setValue(st,"projectionMatrix",ke.projectionMatrix),St.logarithmicDepthBuffer&&tr.setValue(st,"logDepthBufFC",2/(Math.log(ke.far+1)/Math.LN2)),_e!==ke&&(_e=ke,Dn=!0,cr=!0),lt.isShaderMaterial||lt.isMeshPhongMaterial||lt.isMeshToonMaterial||lt.isMeshStandardMaterial||lt.envMap){const Kn=tr.map.cameraPosition;Kn!==void 0&&Kn.setValue(st,Kt.setFromMatrixPosition(ke.matrixWorld))}(lt.isMeshPhongMaterial||lt.isMeshToonMaterial||lt.isMeshLambertMaterial||lt.isMeshBasicMaterial||lt.isMeshStandardMaterial||lt.isShaderMaterial)&&tr.setValue(st,"isOrthographic",ke.isOrthographicCamera===!0),(lt.isMeshPhongMaterial||lt.isMeshToonMaterial||lt.isMeshLambertMaterial||lt.isMeshBasicMaterial||lt.isMeshStandardMaterial||lt.isShaderMaterial||lt.isShadowMaterial||It.isSkinnedMesh)&&tr.setValue(st,"viewMatrix",ke.matrixWorldInverse)}if(It.isSkinnedMesh){tr.setOptional(st,It,"bindMatrix"),tr.setOptional(st,It,"bindMatrixInverse");const Kn=It.skeleton;Kn&&(St.floatVertexTextures?(Kn.boneTexture===null&&Kn.computeBoneTexture(),tr.setValue(st,"boneTexture",Kn.boneTexture,Ht),tr.setValue(st,"boneTextureSize",Kn.boneTextureSize)):console.warn("THREE.WebGLRenderer: SkinnedMesh can only be used with WebGL 2. With WebGL 1 OES_texture_float and vertex textures support is required."))}const Ir=ut.morphAttributes;if((Ir.position!==void 0||Ir.normal!==void 0||Ir.color!==void 0&&St.isWebGL2===!0)&&pn.update(It,ut,Nn),(Dn||bn.receiveShadow!==It.receiveShadow)&&(bn.receiveShadow=It.receiveShadow,tr.setValue(st,"receiveShadow",It.receiveShadow)),lt.isMeshGouraudMaterial&&lt.envMap!==null&&(sr.envMap.value=Jt,sr.flipEnvMap.value=Jt.isCubeTexture&&Jt.isRenderTargetTexture===!1?-1:1),Dn&&(tr.setValue(st,"toneMappingExposure",Be.toneMappingExposure),bn.needsLights&&Yi(sr,cr),Nt&&lt.fog===!0&&Dt.refreshFogUniforms(sr,Nt),Dt.refreshMaterialUniforms(sr,lt,at,rt,pt),WebGLUniforms.upload(st,bn.uniformsList,sr,Ht)),lt.isShaderMaterial&&lt.uniformsNeedUpdate===!0&&(WebGLUniforms.upload(st,bn.uniformsList,sr,Ht),lt.uniformsNeedUpdate=!1),lt.isSpriteMaterial&&tr.setValue(st,"center",It.center),tr.setValue(st,"modelViewMatrix",It.modelViewMatrix),tr.setValue(st,"normalMatrix",It.normalMatrix),tr.setValue(st,"modelMatrix",It.matrixWorld),lt.isShaderMaterial||lt.isRawShaderMaterial){const Kn=lt.uniformsGroups;for(let yr=0,ar=Kn.length;yr<ar;yr++)if(St.isWebGL2){const jn=Kn[yr];An.update(jn,Nn),An.bind(jn,Nn)}else console.warn("THREE.WebGLRenderer: Uniform Buffer Objects can only be used with WebGL 2.")}return Nn}function Yi(ke,it){ke.ambientLightColor.needsUpdate=it,ke.lightProbe.needsUpdate=it,ke.directionalLights.needsUpdate=it,ke.directionalLightShadows.needsUpdate=it,ke.pointLights.needsUpdate=it,ke.pointLightShadows.needsUpdate=it,ke.spotLights.needsUpdate=it,ke.spotLightShadows.needsUpdate=it,ke.rectAreaLights.needsUpdate=it,ke.hemisphereLights.needsUpdate=it}function Qe(ke){return ke.isMeshLambertMaterial||ke.isMeshToonMaterial||ke.isMeshPhongMaterial||ke.isMeshStandardMaterial||ke.isShadowMaterial||ke.isShaderMaterial&&ke.lights===!0}this.getActiveCubeFace=function(){return Ee},this.getActiveMipmapLevel=function(){return We},this.getRenderTarget=function(){return Ze},this.setRenderTargetTextures=function(ke,it,ut){Wt.get(ke.texture).__webglTexture=it,Wt.get(ke.depthTexture).__webglTexture=ut;const lt=Wt.get(ke);lt.__hasExternalTextures=!0,lt.__hasExternalTextures&&(lt.__autoAllocateDepthBuffer=ut===void 0,lt.__autoAllocateDepthBuffer||wt.has("WEBGL_multisampled_render_to_texture")===!0&&(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),lt.__useRenderToTexture=!1))},this.setRenderTargetFramebuffer=function(ke,it){const ut=Wt.get(ke);ut.__webglFramebuffer=it,ut.__useDefaultFramebuffer=it===void 0},this.setRenderTarget=function(ke,it=0,ut=0){Ze=ke,Ee=it,We=ut;let lt=!0,It=null,Nt=!1,Xt=!1;if(ke){const Jt=Wt.get(ke);Jt.__useDefaultFramebuffer!==void 0?(Rt.bindFramebuffer(st.FRAMEBUFFER,null),lt=!1):Jt.__webglFramebuffer===void 0?Ht.setupRenderTarget(ke):Jt.__hasExternalTextures&&Ht.rebindTextures(ke,Wt.get(ke.texture).__webglTexture,Wt.get(ke.depthTexture).__webglTexture);const qt=ke.texture;(qt.isData3DTexture||qt.isDataArrayTexture||qt.isCompressedArrayTexture)&&(Xt=!0);const yt=Wt.get(ke).__webglFramebuffer;ke.isWebGLCubeRenderTarget?(It=yt[it],Nt=!0):St.isWebGL2&&ke.samples>0&&Ht.useMultisampledRTT(ke)===!1?It=Wt.get(ke).__webglMultisampledFramebuffer:It=yt,Xe.copy(ke.viewport),Pe.copy(ke.scissor),He=ke.scissorTest}else Xe.copy(je).multiplyScalar(at).floor(),Pe.copy(Te).multiplyScalar(at).floor(),He=De;if(Rt.bindFramebuffer(st.FRAMEBUFFER,It)&&St.drawBuffers&&lt&&Rt.drawBuffers(ke,It),Rt.viewport(Xe),Rt.scissor(Pe),Rt.setScissorTest(He),Nt){const Jt=Wt.get(ke.texture);st.framebufferTexture2D(st.FRAMEBUFFER,st.COLOR_ATTACHMENT0,st.TEXTURE_CUBE_MAP_POSITIVE_X+it,Jt.__webglTexture,ut)}else if(Xt){const Jt=Wt.get(ke.texture),qt=it||0;st.framebufferTextureLayer(st.FRAMEBUFFER,st.COLOR_ATTACHMENT0,Jt.__webglTexture,ut||0,qt)}Ve=-1},this.readRenderTargetPixels=function(ke,it,ut,lt,It,Nt,Xt){if(!(ke&&ke.isWebGLRenderTarget)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");return}let Ot=Wt.get(ke).__webglFramebuffer;if(ke.isWebGLCubeRenderTarget&&Xt!==void 0&&(Ot=Ot[Xt]),Ot){Rt.bindFramebuffer(st.FRAMEBUFFER,Ot);try{const Jt=ke.texture,qt=Jt.format,yt=Jt.type;if(qt!==RGBAFormat&&$t.convert(qt)!==st.getParameter(st.IMPLEMENTATION_COLOR_READ_FORMAT)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");return}const yn=yt===HalfFloatType&&(wt.has("EXT_color_buffer_half_float")||St.isWebGL2&&wt.has("EXT_color_buffer_float"));if(yt!==UnsignedByteType&&$t.convert(yt)!==st.getParameter(st.IMPLEMENTATION_COLOR_READ_TYPE)&&!(yt===FloatType&&(St.isWebGL2||wt.has("OES_texture_float")||wt.has("WEBGL_color_buffer_float")))&&!yn){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");return}it>=0&&it<=ke.width-lt&&ut>=0&&ut<=ke.height-It&&st.readPixels(it,ut,lt,It,$t.convert(qt),$t.convert(yt),Nt)}finally{const Jt=Ze!==null?Wt.get(Ze).__webglFramebuffer:null;Rt.bindFramebuffer(st.FRAMEBUFFER,Jt)}}},this.copyFramebufferToTexture=function(ke,it,ut=0){const lt=Math.pow(2,-ut),It=Math.floor(it.image.width*lt),Nt=Math.floor(it.image.height*lt);Ht.setTexture2D(it,0),st.copyTexSubImage2D(st.TEXTURE_2D,ut,0,0,ke.x,ke.y,It,Nt),Rt.unbindTexture()},this.copyTextureToTexture=function(ke,it,ut,lt=0){const It=it.image.width,Nt=it.image.height,Xt=$t.convert(ut.format),Ot=$t.convert(ut.type);Ht.setTexture2D(ut,0),st.pixelStorei(st.UNPACK_FLIP_Y_WEBGL,ut.flipY),st.pixelStorei(st.UNPACK_PREMULTIPLY_ALPHA_WEBGL,ut.premultiplyAlpha),st.pixelStorei(st.UNPACK_ALIGNMENT,ut.unpackAlignment),it.isDataTexture?st.texSubImage2D(st.TEXTURE_2D,lt,ke.x,ke.y,It,Nt,Xt,Ot,it.image.data):it.isCompressedTexture?st.compressedTexSubImage2D(st.TEXTURE_2D,lt,ke.x,ke.y,it.mipmaps[0].width,it.mipmaps[0].height,Xt,it.mipmaps[0].data):st.texSubImage2D(st.TEXTURE_2D,lt,ke.x,ke.y,Xt,Ot,it.image),lt===0&&ut.generateMipmaps&&st.generateMipmap(st.TEXTURE_2D),Rt.unbindTexture()},this.copyTextureToTexture3D=function(ke,it,ut,lt,It=0){if(Be.isWebGL1Renderer){console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.");return}const Nt=ke.max.x-ke.min.x+1,Xt=ke.max.y-ke.min.y+1,Ot=ke.max.z-ke.min.z+1,Jt=$t.convert(lt.format),qt=$t.convert(lt.type);let yt;if(lt.isData3DTexture)Ht.setTexture3D(lt,0),yt=st.TEXTURE_3D;else if(lt.isDataArrayTexture)Ht.setTexture2DArray(lt,0),yt=st.TEXTURE_2D_ARRAY;else{console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");return}st.pixelStorei(st.UNPACK_FLIP_Y_WEBGL,lt.flipY),st.pixelStorei(st.UNPACK_PREMULTIPLY_ALPHA_WEBGL,lt.premultiplyAlpha),st.pixelStorei(st.UNPACK_ALIGNMENT,lt.unpackAlignment);const yn=st.getParameter(st.UNPACK_ROW_LENGTH),Cn=st.getParameter(st.UNPACK_IMAGE_HEIGHT),hn=st.getParameter(st.UNPACK_SKIP_PIXELS),xn=st.getParameter(st.UNPACK_SKIP_ROWS),Hn=st.getParameter(st.UNPACK_SKIP_IMAGES),Wn=ut.isCompressedTexture?ut.mipmaps[0]:ut.image;st.pixelStorei(st.UNPACK_ROW_LENGTH,Wn.width),st.pixelStorei(st.UNPACK_IMAGE_HEIGHT,Wn.height),st.pixelStorei(st.UNPACK_SKIP_PIXELS,ke.min.x),st.pixelStorei(st.UNPACK_SKIP_ROWS,ke.min.y),st.pixelStorei(st.UNPACK_SKIP_IMAGES,ke.min.z),ut.isDataTexture||ut.isData3DTexture?st.texSubImage3D(yt,It,it.x,it.y,it.z,Nt,Xt,Ot,Jt,qt,Wn.data):ut.isCompressedArrayTexture?(console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: untested support for compressed srcTexture."),st.compressedTexSubImage3D(yt,It,it.x,it.y,it.z,Nt,Xt,Ot,Jt,Wn.data)):st.texSubImage3D(yt,It,it.x,it.y,it.z,Nt,Xt,Ot,Jt,qt,Wn),st.pixelStorei(st.UNPACK_ROW_LENGTH,yn),st.pixelStorei(st.UNPACK_IMAGE_HEIGHT,Cn),st.pixelStorei(st.UNPACK_SKIP_PIXELS,hn),st.pixelStorei(st.UNPACK_SKIP_ROWS,xn),st.pixelStorei(st.UNPACK_SKIP_IMAGES,Hn),It===0&&lt.generateMipmaps&&st.generateMipmap(yt),Rt.unbindTexture()},this.initTexture=function(ke){ke.isCubeTexture?Ht.setTextureCube(ke,0):ke.isData3DTexture?Ht.setTexture3D(ke,0):ke.isDataArrayTexture||ke.isCompressedArrayTexture?Ht.setTexture2DArray(ke,0):Ht.setTexture2D(ke,0),Rt.unbindTexture()},this.resetState=function(){Ee=0,We=0,Ze=null,Rt.reset(),on.reset()},typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}get coordinateSystem(){return WebGLCoordinateSystem}get physicallyCorrectLights(){return console.warn("THREE.WebGLRenderer: the property .physicallyCorrectLights has been removed. Set renderer.useLegacyLights instead."),!this.useLegacyLights}set physicallyCorrectLights(Z){console.warn("THREE.WebGLRenderer: the property .physicallyCorrectLights has been removed. Set renderer.useLegacyLights instead."),this.useLegacyLights=!Z}get outputEncoding(){return console.warn("THREE.WebGLRenderer: Property .outputEncoding has been removed. Use .outputColorSpace instead."),this.outputColorSpace===SRGBColorSpace$1?sRGBEncoding$2:LinearEncoding$2}set outputEncoding(Z){console.warn("THREE.WebGLRenderer: Property .outputEncoding has been removed. Use .outputColorSpace instead."),this.outputColorSpace=Z===sRGBEncoding$2?SRGBColorSpace$1:LinearSRGBColorSpace$1}}class WebGL1Renderer extends WebGLRenderer{}WebGL1Renderer.prototype.isWebGL1Renderer=!0;class FogExp2{constructor(Z,_=25e-5){this.isFogExp2=!0,this.name="",this.color=new Color$1(Z),this.density=_}clone(){return new FogExp2(this.color,this.density)}toJSON(){return{type:"FogExp2",color:this.color.getHex(),density:this.density}}}class Fog{constructor(Z,_=1,K=1e3){this.isFog=!0,this.name="",this.color=new Color$1(Z),this.near=_,this.far=K}clone(){return new Fog(this.color,this.near,this.far)}toJSON(){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}}}let Scene$1=class extends Object3D{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.overrideMaterial=null,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(Z,_){return super.copy(Z,_),Z.background!==null&&(this.background=Z.background.clone()),Z.environment!==null&&(this.environment=Z.environment.clone()),Z.fog!==null&&(this.fog=Z.fog.clone()),this.backgroundBlurriness=Z.backgroundBlurriness,this.backgroundIntensity=Z.backgroundIntensity,Z.overrideMaterial!==null&&(this.overrideMaterial=Z.overrideMaterial.clone()),this.matrixAutoUpdate=Z.matrixAutoUpdate,this}toJSON(Z){const _=super.toJSON(Z);return this.fog!==null&&(_.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(_.object.backgroundBlurriness=this.backgroundBlurriness),this.backgroundIntensity!==1&&(_.object.backgroundIntensity=this.backgroundIntensity),_}};class InterleavedBuffer{constructor(Z,_){this.isInterleavedBuffer=!0,this.array=Z,this.stride=_,this.count=Z!==void 0?Z.length/_:0,this.usage=StaticDrawUsage,this.updateRange={offset:0,count:-1},this.version=0,this.uuid=generateUUID$1()}onUploadCallback(){}set needsUpdate(Z){Z===!0&&this.version++}setUsage(Z){return this.usage=Z,this}copy(Z){return this.array=new Z.array.constructor(Z.array),this.count=Z.count,this.stride=Z.stride,this.usage=Z.usage,this}copyAt(Z,_,K){Z*=this.stride,K*=_.stride;for(let te=0,ne=this.stride;te<ne;te++)this.array[Z+te]=_.array[K+te];return this}set(Z,_=0){return this.array.set(Z,_),this}clone(Z){Z.arrayBuffers===void 0&&(Z.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=generateUUID$1()),Z.arrayBuffers[this.array.buffer._uuid]===void 0&&(Z.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const _=new this.array.constructor(Z.arrayBuffers[this.array.buffer._uuid]),K=new this.constructor(_,this.stride);return K.setUsage(this.usage),K}onUpload(Z){return this.onUploadCallback=Z,this}toJSON(Z){return Z.arrayBuffers===void 0&&(Z.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=generateUUID$1()),Z.arrayBuffers[this.array.buffer._uuid]===void 0&&(Z.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}const _vector$5=new Vector3;class InterleavedBufferAttribute{constructor(Z,_,K,te=!1){this.isInterleavedBufferAttribute=!0,this.name="",this.data=Z,this.itemSize=_,this.offset=K,this.normalized=te}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(Z){this.data.needsUpdate=Z}applyMatrix4(Z){for(let _=0,K=this.data.count;_<K;_++)_vector$5.fromBufferAttribute(this,_),_vector$5.applyMatrix4(Z),this.setXYZ(_,_vector$5.x,_vector$5.y,_vector$5.z);return this}applyNormalMatrix(Z){for(let _=0,K=this.count;_<K;_++)_vector$5.fromBufferAttribute(this,_),_vector$5.applyNormalMatrix(Z),this.setXYZ(_,_vector$5.x,_vector$5.y,_vector$5.z);return this}transformDirection(Z){for(let _=0,K=this.count;_<K;_++)_vector$5.fromBufferAttribute(this,_),_vector$5.transformDirection(Z),this.setXYZ(_,_vector$5.x,_vector$5.y,_vector$5.z);return this}setX(Z,_){return this.normalized&&(_=normalize$5(_,this.array)),this.data.array[Z*this.data.stride+this.offset]=_,this}setY(Z,_){return this.normalized&&(_=normalize$5(_,this.array)),this.data.array[Z*this.data.stride+this.offset+1]=_,this}setZ(Z,_){return this.normalized&&(_=normalize$5(_,this.array)),this.data.array[Z*this.data.stride+this.offset+2]=_,this}setW(Z,_){return this.normalized&&(_=normalize$5(_,this.array)),this.data.array[Z*this.data.stride+this.offset+3]=_,this}getX(Z){let _=this.data.array[Z*this.data.stride+this.offset];return this.normalized&&(_=denormalize(_,this.array)),_}getY(Z){let _=this.data.array[Z*this.data.stride+this.offset+1];return this.normalized&&(_=denormalize(_,this.array)),_}getZ(Z){let _=this.data.array[Z*this.data.stride+this.offset+2];return this.normalized&&(_=denormalize(_,this.array)),_}getW(Z){let _=this.data.array[Z*this.data.stride+this.offset+3];return this.normalized&&(_=denormalize(_,this.array)),_}setXY(Z,_,K){return Z=Z*this.data.stride+this.offset,this.normalized&&(_=normalize$5(_,this.array),K=normalize$5(K,this.array)),this.data.array[Z+0]=_,this.data.array[Z+1]=K,this}setXYZ(Z,_,K,te){return Z=Z*this.data.stride+this.offset,this.normalized&&(_=normalize$5(_,this.array),K=normalize$5(K,this.array),te=normalize$5(te,this.array)),this.data.array[Z+0]=_,this.data.array[Z+1]=K,this.data.array[Z+2]=te,this}setXYZW(Z,_,K,te,ne){return Z=Z*this.data.stride+this.offset,this.normalized&&(_=normalize$5(_,this.array),K=normalize$5(K,this.array),te=normalize$5(te,this.array),ne=normalize$5(ne,this.array)),this.data.array[Z+0]=_,this.data.array[Z+1]=K,this.data.array[Z+2]=te,this.data.array[Z+3]=ne,this}clone(Z){if(Z===void 0){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will de-interleave buffer data.");const _=[];for(let K=0;K<this.count;K++){const te=K*this.data.stride+this.offset;for(let ne=0;ne<this.itemSize;ne++)_.push(this.data.array[te+ne])}return new BufferAttribute(new this.array.constructor(_),this.itemSize,this.normalized)}else return Z.interleavedBuffers===void 0&&(Z.interleavedBuffers={}),Z.interleavedBuffers[this.data.uuid]===void 0&&(Z.interleavedBuffers[this.data.uuid]=this.data.clone(Z)),new InterleavedBufferAttribute(Z.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(Z){if(Z===void 0){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will de-interleave buffer data.");const _=[];for(let K=0;K<this.count;K++){const te=K*this.data.stride+this.offset;for(let ne=0;ne<this.itemSize;ne++)_.push(this.data.array[te+ne])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:_,normalized:this.normalized}}else return Z.interleavedBuffers===void 0&&(Z.interleavedBuffers={}),Z.interleavedBuffers[this.data.uuid]===void 0&&(Z.interleavedBuffers[this.data.uuid]=this.data.toJSON(Z)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}class SpriteMaterial extends Material{constructor(Z){super(),this.isSpriteMaterial=!0,this.type="SpriteMaterial",this.color=new Color$1(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.fog=!0,this.setValues(Z)}copy(Z){return super.copy(Z),this.color.copy(Z.color),this.map=Z.map,this.alphaMap=Z.alphaMap,this.rotation=Z.rotation,this.sizeAttenuation=Z.sizeAttenuation,this.fog=Z.fog,this}}let _geometry;const _intersectPoint=new Vector3,_worldScale=new Vector3,_mvPosition=new Vector3,_alignedPosition=new Vector2,_rotatedPosition=new Vector2,_viewWorldMatrix=new Matrix4,_vA=new Vector3,_vB=new Vector3,_vC=new Vector3,_uvA=new Vector2,_uvB=new Vector2,_uvC=new Vector2;class Sprite extends Object3D{constructor(Z){if(super(),this.isSprite=!0,this.type="Sprite",_geometry===void 0){_geometry=new BufferGeometry;const _=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),K=new InterleavedBuffer(_,5);_geometry.setIndex([0,1,2,0,2,3]),_geometry.setAttribute("position",new InterleavedBufferAttribute(K,3,0,!1)),_geometry.setAttribute("uv",new InterleavedBufferAttribute(K,2,3,!1))}this.geometry=_geometry,this.material=Z!==void 0?Z:new SpriteMaterial,this.center=new Vector2(.5,.5)}raycast(Z,_){Z.camera===null&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),_worldScale.setFromMatrixScale(this.matrixWorld),_viewWorldMatrix.copy(Z.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(Z.camera.matrixWorldInverse,this.matrixWorld),_mvPosition.setFromMatrixPosition(this.modelViewMatrix),Z.camera.isPerspectiveCamera&&this.material.sizeAttenuation===!1&&_worldScale.multiplyScalar(-_mvPosition.z);const K=this.material.rotation;let te,ne;K!==0&&(ne=Math.cos(K),te=Math.sin(K));const oe=this.center;transformVertex(_vA.set(-.5,-.5,0),_mvPosition,oe,_worldScale,te,ne),transformVertex(_vB.set(.5,-.5,0),_mvPosition,oe,_worldScale,te,ne),transformVertex(_vC.set(.5,.5,0),_mvPosition,oe,_worldScale,te,ne),_uvA.set(0,0),_uvB.set(1,0),_uvC.set(1,1);let ie=Z.ray.intersectTriangle(_vA,_vB,_vC,!1,_intersectPoint);if(ie===null&&(transformVertex(_vB.set(-.5,.5,0),_mvPosition,oe,_worldScale,te,ne),_uvB.set(0,1),ie=Z.ray.intersectTriangle(_vA,_vC,_vB,!1,_intersectPoint),ie===null))return;const se=Z.ray.origin.distanceTo(_intersectPoint);se<Z.near||se>Z.far||_.push({distance:se,point:_intersectPoint.clone(),uv:Triangle.getInterpolation(_intersectPoint,_vA,_vB,_vC,_uvA,_uvB,_uvC,new Vector2),face:null,object:this})}copy(Z,_){return super.copy(Z,_),Z.center!==void 0&&this.center.copy(Z.center),this.material=Z.material,this}}function transformVertex(X,Z,_,K,te,ne){_alignedPosition.subVectors(X,_).addScalar(.5).multiply(K),te!==void 0?(_rotatedPosition.x=ne*_alignedPosition.x-te*_alignedPosition.y,_rotatedPosition.y=te*_alignedPosition.x+ne*_alignedPosition.y):_rotatedPosition.copy(_alignedPosition),X.copy(Z),X.x+=_rotatedPosition.x,X.y+=_rotatedPosition.y,X.applyMatrix4(_viewWorldMatrix)}const _v1$2=new Vector3,_v2$1=new Vector3;class LOD extends Object3D{constructor(){super(),this._currentLevel=0,this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]},isLOD:{value:!0}}),this.autoUpdate=!0}copy(Z){super.copy(Z,!1);const _=Z.levels;for(let K=0,te=_.length;K<te;K++){const ne=_[K];this.addLevel(ne.object.clone(),ne.distance,ne.hysteresis)}return this.autoUpdate=Z.autoUpdate,this}addLevel(Z,_=0,K=0){_=Math.abs(_);const te=this.levels;let ne;for(ne=0;ne<te.length&&!(_<te[ne].distance);ne++);return te.splice(ne,0,{distance:_,hysteresis:K,object:Z}),this.add(Z),this}getCurrentLevel(){return this._currentLevel}getObjectForDistance(Z){const _=this.levels;if(_.length>0){let K,te;for(K=1,te=_.length;K<te;K++){let ne=_[K].distance;if(_[K].object.visible&&(ne-=ne*_[K].hysteresis),Z<ne)break}return _[K-1].object}return null}raycast(Z,_){if(this.levels.length>0){_v1$2.setFromMatrixPosition(this.matrixWorld);const te=Z.ray.origin.distanceTo(_v1$2);this.getObjectForDistance(te).raycast(Z,_)}}update(Z){const _=this.levels;if(_.length>1){_v1$2.setFromMatrixPosition(Z.matrixWorld),_v2$1.setFromMatrixPosition(this.matrixWorld);const K=_v1$2.distanceTo(_v2$1)/Z.zoom;_[0].object.visible=!0;let te,ne;for(te=1,ne=_.length;te<ne;te++){let oe=_[te].distance;if(_[te].object.visible&&(oe-=oe*_[te].hysteresis),K>=oe)_[te-1].object.visible=!1,_[te].object.visible=!0;else break}for(this._currentLevel=te-1;te<ne;te++)_[te].object.visible=!1}}toJSON(Z){const _=super.toJSON(Z);this.autoUpdate===!1&&(_.object.autoUpdate=!1),_.object.levels=[];const K=this.levels;for(let te=0,ne=K.length;te<ne;te++){const oe=K[te];_.object.levels.push({object:oe.object.uuid,distance:oe.distance,hysteresis:oe.hysteresis})}return _}}const _basePosition=new Vector3,_skinIndex=new Vector4,_skinWeight=new Vector4,_vector3=new Vector3,_matrix4=new Matrix4,_vertex=new Vector3,_sphere$3=new Sphere,_inverseMatrix$2=new Matrix4,_ray$2=new Ray$2;class SkinnedMesh extends Mesh{constructor(Z,_){super(Z,_),this.isSkinnedMesh=!0,this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new Matrix4,this.bindMatrixInverse=new Matrix4,this.boundingBox=null,this.boundingSphere=null}computeBoundingBox(){const Z=this.geometry;this.boundingBox===null&&(this.boundingBox=new Box3),this.boundingBox.makeEmpty();const _=Z.getAttribute("position");for(let K=0;K<_.count;K++)_vertex.fromBufferAttribute(_,K),this.applyBoneTransform(K,_vertex),this.boundingBox.expandByPoint(_vertex)}computeBoundingSphere(){const Z=this.geometry;this.boundingSphere===null&&(this.boundingSphere=new Sphere),this.boundingSphere.makeEmpty();const _=Z.getAttribute("position");for(let K=0;K<_.count;K++)_vertex.fromBufferAttribute(_,K),this.applyBoneTransform(K,_vertex),this.boundingSphere.expandByPoint(_vertex)}copy(Z,_){return super.copy(Z,_),this.bindMode=Z.bindMode,this.bindMatrix.copy(Z.bindMatrix),this.bindMatrixInverse.copy(Z.bindMatrixInverse),this.skeleton=Z.skeleton,Z.boundingBox!==null&&(this.boundingBox=Z.boundingBox.clone()),Z.boundingSphere!==null&&(this.boundingSphere=Z.boundingSphere.clone()),this}raycast(Z,_){const K=this.material,te=this.matrixWorld;K!==void 0&&(this.boundingSphere===null&&this.computeBoundingSphere(),_sphere$3.copy(this.boundingSphere),_sphere$3.applyMatrix4(te),Z.ray.intersectsSphere(_sphere$3)!==!1&&(_inverseMatrix$2.copy(te).invert(),_ray$2.copy(Z.ray).applyMatrix4(_inverseMatrix$2),!(this.boundingBox!==null&&_ray$2.intersectsBox(this.boundingBox)===!1)&&this._computeIntersections(Z,_,_ray$2)))}getVertexPosition(Z,_){return super.getVertexPosition(Z,_),this.applyBoneTransform(Z,_),_}bind(Z,_){this.skeleton=Z,_===void 0&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),_=this.matrixWorld),this.bindMatrix.copy(_),this.bindMatrixInverse.copy(_).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const Z=new Vector4,_=this.geometry.attributes.skinWeight;for(let K=0,te=_.count;K<te;K++){Z.fromBufferAttribute(_,K);const ne=1/Z.manhattanLength();ne!==1/0?Z.multiplyScalar(ne):Z.set(1,0,0,0),_.setXYZW(K,Z.x,Z.y,Z.z,Z.w)}}updateMatrixWorld(Z){super.updateMatrixWorld(Z),this.bindMode==="attached"?this.bindMatrixInverse.copy(this.matrixWorld).invert():this.bindMode==="detached"?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}applyBoneTransform(Z,_){const K=this.skeleton,te=this.geometry;_skinIndex.fromBufferAttribute(te.attributes.skinIndex,Z),_skinWeight.fromBufferAttribute(te.attributes.skinWeight,Z),_basePosition.copy(_).applyMatrix4(this.bindMatrix),_.set(0,0,0);for(let ne=0;ne<4;ne++){const oe=_skinWeight.getComponent(ne);if(oe!==0){const ie=_skinIndex.getComponent(ne);_matrix4.multiplyMatrices(K.bones[ie].matrixWorld,K.boneInverses[ie]),_.addScaledVector(_vector3.copy(_basePosition).applyMatrix4(_matrix4),oe)}}return _.applyMatrix4(this.bindMatrixInverse)}boneTransform(Z,_){return console.warn("THREE.SkinnedMesh: .boneTransform() was renamed to .applyBoneTransform() in r151."),this.applyBoneTransform(Z,_)}}class Bone extends Object3D{constructor(){super(),this.isBone=!0,this.type="Bone"}}class DataTexture extends Texture{constructor(Z=null,_=1,K=1,te,ne,oe,ie,se,ae=NearestFilter,ge=NearestFilter,ce,de){super(null,oe,ie,se,ae,ge,te,ne,ce,de),this.isDataTexture=!0,this.image={data:Z,width:_,height:K},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}const _offsetMatrix=new Matrix4,_identityMatrix$1=new Matrix4;class Skeleton{constructor(Z=[],_=[]){this.uuid=generateUUID$1(),this.bones=Z.slice(0),this.boneInverses=_,this.boneMatrices=null,this.boneTexture=null,this.boneTextureSize=0,this.init()}init(){const Z=this.bones,_=this.boneInverses;if(this.boneMatrices=new Float32Array(Z.length*16),_.length===0)this.calculateInverses();else if(Z.length!==_.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let K=0,te=this.bones.length;K<te;K++)this.boneInverses.push(new Matrix4)}}calculateInverses(){this.boneInverses.length=0;for(let Z=0,_=this.bones.length;Z<_;Z++){const K=new Matrix4;this.bones[Z]&&K.copy(this.bones[Z].matrixWorld).invert(),this.boneInverses.push(K)}}pose(){for(let Z=0,_=this.bones.length;Z<_;Z++){const K=this.bones[Z];K&&K.matrixWorld.copy(this.boneInverses[Z]).invert()}for(let Z=0,_=this.bones.length;Z<_;Z++){const K=this.bones[Z];K&&(K.parent&&K.parent.isBone?(K.matrix.copy(K.parent.matrixWorld).invert(),K.matrix.multiply(K.matrixWorld)):K.matrix.copy(K.matrixWorld),K.matrix.decompose(K.position,K.quaternion,K.scale))}}update(){const Z=this.bones,_=this.boneInverses,K=this.boneMatrices,te=this.boneTexture;for(let ne=0,oe=Z.length;ne<oe;ne++){const ie=Z[ne]?Z[ne].matrixWorld:_identityMatrix$1;_offsetMatrix.multiplyMatrices(ie,_[ne]),_offsetMatrix.toArray(K,ne*16)}te!==null&&(te.needsUpdate=!0)}clone(){return new Skeleton(this.bones,this.boneInverses)}computeBoneTexture(){let Z=Math.sqrt(this.bones.length*4);Z=ceilPowerOfTwo(Z),Z=Math.max(Z,4);const _=new Float32Array(Z*Z*4);_.set(this.boneMatrices);const K=new DataTexture(_,Z,Z,RGBAFormat,FloatType);return K.needsUpdate=!0,this.boneMatrices=_,this.boneTexture=K,this.boneTextureSize=Z,this}getBoneByName(Z){for(let _=0,K=this.bones.length;_<K;_++){const te=this.bones[_];if(te.name===Z)return te}}dispose(){this.boneTexture!==null&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(Z,_){this.uuid=Z.uuid;for(let K=0,te=Z.bones.length;K<te;K++){const ne=Z.bones[K];let oe=_[ne];oe===void 0&&(console.warn("THREE.Skeleton: No bone found with UUID:",ne),oe=new Bone),this.bones.push(oe),this.boneInverses.push(new Matrix4().fromArray(Z.boneInverses[K]))}return this.init(),this}toJSON(){const Z={metadata:{version:4.6,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};Z.uuid=this.uuid;const _=this.bones,K=this.boneInverses;for(let te=0,ne=_.length;te<ne;te++){const oe=_[te];Z.bones.push(oe.uuid);const ie=K[te];Z.boneInverses.push(ie.toArray())}return Z}}class InstancedBufferAttribute extends BufferAttribute{constructor(Z,_,K,te=1){super(Z,_,K),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=te}copy(Z){return super.copy(Z),this.meshPerAttribute=Z.meshPerAttribute,this}toJSON(){const Z=super.toJSON();return Z.meshPerAttribute=this.meshPerAttribute,Z.isInstancedBufferAttribute=!0,Z}}const _instanceLocalMatrix=new Matrix4,_instanceWorldMatrix=new Matrix4,_instanceIntersects=[],_box3=new Box3,_identity=new Matrix4,_mesh=new Mesh,_sphere$2=new Sphere;class InstancedMesh extends Mesh{constructor(Z,_,K){super(Z,_),this.isInstancedMesh=!0,this.instanceMatrix=new InstancedBufferAttribute(new Float32Array(K*16),16),this.instanceColor=null,this.count=K,this.boundingBox=null,this.boundingSphere=null;for(let te=0;te<K;te++)this.setMatrixAt(te,_identity)}computeBoundingBox(){const Z=this.geometry,_=this.count;this.boundingBox===null&&(this.boundingBox=new Box3),Z.boundingBox===null&&Z.computeBoundingBox(),this.boundingBox.makeEmpty();for(let K=0;K<_;K++)this.getMatrixAt(K,_instanceLocalMatrix),_box3.copy(Z.boundingBox).applyMatrix4(_instanceLocalMatrix),this.boundingBox.union(_box3)}computeBoundingSphere(){const Z=this.geometry,_=this.count;this.boundingSphere===null&&(this.boundingSphere=new Sphere),Z.boundingSphere===null&&Z.computeBoundingSphere(),this.boundingSphere.makeEmpty();for(let K=0;K<_;K++)this.getMatrixAt(K,_instanceLocalMatrix),_sphere$2.copy(Z.boundingSphere).applyMatrix4(_instanceLocalMatrix),this.boundingSphere.union(_sphere$2)}copy(Z,_){return super.copy(Z,_),this.instanceMatrix.copy(Z.instanceMatrix),Z.instanceColor!==null&&(this.instanceColor=Z.instanceColor.clone()),this.count=Z.count,Z.boundingBox!==null&&(this.boundingBox=Z.boundingBox.clone()),Z.boundingSphere!==null&&(this.boundingSphere=Z.boundingSphere.clone()),this}getColorAt(Z,_){_.fromArray(this.instanceColor.array,Z*3)}getMatrixAt(Z,_){_.fromArray(this.instanceMatrix.array,Z*16)}raycast(Z,_){const K=this.matrixWorld,te=this.count;if(_mesh.geometry=this.geometry,_mesh.material=this.material,_mesh.material!==void 0&&(this.boundingSphere===null&&this.computeBoundingSphere(),_sphere$2.copy(this.boundingSphere),_sphere$2.applyMatrix4(K),Z.ray.intersectsSphere(_sphere$2)!==!1))for(let ne=0;ne<te;ne++){this.getMatrixAt(ne,_instanceLocalMatrix),_instanceWorldMatrix.multiplyMatrices(K,_instanceLocalMatrix),_mesh.matrixWorld=_instanceWorldMatrix,_mesh.raycast(Z,_instanceIntersects);for(let oe=0,ie=_instanceIntersects.length;oe<ie;oe++){const se=_instanceIntersects[oe];se.instanceId=ne,se.object=this,_.push(se)}_instanceIntersects.length=0}}setColorAt(Z,_){this.instanceColor===null&&(this.instanceColor=new InstancedBufferAttribute(new Float32Array(this.instanceMatrix.count*3),3)),_.toArray(this.instanceColor.array,Z*3)}setMatrixAt(Z,_){_.toArray(this.instanceMatrix.array,Z*16)}updateMorphTargets(){}dispose(){this.dispatchEvent({type:"dispose"})}}class LineBasicMaterial extends Material{constructor(Z){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new Color$1(16777215),this.map=null,this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(Z)}copy(Z){return super.copy(Z),this.color.copy(Z.color),this.map=Z.map,this.linewidth=Z.linewidth,this.linecap=Z.linecap,this.linejoin=Z.linejoin,this.fog=Z.fog,this}}const _start$1=new Vector3,_end$1=new Vector3,_inverseMatrix$1=new Matrix4,_ray$1=new Ray$2,_sphere$1=new Sphere;class Line extends Object3D{constructor(Z=new BufferGeometry,_=new LineBasicMaterial){super(),this.isLine=!0,this.type="Line",this.geometry=Z,this.material=_,this.updateMorphTargets()}copy(Z,_){return super.copy(Z,_),this.material=Z.material,this.geometry=Z.geometry,this}computeLineDistances(){const Z=this.geometry;if(Z.index===null){const _=Z.attributes.position,K=[0];for(let te=1,ne=_.count;te<ne;te++)_start$1.fromBufferAttribute(_,te-1),_end$1.fromBufferAttribute(_,te),K[te]=K[te-1],K[te]+=_start$1.distanceTo(_end$1);Z.setAttribute("lineDistance",new Float32BufferAttribute(K,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(Z,_){const K=this.geometry,te=this.matrixWorld,ne=Z.params.Line.threshold,oe=K.drawRange;if(K.boundingSphere===null&&K.computeBoundingSphere(),_sphere$1.copy(K.boundingSphere),_sphere$1.applyMatrix4(te),_sphere$1.radius+=ne,Z.ray.intersectsSphere(_sphere$1)===!1)return;_inverseMatrix$1.copy(te).invert(),_ray$1.copy(Z.ray).applyMatrix4(_inverseMatrix$1);const ie=ne/((this.scale.x+this.scale.y+this.scale.z)/3),se=ie*ie,ae=new Vector3,ge=new Vector3,ce=new Vector3,de=new Vector3,pe=this.isLineSegments?2:1,fe=K.index,me=K.attributes.position;if(fe!==null){const ye=Math.max(0,oe.start),ve=Math.min(fe.count,oe.start+oe.count);for(let Be=ye,Re=ve-1;Be<Re;Be+=pe){const Ee=fe.getX(Be),We=fe.getX(Be+1);if(ae.fromBufferAttribute(me,Ee),ge.fromBufferAttribute(me,We),_ray$1.distanceSqToSegment(ae,ge,de,ce)>se)continue;de.applyMatrix4(this.matrixWorld);const Ve=Z.ray.origin.distanceTo(de);Ve<Z.near||Ve>Z.far||_.push({distance:Ve,point:ce.clone().applyMatrix4(this.matrixWorld),index:Be,face:null,faceIndex:null,object:this})}}else{const ye=Math.max(0,oe.start),ve=Math.min(me.count,oe.start+oe.count);for(let Be=ye,Re=ve-1;Be<Re;Be+=pe){if(ae.fromBufferAttribute(me,Be),ge.fromBufferAttribute(me,Be+1),_ray$1.distanceSqToSegment(ae,ge,de,ce)>se)continue;de.applyMatrix4(this.matrixWorld);const We=Z.ray.origin.distanceTo(de);We<Z.near||We>Z.far||_.push({distance:We,point:ce.clone().applyMatrix4(this.matrixWorld),index:Be,face:null,faceIndex:null,object:this})}}}updateMorphTargets(){const _=this.geometry.morphAttributes,K=Object.keys(_);if(K.length>0){const te=_[K[0]];if(te!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let ne=0,oe=te.length;ne<oe;ne++){const ie=te[ne].name||String(ne);this.morphTargetInfluences.push(0),this.morphTargetDictionary[ie]=ne}}}}}const _start=new Vector3,_end=new Vector3;class LineSegments extends Line{constructor(Z,_){super(Z,_),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){const Z=this.geometry;if(Z.index===null){const _=Z.attributes.position,K=[];for(let te=0,ne=_.count;te<ne;te+=2)_start.fromBufferAttribute(_,te),_end.fromBufferAttribute(_,te+1),K[te]=te===0?0:K[te-1],K[te+1]=K[te]+_start.distanceTo(_end);Z.setAttribute("lineDistance",new Float32BufferAttribute(K,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}}class LineLoop extends Line{constructor(Z,_){super(Z,_),this.isLineLoop=!0,this.type="LineLoop"}}class PointsMaterial extends Material{constructor(Z){super(),this.isPointsMaterial=!0,this.type="PointsMaterial",this.color=new Color$1(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(Z)}copy(Z){return super.copy(Z),this.color.copy(Z.color),this.map=Z.map,this.alphaMap=Z.alphaMap,this.size=Z.size,this.sizeAttenuation=Z.sizeAttenuation,this.fog=Z.fog,this}}const _inverseMatrix=new Matrix4,_ray=new Ray$2,_sphere=new Sphere,_position$2=new Vector3;class Points extends Object3D{constructor(Z=new BufferGeometry,_=new PointsMaterial){super(),this.isPoints=!0,this.type="Points",this.geometry=Z,this.material=_,this.updateMorphTargets()}copy(Z,_){return super.copy(Z,_),this.material=Z.material,this.geometry=Z.geometry,this}raycast(Z,_){const K=this.geometry,te=this.matrixWorld,ne=Z.params.Points.threshold,oe=K.drawRange;if(K.boundingSphere===null&&K.computeBoundingSphere(),_sphere.copy(K.boundingSphere),_sphere.applyMatrix4(te),_sphere.radius+=ne,Z.ray.intersectsSphere(_sphere)===!1)return;_inverseMatrix.copy(te).invert(),_ray.copy(Z.ray).applyMatrix4(_inverseMatrix);const ie=ne/((this.scale.x+this.scale.y+this.scale.z)/3),se=ie*ie,ae=K.index,ce=K.attributes.position;if(ae!==null){const de=Math.max(0,oe.start),pe=Math.min(ae.count,oe.start+oe.count);for(let fe=de,be=pe;fe<be;fe++){const me=ae.getX(fe);_position$2.fromBufferAttribute(ce,me),testPoint(_position$2,me,se,te,Z,_,this)}}else{const de=Math.max(0,oe.start),pe=Math.min(ce.count,oe.start+oe.count);for(let fe=de,be=pe;fe<be;fe++)_position$2.fromBufferAttribute(ce,fe),testPoint(_position$2,fe,se,te,Z,_,this)}}updateMorphTargets(){const _=this.geometry.morphAttributes,K=Object.keys(_);if(K.length>0){const te=_[K[0]];if(te!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let ne=0,oe=te.length;ne<oe;ne++){const ie=te[ne].name||String(ne);this.morphTargetInfluences.push(0),this.morphTargetDictionary[ie]=ne}}}}}function testPoint(X,Z,_,K,te,ne,oe){const ie=_ray.distanceSqToPoint(X);if(ie<_){const se=new Vector3;_ray.closestPointToPoint(X,se),se.applyMatrix4(K);const ae=te.ray.origin.distanceTo(se);if(ae<te.near||ae>te.far)return;ne.push({distance:ae,distanceToRay:Math.sqrt(ie),point:se,index:Z,face:null,object:oe})}}class VideoTexture extends Texture{constructor(Z,_,K,te,ne,oe,ie,se,ae){super(Z,_,K,te,ne,oe,ie,se,ae),this.isVideoTexture=!0,this.minFilter=oe!==void 0?oe:LinearFilter,this.magFilter=ne!==void 0?ne:LinearFilter,this.generateMipmaps=!1;const ge=this;function ce(){ge.needsUpdate=!0,Z.requestVideoFrameCallback(ce)}"requestVideoFrameCallback"in Z&&Z.requestVideoFrameCallback(ce)}clone(){return new this.constructor(this.image).copy(this)}update(){const Z=this.image;"requestVideoFrameCallback"in Z===!1&&Z.readyState>=Z.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}class FramebufferTexture extends Texture{constructor(Z,_){super({width:Z,height:_}),this.isFramebufferTexture=!0,this.magFilter=NearestFilter,this.minFilter=NearestFilter,this.generateMipmaps=!1,this.needsUpdate=!0}}class CompressedTexture extends Texture{constructor(Z,_,K,te,ne,oe,ie,se,ae,ge,ce,de){super(null,oe,ie,se,ae,ge,te,ne,ce,de),this.isCompressedTexture=!0,this.image={width:_,height:K},this.mipmaps=Z,this.flipY=!1,this.generateMipmaps=!1}}class CompressedArrayTexture extends CompressedTexture{constructor(Z,_,K,te,ne,oe){super(Z,_,K,ne,oe),this.isCompressedArrayTexture=!0,this.image.depth=te,this.wrapR=ClampToEdgeWrapping}}class CanvasTexture extends Texture{constructor(Z,_,K,te,ne,oe,ie,se,ae){super(Z,_,K,te,ne,oe,ie,se,ae),this.isCanvasTexture=!0,this.needsUpdate=!0}}class Curve{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}getPointAt(Z,_){const K=this.getUtoTmapping(Z);return this.getPoint(K,_)}getPoints(Z=5){const _=[];for(let K=0;K<=Z;K++)_.push(this.getPoint(K/Z));return _}getSpacedPoints(Z=5){const _=[];for(let K=0;K<=Z;K++)_.push(this.getPointAt(K/Z));return _}getLength(){const Z=this.getLengths();return Z[Z.length-1]}getLengths(Z=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===Z+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const _=[];let K,te=this.getPoint(0),ne=0;_.push(0);for(let oe=1;oe<=Z;oe++)K=this.getPoint(oe/Z),ne+=K.distanceTo(te),_.push(ne),te=K;return this.cacheArcLengths=_,_}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(Z,_){const K=this.getLengths();let te=0;const ne=K.length;let oe;_?oe=_:oe=Z*K[ne-1];let ie=0,se=ne-1,ae;for(;ie<=se;)if(te=Math.floor(ie+(se-ie)/2),ae=K[te]-oe,ae<0)ie=te+1;else if(ae>0)se=te-1;else{se=te;break}if(te=se,K[te]===oe)return te/(ne-1);const ge=K[te],de=K[te+1]-ge,pe=(oe-ge)/de;return(te+pe)/(ne-1)}getTangent(Z,_){let te=Z-1e-4,ne=Z+1e-4;te<0&&(te=0),ne>1&&(ne=1);const oe=this.getPoint(te),ie=this.getPoint(ne),se=_||(oe.isVector2?new Vector2:new Vector3);return se.copy(ie).sub(oe).normalize(),se}getTangentAt(Z,_){const K=this.getUtoTmapping(Z);return this.getTangent(K,_)}computeFrenetFrames(Z,_){const K=new Vector3,te=[],ne=[],oe=[],ie=new Vector3,se=new Matrix4;for(let pe=0;pe<=Z;pe++){const fe=pe/Z;te[pe]=this.getTangentAt(fe,new Vector3)}ne[0]=new Vector3,oe[0]=new Vector3;let ae=Number.MAX_VALUE;const ge=Math.abs(te[0].x),ce=Math.abs(te[0].y),de=Math.abs(te[0].z);ge<=ae&&(ae=ge,K.set(1,0,0)),ce<=ae&&(ae=ce,K.set(0,1,0)),de<=ae&&K.set(0,0,1),ie.crossVectors(te[0],K).normalize(),ne[0].crossVectors(te[0],ie),oe[0].crossVectors(te[0],ne[0]);for(let pe=1;pe<=Z;pe++){if(ne[pe]=ne[pe-1].clone(),oe[pe]=oe[pe-1].clone(),ie.crossVectors(te[pe-1],te[pe]),ie.length()>Number.EPSILON){ie.normalize();const fe=Math.acos(clamp$3(te[pe-1].dot(te[pe]),-1,1));ne[pe].applyMatrix4(se.makeRotationAxis(ie,fe))}oe[pe].crossVectors(te[pe],ne[pe])}if(_===!0){let pe=Math.acos(clamp$3(ne[0].dot(ne[Z]),-1,1));pe/=Z,te[0].dot(ie.crossVectors(ne[0],ne[Z]))>0&&(pe=-pe);for(let fe=1;fe<=Z;fe++)ne[fe].applyMatrix4(se.makeRotationAxis(te[fe],pe*fe)),oe[fe].crossVectors(te[fe],ne[fe])}return{tangents:te,normals:ne,binormals:oe}}clone(){return new this.constructor().copy(this)}copy(Z){return this.arcLengthDivisions=Z.arcLengthDivisions,this}toJSON(){const Z={metadata:{version:4.6,type:"Curve",generator:"Curve.toJSON"}};return Z.arcLengthDivisions=this.arcLengthDivisions,Z.type=this.type,Z}fromJSON(Z){return this.arcLengthDivisions=Z.arcLengthDivisions,this}}class EllipseCurve extends Curve{constructor(Z=0,_=0,K=1,te=1,ne=0,oe=Math.PI*2,ie=!1,se=0){super(),this.isEllipseCurve=!0,this.type="EllipseCurve",this.aX=Z,this.aY=_,this.xRadius=K,this.yRadius=te,this.aStartAngle=ne,this.aEndAngle=oe,this.aClockwise=ie,this.aRotation=se}getPoint(Z,_){const K=_||new Vector2,te=Math.PI*2;let ne=this.aEndAngle-this.aStartAngle;const oe=Math.abs(ne)<Number.EPSILON;for(;ne<0;)ne+=te;for(;ne>te;)ne-=te;ne<Number.EPSILON&&(oe?ne=0:ne=te),this.aClockwise===!0&&!oe&&(ne===te?ne=-te:ne=ne-te);const ie=this.aStartAngle+Z*ne;let se=this.aX+this.xRadius*Math.cos(ie),ae=this.aY+this.yRadius*Math.sin(ie);if(this.aRotation!==0){const ge=Math.cos(this.aRotation),ce=Math.sin(this.aRotation),de=se-this.aX,pe=ae-this.aY;se=de*ge-pe*ce+this.aX,ae=de*ce+pe*ge+this.aY}return K.set(se,ae)}copy(Z){return super.copy(Z),this.aX=Z.aX,this.aY=Z.aY,this.xRadius=Z.xRadius,this.yRadius=Z.yRadius,this.aStartAngle=Z.aStartAngle,this.aEndAngle=Z.aEndAngle,this.aClockwise=Z.aClockwise,this.aRotation=Z.aRotation,this}toJSON(){const Z=super.toJSON();return Z.aX=this.aX,Z.aY=this.aY,Z.xRadius=this.xRadius,Z.yRadius=this.yRadius,Z.aStartAngle=this.aStartAngle,Z.aEndAngle=this.aEndAngle,Z.aClockwise=this.aClockwise,Z.aRotation=this.aRotation,Z}fromJSON(Z){return super.fromJSON(Z),this.aX=Z.aX,this.aY=Z.aY,this.xRadius=Z.xRadius,this.yRadius=Z.yRadius,this.aStartAngle=Z.aStartAngle,this.aEndAngle=Z.aEndAngle,this.aClockwise=Z.aClockwise,this.aRotation=Z.aRotation,this}}class ArcCurve extends EllipseCurve{constructor(Z,_,K,te,ne,oe){super(Z,_,K,K,te,ne,oe),this.isArcCurve=!0,this.type="ArcCurve"}}function CubicPoly(){let X=0,Z=0,_=0,K=0;function te(ne,oe,ie,se){X=ne,Z=ie,_=-3*ne+3*oe-2*ie-se,K=2*ne-2*oe+ie+se}return{initCatmullRom:function(ne,oe,ie,se,ae){te(oe,ie,ae*(ie-ne),ae*(se-oe))},initNonuniformCatmullRom:function(ne,oe,ie,se,ae,ge,ce){let de=(oe-ne)/ae-(ie-ne)/(ae+ge)+(ie-oe)/ge,pe=(ie-oe)/ge-(se-oe)/(ge+ce)+(se-ie)/ce;de*=ge,pe*=ge,te(oe,ie,de,pe)},calc:function(ne){const oe=ne*ne,ie=oe*ne;return X+Z*ne+_*oe+K*ie}}}const tmp=new Vector3,px=new CubicPoly,py=new CubicPoly,pz=new CubicPoly;class CatmullRomCurve3 extends Curve{constructor(Z=[],_=!1,K="centripetal",te=.5){super(),this.isCatmullRomCurve3=!0,this.type="CatmullRomCurve3",this.points=Z,this.closed=_,this.curveType=K,this.tension=te}getPoint(Z,_=new Vector3){const K=_,te=this.points,ne=te.length,oe=(ne-(this.closed?0:1))*Z;let ie=Math.floor(oe),se=oe-ie;this.closed?ie+=ie>0?0:(Math.floor(Math.abs(ie)/ne)+1)*ne:se===0&&ie===ne-1&&(ie=ne-2,se=1);let ae,ge;this.closed||ie>0?ae=te[(ie-1)%ne]:(tmp.subVectors(te[0],te[1]).add(te[0]),ae=tmp);const ce=te[ie%ne],de=te[(ie+1)%ne];if(this.closed||ie+2<ne?ge=te[(ie+2)%ne]:(tmp.subVectors(te[ne-1],te[ne-2]).add(te[ne-1]),ge=tmp),this.curveType==="centripetal"||this.curveType==="chordal"){const pe=this.curveType==="chordal"?.5:.25;let fe=Math.pow(ae.distanceToSquared(ce),pe),be=Math.pow(ce.distanceToSquared(de),pe),me=Math.pow(de.distanceToSquared(ge),pe);be<1e-4&&(be=1),fe<1e-4&&(fe=be),me<1e-4&&(me=be),px.initNonuniformCatmullRom(ae.x,ce.x,de.x,ge.x,fe,be,me),py.initNonuniformCatmullRom(ae.y,ce.y,de.y,ge.y,fe,be,me),pz.initNonuniformCatmullRom(ae.z,ce.z,de.z,ge.z,fe,be,me)}else this.curveType==="catmullrom"&&(px.initCatmullRom(ae.x,ce.x,de.x,ge.x,this.tension),py.initCatmullRom(ae.y,ce.y,de.y,ge.y,this.tension),pz.initCatmullRom(ae.z,ce.z,de.z,ge.z,this.tension));return K.set(px.calc(se),py.calc(se),pz.calc(se)),K}copy(Z){super.copy(Z),this.points=[];for(let _=0,K=Z.points.length;_<K;_++){const te=Z.points[_];this.points.push(te.clone())}return this.closed=Z.closed,this.curveType=Z.curveType,this.tension=Z.tension,this}toJSON(){const Z=super.toJSON();Z.points=[];for(let _=0,K=this.points.length;_<K;_++){const te=this.points[_];Z.points.push(te.toArray())}return Z.closed=this.closed,Z.curveType=this.curveType,Z.tension=this.tension,Z}fromJSON(Z){super.fromJSON(Z),this.points=[];for(let _=0,K=Z.points.length;_<K;_++){const te=Z.points[_];this.points.push(new Vector3().fromArray(te))}return this.closed=Z.closed,this.curveType=Z.curveType,this.tension=Z.tension,this}}function CatmullRom(X,Z,_,K,te){const ne=(K-Z)*.5,oe=(te-_)*.5,ie=X*X,se=X*ie;return(2*_-2*K+ne+oe)*se+(-3*_+3*K-2*ne-oe)*ie+ne*X+_}function QuadraticBezierP0(X,Z){const _=1-X;return _*_*Z}function QuadraticBezierP1(X,Z){return 2*(1-X)*X*Z}function QuadraticBezierP2(X,Z){return X*X*Z}function QuadraticBezier(X,Z,_,K){return QuadraticBezierP0(X,Z)+QuadraticBezierP1(X,_)+QuadraticBezierP2(X,K)}function CubicBezierP0(X,Z){const _=1-X;return _*_*_*Z}function CubicBezierP1(X,Z){const _=1-X;return 3*_*_*X*Z}function CubicBezierP2(X,Z){return 3*(1-X)*X*X*Z}function CubicBezierP3(X,Z){return X*X*X*Z}function CubicBezier(X,Z,_,K,te){return CubicBezierP0(X,Z)+CubicBezierP1(X,_)+CubicBezierP2(X,K)+CubicBezierP3(X,te)}class CubicBezierCurve extends Curve{constructor(Z=new Vector2,_=new Vector2,K=new Vector2,te=new Vector2){super(),this.isCubicBezierCurve=!0,this.type="CubicBezierCurve",this.v0=Z,this.v1=_,this.v2=K,this.v3=te}getPoint(Z,_=new Vector2){const K=_,te=this.v0,ne=this.v1,oe=this.v2,ie=this.v3;return K.set(CubicBezier(Z,te.x,ne.x,oe.x,ie.x),CubicBezier(Z,te.y,ne.y,oe.y,ie.y)),K}copy(Z){return super.copy(Z),this.v0.copy(Z.v0),this.v1.copy(Z.v1),this.v2.copy(Z.v2),this.v3.copy(Z.v3),this}toJSON(){const Z=super.toJSON();return Z.v0=this.v0.toArray(),Z.v1=this.v1.toArray(),Z.v2=this.v2.toArray(),Z.v3=this.v3.toArray(),Z}fromJSON(Z){return super.fromJSON(Z),this.v0.fromArray(Z.v0),this.v1.fromArray(Z.v1),this.v2.fromArray(Z.v2),this.v3.fromArray(Z.v3),this}}class CubicBezierCurve3 extends Curve{constructor(Z=new Vector3,_=new Vector3,K=new Vector3,te=new Vector3){super(),this.isCubicBezierCurve3=!0,this.type="CubicBezierCurve3",this.v0=Z,this.v1=_,this.v2=K,this.v3=te}getPoint(Z,_=new Vector3){const K=_,te=this.v0,ne=this.v1,oe=this.v2,ie=this.v3;return K.set(CubicBezier(Z,te.x,ne.x,oe.x,ie.x),CubicBezier(Z,te.y,ne.y,oe.y,ie.y),CubicBezier(Z,te.z,ne.z,oe.z,ie.z)),K}copy(Z){return super.copy(Z),this.v0.copy(Z.v0),this.v1.copy(Z.v1),this.v2.copy(Z.v2),this.v3.copy(Z.v3),this}toJSON(){const Z=super.toJSON();return Z.v0=this.v0.toArray(),Z.v1=this.v1.toArray(),Z.v2=this.v2.toArray(),Z.v3=this.v3.toArray(),Z}fromJSON(Z){return super.fromJSON(Z),this.v0.fromArray(Z.v0),this.v1.fromArray(Z.v1),this.v2.fromArray(Z.v2),this.v3.fromArray(Z.v3),this}}class LineCurve extends Curve{constructor(Z=new Vector2,_=new Vector2){super(),this.isLineCurve=!0,this.type="LineCurve",this.v1=Z,this.v2=_}getPoint(Z,_=new Vector2){const K=_;return Z===1?K.copy(this.v2):(K.copy(this.v2).sub(this.v1),K.multiplyScalar(Z).add(this.v1)),K}getPointAt(Z,_){return this.getPoint(Z,_)}getTangent(Z,_=new Vector2){return _.subVectors(this.v2,this.v1).normalize()}getTangentAt(Z,_){return this.getTangent(Z,_)}copy(Z){return super.copy(Z),this.v1.copy(Z.v1),this.v2.copy(Z.v2),this}toJSON(){const Z=super.toJSON();return Z.v1=this.v1.toArray(),Z.v2=this.v2.toArray(),Z}fromJSON(Z){return super.fromJSON(Z),this.v1.fromArray(Z.v1),this.v2.fromArray(Z.v2),this}}class LineCurve3 extends Curve{constructor(Z=new Vector3,_=new Vector3){super(),this.isLineCurve3=!0,this.type="LineCurve3",this.v1=Z,this.v2=_}getPoint(Z,_=new Vector3){const K=_;return Z===1?K.copy(this.v2):(K.copy(this.v2).sub(this.v1),K.multiplyScalar(Z).add(this.v1)),K}getPointAt(Z,_){return this.getPoint(Z,_)}getTangent(Z,_=new Vector3){return _.subVectors(this.v2,this.v1).normalize()}getTangentAt(Z,_){return this.getTangent(Z,_)}copy(Z){return super.copy(Z),this.v1.copy(Z.v1),this.v2.copy(Z.v2),this}toJSON(){const Z=super.toJSON();return Z.v1=this.v1.toArray(),Z.v2=this.v2.toArray(),Z}fromJSON(Z){return super.fromJSON(Z),this.v1.fromArray(Z.v1),this.v2.fromArray(Z.v2),this}}class QuadraticBezierCurve extends Curve{constructor(Z=new Vector2,_=new Vector2,K=new Vector2){super(),this.isQuadraticBezierCurve=!0,this.type="QuadraticBezierCurve",this.v0=Z,this.v1=_,this.v2=K}getPoint(Z,_=new Vector2){const K=_,te=this.v0,ne=this.v1,oe=this.v2;return K.set(QuadraticBezier(Z,te.x,ne.x,oe.x),QuadraticBezier(Z,te.y,ne.y,oe.y)),K}copy(Z){return super.copy(Z),this.v0.copy(Z.v0),this.v1.copy(Z.v1),this.v2.copy(Z.v2),this}toJSON(){const Z=super.toJSON();return Z.v0=this.v0.toArray(),Z.v1=this.v1.toArray(),Z.v2=this.v2.toArray(),Z}fromJSON(Z){return super.fromJSON(Z),this.v0.fromArray(Z.v0),this.v1.fromArray(Z.v1),this.v2.fromArray(Z.v2),this}}class QuadraticBezierCurve3 extends Curve{constructor(Z=new Vector3,_=new Vector3,K=new Vector3){super(),this.isQuadraticBezierCurve3=!0,this.type="QuadraticBezierCurve3",this.v0=Z,this.v1=_,this.v2=K}getPoint(Z,_=new Vector3){const K=_,te=this.v0,ne=this.v1,oe=this.v2;return K.set(QuadraticBezier(Z,te.x,ne.x,oe.x),QuadraticBezier(Z,te.y,ne.y,oe.y),QuadraticBezier(Z,te.z,ne.z,oe.z)),K}copy(Z){return super.copy(Z),this.v0.copy(Z.v0),this.v1.copy(Z.v1),this.v2.copy(Z.v2),this}toJSON(){const Z=super.toJSON();return Z.v0=this.v0.toArray(),Z.v1=this.v1.toArray(),Z.v2=this.v2.toArray(),Z}fromJSON(Z){return super.fromJSON(Z),this.v0.fromArray(Z.v0),this.v1.fromArray(Z.v1),this.v2.fromArray(Z.v2),this}}class SplineCurve extends Curve{constructor(Z=[]){super(),this.isSplineCurve=!0,this.type="SplineCurve",this.points=Z}getPoint(Z,_=new Vector2){const K=_,te=this.points,ne=(te.length-1)*Z,oe=Math.floor(ne),ie=ne-oe,se=te[oe===0?oe:oe-1],ae=te[oe],ge=te[oe>te.length-2?te.length-1:oe+1],ce=te[oe>te.length-3?te.length-1:oe+2];return K.set(CatmullRom(ie,se.x,ae.x,ge.x,ce.x),CatmullRom(ie,se.y,ae.y,ge.y,ce.y)),K}copy(Z){super.copy(Z),this.points=[];for(let _=0,K=Z.points.length;_<K;_++){const te=Z.points[_];this.points.push(te.clone())}return this}toJSON(){const Z=super.toJSON();Z.points=[];for(let _=0,K=this.points.length;_<K;_++){const te=this.points[_];Z.points.push(te.toArray())}return Z}fromJSON(Z){super.fromJSON(Z),this.points=[];for(let _=0,K=Z.points.length;_<K;_++){const te=Z.points[_];this.points.push(new Vector2().fromArray(te))}return this}}var Curves=Object.freeze({__proto__:null,ArcCurve,CatmullRomCurve3,CubicBezierCurve,CubicBezierCurve3,EllipseCurve,LineCurve,LineCurve3,QuadraticBezierCurve,QuadraticBezierCurve3,SplineCurve});class CurvePath extends Curve{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(Z){this.curves.push(Z)}closePath(){const Z=this.curves[0].getPoint(0),_=this.curves[this.curves.length-1].getPoint(1);Z.equals(_)||this.curves.push(new LineCurve(_,Z))}getPoint(Z,_){const K=Z*this.getLength(),te=this.getCurveLengths();let ne=0;for(;ne<te.length;){if(te[ne]>=K){const oe=te[ne]-K,ie=this.curves[ne],se=ie.getLength(),ae=se===0?0:1-oe/se;return ie.getPointAt(ae,_)}ne++}return null}getLength(){const Z=this.getCurveLengths();return Z[Z.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;const Z=[];let _=0;for(let K=0,te=this.curves.length;K<te;K++)_+=this.curves[K].getLength(),Z.push(_);return this.cacheLengths=Z,Z}getSpacedPoints(Z=40){const _=[];for(let K=0;K<=Z;K++)_.push(this.getPoint(K/Z));return this.autoClose&&_.push(_[0]),_}getPoints(Z=12){const _=[];let K;for(let te=0,ne=this.curves;te<ne.length;te++){const oe=ne[te],ie=oe.isEllipseCurve?Z*2:oe.isLineCurve||oe.isLineCurve3?1:oe.isSplineCurve?Z*oe.points.length:Z,se=oe.getPoints(ie);for(let ae=0;ae<se.length;ae++){const ge=se[ae];K&&K.equals(ge)||(_.push(ge),K=ge)}}return this.autoClose&&_.length>1&&!_[_.length-1].equals(_[0])&&_.push(_[0]),_}copy(Z){super.copy(Z),this.curves=[];for(let _=0,K=Z.curves.length;_<K;_++){const te=Z.curves[_];this.curves.push(te.clone())}return this.autoClose=Z.autoClose,this}toJSON(){const Z=super.toJSON();Z.autoClose=this.autoClose,Z.curves=[];for(let _=0,K=this.curves.length;_<K;_++){const te=this.curves[_];Z.curves.push(te.toJSON())}return Z}fromJSON(Z){super.fromJSON(Z),this.autoClose=Z.autoClose,this.curves=[];for(let _=0,K=Z.curves.length;_<K;_++){const te=Z.curves[_];this.curves.push(new Curves[te.type]().fromJSON(te))}return this}}class Path extends CurvePath{constructor(Z){super(),this.type="Path",this.currentPoint=new Vector2,Z&&this.setFromPoints(Z)}setFromPoints(Z){this.moveTo(Z[0].x,Z[0].y);for(let _=1,K=Z.length;_<K;_++)this.lineTo(Z[_].x,Z[_].y);return this}moveTo(Z,_){return this.currentPoint.set(Z,_),this}lineTo(Z,_){const K=new LineCurve(this.currentPoint.clone(),new Vector2(Z,_));return this.curves.push(K),this.currentPoint.set(Z,_),this}quadraticCurveTo(Z,_,K,te){const ne=new QuadraticBezierCurve(this.currentPoint.clone(),new Vector2(Z,_),new Vector2(K,te));return this.curves.push(ne),this.currentPoint.set(K,te),this}bezierCurveTo(Z,_,K,te,ne,oe){const ie=new CubicBezierCurve(this.currentPoint.clone(),new Vector2(Z,_),new Vector2(K,te),new Vector2(ne,oe));return this.curves.push(ie),this.currentPoint.set(ne,oe),this}splineThru(Z){const _=[this.currentPoint.clone()].concat(Z),K=new SplineCurve(_);return this.curves.push(K),this.currentPoint.copy(Z[Z.length-1]),this}arc(Z,_,K,te,ne,oe){const ie=this.currentPoint.x,se=this.currentPoint.y;return this.absarc(Z+ie,_+se,K,te,ne,oe),this}absarc(Z,_,K,te,ne,oe){return this.absellipse(Z,_,K,K,te,ne,oe),this}ellipse(Z,_,K,te,ne,oe,ie,se){const ae=this.currentPoint.x,ge=this.currentPoint.y;return this.absellipse(Z+ae,_+ge,K,te,ne,oe,ie,se),this}absellipse(Z,_,K,te,ne,oe,ie,se){const ae=new EllipseCurve(Z,_,K,te,ne,oe,ie,se);if(this.curves.length>0){const ce=ae.getPoint(0);ce.equals(this.currentPoint)||this.lineTo(ce.x,ce.y)}this.curves.push(ae);const ge=ae.getPoint(1);return this.currentPoint.copy(ge),this}copy(Z){return super.copy(Z),this.currentPoint.copy(Z.currentPoint),this}toJSON(){const Z=super.toJSON();return Z.currentPoint=this.currentPoint.toArray(),Z}fromJSON(Z){return super.fromJSON(Z),this.currentPoint.fromArray(Z.currentPoint),this}}class LatheGeometry extends BufferGeometry{constructor(Z=[new Vector2(0,-.5),new Vector2(.5,0),new Vector2(0,.5)],_=12,K=0,te=Math.PI*2){super(),this.type="LatheGeometry",this.parameters={points:Z,segments:_,phiStart:K,phiLength:te},_=Math.floor(_),te=clamp$3(te,0,Math.PI*2);const ne=[],oe=[],ie=[],se=[],ae=[],ge=1/_,ce=new Vector3,de=new Vector2,pe=new Vector3,fe=new Vector3,be=new Vector3;let me=0,ye=0;for(let ve=0;ve<=Z.length-1;ve++)switch(ve){case 0:me=Z[ve+1].x-Z[ve].x,ye=Z[ve+1].y-Z[ve].y,pe.x=ye*1,pe.y=-me,pe.z=ye*0,be.copy(pe),pe.normalize(),se.push(pe.x,pe.y,pe.z);break;case Z.length-1:se.push(be.x,be.y,be.z);break;default:me=Z[ve+1].x-Z[ve].x,ye=Z[ve+1].y-Z[ve].y,pe.x=ye*1,pe.y=-me,pe.z=ye*0,fe.copy(pe),pe.x+=be.x,pe.y+=be.y,pe.z+=be.z,pe.normalize(),se.push(pe.x,pe.y,pe.z),be.copy(fe)}for(let ve=0;ve<=_;ve++){const Be=K+ve*ge*te,Re=Math.sin(Be),Ee=Math.cos(Be);for(let We=0;We<=Z.length-1;We++){ce.x=Z[We].x*Re,ce.y=Z[We].y,ce.z=Z[We].x*Ee,oe.push(ce.x,ce.y,ce.z),de.x=ve/_,de.y=We/(Z.length-1),ie.push(de.x,de.y);const Ze=se[3*We+0]*Re,Ve=se[3*We+1],_e=se[3*We+0]*Ee;ae.push(Ze,Ve,_e)}}for(let ve=0;ve<_;ve++)for(let Be=0;Be<Z.length-1;Be++){const Re=Be+ve*Z.length,Ee=Re,We=Re+Z.length,Ze=Re+Z.length+1,Ve=Re+1;ne.push(Ee,We,Ve),ne.push(Ze,Ve,We)}this.setIndex(ne),this.setAttribute("position",new Float32BufferAttribute(oe,3)),this.setAttribute("uv",new Float32BufferAttribute(ie,2)),this.setAttribute("normal",new Float32BufferAttribute(ae,3))}copy(Z){return super.copy(Z),this.parameters=Object.assign({},Z.parameters),this}static fromJSON(Z){return new LatheGeometry(Z.points,Z.segments,Z.phiStart,Z.phiLength)}}class CapsuleGeometry extends LatheGeometry{constructor(Z=1,_=1,K=4,te=8){const ne=new Path;ne.absarc(0,-_/2,Z,Math.PI*1.5,0),ne.absarc(0,_/2,Z,0,Math.PI*.5),super(ne.getPoints(K),te),this.type="CapsuleGeometry",this.parameters={radius:Z,height:_,capSegments:K,radialSegments:te}}static fromJSON(Z){return new CapsuleGeometry(Z.radius,Z.length,Z.capSegments,Z.radialSegments)}}class CircleGeometry extends BufferGeometry{constructor(Z=1,_=32,K=0,te=Math.PI*2){super(),this.type="CircleGeometry",this.parameters={radius:Z,segments:_,thetaStart:K,thetaLength:te},_=Math.max(3,_);const ne=[],oe=[],ie=[],se=[],ae=new Vector3,ge=new Vector2;oe.push(0,0,0),ie.push(0,0,1),se.push(.5,.5);for(let ce=0,de=3;ce<=_;ce++,de+=3){const pe=K+ce/_*te;ae.x=Z*Math.cos(pe),ae.y=Z*Math.sin(pe),oe.push(ae.x,ae.y,ae.z),ie.push(0,0,1),ge.x=(oe[de]/Z+1)/2,ge.y=(oe[de+1]/Z+1)/2,se.push(ge.x,ge.y)}for(let ce=1;ce<=_;ce++)ne.push(ce,ce+1,0);this.setIndex(ne),this.setAttribute("position",new Float32BufferAttribute(oe,3)),this.setAttribute("normal",new Float32BufferAttribute(ie,3)),this.setAttribute("uv",new Float32BufferAttribute(se,2))}copy(Z){return super.copy(Z),this.parameters=Object.assign({},Z.parameters),this}static fromJSON(Z){return new CircleGeometry(Z.radius,Z.segments,Z.thetaStart,Z.thetaLength)}}class CylinderGeometry extends BufferGeometry{constructor(Z=1,_=1,K=1,te=32,ne=1,oe=!1,ie=0,se=Math.PI*2){super(),this.type="CylinderGeometry",this.parameters={radiusTop:Z,radiusBottom:_,height:K,radialSegments:te,heightSegments:ne,openEnded:oe,thetaStart:ie,thetaLength:se};const ae=this;te=Math.floor(te),ne=Math.floor(ne);const ge=[],ce=[],de=[],pe=[];let fe=0;const be=[],me=K/2;let ye=0;ve(),oe===!1&&(Z>0&&Be(!0),_>0&&Be(!1)),this.setIndex(ge),this.setAttribute("position",new Float32BufferAttribute(ce,3)),this.setAttribute("normal",new Float32BufferAttribute(de,3)),this.setAttribute("uv",new Float32BufferAttribute(pe,2));function ve(){const Re=new Vector3,Ee=new Vector3;let We=0;const Ze=(_-Z)/K;for(let Ve=0;Ve<=ne;Ve++){const _e=[],Xe=Ve/ne,Pe=Xe*(_-Z)+Z;for(let He=0;He<=te;He++){const Ke=He/te,Ue=Ke*se+ie,tt=Math.sin(Ue),rt=Math.cos(Ue);Ee.x=Pe*tt,Ee.y=-Xe*K+me,Ee.z=Pe*rt,ce.push(Ee.x,Ee.y,Ee.z),Re.set(tt,Ze,rt).normalize(),de.push(Re.x,Re.y,Re.z),pe.push(Ke,1-Xe),_e.push(fe++)}be.push(_e)}for(let Ve=0;Ve<te;Ve++)for(let _e=0;_e<ne;_e++){const Xe=be[_e][Ve],Pe=be[_e+1][Ve],He=be[_e+1][Ve+1],Ke=be[_e][Ve+1];ge.push(Xe,Pe,Ke),ge.push(Pe,He,Ke),We+=6}ae.addGroup(ye,We,0),ye+=We}function Be(Re){const Ee=fe,We=new Vector2,Ze=new Vector3;let Ve=0;const _e=Re===!0?Z:_,Xe=Re===!0?1:-1;for(let He=1;He<=te;He++)ce.push(0,me*Xe,0),de.push(0,Xe,0),pe.push(.5,.5),fe++;const Pe=fe;for(let He=0;He<=te;He++){const Ue=He/te*se+ie,tt=Math.cos(Ue),rt=Math.sin(Ue);Ze.x=_e*rt,Ze.y=me*Xe,Ze.z=_e*tt,ce.push(Ze.x,Ze.y,Ze.z),de.push(0,Xe,0),We.x=tt*.5+.5,We.y=rt*.5*Xe+.5,pe.push(We.x,We.y),fe++}for(let He=0;He<te;He++){const Ke=Ee+He,Ue=Pe+He;Re===!0?ge.push(Ue,Ue+1,Ke):ge.push(Ue+1,Ue,Ke),Ve+=3}ae.addGroup(ye,Ve,Re===!0?1:2),ye+=Ve}}copy(Z){return super.copy(Z),this.parameters=Object.assign({},Z.parameters),this}static fromJSON(Z){return new CylinderGeometry(Z.radiusTop,Z.radiusBottom,Z.height,Z.radialSegments,Z.heightSegments,Z.openEnded,Z.thetaStart,Z.thetaLength)}}class ConeGeometry extends CylinderGeometry{constructor(Z=1,_=1,K=32,te=1,ne=!1,oe=0,ie=Math.PI*2){super(0,Z,_,K,te,ne,oe,ie),this.type="ConeGeometry",this.parameters={radius:Z,height:_,radialSegments:K,heightSegments:te,openEnded:ne,thetaStart:oe,thetaLength:ie}}static fromJSON(Z){return new ConeGeometry(Z.radius,Z.height,Z.radialSegments,Z.heightSegments,Z.openEnded,Z.thetaStart,Z.thetaLength)}}class PolyhedronGeometry extends BufferGeometry{constructor(Z=[],_=[],K=1,te=0){super(),this.type="PolyhedronGeometry",this.parameters={vertices:Z,indices:_,radius:K,detail:te};const ne=[],oe=[];ie(te),ae(K),ge(),this.setAttribute("position",new Float32BufferAttribute(ne,3)),this.setAttribute("normal",new Float32BufferAttribute(ne.slice(),3)),this.setAttribute("uv",new Float32BufferAttribute(oe,2)),te===0?this.computeVertexNormals():this.normalizeNormals();function ie(ve){const Be=new Vector3,Re=new Vector3,Ee=new Vector3;for(let We=0;We<_.length;We+=3)pe(_[We+0],Be),pe(_[We+1],Re),pe(_[We+2],Ee),se(Be,Re,Ee,ve)}function se(ve,Be,Re,Ee){const We=Ee+1,Ze=[];for(let Ve=0;Ve<=We;Ve++){Ze[Ve]=[];const _e=ve.clone().lerp(Re,Ve/We),Xe=Be.clone().lerp(Re,Ve/We),Pe=We-Ve;for(let He=0;He<=Pe;He++)He===0&&Ve===We?Ze[Ve][He]=_e:Ze[Ve][He]=_e.clone().lerp(Xe,He/Pe)}for(let Ve=0;Ve<We;Ve++)for(let _e=0;_e<2*(We-Ve)-1;_e++){const Xe=Math.floor(_e/2);_e%2===0?(de(Ze[Ve][Xe+1]),de(Ze[Ve+1][Xe]),de(Ze[Ve][Xe])):(de(Ze[Ve][Xe+1]),de(Ze[Ve+1][Xe+1]),de(Ze[Ve+1][Xe]))}}function ae(ve){const Be=new Vector3;for(let Re=0;Re<ne.length;Re+=3)Be.x=ne[Re+0],Be.y=ne[Re+1],Be.z=ne[Re+2],Be.normalize().multiplyScalar(ve),ne[Re+0]=Be.x,ne[Re+1]=Be.y,ne[Re+2]=Be.z}function ge(){const ve=new Vector3;for(let Be=0;Be<ne.length;Be+=3){ve.x=ne[Be+0],ve.y=ne[Be+1],ve.z=ne[Be+2];const Re=me(ve)/2/Math.PI+.5,Ee=ye(ve)/Math.PI+.5;oe.push(Re,1-Ee)}fe(),ce()}function ce(){for(let ve=0;ve<oe.length;ve+=6){const Be=oe[ve+0],Re=oe[ve+2],Ee=oe[ve+4],We=Math.max(Be,Re,Ee),Ze=Math.min(Be,Re,Ee);We>.9&&Ze<.1&&(Be<.2&&(oe[ve+0]+=1),Re<.2&&(oe[ve+2]+=1),Ee<.2&&(oe[ve+4]+=1))}}function de(ve){ne.push(ve.x,ve.y,ve.z)}function pe(ve,Be){const Re=ve*3;Be.x=Z[Re+0],Be.y=Z[Re+1],Be.z=Z[Re+2]}function fe(){const ve=new Vector3,Be=new Vector3,Re=new Vector3,Ee=new Vector3,We=new Vector2,Ze=new Vector2,Ve=new Vector2;for(let _e=0,Xe=0;_e<ne.length;_e+=9,Xe+=6){ve.set(ne[_e+0],ne[_e+1],ne[_e+2]),Be.set(ne[_e+3],ne[_e+4],ne[_e+5]),Re.set(ne[_e+6],ne[_e+7],ne[_e+8]),We.set(oe[Xe+0],oe[Xe+1]),Ze.set(oe[Xe+2],oe[Xe+3]),Ve.set(oe[Xe+4],oe[Xe+5]),Ee.copy(ve).add(Be).add(Re).divideScalar(3);const Pe=me(Ee);be(We,Xe+0,ve,Pe),be(Ze,Xe+2,Be,Pe),be(Ve,Xe+4,Re,Pe)}}function be(ve,Be,Re,Ee){Ee<0&&ve.x===1&&(oe[Be]=ve.x-1),Re.x===0&&Re.z===0&&(oe[Be]=Ee/2/Math.PI+.5)}function me(ve){return Math.atan2(ve.z,-ve.x)}function ye(ve){return Math.atan2(-ve.y,Math.sqrt(ve.x*ve.x+ve.z*ve.z))}}copy(Z){return super.copy(Z),this.parameters=Object.assign({},Z.parameters),this}static fromJSON(Z){return new PolyhedronGeometry(Z.vertices,Z.indices,Z.radius,Z.details)}}class DodecahedronGeometry extends PolyhedronGeometry{constructor(Z=1,_=0){const K=(1+Math.sqrt(5))/2,te=1/K,ne=[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-te,-K,0,-te,K,0,te,-K,0,te,K,-te,-K,0,-te,K,0,te,-K,0,te,K,0,-K,0,-te,K,0,-te,-K,0,te,K,0,te],oe=[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9];super(ne,oe,Z,_),this.type="DodecahedronGeometry",this.parameters={radius:Z,detail:_}}static fromJSON(Z){return new DodecahedronGeometry(Z.radius,Z.detail)}}const _v0=new Vector3,_v1$1=new Vector3,_normal=new Vector3,_triangle=new Triangle;class EdgesGeometry extends BufferGeometry{constructor(Z=null,_=1){if(super(),this.type="EdgesGeometry",this.parameters={geometry:Z,thresholdAngle:_},Z!==null){const te=Math.pow(10,4),ne=Math.cos(DEG2RAD*_),oe=Z.getIndex(),ie=Z.getAttribute("position"),se=oe?oe.count:ie.count,ae=[0,0,0],ge=["a","b","c"],ce=new Array(3),de={},pe=[];for(let fe=0;fe<se;fe+=3){oe?(ae[0]=oe.getX(fe),ae[1]=oe.getX(fe+1),ae[2]=oe.getX(fe+2)):(ae[0]=fe,ae[1]=fe+1,ae[2]=fe+2);const{a:be,b:me,c:ye}=_triangle;if(be.fromBufferAttribute(ie,ae[0]),me.fromBufferAttribute(ie,ae[1]),ye.fromBufferAttribute(ie,ae[2]),_triangle.getNormal(_normal),ce[0]=`${Math.round(be.x*te)},${Math.round(be.y*te)},${Math.round(be.z*te)}`,ce[1]=`${Math.round(me.x*te)},${Math.round(me.y*te)},${Math.round(me.z*te)}`,ce[2]=`${Math.round(ye.x*te)},${Math.round(ye.y*te)},${Math.round(ye.z*te)}`,!(ce[0]===ce[1]||ce[1]===ce[2]||ce[2]===ce[0]))for(let ve=0;ve<3;ve++){const Be=(ve+1)%3,Re=ce[ve],Ee=ce[Be],We=_triangle[ge[ve]],Ze=_triangle[ge[Be]],Ve=`${Re}_${Ee}`,_e=`${Ee}_${Re}`;_e in de&&de[_e]?(_normal.dot(de[_e].normal)<=ne&&(pe.push(We.x,We.y,We.z),pe.push(Ze.x,Ze.y,Ze.z)),de[_e]=null):Ve in de||(de[Ve]={index0:ae[ve],index1:ae[Be],normal:_normal.clone()})}}for(const fe in de)if(de[fe]){const{index0:be,index1:me}=de[fe];_v0.fromBufferAttribute(ie,be),_v1$1.fromBufferAttribute(ie,me),pe.push(_v0.x,_v0.y,_v0.z),pe.push(_v1$1.x,_v1$1.y,_v1$1.z)}this.setAttribute("position",new Float32BufferAttribute(pe,3))}}copy(Z){return super.copy(Z),this.parameters=Object.assign({},Z.parameters),this}}let Shape$2=class extends Path{constructor(Z){super(Z),this.uuid=generateUUID$1(),this.type="Shape",this.holes=[]}getPointsHoles(Z){const _=[];for(let K=0,te=this.holes.length;K<te;K++)_[K]=this.holes[K].getPoints(Z);return _}extractPoints(Z){return{shape:this.getPoints(Z),holes:this.getPointsHoles(Z)}}copy(Z){super.copy(Z),this.holes=[];for(let _=0,K=Z.holes.length;_<K;_++){const te=Z.holes[_];this.holes.push(te.clone())}return this}toJSON(){const Z=super.toJSON();Z.uuid=this.uuid,Z.holes=[];for(let _=0,K=this.holes.length;_<K;_++){const te=this.holes[_];Z.holes.push(te.toJSON())}return Z}fromJSON(Z){super.fromJSON(Z),this.uuid=Z.uuid,this.holes=[];for(let _=0,K=Z.holes.length;_<K;_++){const te=Z.holes[_];this.holes.push(new Path().fromJSON(te))}return this}};const Earcut={triangulate:function(X,Z,_=2){const K=Z&&Z.length,te=K?Z[0]*_:X.length;let ne=linkedList(X,0,te,_,!0);const oe=[];if(!ne||ne.next===ne.prev)return oe;let ie,se,ae,ge,ce,de,pe;if(K&&(ne=eliminateHoles(X,Z,ne,_)),X.length>80*_){ie=ae=X[0],se=ge=X[1];for(let fe=_;fe<te;fe+=_)ce=X[fe],de=X[fe+1],ce<ie&&(ie=ce),de<se&&(se=de),ce>ae&&(ae=ce),de>ge&&(ge=de);pe=Math.max(ae-ie,ge-se),pe=pe!==0?32767/pe:0}return earcutLinked(ne,oe,_,ie,se,pe,0),oe}};function linkedList(X,Z,_,K,te){let ne,oe;if(te===signedArea(X,Z,_,K)>0)for(ne=Z;ne<_;ne+=K)oe=insertNode(ne,X[ne],X[ne+1],oe);else for(ne=_-K;ne>=Z;ne-=K)oe=insertNode(ne,X[ne],X[ne+1],oe);return oe&&equals(oe,oe.next)&&(removeNode(oe),oe=oe.next),oe}function filterPoints(X,Z){if(!X)return X;Z||(Z=X);let _=X,K;do if(K=!1,!_.steiner&&(equals(_,_.next)||area(_.prev,_,_.next)===0)){if(removeNode(_),_=Z=_.prev,_===_.next)break;K=!0}else _=_.next;while(K||_!==Z);return Z}function earcutLinked(X,Z,_,K,te,ne,oe){if(!X)return;!oe&&ne&&indexCurve(X,K,te,ne);let ie=X,se,ae;for(;X.prev!==X.next;){if(se=X.prev,ae=X.next,ne?isEarHashed(X,K,te,ne):isEar(X)){Z.push(se.i/_|0),Z.push(X.i/_|0),Z.push(ae.i/_|0),removeNode(X),X=ae.next,ie=ae.next;continue}if(X=ae,X===ie){oe?oe===1?(X=cureLocalIntersections(filterPoints(X),Z,_),earcutLinked(X,Z,_,K,te,ne,2)):oe===2&&splitEarcut(X,Z,_,K,te,ne):earcutLinked(filterPoints(X),Z,_,K,te,ne,1);break}}}function isEar(X){const Z=X.prev,_=X,K=X.next;if(area(Z,_,K)>=0)return!1;const te=Z.x,ne=_.x,oe=K.x,ie=Z.y,se=_.y,ae=K.y,ge=te<ne?te<oe?te:oe:ne<oe?ne:oe,ce=ie<se?ie<ae?ie:ae:se<ae?se:ae,de=te>ne?te>oe?te:oe:ne>oe?ne:oe,pe=ie>se?ie>ae?ie:ae:se>ae?se:ae;let fe=K.next;for(;fe!==Z;){if(fe.x>=ge&&fe.x<=de&&fe.y>=ce&&fe.y<=pe&&pointInTriangle(te,ie,ne,se,oe,ae,fe.x,fe.y)&&area(fe.prev,fe,fe.next)>=0)return!1;fe=fe.next}return!0}function isEarHashed(X,Z,_,K){const te=X.prev,ne=X,oe=X.next;if(area(te,ne,oe)>=0)return!1;const ie=te.x,se=ne.x,ae=oe.x,ge=te.y,ce=ne.y,de=oe.y,pe=ie<se?ie<ae?ie:ae:se<ae?se:ae,fe=ge<ce?ge<de?ge:de:ce<de?ce:de,be=ie>se?ie>ae?ie:ae:se>ae?se:ae,me=ge>ce?ge>de?ge:de:ce>de?ce:de,ye=zOrder(pe,fe,Z,_,K),ve=zOrder(be,me,Z,_,K);let Be=X.prevZ,Re=X.nextZ;for(;Be&&Be.z>=ye&&Re&&Re.z<=ve;){if(Be.x>=pe&&Be.x<=be&&Be.y>=fe&&Be.y<=me&&Be!==te&&Be!==oe&&pointInTriangle(ie,ge,se,ce,ae,de,Be.x,Be.y)&&area(Be.prev,Be,Be.next)>=0||(Be=Be.prevZ,Re.x>=pe&&Re.x<=be&&Re.y>=fe&&Re.y<=me&&Re!==te&&Re!==oe&&pointInTriangle(ie,ge,se,ce,ae,de,Re.x,Re.y)&&area(Re.prev,Re,Re.next)>=0))return!1;Re=Re.nextZ}for(;Be&&Be.z>=ye;){if(Be.x>=pe&&Be.x<=be&&Be.y>=fe&&Be.y<=me&&Be!==te&&Be!==oe&&pointInTriangle(ie,ge,se,ce,ae,de,Be.x,Be.y)&&area(Be.prev,Be,Be.next)>=0)return!1;Be=Be.prevZ}for(;Re&&Re.z<=ve;){if(Re.x>=pe&&Re.x<=be&&Re.y>=fe&&Re.y<=me&&Re!==te&&Re!==oe&&pointInTriangle(ie,ge,se,ce,ae,de,Re.x,Re.y)&&area(Re.prev,Re,Re.next)>=0)return!1;Re=Re.nextZ}return!0}function cureLocalIntersections(X,Z,_){let K=X;do{const te=K.prev,ne=K.next.next;!equals(te,ne)&&intersects(te,K,K.next,ne)&&locallyInside(te,ne)&&locallyInside(ne,te)&&(Z.push(te.i/_|0),Z.push(K.i/_|0),Z.push(ne.i/_|0),removeNode(K),removeNode(K.next),K=X=ne),K=K.next}while(K!==X);return filterPoints(K)}function splitEarcut(X,Z,_,K,te,ne){let oe=X;do{let ie=oe.next.next;for(;ie!==oe.prev;){if(oe.i!==ie.i&&isValidDiagonal(oe,ie)){let se=splitPolygon(oe,ie);oe=filterPoints(oe,oe.next),se=filterPoints(se,se.next),earcutLinked(oe,Z,_,K,te,ne,0),earcutLinked(se,Z,_,K,te,ne,0);return}ie=ie.next}oe=oe.next}while(oe!==X)}function eliminateHoles(X,Z,_,K){const te=[];let ne,oe,ie,se,ae;for(ne=0,oe=Z.length;ne<oe;ne++)ie=Z[ne]*K,se=ne<oe-1?Z[ne+1]*K:X.length,ae=linkedList(X,ie,se,K,!1),ae===ae.next&&(ae.steiner=!0),te.push(getLeftmost(ae));for(te.sort(compareX),ne=0;ne<te.length;ne++)_=eliminateHole(te[ne],_);return _}function compareX(X,Z){return X.x-Z.x}function eliminateHole(X,Z){const _=findHoleBridge(X,Z);if(!_)return Z;const K=splitPolygon(_,X);return filterPoints(K,K.next),filterPoints(_,_.next)}function findHoleBridge(X,Z){let _=Z,K=-1/0,te;const ne=X.x,oe=X.y;do{if(oe<=_.y&&oe>=_.next.y&&_.next.y!==_.y){const de=_.x+(oe-_.y)*(_.next.x-_.x)/(_.next.y-_.y);if(de<=ne&&de>K&&(K=de,te=_.x<_.next.x?_:_.next,de===ne))return te}_=_.next}while(_!==Z);if(!te)return null;const ie=te,se=te.x,ae=te.y;let ge=1/0,ce;_=te;do ne>=_.x&&_.x>=se&&ne!==_.x&&pointInTriangle(oe<ae?ne:K,oe,se,ae,oe<ae?K:ne,oe,_.x,_.y)&&(ce=Math.abs(oe-_.y)/(ne-_.x),locallyInside(_,X)&&(ce<ge||ce===ge&&(_.x>te.x||_.x===te.x&&sectorContainsSector(te,_)))&&(te=_,ge=ce)),_=_.next;while(_!==ie);return te}function sectorContainsSector(X,Z){return area(X.prev,X,Z.prev)<0&&area(Z.next,X,X.next)<0}function indexCurve(X,Z,_,K){let te=X;do te.z===0&&(te.z=zOrder(te.x,te.y,Z,_,K)),te.prevZ=te.prev,te.nextZ=te.next,te=te.next;while(te!==X);te.prevZ.nextZ=null,te.prevZ=null,sortLinked(te)}function sortLinked(X){let Z,_,K,te,ne,oe,ie,se,ae=1;do{for(_=X,X=null,ne=null,oe=0;_;){for(oe++,K=_,ie=0,Z=0;Z<ae&&(ie++,K=K.nextZ,!!K);Z++);for(se=ae;ie>0||se>0&&K;)ie!==0&&(se===0||!K||_.z<=K.z)?(te=_,_=_.nextZ,ie--):(te=K,K=K.nextZ,se--),ne?ne.nextZ=te:X=te,te.prevZ=ne,ne=te;_=K}ne.nextZ=null,ae*=2}while(oe>1);return X}function zOrder(X,Z,_,K,te){return X=(X-_)*te|0,Z=(Z-K)*te|0,X=(X|X<<8)&16711935,X=(X|X<<4)&252645135,X=(X|X<<2)&858993459,X=(X|X<<1)&1431655765,Z=(Z|Z<<8)&16711935,Z=(Z|Z<<4)&252645135,Z=(Z|Z<<2)&858993459,Z=(Z|Z<<1)&1431655765,X|Z<<1}function getLeftmost(X){let Z=X,_=X;do(Z.x<_.x||Z.x===_.x&&Z.y<_.y)&&(_=Z),Z=Z.next;while(Z!==X);return _}function pointInTriangle(X,Z,_,K,te,ne,oe,ie){return(te-oe)*(Z-ie)>=(X-oe)*(ne-ie)&&(X-oe)*(K-ie)>=(_-oe)*(Z-ie)&&(_-oe)*(ne-ie)>=(te-oe)*(K-ie)}function isValidDiagonal(X,Z){return X.next.i!==Z.i&&X.prev.i!==Z.i&&!intersectsPolygon(X,Z)&&(locallyInside(X,Z)&&locallyInside(Z,X)&&middleInside(X,Z)&&(area(X.prev,X,Z.prev)||area(X,Z.prev,Z))||equals(X,Z)&&area(X.prev,X,X.next)>0&&area(Z.prev,Z,Z.next)>0)}function area(X,Z,_){return(Z.y-X.y)*(_.x-Z.x)-(Z.x-X.x)*(_.y-Z.y)}function equals(X,Z){return X.x===Z.x&&X.y===Z.y}function intersects(X,Z,_,K){const te=sign(area(X,Z,_)),ne=sign(area(X,Z,K)),oe=sign(area(_,K,X)),ie=sign(area(_,K,Z));return!!(te!==ne&&oe!==ie||te===0&&onSegment(X,_,Z)||ne===0&&onSegment(X,K,Z)||oe===0&&onSegment(_,X,K)||ie===0&&onSegment(_,Z,K))}function onSegment(X,Z,_){return Z.x<=Math.max(X.x,_.x)&&Z.x>=Math.min(X.x,_.x)&&Z.y<=Math.max(X.y,_.y)&&Z.y>=Math.min(X.y,_.y)}function sign(X){return X>0?1:X<0?-1:0}function intersectsPolygon(X,Z){let _=X;do{if(_.i!==X.i&&_.next.i!==X.i&&_.i!==Z.i&&_.next.i!==Z.i&&intersects(_,_.next,X,Z))return!0;_=_.next}while(_!==X);return!1}function locallyInside(X,Z){return area(X.prev,X,X.next)<0?area(X,Z,X.next)>=0&&area(X,X.prev,Z)>=0:area(X,Z,X.prev)<0||area(X,X.next,Z)<0}function middleInside(X,Z){let _=X,K=!1;const te=(X.x+Z.x)/2,ne=(X.y+Z.y)/2;do _.y>ne!=_.next.y>ne&&_.next.y!==_.y&&te<(_.next.x-_.x)*(ne-_.y)/(_.next.y-_.y)+_.x&&(K=!K),_=_.next;while(_!==X);return K}function splitPolygon(X,Z){const _=new Node(X.i,X.x,X.y),K=new Node(Z.i,Z.x,Z.y),te=X.next,ne=Z.prev;return X.next=Z,Z.prev=X,_.next=te,te.prev=_,K.next=_,_.prev=K,ne.next=K,K.prev=ne,K}function insertNode(X,Z,_,K){const te=new Node(X,Z,_);return K?(te.next=K.next,te.prev=K,K.next.prev=te,K.next=te):(te.prev=te,te.next=te),te}function removeNode(X){X.next.prev=X.prev,X.prev.next=X.next,X.prevZ&&(X.prevZ.nextZ=X.nextZ),X.nextZ&&(X.nextZ.prevZ=X.prevZ)}function Node(X,Z,_){this.i=X,this.x=Z,this.y=_,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function signedArea(X,Z,_,K){let te=0;for(let ne=Z,oe=_-K;ne<_;ne+=K)te+=(X[oe]-X[ne])*(X[ne+1]+X[oe+1]),oe=ne;return te}class ShapeUtils{static area(Z){const _=Z.length;let K=0;for(let te=_-1,ne=0;ne<_;te=ne++)K+=Z[te].x*Z[ne].y-Z[ne].x*Z[te].y;return K*.5}static isClockWise(Z){return ShapeUtils.area(Z)<0}static triangulateShape(Z,_){const K=[],te=[],ne=[];removeDupEndPts(Z),addContour(K,Z);let oe=Z.length;_.forEach(removeDupEndPts);for(let se=0;se<_.length;se++)te.push(oe),oe+=_[se].length,addContour(K,_[se]);const ie=Earcut.triangulate(K,te);for(let se=0;se<ie.length;se+=3)ne.push(ie.slice(se,se+3));return ne}}function removeDupEndPts(X){const Z=X.length;Z>2&&X[Z-1].equals(X[0])&&X.pop()}function addContour(X,Z){for(let _=0;_<Z.length;_++)X.push(Z[_].x),X.push(Z[_].y)}class ExtrudeGeometry extends BufferGeometry{constructor(Z=new Shape$2([new Vector2(.5,.5),new Vector2(-.5,.5),new Vector2(-.5,-.5),new Vector2(.5,-.5)]),_={}){super(),this.type="ExtrudeGeometry",this.parameters={shapes:Z,options:_},Z=Array.isArray(Z)?Z:[Z];const K=this,te=[],ne=[];for(let ie=0,se=Z.length;ie<se;ie++){const ae=Z[ie];oe(ae)}this.setAttribute("position",new Float32BufferAttribute(te,3)),this.setAttribute("uv",new Float32BufferAttribute(ne,2)),this.computeVertexNormals();function oe(ie){const se=[],ae=_.curveSegments!==void 0?_.curveSegments:12,ge=_.steps!==void 0?_.steps:1,ce=_.depth!==void 0?_.depth:1;let de=_.bevelEnabled!==void 0?_.bevelEnabled:!0,pe=_.bevelThickness!==void 0?_.bevelThickness:.2,fe=_.bevelSize!==void 0?_.bevelSize:pe-.1,be=_.bevelOffset!==void 0?_.bevelOffset:0,me=_.bevelSegments!==void 0?_.bevelSegments:3;const ye=_.extrudePath,ve=_.UVGenerator!==void 0?_.UVGenerator:WorldUVGenerator;let Be,Re=!1,Ee,We,Ze,Ve;ye&&(Be=ye.getSpacedPoints(ge),Re=!0,de=!1,Ee=ye.computeFrenetFrames(ge,!1),We=new Vector3,Ze=new Vector3,Ve=new Vector3),de||(me=0,pe=0,fe=0,be=0);const _e=ie.extractPoints(ae);let Xe=_e.shape;const Pe=_e.holes;if(!ShapeUtils.isClockWise(Xe)){Xe=Xe.reverse();for(let st=0,Vt=Pe.length;st<Vt;st++){const wt=Pe[st];ShapeUtils.isClockWise(wt)&&(Pe[st]=wt.reverse())}}const Ke=ShapeUtils.triangulateShape(Xe,Pe),Ue=Xe;for(let st=0,Vt=Pe.length;st<Vt;st++){const wt=Pe[st];Xe=Xe.concat(wt)}function tt(st,Vt,wt){return Vt||console.error("THREE.ExtrudeGeometry: vec does not exist"),st.clone().addScaledVector(Vt,wt)}const rt=Xe.length,at=Ke.length;function Oe(st,Vt,wt){let St,Rt,jt;const Wt=st.x-Vt.x,Ht=st.y-Vt.y,Pt=wt.x-st.x,Mt=wt.y-st.y,un=Wt*Wt+Ht*Ht,qe=Wt*Mt-Ht*Pt;if(Math.abs(qe)>Number.EPSILON){const Je=Math.sqrt(un),mt=Math.sqrt(Pt*Pt+Mt*Mt),Dt=Vt.x-Ht/Je,_t=Vt.y+Wt/Je,zt=wt.x-Mt/mt,nn=wt.y+Pt/mt,tn=((zt-Dt)*Mt-(nn-_t)*Pt)/(Wt*Mt-Ht*Pt);St=Dt+Wt*tn-st.x,Rt=_t+Ht*tn-st.y;const Ft=St*St+Rt*Rt;if(Ft<=2)return new Vector2(St,Rt);jt=Math.sqrt(Ft/2)}else{let Je=!1;Wt>Number.EPSILON?Pt>Number.EPSILON&&(Je=!0):Wt<-Number.EPSILON?Pt<-Number.EPSILON&&(Je=!0):Math.sign(Ht)===Math.sign(Mt)&&(Je=!0),Je?(St=-Ht,Rt=Wt,jt=Math.sqrt(un)):(St=Wt,Rt=Ht,jt=Math.sqrt(un/2))}return new Vector2(St/jt,Rt/jt)}const $e=[];for(let st=0,Vt=Ue.length,wt=Vt-1,St=st+1;st<Vt;st++,wt++,St++)wt===Vt&&(wt=0),St===Vt&&(St=0),$e[st]=Oe(Ue[st],Ue[wt],Ue[St]);const je=[];let Te,De=$e.concat();for(let st=0,Vt=Pe.length;st<Vt;st++){const wt=Pe[st];Te=[];for(let St=0,Rt=wt.length,jt=Rt-1,Wt=St+1;St<Rt;St++,jt++,Wt++)jt===Rt&&(jt=0),Wt===Rt&&(Wt=0),Te[St]=Oe(wt[St],wt[jt],wt[Wt]);je.push(Te),De=De.concat(Te)}for(let st=0;st<me;st++){const Vt=st/me,wt=pe*Math.cos(Vt*Math.PI/2),St=fe*Math.sin(Vt*Math.PI/2)+be;for(let Rt=0,jt=Ue.length;Rt<jt;Rt++){const Wt=tt(Ue[Rt],$e[Rt],St);ht(Wt.x,Wt.y,-wt)}for(let Rt=0,jt=Pe.length;Rt<jt;Rt++){const Wt=Pe[Rt];Te=je[Rt];for(let Ht=0,Pt=Wt.length;Ht<Pt;Ht++){const Mt=tt(Wt[Ht],Te[Ht],St);ht(Mt.x,Mt.y,-wt)}}}const ot=fe+be;for(let st=0;st<rt;st++){const Vt=de?tt(Xe[st],De[st],ot):Xe[st];Re?(Ze.copy(Ee.normals[0]).multiplyScalar(Vt.x),We.copy(Ee.binormals[0]).multiplyScalar(Vt.y),Ve.copy(Be[0]).add(Ze).add(We),ht(Ve.x,Ve.y,Ve.z)):ht(Vt.x,Vt.y,0)}for(let st=1;st<=ge;st++)for(let Vt=0;Vt<rt;Vt++){const wt=de?tt(Xe[Vt],De[Vt],ot):Xe[Vt];Re?(Ze.copy(Ee.normals[st]).multiplyScalar(wt.x),We.copy(Ee.binormals[st]).multiplyScalar(wt.y),Ve.copy(Be[st]).add(Ze).add(We),ht(Ve.x,Ve.y,Ve.z)):ht(wt.x,wt.y,ce/ge*st)}for(let st=me-1;st>=0;st--){const Vt=st/me,wt=pe*Math.cos(Vt*Math.PI/2),St=fe*Math.sin(Vt*Math.PI/2)+be;for(let Rt=0,jt=Ue.length;Rt<jt;Rt++){const Wt=tt(Ue[Rt],$e[Rt],St);ht(Wt.x,Wt.y,ce+wt)}for(let Rt=0,jt=Pe.length;Rt<jt;Rt++){const Wt=Pe[Rt];Te=je[Rt];for(let Ht=0,Pt=Wt.length;Ht<Pt;Ht++){const Mt=tt(Wt[Ht],Te[Ht],St);Re?ht(Mt.x,Mt.y+Be[ge-1].y,Be[ge-1].x+wt):ht(Mt.x,Mt.y,ce+wt)}}}ct(),gt();function ct(){const st=te.length/3;if(de){let Vt=0,wt=rt*Vt;for(let St=0;St<at;St++){const Rt=Ke[St];At(Rt[2]+wt,Rt[1]+wt,Rt[0]+wt)}Vt=ge+me*2,wt=rt*Vt;for(let St=0;St<at;St++){const Rt=Ke[St];At(Rt[0]+wt,Rt[1]+wt,Rt[2]+wt)}}else{for(let Vt=0;Vt<at;Vt++){const wt=Ke[Vt];At(wt[2],wt[1],wt[0])}for(let Vt=0;Vt<at;Vt++){const wt=Ke[Vt];At(wt[0]+rt*ge,wt[1]+rt*ge,wt[2]+rt*ge)}}K.addGroup(st,te.length/3-st,0)}function gt(){const st=te.length/3;let Vt=0;pt(Ue,Vt),Vt+=Ue.length;for(let wt=0,St=Pe.length;wt<St;wt++){const Rt=Pe[wt];pt(Rt,Vt),Vt+=Rt.length}K.addGroup(st,te.length/3-st,1)}function pt(st,Vt){let wt=st.length;for(;--wt>=0;){const St=wt;let Rt=wt-1;Rt<0&&(Rt=st.length-1);for(let jt=0,Wt=ge+me*2;jt<Wt;jt++){const Ht=rt*jt,Pt=rt*(jt+1),Mt=Vt+St+Ht,un=Vt+Rt+Ht,qe=Vt+Rt+Pt,Je=Vt+St+Pt;Kt(Mt,un,qe,Je)}}}function ht(st,Vt,wt){se.push(st),se.push(Vt),se.push(wt)}function At(st,Vt,wt){en(st),en(Vt),en(wt);const St=te.length/3,Rt=ve.generateTopUV(K,te,St-3,St-2,St-1);Zt(Rt[0]),Zt(Rt[1]),Zt(Rt[2])}function Kt(st,Vt,wt,St){en(st),en(Vt),en(St),en(Vt),en(wt),en(St);const Rt=te.length/3,jt=ve.generateSideWallUV(K,te,Rt-6,Rt-3,Rt-2,Rt-1);Zt(jt[0]),Zt(jt[1]),Zt(jt[3]),Zt(jt[1]),Zt(jt[2]),Zt(jt[3])}function en(st){te.push(se[st*3+0]),te.push(se[st*3+1]),te.push(se[st*3+2])}function Zt(st){ne.push(st.x),ne.push(st.y)}}}copy(Z){return super.copy(Z),this.parameters=Object.assign({},Z.parameters),this}toJSON(){const Z=super.toJSON(),_=this.parameters.shapes,K=this.parameters.options;return toJSON$1(_,K,Z)}static fromJSON(Z,_){const K=[];for(let ne=0,oe=Z.shapes.length;ne<oe;ne++){const ie=_[Z.shapes[ne]];K.push(ie)}const te=Z.options.extrudePath;return te!==void 0&&(Z.options.extrudePath=new Curves[te.type]().fromJSON(te)),new ExtrudeGeometry(K,Z.options)}}const WorldUVGenerator={generateTopUV:function(X,Z,_,K,te){const ne=Z[_*3],oe=Z[_*3+1],ie=Z[K*3],se=Z[K*3+1],ae=Z[te*3],ge=Z[te*3+1];return[new Vector2(ne,oe),new Vector2(ie,se),new Vector2(ae,ge)]},generateSideWallUV:function(X,Z,_,K,te,ne){const oe=Z[_*3],ie=Z[_*3+1],se=Z[_*3+2],ae=Z[K*3],ge=Z[K*3+1],ce=Z[K*3+2],de=Z[te*3],pe=Z[te*3+1],fe=Z[te*3+2],be=Z[ne*3],me=Z[ne*3+1],ye=Z[ne*3+2];return Math.abs(ie-ge)<Math.abs(oe-ae)?[new Vector2(oe,1-se),new Vector2(ae,1-ce),new Vector2(de,1-fe),new Vector2(be,1-ye)]:[new Vector2(ie,1-se),new Vector2(ge,1-ce),new Vector2(pe,1-fe),new Vector2(me,1-ye)]}};function toJSON$1(X,Z,_){if(_.shapes=[],Array.isArray(X))for(let K=0,te=X.length;K<te;K++){const ne=X[K];_.shapes.push(ne.uuid)}else _.shapes.push(X.uuid);return _.options=Object.assign({},Z),Z.extrudePath!==void 0&&(_.options.extrudePath=Z.extrudePath.toJSON()),_}class IcosahedronGeometry extends PolyhedronGeometry{constructor(Z=1,_=0){const K=(1+Math.sqrt(5))/2,te=[-1,K,0,1,K,0,-1,-K,0,1,-K,0,0,-1,K,0,1,K,0,-1,-K,0,1,-K,K,0,-1,K,0,1,-K,0,-1,-K,0,1],ne=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1];super(te,ne,Z,_),this.type="IcosahedronGeometry",this.parameters={radius:Z,detail:_}}static fromJSON(Z){return new IcosahedronGeometry(Z.radius,Z.detail)}}class OctahedronGeometry extends PolyhedronGeometry{constructor(Z=1,_=0){const K=[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],te=[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2];super(K,te,Z,_),this.type="OctahedronGeometry",this.parameters={radius:Z,detail:_}}static fromJSON(Z){return new OctahedronGeometry(Z.radius,Z.detail)}}class RingGeometry extends BufferGeometry{constructor(Z=.5,_=1,K=32,te=1,ne=0,oe=Math.PI*2){super(),this.type="RingGeometry",this.parameters={innerRadius:Z,outerRadius:_,thetaSegments:K,phiSegments:te,thetaStart:ne,thetaLength:oe},K=Math.max(3,K),te=Math.max(1,te);const ie=[],se=[],ae=[],ge=[];let ce=Z;const de=(_-Z)/te,pe=new Vector3,fe=new Vector2;for(let be=0;be<=te;be++){for(let me=0;me<=K;me++){const ye=ne+me/K*oe;pe.x=ce*Math.cos(ye),pe.y=ce*Math.sin(ye),se.push(pe.x,pe.y,pe.z),ae.push(0,0,1),fe.x=(pe.x/_+1)/2,fe.y=(pe.y/_+1)/2,ge.push(fe.x,fe.y)}ce+=de}for(let be=0;be<te;be++){const me=be*(K+1);for(let ye=0;ye<K;ye++){const ve=ye+me,Be=ve,Re=ve+K+1,Ee=ve+K+2,We=ve+1;ie.push(Be,Re,We),ie.push(Re,Ee,We)}}this.setIndex(ie),this.setAttribute("position",new Float32BufferAttribute(se,3)),this.setAttribute("normal",new Float32BufferAttribute(ae,3)),this.setAttribute("uv",new Float32BufferAttribute(ge,2))}copy(Z){return super.copy(Z),this.parameters=Object.assign({},Z.parameters),this}static fromJSON(Z){return new RingGeometry(Z.innerRadius,Z.outerRadius,Z.thetaSegments,Z.phiSegments,Z.thetaStart,Z.thetaLength)}}class ShapeGeometry extends BufferGeometry{constructor(Z=new Shape$2([new Vector2(0,.5),new Vector2(-.5,-.5),new Vector2(.5,-.5)]),_=12){super(),this.type="ShapeGeometry",this.parameters={shapes:Z,curveSegments:_};const K=[],te=[],ne=[],oe=[];let ie=0,se=0;if(Array.isArray(Z)===!1)ae(Z);else for(let ge=0;ge<Z.length;ge++)ae(Z[ge]),this.addGroup(ie,se,ge),ie+=se,se=0;this.setIndex(K),this.setAttribute("position",new Float32BufferAttribute(te,3)),this.setAttribute("normal",new Float32BufferAttribute(ne,3)),this.setAttribute("uv",new Float32BufferAttribute(oe,2));function ae(ge){const ce=te.length/3,de=ge.extractPoints(_);let pe=de.shape;const fe=de.holes;ShapeUtils.isClockWise(pe)===!1&&(pe=pe.reverse());for(let me=0,ye=fe.length;me<ye;me++){const ve=fe[me];ShapeUtils.isClockWise(ve)===!0&&(fe[me]=ve.reverse())}const be=ShapeUtils.triangulateShape(pe,fe);for(let me=0,ye=fe.length;me<ye;me++){const ve=fe[me];pe=pe.concat(ve)}for(let me=0,ye=pe.length;me<ye;me++){const ve=pe[me];te.push(ve.x,ve.y,0),ne.push(0,0,1),oe.push(ve.x,ve.y)}for(let me=0,ye=be.length;me<ye;me++){const ve=be[me],Be=ve[0]+ce,Re=ve[1]+ce,Ee=ve[2]+ce;K.push(Be,Re,Ee),se+=3}}}copy(Z){return super.copy(Z),this.parameters=Object.assign({},Z.parameters),this}toJSON(){const Z=super.toJSON(),_=this.parameters.shapes;return toJSON(_,Z)}static fromJSON(Z,_){const K=[];for(let te=0,ne=Z.shapes.length;te<ne;te++){const oe=_[Z.shapes[te]];K.push(oe)}return new ShapeGeometry(K,Z.curveSegments)}}function toJSON(X,Z){if(Z.shapes=[],Array.isArray(X))for(let _=0,K=X.length;_<K;_++){const te=X[_];Z.shapes.push(te.uuid)}else Z.shapes.push(X.uuid);return Z}class SphereGeometry extends BufferGeometry{constructor(Z=1,_=32,K=16,te=0,ne=Math.PI*2,oe=0,ie=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:Z,widthSegments:_,heightSegments:K,phiStart:te,phiLength:ne,thetaStart:oe,thetaLength:ie},_=Math.max(3,Math.floor(_)),K=Math.max(2,Math.floor(K));const se=Math.min(oe+ie,Math.PI);let ae=0;const ge=[],ce=new Vector3,de=new Vector3,pe=[],fe=[],be=[],me=[];for(let ye=0;ye<=K;ye++){const ve=[],Be=ye/K;let Re=0;ye===0&&oe===0?Re=.5/_:ye===K&&se===Math.PI&&(Re=-.5/_);for(let Ee=0;Ee<=_;Ee++){const We=Ee/_;ce.x=-Z*Math.cos(te+We*ne)*Math.sin(oe+Be*ie),ce.y=Z*Math.cos(oe+Be*ie),ce.z=Z*Math.sin(te+We*ne)*Math.sin(oe+Be*ie),fe.push(ce.x,ce.y,ce.z),de.copy(ce).normalize(),be.push(de.x,de.y,de.z),me.push(We+Re,1-Be),ve.push(ae++)}ge.push(ve)}for(let ye=0;ye<K;ye++)for(let ve=0;ve<_;ve++){const Be=ge[ye][ve+1],Re=ge[ye][ve],Ee=ge[ye+1][ve],We=ge[ye+1][ve+1];(ye!==0||oe>0)&&pe.push(Be,Re,We),(ye!==K-1||se<Math.PI)&&pe.push(Re,Ee,We)}this.setIndex(pe),this.setAttribute("position",new Float32BufferAttribute(fe,3)),this.setAttribute("normal",new Float32BufferAttribute(be,3)),this.setAttribute("uv",new Float32BufferAttribute(me,2))}copy(Z){return super.copy(Z),this.parameters=Object.assign({},Z.parameters),this}static fromJSON(Z){return new SphereGeometry(Z.radius,Z.widthSegments,Z.heightSegments,Z.phiStart,Z.phiLength,Z.thetaStart,Z.thetaLength)}}class TetrahedronGeometry extends PolyhedronGeometry{constructor(Z=1,_=0){const K=[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],te=[2,1,0,0,3,2,1,3,0,2,3,1];super(K,te,Z,_),this.type="TetrahedronGeometry",this.parameters={radius:Z,detail:_}}static fromJSON(Z){return new TetrahedronGeometry(Z.radius,Z.detail)}}class TorusGeometry extends BufferGeometry{constructor(Z=1,_=.4,K=12,te=48,ne=Math.PI*2){super(),this.type="TorusGeometry",this.parameters={radius:Z,tube:_,radialSegments:K,tubularSegments:te,arc:ne},K=Math.floor(K),te=Math.floor(te);const oe=[],ie=[],se=[],ae=[],ge=new Vector3,ce=new Vector3,de=new Vector3;for(let pe=0;pe<=K;pe++)for(let fe=0;fe<=te;fe++){const be=fe/te*ne,me=pe/K*Math.PI*2;ce.x=(Z+_*Math.cos(me))*Math.cos(be),ce.y=(Z+_*Math.cos(me))*Math.sin(be),ce.z=_*Math.sin(me),ie.push(ce.x,ce.y,ce.z),ge.x=Z*Math.cos(be),ge.y=Z*Math.sin(be),de.subVectors(ce,ge).normalize(),se.push(de.x,de.y,de.z),ae.push(fe/te),ae.push(pe/K)}for(let pe=1;pe<=K;pe++)for(let fe=1;fe<=te;fe++){const be=(te+1)*pe+fe-1,me=(te+1)*(pe-1)+fe-1,ye=(te+1)*(pe-1)+fe,ve=(te+1)*pe+fe;oe.push(be,me,ve),oe.push(me,ye,ve)}this.setIndex(oe),this.setAttribute("position",new Float32BufferAttribute(ie,3)),this.setAttribute("normal",new Float32BufferAttribute(se,3)),this.setAttribute("uv",new Float32BufferAttribute(ae,2))}copy(Z){return super.copy(Z),this.parameters=Object.assign({},Z.parameters),this}static fromJSON(Z){return new TorusGeometry(Z.radius,Z.tube,Z.radialSegments,Z.tubularSegments,Z.arc)}}class TorusKnotGeometry extends BufferGeometry{constructor(Z=1,_=.4,K=64,te=8,ne=2,oe=3){super(),this.type="TorusKnotGeometry",this.parameters={radius:Z,tube:_,tubularSegments:K,radialSegments:te,p:ne,q:oe},K=Math.floor(K),te=Math.floor(te);const ie=[],se=[],ae=[],ge=[],ce=new Vector3,de=new Vector3,pe=new Vector3,fe=new Vector3,be=new Vector3,me=new Vector3,ye=new Vector3;for(let Be=0;Be<=K;++Be){const Re=Be/K*ne*Math.PI*2;ve(Re,ne,oe,Z,pe),ve(Re+.01,ne,oe,Z,fe),me.subVectors(fe,pe),ye.addVectors(fe,pe),be.crossVectors(me,ye),ye.crossVectors(be,me),be.normalize(),ye.normalize();for(let Ee=0;Ee<=te;++Ee){const We=Ee/te*Math.PI*2,Ze=-_*Math.cos(We),Ve=_*Math.sin(We);ce.x=pe.x+(Ze*ye.x+Ve*be.x),ce.y=pe.y+(Ze*ye.y+Ve*be.y),ce.z=pe.z+(Ze*ye.z+Ve*be.z),se.push(ce.x,ce.y,ce.z),de.subVectors(ce,pe).normalize(),ae.push(de.x,de.y,de.z),ge.push(Be/K),ge.push(Ee/te)}}for(let Be=1;Be<=K;Be++)for(let Re=1;Re<=te;Re++){const Ee=(te+1)*(Be-1)+(Re-1),We=(te+1)*Be+(Re-1),Ze=(te+1)*Be+Re,Ve=(te+1)*(Be-1)+Re;ie.push(Ee,We,Ve),ie.push(We,Ze,Ve)}this.setIndex(ie),this.setAttribute("position",new Float32BufferAttribute(se,3)),this.setAttribute("normal",new Float32BufferAttribute(ae,3)),this.setAttribute("uv",new Float32BufferAttribute(ge,2));function ve(Be,Re,Ee,We,Ze){const Ve=Math.cos(Be),_e=Math.sin(Be),Xe=Ee/Re*Be,Pe=Math.cos(Xe);Ze.x=We*(2+Pe)*.5*Ve,Ze.y=We*(2+Pe)*_e*.5,Ze.z=We*Math.sin(Xe)*.5}}copy(Z){return super.copy(Z),this.parameters=Object.assign({},Z.parameters),this}static fromJSON(Z){return new TorusKnotGeometry(Z.radius,Z.tube,Z.tubularSegments,Z.radialSegments,Z.p,Z.q)}}class TubeGeometry extends BufferGeometry{constructor(Z=new QuadraticBezierCurve3(new Vector3(-1,-1,0),new Vector3(-1,1,0),new Vector3(1,1,0)),_=64,K=1,te=8,ne=!1){super(),this.type="TubeGeometry",this.parameters={path:Z,tubularSegments:_,radius:K,radialSegments:te,closed:ne};const oe=Z.computeFrenetFrames(_,ne);this.tangents=oe.tangents,this.normals=oe.normals,this.binormals=oe.binormals;const ie=new Vector3,se=new Vector3,ae=new Vector2;let ge=new Vector3;const ce=[],de=[],pe=[],fe=[];be(),this.setIndex(fe),this.setAttribute("position",new Float32BufferAttribute(ce,3)),this.setAttribute("normal",new Float32BufferAttribute(de,3)),this.setAttribute("uv",new Float32BufferAttribute(pe,2));function be(){for(let Be=0;Be<_;Be++)me(Be);me(ne===!1?_:0),ve(),ye()}function me(Be){ge=Z.getPointAt(Be/_,ge);const Re=oe.normals[Be],Ee=oe.binormals[Be];for(let We=0;We<=te;We++){const Ze=We/te*Math.PI*2,Ve=Math.sin(Ze),_e=-Math.cos(Ze);se.x=_e*Re.x+Ve*Ee.x,se.y=_e*Re.y+Ve*Ee.y,se.z=_e*Re.z+Ve*Ee.z,se.normalize(),de.push(se.x,se.y,se.z),ie.x=ge.x+K*se.x,ie.y=ge.y+K*se.y,ie.z=ge.z+K*se.z,ce.push(ie.x,ie.y,ie.z)}}function ye(){for(let Be=1;Be<=_;Be++)for(let Re=1;Re<=te;Re++){const Ee=(te+1)*(Be-1)+(Re-1),We=(te+1)*Be+(Re-1),Ze=(te+1)*Be+Re,Ve=(te+1)*(Be-1)+Re;fe.push(Ee,We,Ve),fe.push(We,Ze,Ve)}}function ve(){for(let Be=0;Be<=_;Be++)for(let Re=0;Re<=te;Re++)ae.x=Be/_,ae.y=Re/te,pe.push(ae.x,ae.y)}}copy(Z){return super.copy(Z),this.parameters=Object.assign({},Z.parameters),this}toJSON(){const Z=super.toJSON();return Z.path=this.parameters.path.toJSON(),Z}static fromJSON(Z){return new TubeGeometry(new Curves[Z.path.type]().fromJSON(Z.path),Z.tubularSegments,Z.radius,Z.radialSegments,Z.closed)}}class WireframeGeometry extends BufferGeometry{constructor(Z=null){if(super(),this.type="WireframeGeometry",this.parameters={geometry:Z},Z!==null){const _=[],K=new Set,te=new Vector3,ne=new Vector3;if(Z.index!==null){const oe=Z.attributes.position,ie=Z.index;let se=Z.groups;se.length===0&&(se=[{start:0,count:ie.count,materialIndex:0}]);for(let ae=0,ge=se.length;ae<ge;++ae){const ce=se[ae],de=ce.start,pe=ce.count;for(let fe=de,be=de+pe;fe<be;fe+=3)for(let me=0;me<3;me++){const ye=ie.getX(fe+me),ve=ie.getX(fe+(me+1)%3);te.fromBufferAttribute(oe,ye),ne.fromBufferAttribute(oe,ve),isUniqueEdge(te,ne,K)===!0&&(_.push(te.x,te.y,te.z),_.push(ne.x,ne.y,ne.z))}}}else{const oe=Z.attributes.position;for(let ie=0,se=oe.count/3;ie<se;ie++)for(let ae=0;ae<3;ae++){const ge=3*ie+ae,ce=3*ie+(ae+1)%3;te.fromBufferAttribute(oe,ge),ne.fromBufferAttribute(oe,ce),isUniqueEdge(te,ne,K)===!0&&(_.push(te.x,te.y,te.z),_.push(ne.x,ne.y,ne.z))}}this.setAttribute("position",new Float32BufferAttribute(_,3))}}copy(Z){return super.copy(Z),this.parameters=Object.assign({},Z.parameters),this}}function isUniqueEdge(X,Z,_){const K=`${X.x},${X.y},${X.z}-${Z.x},${Z.y},${Z.z}`,te=`${Z.x},${Z.y},${Z.z}-${X.x},${X.y},${X.z}`;return _.has(K)===!0||_.has(te)===!0?!1:(_.add(K),_.add(te),!0)}var Geometries=Object.freeze({__proto__:null,BoxGeometry,CapsuleGeometry,CircleGeometry,ConeGeometry,CylinderGeometry,DodecahedronGeometry,EdgesGeometry,ExtrudeGeometry,IcosahedronGeometry,LatheGeometry,OctahedronGeometry,PlaneGeometry,PolyhedronGeometry,RingGeometry,ShapeGeometry,SphereGeometry,TetrahedronGeometry,TorusGeometry,TorusKnotGeometry,TubeGeometry,WireframeGeometry});class ShadowMaterial extends Material{constructor(Z){super(),this.isShadowMaterial=!0,this.type="ShadowMaterial",this.color=new Color$1(0),this.transparent=!0,this.fog=!0,this.setValues(Z)}copy(Z){return super.copy(Z),this.color.copy(Z.color),this.fog=Z.fog,this}}class RawShaderMaterial extends ShaderMaterial{constructor(Z){super(Z),this.isRawShaderMaterial=!0,this.type="RawShaderMaterial"}}class MeshStandardMaterial extends Material{constructor(Z){super(),this.isMeshStandardMaterial=!0,this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new Color$1(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Color$1(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=TangentSpaceNormalMap,this.normalScale=new Vector2(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(Z)}copy(Z){return super.copy(Z),this.defines={STANDARD:""},this.color.copy(Z.color),this.roughness=Z.roughness,this.metalness=Z.metalness,this.map=Z.map,this.lightMap=Z.lightMap,this.lightMapIntensity=Z.lightMapIntensity,this.aoMap=Z.aoMap,this.aoMapIntensity=Z.aoMapIntensity,this.emissive.copy(Z.emissive),this.emissiveMap=Z.emissiveMap,this.emissiveIntensity=Z.emissiveIntensity,this.bumpMap=Z.bumpMap,this.bumpScale=Z.bumpScale,this.normalMap=Z.normalMap,this.normalMapType=Z.normalMapType,this.normalScale.copy(Z.normalScale),this.displacementMap=Z.displacementMap,this.displacementScale=Z.displacementScale,this.displacementBias=Z.displacementBias,this.roughnessMap=Z.roughnessMap,this.metalnessMap=Z.metalnessMap,this.alphaMap=Z.alphaMap,this.envMap=Z.envMap,this.envMapIntensity=Z.envMapIntensity,this.wireframe=Z.wireframe,this.wireframeLinewidth=Z.wireframeLinewidth,this.wireframeLinecap=Z.wireframeLinecap,this.wireframeLinejoin=Z.wireframeLinejoin,this.flatShading=Z.flatShading,this.fog=Z.fog,this}}class MeshPhysicalMaterial extends MeshStandardMaterial{constructor(Z){super(),this.isMeshPhysicalMaterial=!0,this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.anisotropyRotation=0,this.anisotropyMap=null,this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new Vector2(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return clamp$3(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(_){this.ior=(1+.4*_)/(1-.4*_)}}),this.iridescenceMap=null,this.iridescenceIOR=1.3,this.iridescenceThicknessRange=[100,400],this.iridescenceThicknessMap=null,this.sheenColor=new Color$1(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=1/0,this.attenuationColor=new Color$1(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new Color$1(1,1,1),this.specularColorMap=null,this._anisotropy=0,this._clearcoat=0,this._iridescence=0,this._sheen=0,this._transmission=0,this.setValues(Z)}get anisotropy(){return this._anisotropy}set anisotropy(Z){this._anisotropy>0!=Z>0&&this.version++,this._anisotropy=Z}get clearcoat(){return this._clearcoat}set clearcoat(Z){this._clearcoat>0!=Z>0&&this.version++,this._clearcoat=Z}get iridescence(){return this._iridescence}set iridescence(Z){this._iridescence>0!=Z>0&&this.version++,this._iridescence=Z}get sheen(){return this._sheen}set sheen(Z){this._sheen>0!=Z>0&&this.version++,this._sheen=Z}get transmission(){return this._transmission}set transmission(Z){this._transmission>0!=Z>0&&this.version++,this._transmission=Z}copy(Z){return super.copy(Z),this.defines={STANDARD:"",PHYSICAL:""},this.anisotropy=Z.anisotropy,this.anisotropyRotation=Z.anisotropyRotation,this.anisotropyMap=Z.anisotropyMap,this.clearcoat=Z.clearcoat,this.clearcoatMap=Z.clearcoatMap,this.clearcoatRoughness=Z.clearcoatRoughness,this.clearcoatRoughnessMap=Z.clearcoatRoughnessMap,this.clearcoatNormalMap=Z.clearcoatNormalMap,this.clearcoatNormalScale.copy(Z.clearcoatNormalScale),this.ior=Z.ior,this.iridescence=Z.iridescence,this.iridescenceMap=Z.iridescenceMap,this.iridescenceIOR=Z.iridescenceIOR,this.iridescenceThicknessRange=[...Z.iridescenceThicknessRange],this.iridescenceThicknessMap=Z.iridescenceThicknessMap,this.sheen=Z.sheen,this.sheenColor.copy(Z.sheenColor),this.sheenColorMap=Z.sheenColorMap,this.sheenRoughness=Z.sheenRoughness,this.sheenRoughnessMap=Z.sheenRoughnessMap,this.transmission=Z.transmission,this.transmissionMap=Z.transmissionMap,this.thickness=Z.thickness,this.thicknessMap=Z.thicknessMap,this.attenuationDistance=Z.attenuationDistance,this.attenuationColor.copy(Z.attenuationColor),this.specularIntensity=Z.specularIntensity,this.specularIntensityMap=Z.specularIntensityMap,this.specularColor.copy(Z.specularColor),this.specularColorMap=Z.specularColorMap,this}}class MeshPhongMaterial extends Material{constructor(Z){super(),this.isMeshPhongMaterial=!0,this.type="MeshPhongMaterial",this.color=new Color$1(16777215),this.specular=new Color$1(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Color$1(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=TangentSpaceNormalMap,this.normalScale=new Vector2(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(Z)}copy(Z){return super.copy(Z),this.color.copy(Z.color),this.specular.copy(Z.specular),this.shininess=Z.shininess,this.map=Z.map,this.lightMap=Z.lightMap,this.lightMapIntensity=Z.lightMapIntensity,this.aoMap=Z.aoMap,this.aoMapIntensity=Z.aoMapIntensity,this.emissive.copy(Z.emissive),this.emissiveMap=Z.emissiveMap,this.emissiveIntensity=Z.emissiveIntensity,this.bumpMap=Z.bumpMap,this.bumpScale=Z.bumpScale,this.normalMap=Z.normalMap,this.normalMapType=Z.normalMapType,this.normalScale.copy(Z.normalScale),this.displacementMap=Z.displacementMap,this.displacementScale=Z.displacementScale,this.displacementBias=Z.displacementBias,this.specularMap=Z.specularMap,this.alphaMap=Z.alphaMap,this.envMap=Z.envMap,this.combine=Z.combine,this.reflectivity=Z.reflectivity,this.refractionRatio=Z.refractionRatio,this.wireframe=Z.wireframe,this.wireframeLinewidth=Z.wireframeLinewidth,this.wireframeLinecap=Z.wireframeLinecap,this.wireframeLinejoin=Z.wireframeLinejoin,this.flatShading=Z.flatShading,this.fog=Z.fog,this}}class MeshToonMaterial extends Material{constructor(Z){super(),this.isMeshToonMaterial=!0,this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new Color$1(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Color$1(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=TangentSpaceNormalMap,this.normalScale=new Vector2(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(Z)}copy(Z){return super.copy(Z),this.color.copy(Z.color),this.map=Z.map,this.gradientMap=Z.gradientMap,this.lightMap=Z.lightMap,this.lightMapIntensity=Z.lightMapIntensity,this.aoMap=Z.aoMap,this.aoMapIntensity=Z.aoMapIntensity,this.emissive.copy(Z.emissive),this.emissiveMap=Z.emissiveMap,this.emissiveIntensity=Z.emissiveIntensity,this.bumpMap=Z.bumpMap,this.bumpScale=Z.bumpScale,this.normalMap=Z.normalMap,this.normalMapType=Z.normalMapType,this.normalScale.copy(Z.normalScale),this.displacementMap=Z.displacementMap,this.displacementScale=Z.displacementScale,this.displacementBias=Z.displacementBias,this.alphaMap=Z.alphaMap,this.wireframe=Z.wireframe,this.wireframeLinewidth=Z.wireframeLinewidth,this.wireframeLinecap=Z.wireframeLinecap,this.wireframeLinejoin=Z.wireframeLinejoin,this.fog=Z.fog,this}}class MeshNormalMaterial extends Material{constructor(Z){super(),this.isMeshNormalMaterial=!0,this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=TangentSpaceNormalMap,this.normalScale=new Vector2(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.flatShading=!1,this.setValues(Z)}copy(Z){return super.copy(Z),this.bumpMap=Z.bumpMap,this.bumpScale=Z.bumpScale,this.normalMap=Z.normalMap,this.normalMapType=Z.normalMapType,this.normalScale.copy(Z.normalScale),this.displacementMap=Z.displacementMap,this.displacementScale=Z.displacementScale,this.displacementBias=Z.displacementBias,this.wireframe=Z.wireframe,this.wireframeLinewidth=Z.wireframeLinewidth,this.flatShading=Z.flatShading,this}}class MeshLambertMaterial extends Material{constructor(Z){super(),this.isMeshLambertMaterial=!0,this.type="MeshLambertMaterial",this.color=new Color$1(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Color$1(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=TangentSpaceNormalMap,this.normalScale=new Vector2(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(Z)}copy(Z){return super.copy(Z),this.color.copy(Z.color),this.map=Z.map,this.lightMap=Z.lightMap,this.lightMapIntensity=Z.lightMapIntensity,this.aoMap=Z.aoMap,this.aoMapIntensity=Z.aoMapIntensity,this.emissive.copy(Z.emissive),this.emissiveMap=Z.emissiveMap,this.emissiveIntensity=Z.emissiveIntensity,this.bumpMap=Z.bumpMap,this.bumpScale=Z.bumpScale,this.normalMap=Z.normalMap,this.normalMapType=Z.normalMapType,this.normalScale.copy(Z.normalScale),this.displacementMap=Z.displacementMap,this.displacementScale=Z.displacementScale,this.displacementBias=Z.displacementBias,this.specularMap=Z.specularMap,this.alphaMap=Z.alphaMap,this.envMap=Z.envMap,this.combine=Z.combine,this.reflectivity=Z.reflectivity,this.refractionRatio=Z.refractionRatio,this.wireframe=Z.wireframe,this.wireframeLinewidth=Z.wireframeLinewidth,this.wireframeLinecap=Z.wireframeLinecap,this.wireframeLinejoin=Z.wireframeLinejoin,this.flatShading=Z.flatShading,this.fog=Z.fog,this}}class MeshMatcapMaterial extends Material{constructor(Z){super(),this.isMeshMatcapMaterial=!0,this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new Color$1(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=TangentSpaceNormalMap,this.normalScale=new Vector2(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.flatShading=!1,this.fog=!0,this.setValues(Z)}copy(Z){return super.copy(Z),this.defines={MATCAP:""},this.color.copy(Z.color),this.matcap=Z.matcap,this.map=Z.map,this.bumpMap=Z.bumpMap,this.bumpScale=Z.bumpScale,this.normalMap=Z.normalMap,this.normalMapType=Z.normalMapType,this.normalScale.copy(Z.normalScale),this.displacementMap=Z.displacementMap,this.displacementScale=Z.displacementScale,this.displacementBias=Z.displacementBias,this.alphaMap=Z.alphaMap,this.flatShading=Z.flatShading,this.fog=Z.fog,this}}class LineDashedMaterial extends LineBasicMaterial{constructor(Z){super(),this.isLineDashedMaterial=!0,this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(Z)}copy(Z){return super.copy(Z),this.scale=Z.scale,this.dashSize=Z.dashSize,this.gapSize=Z.gapSize,this}}function arraySlice(X,Z,_){return isTypedArray(X)?new X.constructor(X.subarray(Z,_!==void 0?_:X.length)):X.slice(Z,_)}function convertArray(X,Z,_){return!X||!_&&X.constructor===Z?X:typeof Z.BYTES_PER_ELEMENT=="number"?new Z(X):Array.prototype.slice.call(X)}function isTypedArray(X){return ArrayBuffer.isView(X)&&!(X instanceof DataView)}function getKeyframeOrder(X){function Z(te,ne){return X[te]-X[ne]}const _=X.length,K=new Array(_);for(let te=0;te!==_;++te)K[te]=te;return K.sort(Z),K}function sortedArray(X,Z,_){const K=X.length,te=new X.constructor(K);for(let ne=0,oe=0;oe!==K;++ne){const ie=_[ne]*Z;for(let se=0;se!==Z;++se)te[oe++]=X[ie+se]}return te}function flattenJSON(X,Z,_,K){let te=1,ne=X[0];for(;ne!==void 0&&ne[K]===void 0;)ne=X[te++];if(ne===void 0)return;let oe=ne[K];if(oe!==void 0)if(Array.isArray(oe))do oe=ne[K],oe!==void 0&&(Z.push(ne.time),_.push.apply(_,oe)),ne=X[te++];while(ne!==void 0);else if(oe.toArray!==void 0)do oe=ne[K],oe!==void 0&&(Z.push(ne.time),oe.toArray(_,_.length)),ne=X[te++];while(ne!==void 0);else do oe=ne[K],oe!==void 0&&(Z.push(ne.time),_.push(oe)),ne=X[te++];while(ne!==void 0)}function subclip(X,Z,_,K,te=30){const ne=X.clone();ne.name=Z;const oe=[];for(let se=0;se<ne.tracks.length;++se){const ae=ne.tracks[se],ge=ae.getValueSize(),ce=[],de=[];for(let pe=0;pe<ae.times.length;++pe){const fe=ae.times[pe]*te;if(!(fe<_||fe>=K)){ce.push(ae.times[pe]);for(let be=0;be<ge;++be)de.push(ae.values[pe*ge+be])}}ce.length!==0&&(ae.times=convertArray(ce,ae.times.constructor),ae.values=convertArray(de,ae.values.constructor),oe.push(ae))}ne.tracks=oe;let ie=1/0;for(let se=0;se<ne.tracks.length;++se)ie>ne.tracks[se].times[0]&&(ie=ne.tracks[se].times[0]);for(let se=0;se<ne.tracks.length;++se)ne.tracks[se].shift(-1*ie);return ne.resetDuration(),ne}function makeClipAdditive(X,Z=0,_=X,K=30){K<=0&&(K=30);const te=_.tracks.length,ne=Z/K;for(let oe=0;oe<te;++oe){const ie=_.tracks[oe],se=ie.ValueTypeName;if(se==="bool"||se==="string")continue;const ae=X.tracks.find(function(ye){return ye.name===ie.name&&ye.ValueTypeName===se});if(ae===void 0)continue;let ge=0;const ce=ie.getValueSize();ie.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(ge=ce/3);let de=0;const pe=ae.getValueSize();ae.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(de=pe/3);const fe=ie.times.length-1;let be;if(ne<=ie.times[0]){const ye=ge,ve=ce-ge;be=arraySlice(ie.values,ye,ve)}else if(ne>=ie.times[fe]){const ye=fe*ce+ge,ve=ye+ce-ge;be=arraySlice(ie.values,ye,ve)}else{const ye=ie.createInterpolant(),ve=ge,Be=ce-ge;ye.evaluate(ne),be=arraySlice(ye.resultBuffer,ve,Be)}se==="quaternion"&&new Quaternion$2().fromArray(be).normalize().conjugate().toArray(be);const me=ae.times.length;for(let ye=0;ye<me;++ye){const ve=ye*pe+de;if(se==="quaternion")Quaternion$2.multiplyQuaternionsFlat(ae.values,ve,be,0,ae.values,ve);else{const Be=pe-de*2;for(let Re=0;Re<Be;++Re)ae.values[ve+Re]-=be[Re]}}}return X.blendMode=AdditiveAnimationBlendMode,X}const AnimationUtils={arraySlice,convertArray,isTypedArray,getKeyframeOrder,sortedArray,flattenJSON,subclip,makeClipAdditive};class Interpolant{constructor(Z,_,K,te){this.parameterPositions=Z,this._cachedIndex=0,this.resultBuffer=te!==void 0?te:new _.constructor(K),this.sampleValues=_,this.valueSize=K,this.settings=null,this.DefaultSettings_={}}evaluate(Z){const _=this.parameterPositions;let K=this._cachedIndex,te=_[K],ne=_[K-1];e:{t:{let oe;n:{r:if(!(Z<te)){for(let ie=K+2;;){if(te===void 0){if(Z<ne)break r;return K=_.length,this._cachedIndex=K,this.copySampleValue_(K-1)}if(K===ie)break;if(ne=te,te=_[++K],Z<te)break t}oe=_.length;break n}if(!(Z>=ne)){const ie=_[1];Z<ie&&(K=2,ne=ie);for(let se=K-2;;){if(ne===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(K===se)break;if(te=ne,ne=_[--K-1],Z>=ne)break t}oe=K,K=0;break n}break e}for(;K<oe;){const ie=K+oe>>>1;Z<_[ie]?oe=ie:K=ie+1}if(te=_[K],ne=_[K-1],ne===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(te===void 0)return K=_.length,this._cachedIndex=K,this.copySampleValue_(K-1)}this._cachedIndex=K,this.intervalChanged_(K,ne,te)}return this.interpolate_(K,ne,Z,te)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(Z){const _=this.resultBuffer,K=this.sampleValues,te=this.valueSize,ne=Z*te;for(let oe=0;oe!==te;++oe)_[oe]=K[ne+oe];return _}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}class CubicInterpolant extends Interpolant{constructor(Z,_,K,te){super(Z,_,K,te),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:ZeroCurvatureEnding,endingEnd:ZeroCurvatureEnding}}intervalChanged_(Z,_,K){const te=this.parameterPositions;let ne=Z-2,oe=Z+1,ie=te[ne],se=te[oe];if(ie===void 0)switch(this.getSettings_().endingStart){case ZeroSlopeEnding:ne=Z,ie=2*_-K;break;case WrapAroundEnding:ne=te.length-2,ie=_+te[ne]-te[ne+1];break;default:ne=Z,ie=K}if(se===void 0)switch(this.getSettings_().endingEnd){case ZeroSlopeEnding:oe=Z,se=2*K-_;break;case WrapAroundEnding:oe=1,se=K+te[1]-te[0];break;default:oe=Z-1,se=_}const ae=(K-_)*.5,ge=this.valueSize;this._weightPrev=ae/(_-ie),this._weightNext=ae/(se-K),this._offsetPrev=ne*ge,this._offsetNext=oe*ge}interpolate_(Z,_,K,te){const ne=this.resultBuffer,oe=this.sampleValues,ie=this.valueSize,se=Z*ie,ae=se-ie,ge=this._offsetPrev,ce=this._offsetNext,de=this._weightPrev,pe=this._weightNext,fe=(K-_)/(te-_),be=fe*fe,me=be*fe,ye=-de*me+2*de*be-de*fe,ve=(1+de)*me+(-1.5-2*de)*be+(-.5+de)*fe+1,Be=(-1-pe)*me+(1.5+pe)*be+.5*fe,Re=pe*me-pe*be;for(let Ee=0;Ee!==ie;++Ee)ne[Ee]=ye*oe[ge+Ee]+ve*oe[ae+Ee]+Be*oe[se+Ee]+Re*oe[ce+Ee];return ne}}class LinearInterpolant extends Interpolant{constructor(Z,_,K,te){super(Z,_,K,te)}interpolate_(Z,_,K,te){const ne=this.resultBuffer,oe=this.sampleValues,ie=this.valueSize,se=Z*ie,ae=se-ie,ge=(K-_)/(te-_),ce=1-ge;for(let de=0;de!==ie;++de)ne[de]=oe[ae+de]*ce+oe[se+de]*ge;return ne}}class DiscreteInterpolant extends Interpolant{constructor(Z,_,K,te){super(Z,_,K,te)}interpolate_(Z){return this.copySampleValue_(Z-1)}}class KeyframeTrack{constructor(Z,_,K,te){if(Z===void 0)throw new Error("THREE.KeyframeTrack: track name is undefined");if(_===void 0||_.length===0)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+Z);this.name=Z,this.times=convertArray(_,this.TimeBufferType),this.values=convertArray(K,this.ValueBufferType),this.setInterpolation(te||this.DefaultInterpolation)}static toJSON(Z){const _=Z.constructor;let K;if(_.toJSON!==this.toJSON)K=_.toJSON(Z);else{K={name:Z.name,times:convertArray(Z.times,Array),values:convertArray(Z.values,Array)};const te=Z.getInterpolation();te!==Z.DefaultInterpolation&&(K.interpolation=te)}return K.type=Z.ValueTypeName,K}InterpolantFactoryMethodDiscrete(Z){return new DiscreteInterpolant(this.times,this.values,this.getValueSize(),Z)}InterpolantFactoryMethodLinear(Z){return new LinearInterpolant(this.times,this.values,this.getValueSize(),Z)}InterpolantFactoryMethodSmooth(Z){return new CubicInterpolant(this.times,this.values,this.getValueSize(),Z)}setInterpolation(Z){let _;switch(Z){case InterpolateDiscrete:_=this.InterpolantFactoryMethodDiscrete;break;case InterpolateLinear:_=this.InterpolantFactoryMethodLinear;break;case InterpolateSmooth:_=this.InterpolantFactoryMethodSmooth;break}if(_===void 0){const K="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(this.createInterpolant===void 0)if(Z!==this.DefaultInterpolation)this.setInterpolation(this.DefaultInterpolation);else throw new Error(K);return console.warn("THREE.KeyframeTrack:",K),this}return this.createInterpolant=_,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return InterpolateDiscrete;case this.InterpolantFactoryMethodLinear:return InterpolateLinear;case this.InterpolantFactoryMethodSmooth:return InterpolateSmooth}}getValueSize(){return this.values.length/this.times.length}shift(Z){if(Z!==0){const _=this.times;for(let K=0,te=_.length;K!==te;++K)_[K]+=Z}return this}scale(Z){if(Z!==1){const _=this.times;for(let K=0,te=_.length;K!==te;++K)_[K]*=Z}return this}trim(Z,_){const K=this.times,te=K.length;let ne=0,oe=te-1;for(;ne!==te&&K[ne]<Z;)++ne;for(;oe!==-1&&K[oe]>_;)--oe;if(++oe,ne!==0||oe!==te){ne>=oe&&(oe=Math.max(oe,1),ne=oe-1);const ie=this.getValueSize();this.times=arraySlice(K,ne,oe),this.values=arraySlice(this.values,ne*ie,oe*ie)}return this}validate(){let Z=!0;const _=this.getValueSize();_-Math.floor(_)!==0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),Z=!1);const K=this.times,te=this.values,ne=K.length;ne===0&&(console.error("THREE.KeyframeTrack: Track is empty.",this),Z=!1);let oe=null;for(let ie=0;ie!==ne;ie++){const se=K[ie];if(typeof se=="number"&&isNaN(se)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,ie,se),Z=!1;break}if(oe!==null&&oe>se){console.error("THREE.KeyframeTrack: Out of order keys.",this,ie,se,oe),Z=!1;break}oe=se}if(te!==void 0&&isTypedArray(te))for(let ie=0,se=te.length;ie!==se;++ie){const ae=te[ie];if(isNaN(ae)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,ie,ae),Z=!1;break}}return Z}optimize(){const Z=arraySlice(this.times),_=arraySlice(this.values),K=this.getValueSize(),te=this.getInterpolation()===InterpolateSmooth,ne=Z.length-1;let oe=1;for(let ie=1;ie<ne;++ie){let se=!1;const ae=Z[ie],ge=Z[ie+1];if(ae!==ge&&(ie!==1||ae!==Z[0]))if(te)se=!0;else{const ce=ie*K,de=ce-K,pe=ce+K;for(let fe=0;fe!==K;++fe){const be=_[ce+fe];if(be!==_[de+fe]||be!==_[pe+fe]){se=!0;break}}}if(se){if(ie!==oe){Z[oe]=Z[ie];const ce=ie*K,de=oe*K;for(let pe=0;pe!==K;++pe)_[de+pe]=_[ce+pe]}++oe}}if(ne>0){Z[oe]=Z[ne];for(let ie=ne*K,se=oe*K,ae=0;ae!==K;++ae)_[se+ae]=_[ie+ae];++oe}return oe!==Z.length?(this.times=arraySlice(Z,0,oe),this.values=arraySlice(_,0,oe*K)):(this.times=Z,this.values=_),this}clone(){const Z=arraySlice(this.times,0),_=arraySlice(this.values,0),K=this.constructor,te=new K(this.name,Z,_);return te.createInterpolant=this.createInterpolant,te}}KeyframeTrack.prototype.TimeBufferType=Float32Array;KeyframeTrack.prototype.ValueBufferType=Float32Array;KeyframeTrack.prototype.DefaultInterpolation=InterpolateLinear;class BooleanKeyframeTrack extends KeyframeTrack{}BooleanKeyframeTrack.prototype.ValueTypeName="bool";BooleanKeyframeTrack.prototype.ValueBufferType=Array;BooleanKeyframeTrack.prototype.DefaultInterpolation=InterpolateDiscrete;BooleanKeyframeTrack.prototype.InterpolantFactoryMethodLinear=void 0;BooleanKeyframeTrack.prototype.InterpolantFactoryMethodSmooth=void 0;class ColorKeyframeTrack extends KeyframeTrack{}ColorKeyframeTrack.prototype.ValueTypeName="color";class NumberKeyframeTrack extends KeyframeTrack{}NumberKeyframeTrack.prototype.ValueTypeName="number";class QuaternionLinearInterpolant extends Interpolant{constructor(Z,_,K,te){super(Z,_,K,te)}interpolate_(Z,_,K,te){const ne=this.resultBuffer,oe=this.sampleValues,ie=this.valueSize,se=(K-_)/(te-_);let ae=Z*ie;for(let ge=ae+ie;ae!==ge;ae+=4)Quaternion$2.slerpFlat(ne,0,oe,ae-ie,oe,ae,se);return ne}}class QuaternionKeyframeTrack extends KeyframeTrack{InterpolantFactoryMethodLinear(Z){return new QuaternionLinearInterpolant(this.times,this.values,this.getValueSize(),Z)}}QuaternionKeyframeTrack.prototype.ValueTypeName="quaternion";QuaternionKeyframeTrack.prototype.DefaultInterpolation=InterpolateLinear;QuaternionKeyframeTrack.prototype.InterpolantFactoryMethodSmooth=void 0;class StringKeyframeTrack extends KeyframeTrack{}StringKeyframeTrack.prototype.ValueTypeName="string";StringKeyframeTrack.prototype.ValueBufferType=Array;StringKeyframeTrack.prototype.DefaultInterpolation=InterpolateDiscrete;StringKeyframeTrack.prototype.InterpolantFactoryMethodLinear=void 0;StringKeyframeTrack.prototype.InterpolantFactoryMethodSmooth=void 0;class VectorKeyframeTrack extends KeyframeTrack{}VectorKeyframeTrack.prototype.ValueTypeName="vector";class AnimationClip{constructor(Z,_=-1,K,te=NormalAnimationBlendMode){this.name=Z,this.tracks=K,this.duration=_,this.blendMode=te,this.uuid=generateUUID$1(),this.duration<0&&this.resetDuration()}static parse(Z){const _=[],K=Z.tracks,te=1/(Z.fps||1);for(let oe=0,ie=K.length;oe!==ie;++oe)_.push(parseKeyframeTrack(K[oe]).scale(te));const ne=new this(Z.name,Z.duration,_,Z.blendMode);return ne.uuid=Z.uuid,ne}static toJSON(Z){const _=[],K=Z.tracks,te={name:Z.name,duration:Z.duration,tracks:_,uuid:Z.uuid,blendMode:Z.blendMode};for(let ne=0,oe=K.length;ne!==oe;++ne)_.push(KeyframeTrack.toJSON(K[ne]));return te}static CreateFromMorphTargetSequence(Z,_,K,te){const ne=_.length,oe=[];for(let ie=0;ie<ne;ie++){let se=[],ae=[];se.push((ie+ne-1)%ne,ie,(ie+1)%ne),ae.push(0,1,0);const ge=getKeyframeOrder(se);se=sortedArray(se,1,ge),ae=sortedArray(ae,1,ge),!te&&se[0]===0&&(se.push(ne),ae.push(ae[0])),oe.push(new NumberKeyframeTrack(".morphTargetInfluences["+_[ie].name+"]",se,ae).scale(1/K))}return new this(Z,-1,oe)}static findByName(Z,_){let K=Z;if(!Array.isArray(Z)){const te=Z;K=te.geometry&&te.geometry.animations||te.animations}for(let te=0;te<K.length;te++)if(K[te].name===_)return K[te];return null}static CreateClipsFromMorphTargetSequences(Z,_,K){const te={},ne=/^([\w-]*?)([\d]+)$/;for(let ie=0,se=Z.length;ie<se;ie++){const ae=Z[ie],ge=ae.name.match(ne);if(ge&&ge.length>1){const ce=ge[1];let de=te[ce];de||(te[ce]=de=[]),de.push(ae)}}const oe=[];for(const ie in te)oe.push(this.CreateFromMorphTargetSequence(ie,te[ie],_,K));return oe}static parseAnimation(Z,_){if(!Z)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;const K=function(ce,de,pe,fe,be){if(pe.length!==0){const me=[],ye=[];flattenJSON(pe,me,ye,fe),me.length!==0&&be.push(new ce(de,me,ye))}},te=[],ne=Z.name||"default",oe=Z.fps||30,ie=Z.blendMode;let se=Z.length||-1;const ae=Z.hierarchy||[];for(let ce=0;ce<ae.length;ce++){const de=ae[ce].keys;if(!(!de||de.length===0))if(de[0].morphTargets){const pe={};let fe;for(fe=0;fe<de.length;fe++)if(de[fe].morphTargets)for(let be=0;be<de[fe].morphTargets.length;be++)pe[de[fe].morphTargets[be]]=-1;for(const be in pe){const me=[],ye=[];for(let ve=0;ve!==de[fe].morphTargets.length;++ve){const Be=de[fe];me.push(Be.time),ye.push(Be.morphTarget===be?1:0)}te.push(new NumberKeyframeTrack(".morphTargetInfluence["+be+"]",me,ye))}se=pe.length*oe}else{const pe=".bones["+_[ce].name+"]";K(VectorKeyframeTrack,pe+".position",de,"pos",te),K(QuaternionKeyframeTrack,pe+".quaternion",de,"rot",te),K(VectorKeyframeTrack,pe+".scale",de,"scl",te)}}return te.length===0?null:new this(ne,se,te,ie)}resetDuration(){const Z=this.tracks;let _=0;for(let K=0,te=Z.length;K!==te;++K){const ne=this.tracks[K];_=Math.max(_,ne.times[ne.times.length-1])}return this.duration=_,this}trim(){for(let Z=0;Z<this.tracks.length;Z++)this.tracks[Z].trim(0,this.duration);return this}validate(){let Z=!0;for(let _=0;_<this.tracks.length;_++)Z=Z&&this.tracks[_].validate();return Z}optimize(){for(let Z=0;Z<this.tracks.length;Z++)this.tracks[Z].optimize();return this}clone(){const Z=[];for(let _=0;_<this.tracks.length;_++)Z.push(this.tracks[_].clone());return new this.constructor(this.name,this.duration,Z,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}}function getTrackTypeForValueTypeName(X){switch(X.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return NumberKeyframeTrack;case"vector":case"vector2":case"vector3":case"vector4":return VectorKeyframeTrack;case"color":return ColorKeyframeTrack;case"quaternion":return QuaternionKeyframeTrack;case"bool":case"boolean":return BooleanKeyframeTrack;case"string":return StringKeyframeTrack}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+X)}function parseKeyframeTrack(X){if(X.type===void 0)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const Z=getTrackTypeForValueTypeName(X.type);if(X.times===void 0){const _=[],K=[];flattenJSON(X.keys,_,K,"value"),X.times=_,X.values=K}return Z.parse!==void 0?Z.parse(X):new Z(X.name,X.times,X.values,X.interpolation)}const Cache={enabled:!1,files:{},add:function(X,Z){this.enabled!==!1&&(this.files[X]=Z)},get:function(X){if(this.enabled!==!1)return this.files[X]},remove:function(X){delete this.files[X]},clear:function(){this.files={}}};class LoadingManager{constructor(Z,_,K){const te=this;let ne=!1,oe=0,ie=0,se;const ae=[];this.onStart=void 0,this.onLoad=Z,this.onProgress=_,this.onError=K,this.itemStart=function(ge){ie++,ne===!1&&te.onStart!==void 0&&te.onStart(ge,oe,ie),ne=!0},this.itemEnd=function(ge){oe++,te.onProgress!==void 0&&te.onProgress(ge,oe,ie),oe===ie&&(ne=!1,te.onLoad!==void 0&&te.onLoad())},this.itemError=function(ge){te.onError!==void 0&&te.onError(ge)},this.resolveURL=function(ge){return se?se(ge):ge},this.setURLModifier=function(ge){return se=ge,this},this.addHandler=function(ge,ce){return ae.push(ge,ce),this},this.removeHandler=function(ge){const ce=ae.indexOf(ge);return ce!==-1&&ae.splice(ce,2),this},this.getHandler=function(ge){for(let ce=0,de=ae.length;ce<de;ce+=2){const pe=ae[ce],fe=ae[ce+1];if(pe.global&&(pe.lastIndex=0),pe.test(ge))return fe}return null}}}const DefaultLoadingManager=new LoadingManager;class Loader{constructor(Z){this.manager=Z!==void 0?Z:DefaultLoadingManager,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(Z,_){const K=this;return new Promise(function(te,ne){K.load(Z,te,_,ne)})}parse(){}setCrossOrigin(Z){return this.crossOrigin=Z,this}setWithCredentials(Z){return this.withCredentials=Z,this}setPath(Z){return this.path=Z,this}setResourcePath(Z){return this.resourcePath=Z,this}setRequestHeader(Z){return this.requestHeader=Z,this}}Loader.DEFAULT_MATERIAL_NAME="__DEFAULT";const loading={};class HttpError extends Error{constructor(Z,_){super(Z),this.response=_}}class FileLoader extends Loader{constructor(Z){super(Z)}load(Z,_,K,te){Z===void 0&&(Z=""),this.path!==void 0&&(Z=this.path+Z),Z=this.manager.resolveURL(Z);const ne=Cache.get(Z);if(ne!==void 0)return this.manager.itemStart(Z),setTimeout(()=>{_&&_(ne),this.manager.itemEnd(Z)},0),ne;if(loading[Z]!==void 0){loading[Z].push({onLoad:_,onProgress:K,onError:te});return}loading[Z]=[],loading[Z].push({onLoad:_,onProgress:K,onError:te});const oe=new Request(Z,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),ie=this.mimeType,se=this.responseType;fetch(oe).then(ae=>{if(ae.status===200||ae.status===0){if(ae.status===0&&console.warn("THREE.FileLoader: HTTP Status 0 received."),typeof ReadableStream>"u"||ae.body===void 0||ae.body.getReader===void 0)return ae;const ge=loading[Z],ce=ae.body.getReader(),de=ae.headers.get("Content-Length")||ae.headers.get("X-File-Size"),pe=de?parseInt(de):0,fe=pe!==0;let be=0;const me=new ReadableStream({start(ye){ve();function ve(){ce.read().then(({done:Be,value:Re})=>{if(Be)ye.close();else{be+=Re.byteLength;const Ee=new ProgressEvent("progress",{lengthComputable:fe,loaded:be,total:pe});for(let We=0,Ze=ge.length;We<Ze;We++){const Ve=ge[We];Ve.onProgress&&Ve.onProgress(Ee)}ye.enqueue(Re),ve()}})}}});return new Response(me)}else throw new HttpError(`fetch for "${ae.url}" responded with ${ae.status}: ${ae.statusText}`,ae)}).then(ae=>{switch(se){case"arraybuffer":return ae.arrayBuffer();case"blob":return ae.blob();case"document":return ae.text().then(ge=>new DOMParser().parseFromString(ge,ie));case"json":return ae.json();default:if(ie===void 0)return ae.text();{const ce=/charset="?([^;"\s]*)"?/i.exec(ie),de=ce&&ce[1]?ce[1].toLowerCase():void 0,pe=new TextDecoder(de);return ae.arrayBuffer().then(fe=>pe.decode(fe))}}}).then(ae=>{Cache.add(Z,ae);const ge=loading[Z];delete loading[Z];for(let ce=0,de=ge.length;ce<de;ce++){const pe=ge[ce];pe.onLoad&&pe.onLoad(ae)}}).catch(ae=>{const ge=loading[Z];if(ge===void 0)throw this.manager.itemError(Z),ae;delete loading[Z];for(let ce=0,de=ge.length;ce<de;ce++){const pe=ge[ce];pe.onError&&pe.onError(ae)}this.manager.itemError(Z)}).finally(()=>{this.manager.itemEnd(Z)}),this.manager.itemStart(Z)}setResponseType(Z){return this.responseType=Z,this}setMimeType(Z){return this.mimeType=Z,this}}class AnimationLoader extends Loader{constructor(Z){super(Z)}load(Z,_,K,te){const ne=this,oe=new FileLoader(this.manager);oe.setPath(this.path),oe.setRequestHeader(this.requestHeader),oe.setWithCredentials(this.withCredentials),oe.load(Z,function(ie){try{_(ne.parse(JSON.parse(ie)))}catch(se){te?te(se):console.error(se),ne.manager.itemError(Z)}},K,te)}parse(Z){const _=[];for(let K=0;K<Z.length;K++){const te=AnimationClip.parse(Z[K]);_.push(te)}return _}}class CompressedTextureLoader extends Loader{constructor(Z){super(Z)}load(Z,_,K,te){const ne=this,oe=[],ie=new CompressedTexture,se=new FileLoader(this.manager);se.setPath(this.path),se.setResponseType("arraybuffer"),se.setRequestHeader(this.requestHeader),se.setWithCredentials(ne.withCredentials);let ae=0;function ge(ce){se.load(Z[ce],function(de){const pe=ne.parse(de,!0);oe[ce]={width:pe.width,height:pe.height,format:pe.format,mipmaps:pe.mipmaps},ae+=1,ae===6&&(pe.mipmapCount===1&&(ie.minFilter=LinearFilter),ie.image=oe,ie.format=pe.format,ie.needsUpdate=!0,_&&_(ie))},K,te)}if(Array.isArray(Z))for(let ce=0,de=Z.length;ce<de;++ce)ge(ce);else se.load(Z,function(ce){const de=ne.parse(ce,!0);if(de.isCubemap){const pe=de.mipmaps.length/de.mipmapCount;for(let fe=0;fe<pe;fe++){oe[fe]={mipmaps:[]};for(let be=0;be<de.mipmapCount;be++)oe[fe].mipmaps.push(de.mipmaps[fe*de.mipmapCount+be]),oe[fe].format=de.format,oe[fe].width=de.width,oe[fe].height=de.height}ie.image=oe}else ie.image.width=de.width,ie.image.height=de.height,ie.mipmaps=de.mipmaps;de.mipmapCount===1&&(ie.minFilter=LinearFilter),ie.format=de.format,ie.needsUpdate=!0,_&&_(ie)},K,te);return ie}}class ImageLoader extends Loader{constructor(Z){super(Z)}load(Z,_,K,te){this.path!==void 0&&(Z=this.path+Z),Z=this.manager.resolveURL(Z);const ne=this,oe=Cache.get(Z);if(oe!==void 0)return ne.manager.itemStart(Z),setTimeout(function(){_&&_(oe),ne.manager.itemEnd(Z)},0),oe;const ie=createElementNS("img");function se(){ge(),Cache.add(Z,this),_&&_(this),ne.manager.itemEnd(Z)}function ae(ce){ge(),te&&te(ce),ne.manager.itemError(Z),ne.manager.itemEnd(Z)}function ge(){ie.removeEventListener("load",se,!1),ie.removeEventListener("error",ae,!1)}return ie.addEventListener("load",se,!1),ie.addEventListener("error",ae,!1),Z.slice(0,5)!=="data:"&&this.crossOrigin!==void 0&&(ie.crossOrigin=this.crossOrigin),ne.manager.itemStart(Z),ie.src=Z,ie}}class CubeTextureLoader extends Loader{constructor(Z){super(Z)}load(Z,_,K,te){const ne=new CubeTexture;ne.colorSpace=SRGBColorSpace$1;const oe=new ImageLoader(this.manager);oe.setCrossOrigin(this.crossOrigin),oe.setPath(this.path);let ie=0;function se(ae){oe.load(Z[ae],function(ge){ne.images[ae]=ge,ie++,ie===6&&(ne.needsUpdate=!0,_&&_(ne))},void 0,te)}for(let ae=0;ae<Z.length;++ae)se(ae);return ne}}class DataTextureLoader extends Loader{constructor(Z){super(Z)}load(Z,_,K,te){const ne=this,oe=new DataTexture,ie=new FileLoader(this.manager);return ie.setResponseType("arraybuffer"),ie.setRequestHeader(this.requestHeader),ie.setPath(this.path),ie.setWithCredentials(ne.withCredentials),ie.load(Z,function(se){const ae=ne.parse(se);ae&&(ae.image!==void 0?oe.image=ae.image:ae.data!==void 0&&(oe.image.width=ae.width,oe.image.height=ae.height,oe.image.data=ae.data),oe.wrapS=ae.wrapS!==void 0?ae.wrapS:ClampToEdgeWrapping,oe.wrapT=ae.wrapT!==void 0?ae.wrapT:ClampToEdgeWrapping,oe.magFilter=ae.magFilter!==void 0?ae.magFilter:LinearFilter,oe.minFilter=ae.minFilter!==void 0?ae.minFilter:LinearFilter,oe.anisotropy=ae.anisotropy!==void 0?ae.anisotropy:1,ae.colorSpace!==void 0?oe.colorSpace=ae.colorSpace:ae.encoding!==void 0&&(oe.encoding=ae.encoding),ae.flipY!==void 0&&(oe.flipY=ae.flipY),ae.format!==void 0&&(oe.format=ae.format),ae.type!==void 0&&(oe.type=ae.type),ae.mipmaps!==void 0&&(oe.mipmaps=ae.mipmaps,oe.minFilter=LinearMipmapLinearFilter),ae.mipmapCount===1&&(oe.minFilter=LinearFilter),ae.generateMipmaps!==void 0&&(oe.generateMipmaps=ae.generateMipmaps),oe.needsUpdate=!0,_&&_(oe,ae))},K,te),oe}}class TextureLoader extends Loader{constructor(Z){super(Z)}load(Z,_,K,te){const ne=new Texture,oe=new ImageLoader(this.manager);return oe.setCrossOrigin(this.crossOrigin),oe.setPath(this.path),oe.load(Z,function(ie){ne.image=ie,ne.needsUpdate=!0,_!==void 0&&_(ne)},K,te),ne}}class Light extends Object3D{constructor(Z,_=1){super(),this.isLight=!0,this.type="Light",this.color=new Color$1(Z),this.intensity=_}dispose(){}copy(Z,_){return super.copy(Z,_),this.color.copy(Z.color),this.intensity=Z.intensity,this}toJSON(Z){const _=super.toJSON(Z);return _.object.color=this.color.getHex(),_.object.intensity=this.intensity,this.groundColor!==void 0&&(_.object.groundColor=this.groundColor.getHex()),this.distance!==void 0&&(_.object.distance=this.distance),this.angle!==void 0&&(_.object.angle=this.angle),this.decay!==void 0&&(_.object.decay=this.decay),this.penumbra!==void 0&&(_.object.penumbra=this.penumbra),this.shadow!==void 0&&(_.object.shadow=this.shadow.toJSON()),_}}class HemisphereLight extends Light{constructor(Z,_,K){super(Z,K),this.isHemisphereLight=!0,this.type="HemisphereLight",this.position.copy(Object3D.DEFAULT_UP),this.updateMatrix(),this.groundColor=new Color$1(_)}copy(Z,_){return super.copy(Z,_),this.groundColor.copy(Z.groundColor),this}}const _projScreenMatrix$1=new Matrix4,_lightPositionWorld$1=new Vector3,_lookTarget$1=new Vector3;class LightShadow{constructor(Z){this.camera=Z,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new Vector2(512,512),this.map=null,this.mapPass=null,this.matrix=new Matrix4,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new Frustum,this._frameExtents=new Vector2(1,1),this._viewportCount=1,this._viewports=[new Vector4(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(Z){const _=this.camera,K=this.matrix;_lightPositionWorld$1.setFromMatrixPosition(Z.matrixWorld),_.position.copy(_lightPositionWorld$1),_lookTarget$1.setFromMatrixPosition(Z.target.matrixWorld),_.lookAt(_lookTarget$1),_.updateMatrixWorld(),_projScreenMatrix$1.multiplyMatrices(_.projectionMatrix,_.matrixWorldInverse),this._frustum.setFromProjectionMatrix(_projScreenMatrix$1),K.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),K.multiply(_projScreenMatrix$1)}getViewport(Z){return this._viewports[Z]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(Z){return this.camera=Z.camera.clone(),this.bias=Z.bias,this.radius=Z.radius,this.mapSize.copy(Z.mapSize),this}clone(){return new this.constructor().copy(this)}toJSON(){const Z={};return this.bias!==0&&(Z.bias=this.bias),this.normalBias!==0&&(Z.normalBias=this.normalBias),this.radius!==1&&(Z.radius=this.radius),(this.mapSize.x!==512||this.mapSize.y!==512)&&(Z.mapSize=this.mapSize.toArray()),Z.camera=this.camera.toJSON(!1).object,delete Z.camera.matrix,Z}}class SpotLightShadow extends LightShadow{constructor(){super(new PerspectiveCamera(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1}updateMatrices(Z){const _=this.camera,K=RAD2DEG*2*Z.angle*this.focus,te=this.mapSize.width/this.mapSize.height,ne=Z.distance||_.far;(K!==_.fov||te!==_.aspect||ne!==_.far)&&(_.fov=K,_.aspect=te,_.far=ne,_.updateProjectionMatrix()),super.updateMatrices(Z)}copy(Z){return super.copy(Z),this.focus=Z.focus,this}}class SpotLight extends Light{constructor(Z,_,K=0,te=Math.PI/3,ne=0,oe=2){super(Z,_),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(Object3D.DEFAULT_UP),this.updateMatrix(),this.target=new Object3D,this.distance=K,this.angle=te,this.penumbra=ne,this.decay=oe,this.map=null,this.shadow=new SpotLightShadow}get power(){return this.intensity*Math.PI}set power(Z){this.intensity=Z/Math.PI}dispose(){this.shadow.dispose()}copy(Z,_){return super.copy(Z,_),this.distance=Z.distance,this.angle=Z.angle,this.penumbra=Z.penumbra,this.decay=Z.decay,this.target=Z.target.clone(),this.shadow=Z.shadow.clone(),this}}const _projScreenMatrix=new Matrix4,_lightPositionWorld=new Vector3,_lookTarget=new Vector3;class PointLightShadow extends LightShadow{constructor(){super(new PerspectiveCamera(90,1,.5,500)),this.isPointLightShadow=!0,this._frameExtents=new Vector2(4,2),this._viewportCount=6,this._viewports=[new Vector4(2,1,1,1),new Vector4(0,1,1,1),new Vector4(3,1,1,1),new Vector4(1,1,1,1),new Vector4(3,0,1,1),new Vector4(1,0,1,1)],this._cubeDirections=[new Vector3(1,0,0),new Vector3(-1,0,0),new Vector3(0,0,1),new Vector3(0,0,-1),new Vector3(0,1,0),new Vector3(0,-1,0)],this._cubeUps=[new Vector3(0,1,0),new Vector3(0,1,0),new Vector3(0,1,0),new Vector3(0,1,0),new Vector3(0,0,1),new Vector3(0,0,-1)]}updateMatrices(Z,_=0){const K=this.camera,te=this.matrix,ne=Z.distance||K.far;ne!==K.far&&(K.far=ne,K.updateProjectionMatrix()),_lightPositionWorld.setFromMatrixPosition(Z.matrixWorld),K.position.copy(_lightPositionWorld),_lookTarget.copy(K.position),_lookTarget.add(this._cubeDirections[_]),K.up.copy(this._cubeUps[_]),K.lookAt(_lookTarget),K.updateMatrixWorld(),te.makeTranslation(-_lightPositionWorld.x,-_lightPositionWorld.y,-_lightPositionWorld.z),_projScreenMatrix.multiplyMatrices(K.projectionMatrix,K.matrixWorldInverse),this._frustum.setFromProjectionMatrix(_projScreenMatrix)}}class PointLight extends Light{constructor(Z,_,K=0,te=2){super(Z,_),this.isPointLight=!0,this.type="PointLight",this.distance=K,this.decay=te,this.shadow=new PointLightShadow}get power(){return this.intensity*4*Math.PI}set power(Z){this.intensity=Z/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(Z,_){return super.copy(Z,_),this.distance=Z.distance,this.decay=Z.decay,this.shadow=Z.shadow.clone(),this}}class DirectionalLightShadow extends LightShadow{constructor(){super(new OrthographicCamera(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}}class DirectionalLight extends Light{constructor(Z,_){super(Z,_),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(Object3D.DEFAULT_UP),this.updateMatrix(),this.target=new Object3D,this.shadow=new DirectionalLightShadow}dispose(){this.shadow.dispose()}copy(Z){return super.copy(Z),this.target=Z.target.clone(),this.shadow=Z.shadow.clone(),this}}class AmbientLight extends Light{constructor(Z,_){super(Z,_),this.isAmbientLight=!0,this.type="AmbientLight"}}class RectAreaLight extends Light{constructor(Z,_,K=10,te=10){super(Z,_),this.isRectAreaLight=!0,this.type="RectAreaLight",this.width=K,this.height=te}get power(){return this.intensity*this.width*this.height*Math.PI}set power(Z){this.intensity=Z/(this.width*this.height*Math.PI)}copy(Z){return super.copy(Z),this.width=Z.width,this.height=Z.height,this}toJSON(Z){const _=super.toJSON(Z);return _.object.width=this.width,_.object.height=this.height,_}}class SphericalHarmonics3{constructor(){this.isSphericalHarmonics3=!0,this.coefficients=[];for(let Z=0;Z<9;Z++)this.coefficients.push(new Vector3)}set(Z){for(let _=0;_<9;_++)this.coefficients[_].copy(Z[_]);return this}zero(){for(let Z=0;Z<9;Z++)this.coefficients[Z].set(0,0,0);return this}getAt(Z,_){const K=Z.x,te=Z.y,ne=Z.z,oe=this.coefficients;return _.copy(oe[0]).multiplyScalar(.282095),_.addScaledVector(oe[1],.488603*te),_.addScaledVector(oe[2],.488603*ne),_.addScaledVector(oe[3],.488603*K),_.addScaledVector(oe[4],1.092548*(K*te)),_.addScaledVector(oe[5],1.092548*(te*ne)),_.addScaledVector(oe[6],.315392*(3*ne*ne-1)),_.addScaledVector(oe[7],1.092548*(K*ne)),_.addScaledVector(oe[8],.546274*(K*K-te*te)),_}getIrradianceAt(Z,_){const K=Z.x,te=Z.y,ne=Z.z,oe=this.coefficients;return _.copy(oe[0]).multiplyScalar(.886227),_.addScaledVector(oe[1],2*.511664*te),_.addScaledVector(oe[2],2*.511664*ne),_.addScaledVector(oe[3],2*.511664*K),_.addScaledVector(oe[4],2*.429043*K*te),_.addScaledVector(oe[5],2*.429043*te*ne),_.addScaledVector(oe[6],.743125*ne*ne-.247708),_.addScaledVector(oe[7],2*.429043*K*ne),_.addScaledVector(oe[8],.429043*(K*K-te*te)),_}add(Z){for(let _=0;_<9;_++)this.coefficients[_].add(Z.coefficients[_]);return this}addScaledSH(Z,_){for(let K=0;K<9;K++)this.coefficients[K].addScaledVector(Z.coefficients[K],_);return this}scale(Z){for(let _=0;_<9;_++)this.coefficients[_].multiplyScalar(Z);return this}lerp(Z,_){for(let K=0;K<9;K++)this.coefficients[K].lerp(Z.coefficients[K],_);return this}equals(Z){for(let _=0;_<9;_++)if(!this.coefficients[_].equals(Z.coefficients[_]))return!1;return!0}copy(Z){return this.set(Z.coefficients)}clone(){return new this.constructor().copy(this)}fromArray(Z,_=0){const K=this.coefficients;for(let te=0;te<9;te++)K[te].fromArray(Z,_+te*3);return this}toArray(Z=[],_=0){const K=this.coefficients;for(let te=0;te<9;te++)K[te].toArray(Z,_+te*3);return Z}static getBasisAt(Z,_){const K=Z.x,te=Z.y,ne=Z.z;_[0]=.282095,_[1]=.488603*te,_[2]=.488603*ne,_[3]=.488603*K,_[4]=1.092548*K*te,_[5]=1.092548*te*ne,_[6]=.315392*(3*ne*ne-1),_[7]=1.092548*K*ne,_[8]=.546274*(K*K-te*te)}}class LightProbe extends Light{constructor(Z=new SphericalHarmonics3,_=1){super(void 0,_),this.isLightProbe=!0,this.sh=Z}copy(Z){return super.copy(Z),this.sh.copy(Z.sh),this}fromJSON(Z){return this.intensity=Z.intensity,this.sh.fromArray(Z.sh),this}toJSON(Z){const _=super.toJSON(Z);return _.object.sh=this.sh.toArray(),_}}class MaterialLoader extends Loader{constructor(Z){super(Z),this.textures={}}load(Z,_,K,te){const ne=this,oe=new FileLoader(ne.manager);oe.setPath(ne.path),oe.setRequestHeader(ne.requestHeader),oe.setWithCredentials(ne.withCredentials),oe.load(Z,function(ie){try{_(ne.parse(JSON.parse(ie)))}catch(se){te?te(se):console.error(se),ne.manager.itemError(Z)}},K,te)}parse(Z){const _=this.textures;function K(ne){return _[ne]===void 0&&console.warn("THREE.MaterialLoader: Undefined texture",ne),_[ne]}const te=MaterialLoader.createMaterialFromType(Z.type);if(Z.uuid!==void 0&&(te.uuid=Z.uuid),Z.name!==void 0&&(te.name=Z.name),Z.color!==void 0&&te.color!==void 0&&te.color.setHex(Z.color),Z.roughness!==void 0&&(te.roughness=Z.roughness),Z.metalness!==void 0&&(te.metalness=Z.metalness),Z.sheen!==void 0&&(te.sheen=Z.sheen),Z.sheenColor!==void 0&&(te.sheenColor=new Color$1().setHex(Z.sheenColor)),Z.sheenRoughness!==void 0&&(te.sheenRoughness=Z.sheenRoughness),Z.emissive!==void 0&&te.emissive!==void 0&&te.emissive.setHex(Z.emissive),Z.specular!==void 0&&te.specular!==void 0&&te.specular.setHex(Z.specular),Z.specularIntensity!==void 0&&(te.specularIntensity=Z.specularIntensity),Z.specularColor!==void 0&&te.specularColor!==void 0&&te.specularColor.setHex(Z.specularColor),Z.shininess!==void 0&&(te.shininess=Z.shininess),Z.clearcoat!==void 0&&(te.clearcoat=Z.clearcoat),Z.clearcoatRoughness!==void 0&&(te.clearcoatRoughness=Z.clearcoatRoughness),Z.iridescence!==void 0&&(te.iridescence=Z.iridescence),Z.iridescenceIOR!==void 0&&(te.iridescenceIOR=Z.iridescenceIOR),Z.iridescenceThicknessRange!==void 0&&(te.iridescenceThicknessRange=Z.iridescenceThicknessRange),Z.transmission!==void 0&&(te.transmission=Z.transmission),Z.thickness!==void 0&&(te.thickness=Z.thickness),Z.attenuationDistance!==void 0&&(te.attenuationDistance=Z.attenuationDistance),Z.attenuationColor!==void 0&&te.attenuationColor!==void 0&&te.attenuationColor.setHex(Z.attenuationColor),Z.anisotropy!==void 0&&(te.anisotropy=Z.anisotropy),Z.anisotropyRotation!==void 0&&(te.anisotropyRotation=Z.anisotropyRotation),Z.fog!==void 0&&(te.fog=Z.fog),Z.flatShading!==void 0&&(te.flatShading=Z.flatShading),Z.blending!==void 0&&(te.blending=Z.blending),Z.combine!==void 0&&(te.combine=Z.combine),Z.side!==void 0&&(te.side=Z.side),Z.shadowSide!==void 0&&(te.shadowSide=Z.shadowSide),Z.opacity!==void 0&&(te.opacity=Z.opacity),Z.transparent!==void 0&&(te.transparent=Z.transparent),Z.alphaTest!==void 0&&(te.alphaTest=Z.alphaTest),Z.alphaHash!==void 0&&(te.alphaHash=Z.alphaHash),Z.depthTest!==void 0&&(te.depthTest=Z.depthTest),Z.depthWrite!==void 0&&(te.depthWrite=Z.depthWrite),Z.colorWrite!==void 0&&(te.colorWrite=Z.colorWrite),Z.stencilWrite!==void 0&&(te.stencilWrite=Z.stencilWrite),Z.stencilWriteMask!==void 0&&(te.stencilWriteMask=Z.stencilWriteMask),Z.stencilFunc!==void 0&&(te.stencilFunc=Z.stencilFunc),Z.stencilRef!==void 0&&(te.stencilRef=Z.stencilRef),Z.stencilFuncMask!==void 0&&(te.stencilFuncMask=Z.stencilFuncMask),Z.stencilFail!==void 0&&(te.stencilFail=Z.stencilFail),Z.stencilZFail!==void 0&&(te.stencilZFail=Z.stencilZFail),Z.stencilZPass!==void 0&&(te.stencilZPass=Z.stencilZPass),Z.wireframe!==void 0&&(te.wireframe=Z.wireframe),Z.wireframeLinewidth!==void 0&&(te.wireframeLinewidth=Z.wireframeLinewidth),Z.wireframeLinecap!==void 0&&(te.wireframeLinecap=Z.wireframeLinecap),Z.wireframeLinejoin!==void 0&&(te.wireframeLinejoin=Z.wireframeLinejoin),Z.rotation!==void 0&&(te.rotation=Z.rotation),Z.linewidth!==1&&(te.linewidth=Z.linewidth),Z.dashSize!==void 0&&(te.dashSize=Z.dashSize),Z.gapSize!==void 0&&(te.gapSize=Z.gapSize),Z.scale!==void 0&&(te.scale=Z.scale),Z.polygonOffset!==void 0&&(te.polygonOffset=Z.polygonOffset),Z.polygonOffsetFactor!==void 0&&(te.polygonOffsetFactor=Z.polygonOffsetFactor),Z.polygonOffsetUnits!==void 0&&(te.polygonOffsetUnits=Z.polygonOffsetUnits),Z.dithering!==void 0&&(te.dithering=Z.dithering),Z.alphaToCoverage!==void 0&&(te.alphaToCoverage=Z.alphaToCoverage),Z.premultipliedAlpha!==void 0&&(te.premultipliedAlpha=Z.premultipliedAlpha),Z.forceSinglePass!==void 0&&(te.forceSinglePass=Z.forceSinglePass),Z.visible!==void 0&&(te.visible=Z.visible),Z.toneMapped!==void 0&&(te.toneMapped=Z.toneMapped),Z.userData!==void 0&&(te.userData=Z.userData),Z.vertexColors!==void 0&&(typeof Z.vertexColors=="number"?te.vertexColors=Z.vertexColors>0:te.vertexColors=Z.vertexColors),Z.uniforms!==void 0)for(const ne in Z.uniforms){const oe=Z.uniforms[ne];switch(te.uniforms[ne]={},oe.type){case"t":te.uniforms[ne].value=K(oe.value);break;case"c":te.uniforms[ne].value=new Color$1().setHex(oe.value);break;case"v2":te.uniforms[ne].value=new Vector2().fromArray(oe.value);break;case"v3":te.uniforms[ne].value=new Vector3().fromArray(oe.value);break;case"v4":te.uniforms[ne].value=new Vector4().fromArray(oe.value);break;case"m3":te.uniforms[ne].value=new Matrix3().fromArray(oe.value);break;case"m4":te.uniforms[ne].value=new Matrix4().fromArray(oe.value);break;default:te.uniforms[ne].value=oe.value}}if(Z.defines!==void 0&&(te.defines=Z.defines),Z.vertexShader!==void 0&&(te.vertexShader=Z.vertexShader),Z.fragmentShader!==void 0&&(te.fragmentShader=Z.fragmentShader),Z.glslVersion!==void 0&&(te.glslVersion=Z.glslVersion),Z.extensions!==void 0)for(const ne in Z.extensions)te.extensions[ne]=Z.extensions[ne];if(Z.lights!==void 0&&(te.lights=Z.lights),Z.clipping!==void 0&&(te.clipping=Z.clipping),Z.size!==void 0&&(te.size=Z.size),Z.sizeAttenuation!==void 0&&(te.sizeAttenuation=Z.sizeAttenuation),Z.map!==void 0&&(te.map=K(Z.map)),Z.matcap!==void 0&&(te.matcap=K(Z.matcap)),Z.alphaMap!==void 0&&(te.alphaMap=K(Z.alphaMap)),Z.bumpMap!==void 0&&(te.bumpMap=K(Z.bumpMap)),Z.bumpScale!==void 0&&(te.bumpScale=Z.bumpScale),Z.normalMap!==void 0&&(te.normalMap=K(Z.normalMap)),Z.normalMapType!==void 0&&(te.normalMapType=Z.normalMapType),Z.normalScale!==void 0){let ne=Z.normalScale;Array.isArray(ne)===!1&&(ne=[ne,ne]),te.normalScale=new Vector2().fromArray(ne)}return Z.displacementMap!==void 0&&(te.displacementMap=K(Z.displacementMap)),Z.displacementScale!==void 0&&(te.displacementScale=Z.displacementScale),Z.displacementBias!==void 0&&(te.displacementBias=Z.displacementBias),Z.roughnessMap!==void 0&&(te.roughnessMap=K(Z.roughnessMap)),Z.metalnessMap!==void 0&&(te.metalnessMap=K(Z.metalnessMap)),Z.emissiveMap!==void 0&&(te.emissiveMap=K(Z.emissiveMap)),Z.emissiveIntensity!==void 0&&(te.emissiveIntensity=Z.emissiveIntensity),Z.specularMap!==void 0&&(te.specularMap=K(Z.specularMap)),Z.specularIntensityMap!==void 0&&(te.specularIntensityMap=K(Z.specularIntensityMap)),Z.specularColorMap!==void 0&&(te.specularColorMap=K(Z.specularColorMap)),Z.envMap!==void 0&&(te.envMap=K(Z.envMap)),Z.envMapIntensity!==void 0&&(te.envMapIntensity=Z.envMapIntensity),Z.reflectivity!==void 0&&(te.reflectivity=Z.reflectivity),Z.refractionRatio!==void 0&&(te.refractionRatio=Z.refractionRatio),Z.lightMap!==void 0&&(te.lightMap=K(Z.lightMap)),Z.lightMapIntensity!==void 0&&(te.lightMapIntensity=Z.lightMapIntensity),Z.aoMap!==void 0&&(te.aoMap=K(Z.aoMap)),Z.aoMapIntensity!==void 0&&(te.aoMapIntensity=Z.aoMapIntensity),Z.gradientMap!==void 0&&(te.gradientMap=K(Z.gradientMap)),Z.clearcoatMap!==void 0&&(te.clearcoatMap=K(Z.clearcoatMap)),Z.clearcoatRoughnessMap!==void 0&&(te.clearcoatRoughnessMap=K(Z.clearcoatRoughnessMap)),Z.clearcoatNormalMap!==void 0&&(te.clearcoatNormalMap=K(Z.clearcoatNormalMap)),Z.clearcoatNormalScale!==void 0&&(te.clearcoatNormalScale=new Vector2().fromArray(Z.clearcoatNormalScale)),Z.iridescenceMap!==void 0&&(te.iridescenceMap=K(Z.iridescenceMap)),Z.iridescenceThicknessMap!==void 0&&(te.iridescenceThicknessMap=K(Z.iridescenceThicknessMap)),Z.transmissionMap!==void 0&&(te.transmissionMap=K(Z.transmissionMap)),Z.thicknessMap!==void 0&&(te.thicknessMap=K(Z.thicknessMap)),Z.anisotropyMap!==void 0&&(te.anisotropyMap=K(Z.anisotropyMap)),Z.sheenColorMap!==void 0&&(te.sheenColorMap=K(Z.sheenColorMap)),Z.sheenRoughnessMap!==void 0&&(te.sheenRoughnessMap=K(Z.sheenRoughnessMap)),te}setTextures(Z){return this.textures=Z,this}static createMaterialFromType(Z){const _={ShadowMaterial,SpriteMaterial,RawShaderMaterial,ShaderMaterial,PointsMaterial,MeshPhysicalMaterial,MeshStandardMaterial,MeshPhongMaterial,MeshToonMaterial,MeshNormalMaterial,MeshLambertMaterial,MeshDepthMaterial,MeshDistanceMaterial,MeshBasicMaterial,MeshMatcapMaterial,LineDashedMaterial,LineBasicMaterial,Material};return new _[Z]}}class LoaderUtils{static decodeText(Z){if(typeof TextDecoder<"u")return new TextDecoder().decode(Z);let _="";for(let K=0,te=Z.length;K<te;K++)_+=String.fromCharCode(Z[K]);try{return decodeURIComponent(escape(_))}catch{return _}}static extractUrlBase(Z){const _=Z.lastIndexOf("/");return _===-1?"./":Z.slice(0,_+1)}static resolveURL(Z,_){return typeof Z!="string"||Z===""?"":(/^https?:\/\//i.test(_)&&/^\//.test(Z)&&(_=_.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(Z)||/^data:.*,.*$/i.test(Z)||/^blob:.*$/i.test(Z)?Z:_+Z)}}class InstancedBufferGeometry extends BufferGeometry{constructor(){super(),this.isInstancedBufferGeometry=!0,this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy(Z){return super.copy(Z),this.instanceCount=Z.instanceCount,this}toJSON(){const Z=super.toJSON();return Z.instanceCount=this.instanceCount,Z.isInstancedBufferGeometry=!0,Z}}class BufferGeometryLoader extends Loader{constructor(Z){super(Z)}load(Z,_,K,te){const ne=this,oe=new FileLoader(ne.manager);oe.setPath(ne.path),oe.setRequestHeader(ne.requestHeader),oe.setWithCredentials(ne.withCredentials),oe.load(Z,function(ie){try{_(ne.parse(JSON.parse(ie)))}catch(se){te?te(se):console.error(se),ne.manager.itemError(Z)}},K,te)}parse(Z){const _={},K={};function te(pe,fe){if(_[fe]!==void 0)return _[fe];const me=pe.interleavedBuffers[fe],ye=ne(pe,me.buffer),ve=getTypedArray(me.type,ye),Be=new InterleavedBuffer(ve,me.stride);return Be.uuid=me.uuid,_[fe]=Be,Be}function ne(pe,fe){if(K[fe]!==void 0)return K[fe];const me=pe.arrayBuffers[fe],ye=new Uint32Array(me).buffer;return K[fe]=ye,ye}const oe=Z.isInstancedBufferGeometry?new InstancedBufferGeometry:new BufferGeometry,ie=Z.data.index;if(ie!==void 0){const pe=getTypedArray(ie.type,ie.array);oe.setIndex(new BufferAttribute(pe,1))}const se=Z.data.attributes;for(const pe in se){const fe=se[pe];let be;if(fe.isInterleavedBufferAttribute){const me=te(Z.data,fe.data);be=new InterleavedBufferAttribute(me,fe.itemSize,fe.offset,fe.normalized)}else{const me=getTypedArray(fe.type,fe.array),ye=fe.isInstancedBufferAttribute?InstancedBufferAttribute:BufferAttribute;be=new ye(me,fe.itemSize,fe.normalized)}fe.name!==void 0&&(be.name=fe.name),fe.usage!==void 0&&be.setUsage(fe.usage),fe.updateRange!==void 0&&(be.updateRange.offset=fe.updateRange.offset,be.updateRange.count=fe.updateRange.count),oe.setAttribute(pe,be)}const ae=Z.data.morphAttributes;if(ae)for(const pe in ae){const fe=ae[pe],be=[];for(let me=0,ye=fe.length;me<ye;me++){const ve=fe[me];let Be;if(ve.isInterleavedBufferAttribute){const Re=te(Z.data,ve.data);Be=new InterleavedBufferAttribute(Re,ve.itemSize,ve.offset,ve.normalized)}else{const Re=getTypedArray(ve.type,ve.array);Be=new BufferAttribute(Re,ve.itemSize,ve.normalized)}ve.name!==void 0&&(Be.name=ve.name),be.push(Be)}oe.morphAttributes[pe]=be}Z.data.morphTargetsRelative&&(oe.morphTargetsRelative=!0);const ce=Z.data.groups||Z.data.drawcalls||Z.data.offsets;if(ce!==void 0)for(let pe=0,fe=ce.length;pe!==fe;++pe){const be=ce[pe];oe.addGroup(be.start,be.count,be.materialIndex)}const de=Z.data.boundingSphere;if(de!==void 0){const pe=new Vector3;de.center!==void 0&&pe.fromArray(de.center),oe.boundingSphere=new Sphere(pe,de.radius)}return Z.name&&(oe.name=Z.name),Z.userData&&(oe.userData=Z.userData),oe}}class ObjectLoader extends Loader{constructor(Z){super(Z)}load(Z,_,K,te){const ne=this,oe=this.path===""?LoaderUtils.extractUrlBase(Z):this.path;this.resourcePath=this.resourcePath||oe;const ie=new FileLoader(this.manager);ie.setPath(this.path),ie.setRequestHeader(this.requestHeader),ie.setWithCredentials(this.withCredentials),ie.load(Z,function(se){let ae=null;try{ae=JSON.parse(se)}catch(ce){te!==void 0&&te(ce),console.error("THREE:ObjectLoader: Can't parse "+Z+".",ce.message);return}const ge=ae.metadata;if(ge===void 0||ge.type===void 0||ge.type.toLowerCase()==="geometry"){te!==void 0&&te(new Error("THREE.ObjectLoader: Can't load "+Z)),console.error("THREE.ObjectLoader: Can't load "+Z);return}ne.parse(ae,_)},K,te)}async loadAsync(Z,_){const K=this,te=this.path===""?LoaderUtils.extractUrlBase(Z):this.path;this.resourcePath=this.resourcePath||te;const ne=new FileLoader(this.manager);ne.setPath(this.path),ne.setRequestHeader(this.requestHeader),ne.setWithCredentials(this.withCredentials);const oe=await ne.loadAsync(Z,_),ie=JSON.parse(oe),se=ie.metadata;if(se===void 0||se.type===void 0||se.type.toLowerCase()==="geometry")throw new Error("THREE.ObjectLoader: Can't load "+Z);return await K.parseAsync(ie)}parse(Z,_){const K=this.parseAnimations(Z.animations),te=this.parseShapes(Z.shapes),ne=this.parseGeometries(Z.geometries,te),oe=this.parseImages(Z.images,function(){_!==void 0&&_(ae)}),ie=this.parseTextures(Z.textures,oe),se=this.parseMaterials(Z.materials,ie),ae=this.parseObject(Z.object,ne,se,ie,K),ge=this.parseSkeletons(Z.skeletons,ae);if(this.bindSkeletons(ae,ge),_!==void 0){let ce=!1;for(const de in oe)if(oe[de].data instanceof HTMLImageElement){ce=!0;break}ce===!1&&_(ae)}return ae}async parseAsync(Z){const _=this.parseAnimations(Z.animations),K=this.parseShapes(Z.shapes),te=this.parseGeometries(Z.geometries,K),ne=await this.parseImagesAsync(Z.images),oe=this.parseTextures(Z.textures,ne),ie=this.parseMaterials(Z.materials,oe),se=this.parseObject(Z.object,te,ie,oe,_),ae=this.parseSkeletons(Z.skeletons,se);return this.bindSkeletons(se,ae),se}parseShapes(Z){const _={};if(Z!==void 0)for(let K=0,te=Z.length;K<te;K++){const ne=new Shape$2().fromJSON(Z[K]);_[ne.uuid]=ne}return _}parseSkeletons(Z,_){const K={},te={};if(_.traverse(function(ne){ne.isBone&&(te[ne.uuid]=ne)}),Z!==void 0)for(let ne=0,oe=Z.length;ne<oe;ne++){const ie=new Skeleton().fromJSON(Z[ne],te);K[ie.uuid]=ie}return K}parseGeometries(Z,_){const K={};if(Z!==void 0){const te=new BufferGeometryLoader;for(let ne=0,oe=Z.length;ne<oe;ne++){let ie;const se=Z[ne];switch(se.type){case"BufferGeometry":case"InstancedBufferGeometry":ie=te.parse(se);break;default:se.type in Geometries?ie=Geometries[se.type].fromJSON(se,_):console.warn(`THREE.ObjectLoader: Unsupported geometry type "${se.type}"`)}ie.uuid=se.uuid,se.name!==void 0&&(ie.name=se.name),se.userData!==void 0&&(ie.userData=se.userData),K[se.uuid]=ie}}return K}parseMaterials(Z,_){const K={},te={};if(Z!==void 0){const ne=new MaterialLoader;ne.setTextures(_);for(let oe=0,ie=Z.length;oe<ie;oe++){const se=Z[oe];K[se.uuid]===void 0&&(K[se.uuid]=ne.parse(se)),te[se.uuid]=K[se.uuid]}}return te}parseAnimations(Z){const _={};if(Z!==void 0)for(let K=0;K<Z.length;K++){const te=Z[K],ne=AnimationClip.parse(te);_[ne.uuid]=ne}return _}parseImages(Z,_){const K=this,te={};let ne;function oe(se){return K.manager.itemStart(se),ne.load(se,function(){K.manager.itemEnd(se)},void 0,function(){K.manager.itemError(se),K.manager.itemEnd(se)})}function ie(se){if(typeof se=="string"){const ae=se,ge=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(ae)?ae:K.resourcePath+ae;return oe(ge)}else return se.data?{data:getTypedArray(se.type,se.data),width:se.width,height:se.height}:null}if(Z!==void 0&&Z.length>0){const se=new LoadingManager(_);ne=new ImageLoader(se),ne.setCrossOrigin(this.crossOrigin);for(let ae=0,ge=Z.length;ae<ge;ae++){const ce=Z[ae],de=ce.url;if(Array.isArray(de)){const pe=[];for(let fe=0,be=de.length;fe<be;fe++){const me=de[fe],ye=ie(me);ye!==null&&(ye instanceof HTMLImageElement?pe.push(ye):pe.push(new DataTexture(ye.data,ye.width,ye.height)))}te[ce.uuid]=new Source(pe)}else{const pe=ie(ce.url);te[ce.uuid]=new Source(pe)}}}return te}async parseImagesAsync(Z){const _=this,K={};let te;async function ne(oe){if(typeof oe=="string"){const ie=oe,se=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(ie)?ie:_.resourcePath+ie;return await te.loadAsync(se)}else return oe.data?{data:getTypedArray(oe.type,oe.data),width:oe.width,height:oe.height}:null}if(Z!==void 0&&Z.length>0){te=new ImageLoader(this.manager),te.setCrossOrigin(this.crossOrigin);for(let oe=0,ie=Z.length;oe<ie;oe++){const se=Z[oe],ae=se.url;if(Array.isArray(ae)){const ge=[];for(let ce=0,de=ae.length;ce<de;ce++){const pe=ae[ce],fe=await ne(pe);fe!==null&&(fe instanceof HTMLImageElement?ge.push(fe):ge.push(new DataTexture(fe.data,fe.width,fe.height)))}K[se.uuid]=new Source(ge)}else{const ge=await ne(se.url);K[se.uuid]=new Source(ge)}}}return K}parseTextures(Z,_){function K(ne,oe){return typeof ne=="number"?ne:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",ne),oe[ne])}const te={};if(Z!==void 0)for(let ne=0,oe=Z.length;ne<oe;ne++){const ie=Z[ne];ie.image===void 0&&console.warn('THREE.ObjectLoader: No "image" specified for',ie.uuid),_[ie.image]===void 0&&console.warn("THREE.ObjectLoader: Undefined image",ie.image);const se=_[ie.image],ae=se.data;let ge;Array.isArray(ae)?(ge=new CubeTexture,ae.length===6&&(ge.needsUpdate=!0)):(ae&&ae.data?ge=new DataTexture:ge=new Texture,ae&&(ge.needsUpdate=!0)),ge.source=se,ge.uuid=ie.uuid,ie.name!==void 0&&(ge.name=ie.name),ie.mapping!==void 0&&(ge.mapping=K(ie.mapping,TEXTURE_MAPPING)),ie.channel!==void 0&&(ge.channel=ie.channel),ie.offset!==void 0&&ge.offset.fromArray(ie.offset),ie.repeat!==void 0&&ge.repeat.fromArray(ie.repeat),ie.center!==void 0&&ge.center.fromArray(ie.center),ie.rotation!==void 0&&(ge.rotation=ie.rotation),ie.wrap!==void 0&&(ge.wrapS=K(ie.wrap[0],TEXTURE_WRAPPING),ge.wrapT=K(ie.wrap[1],TEXTURE_WRAPPING)),ie.format!==void 0&&(ge.format=ie.format),ie.internalFormat!==void 0&&(ge.internalFormat=ie.internalFormat),ie.type!==void 0&&(ge.type=ie.type),ie.colorSpace!==void 0&&(ge.colorSpace=ie.colorSpace),ie.encoding!==void 0&&(ge.encoding=ie.encoding),ie.minFilter!==void 0&&(ge.minFilter=K(ie.minFilter,TEXTURE_FILTER)),ie.magFilter!==void 0&&(ge.magFilter=K(ie.magFilter,TEXTURE_FILTER)),ie.anisotropy!==void 0&&(ge.anisotropy=ie.anisotropy),ie.flipY!==void 0&&(ge.flipY=ie.flipY),ie.generateMipmaps!==void 0&&(ge.generateMipmaps=ie.generateMipmaps),ie.premultiplyAlpha!==void 0&&(ge.premultiplyAlpha=ie.premultiplyAlpha),ie.unpackAlignment!==void 0&&(ge.unpackAlignment=ie.unpackAlignment),ie.compareFunction!==void 0&&(ge.compareFunction=ie.compareFunction),ie.userData!==void 0&&(ge.userData=ie.userData),te[ie.uuid]=ge}return te}parseObject(Z,_,K,te,ne){let oe;function ie(de){return _[de]===void 0&&console.warn("THREE.ObjectLoader: Undefined geometry",de),_[de]}function se(de){if(de!==void 0){if(Array.isArray(de)){const pe=[];for(let fe=0,be=de.length;fe<be;fe++){const me=de[fe];K[me]===void 0&&console.warn("THREE.ObjectLoader: Undefined material",me),pe.push(K[me])}return pe}return K[de]===void 0&&console.warn("THREE.ObjectLoader: Undefined material",de),K[de]}}function ae(de){return te[de]===void 0&&console.warn("THREE.ObjectLoader: Undefined texture",de),te[de]}let ge,ce;switch(Z.type){case"Scene":oe=new Scene$1,Z.background!==void 0&&(Number.isInteger(Z.background)?oe.background=new Color$1(Z.background):oe.background=ae(Z.background)),Z.environment!==void 0&&(oe.environment=ae(Z.environment)),Z.fog!==void 0&&(Z.fog.type==="Fog"?oe.fog=new Fog(Z.fog.color,Z.fog.near,Z.fog.far):Z.fog.type==="FogExp2"&&(oe.fog=new FogExp2(Z.fog.color,Z.fog.density))),Z.backgroundBlurriness!==void 0&&(oe.backgroundBlurriness=Z.backgroundBlurriness),Z.backgroundIntensity!==void 0&&(oe.backgroundIntensity=Z.backgroundIntensity);break;case"PerspectiveCamera":oe=new PerspectiveCamera(Z.fov,Z.aspect,Z.near,Z.far),Z.focus!==void 0&&(oe.focus=Z.focus),Z.zoom!==void 0&&(oe.zoom=Z.zoom),Z.filmGauge!==void 0&&(oe.filmGauge=Z.filmGauge),Z.filmOffset!==void 0&&(oe.filmOffset=Z.filmOffset),Z.view!==void 0&&(oe.view=Object.assign({},Z.view));break;case"OrthographicCamera":oe=new OrthographicCamera(Z.left,Z.right,Z.top,Z.bottom,Z.near,Z.far),Z.zoom!==void 0&&(oe.zoom=Z.zoom),Z.view!==void 0&&(oe.view=Object.assign({},Z.view));break;case"AmbientLight":oe=new AmbientLight(Z.color,Z.intensity);break;case"DirectionalLight":oe=new DirectionalLight(Z.color,Z.intensity);break;case"PointLight":oe=new PointLight(Z.color,Z.intensity,Z.distance,Z.decay);break;case"RectAreaLight":oe=new RectAreaLight(Z.color,Z.intensity,Z.width,Z.height);break;case"SpotLight":oe=new SpotLight(Z.color,Z.intensity,Z.distance,Z.angle,Z.penumbra,Z.decay);break;case"HemisphereLight":oe=new HemisphereLight(Z.color,Z.groundColor,Z.intensity);break;case"LightProbe":oe=new LightProbe().fromJSON(Z);break;case"SkinnedMesh":ge=ie(Z.geometry),ce=se(Z.material),oe=new SkinnedMesh(ge,ce),Z.bindMode!==void 0&&(oe.bindMode=Z.bindMode),Z.bindMatrix!==void 0&&oe.bindMatrix.fromArray(Z.bindMatrix),Z.skeleton!==void 0&&(oe.skeleton=Z.skeleton);break;case"Mesh":ge=ie(Z.geometry),ce=se(Z.material),oe=new Mesh(ge,ce);break;case"InstancedMesh":ge=ie(Z.geometry),ce=se(Z.material);const de=Z.count,pe=Z.instanceMatrix,fe=Z.instanceColor;oe=new InstancedMesh(ge,ce,de),oe.instanceMatrix=new InstancedBufferAttribute(new Float32Array(pe.array),16),fe!==void 0&&(oe.instanceColor=new InstancedBufferAttribute(new Float32Array(fe.array),fe.itemSize));break;case"LOD":oe=new LOD;break;case"Line":oe=new Line(ie(Z.geometry),se(Z.material));break;case"LineLoop":oe=new LineLoop(ie(Z.geometry),se(Z.material));break;case"LineSegments":oe=new LineSegments(ie(Z.geometry),se(Z.material));break;case"PointCloud":case"Points":oe=new Points(ie(Z.geometry),se(Z.material));break;case"Sprite":oe=new Sprite(se(Z.material));break;case"Group":oe=new Group;break;case"Bone":oe=new Bone;break;default:oe=new Object3D}if(oe.uuid=Z.uuid,Z.name!==void 0&&(oe.name=Z.name),Z.matrix!==void 0?(oe.matrix.fromArray(Z.matrix),Z.matrixAutoUpdate!==void 0&&(oe.matrixAutoUpdate=Z.matrixAutoUpdate),oe.matrixAutoUpdate&&oe.matrix.decompose(oe.position,oe.quaternion,oe.scale)):(Z.position!==void 0&&oe.position.fromArray(Z.position),Z.rotation!==void 0&&oe.rotation.fromArray(Z.rotation),Z.quaternion!==void 0&&oe.quaternion.fromArray(Z.quaternion),Z.scale!==void 0&&oe.scale.fromArray(Z.scale)),Z.up!==void 0&&oe.up.fromArray(Z.up),Z.castShadow!==void 0&&(oe.castShadow=Z.castShadow),Z.receiveShadow!==void 0&&(oe.receiveShadow=Z.receiveShadow),Z.shadow&&(Z.shadow.bias!==void 0&&(oe.shadow.bias=Z.shadow.bias),Z.shadow.normalBias!==void 0&&(oe.shadow.normalBias=Z.shadow.normalBias),Z.shadow.radius!==void 0&&(oe.shadow.radius=Z.shadow.radius),Z.shadow.mapSize!==void 0&&oe.shadow.mapSize.fromArray(Z.shadow.mapSize),Z.shadow.camera!==void 0&&(oe.shadow.camera=this.parseObject(Z.shadow.camera))),Z.visible!==void 0&&(oe.visible=Z.visible),Z.frustumCulled!==void 0&&(oe.frustumCulled=Z.frustumCulled),Z.renderOrder!==void 0&&(oe.renderOrder=Z.renderOrder),Z.userData!==void 0&&(oe.userData=Z.userData),Z.layers!==void 0&&(oe.layers.mask=Z.layers),Z.children!==void 0){const de=Z.children;for(let pe=0;pe<de.length;pe++)oe.add(this.parseObject(de[pe],_,K,te,ne))}if(Z.animations!==void 0){const de=Z.animations;for(let pe=0;pe<de.length;pe++){const fe=de[pe];oe.animations.push(ne[fe])}}if(Z.type==="LOD"){Z.autoUpdate!==void 0&&(oe.autoUpdate=Z.autoUpdate);const de=Z.levels;for(let pe=0;pe<de.length;pe++){const fe=de[pe],be=oe.getObjectByProperty("uuid",fe.object);be!==void 0&&oe.addLevel(be,fe.distance,fe.hysteresis)}}return oe}bindSkeletons(Z,_){Object.keys(_).length!==0&&Z.traverse(function(K){if(K.isSkinnedMesh===!0&&K.skeleton!==void 0){const te=_[K.skeleton];te===void 0?console.warn("THREE.ObjectLoader: No skeleton found with UUID:",K.skeleton):K.bind(te,K.bindMatrix)}})}}const TEXTURE_MAPPING={UVMapping,CubeReflectionMapping,CubeRefractionMapping,EquirectangularReflectionMapping,EquirectangularRefractionMapping,CubeUVReflectionMapping},TEXTURE_WRAPPING={RepeatWrapping,ClampToEdgeWrapping,MirroredRepeatWrapping},TEXTURE_FILTER={NearestFilter,NearestMipmapNearestFilter,NearestMipmapLinearFilter,LinearFilter,LinearMipmapNearestFilter,LinearMipmapLinearFilter};class ImageBitmapLoader extends Loader{constructor(Z){super(Z),this.isImageBitmapLoader=!0,typeof createImageBitmap>"u"&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),typeof fetch>"u"&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"}}setOptions(Z){return this.options=Z,this}load(Z,_,K,te){Z===void 0&&(Z=""),this.path!==void 0&&(Z=this.path+Z),Z=this.manager.resolveURL(Z);const ne=this,oe=Cache.get(Z);if(oe!==void 0)return ne.manager.itemStart(Z),setTimeout(function(){_&&_(oe),ne.manager.itemEnd(Z)},0),oe;const ie={};ie.credentials=this.crossOrigin==="anonymous"?"same-origin":"include",ie.headers=this.requestHeader,fetch(Z,ie).then(function(se){return se.blob()}).then(function(se){return createImageBitmap(se,Object.assign(ne.options,{colorSpaceConversion:"none"}))}).then(function(se){Cache.add(Z,se),_&&_(se),ne.manager.itemEnd(Z)}).catch(function(se){te&&te(se),ne.manager.itemError(Z),ne.manager.itemEnd(Z)}),ne.manager.itemStart(Z)}}let _context,AudioContext$1=class{static getContext(){return _context===void 0&&(_context=new(window.AudioContext||window.webkitAudioContext)),_context}static setContext(Z){_context=Z}};class AudioLoader extends Loader{constructor(Z){super(Z)}load(Z,_,K,te){const ne=this,oe=new FileLoader(this.manager);oe.setResponseType("arraybuffer"),oe.setPath(this.path),oe.setRequestHeader(this.requestHeader),oe.setWithCredentials(this.withCredentials),oe.load(Z,function(se){try{const ae=se.slice(0);AudioContext$1.getContext().decodeAudioData(ae,function(ce){_(ce)},ie)}catch(ae){ie(ae)}},K,te);function ie(se){te?te(se):console.error(se),ne.manager.itemError(Z)}}}class HemisphereLightProbe extends LightProbe{constructor(Z,_,K=1){super(void 0,K),this.isHemisphereLightProbe=!0;const te=new Color$1().set(Z),ne=new Color$1().set(_),oe=new Vector3(te.r,te.g,te.b),ie=new Vector3(ne.r,ne.g,ne.b),se=Math.sqrt(Math.PI),ae=se*Math.sqrt(.75);this.sh.coefficients[0].copy(oe).add(ie).multiplyScalar(se),this.sh.coefficients[1].copy(oe).sub(ie).multiplyScalar(ae)}}class AmbientLightProbe extends LightProbe{constructor(Z,_=1){super(void 0,_),this.isAmbientLightProbe=!0;const K=new Color$1().set(Z);this.sh.coefficients[0].set(K.r,K.g,K.b).multiplyScalar(2*Math.sqrt(Math.PI))}}const _eyeRight=new Matrix4,_eyeLeft=new Matrix4,_projectionMatrix=new Matrix4;class StereoCamera{constructor(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new PerspectiveCamera,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new PerspectiveCamera,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}update(Z){const _=this._cache;if(_.focus!==Z.focus||_.fov!==Z.fov||_.aspect!==Z.aspect*this.aspect||_.near!==Z.near||_.far!==Z.far||_.zoom!==Z.zoom||_.eyeSep!==this.eyeSep){_.focus=Z.focus,_.fov=Z.fov,_.aspect=Z.aspect*this.aspect,_.near=Z.near,_.far=Z.far,_.zoom=Z.zoom,_.eyeSep=this.eyeSep,_projectionMatrix.copy(Z.projectionMatrix);const te=_.eyeSep/2,ne=te*_.near/_.focus,oe=_.near*Math.tan(DEG2RAD*_.fov*.5)/_.zoom;let ie,se;_eyeLeft.elements[12]=-te,_eyeRight.elements[12]=te,ie=-oe*_.aspect+ne,se=oe*_.aspect+ne,_projectionMatrix.elements[0]=2*_.near/(se-ie),_projectionMatrix.elements[8]=(se+ie)/(se-ie),this.cameraL.projectionMatrix.copy(_projectionMatrix),ie=-oe*_.aspect-ne,se=oe*_.aspect-ne,_projectionMatrix.elements[0]=2*_.near/(se-ie),_projectionMatrix.elements[8]=(se+ie)/(se-ie),this.cameraR.projectionMatrix.copy(_projectionMatrix)}this.cameraL.matrixWorld.copy(Z.matrixWorld).multiply(_eyeLeft),this.cameraR.matrixWorld.copy(Z.matrixWorld).multiply(_eyeRight)}}class Clock{constructor(Z=!0){this.autoStart=Z,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=now$2(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let Z=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const _=now$2();Z=(_-this.oldTime)/1e3,this.oldTime=_,this.elapsedTime+=Z}return Z}}function now$2(){return(typeof performance>"u"?Date:performance).now()}const _position$1=new Vector3,_quaternion$1=new Quaternion$2,_scale$1=new Vector3,_orientation$1=new Vector3;class AudioListener extends Object3D{constructor(){super(),this.type="AudioListener",this.context=AudioContext$1.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null,this.timeDelta=0,this._clock=new Clock}getInput(){return this.gain}removeFilter(){return this.filter!==null&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this}getFilter(){return this.filter}setFilter(Z){return this.filter!==null?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=Z,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this}getMasterVolume(){return this.gain.gain.value}setMasterVolume(Z){return this.gain.gain.setTargetAtTime(Z,this.context.currentTime,.01),this}updateMatrixWorld(Z){super.updateMatrixWorld(Z);const _=this.context.listener,K=this.up;if(this.timeDelta=this._clock.getDelta(),this.matrixWorld.decompose(_position$1,_quaternion$1,_scale$1),_orientation$1.set(0,0,-1).applyQuaternion(_quaternion$1),_.positionX){const te=this.context.currentTime+this.timeDelta;_.positionX.linearRampToValueAtTime(_position$1.x,te),_.positionY.linearRampToValueAtTime(_position$1.y,te),_.positionZ.linearRampToValueAtTime(_position$1.z,te),_.forwardX.linearRampToValueAtTime(_orientation$1.x,te),_.forwardY.linearRampToValueAtTime(_orientation$1.y,te),_.forwardZ.linearRampToValueAtTime(_orientation$1.z,te),_.upX.linearRampToValueAtTime(K.x,te),_.upY.linearRampToValueAtTime(K.y,te),_.upZ.linearRampToValueAtTime(K.z,te)}else _.setPosition(_position$1.x,_position$1.y,_position$1.z),_.setOrientation(_orientation$1.x,_orientation$1.y,_orientation$1.z,K.x,K.y,K.z)}}class Audio extends Object3D{constructor(Z){super(),this.type="Audio",this.listener=Z,this.context=Z.context,this.gain=this.context.createGain(),this.gain.connect(Z.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.source=null,this.sourceType="empty",this._startedAt=0,this._progress=0,this._connected=!1,this.filters=[]}getOutput(){return this.gain}setNodeSource(Z){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=Z,this.connect(),this}setMediaElementSource(Z){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(Z),this.connect(),this}setMediaStreamSource(Z){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(Z),this.connect(),this}setBuffer(Z){return this.buffer=Z,this.sourceType="buffer",this.autoplay&&this.play(),this}play(Z=0){if(this.isPlaying===!0){console.warn("THREE.Audio: Audio is already playing.");return}if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}this._startedAt=this.context.currentTime+Z;const _=this.context.createBufferSource();return _.buffer=this.buffer,_.loop=this.loop,_.loopStart=this.loopStart,_.loopEnd=this.loopEnd,_.onended=this.onEnded.bind(this),_.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=_,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}pause(){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.isPlaying===!0&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,this.loop===!0&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this}stop(){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this._progress=0,this.source!==null&&(this.source.stop(),this.source.onended=null),this.isPlaying=!1,this}connect(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(let Z=1,_=this.filters.length;Z<_;Z++)this.filters[Z-1].connect(this.filters[Z]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this}disconnect(){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(let Z=1,_=this.filters.length;Z<_;Z++)this.filters[Z-1].disconnect(this.filters[Z]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this}getFilters(){return this.filters}setFilters(Z){return Z||(Z=[]),this._connected===!0?(this.disconnect(),this.filters=Z.slice(),this.connect()):this.filters=Z.slice(),this}setDetune(Z){if(this.detune=Z,this.source.detune!==void 0)return this.isPlaying===!0&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this}getDetune(){return this.detune}getFilter(){return this.getFilters()[0]}setFilter(Z){return this.setFilters(Z?[Z]:[])}setPlaybackRate(Z){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.playbackRate=Z,this.isPlaying===!0&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this}getPlaybackRate(){return this.playbackRate}onEnded(){this.isPlaying=!1}getLoop(){return this.hasPlaybackControl===!1?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop}setLoop(Z){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.loop=Z,this.isPlaying===!0&&(this.source.loop=this.loop),this}setLoopStart(Z){return this.loopStart=Z,this}setLoopEnd(Z){return this.loopEnd=Z,this}getVolume(){return this.gain.gain.value}setVolume(Z){return this.gain.gain.setTargetAtTime(Z,this.context.currentTime,.01),this}}const _position=new Vector3,_quaternion=new Quaternion$2,_scale=new Vector3,_orientation=new Vector3;class PositionalAudio extends Audio{constructor(Z){super(Z),this.panner=this.context.createPanner(),this.panner.panningModel="HRTF",this.panner.connect(this.gain)}connect(){super.connect(),this.panner.connect(this.gain)}disconnect(){super.disconnect(),this.panner.disconnect(this.gain)}getOutput(){return this.panner}getRefDistance(){return this.panner.refDistance}setRefDistance(Z){return this.panner.refDistance=Z,this}getRolloffFactor(){return this.panner.rolloffFactor}setRolloffFactor(Z){return this.panner.rolloffFactor=Z,this}getDistanceModel(){return this.panner.distanceModel}setDistanceModel(Z){return this.panner.distanceModel=Z,this}getMaxDistance(){return this.panner.maxDistance}setMaxDistance(Z){return this.panner.maxDistance=Z,this}setDirectionalCone(Z,_,K){return this.panner.coneInnerAngle=Z,this.panner.coneOuterAngle=_,this.panner.coneOuterGain=K,this}updateMatrixWorld(Z){if(super.updateMatrixWorld(Z),this.hasPlaybackControl===!0&&this.isPlaying===!1)return;this.matrixWorld.decompose(_position,_quaternion,_scale),_orientation.set(0,0,1).applyQuaternion(_quaternion);const _=this.panner;if(_.positionX){const K=this.context.currentTime+this.listener.timeDelta;_.positionX.linearRampToValueAtTime(_position.x,K),_.positionY.linearRampToValueAtTime(_position.y,K),_.positionZ.linearRampToValueAtTime(_position.z,K),_.orientationX.linearRampToValueAtTime(_orientation.x,K),_.orientationY.linearRampToValueAtTime(_orientation.y,K),_.orientationZ.linearRampToValueAtTime(_orientation.z,K)}else _.setPosition(_position.x,_position.y,_position.z),_.setOrientation(_orientation.x,_orientation.y,_orientation.z)}}class AudioAnalyser{constructor(Z,_=2048){this.analyser=Z.context.createAnalyser(),this.analyser.fftSize=_,this.data=new Uint8Array(this.analyser.frequencyBinCount),Z.getOutput().connect(this.analyser)}getFrequencyData(){return this.analyser.getByteFrequencyData(this.data),this.data}getAverageFrequency(){let Z=0;const _=this.getFrequencyData();for(let K=0;K<_.length;K++)Z+=_[K];return Z/_.length}}class PropertyMixer{constructor(Z,_,K){this.binding=Z,this.valueSize=K;let te,ne,oe;switch(_){case"quaternion":te=this._slerp,ne=this._slerpAdditive,oe=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(K*6),this._workIndex=5;break;case"string":case"bool":te=this._select,ne=this._select,oe=this._setAdditiveIdentityOther,this.buffer=new Array(K*5);break;default:te=this._lerp,ne=this._lerpAdditive,oe=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(K*5)}this._mixBufferRegion=te,this._mixBufferRegionAdditive=ne,this._setIdentity=oe,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(Z,_){const K=this.buffer,te=this.valueSize,ne=Z*te+te;let oe=this.cumulativeWeight;if(oe===0){for(let ie=0;ie!==te;++ie)K[ne+ie]=K[ie];oe=_}else{oe+=_;const ie=_/oe;this._mixBufferRegion(K,ne,0,ie,te)}this.cumulativeWeight=oe}accumulateAdditive(Z){const _=this.buffer,K=this.valueSize,te=K*this._addIndex;this.cumulativeWeightAdditive===0&&this._setIdentity(),this._mixBufferRegionAdditive(_,te,0,Z,K),this.cumulativeWeightAdditive+=Z}apply(Z){const _=this.valueSize,K=this.buffer,te=Z*_+_,ne=this.cumulativeWeight,oe=this.cumulativeWeightAdditive,ie=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,ne<1){const se=_*this._origIndex;this._mixBufferRegion(K,te,se,1-ne,_)}oe>0&&this._mixBufferRegionAdditive(K,te,this._addIndex*_,1,_);for(let se=_,ae=_+_;se!==ae;++se)if(K[se]!==K[se+_]){ie.setValue(K,te);break}}saveOriginalState(){const Z=this.binding,_=this.buffer,K=this.valueSize,te=K*this._origIndex;Z.getValue(_,te);for(let ne=K,oe=te;ne!==oe;++ne)_[ne]=_[te+ne%K];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){const Z=this.valueSize*3;this.binding.setValue(this.buffer,Z)}_setAdditiveIdentityNumeric(){const Z=this._addIndex*this.valueSize,_=Z+this.valueSize;for(let K=Z;K<_;K++)this.buffer[K]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){const Z=this._origIndex*this.valueSize,_=this._addIndex*this.valueSize;for(let K=0;K<this.valueSize;K++)this.buffer[_+K]=this.buffer[Z+K]}_select(Z,_,K,te,ne){if(te>=.5)for(let oe=0;oe!==ne;++oe)Z[_+oe]=Z[K+oe]}_slerp(Z,_,K,te){Quaternion$2.slerpFlat(Z,_,Z,_,Z,K,te)}_slerpAdditive(Z,_,K,te,ne){const oe=this._workIndex*ne;Quaternion$2.multiplyQuaternionsFlat(Z,oe,Z,_,Z,K),Quaternion$2.slerpFlat(Z,_,Z,_,Z,oe,te)}_lerp(Z,_,K,te,ne){const oe=1-te;for(let ie=0;ie!==ne;++ie){const se=_+ie;Z[se]=Z[se]*oe+Z[K+ie]*te}}_lerpAdditive(Z,_,K,te,ne){for(let oe=0;oe!==ne;++oe){const ie=_+oe;Z[ie]=Z[ie]+Z[K+oe]*te}}}const _RESERVED_CHARS_RE="\\[\\]\\.:\\/",_reservedRe=new RegExp("["+_RESERVED_CHARS_RE+"]","g"),_wordChar="[^"+_RESERVED_CHARS_RE+"]",_wordCharOrDot="[^"+_RESERVED_CHARS_RE.replace("\\.","")+"]",_directoryRe=/((?:WC+[\/:])*)/.source.replace("WC",_wordChar),_nodeRe=/(WCOD+)?/.source.replace("WCOD",_wordCharOrDot),_objectRe=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",_wordChar),_propertyRe=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",_wordChar),_trackRe=new RegExp("^"+_directoryRe+_nodeRe+_objectRe+_propertyRe+"$"),_supportedObjectNames=["material","materials","bones","map"];class Composite{constructor(Z,_,K){const te=K||PropertyBinding.parseTrackName(_);this._targetGroup=Z,this._bindings=Z.subscribe_(_,te)}getValue(Z,_){this.bind();const K=this._targetGroup.nCachedObjects_,te=this._bindings[K];te!==void 0&&te.getValue(Z,_)}setValue(Z,_){const K=this._bindings;for(let te=this._targetGroup.nCachedObjects_,ne=K.length;te!==ne;++te)K[te].setValue(Z,_)}bind(){const Z=this._bindings;for(let _=this._targetGroup.nCachedObjects_,K=Z.length;_!==K;++_)Z[_].bind()}unbind(){const Z=this._bindings;for(let _=this._targetGroup.nCachedObjects_,K=Z.length;_!==K;++_)Z[_].unbind()}}class PropertyBinding{constructor(Z,_,K){this.path=_,this.parsedPath=K||PropertyBinding.parseTrackName(_),this.node=PropertyBinding.findNode(Z,this.parsedPath.nodeName),this.rootNode=Z,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(Z,_,K){return Z&&Z.isAnimationObjectGroup?new PropertyBinding.Composite(Z,_,K):new PropertyBinding(Z,_,K)}static sanitizeNodeName(Z){return Z.replace(/\s/g,"_").replace(_reservedRe,"")}static parseTrackName(Z){const _=_trackRe.exec(Z);if(_===null)throw new Error("PropertyBinding: Cannot parse trackName: "+Z);const K={nodeName:_[2],objectName:_[3],objectIndex:_[4],propertyName:_[5],propertyIndex:_[6]},te=K.nodeName&&K.nodeName.lastIndexOf(".");if(te!==void 0&&te!==-1){const ne=K.nodeName.substring(te+1);_supportedObjectNames.indexOf(ne)!==-1&&(K.nodeName=K.nodeName.substring(0,te),K.objectName=ne)}if(K.propertyName===null||K.propertyName.length===0)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+Z);return K}static findNode(Z,_){if(_===void 0||_===""||_==="."||_===-1||_===Z.name||_===Z.uuid)return Z;if(Z.skeleton){const K=Z.skeleton.getBoneByName(_);if(K!==void 0)return K}if(Z.children){const K=function(ne){for(let oe=0;oe<ne.length;oe++){const ie=ne[oe];if(ie.name===_||ie.uuid===_)return ie;const se=K(ie.children);if(se)return se}return null},te=K(Z.children);if(te)return te}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(Z,_){Z[_]=this.targetObject[this.propertyName]}_getValue_array(Z,_){const K=this.resolvedProperty;for(let te=0,ne=K.length;te!==ne;++te)Z[_++]=K[te]}_getValue_arrayElement(Z,_){Z[_]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(Z,_){this.resolvedProperty.toArray(Z,_)}_setValue_direct(Z,_){this.targetObject[this.propertyName]=Z[_]}_setValue_direct_setNeedsUpdate(Z,_){this.targetObject[this.propertyName]=Z[_],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(Z,_){this.targetObject[this.propertyName]=Z[_],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(Z,_){const K=this.resolvedProperty;for(let te=0,ne=K.length;te!==ne;++te)K[te]=Z[_++]}_setValue_array_setNeedsUpdate(Z,_){const K=this.resolvedProperty;for(let te=0,ne=K.length;te!==ne;++te)K[te]=Z[_++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(Z,_){const K=this.resolvedProperty;for(let te=0,ne=K.length;te!==ne;++te)K[te]=Z[_++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(Z,_){this.resolvedProperty[this.propertyIndex]=Z[_]}_setValue_arrayElement_setNeedsUpdate(Z,_){this.resolvedProperty[this.propertyIndex]=Z[_],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(Z,_){this.resolvedProperty[this.propertyIndex]=Z[_],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(Z,_){this.resolvedProperty.fromArray(Z,_)}_setValue_fromArray_setNeedsUpdate(Z,_){this.resolvedProperty.fromArray(Z,_),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(Z,_){this.resolvedProperty.fromArray(Z,_),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(Z,_){this.bind(),this.getValue(Z,_)}_setValue_unbound(Z,_){this.bind(),this.setValue(Z,_)}bind(){let Z=this.node;const _=this.parsedPath,K=_.objectName,te=_.propertyName;let ne=_.propertyIndex;if(Z||(Z=PropertyBinding.findNode(this.rootNode,_.nodeName),this.node=Z),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!Z){console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.");return}if(K){let ae=_.objectIndex;switch(K){case"materials":if(!Z.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!Z.material.materials){console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);return}Z=Z.material.materials;break;case"bones":if(!Z.skeleton){console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);return}Z=Z.skeleton.bones;for(let ge=0;ge<Z.length;ge++)if(Z[ge].name===ae){ae=ge;break}break;case"map":if("map"in Z){Z=Z.map;break}if(!Z.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!Z.material.map){console.error("THREE.PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);return}Z=Z.material.map;break;default:if(Z[K]===void 0){console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);return}Z=Z[K]}if(ae!==void 0){if(Z[ae]===void 0){console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,Z);return}Z=Z[ae]}}const oe=Z[te];if(oe===void 0){const ae=_.nodeName;console.error("THREE.PropertyBinding: Trying to update property for track: "+ae+"."+te+" but it wasn't found.",Z);return}let ie=this.Versioning.None;this.targetObject=Z,Z.needsUpdate!==void 0?ie=this.Versioning.NeedsUpdate:Z.matrixWorldNeedsUpdate!==void 0&&(ie=this.Versioning.MatrixWorldNeedsUpdate);let se=this.BindingType.Direct;if(ne!==void 0){if(te==="morphTargetInfluences"){if(!Z.geometry){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);return}if(!Z.geometry.morphAttributes){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);return}Z.morphTargetDictionary[ne]!==void 0&&(ne=Z.morphTargetDictionary[ne])}se=this.BindingType.ArrayElement,this.resolvedProperty=oe,this.propertyIndex=ne}else oe.fromArray!==void 0&&oe.toArray!==void 0?(se=this.BindingType.HasFromToArray,this.resolvedProperty=oe):Array.isArray(oe)?(se=this.BindingType.EntireArray,this.resolvedProperty=oe):this.propertyName=te;this.getValue=this.GetterByBindingType[se],this.setValue=this.SetterByBindingTypeAndVersioning[se][ie]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}PropertyBinding.Composite=Composite;PropertyBinding.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3};PropertyBinding.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2};PropertyBinding.prototype.GetterByBindingType=[PropertyBinding.prototype._getValue_direct,PropertyBinding.prototype._getValue_array,PropertyBinding.prototype._getValue_arrayElement,PropertyBinding.prototype._getValue_toArray];PropertyBinding.prototype.SetterByBindingTypeAndVersioning=[[PropertyBinding.prototype._setValue_direct,PropertyBinding.prototype._setValue_direct_setNeedsUpdate,PropertyBinding.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[PropertyBinding.prototype._setValue_array,PropertyBinding.prototype._setValue_array_setNeedsUpdate,PropertyBinding.prototype._setValue_array_setMatrixWorldNeedsUpdate],[PropertyBinding.prototype._setValue_arrayElement,PropertyBinding.prototype._setValue_arrayElement_setNeedsUpdate,PropertyBinding.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[PropertyBinding.prototype._setValue_fromArray,PropertyBinding.prototype._setValue_fromArray_setNeedsUpdate,PropertyBinding.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];class AnimationObjectGroup{constructor(){this.isAnimationObjectGroup=!0,this.uuid=generateUUID$1(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;const Z={};this._indicesByUUID=Z;for(let K=0,te=arguments.length;K!==te;++K)Z[arguments[K].uuid]=K;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};const _=this;this.stats={objects:{get total(){return _._objects.length},get inUse(){return this.total-_.nCachedObjects_}},get bindingsPerObject(){return _._bindings.length}}}add(){const Z=this._objects,_=this._indicesByUUID,K=this._paths,te=this._parsedPaths,ne=this._bindings,oe=ne.length;let ie,se=Z.length,ae=this.nCachedObjects_;for(let ge=0,ce=arguments.length;ge!==ce;++ge){const de=arguments[ge],pe=de.uuid;let fe=_[pe];if(fe===void 0){fe=se++,_[pe]=fe,Z.push(de);for(let be=0,me=oe;be!==me;++be)ne[be].push(new PropertyBinding(de,K[be],te[be]))}else if(fe<ae){ie=Z[fe];const be=--ae,me=Z[be];_[me.uuid]=fe,Z[fe]=me,_[pe]=be,Z[be]=de;for(let ye=0,ve=oe;ye!==ve;++ye){const Be=ne[ye],Re=Be[be];let Ee=Be[fe];Be[fe]=Re,Ee===void 0&&(Ee=new PropertyBinding(de,K[ye],te[ye])),Be[be]=Ee}}else Z[fe]!==ie&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=ae}remove(){const Z=this._objects,_=this._indicesByUUID,K=this._bindings,te=K.length;let ne=this.nCachedObjects_;for(let oe=0,ie=arguments.length;oe!==ie;++oe){const se=arguments[oe],ae=se.uuid,ge=_[ae];if(ge!==void 0&&ge>=ne){const ce=ne++,de=Z[ce];_[de.uuid]=ge,Z[ge]=de,_[ae]=ce,Z[ce]=se;for(let pe=0,fe=te;pe!==fe;++pe){const be=K[pe],me=be[ce],ye=be[ge];be[ge]=me,be[ce]=ye}}}this.nCachedObjects_=ne}uncache(){const Z=this._objects,_=this._indicesByUUID,K=this._bindings,te=K.length;let ne=this.nCachedObjects_,oe=Z.length;for(let ie=0,se=arguments.length;ie!==se;++ie){const ae=arguments[ie],ge=ae.uuid,ce=_[ge];if(ce!==void 0)if(delete _[ge],ce<ne){const de=--ne,pe=Z[de],fe=--oe,be=Z[fe];_[pe.uuid]=ce,Z[ce]=pe,_[be.uuid]=de,Z[de]=be,Z.pop();for(let me=0,ye=te;me!==ye;++me){const ve=K[me],Be=ve[de],Re=ve[fe];ve[ce]=Be,ve[de]=Re,ve.pop()}}else{const de=--oe,pe=Z[de];de>0&&(_[pe.uuid]=ce),Z[ce]=pe,Z.pop();for(let fe=0,be=te;fe!==be;++fe){const me=K[fe];me[ce]=me[de],me.pop()}}}this.nCachedObjects_=ne}subscribe_(Z,_){const K=this._bindingsIndicesByPath;let te=K[Z];const ne=this._bindings;if(te!==void 0)return ne[te];const oe=this._paths,ie=this._parsedPaths,se=this._objects,ae=se.length,ge=this.nCachedObjects_,ce=new Array(ae);te=ne.length,K[Z]=te,oe.push(Z),ie.push(_),ne.push(ce);for(let de=ge,pe=se.length;de!==pe;++de){const fe=se[de];ce[de]=new PropertyBinding(fe,Z,_)}return ce}unsubscribe_(Z){const _=this._bindingsIndicesByPath,K=_[Z];if(K!==void 0){const te=this._paths,ne=this._parsedPaths,oe=this._bindings,ie=oe.length-1,se=oe[ie],ae=Z[ie];_[ae]=K,oe[K]=se,oe.pop(),ne[K]=ne[ie],ne.pop(),te[K]=te[ie],te.pop()}}}class AnimationAction{constructor(Z,_,K=null,te=_.blendMode){this._mixer=Z,this._clip=_,this._localRoot=K,this.blendMode=te;const ne=_.tracks,oe=ne.length,ie=new Array(oe),se={endingStart:ZeroCurvatureEnding,endingEnd:ZeroCurvatureEnding};for(let ae=0;ae!==oe;++ae){const ge=ne[ae].createInterpolant(null);ie[ae]=ge,ge.settings=se}this._interpolantSettings=se,this._interpolants=ie,this._propertyBindings=new Array(oe),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=LoopRepeat,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&this.timeScale!==0&&this._startTime===null&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(Z){return this._startTime=Z,this}setLoop(Z,_){return this.loop=Z,this.repetitions=_,this}setEffectiveWeight(Z){return this.weight=Z,this._effectiveWeight=this.enabled?Z:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(Z){return this._scheduleFading(Z,0,1)}fadeOut(Z){return this._scheduleFading(Z,1,0)}crossFadeFrom(Z,_,K){if(Z.fadeOut(_),this.fadeIn(_),K){const te=this._clip.duration,ne=Z._clip.duration,oe=ne/te,ie=te/ne;Z.warp(1,oe,_),this.warp(ie,1,_)}return this}crossFadeTo(Z,_,K){return Z.crossFadeFrom(this,_,K)}stopFading(){const Z=this._weightInterpolant;return Z!==null&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(Z)),this}setEffectiveTimeScale(Z){return this.timeScale=Z,this._effectiveTimeScale=this.paused?0:Z,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(Z){return this.timeScale=this._clip.duration/Z,this.stopWarping()}syncWith(Z){return this.time=Z.time,this.timeScale=Z.timeScale,this.stopWarping()}halt(Z){return this.warp(this._effectiveTimeScale,0,Z)}warp(Z,_,K){const te=this._mixer,ne=te.time,oe=this.timeScale;let ie=this._timeScaleInterpolant;ie===null&&(ie=te._lendControlInterpolant(),this._timeScaleInterpolant=ie);const se=ie.parameterPositions,ae=ie.sampleValues;return se[0]=ne,se[1]=ne+K,ae[0]=Z/oe,ae[1]=_/oe,this}stopWarping(){const Z=this._timeScaleInterpolant;return Z!==null&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(Z)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(Z,_,K,te){if(!this.enabled){this._updateWeight(Z);return}const ne=this._startTime;if(ne!==null){const se=(Z-ne)*K;se<0||K===0?_=0:(this._startTime=null,_=K*se)}_*=this._updateTimeScale(Z);const oe=this._updateTime(_),ie=this._updateWeight(Z);if(ie>0){const se=this._interpolants,ae=this._propertyBindings;switch(this.blendMode){case AdditiveAnimationBlendMode:for(let ge=0,ce=se.length;ge!==ce;++ge)se[ge].evaluate(oe),ae[ge].accumulateAdditive(ie);break;case NormalAnimationBlendMode:default:for(let ge=0,ce=se.length;ge!==ce;++ge)se[ge].evaluate(oe),ae[ge].accumulate(te,ie)}}}_updateWeight(Z){let _=0;if(this.enabled){_=this.weight;const K=this._weightInterpolant;if(K!==null){const te=K.evaluate(Z)[0];_*=te,Z>K.parameterPositions[1]&&(this.stopFading(),te===0&&(this.enabled=!1))}}return this._effectiveWeight=_,_}_updateTimeScale(Z){let _=0;if(!this.paused){_=this.timeScale;const K=this._timeScaleInterpolant;if(K!==null){const te=K.evaluate(Z)[0];_*=te,Z>K.parameterPositions[1]&&(this.stopWarping(),_===0?this.paused=!0:this.timeScale=_)}}return this._effectiveTimeScale=_,_}_updateTime(Z){const _=this._clip.duration,K=this.loop;let te=this.time+Z,ne=this._loopCount;const oe=K===LoopPingPong;if(Z===0)return ne===-1?te:oe&&(ne&1)===1?_-te:te;if(K===LoopOnce){ne===-1&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(te>=_)te=_;else if(te<0)te=0;else{this.time=te;break e}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=te,this._mixer.dispatchEvent({type:"finished",action:this,direction:Z<0?-1:1})}}else{if(ne===-1&&(Z>=0?(ne=0,this._setEndings(!0,this.repetitions===0,oe)):this._setEndings(this.repetitions===0,!0,oe)),te>=_||te<0){const ie=Math.floor(te/_);te-=_*ie,ne+=Math.abs(ie);const se=this.repetitions-ne;if(se<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,te=Z>0?_:0,this.time=te,this._mixer.dispatchEvent({type:"finished",action:this,direction:Z>0?1:-1});else{if(se===1){const ae=Z<0;this._setEndings(ae,!ae,oe)}else this._setEndings(!1,!1,oe);this._loopCount=ne,this.time=te,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:ie})}}else this.time=te;if(oe&&(ne&1)===1)return _-te}return te}_setEndings(Z,_,K){const te=this._interpolantSettings;K?(te.endingStart=ZeroSlopeEnding,te.endingEnd=ZeroSlopeEnding):(Z?te.endingStart=this.zeroSlopeAtStart?ZeroSlopeEnding:ZeroCurvatureEnding:te.endingStart=WrapAroundEnding,_?te.endingEnd=this.zeroSlopeAtEnd?ZeroSlopeEnding:ZeroCurvatureEnding:te.endingEnd=WrapAroundEnding)}_scheduleFading(Z,_,K){const te=this._mixer,ne=te.time;let oe=this._weightInterpolant;oe===null&&(oe=te._lendControlInterpolant(),this._weightInterpolant=oe);const ie=oe.parameterPositions,se=oe.sampleValues;return ie[0]=ne,se[0]=_,ie[1]=ne+Z,se[1]=K,this}}const _controlInterpolantsResultBuffer=new Float32Array(1);class AnimationMixer extends EventDispatcher{constructor(Z){super(),this._root=Z,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(Z,_){const K=Z._localRoot||this._root,te=Z._clip.tracks,ne=te.length,oe=Z._propertyBindings,ie=Z._interpolants,se=K.uuid,ae=this._bindingsByRootAndName;let ge=ae[se];ge===void 0&&(ge={},ae[se]=ge);for(let ce=0;ce!==ne;++ce){const de=te[ce],pe=de.name;let fe=ge[pe];if(fe!==void 0)++fe.referenceCount,oe[ce]=fe;else{if(fe=oe[ce],fe!==void 0){fe._cacheIndex===null&&(++fe.referenceCount,this._addInactiveBinding(fe,se,pe));continue}const be=_&&_._propertyBindings[ce].binding.parsedPath;fe=new PropertyMixer(PropertyBinding.create(K,pe,be),de.ValueTypeName,de.getValueSize()),++fe.referenceCount,this._addInactiveBinding(fe,se,pe),oe[ce]=fe}ie[ce].resultBuffer=fe.buffer}}_activateAction(Z){if(!this._isActiveAction(Z)){if(Z._cacheIndex===null){const K=(Z._localRoot||this._root).uuid,te=Z._clip.uuid,ne=this._actionsByClip[te];this._bindAction(Z,ne&&ne.knownActions[0]),this._addInactiveAction(Z,te,K)}const _=Z._propertyBindings;for(let K=0,te=_.length;K!==te;++K){const ne=_[K];ne.useCount++===0&&(this._lendBinding(ne),ne.saveOriginalState())}this._lendAction(Z)}}_deactivateAction(Z){if(this._isActiveAction(Z)){const _=Z._propertyBindings;for(let K=0,te=_.length;K!==te;++K){const ne=_[K];--ne.useCount===0&&(ne.restoreOriginalState(),this._takeBackBinding(ne))}this._takeBackAction(Z)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;const Z=this;this.stats={actions:{get total(){return Z._actions.length},get inUse(){return Z._nActiveActions}},bindings:{get total(){return Z._bindings.length},get inUse(){return Z._nActiveBindings}},controlInterpolants:{get total(){return Z._controlInterpolants.length},get inUse(){return Z._nActiveControlInterpolants}}}}_isActiveAction(Z){const _=Z._cacheIndex;return _!==null&&_<this._nActiveActions}_addInactiveAction(Z,_,K){const te=this._actions,ne=this._actionsByClip;let oe=ne[_];if(oe===void 0)oe={knownActions:[Z],actionByRoot:{}},Z._byClipCacheIndex=0,ne[_]=oe;else{const ie=oe.knownActions;Z._byClipCacheIndex=ie.length,ie.push(Z)}Z._cacheIndex=te.length,te.push(Z),oe.actionByRoot[K]=Z}_removeInactiveAction(Z){const _=this._actions,K=_[_.length-1],te=Z._cacheIndex;K._cacheIndex=te,_[te]=K,_.pop(),Z._cacheIndex=null;const ne=Z._clip.uuid,oe=this._actionsByClip,ie=oe[ne],se=ie.knownActions,ae=se[se.length-1],ge=Z._byClipCacheIndex;ae._byClipCacheIndex=ge,se[ge]=ae,se.pop(),Z._byClipCacheIndex=null;const ce=ie.actionByRoot,de=(Z._localRoot||this._root).uuid;delete ce[de],se.length===0&&delete oe[ne],this._removeInactiveBindingsForAction(Z)}_removeInactiveBindingsForAction(Z){const _=Z._propertyBindings;for(let K=0,te=_.length;K!==te;++K){const ne=_[K];--ne.referenceCount===0&&this._removeInactiveBinding(ne)}}_lendAction(Z){const _=this._actions,K=Z._cacheIndex,te=this._nActiveActions++,ne=_[te];Z._cacheIndex=te,_[te]=Z,ne._cacheIndex=K,_[K]=ne}_takeBackAction(Z){const _=this._actions,K=Z._cacheIndex,te=--this._nActiveActions,ne=_[te];Z._cacheIndex=te,_[te]=Z,ne._cacheIndex=K,_[K]=ne}_addInactiveBinding(Z,_,K){const te=this._bindingsByRootAndName,ne=this._bindings;let oe=te[_];oe===void 0&&(oe={},te[_]=oe),oe[K]=Z,Z._cacheIndex=ne.length,ne.push(Z)}_removeInactiveBinding(Z){const _=this._bindings,K=Z.binding,te=K.rootNode.uuid,ne=K.path,oe=this._bindingsByRootAndName,ie=oe[te],se=_[_.length-1],ae=Z._cacheIndex;se._cacheIndex=ae,_[ae]=se,_.pop(),delete ie[ne],Object.keys(ie).length===0&&delete oe[te]}_lendBinding(Z){const _=this._bindings,K=Z._cacheIndex,te=this._nActiveBindings++,ne=_[te];Z._cacheIndex=te,_[te]=Z,ne._cacheIndex=K,_[K]=ne}_takeBackBinding(Z){const _=this._bindings,K=Z._cacheIndex,te=--this._nActiveBindings,ne=_[te];Z._cacheIndex=te,_[te]=Z,ne._cacheIndex=K,_[K]=ne}_lendControlInterpolant(){const Z=this._controlInterpolants,_=this._nActiveControlInterpolants++;let K=Z[_];return K===void 0&&(K=new LinearInterpolant(new Float32Array(2),new Float32Array(2),1,_controlInterpolantsResultBuffer),K.__cacheIndex=_,Z[_]=K),K}_takeBackControlInterpolant(Z){const _=this._controlInterpolants,K=Z.__cacheIndex,te=--this._nActiveControlInterpolants,ne=_[te];Z.__cacheIndex=te,_[te]=Z,ne.__cacheIndex=K,_[K]=ne}clipAction(Z,_,K){const te=_||this._root,ne=te.uuid;let oe=typeof Z=="string"?AnimationClip.findByName(te,Z):Z;const ie=oe!==null?oe.uuid:Z,se=this._actionsByClip[ie];let ae=null;if(K===void 0&&(oe!==null?K=oe.blendMode:K=NormalAnimationBlendMode),se!==void 0){const ce=se.actionByRoot[ne];if(ce!==void 0&&ce.blendMode===K)return ce;ae=se.knownActions[0],oe===null&&(oe=ae._clip)}if(oe===null)return null;const ge=new AnimationAction(this,oe,_,K);return this._bindAction(ge,ae),this._addInactiveAction(ge,ie,ne),ge}existingAction(Z,_){const K=_||this._root,te=K.uuid,ne=typeof Z=="string"?AnimationClip.findByName(K,Z):Z,oe=ne?ne.uuid:Z,ie=this._actionsByClip[oe];return ie!==void 0&&ie.actionByRoot[te]||null}stopAllAction(){const Z=this._actions,_=this._nActiveActions;for(let K=_-1;K>=0;--K)Z[K].stop();return this}update(Z){Z*=this.timeScale;const _=this._actions,K=this._nActiveActions,te=this.time+=Z,ne=Math.sign(Z),oe=this._accuIndex^=1;for(let ae=0;ae!==K;++ae)_[ae]._update(te,Z,ne,oe);const ie=this._bindings,se=this._nActiveBindings;for(let ae=0;ae!==se;++ae)ie[ae].apply(oe);return this}setTime(Z){this.time=0;for(let _=0;_<this._actions.length;_++)this._actions[_].time=0;return this.update(Z)}getRoot(){return this._root}uncacheClip(Z){const _=this._actions,K=Z.uuid,te=this._actionsByClip,ne=te[K];if(ne!==void 0){const oe=ne.knownActions;for(let ie=0,se=oe.length;ie!==se;++ie){const ae=oe[ie];this._deactivateAction(ae);const ge=ae._cacheIndex,ce=_[_.length-1];ae._cacheIndex=null,ae._byClipCacheIndex=null,ce._cacheIndex=ge,_[ge]=ce,_.pop(),this._removeInactiveBindingsForAction(ae)}delete te[K]}}uncacheRoot(Z){const _=Z.uuid,K=this._actionsByClip;for(const oe in K){const ie=K[oe].actionByRoot,se=ie[_];se!==void 0&&(this._deactivateAction(se),this._removeInactiveAction(se))}const te=this._bindingsByRootAndName,ne=te[_];if(ne!==void 0)for(const oe in ne){const ie=ne[oe];ie.restoreOriginalState(),this._removeInactiveBinding(ie)}}uncacheAction(Z,_){const K=this.existingAction(Z,_);K!==null&&(this._deactivateAction(K),this._removeInactiveAction(K))}}class Uniform{constructor(Z){this.value=Z}clone(){return new Uniform(this.value.clone===void 0?this.value:this.value.clone())}}let id=0;class UniformsGroup extends EventDispatcher{constructor(){super(),this.isUniformsGroup=!0,Object.defineProperty(this,"id",{value:id++}),this.name="",this.usage=StaticDrawUsage,this.uniforms=[]}add(Z){return this.uniforms.push(Z),this}remove(Z){const _=this.uniforms.indexOf(Z);return _!==-1&&this.uniforms.splice(_,1),this}setName(Z){return this.name=Z,this}setUsage(Z){return this.usage=Z,this}dispose(){return this.dispatchEvent({type:"dispose"}),this}copy(Z){this.name=Z.name,this.usage=Z.usage;const _=Z.uniforms;this.uniforms.length=0;for(let K=0,te=_.length;K<te;K++)this.uniforms.push(_[K].clone());return this}clone(){return new this.constructor().copy(this)}}class InstancedInterleavedBuffer extends InterleavedBuffer{constructor(Z,_,K=1){super(Z,_),this.isInstancedInterleavedBuffer=!0,this.meshPerAttribute=K}copy(Z){return super.copy(Z),this.meshPerAttribute=Z.meshPerAttribute,this}clone(Z){const _=super.clone(Z);return _.meshPerAttribute=this.meshPerAttribute,_}toJSON(Z){const _=super.toJSON(Z);return _.isInstancedInterleavedBuffer=!0,_.meshPerAttribute=this.meshPerAttribute,_}}class GLBufferAttribute{constructor(Z,_,K,te,ne){this.isGLBufferAttribute=!0,this.name="",this.buffer=Z,this.type=_,this.itemSize=K,this.elementSize=te,this.count=ne,this.version=0}set needsUpdate(Z){Z===!0&&this.version++}setBuffer(Z){return this.buffer=Z,this}setType(Z,_){return this.type=Z,this.elementSize=_,this}setItemSize(Z){return this.itemSize=Z,this}setCount(Z){return this.count=Z,this}}class Raycaster{constructor(Z,_,K=0,te=1/0){this.ray=new Ray$2(Z,_),this.near=K,this.far=te,this.camera=null,this.layers=new Layers,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(Z,_){this.ray.set(Z,_)}setFromCamera(Z,_){_.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(_.matrixWorld),this.ray.direction.set(Z.x,Z.y,.5).unproject(_).sub(this.ray.origin).normalize(),this.camera=_):_.isOrthographicCamera?(this.ray.origin.set(Z.x,Z.y,(_.near+_.far)/(_.near-_.far)).unproject(_),this.ray.direction.set(0,0,-1).transformDirection(_.matrixWorld),this.camera=_):console.error("THREE.Raycaster: Unsupported camera type: "+_.type)}intersectObject(Z,_=!0,K=[]){return intersectObject(Z,this,K,_),K.sort(ascSort),K}intersectObjects(Z,_=!0,K=[]){for(let te=0,ne=Z.length;te<ne;te++)intersectObject(Z[te],this,K,_);return K.sort(ascSort),K}}function ascSort(X,Z){return X.distance-Z.distance}function intersectObject(X,Z,_,K){if(X.layers.test(Z.layers)&&X.raycast(Z,_),K===!0){const te=X.children;for(let ne=0,oe=te.length;ne<oe;ne++)intersectObject(te[ne],Z,_,!0)}}class Spherical{constructor(Z=1,_=0,K=0){return this.radius=Z,this.phi=_,this.theta=K,this}set(Z,_,K){return this.radius=Z,this.phi=_,this.theta=K,this}copy(Z){return this.radius=Z.radius,this.phi=Z.phi,this.theta=Z.theta,this}makeSafe(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this}setFromVector3(Z){return this.setFromCartesianCoords(Z.x,Z.y,Z.z)}setFromCartesianCoords(Z,_,K){return this.radius=Math.sqrt(Z*Z+_*_+K*K),this.radius===0?(this.theta=0,this.phi=0):(this.theta=Math.atan2(Z,K),this.phi=Math.acos(clamp$3(_/this.radius,-1,1))),this}clone(){return new this.constructor().copy(this)}}class Cylindrical{constructor(Z=1,_=0,K=0){return this.radius=Z,this.theta=_,this.y=K,this}set(Z,_,K){return this.radius=Z,this.theta=_,this.y=K,this}copy(Z){return this.radius=Z.radius,this.theta=Z.theta,this.y=Z.y,this}setFromVector3(Z){return this.setFromCartesianCoords(Z.x,Z.y,Z.z)}setFromCartesianCoords(Z,_,K){return this.radius=Math.sqrt(Z*Z+K*K),this.theta=Math.atan2(Z,K),this.y=_,this}clone(){return new this.constructor().copy(this)}}const _vector$4=new Vector2;class Box2{constructor(Z=new Vector2(1/0,1/0),_=new Vector2(-1/0,-1/0)){this.isBox2=!0,this.min=Z,this.max=_}set(Z,_){return this.min.copy(Z),this.max.copy(_),this}setFromPoints(Z){this.makeEmpty();for(let _=0,K=Z.length;_<K;_++)this.expandByPoint(Z[_]);return this}setFromCenterAndSize(Z,_){const K=_vector$4.copy(_).multiplyScalar(.5);return this.min.copy(Z).sub(K),this.max.copy(Z).add(K),this}clone(){return new this.constructor().copy(this)}copy(Z){return this.min.copy(Z.min),this.max.copy(Z.max),this}makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(Z){return this.isEmpty()?Z.set(0,0):Z.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(Z){return this.isEmpty()?Z.set(0,0):Z.subVectors(this.max,this.min)}expandByPoint(Z){return this.min.min(Z),this.max.max(Z),this}expandByVector(Z){return this.min.sub(Z),this.max.add(Z),this}expandByScalar(Z){return this.min.addScalar(-Z),this.max.addScalar(Z),this}containsPoint(Z){return!(Z.x<this.min.x||Z.x>this.max.x||Z.y<this.min.y||Z.y>this.max.y)}containsBox(Z){return this.min.x<=Z.min.x&&Z.max.x<=this.max.x&&this.min.y<=Z.min.y&&Z.max.y<=this.max.y}getParameter(Z,_){return _.set((Z.x-this.min.x)/(this.max.x-this.min.x),(Z.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(Z){return!(Z.max.x<this.min.x||Z.min.x>this.max.x||Z.max.y<this.min.y||Z.min.y>this.max.y)}clampPoint(Z,_){return _.copy(Z).clamp(this.min,this.max)}distanceToPoint(Z){return this.clampPoint(Z,_vector$4).distanceTo(Z)}intersect(Z){return this.min.max(Z.min),this.max.min(Z.max),this.isEmpty()&&this.makeEmpty(),this}union(Z){return this.min.min(Z.min),this.max.max(Z.max),this}translate(Z){return this.min.add(Z),this.max.add(Z),this}equals(Z){return Z.min.equals(this.min)&&Z.max.equals(this.max)}}const _startP=new Vector3,_startEnd=new Vector3;class Line3{constructor(Z=new Vector3,_=new Vector3){this.start=Z,this.end=_}set(Z,_){return this.start.copy(Z),this.end.copy(_),this}copy(Z){return this.start.copy(Z.start),this.end.copy(Z.end),this}getCenter(Z){return Z.addVectors(this.start,this.end).multiplyScalar(.5)}delta(Z){return Z.subVectors(this.end,this.start)}distanceSq(){return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(Z,_){return this.delta(_).multiplyScalar(Z).add(this.start)}closestPointToPointParameter(Z,_){_startP.subVectors(Z,this.start),_startEnd.subVectors(this.end,this.start);const K=_startEnd.dot(_startEnd);let ne=_startEnd.dot(_startP)/K;return _&&(ne=clamp$3(ne,0,1)),ne}closestPointToPoint(Z,_,K){const te=this.closestPointToPointParameter(Z,_);return this.delta(K).multiplyScalar(te).add(this.start)}applyMatrix4(Z){return this.start.applyMatrix4(Z),this.end.applyMatrix4(Z),this}equals(Z){return Z.start.equals(this.start)&&Z.end.equals(this.end)}clone(){return new this.constructor().copy(this)}}const _vector$3=new Vector3;class SpotLightHelper extends Object3D{constructor(Z,_){super(),this.light=Z,this.matrix=Z.matrixWorld,this.matrixAutoUpdate=!1,this.color=_,this.type="SpotLightHelper";const K=new BufferGeometry,te=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(let oe=0,ie=1,se=32;oe<se;oe++,ie++){const ae=oe/se*Math.PI*2,ge=ie/se*Math.PI*2;te.push(Math.cos(ae),Math.sin(ae),1,Math.cos(ge),Math.sin(ge),1)}K.setAttribute("position",new Float32BufferAttribute(te,3));const ne=new LineBasicMaterial({fog:!1,toneMapped:!1});this.cone=new LineSegments(K,ne),this.add(this.cone),this.update()}dispose(){this.cone.geometry.dispose(),this.cone.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1);const Z=this.light.distance?this.light.distance:1e3,_=Z*Math.tan(this.light.angle);this.cone.scale.set(_,_,Z),_vector$3.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(_vector$3),this.color!==void 0?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}}const _vector$2=new Vector3,_boneMatrix=new Matrix4,_matrixWorldInv=new Matrix4;class SkeletonHelper extends LineSegments{constructor(Z){const _=getBoneList(Z),K=new BufferGeometry,te=[],ne=[],oe=new Color$1(0,0,1),ie=new Color$1(0,1,0);for(let ae=0;ae<_.length;ae++){const ge=_[ae];ge.parent&&ge.parent.isBone&&(te.push(0,0,0),te.push(0,0,0),ne.push(oe.r,oe.g,oe.b),ne.push(ie.r,ie.g,ie.b))}K.setAttribute("position",new Float32BufferAttribute(te,3)),K.setAttribute("color",new Float32BufferAttribute(ne,3));const se=new LineBasicMaterial({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0});super(K,se),this.isSkeletonHelper=!0,this.type="SkeletonHelper",this.root=Z,this.bones=_,this.matrix=Z.matrixWorld,this.matrixAutoUpdate=!1}updateMatrixWorld(Z){const _=this.bones,K=this.geometry,te=K.getAttribute("position");_matrixWorldInv.copy(this.root.matrixWorld).invert();for(let ne=0,oe=0;ne<_.length;ne++){const ie=_[ne];ie.parent&&ie.parent.isBone&&(_boneMatrix.multiplyMatrices(_matrixWorldInv,ie.matrixWorld),_vector$2.setFromMatrixPosition(_boneMatrix),te.setXYZ(oe,_vector$2.x,_vector$2.y,_vector$2.z),_boneMatrix.multiplyMatrices(_matrixWorldInv,ie.parent.matrixWorld),_vector$2.setFromMatrixPosition(_boneMatrix),te.setXYZ(oe+1,_vector$2.x,_vector$2.y,_vector$2.z),oe+=2)}K.getAttribute("position").needsUpdate=!0,super.updateMatrixWorld(Z)}dispose(){this.geometry.dispose(),this.material.dispose()}}function getBoneList(X){const Z=[];X.isBone===!0&&Z.push(X);for(let _=0;_<X.children.length;_++)Z.push.apply(Z,getBoneList(X.children[_]));return Z}class PointLightHelper extends Mesh{constructor(Z,_,K){const te=new SphereGeometry(_,4,2),ne=new MeshBasicMaterial({wireframe:!0,fog:!1,toneMapped:!1});super(te,ne),this.light=Z,this.color=K,this.type="PointLightHelper",this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}dispose(){this.geometry.dispose(),this.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.color!==void 0?this.material.color.set(this.color):this.material.color.copy(this.light.color)}}const _vector$1=new Vector3,_color1=new Color$1,_color2=new Color$1;class HemisphereLightHelper extends Object3D{constructor(Z,_,K){super(),this.light=Z,this.matrix=Z.matrixWorld,this.matrixAutoUpdate=!1,this.color=K,this.type="HemisphereLightHelper";const te=new OctahedronGeometry(_);te.rotateY(Math.PI*.5),this.material=new MeshBasicMaterial({wireframe:!0,fog:!1,toneMapped:!1}),this.color===void 0&&(this.material.vertexColors=!0);const ne=te.getAttribute("position"),oe=new Float32Array(ne.count*3);te.setAttribute("color",new BufferAttribute(oe,3)),this.add(new Mesh(te,this.material)),this.update()}dispose(){this.children[0].geometry.dispose(),this.children[0].material.dispose()}update(){const Z=this.children[0];if(this.color!==void 0)this.material.color.set(this.color);else{const _=Z.geometry.getAttribute("color");_color1.copy(this.light.color),_color2.copy(this.light.groundColor);for(let K=0,te=_.count;K<te;K++){const ne=K<te/2?_color1:_color2;_.setXYZ(K,ne.r,ne.g,ne.b)}_.needsUpdate=!0}this.light.updateWorldMatrix(!0,!1),Z.lookAt(_vector$1.setFromMatrixPosition(this.light.matrixWorld).negate())}}class GridHelper extends LineSegments{constructor(Z=10,_=10,K=4473924,te=8947848){K=new Color$1(K),te=new Color$1(te);const ne=_/2,oe=Z/_,ie=Z/2,se=[],ae=[];for(let de=0,pe=0,fe=-ie;de<=_;de++,fe+=oe){se.push(-ie,0,fe,ie,0,fe),se.push(fe,0,-ie,fe,0,ie);const be=de===ne?K:te;be.toArray(ae,pe),pe+=3,be.toArray(ae,pe),pe+=3,be.toArray(ae,pe),pe+=3,be.toArray(ae,pe),pe+=3}const ge=new BufferGeometry;ge.setAttribute("position",new Float32BufferAttribute(se,3)),ge.setAttribute("color",new Float32BufferAttribute(ae,3));const ce=new LineBasicMaterial({vertexColors:!0,toneMapped:!1});super(ge,ce),this.type="GridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}}class PolarGridHelper extends LineSegments{constructor(Z=10,_=16,K=8,te=64,ne=4473924,oe=8947848){ne=new Color$1(ne),oe=new Color$1(oe);const ie=[],se=[];if(_>1)for(let ce=0;ce<_;ce++){const de=ce/_*(Math.PI*2),pe=Math.sin(de)*Z,fe=Math.cos(de)*Z;ie.push(0,0,0),ie.push(pe,0,fe);const be=ce&1?ne:oe;se.push(be.r,be.g,be.b),se.push(be.r,be.g,be.b)}for(let ce=0;ce<K;ce++){const de=ce&1?ne:oe,pe=Z-Z/K*ce;for(let fe=0;fe<te;fe++){let be=fe/te*(Math.PI*2),me=Math.sin(be)*pe,ye=Math.cos(be)*pe;ie.push(me,0,ye),se.push(de.r,de.g,de.b),be=(fe+1)/te*(Math.PI*2),me=Math.sin(be)*pe,ye=Math.cos(be)*pe,ie.push(me,0,ye),se.push(de.r,de.g,de.b)}}const ae=new BufferGeometry;ae.setAttribute("position",new Float32BufferAttribute(ie,3)),ae.setAttribute("color",new Float32BufferAttribute(se,3));const ge=new LineBasicMaterial({vertexColors:!0,toneMapped:!1});super(ae,ge),this.type="PolarGridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}}const _v1=new Vector3,_v2=new Vector3,_v3=new Vector3;class DirectionalLightHelper extends Object3D{constructor(Z,_,K){super(),this.light=Z,this.matrix=Z.matrixWorld,this.matrixAutoUpdate=!1,this.color=K,this.type="DirectionalLightHelper",_===void 0&&(_=1);let te=new BufferGeometry;te.setAttribute("position",new Float32BufferAttribute([-_,_,0,_,_,0,_,-_,0,-_,-_,0,-_,_,0],3));const ne=new LineBasicMaterial({fog:!1,toneMapped:!1});this.lightPlane=new Line(te,ne),this.add(this.lightPlane),te=new BufferGeometry,te.setAttribute("position",new Float32BufferAttribute([0,0,0,0,0,1],3)),this.targetLine=new Line(te,ne),this.add(this.targetLine),this.update()}dispose(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1),_v1.setFromMatrixPosition(this.light.matrixWorld),_v2.setFromMatrixPosition(this.light.target.matrixWorld),_v3.subVectors(_v2,_v1),this.lightPlane.lookAt(_v2),this.color!==void 0?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(_v2),this.targetLine.scale.z=_v3.length()}}const _vector=new Vector3,_camera=new Camera;class CameraHelper extends LineSegments{constructor(Z){const _=new BufferGeometry,K=new LineBasicMaterial({color:16777215,vertexColors:!0,toneMapped:!1}),te=[],ne=[],oe={};ie("n1","n2"),ie("n2","n4"),ie("n4","n3"),ie("n3","n1"),ie("f1","f2"),ie("f2","f4"),ie("f4","f3"),ie("f3","f1"),ie("n1","f1"),ie("n2","f2"),ie("n3","f3"),ie("n4","f4"),ie("p","n1"),ie("p","n2"),ie("p","n3"),ie("p","n4"),ie("u1","u2"),ie("u2","u3"),ie("u3","u1"),ie("c","t"),ie("p","c"),ie("cn1","cn2"),ie("cn3","cn4"),ie("cf1","cf2"),ie("cf3","cf4");function ie(fe,be){se(fe),se(be)}function se(fe){te.push(0,0,0),ne.push(0,0,0),oe[fe]===void 0&&(oe[fe]=[]),oe[fe].push(te.length/3-1)}_.setAttribute("position",new Float32BufferAttribute(te,3)),_.setAttribute("color",new Float32BufferAttribute(ne,3)),super(_,K),this.type="CameraHelper",this.camera=Z,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=Z.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=oe,this.update();const ae=new Color$1(16755200),ge=new Color$1(16711680),ce=new Color$1(43775),de=new Color$1(16777215),pe=new Color$1(3355443);this.setColors(ae,ge,ce,de,pe)}setColors(Z,_,K,te,ne){const ie=this.geometry.getAttribute("color");ie.setXYZ(0,Z.r,Z.g,Z.b),ie.setXYZ(1,Z.r,Z.g,Z.b),ie.setXYZ(2,Z.r,Z.g,Z.b),ie.setXYZ(3,Z.r,Z.g,Z.b),ie.setXYZ(4,Z.r,Z.g,Z.b),ie.setXYZ(5,Z.r,Z.g,Z.b),ie.setXYZ(6,Z.r,Z.g,Z.b),ie.setXYZ(7,Z.r,Z.g,Z.b),ie.setXYZ(8,Z.r,Z.g,Z.b),ie.setXYZ(9,Z.r,Z.g,Z.b),ie.setXYZ(10,Z.r,Z.g,Z.b),ie.setXYZ(11,Z.r,Z.g,Z.b),ie.setXYZ(12,Z.r,Z.g,Z.b),ie.setXYZ(13,Z.r,Z.g,Z.b),ie.setXYZ(14,Z.r,Z.g,Z.b),ie.setXYZ(15,Z.r,Z.g,Z.b),ie.setXYZ(16,Z.r,Z.g,Z.b),ie.setXYZ(17,Z.r,Z.g,Z.b),ie.setXYZ(18,Z.r,Z.g,Z.b),ie.setXYZ(19,Z.r,Z.g,Z.b),ie.setXYZ(20,Z.r,Z.g,Z.b),ie.setXYZ(21,Z.r,Z.g,Z.b),ie.setXYZ(22,Z.r,Z.g,Z.b),ie.setXYZ(23,Z.r,Z.g,Z.b),ie.setXYZ(24,_.r,_.g,_.b),ie.setXYZ(25,_.r,_.g,_.b),ie.setXYZ(26,_.r,_.g,_.b),ie.setXYZ(27,_.r,_.g,_.b),ie.setXYZ(28,_.r,_.g,_.b),ie.setXYZ(29,_.r,_.g,_.b),ie.setXYZ(30,_.r,_.g,_.b),ie.setXYZ(31,_.r,_.g,_.b),ie.setXYZ(32,K.r,K.g,K.b),ie.setXYZ(33,K.r,K.g,K.b),ie.setXYZ(34,K.r,K.g,K.b),ie.setXYZ(35,K.r,K.g,K.b),ie.setXYZ(36,K.r,K.g,K.b),ie.setXYZ(37,K.r,K.g,K.b),ie.setXYZ(38,te.r,te.g,te.b),ie.setXYZ(39,te.r,te.g,te.b),ie.setXYZ(40,ne.r,ne.g,ne.b),ie.setXYZ(41,ne.r,ne.g,ne.b),ie.setXYZ(42,ne.r,ne.g,ne.b),ie.setXYZ(43,ne.r,ne.g,ne.b),ie.setXYZ(44,ne.r,ne.g,ne.b),ie.setXYZ(45,ne.r,ne.g,ne.b),ie.setXYZ(46,ne.r,ne.g,ne.b),ie.setXYZ(47,ne.r,ne.g,ne.b),ie.setXYZ(48,ne.r,ne.g,ne.b),ie.setXYZ(49,ne.r,ne.g,ne.b),ie.needsUpdate=!0}update(){const Z=this.geometry,_=this.pointMap,K=1,te=1;_camera.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),setPoint("c",_,Z,_camera,0,0,-1),setPoint("t",_,Z,_camera,0,0,1),setPoint("n1",_,Z,_camera,-1,-1,-1),setPoint("n2",_,Z,_camera,K,-1,-1),setPoint("n3",_,Z,_camera,-1,te,-1),setPoint("n4",_,Z,_camera,K,te,-1),setPoint("f1",_,Z,_camera,-1,-1,1),setPoint("f2",_,Z,_camera,K,-1,1),setPoint("f3",_,Z,_camera,-1,te,1),setPoint("f4",_,Z,_camera,K,te,1),setPoint("u1",_,Z,_camera,K*.7,te*1.1,-1),setPoint("u2",_,Z,_camera,-1*.7,te*1.1,-1),setPoint("u3",_,Z,_camera,0,te*2,-1),setPoint("cf1",_,Z,_camera,-1,0,1),setPoint("cf2",_,Z,_camera,K,0,1),setPoint("cf3",_,Z,_camera,0,-1,1),setPoint("cf4",_,Z,_camera,0,te,1),setPoint("cn1",_,Z,_camera,-1,0,-1),setPoint("cn2",_,Z,_camera,K,0,-1),setPoint("cn3",_,Z,_camera,0,-1,-1),setPoint("cn4",_,Z,_camera,0,te,-1),Z.getAttribute("position").needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}}function setPoint(X,Z,_,K,te,ne,oe){_vector.set(te,ne,oe).unproject(K);const ie=Z[X];if(ie!==void 0){const se=_.getAttribute("position");for(let ae=0,ge=ie.length;ae<ge;ae++)se.setXYZ(ie[ae],_vector.x,_vector.y,_vector.z)}}const _box=new Box3;class BoxHelper extends LineSegments{constructor(Z,_=16776960){const K=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),te=new Float32Array(8*3),ne=new BufferGeometry;ne.setIndex(new BufferAttribute(K,1)),ne.setAttribute("position",new BufferAttribute(te,3)),super(ne,new LineBasicMaterial({color:_,toneMapped:!1})),this.object=Z,this.type="BoxHelper",this.matrixAutoUpdate=!1,this.update()}update(Z){if(Z!==void 0&&console.warn("THREE.BoxHelper: .update() has no longer arguments."),this.object!==void 0&&_box.setFromObject(this.object),_box.isEmpty())return;const _=_box.min,K=_box.max,te=this.geometry.attributes.position,ne=te.array;ne[0]=K.x,ne[1]=K.y,ne[2]=K.z,ne[3]=_.x,ne[4]=K.y,ne[5]=K.z,ne[6]=_.x,ne[7]=_.y,ne[8]=K.z,ne[9]=K.x,ne[10]=_.y,ne[11]=K.z,ne[12]=K.x,ne[13]=K.y,ne[14]=_.z,ne[15]=_.x,ne[16]=K.y,ne[17]=_.z,ne[18]=_.x,ne[19]=_.y,ne[20]=_.z,ne[21]=K.x,ne[22]=_.y,ne[23]=_.z,te.needsUpdate=!0,this.geometry.computeBoundingSphere()}setFromObject(Z){return this.object=Z,this.update(),this}copy(Z,_){return super.copy(Z,_),this.object=Z.object,this}dispose(){this.geometry.dispose(),this.material.dispose()}}class Box3Helper extends LineSegments{constructor(Z,_=16776960){const K=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),te=[1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],ne=new BufferGeometry;ne.setIndex(new BufferAttribute(K,1)),ne.setAttribute("position",new Float32BufferAttribute(te,3)),super(ne,new LineBasicMaterial({color:_,toneMapped:!1})),this.box=Z,this.type="Box3Helper",this.geometry.computeBoundingSphere()}updateMatrixWorld(Z){const _=this.box;_.isEmpty()||(_.getCenter(this.position),_.getSize(this.scale),this.scale.multiplyScalar(.5),super.updateMatrixWorld(Z))}dispose(){this.geometry.dispose(),this.material.dispose()}}class PlaneHelper extends Line{constructor(Z,_=1,K=16776960){const te=K,ne=[1,-1,0,-1,1,0,-1,-1,0,1,1,0,-1,1,0,-1,-1,0,1,-1,0,1,1,0],oe=new BufferGeometry;oe.setAttribute("position",new Float32BufferAttribute(ne,3)),oe.computeBoundingSphere(),super(oe,new LineBasicMaterial({color:te,toneMapped:!1})),this.type="PlaneHelper",this.plane=Z,this.size=_;const ie=[1,1,0,-1,1,0,-1,-1,0,1,1,0,-1,-1,0,1,-1,0],se=new BufferGeometry;se.setAttribute("position",new Float32BufferAttribute(ie,3)),se.computeBoundingSphere(),this.add(new Mesh(se,new MeshBasicMaterial({color:te,opacity:.2,transparent:!0,depthWrite:!1,toneMapped:!1})))}updateMatrixWorld(Z){this.position.set(0,0,0),this.scale.set(.5*this.size,.5*this.size,1),this.lookAt(this.plane.normal),this.translateZ(-this.plane.constant),super.updateMatrixWorld(Z)}dispose(){this.geometry.dispose(),this.material.dispose(),this.children[0].geometry.dispose(),this.children[0].material.dispose()}}const _axis=new Vector3;let _lineGeometry,_coneGeometry;class ArrowHelper extends Object3D{constructor(Z=new Vector3(0,0,1),_=new Vector3(0,0,0),K=1,te=16776960,ne=K*.2,oe=ne*.2){super(),this.type="ArrowHelper",_lineGeometry===void 0&&(_lineGeometry=new BufferGeometry,_lineGeometry.setAttribute("position",new Float32BufferAttribute([0,0,0,0,1,0],3)),_coneGeometry=new CylinderGeometry(0,.5,1,5,1),_coneGeometry.translate(0,-.5,0)),this.position.copy(_),this.line=new Line(_lineGeometry,new LineBasicMaterial({color:te,toneMapped:!1})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new Mesh(_coneGeometry,new MeshBasicMaterial({color:te,toneMapped:!1})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(Z),this.setLength(K,ne,oe)}setDirection(Z){if(Z.y>.99999)this.quaternion.set(0,0,0,1);else if(Z.y<-.99999)this.quaternion.set(1,0,0,0);else{_axis.set(Z.z,0,-Z.x).normalize();const _=Math.acos(Z.y);this.quaternion.setFromAxisAngle(_axis,_)}}setLength(Z,_=Z*.2,K=_*.2){this.line.scale.set(1,Math.max(1e-4,Z-_),1),this.line.updateMatrix(),this.cone.scale.set(K,_,K),this.cone.position.y=Z,this.cone.updateMatrix()}setColor(Z){this.line.material.color.set(Z),this.cone.material.color.set(Z)}copy(Z){return super.copy(Z,!1),this.line.copy(Z.line),this.cone.copy(Z.cone),this}dispose(){this.line.geometry.dispose(),this.line.material.dispose(),this.cone.geometry.dispose(),this.cone.material.dispose()}}class AxesHelper extends LineSegments{constructor(Z=1){const _=[0,0,0,Z,0,0,0,0,0,0,Z,0,0,0,0,0,0,Z],K=[1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],te=new BufferGeometry;te.setAttribute("position",new Float32BufferAttribute(_,3)),te.setAttribute("color",new Float32BufferAttribute(K,3));const ne=new LineBasicMaterial({vertexColors:!0,toneMapped:!1});super(te,ne),this.type="AxesHelper"}setColors(Z,_,K){const te=new Color$1,ne=this.geometry.attributes.color.array;return te.set(Z),te.toArray(ne,0),te.toArray(ne,3),te.set(_),te.toArray(ne,6),te.toArray(ne,9),te.set(K),te.toArray(ne,12),te.toArray(ne,15),this.geometry.attributes.color.needsUpdate=!0,this}dispose(){this.geometry.dispose(),this.material.dispose()}}class ShapePath{constructor(){this.type="ShapePath",this.color=new Color$1,this.subPaths=[],this.currentPath=null}moveTo(Z,_){return this.currentPath=new Path,this.subPaths.push(this.currentPath),this.currentPath.moveTo(Z,_),this}lineTo(Z,_){return this.currentPath.lineTo(Z,_),this}quadraticCurveTo(Z,_,K,te){return this.currentPath.quadraticCurveTo(Z,_,K,te),this}bezierCurveTo(Z,_,K,te,ne,oe){return this.currentPath.bezierCurveTo(Z,_,K,te,ne,oe),this}splineThru(Z){return this.currentPath.splineThru(Z),this}toShapes(Z){function _(ye){const ve=[];for(let Be=0,Re=ye.length;Be<Re;Be++){const Ee=ye[Be],We=new Shape$2;We.curves=Ee.curves,ve.push(We)}return ve}function K(ye,ve){const Be=ve.length;let Re=!1;for(let Ee=Be-1,We=0;We<Be;Ee=We++){let Ze=ve[Ee],Ve=ve[We],_e=Ve.x-Ze.x,Xe=Ve.y-Ze.y;if(Math.abs(Xe)>Number.EPSILON){if(Xe<0&&(Ze=ve[We],_e=-_e,Ve=ve[Ee],Xe=-Xe),ye.y<Ze.y||ye.y>Ve.y)continue;if(ye.y===Ze.y){if(ye.x===Ze.x)return!0}else{const Pe=Xe*(ye.x-Ze.x)-_e*(ye.y-Ze.y);if(Pe===0)return!0;if(Pe<0)continue;Re=!Re}}else{if(ye.y!==Ze.y)continue;if(Ve.x<=ye.x&&ye.x<=Ze.x||Ze.x<=ye.x&&ye.x<=Ve.x)return!0}}return Re}const te=ShapeUtils.isClockWise,ne=this.subPaths;if(ne.length===0)return[];let oe,ie,se;const ae=[];if(ne.length===1)return ie=ne[0],se=new Shape$2,se.curves=ie.curves,ae.push(se),ae;let ge=!te(ne[0].getPoints());ge=Z?!ge:ge;const ce=[],de=[];let pe=[],fe=0,be;de[fe]=void 0,pe[fe]=[];for(let ye=0,ve=ne.length;ye<ve;ye++)ie=ne[ye],be=ie.getPoints(),oe=te(be),oe=Z?!oe:oe,oe?(!ge&&de[fe]&&fe++,de[fe]={s:new Shape$2,p:be},de[fe].s.curves=ie.curves,ge&&fe++,pe[fe]=[]):pe[fe].push({h:ie,p:be[0]});if(!de[0])return _(ne);if(de.length>1){let ye=!1,ve=0;for(let Be=0,Re=de.length;Be<Re;Be++)ce[Be]=[];for(let Be=0,Re=de.length;Be<Re;Be++){const Ee=pe[Be];for(let We=0;We<Ee.length;We++){const Ze=Ee[We];let Ve=!0;for(let _e=0;_e<de.length;_e++)K(Ze.p,de[_e].p)&&(Be!==_e&&ve++,Ve?(Ve=!1,ce[_e].push(Ze)):ye=!0);Ve&&ce[Be].push(Ze)}}ve>0&&ye===!1&&(pe=ce)}let me;for(let ye=0,ve=de.length;ye<ve;ye++){se=de[ye].s,ae.push(se),me=pe[ye];for(let Be=0,Re=me.length;Be<Re;Be++)se.holes.push(me[Be].h)}return ae}}typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:REVISION}}));typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=REVISION);const THREE=Object.freeze(Object.defineProperty({__proto__:null,ACESFilmicToneMapping,AddEquation,AddOperation,AdditiveAnimationBlendMode,AdditiveBlending,AlphaFormat,AlwaysCompare,AlwaysDepth,AlwaysStencilFunc,AmbientLight,AmbientLightProbe,AnimationAction,AnimationClip,AnimationLoader,AnimationMixer,AnimationObjectGroup,AnimationUtils,ArcCurve,ArrayCamera,ArrowHelper,Audio,AudioAnalyser,AudioContext:AudioContext$1,AudioListener,AudioLoader,AxesHelper,BackSide,BasicDepthPacking,BasicShadowMap,Bone,BooleanKeyframeTrack,Box2,Box3,Box3Helper,BoxGeometry,BoxHelper,BufferAttribute,BufferGeometry,BufferGeometryLoader,ByteType,Cache,Camera,CameraHelper,CanvasTexture,CapsuleGeometry,CatmullRomCurve3,CineonToneMapping,CircleGeometry,ClampToEdgeWrapping,Clock,Color:Color$1,ColorKeyframeTrack,ColorManagement,CompressedArrayTexture,CompressedTexture,CompressedTextureLoader,ConeGeometry,CubeCamera,CubeReflectionMapping,CubeRefractionMapping,CubeTexture,CubeTextureLoader,CubeUVReflectionMapping,CubicBezierCurve,CubicBezierCurve3,CubicInterpolant,CullFaceBack,CullFaceFront,CullFaceFrontBack,CullFaceNone,Curve,CurvePath,CustomBlending,CustomToneMapping,CylinderGeometry,Cylindrical,Data3DTexture,DataArrayTexture,DataTexture,DataTextureLoader,DataUtils,DecrementStencilOp,DecrementWrapStencilOp,DefaultLoadingManager,DepthFormat,DepthStencilFormat,DepthTexture,DirectionalLight,DirectionalLightHelper,DiscreteInterpolant,DisplayP3ColorSpace,DodecahedronGeometry,DoubleSide,DstAlphaFactor,DstColorFactor,DynamicCopyUsage,DynamicDrawUsage,DynamicReadUsage,EdgesGeometry,EllipseCurve,EqualCompare,EqualDepth,EqualStencilFunc,EquirectangularReflectionMapping,EquirectangularRefractionMapping,Euler,EventDispatcher,ExtrudeGeometry,FileLoader,Float16BufferAttribute,Float32BufferAttribute,Float64BufferAttribute,FloatType,Fog,FogExp2,FramebufferTexture,FrontSide,Frustum,GLBufferAttribute,GLSL1,GLSL3,GreaterCompare,GreaterDepth,GreaterEqualCompare,GreaterEqualDepth,GreaterEqualStencilFunc,GreaterStencilFunc,GridHelper,Group,HalfFloatType,HemisphereLight,HemisphereLightHelper,HemisphereLightProbe,IcosahedronGeometry,ImageBitmapLoader,ImageLoader,ImageUtils,IncrementStencilOp,IncrementWrapStencilOp,InstancedBufferAttribute,InstancedBufferGeometry,InstancedInterleavedBuffer,InstancedMesh,Int16BufferAttribute,Int32BufferAttribute,Int8BufferAttribute,IntType,InterleavedBuffer,InterleavedBufferAttribute,Interpolant,InterpolateDiscrete,InterpolateLinear,InterpolateSmooth,InvertStencilOp,KeepStencilOp,KeyframeTrack,LOD,LatheGeometry,Layers,LessCompare,LessDepth,LessEqualCompare,LessEqualDepth,LessEqualStencilFunc,LessStencilFunc,Light,LightProbe,Line,Line3,LineBasicMaterial,LineCurve,LineCurve3,LineDashedMaterial,LineLoop,LineSegments,LinearEncoding:LinearEncoding$2,LinearFilter,LinearInterpolant,LinearMipMapLinearFilter,LinearMipMapNearestFilter,LinearMipmapLinearFilter,LinearMipmapNearestFilter,LinearSRGBColorSpace:LinearSRGBColorSpace$1,LinearToneMapping,Loader,LoaderUtils,LoadingManager,LoopOnce,LoopPingPong,LoopRepeat,LuminanceAlphaFormat,LuminanceFormat,MOUSE,Material,MaterialLoader,MathUtils,Matrix3,Matrix4,MaxEquation,Mesh,MeshBasicMaterial,MeshDepthMaterial,MeshDistanceMaterial,MeshLambertMaterial,MeshMatcapMaterial,MeshNormalMaterial,MeshPhongMaterial,MeshPhysicalMaterial,MeshStandardMaterial,MeshToonMaterial,MinEquation,MirroredRepeatWrapping,MixOperation,MultiplyBlending,MultiplyOperation,NearestFilter,NearestMipMapLinearFilter,NearestMipMapNearestFilter,NearestMipmapLinearFilter,NearestMipmapNearestFilter,NeverCompare,NeverDepth,NeverStencilFunc,NoBlending,NoColorSpace,NoToneMapping,NormalAnimationBlendMode,NormalBlending,NotEqualCompare,NotEqualDepth,NotEqualStencilFunc,NumberKeyframeTrack,Object3D,ObjectLoader,ObjectSpaceNormalMap,OctahedronGeometry,OneFactor,OneMinusDstAlphaFactor,OneMinusDstColorFactor,OneMinusSrcAlphaFactor,OneMinusSrcColorFactor,OrthographicCamera,PCFShadowMap,PCFSoftShadowMap,PMREMGenerator,Path,PerspectiveCamera,Plane,PlaneGeometry,PlaneHelper,PointLight,PointLightHelper,Points,PointsMaterial,PolarGridHelper,PolyhedronGeometry,PositionalAudio,PropertyBinding,PropertyMixer,QuadraticBezierCurve,QuadraticBezierCurve3,Quaternion:Quaternion$2,QuaternionKeyframeTrack,QuaternionLinearInterpolant,RED_GREEN_RGTC2_Format,RED_RGTC1_Format,REVISION,RGBADepthPacking,RGBAFormat,RGBAIntegerFormat,RGBA_ASTC_10x10_Format,RGBA_ASTC_10x5_Format,RGBA_ASTC_10x6_Format,RGBA_ASTC_10x8_Format,RGBA_ASTC_12x10_Format,RGBA_ASTC_12x12_Format,RGBA_ASTC_4x4_Format,RGBA_ASTC_5x4_Format,RGBA_ASTC_5x5_Format,RGBA_ASTC_6x5_Format,RGBA_ASTC_6x6_Format,RGBA_ASTC_8x5_Format,RGBA_ASTC_8x6_Format,RGBA_ASTC_8x8_Format,RGBA_BPTC_Format,RGBA_ETC2_EAC_Format,RGBA_PVRTC_2BPPV1_Format,RGBA_PVRTC_4BPPV1_Format,RGBA_S3TC_DXT1_Format,RGBA_S3TC_DXT3_Format,RGBA_S3TC_DXT5_Format,RGB_ETC1_Format,RGB_ETC2_Format,RGB_PVRTC_2BPPV1_Format,RGB_PVRTC_4BPPV1_Format,RGB_S3TC_DXT1_Format,RGFormat,RGIntegerFormat,RawShaderMaterial,Ray:Ray$2,Raycaster,RectAreaLight,RedFormat,RedIntegerFormat,ReinhardToneMapping,RepeatWrapping,ReplaceStencilOp,ReverseSubtractEquation,RingGeometry,SIGNED_RED_GREEN_RGTC2_Format,SIGNED_RED_RGTC1_Format,SRGBColorSpace:SRGBColorSpace$1,Scene:Scene$1,ShaderChunk,ShaderLib,ShaderMaterial,ShadowMaterial,Shape:Shape$2,ShapeGeometry,ShapePath,ShapeUtils,ShortType,Skeleton,SkeletonHelper,SkinnedMesh,Source,Sphere,SphereGeometry,Spherical,SphericalHarmonics3,SplineCurve,SpotLight,SpotLightHelper,Sprite,SpriteMaterial,SrcAlphaFactor,SrcAlphaSaturateFactor,SrcColorFactor,StaticCopyUsage,StaticDrawUsage,StaticReadUsage,StereoCamera,StreamCopyUsage,StreamDrawUsage,StreamReadUsage,StringKeyframeTrack,SubtractEquation,SubtractiveBlending,TOUCH,TangentSpaceNormalMap,TetrahedronGeometry,Texture,TextureLoader,TorusGeometry,TorusKnotGeometry,Triangle,TriangleFanDrawMode,TriangleStripDrawMode,TrianglesDrawMode,TubeGeometry,TwoPassDoubleSide,UVMapping,Uint16BufferAttribute,Uint32BufferAttribute,Uint8BufferAttribute,Uint8ClampedBufferAttribute,Uniform,UniformsGroup,UniformsLib,UniformsUtils,UnsignedByteType,UnsignedInt248Type,UnsignedIntType,UnsignedShort4444Type,UnsignedShort5551Type,UnsignedShortType,VSMShadowMap,Vector2,Vector3,Vector4,VectorKeyframeTrack,VideoTexture,WebGL1Renderer,WebGL3DRenderTarget,WebGLArrayRenderTarget,WebGLCoordinateSystem,WebGLCubeRenderTarget,WebGLMultipleRenderTargets,WebGLRenderTarget,WebGLRenderer,WebGLUtils,WebGPUCoordinateSystem,WireframeGeometry,WrapAroundEnding,ZeroCurvatureEnding,ZeroFactor,ZeroSlopeEnding,ZeroStencilOp,_SRGBAFormat,sRGBEncoding:sRGBEncoding$2},Symbol.toStringTag,{value:"Module"}));var constants={exports:{}},reactReconcilerConstants_production_min={};/**
 * @license React
 * react-reconciler-constants.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var hasRequiredReactReconcilerConstants_production_min;function requireReactReconcilerConstants_production_min(){return hasRequiredReactReconcilerConstants_production_min||(hasRequiredReactReconcilerConstants_production_min=1,reactReconcilerConstants_production_min.ConcurrentRoot=1,reactReconcilerConstants_production_min.ContinuousEventPriority=4,reactReconcilerConstants_production_min.DefaultEventPriority=16,reactReconcilerConstants_production_min.DiscreteEventPriority=1,reactReconcilerConstants_production_min.IdleEventPriority=536870912,reactReconcilerConstants_production_min.LegacyRoot=0),reactReconcilerConstants_production_min}var hasRequiredConstants;function requireConstants(){return hasRequiredConstants||(hasRequiredConstants=1,constants.exports=requireReactReconcilerConstants_production_min()),constants.exports}var constantsExports=requireConstants();function createStore$2(X){let Z;const _=new Set,K=(ae,ge)=>{const ce=typeof ae=="function"?ae(Z):ae;if(ce!==Z){const de=Z;Z=ge?ce:Object.assign({},Z,ce),_.forEach(pe=>pe(Z,de))}},te=()=>Z,ne=(ae,ge=te,ce=Object.is)=>{console.warn("[DEPRECATED] Please use `subscribeWithSelector` middleware");let de=ge(Z);function pe(){const fe=ge(Z);if(!ce(de,fe)){const be=de;ae(de=fe,be)}}return _.add(pe),()=>_.delete(pe)},se={setState:K,getState:te,subscribe:(ae,ge,ce)=>ge||ce?ne(ae,ge,ce):(_.add(ae),()=>_.delete(ae)),destroy:()=>_.clear()};return Z=X(K,te,se),se}const isSSR$2=typeof window>"u"||!window.navigator||/ServerSideRendering|^Deno\//.test(window.navigator.userAgent),useIsomorphicLayoutEffect$3=isSSR$2?reactExports.useEffect:reactExports.useLayoutEffect;function create$1(X){const Z=typeof X=="function"?createStore$2(X):X,_=(K=Z.getState,te=Object.is)=>{const[,ne]=reactExports.useReducer(me=>me+1,0),oe=Z.getState(),ie=reactExports.useRef(oe),se=reactExports.useRef(K),ae=reactExports.useRef(te),ge=reactExports.useRef(!1),ce=reactExports.useRef();ce.current===void 0&&(ce.current=K(oe));let de,pe=!1;(ie.current!==oe||se.current!==K||ae.current!==te||ge.current)&&(de=K(oe),pe=!te(ce.current,de)),useIsomorphicLayoutEffect$3(()=>{pe&&(ce.current=de),ie.current=oe,se.current=K,ae.current=te,ge.current=!1});const fe=reactExports.useRef(oe);useIsomorphicLayoutEffect$3(()=>{const me=()=>{try{const ve=Z.getState(),Be=se.current(ve);ae.current(ce.current,Be)||(ie.current=ve,ce.current=Be,ne())}catch{ge.current=!0,ne()}},ye=Z.subscribe(me);return Z.getState()!==fe.current&&me(),ye},[]);const be=pe?de:ce.current;return reactExports.useDebugValue(be),be};return Object.assign(_,Z),_[Symbol.iterator]=function(){console.warn("[useStore, api] = create() is deprecated and will be removed in v4");const K=[_,Z];return{next(){const te=K.length<=0;return{value:K.shift(),done:te}}}},_}const isPromise=X=>typeof X=="object"&&typeof X.then=="function",globalCache=[];function shallowEqualArrays(X,Z,_=(K,te)=>K===te){if(X===Z)return!0;if(!X||!Z)return!1;const K=X.length;if(Z.length!==K)return!1;for(let te=0;te<K;te++)if(!_(X[te],Z[te]))return!1;return!0}function query(X,Z=null,_=!1,K={}){Z===null&&(Z=[X]);for(const ne of globalCache)if(shallowEqualArrays(Z,ne.keys,ne.equal)){if(_)return;if(Object.prototype.hasOwnProperty.call(ne,"error"))throw ne.error;if(Object.prototype.hasOwnProperty.call(ne,"response"))return K.lifespan&&K.lifespan>0&&(ne.timeout&&clearTimeout(ne.timeout),ne.timeout=setTimeout(ne.remove,K.lifespan)),ne.response;if(!_)throw ne.promise}const te={keys:Z,equal:K.equal,remove:()=>{const ne=globalCache.indexOf(te);ne!==-1&&globalCache.splice(ne,1)},promise:(isPromise(X)?X:X(...Z)).then(ne=>{te.response=ne,K.lifespan&&K.lifespan>0&&(te.timeout=setTimeout(te.remove,K.lifespan))}).catch(ne=>te.error=ne)};if(globalCache.push(te),!_)throw te.promise}const suspend=(X,Z,_)=>query(X,Z,!1,_),preload=(X,Z,_)=>void query(X,Z,!0,_),clear=X=>{if(X===void 0||X.length===0)globalCache.splice(0,globalCache.length);else{const Z=globalCache.find(_=>shallowEqualArrays(X,_.keys,_.equal));Z&&Z.remove()}};var reactReconciler={exports:{}},scheduler$1={exports:{}},scheduler_production_min$1={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var hasRequiredScheduler_production_min$1;function requireScheduler_production_min$1(){return hasRequiredScheduler_production_min$1||(hasRequiredScheduler_production_min$1=1,function(X){function Z(Oe,$e){var je=Oe.length;Oe.push($e);e:for(;0<je;){var Te=je-1>>>1,De=Oe[Te];if(0<te(De,$e))Oe[Te]=$e,Oe[je]=De,je=Te;else break e}}function _(Oe){return Oe.length===0?null:Oe[0]}function K(Oe){if(Oe.length===0)return null;var $e=Oe[0],je=Oe.pop();if(je!==$e){Oe[0]=je;e:for(var Te=0,De=Oe.length,ot=De>>>1;Te<ot;){var ct=2*(Te+1)-1,gt=Oe[ct],pt=ct+1,ht=Oe[pt];if(0>te(gt,je))pt<De&&0>te(ht,gt)?(Oe[Te]=ht,Oe[pt]=je,Te=pt):(Oe[Te]=gt,Oe[ct]=je,Te=ct);else if(pt<De&&0>te(ht,je))Oe[Te]=ht,Oe[pt]=je,Te=pt;else break e}}return $e}function te(Oe,$e){var je=Oe.sortIndex-$e.sortIndex;return je!==0?je:Oe.id-$e.id}if(typeof performance=="object"&&typeof performance.now=="function"){var ne=performance;X.unstable_now=function(){return ne.now()}}else{var oe=Date,ie=oe.now();X.unstable_now=function(){return oe.now()-ie}}var se=[],ae=[],ge=1,ce=null,de=3,pe=!1,fe=!1,be=!1,me=typeof setTimeout=="function"?setTimeout:null,ye=typeof clearTimeout=="function"?clearTimeout:null,ve=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function Be(Oe){for(var $e=_(ae);$e!==null;){if($e.callback===null)K(ae);else if($e.startTime<=Oe)K(ae),$e.sortIndex=$e.expirationTime,Z(se,$e);else break;$e=_(ae)}}function Re(Oe){if(be=!1,Be(Oe),!fe)if(_(se)!==null)fe=!0,rt(Ee);else{var $e=_(ae);$e!==null&&at(Re,$e.startTime-Oe)}}function Ee(Oe,$e){fe=!1,be&&(be=!1,ye(Ve),Ve=-1),pe=!0;var je=de;try{for(Be($e),ce=_(se);ce!==null&&(!(ce.expirationTime>$e)||Oe&&!Pe());){var Te=ce.callback;if(typeof Te=="function"){ce.callback=null,de=ce.priorityLevel;var De=Te(ce.expirationTime<=$e);$e=X.unstable_now(),typeof De=="function"?ce.callback=De:ce===_(se)&&K(se),Be($e)}else K(se);ce=_(se)}if(ce!==null)var ot=!0;else{var ct=_(ae);ct!==null&&at(Re,ct.startTime-$e),ot=!1}return ot}finally{ce=null,de=je,pe=!1}}var We=!1,Ze=null,Ve=-1,_e=5,Xe=-1;function Pe(){return!(X.unstable_now()-Xe<_e)}function He(){if(Ze!==null){var Oe=X.unstable_now();Xe=Oe;var $e=!0;try{$e=Ze(!0,Oe)}finally{$e?Ke():(We=!1,Ze=null)}}else We=!1}var Ke;if(typeof ve=="function")Ke=function(){ve(He)};else if(typeof MessageChannel<"u"){var Ue=new MessageChannel,tt=Ue.port2;Ue.port1.onmessage=He,Ke=function(){tt.postMessage(null)}}else Ke=function(){me(He,0)};function rt(Oe){Ze=Oe,We||(We=!0,Ke())}function at(Oe,$e){Ve=me(function(){Oe(X.unstable_now())},$e)}X.unstable_IdlePriority=5,X.unstable_ImmediatePriority=1,X.unstable_LowPriority=4,X.unstable_NormalPriority=3,X.unstable_Profiling=null,X.unstable_UserBlockingPriority=2,X.unstable_cancelCallback=function(Oe){Oe.callback=null},X.unstable_continueExecution=function(){fe||pe||(fe=!0,rt(Ee))},X.unstable_forceFrameRate=function(Oe){0>Oe||125<Oe?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):_e=0<Oe?Math.floor(1e3/Oe):5},X.unstable_getCurrentPriorityLevel=function(){return de},X.unstable_getFirstCallbackNode=function(){return _(se)},X.unstable_next=function(Oe){switch(de){case 1:case 2:case 3:var $e=3;break;default:$e=de}var je=de;de=$e;try{return Oe()}finally{de=je}},X.unstable_pauseExecution=function(){},X.unstable_requestPaint=function(){},X.unstable_runWithPriority=function(Oe,$e){switch(Oe){case 1:case 2:case 3:case 4:case 5:break;default:Oe=3}var je=de;de=Oe;try{return $e()}finally{de=je}},X.unstable_scheduleCallback=function(Oe,$e,je){var Te=X.unstable_now();switch(typeof je=="object"&&je!==null?(je=je.delay,je=typeof je=="number"&&0<je?Te+je:Te):je=Te,Oe){case 1:var De=-1;break;case 2:De=250;break;case 5:De=1073741823;break;case 4:De=1e4;break;default:De=5e3}return De=je+De,Oe={id:ge++,callback:$e,priorityLevel:Oe,startTime:je,expirationTime:De,sortIndex:-1},je>Te?(Oe.sortIndex=je,Z(ae,Oe),_(se)===null&&Oe===_(ae)&&(be?(ye(Ve),Ve=-1):be=!0,at(Re,je-Te))):(Oe.sortIndex=De,Z(se,Oe),fe||pe||(fe=!0,rt(Ee))),Oe},X.unstable_shouldYield=Pe,X.unstable_wrapCallback=function(Oe){var $e=de;return function(){var je=de;de=$e;try{return Oe.apply(this,arguments)}finally{de=je}}}}(scheduler_production_min$1)),scheduler_production_min$1}var hasRequiredScheduler$1;function requireScheduler$1(){return hasRequiredScheduler$1||(hasRequiredScheduler$1=1,scheduler$1.exports=requireScheduler_production_min$1()),scheduler$1.exports}/**
 * @license React
 * react-reconciler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var reactReconciler_production_min,hasRequiredReactReconciler_production_min;function requireReactReconciler_production_min(){return hasRequiredReactReconciler_production_min||(hasRequiredReactReconciler_production_min=1,reactReconciler_production_min=function(Z){var _={},K=requireReact(),te=requireScheduler$1(),ne=Object.assign;function oe(Ie){for(var he="https://reactjs.org/docs/error-decoder.html?invariant="+Ie,Ge=1;Ge<arguments.length;Ge++)he+="&args[]="+encodeURIComponent(arguments[Ge]);return"Minified React error #"+Ie+"; visit "+he+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var ie=K.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,se=Symbol.for("react.element"),ae=Symbol.for("react.portal"),ge=Symbol.for("react.fragment"),ce=Symbol.for("react.strict_mode"),de=Symbol.for("react.profiler"),pe=Symbol.for("react.provider"),fe=Symbol.for("react.context"),be=Symbol.for("react.forward_ref"),me=Symbol.for("react.suspense"),ye=Symbol.for("react.suspense_list"),ve=Symbol.for("react.memo"),Be=Symbol.for("react.lazy"),Re=Symbol.for("react.offscreen"),Ee=Symbol.iterator;function We(Ie){return Ie===null||typeof Ie!="object"?null:(Ie=Ee&&Ie[Ee]||Ie["@@iterator"],typeof Ie=="function"?Ie:null)}function Ze(Ie){if(Ie==null)return null;if(typeof Ie=="function")return Ie.displayName||Ie.name||null;if(typeof Ie=="string")return Ie;switch(Ie){case ge:return"Fragment";case ae:return"Portal";case de:return"Profiler";case ce:return"StrictMode";case me:return"Suspense";case ye:return"SuspenseList"}if(typeof Ie=="object")switch(Ie.$$typeof){case fe:return(Ie.displayName||"Context")+".Consumer";case pe:return(Ie._context.displayName||"Context")+".Provider";case be:var he=Ie.render;return Ie=Ie.displayName,Ie||(Ie=he.displayName||he.name||"",Ie=Ie!==""?"ForwardRef("+Ie+")":"ForwardRef"),Ie;case ve:return he=Ie.displayName||null,he!==null?he:Ze(Ie.type)||"Memo";case Be:he=Ie._payload,Ie=Ie._init;try{return Ze(Ie(he))}catch{}}return null}function Ve(Ie){var he=Ie.type;switch(Ie.tag){case 24:return"Cache";case 9:return(he.displayName||"Context")+".Consumer";case 10:return(he._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return Ie=he.render,Ie=Ie.displayName||Ie.name||"",he.displayName||(Ie!==""?"ForwardRef("+Ie+")":"ForwardRef");case 7:return"Fragment";case 5:return he;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return Ze(he);case 8:return he===ce?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof he=="function")return he.displayName||he.name||null;if(typeof he=="string")return he}return null}function _e(Ie){var he=Ie,Ge=Ie;if(Ie.alternate)for(;he.return;)he=he.return;else{Ie=he;do he=Ie,(he.flags&4098)!==0&&(Ge=he.return),Ie=he.return;while(Ie)}return he.tag===3?Ge:null}function Xe(Ie){if(_e(Ie)!==Ie)throw Error(oe(188))}function Pe(Ie){var he=Ie.alternate;if(!he){if(he=_e(Ie),he===null)throw Error(oe(188));return he!==Ie?null:Ie}for(var Ge=Ie,we=he;;){var Le=Ge.return;if(Le===null)break;var ze=Le.alternate;if(ze===null){if(we=Le.return,we!==null){Ge=we;continue}break}if(Le.child===ze.child){for(ze=Le.child;ze;){if(ze===Ge)return Xe(Le),Ie;if(ze===we)return Xe(Le),he;ze=ze.sibling}throw Error(oe(188))}if(Ge.return!==we.return)Ge=Le,we=ze;else{for(var dt=!1,Gt=Le.child;Gt;){if(Gt===Ge){dt=!0,Ge=Le,we=ze;break}if(Gt===we){dt=!0,we=Le,Ge=ze;break}Gt=Gt.sibling}if(!dt){for(Gt=ze.child;Gt;){if(Gt===Ge){dt=!0,Ge=ze,we=Le;break}if(Gt===we){dt=!0,we=ze,Ge=Le;break}Gt=Gt.sibling}if(!dt)throw Error(oe(189))}}if(Ge.alternate!==we)throw Error(oe(190))}if(Ge.tag!==3)throw Error(oe(188));return Ge.stateNode.current===Ge?Ie:he}function He(Ie){return Ie=Pe(Ie),Ie!==null?Ke(Ie):null}function Ke(Ie){if(Ie.tag===5||Ie.tag===6)return Ie;for(Ie=Ie.child;Ie!==null;){var he=Ke(Ie);if(he!==null)return he;Ie=Ie.sibling}return null}function Ue(Ie){if(Ie.tag===5||Ie.tag===6)return Ie;for(Ie=Ie.child;Ie!==null;){if(Ie.tag!==4){var he=Ue(Ie);if(he!==null)return he}Ie=Ie.sibling}return null}var tt=Array.isArray,rt=Z.getPublicInstance,at=Z.getRootHostContext,Oe=Z.getChildHostContext,$e=Z.prepareForCommit,je=Z.resetAfterCommit,Te=Z.createInstance,De=Z.appendInitialChild,ot=Z.finalizeInitialChildren,ct=Z.prepareUpdate,gt=Z.shouldSetTextContent,pt=Z.createTextInstance,ht=Z.scheduleTimeout,At=Z.cancelTimeout,Kt=Z.noTimeout,en=Z.isPrimaryRenderer,Zt=Z.supportsMutation,st=Z.supportsPersistence,Vt=Z.supportsHydration,wt=Z.getInstanceFromNode,St=Z.preparePortalMount,Rt=Z.getCurrentEventPriority,jt=Z.detachDeletedInstance,Wt=Z.supportsMicrotasks,Ht=Z.scheduleMicrotask,Pt=Z.supportsTestSelectors,Mt=Z.findFiberRoot,un=Z.getBoundingRect,qe=Z.getTextContent,Je=Z.isHiddenSubtree,mt=Z.matchAccessibilityRole,Dt=Z.setFocusIfFocusable,_t=Z.setupIntersectionObserver,zt=Z.appendChild,nn=Z.appendChildToContainer,tn=Z.commitTextUpdate,Ft=Z.commitMount,pn=Z.commitUpdate,sn=Z.insertBefore,rn=Z.insertInContainerBefore,$t=Z.removeChild,on=Z.removeChildFromContainer,An=Z.resetTextContent,wn=Z.hideInstance,ft=Z.hideTextInstance,vt=Z.unhideInstance,Et=Z.unhideTextInstance,gn=Z.clearContainer,an=Z.cloneInstance,vn=Z.createContainerChildSet,zn=Z.appendChildToContainerChildSet,On=Z.finalizeContainerChildren,Tn=Z.replaceContainerChildren,Xn=Z.cloneHiddenInstance,dr=Z.cloneHiddenTextInstance,rr=Z.canHydrateInstance,fr=Z.canHydrateTextInstance,Nr=Z.canHydrateSuspenseInstance,ei=Z.isSuspenseInstancePending,Er=Z.isSuspenseInstanceFallback,Lr=Z.registerSuspenseInstanceRetry,br=Z.getNextHydratableSibling,kn=Z.getFirstHydratableChild,Hr=Z.getFirstHydratableChildWithinContainer,Yi=Z.getFirstHydratableChildWithinSuspenseInstance,Qe=Z.hydrateInstance,ke=Z.hydrateTextInstance,it=Z.hydrateSuspenseInstance,ut=Z.getNextHydratableInstanceAfterSuspenseInstance,lt=Z.commitHydratedContainer,It=Z.commitHydratedSuspenseInstance,Nt=Z.clearSuspenseBoundary,Xt=Z.clearSuspenseBoundaryFromContainer,Ot=Z.shouldDeleteUnhydratedTailInstances,Jt=Z.didNotMatchHydratedContainerTextInstance,qt=Z.didNotMatchHydratedTextInstance,yt;function yn(Ie){if(yt===void 0)try{throw Error()}catch(Ge){var he=Ge.stack.trim().match(/\n( *(at )?)/);yt=he&&he[1]||""}return`
`+yt+Ie}var Cn=!1;function hn(Ie,he){if(!Ie||Cn)return"";Cn=!0;var Ge=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(he)if(he=function(){throw Error()},Object.defineProperty(he.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(he,[])}catch(In){var we=In}Reflect.construct(Ie,[],he)}else{try{he.call()}catch(In){we=In}Ie.call(he.prototype)}else{try{throw Error()}catch(In){we=In}Ie()}}catch(In){if(In&&we&&typeof In.stack=="string"){for(var Le=In.stack.split(`
`),ze=we.stack.split(`
`),dt=Le.length-1,Gt=ze.length-1;1<=dt&&0<=Gt&&Le[dt]!==ze[Gt];)Gt--;for(;1<=dt&&0<=Gt;dt--,Gt--)if(Le[dt]!==ze[Gt]){if(dt!==1||Gt!==1)do if(dt--,Gt--,0>Gt||Le[dt]!==ze[Gt]){var Qt=`
`+Le[dt].replace(" at new "," at ");return Ie.displayName&&Qt.includes("<anonymous>")&&(Qt=Qt.replace("<anonymous>",Ie.displayName)),Qt}while(1<=dt&&0<=Gt);break}}}finally{Cn=!1,Error.prepareStackTrace=Ge}return(Ie=Ie?Ie.displayName||Ie.name:"")?yn(Ie):""}var xn=Object.prototype.hasOwnProperty,Hn=[],Wn=-1;function bn(Ie){return{current:Ie}}function _n(Ie){0>Wn||(Ie.current=Hn[Wn],Hn[Wn]=null,Wn--)}function Zn(Ie,he){Wn++,Hn[Wn]=Ie.current,Ie.current=he}var Nn={},gr=bn(Nn),Dn=bn(!1),cr=Nn;function tr(Ie,he){var Ge=Ie.type.contextTypes;if(!Ge)return Nn;var we=Ie.stateNode;if(we&&we.__reactInternalMemoizedUnmaskedChildContext===he)return we.__reactInternalMemoizedMaskedChildContext;var Le={},ze;for(ze in Ge)Le[ze]=he[ze];return we&&(Ie=Ie.stateNode,Ie.__reactInternalMemoizedUnmaskedChildContext=he,Ie.__reactInternalMemoizedMaskedChildContext=Le),Le}function sr(Ie){return Ie=Ie.childContextTypes,Ie!=null}function Ir(){_n(Dn),_n(gr)}function Kn(Ie,he,Ge){if(gr.current!==Nn)throw Error(oe(168));Zn(gr,he),Zn(Dn,Ge)}function yr(Ie,he,Ge){var we=Ie.stateNode;if(he=he.childContextTypes,typeof we.getChildContext!="function")return Ge;we=we.getChildContext();for(var Le in we)if(!(Le in he))throw Error(oe(108,Ve(Ie)||"Unknown",Le));return ne({},Ge,we)}function ar(Ie){return Ie=(Ie=Ie.stateNode)&&Ie.__reactInternalMemoizedMergedChildContext||Nn,cr=gr.current,Zn(gr,Ie),Zn(Dn,Dn.current),!0}function jn(Ie,he,Ge){var we=Ie.stateNode;if(!we)throw Error(oe(169));Ge?(Ie=yr(Ie,he,cr),we.__reactInternalMemoizedMergedChildContext=Ie,_n(Dn),_n(gr),Zn(gr,Ie)):_n(Dn),Zn(Dn,Ge)}var vr=Math.clz32?Math.clz32:Ki,mi=Math.log,wr=Math.LN2;function Ki(Ie){return Ie>>>=0,Ie===0?32:31-(mi(Ie)/wr|0)|0}var ho=64,or=4194304;function xo(Ie){switch(Ie&-Ie){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return Ie&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return Ie&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return Ie}}function Cs(Ie,he){var Ge=Ie.pendingLanes;if(Ge===0)return 0;var we=0,Le=Ie.suspendedLanes,ze=Ie.pingedLanes,dt=Ge&268435455;if(dt!==0){var Gt=dt&~Le;Gt!==0?we=xo(Gt):(ze&=dt,ze!==0&&(we=xo(ze)))}else dt=Ge&~Le,dt!==0?we=xo(dt):ze!==0&&(we=xo(ze));if(we===0)return 0;if(he!==0&&he!==we&&(he&Le)===0&&(Le=we&-we,ze=he&-he,Le>=ze||Le===16&&(ze&4194240)!==0))return he;if((we&4)!==0&&(we|=Ge&16),he=Ie.entangledLanes,he!==0)for(Ie=Ie.entanglements,he&=we;0<he;)Ge=31-vr(he),Le=1<<Ge,we|=Ie[Ge],he&=~Le;return we}function aa(Ie,he){switch(Ie){case 1:case 2:case 4:return he+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return he+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function la(Ie,he){for(var Ge=Ie.suspendedLanes,we=Ie.pingedLanes,Le=Ie.expirationTimes,ze=Ie.pendingLanes;0<ze;){var dt=31-vr(ze),Gt=1<<dt,Qt=Le[dt];Qt===-1?((Gt&Ge)===0||(Gt&we)!==0)&&(Le[dt]=aa(Gt,he)):Qt<=he&&(Ie.expiredLanes|=Gt),ze&=~Gt}}function Zo(Ie){return Ie=Ie.pendingLanes&-1073741825,Ie!==0?Ie:Ie&1073741824?1073741824:0}function Ws(Ie){for(var he=[],Ge=0;31>Ge;Ge++)he.push(Ie);return he}function ro(Ie,he,Ge){Ie.pendingLanes|=he,he!==536870912&&(Ie.suspendedLanes=0,Ie.pingedLanes=0),Ie=Ie.eventTimes,he=31-vr(he),Ie[he]=Ge}function fo(Ie,he){var Ge=Ie.pendingLanes&~he;Ie.pendingLanes=he,Ie.suspendedLanes=0,Ie.pingedLanes=0,Ie.expiredLanes&=he,Ie.mutableReadLanes&=he,Ie.entangledLanes&=he,he=Ie.entanglements;var we=Ie.eventTimes;for(Ie=Ie.expirationTimes;0<Ge;){var Le=31-vr(Ge),ze=1<<Le;he[Le]=0,we[Le]=-1,Ie[Le]=-1,Ge&=~ze}}function ui(Ie,he){var Ge=Ie.entangledLanes|=he;for(Ie=Ie.entanglements;Ge;){var we=31-vr(Ge),Le=1<<we;Le&he|Ie[we]&he&&(Ie[we]|=he),Ge&=~Le}}var Jn=0;function io(Ie){return Ie&=-Ie,1<Ie?4<Ie?(Ie&268435455)!==0?16:536870912:4:1}var zi=te.unstable_scheduleCallback,Eo=te.unstable_cancelCallback,oo=te.unstable_shouldYield,Al=te.unstable_requestPaint,_r=te.unstable_now,Ao=te.unstable_ImmediatePriority,ml=te.unstable_UserBlockingPriority,bi=te.unstable_NormalPriority,hs=te.unstable_IdlePriority,fs=null,Di=null;function Xo(Ie){if(Di&&typeof Di.onCommitFiberRoot=="function")try{Di.onCommitFiberRoot(fs,Ie,void 0,(Ie.current.flags&128)===128)}catch{}}function As(Ie,he){return Ie===he&&(Ie!==0||1/Ie===1/he)||Ie!==Ie&&he!==he}var ti=typeof Object.is=="function"?Object.is:As,ni=null,_o=!1,so=!1;function Fs(Ie){ni===null?ni=[Ie]:ni.push(Ie)}function ms(Ie){_o=!0,Fs(Ie)}function yi(){if(!so&&ni!==null){so=!0;var Ie=0,he=Jn;try{var Ge=ni;for(Jn=1;Ie<Ge.length;Ie++){var we=Ge[Ie];do we=we(!0);while(we!==null)}ni=null,_o=!1}catch(Le){throw ni!==null&&(ni=ni.slice(Ie+1)),zi(Ao,yi),Le}finally{Jn=he,so=!1}}return null}var bs=ie.ReactCurrentBatchConfig;function Vi(Ie,he){if(ti(Ie,he))return!0;if(typeof Ie!="object"||Ie===null||typeof he!="object"||he===null)return!1;var Ge=Object.keys(Ie),we=Object.keys(he);if(Ge.length!==we.length)return!1;for(we=0;we<Ge.length;we++){var Le=Ge[we];if(!xn.call(he,Le)||!ti(Ie[Le],he[Le]))return!1}return!0}function ko(Ie){switch(Ie.tag){case 5:return yn(Ie.type);case 16:return yn("Lazy");case 13:return yn("Suspense");case 19:return yn("SuspenseList");case 0:case 2:case 15:return Ie=hn(Ie.type,!1),Ie;case 11:return Ie=hn(Ie.type.render,!1),Ie;case 1:return Ie=hn(Ie.type,!0),Ie;default:return""}}function ri(Ie,he){if(Ie&&Ie.defaultProps){he=ne({},he),Ie=Ie.defaultProps;for(var Ge in Ie)he[Ge]===void 0&&(he[Ge]=Ie[Ge]);return he}return he}var Jr=bn(null),Yo=null,Ti=null,Ko=null;function ii(){Ko=Ti=Yo=null}function zo(Ie,he,Ge){en?(Zn(Jr,he._currentValue),he._currentValue=Ge):(Zn(Jr,he._currentValue2),he._currentValue2=Ge)}function Ur(Ie){var he=Jr.current;_n(Jr),en?Ie._currentValue=he:Ie._currentValue2=he}function Qr(Ie,he,Ge){for(;Ie!==null;){var we=Ie.alternate;if((Ie.childLanes&he)!==he?(Ie.childLanes|=he,we!==null&&(we.childLanes|=he)):we!==null&&(we.childLanes&he)!==he&&(we.childLanes|=he),Ie===Ge)break;Ie=Ie.return}}function Kr(Ie,he){Yo=Ie,Ko=Ti=null,Ie=Ie.dependencies,Ie!==null&&Ie.firstContext!==null&&((Ie.lanes&he)!==0&&(li=!0),Ie.firstContext=null)}function Fr(Ie){var he=en?Ie._currentValue:Ie._currentValue2;if(Ko!==Ie)if(Ie={context:Ie,memoizedValue:he,next:null},Ti===null){if(Yo===null)throw Error(oe(308));Ti=Ie,Yo.dependencies={lanes:0,firstContext:Ie}}else Ti=Ti.next=Ie;return he}var wi=null,ao=!1;function ga(Ie){Ie.updateQueue={baseState:Ie.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function lg(Ie,he){Ie=Ie.updateQueue,he.updateQueue===Ie&&(he.updateQueue={baseState:Ie.baseState,firstBaseUpdate:Ie.firstBaseUpdate,lastBaseUpdate:Ie.lastBaseUpdate,shared:Ie.shared,effects:Ie.effects})}function Do(Ie,he){return{eventTime:Ie,lane:he,tag:0,payload:null,callback:null,next:null}}function ys(Ie,he){var Ge=Ie.updateQueue;Ge!==null&&(Ge=Ge.shared,Dr!==null&&(Ie.mode&1)!==0&&(nr&2)===0?(Ie=Ge.interleaved,Ie===null?(he.next=he,wi===null?wi=[Ge]:wi.push(Ge)):(he.next=Ie.next,Ie.next=he),Ge.interleaved=he):(Ie=Ge.pending,Ie===null?he.next=he:(he.next=Ie.next,Ie.next=he),Ge.pending=he))}function bl(Ie,he,Ge){if(he=he.updateQueue,he!==null&&(he=he.shared,(Ge&4194240)!==0)){var we=he.lanes;we&=Ie.pendingLanes,Ge|=we,he.lanes=Ge,ui(Ie,Ge)}}function yl(Ie,he){var Ge=Ie.updateQueue,we=Ie.alternate;if(we!==null&&(we=we.updateQueue,Ge===we)){var Le=null,ze=null;if(Ge=Ge.firstBaseUpdate,Ge!==null){do{var dt={eventTime:Ge.eventTime,lane:Ge.lane,tag:Ge.tag,payload:Ge.payload,callback:Ge.callback,next:null};ze===null?Le=ze=dt:ze=ze.next=dt,Ge=Ge.next}while(Ge!==null);ze===null?Le=ze=he:ze=ze.next=he}else Le=ze=he;Ge={baseState:we.baseState,firstBaseUpdate:Le,lastBaseUpdate:ze,shared:we.shared,effects:we.effects},Ie.updateQueue=Ge;return}Ie=Ge.lastBaseUpdate,Ie===null?Ge.firstBaseUpdate=he:Ie.next=he,Ge.lastBaseUpdate=he}function vl(Ie,he,Ge,we){var Le=Ie.updateQueue;ao=!1;var ze=Le.firstBaseUpdate,dt=Le.lastBaseUpdate,Gt=Le.shared.pending;if(Gt!==null){Le.shared.pending=null;var Qt=Gt,In=Qt.next;Qt.next=null,dt===null?ze=In:dt.next=In,dt=Qt;var Rn=Ie.alternate;Rn!==null&&(Rn=Rn.updateQueue,Gt=Rn.lastBaseUpdate,Gt!==dt&&(Gt===null?Rn.firstBaseUpdate=In:Gt.next=In,Rn.lastBaseUpdate=Qt))}if(ze!==null){var $n=Le.baseState;dt=0,Rn=In=Qt=null,Gt=ze;do{var Yn=Gt.lane,ir=Gt.eventTime;if((we&Yn)===Yn){Rn!==null&&(Rn=Rn.next={eventTime:ir,lane:0,tag:Gt.tag,payload:Gt.payload,callback:Gt.callback,next:null});e:{var Gn=Ie,fi=Gt;switch(Yn=he,ir=Ge,fi.tag){case 1:if(Gn=fi.payload,typeof Gn=="function"){$n=Gn.call(ir,$n,Yn);break e}$n=Gn;break e;case 3:Gn.flags=Gn.flags&-65537|128;case 0:if(Gn=fi.payload,Yn=typeof Gn=="function"?Gn.call(ir,$n,Yn):Gn,Yn==null)break e;$n=ne({},$n,Yn);break e;case 2:ao=!0}}Gt.callback!==null&&Gt.lane!==0&&(Ie.flags|=64,Yn=Le.effects,Yn===null?Le.effects=[Gt]:Yn.push(Gt))}else ir={eventTime:ir,lane:Yn,tag:Gt.tag,payload:Gt.payload,callback:Gt.callback,next:null},Rn===null?(In=Rn=ir,Qt=$n):Rn=Rn.next=ir,dt|=Yn;if(Gt=Gt.next,Gt===null){if(Gt=Le.shared.pending,Gt===null)break;Yn=Gt,Gt=Yn.next,Yn.next=null,Le.lastBaseUpdate=Yn,Le.shared.pending=null}}while(!0);if(Rn===null&&(Qt=$n),Le.baseState=Qt,Le.firstBaseUpdate=In,Le.lastBaseUpdate=Rn,he=Le.shared.interleaved,he!==null){Le=he;do dt|=Le.lane,Le=Le.next;while(Le!==he)}else ze===null&&(Le.shared.lanes=0);Vo|=dt,Ie.lanes=dt,Ie.memoizedState=$n}}function qg(Ie,he,Ge){if(Ie=he.effects,he.effects=null,Ie!==null)for(he=0;he<Ie.length;he++){var we=Ie[he],Le=we.callback;if(Le!==null){if(we.callback=null,we=Ge,typeof Le!="function")throw Error(oe(191,Le));Le.call(we)}}}var ec=new K.Component().refs;function gg(Ie,he,Ge,we){he=Ie.memoizedState,Ge=Ge(we,he),Ge=Ge==null?he:ne({},he,Ge),Ie.memoizedState=Ge,Ie.lanes===0&&(Ie.updateQueue.baseState=Ge)}var Bl={isMounted:function(Ie){return(Ie=Ie._reactInternals)?_e(Ie)===Ie:!1},enqueueSetState:function(Ie,he,Ge){Ie=Ie._reactInternals;var we=pr(),Le=So(Ie),ze=Do(we,Le);ze.payload=he,Ge!=null&&(ze.callback=Ge),ys(Ie,ze),he=Gi(Ie,Le,we),he!==null&&bl(he,Ie,Le)},enqueueReplaceState:function(Ie,he,Ge){Ie=Ie._reactInternals;var we=pr(),Le=So(Ie),ze=Do(we,Le);ze.tag=1,ze.payload=he,Ge!=null&&(ze.callback=Ge),ys(Ie,ze),he=Gi(Ie,Le,we),he!==null&&bl(he,Ie,Le)},enqueueForceUpdate:function(Ie,he){Ie=Ie._reactInternals;var Ge=pr(),we=So(Ie),Le=Do(Ge,we);Le.tag=2,he!=null&&(Le.callback=he),ys(Ie,Le),he=Gi(Ie,we,Ge),he!==null&&bl(he,Ie,we)}};function cg(Ie,he,Ge,we,Le,ze,dt){return Ie=Ie.stateNode,typeof Ie.shouldComponentUpdate=="function"?Ie.shouldComponentUpdate(we,ze,dt):he.prototype&&he.prototype.isPureReactComponent?!Vi(Ge,we)||!Vi(Le,ze):!0}function tc(Ie,he,Ge){var we=!1,Le=Nn,ze=he.contextType;return typeof ze=="object"&&ze!==null?ze=Fr(ze):(Le=sr(he)?cr:gr.current,we=he.contextTypes,ze=(we=we!=null)?tr(Ie,Le):Nn),he=new he(Ge,ze),Ie.memoizedState=he.state!==null&&he.state!==void 0?he.state:null,he.updater=Bl,Ie.stateNode=he,he._reactInternals=Ie,we&&(Ie=Ie.stateNode,Ie.__reactInternalMemoizedUnmaskedChildContext=Le,Ie.__reactInternalMemoizedMaskedChildContext=ze),he}function nc(Ie,he,Ge,we){Ie=he.state,typeof he.componentWillReceiveProps=="function"&&he.componentWillReceiveProps(Ge,we),typeof he.UNSAFE_componentWillReceiveProps=="function"&&he.UNSAFE_componentWillReceiveProps(Ge,we),he.state!==Ie&&Bl.enqueueReplaceState(he,he.state,null)}function ug(Ie,he,Ge,we){var Le=Ie.stateNode;Le.props=Ge,Le.state=Ie.memoizedState,Le.refs=ec,ga(Ie);var ze=he.contextType;typeof ze=="object"&&ze!==null?Le.context=Fr(ze):(ze=sr(he)?cr:gr.current,Le.context=tr(Ie,ze)),Le.state=Ie.memoizedState,ze=he.getDerivedStateFromProps,typeof ze=="function"&&(gg(Ie,he,ze,Ge),Le.state=Ie.memoizedState),typeof he.getDerivedStateFromProps=="function"||typeof Le.getSnapshotBeforeUpdate=="function"||typeof Le.UNSAFE_componentWillMount!="function"&&typeof Le.componentWillMount!="function"||(he=Le.state,typeof Le.componentWillMount=="function"&&Le.componentWillMount(),typeof Le.UNSAFE_componentWillMount=="function"&&Le.UNSAFE_componentWillMount(),he!==Le.state&&Bl.enqueueReplaceState(Le,Le.state,null),vl(Ie,Ge,Le,we),Le.state=Ie.memoizedState),typeof Le.componentDidMount=="function"&&(Ie.flags|=4194308)}var ca=[],vs=0,Gl=null,Sl=0,lo=[],Ui=0,Vs=null,Uo=1,Po="";function Ts(Ie,he){ca[vs++]=Sl,ca[vs++]=Gl,Gl=Ie,Sl=he}function rc(Ie,he,Ge){lo[Ui++]=Uo,lo[Ui++]=Po,lo[Ui++]=Vs,Vs=Ie;var we=Uo;Ie=Po;var Le=32-vr(we)-1;we&=~(1<<Le),Ge+=1;var ze=32-vr(he)+Le;if(30<ze){var dt=Le-Le%5;ze=(we&(1<<dt)-1).toString(32),we>>=dt,Le-=dt,Uo=1<<32-vr(he)+Le|Ge<<Le|we,Po=ze+Ie}else Uo=1<<ze|Ge<<Le|we,Po=Ie}function dg(Ie){Ie.return!==null&&(Ts(Ie,1),rc(Ie,1,0))}function Ig(Ie){for(;Ie===Gl;)Gl=ca[--vs],ca[vs]=null,Sl=ca[--vs],ca[vs]=null;for(;Ie===Vs;)Vs=lo[--Ui],lo[Ui]=null,Po=lo[--Ui],lo[Ui]=null,Uo=lo[--Ui],lo[Ui]=null}var xi=null,di=null,Mr=!1,ua=!1,go=null;function pg(Ie,he){var Ge=qi(5,null,null,0);Ge.elementType="DELETED",Ge.stateNode=he,Ge.return=Ie,he=Ie.deletions,he===null?(Ie.deletions=[Ge],Ie.flags|=16):he.push(Ge)}function Cg(Ie,he){switch(Ie.tag){case 5:return he=rr(he,Ie.type,Ie.pendingProps),he!==null?(Ie.stateNode=he,xi=Ie,di=kn(he),!0):!1;case 6:return he=fr(he,Ie.pendingProps),he!==null?(Ie.stateNode=he,xi=Ie,di=null,!0):!1;case 13:if(he=Nr(he),he!==null){var Ge=Vs!==null?{id:Uo,overflow:Po}:null;return Ie.memoizedState={dehydrated:he,treeContext:Ge,retryLane:1073741824},Ge=qi(18,null,null,0),Ge.stateNode=he,Ge.return=Ie,Ie.child=Ge,xi=Ie,di=null,!0}return!1;default:return!1}}function Rl(Ie){return(Ie.mode&1)!==0&&(Ie.flags&128)===0}function Bs(Ie){if(Mr){var he=di;if(he){var Ge=he;if(!Cg(Ie,he)){if(Rl(Ie))throw Error(oe(418));he=br(Ge);var we=xi;he&&Cg(Ie,he)?pg(we,Ge):(Ie.flags=Ie.flags&-4097|2,Mr=!1,xi=Ie)}}else{if(Rl(Ie))throw Error(oe(418));Ie.flags=Ie.flags&-4097|2,Mr=!1,xi=Ie}}}function ic(Ie){for(Ie=Ie.return;Ie!==null&&Ie.tag!==5&&Ie.tag!==3&&Ie.tag!==13;)Ie=Ie.return;xi=Ie}function La(Ie){if(!Vt||Ie!==xi)return!1;if(!Mr)return ic(Ie),Mr=!0,!1;if(Ie.tag!==3&&(Ie.tag!==5||Ot(Ie.type)&&!gt(Ie.type,Ie.memoizedProps))){var he=di;if(he){if(Rl(Ie)){for(Ie=di;Ie;)Ie=br(Ie);throw Error(oe(418))}for(;he;)pg(Ie,he),he=br(he)}}if(ic(Ie),Ie.tag===13){if(!Vt)throw Error(oe(316));if(Ie=Ie.memoizedState,Ie=Ie!==null?Ie.dehydrated:null,!Ie)throw Error(oe(317));di=ut(Ie)}else di=xi?br(Ie.stateNode):null;return!0}function da(){Vt&&(di=xi=null,ua=Mr=!1)}function wl(Ie){go===null?go=[Ie]:go.push(Ie)}function Ia(Ie,he,Ge){if(Ie=Ge.ref,Ie!==null&&typeof Ie!="function"&&typeof Ie!="object"){if(Ge._owner){if(Ge=Ge._owner,Ge){if(Ge.tag!==1)throw Error(oe(309));var we=Ge.stateNode}if(!we)throw Error(oe(147,Ie));var Le=we,ze=""+Ie;return he!==null&&he.ref!==null&&typeof he.ref=="function"&&he.ref._stringRef===ze?he.ref:(he=function(dt){var Gt=Le.refs;Gt===ec&&(Gt=Le.refs={}),dt===null?delete Gt[ze]:Gt[ze]=dt},he._stringRef=ze,he)}if(typeof Ie!="string")throw Error(oe(284));if(!Ge._owner)throw Error(oe(290,Ie))}return Ie}function Gs(Ie,he){throw Ie=Object.prototype.toString.call(he),Error(oe(31,Ie==="[object Object]"?"object with keys {"+Object.keys(he).join(", ")+"}":Ie))}function pa(Ie){var he=Ie._init;return he(Ie._payload)}function oc(Ie){function he(kt,xt){if(Ie){var Ut=kt.deletions;Ut===null?(kt.deletions=[xt],kt.flags|=16):Ut.push(xt)}}function Ge(kt,xt){if(!Ie)return null;for(;xt!==null;)he(kt,xt),xt=xt.sibling;return null}function we(kt,xt){for(kt=new Map;xt!==null;)xt.key!==null?kt.set(xt.key,xt):kt.set(xt.index,xt),xt=xt.sibling;return kt}function Le(kt,xt){return kt=cs(kt,xt),kt.index=0,kt.sibling=null,kt}function ze(kt,xt,Ut){return kt.index=Ut,Ie?(Ut=kt.alternate,Ut!==null?(Ut=Ut.index,Ut<xt?(kt.flags|=2,xt):Ut):(kt.flags|=2,xt)):(kt.flags|=1048576,xt)}function dt(kt){return Ie&&kt.alternate===null&&(kt.flags|=2),kt}function Gt(kt,xt,Ut,Bn){return xt===null||xt.tag!==6?(xt=eg(Ut,kt.mode,Bn),xt.return=kt,xt):(xt=Le(xt,Ut),xt.return=kt,xt)}function Qt(kt,xt,Ut,Bn){var Vn=Ut.type;return Vn===ge?Rn(kt,xt,Ut.props.children,Bn,Ut.key):xt!==null&&(xt.elementType===Vn||typeof Vn=="object"&&Vn!==null&&Vn.$$typeof===Be&&pa(Vn)===xt.type)?(Bn=Le(xt,Ut.props),Bn.ref=Ia(kt,xt,Ut),Bn.return=kt,Bn):(Bn=ql(Ut.type,Ut.key,Ut.props,null,kt.mode,Bn),Bn.ref=Ia(kt,xt,Ut),Bn.return=kt,Bn)}function In(kt,xt,Ut,Bn){return xt===null||xt.tag!==4||xt.stateNode.containerInfo!==Ut.containerInfo||xt.stateNode.implementation!==Ut.implementation?(xt=tg(Ut,kt.mode,Bn),xt.return=kt,xt):(xt=Le(xt,Ut.children||[]),xt.return=kt,xt)}function Rn(kt,xt,Ut,Bn,Vn){return xt===null||xt.tag!==7?(xt=ia(Ut,kt.mode,Bn,Vn),xt.return=kt,xt):(xt=Le(xt,Ut),xt.return=kt,xt)}function $n(kt,xt,Ut){if(typeof xt=="string"&&xt!==""||typeof xt=="number")return xt=eg(""+xt,kt.mode,Ut),xt.return=kt,xt;if(typeof xt=="object"&&xt!==null){switch(xt.$$typeof){case se:return Ut=ql(xt.type,xt.key,xt.props,null,kt.mode,Ut),Ut.ref=Ia(kt,null,xt),Ut.return=kt,Ut;case ae:return xt=tg(xt,kt.mode,Ut),xt.return=kt,xt;case Be:var Bn=xt._init;return $n(kt,Bn(xt._payload),Ut)}if(tt(xt)||We(xt))return xt=ia(xt,kt.mode,Ut,null),xt.return=kt,xt;Gs(kt,xt)}return null}function Yn(kt,xt,Ut,Bn){var Vn=xt!==null?xt.key:null;if(typeof Ut=="string"&&Ut!==""||typeof Ut=="number")return Vn!==null?null:Gt(kt,xt,""+Ut,Bn);if(typeof Ut=="object"&&Ut!==null){switch(Ut.$$typeof){case se:return Ut.key===Vn?Qt(kt,xt,Ut,Bn):null;case ae:return Ut.key===Vn?In(kt,xt,Ut,Bn):null;case Be:return Vn=Ut._init,Yn(kt,xt,Vn(Ut._payload),Bn)}if(tt(Ut)||We(Ut))return Vn!==null?null:Rn(kt,xt,Ut,Bn,null);Gs(kt,Ut)}return null}function ir(kt,xt,Ut,Bn,Vn){if(typeof Bn=="string"&&Bn!==""||typeof Bn=="number")return kt=kt.get(Ut)||null,Gt(xt,kt,""+Bn,Vn);if(typeof Bn=="object"&&Bn!==null){switch(Bn.$$typeof){case se:return kt=kt.get(Bn.key===null?Ut:Bn.key)||null,Qt(xt,kt,Bn,Vn);case ae:return kt=kt.get(Bn.key===null?Ut:Bn.key)||null,In(xt,kt,Bn,Vn);case Be:var er=Bn._init;return ir(kt,xt,Ut,er(Bn._payload),Vn)}if(tt(Bn)||We(Bn))return kt=kt.get(Ut)||null,Rn(xt,kt,Bn,Vn,null);Gs(xt,Bn)}return null}function Gn(kt,xt,Ut,Bn){for(var Vn=null,er=null,qn=xt,ur=xt=0,Or=null;qn!==null&&ur<Ut.length;ur++){qn.index>ur?(Or=qn,qn=null):Or=qn.sibling;var lr=Yn(kt,qn,Ut[ur],Bn);if(lr===null){qn===null&&(qn=Or);break}Ie&&qn&&lr.alternate===null&&he(kt,qn),xt=ze(lr,xt,ur),er===null?Vn=lr:er.sibling=lr,er=lr,qn=Or}if(ur===Ut.length)return Ge(kt,qn),Mr&&Ts(kt,ur),Vn;if(qn===null){for(;ur<Ut.length;ur++)qn=$n(kt,Ut[ur],Bn),qn!==null&&(xt=ze(qn,xt,ur),er===null?Vn=qn:er.sibling=qn,er=qn);return Mr&&Ts(kt,ur),Vn}for(qn=we(kt,qn);ur<Ut.length;ur++)Or=ir(qn,kt,ur,Ut[ur],Bn),Or!==null&&(Ie&&Or.alternate!==null&&qn.delete(Or.key===null?ur:Or.key),xt=ze(Or,xt,ur),er===null?Vn=Or:er.sibling=Or,er=Or);return Ie&&qn.forEach(function(us){return he(kt,us)}),Mr&&Ts(kt,ur),Vn}function fi(kt,xt,Ut,Bn){var Vn=We(Ut);if(typeof Vn!="function")throw Error(oe(150));if(Ut=Vn.call(Ut),Ut==null)throw Error(oe(151));for(var er=Vn=null,qn=xt,ur=xt=0,Or=null,lr=Ut.next();qn!==null&&!lr.done;ur++,lr=Ut.next()){qn.index>ur?(Or=qn,qn=null):Or=qn.sibling;var us=Yn(kt,qn,lr.value,Bn);if(us===null){qn===null&&(qn=Or);break}Ie&&qn&&us.alternate===null&&he(kt,qn),xt=ze(us,xt,ur),er===null?Vn=us:er.sibling=us,er=us,qn=Or}if(lr.done)return Ge(kt,qn),Mr&&Ts(kt,ur),Vn;if(qn===null){for(;!lr.done;ur++,lr=Ut.next())lr=$n(kt,lr.value,Bn),lr!==null&&(xt=ze(lr,xt,ur),er===null?Vn=lr:er.sibling=lr,er=lr);return Mr&&Ts(kt,ur),Vn}for(qn=we(kt,qn);!lr.done;ur++,lr=Ut.next())lr=ir(qn,kt,ur,lr.value,Bn),lr!==null&&(Ie&&lr.alternate!==null&&qn.delete(lr.key===null?ur:lr.key),xt=ze(lr,xt,ur),er===null?Vn=lr:er.sibling=lr,er=lr);return Ie&&qn.forEach(function(Ug){return he(kt,Ug)}),Mr&&Ts(kt,ur),Vn}function eo(kt,xt,Ut,Bn){if(typeof Ut=="object"&&Ut!==null&&Ut.type===ge&&Ut.key===null&&(Ut=Ut.props.children),typeof Ut=="object"&&Ut!==null){switch(Ut.$$typeof){case se:e:{for(var Vn=Ut.key,er=xt;er!==null;){if(er.key===Vn){if(Vn=Ut.type,Vn===ge){if(er.tag===7){Ge(kt,er.sibling),xt=Le(er,Ut.props.children),xt.return=kt,kt=xt;break e}}else if(er.elementType===Vn||typeof Vn=="object"&&Vn!==null&&Vn.$$typeof===Be&&pa(Vn)===er.type){Ge(kt,er.sibling),xt=Le(er,Ut.props),xt.ref=Ia(kt,er,Ut),xt.return=kt,kt=xt;break e}Ge(kt,er);break}else he(kt,er);er=er.sibling}Ut.type===ge?(xt=ia(Ut.props.children,kt.mode,Bn,Ut.key),xt.return=kt,kt=xt):(Bn=ql(Ut.type,Ut.key,Ut.props,null,kt.mode,Bn),Bn.ref=Ia(kt,xt,Ut),Bn.return=kt,kt=Bn)}return dt(kt);case ae:e:{for(er=Ut.key;xt!==null;){if(xt.key===er)if(xt.tag===4&&xt.stateNode.containerInfo===Ut.containerInfo&&xt.stateNode.implementation===Ut.implementation){Ge(kt,xt.sibling),xt=Le(xt,Ut.children||[]),xt.return=kt,kt=xt;break e}else{Ge(kt,xt);break}else he(kt,xt);xt=xt.sibling}xt=tg(Ut,kt.mode,Bn),xt.return=kt,kt=xt}return dt(kt);case Be:return er=Ut._init,eo(kt,xt,er(Ut._payload),Bn)}if(tt(Ut))return Gn(kt,xt,Ut,Bn);if(We(Ut))return fi(kt,xt,Ut,Bn);Gs(kt,Ut)}return typeof Ut=="string"&&Ut!==""||typeof Ut=="number"?(Ut=""+Ut,xt!==null&&xt.tag===6?(Ge(kt,xt.sibling),xt=Le(xt,Ut),xt.return=kt,kt=xt):(Ge(kt,xt),xt=eg(Ut,kt.mode,Bn),xt.return=kt,kt=xt),dt(kt)):Ge(kt,xt)}return eo}var Oo=oc(!0),sc=oc(!1),Ca={},Ni=bn(Ca),Ns=bn(Ca),Ls=bn(Ca);function mo(Ie){if(Ie===Ca)throw Error(oe(174));return Ie}function xl(Ie,he){Zn(Ls,he),Zn(Ns,Ie),Zn(Ni,Ca),Ie=at(he),_n(Ni),Zn(Ni,Ie)}function ha(){_n(Ni),_n(Ns),_n(Ls)}function ac(Ie){var he=mo(Ls.current),Ge=mo(Ni.current);he=Oe(Ge,Ie.type,he),Ge!==he&&(Zn(Ns,Ie),Zn(Ni,he))}function hg(Ie){Ns.current===Ie&&(_n(Ni),_n(Ns))}var Vr=bn(0);function Zl(Ie){for(var he=Ie;he!==null;){if(he.tag===13){var Ge=he.memoizedState;if(Ge!==null&&(Ge=Ge.dehydrated,Ge===null||ei(Ge)||Er(Ge)))return he}else if(he.tag===19&&he.memoizedProps.revealOrder!==void 0){if((he.flags&128)!==0)return he}else if(he.child!==null){he.child.return=he,he=he.child;continue}if(he===Ie)break;for(;he.sibling===null;){if(he.return===null||he.return===Ie)return null;he=he.return}he.sibling.return=he.return,he=he.sibling}return null}var Pi=[];function Hs(){for(var Ie=0;Ie<Pi.length;Ie++){var he=Pi[Ie];en?he._workInProgressVersionPrimary=null:he._workInProgressVersionSecondary=null}Pi.length=0}var Ha=ie.ReactCurrentDispatcher,Oi=ie.ReactCurrentBatchConfig,Xs=0,Tr=null,oi=null,si=null,El=!1,Mo=!1,ks=0,Xa=0;function ai(){throw Error(oe(321))}function _l(Ie,he){if(he===null)return!1;for(var Ge=0;Ge<he.length&&Ge<Ie.length;Ge++)if(!ti(Ie[Ge],he[Ge]))return!1;return!0}function fa(Ie,he,Ge,we,Le,ze){if(Xs=ze,Tr=he,he.memoizedState=null,he.updateQueue=null,he.lanes=0,Ha.current=Ie===null||Ie.memoizedState===null?vg:Bg,Ie=Ge(we,Le),Mo){ze=0;do{if(Mo=!1,ks=0,25<=ze)throw Error(oe(301));ze+=1,si=oi=null,he.updateQueue=null,Ha.current=Gg,Ie=Ge(we,Le)}while(Mo)}if(Ha.current=ya,he=oi!==null&&oi.next!==null,Xs=0,si=oi=Tr=null,El=!1,he)throw Error(oe(300));return Ie}function Ss(){var Ie=ks!==0;return ks=0,Ie}function bo(){var Ie={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return si===null?Tr.memoizedState=si=Ie:si=si.next=Ie,si}function yo(){if(oi===null){var Ie=Tr.alternate;Ie=Ie!==null?Ie.memoizedState:null}else Ie=oi.next;var he=si===null?Tr.memoizedState:si.next;if(he!==null)si=he,oi=Ie;else{if(Ie===null)throw Error(oe(310));oi=Ie,Ie={memoizedState:oi.memoizedState,baseState:oi.baseState,baseQueue:oi.baseQueue,queue:oi.queue,next:null},si===null?Tr.memoizedState=si=Ie:si=si.next=Ie}return si}function Wo(Ie,he){return typeof he=="function"?he(Ie):he}function ka(Ie){var he=yo(),Ge=he.queue;if(Ge===null)throw Error(oe(311));Ge.lastRenderedReducer=Ie;var we=oi,Le=we.baseQueue,ze=Ge.pending;if(ze!==null){if(Le!==null){var dt=Le.next;Le.next=ze.next,ze.next=dt}we.baseQueue=Le=ze,Ge.pending=null}if(Le!==null){ze=Le.next,we=we.baseState;var Gt=dt=null,Qt=null,In=ze;do{var Rn=In.lane;if((Xs&Rn)===Rn)Qt!==null&&(Qt=Qt.next={lane:0,action:In.action,hasEagerState:In.hasEagerState,eagerState:In.eagerState,next:null}),we=In.hasEagerState?In.eagerState:Ie(we,In.action);else{var $n={lane:Rn,action:In.action,hasEagerState:In.hasEagerState,eagerState:In.eagerState,next:null};Qt===null?(Gt=Qt=$n,dt=we):Qt=Qt.next=$n,Tr.lanes|=Rn,Vo|=Rn}In=In.next}while(In!==null&&In!==ze);Qt===null?dt=we:Qt.next=Gt,ti(we,he.memoizedState)||(li=!0),he.memoizedState=we,he.baseState=dt,he.baseQueue=Qt,Ge.lastRenderedState=we}if(Ie=Ge.interleaved,Ie!==null){Le=Ie;do ze=Le.lane,Tr.lanes|=ze,Vo|=ze,Le=Le.next;while(Le!==Ie)}else Le===null&&(Ge.lanes=0);return[he.memoizedState,Ge.dispatch]}function Ya(Ie){var he=yo(),Ge=he.queue;if(Ge===null)throw Error(oe(311));Ge.lastRenderedReducer=Ie;var we=Ge.dispatch,Le=Ge.pending,ze=he.memoizedState;if(Le!==null){Ge.pending=null;var dt=Le=Le.next;do ze=Ie(ze,dt.action),dt=dt.next;while(dt!==Le);ti(ze,he.memoizedState)||(li=!0),he.memoizedState=ze,he.baseQueue===null&&(he.baseState=ze),Ge.lastRenderedState=ze}return[ze,we]}function fg(){}function Ag(Ie,he){var Ge=Tr,we=yo(),Le=he(),ze=!ti(we.memoizedState,Le);if(ze&&(we.memoizedState=Le,li=!0),we=we.queue,Aa(jo.bind(null,Ge,we,Ie),[Ie]),we.getSnapshot!==he||ze||si!==null&&si.memoizedState.tag&1){if(Ge.flags|=2048,za(9,bg.bind(null,Ge,we,Le,he),void 0,null),Dr===null)throw Error(oe(349));(Xs&30)!==0||mg(Ge,he,Le)}return Le}function mg(Ie,he,Ge){Ie.flags|=16384,Ie={getSnapshot:he,value:Ge},he=Tr.updateQueue,he===null?(he={lastEffect:null,stores:null},Tr.updateQueue=he,he.stores=[Ie]):(Ge=he.stores,Ge===null?he.stores=[Ie]:Ge.push(Ie))}function bg(Ie,he,Ge,we){he.value=Ge,he.getSnapshot=we,Ml(he)&&Gi(Ie,1,-1)}function jo(Ie,he,Ge){return Ge(function(){Ml(he)&&Gi(Ie,1,-1)})}function Ml(Ie){var he=Ie.getSnapshot;Ie=Ie.value;try{var Ge=he();return!ti(Ie,Ge)}catch{return!0}}function Ka(Ie){var he=bo();return typeof Ie=="function"&&(Ie=Ie()),he.memoizedState=he.baseState=Ie,Ie={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Wo,lastRenderedState:Ie},he.queue=Ie,Ie=Ie.dispatch=Kc.bind(null,Tr,Ie),[he.memoizedState,Ie]}function za(Ie,he,Ge,we){return Ie={tag:Ie,create:he,destroy:Ge,deps:we,next:null},he=Tr.updateQueue,he===null?(he={lastEffect:null,stores:null},Tr.updateQueue=he,he.lastEffect=Ie.next=Ie):(Ge=he.lastEffect,Ge===null?he.lastEffect=Ie.next=Ie:(we=Ge.next,Ge.next=Ie,Ie.next=we,he.lastEffect=Ie)),Ie}function lc(){return yo().memoizedState}function Rs(Ie,he,Ge,we){var Le=bo();Tr.flags|=Ie,Le.memoizedState=za(1|he,Ge,void 0,we===void 0?null:we)}function Wl(Ie,he,Ge,we){var Le=yo();we=we===void 0?null:we;var ze=void 0;if(oi!==null){var dt=oi.memoizedState;if(ze=dt.destroy,we!==null&&_l(we,dt.deps)){Le.memoizedState=za(he,Ge,ze,we);return}}Tr.flags|=Ie,Le.memoizedState=za(1|he,Ge,ze,we)}function Fl(Ie,he){return Rs(8390656,8,Ie,he)}function Aa(Ie,he){return Wl(2048,8,Ie,he)}function Gr(Ie,he){return Wl(4,2,Ie,he)}function Vl(Ie,he){return Wl(4,4,Ie,he)}function Da(Ie,he){if(typeof he=="function")return Ie=Ie(),he(Ie),function(){he(null)};if(he!=null)return Ie=Ie(),he.current=Ie,function(){he.current=null}}function ma(Ie,he,Ge){return Ge=Ge!=null?Ge.concat([Ie]):null,Wl(4,4,Da.bind(null,he,Ie),Ge)}function Tl(){}function Nl(Ie,he){var Ge=yo();he=he===void 0?null:he;var we=Ge.memoizedState;return we!==null&&he!==null&&_l(he,we[1])?we[0]:(Ge.memoizedState=[Ie,he],Ie)}function ba(Ie,he){var Ge=yo();he=he===void 0?null:he;var we=Ge.memoizedState;return we!==null&&he!==null&&_l(he,we[1])?we[0]:(Ie=Ie(),Ge.memoizedState=[Ie,he],Ie)}function Ll(Ie,he){var Ge=Jn;Jn=Ge!==0&&4>Ge?Ge:4,Ie(!0);var we=Oi.transition;Oi.transition={};try{Ie(!1),he()}finally{Jn=Ge,Oi.transition=we}}function Ys(){return yo().memoizedState}function gc(Ie,he,Ge){var we=So(Ie);Ge={lane:we,action:Ge,hasEagerState:!1,eagerState:null,next:null},cc(Ie)?yg(he,Ge):(Ua(Ie,he,Ge),Ge=pr(),Ie=Gi(Ie,we,Ge),Ie!==null&&Pa(Ie,he,we))}function Kc(Ie,he,Ge){var we=So(Ie),Le={lane:we,action:Ge,hasEagerState:!1,eagerState:null,next:null};if(cc(Ie))yg(he,Le);else{Ua(Ie,he,Le);var ze=Ie.alternate;if(Ie.lanes===0&&(ze===null||ze.lanes===0)&&(ze=he.lastRenderedReducer,ze!==null))try{var dt=he.lastRenderedState,Gt=ze(dt,Ge);if(Le.hasEagerState=!0,Le.eagerState=Gt,ti(Gt,dt))return}catch{}finally{}Ge=pr(),Ie=Gi(Ie,we,Ge),Ie!==null&&Pa(Ie,he,we)}}function cc(Ie){var he=Ie.alternate;return Ie===Tr||he!==null&&he===Tr}function yg(Ie,he){Mo=El=!0;var Ge=Ie.pending;Ge===null?he.next=he:(he.next=Ge.next,Ge.next=he),Ie.pending=he}function Ua(Ie,he,Ge){Dr!==null&&(Ie.mode&1)!==0&&(nr&2)===0?(Ie=he.interleaved,Ie===null?(Ge.next=Ge,wi===null?wi=[he]:wi.push(he)):(Ge.next=Ie.next,Ie.next=Ge),he.interleaved=Ge):(Ie=he.pending,Ie===null?Ge.next=Ge:(Ge.next=Ie.next,Ie.next=Ge),he.pending=Ge)}function Pa(Ie,he,Ge){if((Ge&4194240)!==0){var we=he.lanes;we&=Ie.pendingLanes,Ge|=we,he.lanes=Ge,ui(Ie,Ge)}}var ya={readContext:Fr,useCallback:ai,useContext:ai,useEffect:ai,useImperativeHandle:ai,useInsertionEffect:ai,useLayoutEffect:ai,useMemo:ai,useReducer:ai,useRef:ai,useState:ai,useDebugValue:ai,useDeferredValue:ai,useTransition:ai,useMutableSource:ai,useSyncExternalStore:ai,useId:ai,unstable_isNewReconciler:!1},vg={readContext:Fr,useCallback:function(Ie,he){return bo().memoizedState=[Ie,he===void 0?null:he],Ie},useContext:Fr,useEffect:Fl,useImperativeHandle:function(Ie,he,Ge){return Ge=Ge!=null?Ge.concat([Ie]):null,Rs(4194308,4,Da.bind(null,he,Ie),Ge)},useLayoutEffect:function(Ie,he){return Rs(4194308,4,Ie,he)},useInsertionEffect:function(Ie,he){return Rs(4,2,Ie,he)},useMemo:function(Ie,he){var Ge=bo();return he=he===void 0?null:he,Ie=Ie(),Ge.memoizedState=[Ie,he],Ie},useReducer:function(Ie,he,Ge){var we=bo();return he=Ge!==void 0?Ge(he):he,we.memoizedState=we.baseState=he,Ie={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Ie,lastRenderedState:he},we.queue=Ie,Ie=Ie.dispatch=gc.bind(null,Tr,Ie),[we.memoizedState,Ie]},useRef:function(Ie){var he=bo();return Ie={current:Ie},he.memoizedState=Ie},useState:Ka,useDebugValue:Tl,useDeferredValue:function(Ie){var he=Ka(Ie),Ge=he[0],we=he[1];return Fl(function(){var Le=Oi.transition;Oi.transition={};try{we(Ie)}finally{Oi.transition=Le}},[Ie]),Ge},useTransition:function(){var Ie=Ka(!1),he=Ie[0];return Ie=Ll.bind(null,Ie[1]),bo().memoizedState=Ie,[he,Ie]},useMutableSource:function(){},useSyncExternalStore:function(Ie,he,Ge){var we=Tr,Le=bo();if(Mr){if(Ge===void 0)throw Error(oe(407));Ge=Ge()}else{if(Ge=he(),Dr===null)throw Error(oe(349));(Xs&30)!==0||mg(we,he,Ge)}Le.memoizedState=Ge;var ze={value:Ge,getSnapshot:he};return Le.queue=ze,Fl(jo.bind(null,we,ze,Ie),[Ie]),we.flags|=2048,za(9,bg.bind(null,we,ze,Ge,he),void 0,null),Ge},useId:function(){var Ie=bo(),he=Dr.identifierPrefix;if(Mr){var Ge=Po,we=Uo;Ge=(we&~(1<<32-vr(we)-1)).toString(32)+Ge,he=":"+he+"R"+Ge,Ge=ks++,0<Ge&&(he+="H"+Ge.toString(32)),he+=":"}else Ge=Xa++,he=":"+he+"r"+Ge.toString(32)+":";return Ie.memoizedState=he},unstable_isNewReconciler:!1},Bg={readContext:Fr,useCallback:Nl,useContext:Fr,useEffect:Aa,useImperativeHandle:ma,useInsertionEffect:Gr,useLayoutEffect:Vl,useMemo:ba,useReducer:ka,useRef:lc,useState:function(){return ka(Wo)},useDebugValue:Tl,useDeferredValue:function(Ie){var he=ka(Wo),Ge=he[0],we=he[1];return Aa(function(){var Le=Oi.transition;Oi.transition={};try{we(Ie)}finally{Oi.transition=Le}},[Ie]),Ge},useTransition:function(){var Ie=ka(Wo)[0],he=yo().memoizedState;return[Ie,he]},useMutableSource:fg,useSyncExternalStore:Ag,useId:Ys,unstable_isNewReconciler:!1},Gg={readContext:Fr,useCallback:Nl,useContext:Fr,useEffect:Aa,useImperativeHandle:ma,useInsertionEffect:Gr,useLayoutEffect:Vl,useMemo:ba,useReducer:Ya,useRef:lc,useState:function(){return Ya(Wo)},useDebugValue:Tl,useDeferredValue:function(Ie){var he=Ya(Wo),Ge=he[0],we=he[1];return Aa(function(){var Le=Oi.transition;Oi.transition={};try{we(Ie)}finally{Oi.transition=Le}},[Ie]),Ge},useTransition:function(){var Ie=Ya(Wo)[0],he=yo().memoizedState;return[Ie,he]},useMutableSource:fg,useSyncExternalStore:Ag,useId:Ys,unstable_isNewReconciler:!1};function Sg(Ie,he){try{var Ge="",we=he;do Ge+=ko(we),we=we.return;while(we);var Le=Ge}catch(ze){Le=`
Error generating stack: `+ze.message+`
`+ze.stack}return{value:Ie,source:he,stack:Le}}function Hl(Ie,he){try{console.error(he.value)}catch(Ge){setTimeout(function(){throw Ge})}}var zc=typeof WeakMap=="function"?WeakMap:Map;function uc(Ie,he,Ge){Ge=Do(-1,Ge),Ge.tag=3,Ge.payload={element:null};var we=he.value;return Ge.callback=function(){wa||(wa=!0,Zr=we),Hl(Ie,he)},Ge}function Xl(Ie,he,Ge){Ge=Do(-1,Ge),Ge.tag=3;var we=Ie.type.getDerivedStateFromError;if(typeof we=="function"){var Le=he.value;Ge.payload=function(){return we(Le)},Ge.callback=function(){Hl(Ie,he)}}var ze=Ie.stateNode;return ze!==null&&typeof ze.componentDidCatch=="function"&&(Ge.callback=function(){Hl(Ie,he),typeof we!="function"&&(Go===null?Go=new Set([this]):Go.add(this));var dt=he.stack;this.componentDidCatch(he.value,{componentStack:dt!==null?dt:""})}),Ge}function Jo(Ie,he,Ge){var we=Ie.pingCache;if(we===null){we=Ie.pingCache=new zc;var Le=new Set;we.set(he,Le)}else Le=we.get(he),Le===void 0&&(Le=new Set,we.set(he,Le));Le.has(Ge)||(Le.add(Ge),Ie=Kg.bind(null,Ie,he,Ge),he.then(Ie,Ie))}function Rg(Ie){do{var he;if((he=Ie.tag===13)&&(he=Ie.memoizedState,he=he!==null?he.dehydrated!==null:!0),he)return Ie;Ie=Ie.return}while(Ie!==null);return null}function Ks(Ie,he,Ge,we,Le){return(Ie.mode&1)===0?(Ie===he?Ie.flags|=65536:(Ie.flags|=128,Ge.flags|=131072,Ge.flags&=-52805,Ge.tag===1&&(Ge.alternate===null?Ge.tag=17:(he=Do(-1,1),he.tag=2,ys(Ge,he))),Ge.lanes|=1),Ie):(Ie.flags|=65536,Ie.lanes=Le,Ie)}function $r(Ie){Ie.flags|=4}function va(Ie,he){if(Ie!==null&&Ie.child===he.child)return!0;if((he.flags&16)!==0)return!1;for(Ie=he.child;Ie!==null;){if((Ie.flags&12854)!==0||(Ie.subtreeFlags&12854)!==0)return!1;Ie=Ie.sibling}return!0}var ji,zs,kl,Yl;if(Zt)ji=function(Ie,he){for(var Ge=he.child;Ge!==null;){if(Ge.tag===5||Ge.tag===6)De(Ie,Ge.stateNode);else if(Ge.tag!==4&&Ge.child!==null){Ge.child.return=Ge,Ge=Ge.child;continue}if(Ge===he)break;for(;Ge.sibling===null;){if(Ge.return===null||Ge.return===he)return;Ge=Ge.return}Ge.sibling.return=Ge.return,Ge=Ge.sibling}},zs=function(){},kl=function(Ie,he,Ge,we,Le){if(Ie=Ie.memoizedProps,Ie!==we){var ze=he.stateNode,dt=mo(Ni.current);Ge=ct(ze,Ge,Ie,we,Le,dt),(he.updateQueue=Ge)&&$r(he)}},Yl=function(Ie,he,Ge,we){Ge!==we&&$r(he)};else if(st){ji=function(Ie,he,Ge,we){for(var Le=he.child;Le!==null;){if(Le.tag===5){var ze=Le.stateNode;Ge&&we&&(ze=Xn(ze,Le.type,Le.memoizedProps,Le)),De(Ie,ze)}else if(Le.tag===6)ze=Le.stateNode,Ge&&we&&(ze=dr(ze,Le.memoizedProps,Le)),De(Ie,ze);else if(Le.tag!==4){if(Le.tag===22&&Le.memoizedState!==null)ze=Le.child,ze!==null&&(ze.return=Le),ji(Ie,Le,!0,!0);else if(Le.child!==null){Le.child.return=Le,Le=Le.child;continue}}if(Le===he)break;for(;Le.sibling===null;){if(Le.return===null||Le.return===he)return;Le=Le.return}Le.sibling.return=Le.return,Le=Le.sibling}};var ws=function(Ie,he,Ge,we){for(var Le=he.child;Le!==null;){if(Le.tag===5){var ze=Le.stateNode;Ge&&we&&(ze=Xn(ze,Le.type,Le.memoizedProps,Le)),zn(Ie,ze)}else if(Le.tag===6)ze=Le.stateNode,Ge&&we&&(ze=dr(ze,Le.memoizedProps,Le)),zn(Ie,ze);else if(Le.tag!==4){if(Le.tag===22&&Le.memoizedState!==null)ze=Le.child,ze!==null&&(ze.return=Le),ws(Ie,Le,!0,!0);else if(Le.child!==null){Le.child.return=Le,Le=Le.child;continue}}if(Le===he)break;for(;Le.sibling===null;){if(Le.return===null||Le.return===he)return;Le=Le.return}Le.sibling.return=Le.return,Le=Le.sibling}};zs=function(Ie,he){var Ge=he.stateNode;if(!va(Ie,he)){Ie=Ge.containerInfo;var we=vn(Ie);ws(we,he,!1,!1),Ge.pendingChildren=we,$r(he),On(Ie,we)}},kl=function(Ie,he,Ge,we,Le){var ze=Ie.stateNode,dt=Ie.memoizedProps;if((Ie=va(Ie,he))&&dt===we)he.stateNode=ze;else{var Gt=he.stateNode,Qt=mo(Ni.current),In=null;dt!==we&&(In=ct(Gt,Ge,dt,we,Le,Qt)),Ie&&In===null?he.stateNode=ze:(ze=an(ze,In,Ge,dt,we,he,Ie,Gt),ot(ze,Ge,we,Le,Qt)&&$r(he),he.stateNode=ze,Ie?$r(he):ji(ze,he,!1,!1))}},Yl=function(Ie,he,Ge,we){Ge!==we?(Ie=mo(Ls.current),Ge=mo(Ni.current),he.stateNode=pt(we,Ie,Ge,he),$r(he)):he.stateNode=Ie.stateNode}}else zs=function(){},kl=function(){},Yl=function(){};function Qo(Ie,he){if(!Mr)switch(Ie.tailMode){case"hidden":he=Ie.tail;for(var Ge=null;he!==null;)he.alternate!==null&&(Ge=he),he=he.sibling;Ge===null?Ie.tail=null:Ge.sibling=null;break;case"collapsed":Ge=Ie.tail;for(var we=null;Ge!==null;)Ge.alternate!==null&&(we=Ge),Ge=Ge.sibling;we===null?he||Ie.tail===null?Ie.tail=null:Ie.tail.sibling=null:we.sibling=null}}function zr(Ie){var he=Ie.alternate!==null&&Ie.alternate.child===Ie.child,Ge=0,we=0;if(he)for(var Le=Ie.child;Le!==null;)Ge|=Le.lanes|Le.childLanes,we|=Le.subtreeFlags&14680064,we|=Le.flags&14680064,Le.return=Ie,Le=Le.sibling;else for(Le=Ie.child;Le!==null;)Ge|=Le.lanes|Le.childLanes,we|=Le.subtreeFlags,we|=Le.flags,Le.return=Ie,Le=Le.sibling;return Ie.subtreeFlags|=we,Ie.childLanes=Ge,he}function Kl(Ie,he,Ge){var we=he.pendingProps;switch(Ig(he),he.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return zr(he),null;case 1:return sr(he.type)&&Ir(),zr(he),null;case 3:return we=he.stateNode,ha(),_n(Dn),_n(gr),Hs(),we.pendingContext&&(we.context=we.pendingContext,we.pendingContext=null),(Ie===null||Ie.child===null)&&(La(he)?$r(he):Ie===null||Ie.memoizedState.isDehydrated&&(he.flags&256)===0||(he.flags|=1024,go!==null&&(sl(go),go=null))),zs(Ie,he),zr(he),null;case 5:hg(he),Ge=mo(Ls.current);var Le=he.type;if(Ie!==null&&he.stateNode!=null)kl(Ie,he,Le,we,Ge),Ie.ref!==he.ref&&(he.flags|=512,he.flags|=2097152);else{if(!we){if(he.stateNode===null)throw Error(oe(166));return zr(he),null}if(Ie=mo(Ni.current),La(he)){if(!Vt)throw Error(oe(175));Ie=Qe(he.stateNode,he.type,he.memoizedProps,Ge,Ie,he,!ua),he.updateQueue=Ie,Ie!==null&&$r(he)}else{var ze=Te(Le,we,Ge,Ie,he);ji(ze,he,!1,!1),he.stateNode=ze,ot(ze,Le,we,Ge,Ie)&&$r(he)}he.ref!==null&&(he.flags|=512,he.flags|=2097152)}return zr(he),null;case 6:if(Ie&&he.stateNode!=null)Yl(Ie,he,Ie.memoizedProps,we);else{if(typeof we!="string"&&he.stateNode===null)throw Error(oe(166));if(Ie=mo(Ls.current),Ge=mo(Ni.current),La(he)){if(!Vt)throw Error(oe(176));if(Ie=he.stateNode,we=he.memoizedProps,(Ge=ke(Ie,we,he,!ua))&&(Le=xi,Le!==null))switch(ze=(Le.mode&1)!==0,Le.tag){case 3:Jt(Le.stateNode.containerInfo,Ie,we,ze);break;case 5:qt(Le.type,Le.memoizedProps,Le.stateNode,Ie,we,ze)}Ge&&$r(he)}else he.stateNode=pt(we,Ie,Ge,he)}return zr(he),null;case 13:if(_n(Vr),we=he.memoizedState,Mr&&di!==null&&(he.mode&1)!==0&&(he.flags&128)===0){for(Ie=di;Ie;)Ie=br(Ie);return da(),he.flags|=98560,he}if(we!==null&&we.dehydrated!==null){if(we=La(he),Ie===null){if(!we)throw Error(oe(318));if(!Vt)throw Error(oe(344));if(Ie=he.memoizedState,Ie=Ie!==null?Ie.dehydrated:null,!Ie)throw Error(oe(317));it(Ie,he)}else da(),(he.flags&128)===0&&(he.memoizedState=null),he.flags|=4;return zr(he),null}return go!==null&&(sl(go),go=null),(he.flags&128)!==0?(he.lanes=Ge,he):(we=we!==null,Ge=!1,Ie===null?La(he):Ge=Ie.memoizedState!==null,we&&!Ge&&(he.child.flags|=8192,(he.mode&1)!==0&&(Ie===null||(Vr.current&1)!==0?kr===0&&(kr=3):Jl())),he.updateQueue!==null&&(he.flags|=4),zr(he),null);case 4:return ha(),zs(Ie,he),Ie===null&&St(he.stateNode.containerInfo),zr(he),null;case 10:return Ur(he.type._context),zr(he),null;case 17:return sr(he.type)&&Ir(),zr(he),null;case 19:if(_n(Vr),Le=he.memoizedState,Le===null)return zr(he),null;if(we=(he.flags&128)!==0,ze=Le.rendering,ze===null)if(we)Qo(Le,!1);else{if(kr!==0||Ie!==null&&(Ie.flags&128)!==0)for(Ie=he.child;Ie!==null;){if(ze=Zl(Ie),ze!==null){for(he.flags|=128,Qo(Le,!1),Ie=ze.updateQueue,Ie!==null&&(he.updateQueue=Ie,he.flags|=4),he.subtreeFlags=0,Ie=Ge,we=he.child;we!==null;)Ge=we,Le=Ie,Ge.flags&=14680066,ze=Ge.alternate,ze===null?(Ge.childLanes=0,Ge.lanes=Le,Ge.child=null,Ge.subtreeFlags=0,Ge.memoizedProps=null,Ge.memoizedState=null,Ge.updateQueue=null,Ge.dependencies=null,Ge.stateNode=null):(Ge.childLanes=ze.childLanes,Ge.lanes=ze.lanes,Ge.child=ze.child,Ge.subtreeFlags=0,Ge.deletions=null,Ge.memoizedProps=ze.memoizedProps,Ge.memoizedState=ze.memoizedState,Ge.updateQueue=ze.updateQueue,Ge.type=ze.type,Le=ze.dependencies,Ge.dependencies=Le===null?null:{lanes:Le.lanes,firstContext:Le.firstContext}),we=we.sibling;return Zn(Vr,Vr.current&1|2),he.child}Ie=Ie.sibling}Le.tail!==null&&_r()>Es&&(he.flags|=128,we=!0,Qo(Le,!1),he.lanes=4194304)}else{if(!we)if(Ie=Zl(ze),Ie!==null){if(he.flags|=128,we=!0,Ie=Ie.updateQueue,Ie!==null&&(he.updateQueue=Ie,he.flags|=4),Qo(Le,!0),Le.tail===null&&Le.tailMode==="hidden"&&!ze.alternate&&!Mr)return zr(he),null}else 2*_r()-Le.renderingStartTime>Es&&Ge!==1073741824&&(he.flags|=128,we=!0,Qo(Le,!1),he.lanes=4194304);Le.isBackwards?(ze.sibling=he.child,he.child=ze):(Ie=Le.last,Ie!==null?Ie.sibling=ze:he.child=ze,Le.last=ze)}return Le.tail!==null?(he=Le.tail,Le.rendering=he,Le.tail=he.sibling,Le.renderingStartTime=_r(),he.sibling=null,Ie=Vr.current,Zn(Vr,we?Ie&1|2:Ie&1),he):(zr(he),null);case 22:case 23:return al(),we=he.memoizedState!==null,Ie!==null&&Ie.memoizedState!==null!==we&&(he.flags|=8192),we&&(he.mode&1)!==0?(Bi&1073741824)!==0&&(zr(he),Zt&&he.subtreeFlags&6&&(he.flags|=8192)):zr(he),null;case 24:return null;case 25:return null}throw Error(oe(156,he.tag))}var wg=ie.ReactCurrentOwner,li=!1;function Xr(Ie,he,Ge,we){he.child=Ie===null?sc(he,null,Ge,we):Oo(he,Ie.child,Ge,we)}function Sr(Ie,he,Ge,we,Le){Ge=Ge.render;var ze=he.ref;return Kr(he,Le),we=fa(Ie,he,Ge,we,ze,Le),Ge=Ss(),Ie!==null&&!li?(he.updateQueue=Ie.updateQueue,he.flags&=-2053,Ie.lanes&=~Le,Li(Ie,he,Le)):(Mr&&Ge&&dg(he),he.flags|=1,Xr(Ie,he,we,Le),he.child)}function Br(Ie,he,Ge,we,Le){if(Ie===null){var ze=Ge.type;return typeof ze=="function"&&!$l(ze)&&ze.defaultProps===void 0&&Ge.compare===null&&Ge.defaultProps===void 0?(he.tag=15,he.type=ze,$o(Ie,he,ze,we,Le)):(Ie=ql(Ge.type,null,we,he,he.mode,Le),Ie.ref=he.ref,Ie.return=he,he.child=Ie)}if(ze=Ie.child,(Ie.lanes&Le)===0){var dt=ze.memoizedProps;if(Ge=Ge.compare,Ge=Ge!==null?Ge:Vi,Ge(dt,we)&&Ie.ref===he.ref)return Li(Ie,he,Le)}return he.flags|=1,Ie=cs(ze,we),Ie.ref=he.ref,Ie.return=he,he.child=Ie}function $o(Ie,he,Ge,we,Le){if(Ie!==null&&Vi(Ie.memoizedProps,we)&&Ie.ref===he.ref)if(li=!1,(Ie.lanes&Le)!==0)(Ie.flags&131072)!==0&&(li=!0);else return he.lanes=Ie.lanes,Li(Ie,he,Le);return qo(Ie,he,Ge,we,Le)}function Ii(Ie,he,Ge){var we=he.pendingProps,Le=we.children,ze=Ie!==null?Ie.memoizedState:null;if(we.mode==="hidden")if((he.mode&1)===0)he.memoizedState={baseLanes:0,cachePool:null},Zn(qs,Bi),Bi|=Ge;else if((Ge&1073741824)!==0)he.memoizedState={baseLanes:0,cachePool:null},we=ze!==null?ze.baseLanes:Ge,Zn(qs,Bi),Bi|=we;else return Ie=ze!==null?ze.baseLanes|Ge:Ge,he.lanes=he.childLanes=1073741824,he.memoizedState={baseLanes:Ie,cachePool:null},he.updateQueue=null,Zn(qs,Bi),Bi|=Ie,null;else ze!==null?(we=ze.baseLanes|Ge,he.memoizedState=null):we=Ge,Zn(qs,Bi),Bi|=we;return Xr(Ie,he,Le,Ge),he.child}function Zi(Ie,he){var Ge=he.ref;(Ie===null&&Ge!==null||Ie!==null&&Ie.ref!==Ge)&&(he.flags|=512,he.flags|=2097152)}function qo(Ie,he,Ge,we,Le){var ze=sr(Ge)?cr:gr.current;return ze=tr(he,ze),Kr(he,Le),Ge=fa(Ie,he,Ge,we,ze,Le),we=Ss(),Ie!==null&&!li?(he.updateQueue=Ie.updateQueue,he.flags&=-2053,Ie.lanes&=~Le,Li(Ie,he,Le)):(Mr&&we&&dg(he),he.flags|=1,Xr(Ie,he,Ge,Le),he.child)}function Ds(Ie,he,Ge,we,Le){if(sr(Ge)){var ze=!0;ar(he)}else ze=!1;if(Kr(he,Le),he.stateNode===null)Ie!==null&&(Ie.alternate=null,he.alternate=null,he.flags|=2),tc(he,Ge,we),ug(he,Ge,we,Le),we=!0;else if(Ie===null){var dt=he.stateNode,Gt=he.memoizedProps;dt.props=Gt;var Qt=dt.context,In=Ge.contextType;typeof In=="object"&&In!==null?In=Fr(In):(In=sr(Ge)?cr:gr.current,In=tr(he,In));var Rn=Ge.getDerivedStateFromProps,$n=typeof Rn=="function"||typeof dt.getSnapshotBeforeUpdate=="function";$n||typeof dt.UNSAFE_componentWillReceiveProps!="function"&&typeof dt.componentWillReceiveProps!="function"||(Gt!==we||Qt!==In)&&nc(he,dt,we,In),ao=!1;var Yn=he.memoizedState;dt.state=Yn,vl(he,we,dt,Le),Qt=he.memoizedState,Gt!==we||Yn!==Qt||Dn.current||ao?(typeof Rn=="function"&&(gg(he,Ge,Rn,we),Qt=he.memoizedState),(Gt=ao||cg(he,Ge,Gt,we,Yn,Qt,In))?($n||typeof dt.UNSAFE_componentWillMount!="function"&&typeof dt.componentWillMount!="function"||(typeof dt.componentWillMount=="function"&&dt.componentWillMount(),typeof dt.UNSAFE_componentWillMount=="function"&&dt.UNSAFE_componentWillMount()),typeof dt.componentDidMount=="function"&&(he.flags|=4194308)):(typeof dt.componentDidMount=="function"&&(he.flags|=4194308),he.memoizedProps=we,he.memoizedState=Qt),dt.props=we,dt.state=Qt,dt.context=In,we=Gt):(typeof dt.componentDidMount=="function"&&(he.flags|=4194308),we=!1)}else{dt=he.stateNode,lg(Ie,he),Gt=he.memoizedProps,In=he.type===he.elementType?Gt:ri(he.type,Gt),dt.props=In,$n=he.pendingProps,Yn=dt.context,Qt=Ge.contextType,typeof Qt=="object"&&Qt!==null?Qt=Fr(Qt):(Qt=sr(Ge)?cr:gr.current,Qt=tr(he,Qt));var ir=Ge.getDerivedStateFromProps;(Rn=typeof ir=="function"||typeof dt.getSnapshotBeforeUpdate=="function")||typeof dt.UNSAFE_componentWillReceiveProps!="function"&&typeof dt.componentWillReceiveProps!="function"||(Gt!==$n||Yn!==Qt)&&nc(he,dt,we,Qt),ao=!1,Yn=he.memoizedState,dt.state=Yn,vl(he,we,dt,Le);var Gn=he.memoizedState;Gt!==$n||Yn!==Gn||Dn.current||ao?(typeof ir=="function"&&(gg(he,Ge,ir,we),Gn=he.memoizedState),(In=ao||cg(he,Ge,In,we,Yn,Gn,Qt)||!1)?(Rn||typeof dt.UNSAFE_componentWillUpdate!="function"&&typeof dt.componentWillUpdate!="function"||(typeof dt.componentWillUpdate=="function"&&dt.componentWillUpdate(we,Gn,Qt),typeof dt.UNSAFE_componentWillUpdate=="function"&&dt.UNSAFE_componentWillUpdate(we,Gn,Qt)),typeof dt.componentDidUpdate=="function"&&(he.flags|=4),typeof dt.getSnapshotBeforeUpdate=="function"&&(he.flags|=1024)):(typeof dt.componentDidUpdate!="function"||Gt===Ie.memoizedProps&&Yn===Ie.memoizedState||(he.flags|=4),typeof dt.getSnapshotBeforeUpdate!="function"||Gt===Ie.memoizedProps&&Yn===Ie.memoizedState||(he.flags|=1024),he.memoizedProps=we,he.memoizedState=Gn),dt.props=we,dt.state=Gn,dt.context=Qt,we=In):(typeof dt.componentDidUpdate!="function"||Gt===Ie.memoizedProps&&Yn===Ie.memoizedState||(he.flags|=4),typeof dt.getSnapshotBeforeUpdate!="function"||Gt===Ie.memoizedProps&&Yn===Ie.memoizedState||(he.flags|=1024),we=!1)}return vi(Ie,he,Ge,we,ze,Le)}function vi(Ie,he,Ge,we,Le,ze){Zi(Ie,he);var dt=(he.flags&128)!==0;if(!we&&!dt)return Le&&jn(he,Ge,!1),Li(Ie,he,ze);we=he.stateNode,wg.current=he;var Gt=dt&&typeof Ge.getDerivedStateFromError!="function"?null:we.render();return he.flags|=1,Ie!==null&&dt?(he.child=Oo(he,Ie.child,null,ze),he.child=Oo(he,null,Gt,ze)):Xr(Ie,he,Gt,ze),he.memoizedState=we.state,Le&&jn(he,Ge,!0),he.child}function Oa(Ie){var he=Ie.stateNode;he.pendingContext?Kn(Ie,he.pendingContext,he.pendingContext!==he.context):he.context&&Kn(Ie,he.context,!1),xl(Ie,he.containerInfo)}function xg(Ie,he,Ge,we,Le){return da(),wl(Le),he.flags|=256,Xr(Ie,he,Ge,we),he.child}var ja={dehydrated:null,treeContext:null,retryLane:0};function Us(Ie){return{baseLanes:Ie,cachePool:null}}function Zg(Ie,he,Ge){var we=he.pendingProps,Le=Vr.current,ze=!1,dt=(he.flags&128)!==0,Gt;if((Gt=dt)||(Gt=Ie!==null&&Ie.memoizedState===null?!1:(Le&2)!==0),Gt?(ze=!0,he.flags&=-129):(Ie===null||Ie.memoizedState!==null)&&(Le|=1),Zn(Vr,Le&1),Ie===null)return Bs(he),Ie=he.memoizedState,Ie!==null&&(Ie=Ie.dehydrated,Ie!==null)?((he.mode&1)===0?he.lanes=1:Er(Ie)?he.lanes=8:he.lanes=1073741824,null):(Le=we.children,Ie=we.fallback,ze?(we=he.mode,ze=he.child,Le={mode:"hidden",children:Le},(we&1)===0&&ze!==null?(ze.childLanes=0,ze.pendingProps=Le):ze=cl(Le,we,0,null),Ie=ia(Ie,we,Ge,null),ze.return=he,Ie.return=he,ze.sibling=Ie,he.child=ze,he.child.memoizedState=Us(Ge),he.memoizedState=ja,Ie):vo(he,Le));if(Le=Ie.memoizedState,Le!==null){if(Gt=Le.dehydrated,Gt!==null){if(dt)return he.flags&256?(he.flags&=-257,Qa(Ie,he,Ge,Error(oe(422)))):he.memoizedState!==null?(he.child=Ie.child,he.flags|=128,null):(ze=we.fallback,Le=he.mode,we=cl({mode:"visible",children:we.children},Le,0,null),ze=ia(ze,Le,Ge,null),ze.flags|=2,we.return=he,ze.return=he,we.sibling=ze,he.child=we,(he.mode&1)!==0&&Oo(he,Ie.child,null,Ge),he.child.memoizedState=Us(Ge),he.memoizedState=ja,ze);if((he.mode&1)===0)he=Qa(Ie,he,Ge,null);else if(Er(Gt))he=Qa(Ie,he,Ge,Error(oe(419)));else if(we=(Ge&Ie.childLanes)!==0,li||we){if(we=Dr,we!==null){switch(Ge&-Ge){case 4:ze=2;break;case 16:ze=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:ze=32;break;case 536870912:ze=268435456;break;default:ze=0}we=(ze&(we.suspendedLanes|Ge))!==0?0:ze,we!==0&&we!==Le.retryLane&&(Le.retryLane=we,Gi(Ie,we,-1))}Jl(),he=Qa(Ie,he,Ge,Error(oe(421)))}else ei(Gt)?(he.flags|=128,he.child=Ie.child,he=hc.bind(null,Ie),Lr(Gt,he),he=null):(Ge=Le.treeContext,Vt&&(di=Yi(Gt),xi=he,Mr=!0,go=null,ua=!1,Ge!==null&&(lo[Ui++]=Uo,lo[Ui++]=Po,lo[Ui++]=Vs,Uo=Ge.id,Po=Ge.overflow,Vs=he)),he=vo(he,he.pendingProps.children),he.flags|=4096);return he}return ze?(we=zl(Ie,he,we.children,we.fallback,Ge),ze=he.child,Le=Ie.child.memoizedState,ze.memoizedState=Le===null?Us(Ge):{baseLanes:Le.baseLanes|Ge,cachePool:null},ze.childLanes=Ie.childLanes&~Ge,he.memoizedState=ja,we):(Ge=Ja(Ie,he,we.children,Ge),he.memoizedState=null,Ge)}return ze?(we=zl(Ie,he,we.children,we.fallback,Ge),ze=he.child,Le=Ie.child.memoizedState,ze.memoizedState=Le===null?Us(Ge):{baseLanes:Le.baseLanes|Ge,cachePool:null},ze.childLanes=Ie.childLanes&~Ge,he.memoizedState=ja,we):(Ge=Ja(Ie,he,we.children,Ge),he.memoizedState=null,Ge)}function vo(Ie,he){return he=cl({mode:"visible",children:he},Ie.mode,0,null),he.return=Ie,Ie.child=he}function Ja(Ie,he,Ge,we){var Le=Ie.child;return Ie=Le.sibling,Ge=cs(Le,{mode:"visible",children:Ge}),(he.mode&1)===0&&(Ge.lanes=we),Ge.return=he,Ge.sibling=null,Ie!==null&&(we=he.deletions,we===null?(he.deletions=[Ie],he.flags|=16):we.push(Ie)),he.child=Ge}function zl(Ie,he,Ge,we,Le){var ze=he.mode;Ie=Ie.child;var dt=Ie.sibling,Gt={mode:"hidden",children:Ge};return(ze&1)===0&&he.child!==Ie?(Ge=he.child,Ge.childLanes=0,Ge.pendingProps=Gt,he.deletions=null):(Ge=cs(Ie,Gt),Ge.subtreeFlags=Ie.subtreeFlags&14680064),dt!==null?we=cs(dt,we):(we=ia(we,ze,Le,null),we.flags|=2),we.return=he,Ge.return=he,Ge.sibling=we,he.child=Ge,we}function Qa(Ie,he,Ge,we){return we!==null&&wl(we),Oo(he,Ie.child,null,Ge),Ie=vo(he,he.pendingProps.children),Ie.flags|=2,he.memoizedState=null,Ie}function dc(Ie,he,Ge){Ie.lanes|=he;var we=Ie.alternate;we!==null&&(we.lanes|=he),Qr(Ie.return,he,Ge)}function Fo(Ie,he,Ge,we,Le){var ze=Ie.memoizedState;ze===null?Ie.memoizedState={isBackwards:he,rendering:null,renderingStartTime:0,last:we,tail:Ge,tailMode:Le}:(ze.isBackwards=he,ze.rendering=null,ze.renderingStartTime=0,ze.last=we,ze.tail=Ge,ze.tailMode=Le)}function Ps(Ie,he,Ge){var we=he.pendingProps,Le=we.revealOrder,ze=we.tail;if(Xr(Ie,he,we.children,Ge),we=Vr.current,(we&2)!==0)we=we&1|2,he.flags|=128;else{if(Ie!==null&&(Ie.flags&128)!==0)e:for(Ie=he.child;Ie!==null;){if(Ie.tag===13)Ie.memoizedState!==null&&dc(Ie,Ge,he);else if(Ie.tag===19)dc(Ie,Ge,he);else if(Ie.child!==null){Ie.child.return=Ie,Ie=Ie.child;continue}if(Ie===he)break e;for(;Ie.sibling===null;){if(Ie.return===null||Ie.return===he)break e;Ie=Ie.return}Ie.sibling.return=Ie.return,Ie=Ie.sibling}we&=1}if(Zn(Vr,we),(he.mode&1)===0)he.memoizedState=null;else switch(Le){case"forwards":for(Ge=he.child,Le=null;Ge!==null;)Ie=Ge.alternate,Ie!==null&&Zl(Ie)===null&&(Le=Ge),Ge=Ge.sibling;Ge=Le,Ge===null?(Le=he.child,he.child=null):(Le=Ge.sibling,Ge.sibling=null),Fo(he,!1,Le,Ge,ze);break;case"backwards":for(Ge=null,Le=he.child,he.child=null;Le!==null;){if(Ie=Le.alternate,Ie!==null&&Zl(Ie)===null){he.child=Le;break}Ie=Le.sibling,Le.sibling=Ge,Ge=Le,Le=Ie}Fo(he,!0,Ge,null,ze);break;case"together":Fo(he,!1,null,null,void 0);break;default:he.memoizedState=null}return he.child}function Li(Ie,he,Ge){if(Ie!==null&&(he.dependencies=Ie.dependencies),Vo|=he.lanes,(Ge&he.childLanes)===0)return null;if(Ie!==null&&he.child!==Ie.child)throw Error(oe(153));if(he.child!==null){for(Ie=he.child,Ge=cs(Ie,Ie.pendingProps),he.child=Ge,Ge.return=he;Ie.sibling!==null;)Ie=Ie.sibling,Ge=Ge.sibling=cs(Ie,Ie.pendingProps),Ge.return=he;Ge.sibling=null}return he.child}function Dl(Ie,he,Ge){switch(he.tag){case 3:Oa(he),da();break;case 5:ac(he);break;case 1:sr(he.type)&&ar(he);break;case 4:xl(he,he.stateNode.containerInfo);break;case 10:zo(he,he.type._context,he.memoizedProps.value);break;case 13:var we=he.memoizedState;if(we!==null)return we.dehydrated!==null?(Zn(Vr,Vr.current&1),he.flags|=128,null):(Ge&he.child.childLanes)!==0?Zg(Ie,he,Ge):(Zn(Vr,Vr.current&1),Ie=Li(Ie,he,Ge),Ie!==null?Ie.sibling:null);Zn(Vr,Vr.current&1);break;case 19:if(we=(Ge&he.childLanes)!==0,(Ie.flags&128)!==0){if(we)return Ps(Ie,he,Ge);he.flags|=128}var Le=he.memoizedState;if(Le!==null&&(Le.rendering=null,Le.tail=null,Le.lastEffect=null),Zn(Vr,Vr.current),we)break;return null;case 22:case 23:return he.lanes=0,Ii(Ie,he,Ge)}return Li(Ie,he,Ge)}function Ul(Ie,he){switch(Ig(he),he.tag){case 1:return sr(he.type)&&Ir(),Ie=he.flags,Ie&65536?(he.flags=Ie&-65537|128,he):null;case 3:return ha(),_n(Dn),_n(gr),Hs(),Ie=he.flags,(Ie&65536)!==0&&(Ie&128)===0?(he.flags=Ie&-65537|128,he):null;case 5:return hg(he),null;case 13:if(_n(Vr),Ie=he.memoizedState,Ie!==null&&Ie.dehydrated!==null){if(he.alternate===null)throw Error(oe(340));da()}return Ie=he.flags,Ie&65536?(he.flags=Ie&-65537|128,he):null;case 19:return _n(Vr),null;case 4:return ha(),null;case 10:return Ur(he.type._context),null;case 22:case 23:return al(),null;case 24:return null;default:return null}}var Ei=!1,gi=!1,Os=typeof WeakSet=="function"?WeakSet:Set,mn=null;function co(Ie,he){var Ge=Ie.ref;if(Ge!==null)if(typeof Ge=="function")try{Ge(null)}catch(we){Mi(Ie,he,we)}else Ge.current=null}function ns(Ie,he,Ge){try{Ge()}catch(we){Mi(Ie,he,we)}}var Eg=!1;function _g(Ie,he){for($e(Ie.containerInfo),mn=he;mn!==null;)if(Ie=mn,he=Ie.child,(Ie.subtreeFlags&1028)!==0&&he!==null)he.return=Ie,mn=he;else for(;mn!==null;){Ie=mn;try{var Ge=Ie.alternate;if((Ie.flags&1024)!==0)switch(Ie.tag){case 0:case 11:case 15:break;case 1:if(Ge!==null){var we=Ge.memoizedProps,Le=Ge.memoizedState,ze=Ie.stateNode,dt=ze.getSnapshotBeforeUpdate(Ie.elementType===Ie.type?we:ri(Ie.type,we),Le);ze.__reactInternalSnapshotBeforeUpdate=dt}break;case 3:Zt&&gn(Ie.stateNode.containerInfo);break;case 5:case 6:case 4:case 17:break;default:throw Error(oe(163))}}catch(Gt){Mi(Ie,Ie.return,Gt)}if(he=Ie.sibling,he!==null){he.return=Ie.return,mn=he;break}mn=Ie.return}return Ge=Eg,Eg=!1,Ge}function rs(Ie,he,Ge){var we=he.updateQueue;if(we=we!==null?we.lastEffect:null,we!==null){var Le=we=we.next;do{if((Le.tag&Ie)===Ie){var ze=Le.destroy;Le.destroy=void 0,ze!==void 0&&ns(he,Ge,ze)}Le=Le.next}while(Le!==we)}}function pi(Ie,he){if(he=he.updateQueue,he=he!==null?he.lastEffect:null,he!==null){var Ge=he=he.next;do{if((Ge.tag&Ie)===Ie){var we=Ge.create;Ge.destroy=we()}Ge=Ge.next}while(Ge!==he)}}function _i(Ie){var he=Ie.ref;if(he!==null){var Ge=Ie.stateNode;switch(Ie.tag){case 5:Ie=rt(Ge);break;default:Ie=Ge}typeof he=="function"?he(Ie):he.current=Ie}}function xr(Ie,he,Ge){if(Di&&typeof Di.onCommitFiberUnmount=="function")try{Di.onCommitFiberUnmount(fs,he)}catch{}switch(he.tag){case 0:case 11:case 14:case 15:if(Ie=he.updateQueue,Ie!==null&&(Ie=Ie.lastEffect,Ie!==null)){var we=Ie=Ie.next;do{var Le=we,ze=Le.destroy;Le=Le.tag,ze!==void 0&&((Le&2)!==0||(Le&4)!==0)&&ns(he,Ge,ze),we=we.next}while(we!==Ie)}break;case 1:if(co(he,Ge),Ie=he.stateNode,typeof Ie.componentWillUnmount=="function")try{Ie.props=he.memoizedProps,Ie.state=he.memoizedState,Ie.componentWillUnmount()}catch(dt){Mi(he,Ge,dt)}break;case 5:co(he,Ge);break;case 4:Zt?Fg(Ie,he,Ge):st&&st&&(he=he.stateNode.containerInfo,Ge=vn(he),Tn(he,Ge))}}function uo(Ie,he,Ge){for(var we=he;;)if(xr(Ie,we,Ge),we.child===null||Zt&&we.tag===4){if(we===he)break;for(;we.sibling===null;){if(we.return===null||we.return===he)return;we=we.return}we.sibling.return=we.return,we=we.sibling}else we.child.return=we,we=we.child}function Mg(Ie){var he=Ie.alternate;he!==null&&(Ie.alternate=null,Mg(he)),Ie.child=null,Ie.deletions=null,Ie.sibling=null,Ie.tag===5&&(he=Ie.stateNode,he!==null&&jt(he)),Ie.stateNode=null,Ie.return=null,Ie.dependencies=null,Ie.memoizedProps=null,Ie.memoizedState=null,Ie.pendingProps=null,Ie.stateNode=null,Ie.updateQueue=null}function Wg(Ie){return Ie.tag===5||Ie.tag===3||Ie.tag===4}function Pl(Ie){e:for(;;){for(;Ie.sibling===null;){if(Ie.return===null||Wg(Ie.return))return null;Ie=Ie.return}for(Ie.sibling.return=Ie.return,Ie=Ie.sibling;Ie.tag!==5&&Ie.tag!==6&&Ie.tag!==18;){if(Ie.flags&2||Ie.child===null||Ie.tag===4)continue e;Ie.child.return=Ie,Ie=Ie.child}if(!(Ie.flags&2))return Ie.stateNode}}function Ol(Ie){if(Zt){e:{for(var he=Ie.return;he!==null;){if(Wg(he))break e;he=he.return}throw Error(oe(160))}var Ge=he;switch(Ge.tag){case 5:he=Ge.stateNode,Ge.flags&32&&(An(he),Ge.flags&=-33),Ge=Pl(Ie),Ba(Ie,Ge,he);break;case 3:case 4:he=Ge.stateNode.containerInfo,Ge=Pl(Ie),jl(Ie,Ge,he);break;default:throw Error(oe(161))}}}function jl(Ie,he,Ge){var we=Ie.tag;if(we===5||we===6)Ie=Ie.stateNode,he?rn(Ge,Ie,he):nn(Ge,Ie);else if(we!==4&&(Ie=Ie.child,Ie!==null))for(jl(Ie,he,Ge),Ie=Ie.sibling;Ie!==null;)jl(Ie,he,Ge),Ie=Ie.sibling}function Ba(Ie,he,Ge){var we=Ie.tag;if(we===5||we===6)Ie=Ie.stateNode,he?sn(Ge,Ie,he):zt(Ge,Ie);else if(we!==4&&(Ie=Ie.child,Ie!==null))for(Ba(Ie,he,Ge),Ie=Ie.sibling;Ie!==null;)Ba(Ie,he,Ge),Ie=Ie.sibling}function Fg(Ie,he,Ge){for(var we=he,Le=!1,ze,dt;;){if(!Le){Le=we.return;e:for(;;){if(Le===null)throw Error(oe(160));switch(ze=Le.stateNode,Le.tag){case 5:dt=!1;break e;case 3:ze=ze.containerInfo,dt=!0;break e;case 4:ze=ze.containerInfo,dt=!0;break e}Le=Le.return}Le=!0}if(we.tag===5||we.tag===6)uo(Ie,we,Ge),dt?on(ze,we.stateNode):$t(ze,we.stateNode);else if(we.tag===18)dt?Xt(ze,we.stateNode):Nt(ze,we.stateNode);else if(we.tag===4){if(we.child!==null){ze=we.stateNode.containerInfo,dt=!0,we.child.return=we,we=we.child;continue}}else if(xr(Ie,we,Ge),we.child!==null){we.child.return=we,we=we.child;continue}if(we===he)break;for(;we.sibling===null;){if(we.return===null||we.return===he)return;we=we.return,we.tag===4&&(Le=!1)}we.sibling.return=we.return,we=we.sibling}}function xs(Ie,he){if(Zt){switch(he.tag){case 0:case 11:case 14:case 15:rs(3,he,he.return),pi(3,he),rs(5,he,he.return);return;case 1:return;case 5:var Ge=he.stateNode;if(Ge!=null){var we=he.memoizedProps;Ie=Ie!==null?Ie.memoizedProps:we;var Le=he.type,ze=he.updateQueue;he.updateQueue=null,ze!==null&&pn(Ge,ze,Le,Ie,we,he)}return;case 6:if(he.stateNode===null)throw Error(oe(162));Ge=he.memoizedProps,tn(he.stateNode,Ie!==null?Ie.memoizedProps:Ge,Ge);return;case 3:Vt&&Ie!==null&&Ie.memoizedState.isDehydrated&&lt(he.stateNode.containerInfo);return;case 12:return;case 13:Ga(he);return;case 19:Ga(he);return;case 17:return}throw Error(oe(163))}switch(he.tag){case 0:case 11:case 14:case 15:rs(3,he,he.return),pi(3,he),rs(5,he,he.return);return;case 12:return;case 13:Ga(he);return;case 19:Ga(he);return;case 3:Vt&&Ie!==null&&Ie.memoizedState.isDehydrated&&lt(he.stateNode.containerInfo);break;case 22:case 23:return}e:if(st){switch(he.tag){case 1:case 5:case 6:break e;case 3:case 4:he=he.stateNode,Tn(he.containerInfo,he.pendingChildren);break e}throw Error(oe(163))}}function Ga(Ie){var he=Ie.updateQueue;if(he!==null){Ie.updateQueue=null;var Ge=Ie.stateNode;Ge===null&&(Ge=Ie.stateNode=new Os),he.forEach(function(we){var Le=fc.bind(null,Ie,we);Ge.has(we)||(Ge.add(we),we.then(Le,Le))})}}function Dc(Ie,he){for(mn=he;mn!==null;){he=mn;var Ge=he.deletions;if(Ge!==null)for(var we=0;we<Ge.length;we++){var Le=Ge[we];try{var ze=Ie;Zt?Fg(ze,Le,he):uo(ze,Le,he);var dt=Le.alternate;dt!==null&&(dt.return=null),Le.return=null}catch(Vn){Mi(Le,he,Vn)}}if(Ge=he.child,(he.subtreeFlags&12854)!==0&&Ge!==null)Ge.return=he,mn=Ge;else for(;mn!==null;){he=mn;try{var Gt=he.flags;if(Gt&32&&Zt&&An(he.stateNode),Gt&512){var Qt=he.alternate;if(Qt!==null){var In=Qt.ref;In!==null&&(typeof In=="function"?In(null):In.current=null)}}if(Gt&8192)switch(he.tag){case 13:if(he.memoizedState!==null){var Rn=he.alternate;(Rn===null||Rn.memoizedState===null)&&(il=_r())}break;case 22:var $n=he.memoizedState!==null,Yn=he.alternate,ir=Yn!==null&&Yn.memoizedState!==null;if(Ge=he,Zt){e:if(we=Ge,Le=$n,ze=null,Zt)for(var Gn=we;;){if(Gn.tag===5){if(ze===null){ze=Gn;var fi=Gn.stateNode;Le?wn(fi):vt(Gn.stateNode,Gn.memoizedProps)}}else if(Gn.tag===6){if(ze===null){var eo=Gn.stateNode;Le?ft(eo):Et(eo,Gn.memoizedProps)}}else if((Gn.tag!==22&&Gn.tag!==23||Gn.memoizedState===null||Gn===we)&&Gn.child!==null){Gn.child.return=Gn,Gn=Gn.child;continue}if(Gn===we)break;for(;Gn.sibling===null;){if(Gn.return===null||Gn.return===we)break e;ze===Gn&&(ze=null),Gn=Gn.return}ze===Gn&&(ze=null),Gn.sibling.return=Gn.return,Gn=Gn.sibling}}if($n&&!ir&&(Ge.mode&1)!==0){mn=Ge;for(var kt=Ge.child;kt!==null;){for(Ge=mn=kt;mn!==null;){we=mn;var xt=we.child;switch(we.tag){case 0:case 11:case 14:case 15:rs(4,we,we.return);break;case 1:co(we,we.return);var Ut=we.stateNode;if(typeof Ut.componentWillUnmount=="function"){var Bn=we.return;try{Ut.props=we.memoizedProps,Ut.state=we.memoizedState,Ut.componentWillUnmount()}catch(Vn){Mi(we,Bn,Vn)}}break;case 5:co(we,we.return);break;case 22:if(we.memoizedState!==null){Tg(Ge);continue}}xt!==null?(xt.return=we,mn=xt):Tg(Ge)}kt=kt.sibling}}}switch(Gt&4102){case 2:Ol(he),he.flags&=-3;break;case 6:Ol(he),he.flags&=-3,xs(he.alternate,he);break;case 4096:he.flags&=-4097;break;case 4100:he.flags&=-4097,xs(he.alternate,he);break;case 4:xs(he.alternate,he)}}catch(Vn){Mi(he,he.return,Vn)}if(Ge=he.sibling,Ge!==null){Ge.return=he.return,mn=Ge;break}mn=he.return}}}function $a(Ie,he,Ge){mn=Ie,qa(Ie)}function qa(Ie,he,Ge){for(var we=(Ie.mode&1)!==0;mn!==null;){var Le=mn,ze=Le.child;if(Le.tag===22&&we){var dt=Le.memoizedState!==null||Ei;if(!dt){var Gt=Le.alternate,Qt=Gt!==null&&Gt.memoizedState!==null||gi;Gt=Ei;var In=gi;if(Ei=dt,(gi=Qt)&&!In)for(mn=Le;mn!==null;)dt=mn,Qt=dt.child,dt.tag===22&&dt.memoizedState!==null?js(Le):Qt!==null?(Qt.return=dt,mn=Qt):js(Le);for(;ze!==null;)mn=ze,qa(ze),ze=ze.sibling;mn=Le,Ei=Gt,gi=In}Vg(Ie)}else(Le.subtreeFlags&8772)!==0&&ze!==null?(ze.return=Le,mn=ze):Vg(Ie)}}function Vg(Ie){for(;mn!==null;){var he=mn;if((he.flags&8772)!==0){var Ge=he.alternate;try{if((he.flags&8772)!==0)switch(he.tag){case 0:case 11:case 15:gi||pi(5,he);break;case 1:var we=he.stateNode;if(he.flags&4&&!gi)if(Ge===null)we.componentDidMount();else{var Le=he.elementType===he.type?Ge.memoizedProps:ri(he.type,Ge.memoizedProps);we.componentDidUpdate(Le,Ge.memoizedState,we.__reactInternalSnapshotBeforeUpdate)}var ze=he.updateQueue;ze!==null&&qg(he,ze,we);break;case 3:var dt=he.updateQueue;if(dt!==null){if(Ge=null,he.child!==null)switch(he.child.tag){case 5:Ge=rt(he.child.stateNode);break;case 1:Ge=he.child.stateNode}qg(he,dt,Ge)}break;case 5:var Gt=he.stateNode;Ge===null&&he.flags&4&&Ft(Gt,he.type,he.memoizedProps,he);break;case 6:break;case 4:break;case 12:break;case 13:if(Vt&&he.memoizedState===null){var Qt=he.alternate;if(Qt!==null){var In=Qt.memoizedState;if(In!==null){var Rn=In.dehydrated;Rn!==null&&It(Rn)}}}break;case 19:case 17:case 21:case 22:case 23:break;default:throw Error(oe(163))}gi||he.flags&512&&_i(he)}catch($n){Mi(he,he.return,$n)}}if(he===Ie){mn=null;break}if(Ge=he.sibling,Ge!==null){Ge.return=he.return,mn=Ge;break}mn=he.return}}function Tg(Ie){for(;mn!==null;){var he=mn;if(he===Ie){mn=null;break}var Ge=he.sibling;if(Ge!==null){Ge.return=he.return,mn=Ge;break}mn=he.return}}function js(Ie){for(;mn!==null;){var he=mn;try{switch(he.tag){case 0:case 11:case 15:var Ge=he.return;try{pi(4,he)}catch(Qt){Mi(he,Ge,Qt)}break;case 1:var we=he.stateNode;if(typeof we.componentDidMount=="function"){var Le=he.return;try{we.componentDidMount()}catch(Qt){Mi(he,Le,Qt)}}var ze=he.return;try{_i(he)}catch(Qt){Mi(he,ze,Qt)}break;case 5:var dt=he.return;try{_i(he)}catch(Qt){Mi(he,dt,Qt)}}}catch(Qt){Mi(he,he.return,Qt)}if(he===Ie){mn=null;break}var Gt=he.sibling;if(Gt!==null){Gt.return=he.return,mn=Gt;break}mn=he.return}}var el=0,Js=1,Qs=2,os=3,Sa=4;if(typeof Symbol=="function"&&Symbol.for){var $s=Symbol.for;el=$s("selector.component"),Js=$s("selector.has_pseudo_class"),Qs=$s("selector.role"),os=$s("selector.test_id"),Sa=$s("selector.text")}function tl(Ie){var he=wt(Ie);if(he!=null){if(typeof he.memoizedProps["data-testname"]!="string")throw Error(oe(364));return he}if(Ie=Mt(Ie),Ie===null)throw Error(oe(362));return Ie.stateNode.current}function nl(Ie,he){switch(he.$$typeof){case el:if(Ie.type===he.value)return!0;break;case Js:e:{he=he.value,Ie=[Ie,0];for(var Ge=0;Ge<Ie.length;){var we=Ie[Ge++],Le=Ie[Ge++],ze=he[Le];if(we.tag!==5||!Je(we)){for(;ze!=null&&nl(we,ze);)Le++,ze=he[Le];if(Le===he.length){he=!0;break e}else for(we=we.child;we!==null;)Ie.push(we,Le),we=we.sibling}}he=!1}return he;case Qs:if(Ie.tag===5&&mt(Ie.stateNode,he.value))return!0;break;case Sa:if((Ie.tag===5||Ie.tag===6)&&(Ie=qe(Ie),Ie!==null&&0<=Ie.indexOf(he.value)))return!0;break;case os:if(Ie.tag===5&&(Ie=Ie.memoizedProps["data-testname"],typeof Ie=="string"&&Ie.toLowerCase()===he.value.toLowerCase()))return!0;break;default:throw Error(oe(365))}return!1}function Zs(Ie){switch(Ie.$$typeof){case el:return"<"+(Ze(Ie.value)||"Unknown")+">";case Js:return":has("+(Zs(Ie)||"")+")";case Qs:return'[role="'+Ie.value+'"]';case Sa:return'"'+Ie.value+'"';case os:return'[data-testname="'+Ie.value+'"]';default:throw Error(oe(365))}}function Ji(Ie,he){var Ge=[];Ie=[Ie,0];for(var we=0;we<Ie.length;){var Le=Ie[we++],ze=Ie[we++],dt=he[ze];if(Le.tag!==5||!Je(Le)){for(;dt!=null&&nl(Le,dt);)ze++,dt=he[ze];if(ze===he.length)Ge.push(Le);else for(Le=Le.child;Le!==null;)Ie.push(Le,ze),Le=Le.sibling}}return Ge}function ss(Ie,he){if(!Pt)throw Error(oe(363));Ie=tl(Ie),Ie=Ji(Ie,he),he=[],Ie=Array.from(Ie);for(var Ge=0;Ge<Ie.length;){var we=Ie[Ge++];if(we.tag===5)Je(we)||he.push(we.stateNode);else for(we=we.child;we!==null;)Ie.push(we),we=we.sibling}return he}var Ng=Math.ceil,rl=ie.ReactCurrentDispatcher,Bo=ie.ReactCurrentOwner,Ar=ie.ReactCurrentBatchConfig,nr=0,Dr=null,mr=null,Wr=0,Bi=0,qs=bn(0),kr=0,Ra=null,Vo=0,Qi=0,ea=0,as=null,Pr=null,il=0,Es=1/0;function ta(){Es=_r()+500}var wa=!1,Zr=null,Go=null,xa=!1,To=null,na=0,ra=0,ls=null,Rr=-1,Yr=0;function pr(){return(nr&6)!==0?_r():Rr!==-1?Rr:Rr=_r()}function So(Ie){return(Ie.mode&1)===0?1:(nr&2)!==0&&Wr!==0?Wr&-Wr:bs.transition!==null?(Yr===0&&(Ie=ho,ho<<=1,(ho&4194240)===0&&(ho=64),Yr=Ie),Yr):(Ie=Jn,Ie!==0?Ie:Rt())}function Gi(Ie,he,Ge){if(50<ra)throw ra=0,ls=null,Error(oe(185));var we=_s(Ie,he);return we===null?null:(ro(we,he,Ge),((nr&2)===0||we!==Dr)&&(we===Dr&&((nr&2)===0&&(Qi|=he),kr===4&&hi(we,Wr)),Hi(we,Ge),he===1&&nr===0&&(Ie.mode&1)===0&&(ta(),_o&&yi())),we)}function _s(Ie,he){Ie.lanes|=he;var Ge=Ie.alternate;for(Ge!==null&&(Ge.lanes|=he),Ge=Ie,Ie=Ie.return;Ie!==null;)Ie.childLanes|=he,Ge=Ie.alternate,Ge!==null&&(Ge.childLanes|=he),Ge=Ie,Ie=Ie.return;return Ge.tag===3?Ge.stateNode:null}function Hi(Ie,he){var Ge=Ie.callbackNode;la(Ie,he);var we=Cs(Ie,Ie===Dr?Wr:0);if(we===0)Ge!==null&&Eo(Ge),Ie.callbackNode=null,Ie.callbackPriority=0;else if(he=we&-we,Ie.callbackPriority!==he){if(Ge!=null&&Eo(Ge),he===1)Ie.tag===0?ms($i.bind(null,Ie)):Fs($i.bind(null,Ie)),Wt?Ht(function(){nr===0&&yi()}):zi(Ao,yi),Ge=null;else{switch(io(we)){case 1:Ge=Ao;break;case 4:Ge=ml;break;case 16:Ge=bi;break;case 536870912:Ge=hs;break;default:Ge=bi}Ge=Ql(Ge,Ci.bind(null,Ie))}Ie.callbackPriority=he,Ie.callbackNode=Ge}}function Ci(Ie,he){if(Rr=-1,Yr=0,(nr&6)!==0)throw Error(oe(327));var Ge=Ie.callbackNode;if(No()&&Ie.callbackNode!==Ge)return null;var we=Cs(Ie,Ie===Dr?Wr:0);if(we===0)return null;if((we&30)!==0||(we&Ie.expiredLanes)!==0||he)he=ll(Ie,we);else{he=we;var Le=nr;nr|=2;var ze=Xg();(Dr!==Ie||Wr!==he)&&(ta(),gs(Ie,he));do try{pc();break}catch(Gt){Hg(Ie,Gt)}while(!0);ii(),rl.current=ze,nr=Le,mr!==null?he=0:(Dr=null,Wr=0,he=kr)}if(he!==0){if(he===2&&(Le=Zo(Ie),Le!==0&&(we=Le,he=ol(Ie,Le))),he===1)throw Ge=Ra,gs(Ie,0),hi(Ie,we),Hi(Ie,_r()),Ge;if(he===6)hi(Ie,we);else{if(Le=Ie.current.alternate,(we&30)===0&&!Lg(Le)&&(he=ll(Ie,we),he===2&&(ze=Zo(Ie),ze!==0&&(we=ze,he=ol(Ie,ze))),he===1))throw Ge=Ra,gs(Ie,0),hi(Ie,we),Hi(Ie,_r()),Ge;switch(Ie.finishedWork=Le,Ie.finishedLanes=we,he){case 0:case 1:throw Error(oe(345));case 2:Ro(Ie,Pr);break;case 3:if(hi(Ie,we),(we&130023424)===we&&(he=il+500-_r(),10<he)){if(Cs(Ie,0)!==0)break;if(Le=Ie.suspendedLanes,(Le&we)!==we){pr(),Ie.pingedLanes|=Ie.suspendedLanes&Le;break}Ie.timeoutHandle=ht(Ro.bind(null,Ie,Pr),he);break}Ro(Ie,Pr);break;case 4:if(hi(Ie,we),(we&4194240)===we)break;for(he=Ie.eventTimes,Le=-1;0<we;){var dt=31-vr(we);ze=1<<dt,dt=he[dt],dt>Le&&(Le=dt),we&=~ze}if(we=Le,we=_r()-we,we=(120>we?120:480>we?480:1080>we?1080:1920>we?1920:3e3>we?3e3:4320>we?4320:1960*Ng(we/1960))-we,10<we){Ie.timeoutHandle=ht(Ro.bind(null,Ie,Pr),we);break}Ro(Ie,Pr);break;case 5:Ro(Ie,Pr);break;default:throw Error(oe(329))}}}return Hi(Ie,_r()),Ie.callbackNode===Ge?Ci.bind(null,Ie):null}function ol(Ie,he){var Ge=as;return Ie.current.memoizedState.isDehydrated&&(gs(Ie,he).flags|=256),Ie=ll(Ie,he),Ie!==2&&(he=Pr,Pr=Ge,he!==null&&sl(he)),Ie}function sl(Ie){Pr===null?Pr=Ie:Pr.push.apply(Pr,Ie)}function Lg(Ie){for(var he=Ie;;){if(he.flags&16384){var Ge=he.updateQueue;if(Ge!==null&&(Ge=Ge.stores,Ge!==null))for(var we=0;we<Ge.length;we++){var Le=Ge[we],ze=Le.getSnapshot;Le=Le.value;try{if(!ti(ze(),Le))return!1}catch{return!1}}}if(Ge=he.child,he.subtreeFlags&16384&&Ge!==null)Ge.return=he,he=Ge;else{if(he===Ie)break;for(;he.sibling===null;){if(he.return===null||he.return===Ie)return!0;he=he.return}he.sibling.return=he.return,he=he.sibling}}return!0}function hi(Ie,he){for(he&=~ea,he&=~Qi,Ie.suspendedLanes|=he,Ie.pingedLanes&=~he,Ie=Ie.expirationTimes;0<he;){var Ge=31-vr(he),we=1<<Ge;Ie[Ge]=-1,he&=~we}}function $i(Ie){if((nr&6)!==0)throw Error(oe(327));No();var he=Cs(Ie,0);if((he&1)===0)return Hi(Ie,_r()),null;var Ge=ll(Ie,he);if(Ie.tag!==0&&Ge===2){var we=Zo(Ie);we!==0&&(he=we,Ge=ol(Ie,we))}if(Ge===1)throw Ge=Ra,gs(Ie,0),hi(Ie,he),Hi(Ie,_r()),Ge;if(Ge===6)throw Error(oe(345));return Ie.finishedWork=Ie.current.alternate,Ie.finishedLanes=he,Ro(Ie,Pr),Hi(Ie,_r()),null}function Za(Ie){To!==null&&To.tag===0&&(nr&6)===0&&No();var he=nr;nr|=1;var Ge=Ar.transition,we=Jn;try{if(Ar.transition=null,Jn=1,Ie)return Ie()}finally{Jn=we,Ar.transition=Ge,nr=he,(nr&6)===0&&yi()}}function al(){Bi=qs.current,_n(qs)}function gs(Ie,he){Ie.finishedWork=null,Ie.finishedLanes=0;var Ge=Ie.timeoutHandle;if(Ge!==Kt&&(Ie.timeoutHandle=Kt,At(Ge)),mr!==null)for(Ge=mr.return;Ge!==null;){var we=Ge;switch(Ig(we),we.tag){case 1:we=we.type.childContextTypes,we!=null&&Ir();break;case 3:ha(),_n(Dn),_n(gr),Hs();break;case 5:hg(we);break;case 4:ha();break;case 13:_n(Vr);break;case 19:_n(Vr);break;case 10:Ur(we.type._context);break;case 22:case 23:al()}Ge=Ge.return}if(Dr=Ie,mr=Ie=cs(Ie.current,null),Wr=Bi=he,kr=0,Ra=null,ea=Qi=Vo=0,Pr=as=null,wi!==null){for(he=0;he<wi.length;he++)if(Ge=wi[he],we=Ge.interleaved,we!==null){Ge.interleaved=null;var Le=we.next,ze=Ge.pending;if(ze!==null){var dt=ze.next;ze.next=Le,we.next=dt}Ge.pending=we}wi=null}return Ie}function Hg(Ie,he){do{var Ge=mr;try{if(ii(),Ha.current=ya,El){for(var we=Tr.memoizedState;we!==null;){var Le=we.queue;Le!==null&&(Le.pending=null),we=we.next}El=!1}if(Xs=0,si=oi=Tr=null,Mo=!1,ks=0,Bo.current=null,Ge===null||Ge.return===null){kr=1,Ra=he,mr=null;break}e:{var ze=Ie,dt=Ge.return,Gt=Ge,Qt=he;if(he=Wr,Gt.flags|=32768,Qt!==null&&typeof Qt=="object"&&typeof Qt.then=="function"){var In=Qt,Rn=Gt,$n=Rn.tag;if((Rn.mode&1)===0&&($n===0||$n===11||$n===15)){var Yn=Rn.alternate;Yn?(Rn.updateQueue=Yn.updateQueue,Rn.memoizedState=Yn.memoizedState,Rn.lanes=Yn.lanes):(Rn.updateQueue=null,Rn.memoizedState=null)}var ir=Rg(dt);if(ir!==null){ir.flags&=-257,Ks(ir,dt,Gt,ze,he),ir.mode&1&&Jo(ze,In,he),he=ir,Qt=In;var Gn=he.updateQueue;if(Gn===null){var fi=new Set;fi.add(Qt),he.updateQueue=fi}else Gn.add(Qt);break e}else{if((he&1)===0){Jo(ze,In,he),Jl();break e}Qt=Error(oe(426))}}else if(Mr&&Gt.mode&1){var eo=Rg(dt);if(eo!==null){(eo.flags&65536)===0&&(eo.flags|=256),Ks(eo,dt,Gt,ze,he),wl(Qt);break e}}ze=Qt,kr!==4&&(kr=2),as===null?as=[ze]:as.push(ze),Qt=Sg(Qt,Gt),Gt=dt;do{switch(Gt.tag){case 3:Gt.flags|=65536,he&=-he,Gt.lanes|=he;var kt=uc(Gt,Qt,he);yl(Gt,kt);break e;case 1:ze=Qt;var xt=Gt.type,Ut=Gt.stateNode;if((Gt.flags&128)===0&&(typeof xt.getDerivedStateFromError=="function"||Ut!==null&&typeof Ut.componentDidCatch=="function"&&(Go===null||!Go.has(Ut)))){Gt.flags|=65536,he&=-he,Gt.lanes|=he;var Bn=Xl(Gt,ze,he);yl(Gt,Bn);break e}}Gt=Gt.return}while(Gt!==null)}Yg(Ge)}catch(Vn){he=Vn,mr===Ge&&Ge!==null&&(mr=Ge=Ge.return);continue}break}while(!0)}function Xg(){var Ie=rl.current;return rl.current=ya,Ie===null?ya:Ie}function Jl(){(kr===0||kr===3||kr===2)&&(kr=4),Dr===null||(Vo&268435455)===0&&(Qi&268435455)===0||hi(Dr,Wr)}function ll(Ie,he){var Ge=nr;nr|=2;var we=Xg();Dr===Ie&&Wr===he||gs(Ie,he);do try{Ic();break}catch(Le){Hg(Ie,Le)}while(!0);if(ii(),nr=Ge,rl.current=we,mr!==null)throw Error(oe(261));return Dr=null,Wr=0,kr}function Ic(){for(;mr!==null;)kg(mr)}function pc(){for(;mr!==null&&!oo();)kg(mr)}function kg(Ie){var he=Dg(Ie.alternate,Ie,Bi);Ie.memoizedProps=Ie.pendingProps,he===null?Yg(Ie):mr=he,Bo.current=null}function Yg(Ie){var he=Ie;do{var Ge=he.alternate;if(Ie=he.return,(he.flags&32768)===0){if(Ge=Kl(Ge,he,Bi),Ge!==null){mr=Ge;return}}else{if(Ge=Ul(Ge,he),Ge!==null){Ge.flags&=32767,mr=Ge;return}if(Ie!==null)Ie.flags|=32768,Ie.subtreeFlags=0,Ie.deletions=null;else{kr=6,mr=null;return}}if(he=he.sibling,he!==null){mr=he;return}mr=he=Ie}while(he!==null);kr===0&&(kr=5)}function Ro(Ie,he){var Ge=Jn,we=Ar.transition;try{Ar.transition=null,Jn=1,Cc(Ie,he,Ge)}finally{Ar.transition=we,Jn=Ge}return null}function Cc(Ie,he,Ge){do No();while(To!==null);if((nr&6)!==0)throw Error(oe(327));var we=Ie.finishedWork,Le=Ie.finishedLanes;if(we===null)return null;if(Ie.finishedWork=null,Ie.finishedLanes=0,we===Ie.current)throw Error(oe(177));Ie.callbackNode=null,Ie.callbackPriority=0;var ze=we.lanes|we.childLanes;if(fo(Ie,ze),Ie===Dr&&(mr=Dr=null,Wr=0),(we.subtreeFlags&2064)===0&&(we.flags&2064)===0||xa||(xa=!0,Ql(bi,function(){return No(),null})),ze=(we.flags&15990)!==0,(we.subtreeFlags&15990)!==0||ze){ze=Ar.transition,Ar.transition=null;var dt=Jn;Jn=1;var Gt=nr;nr|=4,Bo.current=null,_g(Ie,we),Dc(Ie,we),je(Ie.containerInfo),Ie.current=we,$a(we),Al(),nr=Gt,Jn=dt,Ar.transition=ze}else Ie.current=we;if(xa&&(xa=!1,To=Ie,na=Le),ze=Ie.pendingLanes,ze===0&&(Go=null),Xo(we.stateNode),Hi(Ie,_r()),he!==null)for(Ge=Ie.onRecoverableError,we=0;we<he.length;we++)Ge(he[we]);if(wa)throw wa=!1,Ie=Zr,Zr=null,Ie;return(na&1)!==0&&Ie.tag!==0&&No(),ze=Ie.pendingLanes,(ze&1)!==0?Ie===ls?ra++:(ra=0,ls=Ie):ra=0,yi(),null}function No(){if(To!==null){var Ie=io(na),he=Ar.transition,Ge=Jn;try{if(Ar.transition=null,Jn=16>Ie?16:Ie,To===null)var we=!1;else{if(Ie=To,To=null,na=0,(nr&6)!==0)throw Error(oe(331));var Le=nr;for(nr|=4,mn=Ie.current;mn!==null;){var ze=mn,dt=ze.child;if((mn.flags&16)!==0){var Gt=ze.deletions;if(Gt!==null){for(var Qt=0;Qt<Gt.length;Qt++){var In=Gt[Qt];for(mn=In;mn!==null;){var Rn=mn;switch(Rn.tag){case 0:case 11:case 15:rs(8,Rn,ze)}var $n=Rn.child;if($n!==null)$n.return=Rn,mn=$n;else for(;mn!==null;){Rn=mn;var Yn=Rn.sibling,ir=Rn.return;if(Mg(Rn),Rn===In){mn=null;break}if(Yn!==null){Yn.return=ir,mn=Yn;break}mn=ir}}}var Gn=ze.alternate;if(Gn!==null){var fi=Gn.child;if(fi!==null){Gn.child=null;do{var eo=fi.sibling;fi.sibling=null,fi=eo}while(fi!==null)}}mn=ze}}if((ze.subtreeFlags&2064)!==0&&dt!==null)dt.return=ze,mn=dt;else e:for(;mn!==null;){if(ze=mn,(ze.flags&2048)!==0)switch(ze.tag){case 0:case 11:case 15:rs(9,ze,ze.return)}var kt=ze.sibling;if(kt!==null){kt.return=ze.return,mn=kt;break e}mn=ze.return}}var xt=Ie.current;for(mn=xt;mn!==null;){dt=mn;var Ut=dt.child;if((dt.subtreeFlags&2064)!==0&&Ut!==null)Ut.return=dt,mn=Ut;else e:for(dt=xt;mn!==null;){if(Gt=mn,(Gt.flags&2048)!==0)try{switch(Gt.tag){case 0:case 11:case 15:pi(9,Gt)}}catch(Vn){Mi(Gt,Gt.return,Vn)}if(Gt===dt){mn=null;break e}var Bn=Gt.sibling;if(Bn!==null){Bn.return=Gt.return,mn=Bn;break e}mn=Gt.return}}if(nr=Le,yi(),Di&&typeof Di.onPostCommitFiberRoot=="function")try{Di.onPostCommitFiberRoot(fs,Ie)}catch{}we=!0}return we}finally{Jn=Ge,Ar.transition=he}}return!1}function gl(Ie,he,Ge){he=Sg(Ge,he),he=uc(Ie,he,1),ys(Ie,he),he=pr(),Ie=_s(Ie,1),Ie!==null&&(ro(Ie,1,he),Hi(Ie,he))}function Mi(Ie,he,Ge){if(Ie.tag===3)gl(Ie,Ie,Ge);else for(;he!==null;){if(he.tag===3){gl(he,Ie,Ge);break}else if(he.tag===1){var we=he.stateNode;if(typeof he.type.getDerivedStateFromError=="function"||typeof we.componentDidCatch=="function"&&(Go===null||!Go.has(we))){Ie=Sg(Ge,Ie),Ie=Xl(he,Ie,1),ys(he,Ie),Ie=pr(),he=_s(he,1),he!==null&&(ro(he,1,Ie),Hi(he,Ie));break}}he=he.return}}function Kg(Ie,he,Ge){var we=Ie.pingCache;we!==null&&we.delete(he),he=pr(),Ie.pingedLanes|=Ie.suspendedLanes&Ge,Dr===Ie&&(Wr&Ge)===Ge&&(kr===4||kr===3&&(Wr&130023424)===Wr&&500>_r()-il?gs(Ie,0):ea|=Ge),Hi(Ie,he)}function zg(Ie,he){he===0&&((Ie.mode&1)===0?he=1:(he=or,or<<=1,(or&130023424)===0&&(or=4194304)));var Ge=pr();Ie=_s(Ie,he),Ie!==null&&(ro(Ie,he,Ge),Hi(Ie,Ge))}function hc(Ie){var he=Ie.memoizedState,Ge=0;he!==null&&(Ge=he.retryLane),zg(Ie,Ge)}function fc(Ie,he){var Ge=0;switch(Ie.tag){case 13:var we=Ie.stateNode,Le=Ie.memoizedState;Le!==null&&(Ge=Le.retryLane);break;case 19:we=Ie.stateNode;break;default:throw Error(oe(314))}we!==null&&we.delete(he),zg(Ie,Ge)}var Dg;Dg=function(Ie,he,Ge){if(Ie!==null)if(Ie.memoizedProps!==he.pendingProps||Dn.current)li=!0;else{if((Ie.lanes&Ge)===0&&(he.flags&128)===0)return li=!1,Dl(Ie,he,Ge);li=(Ie.flags&131072)!==0}else li=!1,Mr&&(he.flags&1048576)!==0&&rc(he,Sl,he.index);switch(he.lanes=0,he.tag){case 2:var we=he.type;Ie!==null&&(Ie.alternate=null,he.alternate=null,he.flags|=2),Ie=he.pendingProps;var Le=tr(he,gr.current);Kr(he,Ge),Le=fa(null,he,we,Ie,Le,Ge);var ze=Ss();return he.flags|=1,typeof Le=="object"&&Le!==null&&typeof Le.render=="function"&&Le.$$typeof===void 0?(he.tag=1,he.memoizedState=null,he.updateQueue=null,sr(we)?(ze=!0,ar(he)):ze=!1,he.memoizedState=Le.state!==null&&Le.state!==void 0?Le.state:null,ga(he),Le.updater=Bl,he.stateNode=Le,Le._reactInternals=he,ug(he,we,Ie,Ge),he=vi(null,he,we,!0,ze,Ge)):(he.tag=0,Mr&&ze&&dg(he),Xr(null,he,Le,Ge),he=he.child),he;case 16:we=he.elementType;e:{switch(Ie!==null&&(Ie.alternate=null,he.alternate=null,he.flags|=2),Ie=he.pendingProps,Le=we._init,we=Le(we._payload),he.type=we,Le=he.tag=Uc(we),Ie=ri(we,Ie),Le){case 0:he=qo(null,he,we,Ie,Ge);break e;case 1:he=Ds(null,he,we,Ie,Ge);break e;case 11:he=Sr(null,he,we,Ie,Ge);break e;case 14:he=Br(null,he,we,ri(we.type,Ie),Ge);break e}throw Error(oe(306,we,""))}return he;case 0:return we=he.type,Le=he.pendingProps,Le=he.elementType===we?Le:ri(we,Le),qo(Ie,he,we,Le,Ge);case 1:return we=he.type,Le=he.pendingProps,Le=he.elementType===we?Le:ri(we,Le),Ds(Ie,he,we,Le,Ge);case 3:e:{if(Oa(he),Ie===null)throw Error(oe(387));we=he.pendingProps,ze=he.memoizedState,Le=ze.element,lg(Ie,he),vl(he,we,null,Ge);var dt=he.memoizedState;if(we=dt.element,Vt&&ze.isDehydrated)if(ze={element:we,isDehydrated:!1,cache:dt.cache,transitions:dt.transitions},he.updateQueue.baseState=ze,he.memoizedState=ze,he.flags&256){Le=Error(oe(423)),he=xg(Ie,he,we,Ge,Le);break e}else if(we!==Le){Le=Error(oe(424)),he=xg(Ie,he,we,Ge,Le);break e}else for(Vt&&(di=Hr(he.stateNode.containerInfo),xi=he,Mr=!0,go=null,ua=!1),Ge=sc(he,null,we,Ge),he.child=Ge;Ge;)Ge.flags=Ge.flags&-3|4096,Ge=Ge.sibling;else{if(da(),we===Le){he=Li(Ie,he,Ge);break e}Xr(Ie,he,we,Ge)}he=he.child}return he;case 5:return ac(he),Ie===null&&Bs(he),we=he.type,Le=he.pendingProps,ze=Ie!==null?Ie.memoizedProps:null,dt=Le.children,gt(we,Le)?dt=null:ze!==null&&gt(we,ze)&&(he.flags|=32),Zi(Ie,he),Xr(Ie,he,dt,Ge),he.child;case 6:return Ie===null&&Bs(he),null;case 13:return Zg(Ie,he,Ge);case 4:return xl(he,he.stateNode.containerInfo),we=he.pendingProps,Ie===null?he.child=Oo(he,null,we,Ge):Xr(Ie,he,we,Ge),he.child;case 11:return we=he.type,Le=he.pendingProps,Le=he.elementType===we?Le:ri(we,Le),Sr(Ie,he,we,Le,Ge);case 7:return Xr(Ie,he,he.pendingProps,Ge),he.child;case 8:return Xr(Ie,he,he.pendingProps.children,Ge),he.child;case 12:return Xr(Ie,he,he.pendingProps.children,Ge),he.child;case 10:e:{if(we=he.type._context,Le=he.pendingProps,ze=he.memoizedProps,dt=Le.value,zo(he,we,dt),ze!==null)if(ti(ze.value,dt)){if(ze.children===Le.children&&!Dn.current){he=Li(Ie,he,Ge);break e}}else for(ze=he.child,ze!==null&&(ze.return=he);ze!==null;){var Gt=ze.dependencies;if(Gt!==null){dt=ze.child;for(var Qt=Gt.firstContext;Qt!==null;){if(Qt.context===we){if(ze.tag===1){Qt=Do(-1,Ge&-Ge),Qt.tag=2;var In=ze.updateQueue;if(In!==null){In=In.shared;var Rn=In.pending;Rn===null?Qt.next=Qt:(Qt.next=Rn.next,Rn.next=Qt),In.pending=Qt}}ze.lanes|=Ge,Qt=ze.alternate,Qt!==null&&(Qt.lanes|=Ge),Qr(ze.return,Ge,he),Gt.lanes|=Ge;break}Qt=Qt.next}}else if(ze.tag===10)dt=ze.type===he.type?null:ze.child;else if(ze.tag===18){if(dt=ze.return,dt===null)throw Error(oe(341));dt.lanes|=Ge,Gt=dt.alternate,Gt!==null&&(Gt.lanes|=Ge),Qr(dt,Ge,he),dt=ze.sibling}else dt=ze.child;if(dt!==null)dt.return=ze;else for(dt=ze;dt!==null;){if(dt===he){dt=null;break}if(ze=dt.sibling,ze!==null){ze.return=dt.return,dt=ze;break}dt=dt.return}ze=dt}Xr(Ie,he,Le.children,Ge),he=he.child}return he;case 9:return Le=he.type,we=he.pendingProps.children,Kr(he,Ge),Le=Fr(Le),we=we(Le),he.flags|=1,Xr(Ie,he,we,Ge),he.child;case 14:return we=he.type,Le=ri(we,he.pendingProps),Le=ri(we.type,Le),Br(Ie,he,we,Le,Ge);case 15:return $o(Ie,he,he.type,he.pendingProps,Ge);case 17:return we=he.type,Le=he.pendingProps,Le=he.elementType===we?Le:ri(we,Le),Ie!==null&&(Ie.alternate=null,he.alternate=null,he.flags|=2),he.tag=1,sr(we)?(Ie=!0,ar(he)):Ie=!1,Kr(he,Ge),tc(he,we,Le),ug(he,we,Le,Ge),vi(null,he,we,!0,Ie,Ge);case 19:return Ps(Ie,he,Ge);case 22:return Ii(Ie,he,Ge)}throw Error(oe(156,he.tag))};function Ql(Ie,he){return zi(Ie,he)}function Ac(Ie,he,Ge,we){this.tag=Ie,this.key=Ge,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=he,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=we,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function qi(Ie,he,Ge,we){return new Ac(Ie,he,Ge,we)}function $l(Ie){return Ie=Ie.prototype,!(!Ie||!Ie.isReactComponent)}function Uc(Ie){if(typeof Ie=="function")return $l(Ie)?1:0;if(Ie!=null){if(Ie=Ie.$$typeof,Ie===be)return 11;if(Ie===ve)return 14}return 2}function cs(Ie,he){var Ge=Ie.alternate;return Ge===null?(Ge=qi(Ie.tag,he,Ie.key,Ie.mode),Ge.elementType=Ie.elementType,Ge.type=Ie.type,Ge.stateNode=Ie.stateNode,Ge.alternate=Ie,Ie.alternate=Ge):(Ge.pendingProps=he,Ge.type=Ie.type,Ge.flags=0,Ge.subtreeFlags=0,Ge.deletions=null),Ge.flags=Ie.flags&14680064,Ge.childLanes=Ie.childLanes,Ge.lanes=Ie.lanes,Ge.child=Ie.child,Ge.memoizedProps=Ie.memoizedProps,Ge.memoizedState=Ie.memoizedState,Ge.updateQueue=Ie.updateQueue,he=Ie.dependencies,Ge.dependencies=he===null?null:{lanes:he.lanes,firstContext:he.firstContext},Ge.sibling=Ie.sibling,Ge.index=Ie.index,Ge.ref=Ie.ref,Ge}function ql(Ie,he,Ge,we,Le,ze){var dt=2;if(we=Ie,typeof Ie=="function")$l(Ie)&&(dt=1);else if(typeof Ie=="string")dt=5;else e:switch(Ie){case ge:return ia(Ge.children,Le,ze,he);case ce:dt=8,Le|=8;break;case de:return Ie=qi(12,Ge,he,Le|2),Ie.elementType=de,Ie.lanes=ze,Ie;case me:return Ie=qi(13,Ge,he,Le),Ie.elementType=me,Ie.lanes=ze,Ie;case ye:return Ie=qi(19,Ge,he,Le),Ie.elementType=ye,Ie.lanes=ze,Ie;case Re:return cl(Ge,Le,ze,he);default:if(typeof Ie=="object"&&Ie!==null)switch(Ie.$$typeof){case pe:dt=10;break e;case fe:dt=9;break e;case be:dt=11;break e;case ve:dt=14;break e;case Be:dt=16,we=null;break e}throw Error(oe(130,Ie==null?Ie:typeof Ie,""))}return he=qi(dt,Ge,he,Le),he.elementType=Ie,he.type=we,he.lanes=ze,he}function ia(Ie,he,Ge,we){return Ie=qi(7,Ie,we,he),Ie.lanes=Ge,Ie}function cl(Ie,he,Ge,we){return Ie=qi(22,Ie,we,he),Ie.elementType=Re,Ie.lanes=Ge,Ie.stateNode={},Ie}function eg(Ie,he,Ge){return Ie=qi(6,Ie,null,he),Ie.lanes=Ge,Ie}function tg(Ie,he,Ge){return he=qi(4,Ie.children!==null?Ie.children:[],Ie.key,he),he.lanes=Ge,he.stateNode={containerInfo:Ie.containerInfo,pendingChildren:null,implementation:Ie.implementation},he}function ng(Ie,he,Ge,we,Le){this.tag=he,this.containerInfo=Ie,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=Kt,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Ws(0),this.expirationTimes=Ws(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Ws(0),this.identifierPrefix=we,this.onRecoverableError=Le,Vt&&(this.mutableSourceEagerHydrationData=null)}function mc(Ie,he,Ge,we,Le,ze,dt,Gt,Qt){return Ie=new ng(Ie,he,Ge,Gt,Qt),he===1?(he=1,ze===!0&&(he|=8)):he=0,ze=qi(3,null,null,he),Ie.current=ze,ze.stateNode=Ie,ze.memoizedState={element:we,isDehydrated:Ge,cache:null,transitions:null},ga(ze),Ie}function bc(Ie){if(!Ie)return Nn;Ie=Ie._reactInternals;e:{if(_e(Ie)!==Ie||Ie.tag!==1)throw Error(oe(170));var he=Ie;do{switch(he.tag){case 3:he=he.stateNode.context;break e;case 1:if(sr(he.type)){he=he.stateNode.__reactInternalMemoizedMergedChildContext;break e}}he=he.return}while(he!==null);throw Error(oe(171))}if(Ie.tag===1){var Ge=Ie.type;if(sr(Ge))return yr(Ie,Ge,he)}return he}function yc(Ie){var he=Ie._reactInternals;if(he===void 0)throw typeof Ie.render=="function"?Error(oe(188)):(Ie=Object.keys(Ie).join(","),Error(oe(268,Ie)));return Ie=He(he),Ie===null?null:Ie.stateNode}function Io(Ie,he){if(Ie=Ie.memoizedState,Ie!==null&&Ie.dehydrated!==null){var Ge=Ie.retryLane;Ie.retryLane=Ge!==0&&Ge<he?Ge:he}}function ul(Ie,he){Io(Ie,he),(Ie=Ie.alternate)&&Io(Ie,he)}function rg(Ie){return Ie=He(Ie),Ie===null?null:Ie.stateNode}function vc(){return null}return _.attemptContinuousHydration=function(Ie){if(Ie.tag===13){var he=pr();Gi(Ie,134217728,he),ul(Ie,134217728)}},_.attemptHydrationAtCurrentPriority=function(Ie){if(Ie.tag===13){var he=pr(),Ge=So(Ie);Gi(Ie,Ge,he),ul(Ie,Ge)}},_.attemptSynchronousHydration=function(Ie){switch(Ie.tag){case 3:var he=Ie.stateNode;if(he.current.memoizedState.isDehydrated){var Ge=xo(he.pendingLanes);Ge!==0&&(ui(he,Ge|1),Hi(he,_r()),(nr&6)===0&&(ta(),yi()))}break;case 13:var we=pr();Za(function(){return Gi(Ie,1,we)}),ul(Ie,1)}},_.batchedUpdates=function(Ie,he){var Ge=nr;nr|=1;try{return Ie(he)}finally{nr=Ge,nr===0&&(ta(),_o&&yi())}},_.createComponentSelector=function(Ie){return{$$typeof:el,value:Ie}},_.createContainer=function(Ie,he,Ge,we,Le,ze,dt){return mc(Ie,he,!1,null,Ge,we,Le,ze,dt)},_.createHasPseudoClassSelector=function(Ie){return{$$typeof:Js,value:Ie}},_.createHydrationContainer=function(Ie,he,Ge,we,Le,ze,dt,Gt,Qt){return Ie=mc(Ge,we,!0,Ie,Le,ze,dt,Gt,Qt),Ie.context=bc(null),Ge=Ie.current,we=pr(),Le=So(Ge),ze=Do(we,Le),ze.callback=he??null,ys(Ge,ze),Ie.current.lanes=Le,ro(Ie,Le,we),Hi(Ie,we),Ie},_.createPortal=function(Ie,he,Ge){var we=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:ae,key:we==null?null:""+we,children:Ie,containerInfo:he,implementation:Ge}},_.createRoleSelector=function(Ie){return{$$typeof:Qs,value:Ie}},_.createTestNameSelector=function(Ie){return{$$typeof:os,value:Ie}},_.createTextSelector=function(Ie){return{$$typeof:Sa,value:Ie}},_.deferredUpdates=function(Ie){var he=Jn,Ge=Ar.transition;try{return Ar.transition=null,Jn=16,Ie()}finally{Jn=he,Ar.transition=Ge}},_.discreteUpdates=function(Ie,he,Ge,we,Le){var ze=Jn,dt=Ar.transition;try{return Ar.transition=null,Jn=1,Ie(he,Ge,we,Le)}finally{Jn=ze,Ar.transition=dt,nr===0&&ta()}},_.findAllNodes=ss,_.findBoundingRects=function(Ie,he){if(!Pt)throw Error(oe(363));he=ss(Ie,he),Ie=[];for(var Ge=0;Ge<he.length;Ge++)Ie.push(un(he[Ge]));for(he=Ie.length-1;0<he;he--){Ge=Ie[he];for(var we=Ge.x,Le=we+Ge.width,ze=Ge.y,dt=ze+Ge.height,Gt=he-1;0<=Gt;Gt--)if(he!==Gt){var Qt=Ie[Gt],In=Qt.x,Rn=In+Qt.width,$n=Qt.y,Yn=$n+Qt.height;if(we>=In&&ze>=$n&&Le<=Rn&&dt<=Yn){Ie.splice(he,1);break}else if(we!==In||Ge.width!==Qt.width||Yn<ze||$n>dt){if(!(ze!==$n||Ge.height!==Qt.height||Rn<we||In>Le)){In>we&&(Qt.width+=In-we,Qt.x=we),Rn<Le&&(Qt.width=Le-In),Ie.splice(he,1);break}}else{$n>ze&&(Qt.height+=$n-ze,Qt.y=ze),Yn<dt&&(Qt.height=dt-$n),Ie.splice(he,1);break}}}return Ie},_.findHostInstance=yc,_.findHostInstanceWithNoPortals=function(Ie){return Ie=Pe(Ie),Ie=Ie!==null?Ue(Ie):null,Ie===null?null:Ie.stateNode},_.findHostInstanceWithWarning=function(Ie){return yc(Ie)},_.flushControlled=function(Ie){var he=nr;nr|=1;var Ge=Ar.transition,we=Jn;try{Ar.transition=null,Jn=1,Ie()}finally{Jn=we,Ar.transition=Ge,nr=he,nr===0&&(ta(),yi())}},_.flushPassiveEffects=No,_.flushSync=Za,_.focusWithin=function(Ie,he){if(!Pt)throw Error(oe(363));for(Ie=tl(Ie),he=Ji(Ie,he),he=Array.from(he),Ie=0;Ie<he.length;){var Ge=he[Ie++];if(!Je(Ge)){if(Ge.tag===5&&Dt(Ge.stateNode))return!0;for(Ge=Ge.child;Ge!==null;)he.push(Ge),Ge=Ge.sibling}}return!1},_.getCurrentUpdatePriority=function(){return Jn},_.getFindAllNodesFailureDescription=function(Ie,he){if(!Pt)throw Error(oe(363));var Ge=0,we=[];Ie=[tl(Ie),0];for(var Le=0;Le<Ie.length;){var ze=Ie[Le++],dt=Ie[Le++],Gt=he[dt];if((ze.tag!==5||!Je(ze))&&(nl(ze,Gt)&&(we.push(Zs(Gt)),dt++,dt>Ge&&(Ge=dt)),dt<he.length))for(ze=ze.child;ze!==null;)Ie.push(ze,dt),ze=ze.sibling}if(Ge<he.length){for(Ie=[];Ge<he.length;Ge++)Ie.push(Zs(he[Ge]));return`findAllNodes was able to match part of the selector:
  `+(we.join(" > ")+`

No matching component was found for:
  `)+Ie.join(" > ")}return null},_.getPublicRootInstance=function(Ie){if(Ie=Ie.current,!Ie.child)return null;switch(Ie.child.tag){case 5:return rt(Ie.child.stateNode);default:return Ie.child.stateNode}},_.injectIntoDevTools=function(Ie){if(Ie={bundleType:Ie.bundleType,version:Ie.version,rendererPackageName:Ie.rendererPackageName,rendererConfig:Ie.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:ie.ReactCurrentDispatcher,findHostInstanceByFiber:rg,findFiberByHostInstance:Ie.findFiberByHostInstance||vc,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.0.0-fc46dba67-20220329"},typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u")Ie=!1;else{var he=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(he.isDisabled||!he.supportsFiber)Ie=!0;else{try{fs=he.inject(Ie),Di=he}catch{}Ie=!!he.checkDCE}}return Ie},_.isAlreadyRendering=function(){return!1},_.observeVisibleRects=function(Ie,he,Ge,we){if(!Pt)throw Error(oe(363));Ie=ss(Ie,he);var Le=_t(Ie,Ge,we).disconnect;return{disconnect:function(){Le()}}},_.registerMutableSourceForHydration=function(Ie,he){var Ge=he._getVersion;Ge=Ge(he._source),Ie.mutableSourceEagerHydrationData==null?Ie.mutableSourceEagerHydrationData=[he,Ge]:Ie.mutableSourceEagerHydrationData.push(he,Ge)},_.runWithPriority=function(Ie,he){var Ge=Jn;try{return Jn=Ie,he()}finally{Jn=Ge}},_.shouldError=function(){return null},_.shouldSuspend=function(){return!1},_.updateContainer=function(Ie,he,Ge,we){var Le=he.current,ze=pr(),dt=So(Le);return Ge=bc(Ge),he.context===null?he.context=Ge:he.pendingContext=Ge,he=Do(ze,dt),he.payload={element:Ie},we=we===void 0?null:we,we!==null&&(he.callback=we),ys(Le,he),Ie=Gi(Le,dt,ze),Ie!==null&&bl(Ie,Le,dt),dt},_}),reactReconciler_production_min}var hasRequiredReactReconciler;function requireReactReconciler(){return hasRequiredReactReconciler||(hasRequiredReactReconciler=1,reactReconciler.exports=requireReactReconciler_production_min()),reactReconciler.exports}var reactReconcilerExports=requireReactReconciler();const Reconciler=getDefaultExportFromCjs(reactReconcilerExports);var scheduler={exports:{}},scheduler_production_min={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var hasRequiredScheduler_production_min;function requireScheduler_production_min(){return hasRequiredScheduler_production_min||(hasRequiredScheduler_production_min=1,function(X){function Z(Oe,$e){var je=Oe.length;Oe.push($e);e:for(;0<je;){var Te=je-1>>>1,De=Oe[Te];if(0<te(De,$e))Oe[Te]=$e,Oe[je]=De,je=Te;else break e}}function _(Oe){return Oe.length===0?null:Oe[0]}function K(Oe){if(Oe.length===0)return null;var $e=Oe[0],je=Oe.pop();if(je!==$e){Oe[0]=je;e:for(var Te=0,De=Oe.length,ot=De>>>1;Te<ot;){var ct=2*(Te+1)-1,gt=Oe[ct],pt=ct+1,ht=Oe[pt];if(0>te(gt,je))pt<De&&0>te(ht,gt)?(Oe[Te]=ht,Oe[pt]=je,Te=pt):(Oe[Te]=gt,Oe[ct]=je,Te=ct);else if(pt<De&&0>te(ht,je))Oe[Te]=ht,Oe[pt]=je,Te=pt;else break e}}return $e}function te(Oe,$e){var je=Oe.sortIndex-$e.sortIndex;return je!==0?je:Oe.id-$e.id}if(typeof performance=="object"&&typeof performance.now=="function"){var ne=performance;X.unstable_now=function(){return ne.now()}}else{var oe=Date,ie=oe.now();X.unstable_now=function(){return oe.now()-ie}}var se=[],ae=[],ge=1,ce=null,de=3,pe=!1,fe=!1,be=!1,me=typeof setTimeout=="function"?setTimeout:null,ye=typeof clearTimeout=="function"?clearTimeout:null,ve=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function Be(Oe){for(var $e=_(ae);$e!==null;){if($e.callback===null)K(ae);else if($e.startTime<=Oe)K(ae),$e.sortIndex=$e.expirationTime,Z(se,$e);else break;$e=_(ae)}}function Re(Oe){if(be=!1,Be(Oe),!fe)if(_(se)!==null)fe=!0,rt(Ee);else{var $e=_(ae);$e!==null&&at(Re,$e.startTime-Oe)}}function Ee(Oe,$e){fe=!1,be&&(be=!1,ye(Ve),Ve=-1),pe=!0;var je=de;try{for(Be($e),ce=_(se);ce!==null&&(!(ce.expirationTime>$e)||Oe&&!Pe());){var Te=ce.callback;if(typeof Te=="function"){ce.callback=null,de=ce.priorityLevel;var De=Te(ce.expirationTime<=$e);$e=X.unstable_now(),typeof De=="function"?ce.callback=De:ce===_(se)&&K(se),Be($e)}else K(se);ce=_(se)}if(ce!==null)var ot=!0;else{var ct=_(ae);ct!==null&&at(Re,ct.startTime-$e),ot=!1}return ot}finally{ce=null,de=je,pe=!1}}var We=!1,Ze=null,Ve=-1,_e=5,Xe=-1;function Pe(){return!(X.unstable_now()-Xe<_e)}function He(){if(Ze!==null){var Oe=X.unstable_now();Xe=Oe;var $e=!0;try{$e=Ze(!0,Oe)}finally{$e?Ke():(We=!1,Ze=null)}}else We=!1}var Ke;if(typeof ve=="function")Ke=function(){ve(He)};else if(typeof MessageChannel<"u"){var Ue=new MessageChannel,tt=Ue.port2;Ue.port1.onmessage=He,Ke=function(){tt.postMessage(null)}}else Ke=function(){me(He,0)};function rt(Oe){Ze=Oe,We||(We=!0,Ke())}function at(Oe,$e){Ve=me(function(){Oe(X.unstable_now())},$e)}X.unstable_IdlePriority=5,X.unstable_ImmediatePriority=1,X.unstable_LowPriority=4,X.unstable_NormalPriority=3,X.unstable_Profiling=null,X.unstable_UserBlockingPriority=2,X.unstable_cancelCallback=function(Oe){Oe.callback=null},X.unstable_continueExecution=function(){fe||pe||(fe=!0,rt(Ee))},X.unstable_forceFrameRate=function(Oe){0>Oe||125<Oe?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):_e=0<Oe?Math.floor(1e3/Oe):5},X.unstable_getCurrentPriorityLevel=function(){return de},X.unstable_getFirstCallbackNode=function(){return _(se)},X.unstable_next=function(Oe){switch(de){case 1:case 2:case 3:var $e=3;break;default:$e=de}var je=de;de=$e;try{return Oe()}finally{de=je}},X.unstable_pauseExecution=function(){},X.unstable_requestPaint=function(){},X.unstable_runWithPriority=function(Oe,$e){switch(Oe){case 1:case 2:case 3:case 4:case 5:break;default:Oe=3}var je=de;de=Oe;try{return $e()}finally{de=je}},X.unstable_scheduleCallback=function(Oe,$e,je){var Te=X.unstable_now();switch(typeof je=="object"&&je!==null?(je=je.delay,je=typeof je=="number"&&0<je?Te+je:Te):je=Te,Oe){case 1:var De=-1;break;case 2:De=250;break;case 5:De=1073741823;break;case 4:De=1e4;break;default:De=5e3}return De=je+De,Oe={id:ge++,callback:$e,priorityLevel:Oe,startTime:je,expirationTime:De,sortIndex:-1},je>Te?(Oe.sortIndex=je,Z(ae,Oe),_(se)===null&&Oe===_(ae)&&(be?(ye(Ve),Ve=-1):be=!0,at(Re,je-Te))):(Oe.sortIndex=De,Z(se,Oe),fe||pe||(fe=!0,rt(Ee))),Oe},X.unstable_shouldYield=Pe,X.unstable_wrapCallback=function(Oe){var $e=de;return function(){var je=de;de=$e;try{return Oe.apply(this,arguments)}finally{de=je}}}}(scheduler_production_min)),scheduler_production_min}var hasRequiredScheduler;function requireScheduler(){return hasRequiredScheduler||(hasRequiredScheduler=1,scheduler.exports=requireScheduler_production_min()),scheduler.exports}var schedulerExports=requireScheduler();const catalogue={},extend=X=>void Object.assign(catalogue,X);function createRenderer(X,Z){function _(ge,{args:ce=[],attach:de,...pe},fe){let be=`${ge[0].toUpperCase()}${ge.slice(1)}`,me;if(ge==="primitive"){if(pe.object===void 0)throw new Error("R3F: Primitives without 'object' are invalid!");const ye=pe.object;me=prepare$1(ye,{type:ge,root:fe,attach:de,primitive:!0})}else{const ye=catalogue[be];if(!ye)throw new Error(`R3F: ${be} is not part of the THREE namespace! Did you forget to extend? See: https://docs.pmnd.rs/react-three-fiber/api/objects#using-3rd-party-objects-declaratively`);if(!Array.isArray(ce))throw new Error("R3F: The args prop must be an array!");me=prepare$1(new ye(...ce),{type:ge,root:fe,attach:de,memoizedProps:{args:ce}})}return me.__r3f.attach===void 0&&(me.isBufferGeometry?me.__r3f.attach="geometry":me.isMaterial&&(me.__r3f.attach="material")),be!=="inject"&&applyProps$1(me,pe),me}function K(ge,ce){let de=!1;if(ce){var pe,fe;(pe=ce.__r3f)!=null&&pe.attach?attach(ge,ce,ce.__r3f.attach):ce.isObject3D&&ge.isObject3D&&(ge.add(ce),de=!0),de||(fe=ge.__r3f)==null||fe.objects.push(ce),ce.__r3f||prepare$1(ce,{}),ce.__r3f.parent=ge,updateInstance(ce),invalidateInstance(ce)}}function te(ge,ce,de){let pe=!1;if(ce){var fe,be;if((fe=ce.__r3f)!=null&&fe.attach)attach(ge,ce,ce.__r3f.attach);else if(ce.isObject3D&&ge.isObject3D){ce.parent=ge,ce.dispatchEvent({type:"added"}),ge.dispatchEvent({type:"childadded",child:ce});const me=ge.children.filter(ve=>ve!==ce),ye=me.indexOf(de);ge.children=[...me.slice(0,ye),ce,...me.slice(ye)],pe=!0}pe||(be=ge.__r3f)==null||be.objects.push(ce),ce.__r3f||prepare$1(ce,{}),ce.__r3f.parent=ge,updateInstance(ce),invalidateInstance(ce)}}function ne(ge,ce,de=!1){ge&&[...ge].forEach(pe=>oe(ce,pe,de))}function oe(ge,ce,de){if(ce){var pe,fe,be;if(ce.__r3f&&(ce.__r3f.parent=null),(pe=ge.__r3f)!=null&&pe.objects&&(ge.__r3f.objects=ge.__r3f.objects.filter(Re=>Re!==ce)),(fe=ce.__r3f)!=null&&fe.attach)detach(ge,ce,ce.__r3f.attach);else if(ce.isObject3D&&ge.isObject3D){var me;ge.remove(ce),(me=ce.__r3f)!=null&&me.root&&removeInteractivity(findInitialRoot(ce),ce)}const ve=(be=ce.__r3f)==null?void 0:be.primitive,Be=!ve&&(de===void 0?ce.dispose!==null:de);if(!ve){var ye;ne((ye=ce.__r3f)==null?void 0:ye.objects,ce,Be),ne(ce.children,ce,Be)}if(delete ce.__r3f,Be&&ce.dispose&&ce.type!=="Scene"){const Re=()=>{try{ce.dispose()}catch{}};typeof IS_REACT_ACT_ENVIRONMENT>"u"?schedulerExports.unstable_scheduleCallback(schedulerExports.unstable_IdlePriority,Re):Re()}invalidateInstance(ge)}}function ie(ge,ce,de,pe){var fe;const be=(fe=ge.__r3f)==null?void 0:fe.parent;if(!be)return;const me=_(ce,de,ge.__r3f.root);if(ge.children){for(const ye of ge.children)ye.__r3f&&K(me,ye);ge.children=ge.children.filter(ye=>!ye.__r3f)}ge.__r3f.objects.forEach(ye=>K(me,ye)),ge.__r3f.objects=[],ge.__r3f.autoRemovedBeforeAppend||oe(be,ge),me.parent&&(me.__r3f.autoRemovedBeforeAppend=!0),K(be,me),me.raycast&&me.__r3f.eventCount&&findInitialRoot(me).getState().internal.interaction.push(me),[pe,pe.alternate].forEach(ye=>{ye!==null&&(ye.stateNode=me,ye.ref&&(typeof ye.ref=="function"?ye.ref(me):ye.ref.current=me))})}const se=()=>{};return{reconciler:Reconciler({createInstance:_,removeChild:oe,appendChild:K,appendInitialChild:K,insertBefore:te,supportsMutation:!0,isPrimaryRenderer:!1,supportsPersistence:!1,supportsHydration:!1,noTimeout:-1,appendChildToContainer:(ge,ce)=>{if(!ce)return;const de=ge.getState().scene;de.__r3f&&(de.__r3f.root=ge,K(de,ce))},removeChildFromContainer:(ge,ce)=>{ce&&oe(ge.getState().scene,ce)},insertInContainerBefore:(ge,ce,de)=>{if(!ce||!de)return;const pe=ge.getState().scene;pe.__r3f&&te(pe,ce,de)},getRootHostContext:()=>null,getChildHostContext:ge=>ge,finalizeInitialChildren(ge){var ce;return!!((ce=ge==null?void 0:ge.__r3f)!=null?ce:{}).handlers},prepareUpdate(ge,ce,de,pe){var fe;if(((fe=ge==null?void 0:ge.__r3f)!=null?fe:{}).primitive&&pe.object&&pe.object!==ge)return[!0];{const{args:me=[],children:ye,...ve}=pe,{args:Be=[],children:Re,...Ee}=de;if(!Array.isArray(me))throw new Error("R3F: the args prop must be an array!");if(me.some((Ze,Ve)=>Ze!==Be[Ve]))return[!0];const We=diffProps(ge,ve,Ee,!0);return We.changes.length?[!1,We]:null}},commitUpdate(ge,[ce,de],pe,fe,be,me){ce?ie(ge,pe,be,me):applyProps$1(ge,de)},commitMount(ge,ce,de,pe){var fe;const be=(fe=ge.__r3f)!=null?fe:{};ge.raycast&&be.handlers&&be.eventCount&&findInitialRoot(ge).getState().internal.interaction.push(ge)},getPublicInstance:ge=>ge,prepareForCommit:()=>null,preparePortalMount:ge=>prepare$1(ge.getState().scene),resetAfterCommit:()=>{},shouldSetTextContent:()=>!1,clearContainer:()=>!1,hideInstance(ge){var ce;const{attach:de,parent:pe}=(ce=ge.__r3f)!=null?ce:{};de&&pe&&detach(pe,ge,de),ge.isObject3D&&(ge.visible=!1),invalidateInstance(ge)},unhideInstance(ge,ce){var de;const{attach:pe,parent:fe}=(de=ge.__r3f)!=null?de:{};pe&&fe&&attach(fe,ge,pe),(ge.isObject3D&&ce.visible==null||ce.visible)&&(ge.visible=!0),invalidateInstance(ge)},createTextInstance:se,hideTextInstance:se,unhideTextInstance:se,getCurrentEventPriority:()=>Z(),beforeActiveInstanceBlur:()=>{},afterActiveInstanceBlur:()=>{},detachDeletedInstance:()=>{},now:typeof performance<"u"&&is$1.fun(performance.now)?performance.now:is$1.fun(Date.now)?Date.now:()=>0,scheduleTimeout:is$1.fun(setTimeout)?setTimeout:void 0,cancelTimeout:is$1.fun(clearTimeout)?clearTimeout:void 0}),applyProps:applyProps$1}}var _window$document,_window$navigator;const hasColorSpace$1=X=>"colorSpace"in X||"outputColorSpace"in X,getColorManagement=()=>{var X;return(X=catalogue.ColorManagement)!=null?X:null},isOrthographicCamera=X=>X&&X.isOrthographicCamera,isRef$1=X=>X&&X.hasOwnProperty("current"),useIsomorphicLayoutEffect$2=typeof window<"u"&&((_window$document=window.document)!=null&&_window$document.createElement||((_window$navigator=window.navigator)==null?void 0:_window$navigator.product)==="ReactNative")?reactExports.useLayoutEffect:reactExports.useEffect;function useMutableCallback(X){const Z=reactExports.useRef(X);return useIsomorphicLayoutEffect$2(()=>void(Z.current=X),[X]),Z}function Block({set:X}){return useIsomorphicLayoutEffect$2(()=>(X(new Promise(()=>null)),()=>X(!1)),[X]),null}class ErrorBoundary extends reactExports.Component{constructor(...Z){super(...Z),this.state={error:!1}}componentDidCatch(Z){this.props.set(Z)}render(){return this.state.error?null:this.props.children}}ErrorBoundary.getDerivedStateFromError=()=>({error:!0});const DEFAULT="__default",DEFAULTS=new Map,isDiffSet=X=>X&&!!X.memoized&&!!X.changes;function calculateDpr(X){var Z;const _=typeof window<"u"?(Z=window.devicePixelRatio)!=null?Z:2:1;return Array.isArray(X)?Math.min(Math.max(X[0],_),X[1]):X}const getRootState=X=>{var Z;return(Z=X.__r3f)==null?void 0:Z.root.getState()};function findInitialRoot(X){let Z=X.__r3f.root;for(;Z.getState().previousRoot;)Z=Z.getState().previousRoot;return Z}const is$1={obj:X=>X===Object(X)&&!is$1.arr(X)&&typeof X!="function",fun:X=>typeof X=="function",str:X=>typeof X=="string",num:X=>typeof X=="number",boo:X=>typeof X=="boolean",und:X=>X===void 0,arr:X=>Array.isArray(X),equ(X,Z,{arrays:_="shallow",objects:K="reference",strict:te=!0}={}){if(typeof X!=typeof Z||!!X!=!!Z)return!1;if(is$1.str(X)||is$1.num(X)||is$1.boo(X))return X===Z;const ne=is$1.obj(X);if(ne&&K==="reference")return X===Z;const oe=is$1.arr(X);if(oe&&_==="reference")return X===Z;if((oe||ne)&&X===Z)return!0;let ie;for(ie in X)if(!(ie in Z))return!1;if(ne&&_==="shallow"&&K==="shallow"){for(ie in te?Z:X)if(!is$1.equ(X[ie],Z[ie],{strict:te,objects:"reference"}))return!1}else for(ie in te?Z:X)if(X[ie]!==Z[ie])return!1;if(is$1.und(ie)){if(oe&&X.length===0&&Z.length===0||ne&&Object.keys(X).length===0&&Object.keys(Z).length===0)return!0;if(X!==Z)return!1}return!0}};function buildGraph(X){const Z={nodes:{},materials:{}};return X&&X.traverse(_=>{_.name&&(Z.nodes[_.name]=_),_.material&&!Z.materials[_.material.name]&&(Z.materials[_.material.name]=_.material)}),Z}function dispose(X){X.dispose&&X.type!=="Scene"&&X.dispose();for(const Z in X)Z.dispose==null||Z.dispose(),delete X[Z]}function prepare$1(X,Z){const _=X;return _.__r3f={type:"",root:null,previousAttach:null,memoizedProps:{},eventCount:0,handlers:{},objects:[],parent:null,...Z},X}function resolve(X,Z){let _=X;if(Z.includes("-")){const K=Z.split("-"),te=K.pop();return _=K.reduce((ne,oe)=>ne[oe],X),{target:_,key:te}}else return{target:_,key:Z}}const INDEX_REGEX=/-\d+$/;function attach(X,Z,_){if(is$1.str(_)){if(INDEX_REGEX.test(_)){const ne=_.replace(INDEX_REGEX,""),{target:oe,key:ie}=resolve(X,ne);Array.isArray(oe[ie])||(oe[ie]=[])}const{target:K,key:te}=resolve(X,_);Z.__r3f.previousAttach=K[te],K[te]=Z}else Z.__r3f.previousAttach=_(X,Z)}function detach(X,Z,_){var K,te;if(is$1.str(_)){const{target:ne,key:oe}=resolve(X,_),ie=Z.__r3f.previousAttach;ie===void 0?delete ne[oe]:ne[oe]=ie}else(K=Z.__r3f)==null||K.previousAttach==null||K.previousAttach(X,Z);(te=Z.__r3f)==null||delete te.previousAttach}function diffProps(X,{children:Z,key:_,ref:K,...te},{children:ne,key:oe,ref:ie,...se}={},ae=!1){const ge=X.__r3f,ce=Object.entries(te),de=[];if(ae){const fe=Object.keys(se);for(let be=0;be<fe.length;be++)te.hasOwnProperty(fe[be])||ce.unshift([fe[be],DEFAULT+"remove"])}ce.forEach(([fe,be])=>{var me;if((me=X.__r3f)!=null&&me.primitive&&fe==="object"||is$1.equ(be,se[fe]))return;if(/^on(Pointer|Click|DoubleClick|ContextMenu|Wheel)/.test(fe))return de.push([fe,be,!0,[]]);let ye=[];fe.includes("-")&&(ye=fe.split("-")),de.push([fe,be,!1,ye]);for(const ve in te){const Be=te[ve];ve.startsWith(`${fe}-`)&&de.push([ve,Be,!1,ve.split("-")])}});const pe={...te};return ge!=null&&ge.memoizedProps&&ge!=null&&ge.memoizedProps.args&&(pe.args=ge.memoizedProps.args),ge!=null&&ge.memoizedProps&&ge!=null&&ge.memoizedProps.attach&&(pe.attach=ge.memoizedProps.attach),{memoized:pe,changes:de}}function applyProps$1(X,Z){var _;const K=X.__r3f,te=K==null?void 0:K.root,ne=te==null||te.getState==null?void 0:te.getState(),{memoized:oe,changes:ie}=isDiffSet(Z)?Z:diffProps(X,Z),se=K==null?void 0:K.eventCount;X.__r3f&&(X.__r3f.memoizedProps=oe);for(let de=0;de<ie.length;de++){let[pe,fe,be,me]=ie[de];if(hasColorSpace$1(X)){const Re="srgb",Ee="srgb-linear";pe==="encoding"?(pe="colorSpace",fe=fe===3001?Re:Ee):pe==="outputEncoding"&&(pe="outputColorSpace",fe=fe===3001?Re:Ee)}let ye=X,ve=ye[pe];if(me.length&&(ve=me.reduce((Be,Re)=>Be[Re],X),!(ve&&ve.set))){const[Be,...Re]=me.reverse();ye=Re.reverse().reduce((Ee,We)=>Ee[We],X),pe=Be}if(fe===DEFAULT+"remove")if(ye.constructor){let Be=DEFAULTS.get(ye.constructor);Be||(Be=new ye.constructor,DEFAULTS.set(ye.constructor,Be)),fe=Be[pe]}else fe=0;if(be&&K)fe?K.handlers[pe]=fe:delete K.handlers[pe],K.eventCount=Object.keys(K.handlers).length;else if(ve&&ve.set&&(ve.copy||ve instanceof Layers)){if(Array.isArray(fe))ve.fromArray?ve.fromArray(fe):ve.set(...fe);else if(ve.copy&&fe&&fe.constructor&&ve.constructor===fe.constructor)ve.copy(fe);else if(fe!==void 0){var ae;const Be=(ae=ve)==null?void 0:ae.isColor;!Be&&ve.setScalar?ve.setScalar(fe):ve instanceof Layers&&fe instanceof Layers?ve.mask=fe.mask:ve.set(fe),!getColorManagement()&&ne&&!ne.linear&&Be&&ve.convertSRGBToLinear()}}else{var ge;if(ye[pe]=fe,(ge=ye[pe])!=null&&ge.isTexture&&ye[pe].format===RGBAFormat&&ye[pe].type===UnsignedByteType&&ne){const Be=ye[pe];hasColorSpace$1(Be)&&hasColorSpace$1(ne.gl)?Be.colorSpace=ne.gl.outputColorSpace:Be.encoding=ne.gl.outputEncoding}}invalidateInstance(X)}if(K&&K.parent&&X.raycast&&se!==K.eventCount){const de=findInitialRoot(X).getState().internal,pe=de.interaction.indexOf(X);pe>-1&&de.interaction.splice(pe,1),K.eventCount&&de.interaction.push(X)}return!(ie.length===1&&ie[0][0]==="onUpdate")&&ie.length&&(_=X.__r3f)!=null&&_.parent&&updateInstance(X),X}function invalidateInstance(X){var Z,_;const K=(Z=X.__r3f)==null||(_=Z.root)==null||_.getState==null?void 0:_.getState();K&&K.internal.frames===0&&K.invalidate()}function updateInstance(X){X.onUpdate==null||X.onUpdate(X)}function updateCamera(X,Z){X.manual||(isOrthographicCamera(X)?(X.left=Z.width/-2,X.right=Z.width/2,X.top=Z.height/2,X.bottom=Z.height/-2):X.aspect=Z.width/Z.height,X.updateProjectionMatrix(),X.updateMatrixWorld())}function makeId(X){return(X.eventObject||X.object).uuid+"/"+X.index+X.instanceId}function getEventPriority(){var X;const Z=typeof self<"u"&&self||typeof window<"u"&&window;if(!Z)return constantsExports.DefaultEventPriority;switch((X=Z.event)==null?void 0:X.type){case"click":case"contextmenu":case"dblclick":case"pointercancel":case"pointerdown":case"pointerup":return constantsExports.DiscreteEventPriority;case"pointermove":case"pointerout":case"pointerover":case"pointerenter":case"pointerleave":case"wheel":return constantsExports.ContinuousEventPriority;default:return constantsExports.DefaultEventPriority}}function releaseInternalPointerCapture(X,Z,_,K){const te=_.get(Z);te&&(_.delete(Z),_.size===0&&(X.delete(K),te.target.releasePointerCapture(K)))}function removeInteractivity(X,Z){const{internal:_}=X.getState();_.interaction=_.interaction.filter(K=>K!==Z),_.initialHits=_.initialHits.filter(K=>K!==Z),_.hovered.forEach((K,te)=>{(K.eventObject===Z||K.object===Z)&&_.hovered.delete(te)}),_.capturedMap.forEach((K,te)=>{releaseInternalPointerCapture(_.capturedMap,Z,K,te)})}function createEvents(X){function Z(se){const{internal:ae}=X.getState(),ge=se.offsetX-ae.initialClick[0],ce=se.offsetY-ae.initialClick[1];return Math.round(Math.sqrt(ge*ge+ce*ce))}function _(se){return se.filter(ae=>["Move","Over","Enter","Out","Leave"].some(ge=>{var ce;return(ce=ae.__r3f)==null?void 0:ce.handlers["onPointer"+ge]}))}function K(se,ae){const ge=X.getState(),ce=new Set,de=[],pe=ae?ae(ge.internal.interaction):ge.internal.interaction;for(let ye=0;ye<pe.length;ye++){const ve=getRootState(pe[ye]);ve&&(ve.raycaster.camera=void 0)}ge.previousRoot||ge.events.compute==null||ge.events.compute(se,ge);function fe(ye){const ve=getRootState(ye);if(!ve||!ve.events.enabled||ve.raycaster.camera===null)return[];if(ve.raycaster.camera===void 0){var Be;ve.events.compute==null||ve.events.compute(se,ve,(Be=ve.previousRoot)==null?void 0:Be.getState()),ve.raycaster.camera===void 0&&(ve.raycaster.camera=null)}return ve.raycaster.camera?ve.raycaster.intersectObject(ye,!0):[]}let be=pe.flatMap(fe).sort((ye,ve)=>{const Be=getRootState(ye.object),Re=getRootState(ve.object);return!Be||!Re?ye.distance-ve.distance:Re.events.priority-Be.events.priority||ye.distance-ve.distance}).filter(ye=>{const ve=makeId(ye);return ce.has(ve)?!1:(ce.add(ve),!0)});ge.events.filter&&(be=ge.events.filter(be,ge));for(const ye of be){let ve=ye.object;for(;ve;){var me;(me=ve.__r3f)!=null&&me.eventCount&&de.push({...ye,eventObject:ve}),ve=ve.parent}}if("pointerId"in se&&ge.internal.capturedMap.has(se.pointerId))for(let ye of ge.internal.capturedMap.get(se.pointerId).values())ce.has(makeId(ye.intersection))||de.push(ye.intersection);return de}function te(se,ae,ge,ce){const de=X.getState();if(se.length){const pe={stopped:!1};for(const fe of se){const be=getRootState(fe.object)||de,{raycaster:me,pointer:ye,camera:ve,internal:Be}=be,Re=new Vector3(ye.x,ye.y,0).unproject(ve),Ee=Xe=>{var Pe,He;return(Pe=(He=Be.capturedMap.get(Xe))==null?void 0:He.has(fe.eventObject))!=null?Pe:!1},We=Xe=>{const Pe={intersection:fe,target:ae.target};Be.capturedMap.has(Xe)?Be.capturedMap.get(Xe).set(fe.eventObject,Pe):Be.capturedMap.set(Xe,new Map([[fe.eventObject,Pe]])),ae.target.setPointerCapture(Xe)},Ze=Xe=>{const Pe=Be.capturedMap.get(Xe);Pe&&releaseInternalPointerCapture(Be.capturedMap,fe.eventObject,Pe,Xe)};let Ve={};for(let Xe in ae){let Pe=ae[Xe];typeof Pe!="function"&&(Ve[Xe]=Pe)}let _e={...fe,...Ve,pointer:ye,intersections:se,stopped:pe.stopped,delta:ge,unprojectedPoint:Re,ray:me.ray,camera:ve,stopPropagation(){const Xe="pointerId"in ae&&Be.capturedMap.get(ae.pointerId);if((!Xe||Xe.has(fe.eventObject))&&(_e.stopped=pe.stopped=!0,Be.hovered.size&&Array.from(Be.hovered.values()).find(Pe=>Pe.eventObject===fe.eventObject))){const Pe=se.slice(0,se.indexOf(fe));ne([...Pe,fe])}},target:{hasPointerCapture:Ee,setPointerCapture:We,releasePointerCapture:Ze},currentTarget:{hasPointerCapture:Ee,setPointerCapture:We,releasePointerCapture:Ze},nativeEvent:ae};if(ce(_e),pe.stopped===!0)break}}return se}function ne(se){const{internal:ae}=X.getState();for(const ge of ae.hovered.values())if(!se.length||!se.find(ce=>ce.object===ge.object&&ce.index===ge.index&&ce.instanceId===ge.instanceId)){const de=ge.eventObject.__r3f,pe=de==null?void 0:de.handlers;if(ae.hovered.delete(makeId(ge)),de!=null&&de.eventCount){const fe={...ge,intersections:se};pe.onPointerOut==null||pe.onPointerOut(fe),pe.onPointerLeave==null||pe.onPointerLeave(fe)}}}function oe(se,ae){for(let ge=0;ge<ae.length;ge++){const ce=ae[ge].__r3f;ce==null||ce.handlers.onPointerMissed==null||ce.handlers.onPointerMissed(se)}}function ie(se){switch(se){case"onPointerLeave":case"onPointerCancel":return()=>ne([]);case"onLostPointerCapture":return ae=>{const{internal:ge}=X.getState();"pointerId"in ae&&ge.capturedMap.has(ae.pointerId)&&requestAnimationFrame(()=>{ge.capturedMap.has(ae.pointerId)&&(ge.capturedMap.delete(ae.pointerId),ne([]))})}}return function(ge){const{onPointerMissed:ce,internal:de}=X.getState();de.lastEvent.current=ge;const pe=se==="onPointerMove",fe=se==="onClick"||se==="onContextMenu"||se==="onDoubleClick",me=K(ge,pe?_:void 0),ye=fe?Z(ge):0;se==="onPointerDown"&&(de.initialClick=[ge.offsetX,ge.offsetY],de.initialHits=me.map(Be=>Be.eventObject)),fe&&!me.length&&ye<=2&&(oe(ge,de.interaction),ce&&ce(ge)),pe&&ne(me);function ve(Be){const Re=Be.eventObject,Ee=Re.__r3f,We=Ee==null?void 0:Ee.handlers;if(Ee!=null&&Ee.eventCount)if(pe){if(We.onPointerOver||We.onPointerEnter||We.onPointerOut||We.onPointerLeave){const Ze=makeId(Be),Ve=de.hovered.get(Ze);Ve?Ve.stopped&&Be.stopPropagation():(de.hovered.set(Ze,Be),We.onPointerOver==null||We.onPointerOver(Be),We.onPointerEnter==null||We.onPointerEnter(Be))}We.onPointerMove==null||We.onPointerMove(Be)}else{const Ze=We[se];Ze?(!fe||de.initialHits.includes(Re))&&(oe(ge,de.interaction.filter(Ve=>!de.initialHits.includes(Ve))),Ze(Be)):fe&&de.initialHits.includes(Re)&&oe(ge,de.interaction.filter(Ve=>!de.initialHits.includes(Ve)))}}te(me,ge,ye,ve)}}return{handlePointer:ie}}const privateKeys=["set","get","setSize","setFrameloop","setDpr","events","invalidate","advance","size","viewport"],isRenderer=X=>!!(X!=null&&X.render),context=reactExports.createContext(null),createStore$1=(X,Z)=>{const _=create$1((ie,se)=>{const ae=new Vector3,ge=new Vector3,ce=new Vector3;function de(ye=se().camera,ve=ge,Be=se().size){const{width:Re,height:Ee,top:We,left:Ze}=Be,Ve=Re/Ee;ve.isVector3?ce.copy(ve):ce.set(...ve);const _e=ye.getWorldPosition(ae).distanceTo(ce);if(isOrthographicCamera(ye))return{width:Re/ye.zoom,height:Ee/ye.zoom,top:We,left:Ze,factor:1,distance:_e,aspect:Ve};{const Xe=ye.fov*Math.PI/180,Pe=2*Math.tan(Xe/2)*_e,He=Pe*(Re/Ee);return{width:He,height:Pe,top:We,left:Ze,factor:Re/He,distance:_e,aspect:Ve}}}let pe;const fe=ye=>ie(ve=>({performance:{...ve.performance,current:ye}})),be=new Vector2;return{set:ie,get:se,gl:null,camera:null,raycaster:null,events:{priority:1,enabled:!0,connected:!1},xr:null,scene:null,invalidate:(ye=1)=>X(se(),ye),advance:(ye,ve)=>Z(ye,ve,se()),legacy:!1,linear:!1,flat:!1,controls:null,clock:new Clock,pointer:be,mouse:be,frameloop:"always",onPointerMissed:void 0,performance:{current:1,min:.5,max:1,debounce:200,regress:()=>{const ye=se();pe&&clearTimeout(pe),ye.performance.current!==ye.performance.min&&fe(ye.performance.min),pe=setTimeout(()=>fe(se().performance.max),ye.performance.debounce)}},size:{width:0,height:0,top:0,left:0,updateStyle:!1},viewport:{initialDpr:0,dpr:0,width:0,height:0,top:0,left:0,aspect:0,distance:0,factor:0,getCurrentViewport:de},setEvents:ye=>ie(ve=>({...ve,events:{...ve.events,...ye}})),setSize:(ye,ve,Be,Re,Ee)=>{const We=se().camera,Ze={width:ye,height:ve,top:Re||0,left:Ee||0,updateStyle:Be};ie(Ve=>({size:Ze,viewport:{...Ve.viewport,...de(We,ge,Ze)}}))},setDpr:ye=>ie(ve=>{const Be=calculateDpr(ye);return{viewport:{...ve.viewport,dpr:Be,initialDpr:ve.viewport.initialDpr||Be}}}),setFrameloop:(ye="always")=>{const ve=se().clock;ve.stop(),ve.elapsedTime=0,ye!=="never"&&(ve.start(),ve.elapsedTime=0),ie(()=>({frameloop:ye}))},previousRoot:void 0,internal:{active:!1,priority:0,frames:0,lastEvent:reactExports.createRef(),interaction:[],hovered:new Map,subscribers:[],initialClick:[0,0],initialHits:[],capturedMap:new Map,subscribe:(ye,ve,Be)=>{const Re=se().internal;return Re.priority=Re.priority+(ve>0?1:0),Re.subscribers.push({ref:ye,priority:ve,store:Be}),Re.subscribers=Re.subscribers.sort((Ee,We)=>Ee.priority-We.priority),()=>{const Ee=se().internal;Ee!=null&&Ee.subscribers&&(Ee.priority=Ee.priority-(ve>0?1:0),Ee.subscribers=Ee.subscribers.filter(We=>We.ref!==ye))}}}}}),K=_.getState();let te=K.size,ne=K.viewport.dpr,oe=K.camera;return _.subscribe(()=>{const{camera:ie,size:se,viewport:ae,gl:ge,set:ce}=_.getState();if(se.width!==te.width||se.height!==te.height||ae.dpr!==ne){var de;te=se,ne=ae.dpr,updateCamera(ie,se),ge.setPixelRatio(ae.dpr);const pe=(de=se.updateStyle)!=null?de:typeof HTMLCanvasElement<"u"&&ge.domElement instanceof HTMLCanvasElement;ge.setSize(se.width,se.height,pe)}ie!==oe&&(oe=ie,ce(pe=>({viewport:{...pe.viewport,...pe.viewport.getCurrentViewport(ie)}})))}),_.subscribe(ie=>X(ie)),_};function createSubs(X,Z){const _={callback:X};return Z.add(_),()=>void Z.delete(_)}let i$6,globalEffects=new Set,globalAfterEffects=new Set,globalTailEffects=new Set;const addEffect=X=>createSubs(X,globalEffects);function run(X,Z){if(X.size)for(const{callback:_}of X.values())_(Z)}function flushGlobalEffects(X,Z){switch(X){case"before":return run(globalEffects,Z);case"after":return run(globalAfterEffects,Z);case"tail":return run(globalTailEffects,Z)}}let subscribers,subscription;function render$1(X,Z,_){let K=Z.clock.getDelta();for(Z.frameloop==="never"&&typeof X=="number"&&(K=X-Z.clock.elapsedTime,Z.clock.oldTime=Z.clock.elapsedTime,Z.clock.elapsedTime=X),subscribers=Z.internal.subscribers,i$6=0;i$6<subscribers.length;i$6++)subscription=subscribers[i$6],subscription.ref.current(subscription.store.getState(),K,_);return!Z.internal.priority&&Z.gl.render&&Z.gl.render(Z.scene,Z.camera),Z.internal.frames=Math.max(0,Z.internal.frames-1),Z.frameloop==="always"?1:Z.internal.frames}function createLoop(X){let Z=!1,_=!1,K,te,ne;function oe(ae){te=requestAnimationFrame(oe),Z=!0,K=0,flushGlobalEffects("before",ae),_=!0;for(const ce of X.values()){var ge;ne=ce.store.getState(),ne.internal.active&&(ne.frameloop==="always"||ne.internal.frames>0)&&!((ge=ne.gl.xr)!=null&&ge.isPresenting)&&(K+=render$1(ae,ne))}if(_=!1,flushGlobalEffects("after",ae),K===0)return flushGlobalEffects("tail",ae),Z=!1,cancelAnimationFrame(te)}function ie(ae,ge=1){var ce;if(!ae)return X.forEach(de=>ie(de.store.getState(),ge));(ce=ae.gl.xr)!=null&&ce.isPresenting||!ae.internal.active||ae.frameloop==="never"||(ge>1?ae.internal.frames=Math.min(60,ae.internal.frames+ge):_?ae.internal.frames=2:ae.internal.frames=1,Z||(Z=!0,requestAnimationFrame(oe)))}function se(ae,ge=!0,ce,de){if(ge&&flushGlobalEffects("before",ae),ce)render$1(ae,ce,de);else for(const pe of X.values())render$1(ae,pe.store.getState());ge&&flushGlobalEffects("after",ae)}return{loop:oe,invalidate:ie,advance:se}}function useStore(){const X=reactExports.useContext(context);if(!X)throw new Error("R3F: Hooks can only be used within the Canvas component!");return X}function useThree(X=_=>_,Z){return useStore()(X,Z)}function useFrame(X,Z=0){const _=useStore(),K=_.getState().internal.subscribe,te=useMutableCallback(X);return useIsomorphicLayoutEffect$2(()=>K(te,Z,_),[Z,K,_]),null}const memoizedLoaders=new WeakMap;function loadingFn(X,Z){return function(_,...K){let te=memoizedLoaders.get(_);return te||(te=new _,memoizedLoaders.set(_,te)),X&&X(te),Promise.all(K.map(ne=>new Promise((oe,ie)=>te.load(ne,se=>{se.scene&&Object.assign(se,buildGraph(se.scene)),oe(se)},Z,se=>ie(new Error(`Could not load ${ne}: ${se==null?void 0:se.message}`))))))}}function useLoader(X,Z,_,K){const te=Array.isArray(Z)?Z:[Z],ne=suspend(loadingFn(_,K),[X,...te],{equal:is$1.equ});return Array.isArray(Z)?ne:ne[0]}useLoader.preload=function(X,Z,_){const K=Array.isArray(Z)?Z:[Z];return preload(loadingFn(_),[X,...K])};useLoader.clear=function(X,Z){const _=Array.isArray(Z)?Z:[Z];return clear([X,..._])};const roots=new Map,{invalidate,advance:advance$1}=createLoop(roots),{reconciler,applyProps}=createRenderer(roots,getEventPriority),shallowLoose={objects:"shallow",strict:!1},createRendererInstance=(X,Z)=>{const _=typeof X=="function"?X(Z):X;return isRenderer(_)?_:new WebGLRenderer({powerPreference:"high-performance",canvas:Z,antialias:!0,alpha:!0,...X})};function computeInitialSize(X,Z){const _=typeof HTMLCanvasElement<"u"&&X instanceof HTMLCanvasElement;if(Z){const{width:K,height:te,top:ne,left:oe,updateStyle:ie=_}=Z;return{width:K,height:te,top:ne,left:oe,updateStyle:ie}}else if(typeof HTMLCanvasElement<"u"&&X instanceof HTMLCanvasElement&&X.parentElement){const{width:K,height:te,top:ne,left:oe}=X.parentElement.getBoundingClientRect();return{width:K,height:te,top:ne,left:oe,updateStyle:_}}else if(typeof OffscreenCanvas<"u"&&X instanceof OffscreenCanvas)return{width:X.width,height:X.height,top:0,left:0,updateStyle:_};return{width:0,height:0,top:0,left:0}}function createRoot(X){const Z=roots.get(X),_=Z==null?void 0:Z.fiber,K=Z==null?void 0:Z.store;Z&&console.warn("R3F.createRoot should only be called once!");const te=typeof reportError=="function"?reportError:console.error,ne=K||createStore$1(invalidate,advance$1),oe=_||reconciler.createContainer(ne,constantsExports.ConcurrentRoot,null,!1,null,"",te,null);Z||roots.set(X,{fiber:oe,store:ne});let ie,se=!1,ae;return{configure(ge={}){let{gl:ce,size:de,scene:pe,events:fe,onCreated:be,shadows:me=!1,linear:ye=!1,flat:ve=!1,legacy:Be=!1,orthographic:Re=!1,frameloop:Ee="always",dpr:We=[1,2],performance:Ze,raycaster:Ve,camera:_e,onPointerMissed:Xe}=ge,Pe=ne.getState(),He=Pe.gl;Pe.gl||Pe.set({gl:He=createRendererInstance(ce,X)});let Ke=Pe.raycaster;Ke||Pe.set({raycaster:Ke=new Raycaster});const{params:Ue,...tt}=Ve||{};if(is$1.equ(tt,Ke,shallowLoose)||applyProps(Ke,{...tt}),is$1.equ(Ue,Ke.params,shallowLoose)||applyProps(Ke,{params:{...Ke.params,...Ue}}),!Pe.camera||Pe.camera===ae&&!is$1.equ(ae,_e,shallowLoose)){ae=_e;const je=_e instanceof Camera,Te=je?_e:Re?new OrthographicCamera(0,0,0,0,.1,1e3):new PerspectiveCamera(75,0,.1,1e3);je||(Te.position.z=5,_e&&(applyProps(Te,_e),("aspect"in _e||"left"in _e||"right"in _e||"bottom"in _e||"top"in _e)&&(Te.manual=!0,Te.updateProjectionMatrix())),!Pe.camera&&!(_e!=null&&_e.rotation)&&Te.lookAt(0,0,0)),Pe.set({camera:Te}),Ke.camera=Te}if(!Pe.scene){let je;pe!=null&&pe.isScene?je=pe:(je=new Scene$1,pe&&applyProps(je,pe)),Pe.set({scene:prepare$1(je)})}if(!Pe.xr){var rt;const je=(ot,ct)=>{const gt=ne.getState();gt.frameloop!=="never"&&advance$1(ot,!0,gt,ct)},Te=()=>{const ot=ne.getState();ot.gl.xr.enabled=ot.gl.xr.isPresenting,ot.gl.xr.setAnimationLoop(ot.gl.xr.isPresenting?je:null),ot.gl.xr.isPresenting||invalidate(ot)},De={connect(){const ot=ne.getState().gl;ot.xr.addEventListener("sessionstart",Te),ot.xr.addEventListener("sessionend",Te)},disconnect(){const ot=ne.getState().gl;ot.xr.removeEventListener("sessionstart",Te),ot.xr.removeEventListener("sessionend",Te)}};typeof((rt=He.xr)==null?void 0:rt.addEventListener)=="function"&&De.connect(),Pe.set({xr:De})}if(He.shadowMap){const je=He.shadowMap.enabled,Te=He.shadowMap.type;if(He.shadowMap.enabled=!!me,is$1.boo(me))He.shadowMap.type=PCFSoftShadowMap;else if(is$1.str(me)){var at;const De={basic:BasicShadowMap,percentage:PCFShadowMap,soft:PCFSoftShadowMap,variance:VSMShadowMap};He.shadowMap.type=(at=De[me])!=null?at:PCFSoftShadowMap}else is$1.obj(me)&&Object.assign(He.shadowMap,me);(je!==He.shadowMap.enabled||Te!==He.shadowMap.type)&&(He.shadowMap.needsUpdate=!0)}const Oe=getColorManagement();Oe&&("enabled"in Oe?Oe.enabled=!Be:"legacyMode"in Oe&&(Oe.legacyMode=Be)),se||applyProps(He,{outputEncoding:ye?3e3:3001,toneMapping:ve?NoToneMapping:ACESFilmicToneMapping}),Pe.legacy!==Be&&Pe.set(()=>({legacy:Be})),Pe.linear!==ye&&Pe.set(()=>({linear:ye})),Pe.flat!==ve&&Pe.set(()=>({flat:ve})),ce&&!is$1.fun(ce)&&!isRenderer(ce)&&!is$1.equ(ce,He,shallowLoose)&&applyProps(He,ce),fe&&!Pe.events.handlers&&Pe.set({events:fe(ne)});const $e=computeInitialSize(X,de);return is$1.equ($e,Pe.size,shallowLoose)||Pe.setSize($e.width,$e.height,$e.updateStyle,$e.top,$e.left),We&&Pe.viewport.dpr!==calculateDpr(We)&&Pe.setDpr(We),Pe.frameloop!==Ee&&Pe.setFrameloop(Ee),Pe.onPointerMissed||Pe.set({onPointerMissed:Xe}),Ze&&!is$1.equ(Ze,Pe.performance,shallowLoose)&&Pe.set(je=>({performance:{...je.performance,...Ze}})),ie=be,se=!0,this},render(ge){return se||this.configure(),reconciler.updateContainer(jsxRuntimeExports.jsx(Provider,{store:ne,children:ge,onCreated:ie,rootElement:X}),oe,null,()=>{}),ne},unmount(){unmountComponentAtNode(X)}}}function Provider({store:X,children:Z,onCreated:_,rootElement:K}){return useIsomorphicLayoutEffect$2(()=>{const te=X.getState();te.set(ne=>({internal:{...ne.internal,active:!0}})),_&&_(te),X.getState().events.connected||te.events.connect==null||te.events.connect(K)},[]),jsxRuntimeExports.jsx(context.Provider,{value:X,children:Z})}function unmountComponentAtNode(X,Z){const _=roots.get(X),K=_==null?void 0:_.fiber;if(K){const te=_==null?void 0:_.store.getState();te&&(te.internal.active=!1),reconciler.updateContainer(null,K,null,()=>{te&&setTimeout(()=>{try{var ne,oe,ie,se;te.events.disconnect==null||te.events.disconnect(),(ne=te.gl)==null||(oe=ne.renderLists)==null||oe.dispose==null||oe.dispose(),(ie=te.gl)==null||ie.forceContextLoss==null||ie.forceContextLoss(),(se=te.gl)!=null&&se.xr&&te.xr.disconnect(),dispose(te),roots.delete(X)}catch{}},500)})}}function createPortal(X,Z,_){return jsxRuntimeExports.jsx(Portal$1,{children:X,container:Z,state:_},Z.uuid)}function Portal$1({state:X={},children:Z,container:_}){const{events:K,size:te,...ne}=X,oe=useStore(),[ie]=reactExports.useState(()=>new Raycaster),[se]=reactExports.useState(()=>new Vector2),ae=reactExports.useCallback((ce,de)=>{const pe={...ce};Object.keys(ce).forEach(be=>{(privateKeys.includes(be)||ce[be]!==de[be]&&de[be])&&delete pe[be]});let fe;if(de&&te){const be=de.camera;fe=ce.viewport.getCurrentViewport(be,new Vector3,te),be!==ce.camera&&updateCamera(be,te)}return{...pe,scene:_,raycaster:ie,pointer:se,mouse:se,previousRoot:oe,events:{...ce.events,...de==null?void 0:de.events,...K},size:{...ce.size,...te},viewport:{...ce.viewport,...fe},...ne}},[X]),[ge]=reactExports.useState(()=>{const ce=oe.getState();return create$1((pe,fe)=>({...ce,scene:_,raycaster:ie,pointer:se,mouse:se,previousRoot:oe,events:{...ce.events,...K},size:{...ce.size,...te},...ne,set:pe,get:fe,setEvents:be=>pe(me=>({...me,events:{...me.events,...be}}))}))});return reactExports.useEffect(()=>{const ce=oe.subscribe(de=>ge.setState(pe=>ae(de,pe)));return()=>{ce()}},[ae]),reactExports.useEffect(()=>{ge.setState(ce=>ae(oe.getState(),ce))},[ae]),reactExports.useEffect(()=>()=>{ge.destroy()},[]),jsxRuntimeExports.jsx(jsxRuntimeExports.Fragment,{children:reconciler.createPortal(jsxRuntimeExports.jsx(context.Provider,{value:ge,children:Z}),ge,null)})}reconciler.injectIntoDevTools({bundleType:0,rendererPackageName:"@react-three/fiber",version:reactExports.version});const DOM_EVENTS={onClick:["click",!1],onContextMenu:["contextmenu",!1],onDoubleClick:["dblclick",!1],onWheel:["wheel",!0],onPointerDown:["pointerdown",!0],onPointerUp:["pointerup",!0],onPointerLeave:["pointerleave",!0],onPointerMove:["pointermove",!0],onPointerCancel:["pointercancel",!0],onLostPointerCapture:["lostpointercapture",!0]};function createPointerEvents(X){const{handlePointer:Z}=createEvents(X);return{priority:1,enabled:!0,compute(_,K,te){K.pointer.set(_.offsetX/K.size.width*2-1,-(_.offsetY/K.size.height)*2+1),K.raycaster.setFromCamera(K.pointer,K.camera)},connected:void 0,handlers:Object.keys(DOM_EVENTS).reduce((_,K)=>({..._,[K]:Z(K)}),{}),update:()=>{var _;const{events:K,internal:te}=X.getState();(_=te.lastEvent)!=null&&_.current&&K.handlers&&K.handlers.onPointerMove(te.lastEvent.current)},connect:_=>{var K;const{set:te,events:ne}=X.getState();ne.disconnect==null||ne.disconnect(),te(oe=>({events:{...oe.events,connected:_}})),Object.entries((K=ne.handlers)!=null?K:[]).forEach(([oe,ie])=>{const[se,ae]=DOM_EVENTS[oe];_.addEventListener(se,ie,{passive:ae})})},disconnect:()=>{const{set:_,events:K}=X.getState();if(K.connected){var te;Object.entries((te=K.handlers)!=null?te:[]).forEach(([ne,oe])=>{if(K&&K.connected instanceof HTMLElement){const[ie]=DOM_EVENTS[ne];K.connected.removeEventListener(ie,oe)}}),_(ne=>({events:{...ne.events,connected:void 0}}))}}}}var debounce_1,hasRequiredDebounce;function requireDebounce(){if(hasRequiredDebounce)return debounce_1;hasRequiredDebounce=1;function X(Z,_,K){var te,ne,oe,ie,se;_==null&&(_=100);function ae(){var ce=Date.now()-ie;ce<_&&ce>=0?te=setTimeout(ae,_-ce):(te=null,K||(se=Z.apply(oe,ne),oe=ne=null))}var ge=function(){oe=this,ne=arguments,ie=Date.now();var ce=K&&!te;return te||(te=setTimeout(ae,_)),ce&&(se=Z.apply(oe,ne),oe=ne=null),se};return ge.clear=function(){te&&(clearTimeout(te),te=null)},ge.flush=function(){te&&(se=Z.apply(oe,ne),oe=ne=null,clearTimeout(te),te=null)},ge}return X.debounce=X,debounce_1=X,debounce_1}var debounceExports=requireDebounce();const createDebounce=getDefaultExportFromCjs(debounceExports);var __defProp$1=Object.defineProperty,__defProps=Object.defineProperties,__getOwnPropDescs=Object.getOwnPropertyDescriptors,__getOwnPropSymbols=Object.getOwnPropertySymbols,__hasOwnProp=Object.prototype.hasOwnProperty,__propIsEnum=Object.prototype.propertyIsEnumerable,__defNormalProp=(X,Z,_)=>Z in X?__defProp$1(X,Z,{enumerable:!0,configurable:!0,writable:!0,value:_}):X[Z]=_,__spreadValues=(X,Z)=>{for(var _ in Z||(Z={}))__hasOwnProp.call(Z,_)&&__defNormalProp(X,_,Z[_]);if(__getOwnPropSymbols)for(var _ of __getOwnPropSymbols(Z))__propIsEnum.call(Z,_)&&__defNormalProp(X,_,Z[_]);return X},__spreadProps=(X,Z)=>__defProps(X,__getOwnPropDescs(Z)),_a$1,_b$1;typeof window<"u"&&((_a$1=window.document)!=null&&_a$1.createElement||((_b$1=window.navigator)==null?void 0:_b$1.product)==="ReactNative")?reactExports.useLayoutEffect:reactExports.useEffect;function traverseFiber(X,Z,_){if(!X)return;if(_(X)===!0)return X;let K=X.child;for(;K;){const te=traverseFiber(K,Z,_);if(te)return te;K=K.sibling}}function wrapContext(X){try{return Object.defineProperties(X,{_currentRenderer:{get(){return null},set(){}},_currentRenderer2:{get(){return null},set(){}}})}catch{return X}}const error=console.error;console.error=function(){const X=[...arguments].join("");if(X!=null&&X.startsWith("Warning:")&&X.includes("useContext")){console.error=error;return}return error.apply(this,arguments)};const FiberContext=wrapContext(reactExports.createContext(null));class FiberProvider extends reactExports.Component{render(){return reactExports.createElement(FiberContext.Provider,{value:this._reactInternals},this.props.children)}}function useFiber(){const X=reactExports.useContext(FiberContext);if(X===null)throw new Error("its-fine: useFiber must be called within a <FiberProvider />!");const Z=reactExports.useId();return reactExports.useMemo(()=>{for(const K of[X,X==null?void 0:X.alternate]){if(!K)continue;const te=traverseFiber(K,!1,ne=>{let oe=ne.memoizedState;for(;oe;){if(oe.memoizedState===Z)return!0;oe=oe.next}});if(te)return te}},[X,Z])}function useContextMap(){const X=useFiber(),[Z]=reactExports.useState(()=>new Map);Z.clear();let _=X;for(;_;){if(_.type&&typeof _.type=="object"){const te=_.type._context===void 0&&_.type.Provider===_.type?_.type:_.type._context;te&&te!==FiberContext&&!Z.has(te)&&Z.set(te,reactExports.useContext(wrapContext(te)))}_=_.return}return Z}function useContextBridge(){const X=useContextMap();return reactExports.useMemo(()=>Array.from(X.keys()).reduce((Z,_)=>K=>reactExports.createElement(Z,null,reactExports.createElement(_.Provider,__spreadProps(__spreadValues({},K),{value:X.get(_)}))),Z=>reactExports.createElement(FiberProvider,__spreadValues({},Z))),[X])}function useMeasure({debounce:X,scroll:Z,polyfill:_,offsetSize:K}={debounce:0,scroll:!1,offsetSize:!1}){const te=_||typeof window<"u"&&window.ResizeObserver,[ne,oe]=reactExports.useState({left:0,top:0,width:0,height:0,bottom:0,right:0,x:0,y:0});if(!te)return ne.width=1280,ne.height=800,[()=>{},ne,()=>{}];const ie=reactExports.useRef({element:null,scrollContainers:null,resizeObserver:null,lastBounds:ne,orientationHandler:null}),se=X?typeof X=="number"?X:X.scroll:null,ae=X?typeof X=="number"?X:X.resize:null,ge=reactExports.useRef(!1);reactExports.useEffect(()=>(ge.current=!0,()=>void(ge.current=!1)));const[ce,de,pe]=reactExports.useMemo(()=>{const ye=()=>{if(!ie.current.element)return;const{left:ve,top:Be,width:Re,height:Ee,bottom:We,right:Ze,x:Ve,y:_e}=ie.current.element.getBoundingClientRect(),Xe={left:ve,top:Be,width:Re,height:Ee,bottom:We,right:Ze,x:Ve,y:_e};ie.current.element instanceof HTMLElement&&K&&(Xe.height=ie.current.element.offsetHeight,Xe.width=ie.current.element.offsetWidth),Object.freeze(Xe),ge.current&&!areBoundsEqual(ie.current.lastBounds,Xe)&&oe(ie.current.lastBounds=Xe)};return[ye,ae?createDebounce(ye,ae):ye,se?createDebounce(ye,se):ye]},[oe,K,se,ae]);function fe(){ie.current.scrollContainers&&(ie.current.scrollContainers.forEach(ye=>ye.removeEventListener("scroll",pe,!0)),ie.current.scrollContainers=null),ie.current.resizeObserver&&(ie.current.resizeObserver.disconnect(),ie.current.resizeObserver=null),ie.current.orientationHandler&&("orientation"in screen&&"removeEventListener"in screen.orientation?screen.orientation.removeEventListener("change",ie.current.orientationHandler):"onorientationchange"in window&&window.removeEventListener("orientationchange",ie.current.orientationHandler))}function be(){var ye;ie.current.element&&(ie.current.resizeObserver=new te(de),(ye=ie.current.resizeObserver)==null||ye.observe(ie.current.element),Z&&ie.current.scrollContainers&&ie.current.scrollContainers.forEach(ve=>ve.addEventListener("scroll",pe,{capture:!0,passive:!0})),ie.current.orientationHandler=()=>{pe()},"orientation"in screen&&"addEventListener"in screen.orientation?screen.orientation.addEventListener("change",ie.current.orientationHandler):"onorientationchange"in window&&window.addEventListener("orientationchange",ie.current.orientationHandler))}const me=ye=>{!ye||ye===ie.current.element||(fe(),ie.current.element=ye,ie.current.scrollContainers=findScrollContainers(ye),be())};return useOnWindowScroll(pe,!!Z),useOnWindowResize(de),reactExports.useEffect(()=>{fe(),be()},[Z,pe,de]),reactExports.useEffect(()=>fe,[]),[me,ne,ce]}function useOnWindowResize(X){reactExports.useEffect(()=>{const Z=X;return window.addEventListener("resize",Z),()=>void window.removeEventListener("resize",Z)},[X])}function useOnWindowScroll(X,Z){reactExports.useEffect(()=>{if(Z){const _=X;return window.addEventListener("scroll",_,{capture:!0,passive:!0}),()=>void window.removeEventListener("scroll",_,!0)}},[X,Z])}function findScrollContainers(X){const Z=[];if(!X||X===document.body)return Z;const{overflow:_,overflowX:K,overflowY:te}=window.getComputedStyle(X);return[_,K,te].some(ne=>ne==="auto"||ne==="scroll")&&Z.push(X),[...Z,...findScrollContainers(X.parentElement)]}const keys=["x","y","top","bottom","left","right","width","height"],areBoundsEqual=(X,Z)=>keys.every(_=>X[_]===Z[_]),CanvasImpl=reactExports.forwardRef(function({children:Z,fallback:_,resize:K,style:te,gl:ne,events:oe=createPointerEvents,eventSource:ie,eventPrefix:se,shadows:ae,linear:ge,flat:ce,legacy:de,orthographic:pe,frameloop:fe,dpr:be,performance:me,raycaster:ye,camera:ve,scene:Be,onPointerMissed:Re,onCreated:Ee,...We},Ze){reactExports.useMemo(()=>extend(THREE),[]);const Ve=useContextBridge(),[_e,Xe]=useMeasure({scroll:!0,debounce:{scroll:50,resize:0},...K}),Pe=reactExports.useRef(null),He=reactExports.useRef(null);reactExports.useImperativeHandle(Ze,()=>Pe.current);const Ke=useMutableCallback(Re),[Ue,tt]=reactExports.useState(!1),[rt,at]=reactExports.useState(!1);if(Ue)throw Ue;if(rt)throw rt;const Oe=reactExports.useRef(null);useIsomorphicLayoutEffect$2(()=>{const je=Pe.current;Xe.width>0&&Xe.height>0&&je&&(Oe.current||(Oe.current=createRoot(je)),Oe.current.configure({gl:ne,events:oe,shadows:ae,linear:ge,flat:ce,legacy:de,orthographic:pe,frameloop:fe,dpr:be,performance:me,raycaster:ye,camera:ve,scene:Be,size:Xe,onPointerMissed:(...Te)=>Ke.current==null?void 0:Ke.current(...Te),onCreated:Te=>{Te.events.connect==null||Te.events.connect(ie?isRef$1(ie)?ie.current:ie:He.current),se&&Te.setEvents({compute:(De,ot)=>{const ct=De[se+"X"],gt=De[se+"Y"];ot.pointer.set(ct/ot.size.width*2-1,-(gt/ot.size.height)*2+1),ot.raycaster.setFromCamera(ot.pointer,ot.camera)}}),Ee==null||Ee(Te)}}),Oe.current.render(jsxRuntimeExports.jsx(Ve,{children:jsxRuntimeExports.jsx(ErrorBoundary,{set:at,children:jsxRuntimeExports.jsx(reactExports.Suspense,{fallback:jsxRuntimeExports.jsx(Block,{set:tt}),children:Z})})})))}),reactExports.useEffect(()=>{const je=Pe.current;if(je)return()=>unmountComponentAtNode(je)},[]);const $e=ie?"none":"auto";return jsxRuntimeExports.jsx("div",{ref:He,style:{position:"relative",width:"100%",height:"100%",overflow:"hidden",pointerEvents:$e,...te},...We,children:jsxRuntimeExports.jsx("div",{ref:_e,style:{width:"100%",height:"100%"},children:jsxRuntimeExports.jsx("canvas",{ref:Pe,style:{display:"block"},children:_})})})}),Canvas$1=reactExports.forwardRef(function(Z,_){return jsxRuntimeExports.jsx(FiberProvider,{children:jsxRuntimeExports.jsx(CanvasImpl,{...Z,ref:_})})});function _extends$2(){return _extends$2=Object.assign?Object.assign.bind():function(X){for(var Z=1;Z<arguments.length;Z++){var _=arguments[Z];for(var K in _)({}).hasOwnProperty.call(_,K)&&(X[K]=_[K])}return X},_extends$2.apply(null,arguments)}const v1$2=new Vector3,v2$2=new Vector3,v3=new Vector3,v4=new Vector2;function defaultCalculatePosition(X,Z,_){const K=v1$2.setFromMatrixPosition(X.matrixWorld);K.project(Z);const te=_.width/2,ne=_.height/2;return[K.x*te+te,-(K.y*ne)+ne]}function isObjectBehindCamera(X,Z){const _=v1$2.setFromMatrixPosition(X.matrixWorld),K=v2$2.setFromMatrixPosition(Z.matrixWorld),te=_.sub(K),ne=Z.getWorldDirection(v3);return te.angleTo(ne)>Math.PI/2}function isObjectVisible(X,Z,_,K){const te=v1$2.setFromMatrixPosition(X.matrixWorld),ne=te.clone();ne.project(Z),v4.set(ne.x,ne.y),_.setFromCamera(v4,Z);const oe=_.intersectObjects(K,!0);if(oe.length){const ie=oe[0].distance;return te.distanceTo(_.ray.origin)<ie}return!0}function objectScale(X,Z){if(Z instanceof OrthographicCamera)return Z.zoom;if(Z instanceof PerspectiveCamera){const _=v1$2.setFromMatrixPosition(X.matrixWorld),K=v2$2.setFromMatrixPosition(Z.matrixWorld),te=Z.fov*Math.PI/180,ne=_.distanceTo(K);return 1/(2*Math.tan(te/2)*ne)}else return 1}function objectZIndex(X,Z,_){if(Z instanceof PerspectiveCamera||Z instanceof OrthographicCamera){const K=v1$2.setFromMatrixPosition(X.matrixWorld),te=v2$2.setFromMatrixPosition(Z.matrixWorld),ne=K.distanceTo(te),oe=(_[1]-_[0])/(Z.far-Z.near),ie=_[1]-oe*Z.far;return Math.round(oe*ne+ie)}}const epsilon=X=>Math.abs(X)<1e-10?0:X;function getCSSMatrix(X,Z,_=""){let K="matrix3d(";for(let te=0;te!==16;te++)K+=epsilon(Z[te]*X.elements[te])+(te!==15?",":")");return _+K}const getCameraCSSMatrix=(X=>Z=>getCSSMatrix(Z,X))([1,-1,1,1,1,-1,1,1,1,-1,1,1,1,-1,1,1]),getObjectCSSMatrix=(X=>(Z,_)=>getCSSMatrix(Z,X(_),"translate(-50%,-50%)"))(X=>[1/X,1/X,1/X,1,-1/X,-1/X,-1/X,-1,1/X,1/X,1/X,1,1,1,1,1]);function isRefObject(X){return X&&typeof X=="object"&&"current"in X}const Html=reactExports.forwardRef(({children:X,eps:Z=.001,style:_,className:K,prepend:te,center:ne,fullscreen:oe,portal:ie,distanceFactor:se,sprite:ae=!1,transform:ge=!1,occlude:ce,onOcclude:de,castShadow:pe,receiveShadow:fe,material:be,geometry:me,zIndexRange:ye=[16777271,0],calculatePosition:ve=defaultCalculatePosition,as:Be="div",wrapperClass:Re,pointerEvents:Ee="auto",...We},Ze)=>{const{gl:Ve,camera:_e,scene:Xe,size:Pe,raycaster:He,events:Ke,viewport:Ue}=useThree(),[tt]=reactExports.useState(()=>document.createElement(Be)),rt=reactExports.useRef(),at=reactExports.useRef(null),Oe=reactExports.useRef(0),$e=reactExports.useRef([0,0]),je=reactExports.useRef(null),Te=reactExports.useRef(null),De=(ie==null?void 0:ie.current)||Ke.connected||Ve.domElement.parentNode,ot=reactExports.useRef(null),ct=reactExports.useRef(!1),gt=reactExports.useMemo(()=>ce&&ce!=="blending"||Array.isArray(ce)&&ce.length&&isRefObject(ce[0]),[ce]);reactExports.useLayoutEffect(()=>{const en=Ve.domElement;ce&&ce==="blending"?(en.style.zIndex=`${Math.floor(ye[0]/2)}`,en.style.position="absolute",en.style.pointerEvents="none"):(en.style.zIndex=null,en.style.position=null,en.style.pointerEvents=null)},[ce]),reactExports.useLayoutEffect(()=>{if(at.current){const en=rt.current=clientExports.createRoot(tt);if(Xe.updateMatrixWorld(),ge)tt.style.cssText="position:absolute;top:0;left:0;pointer-events:none;overflow:hidden;";else{const Zt=ve(at.current,_e,Pe);tt.style.cssText=`position:absolute;top:0;left:0;transform:translate3d(${Zt[0]}px,${Zt[1]}px,0);transform-origin:0 0;`}return De&&(te?De.prepend(tt):De.appendChild(tt)),()=>{De&&De.removeChild(tt),en.unmount()}}},[De,ge]),reactExports.useLayoutEffect(()=>{Re&&(tt.className=Re)},[Re]);const pt=reactExports.useMemo(()=>ge?{position:"absolute",top:0,left:0,width:Pe.width,height:Pe.height,transformStyle:"preserve-3d",pointerEvents:"none"}:{position:"absolute",transform:ne?"translate3d(-50%,-50%,0)":"none",...oe&&{top:-Pe.height/2,left:-Pe.width/2,width:Pe.width,height:Pe.height},..._},[_,ne,oe,Pe,ge]),ht=reactExports.useMemo(()=>({position:"absolute",pointerEvents:Ee}),[Ee]);reactExports.useLayoutEffect(()=>{if(ct.current=!1,ge){var en;(en=rt.current)==null||en.render(reactExports.createElement("div",{ref:je,style:pt},reactExports.createElement("div",{ref:Te,style:ht},reactExports.createElement("div",{ref:Ze,className:K,style:_,children:X}))))}else{var Zt;(Zt=rt.current)==null||Zt.render(reactExports.createElement("div",{ref:Ze,style:pt,className:K,children:X}))}});const At=reactExports.useRef(!0);useFrame(en=>{if(at.current){_e.updateMatrixWorld(),at.current.updateWorldMatrix(!0,!1);const Zt=ge?$e.current:ve(at.current,_e,Pe);if(ge||Math.abs(Oe.current-_e.zoom)>Z||Math.abs($e.current[0]-Zt[0])>Z||Math.abs($e.current[1]-Zt[1])>Z){const st=isObjectBehindCamera(at.current,_e);let Vt=!1;gt&&(Array.isArray(ce)?Vt=ce.map(jt=>jt.current):ce!=="blending"&&(Vt=[Xe]));const wt=At.current;if(Vt){const jt=isObjectVisible(at.current,_e,He,Vt);At.current=jt&&!st}else At.current=!st;wt!==At.current&&(de?de(!At.current):tt.style.display=At.current?"block":"none");const St=Math.floor(ye[0]/2),Rt=ce?gt?[ye[0],St]:[St-1,0]:ye;if(tt.style.zIndex=`${objectZIndex(at.current,_e,Rt)}`,ge){const[jt,Wt]=[Pe.width/2,Pe.height/2],Ht=_e.projectionMatrix.elements[5]*Wt,{isOrthographicCamera:Pt,top:Mt,left:un,bottom:qe,right:Je}=_e,mt=getCameraCSSMatrix(_e.matrixWorldInverse),Dt=Pt?`scale(${Ht})translate(${epsilon(-(Je+un)/2)}px,${epsilon((Mt+qe)/2)}px)`:`translateZ(${Ht}px)`;let _t=at.current.matrixWorld;ae&&(_t=_e.matrixWorldInverse.clone().transpose().copyPosition(_t).scale(at.current.scale),_t.elements[3]=_t.elements[7]=_t.elements[11]=0,_t.elements[15]=1),tt.style.width=Pe.width+"px",tt.style.height=Pe.height+"px",tt.style.perspective=Pt?"":`${Ht}px`,je.current&&Te.current&&(je.current.style.transform=`${Dt}${mt}translate(${jt}px,${Wt}px)`,Te.current.style.transform=getObjectCSSMatrix(_t,1/((se||10)/400)))}else{const jt=se===void 0?1:objectScale(at.current,_e)*se;tt.style.transform=`translate3d(${Zt[0]}px,${Zt[1]}px,0) scale(${jt})`}$e.current=Zt,Oe.current=_e.zoom}}if(!gt&&ot.current&&!ct.current)if(ge){if(je.current){const Zt=je.current.children[0];if(Zt!=null&&Zt.clientWidth&&Zt!=null&&Zt.clientHeight){const{isOrthographicCamera:st}=_e;if(st||me)We.scale&&(Array.isArray(We.scale)?We.scale instanceof Vector3?ot.current.scale.copy(We.scale.clone().divideScalar(1)):ot.current.scale.set(1/We.scale[0],1/We.scale[1],1/We.scale[2]):ot.current.scale.setScalar(1/We.scale));else{const Vt=(se||10)/400,wt=Zt.clientWidth*Vt,St=Zt.clientHeight*Vt;ot.current.scale.set(wt,St,1)}ct.current=!0}}}else{const Zt=tt.children[0];if(Zt!=null&&Zt.clientWidth&&Zt!=null&&Zt.clientHeight){const st=1/Ue.factor,Vt=Zt.clientWidth*st,wt=Zt.clientHeight*st;ot.current.scale.set(Vt,wt,1),ct.current=!0}ot.current.lookAt(en.camera.position)}});const Kt=reactExports.useMemo(()=>({vertexShader:ge?void 0:`
          /*
            This shader is from the THREE's SpriteMaterial.
            We need to turn the backing plane into a Sprite
            (make it always face the camera) if "transfrom"
            is false.
          */
          #include <common>

          void main() {
            vec2 center = vec2(0., 1.);
            float rotation = 0.0;

            // This is somewhat arbitrary, but it seems to work well
            // Need to figure out how to derive this dynamically if it even matters
            float size = 0.03;

            vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
            vec2 scale;
            scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
            scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );

            bool isPerspective = isPerspectiveMatrix( projectionMatrix );
            if ( isPerspective ) scale *= - mvPosition.z;

            vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale * size;
            vec2 rotatedPosition;
            rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
            rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
            mvPosition.xy += rotatedPosition;

            gl_Position = projectionMatrix * mvPosition;
          }
      `,fragmentShader:`
        void main() {
          gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);
        }
      `}),[ge]);return reactExports.createElement("group",_extends$2({},We,{ref:at}),ce&&!gt&&reactExports.createElement("mesh",{castShadow:pe,receiveShadow:fe,ref:ot},me||reactExports.createElement("planeGeometry",null),be||reactExports.createElement("shaderMaterial",{side:DoubleSide,vertexShader:Kt.vertexShader,fragmentShader:Kt.fragmentShader})))});function clamp$2(X,Z,_){return Math.max(Z,Math.min(X,_))}const V$2={toVector(X,Z){return X===void 0&&(X=Z),Array.isArray(X)?X:[X,X]},add(X,Z){return[X[0]+Z[0],X[1]+Z[1]]},sub(X,Z){return[X[0]-Z[0],X[1]-Z[1]]},addTo(X,Z){X[0]+=Z[0],X[1]+=Z[1]},subTo(X,Z){X[0]-=Z[0],X[1]-=Z[1]}};function rubberband(X,Z,_){return Z===0||Math.abs(Z)===1/0?Math.pow(X,_*5):X*Z*_/(Z+_*X)}function rubberbandIfOutOfBounds(X,Z,_,K=.15){return K===0?clamp$2(X,Z,_):X<Z?-rubberband(Z-X,_-Z,K)+Z:X>_?+rubberband(X-_,_-Z,K)+_:X}function computeRubberband(X,[Z,_],[K,te]){const[[ne,oe],[ie,se]]=X;return[rubberbandIfOutOfBounds(Z,ne,oe,K),rubberbandIfOutOfBounds(_,ie,se,te)]}function _toPrimitive$1(X,Z){if(typeof X!="object"||X===null)return X;var _=X[Symbol.toPrimitive];if(_!==void 0){var K=_.call(X,Z||"default");if(typeof K!="object")return K;throw new TypeError("@@toPrimitive must return a primitive value.")}return(Z==="string"?String:Number)(X)}function _toPropertyKey$1(X){var Z=_toPrimitive$1(X,"string");return typeof Z=="symbol"?Z:String(Z)}function _defineProperty$4(X,Z,_){return Z=_toPropertyKey$1(Z),Z in X?Object.defineProperty(X,Z,{value:_,enumerable:!0,configurable:!0,writable:!0}):X[Z]=_,X}function ownKeys$4(X,Z){var _=Object.keys(X);if(Object.getOwnPropertySymbols){var K=Object.getOwnPropertySymbols(X);Z&&(K=K.filter(function(te){return Object.getOwnPropertyDescriptor(X,te).enumerable})),_.push.apply(_,K)}return _}function _objectSpread2$1(X){for(var Z=1;Z<arguments.length;Z++){var _=arguments[Z]!=null?arguments[Z]:{};Z%2?ownKeys$4(Object(_),!0).forEach(function(K){_defineProperty$4(X,K,_[K])}):Object.getOwnPropertyDescriptors?Object.defineProperties(X,Object.getOwnPropertyDescriptors(_)):ownKeys$4(Object(_)).forEach(function(K){Object.defineProperty(X,K,Object.getOwnPropertyDescriptor(_,K))})}return X}const EVENT_TYPE_MAP={pointer:{start:"down",change:"move",end:"up"},mouse:{start:"down",change:"move",end:"up"},touch:{start:"start",change:"move",end:"end"},gesture:{start:"start",change:"change",end:"end"}};function capitalize$1(X){return X?X[0].toUpperCase()+X.slice(1):""}const actionsWithoutCaptureSupported=["enter","leave"];function hasCapture(X=!1,Z){return X&&!actionsWithoutCaptureSupported.includes(Z)}function toHandlerProp(X,Z="",_=!1){const K=EVENT_TYPE_MAP[X],te=K&&K[Z]||Z;return"on"+capitalize$1(X)+capitalize$1(te)+(hasCapture(_,te)?"Capture":"")}const pointerCaptureEvents=["gotpointercapture","lostpointercapture"];function parseProp(X){let Z=X.substring(2).toLowerCase();const _=!!~Z.indexOf("passive");_&&(Z=Z.replace("passive",""));const K=pointerCaptureEvents.includes(Z)?"capturecapture":"capture",te=!!~Z.indexOf(K);return te&&(Z=Z.replace("capture","")),{device:Z,capture:te,passive:_}}function toDomEventType(X,Z=""){const _=EVENT_TYPE_MAP[X],K=_&&_[Z]||Z;return X+K}function isTouch(X){return"touches"in X}function getPointerType(X){return isTouch(X)?"touch":"pointerType"in X?X.pointerType:"mouse"}function getCurrentTargetTouchList(X){return Array.from(X.touches).filter(Z=>{var _,K;return Z.target===X.currentTarget||((_=X.currentTarget)===null||_===void 0||(K=_.contains)===null||K===void 0?void 0:K.call(_,Z.target))})}function getTouchList(X){return X.type==="touchend"||X.type==="touchcancel"?X.changedTouches:X.targetTouches}function getValueEvent(X){return isTouch(X)?getTouchList(X)[0]:X}function distanceAngle(X,Z){try{const _=Z.clientX-X.clientX,K=Z.clientY-X.clientY,te=(Z.clientX+X.clientX)/2,ne=(Z.clientY+X.clientY)/2,oe=Math.hypot(_,K);return{angle:-(Math.atan2(_,K)*180)/Math.PI,distance:oe,origin:[te,ne]}}catch{}return null}function touchIds(X){return getCurrentTargetTouchList(X).map(Z=>Z.identifier)}function touchDistanceAngle(X,Z){const[_,K]=Array.from(X.touches).filter(te=>Z.includes(te.identifier));return distanceAngle(_,K)}function pointerId(X){const Z=getValueEvent(X);return isTouch(X)?Z.identifier:Z.pointerId}function pointerValues(X){const Z=getValueEvent(X);return[Z.clientX,Z.clientY]}const LINE_HEIGHT=40,PAGE_HEIGHT=800;function wheelValues(X){let{deltaX:Z,deltaY:_,deltaMode:K}=X;return K===1?(Z*=LINE_HEIGHT,_*=LINE_HEIGHT):K===2&&(Z*=PAGE_HEIGHT,_*=PAGE_HEIGHT),[Z,_]}function scrollValues(X){var Z,_;const{scrollX:K,scrollY:te,scrollLeft:ne,scrollTop:oe}=X.currentTarget;return[(Z=K??ne)!==null&&Z!==void 0?Z:0,(_=te??oe)!==null&&_!==void 0?_:0]}function getEventDetails(X){const Z={};if("buttons"in X&&(Z.buttons=X.buttons),"shiftKey"in X){const{shiftKey:_,altKey:K,metaKey:te,ctrlKey:ne}=X;Object.assign(Z,{shiftKey:_,altKey:K,metaKey:te,ctrlKey:ne})}return Z}function call$1(X,...Z){return typeof X=="function"?X(...Z):X}function noop$2(){}function chain(...X){return X.length===0?noop$2:X.length===1?X[0]:function(){let Z;for(const _ of X)Z=_.apply(this,arguments)||Z;return Z}}function assignDefault(X,Z){return Object.assign({},Z,X||{})}const BEFORE_LAST_KINEMATICS_DELAY=32;class Engine{constructor(Z,_,K){this.ctrl=Z,this.args=_,this.key=K,this.state||(this.state={},this.computeValues([0,0]),this.computeInitial(),this.init&&this.init(),this.reset())}get state(){return this.ctrl.state[this.key]}set state(Z){this.ctrl.state[this.key]=Z}get shared(){return this.ctrl.state.shared}get eventStore(){return this.ctrl.gestureEventStores[this.key]}get timeoutStore(){return this.ctrl.gestureTimeoutStores[this.key]}get config(){return this.ctrl.config[this.key]}get sharedConfig(){return this.ctrl.config.shared}get handler(){return this.ctrl.handlers[this.key]}reset(){const{state:Z,shared:_,ingKey:K,args:te}=this;_[K]=Z._active=Z.active=Z._blocked=Z._force=!1,Z._step=[!1,!1],Z.intentional=!1,Z._movement=[0,0],Z._distance=[0,0],Z._direction=[0,0],Z._delta=[0,0],Z._bounds=[[-1/0,1/0],[-1/0,1/0]],Z.args=te,Z.axis=void 0,Z.memo=void 0,Z.elapsedTime=Z.timeDelta=0,Z.direction=[0,0],Z.distance=[0,0],Z.overflow=[0,0],Z._movementBound=[!1,!1],Z.velocity=[0,0],Z.movement=[0,0],Z.delta=[0,0],Z.timeStamp=0}start(Z){const _=this.state,K=this.config;_._active||(this.reset(),this.computeInitial(),_._active=!0,_.target=Z.target,_.currentTarget=Z.currentTarget,_.lastOffset=K.from?call$1(K.from,_):_.offset,_.offset=_.lastOffset,_.startTime=_.timeStamp=Z.timeStamp)}computeValues(Z){const _=this.state;_._values=Z,_.values=this.config.transform(Z)}computeInitial(){const Z=this.state;Z._initial=Z._values,Z.initial=Z.values}compute(Z){const{state:_,config:K,shared:te}=this;_.args=this.args;let ne=0;if(Z&&(_.event=Z,K.preventDefault&&Z.cancelable&&_.event.preventDefault(),_.type=Z.type,te.touches=this.ctrl.pointerIds.size||this.ctrl.touchIds.size,te.locked=!!document.pointerLockElement,Object.assign(te,getEventDetails(Z)),te.down=te.pressed=te.buttons%2===1||te.touches>0,ne=Z.timeStamp-_.timeStamp,_.timeStamp=Z.timeStamp,_.elapsedTime=_.timeStamp-_.startTime),_._active){const We=_._delta.map(Math.abs);V$2.addTo(_._distance,We)}this.axisIntent&&this.axisIntent(Z);const[oe,ie]=_._movement,[se,ae]=K.threshold,{_step:ge,values:ce}=_;if(K.hasCustomTransform?(ge[0]===!1&&(ge[0]=Math.abs(oe)>=se&&ce[0]),ge[1]===!1&&(ge[1]=Math.abs(ie)>=ae&&ce[1])):(ge[0]===!1&&(ge[0]=Math.abs(oe)>=se&&Math.sign(oe)*se),ge[1]===!1&&(ge[1]=Math.abs(ie)>=ae&&Math.sign(ie)*ae)),_.intentional=ge[0]!==!1||ge[1]!==!1,!_.intentional)return;const de=[0,0];if(K.hasCustomTransform){const[We,Ze]=ce;de[0]=ge[0]!==!1?We-ge[0]:0,de[1]=ge[1]!==!1?Ze-ge[1]:0}else de[0]=ge[0]!==!1?oe-ge[0]:0,de[1]=ge[1]!==!1?ie-ge[1]:0;this.restrictToAxis&&!_._blocked&&this.restrictToAxis(de);const pe=_.offset,fe=_._active&&!_._blocked||_.active;fe&&(_.first=_._active&&!_.active,_.last=!_._active&&_.active,_.active=te[this.ingKey]=_._active,Z&&(_.first&&("bounds"in K&&(_._bounds=call$1(K.bounds,_)),this.setup&&this.setup()),_.movement=de,this.computeOffset()));const[be,me]=_.offset,[[ye,ve],[Be,Re]]=_._bounds;_.overflow=[be<ye?-1:be>ve?1:0,me<Be?-1:me>Re?1:0],_._movementBound[0]=_.overflow[0]?_._movementBound[0]===!1?_._movement[0]:_._movementBound[0]:!1,_._movementBound[1]=_.overflow[1]?_._movementBound[1]===!1?_._movement[1]:_._movementBound[1]:!1;const Ee=_._active?K.rubberband||[0,0]:[0,0];if(_.offset=computeRubberband(_._bounds,_.offset,Ee),_.delta=V$2.sub(_.offset,pe),this.computeMovement(),fe&&(!_.last||ne>BEFORE_LAST_KINEMATICS_DELAY)){_.delta=V$2.sub(_.offset,pe);const We=_.delta.map(Math.abs);V$2.addTo(_.distance,We),_.direction=_.delta.map(Math.sign),_._direction=_._delta.map(Math.sign),!_.first&&ne>0&&(_.velocity=[We[0]/ne,We[1]/ne],_.timeDelta=ne)}}emit(){const Z=this.state,_=this.shared,K=this.config;if(Z._active||this.clean(),(Z._blocked||!Z.intentional)&&!Z._force&&!K.triggerAllEvents)return;const te=this.handler(_objectSpread2$1(_objectSpread2$1(_objectSpread2$1({},_),Z),{},{[this.aliasKey]:Z.values}));te!==void 0&&(Z.memo=te)}clean(){this.eventStore.clean(),this.timeoutStore.clean()}}function selectAxis([X,Z],_){const K=Math.abs(X),te=Math.abs(Z);if(K>te&&K>_)return"x";if(te>K&&te>_)return"y"}class CoordinatesEngine extends Engine{constructor(...Z){super(...Z),_defineProperty$4(this,"aliasKey","xy")}reset(){super.reset(),this.state.axis=void 0}init(){this.state.offset=[0,0],this.state.lastOffset=[0,0]}computeOffset(){this.state.offset=V$2.add(this.state.lastOffset,this.state.movement)}computeMovement(){this.state.movement=V$2.sub(this.state.offset,this.state.lastOffset)}axisIntent(Z){const _=this.state,K=this.config;if(!_.axis&&Z){const te=typeof K.axisThreshold=="object"?K.axisThreshold[getPointerType(Z)]:K.axisThreshold;_.axis=selectAxis(_._movement,te)}_._blocked=(K.lockDirection||!!K.axis)&&!_.axis||!!K.axis&&K.axis!==_.axis}restrictToAxis(Z){if(this.config.axis||this.config.lockDirection)switch(this.state.axis){case"x":Z[1]=0;break;case"y":Z[0]=0;break}}}const identity=X=>X,DEFAULT_RUBBERBAND=.15,commonConfigResolver={enabled(X=!0){return X},eventOptions(X,Z,_){return _objectSpread2$1(_objectSpread2$1({},_.shared.eventOptions),X)},preventDefault(X=!1){return X},triggerAllEvents(X=!1){return X},rubberband(X=0){switch(X){case!0:return[DEFAULT_RUBBERBAND,DEFAULT_RUBBERBAND];case!1:return[0,0];default:return V$2.toVector(X)}},from(X){if(typeof X=="function")return X;if(X!=null)return V$2.toVector(X)},transform(X,Z,_){const K=X||_.shared.transform;return this.hasCustomTransform=!!K,K||identity},threshold(X){return V$2.toVector(X,0)}},DEFAULT_AXIS_THRESHOLD=0,coordinatesConfigResolver=_objectSpread2$1(_objectSpread2$1({},commonConfigResolver),{},{axis(X,Z,{axis:_}){if(this.lockDirection=_==="lock",!this.lockDirection)return _},axisThreshold(X=DEFAULT_AXIS_THRESHOLD){return X},bounds(X={}){if(typeof X=="function")return ne=>coordinatesConfigResolver.bounds(X(ne));if("current"in X)return()=>X.current;if(typeof HTMLElement=="function"&&X instanceof HTMLElement)return X;const{left:Z=-1/0,right:_=1/0,top:K=-1/0,bottom:te=1/0}=X;return[[Z,_],[K,te]]}}),KEYS_DELTA_MAP={ArrowRight:(X,Z=1)=>[X*Z,0],ArrowLeft:(X,Z=1)=>[-1*X*Z,0],ArrowUp:(X,Z=1)=>[0,-1*X*Z],ArrowDown:(X,Z=1)=>[0,X*Z]};class DragEngine extends CoordinatesEngine{constructor(...Z){super(...Z),_defineProperty$4(this,"ingKey","dragging")}reset(){super.reset();const Z=this.state;Z._pointerId=void 0,Z._pointerActive=!1,Z._keyboardActive=!1,Z._preventScroll=!1,Z._delayed=!1,Z.swipe=[0,0],Z.tap=!1,Z.canceled=!1,Z.cancel=this.cancel.bind(this)}setup(){const Z=this.state;if(Z._bounds instanceof HTMLElement){const _=Z._bounds.getBoundingClientRect(),K=Z.currentTarget.getBoundingClientRect(),te={left:_.left-K.left+Z.offset[0],right:_.right-K.right+Z.offset[0],top:_.top-K.top+Z.offset[1],bottom:_.bottom-K.bottom+Z.offset[1]};Z._bounds=coordinatesConfigResolver.bounds(te)}}cancel(){const Z=this.state;Z.canceled||(Z.canceled=!0,Z._active=!1,setTimeout(()=>{this.compute(),this.emit()},0))}setActive(){this.state._active=this.state._pointerActive||this.state._keyboardActive}clean(){this.pointerClean(),this.state._pointerActive=!1,this.state._keyboardActive=!1,super.clean()}pointerDown(Z){const _=this.config,K=this.state;if(Z.buttons!=null&&(Array.isArray(_.pointerButtons)?!_.pointerButtons.includes(Z.buttons):_.pointerButtons!==-1&&_.pointerButtons!==Z.buttons))return;const te=this.ctrl.setEventIds(Z);_.pointerCapture&&Z.target.setPointerCapture(Z.pointerId),!(te&&te.size>1&&K._pointerActive)&&(this.start(Z),this.setupPointer(Z),K._pointerId=pointerId(Z),K._pointerActive=!0,this.computeValues(pointerValues(Z)),this.computeInitial(),_.preventScrollAxis&&getPointerType(Z)!=="mouse"?(K._active=!1,this.setupScrollPrevention(Z)):_.delay>0?(this.setupDelayTrigger(Z),_.triggerAllEvents&&(this.compute(Z),this.emit())):this.startPointerDrag(Z))}startPointerDrag(Z){const _=this.state;_._active=!0,_._preventScroll=!0,_._delayed=!1,this.compute(Z),this.emit()}pointerMove(Z){const _=this.state,K=this.config;if(!_._pointerActive)return;const te=pointerId(Z);if(_._pointerId!==void 0&&te!==_._pointerId)return;const ne=pointerValues(Z);if(document.pointerLockElement===Z.target?_._delta=[Z.movementX,Z.movementY]:(_._delta=V$2.sub(ne,_._values),this.computeValues(ne)),V$2.addTo(_._movement,_._delta),this.compute(Z),_._delayed&&_.intentional){this.timeoutStore.remove("dragDelay"),_.active=!1,this.startPointerDrag(Z);return}if(K.preventScrollAxis&&!_._preventScroll)if(_.axis)if(_.axis===K.preventScrollAxis||K.preventScrollAxis==="xy"){_._active=!1,this.clean();return}else{this.timeoutStore.remove("startPointerDrag"),this.startPointerDrag(Z);return}else return;this.emit()}pointerUp(Z){this.ctrl.setEventIds(Z);try{this.config.pointerCapture&&Z.target.hasPointerCapture(Z.pointerId)&&Z.target.releasePointerCapture(Z.pointerId)}catch{}const _=this.state,K=this.config;if(!_._active||!_._pointerActive)return;const te=pointerId(Z);if(_._pointerId!==void 0&&te!==_._pointerId)return;this.state._pointerActive=!1,this.setActive(),this.compute(Z);const[ne,oe]=_._distance;if(_.tap=ne<=K.tapsThreshold&&oe<=K.tapsThreshold,_.tap&&K.filterTaps)_._force=!0;else{const[ie,se]=_._delta,[ae,ge]=_._movement,[ce,de]=K.swipe.velocity,[pe,fe]=K.swipe.distance,be=K.swipe.duration;if(_.elapsedTime<be){const me=Math.abs(ie/_.timeDelta),ye=Math.abs(se/_.timeDelta);me>ce&&Math.abs(ae)>pe&&(_.swipe[0]=Math.sign(ie)),ye>de&&Math.abs(ge)>fe&&(_.swipe[1]=Math.sign(se))}}this.emit()}pointerClick(Z){!this.state.tap&&Z.detail>0&&(Z.preventDefault(),Z.stopPropagation())}setupPointer(Z){const _=this.config,K=_.device;_.pointerLock&&Z.currentTarget.requestPointerLock(),_.pointerCapture||(this.eventStore.add(this.sharedConfig.window,K,"change",this.pointerMove.bind(this)),this.eventStore.add(this.sharedConfig.window,K,"end",this.pointerUp.bind(this)),this.eventStore.add(this.sharedConfig.window,K,"cancel",this.pointerUp.bind(this)))}pointerClean(){this.config.pointerLock&&document.pointerLockElement===this.state.currentTarget&&document.exitPointerLock()}preventScroll(Z){this.state._preventScroll&&Z.cancelable&&Z.preventDefault()}setupScrollPrevention(Z){this.state._preventScroll=!1,persistEvent(Z);const _=this.eventStore.add(this.sharedConfig.window,"touch","change",this.preventScroll.bind(this),{passive:!1});this.eventStore.add(this.sharedConfig.window,"touch","end",_),this.eventStore.add(this.sharedConfig.window,"touch","cancel",_),this.timeoutStore.add("startPointerDrag",this.startPointerDrag.bind(this),this.config.preventScrollDelay,Z)}setupDelayTrigger(Z){this.state._delayed=!0,this.timeoutStore.add("dragDelay",()=>{this.state._step=[0,0],this.startPointerDrag(Z)},this.config.delay)}keyDown(Z){const _=KEYS_DELTA_MAP[Z.key];if(_){const K=this.state,te=Z.shiftKey?10:Z.altKey?.1:1;this.start(Z),K._delta=_(this.config.keyboardDisplacement,te),K._keyboardActive=!0,V$2.addTo(K._movement,K._delta),this.compute(Z),this.emit()}}keyUp(Z){Z.key in KEYS_DELTA_MAP&&(this.state._keyboardActive=!1,this.setActive(),this.compute(Z),this.emit())}bind(Z){const _=this.config.device;Z(_,"start",this.pointerDown.bind(this)),this.config.pointerCapture&&(Z(_,"change",this.pointerMove.bind(this)),Z(_,"end",this.pointerUp.bind(this)),Z(_,"cancel",this.pointerUp.bind(this)),Z("lostPointerCapture","",this.pointerUp.bind(this))),this.config.keys&&(Z("key","down",this.keyDown.bind(this)),Z("key","up",this.keyUp.bind(this))),this.config.filterTaps&&Z("click","",this.pointerClick.bind(this),{capture:!0,passive:!1})}}function persistEvent(X){"persist"in X&&typeof X.persist=="function"&&X.persist()}const isBrowser=typeof window<"u"&&window.document&&window.document.createElement;function supportsTouchEvents(){return isBrowser&&"ontouchstart"in window}function isTouchScreen(){return supportsTouchEvents()||isBrowser&&window.navigator.maxTouchPoints>1}function supportsPointerEvents(){return isBrowser&&"onpointerdown"in window}function supportsPointerLock(){return isBrowser&&"exitPointerLock"in window.document}function supportsGestureEvents(){try{return"constructor"in GestureEvent}catch{return!1}}const SUPPORT={isBrowser,gesture:supportsGestureEvents(),touch:supportsTouchEvents(),touchscreen:isTouchScreen(),pointer:supportsPointerEvents(),pointerLock:supportsPointerLock()},DEFAULT_PREVENT_SCROLL_DELAY=250,DEFAULT_DRAG_DELAY=180,DEFAULT_SWIPE_VELOCITY=.5,DEFAULT_SWIPE_DISTANCE=50,DEFAULT_SWIPE_DURATION=250,DEFAULT_KEYBOARD_DISPLACEMENT=10,DEFAULT_DRAG_AXIS_THRESHOLD={mouse:0,touch:0,pen:8},dragConfigResolver=_objectSpread2$1(_objectSpread2$1({},coordinatesConfigResolver),{},{device(X,Z,{pointer:{touch:_=!1,lock:K=!1,mouse:te=!1}={}}){return this.pointerLock=K&&SUPPORT.pointerLock,SUPPORT.touch&&_?"touch":this.pointerLock?"mouse":SUPPORT.pointer&&!te?"pointer":SUPPORT.touch?"touch":"mouse"},preventScrollAxis(X,Z,{preventScroll:_}){if(this.preventScrollDelay=typeof _=="number"?_:_||_===void 0&&X?DEFAULT_PREVENT_SCROLL_DELAY:void 0,!(!SUPPORT.touchscreen||_===!1))return X||(_!==void 0?"y":void 0)},pointerCapture(X,Z,{pointer:{capture:_=!0,buttons:K=1,keys:te=!0}={}}){return this.pointerButtons=K,this.keys=te,!this.pointerLock&&this.device==="pointer"&&_},threshold(X,Z,{filterTaps:_=!1,tapsThreshold:K=3,axis:te=void 0}){const ne=V$2.toVector(X,_?K:te?1:0);return this.filterTaps=_,this.tapsThreshold=K,ne},swipe({velocity:X=DEFAULT_SWIPE_VELOCITY,distance:Z=DEFAULT_SWIPE_DISTANCE,duration:_=DEFAULT_SWIPE_DURATION}={}){return{velocity:this.transform(V$2.toVector(X)),distance:this.transform(V$2.toVector(Z)),duration:_}},delay(X=0){switch(X){case!0:return DEFAULT_DRAG_DELAY;case!1:return 0;default:return X}},axisThreshold(X){return X?_objectSpread2$1(_objectSpread2$1({},DEFAULT_DRAG_AXIS_THRESHOLD),X):DEFAULT_DRAG_AXIS_THRESHOLD},keyboardDisplacement(X=DEFAULT_KEYBOARD_DISPLACEMENT){return X}});function clampStateInternalMovementToBounds(X){const[Z,_]=X.overflow,[K,te]=X._delta,[ne,oe]=X._direction;(Z<0&&K>0&&ne<0||Z>0&&K<0&&ne>0)&&(X._movement[0]=X._movementBound[0]),(_<0&&te>0&&oe<0||_>0&&te<0&&oe>0)&&(X._movement[1]=X._movementBound[1])}const SCALE_ANGLE_RATIO_INTENT_DEG=30,PINCH_WHEEL_RATIO=100;class PinchEngine extends Engine{constructor(...Z){super(...Z),_defineProperty$4(this,"ingKey","pinching"),_defineProperty$4(this,"aliasKey","da")}init(){this.state.offset=[1,0],this.state.lastOffset=[1,0],this.state._pointerEvents=new Map}reset(){super.reset();const Z=this.state;Z._touchIds=[],Z.canceled=!1,Z.cancel=this.cancel.bind(this),Z.turns=0}computeOffset(){const{type:Z,movement:_,lastOffset:K}=this.state;Z==="wheel"?this.state.offset=V$2.add(_,K):this.state.offset=[(1+_[0])*K[0],_[1]+K[1]]}computeMovement(){const{offset:Z,lastOffset:_}=this.state;this.state.movement=[Z[0]/_[0],Z[1]-_[1]]}axisIntent(){const Z=this.state,[_,K]=Z._movement;if(!Z.axis){const te=Math.abs(_)*SCALE_ANGLE_RATIO_INTENT_DEG-Math.abs(K);te<0?Z.axis="angle":te>0&&(Z.axis="scale")}}restrictToAxis(Z){this.config.lockDirection&&(this.state.axis==="scale"?Z[1]=0:this.state.axis==="angle"&&(Z[0]=0))}cancel(){const Z=this.state;Z.canceled||setTimeout(()=>{Z.canceled=!0,Z._active=!1,this.compute(),this.emit()},0)}touchStart(Z){this.ctrl.setEventIds(Z);const _=this.state,K=this.ctrl.touchIds;if(_._active&&_._touchIds.every(ne=>K.has(ne))||K.size<2)return;this.start(Z),_._touchIds=Array.from(K).slice(0,2);const te=touchDistanceAngle(Z,_._touchIds);te&&this.pinchStart(Z,te)}pointerStart(Z){if(Z.buttons!=null&&Z.buttons%2!==1)return;this.ctrl.setEventIds(Z),Z.target.setPointerCapture(Z.pointerId);const _=this.state,K=_._pointerEvents,te=this.ctrl.pointerIds;if(_._active&&Array.from(K.keys()).every(oe=>te.has(oe))||(K.size<2&&K.set(Z.pointerId,Z),_._pointerEvents.size<2))return;this.start(Z);const ne=distanceAngle(...Array.from(K.values()));ne&&this.pinchStart(Z,ne)}pinchStart(Z,_){const K=this.state;K.origin=_.origin,this.computeValues([_.distance,_.angle]),this.computeInitial(),this.compute(Z),this.emit()}touchMove(Z){if(!this.state._active)return;const _=touchDistanceAngle(Z,this.state._touchIds);_&&this.pinchMove(Z,_)}pointerMove(Z){const _=this.state._pointerEvents;if(_.has(Z.pointerId)&&_.set(Z.pointerId,Z),!this.state._active)return;const K=distanceAngle(...Array.from(_.values()));K&&this.pinchMove(Z,K)}pinchMove(Z,_){const K=this.state,te=K._values[1],ne=_.angle-te;let oe=0;Math.abs(ne)>270&&(oe+=Math.sign(ne)),this.computeValues([_.distance,_.angle-360*oe]),K.origin=_.origin,K.turns=oe,K._movement=[K._values[0]/K._initial[0]-1,K._values[1]-K._initial[1]],this.compute(Z),this.emit()}touchEnd(Z){this.ctrl.setEventIds(Z),this.state._active&&this.state._touchIds.some(_=>!this.ctrl.touchIds.has(_))&&(this.state._active=!1,this.compute(Z),this.emit())}pointerEnd(Z){const _=this.state;this.ctrl.setEventIds(Z);try{Z.target.releasePointerCapture(Z.pointerId)}catch{}_._pointerEvents.has(Z.pointerId)&&_._pointerEvents.delete(Z.pointerId),_._active&&_._pointerEvents.size<2&&(_._active=!1,this.compute(Z),this.emit())}gestureStart(Z){Z.cancelable&&Z.preventDefault();const _=this.state;_._active||(this.start(Z),this.computeValues([Z.scale,Z.rotation]),_.origin=[Z.clientX,Z.clientY],this.compute(Z),this.emit())}gestureMove(Z){if(Z.cancelable&&Z.preventDefault(),!this.state._active)return;const _=this.state;this.computeValues([Z.scale,Z.rotation]),_.origin=[Z.clientX,Z.clientY];const K=_._movement;_._movement=[Z.scale-1,Z.rotation],_._delta=V$2.sub(_._movement,K),this.compute(Z),this.emit()}gestureEnd(Z){this.state._active&&(this.state._active=!1,this.compute(Z),this.emit())}wheel(Z){const _=this.config.modifierKey;_&&(Array.isArray(_)?!_.find(K=>Z[K]):!Z[_])||(this.state._active?this.wheelChange(Z):this.wheelStart(Z),this.timeoutStore.add("wheelEnd",this.wheelEnd.bind(this)))}wheelStart(Z){this.start(Z),this.wheelChange(Z)}wheelChange(Z){"uv"in Z||Z.cancelable&&Z.preventDefault();const K=this.state;K._delta=[-wheelValues(Z)[1]/PINCH_WHEEL_RATIO*K.offset[0],0],V$2.addTo(K._movement,K._delta),clampStateInternalMovementToBounds(K),this.state.origin=[Z.clientX,Z.clientY],this.compute(Z),this.emit()}wheelEnd(){this.state._active&&(this.state._active=!1,this.compute(),this.emit())}bind(Z){const _=this.config.device;_&&(Z(_,"start",this[_+"Start"].bind(this)),Z(_,"change",this[_+"Move"].bind(this)),Z(_,"end",this[_+"End"].bind(this)),Z(_,"cancel",this[_+"End"].bind(this)),Z("lostPointerCapture","",this[_+"End"].bind(this))),this.config.pinchOnWheel&&Z("wheel","",this.wheel.bind(this),{passive:!1})}}const pinchConfigResolver=_objectSpread2$1(_objectSpread2$1({},commonConfigResolver),{},{device(X,Z,{shared:_,pointer:{touch:K=!1}={}}){if(_.target&&!SUPPORT.touch&&SUPPORT.gesture)return"gesture";if(SUPPORT.touch&&K)return"touch";if(SUPPORT.touchscreen){if(SUPPORT.pointer)return"pointer";if(SUPPORT.touch)return"touch"}},bounds(X,Z,{scaleBounds:_={},angleBounds:K={}}){const te=oe=>{const ie=assignDefault(call$1(_,oe),{min:-1/0,max:1/0});return[ie.min,ie.max]},ne=oe=>{const ie=assignDefault(call$1(K,oe),{min:-1/0,max:1/0});return[ie.min,ie.max]};return typeof _!="function"&&typeof K!="function"?[te(),ne()]:oe=>[te(oe),ne(oe)]},threshold(X,Z,_){return this.lockDirection=_.axis==="lock",V$2.toVector(X,this.lockDirection?[.1,3]:0)},modifierKey(X){return X===void 0?"ctrlKey":X},pinchOnWheel(X=!0){return X}});class MoveEngine extends CoordinatesEngine{constructor(...Z){super(...Z),_defineProperty$4(this,"ingKey","moving")}move(Z){this.config.mouseOnly&&Z.pointerType!=="mouse"||(this.state._active?this.moveChange(Z):this.moveStart(Z),this.timeoutStore.add("moveEnd",this.moveEnd.bind(this)))}moveStart(Z){this.start(Z),this.computeValues(pointerValues(Z)),this.compute(Z),this.computeInitial(),this.emit()}moveChange(Z){if(!this.state._active)return;const _=pointerValues(Z),K=this.state;K._delta=V$2.sub(_,K._values),V$2.addTo(K._movement,K._delta),this.computeValues(_),this.compute(Z),this.emit()}moveEnd(Z){this.state._active&&(this.state._active=!1,this.compute(Z),this.emit())}bind(Z){Z("pointer","change",this.move.bind(this)),Z("pointer","leave",this.moveEnd.bind(this))}}const moveConfigResolver=_objectSpread2$1(_objectSpread2$1({},coordinatesConfigResolver),{},{mouseOnly:(X=!0)=>X});class ScrollEngine extends CoordinatesEngine{constructor(...Z){super(...Z),_defineProperty$4(this,"ingKey","scrolling")}scroll(Z){this.state._active||this.start(Z),this.scrollChange(Z),this.timeoutStore.add("scrollEnd",this.scrollEnd.bind(this))}scrollChange(Z){Z.cancelable&&Z.preventDefault();const _=this.state,K=scrollValues(Z);_._delta=V$2.sub(K,_._values),V$2.addTo(_._movement,_._delta),this.computeValues(K),this.compute(Z),this.emit()}scrollEnd(){this.state._active&&(this.state._active=!1,this.compute(),this.emit())}bind(Z){Z("scroll","",this.scroll.bind(this))}}const scrollConfigResolver=coordinatesConfigResolver;class WheelEngine extends CoordinatesEngine{constructor(...Z){super(...Z),_defineProperty$4(this,"ingKey","wheeling")}wheel(Z){this.state._active||this.start(Z),this.wheelChange(Z),this.timeoutStore.add("wheelEnd",this.wheelEnd.bind(this))}wheelChange(Z){const _=this.state;_._delta=wheelValues(Z),V$2.addTo(_._movement,_._delta),clampStateInternalMovementToBounds(_),this.compute(Z),this.emit()}wheelEnd(){this.state._active&&(this.state._active=!1,this.compute(),this.emit())}bind(Z){Z("wheel","",this.wheel.bind(this))}}const wheelConfigResolver=coordinatesConfigResolver;class HoverEngine extends CoordinatesEngine{constructor(...Z){super(...Z),_defineProperty$4(this,"ingKey","hovering")}enter(Z){this.config.mouseOnly&&Z.pointerType!=="mouse"||(this.start(Z),this.computeValues(pointerValues(Z)),this.compute(Z),this.emit())}leave(Z){if(this.config.mouseOnly&&Z.pointerType!=="mouse")return;const _=this.state;if(!_._active)return;_._active=!1;const K=pointerValues(Z);_._movement=_._delta=V$2.sub(K,_._values),this.computeValues(K),this.compute(Z),_.delta=_.movement,this.emit()}bind(Z){Z("pointer","enter",this.enter.bind(this)),Z("pointer","leave",this.leave.bind(this))}}const hoverConfigResolver=_objectSpread2$1(_objectSpread2$1({},coordinatesConfigResolver),{},{mouseOnly:(X=!0)=>X}),EngineMap=new Map,ConfigResolverMap=new Map;function registerAction(X){EngineMap.set(X.key,X.engine),ConfigResolverMap.set(X.key,X.resolver)}const dragAction={key:"drag",engine:DragEngine,resolver:dragConfigResolver},hoverAction={key:"hover",engine:HoverEngine,resolver:hoverConfigResolver},moveAction={key:"move",engine:MoveEngine,resolver:moveConfigResolver},pinchAction={key:"pinch",engine:PinchEngine,resolver:pinchConfigResolver},scrollAction={key:"scroll",engine:ScrollEngine,resolver:scrollConfigResolver},wheelAction={key:"wheel",engine:WheelEngine,resolver:wheelConfigResolver};function _objectWithoutPropertiesLoose$3(X,Z){if(X==null)return{};var _={},K=Object.keys(X),te,ne;for(ne=0;ne<K.length;ne++)te=K[ne],!(Z.indexOf(te)>=0)&&(_[te]=X[te]);return _}function _objectWithoutProperties$3(X,Z){if(X==null)return{};var _=_objectWithoutPropertiesLoose$3(X,Z),K,te;if(Object.getOwnPropertySymbols){var ne=Object.getOwnPropertySymbols(X);for(te=0;te<ne.length;te++)K=ne[te],!(Z.indexOf(K)>=0)&&Object.prototype.propertyIsEnumerable.call(X,K)&&(_[K]=X[K])}return _}const sharedConfigResolver={target(X){if(X)return()=>"current"in X?X.current:X},enabled(X=!0){return X},window(X=SUPPORT.isBrowser?window:void 0){return X},eventOptions({passive:X=!0,capture:Z=!1}={}){return{passive:X,capture:Z}},transform(X){return X}},_excluded$c=["target","eventOptions","window","enabled","transform"];function resolveWith(X={},Z){const _={};for(const[K,te]of Object.entries(Z))switch(typeof te){case"function":_[K]=te.call(_,X[K],K,X);break;case"object":_[K]=resolveWith(X[K],te);break;case"boolean":te&&(_[K]=X[K]);break}return _}function parse$1(X,Z,_={}){const K=X,{target:te,eventOptions:ne,window:oe,enabled:ie,transform:se}=K,ae=_objectWithoutProperties$3(K,_excluded$c);if(_.shared=resolveWith({target:te,eventOptions:ne,window:oe,enabled:ie,transform:se},sharedConfigResolver),Z){const ge=ConfigResolverMap.get(Z);_[Z]=resolveWith(_objectSpread2$1({shared:_.shared},ae),ge)}else for(const ge in ae){const ce=ConfigResolverMap.get(ge);ce&&(_[ge]=resolveWith(_objectSpread2$1({shared:_.shared},ae[ge]),ce))}return _}class EventStore{constructor(Z,_){_defineProperty$4(this,"_listeners",new Set),this._ctrl=Z,this._gestureKey=_}add(Z,_,K,te,ne){const oe=this._listeners,ie=toDomEventType(_,K),se=this._gestureKey?this._ctrl.config[this._gestureKey].eventOptions:{},ae=_objectSpread2$1(_objectSpread2$1({},se),ne);Z.addEventListener(ie,te,ae);const ge=()=>{Z.removeEventListener(ie,te,ae),oe.delete(ge)};return oe.add(ge),ge}clean(){this._listeners.forEach(Z=>Z()),this._listeners.clear()}}class TimeoutStore{constructor(){_defineProperty$4(this,"_timeouts",new Map)}add(Z,_,K=140,...te){this.remove(Z),this._timeouts.set(Z,window.setTimeout(_,K,...te))}remove(Z){const _=this._timeouts.get(Z);_&&window.clearTimeout(_)}clean(){this._timeouts.forEach(Z=>void window.clearTimeout(Z)),this._timeouts.clear()}}let Controller$1=class{constructor(Z){_defineProperty$4(this,"gestures",new Set),_defineProperty$4(this,"_targetEventStore",new EventStore(this)),_defineProperty$4(this,"gestureEventStores",{}),_defineProperty$4(this,"gestureTimeoutStores",{}),_defineProperty$4(this,"handlers",{}),_defineProperty$4(this,"config",{}),_defineProperty$4(this,"pointerIds",new Set),_defineProperty$4(this,"touchIds",new Set),_defineProperty$4(this,"state",{shared:{shiftKey:!1,metaKey:!1,ctrlKey:!1,altKey:!1}}),resolveGestures(this,Z)}setEventIds(Z){if(isTouch(Z))return this.touchIds=new Set(touchIds(Z)),this.touchIds;if("pointerId"in Z)return Z.type==="pointerup"||Z.type==="pointercancel"?this.pointerIds.delete(Z.pointerId):Z.type==="pointerdown"&&this.pointerIds.add(Z.pointerId),this.pointerIds}applyHandlers(Z,_){this.handlers=Z,this.nativeHandlers=_}applyConfig(Z,_){this.config=parse$1(Z,_,this.config)}clean(){this._targetEventStore.clean();for(const Z of this.gestures)this.gestureEventStores[Z].clean(),this.gestureTimeoutStores[Z].clean()}effect(){return this.config.shared.target&&this.bind(),()=>this._targetEventStore.clean()}bind(...Z){const _=this.config.shared,K={};let te;if(!(_.target&&(te=_.target(),!te))){if(_.enabled){for(const oe of this.gestures){const ie=this.config[oe],se=bindToProps(K,ie.eventOptions,!!te);if(ie.enabled){const ae=EngineMap.get(oe);new ae(this,Z,oe).bind(se)}}const ne=bindToProps(K,_.eventOptions,!!te);for(const oe in this.nativeHandlers)ne(oe,"",ie=>this.nativeHandlers[oe](_objectSpread2$1(_objectSpread2$1({},this.state.shared),{},{event:ie,args:Z})),void 0,!0)}for(const ne in K)K[ne]=chain(...K[ne]);if(!te)return K;for(const ne in K){const{device:oe,capture:ie,passive:se}=parseProp(ne);this._targetEventStore.add(te,oe,"",K[ne],{capture:ie,passive:se})}}}};function setupGesture(X,Z){X.gestures.add(Z),X.gestureEventStores[Z]=new EventStore(X,Z),X.gestureTimeoutStores[Z]=new TimeoutStore}function resolveGestures(X,Z){Z.drag&&setupGesture(X,"drag"),Z.wheel&&setupGesture(X,"wheel"),Z.scroll&&setupGesture(X,"scroll"),Z.move&&setupGesture(X,"move"),Z.pinch&&setupGesture(X,"pinch"),Z.hover&&setupGesture(X,"hover")}const bindToProps=(X,Z,_)=>(K,te,ne,oe={},ie=!1)=>{var se,ae;const ge=(se=oe.capture)!==null&&se!==void 0?se:Z.capture,ce=(ae=oe.passive)!==null&&ae!==void 0?ae:Z.passive;let de=ie?K:toHandlerProp(K,te,ge);_&&ce&&(de+="Passive"),X[de]=X[de]||[],X[de].push(ne)},RE_NOT_NATIVE=/^on(Drag|Wheel|Scroll|Move|Pinch|Hover)/;function sortHandlers(X){const Z={},_={},K=new Set;for(let te in X)RE_NOT_NATIVE.test(te)?(K.add(RegExp.lastMatch),_[te]=X[te]):Z[te]=X[te];return[_,Z,K]}function registerGesture(X,Z,_,K,te,ne){if(!X.has(_)||!EngineMap.has(K))return;const oe=_+"Start",ie=_+"End",se=ae=>{let ge;return ae.first&&oe in Z&&Z[oe](ae),_ in Z&&(ge=Z[_](ae)),ae.last&&ie in Z&&Z[ie](ae),ge};te[K]=se,ne[K]=ne[K]||{}}function parseMergedHandlers(X,Z){const[_,K,te]=sortHandlers(X),ne={};return registerGesture(te,_,"onDrag","drag",ne,Z),registerGesture(te,_,"onWheel","wheel",ne,Z),registerGesture(te,_,"onScroll","scroll",ne,Z),registerGesture(te,_,"onPinch","pinch",ne,Z),registerGesture(te,_,"onMove","move",ne,Z),registerGesture(te,_,"onHover","hover",ne,Z),{handlers:ne,config:Z,nativeHandlers:K}}function useRecognizers(X,Z={},_,K){const te=React.useMemo(()=>new Controller$1(X),[]);if(te.applyHandlers(X,K),te.applyConfig(Z,_),React.useEffect(te.effect.bind(te)),React.useEffect(()=>te.clean.bind(te),[]),Z.target===void 0)return te.bind.bind(te)}function useDrag$1(X,Z){return registerAction(dragAction),useRecognizers({drag:X},Z||{},"drag")}function createUseGesture(X){return X.forEach(registerAction),function(_,K){const{handlers:te,nativeHandlers:ne,config:oe}=parseMergedHandlers(_,K||{});return useRecognizers(te,oe,void 0,ne)}}function useGesture(X,Z){return createUseGesture([dragAction,pinchAction,scrollAction,wheelAction,moveAction,hoverAction])(X,Z)}var updateQueue=makeQueue(),raf=X=>schedule(X,updateQueue),writeQueue=makeQueue();raf.write=X=>schedule(X,writeQueue);var onStartQueue=makeQueue();raf.onStart=X=>schedule(X,onStartQueue);var onFrameQueue=makeQueue();raf.onFrame=X=>schedule(X,onFrameQueue);var onFinishQueue=makeQueue();raf.onFinish=X=>schedule(X,onFinishQueue);var timeouts=[];raf.setTimeout=(X,Z)=>{const _=raf.now()+Z,K=()=>{const ne=timeouts.findIndex(oe=>oe.cancel==K);~ne&&timeouts.splice(ne,1),pendingCount-=~ne?1:0},te={time:_,handler:X,cancel:K};return timeouts.splice(findTimeout(_),0,te),pendingCount+=1,start(),te};var findTimeout=X=>~(~timeouts.findIndex(Z=>Z.time>X)||~timeouts.length);raf.cancel=X=>{onStartQueue.delete(X),onFrameQueue.delete(X),onFinishQueue.delete(X),updateQueue.delete(X),writeQueue.delete(X)};raf.sync=X=>{sync=!0,raf.batchedUpdates(X),sync=!1};raf.throttle=X=>{let Z;function _(){try{X(...Z)}finally{Z=null}}function K(...te){Z=te,raf.onStart(_)}return K.handler=X,K.cancel=()=>{onStartQueue.delete(_),Z=null},K};var nativeRaf=typeof window<"u"?window.requestAnimationFrame:()=>{};raf.use=X=>nativeRaf=X;raf.now=typeof performance<"u"?()=>performance.now():Date.now;raf.batchedUpdates=X=>X();raf.catch=console.error;raf.frameLoop="always";raf.advance=()=>{raf.frameLoop!=="demand"?console.warn("Cannot call the manual advancement of rafz whilst frameLoop is not set as demand"):update()};var ts=-1,pendingCount=0,sync=!1;function schedule(X,Z){sync?(Z.delete(X),X(0)):(Z.add(X),start())}function start(){ts<0&&(ts=0,raf.frameLoop!=="demand"&&nativeRaf(loop))}function stop(){ts=-1}function loop(){~ts&&(nativeRaf(loop),raf.batchedUpdates(update))}function update(){const X=ts;ts=raf.now();const Z=findTimeout(ts);if(Z&&(eachSafely(timeouts.splice(0,Z),_=>_.handler()),pendingCount-=Z),!pendingCount){stop();return}onStartQueue.flush(),updateQueue.flush(X?Math.min(64,ts-X):16.667),onFrameQueue.flush(),writeQueue.flush(),onFinishQueue.flush()}function makeQueue(){let X=new Set,Z=X;return{add(_){pendingCount+=Z==X&&!X.has(_)?1:0,X.add(_)},delete(_){return pendingCount-=Z==X&&X.has(_)?1:0,X.delete(_)},flush(_){Z.size&&(X=new Set,pendingCount-=Z.size,eachSafely(Z,K=>K(_)&&X.add(K)),pendingCount+=X.size,Z=X)}}}function eachSafely(X,Z){X.forEach(_=>{try{Z(_)}catch(K){raf.catch(K)}})}var __defProp=Object.defineProperty,__export=(X,Z)=>{for(var _ in Z)__defProp(X,_,{get:Z[_],enumerable:!0})},globals_exports={};__export(globals_exports,{assign:()=>assign$2,colors:()=>colors,createStringInterpolator:()=>createStringInterpolator,skipAnimation:()=>skipAnimation,to:()=>to,willAdvance:()=>willAdvance});function noop$1(){}var defineHidden=(X,Z,_)=>Object.defineProperty(X,Z,{value:_,writable:!0,configurable:!0}),is={arr:Array.isArray,obj:X=>!!X&&X.constructor.name==="Object",fun:X=>typeof X=="function",str:X=>typeof X=="string",num:X=>typeof X=="number",und:X=>X===void 0};function isEqual(X,Z){if(is.arr(X)){if(!is.arr(Z)||X.length!==Z.length)return!1;for(let _=0;_<X.length;_++)if(X[_]!==Z[_])return!1;return!0}return X===Z}var each=(X,Z)=>X.forEach(Z);function eachProp(X,Z,_){if(is.arr(X)){for(let K=0;K<X.length;K++)Z.call(_,X[K],`${K}`);return}for(const K in X)X.hasOwnProperty(K)&&Z.call(_,X[K],K)}var toArray=X=>is.und(X)?[]:is.arr(X)?X:[X];function flush(X,Z){if(X.size){const _=Array.from(X);X.clear(),each(_,Z)}}var flushCalls=(X,...Z)=>flush(X,_=>_(...Z)),isSSR$1=()=>typeof window>"u"||!window.navigator||/ServerSideRendering|^Deno\//.test(window.navigator.userAgent),createStringInterpolator,to,colors=null,skipAnimation=!1,willAdvance=noop$1,assign$2=X=>{X.to&&(to=X.to),X.now&&(raf.now=X.now),X.colors!==void 0&&(colors=X.colors),X.skipAnimation!=null&&(skipAnimation=X.skipAnimation),X.createStringInterpolator&&(createStringInterpolator=X.createStringInterpolator),X.requestAnimationFrame&&raf.use(X.requestAnimationFrame),X.batchedUpdates&&(raf.batchedUpdates=X.batchedUpdates),X.willAdvance&&(willAdvance=X.willAdvance),X.frameLoop&&(raf.frameLoop=X.frameLoop)},startQueue=new Set,currentFrame=[],prevFrame=[],priority=0,frameLoop={get idle(){return!startQueue.size&&!currentFrame.length},start(X){priority>X.priority?(startQueue.add(X),raf.onStart(flushStartQueue)):(startSafely(X),raf(advance))},advance,sort(X){if(priority)raf.onFrame(()=>frameLoop.sort(X));else{const Z=currentFrame.indexOf(X);~Z&&(currentFrame.splice(Z,1),startUnsafely(X))}},clear(){currentFrame=[],startQueue.clear()}};function flushStartQueue(){startQueue.forEach(startSafely),startQueue.clear(),raf(advance)}function startSafely(X){currentFrame.includes(X)||startUnsafely(X)}function startUnsafely(X){currentFrame.splice(findIndex(currentFrame,Z=>Z.priority>X.priority),0,X)}function advance(X){const Z=prevFrame;for(let _=0;_<currentFrame.length;_++){const K=currentFrame[_];priority=K.priority,K.idle||(willAdvance(K),K.advance(X),K.idle||Z.push(K))}return priority=0,prevFrame=currentFrame,prevFrame.length=0,currentFrame=Z,currentFrame.length>0}function findIndex(X,Z){const _=X.findIndex(Z);return _<0?X.length:_}var clamp$1=(X,Z,_)=>Math.min(Math.max(_,X),Z),colors2={transparent:0,aliceblue:4042850303,antiquewhite:4209760255,aqua:16777215,aquamarine:2147472639,azure:4043309055,beige:4126530815,bisque:4293182719,black:255,blanchedalmond:4293643775,blue:65535,blueviolet:2318131967,brown:2771004159,burlywood:3736635391,burntsienna:3934150143,cadetblue:1604231423,chartreuse:2147418367,chocolate:3530104575,coral:4286533887,cornflowerblue:1687547391,cornsilk:4294499583,crimson:3692313855,cyan:16777215,darkblue:35839,darkcyan:9145343,darkgoldenrod:3095792639,darkgray:2846468607,darkgreen:6553855,darkgrey:2846468607,darkkhaki:3182914559,darkmagenta:2332068863,darkolivegreen:1433087999,darkorange:4287365375,darkorchid:2570243327,darkred:2332033279,darksalmon:3918953215,darkseagreen:2411499519,darkslateblue:1211993087,darkslategray:793726975,darkslategrey:793726975,darkturquoise:13554175,darkviolet:2483082239,deeppink:4279538687,deepskyblue:12582911,dimgray:1768516095,dimgrey:1768516095,dodgerblue:512819199,firebrick:2988581631,floralwhite:4294635775,forestgreen:579543807,fuchsia:4278255615,gainsboro:3705462015,ghostwhite:4177068031,gold:4292280575,goldenrod:3668254975,gray:2155905279,green:8388863,greenyellow:2919182335,grey:2155905279,honeydew:4043305215,hotpink:4285117695,indianred:3445382399,indigo:1258324735,ivory:4294963455,khaki:4041641215,lavender:3873897215,lavenderblush:4293981695,lawngreen:2096890111,lemonchiffon:4294626815,lightblue:2916673279,lightcoral:4034953471,lightcyan:3774873599,lightgoldenrodyellow:4210742015,lightgray:3553874943,lightgreen:2431553791,lightgrey:3553874943,lightpink:4290167295,lightsalmon:4288707327,lightseagreen:548580095,lightskyblue:2278488831,lightslategray:2005441023,lightslategrey:2005441023,lightsteelblue:2965692159,lightyellow:4294959359,lime:16711935,limegreen:852308735,linen:4210091775,magenta:4278255615,maroon:2147483903,mediumaquamarine:1724754687,mediumblue:52735,mediumorchid:3126187007,mediumpurple:2473647103,mediumseagreen:1018393087,mediumslateblue:2070474495,mediumspringgreen:16423679,mediumturquoise:1221709055,mediumvioletred:3340076543,midnightblue:421097727,mintcream:4127193855,mistyrose:4293190143,moccasin:4293178879,navajowhite:4292783615,navy:33023,oldlace:4260751103,olive:2155872511,olivedrab:1804477439,orange:4289003775,orangered:4282712319,orchid:3664828159,palegoldenrod:4008225535,palegreen:2566625535,paleturquoise:2951671551,palevioletred:3681588223,papayawhip:4293907967,peachpuff:4292524543,peru:3448061951,pink:4290825215,plum:3718307327,powderblue:2967529215,purple:2147516671,rebeccapurple:1714657791,red:4278190335,rosybrown:3163525119,royalblue:1097458175,saddlebrown:2336560127,salmon:4202722047,sandybrown:4104413439,seagreen:780883967,seashell:4294307583,sienna:2689740287,silver:3233857791,skyblue:2278484991,slateblue:1784335871,slategray:1887473919,slategrey:1887473919,snow:4294638335,springgreen:16744447,steelblue:1182971135,tan:3535047935,teal:8421631,thistle:3636451583,tomato:4284696575,turquoise:1088475391,violet:4001558271,wheat:4125012991,white:4294967295,whitesmoke:4126537215,yellow:4294902015,yellowgreen:2597139199},NUMBER="[-+]?\\d*\\.?\\d+",PERCENTAGE=NUMBER+"%";function call(...X){return"\\(\\s*("+X.join(")\\s*,\\s*(")+")\\s*\\)"}var rgb=new RegExp("rgb"+call(NUMBER,NUMBER,NUMBER)),rgba=new RegExp("rgba"+call(NUMBER,NUMBER,NUMBER,NUMBER)),hsl=new RegExp("hsl"+call(NUMBER,PERCENTAGE,PERCENTAGE)),hsla=new RegExp("hsla"+call(NUMBER,PERCENTAGE,PERCENTAGE,NUMBER)),hex3=/^#([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex4=/^#([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex6=/^#([0-9a-fA-F]{6})$/,hex8=/^#([0-9a-fA-F]{8})$/;function normalizeColor(X){let Z;return typeof X=="number"?X>>>0===X&&X>=0&&X<=4294967295?X:null:(Z=hex6.exec(X))?parseInt(Z[1]+"ff",16)>>>0:colors&&colors[X]!==void 0?colors[X]:(Z=rgb.exec(X))?(parse255(Z[1])<<24|parse255(Z[2])<<16|parse255(Z[3])<<8|255)>>>0:(Z=rgba.exec(X))?(parse255(Z[1])<<24|parse255(Z[2])<<16|parse255(Z[3])<<8|parse1(Z[4]))>>>0:(Z=hex3.exec(X))?parseInt(Z[1]+Z[1]+Z[2]+Z[2]+Z[3]+Z[3]+"ff",16)>>>0:(Z=hex8.exec(X))?parseInt(Z[1],16)>>>0:(Z=hex4.exec(X))?parseInt(Z[1]+Z[1]+Z[2]+Z[2]+Z[3]+Z[3]+Z[4]+Z[4],16)>>>0:(Z=hsl.exec(X))?(hslToRgb(parse360(Z[1]),parsePercentage(Z[2]),parsePercentage(Z[3]))|255)>>>0:(Z=hsla.exec(X))?(hslToRgb(parse360(Z[1]),parsePercentage(Z[2]),parsePercentage(Z[3]))|parse1(Z[4]))>>>0:null}function hue2rgb(X,Z,_){return _<0&&(_+=1),_>1&&(_-=1),_<1/6?X+(Z-X)*6*_:_<1/2?Z:_<2/3?X+(Z-X)*(2/3-_)*6:X}function hslToRgb(X,Z,_){const K=_<.5?_*(1+Z):_+Z-_*Z,te=2*_-K,ne=hue2rgb(te,K,X+1/3),oe=hue2rgb(te,K,X),ie=hue2rgb(te,K,X-1/3);return Math.round(ne*255)<<24|Math.round(oe*255)<<16|Math.round(ie*255)<<8}function parse255(X){const Z=parseInt(X,10);return Z<0?0:Z>255?255:Z}function parse360(X){return(parseFloat(X)%360+360)%360/360}function parse1(X){const Z=parseFloat(X);return Z<0?0:Z>1?255:Math.round(Z*255)}function parsePercentage(X){const Z=parseFloat(X);return Z<0?0:Z>100?1:Z/100}function colorToRgba(X){let Z=normalizeColor(X);if(Z===null)return X;Z=Z||0;const _=(Z&4278190080)>>>24,K=(Z&16711680)>>>16,te=(Z&65280)>>>8,ne=(Z&255)/255;return`rgba(${_}, ${K}, ${te}, ${ne})`}var createInterpolator=(X,Z,_)=>{if(is.fun(X))return X;if(is.arr(X))return createInterpolator({range:X,output:Z,extrapolate:_});if(is.str(X.output[0]))return createStringInterpolator(X);const K=X,te=K.output,ne=K.range||[0,1],oe=K.extrapolateLeft||K.extrapolate||"extend",ie=K.extrapolateRight||K.extrapolate||"extend",se=K.easing||(ae=>ae);return ae=>{const ge=findRange(ae,ne);return interpolate(ae,ne[ge],ne[ge+1],te[ge],te[ge+1],se,oe,ie,K.map)}};function interpolate(X,Z,_,K,te,ne,oe,ie,se){let ae=se?se(X):X;if(ae<Z){if(oe==="identity")return ae;oe==="clamp"&&(ae=Z)}if(ae>_){if(ie==="identity")return ae;ie==="clamp"&&(ae=_)}return K===te?K:Z===_?X<=Z?K:te:(Z===-1/0?ae=-ae:_===1/0?ae=ae-Z:ae=(ae-Z)/(_-Z),ae=ne(ae),K===-1/0?ae=-ae:te===1/0?ae=ae+K:ae=ae*(te-K)+K,ae)}function findRange(X,Z){for(var _=1;_<Z.length-1&&!(Z[_]>=X);++_);return _-1}var steps=(X,Z="end")=>_=>{_=Z==="end"?Math.min(_,.999):Math.max(_,.001);const K=_*X,te=Z==="end"?Math.floor(K):Math.ceil(K);return clamp$1(0,1,te/X)},c1=1.70158,c2=c1*1.525,c3=c1+1,c4=2*Math.PI/3,c5=2*Math.PI/4.5,bounceOut=X=>X<1/2.75?7.5625*X*X:X<2/2.75?7.5625*(X-=1.5/2.75)*X+.75:X<2.5/2.75?7.5625*(X-=2.25/2.75)*X+.9375:7.5625*(X-=2.625/2.75)*X+.984375,easings={linear:X=>X,easeInQuad:X=>X*X,easeOutQuad:X=>1-(1-X)*(1-X),easeInOutQuad:X=>X<.5?2*X*X:1-Math.pow(-2*X+2,2)/2,easeInCubic:X=>X*X*X,easeOutCubic:X=>1-Math.pow(1-X,3),easeInOutCubic:X=>X<.5?4*X*X*X:1-Math.pow(-2*X+2,3)/2,easeInQuart:X=>X*X*X*X,easeOutQuart:X=>1-Math.pow(1-X,4),easeInOutQuart:X=>X<.5?8*X*X*X*X:1-Math.pow(-2*X+2,4)/2,easeInQuint:X=>X*X*X*X*X,easeOutQuint:X=>1-Math.pow(1-X,5),easeInOutQuint:X=>X<.5?16*X*X*X*X*X:1-Math.pow(-2*X+2,5)/2,easeInSine:X=>1-Math.cos(X*Math.PI/2),easeOutSine:X=>Math.sin(X*Math.PI/2),easeInOutSine:X=>-(Math.cos(Math.PI*X)-1)/2,easeInExpo:X=>X===0?0:Math.pow(2,10*X-10),easeOutExpo:X=>X===1?1:1-Math.pow(2,-10*X),easeInOutExpo:X=>X===0?0:X===1?1:X<.5?Math.pow(2,20*X-10)/2:(2-Math.pow(2,-20*X+10))/2,easeInCirc:X=>1-Math.sqrt(1-Math.pow(X,2)),easeOutCirc:X=>Math.sqrt(1-Math.pow(X-1,2)),easeInOutCirc:X=>X<.5?(1-Math.sqrt(1-Math.pow(2*X,2)))/2:(Math.sqrt(1-Math.pow(-2*X+2,2))+1)/2,easeInBack:X=>c3*X*X*X-c1*X*X,easeOutBack:X=>1+c3*Math.pow(X-1,3)+c1*Math.pow(X-1,2),easeInOutBack:X=>X<.5?Math.pow(2*X,2)*((c2+1)*2*X-c2)/2:(Math.pow(2*X-2,2)*((c2+1)*(X*2-2)+c2)+2)/2,easeInElastic:X=>X===0?0:X===1?1:-Math.pow(2,10*X-10)*Math.sin((X*10-10.75)*c4),easeOutElastic:X=>X===0?0:X===1?1:Math.pow(2,-10*X)*Math.sin((X*10-.75)*c4)+1,easeInOutElastic:X=>X===0?0:X===1?1:X<.5?-(Math.pow(2,20*X-10)*Math.sin((20*X-11.125)*c5))/2:Math.pow(2,-20*X+10)*Math.sin((20*X-11.125)*c5)/2+1,easeInBounce:X=>1-bounceOut(1-X),easeOutBounce:bounceOut,easeInOutBounce:X=>X<.5?(1-bounceOut(1-2*X))/2:(1+bounceOut(2*X-1))/2,steps},$get=Symbol.for("FluidValue.get"),$observers=Symbol.for("FluidValue.observers"),hasFluidValue=X=>!!(X&&X[$get]),getFluidValue=X=>X&&X[$get]?X[$get]():X,getFluidObservers=X=>X[$observers]||null;function callFluidObserver(X,Z){X.eventObserved?X.eventObserved(Z):X(Z)}function callFluidObservers(X,Z){const _=X[$observers];_&&_.forEach(K=>{callFluidObserver(K,Z)})}var FluidValue=class{constructor(X){if(!X&&!(X=this.get))throw Error("Unknown getter");setFluidGetter(this,X)}},setFluidGetter=(X,Z)=>setHidden(X,$get,Z);function addFluidObserver(X,Z){if(X[$get]){let _=X[$observers];_||setHidden(X,$observers,_=new Set),_.has(Z)||(_.add(Z),X.observerAdded&&X.observerAdded(_.size,Z))}return Z}function removeFluidObserver(X,Z){const _=X[$observers];if(_&&_.has(Z)){const K=_.size-1;K?_.delete(Z):X[$observers]=null,X.observerRemoved&&X.observerRemoved(K,Z)}}var setHidden=(X,Z,_)=>Object.defineProperty(X,Z,{value:_,writable:!0,configurable:!0}),numberRegex=/[+\-]?(?:0|[1-9]\d*)(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,colorRegex=/(#(?:[0-9a-f]{2}){2,4}|(#[0-9a-f]{3})|(rgb|hsl)a?\((-?\d+%?[,\s]+){2,3}\s*[\d\.]+%?\))/gi,unitRegex=new RegExp(`(${numberRegex.source})(%|[a-z]+)`,"i"),rgbaRegex=/rgba\(([0-9\.-]+), ([0-9\.-]+), ([0-9\.-]+), ([0-9\.-]+)\)/gi,cssVariableRegex=/var\((--[a-zA-Z0-9-_]+),? ?([a-zA-Z0-9 ()%#.,-]+)?\)/,variableToRgba=X=>{const[Z,_]=parseCSSVariable(X);if(!Z||isSSR$1())return X;const K=window.getComputedStyle(document.documentElement).getPropertyValue(Z);if(K)return K.trim();if(_&&_.startsWith("--")){const te=window.getComputedStyle(document.documentElement).getPropertyValue(_);return te||X}else{if(_&&cssVariableRegex.test(_))return variableToRgba(_);if(_)return _}return X},parseCSSVariable=X=>{const Z=cssVariableRegex.exec(X);if(!Z)return[,];const[,_,K]=Z;return[_,K]},namedColorRegex,rgbaRound=(X,Z,_,K,te)=>`rgba(${Math.round(Z)}, ${Math.round(_)}, ${Math.round(K)}, ${te})`,createStringInterpolator2=X=>{namedColorRegex||(namedColorRegex=colors?new RegExp(`(${Object.keys(colors).join("|")})(?!\\w)`,"g"):/^\b$/);const Z=X.output.map(ne=>getFluidValue(ne).replace(cssVariableRegex,variableToRgba).replace(colorRegex,colorToRgba).replace(namedColorRegex,colorToRgba)),_=Z.map(ne=>ne.match(numberRegex).map(Number)),te=_[0].map((ne,oe)=>_.map(ie=>{if(!(oe in ie))throw Error('The arity of each "output" value must be equal');return ie[oe]})).map(ne=>createInterpolator({...X,output:ne}));return ne=>{var se;const oe=!unitRegex.test(Z[0])&&((se=Z.find(ae=>unitRegex.test(ae)))==null?void 0:se.replace(numberRegex,""));let ie=0;return Z[0].replace(numberRegex,()=>`${te[ie++](ne)}${oe||""}`).replace(rgbaRegex,rgbaRound)}},prefix="react-spring: ",once$1=X=>{const Z=X;let _=!1;if(typeof Z!="function")throw new TypeError(`${prefix}once requires a function parameter`);return(...K)=>{_||(Z(...K),_=!0)}},warnInterpolate=once$1(console.warn);function deprecateInterpolate(){warnInterpolate(`${prefix}The "interpolate" function is deprecated in v9 (use "to" instead)`)}var warnDirectCall=once$1(console.warn);function deprecateDirectCall(){warnDirectCall(`${prefix}Directly calling start instead of using the api object is deprecated in v9 (use ".start" instead), this will be removed in later 0.X.0 versions`)}function isAnimatedString(X){return is.str(X)&&(X[0]=="#"||/\d/.test(X)||!isSSR$1()&&cssVariableRegex.test(X)||X in(colors||{}))}var useIsomorphicLayoutEffect$1=isSSR$1()?reactExports.useEffect:reactExports.useLayoutEffect,useIsMounted=()=>{const X=reactExports.useRef(!1);return useIsomorphicLayoutEffect$1(()=>(X.current=!0,()=>{X.current=!1}),[]),X};function useForceUpdate(){const X=reactExports.useState()[1],Z=useIsMounted();return()=>{Z.current&&X(Math.random())}}function useMemoOne(X,Z){const[_]=reactExports.useState(()=>({inputs:Z,result:X()})),K=reactExports.useRef(),te=K.current;let ne=te;return ne?ne.inputs&&areInputsEqual(Z,ne.inputs)||(ne={inputs:Z,result:X()}):ne=_,reactExports.useEffect(()=>{K.current=ne,te==_&&(_.inputs=_.result=void 0)},[ne]),ne.result}function areInputsEqual(X,Z){if(X.length!==Z.length)return!1;for(let _=0;_<X.length;_++)if(X[_]!==Z[_])return!1;return!0}var useOnce=X=>reactExports.useEffect(X,emptyDeps),emptyDeps=[];function usePrev(X){const Z=reactExports.useRef();return reactExports.useEffect(()=>{Z.current=X}),Z.current}var $node=Symbol.for("Animated:node"),isAnimated=X=>!!X&&X[$node]===X,getAnimated=X=>X&&X[$node],setAnimated=(X,Z)=>defineHidden(X,$node,Z),getPayload=X=>X&&X[$node]&&X[$node].getPayload(),Animated=class{constructor(){setAnimated(this,this)}getPayload(){return this.payload||[]}},AnimatedValue=class extends Animated{constructor(X){super(),this._value=X,this.done=!0,this.durationProgress=0,is.num(this._value)&&(this.lastPosition=this._value)}static create(X){return new AnimatedValue(X)}getPayload(){return[this]}getValue(){return this._value}setValue(X,Z){return is.num(X)&&(this.lastPosition=X,Z&&(X=Math.round(X/Z)*Z,this.done&&(this.lastPosition=X))),this._value===X?!1:(this._value=X,!0)}reset(){const{done:X}=this;this.done=!1,is.num(this._value)&&(this.elapsedTime=0,this.durationProgress=0,this.lastPosition=this._value,X&&(this.lastVelocity=null),this.v0=null)}},AnimatedString=class extends AnimatedValue{constructor(X){super(0),this._string=null,this._toString=createInterpolator({output:[X,X]})}static create(X){return new AnimatedString(X)}getValue(){const X=this._string;return X??(this._string=this._toString(this._value))}setValue(X){if(is.str(X)){if(X==this._string)return!1;this._string=X,this._value=1}else if(super.setValue(X))this._string=null;else return!1;return!0}reset(X){X&&(this._toString=createInterpolator({output:[this.getValue(),X]})),this._value=0,super.reset()}},TreeContext={dependencies:null},AnimatedObject=class extends Animated{constructor(X){super(),this.source=X,this.setValue(X)}getValue(X){const Z={};return eachProp(this.source,(_,K)=>{isAnimated(_)?Z[K]=_.getValue(X):hasFluidValue(_)?Z[K]=getFluidValue(_):X||(Z[K]=_)}),Z}setValue(X){this.source=X,this.payload=this._makePayload(X)}reset(){this.payload&&each(this.payload,X=>X.reset())}_makePayload(X){if(X){const Z=new Set;return eachProp(X,this._addToPayload,Z),Array.from(Z)}}_addToPayload(X){TreeContext.dependencies&&hasFluidValue(X)&&TreeContext.dependencies.add(X);const Z=getPayload(X);Z&&each(Z,_=>this.add(_))}},AnimatedArray=class extends AnimatedObject{constructor(X){super(X)}static create(X){return new AnimatedArray(X)}getValue(){return this.source.map(X=>X.getValue())}setValue(X){const Z=this.getPayload();return X.length==Z.length?Z.map((_,K)=>_.setValue(X[K])).some(Boolean):(super.setValue(X.map(makeAnimated)),!0)}};function makeAnimated(X){return(isAnimatedString(X)?AnimatedString:AnimatedValue).create(X)}function getAnimatedType(X){const Z=getAnimated(X);return Z?Z.constructor:is.arr(X)?AnimatedArray:isAnimatedString(X)?AnimatedString:AnimatedValue}var withAnimated=(X,Z)=>{const _=!is.fun(X)||X.prototype&&X.prototype.isReactComponent;return reactExports.forwardRef((K,te)=>{const ne=reactExports.useRef(null),oe=_&&reactExports.useCallback(fe=>{ne.current=updateRef(te,fe)},[te]),[ie,se]=getAnimatedState(K,Z),ae=useForceUpdate(),ge=()=>{const fe=ne.current;if(_&&!fe)return;(fe?Z.applyAnimatedValues(fe,ie.getValue(!0)):!1)===!1&&ae()},ce=new PropsObserver(ge,se),de=reactExports.useRef();useIsomorphicLayoutEffect$1(()=>(de.current=ce,each(se,fe=>addFluidObserver(fe,ce)),()=>{de.current&&(each(de.current.deps,fe=>removeFluidObserver(fe,de.current)),raf.cancel(de.current.update))})),reactExports.useEffect(ge,[]),useOnce(()=>()=>{const fe=de.current;each(fe.deps,be=>removeFluidObserver(be,fe))});const pe=Z.getComponentProps(ie.getValue());return reactExports.createElement(X,{...pe,ref:oe})})},PropsObserver=class{constructor(X,Z){this.update=X,this.deps=Z}eventObserved(X){X.type=="change"&&raf.write(this.update)}};function getAnimatedState(X,Z){const _=new Set;return TreeContext.dependencies=_,X.style&&(X={...X,style:Z.createAnimatedStyle(X.style)}),X=new AnimatedObject(X),TreeContext.dependencies=null,[X,_]}function updateRef(X,Z){return X&&(is.fun(X)?X(Z):X.current=Z),Z}var cacheKey=Symbol.for("AnimatedComponent"),createHost=(X,{applyAnimatedValues:Z=()=>!1,createAnimatedStyle:_=te=>new AnimatedObject(te),getComponentProps:K=te=>te}={})=>{const te={applyAnimatedValues:Z,createAnimatedStyle:_,getComponentProps:K},ne=oe=>{const ie=getDisplayName(oe)||"Anonymous";return is.str(oe)?oe=ne[oe]||(ne[oe]=withAnimated(oe,te)):oe=oe[cacheKey]||(oe[cacheKey]=withAnimated(oe,te)),oe.displayName=`Animated(${ie})`,oe};return eachProp(X,(oe,ie)=>{is.arr(X)&&(ie=getDisplayName(oe)),ne[ie]=ne(oe)}),{animated:ne}},getDisplayName=X=>is.str(X)?X:X&&is.str(X.displayName)?X.displayName:is.fun(X)&&X.name||null;function callProp(X,...Z){return is.fun(X)?X(...Z):X}var matchProp=(X,Z)=>X===!0||!!(Z&&X&&(is.fun(X)?X(Z):toArray(X).includes(Z))),resolveProp=(X,Z)=>is.obj(X)?Z&&X[Z]:X,getDefaultProp=(X,Z)=>X.default===!0?X[Z]:X.default?X.default[Z]:void 0,noopTransform=X=>X,getDefaultProps=(X,Z=noopTransform)=>{let _=DEFAULT_PROPS;X.default&&X.default!==!0&&(X=X.default,_=Object.keys(X));const K={};for(const te of _){const ne=Z(X[te],te);is.und(ne)||(K[te]=ne)}return K},DEFAULT_PROPS=["config","onProps","onStart","onChange","onPause","onResume","onRest"],RESERVED_PROPS={config:1,from:1,to:1,ref:1,loop:1,reset:1,pause:1,cancel:1,reverse:1,immediate:1,default:1,delay:1,onProps:1,onStart:1,onChange:1,onPause:1,onResume:1,onRest:1,onResolve:1,items:1,trail:1,sort:1,expires:1,initial:1,enter:1,update:1,leave:1,children:1,onDestroyed:1,keys:1,callId:1,parentId:1};function getForwardProps(X){const Z={};let _=0;if(eachProp(X,(K,te)=>{RESERVED_PROPS[te]||(Z[te]=K,_++)}),_)return Z}function inferTo(X){const Z=getForwardProps(X);if(Z){const _={to:Z};return eachProp(X,(K,te)=>te in Z||(_[te]=K)),_}return{...X}}function computeGoal(X){return X=getFluidValue(X),is.arr(X)?X.map(computeGoal):isAnimatedString(X)?globals_exports.createStringInterpolator({range:[0,1],output:[X,X]})(1):X}function hasProps(X){for(const Z in X)return!0;return!1}function isAsyncTo(X){return is.fun(X)||is.arr(X)&&is.obj(X[0])}function detachRefs(X,Z){var _;(_=X.ref)==null||_.delete(X),Z==null||Z.delete(X)}function replaceRef(X,Z){var _;Z&&X.ref!==Z&&((_=X.ref)==null||_.delete(X),Z.add(X),X.ref=Z)}var config={default:{tension:170,friction:26},gentle:{tension:120,friction:14},wobbly:{tension:180,friction:12},stiff:{tension:210,friction:20},slow:{tension:280,friction:60},molasses:{tension:280,friction:120}},defaults={...config.default,mass:1,damping:1,easing:easings.linear,clamp:!1},AnimationConfig=class{constructor(){this.velocity=0,Object.assign(this,defaults)}};function mergeConfig(X,Z,_){_&&(_={..._},sanitizeConfig(_,Z),Z={..._,...Z}),sanitizeConfig(X,Z),Object.assign(X,Z);for(const oe in defaults)X[oe]==null&&(X[oe]=defaults[oe]);let{frequency:K,damping:te}=X;const{mass:ne}=X;return is.und(K)||(K<.01&&(K=.01),te<0&&(te=0),X.tension=Math.pow(2*Math.PI/K,2)*ne,X.friction=4*Math.PI*te*ne/K),X}function sanitizeConfig(X,Z){if(!is.und(Z.decay))X.duration=void 0;else{const _=!is.und(Z.tension)||!is.und(Z.friction);(_||!is.und(Z.frequency)||!is.und(Z.damping)||!is.und(Z.mass))&&(X.duration=void 0,X.decay=void 0),_&&(X.frequency=void 0)}}var emptyArray=[],Animation=class{constructor(){this.changed=!1,this.values=emptyArray,this.toValues=null,this.fromValues=emptyArray,this.config=new AnimationConfig,this.immediate=!1}};function scheduleProps(X,{key:Z,props:_,defaultProps:K,state:te,actions:ne}){return new Promise((oe,ie)=>{let se,ae,ge=matchProp(_.cancel??(K==null?void 0:K.cancel),Z);if(ge)pe();else{is.und(_.pause)||(te.paused=matchProp(_.pause,Z));let fe=K==null?void 0:K.pause;fe!==!0&&(fe=te.paused||matchProp(fe,Z)),se=callProp(_.delay||0,Z),fe?(te.resumeQueue.add(de),ne.pause()):(ne.resume(),de())}function ce(){te.resumeQueue.add(de),te.timeouts.delete(ae),ae.cancel(),se=ae.time-raf.now()}function de(){se>0&&!globals_exports.skipAnimation?(te.delayed=!0,ae=raf.setTimeout(pe,se),te.pauseQueue.add(ce),te.timeouts.add(ae)):pe()}function pe(){te.delayed&&(te.delayed=!1),te.pauseQueue.delete(ce),te.timeouts.delete(ae),X<=(te.cancelId||0)&&(ge=!0);try{ne.start({..._,callId:X,cancel:ge},oe)}catch(fe){ie(fe)}}})}var getCombinedResult=(X,Z)=>Z.length==1?Z[0]:Z.some(_=>_.cancelled)?getCancelledResult(X.get()):Z.every(_=>_.noop)?getNoopResult(X.get()):getFinishedResult(X.get(),Z.every(_=>_.finished)),getNoopResult=X=>({value:X,noop:!0,finished:!0,cancelled:!1}),getFinishedResult=(X,Z,_=!1)=>({value:X,finished:Z,cancelled:_}),getCancelledResult=X=>({value:X,cancelled:!0,finished:!1});function runAsync(X,Z,_,K){const{callId:te,parentId:ne,onRest:oe}=Z,{asyncTo:ie,promise:se}=_;return!ne&&X===ie&&!Z.reset?se:_.promise=(async()=>{_.asyncId=te,_.asyncTo=X;const ae=getDefaultProps(Z,(me,ye)=>ye==="onRest"?void 0:me);let ge,ce;const de=new Promise((me,ye)=>(ge=me,ce=ye)),pe=me=>{const ye=te<=(_.cancelId||0)&&getCancelledResult(K)||te!==_.asyncId&&getFinishedResult(K,!1);if(ye)throw me.result=ye,ce(me),me},fe=(me,ye)=>{const ve=new BailSignal,Be=new SkipAnimationSignal;return(async()=>{if(globals_exports.skipAnimation)throw stopAsync(_),Be.result=getFinishedResult(K,!1),ce(Be),Be;pe(ve);const Re=is.obj(me)?{...me}:{...ye,to:me};Re.parentId=te,eachProp(ae,(We,Ze)=>{is.und(Re[Ze])&&(Re[Ze]=We)});const Ee=await K.start(Re);return pe(ve),_.paused&&await new Promise(We=>{_.resumeQueue.add(We)}),Ee})()};let be;if(globals_exports.skipAnimation)return stopAsync(_),getFinishedResult(K,!1);try{let me;is.arr(X)?me=(async ye=>{for(const ve of ye)await fe(ve)})(X):me=Promise.resolve(X(fe,K.stop.bind(K))),await Promise.all([me.then(ge),de]),be=getFinishedResult(K.get(),!0,!1)}catch(me){if(me instanceof BailSignal)be=me.result;else if(me instanceof SkipAnimationSignal)be=me.result;else throw me}finally{te==_.asyncId&&(_.asyncId=ne,_.asyncTo=ne?ie:void 0,_.promise=ne?se:void 0)}return is.fun(oe)&&raf.batchedUpdates(()=>{oe(be,K,K.item)}),be})()}function stopAsync(X,Z){flush(X.timeouts,_=>_.cancel()),X.pauseQueue.clear(),X.resumeQueue.clear(),X.asyncId=X.asyncTo=X.promise=void 0,Z&&(X.cancelId=Z)}var BailSignal=class extends Error{constructor(){super("An async animation has been interrupted. You see this error because you forgot to use `await` or `.catch(...)` on its returned promise.")}},SkipAnimationSignal=class extends Error{constructor(){super("SkipAnimationSignal")}},isFrameValue=X=>X instanceof FrameValue,nextId=1,FrameValue=class extends FluidValue{constructor(){super(...arguments),this.id=nextId++,this._priority=0}get priority(){return this._priority}set priority(X){this._priority!=X&&(this._priority=X,this._onPriorityChange(X))}get(){const X=getAnimated(this);return X&&X.getValue()}to(...X){return globals_exports.to(this,X)}interpolate(...X){return deprecateInterpolate(),globals_exports.to(this,X)}toJSON(){return this.get()}observerAdded(X){X==1&&this._attach()}observerRemoved(X){X==0&&this._detach()}_attach(){}_detach(){}_onChange(X,Z=!1){callFluidObservers(this,{type:"change",parent:this,value:X,idle:Z})}_onPriorityChange(X){this.idle||frameLoop.sort(this),callFluidObservers(this,{type:"priority",parent:this,priority:X})}},$P=Symbol.for("SpringPhase"),HAS_ANIMATED=1,IS_ANIMATING=2,IS_PAUSED=4,hasAnimated=X=>(X[$P]&HAS_ANIMATED)>0,isAnimating=X=>(X[$P]&IS_ANIMATING)>0,isPaused=X=>(X[$P]&IS_PAUSED)>0,setActiveBit=(X,Z)=>Z?X[$P]|=IS_ANIMATING|HAS_ANIMATED:X[$P]&=-3,setPausedBit=(X,Z)=>Z?X[$P]|=IS_PAUSED:X[$P]&=-5,SpringValue=class extends FrameValue{constructor(X,Z){if(super(),this.animation=new Animation,this.defaultProps={},this._state={paused:!1,delayed:!1,pauseQueue:new Set,resumeQueue:new Set,timeouts:new Set},this._pendingCalls=new Set,this._lastCallId=0,this._lastToId=0,this._memoizedDuration=0,!is.und(X)||!is.und(Z)){const _=is.obj(X)?{...X}:{...Z,from:X};is.und(_.default)&&(_.default=!0),this.start(_)}}get idle(){return!(isAnimating(this)||this._state.asyncTo)||isPaused(this)}get goal(){return getFluidValue(this.animation.to)}get velocity(){const X=getAnimated(this);return X instanceof AnimatedValue?X.lastVelocity||0:X.getPayload().map(Z=>Z.lastVelocity||0)}get hasAnimated(){return hasAnimated(this)}get isAnimating(){return isAnimating(this)}get isPaused(){return isPaused(this)}get isDelayed(){return this._state.delayed}advance(X){let Z=!0,_=!1;const K=this.animation;let{toValues:te}=K;const{config:ne}=K,oe=getPayload(K.to);!oe&&hasFluidValue(K.to)&&(te=toArray(getFluidValue(K.to))),K.values.forEach((ae,ge)=>{if(ae.done)return;const ce=ae.constructor==AnimatedString?1:oe?oe[ge].lastPosition:te[ge];let de=K.immediate,pe=ce;if(!de){if(pe=ae.lastPosition,ne.tension<=0){ae.done=!0;return}let fe=ae.elapsedTime+=X;const be=K.fromValues[ge],me=ae.v0!=null?ae.v0:ae.v0=is.arr(ne.velocity)?ne.velocity[ge]:ne.velocity;let ye;const ve=ne.precision||(be==ce?.005:Math.min(1,Math.abs(ce-be)*.001));if(is.und(ne.duration))if(ne.decay){const Be=ne.decay===!0?.998:ne.decay,Re=Math.exp(-(1-Be)*fe);pe=be+me/(1-Be)*(1-Re),de=Math.abs(ae.lastPosition-pe)<=ve,ye=me*Re}else{ye=ae.lastVelocity==null?me:ae.lastVelocity;const Be=ne.restVelocity||ve/10,Re=ne.clamp?0:ne.bounce,Ee=!is.und(Re),We=be==ce?ae.v0>0:be<ce;let Ze,Ve=!1;const _e=1,Xe=Math.ceil(X/_e);for(let Pe=0;Pe<Xe&&(Ze=Math.abs(ye)>Be,!(!Ze&&(de=Math.abs(ce-pe)<=ve,de)));++Pe){Ee&&(Ve=pe==ce||pe>ce==We,Ve&&(ye=-ye*Re,pe=ce));const He=-ne.tension*1e-6*(pe-ce),Ke=-ne.friction*.001*ye,Ue=(He+Ke)/ne.mass;ye=ye+Ue*_e,pe=pe+ye*_e}}else{let Be=1;ne.duration>0&&(this._memoizedDuration!==ne.duration&&(this._memoizedDuration=ne.duration,ae.durationProgress>0&&(ae.elapsedTime=ne.duration*ae.durationProgress,fe=ae.elapsedTime+=X)),Be=(ne.progress||0)+fe/this._memoizedDuration,Be=Be>1?1:Be<0?0:Be,ae.durationProgress=Be),pe=be+ne.easing(Be)*(ce-be),ye=(pe-ae.lastPosition)/X,de=Be==1}ae.lastVelocity=ye,Number.isNaN(pe)&&(console.warn("Got NaN while animating:",this),de=!0)}oe&&!oe[ge].done&&(de=!1),de?ae.done=!0:Z=!1,ae.setValue(pe,ne.round)&&(_=!0)});const ie=getAnimated(this),se=ie.getValue();if(Z){const ae=getFluidValue(K.to);(se!==ae||_)&&!ne.decay?(ie.setValue(ae),this._onChange(ae)):_&&ne.decay&&this._onChange(se),this._stop()}else _&&this._onChange(se)}set(X){return raf.batchedUpdates(()=>{this._stop(),this._focus(X),this._set(X)}),this}pause(){this._update({pause:!0})}resume(){this._update({pause:!1})}finish(){if(isAnimating(this)){const{to:X,config:Z}=this.animation;raf.batchedUpdates(()=>{this._onStart(),Z.decay||this._set(X,!1),this._stop()})}return this}update(X){return(this.queue||(this.queue=[])).push(X),this}start(X,Z){let _;return is.und(X)?(_=this.queue||[],this.queue=[]):_=[is.obj(X)?X:{...Z,to:X}],Promise.all(_.map(K=>this._update(K))).then(K=>getCombinedResult(this,K))}stop(X){const{to:Z}=this.animation;return this._focus(this.get()),stopAsync(this._state,X&&this._lastCallId),raf.batchedUpdates(()=>this._stop(Z,X)),this}reset(){this._update({reset:!0})}eventObserved(X){X.type=="change"?this._start():X.type=="priority"&&(this.priority=X.priority+1)}_prepareNode(X){const Z=this.key||"";let{to:_,from:K}=X;_=is.obj(_)?_[Z]:_,(_==null||isAsyncTo(_))&&(_=void 0),K=is.obj(K)?K[Z]:K,K==null&&(K=void 0);const te={to:_,from:K};return hasAnimated(this)||(X.reverse&&([_,K]=[K,_]),K=getFluidValue(K),is.und(K)?getAnimated(this)||this._set(_):this._set(K)),te}_update({...X},Z){const{key:_,defaultProps:K}=this;X.default&&Object.assign(K,getDefaultProps(X,(oe,ie)=>/^on/.test(ie)?resolveProp(oe,_):oe)),mergeActiveFn(this,X,"onProps"),sendEvent(this,"onProps",X,this);const te=this._prepareNode(X);if(Object.isFrozen(this))throw Error("Cannot animate a `SpringValue` object that is frozen. Did you forget to pass your component to `animated(...)` before animating its props?");const ne=this._state;return scheduleProps(++this._lastCallId,{key:_,props:X,defaultProps:K,state:ne,actions:{pause:()=>{isPaused(this)||(setPausedBit(this,!0),flushCalls(ne.pauseQueue),sendEvent(this,"onPause",getFinishedResult(this,checkFinished(this,this.animation.to)),this))},resume:()=>{isPaused(this)&&(setPausedBit(this,!1),isAnimating(this)&&this._resume(),flushCalls(ne.resumeQueue),sendEvent(this,"onResume",getFinishedResult(this,checkFinished(this,this.animation.to)),this))},start:this._merge.bind(this,te)}}).then(oe=>{if(X.loop&&oe.finished&&!(Z&&oe.noop)){const ie=createLoopUpdate(X);if(ie)return this._update(ie,!0)}return oe})}_merge(X,Z,_){if(Z.cancel)return this.stop(!0),_(getCancelledResult(this));const K=!is.und(X.to),te=!is.und(X.from);if(K||te)if(Z.callId>this._lastToId)this._lastToId=Z.callId;else return _(getCancelledResult(this));const{key:ne,defaultProps:oe,animation:ie}=this,{to:se,from:ae}=ie;let{to:ge=se,from:ce=ae}=X;te&&!K&&(!Z.default||is.und(ge))&&(ge=ce),Z.reverse&&([ge,ce]=[ce,ge]);const de=!isEqual(ce,ae);de&&(ie.from=ce),ce=getFluidValue(ce);const pe=!isEqual(ge,se);pe&&this._focus(ge);const fe=isAsyncTo(Z.to),{config:be}=ie,{decay:me,velocity:ye}=be;(K||te)&&(be.velocity=0),Z.config&&!fe&&mergeConfig(be,callProp(Z.config,ne),Z.config!==oe.config?callProp(oe.config,ne):void 0);let ve=getAnimated(this);if(!ve||is.und(ge))return _(getFinishedResult(this,!0));const Be=is.und(Z.reset)?te&&!Z.default:!is.und(ce)&&matchProp(Z.reset,ne),Re=Be?ce:this.get(),Ee=computeGoal(ge),We=is.num(Ee)||is.arr(Ee)||isAnimatedString(Ee),Ze=!fe&&(!We||matchProp(oe.immediate||Z.immediate,ne));if(pe){const Pe=getAnimatedType(ge);if(Pe!==ve.constructor)if(Ze)ve=this._set(Ee);else throw Error(`Cannot animate between ${ve.constructor.name} and ${Pe.name}, as the "to" prop suggests`)}const Ve=ve.constructor;let _e=hasFluidValue(ge),Xe=!1;if(!_e){const Pe=Be||!hasAnimated(this)&&de;(pe||Pe)&&(Xe=isEqual(computeGoal(Re),Ee),_e=!Xe),(!isEqual(ie.immediate,Ze)&&!Ze||!isEqual(be.decay,me)||!isEqual(be.velocity,ye))&&(_e=!0)}if(Xe&&isAnimating(this)&&(ie.changed&&!Be?_e=!0:_e||this._stop(se)),!fe&&((_e||hasFluidValue(se))&&(ie.values=ve.getPayload(),ie.toValues=hasFluidValue(ge)?null:Ve==AnimatedString?[1]:toArray(Ee)),ie.immediate!=Ze&&(ie.immediate=Ze,!Ze&&!Be&&this._set(se)),_e)){const{onRest:Pe}=ie;each(ACTIVE_EVENTS,Ke=>mergeActiveFn(this,Z,Ke));const He=getFinishedResult(this,checkFinished(this,se));flushCalls(this._pendingCalls,He),this._pendingCalls.add(_),ie.changed&&raf.batchedUpdates(()=>{var Ke;ie.changed=!Be,Pe==null||Pe(He,this),Be?callProp(oe.onRest,He):(Ke=ie.onStart)==null||Ke.call(ie,He,this)})}Be&&this._set(Re),fe?_(runAsync(Z.to,Z,this._state,this)):_e?this._start():isAnimating(this)&&!pe?this._pendingCalls.add(_):_(getNoopResult(Re))}_focus(X){const Z=this.animation;X!==Z.to&&(getFluidObservers(this)&&this._detach(),Z.to=X,getFluidObservers(this)&&this._attach())}_attach(){let X=0;const{to:Z}=this.animation;hasFluidValue(Z)&&(addFluidObserver(Z,this),isFrameValue(Z)&&(X=Z.priority+1)),this.priority=X}_detach(){const{to:X}=this.animation;hasFluidValue(X)&&removeFluidObserver(X,this)}_set(X,Z=!0){const _=getFluidValue(X);if(!is.und(_)){const K=getAnimated(this);if(!K||!isEqual(_,K.getValue())){const te=getAnimatedType(_);!K||K.constructor!=te?setAnimated(this,te.create(_)):K.setValue(_),K&&raf.batchedUpdates(()=>{this._onChange(_,Z)})}}return getAnimated(this)}_onStart(){const X=this.animation;X.changed||(X.changed=!0,sendEvent(this,"onStart",getFinishedResult(this,checkFinished(this,X.to)),this))}_onChange(X,Z){Z||(this._onStart(),callProp(this.animation.onChange,X,this)),callProp(this.defaultProps.onChange,X,this),super._onChange(X,Z)}_start(){const X=this.animation;getAnimated(this).reset(getFluidValue(X.to)),X.immediate||(X.fromValues=X.values.map(Z=>Z.lastPosition)),isAnimating(this)||(setActiveBit(this,!0),isPaused(this)||this._resume())}_resume(){globals_exports.skipAnimation?this.finish():frameLoop.start(this)}_stop(X,Z){if(isAnimating(this)){setActiveBit(this,!1);const _=this.animation;each(_.values,te=>{te.done=!0}),_.toValues&&(_.onChange=_.onPause=_.onResume=void 0),callFluidObservers(this,{type:"idle",parent:this});const K=Z?getCancelledResult(this.get()):getFinishedResult(this.get(),checkFinished(this,X??_.to));flushCalls(this._pendingCalls,K),_.changed&&(_.changed=!1,sendEvent(this,"onRest",K,this))}}};function checkFinished(X,Z){const _=computeGoal(Z),K=computeGoal(X.get());return isEqual(K,_)}function createLoopUpdate(X,Z=X.loop,_=X.to){const K=callProp(Z);if(K){const te=K!==!0&&inferTo(K),ne=(te||X).reverse,oe=!te||te.reset;return createUpdate({...X,loop:Z,default:!1,pause:void 0,to:!ne||isAsyncTo(_)?_:void 0,from:oe?X.from:void 0,reset:oe,...te})}}function createUpdate(X){const{to:Z,from:_}=X=inferTo(X),K=new Set;return is.obj(Z)&&findDefined(Z,K),is.obj(_)&&findDefined(_,K),X.keys=K.size?Array.from(K):null,X}function declareUpdate(X){const Z=createUpdate(X);return is.und(Z.default)&&(Z.default=getDefaultProps(Z)),Z}function findDefined(X,Z){eachProp(X,(_,K)=>_!=null&&Z.add(K))}var ACTIVE_EVENTS=["onStart","onRest","onChange","onPause","onResume"];function mergeActiveFn(X,Z,_){X.animation[_]=Z[_]!==getDefaultProp(Z,_)?resolveProp(Z[_],X.key):void 0}function sendEvent(X,Z,..._){var K,te,ne,oe;(te=(K=X.animation)[Z])==null||te.call(K,..._),(oe=(ne=X.defaultProps)[Z])==null||oe.call(ne,..._)}var BATCHED_EVENTS=["onStart","onChange","onRest"],nextId2=1,Controller=class{constructor(X,Z){this.id=nextId2++,this.springs={},this.queue=[],this._lastAsyncId=0,this._active=new Set,this._changed=new Set,this._started=!1,this._state={paused:!1,pauseQueue:new Set,resumeQueue:new Set,timeouts:new Set},this._events={onStart:new Map,onChange:new Map,onRest:new Map},this._onFrame=this._onFrame.bind(this),Z&&(this._flush=Z),X&&this.start({default:!0,...X})}get idle(){return!this._state.asyncTo&&Object.values(this.springs).every(X=>X.idle&&!X.isDelayed&&!X.isPaused)}get item(){return this._item}set item(X){this._item=X}get(){const X={};return this.each((Z,_)=>X[_]=Z.get()),X}set(X){for(const Z in X){const _=X[Z];is.und(_)||this.springs[Z].set(_)}}update(X){return X&&this.queue.push(createUpdate(X)),this}start(X){let{queue:Z}=this;return X?Z=toArray(X).map(createUpdate):this.queue=[],this._flush?this._flush(this,Z):(prepareKeys(this,Z),flushUpdateQueue(this,Z))}stop(X,Z){if(X!==!!X&&(Z=X),Z){const _=this.springs;each(toArray(Z),K=>_[K].stop(!!X))}else stopAsync(this._state,this._lastAsyncId),this.each(_=>_.stop(!!X));return this}pause(X){if(is.und(X))this.start({pause:!0});else{const Z=this.springs;each(toArray(X),_=>Z[_].pause())}return this}resume(X){if(is.und(X))this.start({pause:!1});else{const Z=this.springs;each(toArray(X),_=>Z[_].resume())}return this}each(X){eachProp(this.springs,X)}_onFrame(){const{onStart:X,onChange:Z,onRest:_}=this._events,K=this._active.size>0,te=this._changed.size>0;(K&&!this._started||te&&!this._started)&&(this._started=!0,flush(X,([ie,se])=>{se.value=this.get(),ie(se,this,this._item)}));const ne=!K&&this._started,oe=te||ne&&_.size?this.get():null;te&&Z.size&&flush(Z,([ie,se])=>{se.value=oe,ie(se,this,this._item)}),ne&&(this._started=!1,flush(_,([ie,se])=>{se.value=oe,ie(se,this,this._item)}))}eventObserved(X){if(X.type=="change")this._changed.add(X.parent),X.idle||this._active.add(X.parent);else if(X.type=="idle")this._active.delete(X.parent);else return;raf.onFrame(this._onFrame)}};function flushUpdateQueue(X,Z){return Promise.all(Z.map(_=>flushUpdate(X,_))).then(_=>getCombinedResult(X,_))}async function flushUpdate(X,Z,_){const{keys:K,to:te,from:ne,loop:oe,onRest:ie,onResolve:se}=Z,ae=is.obj(Z.default)&&Z.default;oe&&(Z.loop=!1),te===!1&&(Z.to=null),ne===!1&&(Z.from=null);const ge=is.arr(te)||is.fun(te)?te:void 0;ge?(Z.to=void 0,Z.onRest=void 0,ae&&(ae.onRest=void 0)):each(BATCHED_EVENTS,be=>{const me=Z[be];if(is.fun(me)){const ye=X._events[be];Z[be]=({finished:ve,cancelled:Be})=>{const Re=ye.get(me);Re?(ve||(Re.finished=!1),Be&&(Re.cancelled=!0)):ye.set(me,{value:null,finished:ve||!1,cancelled:Be||!1})},ae&&(ae[be]=Z[be])}});const ce=X._state;Z.pause===!ce.paused?(ce.paused=Z.pause,flushCalls(Z.pause?ce.pauseQueue:ce.resumeQueue)):ce.paused&&(Z.pause=!0);const de=(K||Object.keys(X.springs)).map(be=>X.springs[be].start(Z)),pe=Z.cancel===!0||getDefaultProp(Z,"cancel")===!0;(ge||pe&&ce.asyncId)&&de.push(scheduleProps(++X._lastAsyncId,{props:Z,state:ce,actions:{pause:noop$1,resume:noop$1,start(be,me){pe?(stopAsync(ce,X._lastAsyncId),me(getCancelledResult(X))):(be.onRest=ie,me(runAsync(ge,be,ce,X)))}}})),ce.paused&&await new Promise(be=>{ce.resumeQueue.add(be)});const fe=getCombinedResult(X,await Promise.all(de));if(oe&&fe.finished&&!(_&&fe.noop)){const be=createLoopUpdate(Z,oe,te);if(be)return prepareKeys(X,[be]),flushUpdate(X,be,!0)}return se&&raf.batchedUpdates(()=>se(fe,X,X.item)),fe}function getSprings(X,Z){const _={...X.springs};return Z&&each(toArray(Z),K=>{is.und(K.keys)&&(K=createUpdate(K)),is.obj(K.to)||(K={...K,to:void 0}),prepareSprings(_,K,te=>createSpring(te))}),setSprings(X,_),_}function setSprings(X,Z){eachProp(Z,(_,K)=>{X.springs[K]||(X.springs[K]=_,addFluidObserver(_,X))})}function createSpring(X,Z){const _=new SpringValue;return _.key=X,Z&&addFluidObserver(_,Z),_}function prepareSprings(X,Z,_){Z.keys&&each(Z.keys,K=>{(X[K]||(X[K]=_(K)))._prepareNode(Z)})}function prepareKeys(X,Z){each(Z,_=>{prepareSprings(X.springs,_,K=>createSpring(K,X))})}var SpringContext=({children:X,...Z})=>{const _=reactExports.useContext(ctx),K=Z.pause||!!_.pause,te=Z.immediate||!!_.immediate;Z=useMemoOne(()=>({pause:K,immediate:te}),[K,te]);const{Provider:ne}=ctx;return reactExports.createElement(ne,{value:Z},X)},ctx=makeContext(SpringContext,{});SpringContext.Provider=ctx.Provider;SpringContext.Consumer=ctx.Consumer;function makeContext(X,Z){return Object.assign(X,reactExports.createContext(Z)),X.Provider._context=X,X.Consumer._context=X,X}var SpringRef=()=>{const X=[],Z=function(K){deprecateDirectCall();const te=[];return each(X,(ne,oe)=>{if(is.und(K))te.push(ne.start());else{const ie=_(K,ne,oe);ie&&te.push(ne.start(ie))}}),te};Z.current=X,Z.add=function(K){X.includes(K)||X.push(K)},Z.delete=function(K){const te=X.indexOf(K);~te&&X.splice(te,1)},Z.pause=function(){return each(X,K=>K.pause(...arguments)),this},Z.resume=function(){return each(X,K=>K.resume(...arguments)),this},Z.set=function(K){each(X,(te,ne)=>{const oe=is.fun(K)?K(ne,te):K;oe&&te.set(oe)})},Z.start=function(K){const te=[];return each(X,(ne,oe)=>{if(is.und(K))te.push(ne.start());else{const ie=this._getProps(K,ne,oe);ie&&te.push(ne.start(ie))}}),te},Z.stop=function(){return each(X,K=>K.stop(...arguments)),this},Z.update=function(K){return each(X,(te,ne)=>te.update(this._getProps(K,te,ne))),this};const _=function(K,te,ne){return is.fun(K)?K(ne,te):K};return Z._getProps=_,Z};function useSprings(X,Z,_){const K=is.fun(Z)&&Z;K&&!_&&(_=[]);const te=reactExports.useMemo(()=>K||arguments.length==3?SpringRef():void 0,[]),ne=reactExports.useRef(0),oe=useForceUpdate(),ie=reactExports.useMemo(()=>({ctrls:[],queue:[],flush(ye,ve){const Be=getSprings(ye,ve);return ne.current>0&&!ie.queue.length&&!Object.keys(Be).some(Ee=>!ye.springs[Ee])?flushUpdateQueue(ye,ve):new Promise(Ee=>{setSprings(ye,Be),ie.queue.push(()=>{Ee(flushUpdateQueue(ye,ve))}),oe()})}}),[]),se=reactExports.useRef([...ie.ctrls]),ae=[],ge=usePrev(X)||0;reactExports.useMemo(()=>{each(se.current.slice(X,ge),ye=>{detachRefs(ye,te),ye.stop(!0)}),se.current.length=X,ce(ge,X)},[X]),reactExports.useMemo(()=>{ce(0,Math.min(ge,X))},_);function ce(ye,ve){for(let Be=ye;Be<ve;Be++){const Re=se.current[Be]||(se.current[Be]=new Controller(null,ie.flush)),Ee=K?K(Be,Re):Z[Be];Ee&&(ae[Be]=declareUpdate(Ee))}}const de=se.current.map((ye,ve)=>getSprings(ye,ae[ve])),pe=reactExports.useContext(SpringContext),fe=usePrev(pe),be=pe!==fe&&hasProps(pe);useIsomorphicLayoutEffect$1(()=>{ne.current++,ie.ctrls=se.current;const{queue:ye}=ie;ye.length&&(ie.queue=[],each(ye,ve=>ve())),each(se.current,(ve,Be)=>{te==null||te.add(ve),be&&ve.start({default:pe});const Re=ae[Be];Re&&(replaceRef(ve,Re.ref),ve.ref?ve.queue.push(Re):ve.start(Re))})}),useOnce(()=>()=>{each(ie.ctrls,ye=>ye.stop(!0))});const me=de.map(ye=>({...ye}));return te?[me,te]:me}function useSpring(X,Z){const _=is.fun(X),[[K],te]=useSprings(1,_?X:[X],_?[]:Z);return _||arguments.length==2?[K,te]:K}var Interpolation=class extends FrameValue{constructor(X,Z){super(),this.source=X,this.idle=!0,this._active=new Set,this.calc=createInterpolator(...Z);const _=this._get(),K=getAnimatedType(_);setAnimated(this,K.create(_))}advance(X){const Z=this._get(),_=this.get();isEqual(Z,_)||(getAnimated(this).setValue(Z),this._onChange(Z,this.idle)),!this.idle&&checkIdle(this._active)&&becomeIdle(this)}_get(){const X=is.arr(this.source)?this.source.map(getFluidValue):toArray(getFluidValue(this.source));return this.calc(...X)}_start(){this.idle&&!checkIdle(this._active)&&(this.idle=!1,each(getPayload(this),X=>{X.done=!1}),globals_exports.skipAnimation?(raf.batchedUpdates(()=>this.advance()),becomeIdle(this)):frameLoop.start(this))}_attach(){let X=1;each(toArray(this.source),Z=>{hasFluidValue(Z)&&addFluidObserver(Z,this),isFrameValue(Z)&&(Z.idle||this._active.add(Z),X=Math.max(X,Z.priority+1))}),this.priority=X,this._start()}_detach(){each(toArray(this.source),X=>{hasFluidValue(X)&&removeFluidObserver(X,this)}),this._active.clear(),becomeIdle(this)}eventObserved(X){X.type=="change"?X.idle?this.advance():(this._active.add(X.parent),this._start()):X.type=="idle"?this._active.delete(X.parent):X.type=="priority"&&(this.priority=toArray(this.source).reduce((Z,_)=>Math.max(Z,(isFrameValue(_)?_.priority:0)+1),0))}};function isIdle(X){return X.idle!==!1}function checkIdle(X){return!X.size||Array.from(X).every(isIdle)}function becomeIdle(X){X.idle||(X.idle=!0,each(getPayload(X),Z=>{Z.done=!0}),callFluidObservers(X,{type:"idle",parent:X}))}globals_exports.assign({createStringInterpolator:createStringInterpolator2,to:(X,Z)=>new Interpolation(X,Z)});var primitives=["primitive"].concat(Object.keys(THREE).filter(X=>/^[A-Z]/.test(X)).map(X=>X[0].toLowerCase()+X.slice(1)));globals_exports.assign({createStringInterpolator:createStringInterpolator2,colors:colors2,frameLoop:"demand"});addEffect(()=>{raf.advance()});var host=createHost(primitives,{applyAnimatedValues:applyProps}),animated=host.animated;function PresentationControls({enabled:X=!0,snap:Z,global:_,domElement:K,cursor:te=!0,children:ne,speed:oe=1,rotation:ie=[0,0,0],zoom:se=1,polar:ae=[0,Math.PI/2],azimuth:ge=[-1/0,1/0],config:ce={mass:1,tension:170,friction:26}}){const de=useThree(We=>We.events),pe=useThree(We=>We.gl),fe=K||de.connected||pe.domElement,{size:be}=useThree(),me=reactExports.useMemo(()=>[ie[0]+ae[0],ie[0]+ae[1]],[ie[0],ae[0],ae[1]]),ye=reactExports.useMemo(()=>[ie[1]+ge[0],ie[1]+ge[1]],[ie[1],ge[0],ge[1]]),ve=reactExports.useMemo(()=>[MathUtils.clamp(ie[0],...me),MathUtils.clamp(ie[1],...ye),ie[2]],[ie[0],ie[1],ie[2],me,ye]),[Be,Re]=useSpring(()=>({scale:1,rotation:ve,config:ce}));reactExports.useEffect(()=>void Re.start({scale:1,rotation:ve,config:ce}),[ve]),reactExports.useEffect(()=>{if(_&&te&&X)return fe.style.cursor="grab",pe.domElement.style.cursor="",()=>{fe.style.cursor="default",pe.domElement.style.cursor="default"}},[_,te,fe,X]);const Ee=useGesture({onHover:({last:We})=>{te&&!_&&X&&(fe.style.cursor=We?"auto":"grab")},onDrag:({down:We,delta:[Ze,Ve],memo:[_e,Xe]=Be.rotation.animation.to||ve})=>{if(!X)return[Ve,Ze];te&&(fe.style.cursor=We?"grabbing":"grab"),Ze=MathUtils.clamp(Xe+Ze/be.width*Math.PI*oe,...ye),Ve=MathUtils.clamp(_e+Ve/be.height*Math.PI*oe,...me);const Pe=Z&&!We&&typeof Z!="boolean"?Z:ce;return Re.start({scale:We&&Ve>me[1]/2?se:1,rotation:Z&&!We?ve:[Ve,Ze,0],config:He=>He==="scale"?{...Pe,friction:Pe.friction*3}:Pe}),[Ve,Ze]}},{target:_?fe:void 0});return reactExports.createElement(animated.group,_extends$2({},Ee==null?void 0:Ee(),Be),ne)}const version=parseInt(REVISION.replace(/\D+/g,""));function toTrianglesDrawMode(X,Z){if(Z===TrianglesDrawMode)return console.warn("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles."),X;if(Z===TriangleFanDrawMode||Z===TriangleStripDrawMode){let _=X.getIndex();if(_===null){const oe=[],ie=X.getAttribute("position");if(ie!==void 0){for(let se=0;se<ie.count;se++)oe.push(se);X.setIndex(oe),_=X.getIndex()}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),X}const K=_.count-2,te=[];if(_)if(Z===TriangleFanDrawMode)for(let oe=1;oe<=K;oe++)te.push(_.getX(0)),te.push(_.getX(oe)),te.push(_.getX(oe+1));else for(let oe=0;oe<K;oe++)oe%2===0?(te.push(_.getX(oe)),te.push(_.getX(oe+1)),te.push(_.getX(oe+2))):(te.push(_.getX(oe+2)),te.push(_.getX(oe+1)),te.push(_.getX(oe)));te.length/3!==K&&console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const ne=X.clone();return ne.setIndex(te),ne.clearGroups(),ne}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:",Z),X}var u8=Uint8Array,u16=Uint16Array,u32=Uint32Array,fleb=new u8([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),fdeb=new u8([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),clim=new u8([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),freb=function(X,Z){for(var _=new u16(31),K=0;K<31;++K)_[K]=Z+=1<<X[K-1];for(var te=new u32(_[30]),K=1;K<30;++K)for(var ne=_[K];ne<_[K+1];++ne)te[ne]=ne-_[K]<<5|K;return[_,te]},_a=freb(fleb,2),fl=_a[0],revfl=_a[1];fl[28]=258,revfl[258]=28;var _b=freb(fdeb,0),fd=_b[0],rev=new u16(32768);for(var i$5=0;i$5<32768;++i$5){var x$4=(i$5&43690)>>>1|(i$5&21845)<<1;x$4=(x$4&52428)>>>2|(x$4&13107)<<2,x$4=(x$4&61680)>>>4|(x$4&3855)<<4,rev[i$5]=((x$4&65280)>>>8|(x$4&255)<<8)>>>1}var hMap=function(X,Z,_){for(var K=X.length,te=0,ne=new u16(Z);te<K;++te)++ne[X[te]-1];var oe=new u16(Z);for(te=0;te<Z;++te)oe[te]=oe[te-1]+ne[te-1]<<1;var ie;if(_){ie=new u16(1<<Z);var se=15-Z;for(te=0;te<K;++te)if(X[te])for(var ae=te<<4|X[te],ge=Z-X[te],ce=oe[X[te]-1]++<<ge,de=ce|(1<<ge)-1;ce<=de;++ce)ie[rev[ce]>>>se]=ae}else for(ie=new u16(K),te=0;te<K;++te)X[te]&&(ie[te]=rev[oe[X[te]-1]++]>>>15-X[te]);return ie},flt=new u8(288);for(var i$5=0;i$5<144;++i$5)flt[i$5]=8;for(var i$5=144;i$5<256;++i$5)flt[i$5]=9;for(var i$5=256;i$5<280;++i$5)flt[i$5]=7;for(var i$5=280;i$5<288;++i$5)flt[i$5]=8;var fdt=new u8(32);for(var i$5=0;i$5<32;++i$5)fdt[i$5]=5;var flrm=hMap(flt,9,1),fdrm=hMap(fdt,5,1),max=function(X){for(var Z=X[0],_=1;_<X.length;++_)X[_]>Z&&(Z=X[_]);return Z},bits=function(X,Z,_){var K=Z/8|0;return(X[K]|X[K+1]<<8)>>(Z&7)&_},bits16=function(X,Z){var _=Z/8|0;return(X[_]|X[_+1]<<8|X[_+2]<<16)>>(Z&7)},shft=function(X){return(X/8|0)+(X&7&&1)},slc=function(X,Z,_){(_==null||_>X.length)&&(_=X.length);var K=new(X instanceof u16?u16:X instanceof u32?u32:u8)(_-Z);return K.set(X.subarray(Z,_)),K},inflt=function(X,Z,_){var K=X.length;if(!K||_&&!_.l&&K<5)return Z||new u8(0);var te=!Z||_,ne=!_||_.i;_||(_={}),Z||(Z=new u8(K*3));var oe=function(pt){var ht=Z.length;if(pt>ht){var At=new u8(Math.max(ht*2,pt));At.set(Z),Z=At}},ie=_.f||0,se=_.p||0,ae=_.b||0,ge=_.l,ce=_.d,de=_.m,pe=_.n,fe=K*8;do{if(!ge){_.f=ie=bits(X,se,1);var be=bits(X,se+1,3);if(se+=3,be)if(be==1)ge=flrm,ce=fdrm,de=9,pe=5;else if(be==2){var Be=bits(X,se,31)+257,Re=bits(X,se+10,15)+4,Ee=Be+bits(X,se+5,31)+1;se+=14;for(var We=new u8(Ee),Ze=new u8(19),Ve=0;Ve<Re;++Ve)Ze[clim[Ve]]=bits(X,se+Ve*3,7);se+=Re*3;for(var _e=max(Ze),Xe=(1<<_e)-1,Pe=hMap(Ze,_e,1),Ve=0;Ve<Ee;){var He=Pe[bits(X,se,Xe)];se+=He&15;var me=He>>>4;if(me<16)We[Ve++]=me;else{var Ke=0,Ue=0;for(me==16?(Ue=3+bits(X,se,3),se+=2,Ke=We[Ve-1]):me==17?(Ue=3+bits(X,se,7),se+=3):me==18&&(Ue=11+bits(X,se,127),se+=7);Ue--;)We[Ve++]=Ke}}var tt=We.subarray(0,Be),rt=We.subarray(Be);de=max(tt),pe=max(rt),ge=hMap(tt,de,1),ce=hMap(rt,pe,1)}else throw"invalid block type";else{var me=shft(se)+4,ye=X[me-4]|X[me-3]<<8,ve=me+ye;if(ve>K){if(ne)throw"unexpected EOF";break}te&&oe(ae+ye),Z.set(X.subarray(me,ve),ae),_.b=ae+=ye,_.p=se=ve*8;continue}if(se>fe){if(ne)throw"unexpected EOF";break}}te&&oe(ae+131072);for(var at=(1<<de)-1,Oe=(1<<pe)-1,$e=se;;$e=se){var Ke=ge[bits16(X,se)&at],je=Ke>>>4;if(se+=Ke&15,se>fe){if(ne)throw"unexpected EOF";break}if(!Ke)throw"invalid length/literal";if(je<256)Z[ae++]=je;else if(je==256){$e=se,ge=null;break}else{var Te=je-254;if(je>264){var Ve=je-257,De=fleb[Ve];Te=bits(X,se,(1<<De)-1)+fl[Ve],se+=De}var ot=ce[bits16(X,se)&Oe],ct=ot>>>4;if(!ot)throw"invalid distance";se+=ot&15;var rt=fd[ct];if(ct>3){var De=fdeb[ct];rt+=bits16(X,se)&(1<<De)-1,se+=De}if(se>fe){if(ne)throw"unexpected EOF";break}te&&oe(ae+131072);for(var gt=ae+Te;ae<gt;ae+=4)Z[ae]=Z[ae-rt],Z[ae+1]=Z[ae+1-rt],Z[ae+2]=Z[ae+2-rt],Z[ae+3]=Z[ae+3-rt];ae=gt}}_.l=ge,_.p=$e,_.b=ae,ge&&(ie=1,_.m=de,_.d=ce,_.n=pe)}while(!ie);return ae==Z.length?Z:slc(Z,0,ae)},et=new u8(0),zlv=function(X){if((X[0]&15)!=8||X[0]>>>4>7||(X[0]<<8|X[1])%31)throw"invalid zlib data";if(X[1]&32)throw"invalid zlib data: preset dictionaries not supported"};function unzlibSync(X,Z){return inflt((zlv(X),X.subarray(2,-4)),Z)}var td=typeof TextDecoder<"u"&&new TextDecoder,tds=0;try{td.decode(et,{stream:!0}),tds=1}catch{}const isCubeTexture=X=>X&&X.isCubeTexture;class GroundProjectedEnv extends Mesh{constructor(Z,_){var K,te;const ne=isCubeTexture(Z),ie=((te=ne?(K=Z.image[0])==null?void 0:K.width:Z.image.width)!=null?te:1024)/4,se=Math.floor(Math.log2(ie)),ae=Math.pow(2,se),ge=3*Math.max(ae,16*7),ce=4*ae,de=[ne?"#define ENVMAP_TYPE_CUBE":"",`#define CUBEUV_TEXEL_WIDTH ${1/ge}`,`#define CUBEUV_TEXEL_HEIGHT ${1/ce}`,`#define CUBEUV_MAX_MIP ${se}.0`],pe=`
        varying vec3 vWorldPosition;
        void main() 
        {
            vec4 worldPosition = ( modelMatrix * vec4( position, 1.0 ) );
            vWorldPosition = worldPosition.xyz;
            
            gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
        }
        `,fe=de.join(`
`)+`
        #define ENVMAP_TYPE_CUBE_UV
        varying vec3 vWorldPosition;
        uniform float radius;
        uniform float height;
        uniform float angle;
        #ifdef ENVMAP_TYPE_CUBE
            uniform samplerCube map;
        #else
            uniform sampler2D map;
        #endif
        // From: https://www.shadertoy.com/view/4tsBD7
        float diskIntersectWithBackFaceCulling( vec3 ro, vec3 rd, vec3 c, vec3 n, float r ) 
        {
            float d = dot ( rd, n );
            
            if( d > 0.0 ) { return 1e6; }
            
            vec3  o = ro - c;
            float t = - dot( n, o ) / d;
            vec3  q = o + rd * t;
            
            return ( dot( q, q ) < r * r ) ? t : 1e6;
        }
        // From: https://www.iquilezles.org/www/articles/intersectors/intersectors.htm
        float sphereIntersect( vec3 ro, vec3 rd, vec3 ce, float ra ) 
        {
            vec3 oc = ro - ce;
            float b = dot( oc, rd );
            float c = dot( oc, oc ) - ra * ra;
            float h = b * b - c;
            
            if( h < 0.0 ) { return -1.0; }
            
            h = sqrt( h );
            
            return - b + h;
        }
        vec3 project() 
        {
            vec3 p = normalize( vWorldPosition );
            vec3 camPos = cameraPosition;
            camPos.y -= height;
            float intersection = sphereIntersect( camPos, p, vec3( 0.0 ), radius );
            if( intersection > 0.0 ) {
                
                vec3 h = vec3( 0.0, - height, 0.0 );
                float intersection2 = diskIntersectWithBackFaceCulling( camPos, p, h, vec3( 0.0, 1.0, 0.0 ), radius );
                p = ( camPos + min( intersection, intersection2 ) * p ) / radius;
            } else {
                p = vec3( 0.0, 1.0, 0.0 );
            }
            return p;
        }
        #include <common>
        #include <cube_uv_reflection_fragment>
        void main() 
        {
            vec3 projectedWorldPosition = project();
            
            #ifdef ENVMAP_TYPE_CUBE
                vec3 outcolor = textureCube( map, projectedWorldPosition ).rgb;
            #else
                vec3 direction = normalize( projectedWorldPosition );
                vec2 uv = equirectUv( direction );
                vec3 outcolor = texture2D( map, uv ).rgb;
            #endif
            gl_FragColor = vec4( outcolor, 1.0 );
            #include <tonemapping_fragment>
            #include <${version>=154?"colorspace_fragment":"encodings_fragment"}>
        }
        `,be={map:{value:Z},height:{value:(_==null?void 0:_.height)||15},radius:{value:(_==null?void 0:_.radius)||100}},me=new IcosahedronGeometry(1,16),ye=new ShaderMaterial({uniforms:be,fragmentShader:fe,vertexShader:pe,side:DoubleSide});super(me,ye)}set radius(Z){this.material.uniforms.radius.value=Z}get radius(){return this.material.uniforms.radius.value}set height(Z){this.material.uniforms.height.value=Z}get height(){return this.material.uniforms.height.value}}function retarget(X,Z,_={}){const K=new Vector3,te=new Quaternion$2,ne=new Vector3,oe=new Matrix4,ie=new Matrix4,se=new Matrix4;_.preserveMatrix=_.preserveMatrix!==void 0?_.preserveMatrix:!0,_.preservePosition=_.preservePosition!==void 0?_.preservePosition:!0,_.preserveHipPosition=_.preserveHipPosition!==void 0?_.preserveHipPosition:!1,_.useTargetMatrix=_.useTargetMatrix!==void 0?_.useTargetMatrix:!1,_.hip=_.hip!==void 0?_.hip:"hip",_.names=_.names||{};const ae=Z.isObject3D?Z.skeleton.bones:getBones(Z),ge=X.isObject3D?X.skeleton.bones:getBones(X);let ce,de,pe,fe,be;if(X.isObject3D?X.skeleton.pose():(_.useTargetMatrix=!0,_.preserveMatrix=!1),_.preservePosition){be=[];for(let me=0;me<ge.length;me++)be.push(ge[me].position.clone())}if(_.preserveMatrix){X.updateMatrixWorld(),X.matrixWorld.identity();for(let me=0;me<X.children.length;++me)X.children[me].updateMatrixWorld(!0)}if(_.offsets){ce=[];for(let me=0;me<ge.length;++me)de=ge[me],pe=_.names[de.name]||de.name,_.offsets[pe]&&(de.matrix.multiply(_.offsets[pe]),de.matrix.decompose(de.position,de.quaternion,de.scale),de.updateMatrixWorld()),ce.push(de.matrixWorld.clone())}for(let me=0;me<ge.length;++me){if(de=ge[me],pe=_.names[de.name]||de.name,fe=getBoneByName(pe,ae),se.copy(de.matrixWorld),fe){if(fe.updateMatrixWorld(),_.useTargetMatrix?ie.copy(fe.matrixWorld):(ie.copy(X.matrixWorld).invert(),ie.multiply(fe.matrixWorld)),ne.setFromMatrixScale(ie),ie.scale(ne.set(1/ne.x,1/ne.y,1/ne.z)),se.makeRotationFromQuaternion(te.setFromRotationMatrix(ie)),X.isObject3D){const ye=ge.indexOf(de),ve=ce?ce[ye]:oe.copy(X.skeleton.boneInverses[ye]).invert();se.multiply(ve)}se.copyPosition(ie)}de.parent&&de.parent.isBone?(de.matrix.copy(de.parent.matrixWorld).invert(),de.matrix.multiply(se)):de.matrix.copy(se),_.preserveHipPosition&&pe===_.hip&&de.matrix.setPosition(K.set(0,de.position.y,0)),de.matrix.decompose(de.position,de.quaternion,de.scale),de.updateMatrixWorld()}if(_.preservePosition)for(let me=0;me<ge.length;++me)de=ge[me],pe=_.names[de.name]||de.name,pe!==_.hip&&de.position.copy(be[me]);_.preserveMatrix&&X.updateMatrixWorld(!0)}function retargetClip(X,Z,_,K={}){K.useFirstFramePosition=K.useFirstFramePosition!==void 0?K.useFirstFramePosition:!1,K.fps=K.fps!==void 0?K.fps:30,K.names=K.names||[],Z.isObject3D||(Z=getHelperFromSkeleton(Z));const te=Math.round(_.duration*(K.fps/1e3)*1e3),ne=1/K.fps,oe=[],ie=new AnimationMixer(Z),se=getBones(X.skeleton),ae=[];let ge,ce,de,pe,fe;ie.clipAction(_).play(),ie.update(0),Z.updateMatrixWorld();for(let be=0;be<te;++be){const me=be*ne;retarget(X,Z,K);for(let ye=0;ye<se.length;++ye)fe=K.names[se[ye].name]||se[ye].name,de=getBoneByName(fe,Z.skeleton),de&&(ce=se[ye],pe=ae[ye]=ae[ye]||{bone:ce},K.hip===fe&&(pe.pos||(pe.pos={times:new Float32Array(te),values:new Float32Array(te*3)}),K.useFirstFramePosition&&(be===0&&(ge=ce.position.clone()),ce.position.sub(ge)),pe.pos.times[be]=me,ce.position.toArray(pe.pos.values,be*3)),pe.quat||(pe.quat={times:new Float32Array(te),values:new Float32Array(te*4)}),pe.quat.times[be]=me,ce.quaternion.toArray(pe.quat.values,be*4));ie.update(ne),Z.updateMatrixWorld()}for(let be=0;be<ae.length;++be)pe=ae[be],pe&&(pe.pos&&oe.push(new VectorKeyframeTrack(".bones["+pe.bone.name+"].position",pe.pos.times,pe.pos.values)),oe.push(new QuaternionKeyframeTrack(".bones["+pe.bone.name+"].quaternion",pe.quat.times,pe.quat.values)));return ie.uncacheAction(_),new AnimationClip(_.name,-1,oe)}function clone(X){const Z=new Map,_=new Map,K=X.clone();return parallelTraverse(X,K,function(te,ne){Z.set(ne,te),_.set(te,ne)}),K.traverse(function(te){if(!te.isSkinnedMesh)return;const ne=te,oe=Z.get(te),ie=oe.skeleton.bones;ne.skeleton=oe.skeleton.clone(),ne.bindMatrix.copy(oe.bindMatrix),ne.skeleton.bones=ie.map(function(se){return _.get(se)}),ne.bind(ne.skeleton,ne.bindMatrix)}),K}function getBoneByName(X,Z){for(let _=0,K=getBones(Z);_<K.length;_++)if(X===K[_].name)return K[_]}function getBones(X){return Array.isArray(X)?X:X.bones}function getHelperFromSkeleton(X){const Z=new SkeletonHelper(X.bones[0]);return Z.skeleton=X,Z}function parallelTraverse(X,Z,_){_(X,Z);for(let K=0;K<X.children.length;K++)parallelTraverse(X.children[K],Z.children[K],_)}const SkeletonUtils={retarget,retargetClip,clone};function decodeText(X){if(typeof TextDecoder<"u")return new TextDecoder().decode(X);let Z="";for(let _=0,K=X.length;_<K;_++)Z+=String.fromCharCode(X[_]);try{return decodeURIComponent(escape(Z))}catch{return Z}}const SRGBColorSpace="srgb",LinearSRGBColorSpace="srgb-linear",sRGBEncoding$1=3001,LinearEncoding$1=3e3;class GLTFLoader extends Loader{constructor(Z){super(Z),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(_){return new GLTFMaterialsClearcoatExtension(_)}),this.register(function(_){return new GLTFMaterialsDispersionExtension(_)}),this.register(function(_){return new GLTFTextureBasisUExtension(_)}),this.register(function(_){return new GLTFTextureWebPExtension(_)}),this.register(function(_){return new GLTFTextureAVIFExtension(_)}),this.register(function(_){return new GLTFMaterialsSheenExtension(_)}),this.register(function(_){return new GLTFMaterialsTransmissionExtension(_)}),this.register(function(_){return new GLTFMaterialsVolumeExtension(_)}),this.register(function(_){return new GLTFMaterialsIorExtension(_)}),this.register(function(_){return new GLTFMaterialsEmissiveStrengthExtension(_)}),this.register(function(_){return new GLTFMaterialsSpecularExtension(_)}),this.register(function(_){return new GLTFMaterialsIridescenceExtension(_)}),this.register(function(_){return new GLTFMaterialsAnisotropyExtension(_)}),this.register(function(_){return new GLTFMaterialsBumpExtension(_)}),this.register(function(_){return new GLTFLightsExtension(_)}),this.register(function(_){return new GLTFMeshoptCompression(_)}),this.register(function(_){return new GLTFMeshGpuInstancing(_)})}load(Z,_,K,te){const ne=this;let oe;if(this.resourcePath!=="")oe=this.resourcePath;else if(this.path!==""){const ae=LoaderUtils.extractUrlBase(Z);oe=LoaderUtils.resolveURL(ae,this.path)}else oe=LoaderUtils.extractUrlBase(Z);this.manager.itemStart(Z);const ie=function(ae){te?te(ae):console.error(ae),ne.manager.itemError(Z),ne.manager.itemEnd(Z)},se=new FileLoader(this.manager);se.setPath(this.path),se.setResponseType("arraybuffer"),se.setRequestHeader(this.requestHeader),se.setWithCredentials(this.withCredentials),se.load(Z,function(ae){try{ne.parse(ae,oe,function(ge){_(ge),ne.manager.itemEnd(Z)},ie)}catch(ge){ie(ge)}},K,ie)}setDRACOLoader(Z){return this.dracoLoader=Z,this}setDDSLoader(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(Z){return this.ktx2Loader=Z,this}setMeshoptDecoder(Z){return this.meshoptDecoder=Z,this}register(Z){return this.pluginCallbacks.indexOf(Z)===-1&&this.pluginCallbacks.push(Z),this}unregister(Z){return this.pluginCallbacks.indexOf(Z)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(Z),1),this}parse(Z,_,K,te){let ne;const oe={},ie={};if(typeof Z=="string")ne=JSON.parse(Z);else if(Z instanceof ArrayBuffer)if(decodeText(new Uint8Array(Z.slice(0,4)))===BINARY_EXTENSION_HEADER_MAGIC){try{oe[EXTENSIONS.KHR_BINARY_GLTF]=new GLTFBinaryExtension(Z)}catch(ge){te&&te(ge);return}ne=JSON.parse(oe[EXTENSIONS.KHR_BINARY_GLTF].content)}else ne=JSON.parse(decodeText(new Uint8Array(Z)));else ne=Z;if(ne.asset===void 0||ne.asset.version[0]<2){te&&te(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));return}const se=new GLTFParser(ne,{path:_||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});se.fileLoader.setRequestHeader(this.requestHeader);for(let ae=0;ae<this.pluginCallbacks.length;ae++){const ge=this.pluginCallbacks[ae](se);ge.name||console.error("THREE.GLTFLoader: Invalid plugin found: missing name"),ie[ge.name]=ge,oe[ge.name]=!0}if(ne.extensionsUsed)for(let ae=0;ae<ne.extensionsUsed.length;++ae){const ge=ne.extensionsUsed[ae],ce=ne.extensionsRequired||[];switch(ge){case EXTENSIONS.KHR_MATERIALS_UNLIT:oe[ge]=new GLTFMaterialsUnlitExtension;break;case EXTENSIONS.KHR_DRACO_MESH_COMPRESSION:oe[ge]=new GLTFDracoMeshCompressionExtension(ne,this.dracoLoader);break;case EXTENSIONS.KHR_TEXTURE_TRANSFORM:oe[ge]=new GLTFTextureTransformExtension;break;case EXTENSIONS.KHR_MESH_QUANTIZATION:oe[ge]=new GLTFMeshQuantizationExtension;break;default:ce.indexOf(ge)>=0&&ie[ge]===void 0&&console.warn('THREE.GLTFLoader: Unknown extension "'+ge+'".')}}se.setExtensions(oe),se.setPlugins(ie),se.parse(K,te)}parseAsync(Z,_){const K=this;return new Promise(function(te,ne){K.parse(Z,_,te,ne)})}}function GLTFRegistry(){let X={};return{get:function(Z){return X[Z]},add:function(Z,_){X[Z]=_},remove:function(Z){delete X[Z]},removeAll:function(){X={}}}}const EXTENSIONS={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_DISPERSION:"KHR_materials_dispersion",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_ANISOTROPY:"KHR_materials_anisotropy",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_MATERIALS_BUMP:"EXT_materials_bump",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_TEXTURE_AVIF:"EXT_texture_avif",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",EXT_MESH_GPU_INSTANCING:"EXT_mesh_gpu_instancing"};class GLTFLightsExtension{constructor(Z){this.parser=Z,this.name=EXTENSIONS.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const Z=this.parser,_=this.parser.json.nodes||[];for(let K=0,te=_.length;K<te;K++){const ne=_[K];ne.extensions&&ne.extensions[this.name]&&ne.extensions[this.name].light!==void 0&&Z._addNodeRef(this.cache,ne.extensions[this.name].light)}}_loadLight(Z){const _=this.parser,K="light:"+Z;let te=_.cache.get(K);if(te)return te;const ne=_.json,se=((ne.extensions&&ne.extensions[this.name]||{}).lights||[])[Z];let ae;const ge=new Color$1(16777215);se.color!==void 0&&ge.setRGB(se.color[0],se.color[1],se.color[2],LinearSRGBColorSpace);const ce=se.range!==void 0?se.range:0;switch(se.type){case"directional":ae=new DirectionalLight(ge),ae.target.position.set(0,0,-1),ae.add(ae.target);break;case"point":ae=new PointLight(ge),ae.distance=ce;break;case"spot":ae=new SpotLight(ge),ae.distance=ce,se.spot=se.spot||{},se.spot.innerConeAngle=se.spot.innerConeAngle!==void 0?se.spot.innerConeAngle:0,se.spot.outerConeAngle=se.spot.outerConeAngle!==void 0?se.spot.outerConeAngle:Math.PI/4,ae.angle=se.spot.outerConeAngle,ae.penumbra=1-se.spot.innerConeAngle/se.spot.outerConeAngle,ae.target.position.set(0,0,-1),ae.add(ae.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+se.type)}return ae.position.set(0,0,0),ae.decay=2,assignExtrasToUserData(ae,se),se.intensity!==void 0&&(ae.intensity=se.intensity),ae.name=_.createUniqueName(se.name||"light_"+Z),te=Promise.resolve(ae),_.cache.add(K,te),te}getDependency(Z,_){if(Z==="light")return this._loadLight(_)}createNodeAttachment(Z){const _=this,K=this.parser,ne=K.json.nodes[Z],ie=(ne.extensions&&ne.extensions[this.name]||{}).light;return ie===void 0?null:this._loadLight(ie).then(function(se){return K._getNodeRef(_.cache,ie,se)})}}class GLTFMaterialsUnlitExtension{constructor(){this.name=EXTENSIONS.KHR_MATERIALS_UNLIT}getMaterialType(){return MeshBasicMaterial}extendParams(Z,_,K){const te=[];Z.color=new Color$1(1,1,1),Z.opacity=1;const ne=_.pbrMetallicRoughness;if(ne){if(Array.isArray(ne.baseColorFactor)){const oe=ne.baseColorFactor;Z.color.setRGB(oe[0],oe[1],oe[2],LinearSRGBColorSpace),Z.opacity=oe[3]}ne.baseColorTexture!==void 0&&te.push(K.assignTexture(Z,"map",ne.baseColorTexture,SRGBColorSpace))}return Promise.all(te)}}class GLTFMaterialsEmissiveStrengthExtension{constructor(Z){this.parser=Z,this.name=EXTENSIONS.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(Z,_){const te=this.parser.json.materials[Z];if(!te.extensions||!te.extensions[this.name])return Promise.resolve();const ne=te.extensions[this.name].emissiveStrength;return ne!==void 0&&(_.emissiveIntensity=ne),Promise.resolve()}}class GLTFMaterialsClearcoatExtension{constructor(Z){this.parser=Z,this.name=EXTENSIONS.KHR_MATERIALS_CLEARCOAT}getMaterialType(Z){const K=this.parser.json.materials[Z];return!K.extensions||!K.extensions[this.name]?null:MeshPhysicalMaterial}extendMaterialParams(Z,_){const K=this.parser,te=K.json.materials[Z];if(!te.extensions||!te.extensions[this.name])return Promise.resolve();const ne=[],oe=te.extensions[this.name];if(oe.clearcoatFactor!==void 0&&(_.clearcoat=oe.clearcoatFactor),oe.clearcoatTexture!==void 0&&ne.push(K.assignTexture(_,"clearcoatMap",oe.clearcoatTexture)),oe.clearcoatRoughnessFactor!==void 0&&(_.clearcoatRoughness=oe.clearcoatRoughnessFactor),oe.clearcoatRoughnessTexture!==void 0&&ne.push(K.assignTexture(_,"clearcoatRoughnessMap",oe.clearcoatRoughnessTexture)),oe.clearcoatNormalTexture!==void 0&&(ne.push(K.assignTexture(_,"clearcoatNormalMap",oe.clearcoatNormalTexture)),oe.clearcoatNormalTexture.scale!==void 0)){const ie=oe.clearcoatNormalTexture.scale;_.clearcoatNormalScale=new Vector2(ie,ie)}return Promise.all(ne)}}class GLTFMaterialsDispersionExtension{constructor(Z){this.parser=Z,this.name=EXTENSIONS.KHR_MATERIALS_DISPERSION}getMaterialType(Z){const K=this.parser.json.materials[Z];return!K.extensions||!K.extensions[this.name]?null:MeshPhysicalMaterial}extendMaterialParams(Z,_){const te=this.parser.json.materials[Z];if(!te.extensions||!te.extensions[this.name])return Promise.resolve();const ne=te.extensions[this.name];return _.dispersion=ne.dispersion!==void 0?ne.dispersion:0,Promise.resolve()}}class GLTFMaterialsIridescenceExtension{constructor(Z){this.parser=Z,this.name=EXTENSIONS.KHR_MATERIALS_IRIDESCENCE}getMaterialType(Z){const K=this.parser.json.materials[Z];return!K.extensions||!K.extensions[this.name]?null:MeshPhysicalMaterial}extendMaterialParams(Z,_){const K=this.parser,te=K.json.materials[Z];if(!te.extensions||!te.extensions[this.name])return Promise.resolve();const ne=[],oe=te.extensions[this.name];return oe.iridescenceFactor!==void 0&&(_.iridescence=oe.iridescenceFactor),oe.iridescenceTexture!==void 0&&ne.push(K.assignTexture(_,"iridescenceMap",oe.iridescenceTexture)),oe.iridescenceIor!==void 0&&(_.iridescenceIOR=oe.iridescenceIor),_.iridescenceThicknessRange===void 0&&(_.iridescenceThicknessRange=[100,400]),oe.iridescenceThicknessMinimum!==void 0&&(_.iridescenceThicknessRange[0]=oe.iridescenceThicknessMinimum),oe.iridescenceThicknessMaximum!==void 0&&(_.iridescenceThicknessRange[1]=oe.iridescenceThicknessMaximum),oe.iridescenceThicknessTexture!==void 0&&ne.push(K.assignTexture(_,"iridescenceThicknessMap",oe.iridescenceThicknessTexture)),Promise.all(ne)}}class GLTFMaterialsSheenExtension{constructor(Z){this.parser=Z,this.name=EXTENSIONS.KHR_MATERIALS_SHEEN}getMaterialType(Z){const K=this.parser.json.materials[Z];return!K.extensions||!K.extensions[this.name]?null:MeshPhysicalMaterial}extendMaterialParams(Z,_){const K=this.parser,te=K.json.materials[Z];if(!te.extensions||!te.extensions[this.name])return Promise.resolve();const ne=[];_.sheenColor=new Color$1(0,0,0),_.sheenRoughness=0,_.sheen=1;const oe=te.extensions[this.name];if(oe.sheenColorFactor!==void 0){const ie=oe.sheenColorFactor;_.sheenColor.setRGB(ie[0],ie[1],ie[2],LinearSRGBColorSpace)}return oe.sheenRoughnessFactor!==void 0&&(_.sheenRoughness=oe.sheenRoughnessFactor),oe.sheenColorTexture!==void 0&&ne.push(K.assignTexture(_,"sheenColorMap",oe.sheenColorTexture,SRGBColorSpace)),oe.sheenRoughnessTexture!==void 0&&ne.push(K.assignTexture(_,"sheenRoughnessMap",oe.sheenRoughnessTexture)),Promise.all(ne)}}class GLTFMaterialsTransmissionExtension{constructor(Z){this.parser=Z,this.name=EXTENSIONS.KHR_MATERIALS_TRANSMISSION}getMaterialType(Z){const K=this.parser.json.materials[Z];return!K.extensions||!K.extensions[this.name]?null:MeshPhysicalMaterial}extendMaterialParams(Z,_){const K=this.parser,te=K.json.materials[Z];if(!te.extensions||!te.extensions[this.name])return Promise.resolve();const ne=[],oe=te.extensions[this.name];return oe.transmissionFactor!==void 0&&(_.transmission=oe.transmissionFactor),oe.transmissionTexture!==void 0&&ne.push(K.assignTexture(_,"transmissionMap",oe.transmissionTexture)),Promise.all(ne)}}class GLTFMaterialsVolumeExtension{constructor(Z){this.parser=Z,this.name=EXTENSIONS.KHR_MATERIALS_VOLUME}getMaterialType(Z){const K=this.parser.json.materials[Z];return!K.extensions||!K.extensions[this.name]?null:MeshPhysicalMaterial}extendMaterialParams(Z,_){const K=this.parser,te=K.json.materials[Z];if(!te.extensions||!te.extensions[this.name])return Promise.resolve();const ne=[],oe=te.extensions[this.name];_.thickness=oe.thicknessFactor!==void 0?oe.thicknessFactor:0,oe.thicknessTexture!==void 0&&ne.push(K.assignTexture(_,"thicknessMap",oe.thicknessTexture)),_.attenuationDistance=oe.attenuationDistance||1/0;const ie=oe.attenuationColor||[1,1,1];return _.attenuationColor=new Color$1().setRGB(ie[0],ie[1],ie[2],LinearSRGBColorSpace),Promise.all(ne)}}class GLTFMaterialsIorExtension{constructor(Z){this.parser=Z,this.name=EXTENSIONS.KHR_MATERIALS_IOR}getMaterialType(Z){const K=this.parser.json.materials[Z];return!K.extensions||!K.extensions[this.name]?null:MeshPhysicalMaterial}extendMaterialParams(Z,_){const te=this.parser.json.materials[Z];if(!te.extensions||!te.extensions[this.name])return Promise.resolve();const ne=te.extensions[this.name];return _.ior=ne.ior!==void 0?ne.ior:1.5,Promise.resolve()}}class GLTFMaterialsSpecularExtension{constructor(Z){this.parser=Z,this.name=EXTENSIONS.KHR_MATERIALS_SPECULAR}getMaterialType(Z){const K=this.parser.json.materials[Z];return!K.extensions||!K.extensions[this.name]?null:MeshPhysicalMaterial}extendMaterialParams(Z,_){const K=this.parser,te=K.json.materials[Z];if(!te.extensions||!te.extensions[this.name])return Promise.resolve();const ne=[],oe=te.extensions[this.name];_.specularIntensity=oe.specularFactor!==void 0?oe.specularFactor:1,oe.specularTexture!==void 0&&ne.push(K.assignTexture(_,"specularIntensityMap",oe.specularTexture));const ie=oe.specularColorFactor||[1,1,1];return _.specularColor=new Color$1().setRGB(ie[0],ie[1],ie[2],LinearSRGBColorSpace),oe.specularColorTexture!==void 0&&ne.push(K.assignTexture(_,"specularColorMap",oe.specularColorTexture,SRGBColorSpace)),Promise.all(ne)}}class GLTFMaterialsBumpExtension{constructor(Z){this.parser=Z,this.name=EXTENSIONS.EXT_MATERIALS_BUMP}getMaterialType(Z){const K=this.parser.json.materials[Z];return!K.extensions||!K.extensions[this.name]?null:MeshPhysicalMaterial}extendMaterialParams(Z,_){const K=this.parser,te=K.json.materials[Z];if(!te.extensions||!te.extensions[this.name])return Promise.resolve();const ne=[],oe=te.extensions[this.name];return _.bumpScale=oe.bumpFactor!==void 0?oe.bumpFactor:1,oe.bumpTexture!==void 0&&ne.push(K.assignTexture(_,"bumpMap",oe.bumpTexture)),Promise.all(ne)}}class GLTFMaterialsAnisotropyExtension{constructor(Z){this.parser=Z,this.name=EXTENSIONS.KHR_MATERIALS_ANISOTROPY}getMaterialType(Z){const K=this.parser.json.materials[Z];return!K.extensions||!K.extensions[this.name]?null:MeshPhysicalMaterial}extendMaterialParams(Z,_){const K=this.parser,te=K.json.materials[Z];if(!te.extensions||!te.extensions[this.name])return Promise.resolve();const ne=[],oe=te.extensions[this.name];return oe.anisotropyStrength!==void 0&&(_.anisotropy=oe.anisotropyStrength),oe.anisotropyRotation!==void 0&&(_.anisotropyRotation=oe.anisotropyRotation),oe.anisotropyTexture!==void 0&&ne.push(K.assignTexture(_,"anisotropyMap",oe.anisotropyTexture)),Promise.all(ne)}}class GLTFTextureBasisUExtension{constructor(Z){this.parser=Z,this.name=EXTENSIONS.KHR_TEXTURE_BASISU}loadTexture(Z){const _=this.parser,K=_.json,te=K.textures[Z];if(!te.extensions||!te.extensions[this.name])return null;const ne=te.extensions[this.name],oe=_.options.ktx2Loader;if(!oe){if(K.extensionsRequired&&K.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return _.loadTextureImage(Z,ne.source,oe)}}class GLTFTextureWebPExtension{constructor(Z){this.parser=Z,this.name=EXTENSIONS.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(Z){const _=this.name,K=this.parser,te=K.json,ne=te.textures[Z];if(!ne.extensions||!ne.extensions[_])return null;const oe=ne.extensions[_],ie=te.images[oe.source];let se=K.textureLoader;if(ie.uri){const ae=K.options.manager.getHandler(ie.uri);ae!==null&&(se=ae)}return this.detectSupport().then(function(ae){if(ae)return K.loadTextureImage(Z,oe.source,se);if(te.extensionsRequired&&te.extensionsRequired.indexOf(_)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return K.loadTexture(Z)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(Z){const _=new Image;_.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",_.onload=_.onerror=function(){Z(_.height===1)}})),this.isSupported}}class GLTFTextureAVIFExtension{constructor(Z){this.parser=Z,this.name=EXTENSIONS.EXT_TEXTURE_AVIF,this.isSupported=null}loadTexture(Z){const _=this.name,K=this.parser,te=K.json,ne=te.textures[Z];if(!ne.extensions||!ne.extensions[_])return null;const oe=ne.extensions[_],ie=te.images[oe.source];let se=K.textureLoader;if(ie.uri){const ae=K.options.manager.getHandler(ie.uri);ae!==null&&(se=ae)}return this.detectSupport().then(function(ae){if(ae)return K.loadTextureImage(Z,oe.source,se);if(te.extensionsRequired&&te.extensionsRequired.indexOf(_)>=0)throw new Error("THREE.GLTFLoader: AVIF required by asset but unsupported.");return K.loadTexture(Z)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(Z){const _=new Image;_.src="data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAABcAAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAEAAAABAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQAMAAAAABNjb2xybmNseAACAAIABoAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAAB9tZGF0EgAKCBgABogQEDQgMgkQAAAAB8dSLfI=",_.onload=_.onerror=function(){Z(_.height===1)}})),this.isSupported}}class GLTFMeshoptCompression{constructor(Z){this.name=EXTENSIONS.EXT_MESHOPT_COMPRESSION,this.parser=Z}loadBufferView(Z){const _=this.parser.json,K=_.bufferViews[Z];if(K.extensions&&K.extensions[this.name]){const te=K.extensions[this.name],ne=this.parser.getDependency("buffer",te.buffer),oe=this.parser.options.meshoptDecoder;if(!oe||!oe.supported){if(_.extensionsRequired&&_.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return ne.then(function(ie){const se=te.byteOffset||0,ae=te.byteLength||0,ge=te.count,ce=te.byteStride,de=new Uint8Array(ie,se,ae);return oe.decodeGltfBufferAsync?oe.decodeGltfBufferAsync(ge,ce,de,te.mode,te.filter).then(function(pe){return pe.buffer}):oe.ready.then(function(){const pe=new ArrayBuffer(ge*ce);return oe.decodeGltfBuffer(new Uint8Array(pe),ge,ce,de,te.mode,te.filter),pe})})}else return null}}class GLTFMeshGpuInstancing{constructor(Z){this.name=EXTENSIONS.EXT_MESH_GPU_INSTANCING,this.parser=Z}createNodeMesh(Z){const _=this.parser.json,K=_.nodes[Z];if(!K.extensions||!K.extensions[this.name]||K.mesh===void 0)return null;const te=_.meshes[K.mesh];for(const ae of te.primitives)if(ae.mode!==WEBGL_CONSTANTS.TRIANGLES&&ae.mode!==WEBGL_CONSTANTS.TRIANGLE_STRIP&&ae.mode!==WEBGL_CONSTANTS.TRIANGLE_FAN&&ae.mode!==void 0)return null;const oe=K.extensions[this.name].attributes,ie=[],se={};for(const ae in oe)ie.push(this.parser.getDependency("accessor",oe[ae]).then(ge=>(se[ae]=ge,se[ae])));return ie.length<1?null:(ie.push(this.parser.createNodeMesh(Z)),Promise.all(ie).then(ae=>{const ge=ae.pop(),ce=ge.isGroup?ge.children:[ge],de=ae[0].count,pe=[];for(const fe of ce){const be=new Matrix4,me=new Vector3,ye=new Quaternion$2,ve=new Vector3(1,1,1),Be=new InstancedMesh(fe.geometry,fe.material,de);for(let Re=0;Re<de;Re++)se.TRANSLATION&&me.fromBufferAttribute(se.TRANSLATION,Re),se.ROTATION&&ye.fromBufferAttribute(se.ROTATION,Re),se.SCALE&&ve.fromBufferAttribute(se.SCALE,Re),Be.setMatrixAt(Re,be.compose(me,ye,ve));for(const Re in se)if(Re==="_COLOR_0"){const Ee=se[Re];Be.instanceColor=new InstancedBufferAttribute(Ee.array,Ee.itemSize,Ee.normalized)}else Re!=="TRANSLATION"&&Re!=="ROTATION"&&Re!=="SCALE"&&fe.geometry.setAttribute(Re,se[Re]);Object3D.prototype.copy.call(Be,fe),this.parser.assignFinalMaterial(Be),pe.push(Be)}return ge.isGroup?(ge.clear(),ge.add(...pe),ge):pe[0]}))}}const BINARY_EXTENSION_HEADER_MAGIC="glTF",BINARY_EXTENSION_HEADER_LENGTH=12,BINARY_EXTENSION_CHUNK_TYPES={JSON:1313821514,BIN:5130562};class GLTFBinaryExtension{constructor(Z){this.name=EXTENSIONS.KHR_BINARY_GLTF,this.content=null,this.body=null;const _=new DataView(Z,0,BINARY_EXTENSION_HEADER_LENGTH);if(this.header={magic:decodeText(new Uint8Array(Z.slice(0,4))),version:_.getUint32(4,!0),length:_.getUint32(8,!0)},this.header.magic!==BINARY_EXTENSION_HEADER_MAGIC)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const K=this.header.length-BINARY_EXTENSION_HEADER_LENGTH,te=new DataView(Z,BINARY_EXTENSION_HEADER_LENGTH);let ne=0;for(;ne<K;){const oe=te.getUint32(ne,!0);ne+=4;const ie=te.getUint32(ne,!0);if(ne+=4,ie===BINARY_EXTENSION_CHUNK_TYPES.JSON){const se=new Uint8Array(Z,BINARY_EXTENSION_HEADER_LENGTH+ne,oe);this.content=decodeText(se)}else if(ie===BINARY_EXTENSION_CHUNK_TYPES.BIN){const se=BINARY_EXTENSION_HEADER_LENGTH+ne;this.body=Z.slice(se,se+oe)}ne+=oe}if(this.content===null)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class GLTFDracoMeshCompressionExtension{constructor(Z,_){if(!_)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=EXTENSIONS.KHR_DRACO_MESH_COMPRESSION,this.json=Z,this.dracoLoader=_,this.dracoLoader.preload()}decodePrimitive(Z,_){const K=this.json,te=this.dracoLoader,ne=Z.extensions[this.name].bufferView,oe=Z.extensions[this.name].attributes,ie={},se={},ae={};for(const ge in oe){const ce=ATTRIBUTES[ge]||ge.toLowerCase();ie[ce]=oe[ge]}for(const ge in Z.attributes){const ce=ATTRIBUTES[ge]||ge.toLowerCase();if(oe[ge]!==void 0){const de=K.accessors[Z.attributes[ge]],pe=WEBGL_COMPONENT_TYPES[de.componentType];ae[ce]=pe.name,se[ce]=de.normalized===!0}}return _.getDependency("bufferView",ne).then(function(ge){return new Promise(function(ce,de){te.decodeDracoFile(ge,function(pe){for(const fe in pe.attributes){const be=pe.attributes[fe],me=se[fe];me!==void 0&&(be.normalized=me)}ce(pe)},ie,ae,LinearSRGBColorSpace,de)})})}}class GLTFTextureTransformExtension{constructor(){this.name=EXTENSIONS.KHR_TEXTURE_TRANSFORM}extendTexture(Z,_){return(_.texCoord===void 0||_.texCoord===Z.channel)&&_.offset===void 0&&_.rotation===void 0&&_.scale===void 0||(Z=Z.clone(),_.texCoord!==void 0&&(Z.channel=_.texCoord),_.offset!==void 0&&Z.offset.fromArray(_.offset),_.rotation!==void 0&&(Z.rotation=_.rotation),_.scale!==void 0&&Z.repeat.fromArray(_.scale),Z.needsUpdate=!0),Z}}class GLTFMeshQuantizationExtension{constructor(){this.name=EXTENSIONS.KHR_MESH_QUANTIZATION}}class GLTFCubicSplineInterpolant extends Interpolant{constructor(Z,_,K,te){super(Z,_,K,te)}copySampleValue_(Z){const _=this.resultBuffer,K=this.sampleValues,te=this.valueSize,ne=Z*te*3+te;for(let oe=0;oe!==te;oe++)_[oe]=K[ne+oe];return _}interpolate_(Z,_,K,te){const ne=this.resultBuffer,oe=this.sampleValues,ie=this.valueSize,se=ie*2,ae=ie*3,ge=te-_,ce=(K-_)/ge,de=ce*ce,pe=de*ce,fe=Z*ae,be=fe-ae,me=-2*pe+3*de,ye=pe-de,ve=1-me,Be=ye-de+ce;for(let Re=0;Re!==ie;Re++){const Ee=oe[be+Re+ie],We=oe[be+Re+se]*ge,Ze=oe[fe+Re+ie],Ve=oe[fe+Re]*ge;ne[Re]=ve*Ee+Be*We+me*Ze+ye*Ve}return ne}}const _q=new Quaternion$2;class GLTFCubicSplineQuaternionInterpolant extends GLTFCubicSplineInterpolant{interpolate_(Z,_,K,te){const ne=super.interpolate_(Z,_,K,te);return _q.fromArray(ne).normalize().toArray(ne),ne}}const WEBGL_CONSTANTS={FLOAT:5126,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,LINEAR:9729,REPEAT:10497,SAMPLER_2D:35678,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123},WEBGL_COMPONENT_TYPES={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},WEBGL_FILTERS={9728:NearestFilter,9729:LinearFilter,9984:NearestMipmapNearestFilter,9985:LinearMipmapNearestFilter,9986:NearestMipmapLinearFilter,9987:LinearMipmapLinearFilter},WEBGL_WRAPPINGS={33071:ClampToEdgeWrapping,33648:MirroredRepeatWrapping,10497:RepeatWrapping},WEBGL_TYPE_SIZES={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},ATTRIBUTES={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",...version>=152?{TEXCOORD_0:"uv",TEXCOORD_1:"uv1",TEXCOORD_2:"uv2",TEXCOORD_3:"uv3"}:{TEXCOORD_0:"uv",TEXCOORD_1:"uv2"},COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},PATH_PROPERTIES={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},INTERPOLATION={CUBICSPLINE:void 0,LINEAR:InterpolateLinear,STEP:InterpolateDiscrete},ALPHA_MODES={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};function createDefaultMaterial(X){return X.DefaultMaterial===void 0&&(X.DefaultMaterial=new MeshStandardMaterial({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:FrontSide})),X.DefaultMaterial}function addUnknownExtensionsToUserData(X,Z,_){for(const K in _.extensions)X[K]===void 0&&(Z.userData.gltfExtensions=Z.userData.gltfExtensions||{},Z.userData.gltfExtensions[K]=_.extensions[K])}function assignExtrasToUserData(X,Z){Z.extras!==void 0&&(typeof Z.extras=="object"?Object.assign(X.userData,Z.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+Z.extras))}function addMorphTargets(X,Z,_){let K=!1,te=!1,ne=!1;for(let ae=0,ge=Z.length;ae<ge;ae++){const ce=Z[ae];if(ce.POSITION!==void 0&&(K=!0),ce.NORMAL!==void 0&&(te=!0),ce.COLOR_0!==void 0&&(ne=!0),K&&te&&ne)break}if(!K&&!te&&!ne)return Promise.resolve(X);const oe=[],ie=[],se=[];for(let ae=0,ge=Z.length;ae<ge;ae++){const ce=Z[ae];if(K){const de=ce.POSITION!==void 0?_.getDependency("accessor",ce.POSITION):X.attributes.position;oe.push(de)}if(te){const de=ce.NORMAL!==void 0?_.getDependency("accessor",ce.NORMAL):X.attributes.normal;ie.push(de)}if(ne){const de=ce.COLOR_0!==void 0?_.getDependency("accessor",ce.COLOR_0):X.attributes.color;se.push(de)}}return Promise.all([Promise.all(oe),Promise.all(ie),Promise.all(se)]).then(function(ae){const ge=ae[0],ce=ae[1],de=ae[2];return K&&(X.morphAttributes.position=ge),te&&(X.morphAttributes.normal=ce),ne&&(X.morphAttributes.color=de),X.morphTargetsRelative=!0,X})}function updateMorphTargets(X,Z){if(X.updateMorphTargets(),Z.weights!==void 0)for(let _=0,K=Z.weights.length;_<K;_++)X.morphTargetInfluences[_]=Z.weights[_];if(Z.extras&&Array.isArray(Z.extras.targetNames)){const _=Z.extras.targetNames;if(X.morphTargetInfluences.length===_.length){X.morphTargetDictionary={};for(let K=0,te=_.length;K<te;K++)X.morphTargetDictionary[_[K]]=K}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function createPrimitiveKey(X){let Z;const _=X.extensions&&X.extensions[EXTENSIONS.KHR_DRACO_MESH_COMPRESSION];if(_?Z="draco:"+_.bufferView+":"+_.indices+":"+createAttributesKey(_.attributes):Z=X.indices+":"+createAttributesKey(X.attributes)+":"+X.mode,X.targets!==void 0)for(let K=0,te=X.targets.length;K<te;K++)Z+=":"+createAttributesKey(X.targets[K]);return Z}function createAttributesKey(X){let Z="";const _=Object.keys(X).sort();for(let K=0,te=_.length;K<te;K++)Z+=_[K]+":"+X[_[K]]+";";return Z}function getNormalizedComponentScale(X){switch(X){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}function getImageURIMimeType(X){return X.search(/\.jpe?g($|\?)/i)>0||X.search(/^data\:image\/jpeg/)===0?"image/jpeg":X.search(/\.webp($|\?)/i)>0||X.search(/^data\:image\/webp/)===0?"image/webp":"image/png"}const _identityMatrix=new Matrix4;class GLTFParser{constructor(Z={},_={}){this.json=Z,this.extensions={},this.plugins={},this.options=_,this.cache=new GLTFRegistry,this.associations=new Map,this.primitiveCache={},this.nodeCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};let K=!1,te=!1,ne=-1;typeof navigator<"u"&&typeof navigator.userAgent<"u"&&(K=/^((?!chrome|android).)*safari/i.test(navigator.userAgent)===!0,te=navigator.userAgent.indexOf("Firefox")>-1,ne=te?navigator.userAgent.match(/Firefox\/([0-9]+)\./)[1]:-1),typeof createImageBitmap>"u"||K||te&&ne<98?this.textureLoader=new TextureLoader(this.options.manager):this.textureLoader=new ImageBitmapLoader(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new FileLoader(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),this.options.crossOrigin==="use-credentials"&&this.fileLoader.setWithCredentials(!0)}setExtensions(Z){this.extensions=Z}setPlugins(Z){this.plugins=Z}parse(Z,_){const K=this,te=this.json,ne=this.extensions;this.cache.removeAll(),this.nodeCache={},this._invokeAll(function(oe){return oe._markDefs&&oe._markDefs()}),Promise.all(this._invokeAll(function(oe){return oe.beforeRoot&&oe.beforeRoot()})).then(function(){return Promise.all([K.getDependencies("scene"),K.getDependencies("animation"),K.getDependencies("camera")])}).then(function(oe){const ie={scene:oe[0][te.scene||0],scenes:oe[0],animations:oe[1],cameras:oe[2],asset:te.asset,parser:K,userData:{}};return addUnknownExtensionsToUserData(ne,ie,te),assignExtrasToUserData(ie,te),Promise.all(K._invokeAll(function(se){return se.afterRoot&&se.afterRoot(ie)})).then(function(){for(const se of ie.scenes)se.updateMatrixWorld();Z(ie)})}).catch(_)}_markDefs(){const Z=this.json.nodes||[],_=this.json.skins||[],K=this.json.meshes||[];for(let te=0,ne=_.length;te<ne;te++){const oe=_[te].joints;for(let ie=0,se=oe.length;ie<se;ie++)Z[oe[ie]].isBone=!0}for(let te=0,ne=Z.length;te<ne;te++){const oe=Z[te];oe.mesh!==void 0&&(this._addNodeRef(this.meshCache,oe.mesh),oe.skin!==void 0&&(K[oe.mesh].isSkinnedMesh=!0)),oe.camera!==void 0&&this._addNodeRef(this.cameraCache,oe.camera)}}_addNodeRef(Z,_){_!==void 0&&(Z.refs[_]===void 0&&(Z.refs[_]=Z.uses[_]=0),Z.refs[_]++)}_getNodeRef(Z,_,K){if(Z.refs[_]<=1)return K;const te=K.clone(),ne=(oe,ie)=>{const se=this.associations.get(oe);se!=null&&this.associations.set(ie,se);for(const[ae,ge]of oe.children.entries())ne(ge,ie.children[ae])};return ne(K,te),te.name+="_instance_"+Z.uses[_]++,te}_invokeOne(Z){const _=Object.values(this.plugins);_.push(this);for(let K=0;K<_.length;K++){const te=Z(_[K]);if(te)return te}return null}_invokeAll(Z){const _=Object.values(this.plugins);_.unshift(this);const K=[];for(let te=0;te<_.length;te++){const ne=Z(_[te]);ne&&K.push(ne)}return K}getDependency(Z,_){const K=Z+":"+_;let te=this.cache.get(K);if(!te){switch(Z){case"scene":te=this.loadScene(_);break;case"node":te=this._invokeOne(function(ne){return ne.loadNode&&ne.loadNode(_)});break;case"mesh":te=this._invokeOne(function(ne){return ne.loadMesh&&ne.loadMesh(_)});break;case"accessor":te=this.loadAccessor(_);break;case"bufferView":te=this._invokeOne(function(ne){return ne.loadBufferView&&ne.loadBufferView(_)});break;case"buffer":te=this.loadBuffer(_);break;case"material":te=this._invokeOne(function(ne){return ne.loadMaterial&&ne.loadMaterial(_)});break;case"texture":te=this._invokeOne(function(ne){return ne.loadTexture&&ne.loadTexture(_)});break;case"skin":te=this.loadSkin(_);break;case"animation":te=this._invokeOne(function(ne){return ne.loadAnimation&&ne.loadAnimation(_)});break;case"camera":te=this.loadCamera(_);break;default:if(te=this._invokeOne(function(ne){return ne!=this&&ne.getDependency&&ne.getDependency(Z,_)}),!te)throw new Error("Unknown type: "+Z);break}this.cache.add(K,te)}return te}getDependencies(Z){let _=this.cache.get(Z);if(!_){const K=this,te=this.json[Z+(Z==="mesh"?"es":"s")]||[];_=Promise.all(te.map(function(ne,oe){return K.getDependency(Z,oe)})),this.cache.add(Z,_)}return _}loadBuffer(Z){const _=this.json.buffers[Z],K=this.fileLoader;if(_.type&&_.type!=="arraybuffer")throw new Error("THREE.GLTFLoader: "+_.type+" buffer type is not supported.");if(_.uri===void 0&&Z===0)return Promise.resolve(this.extensions[EXTENSIONS.KHR_BINARY_GLTF].body);const te=this.options;return new Promise(function(ne,oe){K.load(LoaderUtils.resolveURL(_.uri,te.path),ne,void 0,function(){oe(new Error('THREE.GLTFLoader: Failed to load buffer "'+_.uri+'".'))})})}loadBufferView(Z){const _=this.json.bufferViews[Z];return this.getDependency("buffer",_.buffer).then(function(K){const te=_.byteLength||0,ne=_.byteOffset||0;return K.slice(ne,ne+te)})}loadAccessor(Z){const _=this,K=this.json,te=this.json.accessors[Z];if(te.bufferView===void 0&&te.sparse===void 0){const oe=WEBGL_TYPE_SIZES[te.type],ie=WEBGL_COMPONENT_TYPES[te.componentType],se=te.normalized===!0,ae=new ie(te.count*oe);return Promise.resolve(new BufferAttribute(ae,oe,se))}const ne=[];return te.bufferView!==void 0?ne.push(this.getDependency("bufferView",te.bufferView)):ne.push(null),te.sparse!==void 0&&(ne.push(this.getDependency("bufferView",te.sparse.indices.bufferView)),ne.push(this.getDependency("bufferView",te.sparse.values.bufferView))),Promise.all(ne).then(function(oe){const ie=oe[0],se=WEBGL_TYPE_SIZES[te.type],ae=WEBGL_COMPONENT_TYPES[te.componentType],ge=ae.BYTES_PER_ELEMENT,ce=ge*se,de=te.byteOffset||0,pe=te.bufferView!==void 0?K.bufferViews[te.bufferView].byteStride:void 0,fe=te.normalized===!0;let be,me;if(pe&&pe!==ce){const ye=Math.floor(de/pe),ve="InterleavedBuffer:"+te.bufferView+":"+te.componentType+":"+ye+":"+te.count;let Be=_.cache.get(ve);Be||(be=new ae(ie,ye*pe,te.count*pe/ge),Be=new InterleavedBuffer(be,pe/ge),_.cache.add(ve,Be)),me=new InterleavedBufferAttribute(Be,se,de%pe/ge,fe)}else ie===null?be=new ae(te.count*se):be=new ae(ie,de,te.count*se),me=new BufferAttribute(be,se,fe);if(te.sparse!==void 0){const ye=WEBGL_TYPE_SIZES.SCALAR,ve=WEBGL_COMPONENT_TYPES[te.sparse.indices.componentType],Be=te.sparse.indices.byteOffset||0,Re=te.sparse.values.byteOffset||0,Ee=new ve(oe[1],Be,te.sparse.count*ye),We=new ae(oe[2],Re,te.sparse.count*se);ie!==null&&(me=new BufferAttribute(me.array.slice(),me.itemSize,me.normalized));for(let Ze=0,Ve=Ee.length;Ze<Ve;Ze++){const _e=Ee[Ze];if(me.setX(_e,We[Ze*se]),se>=2&&me.setY(_e,We[Ze*se+1]),se>=3&&me.setZ(_e,We[Ze*se+2]),se>=4&&me.setW(_e,We[Ze*se+3]),se>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return me})}loadTexture(Z){const _=this.json,K=this.options,ne=_.textures[Z].source,oe=_.images[ne];let ie=this.textureLoader;if(oe.uri){const se=K.manager.getHandler(oe.uri);se!==null&&(ie=se)}return this.loadTextureImage(Z,ne,ie)}loadTextureImage(Z,_,K){const te=this,ne=this.json,oe=ne.textures[Z],ie=ne.images[_],se=(ie.uri||ie.bufferView)+":"+oe.sampler;if(this.textureCache[se])return this.textureCache[se];const ae=this.loadImageSource(_,K).then(function(ge){ge.flipY=!1,ge.name=oe.name||ie.name||"",ge.name===""&&typeof ie.uri=="string"&&ie.uri.startsWith("data:image/")===!1&&(ge.name=ie.uri);const de=(ne.samplers||{})[oe.sampler]||{};return ge.magFilter=WEBGL_FILTERS[de.magFilter]||LinearFilter,ge.minFilter=WEBGL_FILTERS[de.minFilter]||LinearMipmapLinearFilter,ge.wrapS=WEBGL_WRAPPINGS[de.wrapS]||RepeatWrapping,ge.wrapT=WEBGL_WRAPPINGS[de.wrapT]||RepeatWrapping,te.associations.set(ge,{textures:Z}),ge}).catch(function(){return null});return this.textureCache[se]=ae,ae}loadImageSource(Z,_){const K=this,te=this.json,ne=this.options;if(this.sourceCache[Z]!==void 0)return this.sourceCache[Z].then(ce=>ce.clone());const oe=te.images[Z],ie=self.URL||self.webkitURL;let se=oe.uri||"",ae=!1;if(oe.bufferView!==void 0)se=K.getDependency("bufferView",oe.bufferView).then(function(ce){ae=!0;const de=new Blob([ce],{type:oe.mimeType});return se=ie.createObjectURL(de),se});else if(oe.uri===void 0)throw new Error("THREE.GLTFLoader: Image "+Z+" is missing URI and bufferView");const ge=Promise.resolve(se).then(function(ce){return new Promise(function(de,pe){let fe=de;_.isImageBitmapLoader===!0&&(fe=function(be){const me=new Texture(be);me.needsUpdate=!0,de(me)}),_.load(LoaderUtils.resolveURL(ce,ne.path),fe,void 0,pe)})}).then(function(ce){return ae===!0&&ie.revokeObjectURL(se),assignExtrasToUserData(ce,oe),ce.userData.mimeType=oe.mimeType||getImageURIMimeType(oe.uri),ce}).catch(function(ce){throw console.error("THREE.GLTFLoader: Couldn't load texture",se),ce});return this.sourceCache[Z]=ge,ge}assignTexture(Z,_,K,te){const ne=this;return this.getDependency("texture",K.index).then(function(oe){if(!oe)return null;if(K.texCoord!==void 0&&K.texCoord>0&&(oe=oe.clone(),oe.channel=K.texCoord),ne.extensions[EXTENSIONS.KHR_TEXTURE_TRANSFORM]){const ie=K.extensions!==void 0?K.extensions[EXTENSIONS.KHR_TEXTURE_TRANSFORM]:void 0;if(ie){const se=ne.associations.get(oe);oe=ne.extensions[EXTENSIONS.KHR_TEXTURE_TRANSFORM].extendTexture(oe,ie),ne.associations.set(oe,se)}}return te!==void 0&&(typeof te=="number"&&(te=te===sRGBEncoding$1?SRGBColorSpace:LinearSRGBColorSpace),"colorSpace"in oe?oe.colorSpace=te:oe.encoding=te===SRGBColorSpace?sRGBEncoding$1:LinearEncoding$1),Z[_]=oe,oe})}assignFinalMaterial(Z){const _=Z.geometry;let K=Z.material;const te=_.attributes.tangent===void 0,ne=_.attributes.color!==void 0,oe=_.attributes.normal===void 0;if(Z.isPoints){const ie="PointsMaterial:"+K.uuid;let se=this.cache.get(ie);se||(se=new PointsMaterial,Material.prototype.copy.call(se,K),se.color.copy(K.color),se.map=K.map,se.sizeAttenuation=!1,this.cache.add(ie,se)),K=se}else if(Z.isLine){const ie="LineBasicMaterial:"+K.uuid;let se=this.cache.get(ie);se||(se=new LineBasicMaterial,Material.prototype.copy.call(se,K),se.color.copy(K.color),se.map=K.map,this.cache.add(ie,se)),K=se}if(te||ne||oe){let ie="ClonedMaterial:"+K.uuid+":";te&&(ie+="derivative-tangents:"),ne&&(ie+="vertex-colors:"),oe&&(ie+="flat-shading:");let se=this.cache.get(ie);se||(se=K.clone(),ne&&(se.vertexColors=!0),oe&&(se.flatShading=!0),te&&(se.normalScale&&(se.normalScale.y*=-1),se.clearcoatNormalScale&&(se.clearcoatNormalScale.y*=-1)),this.cache.add(ie,se),this.associations.set(se,this.associations.get(K))),K=se}Z.material=K}getMaterialType(){return MeshStandardMaterial}loadMaterial(Z){const _=this,K=this.json,te=this.extensions,ne=K.materials[Z];let oe;const ie={},se=ne.extensions||{},ae=[];if(se[EXTENSIONS.KHR_MATERIALS_UNLIT]){const ce=te[EXTENSIONS.KHR_MATERIALS_UNLIT];oe=ce.getMaterialType(),ae.push(ce.extendParams(ie,ne,_))}else{const ce=ne.pbrMetallicRoughness||{};if(ie.color=new Color$1(1,1,1),ie.opacity=1,Array.isArray(ce.baseColorFactor)){const de=ce.baseColorFactor;ie.color.setRGB(de[0],de[1],de[2],LinearSRGBColorSpace),ie.opacity=de[3]}ce.baseColorTexture!==void 0&&ae.push(_.assignTexture(ie,"map",ce.baseColorTexture,SRGBColorSpace)),ie.metalness=ce.metallicFactor!==void 0?ce.metallicFactor:1,ie.roughness=ce.roughnessFactor!==void 0?ce.roughnessFactor:1,ce.metallicRoughnessTexture!==void 0&&(ae.push(_.assignTexture(ie,"metalnessMap",ce.metallicRoughnessTexture)),ae.push(_.assignTexture(ie,"roughnessMap",ce.metallicRoughnessTexture))),oe=this._invokeOne(function(de){return de.getMaterialType&&de.getMaterialType(Z)}),ae.push(Promise.all(this._invokeAll(function(de){return de.extendMaterialParams&&de.extendMaterialParams(Z,ie)})))}ne.doubleSided===!0&&(ie.side=DoubleSide);const ge=ne.alphaMode||ALPHA_MODES.OPAQUE;if(ge===ALPHA_MODES.BLEND?(ie.transparent=!0,ie.depthWrite=!1):(ie.transparent=!1,ge===ALPHA_MODES.MASK&&(ie.alphaTest=ne.alphaCutoff!==void 0?ne.alphaCutoff:.5)),ne.normalTexture!==void 0&&oe!==MeshBasicMaterial&&(ae.push(_.assignTexture(ie,"normalMap",ne.normalTexture)),ie.normalScale=new Vector2(1,1),ne.normalTexture.scale!==void 0)){const ce=ne.normalTexture.scale;ie.normalScale.set(ce,ce)}if(ne.occlusionTexture!==void 0&&oe!==MeshBasicMaterial&&(ae.push(_.assignTexture(ie,"aoMap",ne.occlusionTexture)),ne.occlusionTexture.strength!==void 0&&(ie.aoMapIntensity=ne.occlusionTexture.strength)),ne.emissiveFactor!==void 0&&oe!==MeshBasicMaterial){const ce=ne.emissiveFactor;ie.emissive=new Color$1().setRGB(ce[0],ce[1],ce[2],LinearSRGBColorSpace)}return ne.emissiveTexture!==void 0&&oe!==MeshBasicMaterial&&ae.push(_.assignTexture(ie,"emissiveMap",ne.emissiveTexture,SRGBColorSpace)),Promise.all(ae).then(function(){const ce=new oe(ie);return ne.name&&(ce.name=ne.name),assignExtrasToUserData(ce,ne),_.associations.set(ce,{materials:Z}),ne.extensions&&addUnknownExtensionsToUserData(te,ce,ne),ce})}createUniqueName(Z){const _=PropertyBinding.sanitizeNodeName(Z||"");return _ in this.nodeNamesUsed?_+"_"+ ++this.nodeNamesUsed[_]:(this.nodeNamesUsed[_]=0,_)}loadGeometries(Z){const _=this,K=this.extensions,te=this.primitiveCache;function ne(ie){return K[EXTENSIONS.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(ie,_).then(function(se){return addPrimitiveAttributes(se,ie,_)})}const oe=[];for(let ie=0,se=Z.length;ie<se;ie++){const ae=Z[ie],ge=createPrimitiveKey(ae),ce=te[ge];if(ce)oe.push(ce.promise);else{let de;ae.extensions&&ae.extensions[EXTENSIONS.KHR_DRACO_MESH_COMPRESSION]?de=ne(ae):de=addPrimitiveAttributes(new BufferGeometry,ae,_),te[ge]={primitive:ae,promise:de},oe.push(de)}}return Promise.all(oe)}loadMesh(Z){const _=this,K=this.json,te=this.extensions,ne=K.meshes[Z],oe=ne.primitives,ie=[];for(let se=0,ae=oe.length;se<ae;se++){const ge=oe[se].material===void 0?createDefaultMaterial(this.cache):this.getDependency("material",oe[se].material);ie.push(ge)}return ie.push(_.loadGeometries(oe)),Promise.all(ie).then(function(se){const ae=se.slice(0,se.length-1),ge=se[se.length-1],ce=[];for(let pe=0,fe=ge.length;pe<fe;pe++){const be=ge[pe],me=oe[pe];let ye;const ve=ae[pe];if(me.mode===WEBGL_CONSTANTS.TRIANGLES||me.mode===WEBGL_CONSTANTS.TRIANGLE_STRIP||me.mode===WEBGL_CONSTANTS.TRIANGLE_FAN||me.mode===void 0)ye=ne.isSkinnedMesh===!0?new SkinnedMesh(be,ve):new Mesh(be,ve),ye.isSkinnedMesh===!0&&ye.normalizeSkinWeights(),me.mode===WEBGL_CONSTANTS.TRIANGLE_STRIP?ye.geometry=toTrianglesDrawMode(ye.geometry,TriangleStripDrawMode):me.mode===WEBGL_CONSTANTS.TRIANGLE_FAN&&(ye.geometry=toTrianglesDrawMode(ye.geometry,TriangleFanDrawMode));else if(me.mode===WEBGL_CONSTANTS.LINES)ye=new LineSegments(be,ve);else if(me.mode===WEBGL_CONSTANTS.LINE_STRIP)ye=new Line(be,ve);else if(me.mode===WEBGL_CONSTANTS.LINE_LOOP)ye=new LineLoop(be,ve);else if(me.mode===WEBGL_CONSTANTS.POINTS)ye=new Points(be,ve);else throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+me.mode);Object.keys(ye.geometry.morphAttributes).length>0&&updateMorphTargets(ye,ne),ye.name=_.createUniqueName(ne.name||"mesh_"+Z),assignExtrasToUserData(ye,ne),me.extensions&&addUnknownExtensionsToUserData(te,ye,me),_.assignFinalMaterial(ye),ce.push(ye)}for(let pe=0,fe=ce.length;pe<fe;pe++)_.associations.set(ce[pe],{meshes:Z,primitives:pe});if(ce.length===1)return ne.extensions&&addUnknownExtensionsToUserData(te,ce[0],ne),ce[0];const de=new Group;ne.extensions&&addUnknownExtensionsToUserData(te,de,ne),_.associations.set(de,{meshes:Z});for(let pe=0,fe=ce.length;pe<fe;pe++)de.add(ce[pe]);return de})}loadCamera(Z){let _;const K=this.json.cameras[Z],te=K[K.type];if(!te){console.warn("THREE.GLTFLoader: Missing camera parameters.");return}return K.type==="perspective"?_=new PerspectiveCamera(MathUtils.radToDeg(te.yfov),te.aspectRatio||1,te.znear||1,te.zfar||2e6):K.type==="orthographic"&&(_=new OrthographicCamera(-te.xmag,te.xmag,te.ymag,-te.ymag,te.znear,te.zfar)),K.name&&(_.name=this.createUniqueName(K.name)),assignExtrasToUserData(_,K),Promise.resolve(_)}loadSkin(Z){const _=this.json.skins[Z],K=[];for(let te=0,ne=_.joints.length;te<ne;te++)K.push(this._loadNodeShallow(_.joints[te]));return _.inverseBindMatrices!==void 0?K.push(this.getDependency("accessor",_.inverseBindMatrices)):K.push(null),Promise.all(K).then(function(te){const ne=te.pop(),oe=te,ie=[],se=[];for(let ae=0,ge=oe.length;ae<ge;ae++){const ce=oe[ae];if(ce){ie.push(ce);const de=new Matrix4;ne!==null&&de.fromArray(ne.array,ae*16),se.push(de)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',_.joints[ae])}return new Skeleton(ie,se)})}loadAnimation(Z){const _=this.json,K=this,te=_.animations[Z],ne=te.name?te.name:"animation_"+Z,oe=[],ie=[],se=[],ae=[],ge=[];for(let ce=0,de=te.channels.length;ce<de;ce++){const pe=te.channels[ce],fe=te.samplers[pe.sampler],be=pe.target,me=be.node,ye=te.parameters!==void 0?te.parameters[fe.input]:fe.input,ve=te.parameters!==void 0?te.parameters[fe.output]:fe.output;be.node!==void 0&&(oe.push(this.getDependency("node",me)),ie.push(this.getDependency("accessor",ye)),se.push(this.getDependency("accessor",ve)),ae.push(fe),ge.push(be))}return Promise.all([Promise.all(oe),Promise.all(ie),Promise.all(se),Promise.all(ae),Promise.all(ge)]).then(function(ce){const de=ce[0],pe=ce[1],fe=ce[2],be=ce[3],me=ce[4],ye=[];for(let ve=0,Be=de.length;ve<Be;ve++){const Re=de[ve],Ee=pe[ve],We=fe[ve],Ze=be[ve],Ve=me[ve];if(Re===void 0)continue;Re.updateMatrix&&Re.updateMatrix();const _e=K._createAnimationTracks(Re,Ee,We,Ze,Ve);if(_e)for(let Xe=0;Xe<_e.length;Xe++)ye.push(_e[Xe])}return new AnimationClip(ne,void 0,ye)})}createNodeMesh(Z){const _=this.json,K=this,te=_.nodes[Z];return te.mesh===void 0?null:K.getDependency("mesh",te.mesh).then(function(ne){const oe=K._getNodeRef(K.meshCache,te.mesh,ne);return te.weights!==void 0&&oe.traverse(function(ie){if(ie.isMesh)for(let se=0,ae=te.weights.length;se<ae;se++)ie.morphTargetInfluences[se]=te.weights[se]}),oe})}loadNode(Z){const _=this.json,K=this,te=_.nodes[Z],ne=K._loadNodeShallow(Z),oe=[],ie=te.children||[];for(let ae=0,ge=ie.length;ae<ge;ae++)oe.push(K.getDependency("node",ie[ae]));const se=te.skin===void 0?Promise.resolve(null):K.getDependency("skin",te.skin);return Promise.all([ne,Promise.all(oe),se]).then(function(ae){const ge=ae[0],ce=ae[1],de=ae[2];de!==null&&ge.traverse(function(pe){pe.isSkinnedMesh&&pe.bind(de,_identityMatrix)});for(let pe=0,fe=ce.length;pe<fe;pe++)ge.add(ce[pe]);return ge})}_loadNodeShallow(Z){const _=this.json,K=this.extensions,te=this;if(this.nodeCache[Z]!==void 0)return this.nodeCache[Z];const ne=_.nodes[Z],oe=ne.name?te.createUniqueName(ne.name):"",ie=[],se=te._invokeOne(function(ae){return ae.createNodeMesh&&ae.createNodeMesh(Z)});return se&&ie.push(se),ne.camera!==void 0&&ie.push(te.getDependency("camera",ne.camera).then(function(ae){return te._getNodeRef(te.cameraCache,ne.camera,ae)})),te._invokeAll(function(ae){return ae.createNodeAttachment&&ae.createNodeAttachment(Z)}).forEach(function(ae){ie.push(ae)}),this.nodeCache[Z]=Promise.all(ie).then(function(ae){let ge;if(ne.isBone===!0?ge=new Bone:ae.length>1?ge=new Group:ae.length===1?ge=ae[0]:ge=new Object3D,ge!==ae[0])for(let ce=0,de=ae.length;ce<de;ce++)ge.add(ae[ce]);if(ne.name&&(ge.userData.name=ne.name,ge.name=oe),assignExtrasToUserData(ge,ne),ne.extensions&&addUnknownExtensionsToUserData(K,ge,ne),ne.matrix!==void 0){const ce=new Matrix4;ce.fromArray(ne.matrix),ge.applyMatrix4(ce)}else ne.translation!==void 0&&ge.position.fromArray(ne.translation),ne.rotation!==void 0&&ge.quaternion.fromArray(ne.rotation),ne.scale!==void 0&&ge.scale.fromArray(ne.scale);return te.associations.has(ge)||te.associations.set(ge,{}),te.associations.get(ge).nodes=Z,ge}),this.nodeCache[Z]}loadScene(Z){const _=this.extensions,K=this.json.scenes[Z],te=this,ne=new Group;K.name&&(ne.name=te.createUniqueName(K.name)),assignExtrasToUserData(ne,K),K.extensions&&addUnknownExtensionsToUserData(_,ne,K);const oe=K.nodes||[],ie=[];for(let se=0,ae=oe.length;se<ae;se++)ie.push(te.getDependency("node",oe[se]));return Promise.all(ie).then(function(se){for(let ge=0,ce=se.length;ge<ce;ge++)ne.add(se[ge]);const ae=ge=>{const ce=new Map;for(const[de,pe]of te.associations)(de instanceof Material||de instanceof Texture)&&ce.set(de,pe);return ge.traverse(de=>{const pe=te.associations.get(de);pe!=null&&ce.set(de,pe)}),ce};return te.associations=ae(ne),ne})}_createAnimationTracks(Z,_,K,te,ne){const oe=[],ie=Z.name?Z.name:Z.uuid,se=[];PATH_PROPERTIES[ne.path]===PATH_PROPERTIES.weights?Z.traverse(function(de){de.morphTargetInfluences&&se.push(de.name?de.name:de.uuid)}):se.push(ie);let ae;switch(PATH_PROPERTIES[ne.path]){case PATH_PROPERTIES.weights:ae=NumberKeyframeTrack;break;case PATH_PROPERTIES.rotation:ae=QuaternionKeyframeTrack;break;case PATH_PROPERTIES.position:case PATH_PROPERTIES.scale:ae=VectorKeyframeTrack;break;default:switch(K.itemSize){case 1:ae=NumberKeyframeTrack;break;case 2:case 3:default:ae=VectorKeyframeTrack;break}break}const ge=te.interpolation!==void 0?INTERPOLATION[te.interpolation]:InterpolateLinear,ce=this._getArrayFromAccessor(K);for(let de=0,pe=se.length;de<pe;de++){const fe=new ae(se[de]+"."+PATH_PROPERTIES[ne.path],_.array,ce,ge);te.interpolation==="CUBICSPLINE"&&this._createCubicSplineTrackInterpolant(fe),oe.push(fe)}return oe}_getArrayFromAccessor(Z){let _=Z.array;if(Z.normalized){const K=getNormalizedComponentScale(_.constructor),te=new Float32Array(_.length);for(let ne=0,oe=_.length;ne<oe;ne++)te[ne]=_[ne]*K;_=te}return _}_createCubicSplineTrackInterpolant(Z){Z.createInterpolant=function(K){const te=this instanceof QuaternionKeyframeTrack?GLTFCubicSplineQuaternionInterpolant:GLTFCubicSplineInterpolant;return new te(this.times,this.values,this.getValueSize()/3,K)},Z.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0}}function computeBounds(X,Z,_){const K=Z.attributes,te=new Box3;if(K.POSITION!==void 0){const ie=_.json.accessors[K.POSITION],se=ie.min,ae=ie.max;if(se!==void 0&&ae!==void 0){if(te.set(new Vector3(se[0],se[1],se[2]),new Vector3(ae[0],ae[1],ae[2])),ie.normalized){const ge=getNormalizedComponentScale(WEBGL_COMPONENT_TYPES[ie.componentType]);te.min.multiplyScalar(ge),te.max.multiplyScalar(ge)}}else{console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");return}}else return;const ne=Z.targets;if(ne!==void 0){const ie=new Vector3,se=new Vector3;for(let ae=0,ge=ne.length;ae<ge;ae++){const ce=ne[ae];if(ce.POSITION!==void 0){const de=_.json.accessors[ce.POSITION],pe=de.min,fe=de.max;if(pe!==void 0&&fe!==void 0){if(se.setX(Math.max(Math.abs(pe[0]),Math.abs(fe[0]))),se.setY(Math.max(Math.abs(pe[1]),Math.abs(fe[1]))),se.setZ(Math.max(Math.abs(pe[2]),Math.abs(fe[2]))),de.normalized){const be=getNormalizedComponentScale(WEBGL_COMPONENT_TYPES[de.componentType]);se.multiplyScalar(be)}ie.max(se)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}te.expandByVector(ie)}X.boundingBox=te;const oe=new Sphere;te.getCenter(oe.center),oe.radius=te.min.distanceTo(te.max)/2,X.boundingSphere=oe}function addPrimitiveAttributes(X,Z,_){const K=Z.attributes,te=[];function ne(oe,ie){return _.getDependency("accessor",oe).then(function(se){X.setAttribute(ie,se)})}for(const oe in K){const ie=ATTRIBUTES[oe]||oe.toLowerCase();ie in X.attributes||te.push(ne(K[oe],ie))}if(Z.indices!==void 0&&!X.index){const oe=_.getDependency("accessor",Z.indices).then(function(ie){X.setIndex(ie)});te.push(oe)}return assignExtrasToUserData(X,Z),computeBounds(X,Z,_),Promise.all(te).then(function(){return Z.targets!==void 0?addMorphTargets(X,Z.targets,_):X})}class RGBELoader extends DataTextureLoader{constructor(Z){super(Z),this.type=HalfFloatType}parse(Z){const oe=function(Ve,_e){switch(Ve){case 1:throw new Error("THREE.RGBELoader: Read Error: "+(_e||""));case 2:throw new Error("THREE.RGBELoader: Write Error: "+(_e||""));case 3:throw new Error("THREE.RGBELoader: Bad File Format: "+(_e||""));default:case 4:throw new Error("THREE.RGBELoader: Memory Error: "+(_e||""))}},ge=`
`,ce=function(Ve,_e,Xe){_e=_e||1024;let He=Ve.pos,Ke=-1,Ue=0,tt="",rt=String.fromCharCode.apply(null,new Uint16Array(Ve.subarray(He,He+128)));for(;0>(Ke=rt.indexOf(ge))&&Ue<_e&&He<Ve.byteLength;)tt+=rt,Ue+=rt.length,He+=128,rt+=String.fromCharCode.apply(null,new Uint16Array(Ve.subarray(He,He+128)));return-1<Ke?(Ve.pos+=Ue+Ke+1,tt+rt.slice(0,Ke)):!1},de=function(Ve){const _e=/^#\?(\S+)/,Xe=/^\s*GAMMA\s*=\s*(\d+(\.\d+)?)\s*$/,Pe=/^\s*EXPOSURE\s*=\s*(\d+(\.\d+)?)\s*$/,He=/^\s*FORMAT=(\S+)\s*$/,Ke=/^\s*\-Y\s+(\d+)\s+\+X\s+(\d+)\s*$/,Ue={valid:0,string:"",comments:"",programtype:"RGBE",format:"",gamma:1,exposure:1,width:0,height:0};let tt,rt;for((Ve.pos>=Ve.byteLength||!(tt=ce(Ve)))&&oe(1,"no header found"),(rt=tt.match(_e))||oe(3,"bad initial token"),Ue.valid|=1,Ue.programtype=rt[1],Ue.string+=tt+`
`;tt=ce(Ve),tt!==!1;){if(Ue.string+=tt+`
`,tt.charAt(0)==="#"){Ue.comments+=tt+`
`;continue}if((rt=tt.match(Xe))&&(Ue.gamma=parseFloat(rt[1])),(rt=tt.match(Pe))&&(Ue.exposure=parseFloat(rt[1])),(rt=tt.match(He))&&(Ue.valid|=2,Ue.format=rt[1]),(rt=tt.match(Ke))&&(Ue.valid|=4,Ue.height=parseInt(rt[1],10),Ue.width=parseInt(rt[2],10)),Ue.valid&2&&Ue.valid&4)break}return Ue.valid&2||oe(3,"missing format specifier"),Ue.valid&4||oe(3,"missing image size specifier"),Ue},pe=function(Ve,_e,Xe){const Pe=_e;if(Pe<8||Pe>32767||Ve[0]!==2||Ve[1]!==2||Ve[2]&128)return new Uint8Array(Ve);Pe!==(Ve[2]<<8|Ve[3])&&oe(3,"wrong scanline width");const He=new Uint8Array(4*_e*Xe);He.length||oe(4,"unable to allocate buffer space");let Ke=0,Ue=0;const tt=4*Pe,rt=new Uint8Array(4),at=new Uint8Array(tt);let Oe=Xe;for(;Oe>0&&Ue<Ve.byteLength;){Ue+4>Ve.byteLength&&oe(1),rt[0]=Ve[Ue++],rt[1]=Ve[Ue++],rt[2]=Ve[Ue++],rt[3]=Ve[Ue++],(rt[0]!=2||rt[1]!=2||(rt[2]<<8|rt[3])!=Pe)&&oe(3,"bad rgbe scanline format");let $e=0,je;for(;$e<tt&&Ue<Ve.byteLength;){je=Ve[Ue++];const De=je>128;if(De&&(je-=128),(je===0||$e+je>tt)&&oe(3,"bad scanline data"),De){const ot=Ve[Ue++];for(let ct=0;ct<je;ct++)at[$e++]=ot}else at.set(Ve.subarray(Ue,Ue+je),$e),$e+=je,Ue+=je}const Te=Pe;for(let De=0;De<Te;De++){let ot=0;He[Ke]=at[De+ot],ot+=Pe,He[Ke+1]=at[De+ot],ot+=Pe,He[Ke+2]=at[De+ot],ot+=Pe,He[Ke+3]=at[De+ot],Ke+=4}Oe--}return He},fe=function(Ve,_e,Xe,Pe){const He=Ve[_e+3],Ke=Math.pow(2,He-128)/255;Xe[Pe+0]=Ve[_e+0]*Ke,Xe[Pe+1]=Ve[_e+1]*Ke,Xe[Pe+2]=Ve[_e+2]*Ke,Xe[Pe+3]=1},be=function(Ve,_e,Xe,Pe){const He=Ve[_e+3],Ke=Math.pow(2,He-128)/255;Xe[Pe+0]=DataUtils.toHalfFloat(Math.min(Ve[_e+0]*Ke,65504)),Xe[Pe+1]=DataUtils.toHalfFloat(Math.min(Ve[_e+1]*Ke,65504)),Xe[Pe+2]=DataUtils.toHalfFloat(Math.min(Ve[_e+2]*Ke,65504)),Xe[Pe+3]=DataUtils.toHalfFloat(1)},me=new Uint8Array(Z);me.pos=0;const ye=de(me),ve=ye.width,Be=ye.height,Re=pe(me.subarray(me.pos),ve,Be);let Ee,We,Ze;switch(this.type){case FloatType:Ze=Re.length/4;const Ve=new Float32Array(Ze*4);for(let Xe=0;Xe<Ze;Xe++)fe(Re,Xe*4,Ve,Xe*4);Ee=Ve,We=FloatType;break;case HalfFloatType:Ze=Re.length/4;const _e=new Uint16Array(Ze*4);for(let Xe=0;Xe<Ze;Xe++)be(Re,Xe*4,_e,Xe*4);Ee=_e,We=HalfFloatType;break;default:throw new Error("THREE.RGBELoader: Unsupported type: "+this.type)}return{width:ve,height:Be,data:Ee,header:ye.string,gamma:ye.gamma,exposure:ye.exposure,type:We}}setDataType(Z){return this.type=Z,this}load(Z,_,K,te){function ne(oe,ie){switch(oe.type){case FloatType:case HalfFloatType:"colorSpace"in oe?oe.colorSpace="srgb-linear":oe.encoding=3e3,oe.minFilter=LinearFilter,oe.magFilter=LinearFilter,oe.generateMipmaps=!1,oe.flipY=!0;break}_&&_(oe,ie)}return super.load(Z,ne,K,te)}}const hasColorSpace=version>=152;class EXRLoader extends DataTextureLoader{constructor(Z){super(Z),this.type=HalfFloatType}parse(Z){const _e=Math.pow(2.7182818,2.2);function Xe(Qe,ke){for(var it=0,ut=0;ut<65536;++ut)(ut==0||Qe[ut>>3]&1<<(ut&7))&&(ke[it++]=ut);for(var lt=it-1;it<65536;)ke[it++]=0;return lt}function Pe(Qe){for(var ke=0;ke<16384;ke++)Qe[ke]={},Qe[ke].len=0,Qe[ke].lit=0,Qe[ke].p=null}const He={l:0,c:0,lc:0};function Ke(Qe,ke,it,ut,lt){for(;it<Qe;)ke=ke<<8|$t(ut,lt),it+=8;it-=Qe,He.l=ke>>it&(1<<Qe)-1,He.c=ke,He.lc=it}const Ue=new Array(59);function tt(Qe){for(var ke=0;ke<=58;++ke)Ue[ke]=0;for(var ke=0;ke<65537;++ke)Ue[Qe[ke]]+=1;for(var it=0,ke=58;ke>0;--ke){var ut=it+Ue[ke]>>1;Ue[ke]=it,it=ut}for(var ke=0;ke<65537;++ke){var lt=Qe[ke];lt>0&&(Qe[ke]=lt|Ue[lt]++<<6)}}function rt(Qe,ke,it,ut,lt,It,Nt){for(var Xt=it,Ot=0,Jt=0;lt<=It;lt++){if(Xt.value-it.value>ut)return!1;Ke(6,Ot,Jt,Qe,Xt);var qt=He.l;if(Ot=He.c,Jt=He.lc,Nt[lt]=qt,qt==63){if(Xt.value-it.value>ut)throw"Something wrong with hufUnpackEncTable";Ke(8,Ot,Jt,Qe,Xt);var yt=He.l+6;if(Ot=He.c,Jt=He.lc,lt+yt>It+1)throw"Something wrong with hufUnpackEncTable";for(;yt--;)Nt[lt++]=0;lt--}else if(qt>=59){var yt=qt-59+2;if(lt+yt>It+1)throw"Something wrong with hufUnpackEncTable";for(;yt--;)Nt[lt++]=0;lt--}}tt(Nt)}function at(Qe){return Qe&63}function Oe(Qe){return Qe>>6}function $e(Qe,ke,it,ut){for(;ke<=it;ke++){var lt=Oe(Qe[ke]),It=at(Qe[ke]);if(lt>>It)throw"Invalid table entry";if(It>14){var Nt=ut[lt>>It-14];if(Nt.len)throw"Invalid table entry";if(Nt.lit++,Nt.p){var Xt=Nt.p;Nt.p=new Array(Nt.lit);for(var Ot=0;Ot<Nt.lit-1;++Ot)Nt.p[Ot]=Xt[Ot]}else Nt.p=new Array(1);Nt.p[Nt.lit-1]=ke}else if(It)for(var Jt=0,Ot=1<<14-It;Ot>0;Ot--){var Nt=ut[(lt<<14-It)+Jt];if(Nt.len||Nt.p)throw"Invalid table entry";Nt.len=It,Nt.lit=ke,Jt++}}return!0}const je={c:0,lc:0};function Te(Qe,ke,it,ut){Qe=Qe<<8|$t(it,ut),ke+=8,je.c=Qe,je.lc=ke}const De={c:0,lc:0};function ot(Qe,ke,it,ut,lt,It,Nt,Xt,Ot,Jt){if(Qe==ke){ut<8&&(Te(it,ut,lt,Nt),it=je.c,ut=je.lc),ut-=8;var qt=it>>ut,qt=new Uint8Array([qt])[0];if(Ot.value+qt>Jt)return!1;for(var yt=Xt[Ot.value-1];qt-- >0;)Xt[Ot.value++]=yt}else if(Ot.value<Jt)Xt[Ot.value++]=Qe;else return!1;De.c=it,De.lc=ut}function ct(Qe){return Qe&65535}function gt(Qe){var ke=ct(Qe);return ke>32767?ke-65536:ke}const pt={a:0,b:0};function ht(Qe,ke){var it=gt(Qe),ut=gt(ke),lt=ut,It=it+(lt&1)+(lt>>1),Nt=It,Xt=It-lt;pt.a=Nt,pt.b=Xt}function At(Qe,ke){var it=ct(Qe),ut=ct(ke),lt=it-(ut>>1)&65535,It=ut+lt-32768&65535;pt.a=It,pt.b=lt}function Kt(Qe,ke,it,ut,lt,It,Nt){for(var Xt=Nt<16384,Ot=it>lt?lt:it,Jt=1,qt;Jt<=Ot;)Jt<<=1;for(Jt>>=1,qt=Jt,Jt>>=1;Jt>=1;){for(var yt=0,yn=yt+It*(lt-qt),Cn=It*Jt,hn=It*qt,xn=ut*Jt,Hn=ut*qt,Wn,bn,_n,Zn;yt<=yn;yt+=hn){for(var Nn=yt,gr=yt+ut*(it-qt);Nn<=gr;Nn+=Hn){var Dn=Nn+xn,cr=Nn+Cn,tr=cr+xn;Xt?(ht(Qe[Nn+ke],Qe[cr+ke]),Wn=pt.a,_n=pt.b,ht(Qe[Dn+ke],Qe[tr+ke]),bn=pt.a,Zn=pt.b,ht(Wn,bn),Qe[Nn+ke]=pt.a,Qe[Dn+ke]=pt.b,ht(_n,Zn),Qe[cr+ke]=pt.a,Qe[tr+ke]=pt.b):(At(Qe[Nn+ke],Qe[cr+ke]),Wn=pt.a,_n=pt.b,At(Qe[Dn+ke],Qe[tr+ke]),bn=pt.a,Zn=pt.b,At(Wn,bn),Qe[Nn+ke]=pt.a,Qe[Dn+ke]=pt.b,At(_n,Zn),Qe[cr+ke]=pt.a,Qe[tr+ke]=pt.b)}if(it&Jt){var cr=Nn+Cn;Xt?ht(Qe[Nn+ke],Qe[cr+ke]):At(Qe[Nn+ke],Qe[cr+ke]),Wn=pt.a,Qe[cr+ke]=pt.b,Qe[Nn+ke]=Wn}}if(lt&Jt)for(var Nn=yt,gr=yt+ut*(it-qt);Nn<=gr;Nn+=Hn){var Dn=Nn+xn;Xt?ht(Qe[Nn+ke],Qe[Dn+ke]):At(Qe[Nn+ke],Qe[Dn+ke]),Wn=pt.a,Qe[Dn+ke]=pt.b,Qe[Nn+ke]=Wn}qt=Jt,Jt>>=1}return yt}function en(Qe,ke,it,ut,lt,It,Nt,Xt,Ot,Jt){for(var qt=0,yt=0,yn=Xt,Cn=Math.trunc(lt.value+(It+7)/8);lt.value<Cn;)for(Te(qt,yt,it,lt),qt=je.c,yt=je.lc;yt>=14;){var hn=qt>>yt-14&16383,xn=ke[hn];if(xn.len)yt-=xn.len,ot(xn.lit,Nt,qt,yt,it,ut,lt,Ot,Jt,yn),qt=De.c,yt=De.lc;else{if(!xn.p)throw"hufDecode issues";var Hn;for(Hn=0;Hn<xn.lit;Hn++){for(var Wn=at(Qe[xn.p[Hn]]);yt<Wn&&lt.value<Cn;)Te(qt,yt,it,lt),qt=je.c,yt=je.lc;if(yt>=Wn&&Oe(Qe[xn.p[Hn]])==(qt>>yt-Wn&(1<<Wn)-1)){yt-=Wn,ot(xn.p[Hn],Nt,qt,yt,it,ut,lt,Ot,Jt,yn),qt=De.c,yt=De.lc;break}}if(Hn==xn.lit)throw"hufDecode issues"}}var bn=8-It&7;for(qt>>=bn,yt-=bn;yt>0;){var xn=ke[qt<<14-yt&16383];if(xn.len)yt-=xn.len,ot(xn.lit,Nt,qt,yt,it,ut,lt,Ot,Jt,yn),qt=De.c,yt=De.lc;else throw"hufDecode issues"}return!0}function Zt(Qe,ke,it,ut,lt,It){var Nt={value:0},Xt=it.value,Ot=rn(ke,it),Jt=rn(ke,it);it.value+=4;var qt=rn(ke,it);if(it.value+=4,Ot<0||Ot>=65537||Jt<0||Jt>=65537)throw"Something wrong with HUF_ENCSIZE";var yt=new Array(65537),yn=new Array(16384);Pe(yn);var Cn=ut-(it.value-Xt);if(rt(Qe,ke,it,Cn,Ot,Jt,yt),qt>8*(ut-(it.value-Xt)))throw"Something wrong with hufUncompress";$e(yt,Ot,Jt,yn),en(yt,yn,Qe,ke,it,qt,Jt,It,lt,Nt)}function st(Qe,ke,it){for(var ut=0;ut<it;++ut)ke[ut]=Qe[ke[ut]]}function Vt(Qe){for(var ke=1;ke<Qe.length;ke++){var it=Qe[ke-1]+Qe[ke]-128;Qe[ke]=it}}function wt(Qe,ke){for(var it=0,ut=Math.floor((Qe.length+1)/2),lt=0,It=Qe.length-1;!(lt>It||(ke[lt++]=Qe[it++],lt>It));)ke[lt++]=Qe[ut++]}function St(Qe){for(var ke=Qe.byteLength,it=new Array,ut=0,lt=new DataView(Qe);ke>0;){var It=lt.getInt8(ut++);if(It<0){var Nt=-It;ke-=Nt+1;for(var Xt=0;Xt<Nt;Xt++)it.push(lt.getUint8(ut++))}else{var Nt=It;ke-=2;for(var Ot=lt.getUint8(ut++),Xt=0;Xt<Nt+1;Xt++)it.push(Ot)}}return it}function Rt(Qe,ke,it,ut,lt,It){var Dn=new DataView(It.buffer),Nt=it[Qe.idx[0]].width,Xt=it[Qe.idx[0]].height,Ot=3,Jt=Math.floor(Nt/8),qt=Math.ceil(Nt/8),yt=Math.ceil(Xt/8),yn=Nt-(qt-1)*8,Cn=Xt-(yt-1)*8,hn={value:0},xn=new Array(Ot),Hn=new Array(Ot),Wn=new Array(Ot),bn=new Array(Ot),_n=new Array(Ot);for(let Kn=0;Kn<Ot;++Kn)_n[Kn]=ke[Qe.idx[Kn]],xn[Kn]=Kn<1?0:xn[Kn-1]+qt*yt,Hn[Kn]=new Float32Array(64),Wn[Kn]=new Uint16Array(64),bn[Kn]=new Uint16Array(qt*64);for(let Kn=0;Kn<yt;++Kn){var Zn=8;Kn==yt-1&&(Zn=Cn);var Nn=8;for(let ar=0;ar<qt;++ar){ar==qt-1&&(Nn=yn);for(let jn=0;jn<Ot;++jn)Wn[jn].fill(0),Wn[jn][0]=lt[xn[jn]++],jt(hn,ut,Wn[jn]),Wt(Wn[jn],Hn[jn]),Ht(Hn[jn]);Pt(Hn);for(let jn=0;jn<Ot;++jn)Mt(Hn[jn],bn[jn],ar*64)}let yr=0;for(let ar=0;ar<Ot;++ar){const jn=it[Qe.idx[ar]].type;for(let vr=8*Kn;vr<8*Kn+Zn;++vr){yr=_n[ar][vr];for(let mi=0;mi<Jt;++mi){const wr=mi*64+(vr&7)*8;Dn.setUint16(yr+0*2*jn,bn[ar][wr+0],!0),Dn.setUint16(yr+1*2*jn,bn[ar][wr+1],!0),Dn.setUint16(yr+2*2*jn,bn[ar][wr+2],!0),Dn.setUint16(yr+3*2*jn,bn[ar][wr+3],!0),Dn.setUint16(yr+4*2*jn,bn[ar][wr+4],!0),Dn.setUint16(yr+5*2*jn,bn[ar][wr+5],!0),Dn.setUint16(yr+6*2*jn,bn[ar][wr+6],!0),Dn.setUint16(yr+7*2*jn,bn[ar][wr+7],!0),yr+=8*2*jn}}if(Jt!=qt)for(let vr=8*Kn;vr<8*Kn+Zn;++vr){const mi=_n[ar][vr]+8*Jt*2*jn,wr=Jt*64+(vr&7)*8;for(let Ki=0;Ki<Nn;++Ki)Dn.setUint16(mi+Ki*2*jn,bn[ar][wr+Ki],!0)}}}for(var gr=new Uint16Array(Nt),Dn=new DataView(It.buffer),cr=0;cr<Ot;++cr){it[Qe.idx[cr]].decoded=!0;var tr=it[Qe.idx[cr]].type;if(it[cr].type==2)for(var sr=0;sr<Xt;++sr){const Kn=_n[cr][sr];for(var Ir=0;Ir<Nt;++Ir)gr[Ir]=Dn.getUint16(Kn+Ir*2*tr,!0);for(var Ir=0;Ir<Nt;++Ir)Dn.setFloat32(Kn+Ir*2*tr,vt(gr[Ir]),!0)}}}function jt(Qe,ke,it){for(var ut,lt=1;lt<64;)ut=ke[Qe.value],ut==65280?lt=64:ut>>8==255?lt+=ut&255:(it[lt]=ut,lt++),Qe.value++}function Wt(Qe,ke){ke[0]=vt(Qe[0]),ke[1]=vt(Qe[1]),ke[2]=vt(Qe[5]),ke[3]=vt(Qe[6]),ke[4]=vt(Qe[14]),ke[5]=vt(Qe[15]),ke[6]=vt(Qe[27]),ke[7]=vt(Qe[28]),ke[8]=vt(Qe[2]),ke[9]=vt(Qe[4]),ke[10]=vt(Qe[7]),ke[11]=vt(Qe[13]),ke[12]=vt(Qe[16]),ke[13]=vt(Qe[26]),ke[14]=vt(Qe[29]),ke[15]=vt(Qe[42]),ke[16]=vt(Qe[3]),ke[17]=vt(Qe[8]),ke[18]=vt(Qe[12]),ke[19]=vt(Qe[17]),ke[20]=vt(Qe[25]),ke[21]=vt(Qe[30]),ke[22]=vt(Qe[41]),ke[23]=vt(Qe[43]),ke[24]=vt(Qe[9]),ke[25]=vt(Qe[11]),ke[26]=vt(Qe[18]),ke[27]=vt(Qe[24]),ke[28]=vt(Qe[31]),ke[29]=vt(Qe[40]),ke[30]=vt(Qe[44]),ke[31]=vt(Qe[53]),ke[32]=vt(Qe[10]),ke[33]=vt(Qe[19]),ke[34]=vt(Qe[23]),ke[35]=vt(Qe[32]),ke[36]=vt(Qe[39]),ke[37]=vt(Qe[45]),ke[38]=vt(Qe[52]),ke[39]=vt(Qe[54]),ke[40]=vt(Qe[20]),ke[41]=vt(Qe[22]),ke[42]=vt(Qe[33]),ke[43]=vt(Qe[38]),ke[44]=vt(Qe[46]),ke[45]=vt(Qe[51]),ke[46]=vt(Qe[55]),ke[47]=vt(Qe[60]),ke[48]=vt(Qe[21]),ke[49]=vt(Qe[34]),ke[50]=vt(Qe[37]),ke[51]=vt(Qe[47]),ke[52]=vt(Qe[50]),ke[53]=vt(Qe[56]),ke[54]=vt(Qe[59]),ke[55]=vt(Qe[61]),ke[56]=vt(Qe[35]),ke[57]=vt(Qe[36]),ke[58]=vt(Qe[48]),ke[59]=vt(Qe[49]),ke[60]=vt(Qe[57]),ke[61]=vt(Qe[58]),ke[62]=vt(Qe[62]),ke[63]=vt(Qe[63])}function Ht(Qe){const ke=.5*Math.cos(.7853975),it=.5*Math.cos(3.14159/16),ut=.5*Math.cos(3.14159/8),lt=.5*Math.cos(3*3.14159/16),It=.5*Math.cos(5*3.14159/16),Nt=.5*Math.cos(3*3.14159/8),Xt=.5*Math.cos(7*3.14159/16);for(var Ot=new Array(4),Jt=new Array(4),qt=new Array(4),yt=new Array(4),yn=0;yn<8;++yn){var Cn=yn*8;Ot[0]=ut*Qe[Cn+2],Ot[1]=Nt*Qe[Cn+2],Ot[2]=ut*Qe[Cn+6],Ot[3]=Nt*Qe[Cn+6],Jt[0]=it*Qe[Cn+1]+lt*Qe[Cn+3]+It*Qe[Cn+5]+Xt*Qe[Cn+7],Jt[1]=lt*Qe[Cn+1]-Xt*Qe[Cn+3]-it*Qe[Cn+5]-It*Qe[Cn+7],Jt[2]=It*Qe[Cn+1]-it*Qe[Cn+3]+Xt*Qe[Cn+5]+lt*Qe[Cn+7],Jt[3]=Xt*Qe[Cn+1]-It*Qe[Cn+3]+lt*Qe[Cn+5]-it*Qe[Cn+7],qt[0]=ke*(Qe[Cn+0]+Qe[Cn+4]),qt[3]=ke*(Qe[Cn+0]-Qe[Cn+4]),qt[1]=Ot[0]+Ot[3],qt[2]=Ot[1]-Ot[2],yt[0]=qt[0]+qt[1],yt[1]=qt[3]+qt[2],yt[2]=qt[3]-qt[2],yt[3]=qt[0]-qt[1],Qe[Cn+0]=yt[0]+Jt[0],Qe[Cn+1]=yt[1]+Jt[1],Qe[Cn+2]=yt[2]+Jt[2],Qe[Cn+3]=yt[3]+Jt[3],Qe[Cn+4]=yt[3]-Jt[3],Qe[Cn+5]=yt[2]-Jt[2],Qe[Cn+6]=yt[1]-Jt[1],Qe[Cn+7]=yt[0]-Jt[0]}for(var hn=0;hn<8;++hn)Ot[0]=ut*Qe[16+hn],Ot[1]=Nt*Qe[16+hn],Ot[2]=ut*Qe[48+hn],Ot[3]=Nt*Qe[48+hn],Jt[0]=it*Qe[8+hn]+lt*Qe[24+hn]+It*Qe[40+hn]+Xt*Qe[56+hn],Jt[1]=lt*Qe[8+hn]-Xt*Qe[24+hn]-it*Qe[40+hn]-It*Qe[56+hn],Jt[2]=It*Qe[8+hn]-it*Qe[24+hn]+Xt*Qe[40+hn]+lt*Qe[56+hn],Jt[3]=Xt*Qe[8+hn]-It*Qe[24+hn]+lt*Qe[40+hn]-it*Qe[56+hn],qt[0]=ke*(Qe[hn]+Qe[32+hn]),qt[3]=ke*(Qe[hn]-Qe[32+hn]),qt[1]=Ot[0]+Ot[3],qt[2]=Ot[1]-Ot[2],yt[0]=qt[0]+qt[1],yt[1]=qt[3]+qt[2],yt[2]=qt[3]-qt[2],yt[3]=qt[0]-qt[1],Qe[0+hn]=yt[0]+Jt[0],Qe[8+hn]=yt[1]+Jt[1],Qe[16+hn]=yt[2]+Jt[2],Qe[24+hn]=yt[3]+Jt[3],Qe[32+hn]=yt[3]-Jt[3],Qe[40+hn]=yt[2]-Jt[2],Qe[48+hn]=yt[1]-Jt[1],Qe[56+hn]=yt[0]-Jt[0]}function Pt(Qe){for(var ke=0;ke<64;++ke){var it=Qe[0][ke],ut=Qe[1][ke],lt=Qe[2][ke];Qe[0][ke]=it+1.5747*lt,Qe[1][ke]=it-.1873*ut-.4682*lt,Qe[2][ke]=it+1.8556*ut}}function Mt(Qe,ke,it){for(var ut=0;ut<64;++ut)ke[it+ut]=DataUtils.toHalfFloat(un(Qe[ut]))}function un(Qe){return Qe<=1?Math.sign(Qe)*Math.pow(Math.abs(Qe),2.2):Math.sign(Qe)*Math.pow(_e,Math.abs(Qe)-1)}function qe(Qe){return new DataView(Qe.array.buffer,Qe.offset.value,Qe.size)}function Je(Qe){var ke=Qe.viewer.buffer.slice(Qe.offset.value,Qe.offset.value+Qe.size),it=new Uint8Array(St(ke)),ut=new Uint8Array(it.length);return Vt(it),wt(it,ut),new DataView(ut.buffer)}function mt(Qe){var ke=Qe.array.slice(Qe.offset.value,Qe.offset.value+Qe.size),it=unzlibSync(ke),ut=new Uint8Array(it.length);return Vt(it),wt(it,ut),new DataView(ut.buffer)}function Dt(Qe){for(var ke=Qe.viewer,it={value:Qe.offset.value},ut=new Uint16Array(Qe.width*Qe.scanlineBlockSize*(Qe.channels*Qe.type)),lt=new Uint8Array(8192),It=0,Nt=new Array(Qe.channels),Xt=0;Xt<Qe.channels;Xt++)Nt[Xt]={},Nt[Xt].start=It,Nt[Xt].end=Nt[Xt].start,Nt[Xt].nx=Qe.width,Nt[Xt].ny=Qe.lines,Nt[Xt].size=Qe.type,It+=Nt[Xt].nx*Nt[Xt].ny*Nt[Xt].size;var Ot=Et(ke,it),Jt=Et(ke,it);if(Jt>=8192)throw"Something is wrong with PIZ_COMPRESSION BITMAP_SIZE";if(Ot<=Jt)for(var Xt=0;Xt<Jt-Ot+1;Xt++)lt[Xt+Ot]=on(ke,it);var qt=new Uint16Array(65536),yt=Xe(lt,qt),yn=rn(ke,it);Zt(Qe.array,ke,it,yn,ut,It);for(var Xt=0;Xt<Qe.channels;++Xt)for(var Cn=Nt[Xt],hn=0;hn<Nt[Xt].size;++hn)Kt(ut,Cn.start+hn,Cn.nx,Cn.size,Cn.ny,Cn.nx*Cn.size,yt);st(qt,ut,It);for(var xn=0,Hn=new Uint8Array(ut.buffer.byteLength),Wn=0;Wn<Qe.lines;Wn++)for(var bn=0;bn<Qe.channels;bn++){var Cn=Nt[bn],_n=Cn.nx*Cn.size,Zn=new Uint8Array(ut.buffer,Cn.end*2,_n*2);Hn.set(Zn,xn),xn+=_n*2,Cn.end+=_n}return new DataView(Hn.buffer)}function _t(Qe){var ke=Qe.array.slice(Qe.offset.value,Qe.offset.value+Qe.size),it=unzlibSync(ke);const ut=Qe.lines*Qe.channels*Qe.width,lt=Qe.type==1?new Uint16Array(ut):new Uint32Array(ut);let It=0,Nt=0;const Xt=new Array(4);for(let Ot=0;Ot<Qe.lines;Ot++)for(let Jt=0;Jt<Qe.channels;Jt++){let qt=0;switch(Qe.type){case 1:Xt[0]=It,Xt[1]=Xt[0]+Qe.width,It=Xt[1]+Qe.width;for(let yt=0;yt<Qe.width;++yt){const yn=it[Xt[0]++]<<8|it[Xt[1]++];qt+=yn,lt[Nt]=qt,Nt++}break;case 2:Xt[0]=It,Xt[1]=Xt[0]+Qe.width,Xt[2]=Xt[1]+Qe.width,It=Xt[2]+Qe.width;for(let yt=0;yt<Qe.width;++yt){const yn=it[Xt[0]++]<<24|it[Xt[1]++]<<16|it[Xt[2]++]<<8;qt+=yn,lt[Nt]=qt,Nt++}break}}return new DataView(lt.buffer)}function zt(Qe){var ke=Qe.viewer,it={value:Qe.offset.value},ut=new Uint8Array(Qe.width*Qe.lines*(Qe.channels*Qe.type*2)),lt={version:An(ke,it),unknownUncompressedSize:An(ke,it),unknownCompressedSize:An(ke,it),acCompressedSize:An(ke,it),dcCompressedSize:An(ke,it),rleCompressedSize:An(ke,it),rleUncompressedSize:An(ke,it),rleRawSize:An(ke,it),totalAcUncompressedCount:An(ke,it),totalDcUncompressedCount:An(ke,it),acCompression:An(ke,it)};if(lt.version<2)throw"EXRLoader.parse: "+br.compression+" version "+lt.version+" is unsupported";for(var It=new Array,Nt=Et(ke,it)-2;Nt>0;){var Xt=nn(ke.buffer,it),Ot=on(ke,it),Jt=Ot>>2&3,qt=(Ot>>4)-1,yt=new Int8Array([qt])[0],yn=on(ke,it);It.push({name:Xt,index:yt,type:yn,compression:Jt}),Nt-=Xt.length+3}for(var Cn=br.channels,hn=new Array(Qe.channels),xn=0;xn<Qe.channels;++xn){var Hn=hn[xn]={},Wn=Cn[xn];Hn.name=Wn.name,Hn.compression=0,Hn.decoded=!1,Hn.type=Wn.pixelType,Hn.pLinear=Wn.pLinear,Hn.width=Qe.width,Hn.height=Qe.lines}for(var bn={idx:new Array(3)},_n=0;_n<Qe.channels;++_n)for(var Hn=hn[_n],xn=0;xn<It.length;++xn){var Zn=It[xn];Hn.name==Zn.name&&(Hn.compression=Zn.compression,Zn.index>=0&&(bn.idx[Zn.index]=_n),Hn.offset=_n)}if(lt.acCompressedSize>0)switch(lt.acCompression){case 0:var Dn=new Uint16Array(lt.totalAcUncompressedCount);Zt(Qe.array,ke,it,lt.acCompressedSize,Dn,lt.totalAcUncompressedCount);break;case 1:var Nn=Qe.array.slice(it.value,it.value+lt.totalAcUncompressedCount),gr=unzlibSync(Nn),Dn=new Uint16Array(gr.buffer);it.value+=lt.totalAcUncompressedCount;break}if(lt.dcCompressedSize>0){var cr={array:Qe.array,offset:it,size:lt.dcCompressedSize},tr=new Uint16Array(mt(cr).buffer);it.value+=lt.dcCompressedSize}if(lt.rleRawSize>0){var Nn=Qe.array.slice(it.value,it.value+lt.rleCompressedSize),gr=unzlibSync(Nn),sr=St(gr.buffer);it.value+=lt.rleCompressedSize}for(var Ir=0,Kn=new Array(hn.length),xn=0;xn<Kn.length;++xn)Kn[xn]=new Array;for(var yr=0;yr<Qe.lines;++yr)for(var ar=0;ar<hn.length;++ar)Kn[ar].push(Ir),Ir+=hn[ar].width*Qe.type*2;Rt(bn,Kn,hn,Dn,tr,ut);for(var xn=0;xn<hn.length;++xn){var Hn=hn[xn];if(!Hn.decoded)switch(Hn.compression){case 2:for(var jn=0,vr=0,yr=0;yr<Qe.lines;++yr){for(var mi=Kn[xn][jn],wr=0;wr<Hn.width;++wr){for(var Ki=0;Ki<2*Hn.type;++Ki)ut[mi++]=sr[vr+Ki*Hn.width*Hn.height];vr++}jn++}break;case 1:default:throw"EXRLoader.parse: unsupported channel compression"}}return new DataView(ut.buffer)}function nn(Qe,ke){for(var it=new Uint8Array(Qe),ut=0;it[ke.value+ut]!=0;)ut+=1;var lt=new TextDecoder().decode(it.slice(ke.value,ke.value+ut));return ke.value=ke.value+ut+1,lt}function tn(Qe,ke,it){var ut=new TextDecoder().decode(new Uint8Array(Qe).slice(ke.value,ke.value+it));return ke.value=ke.value+it,ut}function Ft(Qe,ke){var it=sn(Qe,ke),ut=rn(Qe,ke);return[it,ut]}function pn(Qe,ke){var it=rn(Qe,ke),ut=rn(Qe,ke);return[it,ut]}function sn(Qe,ke){var it=Qe.getInt32(ke.value,!0);return ke.value=ke.value+4,it}function rn(Qe,ke){var it=Qe.getUint32(ke.value,!0);return ke.value=ke.value+4,it}function $t(Qe,ke){var it=Qe[ke.value];return ke.value=ke.value+1,it}function on(Qe,ke){var it=Qe.getUint8(ke.value);return ke.value=ke.value+1,it}const An=function(Qe,ke){let it;return"getBigInt64"in DataView.prototype?it=Number(Qe.getBigInt64(ke.value,!0)):it=Qe.getUint32(ke.value+4,!0)+Number(Qe.getUint32(ke.value,!0)<<32),ke.value+=8,it};function wn(Qe,ke){var it=Qe.getFloat32(ke.value,!0);return ke.value+=4,it}function ft(Qe,ke){return DataUtils.toHalfFloat(wn(Qe,ke))}function vt(Qe){var ke=(Qe&31744)>>10,it=Qe&1023;return(Qe>>15?-1:1)*(ke?ke===31?it?NaN:1/0:Math.pow(2,ke-15)*(1+it/1024):6103515625e-14*(it/1024))}function Et(Qe,ke){var it=Qe.getUint16(ke.value,!0);return ke.value+=2,it}function gn(Qe,ke){return vt(Et(Qe,ke))}function an(Qe,ke,it,ut){for(var lt=it.value,It=[];it.value<lt+ut-1;){var Nt=nn(ke,it),Xt=sn(Qe,it),Ot=on(Qe,it);it.value+=3;var Jt=sn(Qe,it),qt=sn(Qe,it);It.push({name:Nt,pixelType:Xt,pLinear:Ot,xSampling:Jt,ySampling:qt})}return it.value+=1,It}function vn(Qe,ke){var it=wn(Qe,ke),ut=wn(Qe,ke),lt=wn(Qe,ke),It=wn(Qe,ke),Nt=wn(Qe,ke),Xt=wn(Qe,ke),Ot=wn(Qe,ke),Jt=wn(Qe,ke);return{redX:it,redY:ut,greenX:lt,greenY:It,blueX:Nt,blueY:Xt,whiteX:Ot,whiteY:Jt}}function zn(Qe,ke){var it=["NO_COMPRESSION","RLE_COMPRESSION","ZIPS_COMPRESSION","ZIP_COMPRESSION","PIZ_COMPRESSION","PXR24_COMPRESSION","B44_COMPRESSION","B44A_COMPRESSION","DWAA_COMPRESSION","DWAB_COMPRESSION"],ut=on(Qe,ke);return it[ut]}function On(Qe,ke){var it=rn(Qe,ke),ut=rn(Qe,ke),lt=rn(Qe,ke),It=rn(Qe,ke);return{xMin:it,yMin:ut,xMax:lt,yMax:It}}function Tn(Qe,ke){var it=["INCREASING_Y"],ut=on(Qe,ke);return it[ut]}function Xn(Qe,ke){var it=wn(Qe,ke),ut=wn(Qe,ke);return[it,ut]}function dr(Qe,ke){var it=wn(Qe,ke),ut=wn(Qe,ke),lt=wn(Qe,ke);return[it,ut,lt]}function rr(Qe,ke,it,ut,lt){if(ut==="string"||ut==="stringvector"||ut==="iccProfile")return tn(ke,it,lt);if(ut==="chlist")return an(Qe,ke,it,lt);if(ut==="chromaticities")return vn(Qe,it);if(ut==="compression")return zn(Qe,it);if(ut==="box2i")return On(Qe,it);if(ut==="lineOrder")return Tn(Qe,it);if(ut==="float")return wn(Qe,it);if(ut==="v2f")return Xn(Qe,it);if(ut==="v3f")return dr(Qe,it);if(ut==="int")return sn(Qe,it);if(ut==="rational")return Ft(Qe,it);if(ut==="timecode")return pn(Qe,it);if(ut==="preview")return it.value+=lt,"skipped";it.value+=lt}function fr(Qe,ke,it){const ut={};if(Qe.getUint32(0,!0)!=20000630)throw"THREE.EXRLoader: provided file doesn't appear to be in OpenEXR format.";ut.version=Qe.getUint8(4);const lt=Qe.getUint8(5);ut.spec={singleTile:!!(lt&2),longName:!!(lt&4),deepFormat:!!(lt&8),multiPart:!!(lt&16)},it.value=8;for(var It=!0;It;){var Nt=nn(ke,it);if(Nt==0)It=!1;else{var Xt=nn(ke,it),Ot=rn(Qe,it),Jt=rr(Qe,ke,it,Xt,Ot);Jt===void 0?console.warn(`EXRLoader.parse: skipped unknown header attribute type '${Xt}'.`):ut[Nt]=Jt}}if((lt&-5)!=0)throw console.error("EXRHeader:",ut),"THREE.EXRLoader: provided file is currently unsupported.";return ut}function Nr(Qe,ke,it,ut,lt){const It={size:0,viewer:ke,array:it,offset:ut,width:Qe.dataWindow.xMax-Qe.dataWindow.xMin+1,height:Qe.dataWindow.yMax-Qe.dataWindow.yMin+1,channels:Qe.channels.length,bytesPerLine:null,lines:null,inputSize:null,type:Qe.channels[0].pixelType,uncompress:null,getter:null,format:null,[hasColorSpace?"colorSpace":"encoding"]:null};switch(Qe.compression){case"NO_COMPRESSION":It.lines=1,It.uncompress=qe;break;case"RLE_COMPRESSION":It.lines=1,It.uncompress=Je;break;case"ZIPS_COMPRESSION":It.lines=1,It.uncompress=mt;break;case"ZIP_COMPRESSION":It.lines=16,It.uncompress=mt;break;case"PIZ_COMPRESSION":It.lines=32,It.uncompress=Dt;break;case"PXR24_COMPRESSION":It.lines=16,It.uncompress=_t;break;case"DWAA_COMPRESSION":It.lines=32,It.uncompress=zt;break;case"DWAB_COMPRESSION":It.lines=256,It.uncompress=zt;break;default:throw"EXRLoader.parse: "+Qe.compression+" is unsupported"}if(It.scanlineBlockSize=It.lines,It.type==1)switch(lt){case FloatType:It.getter=gn,It.inputSize=2;break;case HalfFloatType:It.getter=Et,It.inputSize=2;break}else if(It.type==2)switch(lt){case FloatType:It.getter=wn,It.inputSize=4;break;case HalfFloatType:It.getter=ft,It.inputSize=4}else throw"EXRLoader.parse: unsupported pixelType "+It.type+" for "+Qe.compression+".";It.blockCount=(Qe.dataWindow.yMax+1)/It.scanlineBlockSize;for(var Nt=0;Nt<It.blockCount;Nt++)An(ke,ut);It.outputChannels=It.channels==3?4:It.channels;const Xt=It.width*It.height*It.outputChannels;switch(lt){case FloatType:It.byteArray=new Float32Array(Xt),It.channels<It.outputChannels&&It.byteArray.fill(1,0,Xt);break;case HalfFloatType:It.byteArray=new Uint16Array(Xt),It.channels<It.outputChannels&&It.byteArray.fill(15360,0,Xt);break;default:console.error("THREE.EXRLoader: unsupported type: ",lt);break}return It.bytesPerLine=It.width*It.inputSize*It.channels,It.outputChannels==4?It.format=RGBAFormat:It.format=RedFormat,hasColorSpace?It.colorSpace="srgb-linear":It.encoding=3e3,It}const ei=new DataView(Z),Er=new Uint8Array(Z),Lr={value:0},br=fr(ei,Z,Lr),kn=Nr(br,ei,Er,Lr,this.type),Hr={value:0},Yi={R:0,G:1,B:2,A:3,Y:0};for(let Qe=0;Qe<kn.height/kn.scanlineBlockSize;Qe++){const ke=rn(ei,Lr);kn.size=rn(ei,Lr),kn.lines=ke+kn.scanlineBlockSize>kn.height?kn.height-ke:kn.scanlineBlockSize;const ut=kn.size<kn.lines*kn.bytesPerLine?kn.uncompress(kn):qe(kn);Lr.value+=kn.size;for(let lt=0;lt<kn.scanlineBlockSize;lt++){const It=lt+Qe*kn.scanlineBlockSize;if(It>=kn.height)break;for(let Nt=0;Nt<kn.channels;Nt++){const Xt=Yi[br.channels[Nt].name];for(let Ot=0;Ot<kn.width;Ot++){Hr.value=(lt*(kn.channels*kn.width)+Nt*kn.width+Ot)*kn.inputSize;const Jt=(kn.height-1-It)*(kn.width*kn.outputChannels)+Ot*kn.outputChannels+Xt;kn.byteArray[Jt]=kn.getter(ut,Hr)}}}}return{header:br,width:kn.width,height:kn.height,data:kn.byteArray,format:kn.format,[hasColorSpace?"colorSpace":"encoding"]:kn[hasColorSpace?"colorSpace":"encoding"],type:this.type}}setDataType(Z){return this.type=Z,this}load(Z,_,K,te){function ne(oe,ie){hasColorSpace?oe.colorSpace=ie.colorSpace:oe.encoding=ie.encoding,oe.minFilter=LinearFilter,oe.magFilter=LinearFilter,oe.generateMipmaps=!1,oe.flipY=!1,_&&_(oe,ie)}return super.load(Z,ne,K,te)}}const _taskCache=new WeakMap;class DRACOLoader extends Loader{constructor(Z){super(Z),this.decoderPath="",this.decoderConfig={},this.decoderBinary=null,this.decoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},this.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"}}setDecoderPath(Z){return this.decoderPath=Z,this}setDecoderConfig(Z){return this.decoderConfig=Z,this}setWorkerLimit(Z){return this.workerLimit=Z,this}load(Z,_,K,te){const ne=new FileLoader(this.manager);ne.setPath(this.path),ne.setResponseType("arraybuffer"),ne.setRequestHeader(this.requestHeader),ne.setWithCredentials(this.withCredentials),ne.load(Z,oe=>{const ie={attributeIDs:this.defaultAttributeIDs,attributeTypes:this.defaultAttributeTypes,useUniqueIDs:!1};this.decodeGeometry(oe,ie).then(_).catch(te)},K,te)}decodeDracoFile(Z,_,K,te){const ne={attributeIDs:K||this.defaultAttributeIDs,attributeTypes:te||this.defaultAttributeTypes,useUniqueIDs:!!K};this.decodeGeometry(Z,ne).then(_)}decodeGeometry(Z,_){for(const se in _.attributeTypes){const ae=_.attributeTypes[se];ae.BYTES_PER_ELEMENT!==void 0&&(_.attributeTypes[se]=ae.name)}const K=JSON.stringify(_);if(_taskCache.has(Z)){const se=_taskCache.get(Z);if(se.key===K)return se.promise;if(Z.byteLength===0)throw new Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}let te;const ne=this.workerNextTaskID++,oe=Z.byteLength,ie=this._getWorker(ne,oe).then(se=>(te=se,new Promise((ae,ge)=>{te._callbacks[ne]={resolve:ae,reject:ge},te.postMessage({type:"decode",id:ne,taskConfig:_,buffer:Z},[Z])}))).then(se=>this._createGeometry(se.geometry));return ie.catch(()=>!0).then(()=>{te&&ne&&this._releaseTask(te,ne)}),_taskCache.set(Z,{key:K,promise:ie}),ie}_createGeometry(Z){const _=new BufferGeometry;Z.index&&_.setIndex(new BufferAttribute(Z.index.array,1));for(let K=0;K<Z.attributes.length;K++){const te=Z.attributes[K],ne=te.name,oe=te.array,ie=te.itemSize;_.setAttribute(ne,new BufferAttribute(oe,ie))}return _}_loadLibrary(Z,_){const K=new FileLoader(this.manager);return K.setPath(this.decoderPath),K.setResponseType(_),K.setWithCredentials(this.withCredentials),new Promise((te,ne)=>{K.load(Z,te,void 0,ne)})}preload(){return this._initDecoder(),this}_initDecoder(){if(this.decoderPending)return this.decoderPending;const Z=typeof WebAssembly!="object"||this.decoderConfig.type==="js",_=[];return Z?_.push(this._loadLibrary("draco_decoder.js","text")):(_.push(this._loadLibrary("draco_wasm_wrapper.js","text")),_.push(this._loadLibrary("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(_).then(K=>{const te=K[0];Z||(this.decoderConfig.wasmBinary=K[1]);const ne=DRACOWorker.toString(),oe=["/* draco decoder */",te,"","/* worker */",ne.substring(ne.indexOf("{")+1,ne.lastIndexOf("}"))].join(`
`);this.workerSourceURL=URL.createObjectURL(new Blob([oe]))}),this.decoderPending}_getWorker(Z,_){return this._initDecoder().then(()=>{if(this.workerPool.length<this.workerLimit){const te=new Worker(this.workerSourceURL);te._callbacks={},te._taskCosts={},te._taskLoad=0,te.postMessage({type:"init",decoderConfig:this.decoderConfig}),te.onmessage=function(ne){const oe=ne.data;switch(oe.type){case"decode":te._callbacks[oe.id].resolve(oe);break;case"error":te._callbacks[oe.id].reject(oe);break;default:console.error('THREE.DRACOLoader: Unexpected message, "'+oe.type+'"')}},this.workerPool.push(te)}else this.workerPool.sort(function(te,ne){return te._taskLoad>ne._taskLoad?-1:1});const K=this.workerPool[this.workerPool.length-1];return K._taskCosts[Z]=_,K._taskLoad+=_,K})}_releaseTask(Z,_){Z._taskLoad-=Z._taskCosts[_],delete Z._callbacks[_],delete Z._taskCosts[_]}debug(){console.log("Task load: ",this.workerPool.map(Z=>Z._taskLoad))}dispose(){for(let Z=0;Z<this.workerPool.length;++Z)this.workerPool[Z].terminate();return this.workerPool.length=0,this}}function DRACOWorker(){let X,Z;onmessage=function(oe){const ie=oe.data;switch(ie.type){case"init":X=ie.decoderConfig,Z=new Promise(function(ge){X.onModuleLoaded=function(ce){ge({draco:ce})},DracoDecoderModule(X)});break;case"decode":const se=ie.buffer,ae=ie.taskConfig;Z.then(ge=>{const ce=ge.draco,de=new ce.Decoder,pe=new ce.DecoderBuffer;pe.Init(new Int8Array(se),se.byteLength);try{const fe=_(ce,de,pe,ae),be=fe.attributes.map(me=>me.array.buffer);fe.index&&be.push(fe.index.array.buffer),self.postMessage({type:"decode",id:ie.id,geometry:fe},be)}catch(fe){console.error(fe),self.postMessage({type:"error",id:ie.id,error:fe.message})}finally{ce.destroy(pe),ce.destroy(de)}});break}};function _(oe,ie,se,ae){const ge=ae.attributeIDs,ce=ae.attributeTypes;let de,pe;const fe=ie.GetEncodedGeometryType(se);if(fe===oe.TRIANGULAR_MESH)de=new oe.Mesh,pe=ie.DecodeBufferToMesh(se,de);else if(fe===oe.POINT_CLOUD)de=new oe.PointCloud,pe=ie.DecodeBufferToPointCloud(se,de);else throw new Error("THREE.DRACOLoader: Unexpected geometry type.");if(!pe.ok()||de.ptr===0)throw new Error("THREE.DRACOLoader: Decoding failed: "+pe.error_msg());const be={index:null,attributes:[]};for(const me in ge){const ye=self[ce[me]];let ve,Be;if(ae.useUniqueIDs)Be=ge[me],ve=ie.GetAttributeByUniqueId(de,Be);else{if(Be=ie.GetAttributeId(de,oe[ge[me]]),Be===-1)continue;ve=ie.GetAttribute(de,Be)}be.attributes.push(te(oe,ie,de,me,ye,ve))}return fe===oe.TRIANGULAR_MESH&&(be.index=K(oe,ie,de)),oe.destroy(de),be}function K(oe,ie,se){const ge=se.num_faces()*3,ce=ge*4,de=oe._malloc(ce);ie.GetTrianglesUInt32Array(se,ce,de);const pe=new Uint32Array(oe.HEAPF32.buffer,de,ge).slice();return oe._free(de),{array:pe,itemSize:1}}function te(oe,ie,se,ae,ge,ce){const de=ce.num_components(),fe=se.num_points()*de,be=fe*ge.BYTES_PER_ELEMENT,me=ne(oe,ge),ye=oe._malloc(be);ie.GetAttributeDataArrayForAllPoints(se,ce,me,be,ye);const ve=new ge(oe.HEAPF32.buffer,ye,fe).slice();return oe._free(ye),{name:ae,array:ve,itemSize:de}}function ne(oe,ie){switch(ie){case Float32Array:return oe.DT_FLOAT32;case Int8Array:return oe.DT_INT8;case Int16Array:return oe.DT_INT16;case Int32Array:return oe.DT_INT32;case Uint8Array:return oe.DT_UINT8;case Uint16Array:return oe.DT_UINT16;case Uint32Array:return oe.DT_UINT32}}}let generated;const MeshoptDecoder=()=>{if(generated)return generated;const X="B9h9z9tFBBBF8fL9gBB9gLaaaaaFa9gEaaaB9gFaFa9gEaaaFaEMcBFFFGGGEIIILF9wFFFLEFBFKNFaFCx/IFMO/LFVK9tv9t9vq95GBt9f9f939h9z9t9f9j9h9s9s9f9jW9vq9zBBp9tv9z9o9v9wW9f9kv9j9v9kv9WvqWv94h919m9mvqBF8Z9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv94h919m9mvqBGy9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv949TvZ91v9u9jvBEn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9P9jWBIi9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9R919hWBLn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9F949wBKI9z9iqlBOc+x8ycGBM/qQFTa8jUUUUBCU/EBlHL8kUUUUBC9+RKGXAGCFJAI9LQBCaRKAE2BBC+gF9HQBALAEAIJHOAGlAGTkUUUBRNCUoBAG9uC/wgBZHKCUGAKCUG9JyRVAECFJRICBRcGXEXAcAF9PQFAVAFAclAcAVJAF9JyRMGXGXAG9FQBAMCbJHKC9wZRSAKCIrCEJCGrRQANCUGJRfCBRbAIRTEXGXAOATlAQ9PQBCBRISEMATAQJRIGXAS9FQBCBRtCBREEXGXAOAIlCi9PQBCBRISLMANCU/CBJAEJRKGXGXGXGXGXATAECKrJ2BBAtCKZrCEZfIBFGEBMAKhB83EBAKCNJhB83EBSEMAKAI2BIAI2BBHmCKrHYAYCE6HYy86BBAKCFJAICIJAYJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCGJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCEJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCIJAYAmJHY2BBAI2BFHmCKrHPAPCE6HPy86BBAKCLJAYAPJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCKJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCOJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCNJAYAmJHY2BBAI2BGHmCKrHPAPCE6HPy86BBAKCVJAYAPJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCcJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCMJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCSJAYAmJHm2BBAI2BEHICKrHYAYCE6HYy86BBAKCQJAmAYJHm2BBAICIrCEZHYAYCE6HYy86BBAKCfJAmAYJHm2BBAICGrCEZHYAYCE6HYy86BBAKCbJAmAYJHK2BBAICEZHIAICE6HIy86BBAKAIJRISGMAKAI2BNAI2BBHmCIrHYAYCb6HYy86BBAKCFJAICNJAYJHY2BBAmCbZHmAmCb6Hmy86BBAKCGJAYAmJHm2BBAI2BFHYCIrHPAPCb6HPy86BBAKCEJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCIJAmAYJHm2BBAI2BGHYCIrHPAPCb6HPy86BBAKCLJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCKJAmAYJHm2BBAI2BEHYCIrHPAPCb6HPy86BBAKCOJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCNJAmAYJHm2BBAI2BIHYCIrHPAPCb6HPy86BBAKCVJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCcJAmAYJHm2BBAI2BLHYCIrHPAPCb6HPy86BBAKCMJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCSJAmAYJHm2BBAI2BKHYCIrHPAPCb6HPy86BBAKCQJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCfJAmAYJHm2BBAI2BOHICIrHYAYCb6HYy86BBAKCbJAmAYJHK2BBAICbZHIAICb6HIy86BBAKAIJRISFMAKAI8pBB83BBAKCNJAICNJ8pBB83BBAICTJRIMAtCGJRtAECTJHEAS9JQBMMGXAIQBCBRISEMGXAM9FQBANAbJ2BBRtCBRKAfREEXAEANCU/CBJAKJ2BBHTCFrCBATCFZl9zAtJHt86BBAEAGJREAKCFJHKAM9HQBMMAfCFJRfAIRTAbCFJHbAG9HQBMMABAcAG9sJANCUGJAMAG9sTkUUUBpANANCUGJAMCaJAG9sJAGTkUUUBpMAMCBAIyAcJRcAIQBMC9+RKSFMCBC99AOAIlAGCAAGCA9Ly6yRKMALCU/EBJ8kUUUUBAKM+OmFTa8jUUUUBCoFlHL8kUUUUBC9+RKGXAFCE9uHOCtJAI9LQBCaRKAE2BBHNC/wFZC/gF9HQBANCbZHVCF9LQBALCoBJCgFCUFT+JUUUBpALC84Jha83EBALC8wJha83EBALC8oJha83EBALCAJha83EBALCiJha83EBALCTJha83EBALha83ENALha83EBAEAIJC9wJRcAECFJHNAOJRMGXAF9FQBCQCbAVCF6yRSABRECBRVCBRQCBRfCBRICBRKEXGXAMAcuQBC9+RKSEMGXGXAN2BBHOC/vF9LQBALCoBJAOCIrCa9zAKJCbZCEWJHb8oGIRTAb8oGBRtGXAOCbZHbAS9PQBALAOCa9zAIJCbZCGWJ8oGBAVAbyROAb9FRbGXGXAGCG9HQBABAt87FBABCIJAO87FBABCGJAT87FBSFMAEAtjGBAECNJAOjGBAECIJATjGBMAVAbJRVALCoBJAKCEWJHmAOjGBAmATjGIALAICGWJAOjGBALCoBJAKCFJCbZHKCEWJHTAtjGBATAOjGIAIAbJRIAKCFJRKSGMGXGXAbCb6QBAQAbJAbC989zJCFJRQSFMAM1BBHbCgFZROGXGXAbCa9MQBAMCFJRMSFMAM1BFHbCgBZCOWAOCgBZqROGXAbCa9MQBAMCGJRMSFMAM1BGHbCgBZCfWAOqROGXAbCa9MQBAMCEJRMSFMAM1BEHbCgBZCdWAOqROGXAbCa9MQBAMCIJRMSFMAM2BIC8cWAOqROAMCLJRMMAOCFrCBAOCFZl9zAQJRQMGXGXAGCG9HQBABAt87FBABCIJAQ87FBABCGJAT87FBSFMAEAtjGBAECNJAQjGBAECIJATjGBMALCoBJAKCEWJHOAQjGBAOATjGIALAICGWJAQjGBALCoBJAKCFJCbZHKCEWJHOAtjGBAOAQjGIAICFJRIAKCFJRKSFMGXAOCDF9LQBALAIAcAOCbZJ2BBHbCIrHTlCbZCGWJ8oGBAVCFJHtATyROALAIAblCbZCGWJ8oGBAtAT9FHmJHtAbCbZHTyRbAT9FRTGXGXAGCG9HQBABAV87FBABCIJAb87FBABCGJAO87FBSFMAEAVjGBAECNJAbjGBAECIJAOjGBMALAICGWJAVjGBALCoBJAKCEWJHYAOjGBAYAVjGIALAICFJHICbZCGWJAOjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAIAmJCbZHICGWJAbjGBALCoBJAKCGJCbZHKCEWJHOAVjGBAOAbjGIAKCFJRKAIATJRIAtATJRVSFMAVCBAM2BBHYyHTAOC/+F6HPJROAYCbZRtGXGXAYCIrHmQBAOCFJRbSFMAORbALAIAmlCbZCGWJ8oGBROMGXGXAtQBAbCFJRVSFMAbRVALAIAYlCbZCGWJ8oGBRbMGXGXAP9FQBAMCFJRYSFMAM1BFHYCgFZRTGXGXAYCa9MQBAMCGJRYSFMAM1BGHYCgBZCOWATCgBZqRTGXAYCa9MQBAMCEJRYSFMAM1BEHYCgBZCfWATqRTGXAYCa9MQBAMCIJRYSFMAM1BIHYCgBZCdWATqRTGXAYCa9MQBAMCLJRYSFMAMCKJRYAM2BLC8cWATqRTMATCFrCBATCFZl9zAQJHQRTMGXGXAmCb6QBAYRPSFMAY1BBHMCgFZROGXGXAMCa9MQBAYCFJRPSFMAY1BFHMCgBZCOWAOCgBZqROGXAMCa9MQBAYCGJRPSFMAY1BGHMCgBZCfWAOqROGXAMCa9MQBAYCEJRPSFMAY1BEHMCgBZCdWAOqROGXAMCa9MQBAYCIJRPSFMAYCLJRPAY2BIC8cWAOqROMAOCFrCBAOCFZl9zAQJHQROMGXGXAtCb6QBAPRMSFMAP1BBHMCgFZRbGXGXAMCa9MQBAPCFJRMSFMAP1BFHMCgBZCOWAbCgBZqRbGXAMCa9MQBAPCGJRMSFMAP1BGHMCgBZCfWAbqRbGXAMCa9MQBAPCEJRMSFMAP1BEHMCgBZCdWAbqRbGXAMCa9MQBAPCIJRMSFMAPCLJRMAP2BIC8cWAbqRbMAbCFrCBAbCFZl9zAQJHQRbMGXGXAGCG9HQBABAT87FBABCIJAb87FBABCGJAO87FBSFMAEATjGBAECNJAbjGBAECIJAOjGBMALCoBJAKCEWJHYAOjGBAYATjGIALAICGWJATjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAICFJHICbZCGWJAOjGBALCoBJAKCGJCbZCEWJHOATjGBAOAbjGIALAIAm9FAmCb6qJHICbZCGWJAbjGBAIAt9FAtCb6qJRIAKCEJRKMANCFJRNABCKJRBAECSJREAKCbZRKAICbZRIAfCEJHfAF9JQBMMCBC99AMAc6yRKMALCoFJ8kUUUUBAKM/tIFGa8jUUUUBCTlRLC9+RKGXAFCLJAI9LQBCaRKAE2BBC/+FZC/QF9HQBALhB83ENAECFJRKAEAIJC98JREGXAF9FQBGXAGCG6QBEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMALCNJAICFZCGWqHGAICGrCBAICFrCFZl9zAG8oGBJHIjGBABAIjGBABCIJRBAFCaJHFQBSGMMEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMABAICGrCBAICFrCFZl9zALCNJAICFZCGWqHI8oGBJHG87FBAIAGjGBABCGJRBAFCaJHFQBMMCBC99AKAE6yRKMAKM+lLKFaF99GaG99FaG99GXGXAGCI9HQBAF9FQFEXGXGX9DBBB8/9DBBB+/ABCGJHG1BB+yAB1BBHE+yHI+L+TABCFJHL1BBHK+yHO+L+THN9DBBBB9gHVyAN9DBB/+hANAN+U9DBBBBANAVyHcAc+MHMAECa3yAI+SHIAI+UAcAMAKCa3yAO+SHcAc+U+S+S+R+VHO+U+SHN+L9DBBB9P9d9FQBAN+oRESFMCUUUU94REMAGAE86BBGXGX9DBBB8/9DBBB+/Ac9DBBBB9gyAcAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMALAG86BBGXGX9DBBB8/9DBBB+/AI9DBBBB9gyAIAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMABAG86BBABCIJRBAFCaJHFQBSGMMAF9FQBEXGXGX9DBBB8/9DBBB+/ABCIJHG8uFB+yAB8uFBHE+yHI+L+TABCGJHL8uFBHK+yHO+L+THN9DBBBB9gHVyAN9DB/+g6ANAN+U9DBBBBANAVyHcAc+MHMAECa3yAI+SHIAI+UAcAMAKCa3yAO+SHcAc+U+S+S+R+VHO+U+SHN+L9DBBB9P9d9FQBAN+oRESFMCUUUU94REMAGAE87FBGXGX9DBBB8/9DBBB+/Ac9DBBBB9gyAcAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMALAG87FBGXGX9DBBB8/9DBBB+/AI9DBBBB9gyAIAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMABAG87FBABCNJRBAFCaJHFQBMMM/SEIEaE99EaF99GXAF9FQBCBREABRIEXGXGX9D/zI818/AICKJ8uFBHLCEq+y+VHKAI8uFB+y+UHO9DB/+g6+U9DBBB8/9DBBB+/AO9DBBBB9gy+SHN+L9DBBB9P9d9FQBAN+oRVSFMCUUUU94RVMAICIJ8uFBRcAICGJ8uFBRMABALCFJCEZAEqCFWJAV87FBGXGXAKAM+y+UHN9DB/+g6+U9DBBB8/9DBBB+/AN9DBBBB9gy+SHS+L9DBBB9P9d9FQBAS+oRMSFMCUUUU94RMMABALCGJCEZAEqCFWJAM87FBGXGXAKAc+y+UHK9DB/+g6+U9DBBB8/9DBBB+/AK9DBBBB9gy+SHS+L9DBBB9P9d9FQBAS+oRcSFMCUUUU94RcMABALCaJCEZAEqCFWJAc87FBGXGX9DBBU8/AOAO+U+TANAN+U+TAKAK+U+THO9DBBBBAO9DBBBB9gy+R9DB/+g6+U9DBBB8/+SHO+L9DBBB9P9d9FQBAO+oRcSFMCUUUU94RcMABALCEZAEqCFWJAc87FBAICNJRIAECIJREAFCaJHFQBMMM9JBGXAGCGrAF9sHF9FQBEXABAB8oGBHGCNWCN91+yAGCi91CnWCUUU/8EJ+++U84GBABCIJRBAFCaJHFQBMMM9TFEaCBCB8oGUkUUBHFABCEJC98ZJHBjGUkUUBGXGXAB8/BCTWHGuQBCaREABAGlCggEJCTrXBCa6QFMAFREMAEM/lFFFaGXGXAFABqCEZ9FQBABRESFMGXGXAGCT9PQBABRESFMABREEXAEAF8oGBjGBAECIJAFCIJ8oGBjGBAECNJAFCNJ8oGBjGBAECSJAFCSJ8oGBjGBAECTJREAFCTJRFAGC9wJHGCb9LQBMMAGCI9JQBEXAEAF8oGBjGBAFCIJRFAECIJREAGC98JHGCE9LQBMMGXAG9FQBEXAEAF2BB86BBAECFJREAFCFJRFAGCaJHGQBMMABMoFFGaGXGXABCEZ9FQBABRESFMAFCgFZC+BwsN9sRIGXGXAGCT9PQBABRESFMABREEXAEAIjGBAECSJAIjGBAECNJAIjGBAECIJAIjGBAECTJREAGC9wJHGCb9LQBMMAGCI9JQBEXAEAIjGBAECIJREAGC98JHGCE9LQBMMGXAG9FQBEXAEAF86BBAECFJREAGCaJHGQBMMABMMMFBCUNMIT9kBB",Z="B9h9z9tFBBBFiI9gBB9gLaaaaaFa9gEaaaB9gFaFaEMcBBFBFFGGGEILF9wFFFLEFBFKNFaFCx/aFMO/LFVK9tv9t9vq95GBt9f9f939h9z9t9f9j9h9s9s9f9jW9vq9zBBp9tv9z9o9v9wW9f9kv9j9v9kv9WvqWv94h919m9mvqBG8Z9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv94h919m9mvqBIy9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv949TvZ91v9u9jvBLn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9P9jWBKi9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9R919hWBOn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9F949wBNI9z9iqlBVc+N9IcIBTEM9+FLa8jUUUUBCTlRBCBRFEXCBRGCBREEXABCNJAGJAECUaAFAGrCFZHIy86BBAEAIJREAGCFJHGCN9HQBMAFCx+YUUBJAE86BBAFCEWCxkUUBJAB8pEN83EBAFCFJHFCUG9HQBMMk8lLbaE97F9+FaL978jUUUUBCU/KBlHL8kUUUUBC9+RKGXAGCFJAI9LQBCaRKAE2BBC+gF9HQBALAEAIJHOAGlAG/8cBBCUoBAG9uC/wgBZHKCUGAKCUG9JyRNAECFJRKCBRVGXEXAVAF9PQFANAFAVlAVANJAF9JyRcGXGXAG9FQBAcCbJHIC9wZHMCE9sRSAMCFWRQAICIrCEJCGrRfCBRbEXAKRTCBRtGXEXGXAOATlAf9PQBCBRKSLMALCU/CBJAtAM9sJRmATAfJRKCBREGXAMCoB9JQBAOAKlC/gB9JQBCBRIEXAmAIJREGXGXGXGXGXATAICKrJ2BBHYCEZfIBFGEBMAECBDtDMIBSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCIJAeDeBJAiCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCNJAeDeBJAiCx+YUUBJ2BBJRKSFMAEAKDBBBDMIBAKCTJRKMGXGXGXGXGXAYCGrCEZfIBFGEBMAECBDtDMITSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMITAKCIJAeDeBJAiCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMITAKCNJAeDeBJAiCx+YUUBJ2BBJRKSFMAEAKDBBBDMITAKCTJRKMGXGXGXGXGXAYCIrCEZfIBFGEBMAECBDtDMIASEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIAAKCIJAeDeBJAiCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIAAKCNJAeDeBJAiCx+YUUBJ2BBJRKSFMAEAKDBBBDMIAAKCTJRKMGXGXGXGXGXAYCKrfIBFGEBMAECBDtDMI8wSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHYCEWCxkUUBJDBEBAYCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHYCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMI8wAKCIJAeDeBJAYCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHYCEWCxkUUBJDBEBAYCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHYCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMI8wAKCNJAeDeBJAYCx+YUUBJ2BBJRKSFMAEAKDBBBDMI8wAKCTJRKMAICoBJREAICUFJAM9LQFAERIAOAKlC/fB9LQBMMGXAEAM9PQBAECErRIEXGXAOAKlCi9PQBCBRKSOMAmAEJRYGXGXGXGXGXATAECKrJ2BBAICKZrCEZfIBFGEBMAYCBDtDMIBSEMAYAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCIJAeDeBJAiCx+YUUBJ2BBJRKSGMAYAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCNJAeDeBJAiCx+YUUBJ2BBJRKSFMAYAKDBBBDMIBAKCTJRKMAICGJRIAECTJHEAM9JQBMMGXAK9FQBAKRTAtCFJHtCI6QGSFMMCBRKSEMGXAM9FQBALCUGJAbJREALAbJDBGBReCBRYEXAEALCU/CBJAYJHIDBIBHdCFD9tAdCFDbHPD9OD9hD9RHdAIAMJDBIBH8ZCFD9tA8ZAPD9OD9hD9RH8ZDQBTFtGmEYIPLdKeOnHpAIAQJDBIBHyCFD9tAyAPD9OD9hD9RHyAIASJDBIBH8cCFD9tA8cAPD9OD9hD9RH8cDQBTFtGmEYIPLdKeOnH8dDQBFTtGEmYILPdKOenHPAPDQBFGEBFGEBFGEBFGEAeD9uHeDyBjGBAEAGJHIAeAPAPDQILKOILKOILKOILKOD9uHeDyBjGBAIAGJHIAeAPAPDQNVcMNVcMNVcMNVcMD9uHeDyBjGBAIAGJHIAeAPAPDQSQfbSQfbSQfbSQfbD9uHeDyBjGBAIAGJHIAeApA8dDQNVi8ZcMpySQ8c8dfb8e8fHPAPDQBFGEBFGEBFGEBFGED9uHeDyBjGBAIAGJHIAeAPAPDQILKOILKOILKOILKOD9uHeDyBjGBAIAGJHIAeAPAPDQNVcMNVcMNVcMNVcMD9uHeDyBjGBAIAGJHIAeAPAPDQSQfbSQfbSQfbSQfbD9uHeDyBjGBAIAGJHIAeAdA8ZDQNiV8ZcpMyS8cQ8df8eb8fHdAyA8cDQNiV8ZcpMyS8cQ8df8eb8fH8ZDQBFTtGEmYILPdKOenHPAPDQBFGEBFGEBFGEBFGED9uHeDyBjGBAIAGJHIAeAPAPDQILKOILKOILKOILKOD9uHeDyBjGBAIAGJHIAeAPAPDQNVcMNVcMNVcMNVcMD9uHeDyBjGBAIAGJHIAeAPAPDQSQfbSQfbSQfbSQfbD9uHeDyBjGBAIAGJHIAeAdA8ZDQNVi8ZcMpySQ8c8dfb8e8fHPAPDQBFGEBFGEBFGEBFGED9uHeDyBjGBAIAGJHIAeAPAPDQILKOILKOILKOILKOD9uHeDyBjGBAIAGJHIAeAPAPDQNVcMNVcMNVcMNVcMD9uHeDyBjGBAIAGJHIAeAPAPDQSQfbSQfbSQfbSQfbD9uHeDyBjGBAIAGJREAYCTJHYAM9JQBMMAbCIJHbAG9JQBMMABAVAG9sJALCUGJAcAG9s/8cBBALALCUGJAcCaJAG9sJAG/8cBBMAcCBAKyAVJRVAKQBMC9+RKSFMCBC99AOAKlAGCAAGCA9Ly6yRKMALCU/KBJ8kUUUUBAKMNBT+BUUUBM+KmFTa8jUUUUBCoFlHL8kUUUUBC9+RKGXAFCE9uHOCtJAI9LQBCaRKAE2BBHNC/wFZC/gF9HQBANCbZHVCF9LQBALCoBJCgFCUF/8MBALC84Jha83EBALC8wJha83EBALC8oJha83EBALCAJha83EBALCiJha83EBALCTJha83EBALha83ENALha83EBAEAIJC9wJRcAECFJHNAOJRMGXAF9FQBCQCbAVCF6yRSABRECBRVCBRQCBRfCBRICBRKEXGXAMAcuQBC9+RKSEMGXGXAN2BBHOC/vF9LQBALCoBJAOCIrCa9zAKJCbZCEWJHb8oGIRTAb8oGBRtGXAOCbZHbAS9PQBALAOCa9zAIJCbZCGWJ8oGBAVAbyROAb9FRbGXGXAGCG9HQBABAt87FBABCIJAO87FBABCGJAT87FBSFMAEAtjGBAECNJAOjGBAECIJATjGBMAVAbJRVALCoBJAKCEWJHmAOjGBAmATjGIALAICGWJAOjGBALCoBJAKCFJCbZHKCEWJHTAtjGBATAOjGIAIAbJRIAKCFJRKSGMGXGXAbCb6QBAQAbJAbC989zJCFJRQSFMAM1BBHbCgFZROGXGXAbCa9MQBAMCFJRMSFMAM1BFHbCgBZCOWAOCgBZqROGXAbCa9MQBAMCGJRMSFMAM1BGHbCgBZCfWAOqROGXAbCa9MQBAMCEJRMSFMAM1BEHbCgBZCdWAOqROGXAbCa9MQBAMCIJRMSFMAM2BIC8cWAOqROAMCLJRMMAOCFrCBAOCFZl9zAQJRQMGXGXAGCG9HQBABAt87FBABCIJAQ87FBABCGJAT87FBSFMAEAtjGBAECNJAQjGBAECIJATjGBMALCoBJAKCEWJHOAQjGBAOATjGIALAICGWJAQjGBALCoBJAKCFJCbZHKCEWJHOAtjGBAOAQjGIAICFJRIAKCFJRKSFMGXAOCDF9LQBALAIAcAOCbZJ2BBHbCIrHTlCbZCGWJ8oGBAVCFJHtATyROALAIAblCbZCGWJ8oGBAtAT9FHmJHtAbCbZHTyRbAT9FRTGXGXAGCG9HQBABAV87FBABCIJAb87FBABCGJAO87FBSFMAEAVjGBAECNJAbjGBAECIJAOjGBMALAICGWJAVjGBALCoBJAKCEWJHYAOjGBAYAVjGIALAICFJHICbZCGWJAOjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAIAmJCbZHICGWJAbjGBALCoBJAKCGJCbZHKCEWJHOAVjGBAOAbjGIAKCFJRKAIATJRIAtATJRVSFMAVCBAM2BBHYyHTAOC/+F6HPJROAYCbZRtGXGXAYCIrHmQBAOCFJRbSFMAORbALAIAmlCbZCGWJ8oGBROMGXGXAtQBAbCFJRVSFMAbRVALAIAYlCbZCGWJ8oGBRbMGXGXAP9FQBAMCFJRYSFMAM1BFHYCgFZRTGXGXAYCa9MQBAMCGJRYSFMAM1BGHYCgBZCOWATCgBZqRTGXAYCa9MQBAMCEJRYSFMAM1BEHYCgBZCfWATqRTGXAYCa9MQBAMCIJRYSFMAM1BIHYCgBZCdWATqRTGXAYCa9MQBAMCLJRYSFMAMCKJRYAM2BLC8cWATqRTMATCFrCBATCFZl9zAQJHQRTMGXGXAmCb6QBAYRPSFMAY1BBHMCgFZROGXGXAMCa9MQBAYCFJRPSFMAY1BFHMCgBZCOWAOCgBZqROGXAMCa9MQBAYCGJRPSFMAY1BGHMCgBZCfWAOqROGXAMCa9MQBAYCEJRPSFMAY1BEHMCgBZCdWAOqROGXAMCa9MQBAYCIJRPSFMAYCLJRPAY2BIC8cWAOqROMAOCFrCBAOCFZl9zAQJHQROMGXGXAtCb6QBAPRMSFMAP1BBHMCgFZRbGXGXAMCa9MQBAPCFJRMSFMAP1BFHMCgBZCOWAbCgBZqRbGXAMCa9MQBAPCGJRMSFMAP1BGHMCgBZCfWAbqRbGXAMCa9MQBAPCEJRMSFMAP1BEHMCgBZCdWAbqRbGXAMCa9MQBAPCIJRMSFMAPCLJRMAP2BIC8cWAbqRbMAbCFrCBAbCFZl9zAQJHQRbMGXGXAGCG9HQBABAT87FBABCIJAb87FBABCGJAO87FBSFMAEATjGBAECNJAbjGBAECIJAOjGBMALCoBJAKCEWJHYAOjGBAYATjGIALAICGWJATjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAICFJHICbZCGWJAOjGBALCoBJAKCGJCbZCEWJHOATjGBAOAbjGIALAIAm9FAmCb6qJHICbZCGWJAbjGBAIAt9FAtCb6qJRIAKCEJRKMANCFJRNABCKJRBAECSJREAKCbZRKAICbZRIAfCEJHfAF9JQBMMCBC99AMAc6yRKMALCoFJ8kUUUUBAKM/tIFGa8jUUUUBCTlRLC9+RKGXAFCLJAI9LQBCaRKAE2BBC/+FZC/QF9HQBALhB83ENAECFJRKAEAIJC98JREGXAF9FQBGXAGCG6QBEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMALCNJAICFZCGWqHGAICGrCBAICFrCFZl9zAG8oGBJHIjGBABAIjGBABCIJRBAFCaJHFQBSGMMEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMABAICGrCBAICFrCFZl9zALCNJAICFZCGWqHI8oGBJHG87FBAIAGjGBABCGJRBAFCaJHFQBMMCBC99AKAE6yRKMAKM/dLEK97FaF97GXGXAGCI9HQBAF9FQFCBRGEXABABDBBBHECiD+rFCiD+sFD/6FHIAECND+rFCiD+sFD/6FAID/gFAECTD+rFCiD+sFD/6FHLD/gFD/kFD/lFHKCBDtD+2FHOAICUUUU94DtHND9OD9RD/kFHI9DBB/+hDYAIAID/mFAKAKD/mFALAOALAND9OD9RD/kFHIAID/mFD/kFD/kFD/jFD/nFHLD/mF9DBBX9LDYHOD/kFCgFDtD9OAECUUU94DtD9OD9QAIALD/mFAOD/kFCND+rFCU/+EDtD9OD9QAKALD/mFAOD/kFCTD+rFCUU/8ODtD9OD9QDMBBABCTJRBAGCIJHGAF9JQBSGMMAF9FQBCBRGEXABCTJHVAVDBBBHECBDtHOCUU98D8cFCUU98D8cEHND9OABDBBBHKAEDQILKOSQfbPden8c8d8e8fCggFDtD9OD/6FAKAEDQBFGENVcMTtmYi8ZpyHECTD+sFD/6FHID/gFAECTD+rFCTD+sFD/6FHLD/gFD/kFD/lFHE9DB/+g6DYALAEAOD+2FHOALCUUUU94DtHcD9OD9RD/kFHLALD/mFAEAED/mFAIAOAIAcD9OD9RD/kFHEAED/mFD/kFD/kFD/jFD/nFHID/mF9DBBX9LDYHOD/kFCTD+rFALAID/mFAOD/kFCggEDtD9OD9QHLAEAID/mFAOD/kFCaDbCBDnGCBDnECBDnKCBDnOCBDncCBDnMCBDnfCBDnbD9OHEDQNVi8ZcMpySQ8c8dfb8e8fD9QDMBBABAKAND9OALAEDQBFTtGEmYILPdKOenD9QDMBBABCAJRBAGCIJHGAF9JQBMMM/hEIGaF97FaL978jUUUUBCTlREGXAF9FQBCBRIEXAEABDBBBHLABCTJHKDBBBHODQILKOSQfbPden8c8d8e8fHNCTD+sFHVCID+rFDMIBAB9DBBU8/DY9D/zI818/DYAVCEDtD9QD/6FD/nFHVALAODQBFGENVcMTtmYi8ZpyHLCTD+rFCTD+sFD/6FD/mFHOAOD/mFAVALCTD+sFD/6FD/mFHcAcD/mFAVANCTD+rFCTD+sFD/6FD/mFHNAND/mFD/kFD/kFD/lFCBDtD+4FD/jF9DB/+g6DYHVD/mF9DBBX9LDYHLD/kFCggEDtHMD9OAcAVD/mFALD/kFCTD+rFD9QHcANAVD/mFALD/kFCTD+rFAOAVD/mFALD/kFAMD9OD9QHVDQBFTtGEmYILPdKOenHLD8dBAEDBIBDyB+t+J83EBABCNJALD8dFAEDBIBDyF+t+J83EBAKAcAVDQNVi8ZcMpySQ8c8dfb8e8fHVD8dBAEDBIBDyG+t+J83EBABCiJAVD8dFAEDBIBDyE+t+J83EBABCAJRBAICIJHIAF9JQBMMM9jFF97GXAGCGrAF9sHG9FQBCBRFEXABABDBBBHECND+rFCND+sFD/6FAECiD+sFCnD+rFCUUU/8EDtD+uFD/mFDMBBABCTJRBAFCIJHFAG9JQBMMM9TFEaCBCB8oGUkUUBHFABCEJC98ZJHBjGUkUUBGXGXAB8/BCTWHGuQBCaREABAGlCggEJCTrXBCa6QFMAFREMAEMMMFBCUNMIT9tBB",_=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]),K=new Uint8Array([32,0,65,253,3,1,2,34,4,106,6,5,11,8,7,20,13,33,12,16,128,9,116,64,19,113,127,15,10,21,22,14,255,66,24,54,136,107,18,23,192,26,114,118,132,17,77,101,130,144,27,87,131,44,45,74,156,154,70,167]);if(typeof WebAssembly!="object")return{supported:!1};let te=X;WebAssembly.validate(_)&&(te=Z);let ne;const oe=WebAssembly.instantiate(ie(te),{}).then(ce=>{ne=ce.instance,ne.exports.__wasm_call_ctors()});function ie(ce){const de=new Uint8Array(ce.length);for(let fe=0;fe<ce.length;++fe){const be=ce.charCodeAt(fe);de[fe]=be>96?be-71:be>64?be-65:be>47?be+4:be>46?63:62}let pe=0;for(let fe=0;fe<ce.length;++fe)de[pe++]=de[fe]<60?K[de[fe]]:(de[fe]-60)*64+de[++fe];return de.buffer.slice(0,pe)}function se(ce,de,pe,fe,be,me){const ye=ne.exports.sbrk,ve=pe+3&-4,Be=ye(ve*fe),Re=ye(be.length),Ee=new Uint8Array(ne.exports.memory.buffer);Ee.set(be,Re);const We=ce(Be,pe,fe,Re,be.length);if(We===0&&me&&me(Be,ve,fe),de.set(Ee.subarray(Be,Be+pe*fe)),ye(Be-ye(0)),We!==0)throw new Error(`Malformed buffer data: ${We}`)}const ae={0:"",1:"meshopt_decodeFilterOct",2:"meshopt_decodeFilterQuat",3:"meshopt_decodeFilterExp",NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},ge={0:"meshopt_decodeVertexBuffer",1:"meshopt_decodeIndexBuffer",2:"meshopt_decodeIndexSequence",ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return generated={ready:oe,supported:!0,decodeVertexBuffer(ce,de,pe,fe,be){se(ne.exports.meshopt_decodeVertexBuffer,ce,de,pe,fe,ne.exports[ae[be]])},decodeIndexBuffer(ce,de,pe,fe){se(ne.exports.meshopt_decodeIndexBuffer,ce,de,pe,fe)},decodeIndexSequence(ce,de,pe,fe){se(ne.exports.meshopt_decodeIndexSequence,ce,de,pe,fe)},decodeGltfBuffer(ce,de,pe,fe,be,me){se(ne.exports[ge[be]],ce,de,pe,fe,ne.exports[ae[me]])}},generated};function workerBootstrap(){var X=Object.create(null);function Z(te,ne){var oe=te.id,ie=te.name,se=te.dependencies;se===void 0&&(se=[]);var ae=te.init;ae===void 0&&(ae=function(){});var ge=te.getTransferables;if(ge===void 0&&(ge=null),!X[oe])try{se=se.map(function(de){return de&&de.isWorkerModule&&(Z(de,function(pe){if(pe instanceof Error)throw pe}),de=X[de.id].value),de}),ae=K("<"+ie+">.init",ae),ge&&(ge=K("<"+ie+">.getTransferables",ge));var ce=null;typeof ae=="function"?ce=ae.apply(void 0,se):console.error("worker module init function failed to rehydrate"),X[oe]={id:oe,value:ce,getTransferables:ge},ne(ce)}catch(de){de&&de.noLog||console.error(de),ne(de)}}function _(te,ne){var oe,ie=te.id,se=te.args;(!X[ie]||typeof X[ie].value!="function")&&ne(new Error("Worker module "+ie+": not found or its 'init' did not return a function"));try{var ae=(oe=X[ie]).value.apply(oe,se);ae&&typeof ae.then=="function"?ae.then(ge,function(ce){return ne(ce instanceof Error?ce:new Error(""+ce))}):ge(ae)}catch(ce){ne(ce)}function ge(ce){try{var de=X[ie].getTransferables&&X[ie].getTransferables(ce);(!de||!Array.isArray(de)||!de.length)&&(de=void 0),ne(ce,de)}catch(pe){console.error(pe),ne(pe)}}}function K(te,ne){var oe=void 0;self.troikaDefine=function(se){return oe=se};var ie=URL.createObjectURL(new Blob(["/** "+te.replace(/\*/g,"")+` **/

troikaDefine(
`+ne+`
)`],{type:"application/javascript"}));try{importScripts(ie)}catch(se){console.error(se)}return URL.revokeObjectURL(ie),delete self.troikaDefine,oe}self.addEventListener("message",function(te){var ne=te.data,oe=ne.messageId,ie=ne.action,se=ne.data;try{ie==="registerModule"&&Z(se,function(ae){ae instanceof Error?postMessage({messageId:oe,success:!1,error:ae.message}):postMessage({messageId:oe,success:!0,result:{isCallable:typeof ae=="function"}})}),ie==="callModule"&&_(se,function(ae,ge){ae instanceof Error?postMessage({messageId:oe,success:!1,error:ae.message}):postMessage({messageId:oe,success:!0,result:ae},ge||void 0)})}catch(ae){postMessage({messageId:oe,success:!1,error:ae.stack})}})}function defineMainThreadModule(X){var Z=function(){for(var _=[],K=arguments.length;K--;)_[K]=arguments[K];return Z._getInitResult().then(function(te){if(typeof te=="function")return te.apply(void 0,_);throw new Error("Worker module function was called but `init` did not return a callable function")})};return Z._getInitResult=function(){var _=X.dependencies,K=X.init;_=Array.isArray(_)?_.map(function(ne){return ne&&(ne=ne.onMainThread||ne,ne._getInitResult&&(ne=ne._getInitResult())),ne}):[];var te=Promise.all(_).then(function(ne){return K.apply(null,ne)});return Z._getInitResult=function(){return te},te},Z}var supportsWorkers=function(){var X=!1;if(typeof window<"u"&&typeof window.document<"u")try{var Z=new Worker(URL.createObjectURL(new Blob([""],{type:"application/javascript"})));Z.terminate(),X=!0}catch(_){console.log("Troika createWorkerModule: web workers not allowed; falling back to main thread execution. Cause: ["+_.message+"]")}return supportsWorkers=function(){return X},X},_workerModuleId=0,_messageId=0,_allowInitAsString=!1,workers=Object.create(null),registeredModules=Object.create(null),openRequests=Object.create(null);function defineWorkerModule(X){if((!X||typeof X.init!="function")&&!_allowInitAsString)throw new Error("requires `options.init` function");var Z=X.dependencies,_=X.init,K=X.getTransferables,te=X.workerId,ne=defineMainThreadModule(X);te==null&&(te="#default");var oe="workerModule"+ ++_workerModuleId,ie=X.name||oe,se=null;Z=Z&&Z.map(function(ge){return typeof ge=="function"&&!ge.workerModuleData&&(_allowInitAsString=!0,ge=defineWorkerModule({workerId:te,name:"<"+ie+"> function dependency: "+ge.name,init:`function(){return (
`+stringifyFunction(ge)+`
)}`}),_allowInitAsString=!1),ge&&ge.workerModuleData&&(ge=ge.workerModuleData),ge});function ae(){for(var ge=[],ce=arguments.length;ce--;)ge[ce]=arguments[ce];if(!supportsWorkers())return ne.apply(void 0,ge);if(!se){se=callWorker(te,"registerModule",ae.workerModuleData);var de=function(){se=null,registeredModules[te].delete(de)};(registeredModules[te]||(registeredModules[te]=new Set)).add(de)}return se.then(function(pe){var fe=pe.isCallable;if(fe)return callWorker(te,"callModule",{id:oe,args:ge});throw new Error("Worker module function was called but `init` did not return a callable function")})}return ae.workerModuleData={isWorkerModule:!0,id:oe,name:ie,dependencies:Z,init:stringifyFunction(_),getTransferables:K&&stringifyFunction(K)},ae.onMainThread=ne,ae}function terminateWorker(X){registeredModules[X]&&registeredModules[X].forEach(function(Z){Z()}),workers[X]&&(workers[X].terminate(),delete workers[X])}function stringifyFunction(X){var Z=X.toString();return!/^function/.test(Z)&&/^\w+\s*\(/.test(Z)&&(Z="function "+Z),Z}function getWorker(X){var Z=workers[X];if(!Z){var _=stringifyFunction(workerBootstrap);Z=workers[X]=new Worker(URL.createObjectURL(new Blob(["/** Worker Module Bootstrap: "+X.replace(/\*/g,"")+` **/

;(`+_+")()"],{type:"application/javascript"}))),Z.onmessage=function(K){var te=K.data,ne=te.messageId,oe=openRequests[ne];if(!oe)throw new Error("WorkerModule response with empty or unknown messageId");delete openRequests[ne],oe(te)}}return Z}function callWorker(X,Z,_){return new Promise(function(K,te){var ne=++_messageId;openRequests[ne]=function(oe){oe.success?K(oe.result):te(new Error("Error in worker "+Z+" call: "+oe.error))},getWorker(X).postMessage({messageId:ne,action:Z,data:_})})}function SDFGenerator(){var X=function(Z){function _($e,je,Te,De,ot,ct,gt,pt){var ht=1-gt;pt.x=ht*ht*$e+2*ht*gt*Te+gt*gt*ot,pt.y=ht*ht*je+2*ht*gt*De+gt*gt*ct}function K($e,je,Te,De,ot,ct,gt,pt,ht,At){var Kt=1-ht;At.x=Kt*Kt*Kt*$e+3*Kt*Kt*ht*Te+3*Kt*ht*ht*ot+ht*ht*ht*gt,At.y=Kt*Kt*Kt*je+3*Kt*Kt*ht*De+3*Kt*ht*ht*ct+ht*ht*ht*pt}function te($e,je){for(var Te=/([MLQCZ])([^MLQCZ]*)/g,De,ot,ct,gt,pt;De=Te.exec($e);){var ht=De[2].replace(/^\s*|\s*$/g,"").split(/[,\s]+/).map(function(At){return parseFloat(At)});switch(De[1]){case"M":gt=ot=ht[0],pt=ct=ht[1];break;case"L":(ht[0]!==gt||ht[1]!==pt)&&je("L",gt,pt,gt=ht[0],pt=ht[1]);break;case"Q":{je("Q",gt,pt,gt=ht[2],pt=ht[3],ht[0],ht[1]);break}case"C":{je("C",gt,pt,gt=ht[4],pt=ht[5],ht[0],ht[1],ht[2],ht[3]);break}case"Z":(gt!==ot||pt!==ct)&&je("L",gt,pt,ot,ct);break}}}function ne($e,je,Te){Te===void 0&&(Te=16);var De={x:0,y:0};te($e,function(ot,ct,gt,pt,ht,At,Kt,en,Zt){switch(ot){case"L":je(ct,gt,pt,ht);break;case"Q":{for(var st=ct,Vt=gt,wt=1;wt<Te;wt++)_(ct,gt,At,Kt,pt,ht,wt/(Te-1),De),je(st,Vt,De.x,De.y),st=De.x,Vt=De.y;break}case"C":{for(var St=ct,Rt=gt,jt=1;jt<Te;jt++)K(ct,gt,At,Kt,en,Zt,pt,ht,jt/(Te-1),De),je(St,Rt,De.x,De.y),St=De.x,Rt=De.y;break}}})}var oe="precision highp float;attribute vec2 aUV;varying vec2 vUV;void main(){vUV=aUV;gl_Position=vec4(mix(vec2(-1.0),vec2(1.0),aUV),0.0,1.0);}",ie="precision highp float;uniform sampler2D tex;varying vec2 vUV;void main(){gl_FragColor=texture2D(tex,vUV);}",se=new WeakMap,ae={premultipliedAlpha:!1,preserveDrawingBuffer:!0,antialias:!1,depth:!1};function ge($e,je){var Te=$e.getContext?$e.getContext("webgl",ae):$e,De=se.get(Te);if(!De){let St=function(Mt){var un=ct[Mt];if(!un&&(un=ct[Mt]=Te.getExtension(Mt),!un))throw new Error(Mt+" not supported");return un},Rt=function(Mt,un){var qe=Te.createShader(un);return Te.shaderSource(qe,Mt),Te.compileShader(qe),qe},jt=function(Mt,un,qe,Je){if(!gt[Mt]){var mt={},Dt={},_t=Te.createProgram();Te.attachShader(_t,Rt(un,Te.VERTEX_SHADER)),Te.attachShader(_t,Rt(qe,Te.FRAGMENT_SHADER)),Te.linkProgram(_t),gt[Mt]={program:_t,transaction:function(nn){Te.useProgram(_t),nn({setUniform:function(Ft,pn){for(var sn=[],rn=arguments.length-2;rn-- >0;)sn[rn]=arguments[rn+2];var $t=Dt[pn]||(Dt[pn]=Te.getUniformLocation(_t,pn));Te["uniform"+Ft].apply(Te,[$t].concat(sn))},setAttribute:function(Ft,pn,sn,rn,$t){var on=mt[Ft];on||(on=mt[Ft]={buf:Te.createBuffer(),loc:Te.getAttribLocation(_t,Ft),data:null}),Te.bindBuffer(Te.ARRAY_BUFFER,on.buf),Te.vertexAttribPointer(on.loc,pn,Te.FLOAT,!1,0,0),Te.enableVertexAttribArray(on.loc),ot?Te.vertexAttribDivisor(on.loc,rn):St("ANGLE_instanced_arrays").vertexAttribDivisorANGLE(on.loc,rn),$t!==on.data&&(Te.bufferData(Te.ARRAY_BUFFER,$t,sn),on.data=$t)}})}}}gt[Mt].transaction(Je)},Wt=function(Mt,un){ht++;try{Te.activeTexture(Te.TEXTURE0+ht);var qe=pt[Mt];qe||(qe=pt[Mt]=Te.createTexture(),Te.bindTexture(Te.TEXTURE_2D,qe),Te.texParameteri(Te.TEXTURE_2D,Te.TEXTURE_MIN_FILTER,Te.NEAREST),Te.texParameteri(Te.TEXTURE_2D,Te.TEXTURE_MAG_FILTER,Te.NEAREST)),Te.bindTexture(Te.TEXTURE_2D,qe),un(qe,ht)}finally{ht--}},Ht=function(Mt,un,qe){var Je=Te.createFramebuffer();At.push(Je),Te.bindFramebuffer(Te.FRAMEBUFFER,Je),Te.activeTexture(Te.TEXTURE0+un),Te.bindTexture(Te.TEXTURE_2D,Mt),Te.framebufferTexture2D(Te.FRAMEBUFFER,Te.COLOR_ATTACHMENT0,Te.TEXTURE_2D,Mt,0);try{qe(Je)}finally{Te.deleteFramebuffer(Je),Te.bindFramebuffer(Te.FRAMEBUFFER,At[--At.length-1]||null)}},Pt=function(){ct={},gt={},pt={},ht=-1,At.length=0};var Kt=St,en=Rt,Zt=jt,st=Wt,Vt=Ht,wt=Pt,ot=typeof WebGL2RenderingContext<"u"&&Te instanceof WebGL2RenderingContext,ct={},gt={},pt={},ht=-1,At=[];Te.canvas.addEventListener("webglcontextlost",function(Mt){Pt(),Mt.preventDefault()},!1),se.set(Te,De={gl:Te,isWebGL2:ot,getExtension:St,withProgram:jt,withTexture:Wt,withTextureFramebuffer:Ht,handleContextLoss:Pt})}je(De)}function ce($e,je,Te,De,ot,ct,gt,pt){gt===void 0&&(gt=15),pt===void 0&&(pt=null),ge($e,function(ht){var At=ht.gl,Kt=ht.withProgram,en=ht.withTexture;en("copy",function(Zt,st){At.texImage2D(At.TEXTURE_2D,0,At.RGBA,ot,ct,0,At.RGBA,At.UNSIGNED_BYTE,je),Kt("copy",oe,ie,function(Vt){var wt=Vt.setUniform,St=Vt.setAttribute;St("aUV",2,At.STATIC_DRAW,0,new Float32Array([0,0,2,0,0,2])),wt("1i","image",st),At.bindFramebuffer(At.FRAMEBUFFER,pt||null),At.disable(At.BLEND),At.colorMask(gt&8,gt&4,gt&2,gt&1),At.viewport(Te,De,ot,ct),At.scissor(Te,De,ot,ct),At.drawArrays(At.TRIANGLES,0,3)})})})}function de($e,je,Te){var De=$e.width,ot=$e.height;ge($e,function(ct){var gt=ct.gl,pt=new Uint8Array(De*ot*4);gt.readPixels(0,0,De,ot,gt.RGBA,gt.UNSIGNED_BYTE,pt),$e.width=je,$e.height=Te,ce(gt,pt,0,0,De,ot)})}var pe=Object.freeze({__proto__:null,withWebGLContext:ge,renderImageData:ce,resizeWebGLCanvasWithoutClearing:de});function fe($e,je,Te,De,ot,ct){ct===void 0&&(ct=1);var gt=new Uint8Array($e*je),pt=De[2]-De[0],ht=De[3]-De[1],At=[];ne(Te,function(St,Rt,jt,Wt){At.push({x1:St,y1:Rt,x2:jt,y2:Wt,minX:Math.min(St,jt),minY:Math.min(Rt,Wt),maxX:Math.max(St,jt),maxY:Math.max(Rt,Wt)})}),At.sort(function(St,Rt){return St.maxX-Rt.maxX});for(var Kt=0;Kt<$e;Kt++)for(var en=0;en<je;en++){var Zt=Vt(De[0]+pt*(Kt+.5)/$e,De[1]+ht*(en+.5)/je),st=Math.pow(1-Math.abs(Zt)/ot,ct)/2;Zt<0&&(st=1-st),st=Math.max(0,Math.min(255,Math.round(st*255))),gt[en*$e+Kt]=st}return gt;function Vt(St,Rt){for(var jt=1/0,Wt=1/0,Ht=At.length;Ht--;){var Pt=At[Ht];if(Pt.maxX+Wt<=St)break;if(St+Wt>Pt.minX&&Rt-Wt<Pt.maxY&&Rt+Wt>Pt.minY){var Mt=ye(St,Rt,Pt.x1,Pt.y1,Pt.x2,Pt.y2);Mt<jt&&(jt=Mt,Wt=Math.sqrt(jt))}}return wt(St,Rt)&&(Wt=-Wt),Wt}function wt(St,Rt){for(var jt=0,Wt=At.length;Wt--;){var Ht=At[Wt];if(Ht.maxX<=St)break;var Pt=Ht.y1>Rt!=Ht.y2>Rt&&St<(Ht.x2-Ht.x1)*(Rt-Ht.y1)/(Ht.y2-Ht.y1)+Ht.x1;Pt&&(jt+=Ht.y1<Ht.y2?1:-1)}return jt!==0}}function be($e,je,Te,De,ot,ct,gt,pt,ht,At){ct===void 0&&(ct=1),pt===void 0&&(pt=0),ht===void 0&&(ht=0),At===void 0&&(At=0),me($e,je,Te,De,ot,ct,gt,null,pt,ht,At)}function me($e,je,Te,De,ot,ct,gt,pt,ht,At,Kt){ct===void 0&&(ct=1),ht===void 0&&(ht=0),At===void 0&&(At=0),Kt===void 0&&(Kt=0);for(var en=fe($e,je,Te,De,ot,ct),Zt=new Uint8Array(en.length*4),st=0;st<en.length;st++)Zt[st*4+Kt]=en[st];ce(gt,Zt,ht,At,$e,je,1<<3-Kt,pt)}function ye($e,je,Te,De,ot,ct){var gt=ot-Te,pt=ct-De,ht=gt*gt+pt*pt,At=ht?Math.max(0,Math.min(1,(($e-Te)*gt+(je-De)*pt)/ht)):0,Kt=$e-(Te+At*gt),en=je-(De+At*pt);return Kt*Kt+en*en}var ve=Object.freeze({__proto__:null,generate:fe,generateIntoCanvas:be,generateIntoFramebuffer:me}),Be="precision highp float;uniform vec4 uGlyphBounds;attribute vec2 aUV;attribute vec4 aLineSegment;varying vec4 vLineSegment;varying vec2 vGlyphXY;void main(){vLineSegment=aLineSegment;vGlyphXY=mix(uGlyphBounds.xy,uGlyphBounds.zw,aUV);gl_Position=vec4(mix(vec2(-1.0),vec2(1.0),aUV),0.0,1.0);}",Re="precision highp float;uniform vec4 uGlyphBounds;uniform float uMaxDistance;uniform float uExponent;varying vec4 vLineSegment;varying vec2 vGlyphXY;float absDistToSegment(vec2 point,vec2 lineA,vec2 lineB){vec2 lineDir=lineB-lineA;float lenSq=dot(lineDir,lineDir);float t=lenSq==0.0 ? 0.0 : clamp(dot(point-lineA,lineDir)/lenSq,0.0,1.0);vec2 linePt=lineA+t*lineDir;return distance(point,linePt);}void main(){vec4 seg=vLineSegment;vec2 p=vGlyphXY;float dist=absDistToSegment(p,seg.xy,seg.zw);float val=pow(1.0-clamp(dist/uMaxDistance,0.0,1.0),uExponent)*0.5;bool crossing=(seg.y>p.y!=seg.w>p.y)&&(p.x<(seg.z-seg.x)*(p.y-seg.y)/(seg.w-seg.y)+seg.x);bool crossingUp=crossing&&vLineSegment.y<vLineSegment.w;gl_FragColor=vec4(crossingUp ? 1.0/255.0 : 0.0,crossing&&!crossingUp ? 1.0/255.0 : 0.0,0.0,val);}",Ee="precision highp float;uniform sampler2D tex;varying vec2 vUV;void main(){vec4 color=texture2D(tex,vUV);bool inside=color.r!=color.g;float val=inside ? 1.0-color.a : color.a;gl_FragColor=vec4(val);}",We=new Float32Array([0,0,2,0,0,2]),Ze=null,Ve=!1,_e={},Xe=new WeakMap;function Pe($e){if(!Ve&&!tt($e))throw new Error("WebGL generation not supported")}function He($e,je,Te,De,ot,ct,gt){if(ct===void 0&&(ct=1),gt===void 0&&(gt=null),!gt&&(gt=Ze,!gt)){var pt=typeof OffscreenCanvas=="function"?new OffscreenCanvas(1,1):typeof document<"u"?document.createElement("canvas"):null;if(!pt)throw new Error("OffscreenCanvas or DOM canvas not supported");gt=Ze=pt.getContext("webgl",{depth:!1})}Pe(gt);var ht=new Uint8Array($e*je*4);ge(gt,function(Zt){var st=Zt.gl,Vt=Zt.withTexture,wt=Zt.withTextureFramebuffer;Vt("readable",function(St,Rt){st.texImage2D(st.TEXTURE_2D,0,st.RGBA,$e,je,0,st.RGBA,st.UNSIGNED_BYTE,null),wt(St,Rt,function(jt){Ue($e,je,Te,De,ot,ct,st,jt,0,0,0),st.readPixels(0,0,$e,je,st.RGBA,st.UNSIGNED_BYTE,ht)})})});for(var At=new Uint8Array($e*je),Kt=0,en=0;Kt<ht.length;Kt+=4)At[en++]=ht[Kt];return At}function Ke($e,je,Te,De,ot,ct,gt,pt,ht,At){ct===void 0&&(ct=1),pt===void 0&&(pt=0),ht===void 0&&(ht=0),At===void 0&&(At=0),Ue($e,je,Te,De,ot,ct,gt,null,pt,ht,At)}function Ue($e,je,Te,De,ot,ct,gt,pt,ht,At,Kt){ct===void 0&&(ct=1),ht===void 0&&(ht=0),At===void 0&&(At=0),Kt===void 0&&(Kt=0),Pe(gt);var en=[];ne(Te,function(Zt,st,Vt,wt){en.push(Zt,st,Vt,wt)}),en=new Float32Array(en),ge(gt,function(Zt){var st=Zt.gl,Vt=Zt.isWebGL2,wt=Zt.getExtension,St=Zt.withProgram,Rt=Zt.withTexture,jt=Zt.withTextureFramebuffer,Wt=Zt.handleContextLoss;if(Rt("rawDistances",function(Ht,Pt){($e!==Ht._lastWidth||je!==Ht._lastHeight)&&st.texImage2D(st.TEXTURE_2D,0,st.RGBA,Ht._lastWidth=$e,Ht._lastHeight=je,0,st.RGBA,st.UNSIGNED_BYTE,null),St("main",Be,Re,function(Mt){var un=Mt.setAttribute,qe=Mt.setUniform,Je=!Vt&&wt("ANGLE_instanced_arrays"),mt=!Vt&&wt("EXT_blend_minmax");un("aUV",2,st.STATIC_DRAW,0,We),un("aLineSegment",4,st.DYNAMIC_DRAW,1,en),qe.apply(void 0,["4f","uGlyphBounds"].concat(De)),qe("1f","uMaxDistance",ot),qe("1f","uExponent",ct),jt(Ht,Pt,function(Dt){st.enable(st.BLEND),st.colorMask(!0,!0,!0,!0),st.viewport(0,0,$e,je),st.scissor(0,0,$e,je),st.blendFunc(st.ONE,st.ONE),st.blendEquationSeparate(st.FUNC_ADD,Vt?st.MAX:mt.MAX_EXT),st.clear(st.COLOR_BUFFER_BIT),Vt?st.drawArraysInstanced(st.TRIANGLES,0,3,en.length/4):Je.drawArraysInstancedANGLE(st.TRIANGLES,0,3,en.length/4)})}),St("post",oe,Ee,function(Mt){Mt.setAttribute("aUV",2,st.STATIC_DRAW,0,We),Mt.setUniform("1i","tex",Pt),st.bindFramebuffer(st.FRAMEBUFFER,pt),st.disable(st.BLEND),st.colorMask(Kt===0,Kt===1,Kt===2,Kt===3),st.viewport(ht,At,$e,je),st.scissor(ht,At,$e,je),st.drawArrays(st.TRIANGLES,0,3)})}),st.isContextLost())throw Wt(),new Error("webgl context lost")})}function tt($e){var je=!$e||$e===Ze?_e:$e.canvas||$e,Te=Xe.get(je);if(Te===void 0){Ve=!0;var De=null;try{var ot=[97,106,97,61,99,137,118,80,80,118,137,99,61,97,106,97],ct=He(4,4,"M8,8L16,8L24,24L16,24Z",[0,0,32,32],24,1,$e);Te=ct&&ot.length===ct.length&&ct.every(function(gt,pt){return gt===ot[pt]}),Te||(De="bad trial run results",console.info(ot,ct))}catch(gt){Te=!1,De=gt.message}De&&console.warn("WebGL SDF generation not supported:",De),Ve=!1,Xe.set(je,Te)}return Te}var rt=Object.freeze({__proto__:null,generate:He,generateIntoCanvas:Ke,generateIntoFramebuffer:Ue,isSupported:tt});function at($e,je,Te,De,ot,ct){ot===void 0&&(ot=Math.max(De[2]-De[0],De[3]-De[1])/2),ct===void 0&&(ct=1);try{return He.apply(rt,arguments)}catch(gt){return console.info("WebGL SDF generation failed, falling back to JS",gt),fe.apply(ve,arguments)}}function Oe($e,je,Te,De,ot,ct,gt,pt,ht,At){ot===void 0&&(ot=Math.max(De[2]-De[0],De[3]-De[1])/2),ct===void 0&&(ct=1),pt===void 0&&(pt=0),ht===void 0&&(ht=0),At===void 0&&(At=0);try{return Ke.apply(rt,arguments)}catch(Kt){return console.info("WebGL SDF generation failed, falling back to JS",Kt),be.apply(ve,arguments)}}return Z.forEachPathCommand=te,Z.generate=at,Z.generateIntoCanvas=Oe,Z.javascript=ve,Z.pathToLineSegments=ne,Z.webgl=rt,Z.webglUtils=pe,Object.defineProperty(Z,"__esModule",{value:!0}),Z}({});return X}function bidiFactory(){var X=function(Z){var _={R:"13k,1a,2,3,3,2+1j,ch+16,a+1,5+2,2+n,5,a,4,6+16,4+3,h+1b,4mo,179q,2+9,2+11,2i9+7y,2+68,4,3+4,5+13,4+3,2+4k,3+29,8+cf,1t+7z,w+17,3+3m,1t+3z,16o1+5r,8+30,8+mc,29+1r,29+4v,75+73",EN:"1c+9,3d+1,6,187+9,513,4+5,7+9,sf+j,175h+9,qw+q,161f+1d,4xt+a,25i+9",ES:"17,2,6dp+1,f+1,av,16vr,mx+1,4o,2",ET:"z+2,3h+3,b+1,ym,3e+1,2o,p4+1,8,6u,7c,g6,1wc,1n9+4,30+1b,2n,6d,qhx+1,h0m,a+1,49+2,63+1,4+1,6bb+3,12jj",AN:"16o+5,2j+9,2+1,35,ed,1ff2+9,87+u",CS:"18,2+1,b,2u,12k,55v,l,17v0,2,3,53,2+1,b",B:"a,3,f+2,2v,690",S:"9,2,k",WS:"c,k,4f4,1vk+a,u,1j,335",ON:"x+1,4+4,h+5,r+5,r+3,z,5+3,2+1,2+1,5,2+2,3+4,o,w,ci+1,8+d,3+d,6+8,2+g,39+1,9,6+1,2,33,b8,3+1,3c+1,7+1,5r,b,7h+3,sa+5,2,3i+6,jg+3,ur+9,2v,ij+1,9g+9,7+a,8m,4+1,49+x,14u,2+2,c+2,e+2,e+2,e+1,i+n,e+e,2+p,u+2,e+2,36+1,2+3,2+1,b,2+2,6+5,2,2,2,h+1,5+4,6+3,3+f,16+2,5+3l,3+81,1y+p,2+40,q+a,m+13,2r+ch,2+9e,75+hf,3+v,2+2w,6e+5,f+6,75+2a,1a+p,2+2g,d+5x,r+b,6+3,4+o,g,6+1,6+2,2k+1,4,2j,5h+z,1m+1,1e+f,t+2,1f+e,d+3,4o+3,2s+1,w,535+1r,h3l+1i,93+2,2s,b+1,3l+x,2v,4g+3,21+3,kz+1,g5v+1,5a,j+9,n+v,2,3,2+8,2+1,3+2,2,3,46+1,4+4,h+5,r+5,r+a,3h+2,4+6,b+4,78,1r+24,4+c,4,1hb,ey+6,103+j,16j+c,1ux+7,5+g,fsh,jdq+1t,4,57+2e,p1,1m,1m,1m,1m,4kt+1,7j+17,5+2r,d+e,3+e,2+e,2+10,m+4,w,1n+5,1q,4z+5,4b+rb,9+c,4+c,4+37,d+2g,8+b,l+b,5+1j,9+9,7+13,9+t,3+1,27+3c,2+29,2+3q,d+d,3+4,4+2,6+6,a+o,8+6,a+2,e+6,16+42,2+1i",BN:"0+8,6+d,2s+5,2+p,e,4m9,1kt+2,2b+5,5+5,17q9+v,7k,6p+8,6+1,119d+3,440+7,96s+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+75,6p+2rz,1ben+1,1ekf+1,1ekf+1",NSM:"lc+33,7o+6,7c+18,2,2+1,2+1,2,21+a,1d+k,h,2u+6,3+5,3+1,2+3,10,v+q,2k+a,1n+8,a,p+3,2+8,2+2,2+4,18+2,3c+e,2+v,1k,2,5+7,5,4+6,b+1,u,1n,5+3,9,l+1,r,3+1,1m,5+1,5+1,3+2,4,v+1,4,c+1,1m,5+4,2+1,5,l+1,n+5,2,1n,3,2+3,9,8+1,c+1,v,1q,d,1f,4,1m+2,6+2,2+3,8+1,c+1,u,1n,g+1,l+1,t+1,1m+1,5+3,9,l+1,u,21,8+2,2,2j,3+6,d+7,2r,3+8,c+5,23+1,s,2,2,1k+d,2+4,2+1,6+a,2+z,a,2v+3,2+5,2+1,3+1,q+1,5+2,h+3,e,3+1,7,g,jk+2,qb+2,u+2,u+1,v+1,1t+1,2+6,9,3+a,a,1a+2,3c+1,z,3b+2,5+1,a,7+2,64+1,3,1n,2+6,2,2,3+7,7+9,3,1d+g,1s+3,1d,2+4,2,6,15+8,d+1,x+3,3+1,2+2,1l,2+1,4,2+2,1n+7,3+1,49+2,2+c,2+6,5,7,4+1,5j+1l,2+4,k1+w,2db+2,3y,2p+v,ff+3,30+1,n9x+3,2+9,x+1,29+1,7l,4,5,q+1,6,48+1,r+h,e,13+7,q+a,1b+2,1d,3+3,3+1,14,1w+5,3+1,3+1,d,9,1c,1g,2+2,3+1,6+1,2,17+1,9,6n,3,5,fn5,ki+f,h+f,r2,6b,46+4,1af+2,2+1,6+3,15+2,5,4m+1,fy+3,as+1,4a+a,4x,1j+e,1l+2,1e+3,3+1,1y+2,11+4,2+7,1r,d+1,1h+8,b+3,3,2o+2,3,2+1,7,4h,4+7,m+1,1m+1,4,12+6,4+4,5g+7,3+2,2,o,2d+5,2,5+1,2+1,6n+3,7+1,2+1,s+1,2e+7,3,2+1,2z,2,3+5,2,2u+2,3+3,2+4,78+8,2+1,75+1,2,5,41+3,3+1,5,x+5,3+1,15+5,3+3,9,a+5,3+2,1b+c,2+1,bb+6,2+5,2d+l,3+6,2+1,2+1,3f+5,4,2+1,2+6,2,21+1,4,2,9o+1,f0c+4,1o+6,t5,1s+3,2a,f5l+1,43t+2,i+7,3+6,v+3,45+2,1j0+1i,5+1d,9,f,n+4,2+e,11t+6,2+g,3+6,2+1,2+4,7a+6,c6+3,15t+6,32+6,gzhy+6n",AL:"16w,3,2,e+1b,z+2,2+2s,g+1,8+1,b+m,2+t,s+2i,c+e,4h+f,1d+1e,1bwe+dp,3+3z,x+c,2+1,35+3y,2rm+z,5+7,b+5,dt+l,c+u,17nl+27,1t+27,4x+6n,3+d",LRO:"6ct",RLO:"6cu",LRE:"6cq",RLE:"6cr",PDF:"6cs",LRI:"6ee",RLI:"6ef",FSI:"6eg",PDI:"6eh"},K={},te={};K.L=1,te[1]="L",Object.keys(_).forEach(function(Wt,Ht){K[Wt]=1<<Ht+1,te[K[Wt]]=Wt}),Object.freeze(K);var ne=K.LRI|K.RLI|K.FSI,oe=K.L|K.R|K.AL,ie=K.B|K.S|K.WS|K.ON|K.FSI|K.LRI|K.RLI|K.PDI,se=K.BN|K.RLE|K.LRE|K.RLO|K.LRO|K.PDF,ae=K.S|K.WS|K.B|ne|K.PDI|se,ge=null;function ce(){if(!ge){ge=new Map;var Wt=function(Pt){if(_.hasOwnProperty(Pt)){var Mt=0;_[Pt].split(",").forEach(function(un){var qe=un.split("+"),Je=qe[0],mt=qe[1];Je=parseInt(Je,36),mt=mt?parseInt(mt,36):0,ge.set(Mt+=Je,K[Pt]);for(var Dt=0;Dt<mt;Dt++)ge.set(++Mt,K[Pt])})}};for(var Ht in _)Wt(Ht)}}function de(Wt){return ce(),ge.get(Wt.codePointAt(0))||K.L}function pe(Wt){return te[de(Wt)]}var fe={pairs:"14>1,1e>2,u>2,2wt>1,1>1,1ge>1,1wp>1,1j>1,f>1,hm>1,1>1,u>1,u6>1,1>1,+5,28>1,w>1,1>1,+3,b8>1,1>1,+3,1>3,-1>-1,3>1,1>1,+2,1s>1,1>1,x>1,th>1,1>1,+2,db>1,1>1,+3,3>1,1>1,+2,14qm>1,1>1,+1,4q>1,1e>2,u>2,2>1,+1",canonical:"6f1>-6dx,6dy>-6dx,6ec>-6ed,6ee>-6ed,6ww>2jj,-2ji>2jj,14r4>-1e7l,1e7m>-1e7l,1e7m>-1e5c,1e5d>-1e5b,1e5c>-14qx,14qy>-14qx,14vn>-1ecg,1ech>-1ecg,1edu>-1ecg,1eci>-1ecg,1eda>-1ecg,1eci>-1ecg,1eci>-168q,168r>-168q,168s>-14ye,14yf>-14ye"};function be(Wt,Ht){var Pt=36,Mt=0,un=new Map,qe=Ht&&new Map,Je;return Wt.split(",").forEach(function mt(Dt){if(Dt.indexOf("+")!==-1)for(var _t=+Dt;_t--;)mt(Je);else{Je=Dt;var zt=Dt.split(">"),nn=zt[0],tn=zt[1];nn=String.fromCodePoint(Mt+=parseInt(nn,Pt)),tn=String.fromCodePoint(Mt+=parseInt(tn,Pt)),un.set(nn,tn),Ht&&qe.set(tn,nn)}}),{map:un,reverseMap:qe}}var me,ye,ve;function Be(){if(!me){var Wt=be(fe.pairs,!0),Ht=Wt.map,Pt=Wt.reverseMap;me=Ht,ye=Pt,ve=be(fe.canonical,!1).map}}function Re(Wt){return Be(),me.get(Wt)||null}function Ee(Wt){return Be(),ye.get(Wt)||null}function We(Wt){return Be(),ve.get(Wt)||null}var Ze=K.L,Ve=K.R,_e=K.EN,Xe=K.ES,Pe=K.ET,He=K.AN,Ke=K.CS,Ue=K.B,tt=K.S,rt=K.ON,at=K.BN,Oe=K.NSM,$e=K.AL,je=K.LRO,Te=K.RLO,De=K.LRE,ot=K.RLE,ct=K.PDF,gt=K.LRI,pt=K.RLI,ht=K.FSI,At=K.PDI;function Kt(Wt,Ht){for(var Pt=125,Mt=new Uint32Array(Wt.length),un=0;un<Wt.length;un++)Mt[un]=de(Wt[un]);var qe=new Map;function Je(Ur,Qr){var Kr=Mt[Ur];Mt[Ur]=Qr,qe.set(Kr,qe.get(Kr)-1),Kr&ie&&qe.set(ie,qe.get(ie)-1),qe.set(Qr,(qe.get(Qr)||0)+1),Qr&ie&&qe.set(ie,(qe.get(ie)||0)+1)}for(var mt=new Uint8Array(Wt.length),Dt=new Map,_t=[],zt=null,nn=0;nn<Wt.length;nn++)zt||_t.push(zt={start:nn,end:Wt.length-1,level:Ht==="rtl"?1:Ht==="ltr"?0:ii(nn,!1)}),Mt[nn]&Ue&&(zt.end=nn,zt=null);for(var tn=ot|De|Te|je|ne|At|ct|Ue,Ft=function(Ur){return Ur+(Ur&1?1:2)},pn=function(Ur){return Ur+(Ur&1?2:1)},sn=0;sn<_t.length;sn++){zt=_t[sn];var rn=[{_level:zt.level,_override:0,_isolate:0}],$t=void 0,on=0,An=0,wn=0;qe.clear();for(var ft=zt.start;ft<=zt.end;ft++){var vt=Mt[ft];if($t=rn[rn.length-1],qe.set(vt,(qe.get(vt)||0)+1),vt&ie&&qe.set(ie,(qe.get(ie)||0)+1),vt&tn)if(vt&(ot|De)){mt[ft]=$t._level;var Et=(vt===ot?pn:Ft)($t._level);Et<=Pt&&!on&&!An?rn.push({_level:Et,_override:0,_isolate:0}):on||An++}else if(vt&(Te|je)){mt[ft]=$t._level;var gn=(vt===Te?pn:Ft)($t._level);gn<=Pt&&!on&&!An?rn.push({_level:gn,_override:vt&Te?Ve:Ze,_isolate:0}):on||An++}else if(vt&ne){vt&ht&&(vt=ii(ft+1,!0)===1?pt:gt),mt[ft]=$t._level,$t._override&&Je(ft,$t._override);var an=(vt===pt?pn:Ft)($t._level);an<=Pt&&on===0&&An===0?(wn++,rn.push({_level:an,_override:0,_isolate:1,_isolInitIndex:ft})):on++}else if(vt&At){if(on>0)on--;else if(wn>0){for(An=0;!rn[rn.length-1]._isolate;)rn.pop();var vn=rn[rn.length-1]._isolInitIndex;vn!=null&&(Dt.set(vn,ft),Dt.set(ft,vn)),rn.pop(),wn--}$t=rn[rn.length-1],mt[ft]=$t._level,$t._override&&Je(ft,$t._override)}else vt&ct?(on===0&&(An>0?An--:!$t._isolate&&rn.length>1&&(rn.pop(),$t=rn[rn.length-1])),mt[ft]=$t._level):vt&Ue&&(mt[ft]=zt.level);else mt[ft]=$t._level,$t._override&&vt!==at&&Je(ft,$t._override)}for(var zn=[],On=null,Tn=zt.start;Tn<=zt.end;Tn++){var Xn=Mt[Tn];if(!(Xn&se)){var dr=mt[Tn],rr=Xn&ne,fr=Xn===At;On&&dr===On._level?(On._end=Tn,On._endsWithIsolInit=rr):zn.push(On={_start:Tn,_end:Tn,_level:dr,_startsWithPDI:fr,_endsWithIsolInit:rr})}}for(var Nr=[],ei=0;ei<zn.length;ei++){var Er=zn[ei];if(!Er._startsWithPDI||Er._startsWithPDI&&!Dt.has(Er._start)){for(var Lr=[On=Er],br=void 0;On&&On._endsWithIsolInit&&(br=Dt.get(On._end))!=null;)for(var kn=ei+1;kn<zn.length;kn++)if(zn[kn]._start===br){Lr.push(On=zn[kn]);break}for(var Hr=[],Yi=0;Yi<Lr.length;Yi++)for(var Qe=Lr[Yi],ke=Qe._start;ke<=Qe._end;ke++)Hr.push(ke);for(var it=mt[Hr[0]],ut=zt.level,lt=Hr[0]-1;lt>=0;lt--)if(!(Mt[lt]&se)){ut=mt[lt];break}var It=Hr[Hr.length-1],Nt=mt[It],Xt=zt.level;if(!(Mt[It]&ne)){for(var Ot=It+1;Ot<=zt.end;Ot++)if(!(Mt[Ot]&se)){Xt=mt[Ot];break}}Nr.push({_seqIndices:Hr,_sosType:Math.max(ut,it)%2?Ve:Ze,_eosType:Math.max(Xt,Nt)%2?Ve:Ze})}}for(var Jt=0;Jt<Nr.length;Jt++){var qt=Nr[Jt],yt=qt._seqIndices,yn=qt._sosType,Cn=qt._eosType,hn=mt[yt[0]]&1?Ve:Ze;if(qe.get(Oe))for(var xn=0;xn<yt.length;xn++){var Hn=yt[xn];if(Mt[Hn]&Oe){for(var Wn=yn,bn=xn-1;bn>=0;bn--)if(!(Mt[yt[bn]]&se)){Wn=Mt[yt[bn]];break}Je(Hn,Wn&(ne|At)?rt:Wn)}}if(qe.get(_e))for(var _n=0;_n<yt.length;_n++){var Zn=yt[_n];if(Mt[Zn]&_e)for(var Nn=_n-1;Nn>=-1;Nn--){var gr=Nn===-1?yn:Mt[yt[Nn]];if(gr&oe){gr===$e&&Je(Zn,He);break}}}if(qe.get($e))for(var Dn=0;Dn<yt.length;Dn++){var cr=yt[Dn];Mt[cr]&$e&&Je(cr,Ve)}if(qe.get(Xe)||qe.get(Ke))for(var tr=1;tr<yt.length-1;tr++){var sr=yt[tr];if(Mt[sr]&(Xe|Ke)){for(var Ir=0,Kn=0,yr=tr-1;yr>=0&&(Ir=Mt[yt[yr]],!!(Ir&se));yr--);for(var ar=tr+1;ar<yt.length&&(Kn=Mt[yt[ar]],!!(Kn&se));ar++);Ir===Kn&&(Mt[sr]===Xe?Ir===_e:Ir&(_e|He))&&Je(sr,Ir)}}if(qe.get(_e))for(var jn=0;jn<yt.length;jn++){var vr=yt[jn];if(Mt[vr]&_e){for(var mi=jn-1;mi>=0&&Mt[yt[mi]]&(Pe|se);mi--)Je(yt[mi],_e);for(jn++;jn<yt.length&&Mt[yt[jn]]&(Pe|se|_e);jn++)Mt[yt[jn]]!==_e&&Je(yt[jn],_e)}}if(qe.get(Pe)||qe.get(Xe)||qe.get(Ke))for(var wr=0;wr<yt.length;wr++){var Ki=yt[wr];if(Mt[Ki]&(Pe|Xe|Ke)){Je(Ki,rt);for(var ho=wr-1;ho>=0&&Mt[yt[ho]]&se;ho--)Je(yt[ho],rt);for(var or=wr+1;or<yt.length&&Mt[yt[or]]&se;or++)Je(yt[or],rt)}}if(qe.get(_e))for(var xo=0,Cs=yn;xo<yt.length;xo++){var aa=yt[xo],la=Mt[aa];la&_e?Cs===Ze&&Je(aa,Ze):la&oe&&(Cs=la)}if(qe.get(ie)){var Zo=Ve|_e|He,Ws=Zo|Ze,ro=[];{for(var fo=[],ui=0;ui<yt.length;ui++)if(Mt[yt[ui]]&ie){var Jn=Wt[yt[ui]],io=void 0;if(Re(Jn)!==null)if(fo.length<63)fo.push({char:Jn,seqIndex:ui});else break;else if((io=Ee(Jn))!==null)for(var zi=fo.length-1;zi>=0;zi--){var Eo=fo[zi].char;if(Eo===io||Eo===Ee(We(Jn))||Re(We(Eo))===Jn){ro.push([fo[zi].seqIndex,ui]),fo.length=zi;break}}}ro.sort(function(Ur,Qr){return Ur[0]-Qr[0]})}for(var oo=0;oo<ro.length;oo++){for(var Al=ro[oo],_r=Al[0],Ao=Al[1],ml=!1,bi=0,hs=_r+1;hs<Ao;hs++){var fs=yt[hs];if(Mt[fs]&Ws){ml=!0;var Di=Mt[fs]&Zo?Ve:Ze;if(Di===hn){bi=Di;break}}}if(ml&&!bi){bi=yn;for(var Xo=_r-1;Xo>=0;Xo--){var As=yt[Xo];if(Mt[As]&Ws){var ti=Mt[As]&Zo?Ve:Ze;ti!==hn?bi=ti:bi=hn;break}}}if(bi){if(Mt[yt[_r]]=Mt[yt[Ao]]=bi,bi!==hn){for(var ni=_r+1;ni<yt.length;ni++)if(!(Mt[yt[ni]]&se)){de(Wt[yt[ni]])&Oe&&(Mt[yt[ni]]=bi);break}}if(bi!==hn){for(var _o=Ao+1;_o<yt.length;_o++)if(!(Mt[yt[_o]]&se)){de(Wt[yt[_o]])&Oe&&(Mt[yt[_o]]=bi);break}}}}for(var so=0;so<yt.length;so++)if(Mt[yt[so]]&ie){for(var Fs=so,ms=so,yi=yn,bs=so-1;bs>=0;bs--)if(Mt[yt[bs]]&se)Fs=bs;else{yi=Mt[yt[bs]]&Zo?Ve:Ze;break}for(var Vi=Cn,ko=so+1;ko<yt.length;ko++)if(Mt[yt[ko]]&(ie|se))ms=ko;else{Vi=Mt[yt[ko]]&Zo?Ve:Ze;break}for(var ri=Fs;ri<=ms;ri++)Mt[yt[ri]]=yi===Vi?yi:hn;so=ms}}}for(var Jr=zt.start;Jr<=zt.end;Jr++){var Yo=mt[Jr],Ti=Mt[Jr];if(Yo&1?Ti&(Ze|_e|He)&&mt[Jr]++:Ti&Ve?mt[Jr]++:Ti&(He|_e)&&(mt[Jr]+=2),Ti&se&&(mt[Jr]=Jr===0?zt.level:mt[Jr-1]),Jr===zt.end||de(Wt[Jr])&(tt|Ue))for(var Ko=Jr;Ko>=0&&de(Wt[Ko])&ae;Ko--)mt[Ko]=zt.level}}return{levels:mt,paragraphs:_t};function ii(Ur,Qr){for(var Kr=Ur;Kr<Wt.length;Kr++){var Fr=Mt[Kr];if(Fr&(Ve|$e))return 1;if(Fr&(Ue|Ze)||Qr&&Fr===At)return 0;if(Fr&ne){var wi=zo(Kr);Kr=wi===-1?Wt.length:wi}}return 0}function zo(Ur){for(var Qr=1,Kr=Ur+1;Kr<Wt.length;Kr++){var Fr=Mt[Kr];if(Fr&Ue)break;if(Fr&At){if(--Qr===0)return Kr}else Fr&ne&&Qr++}return-1}}var en="14>1,j>2,t>2,u>2,1a>g,2v3>1,1>1,1ge>1,1wd>1,b>1,1j>1,f>1,ai>3,-2>3,+1,8>1k0,-1jq>1y7,-1y6>1hf,-1he>1h6,-1h5>1ha,-1h8>1qi,-1pu>1,6>3u,-3s>7,6>1,1>1,f>1,1>1,+2,3>1,1>1,+13,4>1,1>1,6>1eo,-1ee>1,3>1mg,-1me>1mk,-1mj>1mi,-1mg>1mi,-1md>1,1>1,+2,1>10k,-103>1,1>1,4>1,5>1,1>1,+10,3>1,1>8,-7>8,+1,-6>7,+1,a>1,1>1,u>1,u6>1,1>1,+5,26>1,1>1,2>1,2>2,8>1,7>1,4>1,1>1,+5,b8>1,1>1,+3,1>3,-2>1,2>1,1>1,+2,c>1,3>1,1>1,+2,h>1,3>1,a>1,1>1,2>1,3>1,1>1,d>1,f>1,3>1,1a>1,1>1,6>1,7>1,13>1,k>1,1>1,+19,4>1,1>1,+2,2>1,1>1,+18,m>1,a>1,1>1,lk>1,1>1,4>1,2>1,f>1,3>1,1>1,+3,db>1,1>1,+3,3>1,1>1,+2,14qm>1,1>1,+1,6>1,4j>1,j>2,t>2,u>2,2>1,+1",Zt;function st(){if(!Zt){var Wt=be(en,!0),Ht=Wt.map,Pt=Wt.reverseMap;Pt.forEach(function(Mt,un){Ht.set(un,Mt)}),Zt=Ht}}function Vt(Wt){return st(),Zt.get(Wt)||null}function wt(Wt,Ht,Pt,Mt){var un=Wt.length;Pt=Math.max(0,Pt==null?0:+Pt),Mt=Math.min(un-1,Mt==null?un-1:+Mt);for(var qe=new Map,Je=Pt;Je<=Mt;Je++)if(Ht[Je]&1){var mt=Vt(Wt[Je]);mt!==null&&qe.set(Je,mt)}return qe}function St(Wt,Ht,Pt,Mt){var un=Wt.length;Pt=Math.max(0,Pt==null?0:+Pt),Mt=Math.min(un-1,Mt==null?un-1:+Mt);var qe=[];return Ht.paragraphs.forEach(function(Je){var mt=Math.max(Pt,Je.start),Dt=Math.min(Mt,Je.end);if(mt<Dt){for(var _t=Ht.levels.slice(mt,Dt+1),zt=Dt;zt>=mt&&de(Wt[zt])&ae;zt--)_t[zt]=Je.level;for(var nn=Je.level,tn=1/0,Ft=0;Ft<_t.length;Ft++){var pn=_t[Ft];pn>nn&&(nn=pn),pn<tn&&(tn=pn|1)}for(var sn=nn;sn>=tn;sn--)for(var rn=0;rn<_t.length;rn++)if(_t[rn]>=sn){for(var $t=rn;rn+1<_t.length&&_t[rn+1]>=sn;)rn++;rn>$t&&qe.push([$t+mt,rn+mt])}}}),qe}function Rt(Wt,Ht,Pt,Mt){var un=jt(Wt,Ht,Pt,Mt),qe=[].concat(Wt);return un.forEach(function(Je,mt){qe[mt]=(Ht.levels[Je]&1?Vt(Wt[Je]):null)||Wt[Je]}),qe.join("")}function jt(Wt,Ht,Pt,Mt){for(var un=St(Wt,Ht,Pt,Mt),qe=[],Je=0;Je<Wt.length;Je++)qe[Je]=Je;return un.forEach(function(mt){for(var Dt=mt[0],_t=mt[1],zt=qe.slice(Dt,_t+1),nn=zt.length;nn--;)qe[_t-nn]=zt[nn]}),qe}return Z.closingToOpeningBracket=Ee,Z.getBidiCharType=de,Z.getBidiCharTypeName=pe,Z.getCanonicalBracket=We,Z.getEmbeddingLevels=Kt,Z.getMirroredCharacter=Vt,Z.getMirroredCharactersMap=wt,Z.getReorderSegments=St,Z.getReorderedIndices=jt,Z.getReorderedString=Rt,Z.openingToClosingBracket=Re,Object.defineProperty(Z,"__esModule",{value:!0}),Z}({});return X}const voidMainRegExp=/\bvoid\s+main\s*\(\s*\)\s*{/g;function expandShaderIncludes(X){const Z=/^[ \t]*#include +<([\w\d./]+)>/gm;function _(K,te){let ne=ShaderChunk[te];return ne?expandShaderIncludes(ne):K}return X.replace(Z,_)}const _lut=[];for(let X=0;X<256;X++)_lut[X]=(X<16?"0":"")+X.toString(16);function generateUUID(){const X=Math.random()*4294967295|0,Z=Math.random()*4294967295|0,_=Math.random()*4294967295|0,K=Math.random()*4294967295|0;return(_lut[X&255]+_lut[X>>8&255]+_lut[X>>16&255]+_lut[X>>24&255]+"-"+_lut[Z&255]+_lut[Z>>8&255]+"-"+_lut[Z>>16&15|64]+_lut[Z>>24&255]+"-"+_lut[_&63|128]+_lut[_>>8&255]+"-"+_lut[_>>16&255]+_lut[_>>24&255]+_lut[K&255]+_lut[K>>8&255]+_lut[K>>16&255]+_lut[K>>24&255]).toUpperCase()}const assign$1=Object.assign||function(){let X=arguments[0];for(let Z=1,_=arguments.length;Z<_;Z++){let K=arguments[Z];if(K)for(let te in K)Object.prototype.hasOwnProperty.call(K,te)&&(X[te]=K[te])}return X},epoch=Date.now(),CONSTRUCTOR_CACHE=new WeakMap,SHADER_UPGRADE_CACHE=new Map;let materialInstanceId=1e10;function createDerivedMaterial(X,Z){const _=getKeyForOptions(Z);let K=CONSTRUCTOR_CACHE.get(X);if(K||CONSTRUCTOR_CACHE.set(X,K=Object.create(null)),K[_])return new K[_];const te=`_onBeforeCompile${_}`,ne=function(ae,ge){X.onBeforeCompile.call(this,ae,ge);const ce=this.customProgramCacheKey()+"|"+ae.vertexShader+"|"+ae.fragmentShader;let de=SHADER_UPGRADE_CACHE[ce];if(!de){const pe=upgradeShaders(this,ae,Z,_);de=SHADER_UPGRADE_CACHE[ce]=pe}ae.vertexShader=de.vertexShader,ae.fragmentShader=de.fragmentShader,assign$1(ae.uniforms,this.uniforms),Z.timeUniform&&(ae.uniforms[Z.timeUniform]={get value(){return Date.now()-epoch}}),this[te]&&this[te](ae)},oe=function(){return ie(Z.chained?X:X.clone())},ie=function(ae){const ge=Object.create(ae,se);return Object.defineProperty(ge,"baseMaterial",{value:X}),Object.defineProperty(ge,"id",{value:materialInstanceId++}),ge.uuid=generateUUID(),ge.uniforms=assign$1({},ae.uniforms,Z.uniforms),ge.defines=assign$1({},ae.defines,Z.defines),ge.defines[`TROIKA_DERIVED_MATERIAL_${_}`]="",ge.extensions=assign$1({},ae.extensions,Z.extensions),ge._listeners=void 0,ge},se={constructor:{value:oe},isDerivedMaterial:{value:!0},type:{get:()=>X.type,set:ae=>{X.type=ae}},isDerivedFrom:{writable:!0,configurable:!0,value:function(ae){const ge=this.baseMaterial;return ae===ge||ge.isDerivedMaterial&&ge.isDerivedFrom(ae)||!1}},customProgramCacheKey:{writable:!0,configurable:!0,value:function(){return X.customProgramCacheKey()+"|"+_}},onBeforeCompile:{get(){return ne},set(ae){this[te]=ae}},copy:{writable:!0,configurable:!0,value:function(ae){return X.copy.call(this,ae),!X.isShaderMaterial&&!X.isDerivedMaterial&&(assign$1(this.extensions,ae.extensions),assign$1(this.defines,ae.defines),assign$1(this.uniforms,UniformsUtils.clone(ae.uniforms))),this}},clone:{writable:!0,configurable:!0,value:function(){const ae=new X.constructor;return ie(ae).copy(this)}},getDepthMaterial:{writable:!0,configurable:!0,value:function(){let ae=this._depthMaterial;return ae||(ae=this._depthMaterial=createDerivedMaterial(X.isDerivedMaterial?X.getDepthMaterial():new MeshDepthMaterial({depthPacking:RGBADepthPacking}),Z),ae.defines.IS_DEPTH_MATERIAL="",ae.uniforms=this.uniforms),ae}},getDistanceMaterial:{writable:!0,configurable:!0,value:function(){let ae=this._distanceMaterial;return ae||(ae=this._distanceMaterial=createDerivedMaterial(X.isDerivedMaterial?X.getDistanceMaterial():new MeshDistanceMaterial,Z),ae.defines.IS_DISTANCE_MATERIAL="",ae.uniforms=this.uniforms),ae}},dispose:{writable:!0,configurable:!0,value(){const{_depthMaterial:ae,_distanceMaterial:ge}=this;ae&&ae.dispose(),ge&&ge.dispose(),X.dispose.call(this)}}};return K[_]=oe,new oe}function upgradeShaders(X,{vertexShader:Z,fragmentShader:_},K,te){let{vertexDefs:ne,vertexMainIntro:oe,vertexMainOutro:ie,vertexTransform:se,fragmentDefs:ae,fragmentMainIntro:ge,fragmentMainOutro:ce,fragmentColorTransform:de,customRewriter:pe,timeUniform:fe}=K;if(ne=ne||"",oe=oe||"",ie=ie||"",ae=ae||"",ge=ge||"",ce=ce||"",(se||pe)&&(Z=expandShaderIncludes(Z)),(de||pe)&&(_=_.replace(/^[ \t]*#include <((?:tonemapping|encodings|colorspace|fog|premultiplied_alpha|dithering)_fragment)>/gm,`
//!BEGIN_POST_CHUNK $1
$&
//!END_POST_CHUNK
`),_=expandShaderIncludes(_)),pe){let be=pe({vertexShader:Z,fragmentShader:_});Z=be.vertexShader,_=be.fragmentShader}if(de){let be=[];_=_.replace(/^\/\/!BEGIN_POST_CHUNK[^]+?^\/\/!END_POST_CHUNK/gm,me=>(be.push(me),"")),ce=`${de}
${be.join(`
`)}
${ce}`}if(fe){const be=`
uniform float ${fe};
`;ne=be+ne,ae=be+ae}return se&&(Z=`vec3 troika_position_${te};
vec3 troika_normal_${te};
vec2 troika_uv_${te};
${Z}
`,ne=`${ne}
void troikaVertexTransform${te}(inout vec3 position, inout vec3 normal, inout vec2 uv) {
  ${se}
}
`,oe=`
troika_position_${te} = vec3(position);
troika_normal_${te} = vec3(normal);
troika_uv_${te} = vec2(uv);
troikaVertexTransform${te}(troika_position_${te}, troika_normal_${te}, troika_uv_${te});
${oe}
`,Z=Z.replace(/\b(position|normal|uv)\b/g,(be,me,ye,ve)=>/\battribute\s+vec[23]\s+$/.test(ve.substr(0,ye))?me:`troika_${me}_${te}`),X.map&&X.map.channel>0||(Z=Z.replace(/\bMAP_UV\b/g,`troika_uv_${te}`))),Z=injectIntoShaderCode(Z,te,ne,oe,ie),_=injectIntoShaderCode(_,te,ae,ge,ce),{vertexShader:Z,fragmentShader:_}}function injectIntoShaderCode(X,Z,_,K,te){return(K||te||_)&&(X=X.replace(voidMainRegExp,`
${_}
void troikaOrigMain${Z}() {`),X+=`
void main() {
  ${K}
  troikaOrigMain${Z}();
  ${te}
}`),X}function optionsJsonReplacer(X,Z){return X==="uniforms"?void 0:typeof Z=="function"?Z.toString():Z}let _idCtr=0;const optionsHashesToIds=new Map;function getKeyForOptions(X){const Z=JSON.stringify(X,optionsJsonReplacer);let _=optionsHashesToIds.get(Z);return _==null&&optionsHashesToIds.set(Z,_=++_idCtr),_}/*!
Custom build of Typr.ts (https://github.com/fredli74/Typr.ts) for use in Troika text rendering.
Original MIT license applies: https://github.com/fredli74/Typr.ts/blob/master/LICENSE
*/function typrFactory(){return typeof window>"u"&&(self.window=self),function(X){var Z={parse:function(te){var ne=Z._bin,oe=new Uint8Array(te);if(ne.readASCII(oe,0,4)=="ttcf"){var ie=4;ne.readUshort(oe,ie),ie+=2,ne.readUshort(oe,ie),ie+=2;var se=ne.readUint(oe,ie);ie+=4;for(var ae=[],ge=0;ge<se;ge++){var ce=ne.readUint(oe,ie);ie+=4,ae.push(Z._readFont(oe,ce))}return ae}return[Z._readFont(oe,0)]},_readFont:function(te,ne){var oe=Z._bin,ie=ne;oe.readFixed(te,ne),ne+=4;var se=oe.readUshort(te,ne);ne+=2,oe.readUshort(te,ne),ne+=2,oe.readUshort(te,ne),ne+=2,oe.readUshort(te,ne),ne+=2;for(var ae=["cmap","head","hhea","maxp","hmtx","name","OS/2","post","loca","glyf","kern","CFF ","GDEF","GPOS","GSUB","SVG "],ge={_data:te,_offset:ie},ce={},de=0;de<se;de++){var pe=oe.readASCII(te,ne,4);ne+=4,oe.readUint(te,ne),ne+=4;var fe=oe.readUint(te,ne);ne+=4;var be=oe.readUint(te,ne);ne+=4,ce[pe]={offset:fe,length:be}}for(de=0;de<ae.length;de++){var me=ae[de];ce[me]&&(ge[me.trim()]=Z[me.trim()].parse(te,ce[me].offset,ce[me].length,ge))}return ge},_tabOffset:function(te,ne,oe){for(var ie=Z._bin,se=ie.readUshort(te,oe+4),ae=oe+12,ge=0;ge<se;ge++){var ce=ie.readASCII(te,ae,4);ae+=4,ie.readUint(te,ae),ae+=4;var de=ie.readUint(te,ae);if(ae+=4,ie.readUint(te,ae),ae+=4,ce==ne)return de}return 0}};Z._bin={readFixed:function(te,ne){return(te[ne]<<8|te[ne+1])+(te[ne+2]<<8|te[ne+3])/65540},readF2dot14:function(te,ne){return Z._bin.readShort(te,ne)/16384},readInt:function(te,ne){return Z._bin._view(te).getInt32(ne)},readInt8:function(te,ne){return Z._bin._view(te).getInt8(ne)},readShort:function(te,ne){return Z._bin._view(te).getInt16(ne)},readUshort:function(te,ne){return Z._bin._view(te).getUint16(ne)},readUshorts:function(te,ne,oe){for(var ie=[],se=0;se<oe;se++)ie.push(Z._bin.readUshort(te,ne+2*se));return ie},readUint:function(te,ne){return Z._bin._view(te).getUint32(ne)},readUint64:function(te,ne){return 4294967296*Z._bin.readUint(te,ne)+Z._bin.readUint(te,ne+4)},readASCII:function(te,ne,oe){for(var ie="",se=0;se<oe;se++)ie+=String.fromCharCode(te[ne+se]);return ie},readUnicode:function(te,ne,oe){for(var ie="",se=0;se<oe;se++){var ae=te[ne++]<<8|te[ne++];ie+=String.fromCharCode(ae)}return ie},_tdec:typeof window<"u"&&window.TextDecoder?new window.TextDecoder:null,readUTF8:function(te,ne,oe){var ie=Z._bin._tdec;return ie&&ne==0&&oe==te.length?ie.decode(te):Z._bin.readASCII(te,ne,oe)},readBytes:function(te,ne,oe){for(var ie=[],se=0;se<oe;se++)ie.push(te[ne+se]);return ie},readASCIIArray:function(te,ne,oe){for(var ie=[],se=0;se<oe;se++)ie.push(String.fromCharCode(te[ne+se]));return ie},_view:function(te){return te._dataView||(te._dataView=te.buffer?new DataView(te.buffer,te.byteOffset,te.byteLength):new DataView(new Uint8Array(te).buffer))}},Z._lctf={},Z._lctf.parse=function(te,ne,oe,ie,se){var ae=Z._bin,ge={},ce=ne;ae.readFixed(te,ne),ne+=4;var de=ae.readUshort(te,ne);ne+=2;var pe=ae.readUshort(te,ne);ne+=2;var fe=ae.readUshort(te,ne);return ne+=2,ge.scriptList=Z._lctf.readScriptList(te,ce+de),ge.featureList=Z._lctf.readFeatureList(te,ce+pe),ge.lookupList=Z._lctf.readLookupList(te,ce+fe,se),ge},Z._lctf.readLookupList=function(te,ne,oe){var ie=Z._bin,se=ne,ae=[],ge=ie.readUshort(te,ne);ne+=2;for(var ce=0;ce<ge;ce++){var de=ie.readUshort(te,ne);ne+=2;var pe=Z._lctf.readLookupTable(te,se+de,oe);ae.push(pe)}return ae},Z._lctf.readLookupTable=function(te,ne,oe){var ie=Z._bin,se=ne,ae={tabs:[]};ae.ltype=ie.readUshort(te,ne),ne+=2,ae.flag=ie.readUshort(te,ne),ne+=2;var ge=ie.readUshort(te,ne);ne+=2;for(var ce=ae.ltype,de=0;de<ge;de++){var pe=ie.readUshort(te,ne);ne+=2;var fe=oe(te,ce,se+pe,ae);ae.tabs.push(fe)}return ae},Z._lctf.numOfOnes=function(te){for(var ne=0,oe=0;oe<32;oe++)(te>>>oe&1)!=0&&ne++;return ne},Z._lctf.readClassDef=function(te,ne){var oe=Z._bin,ie=[],se=oe.readUshort(te,ne);if(ne+=2,se==1){var ae=oe.readUshort(te,ne);ne+=2;var ge=oe.readUshort(te,ne);ne+=2;for(var ce=0;ce<ge;ce++)ie.push(ae+ce),ie.push(ae+ce),ie.push(oe.readUshort(te,ne)),ne+=2}if(se==2){var de=oe.readUshort(te,ne);for(ne+=2,ce=0;ce<de;ce++)ie.push(oe.readUshort(te,ne)),ne+=2,ie.push(oe.readUshort(te,ne)),ne+=2,ie.push(oe.readUshort(te,ne)),ne+=2}return ie},Z._lctf.getInterval=function(te,ne){for(var oe=0;oe<te.length;oe+=3){var ie=te[oe],se=te[oe+1];if(te[oe+2],ie<=ne&&ne<=se)return oe}return-1},Z._lctf.readCoverage=function(te,ne){var oe=Z._bin,ie={};ie.fmt=oe.readUshort(te,ne),ne+=2;var se=oe.readUshort(te,ne);return ne+=2,ie.fmt==1&&(ie.tab=oe.readUshorts(te,ne,se)),ie.fmt==2&&(ie.tab=oe.readUshorts(te,ne,3*se)),ie},Z._lctf.coverageIndex=function(te,ne){var oe=te.tab;if(te.fmt==1)return oe.indexOf(ne);if(te.fmt==2){var ie=Z._lctf.getInterval(oe,ne);if(ie!=-1)return oe[ie+2]+(ne-oe[ie])}return-1},Z._lctf.readFeatureList=function(te,ne){var oe=Z._bin,ie=ne,se=[],ae=oe.readUshort(te,ne);ne+=2;for(var ge=0;ge<ae;ge++){var ce=oe.readASCII(te,ne,4);ne+=4;var de=oe.readUshort(te,ne);ne+=2;var pe=Z._lctf.readFeatureTable(te,ie+de);pe.tag=ce.trim(),se.push(pe)}return se},Z._lctf.readFeatureTable=function(te,ne){var oe=Z._bin,ie=ne,se={},ae=oe.readUshort(te,ne);ne+=2,ae>0&&(se.featureParams=ie+ae);var ge=oe.readUshort(te,ne);ne+=2,se.tab=[];for(var ce=0;ce<ge;ce++)se.tab.push(oe.readUshort(te,ne+2*ce));return se},Z._lctf.readScriptList=function(te,ne){var oe=Z._bin,ie=ne,se={},ae=oe.readUshort(te,ne);ne+=2;for(var ge=0;ge<ae;ge++){var ce=oe.readASCII(te,ne,4);ne+=4;var de=oe.readUshort(te,ne);ne+=2,se[ce.trim()]=Z._lctf.readScriptTable(te,ie+de)}return se},Z._lctf.readScriptTable=function(te,ne){var oe=Z._bin,ie=ne,se={},ae=oe.readUshort(te,ne);ne+=2,ae>0&&(se.default=Z._lctf.readLangSysTable(te,ie+ae));var ge=oe.readUshort(te,ne);ne+=2;for(var ce=0;ce<ge;ce++){var de=oe.readASCII(te,ne,4);ne+=4;var pe=oe.readUshort(te,ne);ne+=2,se[de.trim()]=Z._lctf.readLangSysTable(te,ie+pe)}return se},Z._lctf.readLangSysTable=function(te,ne){var oe=Z._bin,ie={};oe.readUshort(te,ne),ne+=2,ie.reqFeature=oe.readUshort(te,ne),ne+=2;var se=oe.readUshort(te,ne);return ne+=2,ie.features=oe.readUshorts(te,ne,se),ie},Z.CFF={},Z.CFF.parse=function(te,ne,oe){var ie=Z._bin;(te=new Uint8Array(te.buffer,ne,oe))[ne=0],te[++ne],te[++ne],te[++ne],ne++;var se=[];ne=Z.CFF.readIndex(te,ne,se);for(var ae=[],ge=0;ge<se.length-1;ge++)ae.push(ie.readASCII(te,ne+se[ge],se[ge+1]-se[ge]));ne+=se[se.length-1];var ce=[];ne=Z.CFF.readIndex(te,ne,ce);var de=[];for(ge=0;ge<ce.length-1;ge++)de.push(Z.CFF.readDict(te,ne+ce[ge],ne+ce[ge+1]));ne+=ce[ce.length-1];var pe=de[0],fe=[];ne=Z.CFF.readIndex(te,ne,fe);var be=[];for(ge=0;ge<fe.length-1;ge++)be.push(ie.readASCII(te,ne+fe[ge],fe[ge+1]-fe[ge]));if(ne+=fe[fe.length-1],Z.CFF.readSubrs(te,ne,pe),pe.CharStrings){ne=pe.CharStrings,fe=[],ne=Z.CFF.readIndex(te,ne,fe);var me=[];for(ge=0;ge<fe.length-1;ge++)me.push(ie.readBytes(te,ne+fe[ge],fe[ge+1]-fe[ge]));pe.CharStrings=me}if(pe.ROS){ne=pe.FDArray;var ye=[];for(ne=Z.CFF.readIndex(te,ne,ye),pe.FDArray=[],ge=0;ge<ye.length-1;ge++){var ve=Z.CFF.readDict(te,ne+ye[ge],ne+ye[ge+1]);Z.CFF._readFDict(te,ve,be),pe.FDArray.push(ve)}ne+=ye[ye.length-1],ne=pe.FDSelect,pe.FDSelect=[];var Be=te[ne];if(ne++,Be!=3)throw Be;var Re=ie.readUshort(te,ne);for(ne+=2,ge=0;ge<Re+1;ge++)pe.FDSelect.push(ie.readUshort(te,ne),te[ne+2]),ne+=3}return pe.Encoding&&(pe.Encoding=Z.CFF.readEncoding(te,pe.Encoding,pe.CharStrings.length)),pe.charset&&(pe.charset=Z.CFF.readCharset(te,pe.charset,pe.CharStrings.length)),Z.CFF._readFDict(te,pe,be),pe},Z.CFF._readFDict=function(te,ne,oe){var ie;for(var se in ne.Private&&(ie=ne.Private[1],ne.Private=Z.CFF.readDict(te,ie,ie+ne.Private[0]),ne.Private.Subrs&&Z.CFF.readSubrs(te,ie+ne.Private.Subrs,ne.Private)),ne)["FamilyName","FontName","FullName","Notice","version","Copyright"].indexOf(se)!=-1&&(ne[se]=oe[ne[se]-426+35])},Z.CFF.readSubrs=function(te,ne,oe){var ie=Z._bin,se=[];ne=Z.CFF.readIndex(te,ne,se);var ae,ge=se.length;ae=ge<1240?107:ge<33900?1131:32768,oe.Bias=ae,oe.Subrs=[];for(var ce=0;ce<se.length-1;ce++)oe.Subrs.push(ie.readBytes(te,ne+se[ce],se[ce+1]-se[ce]))},Z.CFF.tableSE=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,0,111,112,113,114,0,115,116,117,118,119,120,121,122,0,123,0,124,125,126,127,128,129,130,131,0,132,133,0,134,135,136,137,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,138,0,139,0,0,0,0,140,141,142,143,0,0,0,0,0,144,0,0,0,145,0,0,146,147,148,149,0,0,0,0],Z.CFF.glyphByUnicode=function(te,ne){for(var oe=0;oe<te.charset.length;oe++)if(te.charset[oe]==ne)return oe;return-1},Z.CFF.glyphBySE=function(te,ne){return ne<0||ne>255?-1:Z.CFF.glyphByUnicode(te,Z.CFF.tableSE[ne])},Z.CFF.readEncoding=function(te,ne,oe){Z._bin;var ie=[".notdef"],se=te[ne];if(ne++,se!=0)throw"error: unknown encoding format: "+se;var ae=te[ne];ne++;for(var ge=0;ge<ae;ge++)ie.push(te[ne+ge]);return ie},Z.CFF.readCharset=function(te,ne,oe){var ie=Z._bin,se=[".notdef"],ae=te[ne];if(ne++,ae==0)for(var ge=0;ge<oe;ge++){var ce=ie.readUshort(te,ne);ne+=2,se.push(ce)}else{if(ae!=1&&ae!=2)throw"error: format: "+ae;for(;se.length<oe;){ce=ie.readUshort(te,ne),ne+=2;var de=0;for(ae==1?(de=te[ne],ne++):(de=ie.readUshort(te,ne),ne+=2),ge=0;ge<=de;ge++)se.push(ce),ce++}}return se},Z.CFF.readIndex=function(te,ne,oe){var ie=Z._bin,se=ie.readUshort(te,ne)+1,ae=te[ne+=2];if(ne++,ae==1)for(var ge=0;ge<se;ge++)oe.push(te[ne+ge]);else if(ae==2)for(ge=0;ge<se;ge++)oe.push(ie.readUshort(te,ne+2*ge));else if(ae==3)for(ge=0;ge<se;ge++)oe.push(16777215&ie.readUint(te,ne+3*ge-1));else if(se!=1)throw"unsupported offset size: "+ae+", count: "+se;return(ne+=se*ae)-1},Z.CFF.getCharString=function(te,ne,oe){var ie=Z._bin,se=te[ne],ae=te[ne+1];te[ne+2],te[ne+3],te[ne+4];var ge=1,ce=null,de=null;se<=20&&(ce=se,ge=1),se==12&&(ce=100*se+ae,ge=2),21<=se&&se<=27&&(ce=se,ge=1),se==28&&(de=ie.readShort(te,ne+1),ge=3),29<=se&&se<=31&&(ce=se,ge=1),32<=se&&se<=246&&(de=se-139,ge=1),247<=se&&se<=250&&(de=256*(se-247)+ae+108,ge=2),251<=se&&se<=254&&(de=256*-(se-251)-ae-108,ge=2),se==255&&(de=ie.readInt(te,ne+1)/65535,ge=5),oe.val=de??"o"+ce,oe.size=ge},Z.CFF.readCharString=function(te,ne,oe){for(var ie=ne+oe,se=Z._bin,ae=[];ne<ie;){var ge=te[ne],ce=te[ne+1];te[ne+2],te[ne+3],te[ne+4];var de=1,pe=null,fe=null;ge<=20&&(pe=ge,de=1),ge==12&&(pe=100*ge+ce,de=2),ge!=19&&ge!=20||(pe=ge,de=2),21<=ge&&ge<=27&&(pe=ge,de=1),ge==28&&(fe=se.readShort(te,ne+1),de=3),29<=ge&&ge<=31&&(pe=ge,de=1),32<=ge&&ge<=246&&(fe=ge-139,de=1),247<=ge&&ge<=250&&(fe=256*(ge-247)+ce+108,de=2),251<=ge&&ge<=254&&(fe=256*-(ge-251)-ce-108,de=2),ge==255&&(fe=se.readInt(te,ne+1)/65535,de=5),ae.push(fe??"o"+pe),ne+=de}return ae},Z.CFF.readDict=function(te,ne,oe){for(var ie=Z._bin,se={},ae=[];ne<oe;){var ge=te[ne],ce=te[ne+1];te[ne+2],te[ne+3],te[ne+4];var de=1,pe=null,fe=null;if(ge==28&&(fe=ie.readShort(te,ne+1),de=3),ge==29&&(fe=ie.readInt(te,ne+1),de=5),32<=ge&&ge<=246&&(fe=ge-139,de=1),247<=ge&&ge<=250&&(fe=256*(ge-247)+ce+108,de=2),251<=ge&&ge<=254&&(fe=256*-(ge-251)-ce-108,de=2),ge==255)throw fe=ie.readInt(te,ne+1)/65535,de=5,"unknown number";if(ge==30){var be=[];for(de=1;;){var me=te[ne+de];de++;var ye=me>>4,ve=15&me;if(ye!=15&&be.push(ye),ve!=15&&be.push(ve),ve==15)break}for(var Be="",Re=[0,1,2,3,4,5,6,7,8,9,".","e","e-","reserved","-","endOfNumber"],Ee=0;Ee<be.length;Ee++)Be+=Re[be[Ee]];fe=parseFloat(Be)}ge<=21&&(pe=["version","Notice","FullName","FamilyName","Weight","FontBBox","BlueValues","OtherBlues","FamilyBlues","FamilyOtherBlues","StdHW","StdVW","escape","UniqueID","XUID","charset","Encoding","CharStrings","Private","Subrs","defaultWidthX","nominalWidthX"][ge],de=1,ge==12&&(pe=["Copyright","isFixedPitch","ItalicAngle","UnderlinePosition","UnderlineThickness","PaintType","CharstringType","FontMatrix","StrokeWidth","BlueScale","BlueShift","BlueFuzz","StemSnapH","StemSnapV","ForceBold",0,0,"LanguageGroup","ExpansionFactor","initialRandomSeed","SyntheticBase","PostScript","BaseFontName","BaseFontBlend",0,0,0,0,0,0,"ROS","CIDFontVersion","CIDFontRevision","CIDFontType","CIDCount","UIDBase","FDArray","FDSelect","FontName"][ce],de=2)),pe!=null?(se[pe]=ae.length==1?ae[0]:ae,ae=[]):ae.push(fe),ne+=de}return se},Z.cmap={},Z.cmap.parse=function(te,ne,oe){te=new Uint8Array(te.buffer,ne,oe),ne=0;var ie=Z._bin,se={};ie.readUshort(te,ne),ne+=2;var ae=ie.readUshort(te,ne);ne+=2;var ge=[];se.tables=[];for(var ce=0;ce<ae;ce++){var de=ie.readUshort(te,ne);ne+=2;var pe=ie.readUshort(te,ne);ne+=2;var fe=ie.readUint(te,ne);ne+=4;var be="p"+de+"e"+pe,me=ge.indexOf(fe);if(me==-1){var ye;me=se.tables.length,ge.push(fe);var ve=ie.readUshort(te,fe);ve==0?ye=Z.cmap.parse0(te,fe):ve==4?ye=Z.cmap.parse4(te,fe):ve==6?ye=Z.cmap.parse6(te,fe):ve==12?ye=Z.cmap.parse12(te,fe):console.debug("unknown format: "+ve,de,pe,fe),se.tables.push(ye)}if(se[be]!=null)throw"multiple tables for one platform+encoding";se[be]=me}return se},Z.cmap.parse0=function(te,ne){var oe=Z._bin,ie={};ie.format=oe.readUshort(te,ne),ne+=2;var se=oe.readUshort(te,ne);ne+=2,oe.readUshort(te,ne),ne+=2,ie.map=[];for(var ae=0;ae<se-6;ae++)ie.map.push(te[ne+ae]);return ie},Z.cmap.parse4=function(te,ne){var oe=Z._bin,ie=ne,se={};se.format=oe.readUshort(te,ne),ne+=2;var ae=oe.readUshort(te,ne);ne+=2,oe.readUshort(te,ne),ne+=2;var ge=oe.readUshort(te,ne);ne+=2;var ce=ge/2;se.searchRange=oe.readUshort(te,ne),ne+=2,se.entrySelector=oe.readUshort(te,ne),ne+=2,se.rangeShift=oe.readUshort(te,ne),ne+=2,se.endCount=oe.readUshorts(te,ne,ce),ne+=2*ce,ne+=2,se.startCount=oe.readUshorts(te,ne,ce),ne+=2*ce,se.idDelta=[];for(var de=0;de<ce;de++)se.idDelta.push(oe.readShort(te,ne)),ne+=2;for(se.idRangeOffset=oe.readUshorts(te,ne,ce),ne+=2*ce,se.glyphIdArray=[];ne<ie+ae;)se.glyphIdArray.push(oe.readUshort(te,ne)),ne+=2;return se},Z.cmap.parse6=function(te,ne){var oe=Z._bin,ie={};ie.format=oe.readUshort(te,ne),ne+=2,oe.readUshort(te,ne),ne+=2,oe.readUshort(te,ne),ne+=2,ie.firstCode=oe.readUshort(te,ne),ne+=2;var se=oe.readUshort(te,ne);ne+=2,ie.glyphIdArray=[];for(var ae=0;ae<se;ae++)ie.glyphIdArray.push(oe.readUshort(te,ne)),ne+=2;return ie},Z.cmap.parse12=function(te,ne){var oe=Z._bin,ie={};ie.format=oe.readUshort(te,ne),ne+=2,ne+=2,oe.readUint(te,ne),ne+=4,oe.readUint(te,ne),ne+=4;var se=oe.readUint(te,ne);ne+=4,ie.groups=[];for(var ae=0;ae<se;ae++){var ge=ne+12*ae,ce=oe.readUint(te,ge+0),de=oe.readUint(te,ge+4),pe=oe.readUint(te,ge+8);ie.groups.push([ce,de,pe])}return ie},Z.glyf={},Z.glyf.parse=function(te,ne,oe,ie){for(var se=[],ae=0;ae<ie.maxp.numGlyphs;ae++)se.push(null);return se},Z.glyf._parseGlyf=function(te,ne){var oe=Z._bin,ie=te._data,se=Z._tabOffset(ie,"glyf",te._offset)+te.loca[ne];if(te.loca[ne]==te.loca[ne+1])return null;var ae={};if(ae.noc=oe.readShort(ie,se),se+=2,ae.xMin=oe.readShort(ie,se),se+=2,ae.yMin=oe.readShort(ie,se),se+=2,ae.xMax=oe.readShort(ie,se),se+=2,ae.yMax=oe.readShort(ie,se),se+=2,ae.xMin>=ae.xMax||ae.yMin>=ae.yMax)return null;if(ae.noc>0){ae.endPts=[];for(var ge=0;ge<ae.noc;ge++)ae.endPts.push(oe.readUshort(ie,se)),se+=2;var ce=oe.readUshort(ie,se);if(se+=2,ie.length-se<ce)return null;ae.instructions=oe.readBytes(ie,se,ce),se+=ce;var de=ae.endPts[ae.noc-1]+1;for(ae.flags=[],ge=0;ge<de;ge++){var pe=ie[se];if(se++,ae.flags.push(pe),(8&pe)!=0){var fe=ie[se];se++;for(var be=0;be<fe;be++)ae.flags.push(pe),ge++}}for(ae.xs=[],ge=0;ge<de;ge++){var me=(2&ae.flags[ge])!=0,ye=(16&ae.flags[ge])!=0;me?(ae.xs.push(ye?ie[se]:-ie[se]),se++):ye?ae.xs.push(0):(ae.xs.push(oe.readShort(ie,se)),se+=2)}for(ae.ys=[],ge=0;ge<de;ge++)me=(4&ae.flags[ge])!=0,ye=(32&ae.flags[ge])!=0,me?(ae.ys.push(ye?ie[se]:-ie[se]),se++):ye?ae.ys.push(0):(ae.ys.push(oe.readShort(ie,se)),se+=2);var ve=0,Be=0;for(ge=0;ge<de;ge++)ve+=ae.xs[ge],Be+=ae.ys[ge],ae.xs[ge]=ve,ae.ys[ge]=Be}else{var Re;ae.parts=[];do{Re=oe.readUshort(ie,se),se+=2;var Ee={m:{a:1,b:0,c:0,d:1,tx:0,ty:0},p1:-1,p2:-1};if(ae.parts.push(Ee),Ee.glyphIndex=oe.readUshort(ie,se),se+=2,1&Re){var We=oe.readShort(ie,se);se+=2;var Ze=oe.readShort(ie,se);se+=2}else We=oe.readInt8(ie,se),se++,Ze=oe.readInt8(ie,se),se++;2&Re?(Ee.m.tx=We,Ee.m.ty=Ze):(Ee.p1=We,Ee.p2=Ze),8&Re?(Ee.m.a=Ee.m.d=oe.readF2dot14(ie,se),se+=2):64&Re?(Ee.m.a=oe.readF2dot14(ie,se),se+=2,Ee.m.d=oe.readF2dot14(ie,se),se+=2):128&Re&&(Ee.m.a=oe.readF2dot14(ie,se),se+=2,Ee.m.b=oe.readF2dot14(ie,se),se+=2,Ee.m.c=oe.readF2dot14(ie,se),se+=2,Ee.m.d=oe.readF2dot14(ie,se),se+=2)}while(32&Re);if(256&Re){var Ve=oe.readUshort(ie,se);for(se+=2,ae.instr=[],ge=0;ge<Ve;ge++)ae.instr.push(ie[se]),se++}}return ae},Z.GDEF={},Z.GDEF.parse=function(te,ne,oe,ie){var se=ne;ne+=4;var ae=Z._bin.readUshort(te,ne);return{glyphClassDef:ae===0?null:Z._lctf.readClassDef(te,se+ae)}},Z.GPOS={},Z.GPOS.parse=function(te,ne,oe,ie){return Z._lctf.parse(te,ne,oe,ie,Z.GPOS.subt)},Z.GPOS.subt=function(te,ne,oe,ie){var se=Z._bin,ae=oe,ge={};if(ge.fmt=se.readUshort(te,oe),oe+=2,ne==1||ne==2||ne==3||ne==7||ne==8&&ge.fmt<=2){var ce=se.readUshort(te,oe);oe+=2,ge.coverage=Z._lctf.readCoverage(te,ce+ae)}if(ne==1&&ge.fmt==1){var de=se.readUshort(te,oe);oe+=2,de!=0&&(ge.pos=Z.GPOS.readValueRecord(te,oe,de))}else if(ne==2&&ge.fmt>=1&&ge.fmt<=2){de=se.readUshort(te,oe),oe+=2;var pe=se.readUshort(te,oe);oe+=2;var fe=Z._lctf.numOfOnes(de),be=Z._lctf.numOfOnes(pe);if(ge.fmt==1){ge.pairsets=[];var me=se.readUshort(te,oe);oe+=2;for(var ye=0;ye<me;ye++){var ve=ae+se.readUshort(te,oe);oe+=2;var Be=se.readUshort(te,ve);ve+=2;for(var Re=[],Ee=0;Ee<Be;Ee++){var We=se.readUshort(te,ve);ve+=2,de!=0&&(He=Z.GPOS.readValueRecord(te,ve,de),ve+=2*fe),pe!=0&&(Ke=Z.GPOS.readValueRecord(te,ve,pe),ve+=2*be),Re.push({gid2:We,val1:He,val2:Ke})}ge.pairsets.push(Re)}}if(ge.fmt==2){var Ze=se.readUshort(te,oe);oe+=2;var Ve=se.readUshort(te,oe);oe+=2;var _e=se.readUshort(te,oe);oe+=2;var Xe=se.readUshort(te,oe);for(oe+=2,ge.classDef1=Z._lctf.readClassDef(te,ae+Ze),ge.classDef2=Z._lctf.readClassDef(te,ae+Ve),ge.matrix=[],ye=0;ye<_e;ye++){var Pe=[];for(Ee=0;Ee<Xe;Ee++){var He=null,Ke=null;de!=0&&(He=Z.GPOS.readValueRecord(te,oe,de),oe+=2*fe),pe!=0&&(Ke=Z.GPOS.readValueRecord(te,oe,pe),oe+=2*be),Pe.push({val1:He,val2:Ke})}ge.matrix.push(Pe)}}}else if(ne==4&&ge.fmt==1)ge.markCoverage=Z._lctf.readCoverage(te,se.readUshort(te,oe)+ae),ge.baseCoverage=Z._lctf.readCoverage(te,se.readUshort(te,oe+2)+ae),ge.markClassCount=se.readUshort(te,oe+4),ge.markArray=Z.GPOS.readMarkArray(te,se.readUshort(te,oe+6)+ae),ge.baseArray=Z.GPOS.readBaseArray(te,se.readUshort(te,oe+8)+ae,ge.markClassCount);else if(ne==6&&ge.fmt==1)ge.mark1Coverage=Z._lctf.readCoverage(te,se.readUshort(te,oe)+ae),ge.mark2Coverage=Z._lctf.readCoverage(te,se.readUshort(te,oe+2)+ae),ge.markClassCount=se.readUshort(te,oe+4),ge.mark1Array=Z.GPOS.readMarkArray(te,se.readUshort(te,oe+6)+ae),ge.mark2Array=Z.GPOS.readBaseArray(te,se.readUshort(te,oe+8)+ae,ge.markClassCount);else{if(ne==9&&ge.fmt==1){var Ue=se.readUshort(te,oe);oe+=2;var tt=se.readUint(te,oe);if(oe+=4,ie.ltype==9)ie.ltype=Ue;else if(ie.ltype!=Ue)throw"invalid extension substitution";return Z.GPOS.subt(te,ie.ltype,ae+tt)}console.debug("unsupported GPOS table LookupType",ne,"format",ge.fmt)}return ge},Z.GPOS.readValueRecord=function(te,ne,oe){var ie=Z._bin,se=[];return se.push(1&oe?ie.readShort(te,ne):0),ne+=1&oe?2:0,se.push(2&oe?ie.readShort(te,ne):0),ne+=2&oe?2:0,se.push(4&oe?ie.readShort(te,ne):0),ne+=4&oe?2:0,se.push(8&oe?ie.readShort(te,ne):0),ne+=8&oe?2:0,se},Z.GPOS.readBaseArray=function(te,ne,oe){var ie=Z._bin,se=[],ae=ne,ge=ie.readUshort(te,ne);ne+=2;for(var ce=0;ce<ge;ce++){for(var de=[],pe=0;pe<oe;pe++)de.push(Z.GPOS.readAnchorRecord(te,ae+ie.readUshort(te,ne))),ne+=2;se.push(de)}return se},Z.GPOS.readMarkArray=function(te,ne){var oe=Z._bin,ie=[],se=ne,ae=oe.readUshort(te,ne);ne+=2;for(var ge=0;ge<ae;ge++){var ce=Z.GPOS.readAnchorRecord(te,oe.readUshort(te,ne+2)+se);ce.markClass=oe.readUshort(te,ne),ie.push(ce),ne+=4}return ie},Z.GPOS.readAnchorRecord=function(te,ne){var oe=Z._bin,ie={};return ie.fmt=oe.readUshort(te,ne),ie.x=oe.readShort(te,ne+2),ie.y=oe.readShort(te,ne+4),ie},Z.GSUB={},Z.GSUB.parse=function(te,ne,oe,ie){return Z._lctf.parse(te,ne,oe,ie,Z.GSUB.subt)},Z.GSUB.subt=function(te,ne,oe,ie){var se=Z._bin,ae=oe,ge={};if(ge.fmt=se.readUshort(te,oe),oe+=2,ne!=1&&ne!=2&&ne!=4&&ne!=5&&ne!=6)return null;if(ne==1||ne==2||ne==4||ne==5&&ge.fmt<=2||ne==6&&ge.fmt<=2){var ce=se.readUshort(te,oe);oe+=2,ge.coverage=Z._lctf.readCoverage(te,ae+ce)}if(ne==1&&ge.fmt>=1&&ge.fmt<=2){if(ge.fmt==1)ge.delta=se.readShort(te,oe),oe+=2;else if(ge.fmt==2){var de=se.readUshort(te,oe);oe+=2,ge.newg=se.readUshorts(te,oe,de),oe+=2*ge.newg.length}}else if(ne==2&&ge.fmt==1){de=se.readUshort(te,oe),oe+=2,ge.seqs=[];for(var pe=0;pe<de;pe++){var fe=se.readUshort(te,oe)+ae;oe+=2;var be=se.readUshort(te,fe);ge.seqs.push(se.readUshorts(te,fe+2,be))}}else if(ne==4)for(ge.vals=[],de=se.readUshort(te,oe),oe+=2,pe=0;pe<de;pe++){var me=se.readUshort(te,oe);oe+=2,ge.vals.push(Z.GSUB.readLigatureSet(te,ae+me))}else if(ne==5&&ge.fmt==2){if(ge.fmt==2){var ye=se.readUshort(te,oe);oe+=2,ge.cDef=Z._lctf.readClassDef(te,ae+ye),ge.scset=[];var ve=se.readUshort(te,oe);for(oe+=2,pe=0;pe<ve;pe++){var Be=se.readUshort(te,oe);oe+=2,ge.scset.push(Be==0?null:Z.GSUB.readSubClassSet(te,ae+Be))}}}else if(ne==6&&ge.fmt==3){if(ge.fmt==3){for(pe=0;pe<3;pe++){de=se.readUshort(te,oe),oe+=2;for(var Re=[],Ee=0;Ee<de;Ee++)Re.push(Z._lctf.readCoverage(te,ae+se.readUshort(te,oe+2*Ee)));oe+=2*de,pe==0&&(ge.backCvg=Re),pe==1&&(ge.inptCvg=Re),pe==2&&(ge.ahedCvg=Re)}de=se.readUshort(te,oe),oe+=2,ge.lookupRec=Z.GSUB.readSubstLookupRecords(te,oe,de)}}else{if(ne==7&&ge.fmt==1){var We=se.readUshort(te,oe);oe+=2;var Ze=se.readUint(te,oe);if(oe+=4,ie.ltype==9)ie.ltype=We;else if(ie.ltype!=We)throw"invalid extension substitution";return Z.GSUB.subt(te,ie.ltype,ae+Ze)}console.debug("unsupported GSUB table LookupType",ne,"format",ge.fmt)}return ge},Z.GSUB.readSubClassSet=function(te,ne){var oe=Z._bin.readUshort,ie=ne,se=[],ae=oe(te,ne);ne+=2;for(var ge=0;ge<ae;ge++){var ce=oe(te,ne);ne+=2,se.push(Z.GSUB.readSubClassRule(te,ie+ce))}return se},Z.GSUB.readSubClassRule=function(te,ne){var oe=Z._bin.readUshort,ie={},se=oe(te,ne),ae=oe(te,ne+=2);ne+=2,ie.input=[];for(var ge=0;ge<se-1;ge++)ie.input.push(oe(te,ne)),ne+=2;return ie.substLookupRecords=Z.GSUB.readSubstLookupRecords(te,ne,ae),ie},Z.GSUB.readSubstLookupRecords=function(te,ne,oe){for(var ie=Z._bin.readUshort,se=[],ae=0;ae<oe;ae++)se.push(ie(te,ne),ie(te,ne+2)),ne+=4;return se},Z.GSUB.readChainSubClassSet=function(te,ne){var oe=Z._bin,ie=ne,se=[],ae=oe.readUshort(te,ne);ne+=2;for(var ge=0;ge<ae;ge++){var ce=oe.readUshort(te,ne);ne+=2,se.push(Z.GSUB.readChainSubClassRule(te,ie+ce))}return se},Z.GSUB.readChainSubClassRule=function(te,ne){for(var oe=Z._bin,ie={},se=["backtrack","input","lookahead"],ae=0;ae<se.length;ae++){var ge=oe.readUshort(te,ne);ne+=2,ae==1&&ge--,ie[se[ae]]=oe.readUshorts(te,ne,ge),ne+=2*ie[se[ae]].length}return ge=oe.readUshort(te,ne),ne+=2,ie.subst=oe.readUshorts(te,ne,2*ge),ne+=2*ie.subst.length,ie},Z.GSUB.readLigatureSet=function(te,ne){var oe=Z._bin,ie=ne,se=[],ae=oe.readUshort(te,ne);ne+=2;for(var ge=0;ge<ae;ge++){var ce=oe.readUshort(te,ne);ne+=2,se.push(Z.GSUB.readLigature(te,ie+ce))}return se},Z.GSUB.readLigature=function(te,ne){var oe=Z._bin,ie={chain:[]};ie.nglyph=oe.readUshort(te,ne),ne+=2;var se=oe.readUshort(te,ne);ne+=2;for(var ae=0;ae<se-1;ae++)ie.chain.push(oe.readUshort(te,ne)),ne+=2;return ie},Z.head={},Z.head.parse=function(te,ne,oe){var ie=Z._bin,se={};return ie.readFixed(te,ne),ne+=4,se.fontRevision=ie.readFixed(te,ne),ne+=4,ie.readUint(te,ne),ne+=4,ie.readUint(te,ne),ne+=4,se.flags=ie.readUshort(te,ne),ne+=2,se.unitsPerEm=ie.readUshort(te,ne),ne+=2,se.created=ie.readUint64(te,ne),ne+=8,se.modified=ie.readUint64(te,ne),ne+=8,se.xMin=ie.readShort(te,ne),ne+=2,se.yMin=ie.readShort(te,ne),ne+=2,se.xMax=ie.readShort(te,ne),ne+=2,se.yMax=ie.readShort(te,ne),ne+=2,se.macStyle=ie.readUshort(te,ne),ne+=2,se.lowestRecPPEM=ie.readUshort(te,ne),ne+=2,se.fontDirectionHint=ie.readShort(te,ne),ne+=2,se.indexToLocFormat=ie.readShort(te,ne),ne+=2,se.glyphDataFormat=ie.readShort(te,ne),ne+=2,se},Z.hhea={},Z.hhea.parse=function(te,ne,oe){var ie=Z._bin,se={};return ie.readFixed(te,ne),ne+=4,se.ascender=ie.readShort(te,ne),ne+=2,se.descender=ie.readShort(te,ne),ne+=2,se.lineGap=ie.readShort(te,ne),ne+=2,se.advanceWidthMax=ie.readUshort(te,ne),ne+=2,se.minLeftSideBearing=ie.readShort(te,ne),ne+=2,se.minRightSideBearing=ie.readShort(te,ne),ne+=2,se.xMaxExtent=ie.readShort(te,ne),ne+=2,se.caretSlopeRise=ie.readShort(te,ne),ne+=2,se.caretSlopeRun=ie.readShort(te,ne),ne+=2,se.caretOffset=ie.readShort(te,ne),ne+=2,ne+=8,se.metricDataFormat=ie.readShort(te,ne),ne+=2,se.numberOfHMetrics=ie.readUshort(te,ne),ne+=2,se},Z.hmtx={},Z.hmtx.parse=function(te,ne,oe,ie){for(var se=Z._bin,ae={aWidth:[],lsBearing:[]},ge=0,ce=0,de=0;de<ie.maxp.numGlyphs;de++)de<ie.hhea.numberOfHMetrics&&(ge=se.readUshort(te,ne),ne+=2,ce=se.readShort(te,ne),ne+=2),ae.aWidth.push(ge),ae.lsBearing.push(ce);return ae},Z.kern={},Z.kern.parse=function(te,ne,oe,ie){var se=Z._bin,ae=se.readUshort(te,ne);if(ne+=2,ae==1)return Z.kern.parseV1(te,ne-2,oe,ie);var ge=se.readUshort(te,ne);ne+=2;for(var ce={glyph1:[],rval:[]},de=0;de<ge;de++){ne+=2,oe=se.readUshort(te,ne),ne+=2;var pe=se.readUshort(te,ne);ne+=2;var fe=pe>>>8;if((fe&=15)!=0)throw"unknown kern table format: "+fe;ne=Z.kern.readFormat0(te,ne,ce)}return ce},Z.kern.parseV1=function(te,ne,oe,ie){var se=Z._bin;se.readFixed(te,ne),ne+=4;var ae=se.readUint(te,ne);ne+=4;for(var ge={glyph1:[],rval:[]},ce=0;ce<ae;ce++){se.readUint(te,ne),ne+=4;var de=se.readUshort(te,ne);ne+=2,se.readUshort(te,ne),ne+=2;var pe=de>>>8;if((pe&=15)!=0)throw"unknown kern table format: "+pe;ne=Z.kern.readFormat0(te,ne,ge)}return ge},Z.kern.readFormat0=function(te,ne,oe){var ie=Z._bin,se=-1,ae=ie.readUshort(te,ne);ne+=2,ie.readUshort(te,ne),ne+=2,ie.readUshort(te,ne),ne+=2,ie.readUshort(te,ne),ne+=2;for(var ge=0;ge<ae;ge++){var ce=ie.readUshort(te,ne);ne+=2;var de=ie.readUshort(te,ne);ne+=2;var pe=ie.readShort(te,ne);ne+=2,ce!=se&&(oe.glyph1.push(ce),oe.rval.push({glyph2:[],vals:[]}));var fe=oe.rval[oe.rval.length-1];fe.glyph2.push(de),fe.vals.push(pe),se=ce}return ne},Z.loca={},Z.loca.parse=function(te,ne,oe,ie){var se=Z._bin,ae=[],ge=ie.head.indexToLocFormat,ce=ie.maxp.numGlyphs+1;if(ge==0)for(var de=0;de<ce;de++)ae.push(se.readUshort(te,ne+(de<<1))<<1);if(ge==1)for(de=0;de<ce;de++)ae.push(se.readUint(te,ne+(de<<2)));return ae},Z.maxp={},Z.maxp.parse=function(te,ne,oe){var ie=Z._bin,se={},ae=ie.readUint(te,ne);return ne+=4,se.numGlyphs=ie.readUshort(te,ne),ne+=2,ae==65536&&(se.maxPoints=ie.readUshort(te,ne),ne+=2,se.maxContours=ie.readUshort(te,ne),ne+=2,se.maxCompositePoints=ie.readUshort(te,ne),ne+=2,se.maxCompositeContours=ie.readUshort(te,ne),ne+=2,se.maxZones=ie.readUshort(te,ne),ne+=2,se.maxTwilightPoints=ie.readUshort(te,ne),ne+=2,se.maxStorage=ie.readUshort(te,ne),ne+=2,se.maxFunctionDefs=ie.readUshort(te,ne),ne+=2,se.maxInstructionDefs=ie.readUshort(te,ne),ne+=2,se.maxStackElements=ie.readUshort(te,ne),ne+=2,se.maxSizeOfInstructions=ie.readUshort(te,ne),ne+=2,se.maxComponentElements=ie.readUshort(te,ne),ne+=2,se.maxComponentDepth=ie.readUshort(te,ne),ne+=2),se},Z.name={},Z.name.parse=function(te,ne,oe){var ie=Z._bin,se={};ie.readUshort(te,ne),ne+=2;var ae=ie.readUshort(te,ne);ne+=2,ie.readUshort(te,ne);for(var ge,ce=["copyright","fontFamily","fontSubfamily","ID","fullName","version","postScriptName","trademark","manufacturer","designer","description","urlVendor","urlDesigner","licence","licenceURL","---","typoFamilyName","typoSubfamilyName","compatibleFull","sampleText","postScriptCID","wwsFamilyName","wwsSubfamilyName","lightPalette","darkPalette"],de=ne+=2,pe=0;pe<ae;pe++){var fe=ie.readUshort(te,ne);ne+=2;var be=ie.readUshort(te,ne);ne+=2;var me=ie.readUshort(te,ne);ne+=2;var ye=ie.readUshort(te,ne);ne+=2;var ve=ie.readUshort(te,ne);ne+=2;var Be=ie.readUshort(te,ne);ne+=2;var Re,Ee=ce[ye],We=de+12*ae+Be;if(fe==0)Re=ie.readUnicode(te,We,ve/2);else if(fe==3&&be==0)Re=ie.readUnicode(te,We,ve/2);else if(be==0)Re=ie.readASCII(te,We,ve);else if(be==1)Re=ie.readUnicode(te,We,ve/2);else if(be==3)Re=ie.readUnicode(te,We,ve/2);else{if(fe!=1)throw"unknown encoding "+be+", platformID: "+fe;Re=ie.readASCII(te,We,ve),console.debug("reading unknown MAC encoding "+be+" as ASCII")}var Ze="p"+fe+","+me.toString(16);se[Ze]==null&&(se[Ze]={}),se[Ze][Ee!==void 0?Ee:ye]=Re,se[Ze]._lang=me}for(var Ve in se)if(se[Ve].postScriptName!=null&&se[Ve]._lang==1033)return se[Ve];for(var Ve in se)if(se[Ve].postScriptName!=null&&se[Ve]._lang==0)return se[Ve];for(var Ve in se)if(se[Ve].postScriptName!=null&&se[Ve]._lang==3084)return se[Ve];for(var Ve in se)if(se[Ve].postScriptName!=null)return se[Ve];for(var Ve in se){ge=Ve;break}return console.debug("returning name table with languageID "+se[ge]._lang),se[ge]},Z["OS/2"]={},Z["OS/2"].parse=function(te,ne,oe){var ie=Z._bin.readUshort(te,ne);ne+=2;var se={};if(ie==0)Z["OS/2"].version0(te,ne,se);else if(ie==1)Z["OS/2"].version1(te,ne,se);else if(ie==2||ie==3||ie==4)Z["OS/2"].version2(te,ne,se);else{if(ie!=5)throw"unknown OS/2 table version: "+ie;Z["OS/2"].version5(te,ne,se)}return se},Z["OS/2"].version0=function(te,ne,oe){var ie=Z._bin;return oe.xAvgCharWidth=ie.readShort(te,ne),ne+=2,oe.usWeightClass=ie.readUshort(te,ne),ne+=2,oe.usWidthClass=ie.readUshort(te,ne),ne+=2,oe.fsType=ie.readUshort(te,ne),ne+=2,oe.ySubscriptXSize=ie.readShort(te,ne),ne+=2,oe.ySubscriptYSize=ie.readShort(te,ne),ne+=2,oe.ySubscriptXOffset=ie.readShort(te,ne),ne+=2,oe.ySubscriptYOffset=ie.readShort(te,ne),ne+=2,oe.ySuperscriptXSize=ie.readShort(te,ne),ne+=2,oe.ySuperscriptYSize=ie.readShort(te,ne),ne+=2,oe.ySuperscriptXOffset=ie.readShort(te,ne),ne+=2,oe.ySuperscriptYOffset=ie.readShort(te,ne),ne+=2,oe.yStrikeoutSize=ie.readShort(te,ne),ne+=2,oe.yStrikeoutPosition=ie.readShort(te,ne),ne+=2,oe.sFamilyClass=ie.readShort(te,ne),ne+=2,oe.panose=ie.readBytes(te,ne,10),ne+=10,oe.ulUnicodeRange1=ie.readUint(te,ne),ne+=4,oe.ulUnicodeRange2=ie.readUint(te,ne),ne+=4,oe.ulUnicodeRange3=ie.readUint(te,ne),ne+=4,oe.ulUnicodeRange4=ie.readUint(te,ne),ne+=4,oe.achVendID=[ie.readInt8(te,ne),ie.readInt8(te,ne+1),ie.readInt8(te,ne+2),ie.readInt8(te,ne+3)],ne+=4,oe.fsSelection=ie.readUshort(te,ne),ne+=2,oe.usFirstCharIndex=ie.readUshort(te,ne),ne+=2,oe.usLastCharIndex=ie.readUshort(te,ne),ne+=2,oe.sTypoAscender=ie.readShort(te,ne),ne+=2,oe.sTypoDescender=ie.readShort(te,ne),ne+=2,oe.sTypoLineGap=ie.readShort(te,ne),ne+=2,oe.usWinAscent=ie.readUshort(te,ne),ne+=2,oe.usWinDescent=ie.readUshort(te,ne),ne+=2},Z["OS/2"].version1=function(te,ne,oe){var ie=Z._bin;return ne=Z["OS/2"].version0(te,ne,oe),oe.ulCodePageRange1=ie.readUint(te,ne),ne+=4,oe.ulCodePageRange2=ie.readUint(te,ne),ne+=4},Z["OS/2"].version2=function(te,ne,oe){var ie=Z._bin;return ne=Z["OS/2"].version1(te,ne,oe),oe.sxHeight=ie.readShort(te,ne),ne+=2,oe.sCapHeight=ie.readShort(te,ne),ne+=2,oe.usDefault=ie.readUshort(te,ne),ne+=2,oe.usBreak=ie.readUshort(te,ne),ne+=2,oe.usMaxContext=ie.readUshort(te,ne),ne+=2},Z["OS/2"].version5=function(te,ne,oe){var ie=Z._bin;return ne=Z["OS/2"].version2(te,ne,oe),oe.usLowerOpticalPointSize=ie.readUshort(te,ne),ne+=2,oe.usUpperOpticalPointSize=ie.readUshort(te,ne),ne+=2},Z.post={},Z.post.parse=function(te,ne,oe){var ie=Z._bin,se={};return se.version=ie.readFixed(te,ne),ne+=4,se.italicAngle=ie.readFixed(te,ne),ne+=4,se.underlinePosition=ie.readShort(te,ne),ne+=2,se.underlineThickness=ie.readShort(te,ne),ne+=2,se},Z==null&&(Z={}),Z.U==null&&(Z.U={}),Z.U.codeToGlyph=function(te,ne){var oe=te.cmap,ie=-1;if(oe.p0e4!=null?ie=oe.p0e4:oe.p3e1!=null?ie=oe.p3e1:oe.p1e0!=null?ie=oe.p1e0:oe.p0e3!=null&&(ie=oe.p0e3),ie==-1)throw"no familiar platform and encoding!";var se=oe.tables[ie];if(se.format==0)return ne>=se.map.length?0:se.map[ne];if(se.format==4){for(var ae=-1,ge=0;ge<se.endCount.length;ge++)if(ne<=se.endCount[ge]){ae=ge;break}return ae==-1||se.startCount[ae]>ne?0:65535&(se.idRangeOffset[ae]!=0?se.glyphIdArray[ne-se.startCount[ae]+(se.idRangeOffset[ae]>>1)-(se.idRangeOffset.length-ae)]:ne+se.idDelta[ae])}if(se.format==12){if(ne>se.groups[se.groups.length-1][1])return 0;for(ge=0;ge<se.groups.length;ge++){var ce=se.groups[ge];if(ce[0]<=ne&&ne<=ce[1])return ce[2]+(ne-ce[0])}return 0}throw"unknown cmap table format "+se.format},Z.U.glyphToPath=function(te,ne){var oe={cmds:[],crds:[]};if(te.SVG&&te.SVG.entries[ne]){var ie=te.SVG.entries[ne];return ie==null?oe:(typeof ie=="string"&&(ie=Z.SVG.toPath(ie),te.SVG.entries[ne]=ie),ie)}if(te.CFF){var se={x:0,y:0,stack:[],nStems:0,haveWidth:!1,width:te.CFF.Private?te.CFF.Private.defaultWidthX:0,open:!1},ae=te.CFF,ge=te.CFF.Private;if(ae.ROS){for(var ce=0;ae.FDSelect[ce+2]<=ne;)ce+=2;ge=ae.FDArray[ae.FDSelect[ce+1]].Private}Z.U._drawCFF(te.CFF.CharStrings[ne],se,ae,ge,oe)}else te.glyf&&Z.U._drawGlyf(ne,te,oe);return oe},Z.U._drawGlyf=function(te,ne,oe){var ie=ne.glyf[te];ie==null&&(ie=ne.glyf[te]=Z.glyf._parseGlyf(ne,te)),ie!=null&&(ie.noc>-1?Z.U._simpleGlyph(ie,oe):Z.U._compoGlyph(ie,ne,oe))},Z.U._simpleGlyph=function(te,ne){for(var oe=0;oe<te.noc;oe++){for(var ie=oe==0?0:te.endPts[oe-1]+1,se=te.endPts[oe],ae=ie;ae<=se;ae++){var ge=ae==ie?se:ae-1,ce=ae==se?ie:ae+1,de=1&te.flags[ae],pe=1&te.flags[ge],fe=1&te.flags[ce],be=te.xs[ae],me=te.ys[ae];if(ae==ie)if(de){if(!pe){Z.U.P.moveTo(ne,be,me);continue}Z.U.P.moveTo(ne,te.xs[ge],te.ys[ge])}else pe?Z.U.P.moveTo(ne,te.xs[ge],te.ys[ge]):Z.U.P.moveTo(ne,(te.xs[ge]+be)/2,(te.ys[ge]+me)/2);de?pe&&Z.U.P.lineTo(ne,be,me):fe?Z.U.P.qcurveTo(ne,be,me,te.xs[ce],te.ys[ce]):Z.U.P.qcurveTo(ne,be,me,(be+te.xs[ce])/2,(me+te.ys[ce])/2)}Z.U.P.closePath(ne)}},Z.U._compoGlyph=function(te,ne,oe){for(var ie=0;ie<te.parts.length;ie++){var se={cmds:[],crds:[]},ae=te.parts[ie];Z.U._drawGlyf(ae.glyphIndex,ne,se);for(var ge=ae.m,ce=0;ce<se.crds.length;ce+=2){var de=se.crds[ce],pe=se.crds[ce+1];oe.crds.push(de*ge.a+pe*ge.b+ge.tx),oe.crds.push(de*ge.c+pe*ge.d+ge.ty)}for(ce=0;ce<se.cmds.length;ce++)oe.cmds.push(se.cmds[ce])}},Z.U._getGlyphClass=function(te,ne){var oe=Z._lctf.getInterval(ne,te);return oe==-1?0:ne[oe+2]},Z.U._applySubs=function(te,ne,oe,ie){for(var se=te.length-ne-1,ae=0;ae<oe.tabs.length;ae++)if(oe.tabs[ae]!=null){var ge,ce=oe.tabs[ae];if(!ce.coverage||(ge=Z._lctf.coverageIndex(ce.coverage,te[ne]))!=-1){if(oe.ltype==1)te[ne],ce.fmt==1?te[ne]=te[ne]+ce.delta:te[ne]=ce.newg[ge];else if(oe.ltype==4)for(var de=ce.vals[ge],pe=0;pe<de.length;pe++){var fe=de[pe],be=fe.chain.length;if(!(be>se)){for(var me=!0,ye=0,ve=0;ve<be;ve++){for(;te[ne+ye+(1+ve)]==-1;)ye++;fe.chain[ve]!=te[ne+ye+(1+ve)]&&(me=!1)}if(me){for(te[ne]=fe.nglyph,ve=0;ve<be+ye;ve++)te[ne+ve+1]=-1;break}}}else if(oe.ltype==5&&ce.fmt==2)for(var Be=Z._lctf.getInterval(ce.cDef,te[ne]),Re=ce.cDef[Be+2],Ee=ce.scset[Re],We=0;We<Ee.length;We++){var Ze=Ee[We],Ve=Ze.input;if(!(Ve.length>se)){for(me=!0,ve=0;ve<Ve.length;ve++){var _e=Z._lctf.getInterval(ce.cDef,te[ne+1+ve]);if(Be==-1&&ce.cDef[_e+2]!=Ve[ve]){me=!1;break}}if(me){var Xe=Ze.substLookupRecords;for(pe=0;pe<Xe.length;pe+=2)Xe[pe],Xe[pe+1]}}}else if(oe.ltype==6&&ce.fmt==3){if(!Z.U._glsCovered(te,ce.backCvg,ne-ce.backCvg.length)||!Z.U._glsCovered(te,ce.inptCvg,ne)||!Z.U._glsCovered(te,ce.ahedCvg,ne+ce.inptCvg.length))continue;var Pe=ce.lookupRec;for(We=0;We<Pe.length;We+=2){Be=Pe[We];var He=ie[Pe[We+1]];Z.U._applySubs(te,ne+Be,He,ie)}}}}},Z.U._glsCovered=function(te,ne,oe){for(var ie=0;ie<ne.length;ie++)if(Z._lctf.coverageIndex(ne[ie],te[oe+ie])==-1)return!1;return!0},Z.U.glyphsToPath=function(te,ne,oe){for(var ie={cmds:[],crds:[]},se=0,ae=0;ae<ne.length;ae++){var ge=ne[ae];if(ge!=-1){for(var ce=ae<ne.length-1&&ne[ae+1]!=-1?ne[ae+1]:0,de=Z.U.glyphToPath(te,ge),pe=0;pe<de.crds.length;pe+=2)ie.crds.push(de.crds[pe]+se),ie.crds.push(de.crds[pe+1]);for(oe&&ie.cmds.push(oe),pe=0;pe<de.cmds.length;pe++)ie.cmds.push(de.cmds[pe]);oe&&ie.cmds.push("X"),se+=te.hmtx.aWidth[ge],ae<ne.length-1&&(se+=Z.U.getPairAdjustment(te,ge,ce))}}return ie},Z.U.P={},Z.U.P.moveTo=function(te,ne,oe){te.cmds.push("M"),te.crds.push(ne,oe)},Z.U.P.lineTo=function(te,ne,oe){te.cmds.push("L"),te.crds.push(ne,oe)},Z.U.P.curveTo=function(te,ne,oe,ie,se,ae,ge){te.cmds.push("C"),te.crds.push(ne,oe,ie,se,ae,ge)},Z.U.P.qcurveTo=function(te,ne,oe,ie,se){te.cmds.push("Q"),te.crds.push(ne,oe,ie,se)},Z.U.P.closePath=function(te){te.cmds.push("Z")},Z.U._drawCFF=function(te,ne,oe,ie,se){for(var ae=ne.stack,ge=ne.nStems,ce=ne.haveWidth,de=ne.width,pe=ne.open,fe=0,be=ne.x,me=ne.y,ye=0,ve=0,Be=0,Re=0,Ee=0,We=0,Ze=0,Ve=0,_e=0,Xe=0,Pe={val:0,size:0};fe<te.length;){Z.CFF.getCharString(te,fe,Pe);var He=Pe.val;if(fe+=Pe.size,He=="o1"||He=="o18")ae.length%2!=0&&!ce&&(de=ae.shift()+ie.nominalWidthX),ge+=ae.length>>1,ae.length=0,ce=!0;else if(He=="o3"||He=="o23")ae.length%2!=0&&!ce&&(de=ae.shift()+ie.nominalWidthX),ge+=ae.length>>1,ae.length=0,ce=!0;else if(He=="o4")ae.length>1&&!ce&&(de=ae.shift()+ie.nominalWidthX,ce=!0),pe&&Z.U.P.closePath(se),me+=ae.pop(),Z.U.P.moveTo(se,be,me),pe=!0;else if(He=="o5")for(;ae.length>0;)be+=ae.shift(),me+=ae.shift(),Z.U.P.lineTo(se,be,me);else if(He=="o6"||He=="o7")for(var Ke=ae.length,Ue=He=="o6",tt=0;tt<Ke;tt++){var rt=ae.shift();Ue?be+=rt:me+=rt,Ue=!Ue,Z.U.P.lineTo(se,be,me)}else if(He=="o8"||He=="o24"){Ke=ae.length;for(var at=0;at+6<=Ke;)ye=be+ae.shift(),ve=me+ae.shift(),Be=ye+ae.shift(),Re=ve+ae.shift(),be=Be+ae.shift(),me=Re+ae.shift(),Z.U.P.curveTo(se,ye,ve,Be,Re,be,me),at+=6;He=="o24"&&(be+=ae.shift(),me+=ae.shift(),Z.U.P.lineTo(se,be,me))}else{if(He=="o11")break;if(He=="o1234"||He=="o1235"||He=="o1236"||He=="o1237")He=="o1234"&&(ve=me,Be=(ye=be+ae.shift())+ae.shift(),Xe=Re=ve+ae.shift(),We=Re,Ve=me,be=(Ze=(Ee=(_e=Be+ae.shift())+ae.shift())+ae.shift())+ae.shift(),Z.U.P.curveTo(se,ye,ve,Be,Re,_e,Xe),Z.U.P.curveTo(se,Ee,We,Ze,Ve,be,me)),He=="o1235"&&(ye=be+ae.shift(),ve=me+ae.shift(),Be=ye+ae.shift(),Re=ve+ae.shift(),_e=Be+ae.shift(),Xe=Re+ae.shift(),Ee=_e+ae.shift(),We=Xe+ae.shift(),Ze=Ee+ae.shift(),Ve=We+ae.shift(),be=Ze+ae.shift(),me=Ve+ae.shift(),ae.shift(),Z.U.P.curveTo(se,ye,ve,Be,Re,_e,Xe),Z.U.P.curveTo(se,Ee,We,Ze,Ve,be,me)),He=="o1236"&&(ye=be+ae.shift(),ve=me+ae.shift(),Be=ye+ae.shift(),Xe=Re=ve+ae.shift(),We=Re,Ze=(Ee=(_e=Be+ae.shift())+ae.shift())+ae.shift(),Ve=We+ae.shift(),be=Ze+ae.shift(),Z.U.P.curveTo(se,ye,ve,Be,Re,_e,Xe),Z.U.P.curveTo(se,Ee,We,Ze,Ve,be,me)),He=="o1237"&&(ye=be+ae.shift(),ve=me+ae.shift(),Be=ye+ae.shift(),Re=ve+ae.shift(),_e=Be+ae.shift(),Xe=Re+ae.shift(),Ee=_e+ae.shift(),We=Xe+ae.shift(),Ze=Ee+ae.shift(),Ve=We+ae.shift(),Math.abs(Ze-be)>Math.abs(Ve-me)?be=Ze+ae.shift():me=Ve+ae.shift(),Z.U.P.curveTo(se,ye,ve,Be,Re,_e,Xe),Z.U.P.curveTo(se,Ee,We,Ze,Ve,be,me));else if(He=="o14"){if(ae.length>0&&!ce&&(de=ae.shift()+oe.nominalWidthX,ce=!0),ae.length==4){var Oe=ae.shift(),$e=ae.shift(),je=ae.shift(),Te=ae.shift(),De=Z.CFF.glyphBySE(oe,je),ot=Z.CFF.glyphBySE(oe,Te);Z.U._drawCFF(oe.CharStrings[De],ne,oe,ie,se),ne.x=Oe,ne.y=$e,Z.U._drawCFF(oe.CharStrings[ot],ne,oe,ie,se)}pe&&(Z.U.P.closePath(se),pe=!1)}else if(He=="o19"||He=="o20")ae.length%2!=0&&!ce&&(de=ae.shift()+ie.nominalWidthX),ge+=ae.length>>1,ae.length=0,ce=!0,fe+=ge+7>>3;else if(He=="o21")ae.length>2&&!ce&&(de=ae.shift()+ie.nominalWidthX,ce=!0),me+=ae.pop(),be+=ae.pop(),pe&&Z.U.P.closePath(se),Z.U.P.moveTo(se,be,me),pe=!0;else if(He=="o22")ae.length>1&&!ce&&(de=ae.shift()+ie.nominalWidthX,ce=!0),be+=ae.pop(),pe&&Z.U.P.closePath(se),Z.U.P.moveTo(se,be,me),pe=!0;else if(He=="o25"){for(;ae.length>6;)be+=ae.shift(),me+=ae.shift(),Z.U.P.lineTo(se,be,me);ye=be+ae.shift(),ve=me+ae.shift(),Be=ye+ae.shift(),Re=ve+ae.shift(),be=Be+ae.shift(),me=Re+ae.shift(),Z.U.P.curveTo(se,ye,ve,Be,Re,be,me)}else if(He=="o26")for(ae.length%2&&(be+=ae.shift());ae.length>0;)ye=be,ve=me+ae.shift(),be=Be=ye+ae.shift(),me=(Re=ve+ae.shift())+ae.shift(),Z.U.P.curveTo(se,ye,ve,Be,Re,be,me);else if(He=="o27")for(ae.length%2&&(me+=ae.shift());ae.length>0;)ve=me,Be=(ye=be+ae.shift())+ae.shift(),Re=ve+ae.shift(),be=Be+ae.shift(),me=Re,Z.U.P.curveTo(se,ye,ve,Be,Re,be,me);else if(He=="o10"||He=="o29"){var ct=He=="o10"?ie:oe;if(ae.length==0)console.debug("error: empty stack");else{var gt=ae.pop(),pt=ct.Subrs[gt+ct.Bias];ne.x=be,ne.y=me,ne.nStems=ge,ne.haveWidth=ce,ne.width=de,ne.open=pe,Z.U._drawCFF(pt,ne,oe,ie,se),be=ne.x,me=ne.y,ge=ne.nStems,ce=ne.haveWidth,de=ne.width,pe=ne.open}}else if(He=="o30"||He=="o31"){var ht=ae.length,At=(at=0,He=="o31");for(at+=ht-(Ke=-3&ht);at<Ke;)At?(ve=me,Be=(ye=be+ae.shift())+ae.shift(),me=(Re=ve+ae.shift())+ae.shift(),Ke-at==5?(be=Be+ae.shift(),at++):be=Be,At=!1):(ye=be,ve=me+ae.shift(),Be=ye+ae.shift(),Re=ve+ae.shift(),be=Be+ae.shift(),Ke-at==5?(me=Re+ae.shift(),at++):me=Re,At=!0),Z.U.P.curveTo(se,ye,ve,Be,Re,be,me),at+=4}else{if((He+"").charAt(0)=="o")throw console.debug("Unknown operation: "+He,te),He;ae.push(He)}}}ne.x=be,ne.y=me,ne.nStems=ge,ne.haveWidth=ce,ne.width=de,ne.open=pe};var _=Z,K={Typr:_};return X.Typr=_,X.default=K,Object.defineProperty(X,"__esModule",{value:!0}),X}({}).Typr}/*!
Custom bundle of woff2otf (https://github.com/arty-name/woff2otf) with fflate
(https://github.com/101arrowz/fflate) for use in Troika text rendering. 
Original licenses apply: 
- fflate: https://github.com/101arrowz/fflate/blob/master/LICENSE (MIT)
- woff2otf.js: https://github.com/arty-name/woff2otf/blob/master/woff2otf.js (Apache2)
*/function woff2otfFactory(){return function(X){var Z=Uint8Array,_=Uint16Array,K=Uint32Array,te=new Z([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),ne=new Z([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),oe=new Z([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),ie=function(He,Ke){for(var Ue=new _(31),tt=0;tt<31;++tt)Ue[tt]=Ke+=1<<He[tt-1];var rt=new K(Ue[30]);for(tt=1;tt<30;++tt)for(var at=Ue[tt];at<Ue[tt+1];++at)rt[at]=at-Ue[tt]<<5|tt;return[Ue,rt]},se=ie(te,2),ae=se[0],ge=se[1];ae[28]=258,ge[258]=28;for(var ce=ie(ne,0)[0],de=new _(32768),pe=0;pe<32768;++pe){var fe=(43690&pe)>>>1|(21845&pe)<<1;fe=(61680&(fe=(52428&fe)>>>2|(13107&fe)<<2))>>>4|(3855&fe)<<4,de[pe]=((65280&fe)>>>8|(255&fe)<<8)>>>1}var be=function(He,Ke,Ue){for(var tt=He.length,rt=0,at=new _(Ke);rt<tt;++rt)++at[He[rt]-1];var Oe,$e=new _(Ke);for(rt=0;rt<Ke;++rt)$e[rt]=$e[rt-1]+at[rt-1]<<1;{Oe=new _(1<<Ke);var je=15-Ke;for(rt=0;rt<tt;++rt)if(He[rt])for(var Te=rt<<4|He[rt],De=Ke-He[rt],ot=$e[He[rt]-1]++<<De,ct=ot|(1<<De)-1;ot<=ct;++ot)Oe[de[ot]>>>je]=Te}return Oe},me=new Z(288);for(pe=0;pe<144;++pe)me[pe]=8;for(pe=144;pe<256;++pe)me[pe]=9;for(pe=256;pe<280;++pe)me[pe]=7;for(pe=280;pe<288;++pe)me[pe]=8;var ye=new Z(32);for(pe=0;pe<32;++pe)ye[pe]=5;var ve=be(me,9),Be=be(ye,5),Re=function(He){for(var Ke=He[0],Ue=1;Ue<He.length;++Ue)He[Ue]>Ke&&(Ke=He[Ue]);return Ke},Ee=function(He,Ke,Ue){var tt=Ke/8|0;return(He[tt]|He[tt+1]<<8)>>(7&Ke)&Ue},We=function(He,Ke){var Ue=Ke/8|0;return(He[Ue]|He[Ue+1]<<8|He[Ue+2]<<16)>>(7&Ke)},Ze=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],Ve=function(He,Ke,Ue){var tt=new Error(Ke||Ze[He]);if(tt.code=He,Error.captureStackTrace&&Error.captureStackTrace(tt,Ve),!Ue)throw tt;return tt},_e=function(He,Ke,Ue){var tt=He.length;if(!tt||Ue&&!Ue.l&&tt<5)return Ke||new Z(0);var rt=!Ke||Ue,at=!Ue||Ue.i;Ue||(Ue={}),Ke||(Ke=new Z(3*tt));var Oe,$e=function($t){var on=Ke.length;if($t>on){var An=new Z(Math.max(2*on,$t));An.set(Ke),Ke=An}},je=Ue.f||0,Te=Ue.p||0,De=Ue.b||0,ot=Ue.l,ct=Ue.d,gt=Ue.m,pt=Ue.n,ht=8*tt;do{if(!ot){Ue.f=je=Ee(He,Te,1);var At=Ee(He,Te+1,3);if(Te+=3,!At){var Kt=He[(Pt=((Oe=Te)/8|0)+(7&Oe&&1)+4)-4]|He[Pt-3]<<8,en=Pt+Kt;if(en>tt){at&&Ve(0);break}rt&&$e(De+Kt),Ke.set(He.subarray(Pt,en),De),Ue.b=De+=Kt,Ue.p=Te=8*en;continue}if(At==1)ot=ve,ct=Be,gt=9,pt=5;else if(At==2){var Zt=Ee(He,Te,31)+257,st=Ee(He,Te+10,15)+4,Vt=Zt+Ee(He,Te+5,31)+1;Te+=14;for(var wt=new Z(Vt),St=new Z(19),Rt=0;Rt<st;++Rt)St[oe[Rt]]=Ee(He,Te+3*Rt,7);Te+=3*st;var jt=Re(St),Wt=(1<<jt)-1,Ht=be(St,jt);for(Rt=0;Rt<Vt;){var Pt,Mt=Ht[Ee(He,Te,Wt)];if(Te+=15&Mt,(Pt=Mt>>>4)<16)wt[Rt++]=Pt;else{var un=0,qe=0;for(Pt==16?(qe=3+Ee(He,Te,3),Te+=2,un=wt[Rt-1]):Pt==17?(qe=3+Ee(He,Te,7),Te+=3):Pt==18&&(qe=11+Ee(He,Te,127),Te+=7);qe--;)wt[Rt++]=un}}var Je=wt.subarray(0,Zt),mt=wt.subarray(Zt);gt=Re(Je),pt=Re(mt),ot=be(Je,gt),ct=be(mt,pt)}else Ve(1);if(Te>ht){at&&Ve(0);break}}rt&&$e(De+131072);for(var Dt=(1<<gt)-1,_t=(1<<pt)-1,zt=Te;;zt=Te){var nn=(un=ot[We(He,Te)&Dt])>>>4;if((Te+=15&un)>ht){at&&Ve(0);break}if(un||Ve(2),nn<256)Ke[De++]=nn;else{if(nn==256){zt=Te,ot=null;break}var tn=nn-254;if(nn>264){var Ft=te[Rt=nn-257];tn=Ee(He,Te,(1<<Ft)-1)+ae[Rt],Te+=Ft}var pn=ct[We(He,Te)&_t],sn=pn>>>4;if(pn||Ve(3),Te+=15&pn,mt=ce[sn],sn>3&&(Ft=ne[sn],mt+=We(He,Te)&(1<<Ft)-1,Te+=Ft),Te>ht){at&&Ve(0);break}rt&&$e(De+131072);for(var rn=De+tn;De<rn;De+=4)Ke[De]=Ke[De-mt],Ke[De+1]=Ke[De+1-mt],Ke[De+2]=Ke[De+2-mt],Ke[De+3]=Ke[De+3-mt];De=rn}}Ue.l=ot,Ue.p=zt,Ue.b=De,ot&&(je=1,Ue.m=gt,Ue.d=ct,Ue.n=pt)}while(!je);return De==Ke.length?Ke:function($t,on,An){(An==null||An>$t.length)&&(An=$t.length);var wn=new($t instanceof _?_:$t instanceof K?K:Z)(An-on);return wn.set($t.subarray(on,An)),wn}(Ke,0,De)},Xe=new Z(0),Pe=typeof TextDecoder<"u"&&new TextDecoder;try{Pe.decode(Xe,{stream:!0})}catch{}return X.convert_streams=function(He){var Ke=new DataView(He),Ue=0;function tt(){var Zt=Ke.getUint16(Ue);return Ue+=2,Zt}function rt(){var Zt=Ke.getUint32(Ue);return Ue+=4,Zt}function at(Zt){Kt.setUint16(en,Zt),en+=2}function Oe(Zt){Kt.setUint32(en,Zt),en+=4}for(var $e={signature:rt(),flavor:rt(),length:rt(),numTables:tt(),reserved:tt(),totalSfntSize:rt(),majorVersion:tt(),minorVersion:tt(),metaOffset:rt(),metaLength:rt(),metaOrigLength:rt(),privOffset:rt(),privLength:rt()},je=0;Math.pow(2,je)<=$e.numTables;)je++;je--;for(var Te=16*Math.pow(2,je),De=16*$e.numTables-Te,ot=12,ct=[],gt=0;gt<$e.numTables;gt++)ct.push({tag:rt(),offset:rt(),compLength:rt(),origLength:rt(),origChecksum:rt()}),ot+=16;var pt,ht=new Uint8Array(12+16*ct.length+ct.reduce(function(Zt,st){return Zt+st.origLength+4},0)),At=ht.buffer,Kt=new DataView(At),en=0;return Oe($e.flavor),at($e.numTables),at(Te),at(je),at(De),ct.forEach(function(Zt){Oe(Zt.tag),Oe(Zt.origChecksum),Oe(ot),Oe(Zt.origLength),Zt.outOffset=ot,(ot+=Zt.origLength)%4!=0&&(ot+=4-ot%4)}),ct.forEach(function(Zt){var st,Vt=He.slice(Zt.offset,Zt.offset+Zt.compLength);if(Zt.compLength!=Zt.origLength){var wt=new Uint8Array(Zt.origLength);st=new Uint8Array(Vt,2),_e(st,wt)}else wt=new Uint8Array(Vt);ht.set(wt,Zt.outOffset);var St=0;(ot=Zt.outOffset+Zt.origLength)%4!=0&&(St=4-ot%4),ht.set(new Uint8Array(St).buffer,Zt.outOffset+Zt.origLength),pt=ot+St}),At.slice(0,pt)},Object.defineProperty(X,"__esModule",{value:!0}),X}({}).convert_streams}function parserFactory(X,Z){const _={M:2,L:2,Q:4,C:6,Z:0},K={C:"18g,ca,368,1kz",D:"17k,6,2,2+4,5+c,2+6,2+1,10+1,9+f,j+11,2+1,a,2,2+1,15+2,3,j+2,6+3,2+8,2,2,2+1,w+a,4+e,3+3,2,3+2,3+5,23+w,2f+4,3,2+9,2,b,2+3,3,1k+9,6+1,3+1,2+2,2+d,30g,p+y,1,1+1g,f+x,2,sd2+1d,jf3+4,f+3,2+4,2+2,b+3,42,2,4+2,2+1,2,3,t+1,9f+w,2,el+2,2+g,d+2,2l,2+1,5,3+1,2+1,2,3,6,16wm+1v",R:"17m+3,2,2,6+3,m,15+2,2+2,h+h,13,3+8,2,2,3+1,2,p+1,x,5+4,5,a,2,2,3,u,c+2,g+1,5,2+1,4+1,5j,6+1,2,b,2+2,f,2+1,1s+2,2,3+1,7,1ez0,2,2+1,4+4,b,4,3,b,42,2+2,4,3,2+1,2,o+3,ae,ep,x,2o+2,3+1,3,5+1,6",L:"x9u,jff,a,fd,jv",T:"4t,gj+33,7o+4,1+1,7c+18,2,2+1,2+1,2,21+a,2,1b+k,h,2u+6,3+5,3+1,2+3,y,2,v+q,2k+a,1n+8,a,p+3,2+8,2+2,2+4,18+2,3c+e,2+v,1k,2,5+7,5,4+6,b+1,u,1n,5+3,9,l+1,r,3+1,1m,5+1,5+1,3+2,4,v+1,4,c+1,1m,5+4,2+1,5,l+1,n+5,2,1n,3,2+3,9,8+1,c+1,v,1q,d,1f,4,1m+2,6+2,2+3,8+1,c+1,u,1n,3,7,6+1,l+1,t+1,1m+1,5+3,9,l+1,u,21,8+2,2,2j,3+6,d+7,2r,3+8,c+5,23+1,s,2,2,1k+d,2+4,2+1,6+a,2+z,a,2v+3,2+5,2+1,3+1,q+1,5+2,h+3,e,3+1,7,g,jk+2,qb+2,u+2,u+1,v+1,1t+1,2+6,9,3+a,a,1a+2,3c+1,z,3b+2,5+1,a,7+2,64+1,3,1n,2+6,2,2,3+7,7+9,3,1d+d,1,1+1,1s+3,1d,2+4,2,6,15+8,d+1,x+3,3+1,2+2,1l,2+1,4,2+2,1n+7,3+1,49+2,2+c,2+6,5,7,4+1,5j+1l,2+4,ek,3+1,r+4,1e+4,6+5,2p+c,1+3,1,1+2,1+b,2db+2,3y,2p+v,ff+3,30+1,n9x,1+2,2+9,x+1,29+1,7l,4,5,q+1,6,48+1,r+h,e,13+7,q+a,1b+2,1d,3+3,3+1,14,1w+5,3+1,3+1,d,9,1c,1g,2+2,3+1,6+1,2,17+1,9,6n,3,5,fn5,ki+f,h+f,5s,6y+2,ea,6b,46+4,1af+2,2+1,6+3,15+2,5,4m+1,fy+3,as+1,4a+a,4x,1j+e,1l+2,1e+3,3+1,1y+2,11+4,2+7,1r,d+1,1h+8,b+3,3,2o+2,3,2+1,7,4h,4+7,m+1,1m+1,4,12+6,4+4,5g+7,3+2,2,o,2d+5,2,5+1,2+1,6n+3,7+1,2+1,s+1,2e+7,3,2+1,2z,2,3+5,2,2u+2,3+3,2+4,78+8,2+1,75+1,2,5,41+3,3+1,5,x+9,15+5,3+3,9,a+5,3+2,1b+c,2+1,bb+6,2+5,2,2b+l,3+6,2+1,2+1,3f+5,4,2+1,2+6,2,21+1,4,2,9o+1,470+8,at4+4,1o+6,t5,1s+3,2a,f5l+1,2+3,43o+2,a+7,1+7,3+6,v+3,45+2,1j0+1i,5+1d,9,f,n+4,2+e,11t+6,2+g,3+6,2+1,2+4,7a+6,c6+3,15t+6,32+6,1,gzau,v+2n,3l+6n"},te=1,ne=2,oe=4,ie=8,se=16,ae=32;let ge;function ce(Ze){if(!ge){const Ve={R:ne,L:te,D:oe,C:se,U:ae,T:ie};ge=new Map;for(let _e in K){let Xe=0;K[_e].split(",").forEach(Pe=>{let[He,Ke]=Pe.split("+");He=parseInt(He,36),Ke=Ke?parseInt(Ke,36):0,ge.set(Xe+=He,Ve[_e]);for(let Ue=Ke;Ue--;)ge.set(++Xe,Ve[_e])})}}return ge.get(Ze)||ae}const de=1,pe=2,fe=3,be=4,me=[null,"isol","init","fina","medi"];function ye(Ze){const Ve=new Uint8Array(Ze.length);let _e=ae,Xe=de,Pe=-1;for(let He=0;He<Ze.length;He++){const Ke=Ze.codePointAt(He);let Ue=ce(Ke)|0,tt=de;Ue&ie||(_e&(te|oe|se)?Ue&(ne|oe|se)?(tt=fe,(Xe===de||Xe===fe)&&Ve[Pe]++):Ue&(te|ae)&&(Xe===pe||Xe===be)&&Ve[Pe]--:_e&(ne|ae)&&(Xe===pe||Xe===be)&&Ve[Pe]--,Xe=Ve[He]=tt,_e=Ue,Pe=He,Ke>65535&&He++)}return Ve}function ve(Ze,Ve){const _e=[];for(let Pe=0;Pe<Ve.length;Pe++){const He=Ve.codePointAt(Pe);He>65535&&Pe++,_e.push(X.U.codeToGlyph(Ze,He))}const Xe=Ze.GSUB;if(Xe){const{lookupList:Pe,featureList:He}=Xe;let Ke;const Ue=/^(rlig|liga|mset|isol|init|fina|medi|half|pres|blws|ccmp)$/,tt=[];He.forEach(rt=>{if(Ue.test(rt.tag))for(let at=0;at<rt.tab.length;at++){if(tt[rt.tab[at]])continue;tt[rt.tab[at]]=!0;const Oe=Pe[rt.tab[at]],$e=/^(isol|init|fina|medi)$/.test(rt.tag);$e&&!Ke&&(Ke=ye(Ve));for(let je=0;je<_e.length;je++)(!Ke||!$e||me[Ke[je]]===rt.tag)&&X.U._applySubs(_e,je,Oe,Pe)}})}return _e}function Be(Ze,Ve){const _e=new Int16Array(Ve.length*3);let Xe=0;for(;Xe<Ve.length;Xe++){const Ue=Ve[Xe];if(Ue===-1)continue;_e[Xe*3+2]=Ze.hmtx.aWidth[Ue];const tt=Ze.GPOS;if(tt){const rt=tt.lookupList;for(let at=0;at<rt.length;at++){const Oe=rt[at];for(let $e=0;$e<Oe.tabs.length;$e++){const je=Oe.tabs[$e];if(Oe.ltype===1){if(X._lctf.coverageIndex(je.coverage,Ue)!==-1&&je.pos){Ke(je.pos,Xe);break}}else if(Oe.ltype===2){let Te=null,De=Pe();if(De!==-1){const ot=X._lctf.coverageIndex(je.coverage,Ve[De]);if(ot!==-1){if(je.fmt===1){const ct=je.pairsets[ot];for(let gt=0;gt<ct.length;gt++)ct[gt].gid2===Ue&&(Te=ct[gt])}else if(je.fmt===2){const ct=X.U._getGlyphClass(Ve[De],je.classDef1),gt=X.U._getGlyphClass(Ue,je.classDef2);Te=je.matrix[ct][gt]}if(Te){Te.val1&&Ke(Te.val1,De),Te.val2&&Ke(Te.val2,Xe);break}}}}else if(Oe.ltype===4){const Te=X._lctf.coverageIndex(je.markCoverage,Ue);if(Te!==-1){const De=Pe(He),ot=De===-1?-1:X._lctf.coverageIndex(je.baseCoverage,Ve[De]);if(ot!==-1){const ct=je.markArray[Te],gt=je.baseArray[ot][ct.markClass];_e[Xe*3]=gt.x-ct.x+_e[De*3]-_e[De*3+2],_e[Xe*3+1]=gt.y-ct.y+_e[De*3+1];break}}}else if(Oe.ltype===6){const Te=X._lctf.coverageIndex(je.mark1Coverage,Ue);if(Te!==-1){const De=Pe();if(De!==-1){const ot=Ve[De];if(Re(Ze,ot)===3){const ct=X._lctf.coverageIndex(je.mark2Coverage,ot);if(ct!==-1){const gt=je.mark1Array[Te],pt=je.mark2Array[ct][gt.markClass];_e[Xe*3]=pt.x-gt.x+_e[De*3]-_e[De*3+2],_e[Xe*3+1]=pt.y-gt.y+_e[De*3+1];break}}}}}}}}else if(Ze.kern&&!Ze.cff){const rt=Pe();if(rt!==-1){const at=Ze.kern.glyph1.indexOf(Ve[rt]);if(at!==-1){const Oe=Ze.kern.rval[at].glyph2.indexOf(Ue);Oe!==-1&&(_e[rt*3+2]+=Ze.kern.rval[at].vals[Oe])}}}}return _e;function Pe(Ue){for(let tt=Xe-1;tt>=0;tt--)if(Ve[tt]!==-1&&(!Ue||Ue(Ve[tt])))return tt;return-1}function He(Ue){return Re(Ze,Ue)===1}function Ke(Ue,tt){for(let rt=0;rt<3;rt++)_e[tt*3+rt]+=Ue[rt]||0}}function Re(Ze,Ve){const _e=Ze.GDEF&&Ze.GDEF.glyphClassDef;return _e?X.U._getGlyphClass(Ve,_e):0}function Ee(...Ze){for(let Ve=0;Ve<Ze.length;Ve++)if(typeof Ze[Ve]=="number")return Ze[Ve]}function We(Ze){const Ve=Object.create(null),_e=Ze["OS/2"],Xe=Ze.hhea,Pe=Ze.head.unitsPerEm,He=Ee(_e&&_e.sTypoAscender,Xe&&Xe.ascender,Pe),Ke={unitsPerEm:Pe,ascender:He,descender:Ee(_e&&_e.sTypoDescender,Xe&&Xe.descender,0),capHeight:Ee(_e&&_e.sCapHeight,He),xHeight:Ee(_e&&_e.sxHeight,He),lineGap:Ee(_e&&_e.sTypoLineGap,Xe&&Xe.lineGap),supportsCodePoint(Ue){return X.U.codeToGlyph(Ze,Ue)>0},forEachGlyph(Ue,tt,rt,at){let Oe=0;const $e=1/Ke.unitsPerEm*tt,je=ve(Ze,Ue);let Te=0;const De=Be(Ze,je);return je.forEach((ot,ct)=>{if(ot!==-1){let gt=Ve[ot];if(!gt){const{cmds:pt,crds:ht}=X.U.glyphToPath(Ze,ot);let At="",Kt=0;for(let wt=0,St=pt.length;wt<St;wt++){const Rt=_[pt[wt]];At+=pt[wt];for(let jt=1;jt<=Rt;jt++)At+=(jt>1?",":"")+ht[Kt++]}let en,Zt,st,Vt;if(ht.length){en=Zt=1/0,st=Vt=-1/0;for(let wt=0,St=ht.length;wt<St;wt+=2){let Rt=ht[wt],jt=ht[wt+1];Rt<en&&(en=Rt),jt<Zt&&(Zt=jt),Rt>st&&(st=Rt),jt>Vt&&(Vt=jt)}}else en=st=Zt=Vt=0;gt=Ve[ot]={index:ot,advanceWidth:Ze.hmtx.aWidth[ot],xMin:en,yMin:Zt,xMax:st,yMax:Vt,path:At}}at.call(null,gt,Oe+De[ct*3]*$e,De[ct*3+1]*$e,Te),Oe+=De[ct*3+2]*$e,rt&&(Oe+=rt*tt)}Te+=Ue.codePointAt(Te)>65535?2:1}),Oe}};return Ke}return function(Ve){const _e=new Uint8Array(Ve,0,4),Xe=X._bin.readASCII(_e,0,4);if(Xe==="wOFF")Ve=Z(Ve);else if(Xe==="wOF2")throw new Error("woff2 fonts not supported");return We(X.parse(Ve)[0])}}const workerModule=defineWorkerModule({name:"Typr Font Parser",dependencies:[typrFactory,woff2otfFactory,parserFactory],init(X,Z,_){const K=X(),te=Z();return _(K,te)}});/*!
Custom bundle of @unicode-font-resolver/client v1.0.2 (https://github.com/lojjic/unicode-font-resolver)
for use in Troika text rendering. 
Original MIT license applies
*/function unicodeFontResolverClientFactory(){return function(X){var Z=function(){this.buckets=new Map};Z.prototype.add=function(Be){var Re=Be>>5;this.buckets.set(Re,(this.buckets.get(Re)||0)|1<<(31&Be))},Z.prototype.has=function(Be){var Re=this.buckets.get(Be>>5);return Re!==void 0&&(Re&1<<(31&Be))!=0},Z.prototype.serialize=function(){var Be=[];return this.buckets.forEach(function(Re,Ee){Be.push((+Ee).toString(36)+":"+Re.toString(36))}),Be.join(",")},Z.prototype.deserialize=function(Be){var Re=this;this.buckets.clear(),Be.split(",").forEach(function(Ee){var We=Ee.split(":");Re.buckets.set(parseInt(We[0],36),parseInt(We[1],36))})};var _=Math.pow(2,8),K=_-1,te=~K;function ne(Be){var Re=function(We){return We&te}(Be).toString(16),Ee=function(We){return(We&te)+_-1}(Be).toString(16);return"codepoint-index/plane"+(Be>>16)+"/"+Re+"-"+Ee+".json"}function oe(Be,Re){var Ee=Be&K,We=Re.codePointAt(Ee/6|0);return((We=(We||48)-48)&1<<Ee%6)!=0}function ie(Be,Re){var Ee;(Ee=Be,Ee.replace(/U\+/gi,"").replace(/^,+|,+$/g,"").split(/,+/).map(function(We){return We.split("-").map(function(Ze){return parseInt(Ze.trim(),16)})})).forEach(function(We){var Ze=We[0],Ve=We[1];Ve===void 0&&(Ve=Ze),Re(Ze,Ve)})}function se(Be,Re){ie(Be,function(Ee,We){for(var Ze=Ee;Ze<=We;Ze++)Re(Ze)})}var ae={},ge={},ce=new WeakMap,de="https://cdn.jsdelivr.net/gh/lojjic/unicode-font-resolver@v1.0.1/packages/data";function pe(Be){var Re=ce.get(Be);return Re||(Re=new Z,se(Be.ranges,function(Ee){return Re.add(Ee)}),ce.set(Be,Re)),Re}var fe,be=new Map;function me(Be,Re,Ee){return Be[Re]?Re:Be[Ee]?Ee:function(We){for(var Ze in We)return Ze}(Be)}function ye(Be,Re){var Ee=Re;if(!Be.includes(Ee)){Ee=1/0;for(var We=0;We<Be.length;We++)Math.abs(Be[We]-Re)<Math.abs(Ee-Re)&&(Ee=Be[We])}return Ee}function ve(Be){return fe||(fe=new Set,se("9-D,20,85,A0,1680,2000-200A,2028-202F,205F,3000",function(Re){fe.add(Re)})),fe.has(Be)}return X.CodePointSet=Z,X.clearCache=function(){ae={},ge={}},X.getFontsForString=function(Be,Re){Re===void 0&&(Re={});var Ee,We=Re.lang;We===void 0&&(We=new RegExp("\\p{Script=Hangul}","u").test(Ee=Be)?"ko":new RegExp("\\p{Script=Hiragana}|\\p{Script=Katakana}","u").test(Ee)?"ja":"en");var Ze=Re.category;Ze===void 0&&(Ze="sans-serif");var Ve=Re.style;Ve===void 0&&(Ve="normal");var _e=Re.weight;_e===void 0&&(_e=400);var Xe=(Re.dataUrl||de).replace(/\/$/g,""),Pe=new Map,He=new Uint8Array(Be.length),Ke={},Ue={},tt=new Array(Be.length),rt=new Map,at=!1;function Oe(Te){var De=be.get(Te);return De||(De=fetch(Xe+"/"+Te).then(function(ot){if(!ot.ok)throw new Error(ot.statusText);return ot.json().then(function(ct){if(!Array.isArray(ct)||ct[0]!==1)throw new Error("Incorrect schema version; need 1, got "+ct[0]);return ct[1]})}).catch(function(ot){if(Xe!==de)return at||(console.error('unicode-font-resolver: Failed loading from dataUrl "'+Xe+'", trying default CDN. '+ot.message),at=!0),Xe=de,be.delete(Te),Oe(Te);throw ot}),be.set(Te,De)),De}for(var $e=function(Te){var De=Be.codePointAt(Te),ot=ne(De);tt[Te]=ot,ae[ot]||rt.has(ot)||rt.set(ot,Oe(ot).then(function(ct){ae[ot]=ct})),De>65535&&(Te++,je=Te)},je=0;je<Be.length;je++)$e(je);return Promise.all(rt.values()).then(function(){rt.clear();for(var Te=function(ot){var ct=Be.codePointAt(ot),gt=null,pt=ae[tt[ot]],ht=void 0;for(var At in pt){var Kt=Ue[At];if(Kt===void 0&&(Kt=Ue[At]=new RegExp(At).test(We||"en")),Kt){for(var en in ht=At,pt[At])if(oe(ct,pt[At][en])){gt=en;break}break}}if(!gt){e:for(var Zt in pt)if(Zt!==ht){for(var st in pt[Zt])if(oe(ct,pt[Zt][st])){gt=st;break e}}}gt||(console.debug("No font coverage for U+"+ct.toString(16)),gt="latin"),tt[ot]=gt,ge[gt]||rt.has(gt)||rt.set(gt,Oe("font-meta/"+gt+".json").then(function(Vt){ge[gt]=Vt})),ct>65535&&(ot++,De=ot)},De=0;De<Be.length;De++)Te(De);return Promise.all(rt.values())}).then(function(){for(var Te,De=null,ot=0;ot<Be.length;ot++){var ct=Be.codePointAt(ot);if(De&&(ve(ct)||pe(De).has(ct)))He[ot]=He[ot-1];else{De=ge[tt[ot]];var gt=Ke[De.id];if(!gt){var pt=De.typeforms,ht=me(pt,Ze,"sans-serif"),At=me(pt[ht],Ve,"normal"),Kt=ye((Te=pt[ht])===null||Te===void 0?void 0:Te[At],_e);gt=Ke[De.id]=Xe+"/font-files/"+De.id+"/"+ht+"."+At+"."+Kt+".woff"}var en=Pe.get(gt);en==null&&(en=Pe.size,Pe.set(gt,en)),He[ot]=en}ct>65535&&(ot++,He[ot]=He[ot-1])}return{fontUrls:Array.from(Pe.keys()),chars:He}})},Object.defineProperty(X,"__esModule",{value:!0}),X}({})}function createFontResolver(X,Z){const _=Object.create(null),K=Object.create(null);function te(oe,ie){const se=ae=>{console.error(`Failure loading font ${oe}`,ae)};try{const ae=new XMLHttpRequest;ae.open("get",oe,!0),ae.responseType="arraybuffer",ae.onload=function(){if(ae.status>=400)se(new Error(ae.statusText));else if(ae.status>0)try{const ge=X(ae.response);ge.src=oe,ie(ge)}catch(ge){se(ge)}},ae.onerror=se,ae.send()}catch(ae){se(ae)}}function ne(oe,ie){let se=_[oe];se?ie(se):K[oe]?K[oe].push(ie):(K[oe]=[ie],te(oe,ae=>{ae.src=oe,_[oe]=ae,K[oe].forEach(ge=>ge(ae)),delete K[oe]}))}return function(oe,ie,{lang:se,fonts:ae=[],style:ge="normal",weight:ce="normal",unicodeFontsURL:de}={}){const pe=new Uint8Array(oe.length),fe=[];oe.length||ve();const be=new Map,me=[];if(ge!=="italic"&&(ge="normal"),typeof ce!="number"&&(ce=ce==="bold"?700:400),ae&&!Array.isArray(ae)&&(ae=[ae]),ae=ae.slice().filter(Re=>!Re.lang||Re.lang.test(se)).reverse(),ae.length){let Ze=0;(function Ve(_e=0){for(let Xe=_e,Pe=oe.length;Xe<Pe;Xe++){const He=oe.codePointAt(Xe);if(Ze===1&&fe[pe[Xe-1]].supportsCodePoint(He)||Xe>0&&/\s/.test(oe[Xe]))pe[Xe]=pe[Xe-1],Ze===2&&(me[me.length-1][1]=Xe);else for(let Ke=pe[Xe],Ue=ae.length;Ke<=Ue;Ke++)if(Ke===Ue){const tt=Ze===2?me[me.length-1]:me[me.length]=[Xe,Xe];tt[1]=Xe,Ze=2}else{pe[Xe]=Ke;const{src:tt,unicodeRange:rt}=ae[Ke];if(!rt||Be(He,rt)){const at=_[tt];if(!at){ne(tt,()=>{Ve(Xe)});return}if(at.supportsCodePoint(He)){let Oe=be.get(at);typeof Oe!="number"&&(Oe=fe.length,fe.push(at),be.set(at,Oe)),pe[Xe]=Oe,Ze=1;break}}}He>65535&&Xe+1<Pe&&(pe[Xe+1]=pe[Xe],Xe++,Ze===2&&(me[me.length-1][1]=Xe))}ye()})()}else me.push([0,oe.length-1]),ye();function ye(){if(me.length){const Re=me.map(Ee=>oe.substring(Ee[0],Ee[1]+1)).join(`
`);Z.getFontsForString(Re,{lang:se||void 0,style:ge,weight:ce,dataUrl:de}).then(({fontUrls:Ee,chars:We})=>{const Ze=fe.length;let Ve=0;me.forEach(Xe=>{for(let Pe=0,He=Xe[1]-Xe[0];Pe<=He;Pe++)pe[Xe[0]+Pe]=We[Ve++]+Ze;Ve++});let _e=0;Ee.forEach((Xe,Pe)=>{ne(Xe,He=>{fe[Pe+Ze]=He,++_e===Ee.length&&ve()})})})}else ve()}function ve(){ie({chars:pe,fonts:fe})}function Be(Re,Ee){for(let We=0;We<Ee.length;We++){const[Ze,Ve=Ze]=Ee[We];if(Ze<=Re&&Re<=Ve)return!0}return!1}}}const fontResolverWorkerModule=defineWorkerModule({name:"FontResolver",dependencies:[createFontResolver,workerModule,unicodeFontResolverClientFactory],init(X,Z,_){return X(Z,_())}});function createTypesetter(X,Z){const K=/[\u00AD\u034F\u061C\u115F-\u1160\u17B4-\u17B5\u180B-\u180E\u200B-\u200F\u202A-\u202E\u2060-\u206F\u3164\uFE00-\uFE0F\uFEFF\uFFA0\uFFF0-\uFFF8]/,te="[^\\S\\u00A0]",ne=new RegExp(`${te}|[\\-\\u007C\\u00AD\\u2010\\u2012-\\u2014\\u2027\\u2056\\u2E17\\u2E40]`);function oe({text:fe,lang:be,fonts:me,style:ye,weight:ve,preResolvedFonts:Be,unicodeFontsURL:Re},Ee){const We=({chars:Ze,fonts:Ve})=>{let _e,Xe;const Pe=[];for(let He=0;He<Ze.length;He++)Ze[He]!==Xe?(Xe=Ze[He],Pe.push(_e={start:He,end:He,fontObj:Ve[Ze[He]]})):_e.end=He;Ee(Pe)};Be?We(Be):X(fe,We,{lang:be,fonts:me,style:ye,weight:ve,unicodeFontsURL:Re})}function ie({text:fe="",font:be,lang:me,sdfGlyphSize:ye=64,fontSize:ve=400,fontWeight:Be=1,fontStyle:Re="normal",letterSpacing:Ee=0,lineHeight:We="normal",maxWidth:Ze=1/0,direction:Ve,textAlign:_e="left",textIndent:Xe=0,whiteSpace:Pe="normal",overflowWrap:He="normal",anchorX:Ke=0,anchorY:Ue=0,metricsOnly:tt=!1,unicodeFontsURL:rt,preResolvedFonts:at=null,includeCaretPositions:Oe=!1,chunkedBoundsSize:$e=8192,colorRanges:je=null},Te){const De=ce(),ot={fontLoad:0,typesetting:0};fe.indexOf("\r")>-1&&(console.info("Typesetter: got text with \\r chars; normalizing to \\n"),fe=fe.replace(/\r\n/g,`
`).replace(/\r/g,`
`)),ve=+ve,Ee=+Ee,Ze=+Ze,We=We||"normal",Xe=+Xe,oe({text:fe,lang:me,style:Re,weight:Be,fonts:typeof be=="string"?[{src:be}]:be,unicodeFontsURL:rt,preResolvedFonts:at},ct=>{ot.fontLoad=ce()-De;const gt=isFinite(Ze);let pt=null,ht=null,At=null,Kt=null,en=null,Zt=null,st=null,Vt=null,wt=0,St=0,Rt=Pe!=="nowrap";const jt=new Map,Wt=ce();let Ht=Xe,Pt=0,Mt=new de;const un=[Mt];ct.forEach(_t=>{const{fontObj:zt}=_t,{ascender:nn,descender:tn,unitsPerEm:Ft,lineGap:pn,capHeight:sn,xHeight:rn}=zt;let $t=jt.get(zt);if(!$t){const vt=ve/Ft,Et=We==="normal"?(nn-tn+pn)*vt:We*ve,gn=(Et-(nn-tn)*vt)/2,an=Math.min(Et,(nn-tn)*vt),vn=(nn+tn)/2*vt+an/2;$t={index:jt.size,src:zt.src,fontObj:zt,fontSizeMult:vt,unitsPerEm:Ft,ascender:nn*vt,descender:tn*vt,capHeight:sn*vt,xHeight:rn*vt,lineHeight:Et,baseline:-gn-nn*vt,caretTop:vn,caretBottom:vn-an},jt.set(zt,$t)}const{fontSizeMult:on}=$t,An=fe.slice(_t.start,_t.end+1);let wn,ft;zt.forEachGlyph(An,ve,Ee,(vt,Et,gn,an)=>{Et+=Pt,an+=_t.start,wn=Et,ft=vt;const vn=fe.charAt(an),zn=vt.advanceWidth*on,On=Mt.count;let Tn;if("isEmpty"in vt||(vt.isWhitespace=!!vn&&new RegExp(te).test(vn),vt.canBreakAfter=!!vn&&ne.test(vn),vt.isEmpty=vt.xMin===vt.xMax||vt.yMin===vt.yMax||K.test(vn)),!vt.isWhitespace&&!vt.isEmpty&&St++,Rt&&gt&&!vt.isWhitespace&&Et+zn+Ht>Ze&&On){if(Mt.glyphAt(On-1).glyphObj.canBreakAfter)Tn=new de,Ht=-Et;else for(let dr=On;dr--;)if(dr===0&&He==="break-word"){Tn=new de,Ht=-Et;break}else if(Mt.glyphAt(dr).glyphObj.canBreakAfter){Tn=Mt.splitAt(dr+1);const rr=Tn.glyphAt(0).x;Ht-=rr;for(let fr=Tn.count;fr--;)Tn.glyphAt(fr).x-=rr;break}Tn&&(Mt.isSoftWrapped=!0,Mt=Tn,un.push(Mt),wt=Ze)}let Xn=Mt.glyphAt(Mt.count);Xn.glyphObj=vt,Xn.x=Et+Ht,Xn.y=gn,Xn.width=zn,Xn.charIndex=an,Xn.fontData=$t,vn===`
`&&(Mt=new de,un.push(Mt),Ht=-(Et+zn+Ee*ve)+Xe)}),Pt=wn+ft.advanceWidth*on+Ee*ve});let qe=0;un.forEach(_t=>{let zt=!0;for(let nn=_t.count;nn--;){const tn=_t.glyphAt(nn);zt&&!tn.glyphObj.isWhitespace&&(_t.width=tn.x+tn.width,_t.width>wt&&(wt=_t.width),zt=!1);let{lineHeight:Ft,capHeight:pn,xHeight:sn,baseline:rn}=tn.fontData;Ft>_t.lineHeight&&(_t.lineHeight=Ft);const $t=rn-_t.baseline;$t<0&&(_t.baseline+=$t,_t.cap+=$t,_t.ex+=$t),_t.cap=Math.max(_t.cap,_t.baseline+pn),_t.ex=Math.max(_t.ex,_t.baseline+sn)}_t.baseline-=qe,_t.cap-=qe,_t.ex-=qe,qe+=_t.lineHeight});let Je=0,mt=0;if(Ke&&(typeof Ke=="number"?Je=-Ke:typeof Ke=="string"&&(Je=-wt*(Ke==="left"?0:Ke==="center"?.5:Ke==="right"?1:ae(Ke)))),Ue&&(typeof Ue=="number"?mt=-Ue:typeof Ue=="string"&&(mt=Ue==="top"?0:Ue==="top-baseline"?-un[0].baseline:Ue==="top-cap"?-un[0].cap:Ue==="top-ex"?-un[0].ex:Ue==="middle"?qe/2:Ue==="bottom"?qe:Ue==="bottom-baseline"?-un[un.length-1].baseline:ae(Ue)*qe)),!tt){const _t=Z.getEmbeddingLevels(fe,Ve);pt=new Uint16Array(St),ht=new Uint8Array(St),At=new Float32Array(St*2),Kt={},st=[1/0,1/0,-1/0,-1/0],Vt=[],Oe&&(Zt=new Float32Array(fe.length*4)),je&&(en=new Uint8Array(St*3));let zt=0,nn=-1,tn=-1,Ft,pn;if(un.forEach((sn,rn)=>{let{count:$t,width:on}=sn;if($t>0){let An=0;for(let an=$t;an--&&sn.glyphAt(an).glyphObj.isWhitespace;)An++;let wn=0,ft=0;if(_e==="center")wn=(wt-on)/2;else if(_e==="right")wn=wt-on;else if(_e==="justify"&&sn.isSoftWrapped){let an=0;for(let vn=$t-An;vn--;)sn.glyphAt(vn).glyphObj.isWhitespace&&an++;ft=(wt-on)/an}if(ft||wn){let an=0;for(let vn=0;vn<$t;vn++){let zn=sn.glyphAt(vn);const On=zn.glyphObj;zn.x+=wn+an,ft!==0&&On.isWhitespace&&vn<$t-An&&(an+=ft,zn.width+=ft)}}const vt=Z.getReorderSegments(fe,_t,sn.glyphAt(0).charIndex,sn.glyphAt(sn.count-1).charIndex);for(let an=0;an<vt.length;an++){const[vn,zn]=vt[an];let On=1/0,Tn=-1/0;for(let Xn=0;Xn<$t;Xn++)if(sn.glyphAt(Xn).charIndex>=vn){let dr=Xn,rr=Xn;for(;rr<$t;rr++){let fr=sn.glyphAt(rr);if(fr.charIndex>zn)break;rr<$t-An&&(On=Math.min(On,fr.x),Tn=Math.max(Tn,fr.x+fr.width))}for(let fr=dr;fr<rr;fr++){const Nr=sn.glyphAt(fr);Nr.x=Tn-(Nr.x+Nr.width-On)}break}}let Et;const gn=an=>Et=an;for(let an=0;an<$t;an++){const vn=sn.glyphAt(an);Et=vn.glyphObj;const zn=Et.index,On=_t.levels[vn.charIndex]&1;if(On){const Tn=Z.getMirroredCharacter(fe[vn.charIndex]);Tn&&vn.fontData.fontObj.forEachGlyph(Tn,0,0,gn)}if(Oe){const{charIndex:Tn,fontData:Xn}=vn,dr=vn.x+Je,rr=vn.x+vn.width+Je;Zt[Tn*4]=On?rr:dr,Zt[Tn*4+1]=On?dr:rr,Zt[Tn*4+2]=sn.baseline+Xn.caretBottom+mt,Zt[Tn*4+3]=sn.baseline+Xn.caretTop+mt;const fr=Tn-nn;fr>1&&ge(Zt,nn,fr),nn=Tn}if(je){const{charIndex:Tn}=vn;for(;Tn>tn;)tn++,je.hasOwnProperty(tn)&&(pn=je[tn])}if(!Et.isWhitespace&&!Et.isEmpty){const Tn=zt++,{fontSizeMult:Xn,src:dr,index:rr}=vn.fontData,fr=Kt[dr]||(Kt[dr]={});fr[zn]||(fr[zn]={path:Et.path,pathBounds:[Et.xMin,Et.yMin,Et.xMax,Et.yMax]});const Nr=vn.x+Je,ei=vn.y+sn.baseline+mt;At[Tn*2]=Nr,At[Tn*2+1]=ei;const Er=Nr+Et.xMin*Xn,Lr=ei+Et.yMin*Xn,br=Nr+Et.xMax*Xn,kn=ei+Et.yMax*Xn;Er<st[0]&&(st[0]=Er),Lr<st[1]&&(st[1]=Lr),br>st[2]&&(st[2]=br),kn>st[3]&&(st[3]=kn),Tn%$e===0&&(Ft={start:Tn,end:Tn,rect:[1/0,1/0,-1/0,-1/0]},Vt.push(Ft)),Ft.end++;const Hr=Ft.rect;if(Er<Hr[0]&&(Hr[0]=Er),Lr<Hr[1]&&(Hr[1]=Lr),br>Hr[2]&&(Hr[2]=br),kn>Hr[3]&&(Hr[3]=kn),pt[Tn]=zn,ht[Tn]=rr,je){const Yi=Tn*3;en[Yi]=pn>>16&255,en[Yi+1]=pn>>8&255,en[Yi+2]=pn&255}}}}}),Zt){const sn=fe.length-nn;sn>1&&ge(Zt,nn,sn)}}const Dt=[];jt.forEach(({index:_t,src:zt,unitsPerEm:nn,ascender:tn,descender:Ft,lineHeight:pn,capHeight:sn,xHeight:rn})=>{Dt[_t]={src:zt,unitsPerEm:nn,ascender:tn,descender:Ft,lineHeight:pn,capHeight:sn,xHeight:rn}}),ot.typesetting=ce()-Wt,Te({glyphIds:pt,glyphFontIndices:ht,glyphPositions:At,glyphData:Kt,fontData:Dt,caretPositions:Zt,glyphColors:en,chunkedBounds:Vt,fontSize:ve,topBaseline:mt+un[0].baseline,blockBounds:[Je,mt-qe,Je+wt,mt],visibleBounds:st,timings:ot})})}function se(fe,be){ie({...fe,metricsOnly:!0},me=>{const[ye,ve,Be,Re]=me.blockBounds;be({width:Be-ye,height:Re-ve})})}function ae(fe){let be=fe.match(/^([\d.]+)%$/),me=be?parseFloat(be[1]):NaN;return isNaN(me)?0:me/100}function ge(fe,be,me){const ye=fe[be*4],ve=fe[be*4+1],Be=fe[be*4+2],Re=fe[be*4+3],Ee=(ve-ye)/me;for(let We=0;We<me;We++){const Ze=(be+We)*4;fe[Ze]=ye+Ee*We,fe[Ze+1]=ye+Ee*(We+1),fe[Ze+2]=Be,fe[Ze+3]=Re}}function ce(){return(self.performance||Date).now()}function de(){this.data=[]}const pe=["glyphObj","x","y","width","charIndex","fontData"];return de.prototype={width:0,lineHeight:0,baseline:0,cap:0,ex:0,isSoftWrapped:!1,get count(){return Math.ceil(this.data.length/pe.length)},glyphAt(fe){let be=de.flyweight;return be.data=this.data,be.index=fe,be},splitAt(fe){let be=new de;return be.data=this.data.splice(fe*pe.length),be}},de.flyweight=pe.reduce((fe,be,me,ye)=>(Object.defineProperty(fe,be,{get(){return this.data[this.index*pe.length+me]},set(ve){this.data[this.index*pe.length+me]=ve}}),fe),{data:null,index:0}),{typeset:ie,measure:se}}const now=()=>(self.performance||Date).now(),mainThreadGenerator=SDFGenerator();let warned;function generateSDF(X,Z,_,K,te,ne,oe,ie,se,ae,ge=!0){return ge?generateSDF_GL(X,Z,_,K,te,ne,oe,ie,se,ae).then(null,ce=>(warned||(console.warn("WebGL SDF generation failed, falling back to JS",ce),warned=!0),generateSDF_JS_Worker(X,Z,_,K,te,ne,oe,ie,se,ae))):generateSDF_JS_Worker(X,Z,_,K,te,ne,oe,ie,se,ae)}const queue=[],chunkTimeBudget=5;let timer=0;function nextChunk(){const X=now();for(;queue.length&&now()-X<chunkTimeBudget;)queue.shift()();timer=queue.length?setTimeout(nextChunk,0):0}const generateSDF_GL=(...X)=>new Promise((Z,_)=>{queue.push(()=>{const K=now();try{mainThreadGenerator.webgl.generateIntoCanvas(...X),Z({timing:now()-K})}catch(te){_(te)}}),timer||(timer=setTimeout(nextChunk,0))}),threadCount=4,idleTimeout=2e3,threads={};let callNum=0;function generateSDF_JS_Worker(X,Z,_,K,te,ne,oe,ie,se,ae){const ge="TroikaTextSDFGenerator_JS_"+callNum++%threadCount;let ce=threads[ge];return ce||(ce=threads[ge]={workerModule:defineWorkerModule({name:ge,workerId:ge,dependencies:[SDFGenerator,now],init(de,pe){const fe=de().javascript.generate;return function(...be){const me=pe();return{textureData:fe(...be),timing:pe()-me}}},getTransferables(de){return[de.textureData.buffer]}}),requests:0,idleTimer:null}),ce.requests++,clearTimeout(ce.idleTimer),ce.workerModule(X,Z,_,K,te,ne).then(({textureData:de,timing:pe})=>{const fe=now(),be=new Uint8Array(de.length*4);for(let me=0;me<de.length;me++)be[me*4+ae]=de[me];return mainThreadGenerator.webglUtils.renderImageData(oe,be,ie,se,X,Z,1<<3-ae),pe+=now()-fe,--ce.requests===0&&(ce.idleTimer=setTimeout(()=>{terminateWorker(ge)},idleTimeout)),{timing:pe}})}function warmUpSDFCanvas(X){X._warm||(mainThreadGenerator.webgl.isSupported(X),X._warm=!0)}const resizeWebGLCanvasWithoutClearing=mainThreadGenerator.webglUtils.resizeWebGLCanvasWithoutClearing,CONFIG={defaultFontURL:null,unicodeFontsURL:null,sdfGlyphSize:64,sdfMargin:1/16,sdfExponent:9,textureWidth:2048,useWorker:!0},tempColor=new Color$1;function now$1(){return(self.performance||Date).now()}const atlases=Object.create(null);function getTextRenderInfo(X,Z){X=assign({},X);const _=now$1(),{defaultFontURL:K}=CONFIG,te=[];if(K&&te.push({label:"default",src:toAbsoluteURL(K)}),X.font&&te.push({label:"user",src:toAbsoluteURL(X.font)}),X.font=te,X.text=""+X.text,X.sdfGlyphSize=X.sdfGlyphSize||CONFIG.sdfGlyphSize,X.unicodeFontsURL=X.unicodeFontsURL||CONFIG.unicodeFontsURL,X.colorRanges!=null){let pe={};for(let fe in X.colorRanges)if(X.colorRanges.hasOwnProperty(fe)){let be=X.colorRanges[fe];typeof be!="number"&&(be=tempColor.set(be).getHex()),pe[fe]=be}X.colorRanges=pe}Object.freeze(X);const{textureWidth:ne,sdfExponent:oe}=CONFIG,{sdfGlyphSize:ie}=X,se=ne/ie*4;let ae=atlases[ie];if(!ae){const pe=document.createElement("canvas");pe.width=ne,pe.height=ie*256/se,ae=atlases[ie]={glyphCount:0,sdfGlyphSize:ie,sdfCanvas:pe,sdfTexture:new Texture(pe,void 0,void 0,void 0,LinearFilter,LinearFilter),contextLost:!1,glyphsByFont:new Map},ae.sdfTexture.generateMipmaps=!1,initContextLossHandling(ae)}const{sdfTexture:ge,sdfCanvas:ce}=ae;typesetInWorker(X).then(pe=>{const{glyphIds:fe,glyphFontIndices:be,fontData:me,glyphPositions:ye,fontSize:ve,timings:Be}=pe,Re=[],Ee=new Float32Array(fe.length*4);let We=0,Ze=0;const Ve=now$1(),_e=me.map(Ue=>{let tt=ae.glyphsByFont.get(Ue.src);return tt||ae.glyphsByFont.set(Ue.src,tt=new Map),tt});fe.forEach((Ue,tt)=>{const rt=be[tt],{src:at,unitsPerEm:Oe}=me[rt];let $e=_e[rt].get(Ue);if(!$e){const{path:ct,pathBounds:gt}=pe.glyphData[at][Ue],pt=Math.max(gt[2]-gt[0],gt[3]-gt[1])/ie*(CONFIG.sdfMargin*ie+.5),ht=ae.glyphCount++,At=[gt[0]-pt,gt[1]-pt,gt[2]+pt,gt[3]+pt];_e[rt].set(Ue,$e={path:ct,atlasIndex:ht,sdfViewBox:At}),Re.push($e)}const{sdfViewBox:je}=$e,Te=ye[Ze++],De=ye[Ze++],ot=ve/Oe;Ee[We++]=Te+je[0]*ot,Ee[We++]=De+je[1]*ot,Ee[We++]=Te+je[2]*ot,Ee[We++]=De+je[3]*ot,fe[tt]=$e.atlasIndex}),Be.quads=(Be.quads||0)+(now$1()-Ve);const Xe=now$1();Be.sdf={};const Pe=ce.height,He=Math.ceil(ae.glyphCount/se),Ke=Math.pow(2,Math.ceil(Math.log2(He*ie)));Ke>Pe&&(console.info(`Increasing SDF texture size ${Pe}->${Ke}`),resizeWebGLCanvasWithoutClearing(ce,ne,Ke),ge.dispose()),Promise.all(Re.map(Ue=>generateGlyphSDF(Ue,ae,X.gpuAccelerateSDF).then(({timing:tt})=>{Be.sdf[Ue.atlasIndex]=tt}))).then(()=>{Re.length&&!ae.contextLost&&(safariPre15Workaround(ae),ge.needsUpdate=!0),Be.sdfTotal=now$1()-Xe,Be.total=now$1()-_,Z(Object.freeze({parameters:X,sdfTexture:ge,sdfGlyphSize:ie,sdfExponent:oe,glyphBounds:Ee,glyphAtlasIndices:fe,glyphColors:pe.glyphColors,caretPositions:pe.caretPositions,chunkedBounds:pe.chunkedBounds,ascender:pe.ascender,descender:pe.descender,lineHeight:pe.lineHeight,capHeight:pe.capHeight,xHeight:pe.xHeight,topBaseline:pe.topBaseline,blockBounds:pe.blockBounds,visibleBounds:pe.visibleBounds,timings:pe.timings}))})}),Promise.resolve().then(()=>{ae.contextLost||warmUpSDFCanvas(ce)})}function generateGlyphSDF({path:X,atlasIndex:Z,sdfViewBox:_},{sdfGlyphSize:K,sdfCanvas:te,contextLost:ne},oe){if(ne)return Promise.resolve({timing:-1});const{textureWidth:ie,sdfExponent:se}=CONFIG,ae=Math.max(_[2]-_[0],_[3]-_[1]),ge=Math.floor(Z/4),ce=ge%(ie/K)*K,de=Math.floor(ge/(ie/K))*K,pe=Z%4;return generateSDF(K,K,X,_,ae,se,te,ce,de,pe,oe)}function initContextLossHandling(X){const Z=X.sdfCanvas;Z.addEventListener("webglcontextlost",_=>{console.log("Context Lost",_),_.preventDefault(),X.contextLost=!0}),Z.addEventListener("webglcontextrestored",_=>{console.log("Context Restored",_),X.contextLost=!1;const K=[];X.glyphsByFont.forEach(te=>{te.forEach(ne=>{K.push(generateGlyphSDF(ne,X,!0))})}),Promise.all(K).then(()=>{safariPre15Workaround(X),X.sdfTexture.needsUpdate=!0})})}function preloadFont({font:X,characters:Z,sdfGlyphSize:_},K){let te=Array.isArray(Z)?Z.join(`
`):""+Z;getTextRenderInfo({font:X,sdfGlyphSize:_,text:te},K)}function assign(X,Z){for(let _ in Z)Z.hasOwnProperty(_)&&(X[_]=Z[_]);return X}let linkEl;function toAbsoluteURL(X){return linkEl||(linkEl=typeof document>"u"?{}:document.createElement("a")),linkEl.href=X,linkEl.href}function safariPre15Workaround(X){if(typeof createImageBitmap!="function"){console.info("Safari<15: applying SDF canvas workaround");const{sdfCanvas:Z,sdfTexture:_}=X,{width:K,height:te}=Z,ne=X.sdfCanvas.getContext("webgl");let oe=_.image.data;(!oe||oe.length!==K*te*4)&&(oe=new Uint8Array(K*te*4),_.image={width:K,height:te,data:oe},_.flipY=!1,_.isDataTexture=!0),ne.readPixels(0,0,K,te,ne.RGBA,ne.UNSIGNED_BYTE,oe)}}const typesetterWorkerModule=defineWorkerModule({name:"Typesetter",dependencies:[createTypesetter,fontResolverWorkerModule,bidiFactory],init(X,Z,_){return X(Z,_())}}),typesetInWorker=defineWorkerModule({name:"Typesetter",dependencies:[typesetterWorkerModule],init(X){return function(Z){return new Promise(_=>{X.typeset(Z,_)})}},getTransferables(X){const Z=[];for(let _ in X)X[_]&&X[_].buffer&&Z.push(X[_].buffer);return Z}});typesetInWorker.onMainThread;const templateGeometries={};function getTemplateGeometry(X){let Z=templateGeometries[X];return Z||(Z=templateGeometries[X]=new PlaneGeometry(1,1,X,X).translate(.5,.5,0)),Z}const glyphBoundsAttrName="aTroikaGlyphBounds",glyphIndexAttrName="aTroikaGlyphIndex",glyphColorAttrName="aTroikaGlyphColor";class GlyphsGeometry extends InstancedBufferGeometry{constructor(){super(),this.detail=1,this.curveRadius=0,this.groups=[{start:0,count:1/0,materialIndex:0},{start:0,count:1/0,materialIndex:1}],this.boundingSphere=new Sphere,this.boundingBox=new Box3}computeBoundingSphere(){}computeBoundingBox(){}set detail(Z){if(Z!==this._detail){this._detail=Z,(typeof Z!="number"||Z<1)&&(Z=1);let _=getTemplateGeometry(Z);["position","normal","uv"].forEach(K=>{this.attributes[K]=_.attributes[K].clone()}),this.setIndex(_.getIndex().clone())}}get detail(){return this._detail}set curveRadius(Z){Z!==this._curveRadius&&(this._curveRadius=Z,this._updateBounds())}get curveRadius(){return this._curveRadius}updateGlyphs(Z,_,K,te,ne){this.updateAttributeData(glyphBoundsAttrName,Z,4),this.updateAttributeData(glyphIndexAttrName,_,1),this.updateAttributeData(glyphColorAttrName,ne,3),this._blockBounds=K,this._chunkedBounds=te,this.instanceCount=_.length,this._updateBounds()}_updateBounds(){const Z=this._blockBounds;if(Z){const{curveRadius:_,boundingBox:K}=this;if(_){const{PI:te,floor:ne,min:oe,max:ie,sin:se,cos:ae}=Math,ge=te/2,ce=te*2,de=Math.abs(_),pe=Z[0]/de,fe=Z[2]/de,be=ne((pe+ge)/ce)!==ne((fe+ge)/ce)?-de:oe(se(pe)*de,se(fe)*de),me=ne((pe-ge)/ce)!==ne((fe-ge)/ce)?de:ie(se(pe)*de,se(fe)*de),ye=ne((pe+te)/ce)!==ne((fe+te)/ce)?de*2:ie(de-ae(pe)*de,de-ae(fe)*de);K.min.set(be,Z[1],_<0?-ye:0),K.max.set(me,Z[3],_<0?0:ye)}else K.min.set(Z[0],Z[1],0),K.max.set(Z[2],Z[3],0);K.getBoundingSphere(this.boundingSphere)}}applyClipRect(Z){let _=this.getAttribute(glyphIndexAttrName).count,K=this._chunkedBounds;if(K)for(let te=K.length;te--;){_=K[te].end;let ne=K[te].rect;if(ne[1]<Z.w&&ne[3]>Z.y&&ne[0]<Z.z&&ne[2]>Z.x)break}this.instanceCount=_}updateAttributeData(Z,_,K){const te=this.getAttribute(Z);_?te&&te.array.length===_.length?(te.array.set(_),te.needsUpdate=!0):(this.setAttribute(Z,new InstancedBufferAttribute(_,K)),delete this._maxInstanceCount,this.dispose()):te&&this.deleteAttribute(Z)}}const VERTEX_DEFS=`
uniform vec2 uTroikaSDFTextureSize;
uniform float uTroikaSDFGlyphSize;
uniform vec4 uTroikaTotalBounds;
uniform vec4 uTroikaClipRect;
uniform mat3 uTroikaOrient;
uniform bool uTroikaUseGlyphColors;
uniform float uTroikaEdgeOffset;
uniform float uTroikaBlurRadius;
uniform vec2 uTroikaPositionOffset;
uniform float uTroikaCurveRadius;
attribute vec4 aTroikaGlyphBounds;
attribute float aTroikaGlyphIndex;
attribute vec3 aTroikaGlyphColor;
varying vec2 vTroikaGlyphUV;
varying vec4 vTroikaTextureUVBounds;
varying float vTroikaTextureChannel;
varying vec3 vTroikaGlyphColor;
varying vec2 vTroikaGlyphDimensions;
`,VERTEX_TRANSFORM=`
vec4 bounds = aTroikaGlyphBounds;
bounds.xz += uTroikaPositionOffset.x;
bounds.yw -= uTroikaPositionOffset.y;

vec4 outlineBounds = vec4(
  bounds.xy - uTroikaEdgeOffset - uTroikaBlurRadius,
  bounds.zw + uTroikaEdgeOffset + uTroikaBlurRadius
);
vec4 clippedBounds = vec4(
  clamp(outlineBounds.xy, uTroikaClipRect.xy, uTroikaClipRect.zw),
  clamp(outlineBounds.zw, uTroikaClipRect.xy, uTroikaClipRect.zw)
);

vec2 clippedXY = (mix(clippedBounds.xy, clippedBounds.zw, position.xy) - bounds.xy) / (bounds.zw - bounds.xy);

position.xy = mix(bounds.xy, bounds.zw, clippedXY);

uv = (position.xy - uTroikaTotalBounds.xy) / (uTroikaTotalBounds.zw - uTroikaTotalBounds.xy);

float rad = uTroikaCurveRadius;
if (rad != 0.0) {
  float angle = position.x / rad;
  position.xz = vec2(sin(angle) * rad, rad - cos(angle) * rad);
  normal.xz = vec2(sin(angle), cos(angle));
}
  
position = uTroikaOrient * position;
normal = uTroikaOrient * normal;

vTroikaGlyphUV = clippedXY.xy;
vTroikaGlyphDimensions = vec2(bounds[2] - bounds[0], bounds[3] - bounds[1]);


float txCols = uTroikaSDFTextureSize.x / uTroikaSDFGlyphSize;
vec2 txUvPerSquare = uTroikaSDFGlyphSize / uTroikaSDFTextureSize;
vec2 txStartUV = txUvPerSquare * vec2(
  mod(floor(aTroikaGlyphIndex / 4.0), txCols),
  floor(floor(aTroikaGlyphIndex / 4.0) / txCols)
);
vTroikaTextureUVBounds = vec4(txStartUV, vec2(txStartUV) + txUvPerSquare);
vTroikaTextureChannel = mod(aTroikaGlyphIndex, 4.0);
`,FRAGMENT_DEFS=`
uniform sampler2D uTroikaSDFTexture;
uniform vec2 uTroikaSDFTextureSize;
uniform float uTroikaSDFGlyphSize;
uniform float uTroikaSDFExponent;
uniform float uTroikaEdgeOffset;
uniform float uTroikaFillOpacity;
uniform float uTroikaBlurRadius;
uniform vec3 uTroikaStrokeColor;
uniform float uTroikaStrokeWidth;
uniform float uTroikaStrokeOpacity;
uniform bool uTroikaSDFDebug;
varying vec2 vTroikaGlyphUV;
varying vec4 vTroikaTextureUVBounds;
varying float vTroikaTextureChannel;
varying vec2 vTroikaGlyphDimensions;

float troikaSdfValueToSignedDistance(float alpha) {
  // Inverse of exponential encoding in webgl-sdf-generator
  
  float maxDimension = max(vTroikaGlyphDimensions.x, vTroikaGlyphDimensions.y);
  float absDist = (1.0 - pow(2.0 * (alpha > 0.5 ? 1.0 - alpha : alpha), 1.0 / uTroikaSDFExponent)) * maxDimension;
  float signedDist = absDist * (alpha > 0.5 ? -1.0 : 1.0);
  return signedDist;
}

float troikaGlyphUvToSdfValue(vec2 glyphUV) {
  vec2 textureUV = mix(vTroikaTextureUVBounds.xy, vTroikaTextureUVBounds.zw, glyphUV);
  vec4 rgba = texture2D(uTroikaSDFTexture, textureUV);
  float ch = floor(vTroikaTextureChannel + 0.5); //NOTE: can't use round() in WebGL1
  return ch == 0.0 ? rgba.r : ch == 1.0 ? rgba.g : ch == 2.0 ? rgba.b : rgba.a;
}

float troikaGlyphUvToDistance(vec2 uv) {
  return troikaSdfValueToSignedDistance(troikaGlyphUvToSdfValue(uv));
}

float troikaGetAADist() {
  
  #if defined(GL_OES_standard_derivatives) || __VERSION__ >= 300
  return length(fwidth(vTroikaGlyphUV * vTroikaGlyphDimensions)) * 0.5;
  #else
  return vTroikaGlyphDimensions.x / 64.0;
  #endif
}

float troikaGetFragDistValue() {
  vec2 clampedGlyphUV = clamp(vTroikaGlyphUV, 0.5 / uTroikaSDFGlyphSize, 1.0 - 0.5 / uTroikaSDFGlyphSize);
  float distance = troikaGlyphUvToDistance(clampedGlyphUV);
 
  // Extrapolate distance when outside bounds:
  distance += clampedGlyphUV == vTroikaGlyphUV ? 0.0 : 
    length((vTroikaGlyphUV - clampedGlyphUV) * vTroikaGlyphDimensions);

  

  return distance;
}

float troikaGetEdgeAlpha(float distance, float distanceOffset, float aaDist) {
  #if defined(IS_DEPTH_MATERIAL) || defined(IS_DISTANCE_MATERIAL)
  float alpha = step(-distanceOffset, -distance);
  #else

  float alpha = smoothstep(
    distanceOffset + aaDist,
    distanceOffset - aaDist,
    distance
  );
  #endif

  return alpha;
}
`,FRAGMENT_TRANSFORM=`
float aaDist = troikaGetAADist();
float fragDistance = troikaGetFragDistValue();
float edgeAlpha = uTroikaSDFDebug ?
  troikaGlyphUvToSdfValue(vTroikaGlyphUV) :
  troikaGetEdgeAlpha(fragDistance, uTroikaEdgeOffset, max(aaDist, uTroikaBlurRadius));

#if !defined(IS_DEPTH_MATERIAL) && !defined(IS_DISTANCE_MATERIAL)
vec4 fillRGBA = gl_FragColor;
fillRGBA.a *= uTroikaFillOpacity;
vec4 strokeRGBA = uTroikaStrokeWidth == 0.0 ? fillRGBA : vec4(uTroikaStrokeColor, uTroikaStrokeOpacity);
if (fillRGBA.a == 0.0) fillRGBA.rgb = strokeRGBA.rgb;
gl_FragColor = mix(fillRGBA, strokeRGBA, smoothstep(
  -uTroikaStrokeWidth - aaDist,
  -uTroikaStrokeWidth + aaDist,
  fragDistance
));
gl_FragColor.a *= edgeAlpha;
#endif

if (edgeAlpha == 0.0) {
  discard;
}
`;function createTextDerivedMaterial(X){const Z=createDerivedMaterial(X,{chained:!0,extensions:{derivatives:!0},uniforms:{uTroikaSDFTexture:{value:null},uTroikaSDFTextureSize:{value:new Vector2},uTroikaSDFGlyphSize:{value:0},uTroikaSDFExponent:{value:0},uTroikaTotalBounds:{value:new Vector4(0,0,0,0)},uTroikaClipRect:{value:new Vector4(0,0,0,0)},uTroikaEdgeOffset:{value:0},uTroikaFillOpacity:{value:1},uTroikaPositionOffset:{value:new Vector2},uTroikaCurveRadius:{value:0},uTroikaBlurRadius:{value:0},uTroikaStrokeWidth:{value:0},uTroikaStrokeColor:{value:new Color$1},uTroikaStrokeOpacity:{value:1},uTroikaOrient:{value:new Matrix3},uTroikaUseGlyphColors:{value:!0},uTroikaSDFDebug:{value:!1}},vertexDefs:VERTEX_DEFS,vertexTransform:VERTEX_TRANSFORM,fragmentDefs:FRAGMENT_DEFS,fragmentColorTransform:FRAGMENT_TRANSFORM,customRewriter({vertexShader:_,fragmentShader:K}){let te=/\buniform\s+vec3\s+diffuse\b/;return te.test(K)&&(K=K.replace(te,"varying vec3 vTroikaGlyphColor").replace(/\bdiffuse\b/g,"vTroikaGlyphColor"),te.test(_)||(_=_.replace(voidMainRegExp,`uniform vec3 diffuse;
$&
vTroikaGlyphColor = uTroikaUseGlyphColors ? aTroikaGlyphColor / 255.0 : diffuse;
`))),{vertexShader:_,fragmentShader:K}}});return Z.transparent=!0,Z.forceSinglePass=!0,Object.defineProperties(Z,{isTroikaTextMaterial:{value:!0},shadowSide:{get(){return this.side},set(){}}}),Z}const defaultMaterial=new MeshBasicMaterial({color:16777215,side:DoubleSide,transparent:!0}),defaultStrokeColor=8421504,tempMat4=new Matrix4,tempVec3a=new Vector3,tempVec3b=new Vector3,tempArray=[],origin=new Vector3,defaultOrient="+x+y";function first(X){return Array.isArray(X)?X[0]:X}let getFlatRaycastMesh=()=>{const X=new Mesh(new PlaneGeometry(1,1),defaultMaterial);return getFlatRaycastMesh=()=>X,X},getCurvedRaycastMesh=()=>{const X=new Mesh(new PlaneGeometry(1,1,32,1),defaultMaterial);return getCurvedRaycastMesh=()=>X,X};const syncStartEvent={type:"syncstart"},syncCompleteEvent={type:"synccomplete"},SYNCABLE_PROPS=["font","fontSize","fontStyle","fontWeight","lang","letterSpacing","lineHeight","maxWidth","overflowWrap","text","direction","textAlign","textIndent","whiteSpace","anchorX","anchorY","colorRanges","sdfGlyphSize"],COPYABLE_PROPS=SYNCABLE_PROPS.concat("material","color","depthOffset","clipRect","curveRadius","orientation","glyphGeometryDetail");let Text$1=class extends Mesh{constructor(){const Z=new GlyphsGeometry;super(Z,null),this.text="",this.anchorX=0,this.anchorY=0,this.curveRadius=0,this.direction="auto",this.font=null,this.unicodeFontsURL=null,this.fontSize=.1,this.fontWeight="normal",this.fontStyle="normal",this.lang=null,this.letterSpacing=0,this.lineHeight="normal",this.maxWidth=1/0,this.overflowWrap="normal",this.textAlign="left",this.textIndent=0,this.whiteSpace="normal",this.material=null,this.color=null,this.colorRanges=null,this.outlineWidth=0,this.outlineColor=0,this.outlineOpacity=1,this.outlineBlur=0,this.outlineOffsetX=0,this.outlineOffsetY=0,this.strokeWidth=0,this.strokeColor=defaultStrokeColor,this.strokeOpacity=1,this.fillOpacity=1,this.depthOffset=0,this.clipRect=null,this.orientation=defaultOrient,this.glyphGeometryDetail=1,this.sdfGlyphSize=null,this.gpuAccelerateSDF=!0,this.debugSDF=!1}sync(Z){this._needsSync&&(this._needsSync=!1,this._isSyncing?(this._queuedSyncs||(this._queuedSyncs=[])).push(Z):(this._isSyncing=!0,this.dispatchEvent(syncStartEvent),getTextRenderInfo({text:this.text,font:this.font,lang:this.lang,fontSize:this.fontSize||.1,fontWeight:this.fontWeight||"normal",fontStyle:this.fontStyle||"normal",letterSpacing:this.letterSpacing||0,lineHeight:this.lineHeight||"normal",maxWidth:this.maxWidth,direction:this.direction||"auto",textAlign:this.textAlign,textIndent:this.textIndent,whiteSpace:this.whiteSpace,overflowWrap:this.overflowWrap,anchorX:this.anchorX,anchorY:this.anchorY,colorRanges:this.colorRanges,includeCaretPositions:!0,sdfGlyphSize:this.sdfGlyphSize,gpuAccelerateSDF:this.gpuAccelerateSDF,unicodeFontsURL:this.unicodeFontsURL},_=>{this._isSyncing=!1,this._textRenderInfo=_,this.geometry.updateGlyphs(_.glyphBounds,_.glyphAtlasIndices,_.blockBounds,_.chunkedBounds,_.glyphColors);const K=this._queuedSyncs;K&&(this._queuedSyncs=null,this._needsSync=!0,this.sync(()=>{K.forEach(te=>te&&te())})),this.dispatchEvent(syncCompleteEvent),Z&&Z()})))}onBeforeRender(Z,_,K,te,ne,oe){this.sync(),ne.isTroikaTextMaterial&&this._prepareForRender(ne)}dispose(){this.geometry.dispose()}get textRenderInfo(){return this._textRenderInfo||null}createDerivedMaterial(Z){return createTextDerivedMaterial(Z)}get material(){let Z=this._derivedMaterial;const _=this._baseMaterial||this._defaultMaterial||(this._defaultMaterial=defaultMaterial.clone());if((!Z||!Z.isDerivedFrom(_))&&(Z=this._derivedMaterial=this.createDerivedMaterial(_),_.addEventListener("dispose",function K(){_.removeEventListener("dispose",K),Z.dispose()})),this.hasOutline()){let K=Z._outlineMtl;return K||(K=Z._outlineMtl=Object.create(Z,{id:{value:Z.id+.1}}),K.isTextOutlineMaterial=!0,K.depthWrite=!1,K.map=null,Z.addEventListener("dispose",function te(){Z.removeEventListener("dispose",te),K.dispose()})),[K,Z]}else return Z}set material(Z){Z&&Z.isTroikaTextMaterial?(this._derivedMaterial=Z,this._baseMaterial=Z.baseMaterial):this._baseMaterial=Z}hasOutline(){return!!(this.outlineWidth||this.outlineBlur||this.outlineOffsetX||this.outlineOffsetY)}get glyphGeometryDetail(){return this.geometry.detail}set glyphGeometryDetail(Z){this.geometry.detail=Z}get curveRadius(){return this.geometry.curveRadius}set curveRadius(Z){this.geometry.curveRadius=Z}get customDepthMaterial(){return first(this.material).getDepthMaterial()}get customDistanceMaterial(){return first(this.material).getDistanceMaterial()}_prepareForRender(Z){const _=Z.isTextOutlineMaterial,K=Z.uniforms,te=this.textRenderInfo;if(te){const{sdfTexture:ie,blockBounds:se}=te;K.uTroikaSDFTexture.value=ie,K.uTroikaSDFTextureSize.value.set(ie.image.width,ie.image.height),K.uTroikaSDFGlyphSize.value=te.sdfGlyphSize,K.uTroikaSDFExponent.value=te.sdfExponent,K.uTroikaTotalBounds.value.fromArray(se),K.uTroikaUseGlyphColors.value=!_&&!!te.glyphColors;let ae=0,ge=0,ce=0,de,pe,fe,be=0,me=0;if(_){let{outlineWidth:ve,outlineOffsetX:Be,outlineOffsetY:Re,outlineBlur:Ee,outlineOpacity:We}=this;ae=this._parsePercent(ve)||0,ge=Math.max(0,this._parsePercent(Ee)||0),de=We,be=this._parsePercent(Be)||0,me=this._parsePercent(Re)||0}else ce=Math.max(0,this._parsePercent(this.strokeWidth)||0),ce&&(fe=this.strokeColor,K.uTroikaStrokeColor.value.set(fe??defaultStrokeColor),pe=this.strokeOpacity,pe==null&&(pe=1)),de=this.fillOpacity;K.uTroikaEdgeOffset.value=ae,K.uTroikaPositionOffset.value.set(be,me),K.uTroikaBlurRadius.value=ge,K.uTroikaStrokeWidth.value=ce,K.uTroikaStrokeOpacity.value=pe,K.uTroikaFillOpacity.value=de??1,K.uTroikaCurveRadius.value=this.curveRadius||0;let ye=this.clipRect;if(ye&&Array.isArray(ye)&&ye.length===4)K.uTroikaClipRect.value.fromArray(ye);else{const ve=(this.fontSize||.1)*100;K.uTroikaClipRect.value.set(se[0]-ve,se[1]-ve,se[2]+ve,se[3]+ve)}this.geometry.applyClipRect(K.uTroikaClipRect.value)}K.uTroikaSDFDebug.value=!!this.debugSDF,Z.polygonOffset=!!this.depthOffset,Z.polygonOffsetFactor=Z.polygonOffsetUnits=this.depthOffset||0;const ne=_?this.outlineColor||0:this.color;if(ne==null)delete Z.color;else{const ie=Z.hasOwnProperty("color")?Z.color:Z.color=new Color$1;(ne!==ie._input||typeof ne=="object")&&ie.set(ie._input=ne)}let oe=this.orientation||defaultOrient;if(oe!==Z._orientation){let ie=K.uTroikaOrient.value;oe=oe.replace(/[^-+xyz]/g,"");let se=oe!==defaultOrient&&oe.match(/^([-+])([xyz])([-+])([xyz])$/);if(se){let[,ae,ge,ce,de]=se;tempVec3a.set(0,0,0)[ge]=ae==="-"?1:-1,tempVec3b.set(0,0,0)[de]=ce==="-"?-1:1,tempMat4.lookAt(origin,tempVec3a.cross(tempVec3b),tempVec3b),ie.setFromMatrix4(tempMat4)}else ie.identity();Z._orientation=oe}}_parsePercent(Z){if(typeof Z=="string"){let _=Z.match(/^(-?[\d.]+)%$/),K=_?parseFloat(_[1]):NaN;Z=(isNaN(K)?0:K/100)*this.fontSize}return Z}localPositionToTextCoords(Z,_=new Vector2){_.copy(Z);const K=this.curveRadius;return K&&(_.x=Math.atan2(Z.x,Math.abs(K)-Math.abs(Z.z))*Math.abs(K)),_}worldPositionToTextCoords(Z,_=new Vector2){return tempVec3a.copy(Z),this.localPositionToTextCoords(this.worldToLocal(tempVec3a),_)}raycast(Z,_){const{textRenderInfo:K,curveRadius:te}=this;if(K){const ne=K.blockBounds,oe=te?getCurvedRaycastMesh():getFlatRaycastMesh(),ie=oe.geometry,{position:se,uv:ae}=ie.attributes;for(let ge=0;ge<ae.count;ge++){let ce=ne[0]+ae.getX(ge)*(ne[2]-ne[0]);const de=ne[1]+ae.getY(ge)*(ne[3]-ne[1]);let pe=0;te&&(pe=te-Math.cos(ce/te)*te,ce=Math.sin(ce/te)*te),se.setXYZ(ge,ce,de,pe)}ie.boundingSphere=this.geometry.boundingSphere,ie.boundingBox=this.geometry.boundingBox,oe.matrixWorld=this.matrixWorld,oe.material.side=this.material.side,tempArray.length=0,oe.raycast(Z,tempArray);for(let ge=0;ge<tempArray.length;ge++)tempArray[ge].object=this,_.push(tempArray[ge])}}copy(Z){const _=this.geometry;return super.copy(Z),this.geometry=_,COPYABLE_PROPS.forEach(K=>{this[K]=Z[K]}),this}clone(){return new this.constructor().copy(this)}};SYNCABLE_PROPS.forEach(X=>{const Z="_private_"+X;Object.defineProperty(Text$1.prototype,X,{get(){return this[Z]},set(_){_!==this[Z]&&(this[Z]=_,this._needsSync=!0)}})});new Box3;new Color$1;const Text=reactExports.forwardRef(({sdfGlyphSize:X=64,anchorX:Z="center",anchorY:_="middle",font:K,fontSize:te=1,children:ne,characters:oe,onSync:ie,...se},ae)=>{const ge=useThree(({invalidate:fe})=>fe),[ce]=reactExports.useState(()=>new Text$1),[de,pe]=reactExports.useMemo(()=>{const fe=[];let be="";return reactExports.Children.forEach(ne,me=>{typeof me=="string"||typeof me=="number"?be+=me:fe.push(me)}),[fe,be]},[ne]);return suspend(()=>new Promise(fe=>preloadFont({font:K,characters:oe},fe)),["troika-text",K,oe]),reactExports.useLayoutEffect(()=>void ce.sync(()=>{ge(),ie&&ie(ce)})),reactExports.useEffect(()=>()=>ce.dispose(),[ce]),reactExports.createElement("primitive",_extends$2({object:ce,ref:ae,font:K,text:pe,anchorX:Z,anchorY:_,fontSize:te,sdfGlyphSize:X},se),de)}),IsObject=X=>X===Object(X)&&!Array.isArray(X)&&typeof X!="function";function useTexture(X,Z){const _=useThree(ne=>ne.gl),K=useLoader(TextureLoader,IsObject(X)?Object.values(X):X);return reactExports.useLayoutEffect(()=>{Z==null||Z(K)},[Z]),reactExports.useEffect(()=>{if("initTexture"in _){let ne=[];Array.isArray(K)?ne=K:K instanceof Texture?ne=[K]:IsObject(K)&&(ne=Object.values(K)),ne.forEach(oe=>{oe instanceof Texture&&_.initTexture(oe)})}},[_,K]),reactExports.useMemo(()=>{if(IsObject(X)){const ne={};let oe=0;for(const ie in X)ne[ie]=K[oe++];return ne}else return K},[X,K])}useTexture.preload=X=>useLoader.preload(TextureLoader,X);useTexture.clear=X=>useLoader.clear(TextureLoader,X);let dracoLoader=null,decoderPath="https://www.gstatic.com/draco/versioned/decoders/1.5.5/";function extensions(X=!0,Z=!0,_){return K=>{_&&_(K),X&&(dracoLoader||(dracoLoader=new DRACOLoader),dracoLoader.setDecoderPath(typeof X=="string"?X:decoderPath),K.setDRACOLoader(dracoLoader)),Z&&K.setMeshoptDecoder(typeof MeshoptDecoder=="function"?MeshoptDecoder():MeshoptDecoder)}}const useGLTF=(X,Z,_,K)=>useLoader(GLTFLoader,X,extensions(Z,_,K));useGLTF.preload=(X,Z,_,K)=>useLoader.preload(GLTFLoader,X,extensions(Z,_,K));useGLTF.clear=X=>useLoader.clear(GLTFLoader,X);useGLTF.setDecoderPath=X=>{decoderPath=X};var propTypes={exports:{}},ReactPropTypesSecret_1,hasRequiredReactPropTypesSecret;function requireReactPropTypesSecret(){if(hasRequiredReactPropTypesSecret)return ReactPropTypesSecret_1;hasRequiredReactPropTypesSecret=1;var X="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED";return ReactPropTypesSecret_1=X,ReactPropTypesSecret_1}var factoryWithThrowingShims,hasRequiredFactoryWithThrowingShims;function requireFactoryWithThrowingShims(){if(hasRequiredFactoryWithThrowingShims)return factoryWithThrowingShims;hasRequiredFactoryWithThrowingShims=1;var X=requireReactPropTypesSecret();function Z(){}function _(){}return _.resetWarningCache=Z,factoryWithThrowingShims=function(){function K(oe,ie,se,ae,ge,ce){if(ce!==X){var de=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw de.name="Invariant Violation",de}}K.isRequired=K;function te(){return K}var ne={array:K,bigint:K,bool:K,func:K,number:K,object:K,string:K,symbol:K,any:K,arrayOf:te,element:K,elementType:K,instanceOf:te,node:K,objectOf:te,oneOf:te,oneOfType:te,shape:te,exact:te,checkPropTypes:_,resetWarningCache:Z};return ne.PropTypes=ne,ne},factoryWithThrowingShims}var hasRequiredPropTypes;function requirePropTypes(){return hasRequiredPropTypes||(hasRequiredPropTypes=1,propTypes.exports=requireFactoryWithThrowingShims()()),propTypes.exports}var propTypesExports=requirePropTypes();const PropTypes=getDefaultExportFromCjs(propTypesExports),LinearEncoding=3e3,sRGBEncoding=3001,getBufferForType=(X,Z,_)=>{let K;switch(X){case UnsignedByteType:K=new Uint8ClampedArray(Z*_*4);break;case HalfFloatType:K=new Uint16Array(Z*_*4);break;case UnsignedIntType:K=new Uint32Array(Z*_*4);break;case ByteType:K=new Int8Array(Z*_*4);break;case ShortType:K=new Int16Array(Z*_*4);break;case IntType:K=new Int32Array(Z*_*4);break;case FloatType:K=new Float32Array(Z*_*4);break;default:throw new Error("Unsupported data type")}return K};let _canReadPixelsResult;const canReadPixels=(X,Z,_,K)=>{if(_canReadPixelsResult!==void 0)return _canReadPixelsResult;const te=new WebGLRenderTarget(1,1,K);Z.setRenderTarget(te);const ne=new Mesh(new PlaneGeometry,new MeshBasicMaterial({color:16777215}));Z.render(ne,_),Z.setRenderTarget(null);const oe=getBufferForType(X,te.width,te.height);return Z.readRenderTargetPixels(te,0,0,te.width,te.height,oe),te.dispose(),ne.geometry.dispose(),ne.material.dispose(),_canReadPixelsResult=oe[0]!==0,_canReadPixelsResult};class QuadRenderer{constructor(Z){var _,K,te,ne,oe,ie,se,ae,ge,ce,de,pe,fe,be,me,ye;this._rendererIsDisposable=!1,this._supportsReadPixels=!0,this.render=()=>{this._renderer.setRenderTarget(this._renderTarget);try{this._renderer.render(this._scene,this._camera)}catch(Be){throw this._renderer.setRenderTarget(null),Be}this._renderer.setRenderTarget(null)},this._width=Z.width,this._height=Z.height,this._type=Z.type,this._colorSpace=Z.colorSpace;const ve={format:RGBAFormat,depthBuffer:!1,stencilBuffer:!1,type:this._type,colorSpace:this._colorSpace,anisotropy:((_=Z.renderTargetOptions)===null||_===void 0?void 0:_.anisotropy)!==void 0?(K=Z.renderTargetOptions)===null||K===void 0?void 0:K.anisotropy:1,generateMipmaps:((te=Z.renderTargetOptions)===null||te===void 0?void 0:te.generateMipmaps)!==void 0?(ne=Z.renderTargetOptions)===null||ne===void 0?void 0:ne.generateMipmaps:!1,magFilter:((oe=Z.renderTargetOptions)===null||oe===void 0?void 0:oe.magFilter)!==void 0?(ie=Z.renderTargetOptions)===null||ie===void 0?void 0:ie.magFilter:LinearFilter,minFilter:((se=Z.renderTargetOptions)===null||se===void 0?void 0:se.minFilter)!==void 0?(ae=Z.renderTargetOptions)===null||ae===void 0?void 0:ae.minFilter:LinearFilter,samples:((ge=Z.renderTargetOptions)===null||ge===void 0?void 0:ge.samples)!==void 0?(ce=Z.renderTargetOptions)===null||ce===void 0?void 0:ce.samples:void 0,wrapS:((de=Z.renderTargetOptions)===null||de===void 0?void 0:de.wrapS)!==void 0?(pe=Z.renderTargetOptions)===null||pe===void 0?void 0:pe.wrapS:ClampToEdgeWrapping,wrapT:((fe=Z.renderTargetOptions)===null||fe===void 0?void 0:fe.wrapT)!==void 0?(be=Z.renderTargetOptions)===null||be===void 0?void 0:be.wrapT:ClampToEdgeWrapping};if(this._material=Z.material,Z.renderer?this._renderer=Z.renderer:(this._renderer=QuadRenderer.instantiateRenderer(),this._rendererIsDisposable=!0),this._scene=new Scene$1,this._camera=new OrthographicCamera,this._camera.position.set(0,0,10),this._camera.left=-.5,this._camera.right=.5,this._camera.top=.5,this._camera.bottom=-.5,this._camera.updateProjectionMatrix(),!canReadPixels(this._type,this._renderer,this._camera,ve)){let Be;switch(this._type){case HalfFloatType:Be=this._renderer.extensions.has("EXT_color_buffer_float")?FloatType:void 0;break}Be!==void 0?(console.warn(`This browser does not support reading pixels from ${this._type} RenderTargets, switching to ${FloatType}`),this._type=Be):(this._supportsReadPixels=!1,console.warn("This browser dos not support toArray or toDataTexture, calls to those methods will result in an error thrown"))}this._quad=new Mesh(new PlaneGeometry,this._material),this._quad.geometry.computeBoundingBox(),this._scene.add(this._quad),this._renderTarget=new WebGLRenderTarget(this.width,this.height,ve),this._renderTarget.texture.mapping=((me=Z.renderTargetOptions)===null||me===void 0?void 0:me.mapping)!==void 0?(ye=Z.renderTargetOptions)===null||ye===void 0?void 0:ye.mapping:UVMapping}static instantiateRenderer(){const Z=new WebGLRenderer;return Z.setSize(128,128),Z}toArray(){if(!this._supportsReadPixels)throw new Error("Can't read pixels in this browser");const Z=getBufferForType(this._type,this._width,this._height);return this._renderer.readRenderTargetPixels(this._renderTarget,0,0,this._width,this._height,Z),Z}toDataTexture(Z){const _=new DataTexture(this.toArray(),this.width,this.height,RGBAFormat,this._type,(Z==null?void 0:Z.mapping)||UVMapping,(Z==null?void 0:Z.wrapS)||ClampToEdgeWrapping,(Z==null?void 0:Z.wrapT)||ClampToEdgeWrapping,(Z==null?void 0:Z.magFilter)||LinearFilter,(Z==null?void 0:Z.minFilter)||LinearFilter,(Z==null?void 0:Z.anisotropy)||1,LinearSRGBColorSpace$1);return _.generateMipmaps=(Z==null?void 0:Z.generateMipmaps)!==void 0?Z==null?void 0:Z.generateMipmaps:!1,_}disposeOnDemandRenderer(){this._renderer.setRenderTarget(null),this._rendererIsDisposable&&(this._renderer.dispose(),this._renderer.forceContextLoss())}dispose(Z){this.disposeOnDemandRenderer(),Z&&this.renderTarget.dispose(),this.material instanceof ShaderMaterial&&Object.values(this.material.uniforms).forEach(_=>{_.value instanceof Texture&&_.value.dispose()}),Object.values(this.material).forEach(_=>{_ instanceof Texture&&_.dispose()}),this.material.dispose(),this._quad.geometry.dispose()}get width(){return this._width}set width(Z){this._width=Z,this._renderTarget.setSize(this._width,this._height)}get height(){return this._height}set height(Z){this._height=Z,this._renderTarget.setSize(this._width,this._height)}get renderer(){return this._renderer}get renderTarget(){return this._renderTarget}set renderTarget(Z){this._renderTarget=Z,this._width=Z.width,this._height=Z.height}get material(){return this._material}get type(){return this._type}get colorSpace(){return this._colorSpace}}const vertexShader=`
varying vec2 vUv;

void main() {
  vUv = uv;
  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
}
`,fragmentShader=`
// min half float value
#define HALF_FLOAT_MIN vec3( -65504, -65504, -65504 )
// max half float value
#define HALF_FLOAT_MAX vec3( 65504, 65504, 65504 )

uniform sampler2D sdr;
uniform sampler2D gainMap;
uniform vec3 gamma;
uniform vec3 offsetHdr;
uniform vec3 offsetSdr;
uniform vec3 gainMapMin;
uniform vec3 gainMapMax;
uniform float weightFactor;

varying vec2 vUv;

void main() {
  vec3 rgb = texture2D( sdr, vUv ).rgb;
  vec3 recovery = texture2D( gainMap, vUv ).rgb;
  vec3 logRecovery = pow( recovery, gamma );
  vec3 logBoost = gainMapMin * ( 1.0 - logRecovery ) + gainMapMax * logRecovery;
  vec3 hdrColor = (rgb + offsetSdr) * exp2( logBoost * weightFactor ) - offsetHdr;
  vec3 clampedHdrColor = max( HALF_FLOAT_MIN, min( HALF_FLOAT_MAX, hdrColor ));
  gl_FragColor = vec4( clampedHdrColor , 1.0 );
}
`;class GainMapDecoderMaterial extends ShaderMaterial{constructor({gamma:Z,offsetHdr:_,offsetSdr:K,gainMapMin:te,gainMapMax:ne,maxDisplayBoost:oe,hdrCapacityMin:ie,hdrCapacityMax:se,sdr:ae,gainMap:ge}){super({name:"GainMapDecoderMaterial",vertexShader,fragmentShader,uniforms:{sdr:{value:ae},gainMap:{value:ge},gamma:{value:new Vector3(1/Z[0],1/Z[1],1/Z[2])},offsetHdr:{value:new Vector3().fromArray(_)},offsetSdr:{value:new Vector3().fromArray(K)},gainMapMin:{value:new Vector3().fromArray(te)},gainMapMax:{value:new Vector3().fromArray(ne)},weightFactor:{value:(Math.log2(oe)-ie)/(se-ie)}},blending:NoBlending,depthTest:!1,depthWrite:!1}),this._maxDisplayBoost=oe,this._hdrCapacityMin=ie,this._hdrCapacityMax=se,this.needsUpdate=!0,this.uniformsNeedUpdate=!0}get sdr(){return this.uniforms.sdr.value}set sdr(Z){this.uniforms.sdr.value=Z}get gainMap(){return this.uniforms.gainMap.value}set gainMap(Z){this.uniforms.gainMap.value=Z}get offsetHdr(){return this.uniforms.offsetHdr.value.toArray()}set offsetHdr(Z){this.uniforms.offsetHdr.value.fromArray(Z)}get offsetSdr(){return this.uniforms.offsetSdr.value.toArray()}set offsetSdr(Z){this.uniforms.offsetSdr.value.fromArray(Z)}get gainMapMin(){return this.uniforms.gainMapMin.value.toArray()}set gainMapMin(Z){this.uniforms.gainMapMin.value.fromArray(Z)}get gainMapMax(){return this.uniforms.gainMapMax.value.toArray()}set gainMapMax(Z){this.uniforms.gainMapMax.value.fromArray(Z)}get gamma(){const Z=this.uniforms.gamma.value;return[1/Z.x,1/Z.y,1/Z.z]}set gamma(Z){const _=this.uniforms.gamma.value;_.x=1/Z[0],_.y=1/Z[1],_.z=1/Z[2]}get hdrCapacityMin(){return this._hdrCapacityMin}set hdrCapacityMin(Z){this._hdrCapacityMin=Z,this.calculateWeight()}get hdrCapacityMax(){return this._hdrCapacityMax}set hdrCapacityMax(Z){this._hdrCapacityMax=Z,this.calculateWeight()}get maxDisplayBoost(){return this._maxDisplayBoost}set maxDisplayBoost(Z){this._maxDisplayBoost=Math.max(1,Math.min(65504,Z)),this.calculateWeight()}calculateWeight(){const Z=(Math.log2(this._maxDisplayBoost)-this._hdrCapacityMin)/(this._hdrCapacityMax-this._hdrCapacityMin);this.uniforms.weightFactor.value=Math.max(0,Math.min(1,Z))}}class GainMapNotFoundError extends Error{}class XMPMetadataNotFoundError extends Error{}const getXMLValue=(X,Z,_)=>{const K=new RegExp(`${Z}="([^"]*)"`,"i").exec(X);if(K)return K[1];const te=new RegExp(`<${Z}[^>]*>([\\s\\S]*?)</${Z}>`,"i").exec(X);if(te){const ne=te[1].match(/<rdf:li>([^<]*)<\/rdf:li>/g);return ne&&ne.length===3?ne.map(oe=>oe.replace(/<\/?rdf:li>/g,"")):te[1].trim()}if(_!==void 0)return _;throw new Error(`Can't find ${Z} in gainmap metadata`)},extractXMP=X=>{let Z;typeof TextDecoder<"u"?Z=new TextDecoder().decode(X):Z=X.toString();let _=Z.indexOf("<x:xmpmeta");for(;_!==-1;){const K=Z.indexOf("x:xmpmeta>",_),te=Z.slice(_,K+10);try{const ne=getXMLValue(te,"hdrgm:GainMapMin","0"),oe=getXMLValue(te,"hdrgm:GainMapMax"),ie=getXMLValue(te,"hdrgm:Gamma","1"),se=getXMLValue(te,"hdrgm:OffsetSDR","0.015625"),ae=getXMLValue(te,"hdrgm:OffsetHDR","0.015625"),ge=/hdrgm:HDRCapacityMin="([^"]*)"/.exec(te),ce=ge?ge[1]:"0",de=/hdrgm:HDRCapacityMax="([^"]*)"/.exec(te);if(!de)throw new Error("Incomplete gainmap metadata");const pe=de[1];return{gainMapMin:Array.isArray(ne)?ne.map(fe=>parseFloat(fe)):[parseFloat(ne),parseFloat(ne),parseFloat(ne)],gainMapMax:Array.isArray(oe)?oe.map(fe=>parseFloat(fe)):[parseFloat(oe),parseFloat(oe),parseFloat(oe)],gamma:Array.isArray(ie)?ie.map(fe=>parseFloat(fe)):[parseFloat(ie),parseFloat(ie),parseFloat(ie)],offsetSdr:Array.isArray(se)?se.map(fe=>parseFloat(fe)):[parseFloat(se),parseFloat(se),parseFloat(se)],offsetHdr:Array.isArray(ae)?ae.map(fe=>parseFloat(fe)):[parseFloat(ae),parseFloat(ae),parseFloat(ae)],hdrCapacityMin:parseFloat(ce),hdrCapacityMax:parseFloat(pe)}}catch{}_=Z.indexOf("<x:xmpmeta",K)}};class MPFExtractor{constructor(Z){this.options={debug:Z&&Z.debug!==void 0?Z.debug:!1,extractFII:Z&&Z.extractFII!==void 0?Z.extractFII:!0,extractNonFII:Z&&Z.extractNonFII!==void 0?Z.extractNonFII:!0}}extract(Z){return new Promise((_,K)=>{const te=this.options.debug,ne=new DataView(Z.buffer);if(ne.getUint16(0)!==65496){K(new Error("Not a valid jpeg"));return}const oe=ne.byteLength;let ie=2,se=0,ae;for(;ie<oe;){if(++se>250){K(new Error(`Found no marker after ${se} loops 😵`));return}if(ne.getUint8(ie)!==255){K(new Error(`Not a valid marker at offset 0x${ie.toString(16)}, found: 0x${ne.getUint8(ie).toString(16)}`));return}if(ae=ne.getUint8(ie+1),te&&console.log(`Marker: ${ae.toString(16)}`),ae===226){te&&console.log("Found APP2 marker (0xffe2)");const ge=ie+4;if(ne.getUint32(ge)===1297106432){const ce=ge+4;let de;if(ne.getUint16(ce)===18761)de=!1;else if(ne.getUint16(ce)===19789)de=!0;else{K(new Error("No valid endianness marker found in TIFF header"));return}if(ne.getUint16(ce+2,!de)!==42){K(new Error("Not valid TIFF data! (no 0x002A marker)"));return}const pe=ne.getUint32(ce+4,!de);if(pe<8){K(new Error("Not valid TIFF data! (First offset less than 8)"));return}const fe=ce+pe,be=ne.getUint16(fe,!de),me=fe+2;let ye=0;for(let Ee=me;Ee<me+12*be;Ee+=12)ne.getUint16(Ee,!de)===45057&&(ye=ne.getUint32(Ee+8,!de));const Be=fe+2+be*12+4,Re=[];for(let Ee=Be;Ee<Be+ye*16;Ee+=16){const We={MPType:ne.getUint32(Ee,!de),size:ne.getUint32(Ee+4,!de),dataOffset:ne.getUint32(Ee+8,!de),dependantImages:ne.getUint32(Ee+12,!de),start:-1,end:-1,isFII:!1};We.dataOffset?(We.start=ce+We.dataOffset,We.isFII=!1):(We.start=0,We.isFII=!0),We.end=We.start+We.size,Re.push(We)}if(this.options.extractNonFII&&Re.length){const Ee=new Blob([ne]),We=[];for(const Ze of Re){if(Ze.isFII&&!this.options.extractFII)continue;const Ve=Ee.slice(Ze.start,Ze.end+1,"image/jpeg");We.push(Ve)}_(We)}}}ie+=2+ne.getUint16(ie+2)}})}}const extractGainmapFromJPEG=async X=>{const Z=extractXMP(X);if(!Z)throw new XMPMetadataNotFoundError("Gain map XMP metadata not found");const K=await new MPFExtractor({extractFII:!0,extractNonFII:!0}).extract(X);if(K.length!==2)throw new GainMapNotFoundError("Gain map recovery image not found");return{sdr:new Uint8Array(await K[0].arrayBuffer()),gainMap:new Uint8Array(await K[1].arrayBuffer()),metadata:Z}},getHTMLImageFromBlob=X=>new Promise((Z,_)=>{const K=document.createElement("img");K.onload=()=>{Z(K)},K.onerror=te=>{_(te)},K.src=URL.createObjectURL(X)});class LoaderBase extends Loader{constructor(Z,_){super(_),Z&&(this._renderer=Z),this._internalLoadingManager=new LoadingManager}setRenderer(Z){return this._renderer=Z,this}setRenderTargetOptions(Z){return this._renderTargetOptions=Z,this}prepareQuadRenderer(){this._renderer||console.warn("WARNING: An existing WebGL Renderer was not passed to this Loader constructor or in setRenderer, the result of this Loader will need to be converted to a Data Texture with toDataTexture() before you can use it in your renderer.");const Z=new GainMapDecoderMaterial({gainMapMax:[1,1,1],gainMapMin:[0,0,0],gamma:[1,1,1],offsetHdr:[1,1,1],offsetSdr:[1,1,1],hdrCapacityMax:1,hdrCapacityMin:0,maxDisplayBoost:1,gainMap:new Texture,sdr:new Texture});return new QuadRenderer({width:16,height:16,type:HalfFloatType,colorSpace:LinearSRGBColorSpace$1,material:Z,renderer:this._renderer,renderTargetOptions:this._renderTargetOptions})}async render(Z,_,K,te){const ne=te?new Blob([te],{type:"image/jpeg"}):void 0,oe=new Blob([K],{type:"image/jpeg"});let ie,se,ae=!1;if(typeof createImageBitmap>"u"){const de=await Promise.all([ne?getHTMLImageFromBlob(ne):Promise.resolve(void 0),getHTMLImageFromBlob(oe)]);se=de[0],ie=de[1],ae=!0}else{const de=await Promise.all([ne?createImageBitmap(ne,{imageOrientation:"flipY"}):Promise.resolve(void 0),createImageBitmap(oe,{imageOrientation:"flipY"})]);se=de[0],ie=de[1]}const ge=new Texture(se||new ImageData(2,2),UVMapping,ClampToEdgeWrapping,ClampToEdgeWrapping,LinearFilter,LinearMipMapLinearFilter,RGBAFormat,UnsignedByteType,1,LinearSRGBColorSpace$1);ge.flipY=ae,ge.needsUpdate=!0;const ce=new Texture(ie,UVMapping,ClampToEdgeWrapping,ClampToEdgeWrapping,LinearFilter,LinearMipMapLinearFilter,RGBAFormat,UnsignedByteType,1,SRGBColorSpace$1);ce.flipY=ae,ce.needsUpdate=!0,Z.width=ie.width,Z.height=ie.height,Z.material.gainMap=ge,Z.material.sdr=ce,Z.material.gainMapMin=_.gainMapMin,Z.material.gainMapMax=_.gainMapMax,Z.material.offsetHdr=_.offsetHdr,Z.material.offsetSdr=_.offsetSdr,Z.material.gamma=_.gamma,Z.material.hdrCapacityMin=_.hdrCapacityMin,Z.material.hdrCapacityMax=_.hdrCapacityMax,Z.material.maxDisplayBoost=Math.pow(2,_.hdrCapacityMax),Z.material.needsUpdate=!0,Z.render()}}class GainMapLoader extends LoaderBase{load([Z,_,K],te,ne,oe){const ie=this.prepareQuadRenderer();let se,ae,ge;const ce=async()=>{if(se&&ae&&ge){try{await this.render(ie,ge,se,ae)}catch(_e){this.manager.itemError(Z),this.manager.itemError(_),this.manager.itemError(K),typeof oe=="function"&&oe(_e),ie.disposeOnDemandRenderer();return}typeof te=="function"&&te(ie),this.manager.itemEnd(Z),this.manager.itemEnd(_),this.manager.itemEnd(K),ie.disposeOnDemandRenderer()}};let de=!0,pe=0,fe=0,be=!0,me=0,ye=0,ve=!0,Be=0,Re=0;const Ee=()=>{if(typeof ne=="function"){const _e=pe+me+Be,Xe=fe+ye+Re,Pe=de&&be&&ve;ne(new ProgressEvent("progress",{lengthComputable:Pe,loaded:Xe,total:_e}))}};this.manager.itemStart(Z),this.manager.itemStart(_),this.manager.itemStart(K);const We=new FileLoader(this._internalLoadingManager);We.setResponseType("arraybuffer"),We.setRequestHeader(this.requestHeader),We.setPath(this.path),We.setWithCredentials(this.withCredentials),We.load(Z,async _e=>{if(typeof _e=="string")throw new Error("Invalid sdr buffer");se=_e,await ce()},_e=>{de=_e.lengthComputable,fe=_e.loaded,pe=_e.total,Ee()},_e=>{this.manager.itemError(Z),typeof oe=="function"&&oe(_e)});const Ze=new FileLoader(this._internalLoadingManager);Ze.setResponseType("arraybuffer"),Ze.setRequestHeader(this.requestHeader),Ze.setPath(this.path),Ze.setWithCredentials(this.withCredentials),Ze.load(_,async _e=>{if(typeof _e=="string")throw new Error("Invalid gainmap buffer");ae=_e,await ce()},_e=>{be=_e.lengthComputable,ye=_e.loaded,me=_e.total,Ee()},_e=>{this.manager.itemError(_),typeof oe=="function"&&oe(_e)});const Ve=new FileLoader(this._internalLoadingManager);return Ve.setRequestHeader(this.requestHeader),Ve.setPath(this.path),Ve.setWithCredentials(this.withCredentials),Ve.load(K,async _e=>{if(typeof _e!="string")throw new Error("Invalid metadata string");ge=JSON.parse(_e),await ce()},_e=>{ve=_e.lengthComputable,Re=_e.loaded,Be=_e.total,Ee()},_e=>{this.manager.itemError(K),typeof oe=="function"&&oe(_e)}),ie}}class HDRJPGLoader extends LoaderBase{load(Z,_,K,te){const ne=this.prepareQuadRenderer(),oe=new FileLoader(this._internalLoadingManager);return oe.setResponseType("arraybuffer"),oe.setRequestHeader(this.requestHeader),oe.setPath(this.path),oe.setWithCredentials(this.withCredentials),this.manager.itemStart(Z),oe.load(Z,async ie=>{if(typeof ie=="string")throw new Error("Invalid buffer, received [string], was expecting [ArrayBuffer]");const se=new Uint8Array(ie);let ae,ge,ce;try{const de=await extractGainmapFromJPEG(se);ae=de.sdr,ge=de.gainMap,ce=de.metadata}catch(de){if(de instanceof XMPMetadataNotFoundError||de instanceof GainMapNotFoundError)console.warn(`Failure to reconstruct an HDR image from ${Z}: Gain map metadata not found in the file, HDRJPGLoader will render the SDR jpeg`),ce={gainMapMin:[0,0,0],gainMapMax:[1,1,1],gamma:[1,1,1],hdrCapacityMin:0,hdrCapacityMax:1,offsetHdr:[0,0,0],offsetSdr:[0,0,0]},ae=se;else throw de}try{await this.render(ne,ce,ae,ge)}catch(de){this.manager.itemError(Z),typeof te=="function"&&te(de),ne.disposeOnDemandRenderer();return}typeof _=="function"&&_(ne),this.manager.itemEnd(Z),ne.disposeOnDemandRenderer()},K,ie=>{this.manager.itemError(Z),typeof te=="function"&&te(ie)}),ne}}const presetsObj={apartment:"lebombo_1k.hdr",city:"potsdamer_platz_1k.hdr",dawn:"kiara_1_dawn_1k.hdr",forest:"forest_slope_1k.hdr",lobby:"st_fagans_interior_1k.hdr",night:"dikhololo_night_1k.hdr",park:"rooitou_park_1k.hdr",studio:"studio_small_03_1k.hdr",sunset:"venice_sunset_1k.hdr",warehouse:"empty_warehouse_01_1k.hdr"},CUBEMAP_ROOT="https://raw.githack.com/pmndrs/drei-assets/456060a26bbeb8fdf79326f224b6d99b8bcce736/hdri/",isArray=X=>Array.isArray(X),defaultFiles=["/px.png","/nx.png","/py.png","/ny.png","/pz.png","/nz.png"];function useEnvironment({files:X=defaultFiles,path:Z="",preset:_=void 0,encoding:K=void 0,extensions:te}={}){let ne=null,oe=!1;_&&(validatePreset(_),X=presetsObj[_],Z=CUBEMAP_ROOT),oe=isArray(X);const{extension:ie,isCubemap:se}=getExtension(X);if(ne=getLoader(ie),!ne)throw new Error("useEnvironment: Unrecognized file extension: "+X);const ae=useThree(pe=>pe.gl);reactExports.useLayoutEffect(()=>{if(ie!=="webp"&&ie!=="jpg"&&ie!=="jpeg")return;function pe(){useLoader.clear(ne,oe?[X]:X)}ae.domElement.addEventListener("webglcontextlost",pe,{once:!0})},[X,ae.domElement]);const ge=useLoader(ne,oe?[X]:X,pe=>{(ie==="webp"||ie==="jpg"||ie==="jpeg")&&pe.setRenderer(ae),pe.setPath==null||pe.setPath(Z),te&&te(pe)});let ce=oe?ge[0]:ge;if(ie==="jpg"||ie==="jpeg"||ie==="webp"){var de;ce=(de=ce.renderTarget)==null?void 0:de.texture}return ce.mapping=se?CubeReflectionMapping:EquirectangularReflectionMapping,"colorSpace"in ce?ce.colorSpace=K??se?"srgb":"srgb-linear":ce.encoding=K??se?sRGBEncoding:LinearEncoding,ce}const preloadDefaultOptions={files:defaultFiles,path:"",preset:void 0,extensions:void 0};useEnvironment.preload=X=>{const Z={...preloadDefaultOptions,...X};let{files:_,path:K=""}=Z;const{preset:te,extensions:ne}=Z;te&&(validatePreset(te),_=presetsObj[te],K=CUBEMAP_ROOT);const{extension:oe}=getExtension(_);if(oe==="webp"||oe==="jpg"||oe==="jpeg")throw new Error("useEnvironment: Preloading gainmaps is not supported");const ie=getLoader(oe);if(!ie)throw new Error("useEnvironment: Unrecognized file extension: "+_);useLoader.preload(ie,isArray(_)?[_]:_,se=>{se.setPath==null||se.setPath(K),ne&&ne(se)})};const clearDefaultOptins={files:defaultFiles,preset:void 0};useEnvironment.clear=X=>{const Z={...clearDefaultOptins,...X};let{files:_}=Z;const{preset:K}=Z;K&&(validatePreset(K),_=presetsObj[K]);const{extension:te}=getExtension(_),ne=getLoader(te);if(!ne)throw new Error("useEnvironment: Unrecognized file extension: "+_);useLoader.clear(ne,isArray(_)?[_]:_)};function validatePreset(X){if(!(X in presetsObj))throw new Error("Preset must be one of: "+Object.keys(presetsObj).join(", "))}function getExtension(X){var Z;const _=isArray(X)&&X.length===6,K=isArray(X)&&X.length===3&&X.some(oe=>oe.endsWith("json")),te=isArray(X)?X[0]:X;return{extension:_?"cube":K?"webp":te.startsWith("data:application/exr")?"exr":te.startsWith("data:application/hdr")?"hdr":te.startsWith("data:image/jpeg")?"jpg":(Z=te.split(".").pop())==null||(Z=Z.split("?"))==null||(Z=Z.shift())==null?void 0:Z.toLowerCase(),isCubemap:_,isGainmap:K}}function getLoader(X){return X==="cube"?CubeTextureLoader:X==="hdr"?RGBELoader:X==="exr"?EXRLoader:X==="jpg"||X==="jpeg"?HDRJPGLoader:X==="webp"?GainMapLoader:null}const isRef=X=>X.current&&X.current.isScene,resolveScene=X=>isRef(X)?X.current:X;function setEnvProps(X,Z,_,K,te={}){var ne,oe,ie,se;te={backgroundBlurriness:0,backgroundIntensity:1,backgroundRotation:[0,0,0],environmentIntensity:1,environmentRotation:[0,0,0],...te};const ae=resolveScene(Z||_),ge=ae.background,ce=ae.environment,de={backgroundBlurriness:ae.backgroundBlurriness,backgroundIntensity:ae.backgroundIntensity,backgroundRotation:(ne=(oe=ae.backgroundRotation)==null||oe.clone==null?void 0:oe.clone())!==null&&ne!==void 0?ne:[0,0,0],environmentIntensity:ae.environmentIntensity,environmentRotation:(ie=(se=ae.environmentRotation)==null||se.clone==null?void 0:se.clone())!==null&&ie!==void 0?ie:[0,0,0]};return X!=="only"&&(ae.environment=K),X&&(ae.background=K),applyProps(ae,te),()=>{X!=="only"&&(ae.environment=ce),X&&(ae.background=ge),applyProps(ae,de)}}function EnvironmentMap({scene:X,background:Z=!1,map:_,...K}){const te=useThree(ne=>ne.scene);return reactExports.useLayoutEffect(()=>{if(_)return setEnvProps(Z,X,te,_,K)}),null}function EnvironmentCube({background:X=!1,scene:Z,blur:_,backgroundBlurriness:K,backgroundIntensity:te,backgroundRotation:ne,environmentIntensity:oe,environmentRotation:ie,...se}){const ae=useEnvironment(se),ge=useThree(ce=>ce.scene);return reactExports.useLayoutEffect(()=>setEnvProps(X,Z,ge,ae,{backgroundBlurriness:_??K,backgroundIntensity:te,backgroundRotation:ne,environmentIntensity:oe,environmentRotation:ie})),reactExports.useEffect(()=>()=>{ae.dispose()},[ae]),null}function EnvironmentPortal({children:X,near:Z=.1,far:_=1e3,resolution:K=256,frames:te=1,map:ne,background:oe=!1,blur:ie,backgroundBlurriness:se,backgroundIntensity:ae,backgroundRotation:ge,environmentIntensity:ce,environmentRotation:de,scene:pe,files:fe,path:be,preset:me=void 0,extensions:ye}){const ve=useThree(Ve=>Ve.gl),Be=useThree(Ve=>Ve.scene),Re=reactExports.useRef(null),[Ee]=reactExports.useState(()=>new Scene$1),We=reactExports.useMemo(()=>{const Ve=new WebGLCubeRenderTarget(K);return Ve.texture.type=HalfFloatType,Ve},[K]);reactExports.useEffect(()=>()=>{We.dispose()},[We]),reactExports.useLayoutEffect(()=>{if(te===1){const Ve=ve.autoClear;ve.autoClear=!0,Re.current.update(ve,Ee),ve.autoClear=Ve}return setEnvProps(oe,pe,Be,We.texture,{backgroundBlurriness:ie??se,backgroundIntensity:ae,backgroundRotation:ge,environmentIntensity:ce,environmentRotation:de})},[X,Ee,We.texture,pe,Be,oe,te,ve]);let Ze=1;return useFrame(()=>{if(te===1/0||Ze<te){const Ve=ve.autoClear;ve.autoClear=!0,Re.current.update(ve,Ee),ve.autoClear=Ve,Ze++}}),reactExports.createElement(reactExports.Fragment,null,createPortal(reactExports.createElement(reactExports.Fragment,null,X,reactExports.createElement("cubeCamera",{ref:Re,args:[Z,_,We]}),fe||me?reactExports.createElement(EnvironmentCube,{background:!0,files:fe,preset:me,path:be,extensions:ye}):ne?reactExports.createElement(EnvironmentMap,{background:!0,map:ne,extensions:ye}):null),Ee))}function EnvironmentGround(X){var Z,_,K,te;const ne=useEnvironment(X),oe=X.map||ne;reactExports.useMemo(()=>extend({GroundProjectedEnvImpl:GroundProjectedEnv}),[]),reactExports.useEffect(()=>()=>{ne.dispose()},[ne]);const ie=reactExports.useMemo(()=>[oe],[oe]),se=(Z=X.ground)==null?void 0:Z.height,ae=(_=X.ground)==null?void 0:_.radius,ge=(K=(te=X.ground)==null?void 0:te.scale)!==null&&K!==void 0?K:1e3;return reactExports.createElement(reactExports.Fragment,null,reactExports.createElement(EnvironmentMap,_extends$2({},X,{map:oe})),reactExports.createElement("groundProjectedEnvImpl",{args:ie,scale:ge,height:se,radius:ae}))}function Environment(X){return X.ground?reactExports.createElement(EnvironmentGround,X):X.map?reactExports.createElement(EnvironmentMap,X):X.children?reactExports.createElement(EnvironmentPortal,X):reactExports.createElement(EnvironmentCube,X)}var reactDomExports=requireReactDom();const $7SXl2$reactdom=getDefaultExportFromCjs(reactDomExports);function $6ed0406888f73fc4$var$setRef(X,Z){typeof X=="function"?X(Z):X!=null&&(X.current=Z)}function $6ed0406888f73fc4$export$43e446d32b3d21af(...X){return Z=>X.forEach(_=>$6ed0406888f73fc4$var$setRef(_,Z))}function $6ed0406888f73fc4$export$c7b2cbe3552a0d05(...X){return reactExports.useCallback($6ed0406888f73fc4$export$43e446d32b3d21af(...X),X)}const $5e63c961fc1ce211$export$8c6ed5c666ac1360=reactExports.forwardRef((X,Z)=>{const{children:_,...K}=X,te=reactExports.Children.toArray(_),ne=te.find($5e63c961fc1ce211$var$isSlottable);if(ne){const oe=ne.props.children,ie=te.map(se=>se===ne?reactExports.Children.count(oe)>1?reactExports.Children.only(null):reactExports.isValidElement(oe)?oe.props.children:null:se);return reactExports.createElement($5e63c961fc1ce211$var$SlotClone,_extends$2({},K,{ref:Z}),reactExports.isValidElement(oe)?reactExports.cloneElement(oe,void 0,ie):null)}return reactExports.createElement($5e63c961fc1ce211$var$SlotClone,_extends$2({},K,{ref:Z}),_)});$5e63c961fc1ce211$export$8c6ed5c666ac1360.displayName="Slot";const $5e63c961fc1ce211$var$SlotClone=reactExports.forwardRef((X,Z)=>{const{children:_,...K}=X;return reactExports.isValidElement(_)?reactExports.cloneElement(_,{...$5e63c961fc1ce211$var$mergeProps(K,_.props),ref:$6ed0406888f73fc4$export$43e446d32b3d21af(Z,_.ref)}):reactExports.Children.count(_)>1?reactExports.Children.only(null):null});$5e63c961fc1ce211$var$SlotClone.displayName="SlotClone";const $5e63c961fc1ce211$export$d9f1ccf0bdb05d45=({children:X})=>reactExports.createElement(reactExports.Fragment,null,X);function $5e63c961fc1ce211$var$isSlottable(X){return reactExports.isValidElement(X)&&X.type===$5e63c961fc1ce211$export$d9f1ccf0bdb05d45}function $5e63c961fc1ce211$var$mergeProps(X,Z){const _={...Z};for(const K in Z){const te=X[K],ne=Z[K];/^on[A-Z]/.test(K)?te&&ne?_[K]=(...ie)=>{ne(...ie),te(...ie)}:te&&(_[K]=te):K==="style"?_[K]={...te,...ne}:K==="className"&&(_[K]=[te,ne].filter(Boolean).join(" "))}return{...X,..._}}const $8927f6f2acc4f386$var$NODES=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","span","svg","ul"],$8927f6f2acc4f386$export$250ffa63cdc0d034=$8927f6f2acc4f386$var$NODES.reduce((X,Z)=>{const _=reactExports.forwardRef((K,te)=>{const{asChild:ne,...oe}=K,ie=ne?$5e63c961fc1ce211$export$8c6ed5c666ac1360:Z;return reactExports.useEffect(()=>{window[Symbol.for("radix-ui")]=!0},[]),reactExports.createElement(ie,_extends$2({},oe,{ref:te}))});return _.displayName=`Primitive.${Z}`,{...X,[Z]:_}},{});function $8927f6f2acc4f386$export$6d1a0317bde7de7f(X,Z){X&&reactDomExports.flushSync(()=>X.dispatchEvent(Z))}const $f1701beae083dbae$export$602eac185826482c=reactExports.forwardRef((X,Z)=>{var _;const{container:K=globalThis==null||(_=globalThis.document)===null||_===void 0?void 0:_.body,...te}=X;return K?$7SXl2$reactdom.createPortal(reactExports.createElement($8927f6f2acc4f386$export$250ffa63cdc0d034.div,_extends$2({},te,{ref:Z})),K):null}),$f1701beae083dbae$export$be92b6f5f03c0fe9=$f1701beae083dbae$export$602eac185826482c;var has=Object.prototype.hasOwnProperty;function dequal(X,Z){var _,K;if(X===Z)return!0;if(X&&Z&&(_=X.constructor)===Z.constructor){if(_===Date)return X.getTime()===Z.getTime();if(_===RegExp)return X.toString()===Z.toString();if(_===Array){if((K=X.length)===Z.length)for(;K--&&dequal(X[K],Z[K]););return K===-1}if(!_||typeof X=="object"){K=0;for(_ in X)if(has.call(X,_)&&++K&&!has.call(Z,_)||!(_ in Z)||!dequal(X[_],Z[_]))return!1;return Object.keys(Z).length===K}}return X!==X&&Z!==Z}function shallow(X,Z){if(Object.is(X,Z))return!0;if(typeof X!="object"||X===null||typeof Z!="object"||Z===null)return!1;const _=Object.keys(X);if(_.length!==Object.keys(Z).length)return!1;for(let K=0;K<_.length;K++)if(!Object.prototype.hasOwnProperty.call(Z,_[K])||!Object.is(X[_[K]],Z[_[K]]))return!1;return!0}var Rule=function(Z,_,K,te){this.name=Z,this.fn=_,this.args=K,this.modifiers=te};Rule.prototype._test=function(Z){var _=this.fn;try{testAux(this.modifiers.slice(),_,this)(Z)}catch{_=function(){return!1}}try{return testAux(this.modifiers.slice(),_,this)(Z)}catch{return!1}};Rule.prototype._check=function(Z){try{testAux(this.modifiers.slice(),this.fn,this)(Z)}catch{if(testAux(this.modifiers.slice(),function(K){return K},this)(!1))return}if(!testAux(this.modifiers.slice(),this.fn,this)(Z))throw null};Rule.prototype._testAsync=function(Z){var _=this;return new Promise(function(K,te){testAsyncAux(_.modifiers.slice(),_.fn,_)(Z).then(function(ne){ne?K(Z):te(null)}).catch(function(ne){return te(ne)})})};function pickFn(X,Z){return Z===void 0&&(Z="simple"),typeof X=="object"?X[Z]:X}function testAux(X,Z,_){if(X.length){var K=X.shift(),te=testAux(X,Z,_);return K.perform(te,_)}else return pickFn(Z)}function testAsyncAux(X,Z,_){if(X.length){var K=X.shift(),te=testAsyncAux(X,Z,_);return K.performAsync(te,_)}else return function(ne){return Promise.resolve(pickFn(Z,"async")(ne))}}var Modifier=function(Z,_,K){this.name=Z,this.perform=_,this.performAsync=K},ValidationError=function(X){function Z(_,K,te,ne){for(var oe=[],ie=arguments.length-4;ie-- >0;)oe[ie]=arguments[ie+4];X.call(this,oe),X.captureStackTrace&&X.captureStackTrace(this,Z),this.rule=_,this.value=K,this.cause=te,this.target=ne}return X&&(Z.__proto__=X),Z.prototype=Object.create(X&&X.prototype),Z.prototype.constructor=Z,Z}(Error),Context=function(Z,_){Z===void 0&&(Z=[]),_===void 0&&(_=[]),this.chain=Z,this.nextRuleModifiers=_};Context.prototype._applyRule=function(Z,_){var K=this;return function(){for(var te=[],ne=arguments.length;ne--;)te[ne]=arguments[ne];return K.chain.push(new Rule(_,Z.apply(K,te),te,K.nextRuleModifiers)),K.nextRuleModifiers=[],K}};Context.prototype._applyModifier=function(Z,_){return this.nextRuleModifiers.push(new Modifier(_,Z.simple,Z.async)),this};Context.prototype._clone=function(){return new Context(this.chain.slice(),this.nextRuleModifiers.slice())};Context.prototype.test=function(Z){return this.chain.every(function(_){return _._test(Z)})};Context.prototype.testAll=function(Z){var _=[];return this.chain.forEach(function(K){try{K._check(Z)}catch(te){_.push(new ValidationError(K,Z,te))}}),_};Context.prototype.check=function(Z){this.chain.forEach(function(_){try{_._check(Z)}catch(K){throw new ValidationError(_,Z,K)}})};Context.prototype.testAsync=function(Z){var _=this;return new Promise(function(K,te){executeAsyncRules(Z,_.chain.slice(),K,te)})};function executeAsyncRules(X,Z,_,K){if(Z.length){var te=Z.shift();te._testAsync(X).then(function(){executeAsyncRules(X,Z,_,K)},function(ne){K(new ValidationError(te,X,ne))})}else _(X)}var consideredEmpty=function(X,Z){return Z&&typeof X=="string"&&X.trim().length===0?!0:X==null};function optional(X,Z){return Z===void 0&&(Z=!1),{simple:function(_){return consideredEmpty(_,Z)||X.check(_)===void 0},async:function(_){return consideredEmpty(_,Z)||X.testAsync(_)}}}function v8n(){return typeof Proxy<"u"?proxyContext(new Context):proxylessContext(new Context)}var customRules={};v8n.extend=function(X){Object.assign(customRules,X)};v8n.clearCustomRules=function(){customRules={}};function proxyContext(X){return new Proxy(X,{get:function(_,K){if(K in _)return _[K];var te=proxyContext(X._clone());if(K in availableModifiers)return te._applyModifier(availableModifiers[K],K);if(K in customRules)return te._applyRule(customRules[K],K);if(K in availableRules)return te._applyRule(availableRules[K],K)}})}function proxylessContext(X){var Z=function(te,ne){return Object.keys(te).forEach(function(oe){ne[oe]=function(){for(var ie=[],se=arguments.length;se--;)ie[se]=arguments[se];var ae=proxylessContext(ne._clone()),ge=ae._applyRule(te[oe],oe).apply(void 0,ie);return ge}}),ne},_=Z(availableRules,X),K=Z(customRules,_);return Object.keys(availableModifiers).forEach(function(te){Object.defineProperty(K,te,{get:function(){var ne=proxylessContext(K._clone());return ne._applyModifier(availableModifiers[te],te)}})}),K}var availableModifiers={not:{simple:function(X){return function(Z){return!X(Z)}},async:function(X){return function(Z){return Promise.resolve(X(Z)).then(function(_){return!_}).catch(function(){return!0})}}},some:{simple:function(X){return function(Z){return split(Z).some(function(_){try{return X(_)}catch{return!1}})}},async:function(X){return function(Z){return Promise.all(split(Z).map(function(_){try{return X(_).catch(function(){return!1})}catch{return!1}})).then(function(_){return _.some(Boolean)})}}},every:{simple:function(X){return function(Z){return Z!==!1&&split(Z).every(X)}},async:function(X){return function(Z){return Promise.all(split(Z).map(X)).then(function(_){return _.every(Boolean)})}}},strict:{simple:function(X,Z){return function(_){return isSchemaRule(Z)&&_&&typeof _=="object"?Object.keys(Z.args[0]).length===Object.keys(_).length&&X(_):X(_)}},async:function(X,Z){return function(_){return Promise.resolve(X(_)).then(function(K){return isSchemaRule(Z)&&_&&typeof _=="object"?Object.keys(Z.args[0]).length===Object.keys(_).length&&K:K}).catch(function(){return!1})}}}};function isSchemaRule(X){return X&&X.name==="schema"&&X.args.length>0&&typeof X.args[0]=="object"}function split(X){return typeof X=="string"?X.split(""):X}var availableRules={equal:function(X){return function(Z){return Z==X}},exact:function(X){return function(Z){return Z===X}},number:function(X){return X===void 0&&(X=!0),function(Z){return typeof Z=="number"&&(X||isFinite(Z))}},integer:function(){return function(X){var Z=Number.isInteger||isIntegerPolyfill;return Z(X)}},numeric:function(){return function(X){return!isNaN(parseFloat(X))&&isFinite(X)}},string:function(){return testType("string")},boolean:function(){return testType("boolean")},undefined:function(){return testType("undefined")},null:function(){return testType("null")},array:function(){return testType("array")},object:function(){return testType("object")},instanceOf:function(X){return function(Z){return Z instanceof X}},pattern:function(X){return function(Z){return X.test(Z)}},lowercase:function(){return function(X){return typeof X=="boolean"||X===X.toLowerCase()&&X.trim()!==""}},uppercase:function(){return function(X){return X===X.toUpperCase()&&X.trim()!==""}},vowel:function(){return function(X){return/^[aeiou]+$/i.test(X)}},consonant:function(){return function(X){return/^(?=[^aeiou])([a-z]+)$/i.test(X)}},first:function(X){return function(Z){return Z[0]==X}},last:function(X){return function(Z){return Z[Z.length-1]==X}},empty:function(){return function(X){return X.length===0}},length:function(X,Z){return function(_){return _.length>=X&&_.length<=(Z||X)}},minLength:function(X){return function(Z){return Z.length>=X}},maxLength:function(X){return function(Z){return Z.length<=X}},negative:function(){return function(X){return X<0}},positive:function(){return function(X){return X>=0}},between:function(X,Z){return function(_){return _>=X&&_<=Z}},range:function(X,Z){return function(_){return _>=X&&_<=Z}},lessThan:function(X){return function(Z){return Z<X}},lessThanOrEqual:function(X){return function(Z){return Z<=X}},greaterThan:function(X){return function(Z){return Z>X}},greaterThanOrEqual:function(X){return function(Z){return Z>=X}},even:function(){return function(X){return X%2===0}},odd:function(){return function(X){return X%2!==0}},includes:function(X){return function(Z){return~Z.indexOf(X)}},schema:function(X){return testSchema(X)},passesAnyOf:function(){for(var X=[],Z=arguments.length;Z--;)X[Z]=arguments[Z];return function(_){return X.some(function(K){return K.test(_)})}},optional};function testType(X){return function(Z){return Array.isArray(Z)&&X==="array"||Z===null&&X==="null"||typeof Z===X}}function isIntegerPolyfill(X){return typeof X=="number"&&isFinite(X)&&Math.floor(X)===X}function testSchema(X){return{simple:function(Z){var _=[];if(Object.keys(X).forEach(function(K){var te=X[K];try{te.check((Z||{})[K])}catch(ne){ne.target=K,_.push(ne)}}),_.length>0)throw _;return!0},async:function(Z){var _=[],K=Object.keys(X).map(function(te){var ne=X[te];return ne.testAsync((Z||{})[te]).catch(function(oe){oe.target=te,_.push(oe)})});return Promise.all(K).then(function(){if(_.length>0)throw _;return!0})}}}var e$3="colors",t$2="sizes",r$4="space",n$3={gap:r$4,gridGap:r$4,columnGap:r$4,gridColumnGap:r$4,rowGap:r$4,gridRowGap:r$4,inset:r$4,insetBlock:r$4,insetBlockEnd:r$4,insetBlockStart:r$4,insetInline:r$4,insetInlineEnd:r$4,insetInlineStart:r$4,margin:r$4,marginTop:r$4,marginRight:r$4,marginBottom:r$4,marginLeft:r$4,marginBlock:r$4,marginBlockEnd:r$4,marginBlockStart:r$4,marginInline:r$4,marginInlineEnd:r$4,marginInlineStart:r$4,padding:r$4,paddingTop:r$4,paddingRight:r$4,paddingBottom:r$4,paddingLeft:r$4,paddingBlock:r$4,paddingBlockEnd:r$4,paddingBlockStart:r$4,paddingInline:r$4,paddingInlineEnd:r$4,paddingInlineStart:r$4,top:r$4,right:r$4,bottom:r$4,left:r$4,scrollMargin:r$4,scrollMarginTop:r$4,scrollMarginRight:r$4,scrollMarginBottom:r$4,scrollMarginLeft:r$4,scrollMarginX:r$4,scrollMarginY:r$4,scrollMarginBlock:r$4,scrollMarginBlockEnd:r$4,scrollMarginBlockStart:r$4,scrollMarginInline:r$4,scrollMarginInlineEnd:r$4,scrollMarginInlineStart:r$4,scrollPadding:r$4,scrollPaddingTop:r$4,scrollPaddingRight:r$4,scrollPaddingBottom:r$4,scrollPaddingLeft:r$4,scrollPaddingX:r$4,scrollPaddingY:r$4,scrollPaddingBlock:r$4,scrollPaddingBlockEnd:r$4,scrollPaddingBlockStart:r$4,scrollPaddingInline:r$4,scrollPaddingInlineEnd:r$4,scrollPaddingInlineStart:r$4,fontSize:"fontSizes",background:e$3,backgroundColor:e$3,backgroundImage:e$3,borderImage:e$3,border:e$3,borderBlock:e$3,borderBlockEnd:e$3,borderBlockStart:e$3,borderBottom:e$3,borderBottomColor:e$3,borderColor:e$3,borderInline:e$3,borderInlineEnd:e$3,borderInlineStart:e$3,borderLeft:e$3,borderLeftColor:e$3,borderRight:e$3,borderRightColor:e$3,borderTop:e$3,borderTopColor:e$3,caretColor:e$3,color:e$3,columnRuleColor:e$3,fill:e$3,outline:e$3,outlineColor:e$3,stroke:e$3,textDecorationColor:e$3,fontFamily:"fonts",fontWeight:"fontWeights",lineHeight:"lineHeights",letterSpacing:"letterSpacings",blockSize:t$2,minBlockSize:t$2,maxBlockSize:t$2,inlineSize:t$2,minInlineSize:t$2,maxInlineSize:t$2,width:t$2,minWidth:t$2,maxWidth:t$2,height:t$2,minHeight:t$2,maxHeight:t$2,flexBasis:t$2,gridTemplateColumns:t$2,gridTemplateRows:t$2,borderWidth:"borderWidths",borderTopWidth:"borderWidths",borderRightWidth:"borderWidths",borderBottomWidth:"borderWidths",borderLeftWidth:"borderWidths",borderStyle:"borderStyles",borderTopStyle:"borderStyles",borderRightStyle:"borderStyles",borderBottomStyle:"borderStyles",borderLeftStyle:"borderStyles",borderRadius:"radii",borderTopLeftRadius:"radii",borderTopRightRadius:"radii",borderBottomRightRadius:"radii",borderBottomLeftRadius:"radii",boxShadow:"shadows",textShadow:"shadows",transition:"transitions",zIndex:"zIndices"},i$4=(X,Z)=>typeof Z=="function"?{"()":Function.prototype.toString.call(Z)}:Z,o$3=()=>{const X=Object.create(null);return(Z,_,...K)=>{const te=(ne=>JSON.stringify(ne,i$4))(Z);return te in X?X[te]:X[te]=_(Z,...K)}},l$3=Symbol.for("sxs.internal"),s$5=(X,Z)=>Object.defineProperties(X,Object.getOwnPropertyDescriptors(Z)),a$5=X=>{for(const Z in X)return!0;return!1},{hasOwnProperty:c$6}=Object.prototype,d$4=X=>X.includes("-")?X:X.replace(/[A-Z]/g,Z=>"-"+Z.toLowerCase()),g$4=/\s+(?![^()]*\))/,p$4=X=>Z=>X(...typeof Z=="string"?String(Z).split(g$4):[Z]),u$4={appearance:X=>({WebkitAppearance:X,appearance:X}),backfaceVisibility:X=>({WebkitBackfaceVisibility:X,backfaceVisibility:X}),backdropFilter:X=>({WebkitBackdropFilter:X,backdropFilter:X}),backgroundClip:X=>({WebkitBackgroundClip:X,backgroundClip:X}),boxDecorationBreak:X=>({WebkitBoxDecorationBreak:X,boxDecorationBreak:X}),clipPath:X=>({WebkitClipPath:X,clipPath:X}),content:X=>({content:X.includes('"')||X.includes("'")||/^([A-Za-z]+\([^]*|[^]*-quote|inherit|initial|none|normal|revert|unset)$/.test(X)?X:`"${X}"`}),hyphens:X=>({WebkitHyphens:X,hyphens:X}),maskImage:X=>({WebkitMaskImage:X,maskImage:X}),maskSize:X=>({WebkitMaskSize:X,maskSize:X}),tabSize:X=>({MozTabSize:X,tabSize:X}),textSizeAdjust:X=>({WebkitTextSizeAdjust:X,textSizeAdjust:X}),userSelect:X=>({WebkitUserSelect:X,userSelect:X}),marginBlock:p$4((X,Z)=>({marginBlockStart:X,marginBlockEnd:Z||X})),marginInline:p$4((X,Z)=>({marginInlineStart:X,marginInlineEnd:Z||X})),maxSize:p$4((X,Z)=>({maxBlockSize:X,maxInlineSize:Z||X})),minSize:p$4((X,Z)=>({minBlockSize:X,minInlineSize:Z||X})),paddingBlock:p$4((X,Z)=>({paddingBlockStart:X,paddingBlockEnd:Z||X})),paddingInline:p$4((X,Z)=>({paddingInlineStart:X,paddingInlineEnd:Z||X}))},h$4=/([\d.]+)([^]*)/,f$4=(X,Z)=>X.length?X.reduce((_,K)=>(_.push(...Z.map(te=>te.includes("&")?te.replace(/&/g,/[ +>|~]/.test(K)&&/&.*&/.test(te)?`:is(${K})`:K):K+" "+te)),_),[]):Z,m$5=(X,Z)=>X in b$6&&typeof Z=="string"?Z.replace(/^((?:[^]*[^\w-])?)(fit-content|stretch)((?:[^\w-][^]*)?)$/,(_,K,te,ne)=>K+(te==="stretch"?`-moz-available${ne};${d$4(X)}:${K}-webkit-fill-available`:`-moz-fit-content${ne};${d$4(X)}:${K}fit-content`)+ne):String(Z),b$6={blockSize:1,height:1,inlineSize:1,maxBlockSize:1,maxHeight:1,maxInlineSize:1,maxWidth:1,minBlockSize:1,minHeight:1,minInlineSize:1,minWidth:1,width:1},S$3=X=>X?X+"-":"",k$3=(X,Z,_)=>X.replace(/([+-])?((?:\d+(?:\.\d*)?|\.\d+)(?:[Ee][+-]?\d+)?)?(\$|--)([$\w-]+)/g,(K,te,ne,oe,ie)=>oe=="$"==!!ne?K:(te||oe=="--"?"calc(":"")+"var(--"+(oe==="$"?S$3(Z)+(ie.includes("$")?"":S$3(_))+ie.replace(/\$/g,"-"):ie)+")"+(te||oe=="--"?"*"+(te||"")+(ne||"1")+")":"")),y$4=/\s*,\s*(?![^()]*\))/,B=Object.prototype.toString,$$2=(X,Z,_,K,te)=>{let ne,oe,ie;const se=(ae,ge,ce)=>{let de,pe;const fe=be=>{for(de in be){const ve=de.charCodeAt(0)===64,Be=ve&&Array.isArray(be[de])?be[de]:[be[de]];for(pe of Be){const Re=/[A-Z]/.test(ye=de)?ye:ye.replace(/-[^]/g,We=>We[1].toUpperCase()),Ee=typeof pe=="object"&&pe&&pe.toString===B&&(!K.utils[Re]||!ge.length);if(Re in K.utils&&!Ee){const We=K.utils[Re];if(We!==oe){oe=We,fe(We(pe)),oe=null;continue}}else if(Re in u$4){const We=u$4[Re];if(We!==ie){ie=We,fe(We(pe)),ie=null;continue}}if(ve&&(me=de.slice(1)in K.media?"@media "+K.media[de.slice(1)]:de,de=me.replace(/\(\s*([\w-]+)\s*(=|<|<=|>|>=)\s*([\w-]+)\s*(?:(<|<=|>|>=)\s*([\w-]+)\s*)?\)/g,(We,Ze,Ve,_e,Xe,Pe)=>{const He=h$4.test(Ze),Ke=.0625*(He?-1:1),[Ue,tt]=He?[_e,Ze]:[Ze,_e];return"("+(Ve[0]==="="?"":Ve[0]===">"===He?"max-":"min-")+Ue+":"+(Ve[0]!=="="&&Ve.length===1?tt.replace(h$4,(rt,at,Oe)=>Number(at)+Ke*(Ve===">"?1:-1)+Oe):tt)+(Xe?") and ("+(Xe[0]===">"?"min-":"max-")+Ue+":"+(Xe.length===1?Pe.replace(h$4,(rt,at,Oe)=>Number(at)+Ke*(Xe===">"?-1:1)+Oe):Pe):"")+")"})),Ee){const We=ve?ce.concat(de):[...ce],Ze=ve?[...ge]:f$4(ge,de.split(y$4));ne!==void 0&&te(x$3(...ne)),ne=void 0,se(pe,Ze,We)}else ne===void 0&&(ne=[[],ge,ce]),de=ve||de.charCodeAt(0)!==36?de:`--${S$3(K.prefix)}${de.slice(1).replace(/\$/g,"-")}`,pe=Ee?pe:typeof pe=="number"?pe&&Re in I$2?String(pe)+"px":String(pe):k$3(m$5(Re,pe??""),K.prefix,K.themeMap[Re]),ne[0].push(`${ve?`${de} `:`${d$4(de)}:`}${pe}`)}}var me,ye};fe(ae),ne!==void 0&&te(x$3(...ne)),ne=void 0};se(X,Z,_)},x$3=(X,Z,_)=>`${_.map(K=>`${K}{`).join("")}${Z.length?`${Z.join(",")}{`:""}${X.join(";")}${Z.length?"}":""}${Array(_.length?_.length+1:0).join("}")}`,I$2={animationDelay:1,animationDuration:1,backgroundSize:1,blockSize:1,border:1,borderBlock:1,borderBlockEnd:1,borderBlockEndWidth:1,borderBlockStart:1,borderBlockStartWidth:1,borderBlockWidth:1,borderBottom:1,borderBottomLeftRadius:1,borderBottomRightRadius:1,borderBottomWidth:1,borderEndEndRadius:1,borderEndStartRadius:1,borderInlineEnd:1,borderInlineEndWidth:1,borderInlineStart:1,borderInlineStartWidth:1,borderInlineWidth:1,borderLeft:1,borderLeftWidth:1,borderRadius:1,borderRight:1,borderRightWidth:1,borderSpacing:1,borderStartEndRadius:1,borderStartStartRadius:1,borderTop:1,borderTopLeftRadius:1,borderTopRightRadius:1,borderTopWidth:1,borderWidth:1,bottom:1,columnGap:1,columnRule:1,columnRuleWidth:1,columnWidth:1,containIntrinsicSize:1,flexBasis:1,fontSize:1,gap:1,gridAutoColumns:1,gridAutoRows:1,gridTemplateColumns:1,gridTemplateRows:1,height:1,inlineSize:1,inset:1,insetBlock:1,insetBlockEnd:1,insetBlockStart:1,insetInline:1,insetInlineEnd:1,insetInlineStart:1,left:1,letterSpacing:1,margin:1,marginBlock:1,marginBlockEnd:1,marginBlockStart:1,marginBottom:1,marginInline:1,marginInlineEnd:1,marginInlineStart:1,marginLeft:1,marginRight:1,marginTop:1,maxBlockSize:1,maxHeight:1,maxInlineSize:1,maxWidth:1,minBlockSize:1,minHeight:1,minInlineSize:1,minWidth:1,offsetDistance:1,offsetRotate:1,outline:1,outlineOffset:1,outlineWidth:1,overflowClipMargin:1,padding:1,paddingBlock:1,paddingBlockEnd:1,paddingBlockStart:1,paddingBottom:1,paddingInline:1,paddingInlineEnd:1,paddingInlineStart:1,paddingLeft:1,paddingRight:1,paddingTop:1,perspective:1,right:1,rowGap:1,scrollMargin:1,scrollMarginBlock:1,scrollMarginBlockEnd:1,scrollMarginBlockStart:1,scrollMarginBottom:1,scrollMarginInline:1,scrollMarginInlineEnd:1,scrollMarginInlineStart:1,scrollMarginLeft:1,scrollMarginRight:1,scrollMarginTop:1,scrollPadding:1,scrollPaddingBlock:1,scrollPaddingBlockEnd:1,scrollPaddingBlockStart:1,scrollPaddingBottom:1,scrollPaddingInline:1,scrollPaddingInlineEnd:1,scrollPaddingInlineStart:1,scrollPaddingLeft:1,scrollPaddingRight:1,scrollPaddingTop:1,shapeMargin:1,textDecoration:1,textDecorationThickness:1,textIndent:1,textUnderlineOffset:1,top:1,transitionDelay:1,transitionDuration:1,verticalAlign:1,width:1,wordSpacing:1},R$3=X=>String.fromCharCode(X+(X>25?39:97)),z$1=X=>(Z=>{let _,K="";for(_=Math.abs(Z);_>52;_=_/52|0)K=R$3(_%52)+K;return R$3(_%52)+K})(((Z,_)=>{let K=_.length;for(;K;)Z=33*Z^_.charCodeAt(--K);return Z})(5381,JSON.stringify(X))>>>0),W$1=["themed","global","styled","onevar","resonevar","allvar","inline"],j$1=X=>{if(X.href&&!X.href.startsWith(location.origin))return!1;try{return!!X.cssRules}catch{return!1}},E$1=X=>{let Z;const _=()=>{const{cssRules:te}=Z.sheet;return[].map.call(te,(ne,oe)=>{const{cssText:ie}=ne;let se="";if(ie.startsWith("--sxs"))return"";if(te[oe-1]&&(se=te[oe-1].cssText).startsWith("--sxs")){if(!ne.cssRules.length)return"";for(const ae in Z.rules)if(Z.rules[ae].group===ne)return`--sxs{--sxs:${[...Z.rules[ae].cache].join(" ")}}${ie}`;return ne.cssRules.length?`${se}${ie}`:""}return ie}).join("")},K=()=>{if(Z){const{rules:ie,sheet:se}=Z;if(!se.deleteRule){for(;Object(Object(se.cssRules)[0]).type===3;)se.cssRules.splice(0,1);se.cssRules=[]}for(const ae in ie)delete ie[ae]}const te=Object(X).styleSheets||[];for(const ie of te)if(j$1(ie)){for(let se=0,ae=ie.cssRules;ae[se];++se){const ge=Object(ae[se]);if(ge.type!==1)continue;const ce=Object(ae[se+1]);if(ce.type!==4)continue;++se;const{cssText:de}=ge;if(!de.startsWith("--sxs"))continue;const pe=de.slice(14,-3).trim().split(/\s+/),fe=W$1[pe[0]];fe&&(Z||(Z={sheet:ie,reset:K,rules:{},toString:_}),Z.rules[fe]={group:ce,index:se,cache:new Set(pe)})}if(Z)break}if(!Z){const ie=(se,ae)=>({type:ae,cssRules:[],insertRule(ge,ce){this.cssRules.splice(ce,0,ie(ge,{import:3,undefined:1}[(ge.toLowerCase().match(/^@([a-z]+)/)||[])[1]]||4))},get cssText(){return se==="@media{}"?`@media{${[].map.call(this.cssRules,ge=>ge.cssText).join("")}}`:se}});Z={sheet:X?(X.head||X).appendChild(document.createElement("style")).sheet:ie("","text/css"),rules:{},reset:K,toString:_}}const{sheet:ne,rules:oe}=Z;for(let ie=W$1.length-1;ie>=0;--ie){const se=W$1[ie];if(!oe[se]){const ae=W$1[ie+1],ge=oe[ae]?oe[ae].index:ne.cssRules.length;ne.insertRule("@media{}",ge),ne.insertRule(`--sxs{--sxs:${ie}}`,ge),oe[se]={group:ne.cssRules[ge+1],index:ge,cache:new Set([ie])}}v$4(oe[se])}};return K(),Z},v$4=X=>{const Z=X.group;let _=Z.cssRules.length;X.apply=K=>{try{Z.insertRule(K,_),++_}catch{}}},T$3=Symbol(),w$2=o$3(),M$1=(X,Z)=>w$2(X,()=>(..._)=>{let K={type:null,composers:new Set};for(const te of _)if(te!=null)if(te[l$3]){K.type==null&&(K.type=te[l$3].type);for(const ne of te[l$3].composers)K.composers.add(ne)}else te.constructor!==Object||te.$$typeof?K.type==null&&(K.type=te):K.composers.add(C$1(te,X));return K.type==null&&(K.type="span"),K.composers.size||K.composers.add(["PJLV",{},[],[],{},[]]),P$1(X,K,Z)}),C$1=({variants:X,compoundVariants:Z,defaultVariants:_,...K},te)=>{const ne=`${S$3(te.prefix)}c-${z$1(K)}`,oe=[],ie=[],se=Object.create(null),ae=[];for(const de in _)se[de]=String(_[de]);if(typeof X=="object"&&X)for(const de in X){ge=se,ce=de,c$6.call(ge,ce)||(se[de]="undefined");const pe=X[de];for(const fe in pe){const be={[de]:String(fe)};String(fe)==="undefined"&&ae.push(de);const me=pe[fe],ye=[be,me,!a$5(me)];oe.push(ye)}}var ge,ce;if(typeof Z=="object"&&Z)for(const de of Z){let{css:pe,...fe}=de;pe=typeof pe=="object"&&pe||{};for(const me in fe)fe[me]=String(fe[me]);const be=[fe,pe,!a$5(pe)];ie.push(be)}return[ne,K,oe,ie,se,ae]},P$1=(X,Z,_)=>{const[K,te,ne,oe]=L$3(Z.composers),ie=typeof Z.type=="function"||Z.type.$$typeof?(ce=>{function de(){for(let pe=0;pe<de[T$3].length;pe++){const[fe,be]=de[T$3][pe];ce.rules[fe].apply(be)}return de[T$3]=[],null}return de[T$3]=[],de.rules={},W$1.forEach(pe=>de.rules[pe]={apply:fe=>de[T$3].push([pe,fe])}),de})(_):null,se=(ie||_).rules,ae=`.${K}${te.length>1?`:where(.${te.slice(1).join(".")})`:""}`,ge=ce=>{ce=typeof ce=="object"&&ce||A$1;const{css:de,...pe}=ce,fe={};for(const ye in ne)if(delete pe[ye],ye in ce){let ve=ce[ye];typeof ve=="object"&&ve?fe[ye]={"@initial":ne[ye],...ve}:(ve=String(ve),fe[ye]=ve!=="undefined"||oe.has(ye)?ve:ne[ye])}else fe[ye]=ne[ye];const be=new Set([...te]);for(const[ye,ve,Be,Re]of Z.composers){_.rules.styled.cache.has(ye)||(_.rules.styled.cache.add(ye),$$2(ve,[`.${ye}`],[],X,Ze=>{se.styled.apply(Ze)}));const Ee=O$1(Be,fe,X.media),We=O$1(Re,fe,X.media,!0);for(const Ze of Ee)if(Ze!==void 0)for(const[Ve,_e,Xe]of Ze){const Pe=`${ye}-${z$1(_e)}-${Ve}`;be.add(Pe);const He=(Xe?_.rules.resonevar:_.rules.onevar).cache,Ke=Xe?se.resonevar:se.onevar;He.has(Pe)||(He.add(Pe),$$2(_e,[`.${Pe}`],[],X,Ue=>{Ke.apply(Ue)}))}for(const Ze of We)if(Ze!==void 0)for(const[Ve,_e]of Ze){const Xe=`${ye}-${z$1(_e)}-${Ve}`;be.add(Xe),_.rules.allvar.cache.has(Xe)||(_.rules.allvar.cache.add(Xe),$$2(_e,[`.${Xe}`],[],X,Pe=>{se.allvar.apply(Pe)}))}}if(typeof de=="object"&&de){const ye=`${K}-i${z$1(de)}-css`;be.add(ye),_.rules.inline.cache.has(ye)||(_.rules.inline.cache.add(ye),$$2(de,[`.${ye}`],[],X,ve=>{se.inline.apply(ve)}))}for(const ye of String(ce.className||"").trim().split(/\s+/))ye&&be.add(ye);const me=pe.className=[...be].join(" ");return{type:Z.type,className:me,selector:ae,props:pe,toString:()=>me,deferredInjector:ie}};return s$5(ge,{className:K,selector:ae,[l$3]:Z,toString:()=>(_.rules.styled.cache.has(K)||ge(),K)})},L$3=X=>{let Z="";const _=[],K={},te=[];for(const[ne,,,,oe,ie]of X){Z===""&&(Z=ne),_.push(ne),te.push(...ie);for(const se in oe){const ae=oe[se];(K[se]===void 0||ae!=="undefined"||ie.includes(ae))&&(K[se]=ae)}}return[Z,_,K,new Set(te)]},O$1=(X,Z,_,K)=>{const te=[];e:for(let[ne,oe,ie]of X){if(ie)continue;let se,ae=0,ge=!1;for(se in ne){const ce=ne[se];let de=Z[se];if(de!==ce){if(typeof de!="object"||!de)continue e;{let pe,fe,be=0;for(const me in de){if(ce===String(de[me])){if(me!=="@initial"){const ye=me.slice(1);(fe=fe||[]).push(ye in _?_[ye]:me.replace(/^@media ?/,"")),ge=!0}ae+=be,pe=!0}++be}if(fe&&fe.length&&(oe={["@media "+fe.join(", ")]:oe}),!pe)continue e}}}(te[ae]=te[ae]||[]).push([K?"cv":`${se}-${ne[se]}`,oe,ge])}return te},A$1={},N$2=o$3(),D$2=(X,Z)=>N$2(X,()=>(..._)=>{const K=()=>{for(let te of _){te=typeof te=="object"&&te||{};let ne=z$1(te);if(!Z.rules.global.cache.has(ne)){if(Z.rules.global.cache.add(ne),"@import"in te){let oe=[].indexOf.call(Z.sheet.cssRules,Z.rules.themed.group)-1;for(let ie of[].concat(te["@import"]))ie=ie.includes('"')||ie.includes("'")?ie:`"${ie}"`,Z.sheet.insertRule(`@import ${ie};`,oe++);delete te["@import"]}$$2(te,[],[],X,oe=>{Z.rules.global.apply(oe)})}}return""};return s$5(K,{toString:K})}),H$2=o$3(),V$1=(X,Z)=>H$2(X,()=>_=>{const K=`${S$3(X.prefix)}k-${z$1(_)}`,te=()=>{if(!Z.rules.global.cache.has(K)){Z.rules.global.cache.add(K);const ne=[];$$2(_,[],[],X,ie=>ne.push(ie));const oe=`@keyframes ${K}{${ne.join("")}}`;Z.rules.global.apply(oe)}return K};return s$5(te,{get name(){return te()},toString:te})}),G=class{constructor(X,Z,_,K){this.token=X==null?"":String(X),this.value=Z==null?"":String(Z),this.scale=_==null?"":String(_),this.prefix=K==null?"":String(K)}get computedValue(){return"var("+this.variable+")"}get variable(){return"--"+S$3(this.prefix)+S$3(this.scale)+this.token}toString(){return this.computedValue}},F$1=o$3(),J$1=(X,Z)=>F$1(X,()=>(_,K)=>{K=typeof _=="object"&&_||Object(K);const te=`.${_=(_=typeof _=="string"?_:"")||`${S$3(X.prefix)}t-${z$1(K)}`}`,ne={},oe=[];for(const se in K){ne[se]={};for(const ae in K[se]){const ge=`--${S$3(X.prefix)}${se}-${ae}`,ce=k$3(String(K[se][ae]),X.prefix,se);ne[se][ae]=new G(ae,ce,se,X.prefix),oe.push(`${ge}:${ce}`)}}const ie=()=>{if(oe.length&&!Z.rules.themed.cache.has(_)){Z.rules.themed.cache.add(_);const se=`${K===X.theme?":root,":""}.${_}{${oe.join(";")}}`;Z.rules.themed.apply(se)}return _};return{...ne,get className(){return ie()},selector:te,toString:ie}}),U$1=o$3(),Y$1=o$3(),q$3=X=>{const Z=(_=>{let K=!1;const te=U$1(_,ne=>{K=!0;const oe="prefix"in(ne=typeof ne=="object"&&ne||{})?String(ne.prefix):"",ie=typeof ne.media=="object"&&ne.media||{},se=typeof ne.root=="object"?ne.root||null:globalThis.document||null,ae=typeof ne.theme=="object"&&ne.theme||{},ge={prefix:oe,media:ie,theme:ae,themeMap:typeof ne.themeMap=="object"&&ne.themeMap||{...n$3},utils:typeof ne.utils=="object"&&ne.utils||{}},ce=E$1(se),de={css:M$1(ge,ce),globalCss:D$2(ge,ce),keyframes:V$1(ge,ce),createTheme:J$1(ge,ce),reset(){ce.reset(),de.theme.toString()},theme:{},sheet:ce,config:ge,prefix:oe,getCssText:ce.toString,toString:ce.toString};return String(de.theme=de.createTheme(ae)),de});return K||te.reset(),te})(X);return Z.styled=(({config:_,sheet:K})=>Y$1(_,()=>{const te=M$1(_,K);return(...ne)=>{const oe=te(...ne),ie=oe[l$3].type,se=React.forwardRef((ae,ge)=>{const ce=ae&&ae.as||ie,{props:de,deferredInjector:pe}=oe(ae);return delete de.as,de.ref=ge,pe?React.createElement(React.Fragment,null,React.createElement(ce,de),React.createElement(pe,null)):React.createElement(ce,de)});return se.className=oe.className,se.displayName=`Styled.${ie.displayName||ie.name||ie}`,se.selector=oe.selector,se.toString=()=>oe.selector,se[l$3]=oe[l$3],se}}))(Z),Z};function $e42e1063c40fb3ef$export$b9ecd428b558ff10(X,Z,{checkForDefaultPrevented:_=!0}={}){return function(te){if(X==null||X(te),_===!1||!te.defaultPrevented)return Z==null?void 0:Z(te)}}function $c512c27ab02ef895$export$50c7b4e9d9f19c1(X,Z=[]){let _=[];function K(ne,oe){const ie=reactExports.createContext(oe),se=_.length;_=[..._,oe];function ae(ce){const{scope:de,children:pe,...fe}=ce,be=(de==null?void 0:de[X][se])||ie,me=reactExports.useMemo(()=>fe,Object.values(fe));return reactExports.createElement(be.Provider,{value:me},pe)}function ge(ce,de){const pe=(de==null?void 0:de[X][se])||ie,fe=reactExports.useContext(pe);if(fe)return fe;if(oe!==void 0)return oe;throw new Error(`\`${ce}\` must be used within \`${ne}\``)}return ae.displayName=ne+"Provider",[ae,ge]}const te=()=>{const ne=_.map(oe=>reactExports.createContext(oe));return function(ie){const se=(ie==null?void 0:ie[X])||ne;return reactExports.useMemo(()=>({[`__scope${X}`]:{...ie,[X]:se}}),[ie,se])}};return te.scopeName=X,[K,$c512c27ab02ef895$var$composeContextScopes(te,...Z)]}function $c512c27ab02ef895$var$composeContextScopes(...X){const Z=X[0];if(X.length===1)return Z;const _=()=>{const K=X.map(te=>({useScope:te(),scopeName:te.scopeName}));return function(ne){const oe=K.reduce((ie,{useScope:se,scopeName:ae})=>{const ce=se(ne)[`__scope${ae}`];return{...ie,...ce}},{});return reactExports.useMemo(()=>({[`__scope${Z.scopeName}`]:oe}),[oe])}};return _.scopeName=Z.scopeName,_}function $b1b2314f5f9a1d84$export$25bec8c6f54ee79a(X){const Z=reactExports.useRef(X);return reactExports.useEffect(()=>{Z.current=X}),reactExports.useMemo(()=>(..._)=>{var K;return(K=Z.current)===null||K===void 0?void 0:K.call(Z,..._)},[])}function $addc16e1bbe58fd0$export$3a72a57244d6e765(X,Z=globalThis==null?void 0:globalThis.document){const _=$b1b2314f5f9a1d84$export$25bec8c6f54ee79a(X);reactExports.useEffect(()=>{const K=te=>{te.key==="Escape"&&_(te)};return Z.addEventListener("keydown",K),()=>Z.removeEventListener("keydown",K)},[_,Z])}const $5cb92bef7577960e$var$CONTEXT_UPDATE="dismissableLayer.update",$5cb92bef7577960e$var$POINTER_DOWN_OUTSIDE="dismissableLayer.pointerDownOutside",$5cb92bef7577960e$var$FOCUS_OUTSIDE="dismissableLayer.focusOutside";let $5cb92bef7577960e$var$originalBodyPointerEvents;const $5cb92bef7577960e$var$DismissableLayerContext=reactExports.createContext({layers:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set}),$5cb92bef7577960e$export$177fb62ff3ec1f22=reactExports.forwardRef((X,Z)=>{var _;const{disableOutsidePointerEvents:K=!1,onEscapeKeyDown:te,onPointerDownOutside:ne,onFocusOutside:oe,onInteractOutside:ie,onDismiss:se,...ae}=X,ge=reactExports.useContext($5cb92bef7577960e$var$DismissableLayerContext),[ce,de]=reactExports.useState(null),pe=(_=ce==null?void 0:ce.ownerDocument)!==null&&_!==void 0?_:globalThis==null?void 0:globalThis.document,[,fe]=reactExports.useState({}),be=$6ed0406888f73fc4$export$c7b2cbe3552a0d05(Z,Ve=>de(Ve)),me=Array.from(ge.layers),[ye]=[...ge.layersWithOutsidePointerEventsDisabled].slice(-1),ve=me.indexOf(ye),Be=ce?me.indexOf(ce):-1,Re=ge.layersWithOutsidePointerEventsDisabled.size>0,Ee=Be>=ve,We=$5cb92bef7577960e$var$usePointerDownOutside(Ve=>{const _e=Ve.target,Xe=[...ge.branches].some(Pe=>Pe.contains(_e));!Ee||Xe||(ne==null||ne(Ve),ie==null||ie(Ve),Ve.defaultPrevented||se==null||se())},pe),Ze=$5cb92bef7577960e$var$useFocusOutside(Ve=>{const _e=Ve.target;[...ge.branches].some(Pe=>Pe.contains(_e))||(oe==null||oe(Ve),ie==null||ie(Ve),Ve.defaultPrevented||se==null||se())},pe);return $addc16e1bbe58fd0$export$3a72a57244d6e765(Ve=>{Be===ge.layers.size-1&&(te==null||te(Ve),!Ve.defaultPrevented&&se&&(Ve.preventDefault(),se()))},pe),reactExports.useEffect(()=>{if(ce)return K&&(ge.layersWithOutsidePointerEventsDisabled.size===0&&($5cb92bef7577960e$var$originalBodyPointerEvents=pe.body.style.pointerEvents,pe.body.style.pointerEvents="none"),ge.layersWithOutsidePointerEventsDisabled.add(ce)),ge.layers.add(ce),$5cb92bef7577960e$var$dispatchUpdate(),()=>{K&&ge.layersWithOutsidePointerEventsDisabled.size===1&&(pe.body.style.pointerEvents=$5cb92bef7577960e$var$originalBodyPointerEvents)}},[ce,pe,K,ge]),reactExports.useEffect(()=>()=>{ce&&(ge.layers.delete(ce),ge.layersWithOutsidePointerEventsDisabled.delete(ce),$5cb92bef7577960e$var$dispatchUpdate())},[ce,ge]),reactExports.useEffect(()=>{const Ve=()=>fe({});return document.addEventListener($5cb92bef7577960e$var$CONTEXT_UPDATE,Ve),()=>document.removeEventListener($5cb92bef7577960e$var$CONTEXT_UPDATE,Ve)},[]),reactExports.createElement($8927f6f2acc4f386$export$250ffa63cdc0d034.div,_extends$2({},ae,{ref:be,style:{pointerEvents:Re?Ee?"auto":"none":void 0,...X.style},onFocusCapture:$e42e1063c40fb3ef$export$b9ecd428b558ff10(X.onFocusCapture,Ze.onFocusCapture),onBlurCapture:$e42e1063c40fb3ef$export$b9ecd428b558ff10(X.onBlurCapture,Ze.onBlurCapture),onPointerDownCapture:$e42e1063c40fb3ef$export$b9ecd428b558ff10(X.onPointerDownCapture,We.onPointerDownCapture)}))});function $5cb92bef7577960e$var$usePointerDownOutside(X,Z=globalThis==null?void 0:globalThis.document){const _=$b1b2314f5f9a1d84$export$25bec8c6f54ee79a(X),K=reactExports.useRef(!1),te=reactExports.useRef(()=>{});return reactExports.useEffect(()=>{const ne=ie=>{if(ie.target&&!K.current){let ge=function(){$5cb92bef7577960e$var$handleAndDispatchCustomEvent($5cb92bef7577960e$var$POINTER_DOWN_OUTSIDE,_,ae,{discrete:!0})};var se=ge;const ae={originalEvent:ie};ie.pointerType==="touch"?(Z.removeEventListener("click",te.current),te.current=ge,Z.addEventListener("click",te.current,{once:!0})):ge()}K.current=!1},oe=window.setTimeout(()=>{Z.addEventListener("pointerdown",ne)},0);return()=>{window.clearTimeout(oe),Z.removeEventListener("pointerdown",ne),Z.removeEventListener("click",te.current)}},[Z,_]),{onPointerDownCapture:()=>K.current=!0}}function $5cb92bef7577960e$var$useFocusOutside(X,Z=globalThis==null?void 0:globalThis.document){const _=$b1b2314f5f9a1d84$export$25bec8c6f54ee79a(X),K=reactExports.useRef(!1);return reactExports.useEffect(()=>{const te=ne=>{ne.target&&!K.current&&$5cb92bef7577960e$var$handleAndDispatchCustomEvent($5cb92bef7577960e$var$FOCUS_OUTSIDE,_,{originalEvent:ne},{discrete:!1})};return Z.addEventListener("focusin",te),()=>Z.removeEventListener("focusin",te)},[Z,_]),{onFocusCapture:()=>K.current=!0,onBlurCapture:()=>K.current=!1}}function $5cb92bef7577960e$var$dispatchUpdate(){const X=new CustomEvent($5cb92bef7577960e$var$CONTEXT_UPDATE);document.dispatchEvent(X)}function $5cb92bef7577960e$var$handleAndDispatchCustomEvent(X,Z,_,{discrete:K}){const te=_.originalEvent.target,ne=new CustomEvent(X,{bubbles:!1,cancelable:!0,detail:_});Z&&te.addEventListener(X,Z,{once:!0}),K?$8927f6f2acc4f386$export$6d1a0317bde7de7f(te,ne):te.dispatchEvent(ne)}const $9f79659886946c16$export$e5c5a5f917a5871c=globalThis!=null&&globalThis.document?reactExports.useLayoutEffect:()=>{},$1746a345f3d73bb7$var$useReactId=$2AODx$react.useId||(()=>{});let $1746a345f3d73bb7$var$count=0;function $1746a345f3d73bb7$export$f680877a34711e37(X){const[Z,_]=reactExports.useState($1746a345f3d73bb7$var$useReactId());return $9f79659886946c16$export$e5c5a5f917a5871c(()=>{_(K=>K??String($1746a345f3d73bb7$var$count++))},[X]),Z?`radix-${Z}`:""}function t$1(X){return X.split("-")[0]}function e$2(X){return X.split("-")[1]}function n$2(X){return["top","bottom"].includes(t$1(X))?"x":"y"}function r$3(X){return X==="y"?"height":"width"}function i$3(X,Z,_){let{reference:K,floating:te}=X;const ne=K.x+K.width/2-te.width/2,oe=K.y+K.height/2-te.height/2,ie=n$2(Z),se=r$3(ie),ae=K[se]/2-te[se]/2,ge=ie==="x";let ce;switch(t$1(Z)){case"top":ce={x:ne,y:K.y-te.height};break;case"bottom":ce={x:ne,y:K.y+K.height};break;case"right":ce={x:K.x+K.width,y:oe};break;case"left":ce={x:K.x-te.width,y:oe};break;default:ce={x:K.x,y:K.y}}switch(e$2(Z)){case"start":ce[ie]-=ae*(_&&ge?-1:1);break;case"end":ce[ie]+=ae*(_&&ge?-1:1)}return ce}const o$2=async(X,Z,_)=>{const{placement:K="bottom",strategy:te="absolute",middleware:ne=[],platform:oe}=_,ie=await(oe.isRTL==null?void 0:oe.isRTL(Z));let se=await oe.getElementRects({reference:X,floating:Z,strategy:te}),{x:ae,y:ge}=i$3(se,K,ie),ce=K,de={},pe=0;for(let fe=0;fe<ne.length;fe++){const{name:be,fn:me}=ne[fe],{x:ye,y:ve,data:Be,reset:Re}=await me({x:ae,y:ge,initialPlacement:K,placement:ce,strategy:te,middlewareData:de,rects:se,platform:oe,elements:{reference:X,floating:Z}});ae=ye??ae,ge=ve??ge,de={...de,[be]:{...de[be],...Be}},Re&&pe<=50&&(pe++,typeof Re=="object"&&(Re.placement&&(ce=Re.placement),Re.rects&&(se=Re.rects===!0?await oe.getElementRects({reference:X,floating:Z,strategy:te}):Re.rects),{x:ae,y:ge}=i$3(se,ce,ie)),fe=-1)}return{x:ae,y:ge,placement:ce,strategy:te,middlewareData:de}};function a$4(X){return typeof X!="number"?function(Z){return{top:0,right:0,bottom:0,left:0,...Z}}(X):{top:X,right:X,bottom:X,left:X}}function l$2(X){return{...X,top:X.y,left:X.x,right:X.x+X.width,bottom:X.y+X.height}}async function s$4(X,Z){var _;Z===void 0&&(Z={});const{x:K,y:te,platform:ne,rects:oe,elements:ie,strategy:se}=X,{boundary:ae="clippingAncestors",rootBoundary:ge="viewport",elementContext:ce="floating",altBoundary:de=!1,padding:pe=0}=Z,fe=a$4(pe),be=ie[de?ce==="floating"?"reference":"floating":ce],me=l$2(await ne.getClippingRect({element:(_=await(ne.isElement==null?void 0:ne.isElement(be)))==null||_?be:be.contextElement||await(ne.getDocumentElement==null?void 0:ne.getDocumentElement(ie.floating)),boundary:ae,rootBoundary:ge,strategy:se})),ye=l$2(ne.convertOffsetParentRelativeRectToViewportRelativeRect?await ne.convertOffsetParentRelativeRectToViewportRelativeRect({rect:ce==="floating"?{...oe.floating,x:K,y:te}:oe.reference,offsetParent:await(ne.getOffsetParent==null?void 0:ne.getOffsetParent(ie.floating)),strategy:se}):oe[ce]);return{top:me.top-ye.top+fe.top,bottom:ye.bottom-me.bottom+fe.bottom,left:me.left-ye.left+fe.left,right:ye.right-me.right+fe.right}}const c$5=Math.min,f$3=Math.max;function u$3(X,Z,_){return f$3(X,c$5(Z,_))}const m$4=X=>({name:"arrow",options:X,async fn(Z){const{element:_,padding:K=0}=X??{},{x:te,y:ne,placement:oe,rects:ie,platform:se}=Z;if(_==null)return{};const ae=a$4(K),ge={x:te,y:ne},ce=n$2(oe),de=e$2(oe),pe=r$3(ce),fe=await se.getDimensions(_),be=ce==="y"?"top":"left",me=ce==="y"?"bottom":"right",ye=ie.reference[pe]+ie.reference[ce]-ge[ce]-ie.floating[pe],ve=ge[ce]-ie.reference[ce],Be=await(se.getOffsetParent==null?void 0:se.getOffsetParent(_));let Re=Be?ce==="y"?Be.clientHeight||0:Be.clientWidth||0:0;Re===0&&(Re=ie.floating[pe]);const Ee=ye/2-ve/2,We=ae[be],Ze=Re-fe[pe]-ae[me],Ve=Re/2-fe[pe]/2+Ee,_e=u$3(We,Ve,Ze),Xe=(de==="start"?ae[be]:ae[me])>0&&Ve!==_e&&ie.reference[pe]<=ie.floating[pe];return{[ce]:ge[ce]-(Xe?Ve<We?We-Ve:Ze-Ve:0),data:{[ce]:_e,centerOffset:Ve-_e}}}}),g$3={left:"right",right:"left",bottom:"top",top:"bottom"};function d$3(X){return X.replace(/left|right|bottom|top/g,Z=>g$3[Z])}function p$3(X,Z,_){_===void 0&&(_=!1);const K=e$2(X),te=n$2(X),ne=r$3(te);let oe=te==="x"?K===(_?"end":"start")?"right":"left":K==="start"?"bottom":"top";return Z.reference[ne]>Z.floating[ne]&&(oe=d$3(oe)),{main:oe,cross:d$3(oe)}}const h$3={start:"end",end:"start"};function y$3(X){return X.replace(/start|end/g,Z=>h$3[Z])}const x$2=["top","right","bottom","left"];x$2.reduce((X,Z)=>X.concat(Z,Z+"-start",Z+"-end"),[]);const b$5=function(X){return X===void 0&&(X={}),{name:"flip",options:X,async fn(Z){var _;const{placement:K,middlewareData:te,rects:ne,initialPlacement:oe,platform:ie,elements:se}=Z,{mainAxis:ae=!0,crossAxis:ge=!0,fallbackPlacements:ce,fallbackStrategy:de="bestFit",flipAlignment:pe=!0,...fe}=X,be=t$1(K),me=ce||(be===oe||!pe?[d$3(oe)]:function(Ve){const _e=d$3(Ve);return[y$3(Ve),_e,y$3(_e)]}(oe)),ye=[oe,...me],ve=await s$4(Z,fe),Be=[];let Re=((_=te.flip)==null?void 0:_.overflows)||[];if(ae&&Be.push(ve[be]),ge){const{main:Ve,cross:_e}=p$3(K,ne,await(ie.isRTL==null?void 0:ie.isRTL(se.floating)));Be.push(ve[Ve],ve[_e])}if(Re=[...Re,{placement:K,overflows:Be}],!Be.every(Ve=>Ve<=0)){var Ee,We;const Ve=((Ee=(We=te.flip)==null?void 0:We.index)!=null?Ee:0)+1,_e=ye[Ve];if(_e)return{data:{index:Ve,overflows:Re},reset:{placement:_e}};let Xe="bottom";switch(de){case"bestFit":{var Ze;const Pe=(Ze=Re.map(He=>[He,He.overflows.filter(Ke=>Ke>0).reduce((Ke,Ue)=>Ke+Ue,0)]).sort((He,Ke)=>He[1]-Ke[1])[0])==null?void 0:Ze[0].placement;Pe&&(Xe=Pe);break}case"initialPlacement":Xe=oe}if(K!==Xe)return{reset:{placement:Xe}}}return{}}}};function R$2(X,Z){return{top:X.top-Z.height,right:X.right-Z.width,bottom:X.bottom-Z.height,left:X.left-Z.width}}function A(X){return x$2.some(Z=>X[Z]>=0)}const P=function(X){let{strategy:Z="referenceHidden",..._}=X===void 0?{}:X;return{name:"hide",async fn(K){const{rects:te}=K;switch(Z){case"referenceHidden":{const ne=R$2(await s$4(K,{..._,elementContext:"reference"}),te.reference);return{data:{referenceHiddenOffsets:ne,referenceHidden:A(ne)}}}case"escaped":{const ne=R$2(await s$4(K,{..._,altBoundary:!0}),te.floating);return{data:{escapedOffsets:ne,escaped:A(ne)}}}default:return{}}}}},T$2=function(X){return X===void 0&&(X=0),{name:"offset",options:X,async fn(Z){const{x:_,y:K}=Z,te=await async function(ne,oe){const{placement:ie,platform:se,elements:ae}=ne,ge=await(se.isRTL==null?void 0:se.isRTL(ae.floating)),ce=t$1(ie),de=e$2(ie),pe=n$2(ie)==="x",fe=["left","top"].includes(ce)?-1:1,be=ge&&pe?-1:1,me=typeof oe=="function"?oe(ne):oe;let{mainAxis:ye,crossAxis:ve,alignmentAxis:Be}=typeof me=="number"?{mainAxis:me,crossAxis:0,alignmentAxis:null}:{mainAxis:0,crossAxis:0,alignmentAxis:null,...me};return de&&typeof Be=="number"&&(ve=de==="end"?-1*Be:Be),pe?{x:ve*be,y:ye*fe}:{x:ye*fe,y:ve*be}}(Z,X);return{x:_+te.x,y:K+te.y,data:te}}}};function O(X){return X==="x"?"y":"x"}const D$1=function(X){return X===void 0&&(X={}),{name:"shift",options:X,async fn(Z){const{x:_,y:K,placement:te}=Z,{mainAxis:ne=!0,crossAxis:oe=!1,limiter:ie={fn:me=>{let{x:ye,y:ve}=me;return{x:ye,y:ve}}},...se}=X,ae={x:_,y:K},ge=await s$4(Z,se),ce=n$2(t$1(te)),de=O(ce);let pe=ae[ce],fe=ae[de];if(ne){const me=ce==="y"?"bottom":"right";pe=u$3(pe+ge[ce==="y"?"top":"left"],pe,pe-ge[me])}if(oe){const me=de==="y"?"bottom":"right";fe=u$3(fe+ge[de==="y"?"top":"left"],fe,fe-ge[me])}const be=ie.fn({...Z,[ce]:pe,[de]:fe});return{...be,data:{x:be.x-_,y:be.y-K}}}}},L$2=function(X){return X===void 0&&(X={}),{options:X,fn(Z){const{x:_,y:K,placement:te,rects:ne,middlewareData:oe}=Z,{offset:ie=0,mainAxis:se=!0,crossAxis:ae=!0}=X,ge={x:_,y:K},ce=n$2(te),de=O(ce);let pe=ge[ce],fe=ge[de];const be=typeof ie=="function"?ie({...ne,placement:te}):ie,me=typeof be=="number"?{mainAxis:be,crossAxis:0}:{mainAxis:0,crossAxis:0,...be};if(se){const Ee=ce==="y"?"height":"width",We=ne.reference[ce]-ne.floating[Ee]+me.mainAxis,Ze=ne.reference[ce]+ne.reference[Ee]-me.mainAxis;pe<We?pe=We:pe>Ze&&(pe=Ze)}if(ae){var ye,ve,Be,Re;const Ee=ce==="y"?"width":"height",We=["top","left"].includes(t$1(te)),Ze=ne.reference[de]-ne.floating[Ee]+(We&&(ye=(ve=oe.offset)==null?void 0:ve[de])!=null?ye:0)+(We?0:me.crossAxis),Ve=ne.reference[de]+ne.reference[Ee]+(We?0:(Be=(Re=oe.offset)==null?void 0:Re[de])!=null?Be:0)-(We?me.crossAxis:0);fe<Ze?fe=Ze:fe>Ve&&(fe=Ve)}return{[ce]:pe,[de]:fe}}}},k$2=function(X){return X===void 0&&(X={}),{name:"size",options:X,async fn(Z){const{placement:_,rects:K,platform:te,elements:ne}=Z,{apply:oe,...ie}=X,se=await s$4(Z,ie),ae=t$1(_),ge=e$2(_);let ce,de;ae==="top"||ae==="bottom"?(ce=ae,de=ge===(await(te.isRTL==null?void 0:te.isRTL(ne.floating))?"start":"end")?"left":"right"):(de=ae,ce=ge==="end"?"top":"bottom");const pe=f$3(se.left,0),fe=f$3(se.right,0),be=f$3(se.top,0),me=f$3(se.bottom,0),ye={availableHeight:K.floating.height-(["left","right"].includes(_)?2*(be!==0||me!==0?be+me:f$3(se.top,se.bottom)):se[ce]),availableWidth:K.floating.width-(["top","bottom"].includes(_)?2*(pe!==0||fe!==0?pe+fe:f$3(se.left,se.right)):se[de])},ve=await te.getDimensions(ne.floating);oe==null||oe({...Z,...ye});const Be=await te.getDimensions(ne.floating);return ve.width!==Be.width||ve.height!==Be.height?{reset:{rects:!0}}:{}}}};function n$1(X){return X&&X.document&&X.location&&X.alert&&X.setInterval}function o$1(X){if(X==null)return window;if(!n$1(X)){const Z=X.ownerDocument;return Z&&Z.defaultView||window}return X}function i$2(X){return o$1(X).getComputedStyle(X)}function r$2(X){return n$1(X)?"":X?(X.nodeName||"").toLowerCase():""}function l$1(){const X=navigator.userAgentData;return X!=null&&X.brands?X.brands.map(Z=>Z.brand+"/"+Z.version).join(" "):navigator.userAgent}function c$4(X){return X instanceof o$1(X).HTMLElement}function f$2(X){return X instanceof o$1(X).Element}function s$3(X){return typeof ShadowRoot>"u"?!1:X instanceof o$1(X).ShadowRoot||X instanceof ShadowRoot}function u$2(X){const{overflow:Z,overflowX:_,overflowY:K}=i$2(X);return/auto|scroll|overlay|hidden/.test(Z+K+_)}function d$2(X){return["table","td","th"].includes(r$2(X))}function h$2(X){const Z=/firefox/i.test(l$1()),_=i$2(X);return _.transform!=="none"||_.perspective!=="none"||_.contain==="paint"||["transform","perspective"].includes(_.willChange)||Z&&_.willChange==="filter"||Z&&!!_.filter&&_.filter!=="none"}function a$3(){return!/^((?!chrome|android).)*safari/i.test(l$1())}const g$2=Math.min,p$2=Math.max,m$3=Math.round;function w$1(X,Z,_){var K,te,ne,oe;Z===void 0&&(Z=!1),_===void 0&&(_=!1);const ie=X.getBoundingClientRect();let se=1,ae=1;Z&&c$4(X)&&(se=X.offsetWidth>0&&m$3(ie.width)/X.offsetWidth||1,ae=X.offsetHeight>0&&m$3(ie.height)/X.offsetHeight||1);const ge=f$2(X)?o$1(X):window,ce=!a$3()&&_,de=(ie.left+(ce&&(K=(te=ge.visualViewport)==null?void 0:te.offsetLeft)!=null?K:0))/se,pe=(ie.top+(ce&&(ne=(oe=ge.visualViewport)==null?void 0:oe.offsetTop)!=null?ne:0))/ae,fe=ie.width/se,be=ie.height/ae;return{width:fe,height:be,top:pe,right:de+fe,bottom:pe+be,left:de,x:de,y:pe}}function v$3(X){return(Z=X,(Z instanceof o$1(Z).Node?X.ownerDocument:X.document)||window.document).documentElement;var Z}function y$2(X){return f$2(X)?{scrollLeft:X.scrollLeft,scrollTop:X.scrollTop}:{scrollLeft:X.pageXOffset,scrollTop:X.pageYOffset}}function x$1(X){return w$1(v$3(X)).left+y$2(X).scrollLeft}function b$4(X,Z,_){const K=c$4(Z),te=v$3(Z),ne=w$1(X,K&&function(se){const ae=w$1(se);return m$3(ae.width)!==se.offsetWidth||m$3(ae.height)!==se.offsetHeight}(Z),_==="fixed");let oe={scrollLeft:0,scrollTop:0};const ie={x:0,y:0};if(K||!K&&_!=="fixed")if((r$2(Z)!=="body"||u$2(te))&&(oe=y$2(Z)),c$4(Z)){const se=w$1(Z,!0);ie.x=se.x+Z.clientLeft,ie.y=se.y+Z.clientTop}else te&&(ie.x=x$1(te));return{x:ne.left+oe.scrollLeft-ie.x,y:ne.top+oe.scrollTop-ie.y,width:ne.width,height:ne.height}}function L$1(X){return r$2(X)==="html"?X:X.assignedSlot||X.parentNode||(s$3(X)?X.host:null)||v$3(X)}function R$1(X){return c$4(X)&&getComputedStyle(X).position!=="fixed"?X.offsetParent:null}function T$1(X){const Z=o$1(X);let _=R$1(X);for(;_&&d$2(_)&&getComputedStyle(_).position==="static";)_=R$1(_);return _&&(r$2(_)==="html"||r$2(_)==="body"&&getComputedStyle(_).position==="static"&&!h$2(_))?Z:_||function(K){let te=L$1(K);for(s$3(te)&&(te=te.host);c$4(te)&&!["html","body"].includes(r$2(te));){if(h$2(te))return te;te=te.parentNode}return null}(X)||Z}function W(X){if(c$4(X))return{width:X.offsetWidth,height:X.offsetHeight};const Z=w$1(X);return{width:Z.width,height:Z.height}}function E(X){const Z=L$1(X);return["html","body","#document"].includes(r$2(Z))?X.ownerDocument.body:c$4(Z)&&u$2(Z)?Z:E(Z)}function H$1(X,Z){var _;Z===void 0&&(Z=[]);const K=E(X),te=K===((_=X.ownerDocument)==null?void 0:_.body),ne=o$1(K),oe=te?[ne].concat(ne.visualViewport||[],u$2(K)?K:[]):K,ie=Z.concat(oe);return te?ie:ie.concat(H$1(oe))}function C(X,Z,_){return Z==="viewport"?l$2(function(K,te){const ne=o$1(K),oe=v$3(K),ie=ne.visualViewport;let se=oe.clientWidth,ae=oe.clientHeight,ge=0,ce=0;if(ie){se=ie.width,ae=ie.height;const de=a$3();(de||!de&&te==="fixed")&&(ge=ie.offsetLeft,ce=ie.offsetTop)}return{width:se,height:ae,x:ge,y:ce}}(X,_)):f$2(Z)?function(K,te){const ne=w$1(K,!1,te==="fixed"),oe=ne.top+K.clientTop,ie=ne.left+K.clientLeft;return{top:oe,left:ie,x:ie,y:oe,right:ie+K.clientWidth,bottom:oe+K.clientHeight,width:K.clientWidth,height:K.clientHeight}}(Z,_):l$2(function(K){var te;const ne=v$3(K),oe=y$2(K),ie=(te=K.ownerDocument)==null?void 0:te.body,se=p$2(ne.scrollWidth,ne.clientWidth,ie?ie.scrollWidth:0,ie?ie.clientWidth:0),ae=p$2(ne.scrollHeight,ne.clientHeight,ie?ie.scrollHeight:0,ie?ie.clientHeight:0);let ge=-oe.scrollLeft+x$1(K);const ce=-oe.scrollTop;return i$2(ie||ne).direction==="rtl"&&(ge+=p$2(ne.clientWidth,ie?ie.clientWidth:0)-se),{width:se,height:ae,x:ge,y:ce}}(v$3(X)))}function S$2(X){const Z=H$1(X),_=["absolute","fixed"].includes(i$2(X).position)&&c$4(X)?T$1(X):X;return f$2(_)?Z.filter(K=>f$2(K)&&function(te,ne){const oe=ne.getRootNode==null?void 0:ne.getRootNode();if(te.contains(ne))return!0;if(oe&&s$3(oe)){let ie=ne;do{if(ie&&te===ie)return!0;ie=ie.parentNode||ie.host}while(ie)}return!1}(K,_)&&r$2(K)!=="body"):[]}const D={getClippingRect:function(X){let{element:Z,boundary:_,rootBoundary:K,strategy:te}=X;const ne=[..._==="clippingAncestors"?S$2(Z):[].concat(_),K],oe=ne[0],ie=ne.reduce((se,ae)=>{const ge=C(Z,ae,te);return se.top=p$2(ge.top,se.top),se.right=g$2(ge.right,se.right),se.bottom=g$2(ge.bottom,se.bottom),se.left=p$2(ge.left,se.left),se},C(Z,oe,te));return{width:ie.right-ie.left,height:ie.bottom-ie.top,x:ie.left,y:ie.top}},convertOffsetParentRelativeRectToViewportRelativeRect:function(X){let{rect:Z,offsetParent:_,strategy:K}=X;const te=c$4(_),ne=v$3(_);if(_===ne)return Z;let oe={scrollLeft:0,scrollTop:0};const ie={x:0,y:0};if((te||!te&&K!=="fixed")&&((r$2(_)!=="body"||u$2(ne))&&(oe=y$2(_)),c$4(_))){const se=w$1(_,!0);ie.x=se.x+_.clientLeft,ie.y=se.y+_.clientTop}return{...Z,x:Z.x-oe.scrollLeft+ie.x,y:Z.y-oe.scrollTop+ie.y}},isElement:f$2,getDimensions:W,getOffsetParent:T$1,getDocumentElement:v$3,getElementRects:X=>{let{reference:Z,floating:_,strategy:K}=X;return{reference:b$4(Z,T$1(_),K),floating:{...W(_),x:0,y:0}}},getClientRects:X=>Array.from(X.getClientRects()),isRTL:X=>i$2(X).direction==="rtl"};function N$1(X,Z,_,K){K===void 0&&(K={});const{ancestorScroll:te=!0,ancestorResize:ne=!0,elementResize:oe=!0,animationFrame:ie=!1}=K,se=te&&!ie,ae=ne&&!ie,ge=se||ae?[...f$2(X)?H$1(X):[],...H$1(Z)]:[];ge.forEach(fe=>{se&&fe.addEventListener("scroll",_,{passive:!0}),ae&&fe.addEventListener("resize",_)});let ce,de=null;if(oe){let fe=!0;de=new ResizeObserver(()=>{fe||_(),fe=!1}),f$2(X)&&!ie&&de.observe(X),de.observe(Z)}let pe=ie?w$1(X):null;return ie&&function fe(){const be=w$1(X);!pe||be.x===pe.x&&be.y===pe.y&&be.width===pe.width&&be.height===pe.height||_(),pe=be,ce=requestAnimationFrame(fe)}(),_(),()=>{var fe;ge.forEach(be=>{se&&be.removeEventListener("scroll",_),ae&&be.removeEventListener("resize",_)}),(fe=de)==null||fe.disconnect(),de=null,ie&&cancelAnimationFrame(ce)}}const z=(X,Z,_)=>o$2(X,Z,{platform:D,..._});var index=typeof document<"u"?reactExports.useLayoutEffect:reactExports.useEffect;function deepEqual(X,Z){if(X===Z)return!0;if(typeof X!=typeof Z)return!1;if(typeof X=="function"&&X.toString()===Z.toString())return!0;let _,K,te;if(X&&Z&&typeof X=="object"){if(Array.isArray(X)){if(_=X.length,_!=Z.length)return!1;for(K=_;K--!==0;)if(!deepEqual(X[K],Z[K]))return!1;return!0}if(te=Object.keys(X),_=te.length,_!==Object.keys(Z).length)return!1;for(K=_;K--!==0;)if(!Object.prototype.hasOwnProperty.call(Z,te[K]))return!1;for(K=_;K--!==0;){const ne=te[K];if(!(ne==="_owner"&&X.$$typeof)&&!deepEqual(X[ne],Z[ne]))return!1}return!0}return X!==X&&Z!==Z}function useLatestRef(X){const Z=reactExports.useRef(X);return index(()=>{Z.current=X}),Z}function useFloating(X){let{middleware:Z,placement:_="bottom",strategy:K="absolute",whileElementsMounted:te}=X===void 0?{}:X;const ne=reactExports.useRef(null),oe=reactExports.useRef(null),ie=useLatestRef(te),se=reactExports.useRef(null),[ae,ge]=reactExports.useState({x:null,y:null,strategy:K,placement:_,middlewareData:{}}),[ce,de]=reactExports.useState(Z);deepEqual(ce==null?void 0:ce.map(Be=>{let{options:Re}=Be;return Re}),Z==null?void 0:Z.map(Be=>{let{options:Re}=Be;return Re}))||de(Z);const pe=reactExports.useCallback(()=>{!ne.current||!oe.current||z(ne.current,oe.current,{middleware:ce,placement:_,strategy:K}).then(Be=>{fe.current&&reactDomExports.flushSync(()=>{ge(Be)})})},[ce,_,K]);index(()=>{fe.current&&pe()},[pe]);const fe=reactExports.useRef(!1);index(()=>(fe.current=!0,()=>{fe.current=!1}),[]);const be=reactExports.useCallback(()=>{if(typeof se.current=="function"&&(se.current(),se.current=null),ne.current&&oe.current)if(ie.current){const Be=ie.current(ne.current,oe.current,pe);se.current=Be}else pe()},[pe,ie]),me=reactExports.useCallback(Be=>{ne.current=Be,be()},[be]),ye=reactExports.useCallback(Be=>{oe.current=Be,be()},[be]),ve=reactExports.useMemo(()=>({reference:ne,floating:oe}),[]);return reactExports.useMemo(()=>({...ae,update:pe,refs:ve,reference:me,floating:ye}),[ae,pe,ve,me,ye])}const arrow=X=>{const{element:Z,padding:_}=X;function K(te){return Object.prototype.hasOwnProperty.call(te,"current")}return{name:"arrow",options:X,fn(te){return K(Z)?Z.current!=null?m$4({element:Z.current,padding:_}).fn(te):{}:Z?m$4({element:Z,padding:_}).fn(te):{}}}},$7e8f5cd07187803e$export$21b07c8f274aebd5=reactExports.forwardRef((X,Z)=>{const{children:_,width:K=10,height:te=5,...ne}=X;return reactExports.createElement($8927f6f2acc4f386$export$250ffa63cdc0d034.svg,_extends$2({},ne,{ref:Z,width:K,height:te,viewBox:"0 0 30 10",preserveAspectRatio:"none"}),X.asChild?_:reactExports.createElement("polygon",{points:"0,0 30,0 15,10"}))}),$7e8f5cd07187803e$export$be92b6f5f03c0fe9=$7e8f5cd07187803e$export$21b07c8f274aebd5;function $db6c3485150b8e66$export$1ab7ae714698c4b8(X){const[Z,_]=reactExports.useState(void 0);return $9f79659886946c16$export$e5c5a5f917a5871c(()=>{if(X){_({width:X.offsetWidth,height:X.offsetHeight});const K=new ResizeObserver(te=>{if(!Array.isArray(te)||!te.length)return;const ne=te[0];let oe,ie;if("borderBoxSize"in ne){const se=ne.borderBoxSize,ae=Array.isArray(se)?se[0]:se;oe=ae.inlineSize,ie=ae.blockSize}else oe=X.offsetWidth,ie=X.offsetHeight;_({width:oe,height:ie})});return K.observe(X,{box:"border-box"}),()=>K.unobserve(X)}else _(void 0)},[X]),Z}const $cf1ac5d9fe0e8206$var$POPPER_NAME="Popper",[$cf1ac5d9fe0e8206$var$createPopperContext,$cf1ac5d9fe0e8206$export$722aac194ae923]=$c512c27ab02ef895$export$50c7b4e9d9f19c1($cf1ac5d9fe0e8206$var$POPPER_NAME),[$cf1ac5d9fe0e8206$var$PopperProvider,$cf1ac5d9fe0e8206$var$usePopperContext]=$cf1ac5d9fe0e8206$var$createPopperContext($cf1ac5d9fe0e8206$var$POPPER_NAME),$cf1ac5d9fe0e8206$export$badac9ada3a0bdf9=X=>{const{__scopePopper:Z,children:_}=X,[K,te]=reactExports.useState(null);return reactExports.createElement($cf1ac5d9fe0e8206$var$PopperProvider,{scope:Z,anchor:K,onAnchorChange:te},_)},$cf1ac5d9fe0e8206$var$ANCHOR_NAME="PopperAnchor",$cf1ac5d9fe0e8206$export$ecd4e1ccab6ed6d=reactExports.forwardRef((X,Z)=>{const{__scopePopper:_,virtualRef:K,...te}=X,ne=$cf1ac5d9fe0e8206$var$usePopperContext($cf1ac5d9fe0e8206$var$ANCHOR_NAME,_),oe=reactExports.useRef(null),ie=$6ed0406888f73fc4$export$c7b2cbe3552a0d05(Z,oe);return reactExports.useEffect(()=>{ne.onAnchorChange((K==null?void 0:K.current)||oe.current)}),K?null:reactExports.createElement($8927f6f2acc4f386$export$250ffa63cdc0d034.div,_extends$2({},te,{ref:ie}))}),$cf1ac5d9fe0e8206$var$CONTENT_NAME="PopperContent",[$cf1ac5d9fe0e8206$var$PopperContentProvider,$cf1ac5d9fe0e8206$var$useContentContext]=$cf1ac5d9fe0e8206$var$createPopperContext($cf1ac5d9fe0e8206$var$CONTENT_NAME),[$cf1ac5d9fe0e8206$var$PositionContextProvider,$cf1ac5d9fe0e8206$var$usePositionContext]=$cf1ac5d9fe0e8206$var$createPopperContext($cf1ac5d9fe0e8206$var$CONTENT_NAME,{hasParent:!1,positionUpdateFns:new Set}),$cf1ac5d9fe0e8206$export$bc4ae5855d3c4fc=reactExports.forwardRef((X,Z)=>{var _,K,te,ne,oe,ie,se,ae;const{__scopePopper:ge,side:ce="bottom",sideOffset:de=0,align:pe="center",alignOffset:fe=0,arrowPadding:be=0,collisionBoundary:me=[],collisionPadding:ye=0,sticky:ve="partial",hideWhenDetached:Be=!1,avoidCollisions:Re=!0,onPlaced:Ee,...We}=X,Ze=$cf1ac5d9fe0e8206$var$usePopperContext($cf1ac5d9fe0e8206$var$CONTENT_NAME,ge),[Ve,_e]=reactExports.useState(null),Xe=$6ed0406888f73fc4$export$c7b2cbe3552a0d05(Z,un=>_e(un)),[Pe,He]=reactExports.useState(null),Ke=$db6c3485150b8e66$export$1ab7ae714698c4b8(Pe),Ue=(_=Ke==null?void 0:Ke.width)!==null&&_!==void 0?_:0,tt=(K=Ke==null?void 0:Ke.height)!==null&&K!==void 0?K:0,rt=ce+(pe!=="center"?"-"+pe:""),at=typeof ye=="number"?ye:{top:0,right:0,bottom:0,left:0,...ye},Oe=Array.isArray(me)?me:[me],$e=Oe.length>0,je={padding:at,boundary:Oe.filter($cf1ac5d9fe0e8206$var$isNotNull),altBoundary:$e},{reference:Te,floating:De,strategy:ot,x:ct,y:gt,placement:pt,middlewareData:ht,update:At}=useFloating({strategy:"fixed",placement:rt,whileElementsMounted:N$1,middleware:[$cf1ac5d9fe0e8206$var$anchorCssProperties(),T$2({mainAxis:de+tt,alignmentAxis:fe}),Re?D$1({mainAxis:!0,crossAxis:!1,limiter:ve==="partial"?L$2():void 0,...je}):void 0,Pe?arrow({element:Pe,padding:be}):void 0,Re?b$5({...je}):void 0,k$2({...je,apply:({elements:un,availableWidth:qe,availableHeight:Je})=>{un.floating.style.setProperty("--radix-popper-available-width",`${qe}px`),un.floating.style.setProperty("--radix-popper-available-height",`${Je}px`)}}),$cf1ac5d9fe0e8206$var$transformOrigin({arrowWidth:Ue,arrowHeight:tt}),Be?P({strategy:"referenceHidden"}):void 0].filter($cf1ac5d9fe0e8206$var$isDefined)});$9f79659886946c16$export$e5c5a5f917a5871c(()=>{Te(Ze.anchor)},[Te,Ze.anchor]);const Kt=ct!==null&&gt!==null,[en,Zt]=$cf1ac5d9fe0e8206$var$getSideAndAlignFromPlacement(pt),st=$b1b2314f5f9a1d84$export$25bec8c6f54ee79a(Ee);$9f79659886946c16$export$e5c5a5f917a5871c(()=>{Kt&&(st==null||st())},[Kt,st]);const Vt=(te=ht.arrow)===null||te===void 0?void 0:te.x,wt=(ne=ht.arrow)===null||ne===void 0?void 0:ne.y,St=((oe=ht.arrow)===null||oe===void 0?void 0:oe.centerOffset)!==0,[Rt,jt]=reactExports.useState();$9f79659886946c16$export$e5c5a5f917a5871c(()=>{Ve&&jt(window.getComputedStyle(Ve).zIndex)},[Ve]);const{hasParent:Wt,positionUpdateFns:Ht}=$cf1ac5d9fe0e8206$var$usePositionContext($cf1ac5d9fe0e8206$var$CONTENT_NAME,ge),Pt=!Wt;reactExports.useLayoutEffect(()=>{if(!Pt)return Ht.add(At),()=>{Ht.delete(At)}},[Pt,Ht,At]),$9f79659886946c16$export$e5c5a5f917a5871c(()=>{Pt&&Kt&&Array.from(Ht).reverse().forEach(un=>requestAnimationFrame(un))},[Pt,Kt,Ht]);const Mt={"data-side":en,"data-align":Zt,...We,ref:Xe,style:{...We.style,animation:Kt?void 0:"none",opacity:(ie=ht.hide)!==null&&ie!==void 0&&ie.referenceHidden?0:void 0}};return reactExports.createElement("div",{ref:De,"data-radix-popper-content-wrapper":"",style:{position:ot,left:0,top:0,transform:Kt?`translate3d(${Math.round(ct)}px, ${Math.round(gt)}px, 0)`:"translate3d(0, -200%, 0)",minWidth:"max-content",zIndex:Rt,"--radix-popper-transform-origin":[(se=ht.transformOrigin)===null||se===void 0?void 0:se.x,(ae=ht.transformOrigin)===null||ae===void 0?void 0:ae.y].join(" ")},dir:X.dir},reactExports.createElement($cf1ac5d9fe0e8206$var$PopperContentProvider,{scope:ge,placedSide:en,onArrowChange:He,arrowX:Vt,arrowY:wt,shouldHideArrow:St},Pt?reactExports.createElement($cf1ac5d9fe0e8206$var$PositionContextProvider,{scope:ge,hasParent:!0,positionUpdateFns:Ht},reactExports.createElement($8927f6f2acc4f386$export$250ffa63cdc0d034.div,Mt)):reactExports.createElement($8927f6f2acc4f386$export$250ffa63cdc0d034.div,Mt)))}),$cf1ac5d9fe0e8206$var$ARROW_NAME="PopperArrow",$cf1ac5d9fe0e8206$var$OPPOSITE_SIDE={top:"bottom",right:"left",bottom:"top",left:"right"},$cf1ac5d9fe0e8206$export$79d62cd4e10a3fd0=reactExports.forwardRef(function(Z,_){const{__scopePopper:K,...te}=Z,ne=$cf1ac5d9fe0e8206$var$useContentContext($cf1ac5d9fe0e8206$var$ARROW_NAME,K),oe=$cf1ac5d9fe0e8206$var$OPPOSITE_SIDE[ne.placedSide];return reactExports.createElement("span",{ref:ne.onArrowChange,style:{position:"absolute",left:ne.arrowX,top:ne.arrowY,[oe]:0,transformOrigin:{top:"",right:"0 0",bottom:"center 0",left:"100% 0"}[ne.placedSide],transform:{top:"translateY(100%)",right:"translateY(50%) rotate(90deg) translateX(-50%)",bottom:"rotate(180deg)",left:"translateY(50%) rotate(-90deg) translateX(50%)"}[ne.placedSide],visibility:ne.shouldHideArrow?"hidden":void 0}},reactExports.createElement($7e8f5cd07187803e$export$be92b6f5f03c0fe9,_extends$2({},te,{ref:_,style:{...te.style,display:"block"}})))});function $cf1ac5d9fe0e8206$var$isDefined(X){return X!==void 0}function $cf1ac5d9fe0e8206$var$isNotNull(X){return X!==null}const $cf1ac5d9fe0e8206$var$anchorCssProperties=()=>({name:"anchorCssProperties",fn(X){const{rects:Z,elements:_}=X,{width:K,height:te}=Z.reference;return _.floating.style.setProperty("--radix-popper-anchor-width",`${K}px`),_.floating.style.setProperty("--radix-popper-anchor-height",`${te}px`),{}}}),$cf1ac5d9fe0e8206$var$transformOrigin=X=>({name:"transformOrigin",options:X,fn(Z){var _,K,te,ne,oe;const{placement:ie,rects:se,middlewareData:ae}=Z,ce=((_=ae.arrow)===null||_===void 0?void 0:_.centerOffset)!==0,de=ce?0:X.arrowWidth,pe=ce?0:X.arrowHeight,[fe,be]=$cf1ac5d9fe0e8206$var$getSideAndAlignFromPlacement(ie),me={start:"0%",center:"50%",end:"100%"}[be],ye=((K=(te=ae.arrow)===null||te===void 0?void 0:te.x)!==null&&K!==void 0?K:0)+de/2,ve=((ne=(oe=ae.arrow)===null||oe===void 0?void 0:oe.y)!==null&&ne!==void 0?ne:0)+pe/2;let Be="",Re="";return fe==="bottom"?(Be=ce?me:`${ye}px`,Re=`${-pe}px`):fe==="top"?(Be=ce?me:`${ye}px`,Re=`${se.floating.height+pe}px`):fe==="right"?(Be=`${-pe}px`,Re=ce?me:`${ve}px`):fe==="left"&&(Be=`${se.floating.width+pe}px`,Re=ce?me:`${ve}px`),{data:{x:Be,y:Re}}}});function $cf1ac5d9fe0e8206$var$getSideAndAlignFromPlacement(X){const[Z,_="center"]=X.split("-");return[Z,_]}const $cf1ac5d9fe0e8206$export$be92b6f5f03c0fe9=$cf1ac5d9fe0e8206$export$badac9ada3a0bdf9,$cf1ac5d9fe0e8206$export$b688253958b8dfe7=$cf1ac5d9fe0e8206$export$ecd4e1ccab6ed6d,$cf1ac5d9fe0e8206$export$7c6e2c02157bb7d2=$cf1ac5d9fe0e8206$export$bc4ae5855d3c4fc,$cf1ac5d9fe0e8206$export$21b07c8f274aebd5=$cf1ac5d9fe0e8206$export$79d62cd4e10a3fd0;function $fe963b355347cc68$export$3e6543de14f8614f(X,Z){return reactExports.useReducer((_,K)=>{const te=Z[_][K];return te??_},X)}const $921a889cee6df7e8$export$99c2b779aa4e8b8b=X=>{const{present:Z,children:_}=X,K=$921a889cee6df7e8$var$usePresence(Z),te=typeof _=="function"?_({present:K.isPresent}):reactExports.Children.only(_),ne=$6ed0406888f73fc4$export$c7b2cbe3552a0d05(K.ref,te.ref);return typeof _=="function"||K.isPresent?reactExports.cloneElement(te,{ref:ne}):null};$921a889cee6df7e8$export$99c2b779aa4e8b8b.displayName="Presence";function $921a889cee6df7e8$var$usePresence(X){const[Z,_]=reactExports.useState(),K=reactExports.useRef({}),te=reactExports.useRef(X),ne=reactExports.useRef("none"),oe=X?"mounted":"unmounted",[ie,se]=$fe963b355347cc68$export$3e6543de14f8614f(oe,{mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}});return reactExports.useEffect(()=>{const ae=$921a889cee6df7e8$var$getAnimationName(K.current);ne.current=ie==="mounted"?ae:"none"},[ie]),$9f79659886946c16$export$e5c5a5f917a5871c(()=>{const ae=K.current,ge=te.current;if(ge!==X){const de=ne.current,pe=$921a889cee6df7e8$var$getAnimationName(ae);X?se("MOUNT"):pe==="none"||(ae==null?void 0:ae.display)==="none"?se("UNMOUNT"):se(ge&&de!==pe?"ANIMATION_OUT":"UNMOUNT"),te.current=X}},[X,se]),$9f79659886946c16$export$e5c5a5f917a5871c(()=>{if(Z){const ae=ce=>{const pe=$921a889cee6df7e8$var$getAnimationName(K.current).includes(ce.animationName);ce.target===Z&&pe&&reactDomExports.flushSync(()=>se("ANIMATION_END"))},ge=ce=>{ce.target===Z&&(ne.current=$921a889cee6df7e8$var$getAnimationName(K.current))};return Z.addEventListener("animationstart",ge),Z.addEventListener("animationcancel",ae),Z.addEventListener("animationend",ae),()=>{Z.removeEventListener("animationstart",ge),Z.removeEventListener("animationcancel",ae),Z.removeEventListener("animationend",ae)}}else se("ANIMATION_END")},[Z,se]),{isPresent:["mounted","unmountSuspended"].includes(ie),ref:reactExports.useCallback(ae=>{ae&&(K.current=getComputedStyle(ae)),_(ae)},[])}}function $921a889cee6df7e8$var$getAnimationName(X){return(X==null?void 0:X.animationName)||"none"}function $71cd76cc60e0454e$export$6f32135080cb4c3({prop:X,defaultProp:Z,onChange:_=()=>{}}){const[K,te]=$71cd76cc60e0454e$var$useUncontrolledState({defaultProp:Z,onChange:_}),ne=X!==void 0,oe=ne?X:K,ie=$b1b2314f5f9a1d84$export$25bec8c6f54ee79a(_),se=reactExports.useCallback(ae=>{if(ne){const ce=typeof ae=="function"?ae(X):ae;ce!==X&&ie(ce)}else te(ae)},[ne,X,te,ie]);return[oe,se]}function $71cd76cc60e0454e$var$useUncontrolledState({defaultProp:X,onChange:Z}){const _=reactExports.useState(X),[K]=_,te=reactExports.useRef(K),ne=$b1b2314f5f9a1d84$export$25bec8c6f54ee79a(Z);return reactExports.useEffect(()=>{te.current!==K&&(ne(K),te.current=K)},[K,te,ne]),_}const $ea1ef594cf570d83$export$439d29a4e110a164=reactExports.forwardRef((X,Z)=>reactExports.createElement($8927f6f2acc4f386$export$250ffa63cdc0d034.span,_extends$2({},X,{ref:Z,style:{position:"absolute",border:0,width:1,height:1,padding:0,margin:-1,overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",wordWrap:"normal",...X.style}}))),$ea1ef594cf570d83$export$be92b6f5f03c0fe9=$ea1ef594cf570d83$export$439d29a4e110a164,[$a093c7e1ec25a057$var$createTooltipContext,$a093c7e1ec25a057$export$1c540a2224f0d865]=$c512c27ab02ef895$export$50c7b4e9d9f19c1("Tooltip",[$cf1ac5d9fe0e8206$export$722aac194ae923]),$a093c7e1ec25a057$var$usePopperScope=$cf1ac5d9fe0e8206$export$722aac194ae923(),$a093c7e1ec25a057$var$PROVIDER_NAME="TooltipProvider",$a093c7e1ec25a057$var$TOOLTIP_OPEN="tooltip.open",[$a093c7e1ec25a057$var$TooltipProviderContextProvider,$a093c7e1ec25a057$var$useTooltipProviderContext]=$a093c7e1ec25a057$var$createTooltipContext($a093c7e1ec25a057$var$PROVIDER_NAME),$a093c7e1ec25a057$var$TOOLTIP_NAME="Tooltip",[$a093c7e1ec25a057$var$TooltipContextProvider,$a093c7e1ec25a057$var$useTooltipContext]=$a093c7e1ec25a057$var$createTooltipContext($a093c7e1ec25a057$var$TOOLTIP_NAME),$a093c7e1ec25a057$export$28c660c63b792dea=X=>{const{__scopeTooltip:Z,children:_,open:K,defaultOpen:te=!1,onOpenChange:ne,disableHoverableContent:oe,delayDuration:ie}=X,se=$a093c7e1ec25a057$var$useTooltipProviderContext($a093c7e1ec25a057$var$TOOLTIP_NAME,X.__scopeTooltip),ae=$a093c7e1ec25a057$var$usePopperScope(Z),[ge,ce]=reactExports.useState(null),de=$1746a345f3d73bb7$export$f680877a34711e37(),pe=reactExports.useRef(0),fe=oe??se.disableHoverableContent,be=ie??se.delayDuration,me=reactExports.useRef(!1),[ye=!1,ve]=$71cd76cc60e0454e$export$6f32135080cb4c3({prop:K,defaultProp:te,onChange:Ze=>{Ze?(se.onOpen(),document.dispatchEvent(new CustomEvent($a093c7e1ec25a057$var$TOOLTIP_OPEN))):se.onClose(),ne==null||ne(Ze)}}),Be=reactExports.useMemo(()=>ye?me.current?"delayed-open":"instant-open":"closed",[ye]),Re=reactExports.useCallback(()=>{window.clearTimeout(pe.current),me.current=!1,ve(!0)},[ve]),Ee=reactExports.useCallback(()=>{window.clearTimeout(pe.current),ve(!1)},[ve]),We=reactExports.useCallback(()=>{window.clearTimeout(pe.current),pe.current=window.setTimeout(()=>{me.current=!0,ve(!0)},be)},[be,ve]);return reactExports.useEffect(()=>()=>window.clearTimeout(pe.current),[]),reactExports.createElement($cf1ac5d9fe0e8206$export$be92b6f5f03c0fe9,ae,reactExports.createElement($a093c7e1ec25a057$var$TooltipContextProvider,{scope:Z,contentId:de,open:ye,stateAttribute:Be,trigger:ge,onTriggerChange:ce,onTriggerEnter:reactExports.useCallback(()=>{se.isOpenDelayed?We():Re()},[se.isOpenDelayed,We,Re]),onTriggerLeave:reactExports.useCallback(()=>{fe?Ee():window.clearTimeout(pe.current)},[Ee,fe]),onOpen:Re,onClose:Ee,disableHoverableContent:fe},_))},$a093c7e1ec25a057$var$TRIGGER_NAME="TooltipTrigger",$a093c7e1ec25a057$export$8c610744efcf8a1d=reactExports.forwardRef((X,Z)=>{const{__scopeTooltip:_,...K}=X,te=$a093c7e1ec25a057$var$useTooltipContext($a093c7e1ec25a057$var$TRIGGER_NAME,_),ne=$a093c7e1ec25a057$var$useTooltipProviderContext($a093c7e1ec25a057$var$TRIGGER_NAME,_),oe=$a093c7e1ec25a057$var$usePopperScope(_),ie=reactExports.useRef(null),se=$6ed0406888f73fc4$export$c7b2cbe3552a0d05(Z,ie,te.onTriggerChange),ae=reactExports.useRef(!1),ge=reactExports.useRef(!1),ce=reactExports.useCallback(()=>ae.current=!1,[]);return reactExports.useEffect(()=>()=>document.removeEventListener("pointerup",ce),[ce]),reactExports.createElement($cf1ac5d9fe0e8206$export$b688253958b8dfe7,_extends$2({asChild:!0},oe),reactExports.createElement($8927f6f2acc4f386$export$250ffa63cdc0d034.button,_extends$2({"aria-describedby":te.open?te.contentId:void 0,"data-state":te.stateAttribute},K,{ref:se,onPointerMove:$e42e1063c40fb3ef$export$b9ecd428b558ff10(X.onPointerMove,de=>{de.pointerType!=="touch"&&!ge.current&&!ne.isPointerInTransitRef.current&&(te.onTriggerEnter(),ge.current=!0)}),onPointerLeave:$e42e1063c40fb3ef$export$b9ecd428b558ff10(X.onPointerLeave,()=>{te.onTriggerLeave(),ge.current=!1}),onPointerDown:$e42e1063c40fb3ef$export$b9ecd428b558ff10(X.onPointerDown,()=>{ae.current=!0,document.addEventListener("pointerup",ce,{once:!0})}),onFocus:$e42e1063c40fb3ef$export$b9ecd428b558ff10(X.onFocus,()=>{ae.current||te.onOpen()}),onBlur:$e42e1063c40fb3ef$export$b9ecd428b558ff10(X.onBlur,te.onClose),onClick:$e42e1063c40fb3ef$export$b9ecd428b558ff10(X.onClick,te.onClose)})))}),$a093c7e1ec25a057$var$PORTAL_NAME="TooltipPortal",[$a093c7e1ec25a057$var$PortalProvider,$a093c7e1ec25a057$var$usePortalContext]=$a093c7e1ec25a057$var$createTooltipContext($a093c7e1ec25a057$var$PORTAL_NAME,{forceMount:void 0}),$a093c7e1ec25a057$var$CONTENT_NAME="TooltipContent",$a093c7e1ec25a057$export$e9003e2be37ec060=reactExports.forwardRef((X,Z)=>{const _=$a093c7e1ec25a057$var$usePortalContext($a093c7e1ec25a057$var$CONTENT_NAME,X.__scopeTooltip),{forceMount:K=_.forceMount,side:te="top",...ne}=X,oe=$a093c7e1ec25a057$var$useTooltipContext($a093c7e1ec25a057$var$CONTENT_NAME,X.__scopeTooltip);return reactExports.createElement($921a889cee6df7e8$export$99c2b779aa4e8b8b,{present:K||oe.open},oe.disableHoverableContent?reactExports.createElement($a093c7e1ec25a057$var$TooltipContentImpl,_extends$2({side:te},ne,{ref:Z})):reactExports.createElement($a093c7e1ec25a057$var$TooltipContentHoverable,_extends$2({side:te},ne,{ref:Z})))}),$a093c7e1ec25a057$var$TooltipContentHoverable=reactExports.forwardRef((X,Z)=>{const _=$a093c7e1ec25a057$var$useTooltipContext($a093c7e1ec25a057$var$CONTENT_NAME,X.__scopeTooltip),K=$a093c7e1ec25a057$var$useTooltipProviderContext($a093c7e1ec25a057$var$CONTENT_NAME,X.__scopeTooltip),te=reactExports.useRef(null),ne=$6ed0406888f73fc4$export$c7b2cbe3552a0d05(Z,te),[oe,ie]=reactExports.useState(null),{trigger:se,onClose:ae}=_,ge=te.current,{onPointerInTransitChange:ce}=K,de=reactExports.useCallback(()=>{ie(null),ce(!1)},[ce]),pe=reactExports.useCallback((fe,be)=>{const me=fe.currentTarget,ye={x:fe.clientX,y:fe.clientY},ve=$a093c7e1ec25a057$var$getExitSideFromRect(ye,me.getBoundingClientRect()),Be=ve==="right"||ve==="bottom"?-5:5,Ee=ve==="right"||ve==="left"?{x:fe.clientX+Be,y:fe.clientY}:{x:fe.clientX,y:fe.clientY+Be},We=$a093c7e1ec25a057$var$getPointsFromRect(be.getBoundingClientRect()),Ze=$a093c7e1ec25a057$var$getHull([Ee,...We]);ie(Ze),ce(!0)},[ce]);return reactExports.useEffect(()=>()=>de(),[de]),reactExports.useEffect(()=>{if(se&&ge){const fe=me=>pe(me,ge),be=me=>pe(me,se);return se.addEventListener("pointerleave",fe),ge.addEventListener("pointerleave",be),()=>{se.removeEventListener("pointerleave",fe),ge.removeEventListener("pointerleave",be)}}},[se,ge,pe,de]),reactExports.useEffect(()=>{if(oe){const fe=be=>{const me=be.target,ye={x:be.clientX,y:be.clientY},ve=(se==null?void 0:se.contains(me))||(ge==null?void 0:ge.contains(me)),Be=!$a093c7e1ec25a057$var$isPointInPolygon(ye,oe);ve?de():Be&&(de(),ae())};return document.addEventListener("pointermove",fe),()=>document.removeEventListener("pointermove",fe)}},[se,ge,oe,ae,de]),reactExports.createElement($a093c7e1ec25a057$var$TooltipContentImpl,_extends$2({},X,{ref:ne}))}),[$a093c7e1ec25a057$var$VisuallyHiddenContentContextProvider,$a093c7e1ec25a057$var$useVisuallyHiddenContentContext]=$a093c7e1ec25a057$var$createTooltipContext($a093c7e1ec25a057$var$TOOLTIP_NAME,{isInside:!1}),$a093c7e1ec25a057$var$TooltipContentImpl=reactExports.forwardRef((X,Z)=>{const{__scopeTooltip:_,children:K,"aria-label":te,onEscapeKeyDown:ne,onPointerDownOutside:oe,...ie}=X,se=$a093c7e1ec25a057$var$useTooltipContext($a093c7e1ec25a057$var$CONTENT_NAME,_),ae=$a093c7e1ec25a057$var$usePopperScope(_),{onClose:ge}=se;return reactExports.useEffect(()=>(document.addEventListener($a093c7e1ec25a057$var$TOOLTIP_OPEN,ge),()=>document.removeEventListener($a093c7e1ec25a057$var$TOOLTIP_OPEN,ge)),[ge]),reactExports.useEffect(()=>{if(se.trigger){const ce=de=>{const pe=de.target;pe!=null&&pe.contains(se.trigger)&&ge()};return window.addEventListener("scroll",ce,{capture:!0}),()=>window.removeEventListener("scroll",ce,{capture:!0})}},[se.trigger,ge]),reactExports.createElement($5cb92bef7577960e$export$177fb62ff3ec1f22,{asChild:!0,disableOutsidePointerEvents:!1,onEscapeKeyDown:ne,onPointerDownOutside:oe,onFocusOutside:ce=>ce.preventDefault(),onDismiss:ge},reactExports.createElement($cf1ac5d9fe0e8206$export$7c6e2c02157bb7d2,_extends$2({"data-state":se.stateAttribute},ae,ie,{ref:Z,style:{...ie.style,"--radix-tooltip-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-tooltip-content-available-width":"var(--radix-popper-available-width)","--radix-tooltip-content-available-height":"var(--radix-popper-available-height)","--radix-tooltip-trigger-width":"var(--radix-popper-anchor-width)","--radix-tooltip-trigger-height":"var(--radix-popper-anchor-height)"}}),reactExports.createElement($5e63c961fc1ce211$export$d9f1ccf0bdb05d45,null,K),reactExports.createElement($a093c7e1ec25a057$var$VisuallyHiddenContentContextProvider,{scope:_,isInside:!0},reactExports.createElement($ea1ef594cf570d83$export$be92b6f5f03c0fe9,{id:se.contentId,role:"tooltip"},te||K))))}),$a093c7e1ec25a057$var$ARROW_NAME="TooltipArrow",$a093c7e1ec25a057$export$c27ee0ad710f7559=reactExports.forwardRef((X,Z)=>{const{__scopeTooltip:_,...K}=X,te=$a093c7e1ec25a057$var$usePopperScope(_);return $a093c7e1ec25a057$var$useVisuallyHiddenContentContext($a093c7e1ec25a057$var$ARROW_NAME,_).isInside?null:reactExports.createElement($cf1ac5d9fe0e8206$export$21b07c8f274aebd5,_extends$2({},te,K,{ref:Z}))});function $a093c7e1ec25a057$var$getExitSideFromRect(X,Z){const _=Math.abs(Z.top-X.y),K=Math.abs(Z.bottom-X.y),te=Math.abs(Z.right-X.x),ne=Math.abs(Z.left-X.x);switch(Math.min(_,K,te,ne)){case ne:return"left";case te:return"right";case _:return"top";case K:return"bottom";default:return null}}function $a093c7e1ec25a057$var$getPointsFromRect(X){const{top:Z,right:_,bottom:K,left:te}=X;return[{x:te,y:Z},{x:_,y:Z},{x:_,y:K},{x:te,y:K}]}function $a093c7e1ec25a057$var$isPointInPolygon(X,Z){const{x:_,y:K}=X;let te=!1;for(let ne=0,oe=Z.length-1;ne<Z.length;oe=ne++){const ie=Z[ne].x,se=Z[ne].y,ae=Z[oe].x,ge=Z[oe].y;se>K!=ge>K&&_<(ae-ie)*(K-se)/(ge-se)+ie&&(te=!te)}return te}function $a093c7e1ec25a057$var$getHull(X){const Z=X.slice();return Z.sort((_,K)=>_.x<K.x?-1:_.x>K.x?1:_.y<K.y?-1:_.y>K.y?1:0),$a093c7e1ec25a057$var$getHullPresorted(Z)}function $a093c7e1ec25a057$var$getHullPresorted(X){if(X.length<=1)return X.slice();const Z=[];for(let K=0;K<X.length;K++){const te=X[K];for(;Z.length>=2;){const ne=Z[Z.length-1],oe=Z[Z.length-2];if((ne.x-oe.x)*(te.y-oe.y)>=(ne.y-oe.y)*(te.x-oe.x))Z.pop();else break}Z.push(te)}Z.pop();const _=[];for(let K=X.length-1;K>=0;K--){const te=X[K];for(;_.length>=2;){const ne=_[_.length-1],oe=_[_.length-2];if((ne.x-oe.x)*(te.y-oe.y)>=(ne.y-oe.y)*(te.x-oe.x))_.pop();else break}_.push(te)}return _.pop(),Z.length===1&&_.length===1&&Z[0].x===_[0].x&&Z[0].y===_[0].y?Z:Z.concat(_)}const $a093c7e1ec25a057$export$be92b6f5f03c0fe9=$a093c7e1ec25a057$export$28c660c63b792dea,$a093c7e1ec25a057$export$41fb9f06171c75f4=$a093c7e1ec25a057$export$8c610744efcf8a1d,$a093c7e1ec25a057$export$7c6e2c02157bb7d2=$a093c7e1ec25a057$export$e9003e2be37ec060,$a093c7e1ec25a057$export$21b07c8f274aebd5=$a093c7e1ec25a057$export$c27ee0ad710f7559;function _objectWithoutPropertiesLoose$2(X,Z){if(X==null)return{};var _={},K=Object.keys(X),te,ne;for(ne=0;ne<K.length;ne++)te=K[ne],!(Z.indexOf(te)>=0)&&(_[te]=X[te]);return _}function _objectWithoutProperties$2(X,Z){if(X==null)return{};var _=_objectWithoutPropertiesLoose$2(X,Z),K,te;if(Object.getOwnPropertySymbols){var ne=Object.getOwnPropertySymbols(X);for(te=0;te<ne.length;te++)K=ne[te],!(Z.indexOf(K)>=0)&&Object.prototype.propertyIsEnumerable.call(X,K)&&(_[K]=X[K])}return _}let LevaErrors;(function(X){X[X.UNSUPPORTED_INPUT=0]="UNSUPPORTED_INPUT",X[X.NO_COMPONENT_FOR_TYPE=1]="NO_COMPONENT_FOR_TYPE",X[X.UNKNOWN_INPUT=2]="UNKNOWN_INPUT",X[X.DUPLICATE_KEYS=3]="DUPLICATE_KEYS",X[X.ALREADY_REGISTERED_TYPE=4]="ALREADY_REGISTERED_TYPE",X[X.CLIPBOARD_ERROR=5]="CLIPBOARD_ERROR",X[X.THEME_ERROR=6]="THEME_ERROR",X[X.PATH_DOESNT_EXIST=7]="PATH_DOESNT_EXIST",X[X.INPUT_TYPE_OVERRIDE=8]="INPUT_TYPE_OVERRIDE",X[X.EMPTY_KEY=9]="EMPTY_KEY"})(LevaErrors||(LevaErrors={}));const ErrorList={[LevaErrors.UNSUPPORTED_INPUT]:(X,Z)=>[`An input with type \`${X}\` input was found at path \`${Z}\` but it's not supported yet.`],[LevaErrors.NO_COMPONENT_FOR_TYPE]:(X,Z)=>[`Type \`${X}\` found at path \`${Z}\` can't be displayed in panel because no component supports it yet.`],[LevaErrors.UNKNOWN_INPUT]:(X,Z)=>[`input at path \`${X}\` is not recognized.`,Z],[LevaErrors.DUPLICATE_KEYS]:(X,Z,_)=>[`Key \`${X}\` of path \`${Z}\` already exists at path \`${_}\`. Even nested keys need to be unique. Rename one of the keys.`],[LevaErrors.ALREADY_REGISTERED_TYPE]:X=>[`Type ${X} has already been registered. You can't register a component with the same type.`],[LevaErrors.CLIPBOARD_ERROR]:X=>["Error copying the value",X],[LevaErrors.THEME_ERROR]:(X,Z)=>[`Error accessing the theme \`${X}.${Z}\` value.`],[LevaErrors.PATH_DOESNT_EXIST]:X=>[`Error getting the value at path \`${X}\`. There is probably an error in your \`render\` function.`],[LevaErrors.PATH_DOESNT_EXIST]:X=>[`Error accessing the value at path \`${X}\``],[LevaErrors.INPUT_TYPE_OVERRIDE]:(X,Z,_)=>[`Input at path \`${X}\` already exists with type: \`${Z}\`. Its type cannot be overridden with type \`${_}\`.`],[LevaErrors.EMPTY_KEY]:()=>["Keys can not be empty, if you want to hide a label use whitespace."]};function _log(X,Z,..._){const[K,...te]=ErrorList[Z](..._);console[X]("LEVA: "+K,...te)}const warn=_log.bind(null,"warn"),log$1=_log.bind(null,"log"),_excluded$a=["value"],_excluded2$4=["schema"],_excluded3$1=["value"],Schemas=[],Plugins={};function getValueType(X){let{value:Z}=X,_=_objectWithoutProperties$2(X,_excluded$a);for(let K of Schemas){const te=K(Z,_);if(te)return te}}function register(X,Z){let{schema:_}=Z,K=_objectWithoutProperties$2(Z,_excluded2$4);if(X in Plugins){warn(LevaErrors.ALREADY_REGISTERED_TYPE,X);return}Schemas.push((te,ne)=>_(te,ne)&&X),Plugins[X]=K}function createInternalPlugin(X){return X}function normalize$3$1(X,Z,_,K){const{normalize:te}=Plugins[X];if(te)return te(Z,_,K);if(typeof Z!="object"||!("value"in Z))return{value:Z};const{value:ne}=Z,oe=_objectWithoutProperties$2(Z,_excluded3$1);return{value:ne,settings:oe}}function sanitize$4(X,Z,_,K,te,ne){const{sanitize:oe}=Plugins[X];return oe?oe(Z,_,K,te,ne):Z}function format$2(X,Z,_){const{format:K}=Plugins[X];return K?K(Z,_):Z}function _defineProperty$3(X,Z,_){return Z in X?Object.defineProperty(X,Z,{value:_,enumerable:!0,configurable:!0,writable:!0}):X[Z]=_,X}function ownKeys$3(X,Z){var _=Object.keys(X);if(Object.getOwnPropertySymbols){var K=Object.getOwnPropertySymbols(X);Z&&(K=K.filter(function(te){return Object.getOwnPropertyDescriptor(X,te).enumerable})),_.push.apply(_,K)}return _}function _objectSpread2(X){for(var Z=1;Z<arguments.length;Z++){var _=arguments[Z]!=null?arguments[Z]:{};Z%2?ownKeys$3(Object(_),!0).forEach(function(K){_defineProperty$3(X,K,_[K])}):Object.getOwnPropertyDescriptors?Object.defineProperties(X,Object.getOwnPropertyDescriptors(_)):ownKeys$3(Object(_)).forEach(function(K){Object.defineProperty(X,K,Object.getOwnPropertyDescriptor(_,K))})}return X}const clamp=(X,Z,_)=>X>_?_:X<Z?Z:X,parseNumber=X=>{if(X===""||typeof X=="number")return X;try{const Z=evaluate(X);if(!isNaN(Z))return Z}catch{}return parseFloat(X)},log10=Math.log(10);function getStep(X){let Z=Math.abs(+String(X).replace(".",""));if(Z===0)return .01;for(;Z!==0&&Z%10===0;)Z/=10;const _=Math.floor(Math.log(Z)/log10)+1,K=Math.floor(Math.log10(Math.abs(X))),te=Math.pow(10,K-_);return Math.max(te,.001)}const range=(X,Z,_)=>_===Z?0:(clamp(X,Z,_)-Z)/(_-Z),invertedRange=(X,Z,_)=>X*(_-Z)+Z,getUid=()=>"_"+Math.random().toString(36).substr(2,9),parens=/\(([0-9+\-*/^ .]+)\)/,exp=/(\d+(?:\.\d+)?) ?\^ ?(\d+(?:\.\d+)?)/,mul=/(\d+(?:\.\d+)?) ?\* ?(\d+(?:\.\d+)?)/,div=/(\d+(?:\.\d+)?) ?\/ ?(\d+(?:\.\d+)?)/,add=/(\d+(?:\.\d+)?) ?\+ ?(\d+(?:\.\d+)?)/,sub=/(\d+(?:\.\d+)?) ?- ?(\d+(?:\.\d+)?)/;function evaluate(X){if(isNaN(Number(X)))if(parens.test(X)){const Z=X.replace(parens,(_,K)=>String(evaluate(K)));return evaluate(Z)}else if(exp.test(X)){const Z=X.replace(exp,(_,K,te)=>String(Math.pow(Number(K),Number(te))));return evaluate(Z)}else if(mul.test(X)){const Z=X.replace(mul,(_,K,te)=>String(Number(K)*Number(te)));return evaluate(Z)}else if(div.test(X)){const Z=X.replace(div,(_,K,te)=>{if(te!=0)return String(Number(K)/Number(te));throw new Error("Division by zero")});return evaluate(Z)}else if(add.test(X)){const Z=X.replace(add,(_,K,te)=>String(Number(K)+Number(te)));return evaluate(Z)}else if(sub.test(X)){const Z=X.replace(sub,(_,K,te)=>String(Number(K)-Number(te)));return evaluate(Z)}else return Number(X);return Number(X)}function pick(X,Z){return Z.reduce((_,K)=>(X&&X.hasOwnProperty(K)&&(_[K]=X[K]),_),{})}function omit(X,Z){const _=_objectSpread2({},X);return Z.forEach(K=>K in X&&delete _[K]),_}function mapArrayToKeys(X,Z){return X.reduce((_,K,te)=>Object.assign(_,{[Z[te]]:K}),{})}function isObject$1(X){return Object.prototype.toString.call(X)==="[object Object]"}const isEmptyObject=X=>isObject$1(X)&&Object.keys(X).length===0;let SpecialInputs;(function(X){X.BUTTON="BUTTON",X.BUTTON_GROUP="BUTTON_GROUP",X.MONITOR="MONITOR",X.FOLDER="FOLDER"})(SpecialInputs||(SpecialInputs={}));let LevaInputs;(function(X){X.SELECT="SELECT",X.IMAGE="IMAGE",X.NUMBER="NUMBER",X.COLOR="COLOR",X.STRING="STRING",X.BOOLEAN="BOOLEAN",X.INTERVAL="INTERVAL",X.VECTOR3D="VECTOR3D",X.VECTOR2D="VECTOR2D"})(LevaInputs||(LevaInputs={}));const _excluded$9=["type","__customInput"],_excluded2$3=["render","label","optional","order","disabled","hint","onChange","onEditStart","onEditEnd","transient"],_excluded3$2=["type"];function parseOptions(X,Z,_={},K){var te,ne;if(typeof X!="object"||Array.isArray(X))return{type:K,input:X,options:_objectSpread2({key:Z,label:Z,optional:!1,disabled:!1,order:0},_)};if("__customInput"in X){const{type:Ee,__customInput:We}=X,Ze=_objectWithoutProperties$2(X,_excluded$9);return parseOptions(We,Z,Ze,Ee)}const{render:oe,label:ie,optional:se,order:ae=0,disabled:ge,hint:ce,onChange:de,onEditStart:pe,onEditEnd:fe,transient:be}=X,me=_objectWithoutProperties$2(X,_excluded2$3),ye=_objectSpread2({render:oe,key:Z,label:ie??Z,hint:ce,transient:be??!!de,onEditStart:pe,onEditEnd:fe,disabled:ge,optional:se,order:ae},_);let{type:ve}=me,Be=_objectWithoutProperties$2(me,_excluded3$2);if(ve=K??ve,ve in SpecialInputs)return{type:ve,input:Be,options:ye};let Re;return K&&isObject$1(Be)&&"value"in Be?Re=Be.value:Re=isEmptyObject(Be)?void 0:Be,{type:ve,input:Re,options:_objectSpread2(_objectSpread2({},ye),{},{onChange:de,optional:(te=ye.optional)!==null&&te!==void 0?te:!1,disabled:(ne=ye.disabled)!==null&&ne!==void 0?ne:!1})}}function normalizeInput(X,Z,_,K){const te=parseOptions(X,Z),{type:ne,input:oe,options:ie}=te;if(ne)return ne in SpecialInputs?te:{type:ne,input:normalize$3$1(ne,oe,_,K),options:ie};let se=getValueType(oe);return se?{type:se,input:normalize$3$1(se,oe,_,K),options:ie}:(se=getValueType({value:oe}),se?{type:se,input:normalize$3$1(se,{value:oe},_,K),options:ie}:!1)}function updateInput(X,Z,_,K,te){const{value:ne,type:oe,settings:ie}=X;X.value=sanitizeValue({type:oe,value:ne,settings:ie},Z,_,K),X.fromPanel=te}const ValueError=function(Z,_,K){this.type="LEVA_ERROR",this.message="LEVA: "+Z,this.previousValue=_,this.error=K};function sanitizeValue({type:X,value:Z,settings:_},K,te,ne){const oe=X!=="SELECT"&&typeof K=="function"?K(Z):K;let ie;try{ie=sanitize$4(X,oe,_,Z,te,ne)}catch(se){throw new ValueError(`The value \`${K}\` did not result in a correct value.`,Z,se)}return dequal(ie,Z)?Z:ie}const debounce=(X,Z,_=!1)=>{let K=0;return function(){const te=arguments,ne=_&&!K,oe=()=>X.apply(this,te);window.clearTimeout(K),K=window.setTimeout(oe,Z),ne&&oe()}},multiplyStep=X=>X.shiftKey?5:X.altKey?1/5:1,_excluded$8$1=["value"],_excluded2$2$1=["min","max"],schema$3=X=>{if(typeof X=="number")return!0;if(typeof X=="string"){const Z=parseFloat(X);return isNaN(Z)?!1:X.substring((""+Z).length).trim().length<4}return!1},sanitize$3=(X,{min:Z=-1/0,max:_=1/0,suffix:K})=>{const te=parseFloat(X);if(X===""||isNaN(te))throw Error("Invalid number");const ne=clamp(te,Z,_);return K?ne+K:ne},format$1$1=(X,{pad:Z=0,suffix:_})=>{const K=parseFloat(X).toFixed(Z);return _?K+_:K},normalize$2$1=X=>{let{value:Z}=X,_=_objectWithoutProperties$2(X,_excluded$8$1);const{min:K=-1/0,max:te=1/0}=_,ne=_objectWithoutProperties$2(_,_excluded2$2$1);let oe=parseFloat(Z);const ie=typeof Z=="string"?Z.substring((""+oe).length):void 0;oe=clamp(oe,K,te);let se=_.step;se||(Number.isFinite(K)?Number.isFinite(te)?se=+(Math.abs(te-K)/100).toPrecision(1):se=+(Math.abs(oe-K)/100).toPrecision(1):Number.isFinite(te)&&(se=+(Math.abs(te-oe)/100).toPrecision(1)));const ae=se?getStep(se)*10:getStep(oe);se=se||ae/10;const ge=Math.round(clamp(Math.log10(1/ae),0,2));return{value:ie?oe+ie:oe,settings:_objectSpread2({initialValue:oe,step:se,pad:ge,min:K,max:te,suffix:ie},ne)}},sanitizeStep$1=(X,{step:Z,initialValue:_})=>{const K=Math.round((X-_)/Z);return _+K*Z};var props$3=Object.freeze({__proto__:null,schema:schema$3,sanitize:sanitize$3,format:format$1$1,normalize:normalize$2$1,sanitizeStep:sanitizeStep$1});function _extends$1(){return _extends$1=Object.assign?Object.assign.bind():function(X){for(var Z=1;Z<arguments.length;Z++){var _=arguments[Z];for(var K in _)Object.prototype.hasOwnProperty.call(_,K)&&(X[K]=_[K])}return X},_extends$1.apply(this,arguments)}const InputContext=reactExports.createContext({});function useInputContext(){return reactExports.useContext(InputContext)}const ThemeContext=reactExports.createContext(null),StoreContext=reactExports.createContext(null),PanelSettingsContext=reactExports.createContext(null);function useStoreContext(){return reactExports.useContext(StoreContext)}function usePanelSettingsContext(){return reactExports.useContext(PanelSettingsContext)}const getDefaultTheme=()=>({colors:{elevation1:"#292d39",elevation2:"#181c20",elevation3:"#373c4b",accent1:"#0066dc",accent2:"#007bff",accent3:"#3c93ff",highlight1:"#535760",highlight2:"#8c92a4",highlight3:"#fefefe",vivid1:"#ffcc00",folderWidgetColor:"$highlight2",folderTextColor:"$highlight3",toolTipBackground:"$highlight3",toolTipText:"$elevation2"},radii:{xs:"2px",sm:"3px",lg:"10px"},space:{xs:"3px",sm:"6px",md:"10px",rowGap:"7px",colGap:"7px"},fonts:{mono:"ui-monospace, SFMono-Regular, Menlo, 'Roboto Mono', monospace",sans:"system-ui, sans-serif"},fontSizes:{root:"11px",toolTip:"$root"},sizes:{rootWidth:"280px",controlWidth:"160px",numberInputMinWidth:"38px",scrubberWidth:"8px",scrubberHeight:"16px",rowHeight:"24px",folderTitleHeight:"20px",checkboxSize:"16px",joystickWidth:"100px",joystickHeight:"100px",colorPickerWidth:"$controlWidth",colorPickerHeight:"100px",imagePreviewWidth:"$controlWidth",imagePreviewHeight:"100px",monitorHeight:"60px",titleBarHeight:"39px"},shadows:{level1:"0 0 9px 0 #00000088",level2:"0 4px 14px #00000033"},borderWidths:{root:"0px",input:"1px",focus:"1px",hover:"1px",active:"1px",folder:"1px"},fontWeights:{label:"normal",folder:"normal",button:"normal"}});function createStateClass(X,Z){const[_,K]=X.split(" "),te={};return _!=="none"&&(te.boxShadow=`${Z.inset?"inset ":""}0 0 0 $borderWidths${[Z.key]} $colors${_!=="default"&&_||Z.borderColor}`),K&&(te.backgroundColor=K),te}const utils={$inputStyle:()=>X=>createStateClass(X,{key:"$input",borderColor:"$highlight1",inset:!0}),$focusStyle:()=>X=>createStateClass(X,{key:"$focus",borderColor:"$accent2"}),$hoverStyle:()=>X=>createStateClass(X,{key:"$hover",borderColor:"$accent1",inset:!0}),$activeStyle:()=>X=>createStateClass(X,{key:"$active",borderColor:"$accent1",inset:!0})},{styled,css,createTheme,globalCss,keyframes}=q$3({prefix:"leva",theme:getDefaultTheme(),utils:_objectSpread2(_objectSpread2({},utils),{},{$flex:()=>({display:"flex",alignItems:"center"}),$flexCenter:()=>({display:"flex",alignItems:"center",justifyContent:"center"}),$reset:()=>({outline:"none",fontSize:"inherit",fontWeight:"inherit",color:"inherit",fontFamily:"inherit",border:"none",backgroundColor:"transparent",appearance:"none"}),$draggable:()=>({touchAction:"none",WebkitUserDrag:"none",userSelect:"none"}),$focus:X=>({"&:focus":utils.$focusStyle()(X)}),$focusWithin:X=>({"&:focus-within":utils.$focusStyle()(X)}),$hover:X=>({"&:hover":utils.$hoverStyle()(X)}),$active:X=>({"&:active":utils.$activeStyle()(X)})})}),globalStyles=globalCss({".leva__panel__dragged":{WebkitUserDrag:"none",userSelect:"none",input:{userSelect:"none"},"*":{cursor:"ew-resize !important"}}});function mergeTheme(X){const Z=getDefaultTheme();if(!X)return{theme:Z,className:""};Object.keys(X).forEach(K=>{Object.assign(Z[K],X[K])});const _=createTheme(Z);return{theme:Z,className:_.className}}function useTh(X,Z){const{theme:_}=reactExports.useContext(ThemeContext);if(!(X in _)||!(Z in _[X]))return warn(LevaErrors.THEME_ERROR,X,Z),"";let K=Z;for(;;){let te=_[X][K];if(typeof te=="string"&&te.charAt(0)==="$")K=te.substr(1);else return te}}const StyledInput=styled("input",{$reset:"",padding:"0 $sm",width:0,minWidth:0,flex:1,height:"100%",variants:{levaType:{number:{textAlign:"right"}},as:{textarea:{padding:"$sm"}}}}),InnerLabel=styled("div",{$draggable:"",height:"100%",$flexCenter:"",position:"relative",padding:"0 $xs",fontSize:"0.8em",opacity:.8,cursor:"default",touchAction:"none",[`& + ${StyledInput}`]:{paddingLeft:0}}),InnerNumberLabel=styled(InnerLabel,{cursor:"ew-resize",marginRight:"-$xs",textTransform:"uppercase",opacity:.3,"&:hover":{opacity:1},variants:{dragging:{true:{backgroundColor:"$accent2",opacity:1}}}}),InputContainer=styled("div",{$flex:"",position:"relative",borderRadius:"$sm",overflow:"hidden",color:"inherit",height:"$rowHeight",backgroundColor:"$elevation3",$inputStyle:"$elevation1",$hover:"",$focusWithin:"",variants:{textArea:{true:{height:"auto"}}}}),_excluded$7$1=["innerLabel","value","onUpdate","onChange","onKeyDown","type","id","inputType","rows"],_excluded2$1$1=["onUpdate"];function ValueInput(X){let{innerLabel:Z,value:_,onUpdate:K,onChange:te,onKeyDown:ne,type:oe,id:ie,inputType:se="text",rows:ae=0}=X,ge=_objectWithoutProperties$2(X,_excluded$7$1);const{id:ce,emitOnEditStart:de,emitOnEditEnd:pe,disabled:fe}=useInputContext(),be=ie||ce,me=reactExports.useRef(null),ye=ae>0,ve=ye?"textarea":"input",Be=reactExports.useCallback(We=>Ze=>{const Ve=Ze.currentTarget.value;We(Ve)},[]);React.useEffect(()=>{const We=me.current,Ze=Be(Ve=>{K(Ve),pe()});return We==null||We.addEventListener("blur",Ze),()=>We==null?void 0:We.removeEventListener("blur",Ze)},[Be,K,pe]);const Re=reactExports.useCallback(We=>{We.key==="Enter"&&Be(K)(We)},[Be,K]),Ee=Object.assign({as:ve},ye?{rows:ae}:{},ge);return React.createElement(InputContainer,{textArea:ye},Z&&typeof Z=="string"?React.createElement(InnerLabel,null,Z):Z,React.createElement(StyledInput,_extends$1({levaType:oe,ref:me,id:be,type:se,autoComplete:"off",spellCheck:"false",value:_,onChange:Be(te),onFocus:()=>de(),onKeyPress:Re,onKeyDown:ne,disabled:fe},Ee)))}function NumberInput(X){let{onUpdate:Z}=X,_=_objectWithoutProperties$2(X,_excluded2$1$1);const K=reactExports.useCallback(ne=>Z(parseNumber(ne)),[Z]),te=reactExports.useCallback(ne=>{const oe=ne.key==="ArrowUp"?1:ne.key==="ArrowDown"?-1:0;if(oe){ne.preventDefault();const ie=ne.altKey?.1:ne.shiftKey?10:1;Z(se=>parseFloat(se)+oe*ie)}},[Z]);return React.createElement(ValueInput,_extends$1({},_,{onUpdate:K,onKeyDown:te,type:"number"}))}const StyledFolder=styled("div",{}),StyledWrapper=styled("div",{position:"relative",background:"$elevation2",transition:"height 300ms ease",variants:{fill:{true:{},false:{}},flat:{false:{},true:{}},isRoot:{true:{},false:{paddingLeft:"$md","&::after":{content:'""',position:"absolute",left:0,top:0,width:"$borderWidths$folder",height:"100%",backgroundColor:"$folderWidgetColor",opacity:.4,transform:"translateX(-50%)"}}}},compoundVariants:[{isRoot:!0,fill:!1,css:{overflowY:"auto",maxHeight:"calc(100vh - 20px - $$titleBarHeight)"}},{isRoot:!0,flat:!1,css:{borderRadius:"$lg"}}]}),StyledTitle=styled("div",{$flex:"",color:"$folderTextColor",userSelect:"none",cursor:"pointer",height:"$folderTitleHeight",fontWeight:"$folder","> svg":{marginLeft:-4,marginRight:4,cursor:"pointer",fill:"$folderWidgetColor",opacity:.6},"&:hover > svg":{fill:"$folderWidgetColor"},[`&:hover + ${StyledWrapper}::after`]:{opacity:.6},[`${StyledFolder}:hover > & + ${StyledWrapper}::after`]:{opacity:.6},[`${StyledFolder}:hover > & > svg`]:{opacity:1}}),StyledContent=styled("div",{position:"relative",display:"grid",gridTemplateColumns:"100%",rowGap:"$rowGap",transition:"opacity 250ms ease",variants:{toggled:{true:{opacity:1,transitionDelay:"250ms"},false:{opacity:0,transitionDelay:"0ms",pointerEvents:"none"}},isRoot:{true:{"& > div":{paddingLeft:"$md",paddingRight:"$md"},"& > div:first-of-type":{paddingTop:"$sm"},"& > div:last-of-type":{paddingBottom:"$sm"},[`> ${StyledFolder}:not(:first-of-type)`]:{paddingTop:"$sm",marginTop:"$md",borderTop:"$borderWidths$folder solid $colors$elevation1"}}}}}),StyledRow=styled("div",{position:"relative",zIndex:100,display:"grid",rowGap:"$rowGap",gridTemplateRows:"minmax($sizes$rowHeight, max-content)",alignItems:"center",color:"$highlight2",[`${StyledContent} > &`]:{"&:first-of-type":{marginTop:"$rowGap"},"&:last-of-type":{marginBottom:"$rowGap"}},variants:{disabled:{true:{pointerEvents:"none"},false:{"&:hover,&:focus-within":{color:"$highlight3"}}}}}),StyledInputRow=styled(StyledRow,{gridTemplateColumns:"auto $sizes$controlWidth",columnGap:"$colGap"}),CopyLabelContainer=styled("div",{$flex:"",height:"100%",position:"relative",overflow:"hidden","& > div":{marginLeft:"$colGap",padding:"0 $xs",opacity:.4},"& > div:hover":{opacity:.8},"& > div > svg":{display:"none",cursor:"pointer",width:13,minWidth:13,height:13,backgroundColor:"$elevation2"},"&:hover > div > svg":{display:"block"},variants:{align:{top:{height:"100%",alignItems:"flex-start",paddingTop:"$sm"}}}}),StyledOptionalToggle=styled("input",{$reset:"",height:0,width:0,opacity:0,margin:0,"& + label":{position:"relative",$flexCenter:"",height:"100%",userSelect:"none",cursor:"pointer",paddingLeft:2,paddingRight:"$sm",pointerEvents:"auto"},"& + label:after":{content:'""',width:6,height:6,backgroundColor:"$elevation3",borderRadius:"50%",$activeStyle:""},"&:focus + label:after":{$focusStyle:""},"& + label:active:after":{backgroundColor:"$accent1",$focusStyle:""},"&:checked + label:after":{backgroundColor:"$accent1"}}),StyledLabel=styled("label",{fontWeight:"$label",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap","& > svg":{display:"block"}}),StyledInputWrapper$1=styled("div",{opacity:1,variants:{disabled:{true:{opacity:.6,pointerEvents:"none",[`& ${StyledLabel}`]:{pointerEvents:"auto"}}}}}),Overlay=styled("div",{position:"fixed",top:0,bottom:0,right:0,left:0,zIndex:1e3,userSelect:"none"}),StyledToolTipContent=styled("div",{background:"$toolTipBackground",fontFamily:"$sans",fontSize:"$toolTip",padding:"$xs $sm",color:"$toolTipText",borderRadius:"$xs",boxShadow:"$level2",maxWidth:260}),ToolTipArrow=styled($a093c7e1ec25a057$export$21b07c8f274aebd5,{fill:"$toolTipBackground"});function Portal({children:X}){const{className:Z}=reactExports.useContext(ThemeContext);return React.createElement($f1701beae083dbae$export$be92b6f5f03c0fe9,{className:Z},X)}const _excluded$6$1=["align"];function OptionalToggle(){const{id:X,disable:Z,disabled:_}=useInputContext();return React.createElement(React.Fragment,null,React.createElement(StyledOptionalToggle,{id:X+"__disable",type:"checkbox",checked:!_,onChange:()=>Z(!_)}),React.createElement("label",{htmlFor:X+"__disable"}))}function RawLabel(X){const{id:Z,optional:_,hint:K}=useInputContext(),te=X.htmlFor||(Z?{htmlFor:Z}:null),ne=!K&&typeof X.children=="string"?{title:X.children}:null;return React.createElement(React.Fragment,null,_&&React.createElement(OptionalToggle,null),K!==void 0?React.createElement($a093c7e1ec25a057$export$be92b6f5f03c0fe9,null,React.createElement($a093c7e1ec25a057$export$41fb9f06171c75f4,{asChild:!0},React.createElement(StyledLabel,_extends$1({},te,X))),React.createElement($a093c7e1ec25a057$export$7c6e2c02157bb7d2,{side:"top",sideOffset:2},React.createElement(StyledToolTipContent,null,K,React.createElement(ToolTipArrow,null)))):React.createElement(StyledLabel,_extends$1({},te,ne,X)))}function Label(X){let{align:Z}=X,_=_objectWithoutProperties$2(X,_excluded$6$1);const{value:K,label:te,key:ne,disabled:oe}=useInputContext(),{hideCopyButton:ie}=usePanelSettingsContext(),se=!ie&&ne!==void 0,[ae,ge]=reactExports.useState(!1),ce=async()=>{try{await navigator.clipboard.writeText(JSON.stringify({[ne]:K??""})),ge(!0)}catch{warn(LevaErrors.CLIPBOARD_ERROR,{[ne]:K})}};return React.createElement(CopyLabelContainer,{align:Z,onPointerLeave:()=>ge(!1)},React.createElement(RawLabel,_),se&&!oe&&React.createElement("div",{title:`Click to copy ${typeof te=="string"?te:ne} value`},ae?React.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor"},React.createElement("path",{d:"M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"}),React.createElement("path",{fillRule:"evenodd",d:"M4 5a2 2 0 012-2 3 3 0 003 3h2a3 3 0 003-3 2 2 0 012 2v11a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm9.707 5.707a1 1 0 00-1.414-1.414L9 12.586l-1.293-1.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})):React.createElement("svg",{onClick:ce,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor"},React.createElement("path",{d:"M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z"}),React.createElement("path",{d:"M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z"}))))}const _excluded$5$1=["toggled"],Svg=styled("svg",{fill:"currentColor",transition:"transform 350ms ease, fill 250ms ease"});function Chevron(X){let{toggled:Z}=X,_=_objectWithoutProperties$2(X,_excluded$5$1);return React.createElement(Svg,_extends$1({width:"9",height:"5",viewBox:"0 0 9 5",xmlns:"http://www.w3.org/2000/svg",style:{transform:`rotate(${Z?0:-90}deg)`}},_),React.createElement("path",{d:"M3.8 4.4c.4.3 1 .3 1.4 0L8 1.7A1 1 0 007.4 0H1.6a1 1 0 00-.7 1.7l3 2.7z"}))}const _excluded$4$1=["input"];function Row(X){let{input:Z}=X,_=_objectWithoutProperties$2(X,_excluded$4$1);return Z?React.createElement(StyledInputRow,_):React.createElement(StyledRow,_)}function useInputSetters({value:X,type:Z,settings:_,setValue:K}){const[te,ne]=reactExports.useState(format$2(Z,X,_)),oe=reactExports.useRef(X),ie=reactExports.useRef(_);ie.current=_;const se=reactExports.useCallback(ge=>ne(format$2(Z,ge,ie.current)),[Z]),ae=reactExports.useCallback(ge=>{try{K(ge)}catch(ce){const{type:de,previousValue:pe}=ce;if(de!=="LEVA_ERROR")throw ce;se(pe)}},[se,K]);return reactExports.useEffect(()=>{dequal(X,oe.current)||se(X),oe.current=X},[X,se]),{displayValue:te,onChange:ne,onUpdate:ae}}function useDrag(X,Z){const{emitOnEditStart:_,emitOnEditEnd:K}=useInputContext();return useDrag$1(te=>{te.first&&(document.body.classList.add("leva__panel__dragged"),_==null||_());const ne=X(te);return te.last&&(document.body.classList.remove("leva__panel__dragged"),K==null||K()),ne},Z)}function useCanvas2d(X){const Z=reactExports.useRef(null),_=reactExports.useRef(null),K=reactExports.useRef(!1);return reactExports.useEffect(()=>{const te=debounce(()=>{Z.current.width=Z.current.offsetWidth*window.devicePixelRatio,Z.current.height=Z.current.offsetHeight*window.devicePixelRatio,X(Z.current,_.current)},250);return window.addEventListener("resize",te),K.current||(te(),K.current=!0),()=>window.removeEventListener("resize",te)},[X]),reactExports.useEffect(()=>{_.current=Z.current.getContext("2d")},[]),[Z,_]}function useTransform(){const X=reactExports.useRef(null),Z=reactExports.useRef({x:0,y:0}),_=reactExports.useCallback(K=>{Object.assign(Z.current,K),X.current&&(X.current.style.transform=`translate3d(${Z.current.x}px, ${Z.current.y}px, 0)`)},[]);return[X,_]}const _excluded$3$1=["__refCount"],getInputAtPath=(X,Z)=>{if(!X[Z])return null;const _=X[Z];return _objectWithoutProperties$2(_,_excluded$3$1)};function useInput(X){const Z=useStoreContext(),[_,K]=reactExports.useState(getInputAtPath(Z.getData(),X)),te=reactExports.useCallback(ae=>Z.setValueAtPath(X,ae,!0),[X,Z]),ne=reactExports.useCallback(ae=>Z.setSettingsAtPath(X,ae),[X,Z]),oe=reactExports.useCallback(ae=>Z.disableInputAtPath(X,ae),[X,Z]),ie=reactExports.useCallback(()=>Z.emitOnEditStart(X),[X,Z]),se=reactExports.useCallback(()=>Z.emitOnEditEnd(X),[X,Z]);return reactExports.useEffect(()=>{K(getInputAtPath(Z.getData(),X));const ae=Z.useStore.subscribe(ge=>getInputAtPath(ge.data,X),K,{equalityFn:shallow});return()=>ae()},[Z,X]),[_,{set:te,setSettings:ne,disable:oe,storeId:Z.storeId,emitOnEditStart:ie,emitOnEditEnd:se}]}const RangeGrid=styled("div",{variants:{hasRange:{true:{position:"relative",display:"grid",gridTemplateColumns:"auto $sizes$numberInputMinWidth",columnGap:"$colGap",alignItems:"center"}}}}),Range=styled("div",{position:"relative",width:"100%",height:2,borderRadius:"$xs",backgroundColor:"$elevation1"}),Scrubber=styled("div",{position:"absolute",width:"$scrubberWidth",height:"$scrubberHeight",borderRadius:"$xs",boxShadow:"0 0 0 2px $colors$elevation2",backgroundColor:"$accent2",cursor:"pointer",$active:"none $accent1",$hover:"none $accent3",variants:{position:{left:{borderTopRightRadius:0,borderBottomRightRadius:0,transform:"translateX(calc(-0.5 * ($sizes$scrubberWidth + 4px)))"},right:{borderTopLeftRadius:0,borderBottomLeftRadius:0,transform:"translateX(calc(0.5 * ($sizes$scrubberWidth + 4px)))"}}}}),RangeWrapper=styled("div",{position:"relative",$flex:"",height:"100%",cursor:"pointer",touchAction:"none"}),Indicator=styled("div",{position:"absolute",height:"100%",backgroundColor:"$accent2"});function RangeSlider({value:X,min:Z,max:_,onDrag:K,step:te,initialValue:ne}){const oe=reactExports.useRef(null),ie=reactExports.useRef(null),se=reactExports.useRef(0),ae=useTh("sizes","scrubberWidth"),ge=useDrag(({event:de,first:pe,xy:[fe],movement:[be],memo:me})=>{if(pe){const{width:ve,left:Be}=oe.current.getBoundingClientRect();se.current=ve-parseFloat(ae),me=(de==null?void 0:de.target)===ie.current?X:invertedRange((fe-Be)/ve,Z,_)}const ye=me+invertedRange(be/se.current,0,_-Z);return K(sanitizeStep$1(ye,{step:te,initialValue:ne})),me}),ce=range(X,Z,_);return React.createElement(RangeWrapper,_extends$1({ref:oe},ge()),React.createElement(Range,null,React.createElement(Indicator,{style:{left:0,right:`${(1-ce)*100}%`}})),React.createElement(Scrubber,{ref:ie,style:{left:`calc(${ce} * (100% - ${ae}))`}}))}const DraggableLabel=React.memo(({label:X,onUpdate:Z,step:_,innerLabelTrim:K})=>{const[te,ne]=reactExports.useState(!1),oe=useDrag(({active:ie,delta:[se],event:ae,memo:ge=0,first:ce,last:de,target:pe})=>(ce&&pe.requestPointerLock(),de&&document.exitPointerLock(),ne(ie),ge+=se/2,Math.abs(ge)>=1&&(Z(fe=>parseFloat(fe)+Math.floor(ge)*_*multiplyStep(ae)),ge=0),ge));return React.createElement(InnerNumberLabel,_extends$1({dragging:te,title:X.length>1?X:""},oe()),X.slice(0,K))});function Number$1({label:X,id:Z,displayValue:_,onUpdate:K,onChange:te,settings:ne,innerLabelTrim:oe=1}){const ie=oe>0&&React.createElement(DraggableLabel,{label:X,step:ne.step,onUpdate:K,innerLabelTrim:oe});return React.createElement(NumberInput,{id:Z,value:String(_),onUpdate:K,onChange:te,innerLabel:ie})}function NumberComponent(){const X=useInputContext(),{label:Z,value:_,onUpdate:K,settings:te,id:ne}=X,{min:oe,max:ie}=te,se=ie!==1/0&&oe!==-1/0;return React.createElement(Row,{input:!0},React.createElement(Label,null,Z),React.createElement(RangeGrid,{hasRange:se},se&&React.createElement(RangeSlider,_extends$1({value:parseFloat(_),onDrag:K},te)),React.createElement(Number$1,_extends$1({},X,{id:ne,label:"value",innerLabelTrim:se?0:1}))))}const{sanitizeStep}=props$3,rest=_objectWithoutProperties$2(props$3,["sanitizeStep"]);var number$1=_objectSpread2({component:NumberComponent},rest);const schema$2$1=(X,Z)=>v8n().schema({options:v8n().passesAnyOf(v8n().object(),v8n().array())}).test(Z),sanitize$2$1=(X,{values:Z})=>{if(Z.indexOf(X)<0)throw Error("Selected value doesn't match Select options");return X},format$3=(X,{values:Z})=>Z.indexOf(X),normalize$1$1=X=>{let{value:Z,options:_}=X,K,te;return Array.isArray(_)?(te=_,K=_.map(ne=>String(ne))):(te=Object.values(_),K=Object.keys(_)),"value"in X?te.includes(Z)||(K.unshift(String(Z)),te.unshift(Z)):Z=te[0],Object.values(_).includes(Z)||(_[String(Z)]=Z),{value:Z,settings:{keys:K,values:te}}};var props$2$1=Object.freeze({__proto__:null,schema:schema$2$1,sanitize:sanitize$2$1,format:format$3,normalize:normalize$1$1});const SelectContainer=styled("div",{$flexCenter:"",position:"relative","> svg":{pointerEvents:"none",position:"absolute",right:"$md"}}),NativeSelect=styled("select",{position:"absolute",top:0,left:0,width:"100%",height:"100%",opacity:0}),PresentationalSelect=styled("div",{display:"flex",alignItems:"center",width:"100%",height:"$rowHeight",backgroundColor:"$elevation3",borderRadius:"$sm",padding:"0 $sm",cursor:"pointer",[`${NativeSelect}:focus + &`]:{$focusStyle:""},[`${NativeSelect}:hover + &`]:{$hoverStyle:""}});function Select({displayValue:X,value:Z,onUpdate:_,id:K,settings:te,disabled:ne}){const{keys:oe,values:ie}=te,se=reactExports.useRef();return Z===ie[X]&&(se.current=oe[X]),React.createElement(SelectContainer,null,React.createElement(NativeSelect,{id:K,value:X,onChange:ae=>_(ie[Number(ae.currentTarget.value)]),disabled:ne},oe.map((ae,ge)=>React.createElement("option",{key:ae,value:ge},ae))),React.createElement(PresentationalSelect,null,se.current),React.createElement(Chevron,{toggled:!0}))}function SelectComponent(){const{label:X,value:Z,displayValue:_,onUpdate:K,id:te,disabled:ne,settings:oe}=useInputContext();return React.createElement(Row,{input:!0},React.createElement(Label,null,X),React.createElement(Select,{id:te,value:Z,displayValue:_,onUpdate:K,settings:oe,disabled:ne}))}var select=_objectSpread2({component:SelectComponent},props$2$1);const schema$1$1=X=>v8n().string().test(X),sanitize$1$1=X=>{if(typeof X!="string")throw Error("Invalid string");return X},normalize$4=({value:X,editable:Z=!0,rows:_=!1})=>({value:X,settings:{editable:Z,rows:typeof _=="number"?_:_?5:0}});var props$1$1=Object.freeze({__proto__:null,schema:schema$1$1,sanitize:sanitize$1$1,normalize:normalize$4});const _excluded$2$1=["displayValue","onUpdate","onChange","editable"],NonEditableString=styled("div",{whiteSpace:"pre-wrap"});function String$1(X){let{displayValue:Z,onUpdate:_,onChange:K,editable:te=!0}=X,ne=_objectWithoutProperties$2(X,_excluded$2$1);return te?React.createElement(ValueInput,_extends$1({value:Z,onUpdate:_,onChange:K},ne)):React.createElement(NonEditableString,null,Z)}function StringComponent(){const{label:X,settings:Z,displayValue:_,onUpdate:K,onChange:te}=useInputContext();return React.createElement(Row,{input:!0},React.createElement(Label,null,X),React.createElement(String$1,_extends$1({displayValue:_,onUpdate:K,onChange:te},Z)))}var string=_objectSpread2({component:StringComponent},props$1$1);const schema$4=X=>v8n().boolean().test(X),sanitize$5=X=>{if(typeof X!="boolean")throw Error("Invalid boolean");return X};var props$4=Object.freeze({__proto__:null,schema:schema$4,sanitize:sanitize$5});const StyledInputWrapper=styled("div",{position:"relative",$flex:"",height:"$rowHeight",input:{$reset:"",height:0,width:0,opacity:0,margin:0},label:{position:"relative",$flexCenter:"",userSelect:"none",cursor:"pointer",height:"$checkboxSize",width:"$checkboxSize",backgroundColor:"$elevation3",borderRadius:"$sm",$hover:""},"input:focus + label":{$focusStyle:""},"input:focus:checked + label, input:checked + label:hover":{$hoverStyle:"$accent3"},"input + label:active":{backgroundColor:"$accent1"},"input:checked + label:active":{backgroundColor:"$accent1"},"label > svg":{display:"none",width:"90%",height:"90%",stroke:"$highlight3"},"input:checked + label":{backgroundColor:"$accent2"},"input:checked + label > svg":{display:"block"}});function Boolean$1({value:X,onUpdate:Z,id:_,disabled:K}){return React.createElement(StyledInputWrapper,null,React.createElement("input",{id:_,type:"checkbox",checked:X,onChange:te=>Z(te.currentTarget.checked),disabled:K}),React.createElement("label",{htmlFor:_},React.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},React.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"}))))}function BooleanComponent(){const{label:X,value:Z,onUpdate:_,disabled:K,id:te}=useInputContext();return React.createElement(Row,{input:!0},React.createElement(Label,null,X),React.createElement(Boolean$1,{value:Z,onUpdate:_,id:te,disabled:K}))}var boolean=_objectSpread2({component:BooleanComponent},props$4);const _excluded$1$1=["locked"];function Coordinate({value:X,id:Z,valueKey:_,settings:K,onUpdate:te,innerLabelTrim:ne}){const oe=reactExports.useRef(X[_]);oe.current=X[_];const ie=reactExports.useCallback(ae=>te({[_]:sanitizeValue({type:"NUMBER",value:oe.current,settings:K},ae)}),[te,K,_]),se=useInputSetters({type:"NUMBER",value:X[_],settings:K,setValue:ie});return React.createElement(Number$1,{id:Z,label:_,value:X[_],displayValue:se.displayValue,onUpdate:se.onUpdate,onChange:se.onChange,settings:K,innerLabelTrim:ne})}const Container$2=styled("div",{display:"grid",columnGap:"$colGap",gridAutoFlow:"column dense",alignItems:"center",variants:{withLock:{true:{gridTemplateColumns:"10px auto","> svg":{cursor:"pointer"}}}}});function Lock(X){let{locked:Z}=X,_=_objectWithoutProperties$2(X,_excluded$1$1);return React.createElement("svg",_extends$1({width:"10",height:"10",viewBox:"0 0 15 15",fill:"none",xmlns:"http://www.w3.org/2000/svg"},_),Z?React.createElement("path",{d:"M5 4.63601C5 3.76031 5.24219 3.1054 5.64323 2.67357C6.03934 2.24705 6.64582 1.9783 7.5014 1.9783C8.35745 1.9783 8.96306 2.24652 9.35823 2.67208C9.75838 3.10299 10 3.75708 10 4.63325V5.99999H5V4.63601ZM4 5.99999V4.63601C4 3.58148 4.29339 2.65754 4.91049 1.99307C5.53252 1.32329 6.42675 0.978302 7.5014 0.978302C8.57583 0.978302 9.46952 1.32233 10.091 1.99162C10.7076 2.65557 11 3.57896 11 4.63325V5.99999H12C12.5523 5.99999 13 6.44771 13 6.99999V13C13 13.5523 12.5523 14 12 14H3C2.44772 14 2 13.5523 2 13V6.99999C2 6.44771 2.44772 5.99999 3 5.99999H4ZM3 6.99999H12V13H3V6.99999Z",fill:"currentColor",fillRule:"evenodd",clipRule:"evenodd"}):React.createElement("path",{d:"M9 3.63601C9 2.76044 9.24207 2.11211 9.64154 1.68623C10.0366 1.26502 10.6432 1 11.5014 1C12.4485 1 13.0839 1.30552 13.4722 1.80636C13.8031 2.23312 14 2.84313 14 3.63325H15C15 2.68242 14.7626 1.83856 14.2625 1.19361C13.6389 0.38943 12.6743 0 11.5014 0C10.4294 0 9.53523 0.337871 8.91218 1.0021C8.29351 1.66167 8 2.58135 8 3.63601V6H1C0.447715 6 0 6.44772 0 7V13C0 13.5523 0.447715 14 1 14H10C10.5523 14 11 13.5523 11 13V7C11 6.44772 10.5523 6 10 6H9V3.63601ZM1 7H10V13H1V7Z",fill:"currentColor",fillRule:"evenodd",clipRule:"evenodd"}))}function Vector({value:X,onUpdate:Z,settings:_,innerLabelTrim:K}){const{id:te,setSettings:ne}=useInputContext(),{lock:oe,locked:ie}=_;return React.createElement(Container$2,{withLock:oe},oe&&React.createElement(Lock,{locked:ie,onClick:()=>ne({locked:!ie})}),Object.keys(X).map((se,ae)=>React.createElement(Coordinate,{id:ae===0?te:`${te}.${se}`,key:se,valueKey:se,value:X,settings:_[se],onUpdate:Z,innerLabelTrim:K})))}const normalizeKeyedNumberSettings=(X,Z)=>{const _={};let K=0,te=1/0;Object.entries(X).forEach(([ne,oe])=>{_[ne]=normalize$2$1(_objectSpread2({value:oe},Z[ne])).settings,K=Math.max(K,_[ne].step),te=Math.min(te,_[ne].pad)});for(let ne in _){const{step:oe,min:ie,max:se}=Z[ne]||{};!isFinite(oe)&&(!isFinite(ie)||!isFinite(se))&&(_[ne].step=K,_[ne].pad=te)}return _},_excluded$b=["lock"],_excluded2$5=["value"];function getVectorSchema(X){const Z=v8n().array().length(X).every.number(),_=K=>{if(!K||typeof K!="object")return!1;const te=Object.values(K);return te.length===X&&te.every(ne=>isFinite(ne))};return K=>Z.test(K)||_(K)}function getVectorType(X){return Array.isArray(X)?"array":"object"}function convert$1(X,Z,_){return getVectorType(X)===Z?X:Z==="array"?Object.values(X):mapArrayToKeys(X,_)}const sanitizeVector=(X,Z,_)=>{const K=convert$1(X,"object",Z.keys);for(let oe in K)K[oe]=sanitize$3(K[oe],Z[oe]);const te=Object.keys(K);let ne={};if(te.length===Z.keys.length)ne=K;else{const oe=convert$1(_,"object",Z.keys);if(te.length===1&&Z.locked){const ie=te[0],se=K[ie],ae=oe[ie],ge=ae!==0?se/ae:1;for(let ce in oe)ce===ie?ne[ie]=se:ne[ce]=oe[ce]*ge}else ne=_objectSpread2(_objectSpread2({},oe),K)}return convert$1(ne,Z.format,Z.keys)},formatVector=(X,Z)=>convert$1(X,"object",Z.keys),isNumberSettings=X=>!!X&&("step"in X||"min"in X||"max"in X);function normalizeVector(X,Z,_=[]){const{lock:K=!1}=Z,te=_objectWithoutProperties$2(Z,_excluded$b),ne=Array.isArray(X)?"array":"object",oe=ne==="object"?Object.keys(X):_,ie=convert$1(X,"object",oe),se=isNumberSettings(te)?oe.reduce((ge,ce)=>Object.assign(ge,{[ce]:te}),{}):te,ae=normalizeKeyedNumberSettings(ie,se);return{value:ne==="array"?X:ie,settings:_objectSpread2(_objectSpread2({},ae),{},{format:ne,keys:oe,lock:K,locked:!1})}}function getVectorPlugin(X){return{schema:getVectorSchema(X.length),normalize:Z=>{let{value:_}=Z,K=_objectWithoutProperties$2(Z,_excluded2$5);return normalizeVector(_,K,X)},format:(Z,_)=>formatVector(Z,_),sanitize:(Z,_,K)=>sanitizeVector(Z,_,K)}}var r$1={grad:.9,turn:360,rad:360/(2*Math.PI)},t=function(X){return typeof X=="string"?X.length>0:typeof X=="number"},n=function(X,Z,_){return Z===void 0&&(Z=0),_===void 0&&(_=Math.pow(10,Z)),Math.round(_*X)/_+0},e$1=function(X,Z,_){return Z===void 0&&(Z=0),_===void 0&&(_=1),X>_?_:X>Z?X:Z},u$1=function(X){return(X=isFinite(X)?X%360:0)>0?X:X+360},a$2=function(X){return{r:e$1(X.r,0,255),g:e$1(X.g,0,255),b:e$1(X.b,0,255),a:e$1(X.a)}},o=function(X){return{r:n(X.r),g:n(X.g),b:n(X.b),a:n(X.a,3)}},i$1=/^#([0-9a-f]{3,8})$/i,s$2=function(X){var Z=X.toString(16);return Z.length<2?"0"+Z:Z},h$1=function(X){var Z=X.r,_=X.g,K=X.b,te=X.a,ne=Math.max(Z,_,K),oe=ne-Math.min(Z,_,K),ie=oe?ne===Z?(_-K)/oe:ne===_?2+(K-Z)/oe:4+(Z-_)/oe:0;return{h:60*(ie<0?ie+6:ie),s:ne?oe/ne*100:0,v:ne/255*100,a:te}},b$3=function(X){var Z=X.h,_=X.s,K=X.v,te=X.a;Z=Z/360*6,_/=100,K/=100;var ne=Math.floor(Z),oe=K*(1-_),ie=K*(1-(Z-ne)*_),se=K*(1-(1-Z+ne)*_),ae=ne%6;return{r:255*[K,ie,oe,oe,se,K][ae],g:255*[se,K,K,ie,oe,oe][ae],b:255*[oe,oe,se,K,K,ie][ae],a:te}},g$1=function(X){return{h:u$1(X.h),s:e$1(X.s,0,100),l:e$1(X.l,0,100),a:e$1(X.a)}},d$1=function(X){return{h:n(X.h),s:n(X.s),l:n(X.l),a:n(X.a,3)}},f$1=function(X){return b$3((_=(Z=X).s,{h:Z.h,s:(_*=((K=Z.l)<50?K:100-K)/100)>0?2*_/(K+_)*100:0,v:K+_,a:Z.a}));var Z,_,K},c$3=function(X){return{h:(Z=h$1(X)).h,s:(te=(200-(_=Z.s))*(K=Z.v)/100)>0&&te<200?_*K/100/(te<=100?te:200-te)*100:0,l:te/2,a:Z.a};var Z,_,K,te},l=/^hsla?\(\s*([+-]?\d*\.?\d+)(deg|rad|grad|turn)?\s*,\s*([+-]?\d*\.?\d+)%\s*,\s*([+-]?\d*\.?\d+)%\s*(?:,\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,p$1=/^hsla?\(\s*([+-]?\d*\.?\d+)(deg|rad|grad|turn)?\s+([+-]?\d*\.?\d+)%\s+([+-]?\d*\.?\d+)%\s*(?:\/\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,v$2=/^rgba?\(\s*([+-]?\d*\.?\d+)(%)?\s*,\s*([+-]?\d*\.?\d+)(%)?\s*,\s*([+-]?\d*\.?\d+)(%)?\s*(?:,\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,m$2=/^rgba?\(\s*([+-]?\d*\.?\d+)(%)?\s+([+-]?\d*\.?\d+)(%)?\s+([+-]?\d*\.?\d+)(%)?\s*(?:\/\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,y$1={string:[[function(X){var Z=i$1.exec(X);return Z?(X=Z[1]).length<=4?{r:parseInt(X[0]+X[0],16),g:parseInt(X[1]+X[1],16),b:parseInt(X[2]+X[2],16),a:X.length===4?n(parseInt(X[3]+X[3],16)/255,2):1}:X.length===6||X.length===8?{r:parseInt(X.substr(0,2),16),g:parseInt(X.substr(2,2),16),b:parseInt(X.substr(4,2),16),a:X.length===8?n(parseInt(X.substr(6,2),16)/255,2):1}:null:null},"hex"],[function(X){var Z=v$2.exec(X)||m$2.exec(X);return Z?Z[2]!==Z[4]||Z[4]!==Z[6]?null:a$2({r:Number(Z[1])/(Z[2]?100/255:1),g:Number(Z[3])/(Z[4]?100/255:1),b:Number(Z[5])/(Z[6]?100/255:1),a:Z[7]===void 0?1:Number(Z[7])/(Z[8]?100:1)}):null},"rgb"],[function(X){var Z=l.exec(X)||p$1.exec(X);if(!Z)return null;var _,K,te=g$1({h:(_=Z[1],K=Z[2],K===void 0&&(K="deg"),Number(_)*(r$1[K]||1)),s:Number(Z[3]),l:Number(Z[4]),a:Z[5]===void 0?1:Number(Z[5])/(Z[6]?100:1)});return f$1(te)},"hsl"]],object:[[function(X){var Z=X.r,_=X.g,K=X.b,te=X.a,ne=te===void 0?1:te;return t(Z)&&t(_)&&t(K)?a$2({r:Number(Z),g:Number(_),b:Number(K),a:Number(ne)}):null},"rgb"],[function(X){var Z=X.h,_=X.s,K=X.l,te=X.a,ne=te===void 0?1:te;if(!t(Z)||!t(_)||!t(K))return null;var oe=g$1({h:Number(Z),s:Number(_),l:Number(K),a:Number(ne)});return f$1(oe)},"hsl"],[function(X){var Z=X.h,_=X.s,K=X.v,te=X.a,ne=te===void 0?1:te;if(!t(Z)||!t(_)||!t(K))return null;var oe=function(ie){return{h:u$1(ie.h),s:e$1(ie.s,0,100),v:e$1(ie.v,0,100),a:e$1(ie.a)}}({h:Number(Z),s:Number(_),v:Number(K),a:Number(ne)});return b$3(oe)},"hsv"]]},N=function(X,Z){for(var _=0;_<Z.length;_++){var K=Z[_][0](X);if(K)return[K,Z[_][1]]}return[null,void 0]},x=function(X){return typeof X=="string"?N(X.trim(),y$1.string):typeof X=="object"&&X!==null?N(X,y$1.object):[null,void 0]},I$1=function(X){return x(X)[1]},M=function(X,Z){var _=c$3(X);return{h:_.h,s:e$1(_.s+100*Z,0,100),l:_.l,a:_.a}},H=function(X){return(299*X.r+587*X.g+114*X.b)/1e3/255},$$1=function(X,Z){var _=c$3(X);return{h:_.h,s:_.s,l:e$1(_.l+100*Z,0,100),a:_.a}},j=function(){function X(Z){this.parsed=x(Z)[0],this.rgba=this.parsed||{r:0,g:0,b:0,a:1}}return X.prototype.isValid=function(){return this.parsed!==null},X.prototype.brightness=function(){return n(H(this.rgba),2)},X.prototype.isDark=function(){return H(this.rgba)<.5},X.prototype.isLight=function(){return H(this.rgba)>=.5},X.prototype.toHex=function(){return Z=o(this.rgba),_=Z.r,K=Z.g,te=Z.b,oe=(ne=Z.a)<1?s$2(n(255*ne)):"","#"+s$2(_)+s$2(K)+s$2(te)+oe;var Z,_,K,te,ne,oe},X.prototype.toRgb=function(){return o(this.rgba)},X.prototype.toRgbString=function(){return Z=o(this.rgba),_=Z.r,K=Z.g,te=Z.b,(ne=Z.a)<1?"rgba("+_+", "+K+", "+te+", "+ne+")":"rgb("+_+", "+K+", "+te+")";var Z,_,K,te,ne},X.prototype.toHsl=function(){return d$1(c$3(this.rgba))},X.prototype.toHslString=function(){return Z=d$1(c$3(this.rgba)),_=Z.h,K=Z.s,te=Z.l,(ne=Z.a)<1?"hsla("+_+", "+K+"%, "+te+"%, "+ne+")":"hsl("+_+", "+K+"%, "+te+"%)";var Z,_,K,te,ne},X.prototype.toHsv=function(){return Z=h$1(this.rgba),{h:n(Z.h),s:n(Z.s),v:n(Z.v),a:n(Z.a,3)};var Z},X.prototype.invert=function(){return w({r:255-(Z=this.rgba).r,g:255-Z.g,b:255-Z.b,a:Z.a});var Z},X.prototype.saturate=function(Z){return Z===void 0&&(Z=.1),w(M(this.rgba,Z))},X.prototype.desaturate=function(Z){return Z===void 0&&(Z=.1),w(M(this.rgba,-Z))},X.prototype.grayscale=function(){return w(M(this.rgba,-1))},X.prototype.lighten=function(Z){return Z===void 0&&(Z=.1),w($$1(this.rgba,Z))},X.prototype.darken=function(Z){return Z===void 0&&(Z=.1),w($$1(this.rgba,-Z))},X.prototype.rotate=function(Z){return Z===void 0&&(Z=15),this.hue(this.hue()+Z)},X.prototype.alpha=function(Z){return typeof Z=="number"?w({r:(_=this.rgba).r,g:_.g,b:_.b,a:Z}):n(this.rgba.a,3);var _},X.prototype.hue=function(Z){var _=c$3(this.rgba);return typeof Z=="number"?w({h:Z,s:_.s,l:_.l,a:_.a}):n(_.h)},X.prototype.isEqual=function(Z){return this.toHex()===w(Z).toHex()},X}(),w=function(X){return X instanceof j?X:new j(X)},S$1=[],k$1=function(X){X.forEach(function(Z){S$1.indexOf(Z)<0&&(Z(j,y$1),S$1.push(Z))})};function namesPlugin(X,Z){var _={white:"#ffffff",bisque:"#ffe4c4",blue:"#0000ff",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",antiquewhite:"#faebd7",aqua:"#00ffff",azure:"#f0ffff",whitesmoke:"#f5f5f5",papayawhip:"#ffefd5",plum:"#dda0dd",blanchedalmond:"#ffebcd",black:"#000000",gold:"#ffd700",goldenrod:"#daa520",gainsboro:"#dcdcdc",cornsilk:"#fff8dc",cornflowerblue:"#6495ed",burlywood:"#deb887",aquamarine:"#7fffd4",beige:"#f5f5dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkkhaki:"#bdb76b",darkgray:"#a9a9a9",darkgreen:"#006400",darkgrey:"#a9a9a9",peachpuff:"#ffdab9",darkmagenta:"#8b008b",darkred:"#8b0000",darkorchid:"#9932cc",darkorange:"#ff8c00",darkslateblue:"#483d8b",gray:"#808080",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",deeppink:"#ff1493",deepskyblue:"#00bfff",wheat:"#f5deb3",firebrick:"#b22222",floralwhite:"#fffaf0",ghostwhite:"#f8f8ff",darkviolet:"#9400d3",magenta:"#ff00ff",green:"#008000",dodgerblue:"#1e90ff",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",blueviolet:"#8a2be2",forestgreen:"#228b22",lawngreen:"#7cfc00",indianred:"#cd5c5c",indigo:"#4b0082",fuchsia:"#ff00ff",brown:"#a52a2a",maroon:"#800000",mediumblue:"#0000cd",lightcoral:"#f08080",darkturquoise:"#00ced1",lightcyan:"#e0ffff",ivory:"#fffff0",lightyellow:"#ffffe0",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",linen:"#faf0e6",mediumaquamarine:"#66cdaa",lemonchiffon:"#fffacd",lime:"#00ff00",khaki:"#f0e68c",mediumseagreen:"#3cb371",limegreen:"#32cd32",mediumspringgreen:"#00fa9a",lightskyblue:"#87cefa",lightblue:"#add8e6",midnightblue:"#191970",lightpink:"#ffb6c1",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",mintcream:"#f5fffa",lightslategray:"#778899",lightslategrey:"#778899",navajowhite:"#ffdead",navy:"#000080",mediumvioletred:"#c71585",powderblue:"#b0e0e6",palegoldenrod:"#eee8aa",oldlace:"#fdf5e6",paleturquoise:"#afeeee",mediumturquoise:"#48d1cc",mediumorchid:"#ba55d3",rebeccapurple:"#663399",lightsteelblue:"#b0c4de",mediumslateblue:"#7b68ee",thistle:"#d8bfd8",tan:"#d2b48c",orchid:"#da70d6",mediumpurple:"#9370db",purple:"#800080",pink:"#ffc0cb",skyblue:"#87ceeb",springgreen:"#00ff7f",palegreen:"#98fb98",red:"#ff0000",yellow:"#ffff00",slateblue:"#6a5acd",lavenderblush:"#fff0f5",peru:"#cd853f",palevioletred:"#db7093",violet:"#ee82ee",teal:"#008080",slategray:"#708090",slategrey:"#708090",aliceblue:"#f0f8ff",darkseagreen:"#8fbc8f",darkolivegreen:"#556b2f",greenyellow:"#adff2f",seagreen:"#2e8b57",seashell:"#fff5ee",tomato:"#ff6347",silver:"#c0c0c0",sienna:"#a0522d",lavender:"#e6e6fa",lightgreen:"#90ee90",orange:"#ffa500",orangered:"#ff4500",steelblue:"#4682b4",royalblue:"#4169e1",turquoise:"#40e0d0",yellowgreen:"#9acd32",salmon:"#fa8072",saddlebrown:"#8b4513",sandybrown:"#f4a460",rosybrown:"#bc8f8f",darksalmon:"#e9967a",lightgoldenrodyellow:"#fafad2",snow:"#fffafa",lightgrey:"#d3d3d3",lightgray:"#d3d3d3",dimgray:"#696969",dimgrey:"#696969",olivedrab:"#6b8e23",olive:"#808000"},K={};for(var te in _)K[_[te]]=te;var ne={};X.prototype.toName=function(oe){if(!(this.rgba.a||this.rgba.r||this.rgba.g||this.rgba.b))return"transparent";var ie,se,ae=K[this.toHex()];if(ae)return ae;if(oe!=null&&oe.closest){var ge=this.toRgb(),ce=1/0,de="black";if(!ne.length)for(var pe in _)ne[pe]=new X(_[pe]).toRgb();for(var fe in _){var be=(ie=ge,se=ne[fe],Math.pow(ie.r-se.r,2)+Math.pow(ie.g-se.g,2)+Math.pow(ie.b-se.b,2));be<ce&&(ce=be,de=fe)}return de}},Z.string.push([function(oe){var ie=oe.toLowerCase(),se=ie==="transparent"?"#0000":_[ie];return se?new X(se).toRgb():null},"name"])}function u(){return(u=Object.assign||function(X){for(var Z=1;Z<arguments.length;Z++){var _=arguments[Z];for(var K in _)Object.prototype.hasOwnProperty.call(_,K)&&(X[K]=_[K])}return X}).apply(this,arguments)}function c$2(X,Z){if(X==null)return{};var _,K,te={},ne=Object.keys(X);for(K=0;K<ne.length;K++)Z.indexOf(_=ne[K])>=0||(te[_]=X[_]);return te}function i(X){var Z=reactExports.useRef(X),_=reactExports.useRef(function(K){Z.current&&Z.current(K)});return Z.current=X,_.current}var s$1=function(X,Z,_){return Z===void 0&&(Z=0),_===void 0&&(_=1),X>_?_:X<Z?Z:X},f=function(X){return"touches"in X},v$1=function(X){return X&&X.ownerDocument.defaultView||self},d=function(X,Z,_){var K=X.getBoundingClientRect(),te=f(Z)?function(ne,oe){for(var ie=0;ie<ne.length;ie++)if(ne[ie].identifier===oe)return ne[ie];return ne[0]}(Z.touches,_):Z;return{left:s$1((te.pageX-(K.left+v$1(X).pageXOffset))/K.width),top:s$1((te.pageY-(K.top+v$1(X).pageYOffset))/K.height)}},h=function(X){!f(X)&&X.preventDefault()},m$1=React.memo(function(X){var Z=X.onMove,_=X.onKey,K=c$2(X,["onMove","onKey"]),te=reactExports.useRef(null),ne=i(Z),oe=i(_),ie=reactExports.useRef(null),se=reactExports.useRef(!1),ae=reactExports.useMemo(function(){var pe=function(me){h(me),(f(me)?me.touches.length>0:me.buttons>0)&&te.current?ne(d(te.current,me,ie.current)):be(!1)},fe=function(){return be(!1)};function be(me){var ye=se.current,ve=v$1(te.current),Be=me?ve.addEventListener:ve.removeEventListener;Be(ye?"touchmove":"mousemove",pe),Be(ye?"touchend":"mouseup",fe)}return[function(me){var ye=me.nativeEvent,ve=te.current;if(ve&&(h(ye),!function(Re,Ee){return Ee&&!f(Re)}(ye,se.current)&&ve)){if(f(ye)){se.current=!0;var Be=ye.changedTouches||[];Be.length&&(ie.current=Be[0].identifier)}ve.focus(),ne(d(ve,ye,ie.current)),be(!0)}},function(me){var ye=me.which||me.keyCode;ye<37||ye>40||(me.preventDefault(),oe({left:ye===39?.05:ye===37?-.05:0,top:ye===40?.05:ye===38?-.05:0}))},be]},[oe,ne]),ge=ae[0],ce=ae[1],de=ae[2];return reactExports.useEffect(function(){return de},[de]),React.createElement("div",u({},K,{onTouchStart:ge,onMouseDown:ge,className:"react-colorful__interactive",ref:te,onKeyDown:ce,tabIndex:0,role:"slider"}))}),g=function(X){return X.filter(Boolean).join(" ")},p=function(X){var Z=X.color,_=X.left,K=X.top,te=K===void 0?.5:K,ne=g(["react-colorful__pointer",X.className]);return React.createElement("div",{className:ne,style:{top:100*te+"%",left:100*_+"%"}},React.createElement("div",{className:"react-colorful__pointer-fill",style:{backgroundColor:Z}}))},b$2=function(X,Z,_){return Z===void 0&&(Z=0),_===void 0&&(_=Math.pow(10,Z)),Math.round(_*X)/_},y=function(X){var Z=X.s,_=X.v,K=X.a,te=(200-Z)*_/100;return{h:b$2(X.h),s:b$2(te>0&&te<200?Z*_/100/(te<=100?te:200-te)*100:0),l:b$2(te/2),a:b$2(K,2)}},q$2=function(X){var Z=y(X);return"hsl("+Z.h+", "+Z.s+"%, "+Z.l+"%)"},k=function(X){var Z=y(X);return"hsla("+Z.h+", "+Z.s+"%, "+Z.l+"%, "+Z.a+")"},I=function(X){var Z=X.h,_=X.s,K=X.v,te=X.a;Z=Z/360*6,_/=100,K/=100;var ne=Math.floor(Z),oe=K*(1-_),ie=K*(1-(Z-ne)*_),se=K*(1-(1-Z+ne)*_),ae=ne%6;return{r:b$2(255*[K,ie,oe,oe,se,K][ae]),g:b$2(255*[se,K,K,ie,oe,oe][ae]),b:b$2(255*[oe,oe,se,K,K,ie][ae]),a:b$2(te,2)}},L=function(X){var Z=X.r,_=X.g,K=X.b,te=X.a,ne=Math.max(Z,_,K),oe=ne-Math.min(Z,_,K),ie=oe?ne===Z?(_-K)/oe:ne===_?2+(K-Z)/oe:4+(Z-_)/oe:0;return{h:b$2(60*(ie<0?ie+6:ie)),s:b$2(ne?oe/ne*100:0),v:b$2(ne/255*100),a:te}},S=React.memo(function(X){var Z=X.hue,_=X.onChange,K=g(["react-colorful__hue",X.className]);return React.createElement("div",{className:K},React.createElement(m$1,{onMove:function(te){_({h:360*te.left})},onKey:function(te){_({h:s$1(Z+360*te.left,0,360)})},"aria-label":"Hue","aria-valuenow":b$2(Z),"aria-valuemax":"360","aria-valuemin":"0"},React.createElement(p,{className:"react-colorful__hue-pointer",left:Z/360,color:q$2({h:Z,s:100,v:100,a:1})})))}),T=React.memo(function(X){var Z=X.hsva,_=X.onChange,K={backgroundColor:q$2({h:Z.h,s:100,v:100,a:1})};return React.createElement("div",{className:"react-colorful__saturation",style:K},React.createElement(m$1,{onMove:function(te){_({s:100*te.left,v:100-100*te.top})},onKey:function(te){_({s:s$1(Z.s+100*te.left,0,100),v:s$1(Z.v-100*te.top,0,100)})},"aria-label":"Color","aria-valuetext":"Saturation "+b$2(Z.s)+"%, Brightness "+b$2(Z.v)+"%"},React.createElement(p,{className:"react-colorful__saturation-pointer",top:1-Z.v/100,left:Z.s/100,color:q$2(Z)})))}),F=function(X,Z){if(X===Z)return!0;for(var _ in X)if(X[_]!==Z[_])return!1;return!0};function Y(X,Z,_){var K=i(_),te=reactExports.useState(function(){return X.toHsva(Z)}),ne=te[0],oe=te[1],ie=reactExports.useRef({color:Z,hsva:ne});reactExports.useEffect(function(){if(!X.equal(Z,ie.current.color)){var ae=X.toHsva(Z);ie.current={hsva:ae,color:Z},oe(ae)}},[Z,X]),reactExports.useEffect(function(){var ae;F(ne,ie.current.hsva)||X.equal(ae=X.fromHsva(ne),ie.current.color)||(ie.current={hsva:ne,color:ae},K(ae))},[ne,X,K]);var se=reactExports.useCallback(function(ae){oe(function(ge){return Object.assign({},ge,ae)})},[]);return[ne,se]}var V=typeof window<"u"?reactExports.useLayoutEffect:reactExports.useEffect,$=function(){return typeof __webpack_nonce__<"u"?__webpack_nonce__:void 0},J=new Map,Q=function(X){V(function(){var Z=X.current?X.current.ownerDocument:document;if(Z!==void 0&&!J.has(Z)){var _=Z.createElement("style");_.innerHTML=`.react-colorful{position:relative;display:flex;flex-direction:column;width:200px;height:200px;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;cursor:default}.react-colorful__saturation{position:relative;flex-grow:1;border-color:transparent;border-bottom:12px solid #000;border-radius:8px 8px 0 0;background-image:linear-gradient(0deg,#000,transparent),linear-gradient(90deg,#fff,hsla(0,0%,100%,0))}.react-colorful__alpha-gradient,.react-colorful__pointer-fill{content:"";position:absolute;left:0;top:0;right:0;bottom:0;pointer-events:none;border-radius:inherit}.react-colorful__alpha-gradient,.react-colorful__saturation{box-shadow:inset 0 0 0 1px rgba(0,0,0,.05)}.react-colorful__alpha,.react-colorful__hue{position:relative;height:24px}.react-colorful__hue{background:linear-gradient(90deg,red 0,#ff0 17%,#0f0 33%,#0ff 50%,#00f 67%,#f0f 83%,red)}.react-colorful__last-control{border-radius:0 0 8px 8px}.react-colorful__interactive{position:absolute;left:0;top:0;right:0;bottom:0;border-radius:inherit;outline:none;touch-action:none}.react-colorful__pointer{position:absolute;z-index:1;box-sizing:border-box;width:28px;height:28px;transform:translate(-50%,-50%);background-color:#fff;border:2px solid #fff;border-radius:50%;box-shadow:0 2px 4px rgba(0,0,0,.2)}.react-colorful__interactive:focus .react-colorful__pointer{transform:translate(-50%,-50%) scale(1.1)}.react-colorful__alpha,.react-colorful__alpha-pointer{background-color:#fff;background-image:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill-opacity=".05"><path d="M8 0h8v8H8zM0 8h8v8H0z"/></svg>')}.react-colorful__saturation-pointer{z-index:3}.react-colorful__hue-pointer{z-index:2}`,J.set(Z,_);var K=$();K&&_.setAttribute("nonce",K),Z.head.appendChild(_)}},[])},U=function(X){var Z=X.className,_=X.colorModel,K=X.color,te=K===void 0?_.defaultColor:K,ne=X.onChange,oe=c$2(X,["className","colorModel","color","onChange"]),ie=reactExports.useRef(null);Q(ie);var se=Y(_,te,ne),ae=se[0],ge=se[1],ce=g(["react-colorful",Z]);return React.createElement("div",u({},oe,{ref:ie,className:ce}),React.createElement(T,{hsva:ae,onChange:ge}),React.createElement(S,{hue:ae.h,onChange:ge,className:"react-colorful__last-control"}))},ee=function(X){var Z=X.className,_=X.hsva,K=X.onChange,te={backgroundImage:"linear-gradient(90deg, "+k(Object.assign({},_,{a:0}))+", "+k(Object.assign({},_,{a:1}))+")"},ne=g(["react-colorful__alpha",Z]),oe=b$2(100*_.a);return React.createElement("div",{className:ne},React.createElement("div",{className:"react-colorful__alpha-gradient",style:te}),React.createElement(m$1,{onMove:function(ie){K({a:ie.left})},onKey:function(ie){K({a:s$1(_.a+ie.left)})},"aria-label":"Alpha","aria-valuetext":oe+"%","aria-valuenow":oe,"aria-valuemin":"0","aria-valuemax":"100"},React.createElement(p,{className:"react-colorful__alpha-pointer",left:_.a,color:k(_)})))},re=function(X){var Z=X.className,_=X.colorModel,K=X.color,te=K===void 0?_.defaultColor:K,ne=X.onChange,oe=c$2(X,["className","colorModel","color","onChange"]),ie=reactExports.useRef(null);Q(ie);var se=Y(_,te,ne),ae=se[0],ge=se[1],ce=g(["react-colorful",Z]);return React.createElement("div",u({},oe,{ref:ie,className:ce}),React.createElement(T,{hsva:ae,onChange:ge}),React.createElement(S,{hue:ae.h,onChange:ge}),React.createElement(ee,{hsva:ae,onChange:ge,className:"react-colorful__last-control"}))},xe={defaultColor:{r:0,g:0,b:0,a:1},toHsva:L,fromHsva:I,equal:F},Ce=function(X){return React.createElement(re,u({},X,{colorModel:xe}))},Me={defaultColor:{r:0,g:0,b:0},toHsva:function(X){return L({r:X.r,g:X.g,b:X.b,a:1})},fromHsva:function(X){return{r:(Z=I(X)).r,g:Z.g,b:Z.b};var Z},equal:F},Ne=function(X){return React.createElement(U,u({},X,{colorModel:Me}))};function __awaiter(X,Z,_,K){function te(ne){return ne instanceof _?ne:new _(function(oe){oe(ne)})}return new(_||(_=Promise))(function(ne,oe){function ie(ge){try{ae(K.next(ge))}catch(ce){oe(ce)}}function se(ge){try{ae(K.throw(ge))}catch(ce){oe(ce)}}function ae(ge){ge.done?ne(ge.value):te(ge.value).then(ie,se)}ae((K=K.apply(X,Z||[])).next())})}function __generator(X,Z){var _={label:0,sent:function(){if(ne[0]&1)throw ne[1];return ne[1]},trys:[],ops:[]},K,te,ne,oe=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return oe.next=ie(0),oe.throw=ie(1),oe.return=ie(2),typeof Symbol=="function"&&(oe[Symbol.iterator]=function(){return this}),oe;function ie(ae){return function(ge){return se([ae,ge])}}function se(ae){if(K)throw new TypeError("Generator is already executing.");for(;oe&&(oe=0,ae[0]&&(_=0)),_;)try{if(K=1,te&&(ne=ae[0]&2?te.return:ae[0]?te.throw||((ne=te.return)&&ne.call(te),0):te.next)&&!(ne=ne.call(te,ae[1])).done)return ne;switch(te=0,ne&&(ae=[ae[0]&2,ne.value]),ae[0]){case 0:case 1:ne=ae;break;case 4:return _.label++,{value:ae[1],done:!1};case 5:_.label++,te=ae[1],ae=[0];continue;case 7:ae=_.ops.pop(),_.trys.pop();continue;default:if(ne=_.trys,!(ne=ne.length>0&&ne[ne.length-1])&&(ae[0]===6||ae[0]===2)){_=0;continue}if(ae[0]===3&&(!ne||ae[1]>ne[0]&&ae[1]<ne[3])){_.label=ae[1];break}if(ae[0]===6&&_.label<ne[1]){_.label=ne[1],ne=ae;break}if(ne&&_.label<ne[2]){_.label=ne[2],_.ops.push(ae);break}ne[2]&&_.ops.pop(),_.trys.pop();continue}ae=Z.call(X,_)}catch(ge){ae=[6,ge],te=0}finally{K=ne=0}if(ae[0]&5)throw ae[1];return{value:ae[0]?ae[1]:void 0,done:!0}}}function __read(X,Z){var _=typeof Symbol=="function"&&X[Symbol.iterator];if(!_)return X;var K=_.call(X),te,ne=[],oe;try{for(;(Z===void 0||Z-- >0)&&!(te=K.next()).done;)ne.push(te.value)}catch(ie){oe={error:ie}}finally{try{te&&!te.done&&(_=K.return)&&_.call(K)}finally{if(oe)throw oe.error}}return ne}function __spread(){for(var X=[],Z=0;Z<arguments.length;Z++)X=X.concat(__read(arguments[Z]));return X}typeof SuppressedError=="function"&&SuppressedError;var COMMON_MIME_TYPES=new Map([["aac","audio/aac"],["abw","application/x-abiword"],["arc","application/x-freearc"],["avif","image/avif"],["avi","video/x-msvideo"],["azw","application/vnd.amazon.ebook"],["bin","application/octet-stream"],["bmp","image/bmp"],["bz","application/x-bzip"],["bz2","application/x-bzip2"],["cda","application/x-cdf"],["csh","application/x-csh"],["css","text/css"],["csv","text/csv"],["doc","application/msword"],["docx","application/vnd.openxmlformats-officedocument.wordprocessingml.document"],["eot","application/vnd.ms-fontobject"],["epub","application/epub+zip"],["gz","application/gzip"],["gif","image/gif"],["heic","image/heic"],["heif","image/heif"],["htm","text/html"],["html","text/html"],["ico","image/vnd.microsoft.icon"],["ics","text/calendar"],["jar","application/java-archive"],["jpeg","image/jpeg"],["jpg","image/jpeg"],["js","text/javascript"],["json","application/json"],["jsonld","application/ld+json"],["mid","audio/midi"],["midi","audio/midi"],["mjs","text/javascript"],["mp3","audio/mpeg"],["mp4","video/mp4"],["mpeg","video/mpeg"],["mpkg","application/vnd.apple.installer+xml"],["odp","application/vnd.oasis.opendocument.presentation"],["ods","application/vnd.oasis.opendocument.spreadsheet"],["odt","application/vnd.oasis.opendocument.text"],["oga","audio/ogg"],["ogv","video/ogg"],["ogx","application/ogg"],["opus","audio/opus"],["otf","font/otf"],["png","image/png"],["pdf","application/pdf"],["php","application/x-httpd-php"],["ppt","application/vnd.ms-powerpoint"],["pptx","application/vnd.openxmlformats-officedocument.presentationml.presentation"],["rar","application/vnd.rar"],["rtf","application/rtf"],["sh","application/x-sh"],["svg","image/svg+xml"],["swf","application/x-shockwave-flash"],["tar","application/x-tar"],["tif","image/tiff"],["tiff","image/tiff"],["ts","video/mp2t"],["ttf","font/ttf"],["txt","text/plain"],["vsd","application/vnd.visio"],["wav","audio/wav"],["weba","audio/webm"],["webm","video/webm"],["webp","image/webp"],["woff","font/woff"],["woff2","font/woff2"],["xhtml","application/xhtml+xml"],["xls","application/vnd.ms-excel"],["xlsx","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"],["xml","application/xml"],["xul","application/vnd.mozilla.xul+xml"],["zip","application/zip"],["7z","application/x-7z-compressed"],["mkv","video/x-matroska"],["mov","video/quicktime"],["msg","application/vnd.ms-outlook"]]);function toFileWithPath(X,Z){var _=withMimeType(X);if(typeof _.path!="string"){var K=X.webkitRelativePath;Object.defineProperty(_,"path",{value:typeof Z=="string"?Z:typeof K=="string"&&K.length>0?K:X.name,writable:!1,configurable:!1,enumerable:!0})}return _}function withMimeType(X){var Z=X.name,_=Z&&Z.lastIndexOf(".")!==-1;if(_&&!X.type){var K=Z.split(".").pop().toLowerCase(),te=COMMON_MIME_TYPES.get(K);te&&Object.defineProperty(X,"type",{value:te,writable:!1,configurable:!1,enumerable:!0})}return X}var FILES_TO_IGNORE=[".DS_Store","Thumbs.db"];function fromEvent(X){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(Z){return isObject(X)&&isDataTransfer(X)?[2,getDataTransferFiles(X.dataTransfer,X.type)]:isChangeEvt(X)?[2,getInputFiles(X)]:Array.isArray(X)&&X.every(function(_){return"getFile"in _&&typeof _.getFile=="function"})?[2,getFsHandleFiles(X)]:[2,[]]})})}function isDataTransfer(X){return isObject(X.dataTransfer)}function isChangeEvt(X){return isObject(X)&&isObject(X.target)}function isObject(X){return typeof X=="object"&&X!==null}function getInputFiles(X){return fromList(X.target.files).map(function(Z){return toFileWithPath(Z)})}function getFsHandleFiles(X){return __awaiter(this,void 0,void 0,function(){var Z;return __generator(this,function(_){switch(_.label){case 0:return[4,Promise.all(X.map(function(K){return K.getFile()}))];case 1:return Z=_.sent(),[2,Z.map(function(K){return toFileWithPath(K)})]}})})}function getDataTransferFiles(X,Z){return __awaiter(this,void 0,void 0,function(){var _,K;return __generator(this,function(te){switch(te.label){case 0:return X===null?[2,[]]:X.items?(_=fromList(X.items).filter(function(ne){return ne.kind==="file"}),Z!=="drop"?[2,_]:[4,Promise.all(_.map(toFilePromises))]):[3,2];case 1:return K=te.sent(),[2,noIgnoredFiles(flatten(K))];case 2:return[2,noIgnoredFiles(fromList(X.files).map(function(ne){return toFileWithPath(ne)}))]}})})}function noIgnoredFiles(X){return X.filter(function(Z){return FILES_TO_IGNORE.indexOf(Z.name)===-1})}function fromList(X){if(X===null)return[];for(var Z=[],_=0;_<X.length;_++){var K=X[_];Z.push(K)}return Z}function toFilePromises(X){if(typeof X.webkitGetAsEntry!="function")return fromDataTransferItem(X);var Z=X.webkitGetAsEntry();return Z&&Z.isDirectory?fromDirEntry(Z):fromDataTransferItem(X)}function flatten(X){return X.reduce(function(Z,_){return __spread(Z,Array.isArray(_)?flatten(_):[_])},[])}function fromDataTransferItem(X){var Z=X.getAsFile();if(!Z)return Promise.reject(X+" is not a File");var _=toFileWithPath(Z);return Promise.resolve(_)}function fromEntry(X){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(Z){return[2,X.isDirectory?fromDirEntry(X):fromFileEntry(X)]})})}function fromDirEntry(X){var Z=X.createReader();return new Promise(function(_,K){var te=[];function ne(){var oe=this;Z.readEntries(function(ie){return __awaiter(oe,void 0,void 0,function(){var se,ae,ge;return __generator(this,function(ce){switch(ce.label){case 0:if(ie.length)return[3,5];ce.label=1;case 1:return ce.trys.push([1,3,,4]),[4,Promise.all(te)];case 2:return se=ce.sent(),_(se),[3,4];case 3:return ae=ce.sent(),K(ae),[3,4];case 4:return[3,6];case 5:ge=Promise.all(ie.map(fromEntry)),te.push(ge),ne(),ce.label=6;case 6:return[2]}})})},function(ie){K(ie)})}ne()})}function fromFileEntry(X){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(Z){return[2,new Promise(function(_,K){X.file(function(te){var ne=toFileWithPath(te,X.fullPath);_(ne)},function(te){K(te)})})]})})}var es={},hasRequiredEs;function requireEs(){return hasRequiredEs||(hasRequiredEs=1,es.__esModule=!0,es.default=function(X,Z){if(X&&Z){var _=Array.isArray(Z)?Z:Z.split(",");if(_.length===0)return!0;var K=X.name||"",te=(X.type||"").toLowerCase(),ne=te.replace(/\/.*$/,"");return _.some(function(oe){var ie=oe.trim().toLowerCase();return ie.charAt(0)==="."?K.toLowerCase().endsWith(ie):ie.endsWith("/*")?ne===ie.replace(/\/.*$/,""):te===ie})}return!0}),es}var esExports=requireEs();const accepts=getDefaultExportFromCjs(esExports);function ownKeys$2(X,Z){var _=Object.keys(X);if(Object.getOwnPropertySymbols){var K=Object.getOwnPropertySymbols(X);Z&&(K=K.filter(function(te){return Object.getOwnPropertyDescriptor(X,te).enumerable})),_.push.apply(_,K)}return _}function _objectSpread$2(X){for(var Z=1;Z<arguments.length;Z++){var _=arguments[Z]!=null?arguments[Z]:{};Z%2?ownKeys$2(Object(_),!0).forEach(function(K){_defineProperty$2(X,K,_[K])}):Object.getOwnPropertyDescriptors?Object.defineProperties(X,Object.getOwnPropertyDescriptors(_)):ownKeys$2(Object(_)).forEach(function(K){Object.defineProperty(X,K,Object.getOwnPropertyDescriptor(_,K))})}return X}function _defineProperty$2(X,Z,_){return Z in X?Object.defineProperty(X,Z,{value:_,enumerable:!0,configurable:!0,writable:!0}):X[Z]=_,X}function _slicedToArray$1(X,Z){return _arrayWithHoles$1(X)||_iterableToArrayLimit$1(X,Z)||_unsupportedIterableToArray$1(X,Z)||_nonIterableRest$1()}function _nonIterableRest$1(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function _unsupportedIterableToArray$1(X,Z){if(X){if(typeof X=="string")return _arrayLikeToArray$1(X,Z);var _=Object.prototype.toString.call(X).slice(8,-1);if(_==="Object"&&X.constructor&&(_=X.constructor.name),_==="Map"||_==="Set")return Array.from(X);if(_==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(_))return _arrayLikeToArray$1(X,Z)}}function _arrayLikeToArray$1(X,Z){(Z==null||Z>X.length)&&(Z=X.length);for(var _=0,K=new Array(Z);_<Z;_++)K[_]=X[_];return K}function _iterableToArrayLimit$1(X,Z){var _=X==null?null:typeof Symbol<"u"&&X[Symbol.iterator]||X["@@iterator"];if(_!=null){var K=[],te=!0,ne=!1,oe,ie;try{for(_=_.call(X);!(te=(oe=_.next()).done)&&(K.push(oe.value),!(Z&&K.length===Z));te=!0);}catch(se){ne=!0,ie=se}finally{try{!te&&_.return!=null&&_.return()}finally{if(ne)throw ie}}return K}}function _arrayWithHoles$1(X){if(Array.isArray(X))return X}var FILE_INVALID_TYPE="file-invalid-type",FILE_TOO_LARGE="file-too-large",FILE_TOO_SMALL="file-too-small",TOO_MANY_FILES="too-many-files",getInvalidTypeRejectionErr=function(Z){Z=Array.isArray(Z)&&Z.length===1?Z[0]:Z;var _=Array.isArray(Z)?"one of ".concat(Z.join(", ")):Z;return{code:FILE_INVALID_TYPE,message:"File type must be ".concat(_)}},getTooLargeRejectionErr=function(Z){return{code:FILE_TOO_LARGE,message:"File is larger than ".concat(Z," ").concat(Z===1?"byte":"bytes")}},getTooSmallRejectionErr=function(Z){return{code:FILE_TOO_SMALL,message:"File is smaller than ".concat(Z," ").concat(Z===1?"byte":"bytes")}},TOO_MANY_FILES_REJECTION={code:TOO_MANY_FILES,message:"Too many files"};function fileAccepted(X,Z){var _=X.type==="application/x-moz-file"||accepts(X,Z);return[_,_?null:getInvalidTypeRejectionErr(Z)]}function fileMatchSize(X,Z,_){if(isDefined(X.size))if(isDefined(Z)&&isDefined(_)){if(X.size>_)return[!1,getTooLargeRejectionErr(_)];if(X.size<Z)return[!1,getTooSmallRejectionErr(Z)]}else{if(isDefined(Z)&&X.size<Z)return[!1,getTooSmallRejectionErr(Z)];if(isDefined(_)&&X.size>_)return[!1,getTooLargeRejectionErr(_)]}return[!0,null]}function isDefined(X){return X!=null}function allFilesAccepted(X){var Z=X.files,_=X.accept,K=X.minSize,te=X.maxSize,ne=X.multiple,oe=X.maxFiles;return!ne&&Z.length>1||ne&&oe>=1&&Z.length>oe?!1:Z.every(function(ie){var se=fileAccepted(ie,_),ae=_slicedToArray$1(se,1),ge=ae[0],ce=fileMatchSize(ie,K,te),de=_slicedToArray$1(ce,1),pe=de[0];return ge&&pe})}function isPropagationStopped(X){return typeof X.isPropagationStopped=="function"?X.isPropagationStopped():typeof X.cancelBubble<"u"?X.cancelBubble:!1}function isEvtWithFiles(X){return X.dataTransfer?Array.prototype.some.call(X.dataTransfer.types,function(Z){return Z==="Files"||Z==="application/x-moz-file"}):!!X.target&&!!X.target.files}function onDocumentDragOver(X){X.preventDefault()}function isIe(X){return X.indexOf("MSIE")!==-1||X.indexOf("Trident/")!==-1}function isEdge(X){return X.indexOf("Edge/")!==-1}function isIeOrEdge(){var X=arguments.length>0&&arguments[0]!==void 0?arguments[0]:window.navigator.userAgent;return isIe(X)||isEdge(X)}function composeEventHandlers(){for(var X=arguments.length,Z=new Array(X),_=0;_<X;_++)Z[_]=arguments[_];return function(K){for(var te=arguments.length,ne=new Array(te>1?te-1:0),oe=1;oe<te;oe++)ne[oe-1]=arguments[oe];return Z.some(function(ie){return!isPropagationStopped(K)&&ie&&ie.apply(void 0,[K].concat(ne)),isPropagationStopped(K)})}}function canUseFileSystemAccessAPI(){return"showOpenFilePicker"in window}function filePickerOptionsTypes(X){return X=typeof X=="string"?X.split(","):X,[{description:"everything",accept:Array.isArray(X)?X.filter(function(Z){return Z==="audio/*"||Z==="video/*"||Z==="image/*"||Z==="text/*"||/\w+\/[-+.\w]+/g.test(Z)}).reduce(function(Z,_){return _objectSpread$2(_objectSpread$2({},Z),{},_defineProperty$2({},_,[]))},{}):{}}]}function isAbort(X){return X instanceof DOMException&&(X.name==="AbortError"||X.code===X.ABORT_ERR)}function isSecurityError(X){return X instanceof DOMException&&(X.name==="SecurityError"||X.code===X.SECURITY_ERR)}var _excluded$8=["children"],_excluded2$2=["open"],_excluded3=["refKey","role","onKeyDown","onFocus","onBlur","onClick","onDragEnter","onDragOver","onDragLeave","onDrop"],_excluded4=["refKey","onChange","onClick"];function _toConsumableArray(X){return _arrayWithoutHoles(X)||_iterableToArray(X)||_unsupportedIterableToArray(X)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function _iterableToArray(X){if(typeof Symbol<"u"&&X[Symbol.iterator]!=null||X["@@iterator"]!=null)return Array.from(X)}function _arrayWithoutHoles(X){if(Array.isArray(X))return _arrayLikeToArray(X)}function _slicedToArray(X,Z){return _arrayWithHoles(X)||_iterableToArrayLimit(X,Z)||_unsupportedIterableToArray(X,Z)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function _unsupportedIterableToArray(X,Z){if(X){if(typeof X=="string")return _arrayLikeToArray(X,Z);var _=Object.prototype.toString.call(X).slice(8,-1);if(_==="Object"&&X.constructor&&(_=X.constructor.name),_==="Map"||_==="Set")return Array.from(X);if(_==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(_))return _arrayLikeToArray(X,Z)}}function _arrayLikeToArray(X,Z){(Z==null||Z>X.length)&&(Z=X.length);for(var _=0,K=new Array(Z);_<Z;_++)K[_]=X[_];return K}function _iterableToArrayLimit(X,Z){var _=X==null?null:typeof Symbol<"u"&&X[Symbol.iterator]||X["@@iterator"];if(_!=null){var K=[],te=!0,ne=!1,oe,ie;try{for(_=_.call(X);!(te=(oe=_.next()).done)&&(K.push(oe.value),!(Z&&K.length===Z));te=!0);}catch(se){ne=!0,ie=se}finally{try{!te&&_.return!=null&&_.return()}finally{if(ne)throw ie}}return K}}function _arrayWithHoles(X){if(Array.isArray(X))return X}function ownKeys$1(X,Z){var _=Object.keys(X);if(Object.getOwnPropertySymbols){var K=Object.getOwnPropertySymbols(X);Z&&(K=K.filter(function(te){return Object.getOwnPropertyDescriptor(X,te).enumerable})),_.push.apply(_,K)}return _}function _objectSpread$1(X){for(var Z=1;Z<arguments.length;Z++){var _=arguments[Z]!=null?arguments[Z]:{};Z%2?ownKeys$1(Object(_),!0).forEach(function(K){_defineProperty$1(X,K,_[K])}):Object.getOwnPropertyDescriptors?Object.defineProperties(X,Object.getOwnPropertyDescriptors(_)):ownKeys$1(Object(_)).forEach(function(K){Object.defineProperty(X,K,Object.getOwnPropertyDescriptor(_,K))})}return X}function _defineProperty$1(X,Z,_){return Z in X?Object.defineProperty(X,Z,{value:_,enumerable:!0,configurable:!0,writable:!0}):X[Z]=_,X}function _objectWithoutProperties$1(X,Z){if(X==null)return{};var _=_objectWithoutPropertiesLoose$1(X,Z),K,te;if(Object.getOwnPropertySymbols){var ne=Object.getOwnPropertySymbols(X);for(te=0;te<ne.length;te++)K=ne[te],!(Z.indexOf(K)>=0)&&Object.prototype.propertyIsEnumerable.call(X,K)&&(_[K]=X[K])}return _}function _objectWithoutPropertiesLoose$1(X,Z){if(X==null)return{};var _={},K=Object.keys(X),te,ne;for(ne=0;ne<K.length;ne++)te=K[ne],!(Z.indexOf(te)>=0)&&(_[te]=X[te]);return _}var Dropzone=reactExports.forwardRef(function(X,Z){var _=X.children,K=_objectWithoutProperties$1(X,_excluded$8),te=useDropzone(K),ne=te.open,oe=_objectWithoutProperties$1(te,_excluded2$2);return reactExports.useImperativeHandle(Z,function(){return{open:ne}},[ne]),React.createElement(reactExports.Fragment,null,_(_objectSpread$1(_objectSpread$1({},oe),{},{open:ne})))});Dropzone.displayName="Dropzone";var defaultProps={disabled:!1,getFilesFromEvent:fromEvent,maxSize:1/0,minSize:0,multiple:!0,maxFiles:0,preventDropOnDocument:!0,noClick:!1,noKeyboard:!1,noDrag:!1,noDragEventsBubbling:!1,validator:null,useFsAccessApi:!0};Dropzone.defaultProps=defaultProps;Dropzone.propTypes={children:PropTypes.func,accept:PropTypes.oneOfType([PropTypes.string,PropTypes.arrayOf(PropTypes.string)]),multiple:PropTypes.bool,preventDropOnDocument:PropTypes.bool,noClick:PropTypes.bool,noKeyboard:PropTypes.bool,noDrag:PropTypes.bool,noDragEventsBubbling:PropTypes.bool,minSize:PropTypes.number,maxSize:PropTypes.number,maxFiles:PropTypes.number,disabled:PropTypes.bool,getFilesFromEvent:PropTypes.func,onFileDialogCancel:PropTypes.func,onFileDialogOpen:PropTypes.func,useFsAccessApi:PropTypes.bool,onDragEnter:PropTypes.func,onDragLeave:PropTypes.func,onDragOver:PropTypes.func,onDrop:PropTypes.func,onDropAccepted:PropTypes.func,onDropRejected:PropTypes.func,validator:PropTypes.func};var initialState={isFocused:!1,isFileDialogActive:!1,isDragActive:!1,isDragAccept:!1,isDragReject:!1,draggedFiles:[],acceptedFiles:[],fileRejections:[]};function useDropzone(){var X=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},Z=_objectSpread$1(_objectSpread$1({},defaultProps),X),_=Z.accept,K=Z.disabled,te=Z.getFilesFromEvent,ne=Z.maxSize,oe=Z.minSize,ie=Z.multiple,se=Z.maxFiles,ae=Z.onDragEnter,ge=Z.onDragLeave,ce=Z.onDragOver,de=Z.onDrop,pe=Z.onDropAccepted,fe=Z.onDropRejected,be=Z.onFileDialogCancel,me=Z.onFileDialogOpen,ye=Z.useFsAccessApi,ve=Z.preventDropOnDocument,Be=Z.noClick,Re=Z.noKeyboard,Ee=Z.noDrag,We=Z.noDragEventsBubbling,Ze=Z.validator,Ve=reactExports.useMemo(function(){return typeof me=="function"?me:noop},[me]),_e=reactExports.useMemo(function(){return typeof be=="function"?be:noop},[be]),Xe=reactExports.useRef(null),Pe=reactExports.useRef(null),He=reactExports.useReducer(reducer,initialState),Ke=_slicedToArray(He,2),Ue=Ke[0],tt=Ke[1],rt=Ue.isFocused,at=Ue.isFileDialogActive,Oe=Ue.draggedFiles,$e=reactExports.useRef(typeof window<"u"&&window.isSecureContext&&ye&&canUseFileSystemAccessAPI()),je=function(){!$e.current&&at&&setTimeout(function(){if(Pe.current){var Je=Pe.current.files;Je.length||(tt({type:"closeDialog"}),_e())}},300)};reactExports.useEffect(function(){return window.addEventListener("focus",je,!1),function(){window.removeEventListener("focus",je,!1)}},[Pe,at,_e,$e]);var Te=reactExports.useRef([]),De=function(Je){Xe.current&&Xe.current.contains(Je.target)||(Je.preventDefault(),Te.current=[])};reactExports.useEffect(function(){return ve&&(document.addEventListener("dragover",onDocumentDragOver,!1),document.addEventListener("drop",De,!1)),function(){ve&&(document.removeEventListener("dragover",onDocumentDragOver),document.removeEventListener("drop",De))}},[Xe,ve]);var ot=reactExports.useCallback(function(qe){qe.preventDefault(),qe.persist(),Rt(qe),Te.current=[].concat(_toConsumableArray(Te.current),[qe.target]),isEvtWithFiles(qe)&&Promise.resolve(te(qe)).then(function(Je){isPropagationStopped(qe)&&!We||(tt({draggedFiles:Je,isDragActive:!0,type:"setDraggedFiles"}),ae&&ae(qe))})},[te,ae,We]),ct=reactExports.useCallback(function(qe){qe.preventDefault(),qe.persist(),Rt(qe);var Je=isEvtWithFiles(qe);if(Je&&qe.dataTransfer)try{qe.dataTransfer.dropEffect="copy"}catch{}return Je&&ce&&ce(qe),!1},[ce,We]),gt=reactExports.useCallback(function(qe){qe.preventDefault(),qe.persist(),Rt(qe);var Je=Te.current.filter(function(Dt){return Xe.current&&Xe.current.contains(Dt)}),mt=Je.indexOf(qe.target);mt!==-1&&Je.splice(mt,1),Te.current=Je,!(Je.length>0)&&(tt({isDragActive:!1,type:"setDraggedFiles",draggedFiles:[]}),isEvtWithFiles(qe)&&ge&&ge(qe))},[Xe,ge,We]),pt=reactExports.useCallback(function(qe,Je){var mt=[],Dt=[];qe.forEach(function(_t){var zt=fileAccepted(_t,_),nn=_slicedToArray(zt,2),tn=nn[0],Ft=nn[1],pn=fileMatchSize(_t,oe,ne),sn=_slicedToArray(pn,2),rn=sn[0],$t=sn[1],on=Ze?Ze(_t):null;if(tn&&rn&&!on)mt.push(_t);else{var An=[Ft,$t];on&&(An=An.concat(on)),Dt.push({file:_t,errors:An.filter(function(wn){return wn})})}}),(!ie&&mt.length>1||ie&&se>=1&&mt.length>se)&&(mt.forEach(function(_t){Dt.push({file:_t,errors:[TOO_MANY_FILES_REJECTION]})}),mt.splice(0)),tt({acceptedFiles:mt,fileRejections:Dt,type:"setFiles"}),de&&de(mt,Dt,Je),Dt.length>0&&fe&&fe(Dt,Je),mt.length>0&&pe&&pe(mt,Je)},[tt,ie,_,oe,ne,se,de,pe,fe,Ze]),ht=reactExports.useCallback(function(qe){qe.preventDefault(),qe.persist(),Rt(qe),Te.current=[],isEvtWithFiles(qe)&&Promise.resolve(te(qe)).then(function(Je){isPropagationStopped(qe)&&!We||pt(Je,qe)}),tt({type:"reset"})},[te,pt,We]),At=reactExports.useCallback(function(){if($e.current){tt({type:"openDialog"}),Ve();var qe={multiple:ie,types:filePickerOptionsTypes(_)};window.showOpenFilePicker(qe).then(function(Je){return te(Je)}).then(function(Je){pt(Je,null),tt({type:"closeDialog"})}).catch(function(Je){isAbort(Je)?(_e(Je),tt({type:"closeDialog"})):isSecurityError(Je)&&($e.current=!1,Pe.current&&(Pe.current.value=null,Pe.current.click()))});return}Pe.current&&(tt({type:"openDialog"}),Ve(),Pe.current.value=null,Pe.current.click())},[tt,Ve,_e,ye,pt,_,ie]),Kt=reactExports.useCallback(function(qe){!Xe.current||!Xe.current.isEqualNode(qe.target)||(qe.key===" "||qe.key==="Enter"||qe.keyCode===32||qe.keyCode===13)&&(qe.preventDefault(),At())},[Xe,At]),en=reactExports.useCallback(function(){tt({type:"focus"})},[]),Zt=reactExports.useCallback(function(){tt({type:"blur"})},[]),st=reactExports.useCallback(function(){Be||(isIeOrEdge()?setTimeout(At,0):At())},[Be,At]),Vt=function(Je){return K?null:Je},wt=function(Je){return Re?null:Vt(Je)},St=function(Je){return Ee?null:Vt(Je)},Rt=function(Je){We&&Je.stopPropagation()},jt=reactExports.useMemo(function(){return function(){var qe=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},Je=qe.refKey,mt=Je===void 0?"ref":Je,Dt=qe.role,_t=qe.onKeyDown,zt=qe.onFocus,nn=qe.onBlur,tn=qe.onClick,Ft=qe.onDragEnter,pn=qe.onDragOver,sn=qe.onDragLeave,rn=qe.onDrop,$t=_objectWithoutProperties$1(qe,_excluded3);return _objectSpread$1(_objectSpread$1(_defineProperty$1({onKeyDown:wt(composeEventHandlers(_t,Kt)),onFocus:wt(composeEventHandlers(zt,en)),onBlur:wt(composeEventHandlers(nn,Zt)),onClick:Vt(composeEventHandlers(tn,st)),onDragEnter:St(composeEventHandlers(Ft,ot)),onDragOver:St(composeEventHandlers(pn,ct)),onDragLeave:St(composeEventHandlers(sn,gt)),onDrop:St(composeEventHandlers(rn,ht)),role:typeof Dt=="string"&&Dt!==""?Dt:"button"},mt,Xe),!K&&!Re?{tabIndex:0}:{}),$t)}},[Xe,Kt,en,Zt,st,ot,ct,gt,ht,Re,Ee,K]),Wt=reactExports.useCallback(function(qe){qe.stopPropagation()},[]),Ht=reactExports.useMemo(function(){return function(){var qe=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},Je=qe.refKey,mt=Je===void 0?"ref":Je,Dt=qe.onChange,_t=qe.onClick,zt=_objectWithoutProperties$1(qe,_excluded4),nn=_defineProperty$1({accept:_,multiple:ie,type:"file",style:{display:"none"},onChange:Vt(composeEventHandlers(Dt,ht)),onClick:Vt(composeEventHandlers(_t,Wt)),tabIndex:-1},mt,Pe);return _objectSpread$1(_objectSpread$1({},nn),zt)}},[Pe,_,ie,ht,K]),Pt=Oe.length,Mt=Pt>0&&allFilesAccepted({files:Oe,accept:_,minSize:oe,maxSize:ne,multiple:ie,maxFiles:se}),un=Pt>0&&!Mt;return _objectSpread$1(_objectSpread$1({},Ue),{},{isDragAccept:Mt,isDragReject:un,isFocused:rt&&!K,getRootProps:jt,getInputProps:Ht,rootRef:Xe,inputRef:Pe,open:Vt(At)})}function reducer(X,Z){switch(Z.type){case"focus":return _objectSpread$1(_objectSpread$1({},X),{},{isFocused:!0});case"blur":return _objectSpread$1(_objectSpread$1({},X),{},{isFocused:!1});case"openDialog":return _objectSpread$1(_objectSpread$1({},initialState),{},{isFileDialogActive:!0});case"closeDialog":return _objectSpread$1(_objectSpread$1({},X),{},{isFileDialogActive:!1});case"setDraggedFiles":var _=Z.isDragActive,K=Z.draggedFiles;return _objectSpread$1(_objectSpread$1({},X),{},{draggedFiles:K,isDragActive:_});case"setFiles":return _objectSpread$1(_objectSpread$1({},X),{},{acceptedFiles:Z.acceptedFiles,fileRejections:Z.fileRejections});case"reset":return _objectSpread$1({},initialState);default:return X}}function noop(){}function createStore(X){let Z;const _=new Set,K=(ae,ge)=>{const ce=typeof ae=="function"?ae(Z):ae;if(ce!==Z){const de=Z;Z=ge?ce:Object.assign({},Z,ce),_.forEach(pe=>pe(Z,de))}},te=()=>Z,ne=(ae,ge=te,ce=Object.is)=>{console.warn("[DEPRECATED] Please use `subscribeWithSelector` middleware");let de=ge(Z);function pe(){const fe=ge(Z);if(!ce(de,fe)){const be=de;ae(de=fe,be)}}return _.add(pe),()=>_.delete(pe)},se={setState:K,getState:te,subscribe:(ae,ge,ce)=>ge||ce?ne(ae,ge,ce):(_.add(ae),()=>_.delete(ae)),destroy:()=>_.clear()};return Z=X(K,te,se),se}const isSSR=typeof window>"u"||!window.navigator||/ServerSideRendering|^Deno\//.test(window.navigator.userAgent),useIsomorphicLayoutEffect=isSSR?reactExports.useEffect:reactExports.useLayoutEffect;function create(X){const Z=typeof X=="function"?createStore(X):X,_=(K=Z.getState,te=Object.is)=>{const[,ne]=reactExports.useReducer(me=>me+1,0),oe=Z.getState(),ie=reactExports.useRef(oe),se=reactExports.useRef(K),ae=reactExports.useRef(te),ge=reactExports.useRef(!1),ce=reactExports.useRef();ce.current===void 0&&(ce.current=K(oe));let de,pe=!1;(ie.current!==oe||se.current!==K||ae.current!==te||ge.current)&&(de=K(oe),pe=!te(ce.current,de)),useIsomorphicLayoutEffect(()=>{pe&&(ce.current=de),ie.current=oe,se.current=K,ae.current=te,ge.current=!1});const fe=reactExports.useRef(oe);useIsomorphicLayoutEffect(()=>{const me=()=>{try{const ve=Z.getState(),Be=se.current(ve);ae.current(ce.current,Be)||(ie.current=ve,ce.current=Be,ne())}catch{ge.current=!0,ne()}},ye=Z.subscribe(me);return Z.getState()!==fe.current&&me(),ye},[]);const be=pe?de:ce.current;return reactExports.useDebugValue(be),be};return Object.assign(_,Z),_[Symbol.iterator]=function(){console.warn("[useStore, api] = create() is deprecated and will be removed in v4");const K=[_,Z];return{next(){const te=K.length<=0;return{value:K.shift(),done:te}}}},_}const subscribeWithSelector=X=>(Z,_,K)=>{const te=K.subscribe;return K.subscribe=(oe,ie,se)=>{let ae=oe;if(ie){const ge=(se==null?void 0:se.equalityFn)||Object.is;let ce=oe(K.getState());ae=de=>{const pe=oe(de);if(!ge(ce,pe)){const fe=ce;ie(ce=pe,fe)}},se!=null&&se.fireImmediately&&ie(ce,ce)}return te(ae)},X(Z,_,K)};/*!
 * isobject <https://github.com/jonschlinkert/isobject>
 *
 * Copyright (c) 2014-2017, Jon Schlinkert.
 * Released under the MIT License.
 */var isobject,hasRequiredIsobject;function requireIsobject(){return hasRequiredIsobject||(hasRequiredIsobject=1,isobject=function(Z){return Z!=null&&typeof Z=="object"&&Array.isArray(Z)===!1}),isobject}/*!
 * is-plain-object <https://github.com/jonschlinkert/is-plain-object>
 *
 * Copyright (c) 2014-2017, Jon Schlinkert.
 * Released under the MIT License.
 */var isPlainObject,hasRequiredIsPlainObject;function requireIsPlainObject(){if(hasRequiredIsPlainObject)return isPlainObject;hasRequiredIsPlainObject=1;var X=requireIsobject();function Z(_){return X(_)===!0&&Object.prototype.toString.call(_)==="[object Object]"}return isPlainObject=function(K){var te,ne;return!(Z(K)===!1||(te=K.constructor,typeof te!="function")||(ne=te.prototype,Z(ne)===!1)||ne.hasOwnProperty("isPrototypeOf")===!1)},isPlainObject}/*!
 * is-extendable <https://github.com/jonschlinkert/is-extendable>
 *
 * Copyright (c) 2015-2017, Jon Schlinkert.
 * Released under the MIT License.
 */var isExtendable$2,hasRequiredIsExtendable$2;function requireIsExtendable$2(){if(hasRequiredIsExtendable$2)return isExtendable$2;hasRequiredIsExtendable$2=1;var X=requireIsPlainObject();return isExtendable$2=function(_){return X(_)||typeof _=="function"||Array.isArray(_)},isExtendable$2}/*!
 * for-in <https://github.com/jonschlinkert/for-in>
 *
 * Copyright (c) 2014-2017, Jon Schlinkert.
 * Released under the MIT License.
 */var forIn,hasRequiredForIn;function requireForIn(){return hasRequiredForIn||(hasRequiredForIn=1,forIn=function(Z,_,K){for(var te in Z)if(_.call(K,Z[te],te,Z)===!1)break}),forIn}var mixinDeep_1,hasRequiredMixinDeep;function requireMixinDeep(){if(hasRequiredMixinDeep)return mixinDeep_1;hasRequiredMixinDeep=1;var X=requireIsExtendable$2(),Z=requireForIn();function _(oe,ie){for(var se=arguments.length,ae=0;++ae<se;){var ge=arguments[ae];te(ge)&&Z(ge,K,oe)}return oe}function K(oe,ie){if(ne(ie)){var se=this[ie];te(oe)&&te(se)?_(se,oe):this[ie]=oe}}function te(oe){return X(oe)&&!Array.isArray(oe)}function ne(oe){return oe!=="__proto__"&&oe!=="constructor"&&oe!=="prototype"}return mixinDeep_1=_,mixinDeep_1}/*!
 * get-value <https://github.com/jonschlinkert/get-value>
 *
 * Copyright (c) 2014-2015, Jon Schlinkert.
 * Licensed under the MIT License.
 */var getValue$1,hasRequiredGetValue;function requireGetValue(){if(hasRequiredGetValue)return getValue$1;hasRequiredGetValue=1,getValue$1=function(_,K,te,ne,oe){if(!X(_)||!K)return _;if(K=Z(K),te&&(K+="."+Z(te)),ne&&(K+="."+Z(ne)),oe&&(K+="."+Z(oe)),K in _)return _[K];for(var ie=K.split("."),se=ie.length,ae=-1;_&&++ae<se;){for(var ge=ie[ae];ge[ge.length-1]==="\\";)ge=ge.slice(0,-1)+"."+ie[++ae];_=_[ge]}return _};function X(_){return _!==null&&(typeof _=="object"||typeof _=="function")}function Z(_){return _?Array.isArray(_)?_.join("."):_:""}return getValue$1}/*!
 * assign-symbols <https://github.com/jonschlinkert/assign-symbols>
 *
 * Copyright (c) 2015, Jon Schlinkert.
 * Licensed under the MIT License.
 */var assignSymbols,hasRequiredAssignSymbols;function requireAssignSymbols(){return hasRequiredAssignSymbols||(hasRequiredAssignSymbols=1,assignSymbols=function(X,Z){if(X===null||typeof X>"u")throw new TypeError("expected first argument to be an object.");if(typeof Z>"u"||typeof Symbol>"u"||typeof Object.getOwnPropertySymbols!="function")return X;for(var _=Object.prototype.propertyIsEnumerable,K=Object(X),te=arguments.length,ne=0;++ne<te;)for(var oe=Object(arguments[ne]),ie=Object.getOwnPropertySymbols(oe),se=0;se<ie.length;se++){var ae=ie[se];_.call(oe,ae)&&(K[ae]=oe[ae])}return K}),assignSymbols}var extendShallow$1,hasRequiredExtendShallow$1;function requireExtendShallow$1(){if(hasRequiredExtendShallow$1)return extendShallow$1;hasRequiredExtendShallow$1=1;var X=requireIsExtendable$2(),Z=requireAssignSymbols();extendShallow$1=Object.assign||function(ie){if(ie===null||typeof ie>"u")throw new TypeError("Cannot convert undefined or null to object");ne(ie)||(ie={});for(var se=1;se<arguments.length;se++){var ae=arguments[se];K(ae)&&(ae=te(ae)),ne(ae)&&(_(ie,ae),Z(ie,ae))}return ie};function _(ie,se){for(var ae in se)oe(se,ae)&&(ie[ae]=se[ae])}function K(ie){return ie&&typeof ie=="string"}function te(ie){var se={};for(var ae in ie)se[ae]=ie[ae];return se}function ne(ie){return ie&&typeof ie=="object"||X(ie)}function oe(ie,se){return Object.prototype.hasOwnProperty.call(ie,se)}return extendShallow$1}/*!
 * split-string <https://github.com/jonschlinkert/split-string>
 *
 * Copyright (c) 2015-2017, Jon Schlinkert.
 * Released under the MIT License.
 */var splitString,hasRequiredSplitString;function requireSplitString(){if(hasRequiredSplitString)return splitString;hasRequiredSplitString=1;var X=requireExtendShallow$1();splitString=function(te,ne,oe){if(typeof te!="string")throw new TypeError("expected a string");typeof ne=="function"&&(oe=ne,ne=null),typeof ne=="string"&&(ne={sep:ne});var ie=X({sep:"."},ne),se=ie.quotes||['"',"'","`"],ae;ie.brackets===!0?ae={"<":">","(":")","[":"]","{":"}"}:ie.brackets&&(ae=ie.brackets);var ge=[],ce=[],de=[""],pe=ie.sep,fe=te.length,be=-1,me;function ye(){if(ae&&ce.length)return ae[ce[ce.length-1]]}for(;++be<fe;){var ve=te[be],Be=te[be+1],Re={val:ve,idx:be,arr:de,str:te};if(ge.push(Re),ve==="\\"){Re.val=K(ie,te,be)===!0?ve+Be:Be,Re.escaped=!0,typeof oe=="function"&&oe(Re),de[de.length-1]+=Re.val,be++;continue}if(ae&&ae[ve]){ce.push(ve);var Ee=ye(),We=be+1;if(te.indexOf(Ee,We+1)!==-1)for(;ce.length&&We<fe;){var Ze=te[++We];if(Ze==="\\"){Ze++;continue}if(se.indexOf(Ze)!==-1){We=Z(te,Ze,We+1);continue}if(Ee=ye(),ce.length&&te.indexOf(Ee,We+1)===-1)break;if(ae[Ze]){ce.push(Ze);continue}Ee===Ze&&ce.pop()}if(me=We,me===-1){de[de.length-1]+=ve;continue}ve=te.slice(be,me+1),Re.val=ve,Re.idx=be=me}if(se.indexOf(ve)!==-1){if(me=Z(te,ve,be+1),me===-1){de[de.length-1]+=ve;continue}_(ve,ie)===!0?ve=te.slice(be,me+1):ve=te.slice(be+1,me),Re.val=ve,Re.idx=be=me}if(typeof oe=="function"&&(oe(Re,ge),ve=Re.val,be=Re.idx),Re.val===pe&&Re.split!==!1){de.push("");continue}de[de.length-1]+=Re.val}return de};function Z(te,ne,oe,ie){var se=te.indexOf(ne,oe);return te.charAt(se-1)==="\\"?Z(te,ne,se+1):se}function _(te,ne){return ne.keepDoubleQuotes===!0&&te==='"'||ne.keepSingleQuotes===!0&&te==="'"?!0:ne.keepQuotes}function K(te,ne,oe){return typeof te.keepEscaping=="function"?te.keepEscaping(ne,oe):te.keepEscaping===!0||ne[oe+1]==="\\"}return splitString}/*!
 * is-extendable <https://github.com/jonschlinkert/is-extendable>
 *
 * Copyright (c) 2015, Jon Schlinkert.
 * Licensed under the MIT License.
 */var isExtendable$1,hasRequiredIsExtendable$1;function requireIsExtendable$1(){return hasRequiredIsExtendable$1||(hasRequiredIsExtendable$1=1,isExtendable$1=function(Z){return typeof Z<"u"&&Z!==null&&(typeof Z=="object"||typeof Z=="function")}),isExtendable$1}var extendShallow,hasRequiredExtendShallow;function requireExtendShallow(){if(hasRequiredExtendShallow)return extendShallow;hasRequiredExtendShallow=1;var X=requireIsExtendable$1();extendShallow=function(te){X(te)||(te={});for(var ne=arguments.length,oe=1;oe<ne;oe++){var ie=arguments[oe];X(ie)&&Z(te,ie)}return te};function Z(K,te){for(var ne in te)_(te,ne)&&(K[ne]=te[ne])}function _(K,te){return Object.prototype.hasOwnProperty.call(K,te)}return extendShallow}/*!
 * is-extendable <https://github.com/jonschlinkert/is-extendable>
 *
 * Copyright (c) 2015, Jon Schlinkert.
 * Licensed under the MIT License.
 */var isExtendable,hasRequiredIsExtendable;function requireIsExtendable(){return hasRequiredIsExtendable||(hasRequiredIsExtendable=1,isExtendable=function(Z){return typeof Z<"u"&&Z!==null&&(typeof Z=="object"||typeof Z=="function")}),isExtendable}/*!
 * set-value <https://github.com/jonschlinkert/set-value>
 *
 * Copyright (c) 2014-2015, 2017, Jon Schlinkert.
 * Released under the MIT License.
 */var setValue,hasRequiredSetValue;function requireSetValue(){if(hasRequiredSetValue)return setValue;hasRequiredSetValue=1;var X=requireSplitString(),Z=requireExtendShallow(),_=requireIsPlainObject(),K=requireIsExtendable();setValue=function(ne,oe,ie){if(!K(ne)||(Array.isArray(oe)&&(oe=[].concat.apply([],oe).join(".")),typeof oe!="string"))return ne;for(var se=X(oe,{sep:".",brackets:!0}).filter(te),ae=se.length,ge=-1,ce=ne;++ge<ae;){var de=se[ge];if(ge!==ae-1){K(ce[de])||(ce[de]={}),ce=ce[de];continue}_(ce[de])&&_(ie)?ce[de]=Z({},ce[de],ie):ce[de]=ie}return ne};function te(ne){return ne!=="__proto__"&&ne!=="constructor"&&ne!=="prototype"}return setValue}var mergeValue,hasRequiredMergeValue;function requireMergeValue(){if(hasRequiredMergeValue)return mergeValue;hasRequiredMergeValue=1;var X=requireIsExtendable$2(),Z=requireMixinDeep(),_=requireGetValue(),K=requireSetValue();return mergeValue=function(ne,oe,ie){if(!X(ne))throw new TypeError("expected an object");if(typeof oe!="string"||ie==null)return Z.apply(null,arguments);if(typeof ie=="string")return K(ne,oe,ie),ne;var se=_(ne,oe);return X(ie)&&X(se)&&(ie=Z({},se,ie)),K(ne,oe,ie),ne},mergeValue}var mergeValueExports=requireMergeValue();const merge=getDefaultExportFromCjs(mergeValueExports),join=(...X)=>X.filter(Boolean).join(".");function getKeyPath(X){const Z=X.split(".");return[Z.pop(),Z.join(".")||void 0]}function getValuesForPaths(X,Z){return Object.entries(pick(X,Z)).reduce((_,[,{value:K,disabled:te,key:ne}])=>(_[ne]=te?void 0:K,_),{})}function useCompareMemoize(X,Z){const _=reactExports.useRef();return dequal(X,_.current)||(_.current=X),_.current}function useDeepMemo(X,Z){return reactExports.useMemo(X,useCompareMemoize(Z))}function useToggle(X){const Z=reactExports.useRef(null),_=reactExports.useRef(null),K=reactExports.useRef(!0);return reactExports.useLayoutEffect(()=>{X||(Z.current.style.height="0px",Z.current.style.overflow="hidden")},[]),reactExports.useEffect(()=>{if(K.current){K.current=!1;return}let te;const ne=Z.current,oe=()=>{X&&(ne.style.removeProperty("height"),ne.style.removeProperty("overflow"),_.current.scrollIntoView({behavior:"smooth",block:"nearest"}))};ne.addEventListener("transitionend",oe,{once:!0});const{height:ie}=_.current.getBoundingClientRect();return ne.style.height=ie+"px",X||(ne.style.overflow="hidden",te=window.setTimeout(()=>ne.style.height="0px",50)),()=>{ne.removeEventListener("transitionend",oe),clearTimeout(te)}},[X]),{wrapperRef:Z,contentRef:_}}const useVisiblePaths=X=>{const[Z,_]=reactExports.useState(X.getVisiblePaths());return reactExports.useEffect(()=>{_(X.getVisiblePaths());const K=X.useStore.subscribe(X.getVisiblePaths,_,{equalityFn:shallow});return()=>K()},[X]),Z};function useValuesForPath(X,Z,_){return X.useStore(te=>{const ne=_objectSpread2(_objectSpread2({},_),te.data);return getValuesForPaths(ne,Z)},shallow)}function usePopin(X=3){const Z=reactExports.useRef(null),_=reactExports.useRef(null),[K,te]=reactExports.useState(!1),ne=reactExports.useCallback(()=>te(!0),[]),oe=reactExports.useCallback(()=>te(!1),[]);return reactExports.useLayoutEffect(()=>{if(K){const{bottom:ie,top:se,left:ae}=Z.current.getBoundingClientRect(),{height:ge}=_.current.getBoundingClientRect(),ce=ie+ge>window.innerHeight-40?"up":"down";_.current.style.position="fixed",_.current.style.zIndex="10000",_.current.style.left=ae+"px",ce==="down"?_.current.style.top=ie+X+"px":_.current.style.bottom=window.innerHeight-se+X+"px"}},[X,K]),{popinRef:Z,wrapperRef:_,shown:K,show:ne,hide:oe}}k$1([namesPlugin]);const convertMap={rgb:"toRgb",hsl:"toHsl",hsv:"toHsv",hex:"toHex"};v8n.extend({color:()=>X=>w(X).isValid()});const schema$2=X=>v8n().color().test(X);function convert(X,{format:Z,hasAlpha:_,isString:K}){const te=convertMap[Z]+(K&&Z!=="hex"?"String":""),ne=X[te]();return typeof ne=="object"&&!_?omit(ne,["a"]):ne}const sanitize$2=(X,Z)=>{const _=w(X);if(!_.isValid())throw Error("Invalid color");return convert(_,Z)},format$1=(X,Z)=>convert(w(X),_objectSpread2(_objectSpread2({},Z),{},{isString:!0,format:"hex"})),normalize$3=({value:X})=>{const Z=I$1(X),_=Z==="name"?"hex":Z,K=typeof X=="object"?"a"in X:Z==="hex"&&X.length===8||/^(rgba)|(hsla)|(hsva)/.test(X),te={format:_,hasAlpha:K,isString:typeof X=="string"};return{value:sanitize$2(X,te),settings:te}};var props$2=Object.freeze({__proto__:null,schema:schema$2,sanitize:sanitize$2,format:format$1,normalize:normalize$3});const ColorPreview=styled("div",{position:"relative",boxSizing:"border-box",borderRadius:"$sm",overflow:"hidden",cursor:"pointer",height:"$rowHeight",width:"$rowHeight",backgroundColor:"#fff",backgroundImage:`url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill-opacity=".05"><path d="M8 0h8v8H8zM0 8h8v8H0z"/></svg>')`,$inputStyle:"",$hover:"",zIndex:1,variants:{active:{true:{$inputStyle:"$accent1"}}},"&::before":{content:'""',position:"absolute",top:0,bottom:0,right:0,left:0,backgroundColor:"currentColor",zIndex:1}}),PickerContainer=styled("div",{position:"relative",display:"grid",gridTemplateColumns:"$sizes$rowHeight auto",columnGap:"$colGap",alignItems:"center"}),PickerWrapper=styled("div",{width:"$colorPickerWidth",height:"$colorPickerHeight",".react-colorful":{width:"100%",height:"100%",boxShadow:"$level2",cursor:"crosshair"},".react-colorful__saturation":{borderRadius:"$sm $sm 0 0"},".react-colorful__alpha, .react-colorful__hue":{height:10},".react-colorful__last-control":{borderRadius:"0 0 $sm $sm"},".react-colorful__pointer":{height:12,width:12}});function convertToRgb(X,Z){return Z!=="rgb"?w(X).toRgb():X}function Color({value:X,displayValue:Z,settings:_,onUpdate:K}){const{emitOnEditStart:te,emitOnEditEnd:ne}=useInputContext(),{format:oe,hasAlpha:ie}=_,{popinRef:se,wrapperRef:ae,shown:ge,show:ce,hide:de}=usePopin(),pe=reactExports.useRef(0),[fe,be]=reactExports.useState(()=>convertToRgb(X,oe)),me=ie?Ce:Ne,ye=()=>{be(convertToRgb(X,oe)),ce(),te()},ve=()=>{de(),ne(),window.clearTimeout(pe.current)},Be=()=>{pe.current=window.setTimeout(ve,500)};return reactExports.useEffect(()=>()=>window.clearTimeout(pe.current),[]),React.createElement(React.Fragment,null,React.createElement(ColorPreview,{ref:se,active:ge,onClick:()=>ye(),style:{color:Z}}),ge&&React.createElement(Portal,null,React.createElement(Overlay,{onPointerUp:ve}),React.createElement(PickerWrapper,{ref:ae,onMouseEnter:()=>window.clearTimeout(pe.current),onMouseLeave:Re=>Re.buttons===0&&Be()},React.createElement(me,{color:fe,onChange:K}))))}function ColorComponent(){const{value:X,displayValue:Z,label:_,onChange:K,onUpdate:te,settings:ne}=useInputContext();return React.createElement(Row,{input:!0},React.createElement(Label,null,_),React.createElement(PickerContainer,null,React.createElement(Color,{value:X,displayValue:Z,onChange:K,onUpdate:te,settings:ne}),React.createElement(ValueInput,{value:Z,onChange:K,onUpdate:te})))}var color=_objectSpread2({component:ColorComponent},props$2);function Vector3dComponent(){const{label:X,displayValue:Z,onUpdate:_,settings:K}=useInputContext();return React.createElement(Row,{input:!0},React.createElement(Label,null,X),React.createElement(Vector,{value:Z,settings:K,onUpdate:_}))}var vector3d=_objectSpread2({component:Vector3dComponent},getVectorPlugin(["x","y","z"]));const JoystickTrigger=styled("div",{$flexCenter:"",position:"relative",backgroundColor:"$elevation3",borderRadius:"$sm",cursor:"pointer",height:"$rowHeight",width:"$rowHeight",touchAction:"none",$draggable:"",$hover:"","&:active":{cursor:"none"},"&::after":{content:'""',backgroundColor:"$accent2",height:4,width:4,borderRadius:2}}),JoystickPlayground=styled("div",{$flexCenter:"",width:"$joystickWidth",height:"$joystickHeight",borderRadius:"$sm",boxShadow:"$level2",position:"fixed",zIndex:1e4,overflow:"hidden",$draggable:"",transform:"translate(-50%, -50%)",variants:{isOutOfBounds:{true:{backgroundColor:"$elevation1"},false:{backgroundColor:"$elevation3"}}},"> div":{position:"absolute",$flexCenter:"",borderStyle:"solid",borderWidth:1,borderColor:"$highlight1",backgroundColor:"$elevation3",width:"80%",height:"80%","&::after,&::before":{content:'""',position:"absolute",zindex:10,backgroundColor:"$highlight1"},"&::before":{width:"100%",height:1},"&::after":{height:"100%",width:1}},"> span":{position:"relative",zindex:100,width:10,height:10,backgroundColor:"$accent2",borderRadius:"50%"}});function Joystick({value:X,settings:Z,onUpdate:_}){const K=reactExports.useRef(),te=reactExports.useRef(0),ne=reactExports.useRef(0),oe=reactExports.useRef(1),[ie,se]=reactExports.useState(!1),[ae,ge]=reactExports.useState(!1),[ce,de]=useTransform(),pe=reactExports.useRef(null),fe=reactExports.useRef(null);reactExports.useLayoutEffect(()=>{if(ie){const{top:He,left:Ke,width:Ue,height:tt}=pe.current.getBoundingClientRect();fe.current.style.left=Ke+Ue/2+"px",fe.current.style.top=He+tt/2+"px"}},[ie]);const{keys:[be,me],joystick:ye}=Z,ve=ye==="invertY"?1:-1,{[be]:{step:Be},[me]:{step:Re}}=Z,Ee=useTh("sizes","joystickWidth"),We=useTh("sizes","joystickHeight"),Ze=parseFloat(Ee)*.8/2,Ve=parseFloat(We)*.8/2,_e=reactExports.useCallback(()=>{K.current||(ge(!0),te.current&&de({x:te.current*Ze}),ne.current&&de({y:ne.current*-Ve}),K.current=window.setInterval(()=>{_(He=>{const Ke=Be*te.current*oe.current,Ue=ve*Re*ne.current*oe.current;return Array.isArray(He)?{[be]:He[0]+Ke,[me]:He[1]+Ue}:{[be]:He[be]+Ke,[me]:He[me]+Ue}})},16))},[Ze,Ve,_,de,Be,Re,be,me,ve]),Xe=reactExports.useCallback(()=>{window.clearTimeout(K.current),K.current=void 0,ge(!1)},[]);reactExports.useEffect(()=>{function He(Ke){oe.current=multiplyStep(Ke)}return window.addEventListener("keydown",He),window.addEventListener("keyup",He),()=>{window.clearTimeout(K.current),window.removeEventListener("keydown",He),window.removeEventListener("keyup",He)}},[]);const Pe=useDrag(({first:He,active:Ke,delta:[Ue,tt],movement:[rt,at]})=>{He&&se(!0);const Oe=clamp(rt,-Ze,Ze),$e=clamp(at,-Ve,Ve);te.current=Math.abs(rt)>Math.abs(Oe)?Math.sign(rt-Oe):0,ne.current=Math.abs(at)>Math.abs($e)?Math.sign($e-at):0;let je=X[be],Te=X[me];Ke?(te.current||(je+=Ue*Be*oe.current,de({x:Oe})),ne.current||(Te-=ve*tt*Re*oe.current,de({y:$e})),te.current||ne.current?_e():Xe(),_({[be]:je,[me]:Te})):(se(!1),te.current=0,ne.current=0,de({x:0,y:0}),Xe())});return React.createElement(JoystickTrigger,_extends$1({ref:pe},Pe()),ie&&React.createElement(Portal,null,React.createElement(JoystickPlayground,{ref:fe,isOutOfBounds:ae},React.createElement("div",null),React.createElement("span",{ref:ce}))))}const Container$1=styled("div",{display:"grid",columnGap:"$colGap",variants:{withJoystick:{true:{gridTemplateColumns:"$sizes$rowHeight auto"},false:{gridTemplateColumns:"auto"}}}});function Vector2dComponent(){const{label:X,displayValue:Z,onUpdate:_,settings:K}=useInputContext();return React.createElement(Row,{input:!0},React.createElement(Label,null,X),React.createElement(Container$1,{withJoystick:!!K.joystick},K.joystick&&React.createElement(Joystick,{value:Z,settings:K,onUpdate:_}),React.createElement(Vector,{value:Z,settings:K,onUpdate:_})))}const _excluded$7=["joystick"],plugin=getVectorPlugin(["x","y"]),normalize$2=X=>{let{joystick:Z=!0}=X,_=_objectWithoutProperties$2(X,_excluded$7);const{value:K,settings:te}=plugin.normalize(_);return{value:K,settings:_objectSpread2(_objectSpread2({},te),{},{joystick:Z})}};var vector2d=_objectSpread2(_objectSpread2({component:Vector2dComponent},plugin),{},{normalize:normalize$2});const sanitize$1=X=>{if(X!==void 0){if(X instanceof File)try{return URL.createObjectURL(X)}catch{return}if(typeof X=="string"&&X.indexOf("blob:")===0)return X;throw Error("Invalid image format [undefined | blob | File].")}},schema$1=(X,Z)=>typeof Z=="object"&&"image"in Z,normalize$1=({image:X})=>({value:X});var props$1=Object.freeze({__proto__:null,sanitize:sanitize$1,schema:schema$1,normalize:normalize$1});const ImageContainer=styled("div",{position:"relative",display:"grid",gridTemplateColumns:"$sizes$rowHeight auto 20px",columnGap:"$colGap",alignItems:"center"}),DropZone=styled("div",{$flexCenter:"",overflow:"hidden",height:"$rowHeight",background:"$elevation3",textAlign:"center",color:"inherit",borderRadius:"$sm",outline:"none",userSelect:"none",cursor:"pointer",$inputStyle:"",$hover:"",$focusWithin:"",$active:"$accent1 $elevation1",variants:{isDragAccept:{true:{$inputStyle:"$accent1",backgroundColor:"$elevation1"}}}}),ImagePreview=styled("div",{boxSizing:"border-box",borderRadius:"$sm",height:"$rowHeight",width:"$rowHeight",$inputStyle:"",backgroundSize:"cover",backgroundPosition:"center",variants:{hasImage:{true:{cursor:"pointer",$hover:"",$active:""}}}}),ImageLargePreview=styled("div",{$flexCenter:"",width:"$imagePreviewWidth",height:"$imagePreviewHeight",borderRadius:"$sm",boxShadow:"$level2",pointerEvents:"none",$inputStyle:"",backgroundSize:"cover",backgroundPosition:"center"}),Instructions=styled("div",{fontSize:"0.8em",height:"100%",padding:"$rowGap $md"}),Remove=styled("div",{$flexCenter:"",top:"0",right:"0",marginRight:"$sm",height:"100%",cursor:"pointer",variants:{disabled:{true:{color:"$elevation3",cursor:"default"}}},"&::after,&::before":{content:'""',position:"absolute",height:2,width:10,borderRadius:1,backgroundColor:"currentColor"},"&::after":{transform:"rotate(45deg)"},"&::before":{transform:"rotate(-45deg)"}});function ImageComponent(){const{label:X,value:Z,onUpdate:_,disabled:K}=useInputContext(),{popinRef:te,wrapperRef:ne,shown:oe,show:ie,hide:se}=usePopin(),ae=reactExports.useCallback(fe=>{fe.length&&_(fe[0])},[_]),ge=reactExports.useCallback(fe=>{fe.stopPropagation(),_(void 0)},[_]),{getRootProps:ce,getInputProps:de,isDragAccept:pe}=useDropzone({maxFiles:1,accept:"image/*",onDrop:ae,disabled:K});return React.createElement(Row,{input:!0},React.createElement(Label,null,X),React.createElement(ImageContainer,null,React.createElement(ImagePreview,{ref:te,hasImage:!!Z,onPointerDown:()=>!!Z&&ie(),onPointerUp:se,style:{backgroundImage:Z?`url(${Z})`:"none"}}),oe&&!!Z&&React.createElement(Portal,null,React.createElement(Overlay,{onPointerUp:se,style:{cursor:"pointer"}}),React.createElement(ImageLargePreview,{ref:ne,style:{backgroundImage:`url(${Z})`}})),React.createElement(DropZone,ce({isDragAccept:pe}),React.createElement("input",de()),React.createElement(Instructions,null,pe?"drop image":"click or drop")),React.createElement(Remove,{onClick:ge,disabled:!Z})))}var image=_objectSpread2({component:ImageComponent},props$1);const number=v8n().number(),schema=(X,Z)=>v8n().array().length(2).every.number().test(X)&&v8n().schema({min:number,max:number}).test(Z),format=X=>({min:X[0],max:X[1]}),sanitize=(X,{bounds:[Z,_]},K)=>{const te=Array.isArray(X)?format(X):X,ne={min:K[0],max:K[1]},{min:oe,max:ie}=_objectSpread2(_objectSpread2({},ne),te);return[clamp(Number(oe),Z,Math.max(Z,ie)),clamp(Number(ie),Math.min(_,oe),_)]},normalize=({value:X,min:Z,max:_})=>{const K={min:Z,max:_},te=normalizeKeyedNumberSettings(format(X),{min:K,max:K}),ne=[Z,_],oe=_objectSpread2(_objectSpread2({},te),{},{bounds:ne});return{value:sanitize(format(X),oe,X),settings:oe}};var props=Object.freeze({__proto__:null,schema,format,sanitize,normalize});const _excluded$6=["value","bounds","onDrag"],_excluded2$1=["bounds"],Container=styled("div",{display:"grid",columnGap:"$colGap",gridTemplateColumns:"auto calc($sizes$numberInputMinWidth * 2 + $space$rowGap)"});function IntervalSlider(X){let{value:Z,bounds:[_,K],onDrag:te}=X,ne=_objectWithoutProperties$2(X,_excluded$6);const oe=reactExports.useRef(null),ie=reactExports.useRef(null),se=reactExports.useRef(null),ae=reactExports.useRef(0),ge=useTh("sizes","scrubberWidth"),ce=useDrag(({event:fe,first:be,xy:[me],movement:[ye],memo:ve={}})=>{if(be){const{width:Re,left:Ee}=oe.current.getBoundingClientRect();ae.current=Re-parseFloat(ge);const We=(fe==null?void 0:fe.target)===ie.current||(fe==null?void 0:fe.target)===se.current;ve.pos=invertedRange((me-Ee)/Re,_,K);const Ze=Math.abs(ve.pos-Z.min)-Math.abs(ve.pos-Z.max);ve.key=Ze<0||Ze===0&&ve.pos<=Z.min?"min":"max",We&&(ve.pos=Z[ve.key])}const Be=ve.pos+invertedRange(ye/ae.current,0,K-_);return te({[ve.key]:sanitizeStep(Be,ne[ve.key])}),ve}),de=`calc(${range(Z.min,_,K)} * (100% - ${ge} - 8px) + 4px)`,pe=`calc(${1-range(Z.max,_,K)} * (100% - ${ge} - 8px) + 4px)`;return React.createElement(RangeWrapper,_extends$1({ref:oe},ce()),React.createElement(Range,null,React.createElement(Indicator,{style:{left:de,right:pe}})),React.createElement(Scrubber,{position:"left",ref:ie,style:{left:de}}),React.createElement(Scrubber,{position:"right",ref:se,style:{right:pe}}))}function IntervalComponent(){const{label:X,displayValue:Z,onUpdate:_,settings:K}=useInputContext(),te=_objectWithoutProperties$2(K,_excluded2$1);return React.createElement(React.Fragment,null,React.createElement(Row,{input:!0},React.createElement(Label,null,X),React.createElement(Container,null,React.createElement(IntervalSlider,_extends$1({value:Z},K,{onDrag:_})),React.createElement(Vector,{value:Z,settings:te,onUpdate:_,innerLabelTrim:0}))))}var interval=_objectSpread2({component:IntervalComponent},props);const createEventEmitter=()=>{const X=new Map;return{on:(Z,_)=>{let K=X.get(Z);K===void 0&&(K=new Set,X.set(Z,K)),K.add(_)},off:(Z,_)=>{const K=X.get(Z);K!==void 0&&(K.delete(_),K.size===0&&X.delete(Z))},emit:(Z,..._)=>{const K=X.get(Z);if(K!==void 0)for(const te of K)te(..._)}}},_excluded$5=["type","value"],_excluded2=["onChange","transient","onEditStart","onEditEnd"],Store=function(){const Z=create(subscribeWithSelector(()=>({data:{}}))),_=createEventEmitter();this.storeId=getUid(),this.useStore=Z;const K={},te=new Set;this.getVisiblePaths=()=>{const oe=this.getData(),ie=Object.keys(oe),se=[];Object.entries(K).forEach(([ge,ce])=>{ce.render&&ie.some(de=>de.indexOf(ge)===0)&&!ce.render(this.get)&&se.push(ge+".")});const ae=[];return te.forEach(ge=>{ge in oe&&oe[ge].__refCount>0&&se.every(ce=>ge.indexOf(ce)===-1)&&(!oe[ge].render||oe[ge].render(this.get))&&ae.push(ge)}),ae},this.setOrderedPaths=oe=>{oe.forEach(ie=>te.add(ie))},this.orderPaths=oe=>(this.setOrderedPaths(oe),oe),this.disposePaths=oe=>{Z.setState(ie=>{const se=ie.data;return oe.forEach(ae=>{if(ae in se){const ge=se[ae];ge.__refCount--,ge.__refCount===0&&ge.type in SpecialInputs&&delete se[ae]}}),{data:se}})},this.dispose=()=>{Z.setState(()=>({data:{}}))},this.getFolderSettings=oe=>K[oe]||{},this.getData=()=>Z.getState().data,this.addData=(oe,ie)=>{Z.setState(se=>{const ae=se.data;return Object.entries(oe).forEach(([ge,ce])=>{let de=ae[ge];if(de){const{type:pe,value:fe}=ce,be=_objectWithoutProperties$2(ce,_excluded$5);pe!==de.type?warn(LevaErrors.INPUT_TYPE_OVERRIDE,pe):((de.__refCount===0||ie)&&Object.assign(de,be),de.__refCount++)}else ae[ge]=_objectSpread2(_objectSpread2({},ce),{},{__refCount:1})}),{data:ae}})},this.setValueAtPath=(oe,ie,se)=>{Z.setState(ae=>{const ge=ae.data;return updateInput(ge[oe],ie,oe,this,se),{data:ge}})},this.setSettingsAtPath=(oe,ie)=>{Z.setState(se=>{const ae=se.data;return ae[oe].settings=_objectSpread2(_objectSpread2({},ae[oe].settings),ie),{data:ae}})},this.disableInputAtPath=(oe,ie)=>{Z.setState(se=>{const ae=se.data;return ae[oe].disabled=ie,{data:ae}})},this.set=(oe,ie)=>{Z.setState(se=>{const ae=se.data;return Object.entries(oe).forEach(([ge,ce])=>{try{updateInput(ae[ge],ce,void 0,void 0,ie)}catch{}}),{data:ae}})},this.getInput=oe=>{try{return this.getData()[oe]}catch{warn(LevaErrors.PATH_DOESNT_EXIST,oe)}},this.get=oe=>{var ie;return(ie=this.getInput(oe))===null||ie===void 0?void 0:ie.value},this.emitOnEditStart=oe=>{_.emit(`onEditStart:${oe}`,this.get(oe),oe,_objectSpread2(_objectSpread2({},this.getInput(oe)),{},{get:this.get}))},this.emitOnEditEnd=oe=>{_.emit(`onEditEnd:${oe}`,this.get(oe),oe,_objectSpread2(_objectSpread2({},this.getInput(oe)),{},{get:this.get}))},this.subscribeToEditStart=(oe,ie)=>{const se=`onEditStart:${oe}`;return _.on(se,ie),()=>_.off(se,ie)},this.subscribeToEditEnd=(oe,ie)=>{const se=`onEditEnd:${oe}`;return _.on(se,ie),()=>_.off(se,ie)};const ne=(oe,ie,se)=>{const ae={};return Object.entries(oe).forEach(([ge,ce])=>{if(ge==="")return warn(LevaErrors.EMPTY_KEY);let de=join(ie,ge);if(ce.type===SpecialInputs.FOLDER){const pe=ne(ce.schema,de,se);Object.assign(ae,pe),de in K||(K[de]=ce.settings)}else if(ge in se)warn(LevaErrors.DUPLICATE_KEYS,ge,de,se[ge].path);else{const pe=normalizeInput(ce,ge,de,ae);if(pe){const{type:fe,options:be,input:me}=pe,{onChange:ye,transient:ve,onEditStart:Be,onEditEnd:Re}=be,Ee=_objectWithoutProperties$2(be,_excluded2);ae[de]=_objectSpread2(_objectSpread2(_objectSpread2({type:fe},Ee),me),{},{fromPanel:!0}),se[ge]={path:de,onChange:ye,transient:ve,onEditStart:Be,onEditEnd:Re}}else warn(LevaErrors.UNKNOWN_INPUT,de,ce)}}),ae};this.getDataFromSchema=oe=>{const ie={};return[ne(oe,"",ie),ie]}},levaStore=new Store,defaultSettings$2={collapsed:!1};function folder(X,Z){return{type:SpecialInputs.FOLDER,schema:X,settings:_objectSpread2(_objectSpread2({},defaultSettings$2),Z)}}const isInput=X=>"__levaInput"in X,buildTree=(X,Z)=>{const _={},K=Z?Z.toLowerCase():null;return X.forEach(te=>{const[ne,oe]=getKeyPath(te);(!K||ne.toLowerCase().indexOf(K)>-1)&&merge(_,oe,{[ne]:{__levaInput:!0,path:te}})}),_},_excluded$4=["type","label","path","valueKey","value","settings","setValue","disabled"];function ControlInput(X){let{type:Z,label:_,path:K,valueKey:te,value:ne,settings:oe,setValue:ie,disabled:se}=X,ae=_objectWithoutProperties$2(X,_excluded$4);const{displayValue:ge,onChange:ce,onUpdate:de}=useInputSetters({type:Z,value:ne,settings:oe,setValue:ie}),pe=Plugins[Z].component;return pe?React.createElement(InputContext.Provider,{value:_objectSpread2({key:te,path:K,id:""+K,label:_,displayValue:ge,value:ne,onChange:ce,onUpdate:de,settings:oe,setValue:ie,disabled:se},ae)},React.createElement(StyledInputWrapper$1,{disabled:se},React.createElement(pe,null))):(warn(LevaErrors.NO_COMPONENT_FOR_TYPE,Z,K),null)}const StyledButton=styled("button",{display:"block",$reset:"",fontWeight:"$button",height:"$rowHeight",borderStyle:"none",borderRadius:"$sm",backgroundColor:"$elevation1",color:"$highlight1","&:not(:disabled)":{color:"$highlight3",backgroundColor:"$accent2",cursor:"pointer",$hover:"$accent3",$active:"$accent3 $accent1",$focus:""}});function Button({onClick:X,settings:Z,label:_}){const K=useStoreContext();return React.createElement(Row,null,React.createElement(StyledButton,{disabled:Z.disabled,onClick:()=>X(K.get)},_))}const StyledButtonGroup=styled("div",{$flex:"",justifyContent:"flex-end",gap:"$colGap"}),StyledButtonGroupButton=styled("button",{$reset:"",cursor:"pointer",borderRadius:"$xs","&:hover":{backgroundColor:"$elevation3"}}),getOpts=({label:X,opts:Z})=>{let _=typeof X=="string"&&X.trim()===""?null:X,K=Z;return typeof Z.opts=="object"&&(K.label!==void 0&&(_=Z.label),K=Z.opts),{label:_,opts:K}};function ButtonGroup(X){const{label:Z,opts:_}=getOpts(X),K=useStoreContext();return React.createElement(Row,{input:!!Z},Z&&React.createElement(Label,null,Z),React.createElement(StyledButtonGroup,null,Object.entries(_).map(([te,ne])=>React.createElement(StyledButtonGroupButton,{key:te,onClick:()=>ne(K.get)},te))))}const Canvas=styled("canvas",{height:"$monitorHeight",width:"100%",display:"block",borderRadius:"$sm"}),POINTS=100;function push(X,Z){X.push(Z),X.length>POINTS&&X.shift()}const MonitorCanvas=reactExports.forwardRef(function({initialValue:X},Z){const _=useTh("colors","highlight3"),K=useTh("colors","elevation2"),te=useTh("colors","highlight1"),[ne,oe]=reactExports.useMemo(()=>[w(te).alpha(.4).toRgbString(),w(te).alpha(.1).toRgbString()],[te]),ie=reactExports.useRef([X]),se=reactExports.useRef(X),ae=reactExports.useRef(X),ge=reactExports.useRef(),ce=reactExports.useCallback((fe,be)=>{if(!fe)return;const{width:me,height:ye}=fe,ve=new Path2D,Be=me/POINTS,Re=ye*.05;for(let Ze=0;Ze<ie.current.length;Ze++){const Ve=range(ie.current[Ze],se.current,ae.current),_e=Be*Ze,Xe=ye-Ve*(ye-Re*2)-Re;ve.lineTo(_e,Xe)}be.clearRect(0,0,me,ye);const Ee=new Path2D(ve);Ee.lineTo(Be*(ie.current.length+1),ye),Ee.lineTo(0,ye),Ee.lineTo(0,0);const We=be.createLinearGradient(0,0,0,ye);We.addColorStop(0,ne),We.addColorStop(1,oe),be.fillStyle=We,be.fill(Ee),be.strokeStyle=K,be.lineJoin="round",be.lineWidth=14,be.stroke(ve),be.strokeStyle=_,be.lineWidth=2,be.stroke(ve)},[_,K,ne,oe]),[de,pe]=useCanvas2d(ce);return reactExports.useImperativeHandle(Z,()=>({frame:fe=>{(se.current===void 0||fe<se.current)&&(se.current=fe),(ae.current===void 0||fe>ae.current)&&(ae.current=fe),push(ie.current,fe),ge.current=requestAnimationFrame(()=>ce(de.current,pe.current))}}),[de,pe,ce]),reactExports.useEffect(()=>()=>cancelAnimationFrame(ge.current),[]),React.createElement(Canvas,{ref:de})}),parse=X=>Number.isFinite(X)?X.toPrecision(2):X.toString(),MonitorLog=reactExports.forwardRef(function({initialValue:X},Z){const[_,K]=reactExports.useState(parse(X));return reactExports.useImperativeHandle(Z,()=>({frame:te=>K(parse(te))}),[]),React.createElement("div",null,_)});function getValue(X){return typeof X=="function"?X():X.current}function Monitor({label:X,objectOrFn:Z,settings:_}){const K=reactExports.useRef(),te=reactExports.useRef(getValue(Z));return reactExports.useEffect(()=>{const ne=window.setInterval(()=>{var oe;document.hidden||(oe=K.current)===null||oe===void 0||oe.frame(getValue(Z))},_.interval);return()=>window.clearInterval(ne)},[Z,_.interval]),React.createElement(Row,{input:!0},React.createElement(Label,{align:"top"},X),_.graph?React.createElement(MonitorCanvas,{ref:K,initialValue:te.current}):React.createElement(MonitorLog,{ref:K,initialValue:te.current}))}const _excluded$3=["type","label","key"],specialComponents={[SpecialInputs.BUTTON]:Button,[SpecialInputs.BUTTON_GROUP]:ButtonGroup,[SpecialInputs.MONITOR]:Monitor},Control=React.memo(({path:X})=>{const[Z,{set:_,setSettings:K,disable:te,storeId:ne,emitOnEditStart:oe,emitOnEditEnd:ie}]=useInput(X);if(!Z)return null;const{type:se,label:ae,key:ge}=Z,ce=_objectWithoutProperties$2(Z,_excluded$3);if(se in SpecialInputs){const de=specialComponents[se];return React.createElement(de,_extends$1({label:ae,path:X},ce))}return se in Plugins?React.createElement(ControlInput,_extends$1({key:ne+X,type:se,label:ae,storeId:ne,path:X,valueKey:ge,setValue:_,setSettings:K,disable:te,emitOnEditStart:oe,emitOnEditEnd:ie},ce)):(log$1(LevaErrors.UNSUPPORTED_INPUT,se,X),null)});function FolderTitle({toggle:X,toggled:Z,name:_}){return React.createElement(StyledTitle,{onClick:()=>X()},React.createElement(Chevron,{toggled:Z}),React.createElement("div",null,_))}const Folder=({name:X,path:Z,tree:_})=>{const K=useStoreContext(),te=join(Z,X),{collapsed:ne,color:oe}=K.getFolderSettings(te),[ie,se]=reactExports.useState(!ne),ae=reactExports.useRef(null),ge=useTh("colors","folderWidgetColor"),ce=useTh("colors","folderTextColor");return reactExports.useLayoutEffect(()=>{ae.current.style.setProperty("--leva-colors-folderWidgetColor",oe||ge),ae.current.style.setProperty("--leva-colors-folderTextColor",oe||ce)},[oe,ge,ce]),React.createElement(StyledFolder,{ref:ae},React.createElement(FolderTitle,{name:X,toggled:ie,toggle:()=>se(de=>!de)}),React.createElement(TreeWrapper,{parent:te,tree:_,toggled:ie}))},TreeWrapper=React.memo(({isRoot:X=!1,fill:Z=!1,flat:_=!1,parent:K,tree:te,toggled:ne})=>{const{wrapperRef:oe,contentRef:ie}=useToggle(ne),se=useStoreContext(),ae=([ce,de])=>{var pe;return(isInput(de)?(pe=se.getInput(de.path))===null||pe===void 0?void 0:pe.order:se.getFolderSettings(join(K,ce)).order)||0},ge=Object.entries(te).sort((ce,de)=>ae(ce)-ae(de));return React.createElement(StyledWrapper,{ref:oe,isRoot:X,fill:Z,flat:_},React.createElement(StyledContent,{ref:ie,isRoot:X,toggled:ne},ge.map(([ce,de])=>isInput(de)?React.createElement(Control,{key:de.path,valueKey:de.valueKey,path:de.path}):React.createElement(Folder,{key:ce,name:ce,path:K,tree:de}))))}),StyledRoot=styled("div",{position:"relative",fontFamily:"$mono",fontSize:"$root",color:"$rootText",backgroundColor:"$elevation1",variants:{fill:{false:{position:"fixed",top:"10px",right:"10px",zIndex:1e3,width:"$rootWidth"},true:{position:"relative",width:"100%"}},flat:{false:{borderRadius:"$lg",boxShadow:"$level1"}},oneLineLabels:{true:{[`${StyledInputRow}`]:{gridTemplateColumns:"auto",gridAutoColumns:"minmax(max-content, 1fr)",gridAutoRows:"minmax($sizes$rowHeight), auto)",rowGap:0,columnGap:0,marginTop:"$rowGap"}}},hideTitleBar:{true:{$$titleBarHeight:"0px"},false:{$$titleBarHeight:"$sizes$titleBarHeight"}}},"&,*,*:after,*:before":{boxSizing:"border-box"},"*::selection":{backgroundColor:"$accent2"}}),iconWidth=40,Icon=styled("i",{$flexCenter:"",width:iconWidth,userSelect:"none",cursor:"pointer","> svg":{fill:"$highlight1",transition:"transform 350ms ease, fill 250ms ease"},"&:hover > svg":{fill:"$highlight3"},variants:{active:{true:{"> svg":{fill:"$highlight2"}}}}}),StyledTitleWithFilter=styled("div",{display:"flex",alignItems:"stretch",justifyContent:"space-between",height:"$titleBarHeight",variants:{mode:{drag:{cursor:"grab"}}}}),FilterWrapper=styled("div",{$flex:"",position:"relative",width:"100%",overflow:"hidden",transition:"height 250ms ease",color:"$highlight3",paddingLeft:"$md",[`> ${Icon}`]:{height:30},variants:{toggled:{true:{height:30},false:{height:0}}}}),StyledFilterInput=styled("input",{$reset:"",flex:1,position:"relative",height:30,width:"100%",backgroundColor:"transparent",fontSize:"10px",borderRadius:"$root","&:focus":{},"&::placeholder":{color:"$highlight2"}}),TitleContainer=styled("div",{touchAction:"none",$flexCenter:"",flex:1,"> svg":{fill:"$highlight1"},color:"$highlight1",variants:{drag:{true:{$draggable:"","> svg":{transition:"fill 250ms ease"},"&:hover":{color:"$highlight3"},"&:hover > svg":{fill:"$highlight3"}}},filterEnabled:{false:{paddingRight:iconWidth}}}}),FilterInput=React.forwardRef(({setFilter:X,toggle:Z},_)=>{const[K,te]=reactExports.useState(""),ne=reactExports.useMemo(()=>debounce(X,250),[X]),oe=()=>{X(""),te("")},ie=se=>{const ae=se.currentTarget.value;Z(!0),te(ae)};return reactExports.useEffect(()=>{ne(K)},[K,ne]),React.createElement(React.Fragment,null,React.createElement(StyledFilterInput,{ref:_,value:K,placeholder:"[Open filter with CMD+SHIFT+L]",onPointerDown:se=>se.stopPropagation(),onChange:ie}),React.createElement(Icon,{onClick:()=>oe(),style:{visibility:K?"visible":"hidden"}},React.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",height:"14",width:"14",viewBox:"0 0 20 20",fill:"currentColor"},React.createElement("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z",clipRule:"evenodd"}))))});function TitleWithFilter({setFilter:X,onDrag:Z,onDragStart:_,onDragEnd:K,toggle:te,toggled:ne,title:oe,drag:ie,filterEnabled:se,from:ae}){const[ge,ce]=reactExports.useState(!1),de=reactExports.useRef(null);reactExports.useEffect(()=>{var fe,be;ge?(fe=de.current)===null||fe===void 0||fe.focus():(be=de.current)===null||be===void 0||be.blur()},[ge]);const pe=useDrag(({offset:[fe,be],first:me,last:ye})=>{Z({x:fe,y:be}),me&&_({x:fe,y:be}),ye&&K({x:fe,y:be})},{filterTaps:!0,from:({offset:[fe,be]})=>[(ae==null?void 0:ae.x)||fe,(ae==null?void 0:ae.y)||be]});return reactExports.useEffect(()=>{const fe=be=>{be.key==="L"&&be.shiftKey&&be.metaKey&&ce(me=>!me)};return window.addEventListener("keydown",fe),()=>window.removeEventListener("keydown",fe)},[]),React.createElement(React.Fragment,null,React.createElement(StyledTitleWithFilter,{mode:ie?"drag":void 0},React.createElement(Icon,{active:!ne,onClick:()=>te()},React.createElement(Chevron,{toggled:ne,width:12,height:8})),React.createElement(TitleContainer,_extends$1({},ie?pe():{},{drag:ie,filterEnabled:se}),oe===void 0&&ie?React.createElement("svg",{width:"20",height:"10",viewBox:"0 0 28 14",xmlns:"http://www.w3.org/2000/svg"},React.createElement("circle",{cx:"2",cy:"2",r:"2"}),React.createElement("circle",{cx:"14",cy:"2",r:"2"}),React.createElement("circle",{cx:"26",cy:"2",r:"2"}),React.createElement("circle",{cx:"2",cy:"12",r:"2"}),React.createElement("circle",{cx:"14",cy:"12",r:"2"}),React.createElement("circle",{cx:"26",cy:"12",r:"2"})):oe),se&&React.createElement(Icon,{active:ge,onClick:()=>ce(fe=>!fe)},React.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",height:"20",viewBox:"0 0 20 20"},React.createElement("path",{d:"M9 9a2 2 0 114 0 2 2 0 01-4 0z"}),React.createElement("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm1-13a4 4 0 00-3.446 6.032l-2.261 2.26a1 1 0 101.414 1.415l2.261-2.261A4 4 0 1011 5z",clipRule:"evenodd"})))),React.createElement(FilterWrapper,{toggled:ge},React.createElement(FilterInput,{ref:de,setFilter:X,toggle:te})))}const _excluded$2=["store","hidden","theme","collapsed"];function LevaRoot(X){let{store:Z,hidden:_=!1,theme:K,collapsed:te=!1}=X,ne=_objectWithoutProperties$2(X,_excluded$2);const oe=useDeepMemo(()=>mergeTheme(K),[K]),[ie,se]=reactExports.useState(!te),ae=typeof te=="object"?!te.collapsed:ie,ge=reactExports.useMemo(()=>typeof te=="object"?ce=>{typeof ce=="function"?te.onChange(!ce(!te.collapsed)):te.onChange(!ce)}:se,[te]);return!Z||_?null:React.createElement(ThemeContext.Provider,{value:oe},React.createElement(LevaCore,_extends$1({store:Z},ne,{toggled:ae,setToggle:ge,rootClass:oe.className})))}const LevaCore=React.memo(({store:X,rootClass:Z,fill:_=!1,flat:K=!1,neverHide:te=!1,oneLineLabels:ne=!1,titleBar:oe={title:void 0,drag:!0,filter:!0,position:void 0,onDrag:void 0,onDragStart:void 0,onDragEnd:void 0},hideCopyButton:ie=!1,toggled:se,setToggle:ae})=>{var ge,ce;const de=useVisiblePaths(X),[pe,fe]=reactExports.useState(""),be=reactExports.useMemo(()=>buildTree(de,pe),[de,pe]),[me,ye]=useTransform(),ve=te||de.length>0,Be=typeof oe=="object"&&oe.title||void 0,Re=typeof oe=="object"&&(ge=oe.drag)!==null&&ge!==void 0?ge:!0,Ee=typeof oe=="object"&&(ce=oe.filter)!==null&&ce!==void 0?ce:!0,We=typeof oe=="object"&&oe.position||void 0,Ze=typeof oe=="object"&&oe.onDrag||void 0,Ve=typeof oe=="object"&&oe.onDragStart||void 0,_e=typeof oe=="object"&&oe.onDragEnd||void 0;return React.useEffect(()=>{ye({x:We==null?void 0:We.x,y:We==null?void 0:We.y})},[We,ye]),globalStyles(),React.createElement(PanelSettingsContext.Provider,{value:{hideCopyButton:ie}},React.createElement(StyledRoot,{ref:me,className:Z,fill:_,flat:K,oneLineLabels:ne,hideTitleBar:!oe,style:{display:ve?"block":"none"}},oe&&React.createElement(TitleWithFilter,{onDrag:Xe=>{ye(Xe),Ze==null||Ze(Xe)},onDragStart:Xe=>Ve==null?void 0:Ve(Xe),onDragEnd:Xe=>_e==null?void 0:_e(Xe),setFilter:fe,toggle:Xe=>ae(Pe=>Xe??!Pe),toggled:se,title:Be,drag:Re,filterEnabled:Ee,from:We}),ve&&React.createElement(StoreContext.Provider,{value:X},React.createElement(TreeWrapper,{isRoot:!0,fill:_,flat:K,tree:be,toggled:se}))))}),_excluded$1=["isRoot"];let rootInitialized=!1,rootEl=null;function Leva(X){let{isRoot:Z=!1}=X,_=_objectWithoutProperties$2(X,_excluded$1);return reactExports.useEffect(()=>(rootInitialized=!0,!Z&&rootEl&&(rootEl.remove(),rootEl=null),()=>{Z||(rootInitialized=!1)}),[Z]),React.createElement(LevaRoot,_extends$1({store:levaStore},_))}function useRenderRoot(X){reactExports.useEffect(()=>{X&&!rootInitialized&&(rootEl||(rootEl=document.getElementById("leva__root")||Object.assign(document.createElement("div"),{id:"leva__root"}),document.body&&(document.body.appendChild(rootEl),clientExports.createRoot(rootEl).render(React.createElement(Leva,{isRoot:!0})))),rootInitialized=!0)},[X])}function parseArgs(X,Z,_,K,te){let ne,oe,ie,se,ae;return typeof X=="string"?(oe=X,ne=Z,Array.isArray(_)&&(ae=_)):(ne=X,Array.isArray(Z)?ae=Z:(se=Z,ae=_)),{schema:ne,folderName:oe,folderSettings:ie,hookSettings:se,deps:ae||[]}}function useControls(X,Z,_,K,te){const{folderName:ne,schema:oe,folderSettings:ie,hookSettings:se,deps:ae}=parseArgs(X,Z,_),ge=typeof oe=="function",ce=reactExports.useRef(!1),de=reactExports.useRef(!0),pe=useDeepMemo(()=>{ce.current=!0;const Pe=typeof oe=="function"?oe():oe;return ne?{[ne]:folder(Pe,ie)}:Pe},ae),fe=!(se!=null&&se.store);useRenderRoot(fe);const[be]=reactExports.useState(()=>(se==null?void 0:se.store)||levaStore),[me,ye]=reactExports.useMemo(()=>be.getDataFromSchema(pe),[be,pe]),[ve,Be,Re,Ee,We]=reactExports.useMemo(()=>{const Pe=[],He=[],Ke={},Ue={},tt={};return Object.values(ye).forEach(({path:rt,onChange:at,onEditStart:Oe,onEditEnd:$e,transient:je})=>{Pe.push(rt),at?(Ke[rt]=at,je||He.push(rt)):He.push(rt),Oe&&(Ue[rt]=Oe),$e&&(tt[rt]=$e)}),[Pe,He,Ke,Ue,tt]},[ye]),Ze=reactExports.useMemo(()=>be.orderPaths(ve),[ve,be]),Ve=useValuesForPath(be,Be,me),_e=reactExports.useCallback(Pe=>{const He=Object.entries(Pe).reduce((Ke,[Ue,tt])=>Object.assign(Ke,{[ye[Ue].path]:tt}),{});be.set(He,!1)},[be,ye]),Xe=reactExports.useCallback(Pe=>be.get(ye[Pe].path),[be,ye]);return reactExports.useEffect(()=>{const Pe=!de.current&&ce.current;return be.addData(me,Pe),de.current=!1,ce.current=!1,()=>be.disposePaths(Ze)},[be,Ze,me]),reactExports.useEffect(()=>{const Pe=[];return Object.entries(Re).forEach(([He,Ke])=>{Ke(be.get(He),He,_objectSpread2({initial:!0,get:be.get},be.getInput(He)));const Ue=be.useStore.subscribe(tt=>{const rt=tt.data[He];return[rt.disabled?void 0:rt.value,rt]},([tt,rt])=>Ke(tt,He,_objectSpread2({initial:!1,get:be.get},rt)),{equalityFn:shallow});Pe.push(Ue)}),()=>Pe.forEach(He=>He())},[be,Re]),reactExports.useEffect(()=>{const Pe=[];return Object.entries(Ee).forEach(([He,Ke])=>Pe.push(be.subscribeToEditStart(He,Ke))),Object.entries(We).forEach(([He,Ke])=>Pe.push(be.subscribeToEditEnd(He,Ke))),()=>Pe.forEach(He=>He())},[Ee,We,be]),ge?[Ve,_e,Xe]:Ve}register(LevaInputs.SELECT,select);register(LevaInputs.IMAGE,image);register(LevaInputs.NUMBER,number$1);register(LevaInputs.COLOR,color);register(LevaInputs.STRING,string);register(LevaInputs.BOOLEAN,boolean);register(LevaInputs.INTERVAL,interval);register(LevaInputs.VECTOR3D,vector3d);register(LevaInputs.VECTOR2D,vector2d);const API_KEY="2d12bd421e3af7ce47223bce45944908",AVATAR_ID="fe2da934-6aa4-11ef-8fba-42010a7be011",AVATAR_ID_2="881e4aac-50d5-11ef-9461-42010a7be011",AVATAR_ID_3="9ff38f44-437d-11ef-9187-42010a7be011",AVATAR_ID_4="2734589a-ef8f-11ef-9966-42010a7be016",CONVAI_API_URL="https://api.convai.com/character/get",emitAvatarTypeChange=X=>{window.dispatchEvent(new CustomEvent("avatar-hide")),window.dispatchEvent(new CustomEvent("scene-loading-start")),setTimeout(()=>{window.dispatchEvent(new CustomEvent("avatar-type-change",{detail:X})),setTimeout(()=>{window.dispatchEvent(new CustomEvent("scene-loading-end")),window.dispatchEvent(new CustomEvent("avatar-show"))},500)},100)},LoadingDots=()=>{const[X,Z]=reactExports.useState("");return reactExports.useEffect(()=>{const _=setInterval(()=>{Z(K=>K.length>=3?"":K+".")},500);return()=>clearInterval(_)},[]),X},LoadingSpinner$1=()=>jsxRuntimeExports.jsx(Html,{center:!0,children:jsxRuntimeExports.jsxs("div",{className:"loading-spinner",children:[jsxRuntimeExports.jsx("div",{className:"spinner"}),jsxRuntimeExports.jsxs("div",{className:"loading-text",children:["Loading",LoadingDots()]})]})});function AvatarModel({modelUrl:X,onLoad:Z,visible:_,avatarType:K,onReady:te,...ne}){const{scene:oe}=useGLTF(X),ie=useControls({"Lewa Ręka":folder({leftShoulderX:{value:.45,min:-1,max:1,step:.01},leftShoulderY:{value:-.01,min:-1,max:1,step:.01},leftShoulderZ:{value:-.64,min:-1,max:1,step:.01},leftArmX:{value:.4,min:-1,max:1,step:.01},leftArmY:{value:-.01,min:-1,max:1,step:.01},leftArmZ:{value:.03,min:-1,max:1,step:.01},leftForeArmX:{value:.16,min:-1,max:1,step:.01},leftForeArmY:{value:.1,min:-1,max:1,step:.01},leftForeArmZ:{value:.1,min:-1,max:1,step:.01}}),"Prawa Ręka":folder({rightShoulderX:{value:.65,min:-1,max:1,step:.01},rightShoulderY:{value:.1,min:-1,max:1,step:.01},rightShoulderZ:{value:.61,min:-1,max:1,step:.01},rightArmX:{value:.37,min:-1,max:1,step:.01},rightArmY:{value:0,min:-1,max:1,step:.01},rightArmZ:{value:-.15,min:-1,max:1,step:.01},rightForeArmX:{value:0,min:-1,max:1,step:.01},rightForeArmY:{value:-.1,min:-1,max:1,step:.01},rightForeArmZ:{value:-.1,min:-1,max:1,step:.01}})}),se=React.useMemo(()=>{const We=SkeletonUtils.clone(oe),Ze=Ue=>{let tt=null;return We.traverse(rt=>{rt.isBone&&rt.name===Ue&&(tt=rt)}),tt},Ve=Ze("LeftShoulder"),_e=Ze("LeftArm"),Xe=Ze("LeftForeArm");Ve&&(Ve.rotation.x=Math.PI*ie.leftShoulderX,Ve.rotation.y=Math.PI*ie.leftShoulderY,Ve.rotation.z=Math.PI*ie.leftShoulderZ),_e&&(_e.rotation.x=Math.PI*ie.leftArmX,_e.rotation.y=Math.PI*ie.leftArmY,_e.rotation.z=Math.PI*ie.leftArmZ),Xe&&(Xe.rotation.x=Math.PI*ie.leftForeArmX,Xe.rotation.y=Math.PI*ie.leftForeArmY,Xe.rotation.z=Math.PI*ie.leftForeArmZ);const Pe=Ze("RightShoulder"),He=Ze("RightArm"),Ke=Ze("RightForeArm");return Pe&&(Pe.rotation.x=Math.PI*ie.rightShoulderX,Pe.rotation.y=Math.PI*ie.rightShoulderY,Pe.rotation.z=Math.PI*ie.rightShoulderZ),He&&(He.rotation.x=Math.PI*ie.rightArmX,He.rotation.y=Math.PI*ie.rightArmY,He.rotation.z=Math.PI*ie.rightArmZ),Ke&&(Ke.rotation.x=Math.PI*ie.rightForeArmX,Ke.rotation.y=Math.PI*ie.rightForeArmY,Ke.rotation.z=Math.PI*ie.rightForeArmZ),We},[oe,ie]),ae=reactExports.useRef(),[ge,ce]=reactExports.useState(!1),[de,pe]=reactExports.useState(!0);reactExports.useEffect(()=>{const We=()=>ce(!1),Ze=()=>ce(!0),Ve=()=>pe(!0),_e=()=>pe(!1);return window.addEventListener("avatar-hide",We),window.addEventListener("avatar-show",Ze),window.addEventListener("scene-loading-start",Ve),window.addEventListener("scene-loading-end",_e),()=>{window.removeEventListener("avatar-hide",We),window.removeEventListener("avatar-show",Ze),window.removeEventListener("scene-loading-start",Ve),window.removeEventListener("scene-loading-end",_e)}},[]),reactExports.useEffect(()=>{pe(!0),ce(!1);const We=setTimeout(()=>{pe(!1),ce(!0)},1e3);return()=>clearTimeout(We)},[]),reactExports.useEffect(()=>{useGLTF.preload("/models/avatar1.glb")},[]),reactExports.useEffect(()=>{const We=Ze=>{const Ve=Ze.detail;se&&Ve&&se.traverse(_e=>{_e.isMesh&&_e.morphTargetInfluences&&Ve.forEach((Xe,Pe)=>{Pe<_e.morphTargetInfluences.length&&(_e.morphTargetInfluences[Pe]=Xe)})})};return window.addEventListener("viseme-update",We),()=>window.removeEventListener("viseme-update",We)},[se]),reactExports.useEffect(()=>{const We=()=>{se&&se.traverse(Ze=>{Ze.isMesh&&Ze.morphTargetInfluences&&Ze.morphTargetInfluences.fill(0)})};return window.addEventListener("avatar-talking-end",We),()=>window.removeEventListener("avatar-talking-end",We)},[se]);const[fe,be]=reactExports.useState([]),[me,ye]=reactExports.useState(0),ve=reactExports.useRef(0),Be=reactExports.useRef();reactExports.useEffect(()=>{const We=Ze=>{if(fe.length>0){ve.current+=.016;const Ve=Math.floor(ve.current*100);ye(Ve),Ve>=fe.length?(Ee(),be([]),ve.current=0):Re(Ve)}Be.current=requestAnimationFrame(We)};return Be.current=requestAnimationFrame(We),()=>cancelAnimationFrame(Be.current)},[fe]);const Re=We=>{!window.visemeData||We>=window.visemeData.length||se.traverse(Ze=>{if(Ze.isMesh&&Ze.morphTargetInfluences)for(let Ve=0;Ve<15;Ve++)Ze.morphTargetInfluences[Ve]=window.visemeData[We][Ve]||0})},Ee=()=>{se.traverse(We=>{if(We.isMesh&&We.morphTargetInfluences)for(let Ze=0;Ze<15;Ze++)We.morphTargetInfluences[Ze]=0})};return reactExports.useEffect(()=>{const We=()=>{window.visemeData&&(be([...window.visemeData]),ve.current=0)};return window.addEventListener("viseme-data-update",We),()=>window.removeEventListener("viseme-data-update",We)},[]),reactExports.useEffect(()=>{se&&se.traverse(We=>{We.isMesh})},[se]),reactExports.useEffect(()=>{K&&_&&emitAvatarTypeChange(K)},[K,_]),reactExports.useEffect(()=>{if(te&&typeof te=="function"){te(!1);const We=setTimeout(()=>{se&&!de&&_&&(console.log("Avatar model ready:",K),te(!0))},2e3);return()=>clearTimeout(We)}},[se,de,_,K,te]),de?jsxRuntimeExports.jsx("group",{visible:_,children:jsxRuntimeExports.jsx(LoadingSpinner$1,{})}):jsxRuntimeExports.jsxs("group",{visible:_&&ge,ref:ae,children:[jsxRuntimeExports.jsx("primitive",{object:se,...ne}),se.nodes&&jsxRuntimeExports.jsx(Lipsync,{model:se})]})}function ConvaiAvatar({onLoad:X,visible:Z,onReady:_,...K}){const[te,ne]=reactExports.useState(null),[oe,ie]=reactExports.useState(null),[se,ae]=reactExports.useState(!1),[ge,ce]=reactExports.useState(1);return reactExports.useEffect(()=>{Z&&ae(!0)},[Z]),reactExports.useEffect(()=>{if(!te){async function de(){var pe;try{const fe=await fetch(CONVAI_API_URL,{method:"POST",headers:{"CONVAI-API-KEY":API_KEY,"Content-Type":"application/json"},body:JSON.stringify({charID:AVATAR_ID})});if(!fe.ok)throw new Error("Failed to fetch character");const be=await fe.json();if((pe=be==null?void 0:be.model_details)!=null&&pe.modelLink)ne(be.model_details.modelLink),ce(1),Z&&emitAvatarTypeChange(1);else throw new Error("Invalid model URL")}catch(fe){ie(fe)}}de()}},[te,Z]),reactExports.useEffect(()=>{te&&!oe&&(useGLTF.preload("/reception_desk.glb"),X==null||X())},[te,oe,X]),reactExports.useEffect(()=>{useGLTF.preload("/models/avatar1.glb")},[]),oe||!te||!se?null:jsxRuntimeExports.jsx(reactExports.Suspense,{children:jsxRuntimeExports.jsx(AvatarModel,{modelUrl:te,onLoad:X,visible:Z,avatarType:ge,onReady:_,...K})})}function ConvaiAvatar2({onLoad:X,visible:Z=!1,onReady:_,...K}){const[te,ne]=reactExports.useState(null),[oe,ie]=reactExports.useState(null),[se,ae]=reactExports.useState(!1),[ge,ce]=reactExports.useState(2);return reactExports.useEffect(()=>{Z&&ae(!0)},[Z]),reactExports.useEffect(()=>{if(!te){async function de(){var pe;try{const fe=await fetch(CONVAI_API_URL,{method:"POST",headers:{"CONVAI-API-KEY":API_KEY,"Content-Type":"application/json"},body:JSON.stringify({charID:AVATAR_ID_2})});if(!fe.ok)throw new Error("Failed to fetch character");const be=await fe.json();if((pe=be==null?void 0:be.model_details)!=null&&pe.modelLink)ne(be.model_details.modelLink),ce(2),Z&&emitAvatarTypeChange(2);else throw new Error("Invalid model URL")}catch(fe){ie(fe)}}de()}},[te,Z]),reactExports.useEffect(()=>{te&&!oe&&(useGLTF.preload("/reception_desk.glb"),X==null||X())},[te,oe,X]),reactExports.useEffect(()=>{useGLTF.preload("/models/avatar1.glb")},[]),oe||!te||!se?null:jsxRuntimeExports.jsx(reactExports.Suspense,{children:jsxRuntimeExports.jsx(AvatarModel,{modelUrl:te,onLoad:X,visible:Z,avatarType:ge,onReady:_,...K})})}function ConvaiAvatar3({onLoad:X,visible:Z=!1,onReady:_,...K}){const[te,ne]=reactExports.useState(null),[oe,ie]=reactExports.useState(null),[se,ae]=reactExports.useState(!1),[ge,ce]=reactExports.useState(3);return reactExports.useEffect(()=>{Z&&ae(!0)},[Z]),reactExports.useEffect(()=>{if(!te){async function de(){var pe;try{const fe=await fetch(CONVAI_API_URL,{method:"POST",headers:{"CONVAI-API-KEY":API_KEY,"Content-Type":"application/json"},body:JSON.stringify({charID:AVATAR_ID_3})});if(!fe.ok)throw new Error("Failed to fetch character");const be=await fe.json();if((pe=be==null?void 0:be.model_details)!=null&&pe.modelLink)ne(be.model_details.modelLink),ce(3),Z&&emitAvatarTypeChange(3);else throw new Error("Invalid model URL")}catch(fe){ie(fe)}}de()}},[te,Z]),reactExports.useEffect(()=>{te&&!oe&&(useGLTF.preload("/reception_desk.glb"),X==null||X())},[te,oe,X]),reactExports.useEffect(()=>{useGLTF.preload("/models/avatar1.glb")},[]),oe||!te||!se?null:jsxRuntimeExports.jsx(reactExports.Suspense,{children:jsxRuntimeExports.jsx(AvatarModel,{modelUrl:te,onLoad:X,visible:Z,avatarType:ge,onReady:_,...K})})}function ConvaiAvatar4({onLoad:X,visible:Z=!1,onReady:_,...K}){const[te,ne]=reactExports.useState(null),[oe,ie]=reactExports.useState(null),[se,ae]=reactExports.useState(!1),[ge,ce]=reactExports.useState(4);return reactExports.useEffect(()=>{Z&&ae(!0)},[Z]),reactExports.useEffect(()=>{if(!te){async function de(){var pe;try{const fe=await fetch(CONVAI_API_URL,{method:"POST",headers:{"CONVAI-API-KEY":API_KEY,"Content-Type":"application/json"},body:JSON.stringify({charID:AVATAR_ID_4})});if(!fe.ok)throw new Error("Failed to fetch character");const be=await fe.json();if((pe=be==null?void 0:be.model_details)!=null&&pe.modelLink)ne(be.model_details.modelLink),ce(4),Z&&emitAvatarTypeChange(4);else throw new Error("Invalid model URL")}catch(fe){ie(fe)}}de()}},[te,Z]),reactExports.useEffect(()=>{te&&!oe&&(useGLTF.preload("/reception_desk.glb"),X==null||X())},[te,oe,X]),reactExports.useEffect(()=>{useGLTF.preload("/models/avatar1.glb")},[]),oe||!te||!se?null:jsxRuntimeExports.jsx(reactExports.Suspense,{children:jsxRuntimeExports.jsx(AvatarModel,{modelUrl:te,onLoad:X,visible:Z,avatarType:ge,onReady:_,...K})})}var cjs={exports:{}},Draggable$1={};function r(X){var Z,_,K="";if(typeof X=="string"||typeof X=="number")K+=X;else if(typeof X=="object")if(Array.isArray(X))for(Z=0;Z<X.length;Z++)X[Z]&&(_=r(X[Z]))&&(K&&(K+=" "),K+=_);else for(Z in X)X[Z]&&(K&&(K+=" "),K+=Z);return K}function clsx(){for(var X,Z,_=0,K="";_<arguments.length;)(X=arguments[_++])&&(Z=r(X))&&(K&&(K+=" "),K+=Z);return K}const clsx_m=Object.freeze(Object.defineProperty({__proto__:null,clsx,default:clsx},Symbol.toStringTag,{value:"Module"})),require$$3=getAugmentedNamespace(clsx_m);var domFns={},shims={},hasRequiredShims;function requireShims(){if(hasRequiredShims)return shims;hasRequiredShims=1,Object.defineProperty(shims,"__esModule",{value:!0}),shims.dontSetMe=te,shims.findInArray=X,shims.int=K,shims.isFunction=Z,shims.isNum=_;function X(ne,oe){for(let ie=0,se=ne.length;ie<se;ie++)if(oe.apply(oe,[ne[ie],ie,ne]))return ne[ie]}function Z(ne){return typeof ne=="function"||Object.prototype.toString.call(ne)==="[object Function]"}function _(ne){return typeof ne=="number"&&!isNaN(ne)}function K(ne){return parseInt(ne,10)}function te(ne,oe,ie){if(ne[oe])return new Error("Invalid prop ".concat(oe," passed to ").concat(ie," - do not set this, set it on the child."))}return shims}var getPrefix={},hasRequiredGetPrefix;function requireGetPrefix(){if(hasRequiredGetPrefix)return getPrefix;hasRequiredGetPrefix=1,Object.defineProperty(getPrefix,"__esModule",{value:!0}),getPrefix.browserPrefixToKey=_,getPrefix.browserPrefixToStyle=K,getPrefix.default=void 0,getPrefix.getPrefix=Z;const X=["Moz","Webkit","O","ms"];function Z(){var ne;let oe=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"transform";if(typeof window>"u")return"";const ie=(ne=window.document)===null||ne===void 0||(ne=ne.documentElement)===null||ne===void 0?void 0:ne.style;if(!ie||oe in ie)return"";for(let se=0;se<X.length;se++)if(_(oe,X[se])in ie)return X[se];return""}function _(ne,oe){return oe?"".concat(oe).concat(te(ne)):ne}function K(ne,oe){return oe?"-".concat(oe.toLowerCase(),"-").concat(ne):ne}function te(ne){let oe="",ie=!0;for(let se=0;se<ne.length;se++)ie?(oe+=ne[se].toUpperCase(),ie=!1):ne[se]==="-"?ie=!0:oe+=ne[se];return oe}return getPrefix.default=Z(),getPrefix}var hasRequiredDomFns;function requireDomFns(){if(hasRequiredDomFns)return domFns;hasRequiredDomFns=1,Object.defineProperty(domFns,"__esModule",{value:!0}),domFns.addClassName=Ee,domFns.addEvent=ie,domFns.addUserSelectStyles=Be,domFns.createCSSTransform=fe,domFns.createSVGTransform=be,domFns.getTouch=ye,domFns.getTouchIdentifier=ve,domFns.getTranslation=me,domFns.innerHeight=ce,domFns.innerWidth=de,domFns.matchesSelector=ne,domFns.matchesSelectorAndParentsTo=oe,domFns.offsetXYFromParent=pe,domFns.outerHeight=ae,domFns.outerWidth=ge,domFns.removeClassName=We,domFns.removeEvent=se,domFns.removeUserSelectStyles=Re;var X=requireShims(),Z=K(requireGetPrefix());function _(Ze){if(typeof WeakMap!="function")return null;var Ve=new WeakMap,_e=new WeakMap;return(_=function(Xe){return Xe?_e:Ve})(Ze)}function K(Ze,Ve){if(Ze&&Ze.__esModule)return Ze;if(Ze===null||typeof Ze!="object"&&typeof Ze!="function")return{default:Ze};var _e=_(Ve);if(_e&&_e.has(Ze))return _e.get(Ze);var Xe={},Pe=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var He in Ze)if(He!=="default"&&Object.prototype.hasOwnProperty.call(Ze,He)){var Ke=Pe?Object.getOwnPropertyDescriptor(Ze,He):null;Ke&&(Ke.get||Ke.set)?Object.defineProperty(Xe,He,Ke):Xe[He]=Ze[He]}return Xe.default=Ze,_e&&_e.set(Ze,Xe),Xe}let te="";function ne(Ze,Ve){return te||(te=(0,X.findInArray)(["matches","webkitMatchesSelector","mozMatchesSelector","msMatchesSelector","oMatchesSelector"],function(_e){return(0,X.isFunction)(Ze[_e])})),(0,X.isFunction)(Ze[te])?Ze[te](Ve):!1}function oe(Ze,Ve,_e){let Xe=Ze;do{if(ne(Xe,Ve))return!0;if(Xe===_e)return!1;Xe=Xe.parentNode}while(Xe);return!1}function ie(Ze,Ve,_e,Xe){if(!Ze)return;const Pe={capture:!0,...Xe};Ze.addEventListener?Ze.addEventListener(Ve,_e,Pe):Ze.attachEvent?Ze.attachEvent("on"+Ve,_e):Ze["on"+Ve]=_e}function se(Ze,Ve,_e,Xe){if(!Ze)return;const Pe={capture:!0,...Xe};Ze.removeEventListener?Ze.removeEventListener(Ve,_e,Pe):Ze.detachEvent?Ze.detachEvent("on"+Ve,_e):Ze["on"+Ve]=null}function ae(Ze){let Ve=Ze.clientHeight;const _e=Ze.ownerDocument.defaultView.getComputedStyle(Ze);return Ve+=(0,X.int)(_e.borderTopWidth),Ve+=(0,X.int)(_e.borderBottomWidth),Ve}function ge(Ze){let Ve=Ze.clientWidth;const _e=Ze.ownerDocument.defaultView.getComputedStyle(Ze);return Ve+=(0,X.int)(_e.borderLeftWidth),Ve+=(0,X.int)(_e.borderRightWidth),Ve}function ce(Ze){let Ve=Ze.clientHeight;const _e=Ze.ownerDocument.defaultView.getComputedStyle(Ze);return Ve-=(0,X.int)(_e.paddingTop),Ve-=(0,X.int)(_e.paddingBottom),Ve}function de(Ze){let Ve=Ze.clientWidth;const _e=Ze.ownerDocument.defaultView.getComputedStyle(Ze);return Ve-=(0,X.int)(_e.paddingLeft),Ve-=(0,X.int)(_e.paddingRight),Ve}function pe(Ze,Ve,_e){const Pe=Ve===Ve.ownerDocument.body?{left:0,top:0}:Ve.getBoundingClientRect(),He=(Ze.clientX+Ve.scrollLeft-Pe.left)/_e,Ke=(Ze.clientY+Ve.scrollTop-Pe.top)/_e;return{x:He,y:Ke}}function fe(Ze,Ve){const _e=me(Ze,Ve,"px");return{[(0,Z.browserPrefixToKey)("transform",Z.default)]:_e}}function be(Ze,Ve){return me(Ze,Ve,"")}function me(Ze,Ve,_e){let{x:Xe,y:Pe}=Ze,He="translate(".concat(Xe).concat(_e,",").concat(Pe).concat(_e,")");if(Ve){const Ke="".concat(typeof Ve.x=="string"?Ve.x:Ve.x+_e),Ue="".concat(typeof Ve.y=="string"?Ve.y:Ve.y+_e);He="translate(".concat(Ke,", ").concat(Ue,")")+He}return He}function ye(Ze,Ve){return Ze.targetTouches&&(0,X.findInArray)(Ze.targetTouches,_e=>Ve===_e.identifier)||Ze.changedTouches&&(0,X.findInArray)(Ze.changedTouches,_e=>Ve===_e.identifier)}function ve(Ze){if(Ze.targetTouches&&Ze.targetTouches[0])return Ze.targetTouches[0].identifier;if(Ze.changedTouches&&Ze.changedTouches[0])return Ze.changedTouches[0].identifier}function Be(Ze){if(!Ze)return;let Ve=Ze.getElementById("react-draggable-style-el");Ve||(Ve=Ze.createElement("style"),Ve.type="text/css",Ve.id="react-draggable-style-el",Ve.innerHTML=`.react-draggable-transparent-selection *::-moz-selection {all: inherit;}
`,Ve.innerHTML+=`.react-draggable-transparent-selection *::selection {all: inherit;}
`,Ze.getElementsByTagName("head")[0].appendChild(Ve)),Ze.body&&Ee(Ze.body,"react-draggable-transparent-selection")}function Re(Ze){if(Ze)try{if(Ze.body&&We(Ze.body,"react-draggable-transparent-selection"),Ze.selection)Ze.selection.empty();else{const Ve=(Ze.defaultView||window).getSelection();Ve&&Ve.type!=="Caret"&&Ve.removeAllRanges()}}catch{}}function Ee(Ze,Ve){Ze.classList?Ze.classList.add(Ve):Ze.className.match(new RegExp("(?:^|\\s)".concat(Ve,"(?!\\S)")))||(Ze.className+=" ".concat(Ve))}function We(Ze,Ve){Ze.classList?Ze.classList.remove(Ve):Ze.className=Ze.className.replace(new RegExp("(?:^|\\s)".concat(Ve,"(?!\\S)"),"g"),"")}return domFns}var positionFns={},hasRequiredPositionFns;function requirePositionFns(){if(hasRequiredPositionFns)return positionFns;hasRequiredPositionFns=1,Object.defineProperty(positionFns,"__esModule",{value:!0}),positionFns.canDragX=te,positionFns.canDragY=ne,positionFns.createCoreData=ie,positionFns.createDraggableData=se,positionFns.getBoundPosition=_,positionFns.getControlPosition=oe,positionFns.snapToGrid=K;var X=requireShims(),Z=requireDomFns();function _(ce,de,pe){if(!ce.props.bounds)return[de,pe];let{bounds:fe}=ce.props;fe=typeof fe=="string"?fe:ae(fe);const be=ge(ce);if(typeof fe=="string"){const{ownerDocument:me}=be,ye=me.defaultView;let ve;if(fe==="parent"?ve=be.parentNode:ve=me.querySelector(fe),!(ve instanceof ye.HTMLElement))throw new Error('Bounds selector "'+fe+'" could not find an element.');const Be=ve,Re=ye.getComputedStyle(be),Ee=ye.getComputedStyle(Be);fe={left:-be.offsetLeft+(0,X.int)(Ee.paddingLeft)+(0,X.int)(Re.marginLeft),top:-be.offsetTop+(0,X.int)(Ee.paddingTop)+(0,X.int)(Re.marginTop),right:(0,Z.innerWidth)(Be)-(0,Z.outerWidth)(be)-be.offsetLeft+(0,X.int)(Ee.paddingRight)-(0,X.int)(Re.marginRight),bottom:(0,Z.innerHeight)(Be)-(0,Z.outerHeight)(be)-be.offsetTop+(0,X.int)(Ee.paddingBottom)-(0,X.int)(Re.marginBottom)}}return(0,X.isNum)(fe.right)&&(de=Math.min(de,fe.right)),(0,X.isNum)(fe.bottom)&&(pe=Math.min(pe,fe.bottom)),(0,X.isNum)(fe.left)&&(de=Math.max(de,fe.left)),(0,X.isNum)(fe.top)&&(pe=Math.max(pe,fe.top)),[de,pe]}function K(ce,de,pe){const fe=Math.round(de/ce[0])*ce[0],be=Math.round(pe/ce[1])*ce[1];return[fe,be]}function te(ce){return ce.props.axis==="both"||ce.props.axis==="x"}function ne(ce){return ce.props.axis==="both"||ce.props.axis==="y"}function oe(ce,de,pe){const fe=typeof de=="number"?(0,Z.getTouch)(ce,de):null;if(typeof de=="number"&&!fe)return null;const be=ge(pe),me=pe.props.offsetParent||be.offsetParent||be.ownerDocument.body;return(0,Z.offsetXYFromParent)(fe||ce,me,pe.props.scale)}function ie(ce,de,pe){const fe=!(0,X.isNum)(ce.lastX),be=ge(ce);return fe?{node:be,deltaX:0,deltaY:0,lastX:de,lastY:pe,x:de,y:pe}:{node:be,deltaX:de-ce.lastX,deltaY:pe-ce.lastY,lastX:ce.lastX,lastY:ce.lastY,x:de,y:pe}}function se(ce,de){const pe=ce.props.scale;return{node:de.node,x:ce.state.x+de.deltaX/pe,y:ce.state.y+de.deltaY/pe,deltaX:de.deltaX/pe,deltaY:de.deltaY/pe,lastX:ce.state.x,lastY:ce.state.y}}function ae(ce){return{left:ce.left,top:ce.top,right:ce.right,bottom:ce.bottom}}function ge(ce){const de=ce.findDOMNode();if(!de)throw new Error("<DraggableCore>: Unmounted during event!");return de}return positionFns}var DraggableCore={},log={},hasRequiredLog;function requireLog(){if(hasRequiredLog)return log;hasRequiredLog=1,Object.defineProperty(log,"__esModule",{value:!0}),log.default=X;function X(){}return log}var hasRequiredDraggableCore;function requireDraggableCore(){if(hasRequiredDraggableCore)return DraggableCore;hasRequiredDraggableCore=1,Object.defineProperty(DraggableCore,"__esModule",{value:!0}),DraggableCore.default=void 0;var X=ae(requireReact()),Z=ie(requirePropTypes()),_=ie(requireReactDom()),K=requireDomFns(),te=requirePositionFns(),ne=requireShims(),oe=ie(requireLog());function ie(me){return me&&me.__esModule?me:{default:me}}function se(me){if(typeof WeakMap!="function")return null;var ye=new WeakMap,ve=new WeakMap;return(se=function(Be){return Be?ve:ye})(me)}function ae(me,ye){if(me&&me.__esModule)return me;if(me===null||typeof me!="object"&&typeof me!="function")return{default:me};var ve=se(ye);if(ve&&ve.has(me))return ve.get(me);var Be={},Re=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var Ee in me)if(Ee!=="default"&&Object.prototype.hasOwnProperty.call(me,Ee)){var We=Re?Object.getOwnPropertyDescriptor(me,Ee):null;We&&(We.get||We.set)?Object.defineProperty(Be,Ee,We):Be[Ee]=me[Ee]}return Be.default=me,ve&&ve.set(me,Be),Be}function ge(me,ye,ve){return ye=ce(ye),ye in me?Object.defineProperty(me,ye,{value:ve,enumerable:!0,configurable:!0,writable:!0}):me[ye]=ve,me}function ce(me){var ye=de(me,"string");return typeof ye=="symbol"?ye:String(ye)}function de(me,ye){if(typeof me!="object"||me===null)return me;var ve=me[Symbol.toPrimitive];if(ve!==void 0){var Be=ve.call(me,ye||"default");if(typeof Be!="object")return Be;throw new TypeError("@@toPrimitive must return a primitive value.")}return(ye==="string"?String:Number)(me)}const pe={touch:{start:"touchstart",move:"touchmove",stop:"touchend"},mouse:{start:"mousedown",move:"mousemove",stop:"mouseup"}};let fe=pe.mouse,be=class extends X.Component{constructor(){super(...arguments),ge(this,"dragging",!1),ge(this,"lastX",NaN),ge(this,"lastY",NaN),ge(this,"touchIdentifier",null),ge(this,"mounted",!1),ge(this,"handleDragStart",ye=>{if(this.props.onMouseDown(ye),!this.props.allowAnyClick&&typeof ye.button=="number"&&ye.button!==0)return!1;const ve=this.findDOMNode();if(!ve||!ve.ownerDocument||!ve.ownerDocument.body)throw new Error("<DraggableCore> not mounted on DragStart!");const{ownerDocument:Be}=ve;if(this.props.disabled||!(ye.target instanceof Be.defaultView.Node)||this.props.handle&&!(0,K.matchesSelectorAndParentsTo)(ye.target,this.props.handle,ve)||this.props.cancel&&(0,K.matchesSelectorAndParentsTo)(ye.target,this.props.cancel,ve))return;ye.type==="touchstart"&&ye.preventDefault();const Re=(0,K.getTouchIdentifier)(ye);this.touchIdentifier=Re;const Ee=(0,te.getControlPosition)(ye,Re,this);if(Ee==null)return;const{x:We,y:Ze}=Ee,Ve=(0,te.createCoreData)(this,We,Ze);(0,oe.default)("DraggableCore: handleDragStart: %j",Ve),(0,oe.default)("calling",this.props.onStart),!(this.props.onStart(ye,Ve)===!1||this.mounted===!1)&&(this.props.enableUserSelectHack&&(0,K.addUserSelectStyles)(Be),this.dragging=!0,this.lastX=We,this.lastY=Ze,(0,K.addEvent)(Be,fe.move,this.handleDrag),(0,K.addEvent)(Be,fe.stop,this.handleDragStop))}),ge(this,"handleDrag",ye=>{const ve=(0,te.getControlPosition)(ye,this.touchIdentifier,this);if(ve==null)return;let{x:Be,y:Re}=ve;if(Array.isArray(this.props.grid)){let Ze=Be-this.lastX,Ve=Re-this.lastY;if([Ze,Ve]=(0,te.snapToGrid)(this.props.grid,Ze,Ve),!Ze&&!Ve)return;Be=this.lastX+Ze,Re=this.lastY+Ve}const Ee=(0,te.createCoreData)(this,Be,Re);if((0,oe.default)("DraggableCore: handleDrag: %j",Ee),this.props.onDrag(ye,Ee)===!1||this.mounted===!1){try{this.handleDragStop(new MouseEvent("mouseup"))}catch{const Ve=document.createEvent("MouseEvents");Ve.initMouseEvent("mouseup",!0,!0,window,0,0,0,0,0,!1,!1,!1,!1,0,null),this.handleDragStop(Ve)}return}this.lastX=Be,this.lastY=Re}),ge(this,"handleDragStop",ye=>{if(!this.dragging)return;const ve=(0,te.getControlPosition)(ye,this.touchIdentifier,this);if(ve==null)return;let{x:Be,y:Re}=ve;if(Array.isArray(this.props.grid)){let Ve=Be-this.lastX||0,_e=Re-this.lastY||0;[Ve,_e]=(0,te.snapToGrid)(this.props.grid,Ve,_e),Be=this.lastX+Ve,Re=this.lastY+_e}const Ee=(0,te.createCoreData)(this,Be,Re);if(this.props.onStop(ye,Ee)===!1||this.mounted===!1)return!1;const Ze=this.findDOMNode();Ze&&this.props.enableUserSelectHack&&(0,K.removeUserSelectStyles)(Ze.ownerDocument),(0,oe.default)("DraggableCore: handleDragStop: %j",Ee),this.dragging=!1,this.lastX=NaN,this.lastY=NaN,Ze&&((0,oe.default)("DraggableCore: Removing handlers"),(0,K.removeEvent)(Ze.ownerDocument,fe.move,this.handleDrag),(0,K.removeEvent)(Ze.ownerDocument,fe.stop,this.handleDragStop))}),ge(this,"onMouseDown",ye=>(fe=pe.mouse,this.handleDragStart(ye))),ge(this,"onMouseUp",ye=>(fe=pe.mouse,this.handleDragStop(ye))),ge(this,"onTouchStart",ye=>(fe=pe.touch,this.handleDragStart(ye))),ge(this,"onTouchEnd",ye=>(fe=pe.touch,this.handleDragStop(ye)))}componentDidMount(){this.mounted=!0;const ye=this.findDOMNode();ye&&(0,K.addEvent)(ye,pe.touch.start,this.onTouchStart,{passive:!1})}componentWillUnmount(){this.mounted=!1;const ye=this.findDOMNode();if(ye){const{ownerDocument:ve}=ye;(0,K.removeEvent)(ve,pe.mouse.move,this.handleDrag),(0,K.removeEvent)(ve,pe.touch.move,this.handleDrag),(0,K.removeEvent)(ve,pe.mouse.stop,this.handleDragStop),(0,K.removeEvent)(ve,pe.touch.stop,this.handleDragStop),(0,K.removeEvent)(ye,pe.touch.start,this.onTouchStart,{passive:!1}),this.props.enableUserSelectHack&&(0,K.removeUserSelectStyles)(ve)}}findDOMNode(){var ye,ve;return(ye=this.props)!==null&&ye!==void 0&&ye.nodeRef?(ve=this.props)===null||ve===void 0||(ve=ve.nodeRef)===null||ve===void 0?void 0:ve.current:_.default.findDOMNode(this)}render(){return X.cloneElement(X.Children.only(this.props.children),{onMouseDown:this.onMouseDown,onMouseUp:this.onMouseUp,onTouchEnd:this.onTouchEnd})}};return DraggableCore.default=be,ge(be,"displayName","DraggableCore"),ge(be,"propTypes",{allowAnyClick:Z.default.bool,children:Z.default.node.isRequired,disabled:Z.default.bool,enableUserSelectHack:Z.default.bool,offsetParent:function(me,ye){if(me[ye]&&me[ye].nodeType!==1)throw new Error("Draggable's offsetParent must be a DOM Node.")},grid:Z.default.arrayOf(Z.default.number),handle:Z.default.string,cancel:Z.default.string,nodeRef:Z.default.object,onStart:Z.default.func,onDrag:Z.default.func,onStop:Z.default.func,onMouseDown:Z.default.func,scale:Z.default.number,className:ne.dontSetMe,style:ne.dontSetMe,transform:ne.dontSetMe}),ge(be,"defaultProps",{allowAnyClick:!1,disabled:!1,enableUserSelectHack:!0,onStart:function(){},onDrag:function(){},onStop:function(){},onMouseDown:function(){},scale:1}),DraggableCore}var hasRequiredDraggable;function requireDraggable(){return hasRequiredDraggable||(hasRequiredDraggable=1,function(X){Object.defineProperty(X,"__esModule",{value:!0}),Object.defineProperty(X,"DraggableCore",{enumerable:!0,get:function(){return se.default}}),X.default=void 0;var Z=de(requireReact()),_=ge(requirePropTypes()),K=ge(requireReactDom()),te=ge(require$$3),ne=requireDomFns(),oe=requirePositionFns(),ie=requireShims(),se=ge(requireDraggableCore()),ae=ge(requireLog());function ge(ve){return ve&&ve.__esModule?ve:{default:ve}}function ce(ve){if(typeof WeakMap!="function")return null;var Be=new WeakMap,Re=new WeakMap;return(ce=function(Ee){return Ee?Re:Be})(ve)}function de(ve,Be){if(ve&&ve.__esModule)return ve;if(ve===null||typeof ve!="object"&&typeof ve!="function")return{default:ve};var Re=ce(Be);if(Re&&Re.has(ve))return Re.get(ve);var Ee={},We=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var Ze in ve)if(Ze!=="default"&&Object.prototype.hasOwnProperty.call(ve,Ze)){var Ve=We?Object.getOwnPropertyDescriptor(ve,Ze):null;Ve&&(Ve.get||Ve.set)?Object.defineProperty(Ee,Ze,Ve):Ee[Ze]=ve[Ze]}return Ee.default=ve,Re&&Re.set(ve,Ee),Ee}function pe(){return pe=Object.assign?Object.assign.bind():function(ve){for(var Be=1;Be<arguments.length;Be++){var Re=arguments[Be];for(var Ee in Re)Object.prototype.hasOwnProperty.call(Re,Ee)&&(ve[Ee]=Re[Ee])}return ve},pe.apply(this,arguments)}function fe(ve,Be,Re){return Be=be(Be),Be in ve?Object.defineProperty(ve,Be,{value:Re,enumerable:!0,configurable:!0,writable:!0}):ve[Be]=Re,ve}function be(ve){var Be=me(ve,"string");return typeof Be=="symbol"?Be:String(Be)}function me(ve,Be){if(typeof ve!="object"||ve===null)return ve;var Re=ve[Symbol.toPrimitive];if(Re!==void 0){var Ee=Re.call(ve,Be||"default");if(typeof Ee!="object")return Ee;throw new TypeError("@@toPrimitive must return a primitive value.")}return(Be==="string"?String:Number)(ve)}class ye extends Z.Component{static getDerivedStateFromProps(Be,Re){let{position:Ee}=Be,{prevPropsPosition:We}=Re;return Ee&&(!We||Ee.x!==We.x||Ee.y!==We.y)?((0,ae.default)("Draggable: getDerivedStateFromProps %j",{position:Ee,prevPropsPosition:We}),{x:Ee.x,y:Ee.y,prevPropsPosition:{...Ee}}):null}constructor(Be){super(Be),fe(this,"onDragStart",(Re,Ee)=>{if((0,ae.default)("Draggable: onDragStart: %j",Ee),this.props.onStart(Re,(0,oe.createDraggableData)(this,Ee))===!1)return!1;this.setState({dragging:!0,dragged:!0})}),fe(this,"onDrag",(Re,Ee)=>{if(!this.state.dragging)return!1;(0,ae.default)("Draggable: onDrag: %j",Ee);const We=(0,oe.createDraggableData)(this,Ee),Ze={x:We.x,y:We.y,slackX:0,slackY:0};if(this.props.bounds){const{x:_e,y:Xe}=Ze;Ze.x+=this.state.slackX,Ze.y+=this.state.slackY;const[Pe,He]=(0,oe.getBoundPosition)(this,Ze.x,Ze.y);Ze.x=Pe,Ze.y=He,Ze.slackX=this.state.slackX+(_e-Ze.x),Ze.slackY=this.state.slackY+(Xe-Ze.y),We.x=Ze.x,We.y=Ze.y,We.deltaX=Ze.x-this.state.x,We.deltaY=Ze.y-this.state.y}if(this.props.onDrag(Re,We)===!1)return!1;this.setState(Ze)}),fe(this,"onDragStop",(Re,Ee)=>{if(!this.state.dragging||this.props.onStop(Re,(0,oe.createDraggableData)(this,Ee))===!1)return!1;(0,ae.default)("Draggable: onDragStop: %j",Ee);const Ze={dragging:!1,slackX:0,slackY:0};if(!!this.props.position){const{x:_e,y:Xe}=this.props.position;Ze.x=_e,Ze.y=Xe}this.setState(Ze)}),this.state={dragging:!1,dragged:!1,x:Be.position?Be.position.x:Be.defaultPosition.x,y:Be.position?Be.position.y:Be.defaultPosition.y,prevPropsPosition:{...Be.position},slackX:0,slackY:0,isElementSVG:!1},Be.position&&!(Be.onDrag||Be.onStop)&&console.warn("A `position` was applied to this <Draggable>, without drag handlers. This will make this component effectively undraggable. Please attach `onDrag` or `onStop` handlers so you can adjust the `position` of this element.")}componentDidMount(){typeof window.SVGElement<"u"&&this.findDOMNode()instanceof window.SVGElement&&this.setState({isElementSVG:!0})}componentWillUnmount(){this.setState({dragging:!1})}findDOMNode(){var Be,Re;return(Be=(Re=this.props)===null||Re===void 0||(Re=Re.nodeRef)===null||Re===void 0?void 0:Re.current)!==null&&Be!==void 0?Be:K.default.findDOMNode(this)}render(){const{axis:Be,bounds:Re,children:Ee,defaultPosition:We,defaultClassName:Ze,defaultClassNameDragging:Ve,defaultClassNameDragged:_e,position:Xe,positionOffset:Pe,scale:He,...Ke}=this.props;let Ue={},tt=null;const at=!!!Xe||this.state.dragging,Oe=Xe||We,$e={x:(0,oe.canDragX)(this)&&at?this.state.x:Oe.x,y:(0,oe.canDragY)(this)&&at?this.state.y:Oe.y};this.state.isElementSVG?tt=(0,ne.createSVGTransform)($e,Pe):Ue=(0,ne.createCSSTransform)($e,Pe);const je=(0,te.default)(Ee.props.className||"",Ze,{[Ve]:this.state.dragging,[_e]:this.state.dragged});return Z.createElement(se.default,pe({},Ke,{onStart:this.onDragStart,onDrag:this.onDrag,onStop:this.onDragStop}),Z.cloneElement(Z.Children.only(Ee),{className:je,style:{...Ee.props.style,...Ue},transform:tt}))}}X.default=ye,fe(ye,"displayName","Draggable"),fe(ye,"propTypes",{...se.default.propTypes,axis:_.default.oneOf(["both","x","y","none"]),bounds:_.default.oneOfType([_.default.shape({left:_.default.number,right:_.default.number,top:_.default.number,bottom:_.default.number}),_.default.string,_.default.oneOf([!1])]),defaultClassName:_.default.string,defaultClassNameDragging:_.default.string,defaultClassNameDragged:_.default.string,defaultPosition:_.default.shape({x:_.default.number,y:_.default.number}),positionOffset:_.default.shape({x:_.default.oneOfType([_.default.number,_.default.string]),y:_.default.oneOfType([_.default.number,_.default.string])}),position:_.default.shape({x:_.default.number,y:_.default.number}),className:ie.dontSetMe,style:ie.dontSetMe,transform:ie.dontSetMe}),fe(ye,"defaultProps",{...se.default.defaultProps,axis:"both",bounds:!1,defaultClassName:"react-draggable",defaultClassNameDragging:"react-draggable-dragging",defaultClassNameDragged:"react-draggable-dragged",defaultPosition:{x:0,y:0},scale:1})}(Draggable$1)),Draggable$1}var hasRequiredCjs;function requireCjs(){if(hasRequiredCjs)return cjs.exports;hasRequiredCjs=1;const{default:X,DraggableCore:Z}=requireDraggable();return cjs.exports=X,cjs.exports.default=X,cjs.exports.DraggableCore=Z,cjs.exports}var cjsExports=requireCjs();const Draggable=getDefaultExportFromCjs(cjsExports);var DefaultContext={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},IconContext=React.createContext&&React.createContext(DefaultContext),_excluded=["attr","size","title"];function _objectWithoutProperties(X,Z){if(X==null)return{};var _=_objectWithoutPropertiesLoose(X,Z),K,te;if(Object.getOwnPropertySymbols){var ne=Object.getOwnPropertySymbols(X);for(te=0;te<ne.length;te++)K=ne[te],!(Z.indexOf(K)>=0)&&Object.prototype.propertyIsEnumerable.call(X,K)&&(_[K]=X[K])}return _}function _objectWithoutPropertiesLoose(X,Z){if(X==null)return{};var _={};for(var K in X)if(Object.prototype.hasOwnProperty.call(X,K)){if(Z.indexOf(K)>=0)continue;_[K]=X[K]}return _}function _extends(){return _extends=Object.assign?Object.assign.bind():function(X){for(var Z=1;Z<arguments.length;Z++){var _=arguments[Z];for(var K in _)Object.prototype.hasOwnProperty.call(_,K)&&(X[K]=_[K])}return X},_extends.apply(this,arguments)}function ownKeys(X,Z){var _=Object.keys(X);if(Object.getOwnPropertySymbols){var K=Object.getOwnPropertySymbols(X);Z&&(K=K.filter(function(te){return Object.getOwnPropertyDescriptor(X,te).enumerable})),_.push.apply(_,K)}return _}function _objectSpread(X){for(var Z=1;Z<arguments.length;Z++){var _=arguments[Z]!=null?arguments[Z]:{};Z%2?ownKeys(Object(_),!0).forEach(function(K){_defineProperty(X,K,_[K])}):Object.getOwnPropertyDescriptors?Object.defineProperties(X,Object.getOwnPropertyDescriptors(_)):ownKeys(Object(_)).forEach(function(K){Object.defineProperty(X,K,Object.getOwnPropertyDescriptor(_,K))})}return X}function _defineProperty(X,Z,_){return Z=_toPropertyKey(Z),Z in X?Object.defineProperty(X,Z,{value:_,enumerable:!0,configurable:!0,writable:!0}):X[Z]=_,X}function _toPropertyKey(X){var Z=_toPrimitive(X,"string");return typeof Z=="symbol"?Z:Z+""}function _toPrimitive(X,Z){if(typeof X!="object"||!X)return X;var _=X[Symbol.toPrimitive];if(_!==void 0){var K=_.call(X,Z||"default");if(typeof K!="object")return K;throw new TypeError("@@toPrimitive must return a primitive value.")}return(Z==="string"?String:Number)(X)}function Tree2Element(X){return X&&X.map((Z,_)=>React.createElement(Z.tag,_objectSpread({key:_},Z.attr),Tree2Element(Z.child)))}function GenIcon(X){return Z=>React.createElement(IconBase,_extends({attr:_objectSpread({},X.attr)},Z),Tree2Element(X.child))}function IconBase(X){var Z=_=>{var{attr:K,size:te,title:ne}=X,oe=_objectWithoutProperties(X,_excluded),ie=te||_.size||"1em",se;return _.className&&(se=_.className),X.className&&(se=(se?se+" ":"")+X.className),React.createElement("svg",_extends({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},_.attr,K,oe,{className:se,style:_objectSpread(_objectSpread({color:X.color||_.color},_.style),X.style),height:ie,width:ie,xmlns:"http://www.w3.org/2000/svg"}),ne&&React.createElement("title",null,ne),X.children)};return IconContext!==void 0?React.createElement(IconContext.Consumer,null,_=>Z(_)):Z(DefaultContext)}function MdMicOff(X){return GenIcon({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0zm0 0h24v24H0z"},child:[]},{tag:"path",attr:{d:"M19 11h-1.7c0 .74-.16 1.43-.43 2.05l1.23 1.23c.56-.98.9-2.09.9-3.28zm-4.02.17c0-.06.02-.11.02-.17V5c0-1.66-1.34-3-3-3S9 3.34 9 5v.18l5.98 5.99zM4.27 3 3 4.27l6.01 6.01V11c0 1.66 1.33 3 2.99 3 .22 0 .44-.03.65-.08l1.66 1.66c-.71.33-1.5.52-2.31.52-2.76 0-5.3-2.1-5.3-5.1H5c0 3.41 2.72 6.23 6 6.72V21h2v-3.28c.91-.13 1.77-.45 2.54-.9L19.73 21 21 19.73 4.27 3z"},child:[]}]})(X)}function MdMic(X){return GenIcon({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"},child:[]},{tag:"path",attr:{d:"M12 14c1.66 0 2.99-1.34 2.99-3L15 5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3zm5.3-3c0 3-2.54 5.1-5.3 5.1S6.7 14 6.7 11H5c0 3.41 2.72 6.23 6 6.72V21h2v-3.28c3.28-.48 6-3.3 6-6.72h-1.7z"},child:[]}]})(X)}function MdSpeed(X){return GenIcon({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"},child:[]},{tag:"path",attr:{d:"m20.38 8.57-1.23 1.85a8 8 0 0 1-.22 7.58H5.07A8 8 0 0 1 15.58 6.85l1.85-1.23A10 10 0 0 0 3.35 19a2 2 0 0 0 1.72 1h13.85a2 2 0 0 0 1.74-1 10 10 0 0 0-.27-10.44zm-9.79 6.84a2 2 0 0 0 2.83 0l5.66-8.49-8.49 5.66a2 2 0 0 0 0 2.83z"},child:[]}]})(X)}function MdSend(X){return GenIcon({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"},child:[]},{tag:"path",attr:{d:"M2.01 21 23 12 2.01 3 2 10l15 2-15 2z"},child:[]}]})(X)}function MdExpandLess(X){return GenIcon({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"},child:[]},{tag:"path",attr:{d:"m12 8-6 6 1.41 1.41L12 10.83l4.59 4.58L18 14z"},child:[]}]})(X)}function MdExpandMore(X){return GenIcon({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"},child:[]},{tag:"path",attr:{d:"M16.59 8.59 12 13.17 7.41 8.59 6 10l6 6 6-6z"},child:[]}]})(X)}function MdRefresh(X){return GenIcon({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"},child:[]},{tag:"path",attr:{d:"M17.65 6.35A7.958 7.958 0 0 0 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08A5.99 5.99 0 0 1 12 18c-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4l-2.35 2.35z"},child:[]}]})(X)}var convaiWebClient_umd$1={exports:{}},convaiWebClient_umd=convaiWebClient_umd$1.exports,hasRequiredConvaiWebClient_umd;function requireConvaiWebClient_umd(){return hasRequiredConvaiWebClient_umd||(hasRequiredConvaiWebClient_umd=1,function(module,exports){(function(X,Z){module.exports=Z()})(convaiWebClient_umd,()=>(()=>{var __webpack_modules__={720:(X,Z,_)=>{var K=_(339),te=K,ne=Function("return this")();te.exportSymbol("proto.service.ARKitBlendShapes",null,ne),te.exportSymbol("proto.service.ARKitBlendShapesData",null,ne),proto.service.ARKitBlendShapesData=function(oe){K.Message.initialize(this,oe,0,-1,null,null)},te.inherits(proto.service.ARKitBlendShapesData,K.Message),te.DEBUG&&!COMPILED&&(proto.service.ARKitBlendShapesData.displayName="proto.service.ARKitBlendShapesData"),K.Message.GENERATE_TO_OBJECT&&(proto.service.ARKitBlendShapesData.prototype.toObject=function(oe){return proto.service.ARKitBlendShapesData.toObject(oe,this)},proto.service.ARKitBlendShapesData.toObject=function(oe,ie){var se,ae={arKitBlendShapes:(se=ie.getArKitBlendShapes())&&proto.service.ARKitBlendShapes.toObject(oe,se)};return oe&&(ae.$jspbMessageInstance=ie),ae}),proto.service.ARKitBlendShapesData.deserializeBinary=function(oe){var ie=new K.BinaryReader(oe),se=new proto.service.ARKitBlendShapesData;return proto.service.ARKitBlendShapesData.deserializeBinaryFromReader(se,ie)},proto.service.ARKitBlendShapesData.deserializeBinaryFromReader=function(oe,ie){for(;ie.nextField()&&!ie.isEndGroup();)if(ie.getFieldNumber()===1){var se=new proto.service.ARKitBlendShapes;ie.readMessage(se,proto.service.ARKitBlendShapes.deserializeBinaryFromReader),oe.setArKitBlendShapes(se)}else ie.skipField();return oe},proto.service.ARKitBlendShapesData.prototype.serializeBinary=function(){var oe=new K.BinaryWriter;return proto.service.ARKitBlendShapesData.serializeBinaryToWriter(this,oe),oe.getResultBuffer()},proto.service.ARKitBlendShapesData.serializeBinaryToWriter=function(oe,ie){var se;(se=oe.getArKitBlendShapes())!=null&&ie.writeMessage(1,se,proto.service.ARKitBlendShapes.serializeBinaryToWriter)},proto.service.ARKitBlendShapesData.prototype.getArKitBlendShapes=function(){return K.Message.getWrapperField(this,proto.service.ARKitBlendShapes,1)},proto.service.ARKitBlendShapesData.prototype.setArKitBlendShapes=function(oe){K.Message.setWrapperField(this,1,oe)},proto.service.ARKitBlendShapesData.prototype.clearArKitBlendShapes=function(){this.setArKitBlendShapes(void 0)},proto.service.ARKitBlendShapesData.prototype.hasArKitBlendShapes=function(){return K.Message.getField(this,1)!=null},proto.service.ARKitBlendShapes=function(oe){K.Message.initialize(this,oe,0,-1,null,null)},te.inherits(proto.service.ARKitBlendShapes,K.Message),te.DEBUG&&!COMPILED&&(proto.service.ARKitBlendShapes.displayName="proto.service.ARKitBlendShapes"),K.Message.GENERATE_TO_OBJECT&&(proto.service.ARKitBlendShapes.prototype.toObject=function(oe){return proto.service.ARKitBlendShapes.toObject(oe,this)},proto.service.ARKitBlendShapes.toObject=function(oe,ie){var se={browDownLeft:+K.Message.getFieldWithDefault(ie,1,0),browDownRight:+K.Message.getFieldWithDefault(ie,2,0),browInnerUp:+K.Message.getFieldWithDefault(ie,3,0),browOuterUpLeft:+K.Message.getFieldWithDefault(ie,4,0),browOuterUpRight:+K.Message.getFieldWithDefault(ie,5,0),cheekPuff:+K.Message.getFieldWithDefault(ie,6,0),cheekSquintLeft:+K.Message.getFieldWithDefault(ie,7,0),cheekSquintRight:+K.Message.getFieldWithDefault(ie,8,0),eyeBlinkLeft:+K.Message.getFieldWithDefault(ie,9,0),eyeBlinkRight:+K.Message.getFieldWithDefault(ie,10,0),eyeLookDownLeft:+K.Message.getFieldWithDefault(ie,11,0),eyeLookDownRight:+K.Message.getFieldWithDefault(ie,12,0),eyeLookInLeft:+K.Message.getFieldWithDefault(ie,13,0),eyeLookInRight:+K.Message.getFieldWithDefault(ie,14,0),eyeLookOutLeft:+K.Message.getFieldWithDefault(ie,15,0),eyeLookOutRight:+K.Message.getFieldWithDefault(ie,16,0),eyeLookUpLeft:+K.Message.getFieldWithDefault(ie,17,0),eyeLookUpRight:+K.Message.getFieldWithDefault(ie,18,0),eyeSquintLeft:+K.Message.getFieldWithDefault(ie,19,0),eyeSquintRight:+K.Message.getFieldWithDefault(ie,20,0),eyeWideLeft:+K.Message.getFieldWithDefault(ie,21,0),eyeWideRight:+K.Message.getFieldWithDefault(ie,22,0),jawForward:+K.Message.getFieldWithDefault(ie,23,0),jawLeft:+K.Message.getFieldWithDefault(ie,24,0),jawOpen:+K.Message.getFieldWithDefault(ie,25,0),jawRight:+K.Message.getFieldWithDefault(ie,26,0),mouthClose:+K.Message.getFieldWithDefault(ie,27,0),mouthDimpleLeft:+K.Message.getFieldWithDefault(ie,28,0),mouthDimpleRight:+K.Message.getFieldWithDefault(ie,29,0),mouthFrownLeft:+K.Message.getFieldWithDefault(ie,30,0),mouthFrownRight:+K.Message.getFieldWithDefault(ie,31,0),mouthFunnel:+K.Message.getFieldWithDefault(ie,32,0),mouthLeft:+K.Message.getFieldWithDefault(ie,33,0),mouthLowerDownLeft:+K.Message.getFieldWithDefault(ie,34,0),mouthLowerDownRight:+K.Message.getFieldWithDefault(ie,35,0),mouthPressLeft:+K.Message.getFieldWithDefault(ie,36,0),mouthPressRight:+K.Message.getFieldWithDefault(ie,37,0),mouthPucker:+K.Message.getFieldWithDefault(ie,38,0),mouthRight:+K.Message.getFieldWithDefault(ie,39,0),mouthRollLower:+K.Message.getFieldWithDefault(ie,40,0),mouthRollUpper:+K.Message.getFieldWithDefault(ie,41,0),mouthShrugLower:+K.Message.getFieldWithDefault(ie,42,0),mouthShrugUpper:+K.Message.getFieldWithDefault(ie,43,0),mouthSmileLeft:+K.Message.getFieldWithDefault(ie,44,0),mouthSmileRight:+K.Message.getFieldWithDefault(ie,45,0),mouthStretchLeft:+K.Message.getFieldWithDefault(ie,46,0),mouthStretchRight:+K.Message.getFieldWithDefault(ie,47,0),mouthUpperUpLeft:+K.Message.getFieldWithDefault(ie,48,0),mouthUpperUpRight:+K.Message.getFieldWithDefault(ie,49,0),noseSneerLeft:+K.Message.getFieldWithDefault(ie,50,0),noseSneerRight:+K.Message.getFieldWithDefault(ie,51,0),tongueOut:+K.Message.getFieldWithDefault(ie,52,0)};return oe&&(se.$jspbMessageInstance=ie),se}),proto.service.ARKitBlendShapes.deserializeBinary=function(oe){var ie=new K.BinaryReader(oe),se=new proto.service.ARKitBlendShapes;return proto.service.ARKitBlendShapes.deserializeBinaryFromReader(se,ie)},proto.service.ARKitBlendShapes.deserializeBinaryFromReader=function(oe,ie){for(;ie.nextField()&&!ie.isEndGroup();)switch(ie.getFieldNumber()){case 1:var se=ie.readFloat();oe.setBrowDownLeft(se);break;case 2:se=ie.readFloat(),oe.setBrowDownRight(se);break;case 3:se=ie.readFloat(),oe.setBrowInnerUp(se);break;case 4:se=ie.readFloat(),oe.setBrowOuterUpLeft(se);break;case 5:se=ie.readFloat(),oe.setBrowOuterUpRight(se);break;case 6:se=ie.readFloat(),oe.setCheekPuff(se);break;case 7:se=ie.readFloat(),oe.setCheekSquintLeft(se);break;case 8:se=ie.readFloat(),oe.setCheekSquintRight(se);break;case 9:se=ie.readFloat(),oe.setEyeBlinkLeft(se);break;case 10:se=ie.readFloat(),oe.setEyeBlinkRight(se);break;case 11:se=ie.readFloat(),oe.setEyeLookDownLeft(se);break;case 12:se=ie.readFloat(),oe.setEyeLookDownRight(se);break;case 13:se=ie.readFloat(),oe.setEyeLookInLeft(se);break;case 14:se=ie.readFloat(),oe.setEyeLookInRight(se);break;case 15:se=ie.readFloat(),oe.setEyeLookOutLeft(se);break;case 16:se=ie.readFloat(),oe.setEyeLookOutRight(se);break;case 17:se=ie.readFloat(),oe.setEyeLookUpLeft(se);break;case 18:se=ie.readFloat(),oe.setEyeLookUpRight(se);break;case 19:se=ie.readFloat(),oe.setEyeSquintLeft(se);break;case 20:se=ie.readFloat(),oe.setEyeSquintRight(se);break;case 21:se=ie.readFloat(),oe.setEyeWideLeft(se);break;case 22:se=ie.readFloat(),oe.setEyeWideRight(se);break;case 23:se=ie.readFloat(),oe.setJawForward(se);break;case 24:se=ie.readFloat(),oe.setJawLeft(se);break;case 25:se=ie.readFloat(),oe.setJawOpen(se);break;case 26:se=ie.readFloat(),oe.setJawRight(se);break;case 27:se=ie.readFloat(),oe.setMouthClose(se);break;case 28:se=ie.readFloat(),oe.setMouthDimpleLeft(se);break;case 29:se=ie.readFloat(),oe.setMouthDimpleRight(se);break;case 30:se=ie.readFloat(),oe.setMouthFrownLeft(se);break;case 31:se=ie.readFloat(),oe.setMouthFrownRight(se);break;case 32:se=ie.readFloat(),oe.setMouthFunnel(se);break;case 33:se=ie.readFloat(),oe.setMouthLeft(se);break;case 34:se=ie.readFloat(),oe.setMouthLowerDownLeft(se);break;case 35:se=ie.readFloat(),oe.setMouthLowerDownRight(se);break;case 36:se=ie.readFloat(),oe.setMouthPressLeft(se);break;case 37:se=ie.readFloat(),oe.setMouthPressRight(se);break;case 38:se=ie.readFloat(),oe.setMouthPucker(se);break;case 39:se=ie.readFloat(),oe.setMouthRight(se);break;case 40:se=ie.readFloat(),oe.setMouthRollLower(se);break;case 41:se=ie.readFloat(),oe.setMouthRollUpper(se);break;case 42:se=ie.readFloat(),oe.setMouthShrugLower(se);break;case 43:se=ie.readFloat(),oe.setMouthShrugUpper(se);break;case 44:se=ie.readFloat(),oe.setMouthSmileLeft(se);break;case 45:se=ie.readFloat(),oe.setMouthSmileRight(se);break;case 46:se=ie.readFloat(),oe.setMouthStretchLeft(se);break;case 47:se=ie.readFloat(),oe.setMouthStretchRight(se);break;case 48:se=ie.readFloat(),oe.setMouthUpperUpLeft(se);break;case 49:se=ie.readFloat(),oe.setMouthUpperUpRight(se);break;case 50:se=ie.readFloat(),oe.setNoseSneerLeft(se);break;case 51:se=ie.readFloat(),oe.setNoseSneerRight(se);break;case 52:se=ie.readFloat(),oe.setTongueOut(se);break;default:ie.skipField()}return oe},proto.service.ARKitBlendShapes.prototype.serializeBinary=function(){var oe=new K.BinaryWriter;return proto.service.ARKitBlendShapes.serializeBinaryToWriter(this,oe),oe.getResultBuffer()},proto.service.ARKitBlendShapes.serializeBinaryToWriter=function(oe,ie){var se=void 0;(se=oe.getBrowDownLeft())!==0&&ie.writeFloat(1,se),(se=oe.getBrowDownRight())!==0&&ie.writeFloat(2,se),(se=oe.getBrowInnerUp())!==0&&ie.writeFloat(3,se),(se=oe.getBrowOuterUpLeft())!==0&&ie.writeFloat(4,se),(se=oe.getBrowOuterUpRight())!==0&&ie.writeFloat(5,se),(se=oe.getCheekPuff())!==0&&ie.writeFloat(6,se),(se=oe.getCheekSquintLeft())!==0&&ie.writeFloat(7,se),(se=oe.getCheekSquintRight())!==0&&ie.writeFloat(8,se),(se=oe.getEyeBlinkLeft())!==0&&ie.writeFloat(9,se),(se=oe.getEyeBlinkRight())!==0&&ie.writeFloat(10,se),(se=oe.getEyeLookDownLeft())!==0&&ie.writeFloat(11,se),(se=oe.getEyeLookDownRight())!==0&&ie.writeFloat(12,se),(se=oe.getEyeLookInLeft())!==0&&ie.writeFloat(13,se),(se=oe.getEyeLookInRight())!==0&&ie.writeFloat(14,se),(se=oe.getEyeLookOutLeft())!==0&&ie.writeFloat(15,se),(se=oe.getEyeLookOutRight())!==0&&ie.writeFloat(16,se),(se=oe.getEyeLookUpLeft())!==0&&ie.writeFloat(17,se),(se=oe.getEyeLookUpRight())!==0&&ie.writeFloat(18,se),(se=oe.getEyeSquintLeft())!==0&&ie.writeFloat(19,se),(se=oe.getEyeSquintRight())!==0&&ie.writeFloat(20,se),(se=oe.getEyeWideLeft())!==0&&ie.writeFloat(21,se),(se=oe.getEyeWideRight())!==0&&ie.writeFloat(22,se),(se=oe.getJawForward())!==0&&ie.writeFloat(23,se),(se=oe.getJawLeft())!==0&&ie.writeFloat(24,se),(se=oe.getJawOpen())!==0&&ie.writeFloat(25,se),(se=oe.getJawRight())!==0&&ie.writeFloat(26,se),(se=oe.getMouthClose())!==0&&ie.writeFloat(27,se),(se=oe.getMouthDimpleLeft())!==0&&ie.writeFloat(28,se),(se=oe.getMouthDimpleRight())!==0&&ie.writeFloat(29,se),(se=oe.getMouthFrownLeft())!==0&&ie.writeFloat(30,se),(se=oe.getMouthFrownRight())!==0&&ie.writeFloat(31,se),(se=oe.getMouthFunnel())!==0&&ie.writeFloat(32,se),(se=oe.getMouthLeft())!==0&&ie.writeFloat(33,se),(se=oe.getMouthLowerDownLeft())!==0&&ie.writeFloat(34,se),(se=oe.getMouthLowerDownRight())!==0&&ie.writeFloat(35,se),(se=oe.getMouthPressLeft())!==0&&ie.writeFloat(36,se),(se=oe.getMouthPressRight())!==0&&ie.writeFloat(37,se),(se=oe.getMouthPucker())!==0&&ie.writeFloat(38,se),(se=oe.getMouthRight())!==0&&ie.writeFloat(39,se),(se=oe.getMouthRollLower())!==0&&ie.writeFloat(40,se),(se=oe.getMouthRollUpper())!==0&&ie.writeFloat(41,se),(se=oe.getMouthShrugLower())!==0&&ie.writeFloat(42,se),(se=oe.getMouthShrugUpper())!==0&&ie.writeFloat(43,se),(se=oe.getMouthSmileLeft())!==0&&ie.writeFloat(44,se),(se=oe.getMouthSmileRight())!==0&&ie.writeFloat(45,se),(se=oe.getMouthStretchLeft())!==0&&ie.writeFloat(46,se),(se=oe.getMouthStretchRight())!==0&&ie.writeFloat(47,se),(se=oe.getMouthUpperUpLeft())!==0&&ie.writeFloat(48,se),(se=oe.getMouthUpperUpRight())!==0&&ie.writeFloat(49,se),(se=oe.getNoseSneerLeft())!==0&&ie.writeFloat(50,se),(se=oe.getNoseSneerRight())!==0&&ie.writeFloat(51,se),(se=oe.getTongueOut())!==0&&ie.writeFloat(52,se)},proto.service.ARKitBlendShapes.prototype.getBrowDownLeft=function(){return+K.Message.getFieldWithDefault(this,1,0)},proto.service.ARKitBlendShapes.prototype.setBrowDownLeft=function(oe){K.Message.setProto3FloatField(this,1,oe)},proto.service.ARKitBlendShapes.prototype.getBrowDownRight=function(){return+K.Message.getFieldWithDefault(this,2,0)},proto.service.ARKitBlendShapes.prototype.setBrowDownRight=function(oe){K.Message.setProto3FloatField(this,2,oe)},proto.service.ARKitBlendShapes.prototype.getBrowInnerUp=function(){return+K.Message.getFieldWithDefault(this,3,0)},proto.service.ARKitBlendShapes.prototype.setBrowInnerUp=function(oe){K.Message.setProto3FloatField(this,3,oe)},proto.service.ARKitBlendShapes.prototype.getBrowOuterUpLeft=function(){return+K.Message.getFieldWithDefault(this,4,0)},proto.service.ARKitBlendShapes.prototype.setBrowOuterUpLeft=function(oe){K.Message.setProto3FloatField(this,4,oe)},proto.service.ARKitBlendShapes.prototype.getBrowOuterUpRight=function(){return+K.Message.getFieldWithDefault(this,5,0)},proto.service.ARKitBlendShapes.prototype.setBrowOuterUpRight=function(oe){K.Message.setProto3FloatField(this,5,oe)},proto.service.ARKitBlendShapes.prototype.getCheekPuff=function(){return+K.Message.getFieldWithDefault(this,6,0)},proto.service.ARKitBlendShapes.prototype.setCheekPuff=function(oe){K.Message.setProto3FloatField(this,6,oe)},proto.service.ARKitBlendShapes.prototype.getCheekSquintLeft=function(){return+K.Message.getFieldWithDefault(this,7,0)},proto.service.ARKitBlendShapes.prototype.setCheekSquintLeft=function(oe){K.Message.setProto3FloatField(this,7,oe)},proto.service.ARKitBlendShapes.prototype.getCheekSquintRight=function(){return+K.Message.getFieldWithDefault(this,8,0)},proto.service.ARKitBlendShapes.prototype.setCheekSquintRight=function(oe){K.Message.setProto3FloatField(this,8,oe)},proto.service.ARKitBlendShapes.prototype.getEyeBlinkLeft=function(){return+K.Message.getFieldWithDefault(this,9,0)},proto.service.ARKitBlendShapes.prototype.setEyeBlinkLeft=function(oe){K.Message.setProto3FloatField(this,9,oe)},proto.service.ARKitBlendShapes.prototype.getEyeBlinkRight=function(){return+K.Message.getFieldWithDefault(this,10,0)},proto.service.ARKitBlendShapes.prototype.setEyeBlinkRight=function(oe){K.Message.setProto3FloatField(this,10,oe)},proto.service.ARKitBlendShapes.prototype.getEyeLookDownLeft=function(){return+K.Message.getFieldWithDefault(this,11,0)},proto.service.ARKitBlendShapes.prototype.setEyeLookDownLeft=function(oe){K.Message.setProto3FloatField(this,11,oe)},proto.service.ARKitBlendShapes.prototype.getEyeLookDownRight=function(){return+K.Message.getFieldWithDefault(this,12,0)},proto.service.ARKitBlendShapes.prototype.setEyeLookDownRight=function(oe){K.Message.setProto3FloatField(this,12,oe)},proto.service.ARKitBlendShapes.prototype.getEyeLookInLeft=function(){return+K.Message.getFieldWithDefault(this,13,0)},proto.service.ARKitBlendShapes.prototype.setEyeLookInLeft=function(oe){K.Message.setProto3FloatField(this,13,oe)},proto.service.ARKitBlendShapes.prototype.getEyeLookInRight=function(){return+K.Message.getFieldWithDefault(this,14,0)},proto.service.ARKitBlendShapes.prototype.setEyeLookInRight=function(oe){K.Message.setProto3FloatField(this,14,oe)},proto.service.ARKitBlendShapes.prototype.getEyeLookOutLeft=function(){return+K.Message.getFieldWithDefault(this,15,0)},proto.service.ARKitBlendShapes.prototype.setEyeLookOutLeft=function(oe){K.Message.setProto3FloatField(this,15,oe)},proto.service.ARKitBlendShapes.prototype.getEyeLookOutRight=function(){return+K.Message.getFieldWithDefault(this,16,0)},proto.service.ARKitBlendShapes.prototype.setEyeLookOutRight=function(oe){K.Message.setProto3FloatField(this,16,oe)},proto.service.ARKitBlendShapes.prototype.getEyeLookUpLeft=function(){return+K.Message.getFieldWithDefault(this,17,0)},proto.service.ARKitBlendShapes.prototype.setEyeLookUpLeft=function(oe){K.Message.setProto3FloatField(this,17,oe)},proto.service.ARKitBlendShapes.prototype.getEyeLookUpRight=function(){return+K.Message.getFieldWithDefault(this,18,0)},proto.service.ARKitBlendShapes.prototype.setEyeLookUpRight=function(oe){K.Message.setProto3FloatField(this,18,oe)},proto.service.ARKitBlendShapes.prototype.getEyeSquintLeft=function(){return+K.Message.getFieldWithDefault(this,19,0)},proto.service.ARKitBlendShapes.prototype.setEyeSquintLeft=function(oe){K.Message.setProto3FloatField(this,19,oe)},proto.service.ARKitBlendShapes.prototype.getEyeSquintRight=function(){return+K.Message.getFieldWithDefault(this,20,0)},proto.service.ARKitBlendShapes.prototype.setEyeSquintRight=function(oe){K.Message.setProto3FloatField(this,20,oe)},proto.service.ARKitBlendShapes.prototype.getEyeWideLeft=function(){return+K.Message.getFieldWithDefault(this,21,0)},proto.service.ARKitBlendShapes.prototype.setEyeWideLeft=function(oe){K.Message.setProto3FloatField(this,21,oe)},proto.service.ARKitBlendShapes.prototype.getEyeWideRight=function(){return+K.Message.getFieldWithDefault(this,22,0)},proto.service.ARKitBlendShapes.prototype.setEyeWideRight=function(oe){K.Message.setProto3FloatField(this,22,oe)},proto.service.ARKitBlendShapes.prototype.getJawForward=function(){return+K.Message.getFieldWithDefault(this,23,0)},proto.service.ARKitBlendShapes.prototype.setJawForward=function(oe){K.Message.setProto3FloatField(this,23,oe)},proto.service.ARKitBlendShapes.prototype.getJawLeft=function(){return+K.Message.getFieldWithDefault(this,24,0)},proto.service.ARKitBlendShapes.prototype.setJawLeft=function(oe){K.Message.setProto3FloatField(this,24,oe)},proto.service.ARKitBlendShapes.prototype.getJawOpen=function(){return+K.Message.getFieldWithDefault(this,25,0)},proto.service.ARKitBlendShapes.prototype.setJawOpen=function(oe){K.Message.setProto3FloatField(this,25,oe)},proto.service.ARKitBlendShapes.prototype.getJawRight=function(){return+K.Message.getFieldWithDefault(this,26,0)},proto.service.ARKitBlendShapes.prototype.setJawRight=function(oe){K.Message.setProto3FloatField(this,26,oe)},proto.service.ARKitBlendShapes.prototype.getMouthClose=function(){return+K.Message.getFieldWithDefault(this,27,0)},proto.service.ARKitBlendShapes.prototype.setMouthClose=function(oe){K.Message.setProto3FloatField(this,27,oe)},proto.service.ARKitBlendShapes.prototype.getMouthDimpleLeft=function(){return+K.Message.getFieldWithDefault(this,28,0)},proto.service.ARKitBlendShapes.prototype.setMouthDimpleLeft=function(oe){K.Message.setProto3FloatField(this,28,oe)},proto.service.ARKitBlendShapes.prototype.getMouthDimpleRight=function(){return+K.Message.getFieldWithDefault(this,29,0)},proto.service.ARKitBlendShapes.prototype.setMouthDimpleRight=function(oe){K.Message.setProto3FloatField(this,29,oe)},proto.service.ARKitBlendShapes.prototype.getMouthFrownLeft=function(){return+K.Message.getFieldWithDefault(this,30,0)},proto.service.ARKitBlendShapes.prototype.setMouthFrownLeft=function(oe){K.Message.setProto3FloatField(this,30,oe)},proto.service.ARKitBlendShapes.prototype.getMouthFrownRight=function(){return+K.Message.getFieldWithDefault(this,31,0)},proto.service.ARKitBlendShapes.prototype.setMouthFrownRight=function(oe){K.Message.setProto3FloatField(this,31,oe)},proto.service.ARKitBlendShapes.prototype.getMouthFunnel=function(){return+K.Message.getFieldWithDefault(this,32,0)},proto.service.ARKitBlendShapes.prototype.setMouthFunnel=function(oe){K.Message.setProto3FloatField(this,32,oe)},proto.service.ARKitBlendShapes.prototype.getMouthLeft=function(){return+K.Message.getFieldWithDefault(this,33,0)},proto.service.ARKitBlendShapes.prototype.setMouthLeft=function(oe){K.Message.setProto3FloatField(this,33,oe)},proto.service.ARKitBlendShapes.prototype.getMouthLowerDownLeft=function(){return+K.Message.getFieldWithDefault(this,34,0)},proto.service.ARKitBlendShapes.prototype.setMouthLowerDownLeft=function(oe){K.Message.setProto3FloatField(this,34,oe)},proto.service.ARKitBlendShapes.prototype.getMouthLowerDownRight=function(){return+K.Message.getFieldWithDefault(this,35,0)},proto.service.ARKitBlendShapes.prototype.setMouthLowerDownRight=function(oe){K.Message.setProto3FloatField(this,35,oe)},proto.service.ARKitBlendShapes.prototype.getMouthPressLeft=function(){return+K.Message.getFieldWithDefault(this,36,0)},proto.service.ARKitBlendShapes.prototype.setMouthPressLeft=function(oe){K.Message.setProto3FloatField(this,36,oe)},proto.service.ARKitBlendShapes.prototype.getMouthPressRight=function(){return+K.Message.getFieldWithDefault(this,37,0)},proto.service.ARKitBlendShapes.prototype.setMouthPressRight=function(oe){K.Message.setProto3FloatField(this,37,oe)},proto.service.ARKitBlendShapes.prototype.getMouthPucker=function(){return+K.Message.getFieldWithDefault(this,38,0)},proto.service.ARKitBlendShapes.prototype.setMouthPucker=function(oe){K.Message.setProto3FloatField(this,38,oe)},proto.service.ARKitBlendShapes.prototype.getMouthRight=function(){return+K.Message.getFieldWithDefault(this,39,0)},proto.service.ARKitBlendShapes.prototype.setMouthRight=function(oe){K.Message.setProto3FloatField(this,39,oe)},proto.service.ARKitBlendShapes.prototype.getMouthRollLower=function(){return+K.Message.getFieldWithDefault(this,40,0)},proto.service.ARKitBlendShapes.prototype.setMouthRollLower=function(oe){K.Message.setProto3FloatField(this,40,oe)},proto.service.ARKitBlendShapes.prototype.getMouthRollUpper=function(){return+K.Message.getFieldWithDefault(this,41,0)},proto.service.ARKitBlendShapes.prototype.setMouthRollUpper=function(oe){K.Message.setProto3FloatField(this,41,oe)},proto.service.ARKitBlendShapes.prototype.getMouthShrugLower=function(){return+K.Message.getFieldWithDefault(this,42,0)},proto.service.ARKitBlendShapes.prototype.setMouthShrugLower=function(oe){K.Message.setProto3FloatField(this,42,oe)},proto.service.ARKitBlendShapes.prototype.getMouthShrugUpper=function(){return+K.Message.getFieldWithDefault(this,43,0)},proto.service.ARKitBlendShapes.prototype.setMouthShrugUpper=function(oe){K.Message.setProto3FloatField(this,43,oe)},proto.service.ARKitBlendShapes.prototype.getMouthSmileLeft=function(){return+K.Message.getFieldWithDefault(this,44,0)},proto.service.ARKitBlendShapes.prototype.setMouthSmileLeft=function(oe){K.Message.setProto3FloatField(this,44,oe)},proto.service.ARKitBlendShapes.prototype.getMouthSmileRight=function(){return+K.Message.getFieldWithDefault(this,45,0)},proto.service.ARKitBlendShapes.prototype.setMouthSmileRight=function(oe){K.Message.setProto3FloatField(this,45,oe)},proto.service.ARKitBlendShapes.prototype.getMouthStretchLeft=function(){return+K.Message.getFieldWithDefault(this,46,0)},proto.service.ARKitBlendShapes.prototype.setMouthStretchLeft=function(oe){K.Message.setProto3FloatField(this,46,oe)},proto.service.ARKitBlendShapes.prototype.getMouthStretchRight=function(){return+K.Message.getFieldWithDefault(this,47,0)},proto.service.ARKitBlendShapes.prototype.setMouthStretchRight=function(oe){K.Message.setProto3FloatField(this,47,oe)},proto.service.ARKitBlendShapes.prototype.getMouthUpperUpLeft=function(){return+K.Message.getFieldWithDefault(this,48,0)},proto.service.ARKitBlendShapes.prototype.setMouthUpperUpLeft=function(oe){K.Message.setProto3FloatField(this,48,oe)},proto.service.ARKitBlendShapes.prototype.getMouthUpperUpRight=function(){return+K.Message.getFieldWithDefault(this,49,0)},proto.service.ARKitBlendShapes.prototype.setMouthUpperUpRight=function(oe){K.Message.setProto3FloatField(this,49,oe)},proto.service.ARKitBlendShapes.prototype.getNoseSneerLeft=function(){return+K.Message.getFieldWithDefault(this,50,0)},proto.service.ARKitBlendShapes.prototype.setNoseSneerLeft=function(oe){K.Message.setProto3FloatField(this,50,oe)},proto.service.ARKitBlendShapes.prototype.getNoseSneerRight=function(){return+K.Message.getFieldWithDefault(this,51,0)},proto.service.ARKitBlendShapes.prototype.setNoseSneerRight=function(oe){K.Message.setProto3FloatField(this,51,oe)},proto.service.ARKitBlendShapes.prototype.getTongueOut=function(){return+K.Message.getFieldWithDefault(this,52,0)},proto.service.ARKitBlendShapes.prototype.setTongueOut=function(oe){K.Message.setProto3FloatField(this,52,oe)},te.object.extend(Z,proto.service)},48:(X,Z,_)=>{var K=_(339),te=K,ne=Function("return this")(),oe=_(720);te.exportSymbol("proto.service.ActionConfig",null,ne),te.exportSymbol("proto.service.ActionConfig.Character",null,ne),te.exportSymbol("proto.service.ActionConfig.Object",null,ne),te.exportSymbol("proto.service.AudioConfig",null,ne),te.exportSymbol("proto.service.BlendShapesData",null,ne),te.exportSymbol("proto.service.EmotionResponse",null,ne),te.exportSymbol("proto.service.FaceModel",null,ne),te.exportSymbol("proto.service.FeedbackRequest",null,ne),te.exportSymbol("proto.service.FeedbackRequest.Feedback",null,ne),te.exportSymbol("proto.service.FeedbackResponse",null,ne),te.exportSymbol("proto.service.GetResponseRequest",null,ne),te.exportSymbol("proto.service.GetResponseRequest.GetResponseConfig",null,ne),te.exportSymbol("proto.service.GetResponseRequest.GetResponseData",null,ne),te.exportSymbol("proto.service.GetResponseRequestSingle",null,ne),te.exportSymbol("proto.service.GetResponseResponse",null,ne),te.exportSymbol("proto.service.GetResponseResponse.ActionResponse",null,ne),te.exportSymbol("proto.service.GetResponseResponse.AudioResponse",null,ne),te.exportSymbol("proto.service.GetResponseResponse.BehaviorTreeResponse",null,ne),te.exportSymbol("proto.service.GetResponseResponse.UserTranscript",null,ne),te.exportSymbol("proto.service.HelloRequest",null,ne),te.exportSymbol("proto.service.HelloResponse",null,ne),te.exportSymbol("proto.service.STTRequest",null,ne),te.exportSymbol("proto.service.STTResponse",null,ne),te.exportSymbol("proto.service.TriggerConfig",null,ne),te.exportSymbol("proto.service.Viseme",null,ne),te.exportSymbol("proto.service.VisemesData",null,ne),proto.service.AudioConfig=function(ie){K.Message.initialize(this,ie,0,-1,null,null)},te.inherits(proto.service.AudioConfig,K.Message),te.DEBUG&&!COMPILED&&(proto.service.AudioConfig.displayName="proto.service.AudioConfig"),K.Message.GENERATE_TO_OBJECT&&(proto.service.AudioConfig.prototype.toObject=function(ie){return proto.service.AudioConfig.toObject(ie,this)},proto.service.AudioConfig.toObject=function(ie,se){var ae={sampleRateHertz:K.Message.getFieldWithDefault(se,1,0),disableAudio:K.Message.getFieldWithDefault(se,2,!1),enableFacialData:K.Message.getFieldWithDefault(se,3,!1),faceModel:K.Message.getFieldWithDefault(se,4,0),enableFacialEmotionData:K.Message.getFieldWithDefault(se,5,!1)};return ie&&(ae.$jspbMessageInstance=se),ae}),proto.service.AudioConfig.deserializeBinary=function(ie){var se=new K.BinaryReader(ie),ae=new proto.service.AudioConfig;return proto.service.AudioConfig.deserializeBinaryFromReader(ae,se)},proto.service.AudioConfig.deserializeBinaryFromReader=function(ie,se){for(;se.nextField()&&!se.isEndGroup();)switch(se.getFieldNumber()){case 1:var ae=se.readInt32();ie.setSampleRateHertz(ae);break;case 2:ae=se.readBool(),ie.setDisableAudio(ae);break;case 3:ae=se.readBool(),ie.setEnableFacialData(ae);break;case 4:ae=se.readEnum(),ie.setFaceModel(ae);break;case 5:ae=se.readBool(),ie.setEnableFacialEmotionData(ae);break;default:se.skipField()}return ie},proto.service.AudioConfig.prototype.serializeBinary=function(){var ie=new K.BinaryWriter;return proto.service.AudioConfig.serializeBinaryToWriter(this,ie),ie.getResultBuffer()},proto.service.AudioConfig.serializeBinaryToWriter=function(ie,se){var ae=void 0;(ae=ie.getSampleRateHertz())!==0&&se.writeInt32(1,ae),(ae=ie.getDisableAudio())&&se.writeBool(2,ae),(ae=ie.getEnableFacialData())&&se.writeBool(3,ae),(ae=ie.getFaceModel())!==0&&se.writeEnum(4,ae),(ae=ie.getEnableFacialEmotionData())&&se.writeBool(5,ae)},proto.service.AudioConfig.prototype.getSampleRateHertz=function(){return K.Message.getFieldWithDefault(this,1,0)},proto.service.AudioConfig.prototype.setSampleRateHertz=function(ie){K.Message.setProto3IntField(this,1,ie)},proto.service.AudioConfig.prototype.getDisableAudio=function(){return K.Message.getFieldWithDefault(this,2,!1)},proto.service.AudioConfig.prototype.setDisableAudio=function(ie){K.Message.setProto3BooleanField(this,2,ie)},proto.service.AudioConfig.prototype.getEnableFacialData=function(){return K.Message.getFieldWithDefault(this,3,!1)},proto.service.AudioConfig.prototype.setEnableFacialData=function(ie){K.Message.setProto3BooleanField(this,3,ie)},proto.service.AudioConfig.prototype.getFaceModel=function(){return K.Message.getFieldWithDefault(this,4,0)},proto.service.AudioConfig.prototype.setFaceModel=function(ie){K.Message.setProto3EnumField(this,4,ie)},proto.service.AudioConfig.prototype.getEnableFacialEmotionData=function(){return K.Message.getFieldWithDefault(this,5,!1)},proto.service.AudioConfig.prototype.setEnableFacialEmotionData=function(ie){K.Message.setProto3BooleanField(this,5,ie)},proto.service.TriggerConfig=function(ie){K.Message.initialize(this,ie,0,-1,null,null)},te.inherits(proto.service.TriggerConfig,K.Message),te.DEBUG&&!COMPILED&&(proto.service.TriggerConfig.displayName="proto.service.TriggerConfig"),K.Message.GENERATE_TO_OBJECT&&(proto.service.TriggerConfig.prototype.toObject=function(ie){return proto.service.TriggerConfig.toObject(ie,this)},proto.service.TriggerConfig.toObject=function(ie,se){var ae={triggerName:K.Message.getFieldWithDefault(se,1,""),triggerMessage:K.Message.getFieldWithDefault(se,2,"")};return ie&&(ae.$jspbMessageInstance=se),ae}),proto.service.TriggerConfig.deserializeBinary=function(ie){var se=new K.BinaryReader(ie),ae=new proto.service.TriggerConfig;return proto.service.TriggerConfig.deserializeBinaryFromReader(ae,se)},proto.service.TriggerConfig.deserializeBinaryFromReader=function(ie,se){for(;se.nextField()&&!se.isEndGroup();)switch(se.getFieldNumber()){case 1:var ae=se.readString();ie.setTriggerName(ae);break;case 2:ae=se.readString(),ie.setTriggerMessage(ae);break;default:se.skipField()}return ie},proto.service.TriggerConfig.prototype.serializeBinary=function(){var ie=new K.BinaryWriter;return proto.service.TriggerConfig.serializeBinaryToWriter(this,ie),ie.getResultBuffer()},proto.service.TriggerConfig.serializeBinaryToWriter=function(ie,se){var ae=void 0;(ae=ie.getTriggerName()).length>0&&se.writeString(1,ae),(ae=ie.getTriggerMessage()).length>0&&se.writeString(2,ae)},proto.service.TriggerConfig.prototype.getTriggerName=function(){return K.Message.getFieldWithDefault(this,1,"")},proto.service.TriggerConfig.prototype.setTriggerName=function(ie){K.Message.setProto3StringField(this,1,ie)},proto.service.TriggerConfig.prototype.getTriggerMessage=function(){return K.Message.getFieldWithDefault(this,2,"")},proto.service.TriggerConfig.prototype.setTriggerMessage=function(ie){K.Message.setProto3StringField(this,2,ie)},proto.service.ActionConfig=function(ie){K.Message.initialize(this,ie,0,-1,proto.service.ActionConfig.repeatedFields_,null)},te.inherits(proto.service.ActionConfig,K.Message),te.DEBUG&&!COMPILED&&(proto.service.ActionConfig.displayName="proto.service.ActionConfig"),proto.service.ActionConfig.repeatedFields_=[1,2,3],K.Message.GENERATE_TO_OBJECT&&(proto.service.ActionConfig.prototype.toObject=function(ie){return proto.service.ActionConfig.toObject(ie,this)},proto.service.ActionConfig.toObject=function(ie,se){var ae={actionsList:K.Message.getRepeatedField(se,1),charactersList:K.Message.toObjectList(se.getCharactersList(),proto.service.ActionConfig.Character.toObject,ie),objectsList:K.Message.toObjectList(se.getObjectsList(),proto.service.ActionConfig.Object.toObject,ie),classification:K.Message.getFieldWithDefault(se,4,""),contextLevel:K.Message.getFieldWithDefault(se,5,0),currentAttentionObject:K.Message.getFieldWithDefault(se,6,"")};return ie&&(ae.$jspbMessageInstance=se),ae}),proto.service.ActionConfig.deserializeBinary=function(ie){var se=new K.BinaryReader(ie),ae=new proto.service.ActionConfig;return proto.service.ActionConfig.deserializeBinaryFromReader(ae,se)},proto.service.ActionConfig.deserializeBinaryFromReader=function(ie,se){for(;se.nextField()&&!se.isEndGroup();)switch(se.getFieldNumber()){case 1:var ae=se.readString();ie.addActions(ae);break;case 2:ae=new proto.service.ActionConfig.Character,se.readMessage(ae,proto.service.ActionConfig.Character.deserializeBinaryFromReader),ie.addCharacters(ae);break;case 3:ae=new proto.service.ActionConfig.Object,se.readMessage(ae,proto.service.ActionConfig.Object.deserializeBinaryFromReader),ie.addObjects(ae);break;case 4:ae=se.readString(),ie.setClassification(ae);break;case 5:ae=se.readInt32(),ie.setContextLevel(ae);break;case 6:ae=se.readString(),ie.setCurrentAttentionObject(ae);break;default:se.skipField()}return ie},proto.service.ActionConfig.prototype.serializeBinary=function(){var ie=new K.BinaryWriter;return proto.service.ActionConfig.serializeBinaryToWriter(this,ie),ie.getResultBuffer()},proto.service.ActionConfig.serializeBinaryToWriter=function(ie,se){var ae=void 0;(ae=ie.getActionsList()).length>0&&se.writeRepeatedString(1,ae),(ae=ie.getCharactersList()).length>0&&se.writeRepeatedMessage(2,ae,proto.service.ActionConfig.Character.serializeBinaryToWriter),(ae=ie.getObjectsList()).length>0&&se.writeRepeatedMessage(3,ae,proto.service.ActionConfig.Object.serializeBinaryToWriter),(ae=ie.getClassification()).length>0&&se.writeString(4,ae),(ae=ie.getContextLevel())!==0&&se.writeInt32(5,ae),(ae=ie.getCurrentAttentionObject()).length>0&&se.writeString(6,ae)},proto.service.ActionConfig.Character=function(ie){K.Message.initialize(this,ie,0,-1,null,null)},te.inherits(proto.service.ActionConfig.Character,K.Message),te.DEBUG&&!COMPILED&&(proto.service.ActionConfig.Character.displayName="proto.service.ActionConfig.Character"),K.Message.GENERATE_TO_OBJECT&&(proto.service.ActionConfig.Character.prototype.toObject=function(ie){return proto.service.ActionConfig.Character.toObject(ie,this)},proto.service.ActionConfig.Character.toObject=function(ie,se){var ae={name:K.Message.getFieldWithDefault(se,1,""),bio:K.Message.getFieldWithDefault(se,2,"")};return ie&&(ae.$jspbMessageInstance=se),ae}),proto.service.ActionConfig.Character.deserializeBinary=function(ie){var se=new K.BinaryReader(ie),ae=new proto.service.ActionConfig.Character;return proto.service.ActionConfig.Character.deserializeBinaryFromReader(ae,se)},proto.service.ActionConfig.Character.deserializeBinaryFromReader=function(ie,se){for(;se.nextField()&&!se.isEndGroup();)switch(se.getFieldNumber()){case 1:var ae=se.readString();ie.setName(ae);break;case 2:ae=se.readString(),ie.setBio(ae);break;default:se.skipField()}return ie},proto.service.ActionConfig.Character.prototype.serializeBinary=function(){var ie=new K.BinaryWriter;return proto.service.ActionConfig.Character.serializeBinaryToWriter(this,ie),ie.getResultBuffer()},proto.service.ActionConfig.Character.serializeBinaryToWriter=function(ie,se){var ae=void 0;(ae=ie.getName()).length>0&&se.writeString(1,ae),(ae=ie.getBio()).length>0&&se.writeString(2,ae)},proto.service.ActionConfig.Character.prototype.getName=function(){return K.Message.getFieldWithDefault(this,1,"")},proto.service.ActionConfig.Character.prototype.setName=function(ie){K.Message.setProto3StringField(this,1,ie)},proto.service.ActionConfig.Character.prototype.getBio=function(){return K.Message.getFieldWithDefault(this,2,"")},proto.service.ActionConfig.Character.prototype.setBio=function(ie){K.Message.setProto3StringField(this,2,ie)},proto.service.ActionConfig.Object=function(ie){K.Message.initialize(this,ie,0,-1,null,null)},te.inherits(proto.service.ActionConfig.Object,K.Message),te.DEBUG&&!COMPILED&&(proto.service.ActionConfig.Object.displayName="proto.service.ActionConfig.Object"),K.Message.GENERATE_TO_OBJECT&&(proto.service.ActionConfig.Object.prototype.toObject=function(ie){return proto.service.ActionConfig.Object.toObject(ie,this)},proto.service.ActionConfig.Object.toObject=function(ie,se){var ae={name:K.Message.getFieldWithDefault(se,1,""),description:K.Message.getFieldWithDefault(se,2,"")};return ie&&(ae.$jspbMessageInstance=se),ae}),proto.service.ActionConfig.Object.deserializeBinary=function(ie){var se=new K.BinaryReader(ie),ae=new proto.service.ActionConfig.Object;return proto.service.ActionConfig.Object.deserializeBinaryFromReader(ae,se)},proto.service.ActionConfig.Object.deserializeBinaryFromReader=function(ie,se){for(;se.nextField()&&!se.isEndGroup();)switch(se.getFieldNumber()){case 1:var ae=se.readString();ie.setName(ae);break;case 2:ae=se.readString(),ie.setDescription(ae);break;default:se.skipField()}return ie},proto.service.ActionConfig.Object.prototype.serializeBinary=function(){var ie=new K.BinaryWriter;return proto.service.ActionConfig.Object.serializeBinaryToWriter(this,ie),ie.getResultBuffer()},proto.service.ActionConfig.Object.serializeBinaryToWriter=function(ie,se){var ae=void 0;(ae=ie.getName()).length>0&&se.writeString(1,ae),(ae=ie.getDescription()).length>0&&se.writeString(2,ae)},proto.service.ActionConfig.Object.prototype.getName=function(){return K.Message.getFieldWithDefault(this,1,"")},proto.service.ActionConfig.Object.prototype.setName=function(ie){K.Message.setProto3StringField(this,1,ie)},proto.service.ActionConfig.Object.prototype.getDescription=function(){return K.Message.getFieldWithDefault(this,2,"")},proto.service.ActionConfig.Object.prototype.setDescription=function(ie){K.Message.setProto3StringField(this,2,ie)},proto.service.ActionConfig.prototype.getActionsList=function(){return K.Message.getRepeatedField(this,1)},proto.service.ActionConfig.prototype.setActionsList=function(ie){K.Message.setField(this,1,ie||[])},proto.service.ActionConfig.prototype.addActions=function(ie,se){K.Message.addToRepeatedField(this,1,ie,se)},proto.service.ActionConfig.prototype.clearActionsList=function(){this.setActionsList([])},proto.service.ActionConfig.prototype.getCharactersList=function(){return K.Message.getRepeatedWrapperField(this,proto.service.ActionConfig.Character,2)},proto.service.ActionConfig.prototype.setCharactersList=function(ie){K.Message.setRepeatedWrapperField(this,2,ie)},proto.service.ActionConfig.prototype.addCharacters=function(ie,se){return K.Message.addToRepeatedWrapperField(this,2,ie,proto.service.ActionConfig.Character,se)},proto.service.ActionConfig.prototype.clearCharactersList=function(){this.setCharactersList([])},proto.service.ActionConfig.prototype.getObjectsList=function(){return K.Message.getRepeatedWrapperField(this,proto.service.ActionConfig.Object,3)},proto.service.ActionConfig.prototype.setObjectsList=function(ie){K.Message.setRepeatedWrapperField(this,3,ie)},proto.service.ActionConfig.prototype.addObjects=function(ie,se){return K.Message.addToRepeatedWrapperField(this,3,ie,proto.service.ActionConfig.Object,se)},proto.service.ActionConfig.prototype.clearObjectsList=function(){this.setObjectsList([])},proto.service.ActionConfig.prototype.getClassification=function(){return K.Message.getFieldWithDefault(this,4,"")},proto.service.ActionConfig.prototype.setClassification=function(ie){K.Message.setProto3StringField(this,4,ie)},proto.service.ActionConfig.prototype.getContextLevel=function(){return K.Message.getFieldWithDefault(this,5,0)},proto.service.ActionConfig.prototype.setContextLevel=function(ie){K.Message.setProto3IntField(this,5,ie)},proto.service.ActionConfig.prototype.getCurrentAttentionObject=function(){return K.Message.getFieldWithDefault(this,6,"")},proto.service.ActionConfig.prototype.setCurrentAttentionObject=function(ie){K.Message.setProto3StringField(this,6,ie)},proto.service.STTRequest=function(ie){K.Message.initialize(this,ie,0,-1,null,proto.service.STTRequest.oneofGroups_)},te.inherits(proto.service.STTRequest,K.Message),te.DEBUG&&!COMPILED&&(proto.service.STTRequest.displayName="proto.service.STTRequest"),proto.service.STTRequest.oneofGroups_=[[1,2]],proto.service.STTRequest.RequestTypeCase={REQUEST_TYPE_NOT_SET:0,AUDIO_CONFIG:1,AUDIO_CHUNK:2},proto.service.STTRequest.prototype.getRequestTypeCase=function(){return K.Message.computeOneofCase(this,proto.service.STTRequest.oneofGroups_[0])},K.Message.GENERATE_TO_OBJECT&&(proto.service.STTRequest.prototype.toObject=function(ie){return proto.service.STTRequest.toObject(ie,this)},proto.service.STTRequest.toObject=function(ie,se){var ae,ge={audioConfig:(ae=se.getAudioConfig())&&proto.service.AudioConfig.toObject(ie,ae),audioChunk:se.getAudioChunk_asB64()};return ie&&(ge.$jspbMessageInstance=se),ge}),proto.service.STTRequest.deserializeBinary=function(ie){var se=new K.BinaryReader(ie),ae=new proto.service.STTRequest;return proto.service.STTRequest.deserializeBinaryFromReader(ae,se)},proto.service.STTRequest.deserializeBinaryFromReader=function(ie,se){for(;se.nextField()&&!se.isEndGroup();)switch(se.getFieldNumber()){case 1:var ae=new proto.service.AudioConfig;se.readMessage(ae,proto.service.AudioConfig.deserializeBinaryFromReader),ie.setAudioConfig(ae);break;case 2:ae=se.readBytes(),ie.setAudioChunk(ae);break;default:se.skipField()}return ie},proto.service.STTRequest.prototype.serializeBinary=function(){var ie=new K.BinaryWriter;return proto.service.STTRequest.serializeBinaryToWriter(this,ie),ie.getResultBuffer()},proto.service.STTRequest.serializeBinaryToWriter=function(ie,se){var ae=void 0;(ae=ie.getAudioConfig())!=null&&se.writeMessage(1,ae,proto.service.AudioConfig.serializeBinaryToWriter),(ae=K.Message.getField(ie,2))!=null&&se.writeBytes(2,ae)},proto.service.STTRequest.prototype.getAudioConfig=function(){return K.Message.getWrapperField(this,proto.service.AudioConfig,1)},proto.service.STTRequest.prototype.setAudioConfig=function(ie){K.Message.setOneofWrapperField(this,1,proto.service.STTRequest.oneofGroups_[0],ie)},proto.service.STTRequest.prototype.clearAudioConfig=function(){this.setAudioConfig(void 0)},proto.service.STTRequest.prototype.hasAudioConfig=function(){return K.Message.getField(this,1)!=null},proto.service.STTRequest.prototype.getAudioChunk=function(){return K.Message.getFieldWithDefault(this,2,"")},proto.service.STTRequest.prototype.getAudioChunk_asB64=function(){return K.Message.bytesAsB64(this.getAudioChunk())},proto.service.STTRequest.prototype.getAudioChunk_asU8=function(){return K.Message.bytesAsU8(this.getAudioChunk())},proto.service.STTRequest.prototype.setAudioChunk=function(ie){K.Message.setOneofField(this,2,proto.service.STTRequest.oneofGroups_[0],ie)},proto.service.STTRequest.prototype.clearAudioChunk=function(){K.Message.setOneofField(this,2,proto.service.STTRequest.oneofGroups_[0],void 0)},proto.service.STTRequest.prototype.hasAudioChunk=function(){return K.Message.getField(this,2)!=null},proto.service.STTResponse=function(ie){K.Message.initialize(this,ie,0,-1,null,null)},te.inherits(proto.service.STTResponse,K.Message),te.DEBUG&&!COMPILED&&(proto.service.STTResponse.displayName="proto.service.STTResponse"),K.Message.GENERATE_TO_OBJECT&&(proto.service.STTResponse.prototype.toObject=function(ie){return proto.service.STTResponse.toObject(ie,this)},proto.service.STTResponse.toObject=function(ie,se){var ae={text:K.Message.getFieldWithDefault(se,1,"")};return ie&&(ae.$jspbMessageInstance=se),ae}),proto.service.STTResponse.deserializeBinary=function(ie){var se=new K.BinaryReader(ie),ae=new proto.service.STTResponse;return proto.service.STTResponse.deserializeBinaryFromReader(ae,se)},proto.service.STTResponse.deserializeBinaryFromReader=function(ie,se){for(;se.nextField()&&!se.isEndGroup();)if(se.getFieldNumber()===1){var ae=se.readString();ie.setText(ae)}else se.skipField();return ie},proto.service.STTResponse.prototype.serializeBinary=function(){var ie=new K.BinaryWriter;return proto.service.STTResponse.serializeBinaryToWriter(this,ie),ie.getResultBuffer()},proto.service.STTResponse.serializeBinaryToWriter=function(ie,se){var ae;(ae=ie.getText()).length>0&&se.writeString(1,ae)},proto.service.STTResponse.prototype.getText=function(){return K.Message.getFieldWithDefault(this,1,"")},proto.service.STTResponse.prototype.setText=function(ie){K.Message.setProto3StringField(this,1,ie)},proto.service.GetResponseRequest=function(ie){K.Message.initialize(this,ie,0,-1,null,proto.service.GetResponseRequest.oneofGroups_)},te.inherits(proto.service.GetResponseRequest,K.Message),te.DEBUG&&!COMPILED&&(proto.service.GetResponseRequest.displayName="proto.service.GetResponseRequest"),proto.service.GetResponseRequest.oneofGroups_=[[1,2]],proto.service.GetResponseRequest.RequestTypeCase={REQUEST_TYPE_NOT_SET:0,GET_RESPONSE_CONFIG:1,GET_RESPONSE_DATA:2},proto.service.GetResponseRequest.prototype.getRequestTypeCase=function(){return K.Message.computeOneofCase(this,proto.service.GetResponseRequest.oneofGroups_[0])},K.Message.GENERATE_TO_OBJECT&&(proto.service.GetResponseRequest.prototype.toObject=function(ie){return proto.service.GetResponseRequest.toObject(ie,this)},proto.service.GetResponseRequest.toObject=function(ie,se){var ae,ge={getResponseConfig:(ae=se.getGetResponseConfig())&&proto.service.GetResponseRequest.GetResponseConfig.toObject(ie,ae),getResponseData:(ae=se.getGetResponseData())&&proto.service.GetResponseRequest.GetResponseData.toObject(ie,ae)};return ie&&(ge.$jspbMessageInstance=se),ge}),proto.service.GetResponseRequest.deserializeBinary=function(ie){var se=new K.BinaryReader(ie),ae=new proto.service.GetResponseRequest;return proto.service.GetResponseRequest.deserializeBinaryFromReader(ae,se)},proto.service.GetResponseRequest.deserializeBinaryFromReader=function(ie,se){for(;se.nextField()&&!se.isEndGroup();)switch(se.getFieldNumber()){case 1:var ae=new proto.service.GetResponseRequest.GetResponseConfig;se.readMessage(ae,proto.service.GetResponseRequest.GetResponseConfig.deserializeBinaryFromReader),ie.setGetResponseConfig(ae);break;case 2:ae=new proto.service.GetResponseRequest.GetResponseData,se.readMessage(ae,proto.service.GetResponseRequest.GetResponseData.deserializeBinaryFromReader),ie.setGetResponseData(ae);break;default:se.skipField()}return ie},proto.service.GetResponseRequest.prototype.serializeBinary=function(){var ie=new K.BinaryWriter;return proto.service.GetResponseRequest.serializeBinaryToWriter(this,ie),ie.getResultBuffer()},proto.service.GetResponseRequest.serializeBinaryToWriter=function(ie,se){var ae=void 0;(ae=ie.getGetResponseConfig())!=null&&se.writeMessage(1,ae,proto.service.GetResponseRequest.GetResponseConfig.serializeBinaryToWriter),(ae=ie.getGetResponseData())!=null&&se.writeMessage(2,ae,proto.service.GetResponseRequest.GetResponseData.serializeBinaryToWriter)},proto.service.GetResponseRequest.GetResponseConfig=function(ie){K.Message.initialize(this,ie,0,-1,null,null)},te.inherits(proto.service.GetResponseRequest.GetResponseConfig,K.Message),te.DEBUG&&!COMPILED&&(proto.service.GetResponseRequest.GetResponseConfig.displayName="proto.service.GetResponseRequest.GetResponseConfig"),K.Message.GENERATE_TO_OBJECT&&(proto.service.GetResponseRequest.GetResponseConfig.prototype.toObject=function(ie){return proto.service.GetResponseRequest.GetResponseConfig.toObject(ie,this)},proto.service.GetResponseRequest.GetResponseConfig.toObject=function(ie,se){var ae,ge={characterId:K.Message.getFieldWithDefault(se,2,""),apiKey:K.Message.getFieldWithDefault(se,3,""),sessionId:K.Message.getFieldWithDefault(se,4,""),audioConfig:(ae=se.getAudioConfig())&&proto.service.AudioConfig.toObject(ie,ae),actionConfig:(ae=se.getActionConfig())&&proto.service.ActionConfig.toObject(ie,ae),speaker:K.Message.getFieldWithDefault(se,7,""),languageCode:K.Message.getFieldWithDefault(se,8,""),speakerId:K.Message.getFieldWithDefault(se,9,""),apiAuthToken:K.Message.getFieldWithDefault(se,10,""),narrativeTemplateKeysMap:(ae=se.getNarrativeTemplateKeysMap())?ae.toObject(ie,void 0):[]};return ie&&(ge.$jspbMessageInstance=se),ge}),proto.service.GetResponseRequest.GetResponseConfig.deserializeBinary=function(ie){var se=new K.BinaryReader(ie),ae=new proto.service.GetResponseRequest.GetResponseConfig;return proto.service.GetResponseRequest.GetResponseConfig.deserializeBinaryFromReader(ae,se)},proto.service.GetResponseRequest.GetResponseConfig.deserializeBinaryFromReader=function(ie,se){for(;se.nextField()&&!se.isEndGroup();)switch(se.getFieldNumber()){case 2:var ae=se.readString();ie.setCharacterId(ae);break;case 3:ae=se.readString(),ie.setApiKey(ae);break;case 4:ae=se.readString(),ie.setSessionId(ae);break;case 5:ae=new proto.service.AudioConfig,se.readMessage(ae,proto.service.AudioConfig.deserializeBinaryFromReader),ie.setAudioConfig(ae);break;case 6:ae=new proto.service.ActionConfig,se.readMessage(ae,proto.service.ActionConfig.deserializeBinaryFromReader),ie.setActionConfig(ae);break;case 7:ae=se.readString(),ie.setSpeaker(ae);break;case 8:ae=se.readString(),ie.setLanguageCode(ae);break;case 9:ae=se.readString(),ie.setSpeakerId(ae);break;case 10:ae=se.readString(),ie.setApiAuthToken(ae);break;case 11:ae=ie.getNarrativeTemplateKeysMap(),se.readMessage(ae,function(ge,ce){K.Map.deserializeBinary(ge,ce,K.BinaryReader.prototype.readString,K.BinaryReader.prototype.readString,null,"")});break;default:se.skipField()}return ie},proto.service.GetResponseRequest.GetResponseConfig.prototype.serializeBinary=function(){var ie=new K.BinaryWriter;return proto.service.GetResponseRequest.GetResponseConfig.serializeBinaryToWriter(this,ie),ie.getResultBuffer()},proto.service.GetResponseRequest.GetResponseConfig.serializeBinaryToWriter=function(ie,se){var ae=void 0;(ae=ie.getCharacterId()).length>0&&se.writeString(2,ae),(ae=ie.getApiKey()).length>0&&se.writeString(3,ae),(ae=ie.getSessionId()).length>0&&se.writeString(4,ae),(ae=ie.getAudioConfig())!=null&&se.writeMessage(5,ae,proto.service.AudioConfig.serializeBinaryToWriter),(ae=ie.getActionConfig())!=null&&se.writeMessage(6,ae,proto.service.ActionConfig.serializeBinaryToWriter),(ae=ie.getSpeaker()).length>0&&se.writeString(7,ae),(ae=ie.getLanguageCode()).length>0&&se.writeString(8,ae),(ae=ie.getSpeakerId()).length>0&&se.writeString(9,ae),(ae=ie.getApiAuthToken()).length>0&&se.writeString(10,ae),(ae=ie.getNarrativeTemplateKeysMap(!0))&&ae.getLength()>0&&ae.serializeBinary(11,se,K.BinaryWriter.prototype.writeString,K.BinaryWriter.prototype.writeString)},proto.service.GetResponseRequest.GetResponseConfig.prototype.getCharacterId=function(){return K.Message.getFieldWithDefault(this,2,"")},proto.service.GetResponseRequest.GetResponseConfig.prototype.setCharacterId=function(ie){K.Message.setProto3StringField(this,2,ie)},proto.service.GetResponseRequest.GetResponseConfig.prototype.getApiKey=function(){return K.Message.getFieldWithDefault(this,3,"")},proto.service.GetResponseRequest.GetResponseConfig.prototype.setApiKey=function(ie){K.Message.setProto3StringField(this,3,ie)},proto.service.GetResponseRequest.GetResponseConfig.prototype.getSessionId=function(){return K.Message.getFieldWithDefault(this,4,"")},proto.service.GetResponseRequest.GetResponseConfig.prototype.setSessionId=function(ie){K.Message.setProto3StringField(this,4,ie)},proto.service.GetResponseRequest.GetResponseConfig.prototype.getAudioConfig=function(){return K.Message.getWrapperField(this,proto.service.AudioConfig,5)},proto.service.GetResponseRequest.GetResponseConfig.prototype.setAudioConfig=function(ie){K.Message.setWrapperField(this,5,ie)},proto.service.GetResponseRequest.GetResponseConfig.prototype.clearAudioConfig=function(){this.setAudioConfig(void 0)},proto.service.GetResponseRequest.GetResponseConfig.prototype.hasAudioConfig=function(){return K.Message.getField(this,5)!=null},proto.service.GetResponseRequest.GetResponseConfig.prototype.getActionConfig=function(){return K.Message.getWrapperField(this,proto.service.ActionConfig,6)},proto.service.GetResponseRequest.GetResponseConfig.prototype.setActionConfig=function(ie){K.Message.setWrapperField(this,6,ie)},proto.service.GetResponseRequest.GetResponseConfig.prototype.clearActionConfig=function(){this.setActionConfig(void 0)},proto.service.GetResponseRequest.GetResponseConfig.prototype.hasActionConfig=function(){return K.Message.getField(this,6)!=null},proto.service.GetResponseRequest.GetResponseConfig.prototype.getSpeaker=function(){return K.Message.getFieldWithDefault(this,7,"")},proto.service.GetResponseRequest.GetResponseConfig.prototype.setSpeaker=function(ie){K.Message.setProto3StringField(this,7,ie)},proto.service.GetResponseRequest.GetResponseConfig.prototype.getLanguageCode=function(){return K.Message.getFieldWithDefault(this,8,"")},proto.service.GetResponseRequest.GetResponseConfig.prototype.setLanguageCode=function(ie){K.Message.setProto3StringField(this,8,ie)},proto.service.GetResponseRequest.GetResponseConfig.prototype.getSpeakerId=function(){return K.Message.getFieldWithDefault(this,9,"")},proto.service.GetResponseRequest.GetResponseConfig.prototype.setSpeakerId=function(ie){K.Message.setProto3StringField(this,9,ie)},proto.service.GetResponseRequest.GetResponseConfig.prototype.getApiAuthToken=function(){return K.Message.getFieldWithDefault(this,10,"")},proto.service.GetResponseRequest.GetResponseConfig.prototype.setApiAuthToken=function(ie){K.Message.setProto3StringField(this,10,ie)},proto.service.GetResponseRequest.GetResponseConfig.prototype.getNarrativeTemplateKeysMap=function(ie){return K.Message.getMapField(this,11,ie,null)},proto.service.GetResponseRequest.GetResponseConfig.prototype.clearNarrativeTemplateKeysMap=function(){this.getNarrativeTemplateKeysMap().clear()},proto.service.GetResponseRequest.GetResponseData=function(ie){K.Message.initialize(this,ie,0,-1,null,proto.service.GetResponseRequest.GetResponseData.oneofGroups_)},te.inherits(proto.service.GetResponseRequest.GetResponseData,K.Message),te.DEBUG&&!COMPILED&&(proto.service.GetResponseRequest.GetResponseData.displayName="proto.service.GetResponseRequest.GetResponseData"),proto.service.GetResponseRequest.GetResponseData.oneofGroups_=[[1,2,3]],proto.service.GetResponseRequest.GetResponseData.InputTypeCase={INPUT_TYPE_NOT_SET:0,AUDIO_DATA:1,TEXT_DATA:2,TRIGGER_DATA:3},proto.service.GetResponseRequest.GetResponseData.prototype.getInputTypeCase=function(){return K.Message.computeOneofCase(this,proto.service.GetResponseRequest.GetResponseData.oneofGroups_[0])},K.Message.GENERATE_TO_OBJECT&&(proto.service.GetResponseRequest.GetResponseData.prototype.toObject=function(ie){return proto.service.GetResponseRequest.GetResponseData.toObject(ie,this)},proto.service.GetResponseRequest.GetResponseData.toObject=function(ie,se){var ae,ge={audioData:se.getAudioData_asB64(),textData:K.Message.getFieldWithDefault(se,2,""),triggerData:(ae=se.getTriggerData())&&proto.service.TriggerConfig.toObject(ie,ae)};return ie&&(ge.$jspbMessageInstance=se),ge}),proto.service.GetResponseRequest.GetResponseData.deserializeBinary=function(ie){var se=new K.BinaryReader(ie),ae=new proto.service.GetResponseRequest.GetResponseData;return proto.service.GetResponseRequest.GetResponseData.deserializeBinaryFromReader(ae,se)},proto.service.GetResponseRequest.GetResponseData.deserializeBinaryFromReader=function(ie,se){for(;se.nextField()&&!se.isEndGroup();)switch(se.getFieldNumber()){case 1:var ae=se.readBytes();ie.setAudioData(ae);break;case 2:ae=se.readString(),ie.setTextData(ae);break;case 3:ae=new proto.service.TriggerConfig,se.readMessage(ae,proto.service.TriggerConfig.deserializeBinaryFromReader),ie.setTriggerData(ae);break;default:se.skipField()}return ie},proto.service.GetResponseRequest.GetResponseData.prototype.serializeBinary=function(){var ie=new K.BinaryWriter;return proto.service.GetResponseRequest.GetResponseData.serializeBinaryToWriter(this,ie),ie.getResultBuffer()},proto.service.GetResponseRequest.GetResponseData.serializeBinaryToWriter=function(ie,se){var ae=void 0;(ae=K.Message.getField(ie,1))!=null&&se.writeBytes(1,ae),(ae=K.Message.getField(ie,2))!=null&&se.writeString(2,ae),(ae=ie.getTriggerData())!=null&&se.writeMessage(3,ae,proto.service.TriggerConfig.serializeBinaryToWriter)},proto.service.GetResponseRequest.GetResponseData.prototype.getAudioData=function(){return K.Message.getFieldWithDefault(this,1,"")},proto.service.GetResponseRequest.GetResponseData.prototype.getAudioData_asB64=function(){return K.Message.bytesAsB64(this.getAudioData())},proto.service.GetResponseRequest.GetResponseData.prototype.getAudioData_asU8=function(){return K.Message.bytesAsU8(this.getAudioData())},proto.service.GetResponseRequest.GetResponseData.prototype.setAudioData=function(ie){K.Message.setOneofField(this,1,proto.service.GetResponseRequest.GetResponseData.oneofGroups_[0],ie)},proto.service.GetResponseRequest.GetResponseData.prototype.clearAudioData=function(){K.Message.setOneofField(this,1,proto.service.GetResponseRequest.GetResponseData.oneofGroups_[0],void 0)},proto.service.GetResponseRequest.GetResponseData.prototype.hasAudioData=function(){return K.Message.getField(this,1)!=null},proto.service.GetResponseRequest.GetResponseData.prototype.getTextData=function(){return K.Message.getFieldWithDefault(this,2,"")},proto.service.GetResponseRequest.GetResponseData.prototype.setTextData=function(ie){K.Message.setOneofField(this,2,proto.service.GetResponseRequest.GetResponseData.oneofGroups_[0],ie)},proto.service.GetResponseRequest.GetResponseData.prototype.clearTextData=function(){K.Message.setOneofField(this,2,proto.service.GetResponseRequest.GetResponseData.oneofGroups_[0],void 0)},proto.service.GetResponseRequest.GetResponseData.prototype.hasTextData=function(){return K.Message.getField(this,2)!=null},proto.service.GetResponseRequest.GetResponseData.prototype.getTriggerData=function(){return K.Message.getWrapperField(this,proto.service.TriggerConfig,3)},proto.service.GetResponseRequest.GetResponseData.prototype.setTriggerData=function(ie){K.Message.setOneofWrapperField(this,3,proto.service.GetResponseRequest.GetResponseData.oneofGroups_[0],ie)},proto.service.GetResponseRequest.GetResponseData.prototype.clearTriggerData=function(){this.setTriggerData(void 0)},proto.service.GetResponseRequest.GetResponseData.prototype.hasTriggerData=function(){return K.Message.getField(this,3)!=null},proto.service.GetResponseRequest.prototype.getGetResponseConfig=function(){return K.Message.getWrapperField(this,proto.service.GetResponseRequest.GetResponseConfig,1)},proto.service.GetResponseRequest.prototype.setGetResponseConfig=function(ie){K.Message.setOneofWrapperField(this,1,proto.service.GetResponseRequest.oneofGroups_[0],ie)},proto.service.GetResponseRequest.prototype.clearGetResponseConfig=function(){this.setGetResponseConfig(void 0)},proto.service.GetResponseRequest.prototype.hasGetResponseConfig=function(){return K.Message.getField(this,1)!=null},proto.service.GetResponseRequest.prototype.getGetResponseData=function(){return K.Message.getWrapperField(this,proto.service.GetResponseRequest.GetResponseData,2)},proto.service.GetResponseRequest.prototype.setGetResponseData=function(ie){K.Message.setOneofWrapperField(this,2,proto.service.GetResponseRequest.oneofGroups_[0],ie)},proto.service.GetResponseRequest.prototype.clearGetResponseData=function(){this.setGetResponseData(void 0)},proto.service.GetResponseRequest.prototype.hasGetResponseData=function(){return K.Message.getField(this,2)!=null},proto.service.GetResponseRequestSingle=function(ie){K.Message.initialize(this,ie,0,-1,null,null)},te.inherits(proto.service.GetResponseRequestSingle,K.Message),te.DEBUG&&!COMPILED&&(proto.service.GetResponseRequestSingle.displayName="proto.service.GetResponseRequestSingle"),K.Message.GENERATE_TO_OBJECT&&(proto.service.GetResponseRequestSingle.prototype.toObject=function(ie){return proto.service.GetResponseRequestSingle.toObject(ie,this)},proto.service.GetResponseRequestSingle.toObject=function(ie,se){var ae,ge={responseConfig:(ae=se.getResponseConfig())&&proto.service.GetResponseRequest.toObject(ie,ae),responseData:(ae=se.getResponseData())&&proto.service.GetResponseRequest.toObject(ie,ae)};return ie&&(ge.$jspbMessageInstance=se),ge}),proto.service.GetResponseRequestSingle.deserializeBinary=function(ie){var se=new K.BinaryReader(ie),ae=new proto.service.GetResponseRequestSingle;return proto.service.GetResponseRequestSingle.deserializeBinaryFromReader(ae,se)},proto.service.GetResponseRequestSingle.deserializeBinaryFromReader=function(ie,se){for(;se.nextField()&&!se.isEndGroup();)switch(se.getFieldNumber()){case 1:var ae=new proto.service.GetResponseRequest;se.readMessage(ae,proto.service.GetResponseRequest.deserializeBinaryFromReader),ie.setResponseConfig(ae);break;case 2:ae=new proto.service.GetResponseRequest,se.readMessage(ae,proto.service.GetResponseRequest.deserializeBinaryFromReader),ie.setResponseData(ae);break;default:se.skipField()}return ie},proto.service.GetResponseRequestSingle.prototype.serializeBinary=function(){var ie=new K.BinaryWriter;return proto.service.GetResponseRequestSingle.serializeBinaryToWriter(this,ie),ie.getResultBuffer()},proto.service.GetResponseRequestSingle.serializeBinaryToWriter=function(ie,se){var ae=void 0;(ae=ie.getResponseConfig())!=null&&se.writeMessage(1,ae,proto.service.GetResponseRequest.serializeBinaryToWriter),(ae=ie.getResponseData())!=null&&se.writeMessage(2,ae,proto.service.GetResponseRequest.serializeBinaryToWriter)},proto.service.GetResponseRequestSingle.prototype.getResponseConfig=function(){return K.Message.getWrapperField(this,proto.service.GetResponseRequest,1)},proto.service.GetResponseRequestSingle.prototype.setResponseConfig=function(ie){K.Message.setWrapperField(this,1,ie)},proto.service.GetResponseRequestSingle.prototype.clearResponseConfig=function(){this.setResponseConfig(void 0)},proto.service.GetResponseRequestSingle.prototype.hasResponseConfig=function(){return K.Message.getField(this,1)!=null},proto.service.GetResponseRequestSingle.prototype.getResponseData=function(){return K.Message.getWrapperField(this,proto.service.GetResponseRequest,2)},proto.service.GetResponseRequestSingle.prototype.setResponseData=function(ie){K.Message.setWrapperField(this,2,ie)},proto.service.GetResponseRequestSingle.prototype.clearResponseData=function(){this.setResponseData(void 0)},proto.service.GetResponseRequestSingle.prototype.hasResponseData=function(){return K.Message.getField(this,2)!=null},proto.service.GetResponseResponse=function(ie){K.Message.initialize(this,ie,0,-1,null,proto.service.GetResponseResponse.oneofGroups_)},te.inherits(proto.service.GetResponseResponse,K.Message),te.DEBUG&&!COMPILED&&(proto.service.GetResponseResponse.displayName="proto.service.GetResponseResponse"),proto.service.GetResponseResponse.oneofGroups_=[[2,3,4,5,6,7,8]],proto.service.GetResponseResponse.ResponseTypeCase={RESPONSE_TYPE_NOT_SET:0,ACTION_RESPONSE:2,AUDIO_RESPONSE:3,DEBUG_LOG:4,USER_QUERY:5,BT_RESPONSE:6,EMOTION_RESPONSE:7,INTERACTION_ID:8},proto.service.GetResponseResponse.prototype.getResponseTypeCase=function(){return K.Message.computeOneofCase(this,proto.service.GetResponseResponse.oneofGroups_[0])},K.Message.GENERATE_TO_OBJECT&&(proto.service.GetResponseResponse.prototype.toObject=function(ie){return proto.service.GetResponseResponse.toObject(ie,this)},proto.service.GetResponseResponse.toObject=function(ie,se){var ae,ge={sessionId:K.Message.getFieldWithDefault(se,1,""),actionResponse:(ae=se.getActionResponse())&&proto.service.GetResponseResponse.ActionResponse.toObject(ie,ae),audioResponse:(ae=se.getAudioResponse())&&proto.service.GetResponseResponse.AudioResponse.toObject(ie,ae),debugLog:K.Message.getFieldWithDefault(se,4,""),userQuery:(ae=se.getUserQuery())&&proto.service.GetResponseResponse.UserTranscript.toObject(ie,ae),btResponse:(ae=se.getBtResponse())&&proto.service.GetResponseResponse.BehaviorTreeResponse.toObject(ie,ae),emotionResponse:K.Message.getFieldWithDefault(se,7,""),interactionId:K.Message.getFieldWithDefault(se,8,"")};return ie&&(ge.$jspbMessageInstance=se),ge}),proto.service.GetResponseResponse.deserializeBinary=function(ie){var se=new K.BinaryReader(ie),ae=new proto.service.GetResponseResponse;return proto.service.GetResponseResponse.deserializeBinaryFromReader(ae,se)},proto.service.GetResponseResponse.deserializeBinaryFromReader=function(ie,se){for(;se.nextField()&&!se.isEndGroup();)switch(se.getFieldNumber()){case 1:var ae=se.readString();ie.setSessionId(ae);break;case 2:ae=new proto.service.GetResponseResponse.ActionResponse,se.readMessage(ae,proto.service.GetResponseResponse.ActionResponse.deserializeBinaryFromReader),ie.setActionResponse(ae);break;case 3:ae=new proto.service.GetResponseResponse.AudioResponse,se.readMessage(ae,proto.service.GetResponseResponse.AudioResponse.deserializeBinaryFromReader),ie.setAudioResponse(ae);break;case 4:ae=se.readString(),ie.setDebugLog(ae);break;case 5:ae=new proto.service.GetResponseResponse.UserTranscript,se.readMessage(ae,proto.service.GetResponseResponse.UserTranscript.deserializeBinaryFromReader),ie.setUserQuery(ae);break;case 6:ae=new proto.service.GetResponseResponse.BehaviorTreeResponse,se.readMessage(ae,proto.service.GetResponseResponse.BehaviorTreeResponse.deserializeBinaryFromReader),ie.setBtResponse(ae);break;case 7:ae=se.readString(),ie.setEmotionResponse(ae);break;case 8:ae=se.readString(),ie.setInteractionId(ae);break;default:se.skipField()}return ie},proto.service.GetResponseResponse.prototype.serializeBinary=function(){var ie=new K.BinaryWriter;return proto.service.GetResponseResponse.serializeBinaryToWriter(this,ie),ie.getResultBuffer()},proto.service.GetResponseResponse.serializeBinaryToWriter=function(ie,se){var ae=void 0;(ae=ie.getSessionId()).length>0&&se.writeString(1,ae),(ae=ie.getActionResponse())!=null&&se.writeMessage(2,ae,proto.service.GetResponseResponse.ActionResponse.serializeBinaryToWriter),(ae=ie.getAudioResponse())!=null&&se.writeMessage(3,ae,proto.service.GetResponseResponse.AudioResponse.serializeBinaryToWriter),(ae=K.Message.getField(ie,4))!=null&&se.writeString(4,ae),(ae=ie.getUserQuery())!=null&&se.writeMessage(5,ae,proto.service.GetResponseResponse.UserTranscript.serializeBinaryToWriter),(ae=ie.getBtResponse())!=null&&se.writeMessage(6,ae,proto.service.GetResponseResponse.BehaviorTreeResponse.serializeBinaryToWriter),(ae=K.Message.getField(ie,7))!=null&&se.writeString(7,ae),(ae=K.Message.getField(ie,8))!=null&&se.writeString(8,ae)},proto.service.GetResponseResponse.AudioResponse=function(ie){K.Message.initialize(this,ie,0,-1,null,proto.service.GetResponseResponse.AudioResponse.oneofGroups_)},te.inherits(proto.service.GetResponseResponse.AudioResponse,K.Message),te.DEBUG&&!COMPILED&&(proto.service.GetResponseResponse.AudioResponse.displayName="proto.service.GetResponseResponse.AudioResponse"),proto.service.GetResponseResponse.AudioResponse.oneofGroups_=[[6,7]],proto.service.GetResponseResponse.AudioResponse.FaceDataTypeCase={FACE_DATA_TYPE_NOT_SET:0,VISEMES_DATA:6,BLENDSHAPES_DATA:7},proto.service.GetResponseResponse.AudioResponse.prototype.getFaceDataTypeCase=function(){return K.Message.computeOneofCase(this,proto.service.GetResponseResponse.AudioResponse.oneofGroups_[0])},K.Message.GENERATE_TO_OBJECT&&(proto.service.GetResponseResponse.AudioResponse.prototype.toObject=function(ie){return proto.service.GetResponseResponse.AudioResponse.toObject(ie,this)},proto.service.GetResponseResponse.AudioResponse.toObject=function(ie,se){var ae,ge={audioData:se.getAudioData_asB64(),audioConfig:(ae=se.getAudioConfig())&&proto.service.AudioConfig.toObject(ie,ae),textData:K.Message.getFieldWithDefault(se,3,""),endOfResponse:K.Message.getFieldWithDefault(se,4,!1),faceData:K.Message.getFieldWithDefault(se,5,""),visemesData:(ae=se.getVisemesData())&&proto.service.VisemesData.toObject(ie,ae),blendshapesData:(ae=se.getBlendshapesData())&&proto.service.BlendShapesData.toObject(ie,ae),faceEmotion:(ae=se.getFaceEmotion())&&oe.ARKitBlendShapesData.toObject(ie,ae),emotionResponse:(ae=se.getEmotionResponse())&&proto.service.EmotionResponse.toObject(ie,ae)};return ie&&(ge.$jspbMessageInstance=se),ge}),proto.service.GetResponseResponse.AudioResponse.deserializeBinary=function(ie){var se=new K.BinaryReader(ie),ae=new proto.service.GetResponseResponse.AudioResponse;return proto.service.GetResponseResponse.AudioResponse.deserializeBinaryFromReader(ae,se)},proto.service.GetResponseResponse.AudioResponse.deserializeBinaryFromReader=function(ie,se){for(;se.nextField()&&!se.isEndGroup();)switch(se.getFieldNumber()){case 1:var ae=se.readBytes();ie.setAudioData(ae);break;case 2:ae=new proto.service.AudioConfig,se.readMessage(ae,proto.service.AudioConfig.deserializeBinaryFromReader),ie.setAudioConfig(ae);break;case 3:ae=se.readString(),ie.setTextData(ae);break;case 4:ae=se.readBool(),ie.setEndOfResponse(ae);break;case 5:ae=se.readString(),ie.setFaceData(ae);break;case 6:ae=new proto.service.VisemesData,se.readMessage(ae,proto.service.VisemesData.deserializeBinaryFromReader),ie.setVisemesData(ae);break;case 7:ae=new proto.service.BlendShapesData,se.readMessage(ae,proto.service.BlendShapesData.deserializeBinaryFromReader),ie.setBlendshapesData(ae);break;case 8:ae=new oe.ARKitBlendShapesData,se.readMessage(ae,oe.ARKitBlendShapesData.deserializeBinaryFromReader),ie.setFaceEmotion(ae);break;case 9:ae=new proto.service.EmotionResponse,se.readMessage(ae,proto.service.EmotionResponse.deserializeBinaryFromReader),ie.setEmotionResponse(ae);break;default:se.skipField()}return ie},proto.service.GetResponseResponse.AudioResponse.prototype.serializeBinary=function(){var ie=new K.BinaryWriter;return proto.service.GetResponseResponse.AudioResponse.serializeBinaryToWriter(this,ie),ie.getResultBuffer()},proto.service.GetResponseResponse.AudioResponse.serializeBinaryToWriter=function(ie,se){var ae=void 0;(ae=ie.getAudioData_asU8()).length>0&&se.writeBytes(1,ae),(ae=ie.getAudioConfig())!=null&&se.writeMessage(2,ae,proto.service.AudioConfig.serializeBinaryToWriter),(ae=ie.getTextData()).length>0&&se.writeString(3,ae),(ae=ie.getEndOfResponse())&&se.writeBool(4,ae),(ae=ie.getFaceData()).length>0&&se.writeString(5,ae),(ae=ie.getVisemesData())!=null&&se.writeMessage(6,ae,proto.service.VisemesData.serializeBinaryToWriter),(ae=ie.getBlendshapesData())!=null&&se.writeMessage(7,ae,proto.service.BlendShapesData.serializeBinaryToWriter),(ae=ie.getFaceEmotion())!=null&&se.writeMessage(8,ae,oe.ARKitBlendShapesData.serializeBinaryToWriter),(ae=ie.getEmotionResponse())!=null&&se.writeMessage(9,ae,proto.service.EmotionResponse.serializeBinaryToWriter)},proto.service.GetResponseResponse.AudioResponse.prototype.getAudioData=function(){return K.Message.getFieldWithDefault(this,1,"")},proto.service.GetResponseResponse.AudioResponse.prototype.getAudioData_asB64=function(){return K.Message.bytesAsB64(this.getAudioData())},proto.service.GetResponseResponse.AudioResponse.prototype.getAudioData_asU8=function(){return K.Message.bytesAsU8(this.getAudioData())},proto.service.GetResponseResponse.AudioResponse.prototype.setAudioData=function(ie){K.Message.setProto3BytesField(this,1,ie)},proto.service.GetResponseResponse.AudioResponse.prototype.getAudioConfig=function(){return K.Message.getWrapperField(this,proto.service.AudioConfig,2)},proto.service.GetResponseResponse.AudioResponse.prototype.setAudioConfig=function(ie){K.Message.setWrapperField(this,2,ie)},proto.service.GetResponseResponse.AudioResponse.prototype.clearAudioConfig=function(){this.setAudioConfig(void 0)},proto.service.GetResponseResponse.AudioResponse.prototype.hasAudioConfig=function(){return K.Message.getField(this,2)!=null},proto.service.GetResponseResponse.AudioResponse.prototype.getTextData=function(){return K.Message.getFieldWithDefault(this,3,"")},proto.service.GetResponseResponse.AudioResponse.prototype.setTextData=function(ie){K.Message.setProto3StringField(this,3,ie)},proto.service.GetResponseResponse.AudioResponse.prototype.getEndOfResponse=function(){return K.Message.getFieldWithDefault(this,4,!1)},proto.service.GetResponseResponse.AudioResponse.prototype.setEndOfResponse=function(ie){K.Message.setProto3BooleanField(this,4,ie)},proto.service.GetResponseResponse.AudioResponse.prototype.getFaceData=function(){return K.Message.getFieldWithDefault(this,5,"")},proto.service.GetResponseResponse.AudioResponse.prototype.setFaceData=function(ie){K.Message.setProto3StringField(this,5,ie)},proto.service.GetResponseResponse.AudioResponse.prototype.getVisemesData=function(){return K.Message.getWrapperField(this,proto.service.VisemesData,6)},proto.service.GetResponseResponse.AudioResponse.prototype.setVisemesData=function(ie){K.Message.setOneofWrapperField(this,6,proto.service.GetResponseResponse.AudioResponse.oneofGroups_[0],ie)},proto.service.GetResponseResponse.AudioResponse.prototype.clearVisemesData=function(){this.setVisemesData(void 0)},proto.service.GetResponseResponse.AudioResponse.prototype.hasVisemesData=function(){return K.Message.getField(this,6)!=null},proto.service.GetResponseResponse.AudioResponse.prototype.getBlendshapesData=function(){return K.Message.getWrapperField(this,proto.service.BlendShapesData,7)},proto.service.GetResponseResponse.AudioResponse.prototype.setBlendshapesData=function(ie){K.Message.setOneofWrapperField(this,7,proto.service.GetResponseResponse.AudioResponse.oneofGroups_[0],ie)},proto.service.GetResponseResponse.AudioResponse.prototype.clearBlendshapesData=function(){this.setBlendshapesData(void 0)},proto.service.GetResponseResponse.AudioResponse.prototype.hasBlendshapesData=function(){return K.Message.getField(this,7)!=null},proto.service.GetResponseResponse.AudioResponse.prototype.getFaceEmotion=function(){return K.Message.getWrapperField(this,oe.ARKitBlendShapesData,8)},proto.service.GetResponseResponse.AudioResponse.prototype.setFaceEmotion=function(ie){K.Message.setWrapperField(this,8,ie)},proto.service.GetResponseResponse.AudioResponse.prototype.clearFaceEmotion=function(){this.setFaceEmotion(void 0)},proto.service.GetResponseResponse.AudioResponse.prototype.hasFaceEmotion=function(){return K.Message.getField(this,8)!=null},proto.service.GetResponseResponse.AudioResponse.prototype.getEmotionResponse=function(){return K.Message.getWrapperField(this,proto.service.EmotionResponse,9)},proto.service.GetResponseResponse.AudioResponse.prototype.setEmotionResponse=function(ie){K.Message.setWrapperField(this,9,ie)},proto.service.GetResponseResponse.AudioResponse.prototype.clearEmotionResponse=function(){this.setEmotionResponse(void 0)},proto.service.GetResponseResponse.AudioResponse.prototype.hasEmotionResponse=function(){return K.Message.getField(this,9)!=null},proto.service.GetResponseResponse.ActionResponse=function(ie){K.Message.initialize(this,ie,0,-1,null,null)},te.inherits(proto.service.GetResponseResponse.ActionResponse,K.Message),te.DEBUG&&!COMPILED&&(proto.service.GetResponseResponse.ActionResponse.displayName="proto.service.GetResponseResponse.ActionResponse"),K.Message.GENERATE_TO_OBJECT&&(proto.service.GetResponseResponse.ActionResponse.prototype.toObject=function(ie){return proto.service.GetResponseResponse.ActionResponse.toObject(ie,this)},proto.service.GetResponseResponse.ActionResponse.toObject=function(ie,se){var ae={action:K.Message.getFieldWithDefault(se,1,"")};return ie&&(ae.$jspbMessageInstance=se),ae}),proto.service.GetResponseResponse.ActionResponse.deserializeBinary=function(ie){var se=new K.BinaryReader(ie),ae=new proto.service.GetResponseResponse.ActionResponse;return proto.service.GetResponseResponse.ActionResponse.deserializeBinaryFromReader(ae,se)},proto.service.GetResponseResponse.ActionResponse.deserializeBinaryFromReader=function(ie,se){for(;se.nextField()&&!se.isEndGroup();)if(se.getFieldNumber()===1){var ae=se.readString();ie.setAction(ae)}else se.skipField();return ie},proto.service.GetResponseResponse.ActionResponse.prototype.serializeBinary=function(){var ie=new K.BinaryWriter;return proto.service.GetResponseResponse.ActionResponse.serializeBinaryToWriter(this,ie),ie.getResultBuffer()},proto.service.GetResponseResponse.ActionResponse.serializeBinaryToWriter=function(ie,se){var ae;(ae=ie.getAction()).length>0&&se.writeString(1,ae)},proto.service.GetResponseResponse.ActionResponse.prototype.getAction=function(){return K.Message.getFieldWithDefault(this,1,"")},proto.service.GetResponseResponse.ActionResponse.prototype.setAction=function(ie){K.Message.setProto3StringField(this,1,ie)},proto.service.GetResponseResponse.BehaviorTreeResponse=function(ie){K.Message.initialize(this,ie,0,-1,null,null)},te.inherits(proto.service.GetResponseResponse.BehaviorTreeResponse,K.Message),te.DEBUG&&!COMPILED&&(proto.service.GetResponseResponse.BehaviorTreeResponse.displayName="proto.service.GetResponseResponse.BehaviorTreeResponse"),K.Message.GENERATE_TO_OBJECT&&(proto.service.GetResponseResponse.BehaviorTreeResponse.prototype.toObject=function(ie){return proto.service.GetResponseResponse.BehaviorTreeResponse.toObject(ie,this)},proto.service.GetResponseResponse.BehaviorTreeResponse.toObject=function(ie,se){var ae={btCode:K.Message.getFieldWithDefault(se,1,""),btConstants:K.Message.getFieldWithDefault(se,2,""),narrativeSectionId:K.Message.getFieldWithDefault(se,3,"")};return ie&&(ae.$jspbMessageInstance=se),ae}),proto.service.GetResponseResponse.BehaviorTreeResponse.deserializeBinary=function(ie){var se=new K.BinaryReader(ie),ae=new proto.service.GetResponseResponse.BehaviorTreeResponse;return proto.service.GetResponseResponse.BehaviorTreeResponse.deserializeBinaryFromReader(ae,se)},proto.service.GetResponseResponse.BehaviorTreeResponse.deserializeBinaryFromReader=function(ie,se){for(;se.nextField()&&!se.isEndGroup();)switch(se.getFieldNumber()){case 1:var ae=se.readString();ie.setBtCode(ae);break;case 2:ae=se.readString(),ie.setBtConstants(ae);break;case 3:ae=se.readString(),ie.setNarrativeSectionId(ae);break;default:se.skipField()}return ie},proto.service.GetResponseResponse.BehaviorTreeResponse.prototype.serializeBinary=function(){var ie=new K.BinaryWriter;return proto.service.GetResponseResponse.BehaviorTreeResponse.serializeBinaryToWriter(this,ie),ie.getResultBuffer()},proto.service.GetResponseResponse.BehaviorTreeResponse.serializeBinaryToWriter=function(ie,se){var ae=void 0;(ae=ie.getBtCode()).length>0&&se.writeString(1,ae),(ae=ie.getBtConstants()).length>0&&se.writeString(2,ae),(ae=ie.getNarrativeSectionId()).length>0&&se.writeString(3,ae)},proto.service.GetResponseResponse.BehaviorTreeResponse.prototype.getBtCode=function(){return K.Message.getFieldWithDefault(this,1,"")},proto.service.GetResponseResponse.BehaviorTreeResponse.prototype.setBtCode=function(ie){K.Message.setProto3StringField(this,1,ie)},proto.service.GetResponseResponse.BehaviorTreeResponse.prototype.getBtConstants=function(){return K.Message.getFieldWithDefault(this,2,"")},proto.service.GetResponseResponse.BehaviorTreeResponse.prototype.setBtConstants=function(ie){K.Message.setProto3StringField(this,2,ie)},proto.service.GetResponseResponse.BehaviorTreeResponse.prototype.getNarrativeSectionId=function(){return K.Message.getFieldWithDefault(this,3,"")},proto.service.GetResponseResponse.BehaviorTreeResponse.prototype.setNarrativeSectionId=function(ie){K.Message.setProto3StringField(this,3,ie)},proto.service.GetResponseResponse.UserTranscript=function(ie){K.Message.initialize(this,ie,0,-1,null,null)},te.inherits(proto.service.GetResponseResponse.UserTranscript,K.Message),te.DEBUG&&!COMPILED&&(proto.service.GetResponseResponse.UserTranscript.displayName="proto.service.GetResponseResponse.UserTranscript"),K.Message.GENERATE_TO_OBJECT&&(proto.service.GetResponseResponse.UserTranscript.prototype.toObject=function(ie){return proto.service.GetResponseResponse.UserTranscript.toObject(ie,this)},proto.service.GetResponseResponse.UserTranscript.toObject=function(ie,se){var ae={textData:K.Message.getFieldWithDefault(se,1,""),isFinal:K.Message.getFieldWithDefault(se,2,!1),endOfResponse:K.Message.getFieldWithDefault(se,3,!1)};return ie&&(ae.$jspbMessageInstance=se),ae}),proto.service.GetResponseResponse.UserTranscript.deserializeBinary=function(ie){var se=new K.BinaryReader(ie),ae=new proto.service.GetResponseResponse.UserTranscript;return proto.service.GetResponseResponse.UserTranscript.deserializeBinaryFromReader(ae,se)},proto.service.GetResponseResponse.UserTranscript.deserializeBinaryFromReader=function(ie,se){for(;se.nextField()&&!se.isEndGroup();)switch(se.getFieldNumber()){case 1:var ae=se.readString();ie.setTextData(ae);break;case 2:ae=se.readBool(),ie.setIsFinal(ae);break;case 3:ae=se.readBool(),ie.setEndOfResponse(ae);break;default:se.skipField()}return ie},proto.service.GetResponseResponse.UserTranscript.prototype.serializeBinary=function(){var ie=new K.BinaryWriter;return proto.service.GetResponseResponse.UserTranscript.serializeBinaryToWriter(this,ie),ie.getResultBuffer()},proto.service.GetResponseResponse.UserTranscript.serializeBinaryToWriter=function(ie,se){var ae=void 0;(ae=ie.getTextData()).length>0&&se.writeString(1,ae),(ae=ie.getIsFinal())&&se.writeBool(2,ae),(ae=ie.getEndOfResponse())&&se.writeBool(3,ae)},proto.service.GetResponseResponse.UserTranscript.prototype.getTextData=function(){return K.Message.getFieldWithDefault(this,1,"")},proto.service.GetResponseResponse.UserTranscript.prototype.setTextData=function(ie){K.Message.setProto3StringField(this,1,ie)},proto.service.GetResponseResponse.UserTranscript.prototype.getIsFinal=function(){return K.Message.getFieldWithDefault(this,2,!1)},proto.service.GetResponseResponse.UserTranscript.prototype.setIsFinal=function(ie){K.Message.setProto3BooleanField(this,2,ie)},proto.service.GetResponseResponse.UserTranscript.prototype.getEndOfResponse=function(){return K.Message.getFieldWithDefault(this,3,!1)},proto.service.GetResponseResponse.UserTranscript.prototype.setEndOfResponse=function(ie){K.Message.setProto3BooleanField(this,3,ie)},proto.service.GetResponseResponse.prototype.getSessionId=function(){return K.Message.getFieldWithDefault(this,1,"")},proto.service.GetResponseResponse.prototype.setSessionId=function(ie){K.Message.setProto3StringField(this,1,ie)},proto.service.GetResponseResponse.prototype.getActionResponse=function(){return K.Message.getWrapperField(this,proto.service.GetResponseResponse.ActionResponse,2)},proto.service.GetResponseResponse.prototype.setActionResponse=function(ie){K.Message.setOneofWrapperField(this,2,proto.service.GetResponseResponse.oneofGroups_[0],ie)},proto.service.GetResponseResponse.prototype.clearActionResponse=function(){this.setActionResponse(void 0)},proto.service.GetResponseResponse.prototype.hasActionResponse=function(){return K.Message.getField(this,2)!=null},proto.service.GetResponseResponse.prototype.getAudioResponse=function(){return K.Message.getWrapperField(this,proto.service.GetResponseResponse.AudioResponse,3)},proto.service.GetResponseResponse.prototype.setAudioResponse=function(ie){K.Message.setOneofWrapperField(this,3,proto.service.GetResponseResponse.oneofGroups_[0],ie)},proto.service.GetResponseResponse.prototype.clearAudioResponse=function(){this.setAudioResponse(void 0)},proto.service.GetResponseResponse.prototype.hasAudioResponse=function(){return K.Message.getField(this,3)!=null},proto.service.GetResponseResponse.prototype.getDebugLog=function(){return K.Message.getFieldWithDefault(this,4,"")},proto.service.GetResponseResponse.prototype.setDebugLog=function(ie){K.Message.setOneofField(this,4,proto.service.GetResponseResponse.oneofGroups_[0],ie)},proto.service.GetResponseResponse.prototype.clearDebugLog=function(){K.Message.setOneofField(this,4,proto.service.GetResponseResponse.oneofGroups_[0],void 0)},proto.service.GetResponseResponse.prototype.hasDebugLog=function(){return K.Message.getField(this,4)!=null},proto.service.GetResponseResponse.prototype.getUserQuery=function(){return K.Message.getWrapperField(this,proto.service.GetResponseResponse.UserTranscript,5)},proto.service.GetResponseResponse.prototype.setUserQuery=function(ie){K.Message.setOneofWrapperField(this,5,proto.service.GetResponseResponse.oneofGroups_[0],ie)},proto.service.GetResponseResponse.prototype.clearUserQuery=function(){this.setUserQuery(void 0)},proto.service.GetResponseResponse.prototype.hasUserQuery=function(){return K.Message.getField(this,5)!=null},proto.service.GetResponseResponse.prototype.getBtResponse=function(){return K.Message.getWrapperField(this,proto.service.GetResponseResponse.BehaviorTreeResponse,6)},proto.service.GetResponseResponse.prototype.setBtResponse=function(ie){K.Message.setOneofWrapperField(this,6,proto.service.GetResponseResponse.oneofGroups_[0],ie)},proto.service.GetResponseResponse.prototype.clearBtResponse=function(){this.setBtResponse(void 0)},proto.service.GetResponseResponse.prototype.hasBtResponse=function(){return K.Message.getField(this,6)!=null},proto.service.GetResponseResponse.prototype.getEmotionResponse=function(){return K.Message.getFieldWithDefault(this,7,"")},proto.service.GetResponseResponse.prototype.setEmotionResponse=function(ie){K.Message.setOneofField(this,7,proto.service.GetResponseResponse.oneofGroups_[0],ie)},proto.service.GetResponseResponse.prototype.clearEmotionResponse=function(){K.Message.setOneofField(this,7,proto.service.GetResponseResponse.oneofGroups_[0],void 0)},proto.service.GetResponseResponse.prototype.hasEmotionResponse=function(){return K.Message.getField(this,7)!=null},proto.service.GetResponseResponse.prototype.getInteractionId=function(){return K.Message.getFieldWithDefault(this,8,"")},proto.service.GetResponseResponse.prototype.setInteractionId=function(ie){K.Message.setOneofField(this,8,proto.service.GetResponseResponse.oneofGroups_[0],ie)},proto.service.GetResponseResponse.prototype.clearInteractionId=function(){K.Message.setOneofField(this,8,proto.service.GetResponseResponse.oneofGroups_[0],void 0)},proto.service.GetResponseResponse.prototype.hasInteractionId=function(){return K.Message.getField(this,8)!=null},proto.service.VisemesData=function(ie){K.Message.initialize(this,ie,0,-1,null,null)},te.inherits(proto.service.VisemesData,K.Message),te.DEBUG&&!COMPILED&&(proto.service.VisemesData.displayName="proto.service.VisemesData"),K.Message.GENERATE_TO_OBJECT&&(proto.service.VisemesData.prototype.toObject=function(ie){return proto.service.VisemesData.toObject(ie,this)},proto.service.VisemesData.toObject=function(ie,se){var ae,ge={visemes:(ae=se.getVisemes())&&proto.service.Viseme.toObject(ie,ae)};return ie&&(ge.$jspbMessageInstance=se),ge}),proto.service.VisemesData.deserializeBinary=function(ie){var se=new K.BinaryReader(ie),ae=new proto.service.VisemesData;return proto.service.VisemesData.deserializeBinaryFromReader(ae,se)},proto.service.VisemesData.deserializeBinaryFromReader=function(ie,se){for(;se.nextField()&&!se.isEndGroup();)if(se.getFieldNumber()===1){var ae=new proto.service.Viseme;se.readMessage(ae,proto.service.Viseme.deserializeBinaryFromReader),ie.setVisemes(ae)}else se.skipField();return ie},proto.service.VisemesData.prototype.serializeBinary=function(){var ie=new K.BinaryWriter;return proto.service.VisemesData.serializeBinaryToWriter(this,ie),ie.getResultBuffer()},proto.service.VisemesData.serializeBinaryToWriter=function(ie,se){var ae;(ae=ie.getVisemes())!=null&&se.writeMessage(1,ae,proto.service.Viseme.serializeBinaryToWriter)},proto.service.VisemesData.prototype.getVisemes=function(){return K.Message.getWrapperField(this,proto.service.Viseme,1)},proto.service.VisemesData.prototype.setVisemes=function(ie){K.Message.setWrapperField(this,1,ie)},proto.service.VisemesData.prototype.clearVisemes=function(){this.setVisemes(void 0)},proto.service.VisemesData.prototype.hasVisemes=function(){return K.Message.getField(this,1)!=null},proto.service.EmotionResponse=function(ie){K.Message.initialize(this,ie,0,-1,null,null)},te.inherits(proto.service.EmotionResponse,K.Message),te.DEBUG&&!COMPILED&&(proto.service.EmotionResponse.displayName="proto.service.EmotionResponse"),K.Message.GENERATE_TO_OBJECT&&(proto.service.EmotionResponse.prototype.toObject=function(ie){return proto.service.EmotionResponse.toObject(ie,this)},proto.service.EmotionResponse.toObject=function(ie,se){var ae={emotion:K.Message.getFieldWithDefault(se,1,""),scale:K.Message.getFieldWithDefault(se,2,"")};return ie&&(ae.$jspbMessageInstance=se),ae}),proto.service.EmotionResponse.deserializeBinary=function(ie){var se=new K.BinaryReader(ie),ae=new proto.service.EmotionResponse;return proto.service.EmotionResponse.deserializeBinaryFromReader(ae,se)},proto.service.EmotionResponse.deserializeBinaryFromReader=function(ie,se){for(;se.nextField()&&!se.isEndGroup();)switch(se.getFieldNumber()){case 1:var ae=se.readString();ie.setEmotion(ae);break;case 2:ae=se.readString(),ie.setScale(ae);break;default:se.skipField()}return ie},proto.service.EmotionResponse.prototype.serializeBinary=function(){var ie=new K.BinaryWriter;return proto.service.EmotionResponse.serializeBinaryToWriter(this,ie),ie.getResultBuffer()},proto.service.EmotionResponse.serializeBinaryToWriter=function(ie,se){var ae=void 0;(ae=ie.getEmotion()).length>0&&se.writeString(1,ae),(ae=ie.getScale()).length>0&&se.writeString(2,ae)},proto.service.EmotionResponse.prototype.getEmotion=function(){return K.Message.getFieldWithDefault(this,1,"")},proto.service.EmotionResponse.prototype.setEmotion=function(ie){K.Message.setProto3StringField(this,1,ie)},proto.service.EmotionResponse.prototype.getScale=function(){return K.Message.getFieldWithDefault(this,2,"")},proto.service.EmotionResponse.prototype.setScale=function(ie){K.Message.setProto3StringField(this,2,ie)},proto.service.Viseme=function(ie){K.Message.initialize(this,ie,0,-1,null,null)},te.inherits(proto.service.Viseme,K.Message),te.DEBUG&&!COMPILED&&(proto.service.Viseme.displayName="proto.service.Viseme"),K.Message.GENERATE_TO_OBJECT&&(proto.service.Viseme.prototype.toObject=function(ie){return proto.service.Viseme.toObject(ie,this)},proto.service.Viseme.toObject=function(ie,se){var ae={sil:+K.Message.getFieldWithDefault(se,1,0),pp:+K.Message.getFieldWithDefault(se,2,0),ff:+K.Message.getFieldWithDefault(se,3,0),th:+K.Message.getFieldWithDefault(se,4,0),dd:+K.Message.getFieldWithDefault(se,5,0),kk:+K.Message.getFieldWithDefault(se,6,0),ch:+K.Message.getFieldWithDefault(se,7,0),ss:+K.Message.getFieldWithDefault(se,8,0),nn:+K.Message.getFieldWithDefault(se,9,0),rr:+K.Message.getFieldWithDefault(se,10,0),aa:+K.Message.getFieldWithDefault(se,11,0),e:+K.Message.getFieldWithDefault(se,12,0),ih:+K.Message.getFieldWithDefault(se,13,0),oh:+K.Message.getFieldWithDefault(se,14,0),ou:+K.Message.getFieldWithDefault(se,15,0)};return ie&&(ae.$jspbMessageInstance=se),ae}),proto.service.Viseme.deserializeBinary=function(ie){var se=new K.BinaryReader(ie),ae=new proto.service.Viseme;return proto.service.Viseme.deserializeBinaryFromReader(ae,se)},proto.service.Viseme.deserializeBinaryFromReader=function(ie,se){for(;se.nextField()&&!se.isEndGroup();)switch(se.getFieldNumber()){case 1:var ae=se.readFloat();ie.setSil(ae);break;case 2:ae=se.readFloat(),ie.setPp(ae);break;case 3:ae=se.readFloat(),ie.setFf(ae);break;case 4:ae=se.readFloat(),ie.setTh(ae);break;case 5:ae=se.readFloat(),ie.setDd(ae);break;case 6:ae=se.readFloat(),ie.setKk(ae);break;case 7:ae=se.readFloat(),ie.setCh(ae);break;case 8:ae=se.readFloat(),ie.setSs(ae);break;case 9:ae=se.readFloat(),ie.setNn(ae);break;case 10:ae=se.readFloat(),ie.setRr(ae);break;case 11:ae=se.readFloat(),ie.setAa(ae);break;case 12:ae=se.readFloat(),ie.setE(ae);break;case 13:ae=se.readFloat(),ie.setIh(ae);break;case 14:ae=se.readFloat(),ie.setOh(ae);break;case 15:ae=se.readFloat(),ie.setOu(ae);break;default:se.skipField()}return ie},proto.service.Viseme.prototype.serializeBinary=function(){var ie=new K.BinaryWriter;return proto.service.Viseme.serializeBinaryToWriter(this,ie),ie.getResultBuffer()},proto.service.Viseme.serializeBinaryToWriter=function(ie,se){var ae=void 0;(ae=ie.getSil())!==0&&se.writeFloat(1,ae),(ae=ie.getPp())!==0&&se.writeFloat(2,ae),(ae=ie.getFf())!==0&&se.writeFloat(3,ae),(ae=ie.getTh())!==0&&se.writeFloat(4,ae),(ae=ie.getDd())!==0&&se.writeFloat(5,ae),(ae=ie.getKk())!==0&&se.writeFloat(6,ae),(ae=ie.getCh())!==0&&se.writeFloat(7,ae),(ae=ie.getSs())!==0&&se.writeFloat(8,ae),(ae=ie.getNn())!==0&&se.writeFloat(9,ae),(ae=ie.getRr())!==0&&se.writeFloat(10,ae),(ae=ie.getAa())!==0&&se.writeFloat(11,ae),(ae=ie.getE())!==0&&se.writeFloat(12,ae),(ae=ie.getIh())!==0&&se.writeFloat(13,ae),(ae=ie.getOh())!==0&&se.writeFloat(14,ae),(ae=ie.getOu())!==0&&se.writeFloat(15,ae)},proto.service.Viseme.prototype.getSil=function(){return+K.Message.getFieldWithDefault(this,1,0)},proto.service.Viseme.prototype.setSil=function(ie){K.Message.setProto3FloatField(this,1,ie)},proto.service.Viseme.prototype.getPp=function(){return+K.Message.getFieldWithDefault(this,2,0)},proto.service.Viseme.prototype.setPp=function(ie){K.Message.setProto3FloatField(this,2,ie)},proto.service.Viseme.prototype.getFf=function(){return+K.Message.getFieldWithDefault(this,3,0)},proto.service.Viseme.prototype.setFf=function(ie){K.Message.setProto3FloatField(this,3,ie)},proto.service.Viseme.prototype.getTh=function(){return+K.Message.getFieldWithDefault(this,4,0)},proto.service.Viseme.prototype.setTh=function(ie){K.Message.setProto3FloatField(this,4,ie)},proto.service.Viseme.prototype.getDd=function(){return+K.Message.getFieldWithDefault(this,5,0)},proto.service.Viseme.prototype.setDd=function(ie){K.Message.setProto3FloatField(this,5,ie)},proto.service.Viseme.prototype.getKk=function(){return+K.Message.getFieldWithDefault(this,6,0)},proto.service.Viseme.prototype.setKk=function(ie){K.Message.setProto3FloatField(this,6,ie)},proto.service.Viseme.prototype.getCh=function(){return+K.Message.getFieldWithDefault(this,7,0)},proto.service.Viseme.prototype.setCh=function(ie){K.Message.setProto3FloatField(this,7,ie)},proto.service.Viseme.prototype.getSs=function(){return+K.Message.getFieldWithDefault(this,8,0)},proto.service.Viseme.prototype.setSs=function(ie){K.Message.setProto3FloatField(this,8,ie)},proto.service.Viseme.prototype.getNn=function(){return+K.Message.getFieldWithDefault(this,9,0)},proto.service.Viseme.prototype.setNn=function(ie){K.Message.setProto3FloatField(this,9,ie)},proto.service.Viseme.prototype.getRr=function(){return+K.Message.getFieldWithDefault(this,10,0)},proto.service.Viseme.prototype.setRr=function(ie){K.Message.setProto3FloatField(this,10,ie)},proto.service.Viseme.prototype.getAa=function(){return+K.Message.getFieldWithDefault(this,11,0)},proto.service.Viseme.prototype.setAa=function(ie){K.Message.setProto3FloatField(this,11,ie)},proto.service.Viseme.prototype.getE=function(){return+K.Message.getFieldWithDefault(this,12,0)},proto.service.Viseme.prototype.setE=function(ie){K.Message.setProto3FloatField(this,12,ie)},proto.service.Viseme.prototype.getIh=function(){return+K.Message.getFieldWithDefault(this,13,0)},proto.service.Viseme.prototype.setIh=function(ie){K.Message.setProto3FloatField(this,13,ie)},proto.service.Viseme.prototype.getOh=function(){return+K.Message.getFieldWithDefault(this,14,0)},proto.service.Viseme.prototype.setOh=function(ie){K.Message.setProto3FloatField(this,14,ie)},proto.service.Viseme.prototype.getOu=function(){return+K.Message.getFieldWithDefault(this,15,0)},proto.service.Viseme.prototype.setOu=function(ie){K.Message.setProto3FloatField(this,15,ie)},proto.service.BlendShapesData=function(ie){K.Message.initialize(this,ie,0,-1,null,null)},te.inherits(proto.service.BlendShapesData,K.Message),te.DEBUG&&!COMPILED&&(proto.service.BlendShapesData.displayName="proto.service.BlendShapesData"),K.Message.GENERATE_TO_OBJECT&&(proto.service.BlendShapesData.prototype.toObject=function(ie){return proto.service.BlendShapesData.toObject(ie,this)},proto.service.BlendShapesData.toObject=function(ie,se){var ae={blendshapeData:K.Message.getFieldWithDefault(se,1,"")};return ie&&(ae.$jspbMessageInstance=se),ae}),proto.service.BlendShapesData.deserializeBinary=function(ie){var se=new K.BinaryReader(ie),ae=new proto.service.BlendShapesData;return proto.service.BlendShapesData.deserializeBinaryFromReader(ae,se)},proto.service.BlendShapesData.deserializeBinaryFromReader=function(ie,se){for(;se.nextField()&&!se.isEndGroup();)if(se.getFieldNumber()===1){var ae=se.readString();ie.setBlendshapeData(ae)}else se.skipField();return ie},proto.service.BlendShapesData.prototype.serializeBinary=function(){var ie=new K.BinaryWriter;return proto.service.BlendShapesData.serializeBinaryToWriter(this,ie),ie.getResultBuffer()},proto.service.BlendShapesData.serializeBinaryToWriter=function(ie,se){var ae;(ae=ie.getBlendshapeData()).length>0&&se.writeString(1,ae)},proto.service.BlendShapesData.prototype.getBlendshapeData=function(){return K.Message.getFieldWithDefault(this,1,"")},proto.service.BlendShapesData.prototype.setBlendshapeData=function(ie){K.Message.setProto3StringField(this,1,ie)},proto.service.HelloRequest=function(ie){K.Message.initialize(this,ie,0,-1,null,null)},te.inherits(proto.service.HelloRequest,K.Message),te.DEBUG&&!COMPILED&&(proto.service.HelloRequest.displayName="proto.service.HelloRequest"),K.Message.GENERATE_TO_OBJECT&&(proto.service.HelloRequest.prototype.toObject=function(ie){return proto.service.HelloRequest.toObject(ie,this)},proto.service.HelloRequest.toObject=function(ie,se){var ae={name:K.Message.getFieldWithDefault(se,1,"")};return ie&&(ae.$jspbMessageInstance=se),ae}),proto.service.HelloRequest.deserializeBinary=function(ie){var se=new K.BinaryReader(ie),ae=new proto.service.HelloRequest;return proto.service.HelloRequest.deserializeBinaryFromReader(ae,se)},proto.service.HelloRequest.deserializeBinaryFromReader=function(ie,se){for(;se.nextField()&&!se.isEndGroup();)if(se.getFieldNumber()===1){var ae=se.readString();ie.setName(ae)}else se.skipField();return ie},proto.service.HelloRequest.prototype.serializeBinary=function(){var ie=new K.BinaryWriter;return proto.service.HelloRequest.serializeBinaryToWriter(this,ie),ie.getResultBuffer()},proto.service.HelloRequest.serializeBinaryToWriter=function(ie,se){var ae;(ae=ie.getName()).length>0&&se.writeString(1,ae)},proto.service.HelloRequest.prototype.getName=function(){return K.Message.getFieldWithDefault(this,1,"")},proto.service.HelloRequest.prototype.setName=function(ie){K.Message.setProto3StringField(this,1,ie)},proto.service.HelloResponse=function(ie){K.Message.initialize(this,ie,0,-1,null,null)},te.inherits(proto.service.HelloResponse,K.Message),te.DEBUG&&!COMPILED&&(proto.service.HelloResponse.displayName="proto.service.HelloResponse"),K.Message.GENERATE_TO_OBJECT&&(proto.service.HelloResponse.prototype.toObject=function(ie){return proto.service.HelloResponse.toObject(ie,this)},proto.service.HelloResponse.toObject=function(ie,se){var ae={message:K.Message.getFieldWithDefault(se,1,"")};return ie&&(ae.$jspbMessageInstance=se),ae}),proto.service.HelloResponse.deserializeBinary=function(ie){var se=new K.BinaryReader(ie),ae=new proto.service.HelloResponse;return proto.service.HelloResponse.deserializeBinaryFromReader(ae,se)},proto.service.HelloResponse.deserializeBinaryFromReader=function(ie,se){for(;se.nextField()&&!se.isEndGroup();)if(se.getFieldNumber()===1){var ae=se.readString();ie.setMessage(ae)}else se.skipField();return ie},proto.service.HelloResponse.prototype.serializeBinary=function(){var ie=new K.BinaryWriter;return proto.service.HelloResponse.serializeBinaryToWriter(this,ie),ie.getResultBuffer()},proto.service.HelloResponse.serializeBinaryToWriter=function(ie,se){var ae;(ae=ie.getMessage()).length>0&&se.writeString(1,ae)},proto.service.HelloResponse.prototype.getMessage=function(){return K.Message.getFieldWithDefault(this,1,"")},proto.service.HelloResponse.prototype.setMessage=function(ie){K.Message.setProto3StringField(this,1,ie)},proto.service.FeedbackRequest=function(ie){K.Message.initialize(this,ie,0,-1,null,null)},te.inherits(proto.service.FeedbackRequest,K.Message),te.DEBUG&&!COMPILED&&(proto.service.FeedbackRequest.displayName="proto.service.FeedbackRequest"),K.Message.GENERATE_TO_OBJECT&&(proto.service.FeedbackRequest.prototype.toObject=function(ie){return proto.service.FeedbackRequest.toObject(ie,this)},proto.service.FeedbackRequest.toObject=function(ie,se){var ae,ge={interactionId:K.Message.getFieldWithDefault(se,1,""),characterId:K.Message.getFieldWithDefault(se,2,""),sessionId:K.Message.getFieldWithDefault(se,3,""),textFeedback:(ae=se.getTextFeedback())&&proto.service.FeedbackRequest.Feedback.toObject(ie,ae),userQuery:K.Message.getFieldWithDefault(se,6,""),response:K.Message.getFieldWithDefault(se,7,"")};return ie&&(ge.$jspbMessageInstance=se),ge}),proto.service.FeedbackRequest.deserializeBinary=function(ie){var se=new K.BinaryReader(ie),ae=new proto.service.FeedbackRequest;return proto.service.FeedbackRequest.deserializeBinaryFromReader(ae,se)},proto.service.FeedbackRequest.deserializeBinaryFromReader=function(ie,se){for(;se.nextField()&&!se.isEndGroup();)switch(se.getFieldNumber()){case 1:var ae=se.readString();ie.setInteractionId(ae);break;case 2:ae=se.readString(),ie.setCharacterId(ae);break;case 3:ae=se.readString(),ie.setSessionId(ae);break;case 5:ae=new proto.service.FeedbackRequest.Feedback,se.readMessage(ae,proto.service.FeedbackRequest.Feedback.deserializeBinaryFromReader),ie.setTextFeedback(ae);break;case 6:ae=se.readString(),ie.setUserQuery(ae);break;case 7:ae=se.readString(),ie.setResponse(ae);break;default:se.skipField()}return ie},proto.service.FeedbackRequest.prototype.serializeBinary=function(){var ie=new K.BinaryWriter;return proto.service.FeedbackRequest.serializeBinaryToWriter(this,ie),ie.getResultBuffer()},proto.service.FeedbackRequest.serializeBinaryToWriter=function(ie,se){var ae=void 0;(ae=ie.getInteractionId()).length>0&&se.writeString(1,ae),(ae=ie.getCharacterId()).length>0&&se.writeString(2,ae),(ae=ie.getSessionId()).length>0&&se.writeString(3,ae),(ae=ie.getTextFeedback())!=null&&se.writeMessage(5,ae,proto.service.FeedbackRequest.Feedback.serializeBinaryToWriter),(ae=ie.getUserQuery()).length>0&&se.writeString(6,ae),(ae=ie.getResponse()).length>0&&se.writeString(7,ae)},proto.service.FeedbackRequest.Feedback=function(ie){K.Message.initialize(this,ie,0,-1,proto.service.FeedbackRequest.Feedback.repeatedFields_,null)},te.inherits(proto.service.FeedbackRequest.Feedback,K.Message),te.DEBUG&&!COMPILED&&(proto.service.FeedbackRequest.Feedback.displayName="proto.service.FeedbackRequest.Feedback"),proto.service.FeedbackRequest.Feedback.repeatedFields_=[3],K.Message.GENERATE_TO_OBJECT&&(proto.service.FeedbackRequest.Feedback.prototype.toObject=function(ie){return proto.service.FeedbackRequest.Feedback.toObject(ie,this)},proto.service.FeedbackRequest.Feedback.toObject=function(ie,se){var ae={thumbsUp:K.Message.getFieldWithDefault(se,1,!1),feedbackText:K.Message.getFieldWithDefault(se,2,""),tagsList:K.Message.getRepeatedField(se,3),isTestCase:K.Message.getFieldWithDefault(se,4,!1)};return ie&&(ae.$jspbMessageInstance=se),ae}),proto.service.FeedbackRequest.Feedback.deserializeBinary=function(ie){var se=new K.BinaryReader(ie),ae=new proto.service.FeedbackRequest.Feedback;return proto.service.FeedbackRequest.Feedback.deserializeBinaryFromReader(ae,se)},proto.service.FeedbackRequest.Feedback.deserializeBinaryFromReader=function(ie,se){for(;se.nextField()&&!se.isEndGroup();)switch(se.getFieldNumber()){case 1:var ae=se.readBool();ie.setThumbsUp(ae);break;case 2:ae=se.readString(),ie.setFeedbackText(ae);break;case 3:ae=se.readString(),ie.addTags(ae);break;case 4:ae=se.readBool(),ie.setIsTestCase(ae);break;default:se.skipField()}return ie},proto.service.FeedbackRequest.Feedback.prototype.serializeBinary=function(){var ie=new K.BinaryWriter;return proto.service.FeedbackRequest.Feedback.serializeBinaryToWriter(this,ie),ie.getResultBuffer()},proto.service.FeedbackRequest.Feedback.serializeBinaryToWriter=function(ie,se){var ae=void 0;(ae=ie.getThumbsUp())&&se.writeBool(1,ae),(ae=ie.getFeedbackText()).length>0&&se.writeString(2,ae),(ae=ie.getTagsList()).length>0&&se.writeRepeatedString(3,ae),(ae=ie.getIsTestCase())&&se.writeBool(4,ae)},proto.service.FeedbackRequest.Feedback.prototype.getThumbsUp=function(){return K.Message.getFieldWithDefault(this,1,!1)},proto.service.FeedbackRequest.Feedback.prototype.setThumbsUp=function(ie){K.Message.setProto3BooleanField(this,1,ie)},proto.service.FeedbackRequest.Feedback.prototype.getFeedbackText=function(){return K.Message.getFieldWithDefault(this,2,"")},proto.service.FeedbackRequest.Feedback.prototype.setFeedbackText=function(ie){K.Message.setProto3StringField(this,2,ie)},proto.service.FeedbackRequest.Feedback.prototype.getTagsList=function(){return K.Message.getRepeatedField(this,3)},proto.service.FeedbackRequest.Feedback.prototype.setTagsList=function(ie){K.Message.setField(this,3,ie||[])},proto.service.FeedbackRequest.Feedback.prototype.addTags=function(ie,se){K.Message.addToRepeatedField(this,3,ie,se)},proto.service.FeedbackRequest.Feedback.prototype.clearTagsList=function(){this.setTagsList([])},proto.service.FeedbackRequest.Feedback.prototype.getIsTestCase=function(){return K.Message.getFieldWithDefault(this,4,!1)},proto.service.FeedbackRequest.Feedback.prototype.setIsTestCase=function(ie){K.Message.setProto3BooleanField(this,4,ie)},proto.service.FeedbackRequest.prototype.getInteractionId=function(){return K.Message.getFieldWithDefault(this,1,"")},proto.service.FeedbackRequest.prototype.setInteractionId=function(ie){K.Message.setProto3StringField(this,1,ie)},proto.service.FeedbackRequest.prototype.getCharacterId=function(){return K.Message.getFieldWithDefault(this,2,"")},proto.service.FeedbackRequest.prototype.setCharacterId=function(ie){K.Message.setProto3StringField(this,2,ie)},proto.service.FeedbackRequest.prototype.getSessionId=function(){return K.Message.getFieldWithDefault(this,3,"")},proto.service.FeedbackRequest.prototype.setSessionId=function(ie){K.Message.setProto3StringField(this,3,ie)},proto.service.FeedbackRequest.prototype.getTextFeedback=function(){return K.Message.getWrapperField(this,proto.service.FeedbackRequest.Feedback,5)},proto.service.FeedbackRequest.prototype.setTextFeedback=function(ie){K.Message.setWrapperField(this,5,ie)},proto.service.FeedbackRequest.prototype.clearTextFeedback=function(){this.setTextFeedback(void 0)},proto.service.FeedbackRequest.prototype.hasTextFeedback=function(){return K.Message.getField(this,5)!=null},proto.service.FeedbackRequest.prototype.getUserQuery=function(){return K.Message.getFieldWithDefault(this,6,"")},proto.service.FeedbackRequest.prototype.setUserQuery=function(ie){K.Message.setProto3StringField(this,6,ie)},proto.service.FeedbackRequest.prototype.getResponse=function(){return K.Message.getFieldWithDefault(this,7,"")},proto.service.FeedbackRequest.prototype.setResponse=function(ie){K.Message.setProto3StringField(this,7,ie)},proto.service.FeedbackResponse=function(ie){K.Message.initialize(this,ie,0,-1,null,null)},te.inherits(proto.service.FeedbackResponse,K.Message),te.DEBUG&&!COMPILED&&(proto.service.FeedbackResponse.displayName="proto.service.FeedbackResponse"),K.Message.GENERATE_TO_OBJECT&&(proto.service.FeedbackResponse.prototype.toObject=function(ie){return proto.service.FeedbackResponse.toObject(ie,this)},proto.service.FeedbackResponse.toObject=function(ie,se){var ae={feedbackResponse:K.Message.getFieldWithDefault(se,1,"")};return ie&&(ae.$jspbMessageInstance=se),ae}),proto.service.FeedbackResponse.deserializeBinary=function(ie){var se=new K.BinaryReader(ie),ae=new proto.service.FeedbackResponse;return proto.service.FeedbackResponse.deserializeBinaryFromReader(ae,se)},proto.service.FeedbackResponse.deserializeBinaryFromReader=function(ie,se){for(;se.nextField()&&!se.isEndGroup();)if(se.getFieldNumber()===1){var ae=se.readString();ie.setFeedbackResponse(ae)}else se.skipField();return ie},proto.service.FeedbackResponse.prototype.serializeBinary=function(){var ie=new K.BinaryWriter;return proto.service.FeedbackResponse.serializeBinaryToWriter(this,ie),ie.getResultBuffer()},proto.service.FeedbackResponse.serializeBinaryToWriter=function(ie,se){var ae;(ae=ie.getFeedbackResponse()).length>0&&se.writeString(1,ae)},proto.service.FeedbackResponse.prototype.getFeedbackResponse=function(){return K.Message.getFieldWithDefault(this,1,"")},proto.service.FeedbackResponse.prototype.setFeedbackResponse=function(ie){K.Message.setProto3StringField(this,1,ie)},proto.service.FaceModel={FACE_MODEL_UNSPECIFIED:0,FACE_MODEL_A_2F_MODEL_NAME:1,FACE_MODEL_PHONEMES_MODEL_NAME:2,FACE_MODEL_OVR_MODEL_NAME:3},te.object.extend(Z,proto.service)},820:(X,Z,_)=>{var K=_(48);_(553).grpc;var te=function(){function ne(){}return ne.serviceName="service.ConvaiService",ne}();te.Hello={methodName:"Hello",service:te,requestStream:!1,responseStream:!1,requestType:K.HelloRequest,responseType:K.HelloResponse},te.HelloStream={methodName:"HelloStream",service:te,requestStream:!0,responseStream:!0,requestType:K.HelloRequest,responseType:K.HelloResponse},te.SpeechToText={methodName:"SpeechToText",service:te,requestStream:!0,responseStream:!0,requestType:K.STTRequest,responseType:K.STTResponse},te.GetResponse={methodName:"GetResponse",service:te,requestStream:!0,responseStream:!0,requestType:K.GetResponseRequest,responseType:K.GetResponseResponse},te.GetResponseSingle={methodName:"GetResponseSingle",service:te,requestStream:!1,responseStream:!0,requestType:K.GetResponseRequestSingle,responseType:K.GetResponseResponse},te.SubmitFeedback={methodName:"SubmitFeedback",service:te,requestStream:!1,responseStream:!1,requestType:K.FeedbackRequest,responseType:K.FeedbackResponse},Z.C=te},553:function(X){var Z,_;X.exports=(Z={418:function(K,te){(function(ne,oe){for(var ie in oe)ne[ie]=oe[ie]})(te,function(ne){var oe={};function ie(se){if(oe[se])return oe[se].exports;var ae=oe[se]={i:se,l:!1,exports:{}};return ne[se].call(ae.exports,ae,ae.exports,ie),ae.l=!0,ae.exports}return ie.m=ne,ie.c=oe,ie.i=function(se){return se},ie.d=function(se,ae,ge){ie.o(se,ae)||Object.defineProperty(se,ae,{configurable:!1,enumerable:!0,get:ge})},ie.n=function(se){var ae=se&&se.__esModule?function(){return se.default}:function(){return se};return ie.d(ae,"a",ae),ae},ie.o=function(se,ae){return Object.prototype.hasOwnProperty.call(se,ae)},ie.p="",ie(ie.s=1)}([function(ne,oe,ie){Object.defineProperty(oe,"__esModule",{value:!0});var se=ie(3),ae=function(){function ge(ce,de){ce===void 0&&(ce={}),de===void 0&&(de={splitValues:!1});var pe,fe=this;this.headersMap={},ce&&(typeof Headers<"u"&&ce instanceof Headers?se.getHeaderKeys(ce).forEach(function(be){se.getHeaderValues(ce,be).forEach(function(me){de.splitValues?fe.append(be,se.splitHeaderValue(me)):fe.append(be,me)})}):typeof(pe=ce)=="object"&&typeof pe.headersMap=="object"&&typeof pe.forEach=="function"?ce.forEach(function(be,me){fe.append(be,me)}):typeof Map<"u"&&ce instanceof Map?ce.forEach(function(be,me){fe.append(me,be)}):typeof ce=="string"?this.appendFromString(ce):typeof ce=="object"&&Object.getOwnPropertyNames(ce).forEach(function(be){var me=ce[be];Array.isArray(me)?me.forEach(function(ye){fe.append(be,ye)}):fe.append(be,me)}))}return ge.prototype.appendFromString=function(ce){for(var de=ce.split(`\r
`),pe=0;pe<de.length;pe++){var fe=de[pe],be=fe.indexOf(":");if(be>0){var me=fe.substring(0,be).trim(),ye=fe.substring(be+1).trim();this.append(me,ye)}}},ge.prototype.delete=function(ce,de){var pe=se.normalizeName(ce);if(de===void 0)delete this.headersMap[pe];else{var fe=this.headersMap[pe];if(fe){var be=fe.indexOf(de);be>=0&&fe.splice(be,1),fe.length===0&&delete this.headersMap[pe]}}},ge.prototype.append=function(ce,de){var pe=this,fe=se.normalizeName(ce);Array.isArray(this.headersMap[fe])||(this.headersMap[fe]=[]),Array.isArray(de)?de.forEach(function(be){pe.headersMap[fe].push(se.normalizeValue(be))}):this.headersMap[fe].push(se.normalizeValue(de))},ge.prototype.set=function(ce,de){var pe=se.normalizeName(ce);if(Array.isArray(de)){var fe=[];de.forEach(function(be){fe.push(se.normalizeValue(be))}),this.headersMap[pe]=fe}else this.headersMap[pe]=[se.normalizeValue(de)]},ge.prototype.has=function(ce,de){var pe=this.headersMap[se.normalizeName(ce)];if(!Array.isArray(pe))return!1;if(de!==void 0){var fe=se.normalizeValue(de);return pe.indexOf(fe)>=0}return!0},ge.prototype.get=function(ce){var de=this.headersMap[se.normalizeName(ce)];return de!==void 0?de.concat():[]},ge.prototype.forEach=function(ce){var de=this;Object.getOwnPropertyNames(this.headersMap).forEach(function(pe){ce(pe,de.headersMap[pe])},this)},ge.prototype.toHeaders=function(){if(typeof Headers<"u"){var ce=new Headers;return this.forEach(function(de,pe){pe.forEach(function(fe){ce.append(de,fe)})}),ce}throw new Error("Headers class is not defined")},ge}();oe.BrowserHeaders=ae},function(ne,oe,ie){Object.defineProperty(oe,"__esModule",{value:!0});var se=ie(0);oe.BrowserHeaders=se.BrowserHeaders},function(ne,oe,ie){Object.defineProperty(oe,"__esModule",{value:!0}),oe.iterateHeaders=function(se,ae){for(var ge=se[Symbol.iterator](),ce=ge.next();!ce.done;)ae(ce.value[0]),ce=ge.next()},oe.iterateHeadersKeys=function(se,ae){for(var ge=se.keys(),ce=ge.next();!ce.done;)ae(ce.value),ce=ge.next()}},function(ne,oe,ie){Object.defineProperty(oe,"__esModule",{value:!0});var se=ie(2);oe.normalizeName=function(ae){if(typeof ae!="string"&&(ae=String(ae)),/[^a-z0-9\-#$%&'*+.\^_`|~]/i.test(ae))throw new TypeError("Invalid character in header field name");return ae.toLowerCase()},oe.normalizeValue=function(ae){return typeof ae!="string"&&(ae=String(ae)),ae},oe.getHeaderValues=function(ae,ge){var ce=ae;if(ce instanceof Headers&&ce.getAll)return ce.getAll(ge);var de=ce.get(ge);return de&&typeof de=="string"?[de]:de},oe.getHeaderKeys=function(ae){var ge=ae,ce={},de=[];return ge.keys?se.iterateHeadersKeys(ge,function(pe){ce[pe]||(ce[pe]=!0,de.push(pe))}):ge.forEach?ge.forEach(function(pe,fe){ce[fe]||(ce[fe]=!0,de.push(fe))}):se.iterateHeaders(ge,function(pe){var fe=pe[0];ce[fe]||(ce[fe]=!0,de.push(fe))}),de},oe.splitHeaderValue=function(ae){var ge=[];return ae.split(", ").forEach(function(ce){ce.split(",").forEach(function(de){ge.push(de)})}),ge}}]))},617:function(K,te,ne){Object.defineProperty(te,"__esModule",{value:!0}),te.ChunkParser=te.ChunkType=te.encodeASCII=te.decodeASCII=void 0;var oe,ie=ne(65);function se(be){return(me=be)===9||me===10||me===13||be>=32&&be<=126;var me}function ae(be){for(var me=0;me!==be.length;++me)if(!se(be[me]))throw new Error("Metadata is not valid (printable) ASCII");return String.fromCharCode.apply(String,Array.prototype.slice.call(be))}function ge(be){return!(128&~be.getUint8(0))}function ce(be){return be.getUint32(1,!1)}function de(be,me,ye){return be.byteLength-me>=ye}function pe(be,me,ye){if(be.slice)return be.slice(me,ye);var ve=be.length;ye!==void 0&&(ve=ye);for(var Be=new Uint8Array(ve-me),Re=0,Ee=me;Ee<ve;Ee++)Be[Re++]=be[Ee];return Be}te.decodeASCII=ae,te.encodeASCII=function(be){for(var me=new Uint8Array(be.length),ye=0;ye!==be.length;++ye){var ve=be.charCodeAt(ye);if(!se(ve))throw new Error("Metadata contains invalid ASCII");me[ye]=ve}return me},function(be){be[be.MESSAGE=1]="MESSAGE",be[be.TRAILERS=2]="TRAILERS"}(oe=te.ChunkType||(te.ChunkType={}));var fe=function(){function be(){this.buffer=null,this.position=0}return be.prototype.parse=function(me,ye){if(me.length===0&&ye)return[];var ve,Be=[];if(this.buffer==null)this.buffer=me,this.position=0;else if(this.position===this.buffer.byteLength)this.buffer=me,this.position=0;else{var Re=this.buffer.byteLength-this.position,Ee=new Uint8Array(Re+me.byteLength),We=pe(this.buffer,this.position);Ee.set(We,0);var Ze=new Uint8Array(me);Ee.set(Ze,Re),this.buffer=Ee,this.position=0}for(;;){if(!de(this.buffer,this.position,5))return Be;var Ve=pe(this.buffer,this.position,this.position+5),_e=new DataView(Ve.buffer,Ve.byteOffset,Ve.byteLength),Xe=ce(_e);if(!de(this.buffer,this.position,5+Xe))return Be;var Pe=pe(this.buffer,this.position+5,this.position+5+Xe);if(this.position+=5+Xe,ge(_e))return Be.push({chunkType:oe.TRAILERS,trailers:(ve=Pe,new ie.Metadata(ae(ve)))}),Be;Be.push({chunkType:oe.MESSAGE,data:Pe})}},be}();te.ChunkParser=fe},8:function(K,te){var ne;Object.defineProperty(te,"__esModule",{value:!0}),te.httpStatusToCode=te.Code=void 0,function(oe){oe[oe.OK=0]="OK",oe[oe.Canceled=1]="Canceled",oe[oe.Unknown=2]="Unknown",oe[oe.InvalidArgument=3]="InvalidArgument",oe[oe.DeadlineExceeded=4]="DeadlineExceeded",oe[oe.NotFound=5]="NotFound",oe[oe.AlreadyExists=6]="AlreadyExists",oe[oe.PermissionDenied=7]="PermissionDenied",oe[oe.ResourceExhausted=8]="ResourceExhausted",oe[oe.FailedPrecondition=9]="FailedPrecondition",oe[oe.Aborted=10]="Aborted",oe[oe.OutOfRange=11]="OutOfRange",oe[oe.Unimplemented=12]="Unimplemented",oe[oe.Internal=13]="Internal",oe[oe.Unavailable=14]="Unavailable",oe[oe.DataLoss=15]="DataLoss",oe[oe.Unauthenticated=16]="Unauthenticated"}(ne=te.Code||(te.Code={})),te.httpStatusToCode=function(oe){switch(oe){case 0:return ne.Internal;case 200:return ne.OK;case 400:return ne.InvalidArgument;case 401:return ne.Unauthenticated;case 403:return ne.PermissionDenied;case 404:return ne.NotFound;case 409:return ne.Aborted;case 412:return ne.FailedPrecondition;case 429:return ne.ResourceExhausted;case 499:return ne.Canceled;case 500:default:return ne.Unknown;case 501:return ne.Unimplemented;case 503:return ne.Unavailable;case 504:return ne.DeadlineExceeded}}},934:function(K,te,ne){Object.defineProperty(te,"__esModule",{value:!0}),te.client=void 0;var oe=ne(65),ie=ne(617),se=ne(8),ae=ne(346),ge=ne(57),ce=ne(882);te.client=function(fe,be){return new de(fe,be)};var de=function(){function fe(be,me){this.started=!1,this.sentFirstMessage=!1,this.completed=!1,this.closed=!1,this.finishedSending=!1,this.onHeadersCallbacks=[],this.onMessageCallbacks=[],this.onEndCallbacks=[],this.parser=new ie.ChunkParser,this.methodDefinition=be,this.props=me,this.createTransport()}return fe.prototype.createTransport=function(){var be=this.props.host+"/"+this.methodDefinition.service.serviceName+"/"+this.methodDefinition.methodName,me={methodDefinition:this.methodDefinition,debug:this.props.debug||!1,url:be,onHeaders:this.onTransportHeaders.bind(this),onChunk:this.onTransportChunk.bind(this),onEnd:this.onTransportEnd.bind(this)};this.props.transport?this.transport=this.props.transport(me):this.transport=ge.makeDefaultTransport(me)},fe.prototype.onTransportHeaders=function(be,me){if(this.props.debug&&ae.debug("onHeaders",be,me),this.closed)this.props.debug&&ae.debug("grpc.onHeaders received after request was closed - ignoring");else if(me!==0){this.responseHeaders=be,this.props.debug&&ae.debug("onHeaders.responseHeaders",JSON.stringify(this.responseHeaders,null,2));var ye=pe(be);this.props.debug&&ae.debug("onHeaders.gRPCStatus",ye);var ve=ye&&ye>=0?ye:se.httpStatusToCode(me);this.props.debug&&ae.debug("onHeaders.code",ve);var Be=be.get("grpc-message")||[];if(this.props.debug&&ae.debug("onHeaders.gRPCMessage",Be),this.rawOnHeaders(be),ve!==se.Code.OK){var Re=this.decodeGRPCStatus(Be[0]);this.rawOnError(ve,Re,be)}}},fe.prototype.onTransportChunk=function(be){var me=this;if(this.closed)this.props.debug&&ae.debug("grpc.onChunk received after request was closed - ignoring");else{var ye=[];try{ye=this.parser.parse(be)}catch(ve){return this.props.debug&&ae.debug("onChunk.parsing error",ve,ve.message),void this.rawOnError(se.Code.Internal,"parsing error: "+ve.message)}ye.forEach(function(ve){if(ve.chunkType===ie.ChunkType.MESSAGE){var Be=me.methodDefinition.responseType.deserializeBinary(ve.data);me.rawOnMessage(Be)}else ve.chunkType===ie.ChunkType.TRAILERS&&(me.responseHeaders?(me.responseTrailers=new oe.Metadata(ve.trailers),me.props.debug&&ae.debug("onChunk.trailers",me.responseTrailers)):(me.responseHeaders=new oe.Metadata(ve.trailers),me.rawOnHeaders(me.responseHeaders)))})}},fe.prototype.onTransportEnd=function(){if(this.props.debug&&ae.debug("grpc.onEnd"),this.closed)this.props.debug&&ae.debug("grpc.onEnd received after request was closed - ignoring");else if(this.responseTrailers!==void 0){var be=pe(this.responseTrailers);if(be!==null){var me=this.responseTrailers.get("grpc-message"),ye=this.decodeGRPCStatus(me[0]);this.rawOnEnd(be,ye,this.responseTrailers)}else this.rawOnError(se.Code.Internal,"Response closed without grpc-status (Trailers provided)")}else{if(this.responseHeaders===void 0)return void this.rawOnError(se.Code.Unknown,"Response closed without headers");var ve=pe(this.responseHeaders),Be=this.responseHeaders.get("grpc-message");if(this.props.debug&&ae.debug("grpc.headers only response ",ve,Be),ve===null)return void this.rawOnEnd(se.Code.Unknown,"Response closed without grpc-status (Headers only)",this.responseHeaders);var Re=this.decodeGRPCStatus(Be[0]);this.rawOnEnd(ve,Re,this.responseHeaders)}},fe.prototype.decodeGRPCStatus=function(be){if(!be)return"";try{return decodeURIComponent(be)}catch{return be}},fe.prototype.rawOnEnd=function(be,me,ye){var ve=this;this.props.debug&&ae.debug("rawOnEnd",be,me,ye),this.completed||(this.completed=!0,this.onEndCallbacks.forEach(function(Be){if(!ve.closed)try{Be(be,me,ye)}catch(Re){setTimeout(function(){throw Re},0)}}))},fe.prototype.rawOnHeaders=function(be){this.props.debug&&ae.debug("rawOnHeaders",be),this.completed||this.onHeadersCallbacks.forEach(function(me){try{me(be)}catch(ye){setTimeout(function(){throw ye},0)}})},fe.prototype.rawOnError=function(be,me,ye){var ve=this;ye===void 0&&(ye=new oe.Metadata),this.props.debug&&ae.debug("rawOnError",be,me),this.completed||(this.completed=!0,this.onEndCallbacks.forEach(function(Be){if(!ve.closed)try{Be(be,me,ye)}catch(Re){setTimeout(function(){throw Re},0)}}))},fe.prototype.rawOnMessage=function(be){var me=this;this.props.debug&&ae.debug("rawOnMessage",be.toObject()),this.completed||this.closed||this.onMessageCallbacks.forEach(function(ye){if(!me.closed)try{ye(be)}catch(ve){setTimeout(function(){throw ve},0)}})},fe.prototype.onHeaders=function(be){this.onHeadersCallbacks.push(be)},fe.prototype.onMessage=function(be){this.onMessageCallbacks.push(be)},fe.prototype.onEnd=function(be){this.onEndCallbacks.push(be)},fe.prototype.start=function(be){if(this.started)throw new Error("Client already started - cannot .start()");this.started=!0;var me=new oe.Metadata(be||{});me.set("content-type","application/grpc-web+proto"),me.set("x-grpc-web","1"),this.transport.start(me)},fe.prototype.send=function(be){if(!this.started)throw new Error("Client not started - .start() must be called before .send()");if(this.closed)throw new Error("Client already closed - cannot .send()");if(this.finishedSending)throw new Error("Client already finished sending - cannot .send()");if(!this.methodDefinition.requestStream&&this.sentFirstMessage)throw new Error("Message already sent for non-client-streaming method - cannot .send()");this.sentFirstMessage=!0;var me=ce.frameRequest(be);this.transport.sendMessage(me)},fe.prototype.finishSend=function(){if(!this.started)throw new Error("Client not started - .finishSend() must be called before .close()");if(this.closed)throw new Error("Client already closed - cannot .send()");if(this.finishedSending)throw new Error("Client already finished sending - cannot .finishSend()");this.finishedSending=!0,this.transport.finishSend()},fe.prototype.close=function(){if(!this.started)throw new Error("Client not started - .start() must be called before .close()");if(this.closed)throw new Error("Client already closed - cannot .close()");this.closed=!0,this.props.debug&&ae.debug("request.abort aborting request"),this.transport.cancel()},fe}();function pe(fe){var be=fe.get("grpc-status")||[];if(be.length>0)try{var me=be[0];return parseInt(me,10)}catch{return null}return null}},346:function(K,te){Object.defineProperty(te,"__esModule",{value:!0}),te.debug=void 0,te.debug=function(){for(var ne=[],oe=0;oe<arguments.length;oe++)ne[oe]=arguments[oe]}},607:function(K,te,ne){Object.defineProperty(te,"__esModule",{value:!0}),te.grpc=void 0;var oe,ie=ne(418),se=ne(57),ae=ne(229),ge=ne(540),ce=ne(210),de=ne(859),pe=ne(8),fe=ne(938),be=ne(35),me=ne(934);(oe=te.grpc||(te.grpc={})).setDefaultTransport=se.setDefaultTransportFactory,oe.CrossBrowserHttpTransport=de.CrossBrowserHttpTransport,oe.FetchReadableStreamTransport=ae.FetchReadableStreamTransport,oe.XhrTransport=ce.XhrTransport,oe.WebsocketTransport=ge.WebsocketTransport,oe.Code=pe.Code,oe.Metadata=ie.BrowserHeaders,oe.client=function(ye,ve){return me.client(ye,ve)},oe.invoke=fe.invoke,oe.unary=be.unary},938:function(K,te,ne){Object.defineProperty(te,"__esModule",{value:!0}),te.invoke=void 0;var oe=ne(934);te.invoke=function(ie,se){if(ie.requestStream)throw new Error(".invoke cannot be used with client-streaming methods. Use .client instead.");var ae=oe.client(ie,{host:se.host,transport:se.transport,debug:se.debug});return se.onHeaders&&ae.onHeaders(se.onHeaders),se.onMessage&&ae.onMessage(se.onMessage),se.onEnd&&ae.onEnd(se.onEnd),ae.start(se.metadata),ae.send(se.request),ae.finishSend(),{close:function(){ae.close()}}}},65:function(K,te,ne){Object.defineProperty(te,"__esModule",{value:!0}),te.Metadata=void 0;var oe=ne(418);Object.defineProperty(te,"Metadata",{enumerable:!0,get:function(){return oe.BrowserHeaders}})},57:function(K,te,ne){Object.defineProperty(te,"__esModule",{value:!0}),te.makeDefaultTransport=te.setDefaultTransportFactory=void 0;var oe=ne(859),ie=function(se){return oe.CrossBrowserHttpTransport({withCredentials:!1})(se)};te.setDefaultTransportFactory=function(se){ie=se},te.makeDefaultTransport=function(se){return ie(se)}},229:function(K,te,ne){var oe=this&&this.__assign||function(){return(oe=Object.assign||function(ge){for(var ce,de=1,pe=arguments.length;de<pe;de++)for(var fe in ce=arguments[de])Object.prototype.hasOwnProperty.call(ce,fe)&&(ge[fe]=ce[fe]);return ge}).apply(this,arguments)};Object.defineProperty(te,"__esModule",{value:!0}),te.detectFetchSupport=te.FetchReadableStreamTransport=void 0;var ie=ne(65),se=ne(346);te.FetchReadableStreamTransport=function(ge){return function(ce){return function(de,pe){return de.debug&&se.debug("fetchRequest",de),new ae(de,pe)}(ce,ge)}};var ae=function(){function ge(ce,de){this.cancelled=!1,this.controller=self.AbortController&&new AbortController,this.options=ce,this.init=de}return ge.prototype.pump=function(ce,de){var pe=this;if(this.reader=ce,this.cancelled)return this.options.debug&&se.debug("Fetch.pump.cancel at first pump"),void this.reader.cancel().catch(function(fe){pe.options.debug&&se.debug("Fetch.pump.reader.cancel exception",fe)});this.reader.read().then(function(fe){if(fe.done)return pe.options.onEnd(),de;pe.options.onChunk(fe.value),pe.pump(pe.reader,de)}).catch(function(fe){pe.cancelled?pe.options.debug&&se.debug("Fetch.catch - request cancelled"):(pe.cancelled=!0,pe.options.debug&&se.debug("Fetch.catch",fe.message),pe.options.onEnd(fe))})},ge.prototype.send=function(ce){var de=this;fetch(this.options.url,oe(oe({},this.init),{headers:this.metadata.toHeaders(),method:"POST",body:ce,signal:this.controller&&this.controller.signal})).then(function(pe){if(de.options.debug&&se.debug("Fetch.response",pe),de.options.onHeaders(new ie.Metadata(pe.headers),pe.status),!pe.body)return pe;de.pump(pe.body.getReader(),pe)}).catch(function(pe){de.cancelled?de.options.debug&&se.debug("Fetch.catch - request cancelled"):(de.cancelled=!0,de.options.debug&&se.debug("Fetch.catch",pe.message),de.options.onEnd(pe))})},ge.prototype.sendMessage=function(ce){this.send(ce)},ge.prototype.finishSend=function(){},ge.prototype.start=function(ce){this.metadata=ce},ge.prototype.cancel=function(){var ce=this;this.cancelled?this.options.debug&&se.debug("Fetch.cancel already cancelled"):(this.cancelled=!0,this.controller?(this.options.debug&&se.debug("Fetch.cancel.controller.abort"),this.controller.abort()):this.options.debug&&se.debug("Fetch.cancel.missing abort controller"),this.reader?(this.options.debug&&se.debug("Fetch.cancel.reader.cancel"),this.reader.cancel().catch(function(de){ce.options.debug&&se.debug("Fetch.cancel.reader.cancel exception",de)})):this.options.debug&&se.debug("Fetch.cancel before reader"))},ge}();te.detectFetchSupport=function(){return typeof Response<"u"&&Response.prototype.hasOwnProperty("body")&&typeof Headers=="function"}},859:function(K,te,ne){Object.defineProperty(te,"__esModule",{value:!0}),te.CrossBrowserHttpTransport=void 0;var oe=ne(229),ie=ne(210);te.CrossBrowserHttpTransport=function(se){if(oe.detectFetchSupport()){var ae={credentials:se.withCredentials?"include":"same-origin"};return oe.FetchReadableStreamTransport(ae)}return ie.XhrTransport({withCredentials:se.withCredentials})}},210:function(K,te,ne){var oe,ie=this&&this.__extends||(oe=function(be,me){return(oe=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(ye,ve){ye.__proto__=ve}||function(ye,ve){for(var Be in ve)Object.prototype.hasOwnProperty.call(ve,Be)&&(ye[Be]=ve[Be])})(be,me)},function(be,me){function ye(){this.constructor=be}oe(be,me),be.prototype=me===null?Object.create(me):(ye.prototype=me.prototype,new ye)});Object.defineProperty(te,"__esModule",{value:!0}),te.stringToArrayBuffer=te.MozChunkedArrayBufferXHR=te.XHR=te.XhrTransport=void 0;var se=ne(65),ae=ne(346),ge=ne(849);te.XhrTransport=function(be){return function(me){if(ge.detectMozXHRSupport())return new de(me,be);if(ge.detectXHROverrideMimeTypeSupport())return new ce(me,be);throw new Error("This environment's XHR implementation cannot support binary transfer.")}};var ce=function(){function be(me,ye){this.options=me,this.init=ye}return be.prototype.onProgressEvent=function(){this.options.debug&&ae.debug("XHR.onProgressEvent.length: ",this.xhr.response.length);var me=this.xhr.response.substr(this.index);this.index=this.xhr.response.length;var ye=fe(me);this.options.onChunk(ye)},be.prototype.onLoadEvent=function(){this.options.debug&&ae.debug("XHR.onLoadEvent"),this.options.onEnd()},be.prototype.onStateChange=function(){this.options.debug&&ae.debug("XHR.onStateChange",this.xhr.readyState),this.xhr.readyState===XMLHttpRequest.HEADERS_RECEIVED&&this.options.onHeaders(new se.Metadata(this.xhr.getAllResponseHeaders()),this.xhr.status)},be.prototype.sendMessage=function(me){this.xhr.send(me)},be.prototype.finishSend=function(){},be.prototype.start=function(me){var ye=this;this.metadata=me;var ve=new XMLHttpRequest;this.xhr=ve,ve.open("POST",this.options.url),this.configureXhr(),this.metadata.forEach(function(Be,Re){ve.setRequestHeader(Be,Re.join(", "))}),ve.withCredentials=!!this.init.withCredentials,ve.addEventListener("readystatechange",this.onStateChange.bind(this)),ve.addEventListener("progress",this.onProgressEvent.bind(this)),ve.addEventListener("loadend",this.onLoadEvent.bind(this)),ve.addEventListener("error",function(Be){ye.options.debug&&ae.debug("XHR.error",Be),ye.options.onEnd(Be.error)})},be.prototype.configureXhr=function(){this.xhr.responseType="text",this.xhr.overrideMimeType("text/plain; charset=x-user-defined")},be.prototype.cancel=function(){this.options.debug&&ae.debug("XHR.abort"),this.xhr.abort()},be}();te.XHR=ce;var de=function(be){function me(){return be!==null&&be.apply(this,arguments)||this}return ie(me,be),me.prototype.configureXhr=function(){this.options.debug&&ae.debug("MozXHR.configureXhr: setting responseType to 'moz-chunked-arraybuffer'"),this.xhr.responseType="moz-chunked-arraybuffer"},me.prototype.onProgressEvent=function(){var ye=this.xhr.response;this.options.debug&&ae.debug("MozXHR.onProgressEvent: ",new Uint8Array(ye)),this.options.onChunk(new Uint8Array(ye))},me}(ce);function pe(be,me){var ye=be.charCodeAt(me);if(ye>=55296&&ye<=56319){var ve=be.charCodeAt(me+1);ve>=56320&&ve<=57343&&(ye=65536+(ye-55296<<10)+(ve-56320))}return ye}function fe(be){for(var me=new Uint8Array(be.length),ye=0,ve=0;ve<be.length;ve++){var Be=String.prototype.codePointAt?be.codePointAt(ve):pe(be,ve);me[ye++]=255&Be}return me}te.MozChunkedArrayBufferXHR=de,te.stringToArrayBuffer=fe},849:function(K,te){var ne;function oe(){if(ne!==void 0)return ne;if(XMLHttpRequest){ne=new XMLHttpRequest;try{ne.open("GET","https://localhost")}catch{}}return ne}function ie(se){var ae=oe();if(!ae)return!1;try{return ae.responseType=se,ae.responseType===se}catch{}return!1}Object.defineProperty(te,"__esModule",{value:!0}),te.detectXHROverrideMimeTypeSupport=te.detectMozXHRSupport=te.xhrSupportsResponseType=void 0,te.xhrSupportsResponseType=ie,te.detectMozXHRSupport=function(){return typeof XMLHttpRequest<"u"&&ie("moz-chunked-arraybuffer")},te.detectXHROverrideMimeTypeSupport=function(){return typeof XMLHttpRequest<"u"&&XMLHttpRequest.prototype.hasOwnProperty("overrideMimeType")}},540:function(K,te,ne){Object.defineProperty(te,"__esModule",{value:!0}),te.WebsocketTransport=void 0;var oe,ie=ne(346),se=ne(617);(function(ge){ge[ge.FINISH_SEND=1]="FINISH_SEND"})(oe||(oe={}));var ae=new Uint8Array([1]);te.WebsocketTransport=function(){return function(ge){return function(ce){ce.debug&&ie.debug("websocketRequest",ce);var de,pe=function(me){if(me.substr(0,8)==="https://")return"wss://"+me.substr(8);if(me.substr(0,7)==="http://")return"ws://"+me.substr(7);throw new Error("Websocket transport constructed with non-https:// or http:// host.")}(ce.url),fe=[];function be(me){if(me===oe.FINISH_SEND)de.send(ae);else{var ye=me,ve=new Int8Array(ye.byteLength+1);ve.set(new Uint8Array([0])),ve.set(ye,1),de.send(ve)}}return{sendMessage:function(me){de&&de.readyState!==de.CONNECTING?be(me):fe.push(me)},finishSend:function(){de&&de.readyState!==de.CONNECTING?be(oe.FINISH_SEND):fe.push(oe.FINISH_SEND)},start:function(me){(de=new WebSocket(pe,["grpc-websockets"])).binaryType="arraybuffer",de.onopen=function(){var ye;ce.debug&&ie.debug("websocketRequest.onopen"),de.send((ye="",me.forEach(function(ve,Be){ye+=ve+": "+Be.join(", ")+`\r
`}),se.encodeASCII(ye))),fe.forEach(function(ve){be(ve)})},de.onclose=function(ye){ce.debug&&ie.debug("websocketRequest.onclose",ye),ce.onEnd()},de.onerror=function(ye){ce.debug&&ie.debug("websocketRequest.onerror",ye)},de.onmessage=function(ye){ce.onChunk(new Uint8Array(ye.data))}},cancel:function(){ce.debug&&ie.debug("websocket.abort"),de.close()}}}(ge)}}},35:function(K,te,ne){Object.defineProperty(te,"__esModule",{value:!0}),te.unary=void 0;var oe=ne(65),ie=ne(934);te.unary=function(se,ae){if(se.responseStream)throw new Error(".unary cannot be used with server-streaming methods. Use .invoke or .client instead.");if(se.requestStream)throw new Error(".unary cannot be used with client-streaming methods. Use .client instead.");var ge=null,ce=null,de=ie.client(se,{host:ae.host,transport:ae.transport,debug:ae.debug});return de.onHeaders(function(pe){ge=pe}),de.onMessage(function(pe){ce=pe}),de.onEnd(function(pe,fe,be){ae.onEnd({status:pe,statusMessage:fe,headers:ge||new oe.Metadata,message:ce,trailers:be})}),de.start(ae.metadata),de.send(ae.request),de.finishSend(),{close:function(){de.close()}}}},882:function(K,te){Object.defineProperty(te,"__esModule",{value:!0}),te.frameRequest=void 0,te.frameRequest=function(ne){var oe=ne.serializeBinary(),ie=new ArrayBuffer(oe.byteLength+5);return new DataView(ie,1,4).setUint32(0,oe.length,!1),new Uint8Array(ie,5).set(oe),new Uint8Array(ie)}}},_={},function K(te){if(_[te])return _[te].exports;var ne=_[te]={exports:{}};return Z[te].call(ne.exports,ne,ne.exports,K),ne.exports}(607))},339:function(__unused_webpack_module,exports,__webpack_require__){var $jscomp=$jscomp||{};$jscomp.scope={},$jscomp.findInternal=function(X,Z,_){X instanceof String&&(X=String(X));for(var K=X.length,te=0;te<K;te++){var ne=X[te];if(Z.call(_,ne,te,X))return{i:te,v:ne}}return{i:-1,v:void 0}},$jscomp.ASSUME_ES5=!1,$jscomp.ASSUME_NO_NATIVE_MAP=!1,$jscomp.ASSUME_NO_NATIVE_SET=!1,$jscomp.SIMPLE_FROUND_POLYFILL=!1,$jscomp.defineProperty=$jscomp.ASSUME_ES5||typeof Object.defineProperties=="function"?Object.defineProperty:function(X,Z,_){X!=Array.prototype&&X!=Object.prototype&&(X[Z]=_.value)},$jscomp.getGlobal=function(X){return typeof window<"u"&&window===X?X:__webpack_require__.g!==void 0&&__webpack_require__.g!=null?__webpack_require__.g:X},$jscomp.global=$jscomp.getGlobal(this),$jscomp.polyfill=function(X,Z,_,K){if(Z){for(_=$jscomp.global,X=X.split("."),K=0;K<X.length-1;K++){var te=X[K];te in _||(_[te]={}),_=_[te]}(Z=Z(K=_[X=X[X.length-1]]))!=K&&Z!=null&&$jscomp.defineProperty(_,X,{configurable:!0,writable:!0,value:Z})}},$jscomp.polyfill("Array.prototype.findIndex",function(X){return X||function(Z,_){return $jscomp.findInternal(this,Z,_).i}},"es6","es3"),$jscomp.checkStringArgs=function(X,Z,_){if(X==null)throw new TypeError("The 'this' value for String.prototype."+_+" must not be null or undefined");if(Z instanceof RegExp)throw new TypeError("First argument to String.prototype."+_+" must not be a regular expression");return X+""},$jscomp.polyfill("String.prototype.endsWith",function(X){return X||function(Z,_){var K=$jscomp.checkStringArgs(this,Z,"endsWith");Z+="",_===void 0&&(_=K.length),_=Math.max(0,Math.min(0|_,K.length));for(var te=Z.length;0<te&&0<_;)if(K[--_]!=Z[--te])return!1;return 0>=te}},"es6","es3"),$jscomp.polyfill("Array.prototype.find",function(X){return X||function(Z,_){return $jscomp.findInternal(this,Z,_).v}},"es6","es3"),$jscomp.polyfill("String.prototype.startsWith",function(X){return X||function(Z,_){var K=$jscomp.checkStringArgs(this,Z,"startsWith");Z+="";var te=K.length,ne=Z.length;_=Math.max(0,Math.min(0|_,K.length));for(var oe=0;oe<ne&&_<te;)if(K[_++]!=Z[oe++])return!1;return oe>=ne}},"es6","es3"),$jscomp.polyfill("String.prototype.repeat",function(X){return X||function(Z){var _=$jscomp.checkStringArgs(this,null,"repeat");if(0>Z||1342177279<Z)throw new RangeError("Invalid count value");Z|=0;for(var K="";Z;)1&Z&&(K+=_),(Z>>>=1)&&(_+=_);return K}},"es6","es3");var goog=goog||{};goog.global=this||self,goog.exportPath_=function(X,Z,_){X=X.split("."),_=_||goog.global,X[0]in _||_.execScript===void 0||_.execScript("var "+X[0]);for(var K;X.length&&(K=X.shift());)X.length||Z===void 0?_=_[K]&&_[K]!==Object.prototype[K]?_[K]:_[K]={}:_[K]=Z},goog.define=function(X,Z){return Z},goog.FEATURESET_YEAR=2012,goog.DEBUG=!0,goog.LOCALE="en",goog.TRUSTED_SITE=!0,goog.STRICT_MODE_COMPATIBLE=!1,goog.DISALLOW_TEST_ONLY_CODE=!goog.DEBUG,goog.ENABLE_CHROME_APP_SAFE_SCRIPT_LOADING=!1,goog.provide=function(X){if(goog.isInModuleLoader_())throw Error("goog.provide cannot be used within a module.");goog.constructNamespace_(X)},goog.constructNamespace_=function(X,Z){goog.exportPath_(X,Z)},goog.getScriptNonce=function(X){return X&&X!=goog.global?goog.getScriptNonce_(X.document):(goog.cspNonce_===null&&(goog.cspNonce_=goog.getScriptNonce_(goog.global.document)),goog.cspNonce_)},goog.NONCE_PATTERN_=/^[\w+/_-]+[=]{0,2}$/,goog.cspNonce_=null,goog.getScriptNonce_=function(X){return(X=X.querySelector&&X.querySelector("script[nonce]"))&&(X=X.nonce||X.getAttribute("nonce"))&&goog.NONCE_PATTERN_.test(X)?X:""},goog.VALID_MODULE_RE_=/^[a-zA-Z_$][a-zA-Z0-9._$]*$/,goog.module=function(X){if(typeof X!="string"||!X||X.search(goog.VALID_MODULE_RE_)==-1)throw Error("Invalid module identifier");if(!goog.isInGoogModuleLoader_())throw Error("Module "+X+" has been loaded incorrectly. Note, modules cannot be loaded as normal scripts. They require some kind of pre-processing step. You're likely trying to load a module via a script tag or as a part of a concatenated bundle without rewriting the module. For more info see: https://github.com/google/closure-library/wiki/goog.module:-an-ES6-module-like-alternative-to-goog.provide.");if(goog.moduleLoaderState_.moduleName)throw Error("goog.module may only be called once per module.");goog.moduleLoaderState_.moduleName=X},goog.module.get=function(X){return goog.module.getInternal_(X)},goog.module.getInternal_=function(X){return null},goog.ModuleType={ES6:"es6",GOOG:"goog"},goog.moduleLoaderState_=null,goog.isInModuleLoader_=function(){return goog.isInGoogModuleLoader_()||goog.isInEs6ModuleLoader_()},goog.isInGoogModuleLoader_=function(){return!!goog.moduleLoaderState_&&goog.moduleLoaderState_.type==goog.ModuleType.GOOG},goog.isInEs6ModuleLoader_=function(){if(goog.moduleLoaderState_&&goog.moduleLoaderState_.type==goog.ModuleType.ES6)return!0;var X=goog.global.$jscomp;return!!X&&typeof X.getCurrentModulePath=="function"&&!!X.getCurrentModulePath()},goog.module.declareLegacyNamespace=function(){goog.moduleLoaderState_.declareLegacyNamespace=!0},goog.declareModuleId=function(X){if(goog.moduleLoaderState_)goog.moduleLoaderState_.moduleName=X;else{var Z=goog.global.$jscomp;if(!Z||typeof Z.getCurrentModulePath!="function")throw Error('Module with namespace "'+X+'" has been loaded incorrectly.');Z=Z.require(Z.getCurrentModulePath()),goog.loadedModules_[X]={exports:Z,type:goog.ModuleType.ES6,moduleId:X}}},goog.setTestOnly=function(X){if(goog.DISALLOW_TEST_ONLY_CODE)throw X=X||"",Error("Importing test-only code into non-debug environment"+(X?": "+X:"."))},goog.forwardDeclare=function(X){},goog.getObjectByName=function(X,Z){X=X.split("."),Z=Z||goog.global;for(var _=0;_<X.length;_++)if((Z=Z[X[_]])==null)return null;return Z},goog.globalize=function(X,Z){for(var _ in Z=Z||goog.global,X)Z[_]=X[_]},goog.addDependency=function(X,Z,_,K){},goog.ENABLE_DEBUG_LOADER=!0,goog.logToConsole_=function(X){goog.global.console&&goog.global.console.error(X)},goog.require=function(X){},goog.requireType=function(X){return{}},goog.basePath="",goog.nullFunction=function(){},goog.abstractMethod=function(){throw Error("unimplemented abstract method")},goog.addSingletonGetter=function(X){X.instance_=void 0,X.getInstance=function(){return X.instance_?X.instance_:(goog.DEBUG&&(goog.instantiatedSingletons_[goog.instantiatedSingletons_.length]=X),X.instance_=new X)}},goog.instantiatedSingletons_=[],goog.LOAD_MODULE_USING_EVAL=!0,goog.SEAL_MODULE_EXPORTS=goog.DEBUG,goog.loadedModules_={},goog.DEPENDENCIES_ENABLED=!1,goog.TRANSPILE="detect",goog.ASSUME_ES_MODULES_TRANSPILED=!1,goog.TRANSPILE_TO_LANGUAGE="",goog.TRANSPILER="transpile.js",goog.hasBadLetScoping=null,goog.useSafari10Workaround=function(){if(goog.hasBadLetScoping==null){try{var a=!eval('"use strict";let x = 1; function f() { return typeof x; };f() == "number";')}catch(X){a=!1}goog.hasBadLetScoping=a}return goog.hasBadLetScoping},goog.workaroundSafari10EvalBug=function(X){return"(function(){"+X+`
;})();
`},goog.loadModule=function(X){var Z=goog.moduleLoaderState_;try{if(goog.moduleLoaderState_={moduleName:"",declareLegacyNamespace:!1,type:goog.ModuleType.GOOG},goog.isFunction(X))var _=X.call(void 0,{});else{if(typeof X!="string")throw Error("Invalid module definition");goog.useSafari10Workaround()&&(X=goog.workaroundSafari10EvalBug(X)),_=goog.loadModuleFromSource_.call(void 0,X)}var K=goog.moduleLoaderState_.moduleName;if(typeof K!="string"||!K)throw Error('Invalid module name "'+K+'"');goog.moduleLoaderState_.declareLegacyNamespace?goog.constructNamespace_(K,_):goog.SEAL_MODULE_EXPORTS&&Object.seal&&typeof _=="object"&&_!=null&&Object.seal(_),goog.loadedModules_[K]={exports:_,type:goog.ModuleType.GOOG,moduleId:goog.moduleLoaderState_.moduleName}}finally{goog.moduleLoaderState_=Z}},goog.loadModuleFromSource_=function(a){return eval(a),{}},goog.normalizePath_=function(X){X=X.split("/");for(var Z=0;Z<X.length;)X[Z]=="."?X.splice(Z,1):Z&&X[Z]==".."&&X[Z-1]&&X[Z-1]!=".."?X.splice(--Z,2):Z++;return X.join("/")},goog.loadFileSync_=function(X){if(goog.global.CLOSURE_LOAD_FILE_SYNC)return goog.global.CLOSURE_LOAD_FILE_SYNC(X);try{var Z=new goog.global.XMLHttpRequest;return Z.open("get",X,!1),Z.send(),Z.status==0||Z.status==200?Z.responseText:null}catch{return null}},goog.transpile_=function(X,Z,_){var K=goog.global.$jscomp;K||(goog.global.$jscomp=K={});var te=K.transpile;if(!te){var ne=goog.basePath+goog.TRANSPILER,oe=goog.loadFileSync_(ne);if(oe){if((function(){(0,eval)(oe+`
//# sourceURL=`+ne)}).call(goog.global),goog.global.$gwtExport&&goog.global.$gwtExport.$jscomp&&!goog.global.$gwtExport.$jscomp.transpile)throw Error('The transpiler did not properly export the "transpile" method. $gwtExport: '+JSON.stringify(goog.global.$gwtExport));goog.global.$jscomp.transpile=goog.global.$gwtExport.$jscomp.transpile,te=(K=goog.global.$jscomp).transpile}}return te||(te=K.transpile=function(ie,se){return goog.logToConsole_(se+" requires transpilation but no transpiler was found."),ie}),te(X,Z,_)},goog.typeOf=function(X){var Z=typeof X;if(Z=="object"){if(!X)return"null";if(X instanceof Array)return"array";if(X instanceof Object)return Z;var _=Object.prototype.toString.call(X);if(_=="[object Window]")return"object";if(_=="[object Array]"||typeof X.length=="number"&&X.splice!==void 0&&X.propertyIsEnumerable!==void 0&&!X.propertyIsEnumerable("splice"))return"array";if(_=="[object Function]"||X.call!==void 0&&X.propertyIsEnumerable!==void 0&&!X.propertyIsEnumerable("call"))return"function"}else if(Z=="function"&&X.call===void 0)return"object";return Z},goog.isArray=function(X){return goog.typeOf(X)=="array"},goog.isArrayLike=function(X){var Z=goog.typeOf(X);return Z=="array"||Z=="object"&&typeof X.length=="number"},goog.isDateLike=function(X){return goog.isObject(X)&&typeof X.getFullYear=="function"},goog.isFunction=function(X){return goog.typeOf(X)=="function"},goog.isObject=function(X){var Z=typeof X;return Z=="object"&&X!=null||Z=="function"},goog.getUid=function(X){return Object.prototype.hasOwnProperty.call(X,goog.UID_PROPERTY_)&&X[goog.UID_PROPERTY_]||(X[goog.UID_PROPERTY_]=++goog.uidCounter_)},goog.hasUid=function(X){return!!X[goog.UID_PROPERTY_]},goog.removeUid=function(X){X!==null&&"removeAttribute"in X&&X.removeAttribute(goog.UID_PROPERTY_);try{delete X[goog.UID_PROPERTY_]}catch{}},goog.UID_PROPERTY_="closure_uid_"+(1e9*Math.random()>>>0),goog.uidCounter_=0,goog.getHashCode=goog.getUid,goog.removeHashCode=goog.removeUid,goog.cloneObject=function(X){var Z=goog.typeOf(X);if(Z=="object"||Z=="array"){if(typeof X.clone=="function")return X.clone();for(var _ in Z=Z=="array"?[]:{},X)Z[_]=goog.cloneObject(X[_]);return Z}return X},goog.bindNative_=function(X,Z,_){return X.call.apply(X.bind,arguments)},goog.bindJs_=function(X,Z,_){if(!X)throw Error();if(2<arguments.length){var K=Array.prototype.slice.call(arguments,2);return function(){var te=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(te,K),X.apply(Z,te)}}return function(){return X.apply(Z,arguments)}},goog.bind=function(X,Z,_){return Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?goog.bind=goog.bindNative_:goog.bind=goog.bindJs_,goog.bind.apply(null,arguments)},goog.partial=function(X,Z){var _=Array.prototype.slice.call(arguments,1);return function(){var K=_.slice();return K.push.apply(K,arguments),X.apply(this,K)}},goog.mixin=function(X,Z){for(var _ in Z)X[_]=Z[_]},goog.now=goog.TRUSTED_SITE&&Date.now||function(){return+new Date},goog.globalEval=function(X){if(goog.global.execScript)goog.global.execScript(X,"JavaScript");else{if(!goog.global.eval)throw Error("goog.globalEval not available");if(goog.evalWorksForGlobals_==null){try{goog.global.eval("var _evalTest_ = 1;")}catch{}if(goog.global._evalTest_!==void 0){try{delete goog.global._evalTest_}catch{}goog.evalWorksForGlobals_=!0}else goog.evalWorksForGlobals_=!1}if(goog.evalWorksForGlobals_)goog.global.eval(X);else{var Z=goog.global.document,_=Z.createElement("script");_.type="text/javascript",_.defer=!1,_.appendChild(Z.createTextNode(X)),Z.head.appendChild(_),Z.head.removeChild(_)}}},goog.evalWorksForGlobals_=null,goog.getCssName=function(X,Z){if(String(X).charAt(0)==".")throw Error('className passed in goog.getCssName must not start with ".". You passed: '+X);var _=function(te){return goog.cssNameMapping_[te]||te},K=function(te){te=te.split("-");for(var ne=[],oe=0;oe<te.length;oe++)ne.push(_(te[oe]));return ne.join("-")};return K=goog.cssNameMapping_?goog.cssNameMappingStyle_=="BY_WHOLE"?_:K:function(te){return te},X=Z?X+"-"+K(Z):K(X),goog.global.CLOSURE_CSS_NAME_MAP_FN?goog.global.CLOSURE_CSS_NAME_MAP_FN(X):X},goog.setCssNameMapping=function(X,Z){goog.cssNameMapping_=X,goog.cssNameMappingStyle_=Z},goog.getMsg=function(X,Z,_){return _&&_.html&&(X=X.replace(/</g,"&lt;")),Z&&(X=X.replace(/\{\$([^}]+)}/g,function(K,te){return Z!=null&&te in Z?Z[te]:K})),X},goog.getMsgWithFallback=function(X,Z){return X},goog.exportSymbol=function(X,Z,_){goog.exportPath_(X,Z,_)},goog.exportProperty=function(X,Z,_){X[Z]=_},goog.inherits=function(X,Z){function _(){}_.prototype=Z.prototype,X.superClass_=Z.prototype,X.prototype=new _,X.prototype.constructor=X,X.base=function(K,te,ne){for(var oe=Array(arguments.length-2),ie=2;ie<arguments.length;ie++)oe[ie-2]=arguments[ie];return Z.prototype[te].apply(K,oe)}},goog.scope=function(X){if(goog.isInModuleLoader_())throw Error("goog.scope is not supported within a module.");X.call(goog.global)},goog.defineClass=function(X,Z){var _=Z.constructor,K=Z.statics;return _&&_!=Object.prototype.constructor||(_=function(){throw Error("cannot instantiate an interface (no constructor defined).")}),_=goog.defineClass.createSealingConstructor_(_,X),X&&goog.inherits(_,X),delete Z.constructor,delete Z.statics,goog.defineClass.applyProperties_(_.prototype,Z),K!=null&&(K instanceof Function?K(_):goog.defineClass.applyProperties_(_,K)),_},goog.defineClass.SEAL_CLASS_INSTANCES=goog.DEBUG,goog.defineClass.createSealingConstructor_=function(X,Z){if(!goog.defineClass.SEAL_CLASS_INSTANCES)return X;var _=!goog.defineClass.isUnsealable_(Z),K=function(){var te=X.apply(this,arguments)||this;return te[goog.UID_PROPERTY_]=te[goog.UID_PROPERTY_],this.constructor===K&&_&&Object.seal instanceof Function&&Object.seal(te),te};return K},goog.defineClass.isUnsealable_=function(X){return X&&X.prototype&&X.prototype[goog.UNSEALABLE_CONSTRUCTOR_PROPERTY_]},goog.defineClass.OBJECT_PROTOTYPE_FIELDS_="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" "),goog.defineClass.applyProperties_=function(X,Z){for(var _ in Z)Object.prototype.hasOwnProperty.call(Z,_)&&(X[_]=Z[_]);for(var K=0;K<goog.defineClass.OBJECT_PROTOTYPE_FIELDS_.length;K++)_=goog.defineClass.OBJECT_PROTOTYPE_FIELDS_[K],Object.prototype.hasOwnProperty.call(Z,_)&&(X[_]=Z[_])},goog.tagUnsealableClass=function(X){},goog.UNSEALABLE_CONSTRUCTOR_PROPERTY_="goog_defineClass_legacy_unsealable",goog.TRUSTED_TYPES_POLICY_NAME="",goog.identity_=function(X){return X},goog.createTrustedTypesPolicy=function(X){var Z=null,_=goog.global.trustedTypes||goog.global.TrustedTypes;if(!_||!_.createPolicy)return Z;try{Z=_.createPolicy(X,{createHTML:goog.identity_,createScript:goog.identity_,createScriptURL:goog.identity_,createURL:goog.identity_})}catch(K){goog.logToConsole_(K.message)}return Z},goog.TRUSTED_TYPES_POLICY_=goog.TRUSTED_TYPES_POLICY_NAME?goog.createTrustedTypesPolicy(goog.TRUSTED_TYPES_POLICY_NAME+"#base"):null,goog.object={},goog.object.is=function(X,Z){return X===Z?X!==0||1/X==1/Z:X!=X&&Z!=Z},goog.object.forEach=function(X,Z,_){for(var K in X)Z.call(_,X[K],K,X)},goog.object.filter=function(X,Z,_){var K,te={};for(K in X)Z.call(_,X[K],K,X)&&(te[K]=X[K]);return te},goog.object.map=function(X,Z,_){var K,te={};for(K in X)te[K]=Z.call(_,X[K],K,X);return te},goog.object.some=function(X,Z,_){for(var K in X)if(Z.call(_,X[K],K,X))return!0;return!1},goog.object.every=function(X,Z,_){for(var K in X)if(!Z.call(_,X[K],K,X))return!1;return!0},goog.object.getCount=function(X){var Z,_=0;for(Z in X)_++;return _},goog.object.getAnyKey=function(X){for(var Z in X)return Z},goog.object.getAnyValue=function(X){for(var Z in X)return X[Z]},goog.object.contains=function(X,Z){return goog.object.containsValue(X,Z)},goog.object.getValues=function(X){var Z,_=[],K=0;for(Z in X)_[K++]=X[Z];return _},goog.object.getKeys=function(X){var Z,_=[],K=0;for(Z in X)_[K++]=Z;return _},goog.object.getValueByKeys=function(X,Z){var _=goog.isArrayLike(Z),K=_?Z:arguments;for(_=_?0:1;_<K.length;_++){if(X==null)return;X=X[K[_]]}return X},goog.object.containsKey=function(X,Z){return X!==null&&Z in X},goog.object.containsValue=function(X,Z){for(var _ in X)if(X[_]==Z)return!0;return!1},goog.object.findKey=function(X,Z,_){for(var K in X)if(Z.call(_,X[K],K,X))return K},goog.object.findValue=function(X,Z,_){return(Z=goog.object.findKey(X,Z,_))&&X[Z]},goog.object.isEmpty=function(X){for(var Z in X)return!1;return!0},goog.object.clear=function(X){for(var Z in X)delete X[Z]},goog.object.remove=function(X,Z){var _;return(_=Z in X)&&delete X[Z],_},goog.object.add=function(X,Z,_){if(X!==null&&Z in X)throw Error('The object already contains the key "'+Z+'"');goog.object.set(X,Z,_)},goog.object.get=function(X,Z,_){return X!==null&&Z in X?X[Z]:_},goog.object.set=function(X,Z,_){X[Z]=_},goog.object.setIfUndefined=function(X,Z,_){return Z in X?X[Z]:X[Z]=_},goog.object.setWithReturnValueIfNotSet=function(X,Z,_){return Z in X?X[Z]:(_=_(),X[Z]=_)},goog.object.equals=function(X,Z){for(var _ in X)if(!(_ in Z)||X[_]!==Z[_])return!1;for(var K in Z)if(!(K in X))return!1;return!0},goog.object.clone=function(X){var Z,_={};for(Z in X)_[Z]=X[Z];return _},goog.object.unsafeClone=function(X){var Z=goog.typeOf(X);if(Z=="object"||Z=="array"){if(goog.isFunction(X.clone))return X.clone();for(var _ in Z=Z=="array"?[]:{},X)Z[_]=goog.object.unsafeClone(X[_]);return Z}return X},goog.object.transpose=function(X){var Z,_={};for(Z in X)_[X[Z]]=Z;return _},goog.object.PROTOTYPE_FIELDS_="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" "),goog.object.extend=function(X,Z){for(var _,K,te=1;te<arguments.length;te++){for(_ in K=arguments[te])X[_]=K[_];for(var ne=0;ne<goog.object.PROTOTYPE_FIELDS_.length;ne++)_=goog.object.PROTOTYPE_FIELDS_[ne],Object.prototype.hasOwnProperty.call(K,_)&&(X[_]=K[_])}},goog.object.create=function(X){var Z=arguments.length;if(Z==1&&Array.isArray(arguments[0]))return goog.object.create.apply(null,arguments[0]);if(Z%2)throw Error("Uneven number of arguments");for(var _={},K=0;K<Z;K+=2)_[arguments[K]]=arguments[K+1];return _},goog.object.createSet=function(X){var Z=arguments.length;if(Z==1&&Array.isArray(arguments[0]))return goog.object.createSet.apply(null,arguments[0]);for(var _={},K=0;K<Z;K++)_[arguments[K]]=!0;return _},goog.object.createImmutableView=function(X){var Z=X;return Object.isFrozen&&!Object.isFrozen(X)&&(Z=Object.create(X),Object.freeze(Z)),Z},goog.object.isImmutableView=function(X){return!!Object.isFrozen&&Object.isFrozen(X)},goog.object.getAllPropertyNames=function(X,Z,_){if(!X)return[];if(!Object.getOwnPropertyNames||!Object.getPrototypeOf)return goog.object.getKeys(X);for(var K={};X&&(X!==Object.prototype||Z)&&(X!==Function.prototype||_);){for(var te=Object.getOwnPropertyNames(X),ne=0;ne<te.length;ne++)K[te[ne]]=!0;X=Object.getPrototypeOf(X)}return goog.object.getKeys(K)},goog.object.getSuperClass=function(X){return(X=Object.getPrototypeOf(X.prototype))&&X.constructor};var jspb={asserts:{}};jspb.asserts.doAssertFailure=function(X,Z,_,K){var te="Assertion failed";if(_){te+=": "+_;var ne=K}else X&&(te+=": "+X,ne=Z);throw Error(""+te,ne||[])},jspb.asserts.assert=function(X,Z,_){for(var K=[],te=2;te<arguments.length;++te)K[te-2]=arguments[te];return X||jspb.asserts.doAssertFailure("",null,Z,K),X},jspb.asserts.assertString=function(X,Z,_){for(var K=[],te=2;te<arguments.length;++te)K[te-2]=arguments[te];return typeof X!="string"&&jspb.asserts.doAssertFailure("Expected string but got %s: %s.",[goog.typeOf(X),X],Z,K),X},jspb.asserts.assertArray=function(X,Z,_){for(var K=[],te=2;te<arguments.length;++te)K[te-2]=arguments[te];return Array.isArray(X)||jspb.asserts.doAssertFailure("Expected array but got %s: %s.",[goog.typeOf(X),X],Z,K),X},jspb.asserts.fail=function(X,Z){for(var _=[],K=1;K<arguments.length;++K)_[K-1]=arguments[K];throw Error("Failure"+(X?": "+X:""),_)},jspb.asserts.assertInstanceof=function(X,Z,_,K){for(var te=[],ne=3;ne<arguments.length;++ne)te[ne-3]=arguments[ne];return X instanceof Z||jspb.asserts.doAssertFailure("Expected instanceof %s but got %s.",[jspb.asserts.getType(Z),jspb.asserts.getType(X)],_,te),X},jspb.asserts.getType=function(X){return X instanceof Function?X.displayName||X.name||"unknown type name":X instanceof Object?X.constructor.displayName||X.constructor.name||Object.prototype.toString.call(X):X===null?"null":typeof X},jspb.BinaryConstants={},jspb.ConstBinaryMessage=function(){},jspb.BinaryMessage=function(){},jspb.BinaryConstants.FieldType={INVALID:-1,DOUBLE:1,FLOAT:2,INT64:3,UINT64:4,INT32:5,FIXED64:6,FIXED32:7,BOOL:8,STRING:9,GROUP:10,MESSAGE:11,BYTES:12,UINT32:13,ENUM:14,SFIXED32:15,SFIXED64:16,SINT32:17,SINT64:18,FHASH64:30,VHASH64:31},jspb.BinaryConstants.WireType={INVALID:-1,VARINT:0,FIXED64:1,DELIMITED:2,START_GROUP:3,END_GROUP:4,FIXED32:5},jspb.BinaryConstants.FieldTypeToWireType=function(X){var Z=jspb.BinaryConstants.FieldType,_=jspb.BinaryConstants.WireType;switch(X){case Z.INT32:case Z.INT64:case Z.UINT32:case Z.UINT64:case Z.SINT32:case Z.SINT64:case Z.BOOL:case Z.ENUM:case Z.VHASH64:return _.VARINT;case Z.DOUBLE:case Z.FIXED64:case Z.SFIXED64:case Z.FHASH64:return _.FIXED64;case Z.STRING:case Z.MESSAGE:case Z.BYTES:return _.DELIMITED;case Z.FLOAT:case Z.FIXED32:case Z.SFIXED32:return _.FIXED32;default:return _.INVALID}},jspb.BinaryConstants.INVALID_FIELD_NUMBER=-1,jspb.BinaryConstants.FLOAT32_EPS=1401298464324817e-60,jspb.BinaryConstants.FLOAT32_MIN=11754943508222875e-54,jspb.BinaryConstants.FLOAT32_MAX=34028234663852886e22,jspb.BinaryConstants.FLOAT64_EPS=5e-324,jspb.BinaryConstants.FLOAT64_MIN=22250738585072014e-324,jspb.BinaryConstants.FLOAT64_MAX=17976931348623157e292,jspb.BinaryConstants.TWO_TO_20=1048576,jspb.BinaryConstants.TWO_TO_23=8388608,jspb.BinaryConstants.TWO_TO_31=2147483648,jspb.BinaryConstants.TWO_TO_32=4294967296,jspb.BinaryConstants.TWO_TO_52=4503599627370496,jspb.BinaryConstants.TWO_TO_63=9223372036854776e3,jspb.BinaryConstants.TWO_TO_64=18446744073709552e3,jspb.BinaryConstants.ZERO_HASH="\0\0\0\0\0\0\0\0",goog.debug={},goog.debug.Error=function(X){if(Error.captureStackTrace)Error.captureStackTrace(this,goog.debug.Error);else{var Z=Error().stack;Z&&(this.stack=Z)}X&&(this.message=String(X)),this.reportErrorToServer=!0},goog.inherits(goog.debug.Error,Error),goog.debug.Error.prototype.name="CustomError",goog.dom={},goog.dom.NodeType={ELEMENT:1,ATTRIBUTE:2,TEXT:3,CDATA_SECTION:4,ENTITY_REFERENCE:5,ENTITY:6,PROCESSING_INSTRUCTION:7,COMMENT:8,DOCUMENT:9,DOCUMENT_TYPE:10,DOCUMENT_FRAGMENT:11,NOTATION:12},goog.asserts={},goog.asserts.ENABLE_ASSERTS=goog.DEBUG,goog.asserts.AssertionError=function(X,Z){goog.debug.Error.call(this,goog.asserts.subs_(X,Z)),this.messagePattern=X},goog.inherits(goog.asserts.AssertionError,goog.debug.Error),goog.asserts.AssertionError.prototype.name="AssertionError",goog.asserts.DEFAULT_ERROR_HANDLER=function(X){throw X},goog.asserts.errorHandler_=goog.asserts.DEFAULT_ERROR_HANDLER,goog.asserts.subs_=function(X,Z){for(var _="",K=(X=X.split("%s")).length-1,te=0;te<K;te++)_+=X[te]+(te<Z.length?Z[te]:"%s");return _+X[K]},goog.asserts.doAssertFailure_=function(X,Z,_,K){var te="Assertion failed";if(_){te+=": "+_;var ne=K}else X&&(te+=": "+X,ne=Z);X=new goog.asserts.AssertionError(""+te,ne||[]),goog.asserts.errorHandler_(X)},goog.asserts.setErrorHandler=function(X){goog.asserts.ENABLE_ASSERTS&&(goog.asserts.errorHandler_=X)},goog.asserts.assert=function(X,Z,_){return goog.asserts.ENABLE_ASSERTS&&!X&&goog.asserts.doAssertFailure_("",null,Z,Array.prototype.slice.call(arguments,2)),X},goog.asserts.assertExists=function(X,Z,_){return goog.asserts.ENABLE_ASSERTS&&X==null&&goog.asserts.doAssertFailure_("Expected to exist: %s.",[X],Z,Array.prototype.slice.call(arguments,2)),X},goog.asserts.fail=function(X,Z){goog.asserts.ENABLE_ASSERTS&&goog.asserts.errorHandler_(new goog.asserts.AssertionError("Failure"+(X?": "+X:""),Array.prototype.slice.call(arguments,1)))},goog.asserts.assertNumber=function(X,Z,_){return goog.asserts.ENABLE_ASSERTS&&typeof X!="number"&&goog.asserts.doAssertFailure_("Expected number but got %s: %s.",[goog.typeOf(X),X],Z,Array.prototype.slice.call(arguments,2)),X},goog.asserts.assertString=function(X,Z,_){return goog.asserts.ENABLE_ASSERTS&&typeof X!="string"&&goog.asserts.doAssertFailure_("Expected string but got %s: %s.",[goog.typeOf(X),X],Z,Array.prototype.slice.call(arguments,2)),X},goog.asserts.assertFunction=function(X,Z,_){return goog.asserts.ENABLE_ASSERTS&&!goog.isFunction(X)&&goog.asserts.doAssertFailure_("Expected function but got %s: %s.",[goog.typeOf(X),X],Z,Array.prototype.slice.call(arguments,2)),X},goog.asserts.assertObject=function(X,Z,_){return goog.asserts.ENABLE_ASSERTS&&!goog.isObject(X)&&goog.asserts.doAssertFailure_("Expected object but got %s: %s.",[goog.typeOf(X),X],Z,Array.prototype.slice.call(arguments,2)),X},goog.asserts.assertArray=function(X,Z,_){return goog.asserts.ENABLE_ASSERTS&&!Array.isArray(X)&&goog.asserts.doAssertFailure_("Expected array but got %s: %s.",[goog.typeOf(X),X],Z,Array.prototype.slice.call(arguments,2)),X},goog.asserts.assertBoolean=function(X,Z,_){return goog.asserts.ENABLE_ASSERTS&&typeof X!="boolean"&&goog.asserts.doAssertFailure_("Expected boolean but got %s: %s.",[goog.typeOf(X),X],Z,Array.prototype.slice.call(arguments,2)),X},goog.asserts.assertElement=function(X,Z,_){return!goog.asserts.ENABLE_ASSERTS||goog.isObject(X)&&X.nodeType==goog.dom.NodeType.ELEMENT||goog.asserts.doAssertFailure_("Expected Element but got %s: %s.",[goog.typeOf(X),X],Z,Array.prototype.slice.call(arguments,2)),X},goog.asserts.assertInstanceof=function(X,Z,_,K){return!goog.asserts.ENABLE_ASSERTS||X instanceof Z||goog.asserts.doAssertFailure_("Expected instanceof %s but got %s.",[goog.asserts.getType_(Z),goog.asserts.getType_(X)],_,Array.prototype.slice.call(arguments,3)),X},goog.asserts.assertFinite=function(X,Z,_){return!goog.asserts.ENABLE_ASSERTS||typeof X=="number"&&isFinite(X)||goog.asserts.doAssertFailure_("Expected %s to be a finite number but it is not.",[X],Z,Array.prototype.slice.call(arguments,2)),X},goog.asserts.assertObjectPrototypeIsIntact=function(){for(var X in Object.prototype)goog.asserts.fail(X+" should not be enumerable in Object.prototype.")},goog.asserts.getType_=function(X){return X instanceof Function?X.displayName||X.name||"unknown type name":X instanceof Object?X.constructor.displayName||X.constructor.name||Object.prototype.toString.call(X):X===null?"null":typeof X},goog.array={},goog.NATIVE_ARRAY_PROTOTYPES=goog.TRUSTED_SITE,goog.array.ASSUME_NATIVE_FUNCTIONS=2012<goog.FEATURESET_YEAR,goog.array.peek=function(X){return X[X.length-1]},goog.array.last=goog.array.peek,goog.array.indexOf=goog.NATIVE_ARRAY_PROTOTYPES&&(goog.array.ASSUME_NATIVE_FUNCTIONS||Array.prototype.indexOf)?function(X,Z,_){return goog.asserts.assert(X.length!=null),Array.prototype.indexOf.call(X,Z,_)}:function(X,Z,_){if(_=_==null?0:0>_?Math.max(0,X.length+_):_,typeof X=="string")return typeof Z!="string"||Z.length!=1?-1:X.indexOf(Z,_);for(;_<X.length;_++)if(_ in X&&X[_]===Z)return _;return-1},goog.array.lastIndexOf=goog.NATIVE_ARRAY_PROTOTYPES&&(goog.array.ASSUME_NATIVE_FUNCTIONS||Array.prototype.lastIndexOf)?function(X,Z,_){return goog.asserts.assert(X.length!=null),Array.prototype.lastIndexOf.call(X,Z,_??X.length-1)}:function(X,Z,_){if(0>(_=_??X.length-1)&&(_=Math.max(0,X.length+_)),typeof X=="string")return typeof Z!="string"||Z.length!=1?-1:X.lastIndexOf(Z,_);for(;0<=_;_--)if(_ in X&&X[_]===Z)return _;return-1},goog.array.forEach=goog.NATIVE_ARRAY_PROTOTYPES&&(goog.array.ASSUME_NATIVE_FUNCTIONS||Array.prototype.forEach)?function(X,Z,_){goog.asserts.assert(X.length!=null),Array.prototype.forEach.call(X,Z,_)}:function(X,Z,_){for(var K=X.length,te=typeof X=="string"?X.split(""):X,ne=0;ne<K;ne++)ne in te&&Z.call(_,te[ne],ne,X)},goog.array.forEachRight=function(X,Z,_){var K=X.length,te=typeof X=="string"?X.split(""):X;for(--K;0<=K;--K)K in te&&Z.call(_,te[K],K,X)},goog.array.filter=goog.NATIVE_ARRAY_PROTOTYPES&&(goog.array.ASSUME_NATIVE_FUNCTIONS||Array.prototype.filter)?function(X,Z,_){return goog.asserts.assert(X.length!=null),Array.prototype.filter.call(X,Z,_)}:function(X,Z,_){for(var K=X.length,te=[],ne=0,oe=typeof X=="string"?X.split(""):X,ie=0;ie<K;ie++)if(ie in oe){var se=oe[ie];Z.call(_,se,ie,X)&&(te[ne++]=se)}return te},goog.array.map=goog.NATIVE_ARRAY_PROTOTYPES&&(goog.array.ASSUME_NATIVE_FUNCTIONS||Array.prototype.map)?function(X,Z,_){return goog.asserts.assert(X.length!=null),Array.prototype.map.call(X,Z,_)}:function(X,Z,_){for(var K=X.length,te=Array(K),ne=typeof X=="string"?X.split(""):X,oe=0;oe<K;oe++)oe in ne&&(te[oe]=Z.call(_,ne[oe],oe,X));return te},goog.array.reduce=goog.NATIVE_ARRAY_PROTOTYPES&&(goog.array.ASSUME_NATIVE_FUNCTIONS||Array.prototype.reduce)?function(X,Z,_,K){return goog.asserts.assert(X.length!=null),K&&(Z=goog.bind(Z,K)),Array.prototype.reduce.call(X,Z,_)}:function(X,Z,_,K){var te=_;return goog.array.forEach(X,function(ne,oe){te=Z.call(K,te,ne,oe,X)}),te},goog.array.reduceRight=goog.NATIVE_ARRAY_PROTOTYPES&&(goog.array.ASSUME_NATIVE_FUNCTIONS||Array.prototype.reduceRight)?function(X,Z,_,K){return goog.asserts.assert(X.length!=null),goog.asserts.assert(Z!=null),K&&(Z=goog.bind(Z,K)),Array.prototype.reduceRight.call(X,Z,_)}:function(X,Z,_,K){var te=_;return goog.array.forEachRight(X,function(ne,oe){te=Z.call(K,te,ne,oe,X)}),te},goog.array.some=goog.NATIVE_ARRAY_PROTOTYPES&&(goog.array.ASSUME_NATIVE_FUNCTIONS||Array.prototype.some)?function(X,Z,_){return goog.asserts.assert(X.length!=null),Array.prototype.some.call(X,Z,_)}:function(X,Z,_){for(var K=X.length,te=typeof X=="string"?X.split(""):X,ne=0;ne<K;ne++)if(ne in te&&Z.call(_,te[ne],ne,X))return!0;return!1},goog.array.every=goog.NATIVE_ARRAY_PROTOTYPES&&(goog.array.ASSUME_NATIVE_FUNCTIONS||Array.prototype.every)?function(X,Z,_){return goog.asserts.assert(X.length!=null),Array.prototype.every.call(X,Z,_)}:function(X,Z,_){for(var K=X.length,te=typeof X=="string"?X.split(""):X,ne=0;ne<K;ne++)if(ne in te&&!Z.call(_,te[ne],ne,X))return!1;return!0},goog.array.count=function(X,Z,_){var K=0;return goog.array.forEach(X,function(te,ne,oe){Z.call(_,te,ne,oe)&&++K},_),K},goog.array.find=function(X,Z,_){return 0>(Z=goog.array.findIndex(X,Z,_))?null:typeof X=="string"?X.charAt(Z):X[Z]},goog.array.findIndex=function(X,Z,_){for(var K=X.length,te=typeof X=="string"?X.split(""):X,ne=0;ne<K;ne++)if(ne in te&&Z.call(_,te[ne],ne,X))return ne;return-1},goog.array.findRight=function(X,Z,_){return 0>(Z=goog.array.findIndexRight(X,Z,_))?null:typeof X=="string"?X.charAt(Z):X[Z]},goog.array.findIndexRight=function(X,Z,_){var K=X.length,te=typeof X=="string"?X.split(""):X;for(--K;0<=K;K--)if(K in te&&Z.call(_,te[K],K,X))return K;return-1},goog.array.contains=function(X,Z){return 0<=goog.array.indexOf(X,Z)},goog.array.isEmpty=function(X){return X.length==0},goog.array.clear=function(X){if(!Array.isArray(X))for(var Z=X.length-1;0<=Z;Z--)delete X[Z];X.length=0},goog.array.insert=function(X,Z){goog.array.contains(X,Z)||X.push(Z)},goog.array.insertAt=function(X,Z,_){goog.array.splice(X,_,0,Z)},goog.array.insertArrayAt=function(X,Z,_){goog.partial(goog.array.splice,X,_,0).apply(null,Z)},goog.array.insertBefore=function(X,Z,_){var K;arguments.length==2||0>(K=goog.array.indexOf(X,_))?X.push(Z):goog.array.insertAt(X,Z,K)},goog.array.remove=function(X,Z){var _;return(_=0<=(Z=goog.array.indexOf(X,Z)))&&goog.array.removeAt(X,Z),_},goog.array.removeLast=function(X,Z){return 0<=(Z=goog.array.lastIndexOf(X,Z))&&(goog.array.removeAt(X,Z),!0)},goog.array.removeAt=function(X,Z){return goog.asserts.assert(X.length!=null),Array.prototype.splice.call(X,Z,1).length==1},goog.array.removeIf=function(X,Z,_){return 0<=(Z=goog.array.findIndex(X,Z,_))&&(goog.array.removeAt(X,Z),!0)},goog.array.removeAllIf=function(X,Z,_){var K=0;return goog.array.forEachRight(X,function(te,ne){Z.call(_,te,ne,X)&&goog.array.removeAt(X,ne)&&K++}),K},goog.array.concat=function(X){return Array.prototype.concat.apply([],arguments)},goog.array.join=function(X){return Array.prototype.concat.apply([],arguments)},goog.array.toArray=function(X){var Z=X.length;if(0<Z){for(var _=Array(Z),K=0;K<Z;K++)_[K]=X[K];return _}return[]},goog.array.clone=goog.array.toArray,goog.array.extend=function(X,Z){for(var _=1;_<arguments.length;_++){var K=arguments[_];if(goog.isArrayLike(K)){var te=X.length||0,ne=K.length||0;X.length=te+ne;for(var oe=0;oe<ne;oe++)X[te+oe]=K[oe]}else X.push(K)}},goog.array.splice=function(X,Z,_,K){return goog.asserts.assert(X.length!=null),Array.prototype.splice.apply(X,goog.array.slice(arguments,1))},goog.array.slice=function(X,Z,_){return goog.asserts.assert(X.length!=null),2>=arguments.length?Array.prototype.slice.call(X,Z):Array.prototype.slice.call(X,Z,_)},goog.array.removeDuplicates=function(X,Z,_){Z=Z||X;var K=function(se){return goog.isObject(se)?"o"+goog.getUid(se):(typeof se).charAt(0)+se};_=_||K,K={};for(var te=0,ne=0;ne<X.length;){var oe=X[ne++],ie=_(oe);Object.prototype.hasOwnProperty.call(K,ie)||(K[ie]=!0,Z[te++]=oe)}Z.length=te},goog.array.binarySearch=function(X,Z,_){return goog.array.binarySearch_(X,_||goog.array.defaultCompare,!1,Z)},goog.array.binarySelect=function(X,Z,_){return goog.array.binarySearch_(X,Z,!0,void 0,_)},goog.array.binarySearch_=function(X,Z,_,K,te){for(var ne,oe=0,ie=X.length;oe<ie;){var se=oe+(ie-oe>>>1),ae=_?Z.call(te,X[se],se,X):Z(K,X[se]);0<ae?oe=se+1:(ie=se,ne=!ae)}return ne?oe:-oe-1},goog.array.sort=function(X,Z){X.sort(Z||goog.array.defaultCompare)},goog.array.stableSort=function(X,Z){for(var _=Array(X.length),K=0;K<X.length;K++)_[K]={index:K,value:X[K]};var te=Z||goog.array.defaultCompare;for(goog.array.sort(_,function(ne,oe){return te(ne.value,oe.value)||ne.index-oe.index}),K=0;K<X.length;K++)X[K]=_[K].value},goog.array.sortByKey=function(X,Z,_){var K=_||goog.array.defaultCompare;goog.array.sort(X,function(te,ne){return K(Z(te),Z(ne))})},goog.array.sortObjectsByKey=function(X,Z,_){goog.array.sortByKey(X,function(K){return K[Z]},_)},goog.array.isSorted=function(X,Z,_){Z=Z||goog.array.defaultCompare;for(var K=1;K<X.length;K++){var te=Z(X[K-1],X[K]);if(0<te||te==0&&_)return!1}return!0},goog.array.equals=function(X,Z,_){if(!goog.isArrayLike(X)||!goog.isArrayLike(Z)||X.length!=Z.length)return!1;var K=X.length;_=_||goog.array.defaultCompareEquality;for(var te=0;te<K;te++)if(!_(X[te],Z[te]))return!1;return!0},goog.array.compare3=function(X,Z,_){_=_||goog.array.defaultCompare;for(var K=Math.min(X.length,Z.length),te=0;te<K;te++){var ne=_(X[te],Z[te]);if(ne!=0)return ne}return goog.array.defaultCompare(X.length,Z.length)},goog.array.defaultCompare=function(X,Z){return X>Z?1:X<Z?-1:0},goog.array.inverseDefaultCompare=function(X,Z){return-goog.array.defaultCompare(X,Z)},goog.array.defaultCompareEquality=function(X,Z){return X===Z},goog.array.binaryInsert=function(X,Z,_){return 0>(_=goog.array.binarySearch(X,Z,_))&&(goog.array.insertAt(X,Z,-(_+1)),!0)},goog.array.binaryRemove=function(X,Z,_){return 0<=(Z=goog.array.binarySearch(X,Z,_))&&goog.array.removeAt(X,Z)},goog.array.bucket=function(X,Z,_){for(var K={},te=0;te<X.length;te++){var ne=X[te],oe=Z.call(_,ne,te,X);oe!==void 0&&(K[oe]||(K[oe]=[])).push(ne)}return K},goog.array.toObject=function(X,Z,_){var K={};return goog.array.forEach(X,function(te,ne){K[Z.call(_,te,ne,X)]=te}),K},goog.array.range=function(X,Z,_){var K=[],te=0,ne=X;if(Z!==void 0&&(te=X,ne=Z),0>(_=_||1)*(ne-te))return[];if(0<_)for(X=te;X<ne;X+=_)K.push(X);else for(X=te;X>ne;X+=_)K.push(X);return K},goog.array.repeat=function(X,Z){for(var _=[],K=0;K<Z;K++)_[K]=X;return _},goog.array.flatten=function(X){for(var Z=[],_=0;_<arguments.length;_++){var K=arguments[_];if(Array.isArray(K))for(var te=0;te<K.length;te+=8192){var ne=goog.array.slice(K,te,te+8192);ne=goog.array.flatten.apply(null,ne);for(var oe=0;oe<ne.length;oe++)Z.push(ne[oe])}else Z.push(K)}return Z},goog.array.rotate=function(X,Z){return goog.asserts.assert(X.length!=null),X.length&&(0<(Z%=X.length)?Array.prototype.unshift.apply(X,X.splice(-Z,Z)):0>Z&&Array.prototype.push.apply(X,X.splice(0,-Z))),X},goog.array.moveItem=function(X,Z,_){goog.asserts.assert(0<=Z&&Z<X.length),goog.asserts.assert(0<=_&&_<X.length),Z=Array.prototype.splice.call(X,Z,1),Array.prototype.splice.call(X,_,0,Z[0])},goog.array.zip=function(X){if(!arguments.length)return[];for(var Z=[],_=arguments[0].length,K=1;K<arguments.length;K++)arguments[K].length<_&&(_=arguments[K].length);for(K=0;K<_;K++){for(var te=[],ne=0;ne<arguments.length;ne++)te.push(arguments[ne][K]);Z.push(te)}return Z},goog.array.shuffle=function(X,Z){Z=Z||Math.random;for(var _=X.length-1;0<_;_--){var K=Math.floor(Z()*(_+1)),te=X[_];X[_]=X[K],X[K]=te}},goog.array.copyByIndex=function(X,Z){var _=[];return goog.array.forEach(Z,function(K){_.push(X[K])}),_},goog.array.concatMap=function(X,Z,_){return goog.array.concat.apply([],goog.array.map(X,Z,_))},goog.crypt={},goog.crypt.stringToByteArray=function(X){for(var Z=[],_=0,K=0;K<X.length;K++){var te=X.charCodeAt(K);255<te&&(Z[_++]=255&te,te>>=8),Z[_++]=te}return Z},goog.crypt.byteArrayToString=function(X){if(8192>=X.length)return String.fromCharCode.apply(null,X);for(var Z="",_=0;_<X.length;_+=8192){var K=goog.array.slice(X,_,_+8192);Z+=String.fromCharCode.apply(null,K)}return Z},goog.crypt.byteArrayToHex=function(X,Z){return goog.array.map(X,function(_){return 1<(_=_.toString(16)).length?_:"0"+_}).join(Z||"")},goog.crypt.hexToByteArray=function(X){goog.asserts.assert(X.length%2==0,"Key string length must be multiple of 2");for(var Z=[],_=0;_<X.length;_+=2)Z.push(parseInt(X.substring(_,_+2),16));return Z},goog.crypt.stringToUtf8ByteArray=function(X){for(var Z=[],_=0,K=0;K<X.length;K++){var te=X.charCodeAt(K);128>te?Z[_++]=te:(2048>te?Z[_++]=te>>6|192:((64512&te)==55296&&K+1<X.length&&(64512&X.charCodeAt(K+1))==56320?(te=65536+((1023&te)<<10)+(1023&X.charCodeAt(++K)),Z[_++]=te>>18|240,Z[_++]=te>>12&63|128):Z[_++]=te>>12|224,Z[_++]=te>>6&63|128),Z[_++]=63&te|128)}return Z},goog.crypt.utf8ByteArrayToString=function(X){for(var Z=[],_=0,K=0;_<X.length;){var te=X[_++];if(128>te)Z[K++]=String.fromCharCode(te);else if(191<te&&224>te){var ne=X[_++];Z[K++]=String.fromCharCode((31&te)<<6|63&ne)}else if(239<te&&365>te){ne=X[_++];var oe=X[_++];te=((7&te)<<18|(63&ne)<<12|(63&oe)<<6|63&X[_++])-65536,Z[K++]=String.fromCharCode(55296+(te>>10)),Z[K++]=String.fromCharCode(56320+(1023&te))}else ne=X[_++],oe=X[_++],Z[K++]=String.fromCharCode((15&te)<<12|(63&ne)<<6|63&oe)}return Z.join("")},goog.crypt.xorByteArray=function(X,Z){goog.asserts.assert(X.length==Z.length,"XOR array lengths must match");for(var _=[],K=0;K<X.length;K++)_.push(X[K]^Z[K]);return _},goog.dom.asserts={},goog.dom.asserts.assertIsLocation=function(X){if(goog.asserts.ENABLE_ASSERTS){var Z=goog.dom.asserts.getWindow_(X);Z&&(!X||!(X instanceof Z.Location)&&X instanceof Z.Element)&&goog.asserts.fail("Argument is not a Location (or a non-Element mock); got: %s",goog.dom.asserts.debugStringForType_(X))}return X},goog.dom.asserts.assertIsElementType_=function(X,Z){if(goog.asserts.ENABLE_ASSERTS){var _=goog.dom.asserts.getWindow_(X);_&&_[Z]!==void 0&&(X&&(X instanceof _[Z]||!(X instanceof _.Location||X instanceof _.Element))||goog.asserts.fail("Argument is not a %s (or a non-Element, non-Location mock); got: %s",Z,goog.dom.asserts.debugStringForType_(X)))}return X},goog.dom.asserts.assertIsHTMLAnchorElement=function(X){return goog.dom.asserts.assertIsElementType_(X,"HTMLAnchorElement")},goog.dom.asserts.assertIsHTMLButtonElement=function(X){return goog.dom.asserts.assertIsElementType_(X,"HTMLButtonElement")},goog.dom.asserts.assertIsHTMLLinkElement=function(X){return goog.dom.asserts.assertIsElementType_(X,"HTMLLinkElement")},goog.dom.asserts.assertIsHTMLImageElement=function(X){return goog.dom.asserts.assertIsElementType_(X,"HTMLImageElement")},goog.dom.asserts.assertIsHTMLAudioElement=function(X){return goog.dom.asserts.assertIsElementType_(X,"HTMLAudioElement")},goog.dom.asserts.assertIsHTMLVideoElement=function(X){return goog.dom.asserts.assertIsElementType_(X,"HTMLVideoElement")},goog.dom.asserts.assertIsHTMLInputElement=function(X){return goog.dom.asserts.assertIsElementType_(X,"HTMLInputElement")},goog.dom.asserts.assertIsHTMLTextAreaElement=function(X){return goog.dom.asserts.assertIsElementType_(X,"HTMLTextAreaElement")},goog.dom.asserts.assertIsHTMLCanvasElement=function(X){return goog.dom.asserts.assertIsElementType_(X,"HTMLCanvasElement")},goog.dom.asserts.assertIsHTMLEmbedElement=function(X){return goog.dom.asserts.assertIsElementType_(X,"HTMLEmbedElement")},goog.dom.asserts.assertIsHTMLFormElement=function(X){return goog.dom.asserts.assertIsElementType_(X,"HTMLFormElement")},goog.dom.asserts.assertIsHTMLFrameElement=function(X){return goog.dom.asserts.assertIsElementType_(X,"HTMLFrameElement")},goog.dom.asserts.assertIsHTMLIFrameElement=function(X){return goog.dom.asserts.assertIsElementType_(X,"HTMLIFrameElement")},goog.dom.asserts.assertIsHTMLObjectElement=function(X){return goog.dom.asserts.assertIsElementType_(X,"HTMLObjectElement")},goog.dom.asserts.assertIsHTMLScriptElement=function(X){return goog.dom.asserts.assertIsElementType_(X,"HTMLScriptElement")},goog.dom.asserts.debugStringForType_=function(X){if(!goog.isObject(X))return X===void 0?"undefined":X===null?"null":typeof X;try{return X.constructor.displayName||X.constructor.name||Object.prototype.toString.call(X)}catch{return"<object could not be stringified>"}},goog.dom.asserts.getWindow_=function(X){try{var Z=X&&X.ownerDocument,_=Z&&(Z.defaultView||Z.parentWindow);if((_=_||goog.global).Element&&_.Location)return _}catch{}return null},goog.functions={},goog.functions.constant=function(X){return function(){return X}},goog.functions.FALSE=function(){return!1},goog.functions.TRUE=function(){return!0},goog.functions.NULL=function(){return null},goog.functions.identity=function(X,Z){return X},goog.functions.error=function(X){return function(){throw Error(X)}},goog.functions.fail=function(X){return function(){throw X}},goog.functions.lock=function(X,Z){return Z=Z||0,function(){return X.apply(this,Array.prototype.slice.call(arguments,0,Z))}},goog.functions.nth=function(X){return function(){return arguments[X]}},goog.functions.partialRight=function(X,Z){var _=Array.prototype.slice.call(arguments,1);return function(){var K=Array.prototype.slice.call(arguments);return K.push.apply(K,_),X.apply(this,K)}},goog.functions.withReturnValue=function(X,Z){return goog.functions.sequence(X,goog.functions.constant(Z))},goog.functions.equalTo=function(X,Z){return function(_){return Z?X==_:X===_}},goog.functions.compose=function(X,Z){var _=arguments,K=_.length;return function(){var te;K&&(te=_[K-1].apply(this,arguments));for(var ne=K-2;0<=ne;ne--)te=_[ne].call(this,te);return te}},goog.functions.sequence=function(X){var Z=arguments,_=Z.length;return function(){for(var K,te=0;te<_;te++)K=Z[te].apply(this,arguments);return K}},goog.functions.and=function(X){var Z=arguments,_=Z.length;return function(){for(var K=0;K<_;K++)if(!Z[K].apply(this,arguments))return!1;return!0}},goog.functions.or=function(X){var Z=arguments,_=Z.length;return function(){for(var K=0;K<_;K++)if(Z[K].apply(this,arguments))return!0;return!1}},goog.functions.not=function(X){return function(){return!X.apply(this,arguments)}},goog.functions.create=function(X,Z){var _=function(){};return _.prototype=X.prototype,_=new _,X.apply(_,Array.prototype.slice.call(arguments,1)),_},goog.functions.CACHE_RETURN_VALUE=!0,goog.functions.cacheReturnValue=function(X){var Z,_=!1;return function(){return goog.functions.CACHE_RETURN_VALUE?(_||(Z=X(),_=!0),Z):X()}},goog.functions.once=function(X){var Z=X;return function(){if(Z){var _=Z;Z=null,_()}}},goog.functions.debounce=function(X,Z,_){var K=0;return function(te){goog.global.clearTimeout(K);var ne=arguments;K=goog.global.setTimeout(function(){X.apply(_,ne)},Z)}},goog.functions.throttle=function(X,Z,_){var K=0,te=!1,ne=[],oe=function(){K=0,te&&(te=!1,ie())},ie=function(){K=goog.global.setTimeout(oe,Z),X.apply(_,ne)};return function(se){ne=arguments,K?te=!0:ie()}},goog.functions.rateLimit=function(X,Z,_){var K=0,te=function(){K=0};return function(ne){K||(K=goog.global.setTimeout(te,Z),X.apply(_,arguments))}},goog.dom.HtmlElement=function(){},goog.dom.TagName=function(X){this.tagName_=X},goog.dom.TagName.prototype.toString=function(){return this.tagName_},goog.dom.TagName.A=new goog.dom.TagName("A"),goog.dom.TagName.ABBR=new goog.dom.TagName("ABBR"),goog.dom.TagName.ACRONYM=new goog.dom.TagName("ACRONYM"),goog.dom.TagName.ADDRESS=new goog.dom.TagName("ADDRESS"),goog.dom.TagName.APPLET=new goog.dom.TagName("APPLET"),goog.dom.TagName.AREA=new goog.dom.TagName("AREA"),goog.dom.TagName.ARTICLE=new goog.dom.TagName("ARTICLE"),goog.dom.TagName.ASIDE=new goog.dom.TagName("ASIDE"),goog.dom.TagName.AUDIO=new goog.dom.TagName("AUDIO"),goog.dom.TagName.B=new goog.dom.TagName("B"),goog.dom.TagName.BASE=new goog.dom.TagName("BASE"),goog.dom.TagName.BASEFONT=new goog.dom.TagName("BASEFONT"),goog.dom.TagName.BDI=new goog.dom.TagName("BDI"),goog.dom.TagName.BDO=new goog.dom.TagName("BDO"),goog.dom.TagName.BIG=new goog.dom.TagName("BIG"),goog.dom.TagName.BLOCKQUOTE=new goog.dom.TagName("BLOCKQUOTE"),goog.dom.TagName.BODY=new goog.dom.TagName("BODY"),goog.dom.TagName.BR=new goog.dom.TagName("BR"),goog.dom.TagName.BUTTON=new goog.dom.TagName("BUTTON"),goog.dom.TagName.CANVAS=new goog.dom.TagName("CANVAS"),goog.dom.TagName.CAPTION=new goog.dom.TagName("CAPTION"),goog.dom.TagName.CENTER=new goog.dom.TagName("CENTER"),goog.dom.TagName.CITE=new goog.dom.TagName("CITE"),goog.dom.TagName.CODE=new goog.dom.TagName("CODE"),goog.dom.TagName.COL=new goog.dom.TagName("COL"),goog.dom.TagName.COLGROUP=new goog.dom.TagName("COLGROUP"),goog.dom.TagName.COMMAND=new goog.dom.TagName("COMMAND"),goog.dom.TagName.DATA=new goog.dom.TagName("DATA"),goog.dom.TagName.DATALIST=new goog.dom.TagName("DATALIST"),goog.dom.TagName.DD=new goog.dom.TagName("DD"),goog.dom.TagName.DEL=new goog.dom.TagName("DEL"),goog.dom.TagName.DETAILS=new goog.dom.TagName("DETAILS"),goog.dom.TagName.DFN=new goog.dom.TagName("DFN"),goog.dom.TagName.DIALOG=new goog.dom.TagName("DIALOG"),goog.dom.TagName.DIR=new goog.dom.TagName("DIR"),goog.dom.TagName.DIV=new goog.dom.TagName("DIV"),goog.dom.TagName.DL=new goog.dom.TagName("DL"),goog.dom.TagName.DT=new goog.dom.TagName("DT"),goog.dom.TagName.EM=new goog.dom.TagName("EM"),goog.dom.TagName.EMBED=new goog.dom.TagName("EMBED"),goog.dom.TagName.FIELDSET=new goog.dom.TagName("FIELDSET"),goog.dom.TagName.FIGCAPTION=new goog.dom.TagName("FIGCAPTION"),goog.dom.TagName.FIGURE=new goog.dom.TagName("FIGURE"),goog.dom.TagName.FONT=new goog.dom.TagName("FONT"),goog.dom.TagName.FOOTER=new goog.dom.TagName("FOOTER"),goog.dom.TagName.FORM=new goog.dom.TagName("FORM"),goog.dom.TagName.FRAME=new goog.dom.TagName("FRAME"),goog.dom.TagName.FRAMESET=new goog.dom.TagName("FRAMESET"),goog.dom.TagName.H1=new goog.dom.TagName("H1"),goog.dom.TagName.H2=new goog.dom.TagName("H2"),goog.dom.TagName.H3=new goog.dom.TagName("H3"),goog.dom.TagName.H4=new goog.dom.TagName("H4"),goog.dom.TagName.H5=new goog.dom.TagName("H5"),goog.dom.TagName.H6=new goog.dom.TagName("H6"),goog.dom.TagName.HEAD=new goog.dom.TagName("HEAD"),goog.dom.TagName.HEADER=new goog.dom.TagName("HEADER"),goog.dom.TagName.HGROUP=new goog.dom.TagName("HGROUP"),goog.dom.TagName.HR=new goog.dom.TagName("HR"),goog.dom.TagName.HTML=new goog.dom.TagName("HTML"),goog.dom.TagName.I=new goog.dom.TagName("I"),goog.dom.TagName.IFRAME=new goog.dom.TagName("IFRAME"),goog.dom.TagName.IMG=new goog.dom.TagName("IMG"),goog.dom.TagName.INPUT=new goog.dom.TagName("INPUT"),goog.dom.TagName.INS=new goog.dom.TagName("INS"),goog.dom.TagName.ISINDEX=new goog.dom.TagName("ISINDEX"),goog.dom.TagName.KBD=new goog.dom.TagName("KBD"),goog.dom.TagName.KEYGEN=new goog.dom.TagName("KEYGEN"),goog.dom.TagName.LABEL=new goog.dom.TagName("LABEL"),goog.dom.TagName.LEGEND=new goog.dom.TagName("LEGEND"),goog.dom.TagName.LI=new goog.dom.TagName("LI"),goog.dom.TagName.LINK=new goog.dom.TagName("LINK"),goog.dom.TagName.MAIN=new goog.dom.TagName("MAIN"),goog.dom.TagName.MAP=new goog.dom.TagName("MAP"),goog.dom.TagName.MARK=new goog.dom.TagName("MARK"),goog.dom.TagName.MATH=new goog.dom.TagName("MATH"),goog.dom.TagName.MENU=new goog.dom.TagName("MENU"),goog.dom.TagName.MENUITEM=new goog.dom.TagName("MENUITEM"),goog.dom.TagName.META=new goog.dom.TagName("META"),goog.dom.TagName.METER=new goog.dom.TagName("METER"),goog.dom.TagName.NAV=new goog.dom.TagName("NAV"),goog.dom.TagName.NOFRAMES=new goog.dom.TagName("NOFRAMES"),goog.dom.TagName.NOSCRIPT=new goog.dom.TagName("NOSCRIPT"),goog.dom.TagName.OBJECT=new goog.dom.TagName("OBJECT"),goog.dom.TagName.OL=new goog.dom.TagName("OL"),goog.dom.TagName.OPTGROUP=new goog.dom.TagName("OPTGROUP"),goog.dom.TagName.OPTION=new goog.dom.TagName("OPTION"),goog.dom.TagName.OUTPUT=new goog.dom.TagName("OUTPUT"),goog.dom.TagName.P=new goog.dom.TagName("P"),goog.dom.TagName.PARAM=new goog.dom.TagName("PARAM"),goog.dom.TagName.PICTURE=new goog.dom.TagName("PICTURE"),goog.dom.TagName.PRE=new goog.dom.TagName("PRE"),goog.dom.TagName.PROGRESS=new goog.dom.TagName("PROGRESS"),goog.dom.TagName.Q=new goog.dom.TagName("Q"),goog.dom.TagName.RP=new goog.dom.TagName("RP"),goog.dom.TagName.RT=new goog.dom.TagName("RT"),goog.dom.TagName.RTC=new goog.dom.TagName("RTC"),goog.dom.TagName.RUBY=new goog.dom.TagName("RUBY"),goog.dom.TagName.S=new goog.dom.TagName("S"),goog.dom.TagName.SAMP=new goog.dom.TagName("SAMP"),goog.dom.TagName.SCRIPT=new goog.dom.TagName("SCRIPT"),goog.dom.TagName.SECTION=new goog.dom.TagName("SECTION"),goog.dom.TagName.SELECT=new goog.dom.TagName("SELECT"),goog.dom.TagName.SMALL=new goog.dom.TagName("SMALL"),goog.dom.TagName.SOURCE=new goog.dom.TagName("SOURCE"),goog.dom.TagName.SPAN=new goog.dom.TagName("SPAN"),goog.dom.TagName.STRIKE=new goog.dom.TagName("STRIKE"),goog.dom.TagName.STRONG=new goog.dom.TagName("STRONG"),goog.dom.TagName.STYLE=new goog.dom.TagName("STYLE"),goog.dom.TagName.SUB=new goog.dom.TagName("SUB"),goog.dom.TagName.SUMMARY=new goog.dom.TagName("SUMMARY"),goog.dom.TagName.SUP=new goog.dom.TagName("SUP"),goog.dom.TagName.SVG=new goog.dom.TagName("SVG"),goog.dom.TagName.TABLE=new goog.dom.TagName("TABLE"),goog.dom.TagName.TBODY=new goog.dom.TagName("TBODY"),goog.dom.TagName.TD=new goog.dom.TagName("TD"),goog.dom.TagName.TEMPLATE=new goog.dom.TagName("TEMPLATE"),goog.dom.TagName.TEXTAREA=new goog.dom.TagName("TEXTAREA"),goog.dom.TagName.TFOOT=new goog.dom.TagName("TFOOT"),goog.dom.TagName.TH=new goog.dom.TagName("TH"),goog.dom.TagName.THEAD=new goog.dom.TagName("THEAD"),goog.dom.TagName.TIME=new goog.dom.TagName("TIME"),goog.dom.TagName.TITLE=new goog.dom.TagName("TITLE"),goog.dom.TagName.TR=new goog.dom.TagName("TR"),goog.dom.TagName.TRACK=new goog.dom.TagName("TRACK"),goog.dom.TagName.TT=new goog.dom.TagName("TT"),goog.dom.TagName.U=new goog.dom.TagName("U"),goog.dom.TagName.UL=new goog.dom.TagName("UL"),goog.dom.TagName.VAR=new goog.dom.TagName("VAR"),goog.dom.TagName.VIDEO=new goog.dom.TagName("VIDEO"),goog.dom.TagName.WBR=new goog.dom.TagName("WBR"),goog.dom.tags={},goog.dom.tags.VOID_TAGS_={area:!0,base:!0,br:!0,col:!0,command:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0},goog.dom.tags.isVoidTag=function(X){return goog.dom.tags.VOID_TAGS_[X]===!0},goog.html={},goog.html.trustedtypes={},goog.html.trustedtypes.PRIVATE_DO_NOT_ACCESS_OR_ELSE_POLICY=goog.TRUSTED_TYPES_POLICY_NAME?goog.createTrustedTypesPolicy(goog.TRUSTED_TYPES_POLICY_NAME+"#html"):null,goog.string={},goog.string.TypedString=function(){},goog.string.Const=function(X,Z){this.stringConstValueWithSecurityContract__googStringSecurityPrivate_=X===goog.string.Const.GOOG_STRING_CONSTRUCTOR_TOKEN_PRIVATE_&&Z||"",this.STRING_CONST_TYPE_MARKER__GOOG_STRING_SECURITY_PRIVATE_=goog.string.Const.TYPE_MARKER_},goog.string.Const.prototype.implementsGoogStringTypedString=!0,goog.string.Const.prototype.getTypedStringValue=function(){return this.stringConstValueWithSecurityContract__googStringSecurityPrivate_},goog.DEBUG&&(goog.string.Const.prototype.toString=function(){return"Const{"+this.stringConstValueWithSecurityContract__googStringSecurityPrivate_+"}"}),goog.string.Const.unwrap=function(X){return X instanceof goog.string.Const&&X.constructor===goog.string.Const&&X.STRING_CONST_TYPE_MARKER__GOOG_STRING_SECURITY_PRIVATE_===goog.string.Const.TYPE_MARKER_?X.stringConstValueWithSecurityContract__googStringSecurityPrivate_:(goog.asserts.fail("expected object of type Const, got '"+X+"'"),"type_error:Const")},goog.string.Const.from=function(X){return new goog.string.Const(goog.string.Const.GOOG_STRING_CONSTRUCTOR_TOKEN_PRIVATE_,X)},goog.string.Const.TYPE_MARKER_={},goog.string.Const.GOOG_STRING_CONSTRUCTOR_TOKEN_PRIVATE_={},goog.string.Const.EMPTY=goog.string.Const.from(""),goog.html.SafeScript=function(){this.privateDoNotAccessOrElseSafeScriptWrappedValue_="",this.SAFE_SCRIPT_TYPE_MARKER_GOOG_HTML_SECURITY_PRIVATE_=goog.html.SafeScript.TYPE_MARKER_GOOG_HTML_SECURITY_PRIVATE_},goog.html.SafeScript.prototype.implementsGoogStringTypedString=!0,goog.html.SafeScript.TYPE_MARKER_GOOG_HTML_SECURITY_PRIVATE_={},goog.html.SafeScript.fromConstant=function(X){return(X=goog.string.Const.unwrap(X)).length===0?goog.html.SafeScript.EMPTY:goog.html.SafeScript.createSafeScriptSecurityPrivateDoNotAccessOrElse(X)},goog.html.SafeScript.fromConstantAndArgs=function(X,Z){for(var _=[],K=1;K<arguments.length;K++)_.push(goog.html.SafeScript.stringify_(arguments[K]));return goog.html.SafeScript.createSafeScriptSecurityPrivateDoNotAccessOrElse("("+goog.string.Const.unwrap(X)+")("+_.join(", ")+");")},goog.html.SafeScript.fromJson=function(X){return goog.html.SafeScript.createSafeScriptSecurityPrivateDoNotAccessOrElse(goog.html.SafeScript.stringify_(X))},goog.html.SafeScript.prototype.getTypedStringValue=function(){return this.privateDoNotAccessOrElseSafeScriptWrappedValue_.toString()},goog.DEBUG&&(goog.html.SafeScript.prototype.toString=function(){return"SafeScript{"+this.privateDoNotAccessOrElseSafeScriptWrappedValue_+"}"}),goog.html.SafeScript.unwrap=function(X){return goog.html.SafeScript.unwrapTrustedScript(X).toString()},goog.html.SafeScript.unwrapTrustedScript=function(X){return X instanceof goog.html.SafeScript&&X.constructor===goog.html.SafeScript&&X.SAFE_SCRIPT_TYPE_MARKER_GOOG_HTML_SECURITY_PRIVATE_===goog.html.SafeScript.TYPE_MARKER_GOOG_HTML_SECURITY_PRIVATE_?X.privateDoNotAccessOrElseSafeScriptWrappedValue_:(goog.asserts.fail("expected object of type SafeScript, got '"+X+"' of type "+goog.typeOf(X)),"type_error:SafeScript")},goog.html.SafeScript.stringify_=function(X){return JSON.stringify(X).replace(/</g,"\\x3c")},goog.html.SafeScript.createSafeScriptSecurityPrivateDoNotAccessOrElse=function(X){return new goog.html.SafeScript().initSecurityPrivateDoNotAccessOrElse_(X)},goog.html.SafeScript.prototype.initSecurityPrivateDoNotAccessOrElse_=function(X){return this.privateDoNotAccessOrElseSafeScriptWrappedValue_=goog.html.trustedtypes.PRIVATE_DO_NOT_ACCESS_OR_ELSE_POLICY?goog.html.trustedtypes.PRIVATE_DO_NOT_ACCESS_OR_ELSE_POLICY.createScript(X):X,this},goog.html.SafeScript.EMPTY=goog.html.SafeScript.createSafeScriptSecurityPrivateDoNotAccessOrElse(""),goog.fs={},goog.fs.url={},goog.fs.url.createObjectUrl=function(X){return goog.fs.url.getUrlObject_().createObjectURL(X)},goog.fs.url.revokeObjectUrl=function(X){goog.fs.url.getUrlObject_().revokeObjectURL(X)},goog.fs.url.UrlObject_=function(){},goog.fs.url.UrlObject_.prototype.createObjectURL=function(X){},goog.fs.url.UrlObject_.prototype.revokeObjectURL=function(X){},goog.fs.url.getUrlObject_=function(){var X=goog.fs.url.findUrlObject_();if(X!=null)return X;throw Error("This browser doesn't seem to support blob URLs")},goog.fs.url.findUrlObject_=function(){return goog.global.URL!==void 0&&goog.global.URL.createObjectURL!==void 0?goog.global.URL:goog.global.webkitURL!==void 0&&goog.global.webkitURL.createObjectURL!==void 0?goog.global.webkitURL:goog.global.createObjectURL!==void 0?goog.global:null},goog.fs.url.browserSupportsObjectUrls=function(){return goog.fs.url.findUrlObject_()!=null},goog.fs.blob={},goog.fs.blob.getBlob=function(X){var Z=goog.global.BlobBuilder||goog.global.WebKitBlobBuilder;if(Z!==void 0){Z=new Z;for(var _=0;_<arguments.length;_++)Z.append(arguments[_]);return Z.getBlob()}return goog.fs.blob.getBlobWithProperties(goog.array.toArray(arguments))},goog.fs.blob.getBlobWithProperties=function(X,Z,_){var K=goog.global.BlobBuilder||goog.global.WebKitBlobBuilder;if(K!==void 0){K=new K;for(var te=0;te<X.length;te++)K.append(X[te],_);return K.getBlob(Z)}if(goog.global.Blob!==void 0)return K={},Z&&(K.type=Z),_&&(K.endings=_),new Blob(X,K);throw Error("This browser doesn't seem to support creating Blobs")},goog.i18n={},goog.i18n.bidi={},goog.i18n.bidi.FORCE_RTL=!1,goog.i18n.bidi.IS_RTL=goog.i18n.bidi.FORCE_RTL||(goog.LOCALE.substring(0,2).toLowerCase()=="ar"||goog.LOCALE.substring(0,2).toLowerCase()=="fa"||goog.LOCALE.substring(0,2).toLowerCase()=="he"||goog.LOCALE.substring(0,2).toLowerCase()=="iw"||goog.LOCALE.substring(0,2).toLowerCase()=="ps"||goog.LOCALE.substring(0,2).toLowerCase()=="sd"||goog.LOCALE.substring(0,2).toLowerCase()=="ug"||goog.LOCALE.substring(0,2).toLowerCase()=="ur"||goog.LOCALE.substring(0,2).toLowerCase()=="yi")&&(goog.LOCALE.length==2||goog.LOCALE.substring(2,3)=="-"||goog.LOCALE.substring(2,3)=="_")||3<=goog.LOCALE.length&&goog.LOCALE.substring(0,3).toLowerCase()=="ckb"&&(goog.LOCALE.length==3||goog.LOCALE.substring(3,4)=="-"||goog.LOCALE.substring(3,4)=="_")||7<=goog.LOCALE.length&&(goog.LOCALE.substring(2,3)=="-"||goog.LOCALE.substring(2,3)=="_")&&(goog.LOCALE.substring(3,7).toLowerCase()=="adlm"||goog.LOCALE.substring(3,7).toLowerCase()=="arab"||goog.LOCALE.substring(3,7).toLowerCase()=="hebr"||goog.LOCALE.substring(3,7).toLowerCase()=="nkoo"||goog.LOCALE.substring(3,7).toLowerCase()=="rohg"||goog.LOCALE.substring(3,7).toLowerCase()=="thaa")||8<=goog.LOCALE.length&&(goog.LOCALE.substring(3,4)=="-"||goog.LOCALE.substring(3,4)=="_")&&(goog.LOCALE.substring(4,8).toLowerCase()=="adlm"||goog.LOCALE.substring(4,8).toLowerCase()=="arab"||goog.LOCALE.substring(4,8).toLowerCase()=="hebr"||goog.LOCALE.substring(4,8).toLowerCase()=="nkoo"||goog.LOCALE.substring(4,8).toLowerCase()=="rohg"||goog.LOCALE.substring(4,8).toLowerCase()=="thaa"),goog.i18n.bidi.Format={LRE:"‪",RLE:"‫",PDF:"‬",LRM:"‎",RLM:"‏"},goog.i18n.bidi.Dir={LTR:1,RTL:-1,NEUTRAL:0},goog.i18n.bidi.RIGHT="right",goog.i18n.bidi.LEFT="left",goog.i18n.bidi.I18N_RIGHT=goog.i18n.bidi.IS_RTL?goog.i18n.bidi.LEFT:goog.i18n.bidi.RIGHT,goog.i18n.bidi.I18N_LEFT=goog.i18n.bidi.IS_RTL?goog.i18n.bidi.RIGHT:goog.i18n.bidi.LEFT,goog.i18n.bidi.toDir=function(X,Z){return typeof X=="number"?0<X?goog.i18n.bidi.Dir.LTR:0>X?goog.i18n.bidi.Dir.RTL:Z?null:goog.i18n.bidi.Dir.NEUTRAL:X==null?null:X?goog.i18n.bidi.Dir.RTL:goog.i18n.bidi.Dir.LTR},goog.i18n.bidi.ltrChars_="A-Za-zÀ-ÖØ-öø-ʸ̀-֐ऀ-῿‎Ⰰ-\uD801\uD804-\uD839\uD83C-\uDBFF豈-﬜︀-﹯﻽-￿",goog.i18n.bidi.rtlChars_="֑-ۯۺ-ࣿ‏\uD802-\uD803\uD83A-\uD83Bיִ-﷿ﹰ-ﻼ",goog.i18n.bidi.htmlSkipReg_=/<[^>]*>|&[^;]+;/g,goog.i18n.bidi.stripHtmlIfNeeded_=function(X,Z){return Z?X.replace(goog.i18n.bidi.htmlSkipReg_,""):X},goog.i18n.bidi.rtlCharReg_=new RegExp("["+goog.i18n.bidi.rtlChars_+"]"),goog.i18n.bidi.ltrCharReg_=new RegExp("["+goog.i18n.bidi.ltrChars_+"]"),goog.i18n.bidi.hasAnyRtl=function(X,Z){return goog.i18n.bidi.rtlCharReg_.test(goog.i18n.bidi.stripHtmlIfNeeded_(X,Z))},goog.i18n.bidi.hasRtlChar=goog.i18n.bidi.hasAnyRtl,goog.i18n.bidi.hasAnyLtr=function(X,Z){return goog.i18n.bidi.ltrCharReg_.test(goog.i18n.bidi.stripHtmlIfNeeded_(X,Z))},goog.i18n.bidi.ltrRe_=new RegExp("^["+goog.i18n.bidi.ltrChars_+"]"),goog.i18n.bidi.rtlRe_=new RegExp("^["+goog.i18n.bidi.rtlChars_+"]"),goog.i18n.bidi.isRtlChar=function(X){return goog.i18n.bidi.rtlRe_.test(X)},goog.i18n.bidi.isLtrChar=function(X){return goog.i18n.bidi.ltrRe_.test(X)},goog.i18n.bidi.isNeutralChar=function(X){return!goog.i18n.bidi.isLtrChar(X)&&!goog.i18n.bidi.isRtlChar(X)},goog.i18n.bidi.ltrDirCheckRe_=new RegExp("^[^"+goog.i18n.bidi.rtlChars_+"]*["+goog.i18n.bidi.ltrChars_+"]"),goog.i18n.bidi.rtlDirCheckRe_=new RegExp("^[^"+goog.i18n.bidi.ltrChars_+"]*["+goog.i18n.bidi.rtlChars_+"]"),goog.i18n.bidi.startsWithRtl=function(X,Z){return goog.i18n.bidi.rtlDirCheckRe_.test(goog.i18n.bidi.stripHtmlIfNeeded_(X,Z))},goog.i18n.bidi.isRtlText=goog.i18n.bidi.startsWithRtl,goog.i18n.bidi.startsWithLtr=function(X,Z){return goog.i18n.bidi.ltrDirCheckRe_.test(goog.i18n.bidi.stripHtmlIfNeeded_(X,Z))},goog.i18n.bidi.isLtrText=goog.i18n.bidi.startsWithLtr,goog.i18n.bidi.isRequiredLtrRe_=/^http:\/\/.*/,goog.i18n.bidi.isNeutralText=function(X,Z){return X=goog.i18n.bidi.stripHtmlIfNeeded_(X,Z),goog.i18n.bidi.isRequiredLtrRe_.test(X)||!goog.i18n.bidi.hasAnyLtr(X)&&!goog.i18n.bidi.hasAnyRtl(X)},goog.i18n.bidi.ltrExitDirCheckRe_=new RegExp("["+goog.i18n.bidi.ltrChars_+"][^"+goog.i18n.bidi.rtlChars_+"]*$"),goog.i18n.bidi.rtlExitDirCheckRe_=new RegExp("["+goog.i18n.bidi.rtlChars_+"][^"+goog.i18n.bidi.ltrChars_+"]*$"),goog.i18n.bidi.endsWithLtr=function(X,Z){return goog.i18n.bidi.ltrExitDirCheckRe_.test(goog.i18n.bidi.stripHtmlIfNeeded_(X,Z))},goog.i18n.bidi.isLtrExitText=goog.i18n.bidi.endsWithLtr,goog.i18n.bidi.endsWithRtl=function(X,Z){return goog.i18n.bidi.rtlExitDirCheckRe_.test(goog.i18n.bidi.stripHtmlIfNeeded_(X,Z))},goog.i18n.bidi.isRtlExitText=goog.i18n.bidi.endsWithRtl,goog.i18n.bidi.rtlLocalesRe_=/^(ar|ckb|dv|he|iw|fa|nqo|ps|sd|ug|ur|yi|.*[-_](Adlm|Arab|Hebr|Nkoo|Rohg|Thaa))(?!.*[-_](Latn|Cyrl)($|-|_))($|-|_)/i,goog.i18n.bidi.isRtlLanguage=function(X){return goog.i18n.bidi.rtlLocalesRe_.test(X)},goog.i18n.bidi.bracketGuardTextRe_=/(\(.*?\)+)|(\[.*?\]+)|(\{.*?\}+)|(<.*?>+)/g,goog.i18n.bidi.guardBracketInText=function(X,Z){return Z=(Z===void 0?goog.i18n.bidi.hasAnyRtl(X):Z)?goog.i18n.bidi.Format.RLM:goog.i18n.bidi.Format.LRM,X.replace(goog.i18n.bidi.bracketGuardTextRe_,Z+"$&"+Z)},goog.i18n.bidi.enforceRtlInHtml=function(X){return X.charAt(0)=="<"?X.replace(/<\w+/,"$& dir=rtl"):`
<span dir=rtl>`+X+"</span>"},goog.i18n.bidi.enforceRtlInText=function(X){return goog.i18n.bidi.Format.RLE+X+goog.i18n.bidi.Format.PDF},goog.i18n.bidi.enforceLtrInHtml=function(X){return X.charAt(0)=="<"?X.replace(/<\w+/,"$& dir=ltr"):`
<span dir=ltr>`+X+"</span>"},goog.i18n.bidi.enforceLtrInText=function(X){return goog.i18n.bidi.Format.LRE+X+goog.i18n.bidi.Format.PDF},goog.i18n.bidi.dimensionsRe_=/:\s*([.\d][.\w]*)\s+([.\d][.\w]*)\s+([.\d][.\w]*)\s+([.\d][.\w]*)/g,goog.i18n.bidi.leftRe_=/left/gi,goog.i18n.bidi.rightRe_=/right/gi,goog.i18n.bidi.tempRe_=/%%%%/g,goog.i18n.bidi.mirrorCSS=function(X){return X.replace(goog.i18n.bidi.dimensionsRe_,":$1 $4 $3 $2").replace(goog.i18n.bidi.leftRe_,"%%%%").replace(goog.i18n.bidi.rightRe_,goog.i18n.bidi.LEFT).replace(goog.i18n.bidi.tempRe_,goog.i18n.bidi.RIGHT)},goog.i18n.bidi.doubleQuoteSubstituteRe_=/([\u0591-\u05f2])"/g,goog.i18n.bidi.singleQuoteSubstituteRe_=/([\u0591-\u05f2])'/g,goog.i18n.bidi.normalizeHebrewQuote=function(X){return X.replace(goog.i18n.bidi.doubleQuoteSubstituteRe_,"$1״").replace(goog.i18n.bidi.singleQuoteSubstituteRe_,"$1׳")},goog.i18n.bidi.wordSeparatorRe_=/\s+/,goog.i18n.bidi.hasNumeralsRe_=/[\d\u06f0-\u06f9]/,goog.i18n.bidi.rtlDetectionThreshold_=.4,goog.i18n.bidi.estimateDirection=function(X,Z){var _=0,K=0,te=!1;for(X=goog.i18n.bidi.stripHtmlIfNeeded_(X,Z).split(goog.i18n.bidi.wordSeparatorRe_),Z=0;Z<X.length;Z++){var ne=X[Z];goog.i18n.bidi.startsWithRtl(ne)?(_++,K++):goog.i18n.bidi.isRequiredLtrRe_.test(ne)?te=!0:goog.i18n.bidi.hasAnyLtr(ne)?K++:goog.i18n.bidi.hasNumeralsRe_.test(ne)&&(te=!0)}return K==0?te?goog.i18n.bidi.Dir.LTR:goog.i18n.bidi.Dir.NEUTRAL:_/K>goog.i18n.bidi.rtlDetectionThreshold_?goog.i18n.bidi.Dir.RTL:goog.i18n.bidi.Dir.LTR},goog.i18n.bidi.detectRtlDirectionality=function(X,Z){return goog.i18n.bidi.estimateDirection(X,Z)==goog.i18n.bidi.Dir.RTL},goog.i18n.bidi.setElementDirAndAlign=function(X,Z){X&&(Z=goog.i18n.bidi.toDir(Z))&&(X.style.textAlign=Z==goog.i18n.bidi.Dir.RTL?goog.i18n.bidi.RIGHT:goog.i18n.bidi.LEFT,X.dir=Z==goog.i18n.bidi.Dir.RTL?"rtl":"ltr")},goog.i18n.bidi.setElementDirByTextDirectionality=function(X,Z){switch(goog.i18n.bidi.estimateDirection(Z)){case goog.i18n.bidi.Dir.LTR:X.dir="ltr";break;case goog.i18n.bidi.Dir.RTL:X.dir="rtl";break;default:X.removeAttribute("dir")}},goog.i18n.bidi.DirectionalString=function(){},goog.html.TrustedResourceUrl=function(X,Z){this.privateDoNotAccessOrElseTrustedResourceUrlWrappedValue_=X===goog.html.TrustedResourceUrl.CONSTRUCTOR_TOKEN_PRIVATE_&&Z||"",this.TRUSTED_RESOURCE_URL_TYPE_MARKER_GOOG_HTML_SECURITY_PRIVATE_=goog.html.TrustedResourceUrl.TYPE_MARKER_GOOG_HTML_SECURITY_PRIVATE_},goog.html.TrustedResourceUrl.prototype.implementsGoogStringTypedString=!0,goog.html.TrustedResourceUrl.prototype.getTypedStringValue=function(){return this.privateDoNotAccessOrElseTrustedResourceUrlWrappedValue_.toString()},goog.html.TrustedResourceUrl.prototype.implementsGoogI18nBidiDirectionalString=!0,goog.html.TrustedResourceUrl.prototype.getDirection=function(){return goog.i18n.bidi.Dir.LTR},goog.html.TrustedResourceUrl.prototype.cloneWithParams=function(X,Z){var _=goog.html.TrustedResourceUrl.unwrap(this),K=(_=goog.html.TrustedResourceUrl.URL_PARAM_PARSER_.exec(_))[3]||"";return goog.html.TrustedResourceUrl.createTrustedResourceUrlSecurityPrivateDoNotAccessOrElse(_[1]+goog.html.TrustedResourceUrl.stringifyParams_("?",_[2]||"",X)+goog.html.TrustedResourceUrl.stringifyParams_("#",K,Z))},goog.DEBUG&&(goog.html.TrustedResourceUrl.prototype.toString=function(){return"TrustedResourceUrl{"+this.privateDoNotAccessOrElseTrustedResourceUrlWrappedValue_+"}"}),goog.html.TrustedResourceUrl.unwrap=function(X){return goog.html.TrustedResourceUrl.unwrapTrustedScriptURL(X).toString()},goog.html.TrustedResourceUrl.unwrapTrustedScriptURL=function(X){return X instanceof goog.html.TrustedResourceUrl&&X.constructor===goog.html.TrustedResourceUrl&&X.TRUSTED_RESOURCE_URL_TYPE_MARKER_GOOG_HTML_SECURITY_PRIVATE_===goog.html.TrustedResourceUrl.TYPE_MARKER_GOOG_HTML_SECURITY_PRIVATE_?X.privateDoNotAccessOrElseTrustedResourceUrlWrappedValue_:(goog.asserts.fail("expected object of type TrustedResourceUrl, got '"+X+"' of type "+goog.typeOf(X)),"type_error:TrustedResourceUrl")},goog.html.TrustedResourceUrl.format=function(X,Z){var _=goog.string.Const.unwrap(X);if(!goog.html.TrustedResourceUrl.BASE_URL_.test(_))throw Error("Invalid TrustedResourceUrl format: "+_);return X=_.replace(goog.html.TrustedResourceUrl.FORMAT_MARKER_,function(K,te){if(!Object.prototype.hasOwnProperty.call(Z,te))throw Error('Found marker, "'+te+'", in format string, "'+_+'", but no valid label mapping found in args: '+JSON.stringify(Z));return(K=Z[te])instanceof goog.string.Const?goog.string.Const.unwrap(K):encodeURIComponent(String(K))}),goog.html.TrustedResourceUrl.createTrustedResourceUrlSecurityPrivateDoNotAccessOrElse(X)},goog.html.TrustedResourceUrl.FORMAT_MARKER_=/%{(\w+)}/g,goog.html.TrustedResourceUrl.BASE_URL_=/^((https:)?\/\/[0-9a-z.:[\]-]+\/|\/[^/\\]|[^:/\\%]+\/|[^:/\\%]*[?#]|about:blank#)/i,goog.html.TrustedResourceUrl.URL_PARAM_PARSER_=/^([^?#]*)(\?[^#]*)?(#[\s\S]*)?/,goog.html.TrustedResourceUrl.formatWithParams=function(X,Z,_,K){return goog.html.TrustedResourceUrl.format(X,Z).cloneWithParams(_,K)},goog.html.TrustedResourceUrl.fromConstant=function(X){return goog.html.TrustedResourceUrl.createTrustedResourceUrlSecurityPrivateDoNotAccessOrElse(goog.string.Const.unwrap(X))},goog.html.TrustedResourceUrl.fromConstants=function(X){for(var Z="",_=0;_<X.length;_++)Z+=goog.string.Const.unwrap(X[_]);return goog.html.TrustedResourceUrl.createTrustedResourceUrlSecurityPrivateDoNotAccessOrElse(Z)},goog.html.TrustedResourceUrl.fromSafeScript=function(X){return X=goog.fs.blob.getBlobWithProperties([goog.html.SafeScript.unwrap(X)],"text/javascript"),X=goog.fs.url.createObjectUrl(X),goog.html.TrustedResourceUrl.createTrustedResourceUrlSecurityPrivateDoNotAccessOrElse(X)},goog.html.TrustedResourceUrl.TYPE_MARKER_GOOG_HTML_SECURITY_PRIVATE_={},goog.html.TrustedResourceUrl.createTrustedResourceUrlSecurityPrivateDoNotAccessOrElse=function(X){return X=goog.html.trustedtypes.PRIVATE_DO_NOT_ACCESS_OR_ELSE_POLICY?goog.html.trustedtypes.PRIVATE_DO_NOT_ACCESS_OR_ELSE_POLICY.createScriptURL(X):X,new goog.html.TrustedResourceUrl(goog.html.TrustedResourceUrl.CONSTRUCTOR_TOKEN_PRIVATE_,X)},goog.html.TrustedResourceUrl.stringifyParams_=function(X,Z,_){if(_==null)return Z;if(typeof _=="string")return _?X+encodeURIComponent(_):"";for(var K in _){var te=_[K];te=Array.isArray(te)?te:[te];for(var ne=0;ne<te.length;ne++){var oe=te[ne];oe!=null&&(Z||(Z=X),Z+=(Z.length>X.length?"&":"")+encodeURIComponent(K)+"="+encodeURIComponent(String(oe)))}}return Z},goog.html.TrustedResourceUrl.CONSTRUCTOR_TOKEN_PRIVATE_={},goog.string.internal={},goog.string.internal.startsWith=function(X,Z){return X.lastIndexOf(Z,0)==0},goog.string.internal.endsWith=function(X,Z){var _=X.length-Z.length;return 0<=_&&X.indexOf(Z,_)==_},goog.string.internal.caseInsensitiveStartsWith=function(X,Z){return goog.string.internal.caseInsensitiveCompare(Z,X.substr(0,Z.length))==0},goog.string.internal.caseInsensitiveEndsWith=function(X,Z){return goog.string.internal.caseInsensitiveCompare(Z,X.substr(X.length-Z.length,Z.length))==0},goog.string.internal.caseInsensitiveEquals=function(X,Z){return X.toLowerCase()==Z.toLowerCase()},goog.string.internal.isEmptyOrWhitespace=function(X){return/^[\s\xa0]*$/.test(X)},goog.string.internal.trim=goog.TRUSTED_SITE&&String.prototype.trim?function(X){return X.trim()}:function(X){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(X)[1]},goog.string.internal.caseInsensitiveCompare=function(X,Z){return(X=String(X).toLowerCase())<(Z=String(Z).toLowerCase())?-1:X==Z?0:1},goog.string.internal.newLineToBr=function(X,Z){return X.replace(/(\r\n|\r|\n)/g,Z?"<br />":"<br>")},goog.string.internal.htmlEscape=function(X,Z){if(Z)X=X.replace(goog.string.internal.AMP_RE_,"&amp;").replace(goog.string.internal.LT_RE_,"&lt;").replace(goog.string.internal.GT_RE_,"&gt;").replace(goog.string.internal.QUOT_RE_,"&quot;").replace(goog.string.internal.SINGLE_QUOTE_RE_,"&#39;").replace(goog.string.internal.NULL_RE_,"&#0;");else{if(!goog.string.internal.ALL_RE_.test(X))return X;X.indexOf("&")!=-1&&(X=X.replace(goog.string.internal.AMP_RE_,"&amp;")),X.indexOf("<")!=-1&&(X=X.replace(goog.string.internal.LT_RE_,"&lt;")),X.indexOf(">")!=-1&&(X=X.replace(goog.string.internal.GT_RE_,"&gt;")),X.indexOf('"')!=-1&&(X=X.replace(goog.string.internal.QUOT_RE_,"&quot;")),X.indexOf("'")!=-1&&(X=X.replace(goog.string.internal.SINGLE_QUOTE_RE_,"&#39;")),X.indexOf("\0")!=-1&&(X=X.replace(goog.string.internal.NULL_RE_,"&#0;"))}return X},goog.string.internal.AMP_RE_=/&/g,goog.string.internal.LT_RE_=/</g,goog.string.internal.GT_RE_=/>/g,goog.string.internal.QUOT_RE_=/"/g,goog.string.internal.SINGLE_QUOTE_RE_=/'/g,goog.string.internal.NULL_RE_=/\x00/g,goog.string.internal.ALL_RE_=/[\x00&<>"']/,goog.string.internal.whitespaceEscape=function(X,Z){return goog.string.internal.newLineToBr(X.replace(/  /g," &#160;"),Z)},goog.string.internal.contains=function(X,Z){return X.indexOf(Z)!=-1},goog.string.internal.caseInsensitiveContains=function(X,Z){return goog.string.internal.contains(X.toLowerCase(),Z.toLowerCase())},goog.string.internal.compareVersions=function(X,Z){var _=0;X=goog.string.internal.trim(String(X)).split("."),Z=goog.string.internal.trim(String(Z)).split(".");for(var K=Math.max(X.length,Z.length),te=0;_==0&&te<K;te++){var ne=X[te]||"",oe=Z[te]||"";do{if(ne=/(\d*)(\D*)(.*)/.exec(ne)||["","","",""],oe=/(\d*)(\D*)(.*)/.exec(oe)||["","","",""],ne[0].length==0&&oe[0].length==0)break;_=ne[1].length==0?0:parseInt(ne[1],10);var ie=oe[1].length==0?0:parseInt(oe[1],10);_=goog.string.internal.compareElements_(_,ie)||goog.string.internal.compareElements_(ne[2].length==0,oe[2].length==0)||goog.string.internal.compareElements_(ne[2],oe[2]),ne=ne[3],oe=oe[3]}while(_==0)}return _},goog.string.internal.compareElements_=function(X,Z){return X<Z?-1:X>Z?1:0},goog.html.SafeUrl=function(X,Z){this.privateDoNotAccessOrElseSafeUrlWrappedValue_=X===goog.html.SafeUrl.CONSTRUCTOR_TOKEN_PRIVATE_&&Z||"",this.SAFE_URL_TYPE_MARKER_GOOG_HTML_SECURITY_PRIVATE_=goog.html.SafeUrl.TYPE_MARKER_GOOG_HTML_SECURITY_PRIVATE_},goog.html.SafeUrl.INNOCUOUS_STRING="about:invalid#zClosurez",goog.html.SafeUrl.prototype.implementsGoogStringTypedString=!0,goog.html.SafeUrl.prototype.getTypedStringValue=function(){return this.privateDoNotAccessOrElseSafeUrlWrappedValue_.toString()},goog.html.SafeUrl.prototype.implementsGoogI18nBidiDirectionalString=!0,goog.html.SafeUrl.prototype.getDirection=function(){return goog.i18n.bidi.Dir.LTR},goog.DEBUG&&(goog.html.SafeUrl.prototype.toString=function(){return"SafeUrl{"+this.privateDoNotAccessOrElseSafeUrlWrappedValue_+"}"}),goog.html.SafeUrl.unwrap=function(X){return X instanceof goog.html.SafeUrl&&X.constructor===goog.html.SafeUrl&&X.SAFE_URL_TYPE_MARKER_GOOG_HTML_SECURITY_PRIVATE_===goog.html.SafeUrl.TYPE_MARKER_GOOG_HTML_SECURITY_PRIVATE_?X.privateDoNotAccessOrElseSafeUrlWrappedValue_:(goog.asserts.fail("expected object of type SafeUrl, got '"+X+"' of type "+goog.typeOf(X)),"type_error:SafeUrl")},goog.html.SafeUrl.fromConstant=function(X){return goog.html.SafeUrl.createSafeUrlSecurityPrivateDoNotAccessOrElse(goog.string.Const.unwrap(X))},goog.html.SAFE_MIME_TYPE_PATTERN_=/^(?:audio\/(?:3gpp2|3gpp|aac|L16|midi|mp3|mp4|mpeg|oga|ogg|opus|x-m4a|x-matroska|x-wav|wav|webm)|image\/(?:bmp|gif|jpeg|jpg|png|tiff|webp|x-icon)|text\/csv|video\/(?:mpeg|mp4|ogg|webm|quicktime|x-matroska))(?:;\w+=(?:\w+|"[\w;,= ]+"))*$/i,goog.html.SafeUrl.isSafeMimeType=function(X){return goog.html.SAFE_MIME_TYPE_PATTERN_.test(X)},goog.html.SafeUrl.fromBlob=function(X){return X=goog.html.SafeUrl.isSafeMimeType(X.type)?goog.fs.url.createObjectUrl(X):goog.html.SafeUrl.INNOCUOUS_STRING,goog.html.SafeUrl.createSafeUrlSecurityPrivateDoNotAccessOrElse(X)},goog.html.SafeUrl.fromMediaSource=function(X){return goog.asserts.assert("MediaSource"in goog.global,"No support for MediaSource"),X=X instanceof MediaSource?goog.fs.url.createObjectUrl(X):goog.html.SafeUrl.INNOCUOUS_STRING,goog.html.SafeUrl.createSafeUrlSecurityPrivateDoNotAccessOrElse(X)},goog.html.DATA_URL_PATTERN_=/^data:(.*);base64,[a-z0-9+\/]+=*$/i,goog.html.SafeUrl.fromDataUrl=function(X){var Z=(X=X.replace(/(%0A|%0D)/g,"")).match(goog.html.DATA_URL_PATTERN_);return Z=Z&&goog.html.SafeUrl.isSafeMimeType(Z[1]),goog.html.SafeUrl.createSafeUrlSecurityPrivateDoNotAccessOrElse(Z?X:goog.html.SafeUrl.INNOCUOUS_STRING)},goog.html.SafeUrl.fromTelUrl=function(X){return goog.string.internal.caseInsensitiveStartsWith(X,"tel:")||(X=goog.html.SafeUrl.INNOCUOUS_STRING),goog.html.SafeUrl.createSafeUrlSecurityPrivateDoNotAccessOrElse(X)},goog.html.SIP_URL_PATTERN_=/^sip[s]?:[+a-z0-9_.!$%&'*\/=^`{|}~-]+@([a-z0-9-]+\.)+[a-z0-9]{2,63}$/i,goog.html.SafeUrl.fromSipUrl=function(X){return goog.html.SIP_URL_PATTERN_.test(decodeURIComponent(X))||(X=goog.html.SafeUrl.INNOCUOUS_STRING),goog.html.SafeUrl.createSafeUrlSecurityPrivateDoNotAccessOrElse(X)},goog.html.SafeUrl.fromFacebookMessengerUrl=function(X){return goog.string.internal.caseInsensitiveStartsWith(X,"fb-messenger://share")||(X=goog.html.SafeUrl.INNOCUOUS_STRING),goog.html.SafeUrl.createSafeUrlSecurityPrivateDoNotAccessOrElse(X)},goog.html.SafeUrl.fromWhatsAppUrl=function(X){return goog.string.internal.caseInsensitiveStartsWith(X,"whatsapp://send")||(X=goog.html.SafeUrl.INNOCUOUS_STRING),goog.html.SafeUrl.createSafeUrlSecurityPrivateDoNotAccessOrElse(X)},goog.html.SafeUrl.fromSmsUrl=function(X){return goog.string.internal.caseInsensitiveStartsWith(X,"sms:")&&goog.html.SafeUrl.isSmsUrlBodyValid_(X)||(X=goog.html.SafeUrl.INNOCUOUS_STRING),goog.html.SafeUrl.createSafeUrlSecurityPrivateDoNotAccessOrElse(X)},goog.html.SafeUrl.isSmsUrlBodyValid_=function(X){var Z=X.indexOf("#");if(0<Z&&(X=X.substring(0,Z)),!(Z=X.match(/[?&]body=/gi)))return!0;if(1<Z.length)return!1;if(!(X=X.match(/[?&]body=([^&]*)/)[1]))return!0;try{decodeURIComponent(X)}catch{return!1}return/^(?:[a-z0-9\-_.~]|%[0-9a-f]{2})+$/i.test(X)},goog.html.SafeUrl.fromSshUrl=function(X){return goog.string.internal.caseInsensitiveStartsWith(X,"ssh://")||(X=goog.html.SafeUrl.INNOCUOUS_STRING),goog.html.SafeUrl.createSafeUrlSecurityPrivateDoNotAccessOrElse(X)},goog.html.SafeUrl.sanitizeChromeExtensionUrl=function(X,Z){return goog.html.SafeUrl.sanitizeExtensionUrl_(/^chrome-extension:\/\/([^\/]+)\//,X,Z)},goog.html.SafeUrl.sanitizeFirefoxExtensionUrl=function(X,Z){return goog.html.SafeUrl.sanitizeExtensionUrl_(/^moz-extension:\/\/([^\/]+)\//,X,Z)},goog.html.SafeUrl.sanitizeEdgeExtensionUrl=function(X,Z){return goog.html.SafeUrl.sanitizeExtensionUrl_(/^ms-browser-extension:\/\/([^\/]+)\//,X,Z)},goog.html.SafeUrl.sanitizeExtensionUrl_=function(X,Z,_){return(X=X.exec(Z))?(X=X[1],(_ instanceof goog.string.Const?[goog.string.Const.unwrap(_)]:_.map(function(K){return goog.string.Const.unwrap(K)})).indexOf(X)==-1&&(Z=goog.html.SafeUrl.INNOCUOUS_STRING)):Z=goog.html.SafeUrl.INNOCUOUS_STRING,goog.html.SafeUrl.createSafeUrlSecurityPrivateDoNotAccessOrElse(Z)},goog.html.SafeUrl.fromTrustedResourceUrl=function(X){return goog.html.SafeUrl.createSafeUrlSecurityPrivateDoNotAccessOrElse(goog.html.TrustedResourceUrl.unwrap(X))},goog.html.SAFE_URL_PATTERN_=/^(?:(?:https?|mailto|ftp):|[^:/?#]*(?:[/?#]|$))/i,goog.html.SafeUrl.SAFE_URL_PATTERN=goog.html.SAFE_URL_PATTERN_,goog.html.SafeUrl.sanitize=function(X){return X instanceof goog.html.SafeUrl?X:(X=typeof X=="object"&&X.implementsGoogStringTypedString?X.getTypedStringValue():String(X),goog.html.SAFE_URL_PATTERN_.test(X)||(X=goog.html.SafeUrl.INNOCUOUS_STRING),goog.html.SafeUrl.createSafeUrlSecurityPrivateDoNotAccessOrElse(X))},goog.html.SafeUrl.sanitizeAssertUnchanged=function(X,Z){return X instanceof goog.html.SafeUrl?X:(X=typeof X=="object"&&X.implementsGoogStringTypedString?X.getTypedStringValue():String(X),Z&&/^data:/i.test(X)&&(Z=goog.html.SafeUrl.fromDataUrl(X)).getTypedStringValue()==X?Z:(goog.asserts.assert(goog.html.SAFE_URL_PATTERN_.test(X),"%s does not match the safe URL pattern",X)||(X=goog.html.SafeUrl.INNOCUOUS_STRING),goog.html.SafeUrl.createSafeUrlSecurityPrivateDoNotAccessOrElse(X)))},goog.html.SafeUrl.TYPE_MARKER_GOOG_HTML_SECURITY_PRIVATE_={},goog.html.SafeUrl.createSafeUrlSecurityPrivateDoNotAccessOrElse=function(X){return new goog.html.SafeUrl(goog.html.SafeUrl.CONSTRUCTOR_TOKEN_PRIVATE_,X)},goog.html.SafeUrl.ABOUT_BLANK=goog.html.SafeUrl.createSafeUrlSecurityPrivateDoNotAccessOrElse("about:blank"),goog.html.SafeUrl.CONSTRUCTOR_TOKEN_PRIVATE_={},goog.html.SafeStyle=function(){this.privateDoNotAccessOrElseSafeStyleWrappedValue_="",this.SAFE_STYLE_TYPE_MARKER_GOOG_HTML_SECURITY_PRIVATE_=goog.html.SafeStyle.TYPE_MARKER_GOOG_HTML_SECURITY_PRIVATE_},goog.html.SafeStyle.prototype.implementsGoogStringTypedString=!0,goog.html.SafeStyle.TYPE_MARKER_GOOG_HTML_SECURITY_PRIVATE_={},goog.html.SafeStyle.fromConstant=function(X){return(X=goog.string.Const.unwrap(X)).length===0?goog.html.SafeStyle.EMPTY:(goog.asserts.assert(goog.string.internal.endsWith(X,";"),"Last character of style string is not ';': "+X),goog.asserts.assert(goog.string.internal.contains(X,":"),`Style string must contain at least one ':', to specify a "name: value" pair: `+X),goog.html.SafeStyle.createSafeStyleSecurityPrivateDoNotAccessOrElse(X))},goog.html.SafeStyle.prototype.getTypedStringValue=function(){return this.privateDoNotAccessOrElseSafeStyleWrappedValue_},goog.DEBUG&&(goog.html.SafeStyle.prototype.toString=function(){return"SafeStyle{"+this.privateDoNotAccessOrElseSafeStyleWrappedValue_+"}"}),goog.html.SafeStyle.unwrap=function(X){return X instanceof goog.html.SafeStyle&&X.constructor===goog.html.SafeStyle&&X.SAFE_STYLE_TYPE_MARKER_GOOG_HTML_SECURITY_PRIVATE_===goog.html.SafeStyle.TYPE_MARKER_GOOG_HTML_SECURITY_PRIVATE_?X.privateDoNotAccessOrElseSafeStyleWrappedValue_:(goog.asserts.fail("expected object of type SafeStyle, got '"+X+"' of type "+goog.typeOf(X)),"type_error:SafeStyle")},goog.html.SafeStyle.createSafeStyleSecurityPrivateDoNotAccessOrElse=function(X){return new goog.html.SafeStyle().initSecurityPrivateDoNotAccessOrElse_(X)},goog.html.SafeStyle.prototype.initSecurityPrivateDoNotAccessOrElse_=function(X){return this.privateDoNotAccessOrElseSafeStyleWrappedValue_=X,this},goog.html.SafeStyle.EMPTY=goog.html.SafeStyle.createSafeStyleSecurityPrivateDoNotAccessOrElse(""),goog.html.SafeStyle.INNOCUOUS_STRING="zClosurez",goog.html.SafeStyle.create=function(X){var Z,_="";for(Z in X){if(!/^[-_a-zA-Z0-9]+$/.test(Z))throw Error("Name allows only [-_a-zA-Z0-9], got: "+Z);var K=X[Z];K!=null&&(_+=Z+":"+(K=Array.isArray(K)?goog.array.map(K,goog.html.SafeStyle.sanitizePropertyValue_).join(" "):goog.html.SafeStyle.sanitizePropertyValue_(K))+";")}return _?goog.html.SafeStyle.createSafeStyleSecurityPrivateDoNotAccessOrElse(_):goog.html.SafeStyle.EMPTY},goog.html.SafeStyle.sanitizePropertyValue_=function(X){if(X instanceof goog.html.SafeUrl)return'url("'+goog.html.SafeUrl.unwrap(X).replace(/</g,"%3c").replace(/[\\"]/g,"\\$&")+'")';if(X=X instanceof goog.string.Const?goog.string.Const.unwrap(X):goog.html.SafeStyle.sanitizePropertyValueString_(String(X)),/[{;}]/.test(X))throw new goog.asserts.AssertionError("Value does not allow [{;}], got: %s.",[X]);return X},goog.html.SafeStyle.sanitizePropertyValueString_=function(X){var Z=X.replace(goog.html.SafeStyle.FUNCTIONS_RE_,"$1").replace(goog.html.SafeStyle.FUNCTIONS_RE_,"$1").replace(goog.html.SafeStyle.URL_RE_,"url");return goog.html.SafeStyle.VALUE_RE_.test(Z)?goog.html.SafeStyle.COMMENT_RE_.test(X)?(goog.asserts.fail("String value disallows comments, got: "+X),goog.html.SafeStyle.INNOCUOUS_STRING):goog.html.SafeStyle.hasBalancedQuotes_(X)?goog.html.SafeStyle.hasBalancedSquareBrackets_(X)?goog.html.SafeStyle.sanitizeUrl_(X):(goog.asserts.fail("String value requires balanced square brackets and one identifier per pair of brackets, got: "+X),goog.html.SafeStyle.INNOCUOUS_STRING):(goog.asserts.fail("String value requires balanced quotes, got: "+X),goog.html.SafeStyle.INNOCUOUS_STRING):(goog.asserts.fail("String value allows only "+goog.html.SafeStyle.VALUE_ALLOWED_CHARS_+" and simple functions, got: "+X),goog.html.SafeStyle.INNOCUOUS_STRING)},goog.html.SafeStyle.hasBalancedQuotes_=function(X){for(var Z=!0,_=!0,K=0;K<X.length;K++){var te=X.charAt(K);te=="'"&&_?Z=!Z:te=='"'&&Z&&(_=!_)}return Z&&_},goog.html.SafeStyle.hasBalancedSquareBrackets_=function(X){for(var Z=!0,_=/^[-_a-zA-Z0-9]$/,K=0;K<X.length;K++){var te=X.charAt(K);if(te=="]"){if(Z)return!1;Z=!0}else if(te=="["){if(!Z)return!1;Z=!1}else if(!Z&&!_.test(te))return!1}return Z},goog.html.SafeStyle.VALUE_ALLOWED_CHARS_=`[-,."'%_!# a-zA-Z0-9\\[\\]]`,goog.html.SafeStyle.VALUE_RE_=new RegExp("^"+goog.html.SafeStyle.VALUE_ALLOWED_CHARS_+"+$"),goog.html.SafeStyle.URL_RE_=/\b(url\([ \t\n]*)('[ -&(-\[\]-~]*'|"[ !#-\[\]-~]*"|[!#-&*-\[\]-~]*)([ \t\n]*\))/g,goog.html.SafeStyle.ALLOWED_FUNCTIONS_="calc cubic-bezier fit-content hsl hsla linear-gradient matrix minmax repeat rgb rgba (rotate|scale|translate)(X|Y|Z|3d)?".split(" "),goog.html.SafeStyle.FUNCTIONS_RE_=new RegExp("\\b("+goog.html.SafeStyle.ALLOWED_FUNCTIONS_.join("|")+")\\([-+*/0-9a-z.%\\[\\], ]+\\)","g"),goog.html.SafeStyle.COMMENT_RE_=/\/\*/,goog.html.SafeStyle.sanitizeUrl_=function(X){return X.replace(goog.html.SafeStyle.URL_RE_,function(Z,_,K,te){var ne="";return K=K.replace(/^(['"])(.*)\1$/,function(oe,ie,se){return ne=ie,se}),Z=goog.html.SafeUrl.sanitize(K).getTypedStringValue(),_+ne+Z+ne+te})},goog.html.SafeStyle.concat=function(X){var Z="",_=function(K){Array.isArray(K)?goog.array.forEach(K,_):Z+=goog.html.SafeStyle.unwrap(K)};return goog.array.forEach(arguments,_),Z?goog.html.SafeStyle.createSafeStyleSecurityPrivateDoNotAccessOrElse(Z):goog.html.SafeStyle.EMPTY},goog.html.SafeStyleSheet=function(){this.privateDoNotAccessOrElseSafeStyleSheetWrappedValue_="",this.SAFE_STYLE_SHEET_TYPE_MARKER_GOOG_HTML_SECURITY_PRIVATE_=goog.html.SafeStyleSheet.TYPE_MARKER_GOOG_HTML_SECURITY_PRIVATE_},goog.html.SafeStyleSheet.prototype.implementsGoogStringTypedString=!0,goog.html.SafeStyleSheet.TYPE_MARKER_GOOG_HTML_SECURITY_PRIVATE_={},goog.html.SafeStyleSheet.createRule=function(X,Z){if(goog.string.internal.contains(X,"<"))throw Error("Selector does not allow '<', got: "+X);var _=X.replace(/('|")((?!\1)[^\r\n\f\\]|\\[\s\S])*\1/g,"");if(!/^[-_a-zA-Z0-9#.:* ,>+~[\]()=^$|]+$/.test(_))throw Error("Selector allows only [-_a-zA-Z0-9#.:* ,>+~[\\]()=^$|] and strings, got: "+X);if(!goog.html.SafeStyleSheet.hasBalancedBrackets_(_))throw Error("() and [] in selector must be balanced, got: "+X);return Z instanceof goog.html.SafeStyle||(Z=goog.html.SafeStyle.create(Z)),X=X+"{"+goog.html.SafeStyle.unwrap(Z).replace(/</g,"\\3C ")+"}",goog.html.SafeStyleSheet.createSafeStyleSheetSecurityPrivateDoNotAccessOrElse(X)},goog.html.SafeStyleSheet.hasBalancedBrackets_=function(X){for(var Z={"(":")","[":"]"},_=[],K=0;K<X.length;K++){var te=X[K];if(Z[te])_.push(Z[te]);else if(goog.object.contains(Z,te)&&_.pop()!=te)return!1}return _.length==0},goog.html.SafeStyleSheet.concat=function(X){var Z="",_=function(K){Array.isArray(K)?goog.array.forEach(K,_):Z+=goog.html.SafeStyleSheet.unwrap(K)};return goog.array.forEach(arguments,_),goog.html.SafeStyleSheet.createSafeStyleSheetSecurityPrivateDoNotAccessOrElse(Z)},goog.html.SafeStyleSheet.fromConstant=function(X){return(X=goog.string.Const.unwrap(X)).length===0?goog.html.SafeStyleSheet.EMPTY:(goog.asserts.assert(!goog.string.internal.contains(X,"<"),"Forbidden '<' character in style sheet string: "+X),goog.html.SafeStyleSheet.createSafeStyleSheetSecurityPrivateDoNotAccessOrElse(X))},goog.html.SafeStyleSheet.prototype.getTypedStringValue=function(){return this.privateDoNotAccessOrElseSafeStyleSheetWrappedValue_},goog.DEBUG&&(goog.html.SafeStyleSheet.prototype.toString=function(){return"SafeStyleSheet{"+this.privateDoNotAccessOrElseSafeStyleSheetWrappedValue_+"}"}),goog.html.SafeStyleSheet.unwrap=function(X){return X instanceof goog.html.SafeStyleSheet&&X.constructor===goog.html.SafeStyleSheet&&X.SAFE_STYLE_SHEET_TYPE_MARKER_GOOG_HTML_SECURITY_PRIVATE_===goog.html.SafeStyleSheet.TYPE_MARKER_GOOG_HTML_SECURITY_PRIVATE_?X.privateDoNotAccessOrElseSafeStyleSheetWrappedValue_:(goog.asserts.fail("expected object of type SafeStyleSheet, got '"+X+"' of type "+goog.typeOf(X)),"type_error:SafeStyleSheet")},goog.html.SafeStyleSheet.createSafeStyleSheetSecurityPrivateDoNotAccessOrElse=function(X){return new goog.html.SafeStyleSheet().initSecurityPrivateDoNotAccessOrElse_(X)},goog.html.SafeStyleSheet.prototype.initSecurityPrivateDoNotAccessOrElse_=function(X){return this.privateDoNotAccessOrElseSafeStyleSheetWrappedValue_=X,this},goog.html.SafeStyleSheet.EMPTY=goog.html.SafeStyleSheet.createSafeStyleSheetSecurityPrivateDoNotAccessOrElse(""),goog.labs={},goog.labs.userAgent={},goog.labs.userAgent.util={},goog.labs.userAgent.util.getNativeUserAgentString_=function(){var X=goog.labs.userAgent.util.getNavigator_();return X&&(X=X.userAgent)?X:""},goog.labs.userAgent.util.getNavigator_=function(){return goog.global.navigator},goog.labs.userAgent.util.userAgent_=goog.labs.userAgent.util.getNativeUserAgentString_(),goog.labs.userAgent.util.setUserAgent=function(X){goog.labs.userAgent.util.userAgent_=X||goog.labs.userAgent.util.getNativeUserAgentString_()},goog.labs.userAgent.util.getUserAgent=function(){return goog.labs.userAgent.util.userAgent_},goog.labs.userAgent.util.matchUserAgent=function(X){var Z=goog.labs.userAgent.util.getUserAgent();return goog.string.internal.contains(Z,X)},goog.labs.userAgent.util.matchUserAgentIgnoreCase=function(X){var Z=goog.labs.userAgent.util.getUserAgent();return goog.string.internal.caseInsensitiveContains(Z,X)},goog.labs.userAgent.util.extractVersionTuples=function(X){for(var Z,_=/(\w[\w ]+)\/([^\s]+)\s*(?:\((.*?)\))?/g,K=[];Z=_.exec(X);)K.push([Z[1],Z[2],Z[3]||void 0]);return K},goog.labs.userAgent.browser={},goog.labs.userAgent.browser.matchOpera_=function(){return goog.labs.userAgent.util.matchUserAgent("Opera")},goog.labs.userAgent.browser.matchIE_=function(){return goog.labs.userAgent.util.matchUserAgent("Trident")||goog.labs.userAgent.util.matchUserAgent("MSIE")},goog.labs.userAgent.browser.matchEdgeHtml_=function(){return goog.labs.userAgent.util.matchUserAgent("Edge")},goog.labs.userAgent.browser.matchEdgeChromium_=function(){return goog.labs.userAgent.util.matchUserAgent("Edg/")},goog.labs.userAgent.browser.matchOperaChromium_=function(){return goog.labs.userAgent.util.matchUserAgent("OPR")},goog.labs.userAgent.browser.matchFirefox_=function(){return goog.labs.userAgent.util.matchUserAgent("Firefox")||goog.labs.userAgent.util.matchUserAgent("FxiOS")},goog.labs.userAgent.browser.matchSafari_=function(){return goog.labs.userAgent.util.matchUserAgent("Safari")&&!(goog.labs.userAgent.browser.matchChrome_()||goog.labs.userAgent.browser.matchCoast_()||goog.labs.userAgent.browser.matchOpera_()||goog.labs.userAgent.browser.matchEdgeHtml_()||goog.labs.userAgent.browser.matchEdgeChromium_()||goog.labs.userAgent.browser.matchOperaChromium_()||goog.labs.userAgent.browser.matchFirefox_()||goog.labs.userAgent.browser.isSilk()||goog.labs.userAgent.util.matchUserAgent("Android"))},goog.labs.userAgent.browser.matchCoast_=function(){return goog.labs.userAgent.util.matchUserAgent("Coast")},goog.labs.userAgent.browser.matchIosWebview_=function(){return(goog.labs.userAgent.util.matchUserAgent("iPad")||goog.labs.userAgent.util.matchUserAgent("iPhone"))&&!goog.labs.userAgent.browser.matchSafari_()&&!goog.labs.userAgent.browser.matchChrome_()&&!goog.labs.userAgent.browser.matchCoast_()&&!goog.labs.userAgent.browser.matchFirefox_()&&goog.labs.userAgent.util.matchUserAgent("AppleWebKit")},goog.labs.userAgent.browser.matchChrome_=function(){return(goog.labs.userAgent.util.matchUserAgent("Chrome")||goog.labs.userAgent.util.matchUserAgent("CriOS"))&&!goog.labs.userAgent.browser.matchEdgeHtml_()},goog.labs.userAgent.browser.matchAndroidBrowser_=function(){return goog.labs.userAgent.util.matchUserAgent("Android")&&!(goog.labs.userAgent.browser.isChrome()||goog.labs.userAgent.browser.isFirefox()||goog.labs.userAgent.browser.isOpera()||goog.labs.userAgent.browser.isSilk())},goog.labs.userAgent.browser.isOpera=goog.labs.userAgent.browser.matchOpera_,goog.labs.userAgent.browser.isIE=goog.labs.userAgent.browser.matchIE_,goog.labs.userAgent.browser.isEdge=goog.labs.userAgent.browser.matchEdgeHtml_,goog.labs.userAgent.browser.isEdgeChromium=goog.labs.userAgent.browser.matchEdgeChromium_,goog.labs.userAgent.browser.isOperaChromium=goog.labs.userAgent.browser.matchOperaChromium_,goog.labs.userAgent.browser.isFirefox=goog.labs.userAgent.browser.matchFirefox_,goog.labs.userAgent.browser.isSafari=goog.labs.userAgent.browser.matchSafari_,goog.labs.userAgent.browser.isCoast=goog.labs.userAgent.browser.matchCoast_,goog.labs.userAgent.browser.isIosWebview=goog.labs.userAgent.browser.matchIosWebview_,goog.labs.userAgent.browser.isChrome=goog.labs.userAgent.browser.matchChrome_,goog.labs.userAgent.browser.isAndroidBrowser=goog.labs.userAgent.browser.matchAndroidBrowser_,goog.labs.userAgent.browser.isSilk=function(){return goog.labs.userAgent.util.matchUserAgent("Silk")},goog.labs.userAgent.browser.getVersion=function(){function X(te){return te=goog.array.find(te,K),_[te]||""}var Z=goog.labs.userAgent.util.getUserAgent();if(goog.labs.userAgent.browser.isIE())return goog.labs.userAgent.browser.getIEVersion_(Z);Z=goog.labs.userAgent.util.extractVersionTuples(Z);var _={};goog.array.forEach(Z,function(te){_[te[0]]=te[1]});var K=goog.partial(goog.object.containsKey,_);return goog.labs.userAgent.browser.isOpera()?X(["Version","Opera"]):goog.labs.userAgent.browser.isEdge()?X(["Edge"]):goog.labs.userAgent.browser.isEdgeChromium()?X(["Edg"]):goog.labs.userAgent.browser.isChrome()?X(["Chrome","CriOS","HeadlessChrome"]):(Z=Z[2])&&Z[1]||""},goog.labs.userAgent.browser.isVersionOrHigher=function(X){return 0<=goog.string.internal.compareVersions(goog.labs.userAgent.browser.getVersion(),X)},goog.labs.userAgent.browser.getIEVersion_=function(X){var Z=/rv: *([\d\.]*)/.exec(X);if(Z&&Z[1])return Z[1];Z="";var _=/MSIE +([\d\.]+)/.exec(X);if(_&&_[1])if(X=/Trident\/(\d.\d)/.exec(X),_[1]=="7.0")if(X&&X[1])switch(X[1]){case"4.0":Z="8.0";break;case"5.0":Z="9.0";break;case"6.0":Z="10.0";break;case"7.0":Z="11.0"}else Z="7.0";else Z=_[1];return Z},goog.html.SafeHtml=function(){this.privateDoNotAccessOrElseSafeHtmlWrappedValue_="",this.SAFE_HTML_TYPE_MARKER_GOOG_HTML_SECURITY_PRIVATE_=goog.html.SafeHtml.TYPE_MARKER_GOOG_HTML_SECURITY_PRIVATE_,this.dir_=null},goog.html.SafeHtml.ENABLE_ERROR_MESSAGES=goog.DEBUG,goog.html.SafeHtml.SUPPORT_STYLE_ATTRIBUTE=!0,goog.html.SafeHtml.prototype.implementsGoogI18nBidiDirectionalString=!0,goog.html.SafeHtml.prototype.getDirection=function(){return this.dir_},goog.html.SafeHtml.prototype.implementsGoogStringTypedString=!0,goog.html.SafeHtml.prototype.getTypedStringValue=function(){return this.privateDoNotAccessOrElseSafeHtmlWrappedValue_.toString()},goog.DEBUG&&(goog.html.SafeHtml.prototype.toString=function(){return"SafeHtml{"+this.privateDoNotAccessOrElseSafeHtmlWrappedValue_+"}"}),goog.html.SafeHtml.unwrap=function(X){return goog.html.SafeHtml.unwrapTrustedHTML(X).toString()},goog.html.SafeHtml.unwrapTrustedHTML=function(X){return X instanceof goog.html.SafeHtml&&X.constructor===goog.html.SafeHtml&&X.SAFE_HTML_TYPE_MARKER_GOOG_HTML_SECURITY_PRIVATE_===goog.html.SafeHtml.TYPE_MARKER_GOOG_HTML_SECURITY_PRIVATE_?X.privateDoNotAccessOrElseSafeHtmlWrappedValue_:(goog.asserts.fail("expected object of type SafeHtml, got '"+X+"' of type "+goog.typeOf(X)),"type_error:SafeHtml")},goog.html.SafeHtml.htmlEscape=function(X){if(X instanceof goog.html.SafeHtml)return X;var Z=typeof X=="object",_=null;return Z&&X.implementsGoogI18nBidiDirectionalString&&(_=X.getDirection()),X=Z&&X.implementsGoogStringTypedString?X.getTypedStringValue():String(X),goog.html.SafeHtml.createSafeHtmlSecurityPrivateDoNotAccessOrElse(goog.string.internal.htmlEscape(X),_)},goog.html.SafeHtml.htmlEscapePreservingNewlines=function(X){return X instanceof goog.html.SafeHtml?X:(X=goog.html.SafeHtml.htmlEscape(X),goog.html.SafeHtml.createSafeHtmlSecurityPrivateDoNotAccessOrElse(goog.string.internal.newLineToBr(goog.html.SafeHtml.unwrap(X)),X.getDirection()))},goog.html.SafeHtml.htmlEscapePreservingNewlinesAndSpaces=function(X){return X instanceof goog.html.SafeHtml?X:(X=goog.html.SafeHtml.htmlEscape(X),goog.html.SafeHtml.createSafeHtmlSecurityPrivateDoNotAccessOrElse(goog.string.internal.whitespaceEscape(goog.html.SafeHtml.unwrap(X)),X.getDirection()))},goog.html.SafeHtml.from=goog.html.SafeHtml.htmlEscape,goog.html.SafeHtml.comment=function(X){return goog.html.SafeHtml.createSafeHtmlSecurityPrivateDoNotAccessOrElse("<!--"+goog.string.internal.htmlEscape(X)+"-->",null)},goog.html.SafeHtml.VALID_NAMES_IN_TAG_=/^[a-zA-Z0-9-]+$/,goog.html.SafeHtml.URL_ATTRIBUTES_={action:!0,cite:!0,data:!0,formaction:!0,href:!0,manifest:!0,poster:!0,src:!0},goog.html.SafeHtml.NOT_ALLOWED_TAG_NAMES_={APPLET:!0,BASE:!0,EMBED:!0,IFRAME:!0,LINK:!0,MATH:!0,META:!0,OBJECT:!0,SCRIPT:!0,STYLE:!0,SVG:!0,TEMPLATE:!0},goog.html.SafeHtml.create=function(X,Z,_){return goog.html.SafeHtml.verifyTagName(String(X)),goog.html.SafeHtml.createSafeHtmlTagSecurityPrivateDoNotAccessOrElse(String(X),Z,_)},goog.html.SafeHtml.verifyTagName=function(X){if(!goog.html.SafeHtml.VALID_NAMES_IN_TAG_.test(X))throw Error(goog.html.SafeHtml.ENABLE_ERROR_MESSAGES?"Invalid tag name <"+X+">.":"");if(X.toUpperCase()in goog.html.SafeHtml.NOT_ALLOWED_TAG_NAMES_)throw Error(goog.html.SafeHtml.ENABLE_ERROR_MESSAGES?"Tag name <"+X+"> is not allowed for SafeHtml.":"")},goog.html.SafeHtml.createIframe=function(X,Z,_,K){X&&goog.html.TrustedResourceUrl.unwrap(X);var te={};return te.src=X||null,te.srcdoc=Z&&goog.html.SafeHtml.unwrap(Z),X=goog.html.SafeHtml.combineAttributes(te,{sandbox:""},_),goog.html.SafeHtml.createSafeHtmlTagSecurityPrivateDoNotAccessOrElse("iframe",X,K)},goog.html.SafeHtml.createSandboxIframe=function(X,Z,_,K){if(!goog.html.SafeHtml.canUseSandboxIframe())throw Error(goog.html.SafeHtml.ENABLE_ERROR_MESSAGES?"The browser does not support sandboxed iframes.":"");var te={};return te.src=X?goog.html.SafeUrl.unwrap(goog.html.SafeUrl.sanitize(X)):null,te.srcdoc=Z||null,te.sandbox="",X=goog.html.SafeHtml.combineAttributes(te,{},_),goog.html.SafeHtml.createSafeHtmlTagSecurityPrivateDoNotAccessOrElse("iframe",X,K)},goog.html.SafeHtml.canUseSandboxIframe=function(){return goog.global.HTMLIFrameElement&&"sandbox"in goog.global.HTMLIFrameElement.prototype},goog.html.SafeHtml.createScriptSrc=function(X,Z){return goog.html.TrustedResourceUrl.unwrap(X),X=goog.html.SafeHtml.combineAttributes({src:X},{},Z),goog.html.SafeHtml.createSafeHtmlTagSecurityPrivateDoNotAccessOrElse("script",X)},goog.html.SafeHtml.createScript=function(X,Z){for(var _ in Z){var K=_.toLowerCase();if(K=="language"||K=="src"||K=="text"||K=="type")throw Error(goog.html.SafeHtml.ENABLE_ERROR_MESSAGES?'Cannot set "'+K+'" attribute':"")}for(_="",X=goog.array.concat(X),K=0;K<X.length;K++)_+=goog.html.SafeScript.unwrap(X[K]);return X=goog.html.SafeHtml.createSafeHtmlSecurityPrivateDoNotAccessOrElse(_,goog.i18n.bidi.Dir.NEUTRAL),goog.html.SafeHtml.createSafeHtmlTagSecurityPrivateDoNotAccessOrElse("script",Z,X)},goog.html.SafeHtml.createStyle=function(X,Z){Z=goog.html.SafeHtml.combineAttributes({type:"text/css"},{},Z);var _="";X=goog.array.concat(X);for(var K=0;K<X.length;K++)_+=goog.html.SafeStyleSheet.unwrap(X[K]);return X=goog.html.SafeHtml.createSafeHtmlSecurityPrivateDoNotAccessOrElse(_,goog.i18n.bidi.Dir.NEUTRAL),goog.html.SafeHtml.createSafeHtmlTagSecurityPrivateDoNotAccessOrElse("style",Z,X)},goog.html.SafeHtml.createMetaRefresh=function(X,Z){return X=goog.html.SafeUrl.unwrap(goog.html.SafeUrl.sanitize(X)),(goog.labs.userAgent.browser.isIE()||goog.labs.userAgent.browser.isEdge())&&goog.string.internal.contains(X,";")&&(X="'"+X.replace(/'/g,"%27")+"'"),goog.html.SafeHtml.createSafeHtmlTagSecurityPrivateDoNotAccessOrElse("meta",{"http-equiv":"refresh",content:(Z||0)+"; url="+X})},goog.html.SafeHtml.getAttrNameAndValue_=function(X,Z,_){if(_ instanceof goog.string.Const)_=goog.string.Const.unwrap(_);else if(Z.toLowerCase()=="style"){if(!goog.html.SafeHtml.SUPPORT_STYLE_ATTRIBUTE)throw Error(goog.html.SafeHtml.ENABLE_ERROR_MESSAGES?'Attribute "style" not supported.':"");_=goog.html.SafeHtml.getStyleValue_(_)}else{if(/^on/i.test(Z))throw Error(goog.html.SafeHtml.ENABLE_ERROR_MESSAGES?'Attribute "'+Z+'" requires goog.string.Const value, "'+_+'" given.':"");if(Z.toLowerCase()in goog.html.SafeHtml.URL_ATTRIBUTES_)if(_ instanceof goog.html.TrustedResourceUrl)_=goog.html.TrustedResourceUrl.unwrap(_);else if(_ instanceof goog.html.SafeUrl)_=goog.html.SafeUrl.unwrap(_);else{if(typeof _!="string")throw Error(goog.html.SafeHtml.ENABLE_ERROR_MESSAGES?'Attribute "'+Z+'" on tag "'+X+'" requires goog.html.SafeUrl, goog.string.Const, or string, value "'+_+'" given.':"");_=goog.html.SafeUrl.sanitize(_).getTypedStringValue()}}return _.implementsGoogStringTypedString&&(_=_.getTypedStringValue()),goog.asserts.assert(typeof _=="string"||typeof _=="number","String or number value expected, got "+typeof _+" with value: "+_),Z+'="'+goog.string.internal.htmlEscape(String(_))+'"'},goog.html.SafeHtml.getStyleValue_=function(X){if(!goog.isObject(X))throw Error(goog.html.SafeHtml.ENABLE_ERROR_MESSAGES?'The "style" attribute requires goog.html.SafeStyle or map of style properties, '+typeof X+" given: "+X:"");return X instanceof goog.html.SafeStyle||(X=goog.html.SafeStyle.create(X)),goog.html.SafeStyle.unwrap(X)},goog.html.SafeHtml.createWithDir=function(X,Z,_,K){return(Z=goog.html.SafeHtml.create(Z,_,K)).dir_=X,Z},goog.html.SafeHtml.join=function(X,Z){var _=(X=goog.html.SafeHtml.htmlEscape(X)).getDirection(),K=[],te=function(ne){Array.isArray(ne)?goog.array.forEach(ne,te):(ne=goog.html.SafeHtml.htmlEscape(ne),K.push(goog.html.SafeHtml.unwrap(ne)),ne=ne.getDirection(),_==goog.i18n.bidi.Dir.NEUTRAL?_=ne:ne!=goog.i18n.bidi.Dir.NEUTRAL&&_!=ne&&(_=null))};return goog.array.forEach(Z,te),goog.html.SafeHtml.createSafeHtmlSecurityPrivateDoNotAccessOrElse(K.join(goog.html.SafeHtml.unwrap(X)),_)},goog.html.SafeHtml.concat=function(X){return goog.html.SafeHtml.join(goog.html.SafeHtml.EMPTY,Array.prototype.slice.call(arguments))},goog.html.SafeHtml.concatWithDir=function(X,Z){var _=goog.html.SafeHtml.concat(goog.array.slice(arguments,1));return _.dir_=X,_},goog.html.SafeHtml.TYPE_MARKER_GOOG_HTML_SECURITY_PRIVATE_={},goog.html.SafeHtml.createSafeHtmlSecurityPrivateDoNotAccessOrElse=function(X,Z){return new goog.html.SafeHtml().initSecurityPrivateDoNotAccessOrElse_(X,Z)},goog.html.SafeHtml.prototype.initSecurityPrivateDoNotAccessOrElse_=function(X,Z){return this.privateDoNotAccessOrElseSafeHtmlWrappedValue_=goog.html.trustedtypes.PRIVATE_DO_NOT_ACCESS_OR_ELSE_POLICY?goog.html.trustedtypes.PRIVATE_DO_NOT_ACCESS_OR_ELSE_POLICY.createHTML(X):X,this.dir_=Z,this},goog.html.SafeHtml.createSafeHtmlTagSecurityPrivateDoNotAccessOrElse=function(X,Z,_){var K=null,te="<"+X+goog.html.SafeHtml.stringifyAttributes(X,Z);return _==null?_=[]:Array.isArray(_)||(_=[_]),goog.dom.tags.isVoidTag(X.toLowerCase())?(goog.asserts.assert(!_.length,"Void tag <"+X+"> does not allow content."),te+=">"):(K=goog.html.SafeHtml.concat(_),te+=">"+goog.html.SafeHtml.unwrap(K)+"</"+X+">",K=K.getDirection()),(X=Z&&Z.dir)&&(K=/^(ltr|rtl|auto)$/i.test(X)?goog.i18n.bidi.Dir.NEUTRAL:null),goog.html.SafeHtml.createSafeHtmlSecurityPrivateDoNotAccessOrElse(te,K)},goog.html.SafeHtml.stringifyAttributes=function(X,Z){var _="";if(Z)for(var K in Z){if(!goog.html.SafeHtml.VALID_NAMES_IN_TAG_.test(K))throw Error(goog.html.SafeHtml.ENABLE_ERROR_MESSAGES?'Invalid attribute name "'+K+'".':"");var te=Z[K];te!=null&&(_+=" "+goog.html.SafeHtml.getAttrNameAndValue_(X,K,te))}return _},goog.html.SafeHtml.combineAttributes=function(X,Z,_){var K,te={};for(K in X)goog.asserts.assert(K.toLowerCase()==K,"Must be lower case"),te[K]=X[K];for(K in Z)goog.asserts.assert(K.toLowerCase()==K,"Must be lower case"),te[K]=Z[K];if(_)for(K in _){var ne=K.toLowerCase();if(ne in X)throw Error(goog.html.SafeHtml.ENABLE_ERROR_MESSAGES?'Cannot override "'+ne+'" attribute, got "'+K+'" with value "'+_[K]+'"':"");ne in Z&&delete te[ne],te[K]=_[K]}return te},goog.html.SafeHtml.DOCTYPE_HTML=goog.html.SafeHtml.createSafeHtmlSecurityPrivateDoNotAccessOrElse("<!DOCTYPE html>",goog.i18n.bidi.Dir.NEUTRAL),goog.html.SafeHtml.EMPTY=goog.html.SafeHtml.createSafeHtmlSecurityPrivateDoNotAccessOrElse("",goog.i18n.bidi.Dir.NEUTRAL),goog.html.SafeHtml.BR=goog.html.SafeHtml.createSafeHtmlSecurityPrivateDoNotAccessOrElse("<br>",goog.i18n.bidi.Dir.NEUTRAL),goog.html.uncheckedconversions={},goog.html.uncheckedconversions.safeHtmlFromStringKnownToSatisfyTypeContract=function(X,Z,_){return goog.asserts.assertString(goog.string.Const.unwrap(X),"must provide justification"),goog.asserts.assert(!goog.string.internal.isEmptyOrWhitespace(goog.string.Const.unwrap(X)),"must provide non-empty justification"),goog.html.SafeHtml.createSafeHtmlSecurityPrivateDoNotAccessOrElse(Z,_||null)},goog.html.uncheckedconversions.safeScriptFromStringKnownToSatisfyTypeContract=function(X,Z){return goog.asserts.assertString(goog.string.Const.unwrap(X),"must provide justification"),goog.asserts.assert(!goog.string.internal.isEmptyOrWhitespace(goog.string.Const.unwrap(X)),"must provide non-empty justification"),goog.html.SafeScript.createSafeScriptSecurityPrivateDoNotAccessOrElse(Z)},goog.html.uncheckedconversions.safeStyleFromStringKnownToSatisfyTypeContract=function(X,Z){return goog.asserts.assertString(goog.string.Const.unwrap(X),"must provide justification"),goog.asserts.assert(!goog.string.internal.isEmptyOrWhitespace(goog.string.Const.unwrap(X)),"must provide non-empty justification"),goog.html.SafeStyle.createSafeStyleSecurityPrivateDoNotAccessOrElse(Z)},goog.html.uncheckedconversions.safeStyleSheetFromStringKnownToSatisfyTypeContract=function(X,Z){return goog.asserts.assertString(goog.string.Const.unwrap(X),"must provide justification"),goog.asserts.assert(!goog.string.internal.isEmptyOrWhitespace(goog.string.Const.unwrap(X)),"must provide non-empty justification"),goog.html.SafeStyleSheet.createSafeStyleSheetSecurityPrivateDoNotAccessOrElse(Z)},goog.html.uncheckedconversions.safeUrlFromStringKnownToSatisfyTypeContract=function(X,Z){return goog.asserts.assertString(goog.string.Const.unwrap(X),"must provide justification"),goog.asserts.assert(!goog.string.internal.isEmptyOrWhitespace(goog.string.Const.unwrap(X)),"must provide non-empty justification"),goog.html.SafeUrl.createSafeUrlSecurityPrivateDoNotAccessOrElse(Z)},goog.html.uncheckedconversions.trustedResourceUrlFromStringKnownToSatisfyTypeContract=function(X,Z){return goog.asserts.assertString(goog.string.Const.unwrap(X),"must provide justification"),goog.asserts.assert(!goog.string.internal.isEmptyOrWhitespace(goog.string.Const.unwrap(X)),"must provide non-empty justification"),goog.html.TrustedResourceUrl.createTrustedResourceUrlSecurityPrivateDoNotAccessOrElse(Z)},goog.dom.safe={},goog.dom.safe.InsertAdjacentHtmlPosition={AFTERBEGIN:"afterbegin",AFTEREND:"afterend",BEFOREBEGIN:"beforebegin",BEFOREEND:"beforeend"},goog.dom.safe.insertAdjacentHtml=function(X,Z,_){X.insertAdjacentHTML(Z,goog.html.SafeHtml.unwrapTrustedHTML(_))},goog.dom.safe.SET_INNER_HTML_DISALLOWED_TAGS_={MATH:!0,SCRIPT:!0,STYLE:!0,SVG:!0,TEMPLATE:!0},goog.dom.safe.isInnerHtmlCleanupRecursive_=goog.functions.cacheReturnValue(function(){if(goog.DEBUG&&typeof document>"u")return!1;var X=document.createElement("div"),Z=document.createElement("div");return Z.appendChild(document.createElement("div")),X.appendChild(Z),!(goog.DEBUG&&!X.firstChild)&&(Z=X.firstChild.firstChild,X.innerHTML=goog.html.SafeHtml.unwrapTrustedHTML(goog.html.SafeHtml.EMPTY),!Z.parentElement)}),goog.dom.safe.unsafeSetInnerHtmlDoNotUseOrElse=function(X,Z){if(goog.dom.safe.isInnerHtmlCleanupRecursive_())for(;X.lastChild;)X.removeChild(X.lastChild);X.innerHTML=goog.html.SafeHtml.unwrapTrustedHTML(Z)},goog.dom.safe.setInnerHtml=function(X,Z){if(goog.asserts.ENABLE_ASSERTS){var _=X.tagName.toUpperCase();if(goog.dom.safe.SET_INNER_HTML_DISALLOWED_TAGS_[_])throw Error("goog.dom.safe.setInnerHtml cannot be used to set content of "+X.tagName+".")}goog.dom.safe.unsafeSetInnerHtmlDoNotUseOrElse(X,Z)},goog.dom.safe.setOuterHtml=function(X,Z){X.outerHTML=goog.html.SafeHtml.unwrapTrustedHTML(Z)},goog.dom.safe.setFormElementAction=function(X,Z){Z=Z instanceof goog.html.SafeUrl?Z:goog.html.SafeUrl.sanitizeAssertUnchanged(Z),goog.dom.asserts.assertIsHTMLFormElement(X).action=goog.html.SafeUrl.unwrap(Z)},goog.dom.safe.setButtonFormAction=function(X,Z){Z=Z instanceof goog.html.SafeUrl?Z:goog.html.SafeUrl.sanitizeAssertUnchanged(Z),goog.dom.asserts.assertIsHTMLButtonElement(X).formAction=goog.html.SafeUrl.unwrap(Z)},goog.dom.safe.setInputFormAction=function(X,Z){Z=Z instanceof goog.html.SafeUrl?Z:goog.html.SafeUrl.sanitizeAssertUnchanged(Z),goog.dom.asserts.assertIsHTMLInputElement(X).formAction=goog.html.SafeUrl.unwrap(Z)},goog.dom.safe.setStyle=function(X,Z){X.style.cssText=goog.html.SafeStyle.unwrap(Z)},goog.dom.safe.documentWrite=function(X,Z){X.write(goog.html.SafeHtml.unwrapTrustedHTML(Z))},goog.dom.safe.setAnchorHref=function(X,Z){goog.dom.asserts.assertIsHTMLAnchorElement(X),Z=Z instanceof goog.html.SafeUrl?Z:goog.html.SafeUrl.sanitizeAssertUnchanged(Z),X.href=goog.html.SafeUrl.unwrap(Z)},goog.dom.safe.setImageSrc=function(X,Z){if(goog.dom.asserts.assertIsHTMLImageElement(X),!(Z instanceof goog.html.SafeUrl)){var _=/^data:image\//i.test(Z);Z=goog.html.SafeUrl.sanitizeAssertUnchanged(Z,_)}X.src=goog.html.SafeUrl.unwrap(Z)},goog.dom.safe.setAudioSrc=function(X,Z){if(goog.dom.asserts.assertIsHTMLAudioElement(X),!(Z instanceof goog.html.SafeUrl)){var _=/^data:audio\//i.test(Z);Z=goog.html.SafeUrl.sanitizeAssertUnchanged(Z,_)}X.src=goog.html.SafeUrl.unwrap(Z)},goog.dom.safe.setVideoSrc=function(X,Z){if(goog.dom.asserts.assertIsHTMLVideoElement(X),!(Z instanceof goog.html.SafeUrl)){var _=/^data:video\//i.test(Z);Z=goog.html.SafeUrl.sanitizeAssertUnchanged(Z,_)}X.src=goog.html.SafeUrl.unwrap(Z)},goog.dom.safe.setEmbedSrc=function(X,Z){goog.dom.asserts.assertIsHTMLEmbedElement(X),X.src=goog.html.TrustedResourceUrl.unwrapTrustedScriptURL(Z)},goog.dom.safe.setFrameSrc=function(X,Z){goog.dom.asserts.assertIsHTMLFrameElement(X),X.src=goog.html.TrustedResourceUrl.unwrap(Z)},goog.dom.safe.setIframeSrc=function(X,Z){goog.dom.asserts.assertIsHTMLIFrameElement(X),X.src=goog.html.TrustedResourceUrl.unwrap(Z)},goog.dom.safe.setIframeSrcdoc=function(X,Z){goog.dom.asserts.assertIsHTMLIFrameElement(X),X.srcdoc=goog.html.SafeHtml.unwrapTrustedHTML(Z)},goog.dom.safe.setLinkHrefAndRel=function(X,Z,_){goog.dom.asserts.assertIsHTMLLinkElement(X),X.rel=_,goog.string.internal.caseInsensitiveContains(_,"stylesheet")?(goog.asserts.assert(Z instanceof goog.html.TrustedResourceUrl,'URL must be TrustedResourceUrl because "rel" contains "stylesheet"'),X.href=goog.html.TrustedResourceUrl.unwrap(Z)):X.href=Z instanceof goog.html.TrustedResourceUrl?goog.html.TrustedResourceUrl.unwrap(Z):Z instanceof goog.html.SafeUrl?goog.html.SafeUrl.unwrap(Z):goog.html.SafeUrl.unwrap(goog.html.SafeUrl.sanitizeAssertUnchanged(Z))},goog.dom.safe.setObjectData=function(X,Z){goog.dom.asserts.assertIsHTMLObjectElement(X),X.data=goog.html.TrustedResourceUrl.unwrapTrustedScriptURL(Z)},goog.dom.safe.setScriptSrc=function(X,Z){goog.dom.asserts.assertIsHTMLScriptElement(X),X.src=goog.html.TrustedResourceUrl.unwrapTrustedScriptURL(Z),(Z=goog.getScriptNonce())&&X.setAttribute("nonce",Z)},goog.dom.safe.setScriptContent=function(X,Z){goog.dom.asserts.assertIsHTMLScriptElement(X),X.text=goog.html.SafeScript.unwrapTrustedScript(Z),(Z=goog.getScriptNonce())&&X.setAttribute("nonce",Z)},goog.dom.safe.setLocationHref=function(X,Z){goog.dom.asserts.assertIsLocation(X),Z=Z instanceof goog.html.SafeUrl?Z:goog.html.SafeUrl.sanitizeAssertUnchanged(Z),X.href=goog.html.SafeUrl.unwrap(Z)},goog.dom.safe.assignLocation=function(X,Z){goog.dom.asserts.assertIsLocation(X),Z=Z instanceof goog.html.SafeUrl?Z:goog.html.SafeUrl.sanitizeAssertUnchanged(Z),X.assign(goog.html.SafeUrl.unwrap(Z))},goog.dom.safe.replaceLocation=function(X,Z){Z=Z instanceof goog.html.SafeUrl?Z:goog.html.SafeUrl.sanitizeAssertUnchanged(Z),X.replace(goog.html.SafeUrl.unwrap(Z))},goog.dom.safe.openInWindow=function(X,Z,_,K,te){return X=X instanceof goog.html.SafeUrl?X:goog.html.SafeUrl.sanitizeAssertUnchanged(X),Z=Z||goog.global,_=_ instanceof goog.string.Const?goog.string.Const.unwrap(_):_||"",Z.open(goog.html.SafeUrl.unwrap(X),_,K,te)},goog.dom.safe.parseFromStringHtml=function(X,Z){return goog.dom.safe.parseFromString(X,Z,"text/html")},goog.dom.safe.parseFromString=function(X,Z,_){return X.parseFromString(goog.html.SafeHtml.unwrapTrustedHTML(Z),_)},goog.dom.safe.createImageFromBlob=function(X){if(!/^image\/.*/g.test(X.type))throw Error("goog.dom.safe.createImageFromBlob only accepts MIME type image/.*.");var Z=goog.global.URL.createObjectURL(X);return(X=new goog.global.Image).onload=function(){goog.global.URL.revokeObjectURL(Z)},goog.dom.safe.setImageSrc(X,goog.html.uncheckedconversions.safeUrlFromStringKnownToSatisfyTypeContract(goog.string.Const.from("Image blob URL."),Z)),X},goog.string.DETECT_DOUBLE_ESCAPING=!1,goog.string.FORCE_NON_DOM_HTML_UNESCAPING=!1,goog.string.Unicode={NBSP:" "},goog.string.startsWith=goog.string.internal.startsWith,goog.string.endsWith=goog.string.internal.endsWith,goog.string.caseInsensitiveStartsWith=goog.string.internal.caseInsensitiveStartsWith,goog.string.caseInsensitiveEndsWith=goog.string.internal.caseInsensitiveEndsWith,goog.string.caseInsensitiveEquals=goog.string.internal.caseInsensitiveEquals,goog.string.subs=function(X,Z){for(var _=X.split("%s"),K="",te=Array.prototype.slice.call(arguments,1);te.length&&1<_.length;)K+=_.shift()+te.shift();return K+_.join("%s")},goog.string.collapseWhitespace=function(X){return X.replace(/[\s\xa0]+/g," ").replace(/^\s+|\s+$/g,"")},goog.string.isEmptyOrWhitespace=goog.string.internal.isEmptyOrWhitespace,goog.string.isEmptyString=function(X){return X.length==0},goog.string.isEmpty=goog.string.isEmptyOrWhitespace,goog.string.isEmptyOrWhitespaceSafe=function(X){return goog.string.isEmptyOrWhitespace(goog.string.makeSafe(X))},goog.string.isEmptySafe=goog.string.isEmptyOrWhitespaceSafe,goog.string.isBreakingWhitespace=function(X){return!/[^\t\n\r ]/.test(X)},goog.string.isAlpha=function(X){return!/[^a-zA-Z]/.test(X)},goog.string.isNumeric=function(X){return!/[^0-9]/.test(X)},goog.string.isAlphaNumeric=function(X){return!/[^a-zA-Z0-9]/.test(X)},goog.string.isSpace=function(X){return X==" "},goog.string.isUnicodeChar=function(X){return X.length==1&&" "<=X&&"~">=X||""<=X&&"�">=X},goog.string.stripNewlines=function(X){return X.replace(/(\r\n|\r|\n)+/g," ")},goog.string.canonicalizeNewlines=function(X){return X.replace(/(\r\n|\r|\n)/g,`
`)},goog.string.normalizeWhitespace=function(X){return X.replace(/\xa0|\s/g," ")},goog.string.normalizeSpaces=function(X){return X.replace(/\xa0|[ \t]+/g," ")},goog.string.collapseBreakingSpaces=function(X){return X.replace(/[\t\r\n ]+/g," ").replace(/^[\t\r\n ]+|[\t\r\n ]+$/g,"")},goog.string.trim=goog.string.internal.trim,goog.string.trimLeft=function(X){return X.replace(/^[\s\xa0]+/,"")},goog.string.trimRight=function(X){return X.replace(/[\s\xa0]+$/,"")},goog.string.caseInsensitiveCompare=goog.string.internal.caseInsensitiveCompare,goog.string.numberAwareCompare_=function(X,Z,_){if(X==Z)return 0;if(!X)return-1;if(!Z)return 1;for(var K=X.toLowerCase().match(_),te=Z.toLowerCase().match(_),ne=Math.min(K.length,te.length),oe=0;oe<ne;oe++){_=K[oe];var ie=te[oe];if(_!=ie)return X=parseInt(_,10),!isNaN(X)&&(Z=parseInt(ie,10),!isNaN(Z)&&X-Z)?X-Z:_<ie?-1:1}return K.length!=te.length?K.length-te.length:X<Z?-1:1},goog.string.intAwareCompare=function(X,Z){return goog.string.numberAwareCompare_(X,Z,/\d+|\D+/g)},goog.string.floatAwareCompare=function(X,Z){return goog.string.numberAwareCompare_(X,Z,/\d+|\.\d+|\D+/g)},goog.string.numerateCompare=goog.string.floatAwareCompare,goog.string.urlEncode=function(X){return encodeURIComponent(String(X))},goog.string.urlDecode=function(X){return decodeURIComponent(X.replace(/\+/g," "))},goog.string.newLineToBr=goog.string.internal.newLineToBr,goog.string.htmlEscape=function(X,Z){return X=goog.string.internal.htmlEscape(X,Z),goog.string.DETECT_DOUBLE_ESCAPING&&(X=X.replace(goog.string.E_RE_,"&#101;")),X},goog.string.E_RE_=/e/g,goog.string.unescapeEntities=function(X){return goog.string.contains(X,"&")?!goog.string.FORCE_NON_DOM_HTML_UNESCAPING&&"document"in goog.global?goog.string.unescapeEntitiesUsingDom_(X):goog.string.unescapePureXmlEntities_(X):X},goog.string.unescapeEntitiesWithDocument=function(X,Z){return goog.string.contains(X,"&")?goog.string.unescapeEntitiesUsingDom_(X,Z):X},goog.string.unescapeEntitiesUsingDom_=function(X,Z){var _={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"'},K=Z?Z.createElement("div"):goog.global.document.createElement("div");return X.replace(goog.string.HTML_ENTITY_PATTERN_,function(te,ne){var oe=_[te];return oe||(ne.charAt(0)=="#"&&(ne=+("0"+ne.substr(1)),isNaN(ne)||(oe=String.fromCharCode(ne))),oe||(goog.dom.safe.setInnerHtml(K,goog.html.uncheckedconversions.safeHtmlFromStringKnownToSatisfyTypeContract(goog.string.Const.from("Single HTML entity."),te+" ")),oe=K.firstChild.nodeValue.slice(0,-1)),_[te]=oe)})},goog.string.unescapePureXmlEntities_=function(X){return X.replace(/&([^;]+);/g,function(Z,_){switch(_){case"amp":return"&";case"lt":return"<";case"gt":return">";case"quot":return'"';default:return _.charAt(0)!="#"||(_=+("0"+_.substr(1)),isNaN(_))?Z:String.fromCharCode(_)}})},goog.string.HTML_ENTITY_PATTERN_=/&([^;\s<&]+);?/g,goog.string.whitespaceEscape=function(X,Z){return goog.string.newLineToBr(X.replace(/  /g," &#160;"),Z)},goog.string.preserveSpaces=function(X){return X.replace(/(^|[\n ]) /g,"$1"+goog.string.Unicode.NBSP)},goog.string.stripQuotes=function(X,Z){for(var _=Z.length,K=0;K<_;K++){var te=_==1?Z:Z.charAt(K);if(X.charAt(0)==te&&X.charAt(X.length-1)==te)return X.substring(1,X.length-1)}return X},goog.string.truncate=function(X,Z,_){return _&&(X=goog.string.unescapeEntities(X)),X.length>Z&&(X=X.substring(0,Z-3)+"..."),_&&(X=goog.string.htmlEscape(X)),X},goog.string.truncateMiddle=function(X,Z,_,K){if(_&&(X=goog.string.unescapeEntities(X)),K&&X.length>Z){K>Z&&(K=Z);var te=X.length-K;X=X.substring(0,Z-K)+"..."+X.substring(te)}else X.length>Z&&(K=Math.floor(Z/2),te=X.length-K,X=X.substring(0,K+Z%2)+"..."+X.substring(te));return _&&(X=goog.string.htmlEscape(X)),X},goog.string.specialEscapeChars_={"\0":"\\0","\b":"\\b","\f":"\\f","\n":"\\n","\r":"\\r","	":"\\t","\v":"\\x0B",'"':'\\"',"\\":"\\\\","<":"\\u003C"},goog.string.jsEscapeCache_={"'":"\\'"},goog.string.quote=function(X){X=String(X);for(var Z=['"'],_=0;_<X.length;_++){var K=X.charAt(_),te=K.charCodeAt(0);Z[_+1]=goog.string.specialEscapeChars_[K]||(31<te&&127>te?K:goog.string.escapeChar(K))}return Z.push('"'),Z.join("")},goog.string.escapeString=function(X){for(var Z=[],_=0;_<X.length;_++)Z[_]=goog.string.escapeChar(X.charAt(_));return Z.join("")},goog.string.escapeChar=function(X){if(X in goog.string.jsEscapeCache_)return goog.string.jsEscapeCache_[X];if(X in goog.string.specialEscapeChars_)return goog.string.jsEscapeCache_[X]=goog.string.specialEscapeChars_[X];var Z=X.charCodeAt(0);if(31<Z&&127>Z)var _=X;else 256>Z?(_="\\x",(16>Z||256<Z)&&(_+="0")):(_="\\u",4096>Z&&(_+="0")),_+=Z.toString(16).toUpperCase();return goog.string.jsEscapeCache_[X]=_},goog.string.contains=goog.string.internal.contains,goog.string.caseInsensitiveContains=goog.string.internal.caseInsensitiveContains,goog.string.countOf=function(X,Z){return X&&Z?X.split(Z).length-1:0},goog.string.removeAt=function(X,Z,_){var K=X;return 0<=Z&&Z<X.length&&0<_&&(K=X.substr(0,Z)+X.substr(Z+_,X.length-Z-_)),K},goog.string.remove=function(X,Z){return X.replace(Z,"")},goog.string.removeAll=function(X,Z){return Z=new RegExp(goog.string.regExpEscape(Z),"g"),X.replace(Z,"")},goog.string.replaceAll=function(X,Z,_){return Z=new RegExp(goog.string.regExpEscape(Z),"g"),X.replace(Z,_.replace(/\$/g,"$$$$"))},goog.string.regExpEscape=function(X){return String(X).replace(/([-()\[\]{}+?*.$\^|,:#<!\\])/g,"\\$1").replace(/\x08/g,"\\x08")},goog.string.repeat=String.prototype.repeat?function(X,Z){return X.repeat(Z)}:function(X,Z){return Array(Z+1).join(X)},goog.string.padNumber=function(X,Z,_){return(_=(X=_!==void 0?X.toFixed(_):String(X)).indexOf("."))==-1&&(_=X.length),goog.string.repeat("0",Math.max(0,Z-_))+X},goog.string.makeSafe=function(X){return X==null?"":String(X)},goog.string.buildString=function(X){return Array.prototype.join.call(arguments,"")},goog.string.getRandomString=function(){return Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^goog.now()).toString(36)},goog.string.compareVersions=goog.string.internal.compareVersions,goog.string.hashCode=function(X){for(var Z=0,_=0;_<X.length;++_)Z=31*Z+X.charCodeAt(_)>>>0;return Z},goog.string.uniqueStringCounter_=2147483648*Math.random()|0,goog.string.createUniqueString=function(){return"goog_"+goog.string.uniqueStringCounter_++},goog.string.toNumber=function(X){var Z=Number(X);return Z==0&&goog.string.isEmptyOrWhitespace(X)?NaN:Z},goog.string.isLowerCamelCase=function(X){return/^[a-z]+([A-Z][a-z]*)*$/.test(X)},goog.string.isUpperCamelCase=function(X){return/^([A-Z][a-z]*)+$/.test(X)},goog.string.toCamelCase=function(X){return String(X).replace(/\-([a-z])/g,function(Z,_){return _.toUpperCase()})},goog.string.toSelectorCase=function(X){return String(X).replace(/([A-Z])/g,"-$1").toLowerCase()},goog.string.toTitleCase=function(X,Z){return Z=typeof Z=="string"?goog.string.regExpEscape(Z):"\\s",X.replace(new RegExp("(^"+(Z?"|["+Z+"]+":"")+")([a-z])","g"),function(_,K,te){return K+te.toUpperCase()})},goog.string.capitalize=function(X){return String(X.charAt(0)).toUpperCase()+String(X.substr(1)).toLowerCase()},goog.string.parseInt=function(X){return isFinite(X)&&(X=String(X)),typeof X=="string"?/^\s*-?0x/i.test(X)?parseInt(X,16):parseInt(X,10):NaN},goog.string.splitLimit=function(X,Z,_){X=X.split(Z);for(var K=[];0<_&&X.length;)K.push(X.shift()),_--;return X.length&&K.push(X.join(Z)),K},goog.string.lastComponent=function(X,Z){if(!Z)return X;typeof Z=="string"&&(Z=[Z]);for(var _=-1,K=0;K<Z.length;K++)if(Z[K]!=""){var te=X.lastIndexOf(Z[K]);te>_&&(_=te)}return _==-1?X:X.slice(_+1)},goog.string.editDistance=function(X,Z){var _=[],K=[];if(X==Z)return 0;if(!X.length||!Z.length)return Math.max(X.length,Z.length);for(var te=0;te<Z.length+1;te++)_[te]=te;for(te=0;te<X.length;te++){K[0]=te+1;for(var ne=0;ne<Z.length;ne++)K[ne+1]=Math.min(K[ne]+1,_[ne+1]+1,_[ne]+ +(X[te]!=Z[ne]));for(ne=0;ne<_.length;ne++)_[ne]=K[ne]}return K[Z.length]},goog.labs.userAgent.engine={},goog.labs.userAgent.engine.isPresto=function(){return goog.labs.userAgent.util.matchUserAgent("Presto")},goog.labs.userAgent.engine.isTrident=function(){return goog.labs.userAgent.util.matchUserAgent("Trident")||goog.labs.userAgent.util.matchUserAgent("MSIE")},goog.labs.userAgent.engine.isEdge=function(){return goog.labs.userAgent.util.matchUserAgent("Edge")},goog.labs.userAgent.engine.isWebKit=function(){return goog.labs.userAgent.util.matchUserAgentIgnoreCase("WebKit")&&!goog.labs.userAgent.engine.isEdge()},goog.labs.userAgent.engine.isGecko=function(){return goog.labs.userAgent.util.matchUserAgent("Gecko")&&!goog.labs.userAgent.engine.isWebKit()&&!goog.labs.userAgent.engine.isTrident()&&!goog.labs.userAgent.engine.isEdge()},goog.labs.userAgent.engine.getVersion=function(){var X=goog.labs.userAgent.util.getUserAgent();if(X){X=goog.labs.userAgent.util.extractVersionTuples(X);var Z,_=goog.labs.userAgent.engine.getEngineTuple_(X);if(_)return _[0]=="Gecko"?goog.labs.userAgent.engine.getVersionForKey_(X,"Firefox"):_[1];if((X=X[0])&&(Z=X[2])&&(Z=/Trident\/([^\s;]+)/.exec(Z)))return Z[1]}return""},goog.labs.userAgent.engine.getEngineTuple_=function(X){if(!goog.labs.userAgent.engine.isEdge())return X[1];for(var Z=0;Z<X.length;Z++){var _=X[Z];if(_[0]=="Edge")return _}},goog.labs.userAgent.engine.isVersionOrHigher=function(X){return 0<=goog.string.compareVersions(goog.labs.userAgent.engine.getVersion(),X)},goog.labs.userAgent.engine.getVersionForKey_=function(X,Z){return(X=goog.array.find(X,function(_){return Z==_[0]}))&&X[1]||""},goog.labs.userAgent.platform={},goog.labs.userAgent.platform.isAndroid=function(){return goog.labs.userAgent.util.matchUserAgent("Android")},goog.labs.userAgent.platform.isIpod=function(){return goog.labs.userAgent.util.matchUserAgent("iPod")},goog.labs.userAgent.platform.isIphone=function(){return goog.labs.userAgent.util.matchUserAgent("iPhone")&&!goog.labs.userAgent.util.matchUserAgent("iPod")&&!goog.labs.userAgent.util.matchUserAgent("iPad")},goog.labs.userAgent.platform.isIpad=function(){return goog.labs.userAgent.util.matchUserAgent("iPad")},goog.labs.userAgent.platform.isIos=function(){return goog.labs.userAgent.platform.isIphone()||goog.labs.userAgent.platform.isIpad()||goog.labs.userAgent.platform.isIpod()},goog.labs.userAgent.platform.isMacintosh=function(){return goog.labs.userAgent.util.matchUserAgent("Macintosh")},goog.labs.userAgent.platform.isLinux=function(){return goog.labs.userAgent.util.matchUserAgent("Linux")},goog.labs.userAgent.platform.isWindows=function(){return goog.labs.userAgent.util.matchUserAgent("Windows")},goog.labs.userAgent.platform.isChromeOS=function(){return goog.labs.userAgent.util.matchUserAgent("CrOS")},goog.labs.userAgent.platform.isChromecast=function(){return goog.labs.userAgent.util.matchUserAgent("CrKey")},goog.labs.userAgent.platform.isKaiOS=function(){return goog.labs.userAgent.util.matchUserAgentIgnoreCase("KaiOS")},goog.labs.userAgent.platform.getVersion=function(){var X=goog.labs.userAgent.util.getUserAgent(),Z="";return goog.labs.userAgent.platform.isWindows()?Z=(X=(Z=/Windows (?:NT|Phone) ([0-9.]+)/).exec(X))?X[1]:"0.0":goog.labs.userAgent.platform.isIos()?Z=(X=(Z=/(?:iPhone|iPod|iPad|CPU)\s+OS\s+(\S+)/).exec(X))&&X[1].replace(/_/g,"."):goog.labs.userAgent.platform.isMacintosh()?Z=(X=(Z=/Mac OS X ([0-9_.]+)/).exec(X))?X[1].replace(/_/g,"."):"10":goog.labs.userAgent.platform.isKaiOS()?Z=(X=(Z=/(?:KaiOS)\/(\S+)/i).exec(X))&&X[1]:goog.labs.userAgent.platform.isAndroid()?Z=(X=(Z=/Android\s+([^\);]+)(\)|;)/).exec(X))&&X[1]:goog.labs.userAgent.platform.isChromeOS()&&(Z=(X=(Z=/(?:CrOS\s+(?:i686|x86_64)\s+([0-9.]+))/).exec(X))&&X[1]),Z||""},goog.labs.userAgent.platform.isVersionOrHigher=function(X){return 0<=goog.string.compareVersions(goog.labs.userAgent.platform.getVersion(),X)},goog.reflect={},goog.reflect.object=function(X,Z){return Z},goog.reflect.objectProperty=function(X,Z){return X},goog.reflect.sinkValue=function(X){return goog.reflect.sinkValue[" "](X),X},goog.reflect.sinkValue[" "]=goog.nullFunction,goog.reflect.canAccessProperty=function(X,Z){try{return goog.reflect.sinkValue(X[Z]),!0}catch{}return!1},goog.reflect.cache=function(X,Z,_,K){return K=K?K(Z):Z,Object.prototype.hasOwnProperty.call(X,K)?X[K]:X[K]=_(Z)},goog.userAgent={},goog.userAgent.ASSUME_IE=!1,goog.userAgent.ASSUME_EDGE=!1,goog.userAgent.ASSUME_GECKO=!1,goog.userAgent.ASSUME_WEBKIT=!1,goog.userAgent.ASSUME_MOBILE_WEBKIT=!1,goog.userAgent.ASSUME_OPERA=!1,goog.userAgent.ASSUME_ANY_VERSION=!1,goog.userAgent.BROWSER_KNOWN_=goog.userAgent.ASSUME_IE||goog.userAgent.ASSUME_EDGE||goog.userAgent.ASSUME_GECKO||goog.userAgent.ASSUME_MOBILE_WEBKIT||goog.userAgent.ASSUME_WEBKIT||goog.userAgent.ASSUME_OPERA,goog.userAgent.getUserAgentString=function(){return goog.labs.userAgent.util.getUserAgent()},goog.userAgent.getNavigatorTyped=function(){return goog.global.navigator||null},goog.userAgent.getNavigator=function(){return goog.userAgent.getNavigatorTyped()},goog.userAgent.OPERA=goog.userAgent.BROWSER_KNOWN_?goog.userAgent.ASSUME_OPERA:goog.labs.userAgent.browser.isOpera(),goog.userAgent.IE=goog.userAgent.BROWSER_KNOWN_?goog.userAgent.ASSUME_IE:goog.labs.userAgent.browser.isIE(),goog.userAgent.EDGE=goog.userAgent.BROWSER_KNOWN_?goog.userAgent.ASSUME_EDGE:goog.labs.userAgent.engine.isEdge(),goog.userAgent.EDGE_OR_IE=goog.userAgent.EDGE||goog.userAgent.IE,goog.userAgent.GECKO=goog.userAgent.BROWSER_KNOWN_?goog.userAgent.ASSUME_GECKO:goog.labs.userAgent.engine.isGecko(),goog.userAgent.WEBKIT=goog.userAgent.BROWSER_KNOWN_?goog.userAgent.ASSUME_WEBKIT||goog.userAgent.ASSUME_MOBILE_WEBKIT:goog.labs.userAgent.engine.isWebKit(),goog.userAgent.isMobile_=function(){return goog.userAgent.WEBKIT&&goog.labs.userAgent.util.matchUserAgent("Mobile")},goog.userAgent.MOBILE=goog.userAgent.ASSUME_MOBILE_WEBKIT||goog.userAgent.isMobile_(),goog.userAgent.SAFARI=goog.userAgent.WEBKIT,goog.userAgent.determinePlatform_=function(){var X=goog.userAgent.getNavigatorTyped();return X&&X.platform||""},goog.userAgent.PLATFORM=goog.userAgent.determinePlatform_(),goog.userAgent.ASSUME_MAC=!1,goog.userAgent.ASSUME_WINDOWS=!1,goog.userAgent.ASSUME_LINUX=!1,goog.userAgent.ASSUME_X11=!1,goog.userAgent.ASSUME_ANDROID=!1,goog.userAgent.ASSUME_IPHONE=!1,goog.userAgent.ASSUME_IPAD=!1,goog.userAgent.ASSUME_IPOD=!1,goog.userAgent.ASSUME_KAIOS=!1,goog.userAgent.PLATFORM_KNOWN_=goog.userAgent.ASSUME_MAC||goog.userAgent.ASSUME_WINDOWS||goog.userAgent.ASSUME_LINUX||goog.userAgent.ASSUME_X11||goog.userAgent.ASSUME_ANDROID||goog.userAgent.ASSUME_IPHONE||goog.userAgent.ASSUME_IPAD||goog.userAgent.ASSUME_IPOD,goog.userAgent.MAC=goog.userAgent.PLATFORM_KNOWN_?goog.userAgent.ASSUME_MAC:goog.labs.userAgent.platform.isMacintosh(),goog.userAgent.WINDOWS=goog.userAgent.PLATFORM_KNOWN_?goog.userAgent.ASSUME_WINDOWS:goog.labs.userAgent.platform.isWindows(),goog.userAgent.isLegacyLinux_=function(){return goog.labs.userAgent.platform.isLinux()||goog.labs.userAgent.platform.isChromeOS()},goog.userAgent.LINUX=goog.userAgent.PLATFORM_KNOWN_?goog.userAgent.ASSUME_LINUX:goog.userAgent.isLegacyLinux_(),goog.userAgent.isX11_=function(){var X=goog.userAgent.getNavigatorTyped();return!!X&&goog.string.contains(X.appVersion||"","X11")},goog.userAgent.X11=goog.userAgent.PLATFORM_KNOWN_?goog.userAgent.ASSUME_X11:goog.userAgent.isX11_(),goog.userAgent.ANDROID=goog.userAgent.PLATFORM_KNOWN_?goog.userAgent.ASSUME_ANDROID:goog.labs.userAgent.platform.isAndroid(),goog.userAgent.IPHONE=goog.userAgent.PLATFORM_KNOWN_?goog.userAgent.ASSUME_IPHONE:goog.labs.userAgent.platform.isIphone(),goog.userAgent.IPAD=goog.userAgent.PLATFORM_KNOWN_?goog.userAgent.ASSUME_IPAD:goog.labs.userAgent.platform.isIpad(),goog.userAgent.IPOD=goog.userAgent.PLATFORM_KNOWN_?goog.userAgent.ASSUME_IPOD:goog.labs.userAgent.platform.isIpod(),goog.userAgent.IOS=goog.userAgent.PLATFORM_KNOWN_?goog.userAgent.ASSUME_IPHONE||goog.userAgent.ASSUME_IPAD||goog.userAgent.ASSUME_IPOD:goog.labs.userAgent.platform.isIos(),goog.userAgent.KAIOS=goog.userAgent.PLATFORM_KNOWN_?goog.userAgent.ASSUME_KAIOS:goog.labs.userAgent.platform.isKaiOS(),goog.userAgent.determineVersion_=function(){var X="",Z=goog.userAgent.getVersionRegexResult_();return Z&&(X=Z?Z[1]:""),goog.userAgent.IE&&(Z=goog.userAgent.getDocumentMode_())!=null&&Z>parseFloat(X)?String(Z):X},goog.userAgent.getVersionRegexResult_=function(){var X=goog.userAgent.getUserAgentString();return goog.userAgent.GECKO?/rv:([^\);]+)(\)|;)/.exec(X):goog.userAgent.EDGE?/Edge\/([\d\.]+)/.exec(X):goog.userAgent.IE?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(X):goog.userAgent.WEBKIT?/WebKit\/(\S+)/.exec(X):goog.userAgent.OPERA?/(?:Version)[ \/]?(\S+)/.exec(X):void 0},goog.userAgent.getDocumentMode_=function(){var X=goog.global.document;return X?X.documentMode:void 0},goog.userAgent.VERSION=goog.userAgent.determineVersion_(),goog.userAgent.compare=function(X,Z){return goog.string.compareVersions(X,Z)},goog.userAgent.isVersionOrHigherCache_={},goog.userAgent.isVersionOrHigher=function(X){return goog.userAgent.ASSUME_ANY_VERSION||goog.reflect.cache(goog.userAgent.isVersionOrHigherCache_,X,function(){return 0<=goog.string.compareVersions(goog.userAgent.VERSION,X)})},goog.userAgent.isVersion=goog.userAgent.isVersionOrHigher,goog.userAgent.isDocumentModeOrHigher=function(X){return Number(goog.userAgent.DOCUMENT_MODE)>=X},goog.userAgent.isDocumentMode=goog.userAgent.isDocumentModeOrHigher,goog.userAgent.DOCUMENT_MODE=function(){if(goog.global.document&&goog.userAgent.IE){var X=goog.userAgent.getDocumentMode_();return X||parseInt(goog.userAgent.VERSION,10)||void 0}}(),goog.userAgent.product={},goog.userAgent.product.ASSUME_FIREFOX=!1,goog.userAgent.product.ASSUME_IPHONE=!1,goog.userAgent.product.ASSUME_IPAD=!1,goog.userAgent.product.ASSUME_ANDROID=!1,goog.userAgent.product.ASSUME_CHROME=!1,goog.userAgent.product.ASSUME_SAFARI=!1,goog.userAgent.product.PRODUCT_KNOWN_=goog.userAgent.ASSUME_IE||goog.userAgent.ASSUME_EDGE||goog.userAgent.ASSUME_OPERA||goog.userAgent.product.ASSUME_FIREFOX||goog.userAgent.product.ASSUME_IPHONE||goog.userAgent.product.ASSUME_IPAD||goog.userAgent.product.ASSUME_ANDROID||goog.userAgent.product.ASSUME_CHROME||goog.userAgent.product.ASSUME_SAFARI,goog.userAgent.product.OPERA=goog.userAgent.OPERA,goog.userAgent.product.IE=goog.userAgent.IE,goog.userAgent.product.EDGE=goog.userAgent.EDGE,goog.userAgent.product.FIREFOX=goog.userAgent.product.PRODUCT_KNOWN_?goog.userAgent.product.ASSUME_FIREFOX:goog.labs.userAgent.browser.isFirefox(),goog.userAgent.product.isIphoneOrIpod_=function(){return goog.labs.userAgent.platform.isIphone()||goog.labs.userAgent.platform.isIpod()},goog.userAgent.product.IPHONE=goog.userAgent.product.PRODUCT_KNOWN_?goog.userAgent.product.ASSUME_IPHONE:goog.userAgent.product.isIphoneOrIpod_(),goog.userAgent.product.IPAD=goog.userAgent.product.PRODUCT_KNOWN_?goog.userAgent.product.ASSUME_IPAD:goog.labs.userAgent.platform.isIpad(),goog.userAgent.product.ANDROID=goog.userAgent.product.PRODUCT_KNOWN_?goog.userAgent.product.ASSUME_ANDROID:goog.labs.userAgent.browser.isAndroidBrowser(),goog.userAgent.product.CHROME=goog.userAgent.product.PRODUCT_KNOWN_?goog.userAgent.product.ASSUME_CHROME:goog.labs.userAgent.browser.isChrome(),goog.userAgent.product.isSafariDesktop_=function(){return goog.labs.userAgent.browser.isSafari()&&!goog.labs.userAgent.platform.isIos()},goog.userAgent.product.SAFARI=goog.userAgent.product.PRODUCT_KNOWN_?goog.userAgent.product.ASSUME_SAFARI:goog.userAgent.product.isSafariDesktop_(),goog.crypt.base64={},goog.crypt.base64.DEFAULT_ALPHABET_COMMON_="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",goog.crypt.base64.ENCODED_VALS=goog.crypt.base64.DEFAULT_ALPHABET_COMMON_+"+/=",goog.crypt.base64.ENCODED_VALS_WEBSAFE=goog.crypt.base64.DEFAULT_ALPHABET_COMMON_+"-_.",goog.crypt.base64.Alphabet={DEFAULT:0,NO_PADDING:1,WEBSAFE:2,WEBSAFE_DOT_PADDING:3,WEBSAFE_NO_PADDING:4},goog.crypt.base64.paddingChars_="=.",goog.crypt.base64.isPadding_=function(X){return goog.string.contains(goog.crypt.base64.paddingChars_,X)},goog.crypt.base64.byteToCharMaps_={},goog.crypt.base64.charToByteMap_=null,goog.crypt.base64.ASSUME_NATIVE_SUPPORT_=goog.userAgent.GECKO||goog.userAgent.WEBKIT&&!goog.userAgent.product.SAFARI||goog.userAgent.OPERA,goog.crypt.base64.HAS_NATIVE_ENCODE_=goog.crypt.base64.ASSUME_NATIVE_SUPPORT_||typeof goog.global.btoa=="function",goog.crypt.base64.HAS_NATIVE_DECODE_=goog.crypt.base64.ASSUME_NATIVE_SUPPORT_||!goog.userAgent.product.SAFARI&&!goog.userAgent.IE&&typeof goog.global.atob=="function",goog.crypt.base64.encodeByteArray=function(X,Z){goog.asserts.assert(goog.isArrayLike(X),"encodeByteArray takes an array as a parameter"),Z===void 0&&(Z=goog.crypt.base64.Alphabet.DEFAULT),goog.crypt.base64.init_(),Z=goog.crypt.base64.byteToCharMaps_[Z];for(var _=[],K=0;K<X.length;K+=3){var te=X[K],ne=K+1<X.length,oe=ne?X[K+1]:0,ie=K+2<X.length,se=ie?X[K+2]:0,ae=te>>2;te=(3&te)<<4|oe>>4,oe=(15&oe)<<2|se>>6,se&=63,ie||(se=64,ne||(oe=64)),_.push(Z[ae],Z[te],Z[oe]||"",Z[se]||"")}return _.join("")},goog.crypt.base64.encodeString=function(X,Z){return goog.crypt.base64.HAS_NATIVE_ENCODE_&&!Z?goog.global.btoa(X):goog.crypt.base64.encodeByteArray(goog.crypt.stringToByteArray(X),Z)},goog.crypt.base64.decodeString=function(X,Z){if(goog.crypt.base64.HAS_NATIVE_DECODE_&&!Z)return goog.global.atob(X);var _="";return goog.crypt.base64.decodeStringInternal_(X,function(K){_+=String.fromCharCode(K)}),_},goog.crypt.base64.decodeStringToByteArray=function(X,Z){var _=[];return goog.crypt.base64.decodeStringInternal_(X,function(K){_.push(K)}),_},goog.crypt.base64.decodeStringToUint8Array=function(X){goog.asserts.assert(!goog.userAgent.IE||goog.userAgent.isVersionOrHigher("10"),"Browser does not support typed arrays");var Z=X.length,_=3*Z/4;_%3?_=Math.floor(_):goog.crypt.base64.isPadding_(X[Z-1])&&(_=goog.crypt.base64.isPadding_(X[Z-2])?_-2:_-1);var K=new Uint8Array(_),te=0;return goog.crypt.base64.decodeStringInternal_(X,function(ne){K[te++]=ne}),K.subarray(0,te)},goog.crypt.base64.decodeStringInternal_=function(X,Z){function _(se){for(;K<X.length;){var ae=X.charAt(K++),ge=goog.crypt.base64.charToByteMap_[ae];if(ge!=null)return ge;if(!goog.string.isEmptyOrWhitespace(ae))throw Error("Unknown base64 encoding at char: "+ae)}return se}goog.crypt.base64.init_();for(var K=0;;){var te=_(-1),ne=_(0),oe=_(64),ie=_(64);if(ie===64&&te===-1)break;Z(te<<2|ne>>4),oe!=64&&(Z(ne<<4&240|oe>>2),ie!=64&&Z(oe<<6&192|ie))}},goog.crypt.base64.init_=function(){if(!goog.crypt.base64.charToByteMap_){goog.crypt.base64.charToByteMap_={};for(var X=goog.crypt.base64.DEFAULT_ALPHABET_COMMON_.split(""),Z=["+/=","+/","-_=","-_.","-_"],_=0;5>_;_++){var K=X.concat(Z[_].split(""));goog.crypt.base64.byteToCharMaps_[_]=K;for(var te=0;te<K.length;te++){var ne=K[te],oe=goog.crypt.base64.charToByteMap_[ne];oe===void 0?goog.crypt.base64.charToByteMap_[ne]=te:goog.asserts.assert(oe===te)}}}},jspb.utils={},jspb.utils.split64Low=0,jspb.utils.split64High=0,jspb.utils.splitUint64=function(X){var Z=X>>>0;X=Math.floor((X-Z)/jspb.BinaryConstants.TWO_TO_32)>>>0,jspb.utils.split64Low=Z,jspb.utils.split64High=X},jspb.utils.splitInt64=function(X){var Z=0>X,_=(X=Math.abs(X))>>>0;X=Math.floor((X-_)/jspb.BinaryConstants.TWO_TO_32),X>>>=0,Z&&(X=~X>>>0,4294967295<(_=1+(~_>>>0))&&(_=0,4294967295<++X&&(X=0))),jspb.utils.split64Low=_,jspb.utils.split64High=X},jspb.utils.splitZigzag64=function(X){var Z=0>X;X=2*Math.abs(X),jspb.utils.splitUint64(X),X=jspb.utils.split64Low;var _=jspb.utils.split64High;Z&&(X==0?_==0?_=X=4294967295:(_--,X=4294967295):X--),jspb.utils.split64Low=X,jspb.utils.split64High=_},jspb.utils.splitFloat32=function(X){var Z=0>X?1:0;if((X=Z?-X:X)===0)0<1/X?(jspb.utils.split64High=0,jspb.utils.split64Low=0):(jspb.utils.split64High=0,jspb.utils.split64Low=2147483648);else if(isNaN(X))jspb.utils.split64High=0,jspb.utils.split64Low=2147483647;else if(X>jspb.BinaryConstants.FLOAT32_MAX)jspb.utils.split64High=0,jspb.utils.split64Low=(Z<<31|2139095040)>>>0;else if(X<jspb.BinaryConstants.FLOAT32_MIN)X=Math.round(X/Math.pow(2,-149)),jspb.utils.split64High=0,jspb.utils.split64Low=(Z<<31|X)>>>0;else{var _=Math.floor(Math.log(X)/Math.LN2);X*=Math.pow(2,-_),16777216<=(X=Math.round(X*jspb.BinaryConstants.TWO_TO_23))&&++_,jspb.utils.split64High=0,jspb.utils.split64Low=(Z<<31|_+127<<23|8388607&X)>>>0}},jspb.utils.splitFloat64=function(X){var Z=0>X?1:0;if((X=Z?-X:X)===0)jspb.utils.split64High=0<1/X?0:2147483648,jspb.utils.split64Low=0;else if(isNaN(X))jspb.utils.split64High=2147483647,jspb.utils.split64Low=4294967295;else if(X>jspb.BinaryConstants.FLOAT64_MAX)jspb.utils.split64High=(Z<<31|2146435072)>>>0,jspb.utils.split64Low=0;else if(X<jspb.BinaryConstants.FLOAT64_MIN){var _=X/Math.pow(2,-1074);X=_/jspb.BinaryConstants.TWO_TO_32,jspb.utils.split64High=(Z<<31|X)>>>0,jspb.utils.split64Low=_>>>0}else{var K=0;if(2<=(_=X))for(;2<=_&&1023>K;)K++,_/=2;else for(;1>_&&-1022<K;)_*=2,K--;X=(_=X*Math.pow(2,-K))*jspb.BinaryConstants.TWO_TO_20&1048575,_=_*jspb.BinaryConstants.TWO_TO_52>>>0,jspb.utils.split64High=(Z<<31|K+1023<<20|X)>>>0,jspb.utils.split64Low=_}},jspb.utils.splitHash64=function(X){var Z=X.charCodeAt(0),_=X.charCodeAt(1),K=X.charCodeAt(2),te=X.charCodeAt(3),ne=X.charCodeAt(4),oe=X.charCodeAt(5),ie=X.charCodeAt(6);X=X.charCodeAt(7),jspb.utils.split64Low=Z+(_<<8)+(K<<16)+(te<<24)>>>0,jspb.utils.split64High=ne+(oe<<8)+(ie<<16)+(X<<24)>>>0},jspb.utils.joinUint64=function(X,Z){return Z*jspb.BinaryConstants.TWO_TO_32+(X>>>0)},jspb.utils.joinInt64=function(X,Z){var _=2147483648&Z;return _&&(Z=~Z>>>0,(X=1+~X>>>0)==0&&(Z=Z+1>>>0)),X=jspb.utils.joinUint64(X,Z),_?-X:X},jspb.utils.toZigzag64=function(X,Z,_){var K=Z>>31;return _(X<<1^K,(Z<<1|X>>>31)^K)},jspb.utils.joinZigzag64=function(X,Z){return jspb.utils.fromZigzag64(X,Z,jspb.utils.joinInt64)},jspb.utils.fromZigzag64=function(X,Z,_){var K=-(1&X);return _((X>>>1|Z<<31)^K,Z>>>1^K)},jspb.utils.joinFloat32=function(X,Z){Z=2*(X>>31)+1;var _=X>>>23&255;return X&=8388607,_==255?X?NaN:1/0*Z:_==0?Z*Math.pow(2,-149)*X:Z*Math.pow(2,_-150)*(X+Math.pow(2,23))},jspb.utils.joinFloat64=function(X,Z){var _=2*(Z>>31)+1,K=Z>>>20&2047;return X=jspb.BinaryConstants.TWO_TO_32*(1048575&Z)+X,K==2047?X?NaN:1/0*_:K==0?_*Math.pow(2,-1074)*X:_*Math.pow(2,K-1075)*(X+jspb.BinaryConstants.TWO_TO_52)},jspb.utils.joinHash64=function(X,Z){return String.fromCharCode(X>>>0&255,X>>>8&255,X>>>16&255,X>>>24&255,Z>>>0&255,Z>>>8&255,Z>>>16&255,Z>>>24&255)},jspb.utils.DIGITS="0123456789abcdef".split(""),jspb.utils.ZERO_CHAR_CODE_=48,jspb.utils.A_CHAR_CODE_=97,jspb.utils.joinUnsignedDecimalString=function(X,Z){function _(te,ne){return te=te?String(te):"",ne?"0000000".slice(te.length)+te:te}if(2097151>=Z)return""+jspb.utils.joinUint64(X,Z);var K=(X>>>24|Z<<8)>>>0&16777215;return X=(16777215&X)+6777216*K+6710656*(Z=Z>>16&65535),K+=8147497*Z,Z*=2,1e7<=X&&(K+=Math.floor(X/1e7),X%=1e7),1e7<=K&&(Z+=Math.floor(K/1e7),K%=1e7),_(Z,0)+_(K,Z)+_(X,1)},jspb.utils.joinSignedDecimalString=function(X,Z){var _=2147483648&Z;return _&&(Z=~Z+((X=1+~X>>>0)==0?1:0)>>>0),X=jspb.utils.joinUnsignedDecimalString(X,Z),_?"-"+X:X},jspb.utils.hash64ToDecimalString=function(X,Z){jspb.utils.splitHash64(X),X=jspb.utils.split64Low;var _=jspb.utils.split64High;return Z?jspb.utils.joinSignedDecimalString(X,_):jspb.utils.joinUnsignedDecimalString(X,_)},jspb.utils.hash64ArrayToDecimalStrings=function(X,Z){for(var _=Array(X.length),K=0;K<X.length;K++)_[K]=jspb.utils.hash64ToDecimalString(X[K],Z);return _},jspb.utils.decimalStringToHash64=function(X){function Z(ne,oe){for(var ie=0;8>ie&&(ne!==1||0<oe);ie++)oe=ne*K[ie]+oe,K[ie]=255&oe,oe>>>=8}jspb.asserts.assert(0<X.length);var _=!1;X[0]==="-"&&(_=!0,X=X.slice(1));for(var K=[0,0,0,0,0,0,0,0],te=0;te<X.length;te++)Z(10,X.charCodeAt(te)-jspb.utils.ZERO_CHAR_CODE_);return _&&(function(){for(var ne=0;8>ne;ne++)K[ne]=255&~K[ne]}(),Z(1,1)),goog.crypt.byteArrayToString(K)},jspb.utils.splitDecimalString=function(X){jspb.utils.splitHash64(jspb.utils.decimalStringToHash64(X))},jspb.utils.toHexDigit_=function(X){return String.fromCharCode(10>X?jspb.utils.ZERO_CHAR_CODE_+X:jspb.utils.A_CHAR_CODE_-10+X)},jspb.utils.fromHexCharCode_=function(X){return X>=jspb.utils.A_CHAR_CODE_?X-jspb.utils.A_CHAR_CODE_+10:X-jspb.utils.ZERO_CHAR_CODE_},jspb.utils.hash64ToHexString=function(X){var Z=Array(18);Z[0]="0",Z[1]="x";for(var _=0;8>_;_++){var K=X.charCodeAt(7-_);Z[2*_+2]=jspb.utils.toHexDigit_(K>>4),Z[2*_+3]=jspb.utils.toHexDigit_(15&K)}return Z.join("")},jspb.utils.hexStringToHash64=function(X){X=X.toLowerCase(),jspb.asserts.assert(X.length==18),jspb.asserts.assert(X[0]=="0"),jspb.asserts.assert(X[1]=="x");for(var Z="",_=0;8>_;_++){var K=jspb.utils.fromHexCharCode_(X.charCodeAt(2*_+2)),te=jspb.utils.fromHexCharCode_(X.charCodeAt(2*_+3));Z=String.fromCharCode(16*K+te)+Z}return Z},jspb.utils.hash64ToNumber=function(X,Z){jspb.utils.splitHash64(X),X=jspb.utils.split64Low;var _=jspb.utils.split64High;return Z?jspb.utils.joinInt64(X,_):jspb.utils.joinUint64(X,_)},jspb.utils.numberToHash64=function(X){return jspb.utils.splitInt64(X),jspb.utils.joinHash64(jspb.utils.split64Low,jspb.utils.split64High)},jspb.utils.countVarints=function(X,Z,_){for(var K=0,te=Z;te<_;te++)K+=X[te]>>7;return _-Z-K},jspb.utils.countVarintFields=function(X,Z,_,K){var te=0;if(128>(K=8*K+jspb.BinaryConstants.WireType.VARINT))for(;Z<_&&X[Z++]==K;)for(te++;;){var ne=X[Z++];if(!(128&ne))break}else for(;Z<_;){for(ne=K;128<ne;){if(X[Z]!=(127&ne|128))return te;Z++,ne>>=7}if(X[Z++]!=ne)break;for(te++;128&(ne=X[Z++]););}return te},jspb.utils.countFixedFields_=function(X,Z,_,K,te){var ne=0;if(128>K)for(;Z<_&&X[Z++]==K;)ne++,Z+=te;else for(;Z<_;){for(var oe=K;128<oe;){if(X[Z++]!=(127&oe|128))return ne;oe>>=7}if(X[Z++]!=oe)break;ne++,Z+=te}return ne},jspb.utils.countFixed32Fields=function(X,Z,_,K){return jspb.utils.countFixedFields_(X,Z,_,8*K+jspb.BinaryConstants.WireType.FIXED32,4)},jspb.utils.countFixed64Fields=function(X,Z,_,K){return jspb.utils.countFixedFields_(X,Z,_,8*K+jspb.BinaryConstants.WireType.FIXED64,8)},jspb.utils.countDelimitedFields=function(X,Z,_,K){var te=0;for(K=8*K+jspb.BinaryConstants.WireType.DELIMITED;Z<_;){for(var ne=K;128<ne;){if(X[Z++]!=(127&ne|128))return te;ne>>=7}if(X[Z++]!=ne)break;te++;for(var oe=0,ie=1;oe+=(127&(ne=X[Z++]))*ie,ie*=128,128&ne;);Z+=oe}return te},jspb.utils.debugBytesToTextFormat=function(X){var Z='"';if(X){X=jspb.utils.byteSourceToUint8Array(X);for(var _=0;_<X.length;_++)Z+="\\x",16>X[_]&&(Z+="0"),Z+=X[_].toString(16)}return Z+'"'},jspb.utils.debugScalarToTextFormat=function(X){return typeof X=="string"?goog.string.quote(X):X.toString()},jspb.utils.stringToByteArray=function(X){for(var Z=new Uint8Array(X.length),_=0;_<X.length;_++){var K=X.charCodeAt(_);if(255<K)throw Error("Conversion error: string contains codepoint outside of byte range");Z[_]=K}return Z},jspb.utils.byteSourceToUint8Array=function(X){return X.constructor===Uint8Array?X:X.constructor===ArrayBuffer||X.constructor===Array?new Uint8Array(X):X.constructor===String?goog.crypt.base64.decodeStringToUint8Array(X):X instanceof Uint8Array?new Uint8Array(X.buffer,X.byteOffset,X.byteLength):(jspb.asserts.fail("Type not convertible to Uint8Array."),new Uint8Array(0))},jspb.BinaryDecoder=function(X,Z,_){this.bytes_=null,this.cursor_=this.end_=this.start_=0,this.error_=!1,X&&this.setBlock(X,Z,_)},jspb.BinaryDecoder.instanceCache_=[],jspb.BinaryDecoder.alloc=function(X,Z,_){if(jspb.BinaryDecoder.instanceCache_.length){var K=jspb.BinaryDecoder.instanceCache_.pop();return X&&K.setBlock(X,Z,_),K}return new jspb.BinaryDecoder(X,Z,_)},jspb.BinaryDecoder.prototype.free=function(){this.clear(),100>jspb.BinaryDecoder.instanceCache_.length&&jspb.BinaryDecoder.instanceCache_.push(this)},jspb.BinaryDecoder.prototype.clone=function(){return jspb.BinaryDecoder.alloc(this.bytes_,this.start_,this.end_-this.start_)},jspb.BinaryDecoder.prototype.clear=function(){this.bytes_=null,this.cursor_=this.end_=this.start_=0,this.error_=!1},jspb.BinaryDecoder.prototype.getBuffer=function(){return this.bytes_},jspb.BinaryDecoder.prototype.setBlock=function(X,Z,_){this.bytes_=jspb.utils.byteSourceToUint8Array(X),this.start_=Z!==void 0?Z:0,this.end_=_!==void 0?this.start_+_:this.bytes_.length,this.cursor_=this.start_},jspb.BinaryDecoder.prototype.getEnd=function(){return this.end_},jspb.BinaryDecoder.prototype.setEnd=function(X){this.end_=X},jspb.BinaryDecoder.prototype.reset=function(){this.cursor_=this.start_},jspb.BinaryDecoder.prototype.getCursor=function(){return this.cursor_},jspb.BinaryDecoder.prototype.setCursor=function(X){this.cursor_=X},jspb.BinaryDecoder.prototype.advance=function(X){this.cursor_+=X,jspb.asserts.assert(this.cursor_<=this.end_)},jspb.BinaryDecoder.prototype.atEnd=function(){return this.cursor_==this.end_},jspb.BinaryDecoder.prototype.pastEnd=function(){return this.cursor_>this.end_},jspb.BinaryDecoder.prototype.getError=function(){return this.error_||0>this.cursor_||this.cursor_>this.end_},jspb.BinaryDecoder.prototype.readSplitVarint64=function(X){for(var Z=128,_=0,K=0,te=0;4>te&&128<=Z;te++)_|=(127&(Z=this.bytes_[this.cursor_++]))<<7*te;if(128<=Z&&(_|=(127&(Z=this.bytes_[this.cursor_++]))<<28,K|=(127&Z)>>4),128<=Z)for(te=0;5>te&&128<=Z;te++)K|=(127&(Z=this.bytes_[this.cursor_++]))<<7*te+3;if(128>Z)return X(_>>>0,K>>>0);jspb.asserts.fail("Failed to read varint, encoding is invalid."),this.error_=!0},jspb.BinaryDecoder.prototype.readSplitZigzagVarint64=function(X){return this.readSplitVarint64(function(Z,_){return jspb.utils.fromZigzag64(Z,_,X)})},jspb.BinaryDecoder.prototype.readSplitFixed64=function(X){var Z=this.bytes_,_=this.cursor_;this.cursor_+=8;for(var K=0,te=0,ne=_+7;ne>=_;ne--)K=K<<8|Z[ne],te=te<<8|Z[ne+4];return X(K,te)},jspb.BinaryDecoder.prototype.skipVarint=function(){for(;128&this.bytes_[this.cursor_];)this.cursor_++;this.cursor_++},jspb.BinaryDecoder.prototype.unskipVarint=function(X){for(;128<X;)this.cursor_--,X>>>=7;this.cursor_--},jspb.BinaryDecoder.prototype.readUnsignedVarint32=function(){var X=this.bytes_,Z=X[this.cursor_+0],_=127&Z;return 128>Z?(this.cursor_+=1,jspb.asserts.assert(this.cursor_<=this.end_),_):(_|=(127&(Z=X[this.cursor_+1]))<<7,128>Z?(this.cursor_+=2,jspb.asserts.assert(this.cursor_<=this.end_),_):(_|=(127&(Z=X[this.cursor_+2]))<<14,128>Z?(this.cursor_+=3,jspb.asserts.assert(this.cursor_<=this.end_),_):(_|=(127&(Z=X[this.cursor_+3]))<<21,128>Z?(this.cursor_+=4,jspb.asserts.assert(this.cursor_<=this.end_),_):(_|=(15&(Z=X[this.cursor_+4]))<<28,128>Z?(this.cursor_+=5,jspb.asserts.assert(this.cursor_<=this.end_),_>>>0):(this.cursor_+=5,128<=X[this.cursor_++]&&128<=X[this.cursor_++]&&128<=X[this.cursor_++]&&128<=X[this.cursor_++]&&128<=X[this.cursor_++]&&jspb.asserts.assert(!1),jspb.asserts.assert(this.cursor_<=this.end_),_)))))},jspb.BinaryDecoder.prototype.readSignedVarint32=function(){return~~this.readUnsignedVarint32()},jspb.BinaryDecoder.prototype.readUnsignedVarint32String=function(){return this.readUnsignedVarint32().toString()},jspb.BinaryDecoder.prototype.readSignedVarint32String=function(){return this.readSignedVarint32().toString()},jspb.BinaryDecoder.prototype.readZigzagVarint32=function(){var X=this.readUnsignedVarint32();return X>>>1^-(1&X)},jspb.BinaryDecoder.prototype.readUnsignedVarint64=function(){return this.readSplitVarint64(jspb.utils.joinUint64)},jspb.BinaryDecoder.prototype.readUnsignedVarint64String=function(){return this.readSplitVarint64(jspb.utils.joinUnsignedDecimalString)},jspb.BinaryDecoder.prototype.readSignedVarint64=function(){return this.readSplitVarint64(jspb.utils.joinInt64)},jspb.BinaryDecoder.prototype.readSignedVarint64String=function(){return this.readSplitVarint64(jspb.utils.joinSignedDecimalString)},jspb.BinaryDecoder.prototype.readZigzagVarint64=function(){return this.readSplitVarint64(jspb.utils.joinZigzag64)},jspb.BinaryDecoder.prototype.readZigzagVarintHash64=function(){return this.readSplitZigzagVarint64(jspb.utils.joinHash64)},jspb.BinaryDecoder.prototype.readZigzagVarint64String=function(){return this.readSplitZigzagVarint64(jspb.utils.joinSignedDecimalString)},jspb.BinaryDecoder.prototype.readUint8=function(){var X=this.bytes_[this.cursor_+0];return this.cursor_+=1,jspb.asserts.assert(this.cursor_<=this.end_),X},jspb.BinaryDecoder.prototype.readUint16=function(){var X=this.bytes_[this.cursor_+0],Z=this.bytes_[this.cursor_+1];return this.cursor_+=2,jspb.asserts.assert(this.cursor_<=this.end_),X|Z<<8},jspb.BinaryDecoder.prototype.readUint32=function(){var X=this.bytes_[this.cursor_+0],Z=this.bytes_[this.cursor_+1],_=this.bytes_[this.cursor_+2],K=this.bytes_[this.cursor_+3];return this.cursor_+=4,jspb.asserts.assert(this.cursor_<=this.end_),(X|Z<<8|_<<16|K<<24)>>>0},jspb.BinaryDecoder.prototype.readUint64=function(){var X=this.readUint32(),Z=this.readUint32();return jspb.utils.joinUint64(X,Z)},jspb.BinaryDecoder.prototype.readUint64String=function(){var X=this.readUint32(),Z=this.readUint32();return jspb.utils.joinUnsignedDecimalString(X,Z)},jspb.BinaryDecoder.prototype.readInt8=function(){var X=this.bytes_[this.cursor_+0];return this.cursor_+=1,jspb.asserts.assert(this.cursor_<=this.end_),X<<24>>24},jspb.BinaryDecoder.prototype.readInt16=function(){var X=this.bytes_[this.cursor_+0],Z=this.bytes_[this.cursor_+1];return this.cursor_+=2,jspb.asserts.assert(this.cursor_<=this.end_),(X|Z<<8)<<16>>16},jspb.BinaryDecoder.prototype.readInt32=function(){var X=this.bytes_[this.cursor_+0],Z=this.bytes_[this.cursor_+1],_=this.bytes_[this.cursor_+2],K=this.bytes_[this.cursor_+3];return this.cursor_+=4,jspb.asserts.assert(this.cursor_<=this.end_),X|Z<<8|_<<16|K<<24},jspb.BinaryDecoder.prototype.readInt64=function(){var X=this.readUint32(),Z=this.readUint32();return jspb.utils.joinInt64(X,Z)},jspb.BinaryDecoder.prototype.readInt64String=function(){var X=this.readUint32(),Z=this.readUint32();return jspb.utils.joinSignedDecimalString(X,Z)},jspb.BinaryDecoder.prototype.readFloat=function(){var X=this.readUint32();return jspb.utils.joinFloat32(X,0)},jspb.BinaryDecoder.prototype.readDouble=function(){var X=this.readUint32(),Z=this.readUint32();return jspb.utils.joinFloat64(X,Z)},jspb.BinaryDecoder.prototype.readBool=function(){return!!this.bytes_[this.cursor_++]},jspb.BinaryDecoder.prototype.readEnum=function(){return this.readSignedVarint32()},jspb.BinaryDecoder.prototype.readString=function(X){var Z=this.bytes_,_=this.cursor_;X=_+X;for(var K=[],te="";_<X;){var ne=Z[_++];if(128>ne)K.push(ne);else{if(192>ne)continue;if(224>ne){var oe=Z[_++];K.push((31&ne)<<6|63&oe)}else if(240>ne){oe=Z[_++];var ie=Z[_++];K.push((15&ne)<<12|(63&oe)<<6|63&ie)}else 248>ne&&(ne=(7&ne)<<18|(63&(oe=Z[_++]))<<12|(63&(ie=Z[_++]))<<6|63&Z[_++],ne-=65536,K.push(55296+(ne>>10&1023),56320+(1023&ne)))}8192<=K.length&&(te+=String.fromCharCode.apply(null,K),K.length=0)}return te+=goog.crypt.byteArrayToString(K),this.cursor_=_,te},jspb.BinaryDecoder.prototype.readStringWithLength=function(){var X=this.readUnsignedVarint32();return this.readString(X)},jspb.BinaryDecoder.prototype.readBytes=function(X){if(0>X||this.cursor_+X>this.bytes_.length)return this.error_=!0,jspb.asserts.fail("Invalid byte length!"),new Uint8Array(0);var Z=this.bytes_.subarray(this.cursor_,this.cursor_+X);return this.cursor_+=X,jspb.asserts.assert(this.cursor_<=this.end_),Z},jspb.BinaryDecoder.prototype.readVarintHash64=function(){return this.readSplitVarint64(jspb.utils.joinHash64)},jspb.BinaryDecoder.prototype.readFixedHash64=function(){var X=this.bytes_,Z=this.cursor_,_=X[Z+0],K=X[Z+1],te=X[Z+2],ne=X[Z+3],oe=X[Z+4],ie=X[Z+5],se=X[Z+6];return X=X[Z+7],this.cursor_+=8,String.fromCharCode(_,K,te,ne,oe,ie,se,X)},jspb.BinaryReader=function(X,Z,_){this.decoder_=jspb.BinaryDecoder.alloc(X,Z,_),this.fieldCursor_=this.decoder_.getCursor(),this.nextField_=jspb.BinaryConstants.INVALID_FIELD_NUMBER,this.nextWireType_=jspb.BinaryConstants.WireType.INVALID,this.error_=!1,this.readCallbacks_=null},jspb.BinaryReader.instanceCache_=[],jspb.BinaryReader.alloc=function(X,Z,_){if(jspb.BinaryReader.instanceCache_.length){var K=jspb.BinaryReader.instanceCache_.pop();return X&&K.decoder_.setBlock(X,Z,_),K}return new jspb.BinaryReader(X,Z,_)},jspb.BinaryReader.prototype.alloc=jspb.BinaryReader.alloc,jspb.BinaryReader.prototype.free=function(){this.decoder_.clear(),this.nextField_=jspb.BinaryConstants.INVALID_FIELD_NUMBER,this.nextWireType_=jspb.BinaryConstants.WireType.INVALID,this.error_=!1,this.readCallbacks_=null,100>jspb.BinaryReader.instanceCache_.length&&jspb.BinaryReader.instanceCache_.push(this)},jspb.BinaryReader.prototype.getFieldCursor=function(){return this.fieldCursor_},jspb.BinaryReader.prototype.getCursor=function(){return this.decoder_.getCursor()},jspb.BinaryReader.prototype.getBuffer=function(){return this.decoder_.getBuffer()},jspb.BinaryReader.prototype.getFieldNumber=function(){return this.nextField_},goog.exportProperty(jspb.BinaryReader.prototype,"getFieldNumber",jspb.BinaryReader.prototype.getFieldNumber),jspb.BinaryReader.prototype.getWireType=function(){return this.nextWireType_},jspb.BinaryReader.prototype.isDelimited=function(){return this.nextWireType_==jspb.BinaryConstants.WireType.DELIMITED},goog.exportProperty(jspb.BinaryReader.prototype,"isDelimited",jspb.BinaryReader.prototype.isDelimited),jspb.BinaryReader.prototype.isEndGroup=function(){return this.nextWireType_==jspb.BinaryConstants.WireType.END_GROUP},goog.exportProperty(jspb.BinaryReader.prototype,"isEndGroup",jspb.BinaryReader.prototype.isEndGroup),jspb.BinaryReader.prototype.getError=function(){return this.error_||this.decoder_.getError()},jspb.BinaryReader.prototype.setBlock=function(X,Z,_){this.decoder_.setBlock(X,Z,_),this.nextField_=jspb.BinaryConstants.INVALID_FIELD_NUMBER,this.nextWireType_=jspb.BinaryConstants.WireType.INVALID},jspb.BinaryReader.prototype.reset=function(){this.decoder_.reset(),this.nextField_=jspb.BinaryConstants.INVALID_FIELD_NUMBER,this.nextWireType_=jspb.BinaryConstants.WireType.INVALID},jspb.BinaryReader.prototype.advance=function(X){this.decoder_.advance(X)},jspb.BinaryReader.prototype.nextField=function(){if(this.decoder_.atEnd())return!1;if(this.getError())return jspb.asserts.fail("Decoder hit an error"),!1;this.fieldCursor_=this.decoder_.getCursor();var X=this.decoder_.readUnsignedVarint32(),Z=X>>>3;return(X&=7)!=jspb.BinaryConstants.WireType.VARINT&&X!=jspb.BinaryConstants.WireType.FIXED32&&X!=jspb.BinaryConstants.WireType.FIXED64&&X!=jspb.BinaryConstants.WireType.DELIMITED&&X!=jspb.BinaryConstants.WireType.START_GROUP&&X!=jspb.BinaryConstants.WireType.END_GROUP?(jspb.asserts.fail("Invalid wire type: %s (at position %s)",X,this.fieldCursor_),this.error_=!0,!1):(this.nextField_=Z,this.nextWireType_=X,!0)},goog.exportProperty(jspb.BinaryReader.prototype,"nextField",jspb.BinaryReader.prototype.nextField),jspb.BinaryReader.prototype.unskipHeader=function(){this.decoder_.unskipVarint(this.nextField_<<3|this.nextWireType_)},jspb.BinaryReader.prototype.skipMatchingFields=function(){var X=this.nextField_;for(this.unskipHeader();this.nextField()&&this.getFieldNumber()==X;)this.skipField();this.decoder_.atEnd()||this.unskipHeader()},jspb.BinaryReader.prototype.skipVarintField=function(){this.nextWireType_!=jspb.BinaryConstants.WireType.VARINT?(jspb.asserts.fail("Invalid wire type for skipVarintField"),this.skipField()):this.decoder_.skipVarint()},jspb.BinaryReader.prototype.skipDelimitedField=function(){if(this.nextWireType_!=jspb.BinaryConstants.WireType.DELIMITED)jspb.asserts.fail("Invalid wire type for skipDelimitedField"),this.skipField();else{var X=this.decoder_.readUnsignedVarint32();this.decoder_.advance(X)}},jspb.BinaryReader.prototype.skipFixed32Field=function(){this.nextWireType_!=jspb.BinaryConstants.WireType.FIXED32?(jspb.asserts.fail("Invalid wire type for skipFixed32Field"),this.skipField()):this.decoder_.advance(4)},jspb.BinaryReader.prototype.skipFixed64Field=function(){this.nextWireType_!=jspb.BinaryConstants.WireType.FIXED64?(jspb.asserts.fail("Invalid wire type for skipFixed64Field"),this.skipField()):this.decoder_.advance(8)},jspb.BinaryReader.prototype.skipGroup=function(){for(var X=this.nextField_;;){if(!this.nextField()){jspb.asserts.fail("Unmatched start-group tag: stream EOF"),this.error_=!0;break}if(this.nextWireType_==jspb.BinaryConstants.WireType.END_GROUP){this.nextField_!=X&&(jspb.asserts.fail("Unmatched end-group tag"),this.error_=!0);break}this.skipField()}},jspb.BinaryReader.prototype.skipField=function(){switch(this.nextWireType_){case jspb.BinaryConstants.WireType.VARINT:this.skipVarintField();break;case jspb.BinaryConstants.WireType.FIXED64:this.skipFixed64Field();break;case jspb.BinaryConstants.WireType.DELIMITED:this.skipDelimitedField();break;case jspb.BinaryConstants.WireType.FIXED32:this.skipFixed32Field();break;case jspb.BinaryConstants.WireType.START_GROUP:this.skipGroup();break;default:jspb.asserts.fail("Invalid wire encoding for field.")}},jspb.BinaryReader.prototype.registerReadCallback=function(X,Z){this.readCallbacks_===null&&(this.readCallbacks_={}),jspb.asserts.assert(!this.readCallbacks_[X]),this.readCallbacks_[X]=Z},jspb.BinaryReader.prototype.runReadCallback=function(X){return jspb.asserts.assert(this.readCallbacks_!==null),X=this.readCallbacks_[X],jspb.asserts.assert(X),X(this)},jspb.BinaryReader.prototype.readAny=function(X){this.nextWireType_=jspb.BinaryConstants.FieldTypeToWireType(X);var Z=jspb.BinaryConstants.FieldType;switch(X){case Z.DOUBLE:return this.readDouble();case Z.FLOAT:return this.readFloat();case Z.INT64:return this.readInt64();case Z.UINT64:return this.readUint64();case Z.INT32:return this.readInt32();case Z.FIXED64:return this.readFixed64();case Z.FIXED32:return this.readFixed32();case Z.BOOL:return this.readBool();case Z.STRING:return this.readString();case Z.GROUP:jspb.asserts.fail("Group field type not supported in readAny()");case Z.MESSAGE:jspb.asserts.fail("Message field type not supported in readAny()");case Z.BYTES:return this.readBytes();case Z.UINT32:return this.readUint32();case Z.ENUM:return this.readEnum();case Z.SFIXED32:return this.readSfixed32();case Z.SFIXED64:return this.readSfixed64();case Z.SINT32:return this.readSint32();case Z.SINT64:return this.readSint64();case Z.FHASH64:return this.readFixedHash64();case Z.VHASH64:return this.readVarintHash64();default:jspb.asserts.fail("Invalid field type in readAny()")}return 0},jspb.BinaryReader.prototype.readMessage=function(X,Z){jspb.asserts.assert(this.nextWireType_==jspb.BinaryConstants.WireType.DELIMITED);var _=this.decoder_.getEnd(),K=this.decoder_.readUnsignedVarint32();K=this.decoder_.getCursor()+K,this.decoder_.setEnd(K),Z(X,this),this.decoder_.setCursor(K),this.decoder_.setEnd(_)},goog.exportProperty(jspb.BinaryReader.prototype,"readMessage",jspb.BinaryReader.prototype.readMessage),jspb.BinaryReader.prototype.readGroup=function(X,Z,_){jspb.asserts.assert(this.nextWireType_==jspb.BinaryConstants.WireType.START_GROUP),jspb.asserts.assert(this.nextField_==X),_(Z,this),this.error_||this.nextWireType_==jspb.BinaryConstants.WireType.END_GROUP||(jspb.asserts.fail("Group submessage did not end with an END_GROUP tag"),this.error_=!0)},goog.exportProperty(jspb.BinaryReader.prototype,"readGroup",jspb.BinaryReader.prototype.readGroup),jspb.BinaryReader.prototype.getFieldDecoder=function(){jspb.asserts.assert(this.nextWireType_==jspb.BinaryConstants.WireType.DELIMITED);var X=this.decoder_.readUnsignedVarint32(),Z=this.decoder_.getCursor(),_=Z+X;return X=jspb.BinaryDecoder.alloc(this.decoder_.getBuffer(),Z,X),this.decoder_.setCursor(_),X},jspb.BinaryReader.prototype.readInt32=function(){return jspb.asserts.assert(this.nextWireType_==jspb.BinaryConstants.WireType.VARINT),this.decoder_.readSignedVarint32()},goog.exportProperty(jspb.BinaryReader.prototype,"readInt32",jspb.BinaryReader.prototype.readInt32),jspb.BinaryReader.prototype.readInt32String=function(){return jspb.asserts.assert(this.nextWireType_==jspb.BinaryConstants.WireType.VARINT),this.decoder_.readSignedVarint32String()},jspb.BinaryReader.prototype.readInt64=function(){return jspb.asserts.assert(this.nextWireType_==jspb.BinaryConstants.WireType.VARINT),this.decoder_.readSignedVarint64()},goog.exportProperty(jspb.BinaryReader.prototype,"readInt64",jspb.BinaryReader.prototype.readInt64),jspb.BinaryReader.prototype.readInt64String=function(){return jspb.asserts.assert(this.nextWireType_==jspb.BinaryConstants.WireType.VARINT),this.decoder_.readSignedVarint64String()},jspb.BinaryReader.prototype.readUint32=function(){return jspb.asserts.assert(this.nextWireType_==jspb.BinaryConstants.WireType.VARINT),this.decoder_.readUnsignedVarint32()},goog.exportProperty(jspb.BinaryReader.prototype,"readUint32",jspb.BinaryReader.prototype.readUint32),jspb.BinaryReader.prototype.readUint32String=function(){return jspb.asserts.assert(this.nextWireType_==jspb.BinaryConstants.WireType.VARINT),this.decoder_.readUnsignedVarint32String()},jspb.BinaryReader.prototype.readUint64=function(){return jspb.asserts.assert(this.nextWireType_==jspb.BinaryConstants.WireType.VARINT),this.decoder_.readUnsignedVarint64()},goog.exportProperty(jspb.BinaryReader.prototype,"readUint64",jspb.BinaryReader.prototype.readUint64),jspb.BinaryReader.prototype.readUint64String=function(){return jspb.asserts.assert(this.nextWireType_==jspb.BinaryConstants.WireType.VARINT),this.decoder_.readUnsignedVarint64String()},jspb.BinaryReader.prototype.readSint32=function(){return jspb.asserts.assert(this.nextWireType_==jspb.BinaryConstants.WireType.VARINT),this.decoder_.readZigzagVarint32()},goog.exportProperty(jspb.BinaryReader.prototype,"readSint32",jspb.BinaryReader.prototype.readSint32),jspb.BinaryReader.prototype.readSint64=function(){return jspb.asserts.assert(this.nextWireType_==jspb.BinaryConstants.WireType.VARINT),this.decoder_.readZigzagVarint64()},goog.exportProperty(jspb.BinaryReader.prototype,"readSint64",jspb.BinaryReader.prototype.readSint64),jspb.BinaryReader.prototype.readSint64String=function(){return jspb.asserts.assert(this.nextWireType_==jspb.BinaryConstants.WireType.VARINT),this.decoder_.readZigzagVarint64String()},jspb.BinaryReader.prototype.readFixed32=function(){return jspb.asserts.assert(this.nextWireType_==jspb.BinaryConstants.WireType.FIXED32),this.decoder_.readUint32()},goog.exportProperty(jspb.BinaryReader.prototype,"readFixed32",jspb.BinaryReader.prototype.readFixed32),jspb.BinaryReader.prototype.readFixed64=function(){return jspb.asserts.assert(this.nextWireType_==jspb.BinaryConstants.WireType.FIXED64),this.decoder_.readUint64()},goog.exportProperty(jspb.BinaryReader.prototype,"readFixed64",jspb.BinaryReader.prototype.readFixed64),jspb.BinaryReader.prototype.readFixed64String=function(){return jspb.asserts.assert(this.nextWireType_==jspb.BinaryConstants.WireType.FIXED64),this.decoder_.readUint64String()},jspb.BinaryReader.prototype.readSfixed32=function(){return jspb.asserts.assert(this.nextWireType_==jspb.BinaryConstants.WireType.FIXED32),this.decoder_.readInt32()},goog.exportProperty(jspb.BinaryReader.prototype,"readSfixed32",jspb.BinaryReader.prototype.readSfixed32),jspb.BinaryReader.prototype.readSfixed32String=function(){return jspb.asserts.assert(this.nextWireType_==jspb.BinaryConstants.WireType.FIXED32),this.decoder_.readInt32().toString()},jspb.BinaryReader.prototype.readSfixed64=function(){return jspb.asserts.assert(this.nextWireType_==jspb.BinaryConstants.WireType.FIXED64),this.decoder_.readInt64()},goog.exportProperty(jspb.BinaryReader.prototype,"readSfixed64",jspb.BinaryReader.prototype.readSfixed64),jspb.BinaryReader.prototype.readSfixed64String=function(){return jspb.asserts.assert(this.nextWireType_==jspb.BinaryConstants.WireType.FIXED64),this.decoder_.readInt64String()},jspb.BinaryReader.prototype.readFloat=function(){return jspb.asserts.assert(this.nextWireType_==jspb.BinaryConstants.WireType.FIXED32),this.decoder_.readFloat()},goog.exportProperty(jspb.BinaryReader.prototype,"readFloat",jspb.BinaryReader.prototype.readFloat),jspb.BinaryReader.prototype.readDouble=function(){return jspb.asserts.assert(this.nextWireType_==jspb.BinaryConstants.WireType.FIXED64),this.decoder_.readDouble()},goog.exportProperty(jspb.BinaryReader.prototype,"readDouble",jspb.BinaryReader.prototype.readDouble),jspb.BinaryReader.prototype.readBool=function(){return jspb.asserts.assert(this.nextWireType_==jspb.BinaryConstants.WireType.VARINT),!!this.decoder_.readUnsignedVarint32()},goog.exportProperty(jspb.BinaryReader.prototype,"readBool",jspb.BinaryReader.prototype.readBool),jspb.BinaryReader.prototype.readEnum=function(){return jspb.asserts.assert(this.nextWireType_==jspb.BinaryConstants.WireType.VARINT),this.decoder_.readSignedVarint64()},goog.exportProperty(jspb.BinaryReader.prototype,"readEnum",jspb.BinaryReader.prototype.readEnum),jspb.BinaryReader.prototype.readString=function(){jspb.asserts.assert(this.nextWireType_==jspb.BinaryConstants.WireType.DELIMITED);var X=this.decoder_.readUnsignedVarint32();return this.decoder_.readString(X)},goog.exportProperty(jspb.BinaryReader.prototype,"readString",jspb.BinaryReader.prototype.readString),jspb.BinaryReader.prototype.readBytes=function(){jspb.asserts.assert(this.nextWireType_==jspb.BinaryConstants.WireType.DELIMITED);var X=this.decoder_.readUnsignedVarint32();return this.decoder_.readBytes(X)},goog.exportProperty(jspb.BinaryReader.prototype,"readBytes",jspb.BinaryReader.prototype.readBytes),jspb.BinaryReader.prototype.readVarintHash64=function(){return jspb.asserts.assert(this.nextWireType_==jspb.BinaryConstants.WireType.VARINT),this.decoder_.readVarintHash64()},jspb.BinaryReader.prototype.readSintHash64=function(){return jspb.asserts.assert(this.nextWireType_==jspb.BinaryConstants.WireType.VARINT),this.decoder_.readZigzagVarintHash64()},jspb.BinaryReader.prototype.readSplitVarint64=function(X){return jspb.asserts.assert(this.nextWireType_==jspb.BinaryConstants.WireType.VARINT),this.decoder_.readSplitVarint64(X)},jspb.BinaryReader.prototype.readSplitZigzagVarint64=function(X){return jspb.asserts.assert(this.nextWireType_==jspb.BinaryConstants.WireType.VARINT),this.decoder_.readSplitVarint64(function(Z,_){return jspb.utils.fromZigzag64(Z,_,X)})},jspb.BinaryReader.prototype.readFixedHash64=function(){return jspb.asserts.assert(this.nextWireType_==jspb.BinaryConstants.WireType.FIXED64),this.decoder_.readFixedHash64()},jspb.BinaryReader.prototype.readSplitFixed64=function(X){return jspb.asserts.assert(this.nextWireType_==jspb.BinaryConstants.WireType.FIXED64),this.decoder_.readSplitFixed64(X)},jspb.BinaryReader.prototype.readPackedField_=function(X){jspb.asserts.assert(this.nextWireType_==jspb.BinaryConstants.WireType.DELIMITED);var Z=this.decoder_.readUnsignedVarint32();Z=this.decoder_.getCursor()+Z;for(var _=[];this.decoder_.getCursor()<Z;)_.push(X.call(this.decoder_));return _},jspb.BinaryReader.prototype.readPackedInt32=function(){return this.readPackedField_(this.decoder_.readSignedVarint32)},goog.exportProperty(jspb.BinaryReader.prototype,"readPackedInt32",jspb.BinaryReader.prototype.readPackedInt32),jspb.BinaryReader.prototype.readPackedInt32String=function(){return this.readPackedField_(this.decoder_.readSignedVarint32String)},jspb.BinaryReader.prototype.readPackedInt64=function(){return this.readPackedField_(this.decoder_.readSignedVarint64)},goog.exportProperty(jspb.BinaryReader.prototype,"readPackedInt64",jspb.BinaryReader.prototype.readPackedInt64),jspb.BinaryReader.prototype.readPackedInt64String=function(){return this.readPackedField_(this.decoder_.readSignedVarint64String)},jspb.BinaryReader.prototype.readPackedUint32=function(){return this.readPackedField_(this.decoder_.readUnsignedVarint32)},goog.exportProperty(jspb.BinaryReader.prototype,"readPackedUint32",jspb.BinaryReader.prototype.readPackedUint32),jspb.BinaryReader.prototype.readPackedUint32String=function(){return this.readPackedField_(this.decoder_.readUnsignedVarint32String)},jspb.BinaryReader.prototype.readPackedUint64=function(){return this.readPackedField_(this.decoder_.readUnsignedVarint64)},goog.exportProperty(jspb.BinaryReader.prototype,"readPackedUint64",jspb.BinaryReader.prototype.readPackedUint64),jspb.BinaryReader.prototype.readPackedUint64String=function(){return this.readPackedField_(this.decoder_.readUnsignedVarint64String)},jspb.BinaryReader.prototype.readPackedSint32=function(){return this.readPackedField_(this.decoder_.readZigzagVarint32)},goog.exportProperty(jspb.BinaryReader.prototype,"readPackedSint32",jspb.BinaryReader.prototype.readPackedSint32),jspb.BinaryReader.prototype.readPackedSint64=function(){return this.readPackedField_(this.decoder_.readZigzagVarint64)},goog.exportProperty(jspb.BinaryReader.prototype,"readPackedSint64",jspb.BinaryReader.prototype.readPackedSint64),jspb.BinaryReader.prototype.readPackedSint64String=function(){return this.readPackedField_(this.decoder_.readZigzagVarint64String)},jspb.BinaryReader.prototype.readPackedFixed32=function(){return this.readPackedField_(this.decoder_.readUint32)},goog.exportProperty(jspb.BinaryReader.prototype,"readPackedFixed32",jspb.BinaryReader.prototype.readPackedFixed32),jspb.BinaryReader.prototype.readPackedFixed64=function(){return this.readPackedField_(this.decoder_.readUint64)},goog.exportProperty(jspb.BinaryReader.prototype,"readPackedFixed64",jspb.BinaryReader.prototype.readPackedFixed64),jspb.BinaryReader.prototype.readPackedFixed64String=function(){return this.readPackedField_(this.decoder_.readUint64String)},jspb.BinaryReader.prototype.readPackedSfixed32=function(){return this.readPackedField_(this.decoder_.readInt32)},goog.exportProperty(jspb.BinaryReader.prototype,"readPackedSfixed32",jspb.BinaryReader.prototype.readPackedSfixed32),jspb.BinaryReader.prototype.readPackedSfixed64=function(){return this.readPackedField_(this.decoder_.readInt64)},goog.exportProperty(jspb.BinaryReader.prototype,"readPackedSfixed64",jspb.BinaryReader.prototype.readPackedSfixed64),jspb.BinaryReader.prototype.readPackedSfixed64String=function(){return this.readPackedField_(this.decoder_.readInt64String)},jspb.BinaryReader.prototype.readPackedFloat=function(){return this.readPackedField_(this.decoder_.readFloat)},goog.exportProperty(jspb.BinaryReader.prototype,"readPackedFloat",jspb.BinaryReader.prototype.readPackedFloat),jspb.BinaryReader.prototype.readPackedDouble=function(){return this.readPackedField_(this.decoder_.readDouble)},goog.exportProperty(jspb.BinaryReader.prototype,"readPackedDouble",jspb.BinaryReader.prototype.readPackedDouble),jspb.BinaryReader.prototype.readPackedBool=function(){return this.readPackedField_(this.decoder_.readBool)},goog.exportProperty(jspb.BinaryReader.prototype,"readPackedBool",jspb.BinaryReader.prototype.readPackedBool),jspb.BinaryReader.prototype.readPackedEnum=function(){return this.readPackedField_(this.decoder_.readEnum)},goog.exportProperty(jspb.BinaryReader.prototype,"readPackedEnum",jspb.BinaryReader.prototype.readPackedEnum),jspb.BinaryReader.prototype.readPackedVarintHash64=function(){return this.readPackedField_(this.decoder_.readVarintHash64)},jspb.BinaryReader.prototype.readPackedFixedHash64=function(){return this.readPackedField_(this.decoder_.readFixedHash64)},jspb.BinaryEncoder=function(){this.buffer_=[]},jspb.BinaryEncoder.prototype.length=function(){return this.buffer_.length},jspb.BinaryEncoder.prototype.end=function(){var X=this.buffer_;return this.buffer_=[],X},jspb.BinaryEncoder.prototype.writeSplitVarint64=function(X,Z){for(jspb.asserts.assert(X==Math.floor(X)),jspb.asserts.assert(Z==Math.floor(Z)),jspb.asserts.assert(0<=X&&X<jspb.BinaryConstants.TWO_TO_32),jspb.asserts.assert(0<=Z&&Z<jspb.BinaryConstants.TWO_TO_32);0<Z||127<X;)this.buffer_.push(127&X|128),X=(X>>>7|Z<<25)>>>0,Z>>>=7;this.buffer_.push(X)},jspb.BinaryEncoder.prototype.writeSplitFixed64=function(X,Z){jspb.asserts.assert(X==Math.floor(X)),jspb.asserts.assert(Z==Math.floor(Z)),jspb.asserts.assert(0<=X&&X<jspb.BinaryConstants.TWO_TO_32),jspb.asserts.assert(0<=Z&&Z<jspb.BinaryConstants.TWO_TO_32),this.writeUint32(X),this.writeUint32(Z)},jspb.BinaryEncoder.prototype.writeUnsignedVarint32=function(X){for(jspb.asserts.assert(X==Math.floor(X)),jspb.asserts.assert(0<=X&&X<jspb.BinaryConstants.TWO_TO_32);127<X;)this.buffer_.push(127&X|128),X>>>=7;this.buffer_.push(X)},jspb.BinaryEncoder.prototype.writeSignedVarint32=function(X){if(jspb.asserts.assert(X==Math.floor(X)),jspb.asserts.assert(X>=-jspb.BinaryConstants.TWO_TO_31&&X<jspb.BinaryConstants.TWO_TO_31),0<=X)this.writeUnsignedVarint32(X);else{for(var Z=0;9>Z;Z++)this.buffer_.push(127&X|128),X>>=7;this.buffer_.push(1)}},jspb.BinaryEncoder.prototype.writeUnsignedVarint64=function(X){jspb.asserts.assert(X==Math.floor(X)),jspb.asserts.assert(0<=X&&X<jspb.BinaryConstants.TWO_TO_64),jspb.utils.splitInt64(X),this.writeSplitVarint64(jspb.utils.split64Low,jspb.utils.split64High)},jspb.BinaryEncoder.prototype.writeSignedVarint64=function(X){jspb.asserts.assert(X==Math.floor(X)),jspb.asserts.assert(X>=-jspb.BinaryConstants.TWO_TO_63&&X<jspb.BinaryConstants.TWO_TO_63),jspb.utils.splitInt64(X),this.writeSplitVarint64(jspb.utils.split64Low,jspb.utils.split64High)},jspb.BinaryEncoder.prototype.writeZigzagVarint32=function(X){jspb.asserts.assert(X==Math.floor(X)),jspb.asserts.assert(X>=-jspb.BinaryConstants.TWO_TO_31&&X<jspb.BinaryConstants.TWO_TO_31),this.writeUnsignedVarint32((X<<1^X>>31)>>>0)},jspb.BinaryEncoder.prototype.writeZigzagVarint64=function(X){jspb.asserts.assert(X==Math.floor(X)),jspb.asserts.assert(X>=-jspb.BinaryConstants.TWO_TO_63&&X<jspb.BinaryConstants.TWO_TO_63),jspb.utils.splitZigzag64(X),this.writeSplitVarint64(jspb.utils.split64Low,jspb.utils.split64High)},jspb.BinaryEncoder.prototype.writeZigzagVarint64String=function(X){this.writeZigzagVarintHash64(jspb.utils.decimalStringToHash64(X))},jspb.BinaryEncoder.prototype.writeZigzagVarintHash64=function(X){var Z=this;jspb.utils.splitHash64(X),jspb.utils.toZigzag64(jspb.utils.split64Low,jspb.utils.split64High,function(_,K){Z.writeSplitVarint64(_>>>0,K>>>0)})},jspb.BinaryEncoder.prototype.writeUint8=function(X){jspb.asserts.assert(X==Math.floor(X)),jspb.asserts.assert(0<=X&&256>X),this.buffer_.push(X>>>0&255)},jspb.BinaryEncoder.prototype.writeUint16=function(X){jspb.asserts.assert(X==Math.floor(X)),jspb.asserts.assert(0<=X&&65536>X),this.buffer_.push(X>>>0&255),this.buffer_.push(X>>>8&255)},jspb.BinaryEncoder.prototype.writeUint32=function(X){jspb.asserts.assert(X==Math.floor(X)),jspb.asserts.assert(0<=X&&X<jspb.BinaryConstants.TWO_TO_32),this.buffer_.push(X>>>0&255),this.buffer_.push(X>>>8&255),this.buffer_.push(X>>>16&255),this.buffer_.push(X>>>24&255)},jspb.BinaryEncoder.prototype.writeUint64=function(X){jspb.asserts.assert(X==Math.floor(X)),jspb.asserts.assert(0<=X&&X<jspb.BinaryConstants.TWO_TO_64),jspb.utils.splitUint64(X),this.writeUint32(jspb.utils.split64Low),this.writeUint32(jspb.utils.split64High)},jspb.BinaryEncoder.prototype.writeInt8=function(X){jspb.asserts.assert(X==Math.floor(X)),jspb.asserts.assert(-128<=X&&128>X),this.buffer_.push(X>>>0&255)},jspb.BinaryEncoder.prototype.writeInt16=function(X){jspb.asserts.assert(X==Math.floor(X)),jspb.asserts.assert(-32768<=X&&32768>X),this.buffer_.push(X>>>0&255),this.buffer_.push(X>>>8&255)},jspb.BinaryEncoder.prototype.writeInt32=function(X){jspb.asserts.assert(X==Math.floor(X)),jspb.asserts.assert(X>=-jspb.BinaryConstants.TWO_TO_31&&X<jspb.BinaryConstants.TWO_TO_31),this.buffer_.push(X>>>0&255),this.buffer_.push(X>>>8&255),this.buffer_.push(X>>>16&255),this.buffer_.push(X>>>24&255)},jspb.BinaryEncoder.prototype.writeInt64=function(X){jspb.asserts.assert(X==Math.floor(X)),jspb.asserts.assert(X>=-jspb.BinaryConstants.TWO_TO_63&&X<jspb.BinaryConstants.TWO_TO_63),jspb.utils.splitInt64(X),this.writeSplitFixed64(jspb.utils.split64Low,jspb.utils.split64High)},jspb.BinaryEncoder.prototype.writeInt64String=function(X){jspb.asserts.assert(X==Math.floor(X)),jspb.asserts.assert(+X>=-jspb.BinaryConstants.TWO_TO_63&&+X<jspb.BinaryConstants.TWO_TO_63),jspb.utils.splitHash64(jspb.utils.decimalStringToHash64(X)),this.writeSplitFixed64(jspb.utils.split64Low,jspb.utils.split64High)},jspb.BinaryEncoder.prototype.writeFloat=function(X){jspb.asserts.assert(X===1/0||X===-1/0||isNaN(X)||X>=-jspb.BinaryConstants.FLOAT32_MAX&&X<=jspb.BinaryConstants.FLOAT32_MAX),jspb.utils.splitFloat32(X),this.writeUint32(jspb.utils.split64Low)},jspb.BinaryEncoder.prototype.writeDouble=function(X){jspb.asserts.assert(X===1/0||X===-1/0||isNaN(X)||X>=-jspb.BinaryConstants.FLOAT64_MAX&&X<=jspb.BinaryConstants.FLOAT64_MAX),jspb.utils.splitFloat64(X),this.writeUint32(jspb.utils.split64Low),this.writeUint32(jspb.utils.split64High)},jspb.BinaryEncoder.prototype.writeBool=function(X){jspb.asserts.assert(typeof X=="boolean"||typeof X=="number"),this.buffer_.push(X?1:0)},jspb.BinaryEncoder.prototype.writeEnum=function(X){jspb.asserts.assert(X==Math.floor(X)),jspb.asserts.assert(X>=-jspb.BinaryConstants.TWO_TO_31&&X<jspb.BinaryConstants.TWO_TO_31),this.writeSignedVarint32(X)},jspb.BinaryEncoder.prototype.writeBytes=function(X){this.buffer_.push.apply(this.buffer_,X)},jspb.BinaryEncoder.prototype.writeVarintHash64=function(X){jspb.utils.splitHash64(X),this.writeSplitVarint64(jspb.utils.split64Low,jspb.utils.split64High)},jspb.BinaryEncoder.prototype.writeFixedHash64=function(X){jspb.utils.splitHash64(X),this.writeUint32(jspb.utils.split64Low),this.writeUint32(jspb.utils.split64High)},jspb.BinaryEncoder.prototype.writeString=function(X){var Z=this.buffer_.length;jspb.asserts.assertString(X);for(var _=0;_<X.length;_++){var K=X.charCodeAt(_);if(128>K)this.buffer_.push(K);else if(2048>K)this.buffer_.push(K>>6|192),this.buffer_.push(63&K|128);else if(65536>K)if(55296<=K&&56319>=K&&_+1<X.length){var te=X.charCodeAt(_+1);56320<=te&&57343>=te&&(K=1024*(K-55296)+te-56320+65536,this.buffer_.push(K>>18|240),this.buffer_.push(K>>12&63|128),this.buffer_.push(K>>6&63|128),this.buffer_.push(63&K|128),_++)}else this.buffer_.push(K>>12|224),this.buffer_.push(K>>6&63|128),this.buffer_.push(63&K|128)}return this.buffer_.length-Z},jspb.arith={},jspb.arith.UInt64=function(X,Z){this.lo=X,this.hi=Z},jspb.arith.UInt64.prototype.cmp=function(X){return this.hi<X.hi||this.hi==X.hi&&this.lo<X.lo?-1:this.hi==X.hi&&this.lo==X.lo?0:1},jspb.arith.UInt64.prototype.rightShift=function(){return new jspb.arith.UInt64((this.lo>>>1|(1&this.hi)<<31)>>>0,this.hi>>>1>>>0)},jspb.arith.UInt64.prototype.leftShift=function(){return new jspb.arith.UInt64(this.lo<<1>>>0,(this.hi<<1|this.lo>>>31)>>>0)},jspb.arith.UInt64.prototype.msb=function(){return!!(2147483648&this.hi)},jspb.arith.UInt64.prototype.lsb=function(){return!!(1&this.lo)},jspb.arith.UInt64.prototype.zero=function(){return this.lo==0&&this.hi==0},jspb.arith.UInt64.prototype.add=function(X){return new jspb.arith.UInt64((this.lo+X.lo&4294967295)>>>0>>>0,((this.hi+X.hi&4294967295)>>>0)+(4294967296<=this.lo+X.lo?1:0)>>>0)},jspb.arith.UInt64.prototype.sub=function(X){return new jspb.arith.UInt64((this.lo-X.lo&4294967295)>>>0>>>0,((this.hi-X.hi&4294967295)>>>0)-(0>this.lo-X.lo?1:0)>>>0)},jspb.arith.UInt64.mul32x32=function(X,Z){var _=65535&X,K=65535&Z,te=Z>>>16;for(Z=_*K+65536*(_*te&65535)+65536*((X>>>=16)*K&65535),_=X*te+(_*te>>>16)+(X*K>>>16);4294967296<=Z;)Z-=4294967296,_+=1;return new jspb.arith.UInt64(Z>>>0,_>>>0)},jspb.arith.UInt64.prototype.mul=function(X){var Z=jspb.arith.UInt64.mul32x32(this.lo,X);return(X=jspb.arith.UInt64.mul32x32(this.hi,X)).hi=X.lo,X.lo=0,Z.add(X)},jspb.arith.UInt64.prototype.div=function(X){if(X==0)return[];var Z=new jspb.arith.UInt64(0,0),_=new jspb.arith.UInt64(this.lo,this.hi);X=new jspb.arith.UInt64(X,0);for(var K=new jspb.arith.UInt64(1,0);!X.msb();)X=X.leftShift(),K=K.leftShift();for(;!K.zero();)0>=X.cmp(_)&&(Z=Z.add(K),_=_.sub(X)),X=X.rightShift(),K=K.rightShift();return[Z,_]},jspb.arith.UInt64.prototype.toString=function(){for(var X="",Z=this;!Z.zero();){var _=(Z=Z.div(10))[0];X=Z[1].lo+X,Z=_}return X==""&&(X="0"),X},jspb.arith.UInt64.fromString=function(X){for(var Z=new jspb.arith.UInt64(0,0),_=new jspb.arith.UInt64(0,0),K=0;K<X.length;K++){if("0">X[K]||"9"<X[K])return null;var te=parseInt(X[K],10);_.lo=te,Z=Z.mul(10).add(_)}return Z},jspb.arith.UInt64.prototype.clone=function(){return new jspb.arith.UInt64(this.lo,this.hi)},jspb.arith.Int64=function(X,Z){this.lo=X,this.hi=Z},jspb.arith.Int64.prototype.add=function(X){return new jspb.arith.Int64((this.lo+X.lo&4294967295)>>>0>>>0,((this.hi+X.hi&4294967295)>>>0)+(4294967296<=this.lo+X.lo?1:0)>>>0)},jspb.arith.Int64.prototype.sub=function(X){return new jspb.arith.Int64((this.lo-X.lo&4294967295)>>>0>>>0,((this.hi-X.hi&4294967295)>>>0)-(0>this.lo-X.lo?1:0)>>>0)},jspb.arith.Int64.prototype.clone=function(){return new jspb.arith.Int64(this.lo,this.hi)},jspb.arith.Int64.prototype.toString=function(){var X=!!(2147483648&this.hi),Z=new jspb.arith.UInt64(this.lo,this.hi);return X&&(Z=new jspb.arith.UInt64(0,0).sub(Z)),(X?"-":"")+Z.toString()},jspb.arith.Int64.fromString=function(X){var Z=0<X.length&&X[0]=="-";return Z&&(X=X.substring(1)),(X=jspb.arith.UInt64.fromString(X))===null?null:(Z&&(X=new jspb.arith.UInt64(0,0).sub(X)),new jspb.arith.Int64(X.lo,X.hi))},jspb.BinaryWriter=function(){this.blocks_=[],this.totalLength_=0,this.encoder_=new jspb.BinaryEncoder,this.bookmarks_=[]},jspb.BinaryWriter.prototype.appendUint8Array_=function(X){var Z=this.encoder_.end();this.blocks_.push(Z),this.blocks_.push(X),this.totalLength_+=Z.length+X.length},jspb.BinaryWriter.prototype.beginDelimited_=function(X){return this.writeFieldHeader_(X,jspb.BinaryConstants.WireType.DELIMITED),X=this.encoder_.end(),this.blocks_.push(X),this.totalLength_+=X.length,X.push(this.totalLength_),X},jspb.BinaryWriter.prototype.endDelimited_=function(X){var Z=X.pop();for(Z=this.totalLength_+this.encoder_.length()-Z,jspb.asserts.assert(0<=Z);127<Z;)X.push(127&Z|128),Z>>>=7,this.totalLength_++;X.push(Z),this.totalLength_++},jspb.BinaryWriter.prototype.writeSerializedMessage=function(X,Z,_){this.appendUint8Array_(X.subarray(Z,_))},jspb.BinaryWriter.prototype.maybeWriteSerializedMessage=function(X,Z,_){X!=null&&Z!=null&&_!=null&&this.writeSerializedMessage(X,Z,_)},jspb.BinaryWriter.prototype.reset=function(){this.blocks_=[],this.encoder_.end(),this.totalLength_=0,this.bookmarks_=[]},jspb.BinaryWriter.prototype.getResultBuffer=function(){jspb.asserts.assert(this.bookmarks_.length==0);for(var X=new Uint8Array(this.totalLength_+this.encoder_.length()),Z=this.blocks_,_=Z.length,K=0,te=0;te<_;te++){var ne=Z[te];X.set(ne,K),K+=ne.length}return Z=this.encoder_.end(),X.set(Z,K),K+=Z.length,jspb.asserts.assert(K==X.length),this.blocks_=[X],X},goog.exportProperty(jspb.BinaryWriter.prototype,"getResultBuffer",jspb.BinaryWriter.prototype.getResultBuffer),jspb.BinaryWriter.prototype.getResultBase64String=function(X){return goog.crypt.base64.encodeByteArray(this.getResultBuffer(),X)},jspb.BinaryWriter.prototype.beginSubMessage=function(X){this.bookmarks_.push(this.beginDelimited_(X))},jspb.BinaryWriter.prototype.endSubMessage=function(){jspb.asserts.assert(0<=this.bookmarks_.length),this.endDelimited_(this.bookmarks_.pop())},jspb.BinaryWriter.prototype.writeFieldHeader_=function(X,Z){jspb.asserts.assert(1<=X&&X==Math.floor(X)),this.encoder_.writeUnsignedVarint32(8*X+Z)},jspb.BinaryWriter.prototype.writeAny=function(X,Z,_){var K=jspb.BinaryConstants.FieldType;switch(X){case K.DOUBLE:this.writeDouble(Z,_);break;case K.FLOAT:this.writeFloat(Z,_);break;case K.INT64:this.writeInt64(Z,_);break;case K.UINT64:this.writeUint64(Z,_);break;case K.INT32:this.writeInt32(Z,_);break;case K.FIXED64:this.writeFixed64(Z,_);break;case K.FIXED32:this.writeFixed32(Z,_);break;case K.BOOL:this.writeBool(Z,_);break;case K.STRING:this.writeString(Z,_);break;case K.GROUP:jspb.asserts.fail("Group field type not supported in writeAny()");break;case K.MESSAGE:jspb.asserts.fail("Message field type not supported in writeAny()");break;case K.BYTES:this.writeBytes(Z,_);break;case K.UINT32:this.writeUint32(Z,_);break;case K.ENUM:this.writeEnum(Z,_);break;case K.SFIXED32:this.writeSfixed32(Z,_);break;case K.SFIXED64:this.writeSfixed64(Z,_);break;case K.SINT32:this.writeSint32(Z,_);break;case K.SINT64:this.writeSint64(Z,_);break;case K.FHASH64:this.writeFixedHash64(Z,_);break;case K.VHASH64:this.writeVarintHash64(Z,_);break;default:jspb.asserts.fail("Invalid field type in writeAny()")}},jspb.BinaryWriter.prototype.writeUnsignedVarint32_=function(X,Z){Z!=null&&(this.writeFieldHeader_(X,jspb.BinaryConstants.WireType.VARINT),this.encoder_.writeUnsignedVarint32(Z))},jspb.BinaryWriter.prototype.writeSignedVarint32_=function(X,Z){Z!=null&&(this.writeFieldHeader_(X,jspb.BinaryConstants.WireType.VARINT),this.encoder_.writeSignedVarint32(Z))},jspb.BinaryWriter.prototype.writeUnsignedVarint64_=function(X,Z){Z!=null&&(this.writeFieldHeader_(X,jspb.BinaryConstants.WireType.VARINT),this.encoder_.writeUnsignedVarint64(Z))},jspb.BinaryWriter.prototype.writeSignedVarint64_=function(X,Z){Z!=null&&(this.writeFieldHeader_(X,jspb.BinaryConstants.WireType.VARINT),this.encoder_.writeSignedVarint64(Z))},jspb.BinaryWriter.prototype.writeZigzagVarint32_=function(X,Z){Z!=null&&(this.writeFieldHeader_(X,jspb.BinaryConstants.WireType.VARINT),this.encoder_.writeZigzagVarint32(Z))},jspb.BinaryWriter.prototype.writeZigzagVarint64_=function(X,Z){Z!=null&&(this.writeFieldHeader_(X,jspb.BinaryConstants.WireType.VARINT),this.encoder_.writeZigzagVarint64(Z))},jspb.BinaryWriter.prototype.writeZigzagVarint64String_=function(X,Z){Z!=null&&(this.writeFieldHeader_(X,jspb.BinaryConstants.WireType.VARINT),this.encoder_.writeZigzagVarint64String(Z))},jspb.BinaryWriter.prototype.writeZigzagVarintHash64_=function(X,Z){Z!=null&&(this.writeFieldHeader_(X,jspb.BinaryConstants.WireType.VARINT),this.encoder_.writeZigzagVarintHash64(Z))},jspb.BinaryWriter.prototype.writeInt32=function(X,Z){Z!=null&&(jspb.asserts.assert(Z>=-jspb.BinaryConstants.TWO_TO_31&&Z<jspb.BinaryConstants.TWO_TO_31),this.writeSignedVarint32_(X,Z))},goog.exportProperty(jspb.BinaryWriter.prototype,"writeInt32",jspb.BinaryWriter.prototype.writeInt32),jspb.BinaryWriter.prototype.writeInt32String=function(X,Z){Z!=null&&(Z=parseInt(Z,10),jspb.asserts.assert(Z>=-jspb.BinaryConstants.TWO_TO_31&&Z<jspb.BinaryConstants.TWO_TO_31),this.writeSignedVarint32_(X,Z))},jspb.BinaryWriter.prototype.writeInt64=function(X,Z){Z!=null&&(jspb.asserts.assert(Z>=-jspb.BinaryConstants.TWO_TO_63&&Z<jspb.BinaryConstants.TWO_TO_63),this.writeSignedVarint64_(X,Z))},goog.exportProperty(jspb.BinaryWriter.prototype,"writeInt64",jspb.BinaryWriter.prototype.writeInt64),jspb.BinaryWriter.prototype.writeInt64String=function(X,Z){Z!=null&&(Z=jspb.arith.Int64.fromString(Z),this.writeFieldHeader_(X,jspb.BinaryConstants.WireType.VARINT),this.encoder_.writeSplitVarint64(Z.lo,Z.hi))},jspb.BinaryWriter.prototype.writeUint32=function(X,Z){Z!=null&&(jspb.asserts.assert(0<=Z&&Z<jspb.BinaryConstants.TWO_TO_32),this.writeUnsignedVarint32_(X,Z))},goog.exportProperty(jspb.BinaryWriter.prototype,"writeUint32",jspb.BinaryWriter.prototype.writeUint32),jspb.BinaryWriter.prototype.writeUint32String=function(X,Z){Z!=null&&(Z=parseInt(Z,10),jspb.asserts.assert(0<=Z&&Z<jspb.BinaryConstants.TWO_TO_32),this.writeUnsignedVarint32_(X,Z))},jspb.BinaryWriter.prototype.writeUint64=function(X,Z){Z!=null&&(jspb.asserts.assert(0<=Z&&Z<jspb.BinaryConstants.TWO_TO_64),this.writeUnsignedVarint64_(X,Z))},goog.exportProperty(jspb.BinaryWriter.prototype,"writeUint64",jspb.BinaryWriter.prototype.writeUint64),jspb.BinaryWriter.prototype.writeUint64String=function(X,Z){Z!=null&&(Z=jspb.arith.UInt64.fromString(Z),this.writeFieldHeader_(X,jspb.BinaryConstants.WireType.VARINT),this.encoder_.writeSplitVarint64(Z.lo,Z.hi))},jspb.BinaryWriter.prototype.writeSint32=function(X,Z){Z!=null&&(jspb.asserts.assert(Z>=-jspb.BinaryConstants.TWO_TO_31&&Z<jspb.BinaryConstants.TWO_TO_31),this.writeZigzagVarint32_(X,Z))},goog.exportProperty(jspb.BinaryWriter.prototype,"writeSint32",jspb.BinaryWriter.prototype.writeSint32),jspb.BinaryWriter.prototype.writeSint64=function(X,Z){Z!=null&&(jspb.asserts.assert(Z>=-jspb.BinaryConstants.TWO_TO_63&&Z<jspb.BinaryConstants.TWO_TO_63),this.writeZigzagVarint64_(X,Z))},goog.exportProperty(jspb.BinaryWriter.prototype,"writeSint64",jspb.BinaryWriter.prototype.writeSint64),jspb.BinaryWriter.prototype.writeSintHash64=function(X,Z){Z!=null&&this.writeZigzagVarintHash64_(X,Z)},jspb.BinaryWriter.prototype.writeSint64String=function(X,Z){Z!=null&&this.writeZigzagVarint64String_(X,Z)},jspb.BinaryWriter.prototype.writeFixed32=function(X,Z){Z!=null&&(jspb.asserts.assert(0<=Z&&Z<jspb.BinaryConstants.TWO_TO_32),this.writeFieldHeader_(X,jspb.BinaryConstants.WireType.FIXED32),this.encoder_.writeUint32(Z))},goog.exportProperty(jspb.BinaryWriter.prototype,"writeFixed32",jspb.BinaryWriter.prototype.writeFixed32),jspb.BinaryWriter.prototype.writeFixed64=function(X,Z){Z!=null&&(jspb.asserts.assert(0<=Z&&Z<jspb.BinaryConstants.TWO_TO_64),this.writeFieldHeader_(X,jspb.BinaryConstants.WireType.FIXED64),this.encoder_.writeUint64(Z))},goog.exportProperty(jspb.BinaryWriter.prototype,"writeFixed64",jspb.BinaryWriter.prototype.writeFixed64),jspb.BinaryWriter.prototype.writeFixed64String=function(X,Z){Z!=null&&(Z=jspb.arith.UInt64.fromString(Z),this.writeFieldHeader_(X,jspb.BinaryConstants.WireType.FIXED64),this.encoder_.writeSplitFixed64(Z.lo,Z.hi))},jspb.BinaryWriter.prototype.writeSfixed32=function(X,Z){Z!=null&&(jspb.asserts.assert(Z>=-jspb.BinaryConstants.TWO_TO_31&&Z<jspb.BinaryConstants.TWO_TO_31),this.writeFieldHeader_(X,jspb.BinaryConstants.WireType.FIXED32),this.encoder_.writeInt32(Z))},goog.exportProperty(jspb.BinaryWriter.prototype,"writeSfixed32",jspb.BinaryWriter.prototype.writeSfixed32),jspb.BinaryWriter.prototype.writeSfixed64=function(X,Z){Z!=null&&(jspb.asserts.assert(Z>=-jspb.BinaryConstants.TWO_TO_63&&Z<jspb.BinaryConstants.TWO_TO_63),this.writeFieldHeader_(X,jspb.BinaryConstants.WireType.FIXED64),this.encoder_.writeInt64(Z))},goog.exportProperty(jspb.BinaryWriter.prototype,"writeSfixed64",jspb.BinaryWriter.prototype.writeSfixed64),jspb.BinaryWriter.prototype.writeSfixed64String=function(X,Z){Z!=null&&(Z=jspb.arith.Int64.fromString(Z),this.writeFieldHeader_(X,jspb.BinaryConstants.WireType.FIXED64),this.encoder_.writeSplitFixed64(Z.lo,Z.hi))},jspb.BinaryWriter.prototype.writeFloat=function(X,Z){Z!=null&&(this.writeFieldHeader_(X,jspb.BinaryConstants.WireType.FIXED32),this.encoder_.writeFloat(Z))},goog.exportProperty(jspb.BinaryWriter.prototype,"writeFloat",jspb.BinaryWriter.prototype.writeFloat),jspb.BinaryWriter.prototype.writeDouble=function(X,Z){Z!=null&&(this.writeFieldHeader_(X,jspb.BinaryConstants.WireType.FIXED64),this.encoder_.writeDouble(Z))},goog.exportProperty(jspb.BinaryWriter.prototype,"writeDouble",jspb.BinaryWriter.prototype.writeDouble),jspb.BinaryWriter.prototype.writeBool=function(X,Z){Z!=null&&(jspb.asserts.assert(typeof Z=="boolean"||typeof Z=="number"),this.writeFieldHeader_(X,jspb.BinaryConstants.WireType.VARINT),this.encoder_.writeBool(Z))},goog.exportProperty(jspb.BinaryWriter.prototype,"writeBool",jspb.BinaryWriter.prototype.writeBool),jspb.BinaryWriter.prototype.writeEnum=function(X,Z){Z!=null&&(jspb.asserts.assert(Z>=-jspb.BinaryConstants.TWO_TO_31&&Z<jspb.BinaryConstants.TWO_TO_31),this.writeFieldHeader_(X,jspb.BinaryConstants.WireType.VARINT),this.encoder_.writeSignedVarint32(Z))},goog.exportProperty(jspb.BinaryWriter.prototype,"writeEnum",jspb.BinaryWriter.prototype.writeEnum),jspb.BinaryWriter.prototype.writeString=function(X,Z){Z!=null&&(X=this.beginDelimited_(X),this.encoder_.writeString(Z),this.endDelimited_(X))},goog.exportProperty(jspb.BinaryWriter.prototype,"writeString",jspb.BinaryWriter.prototype.writeString),jspb.BinaryWriter.prototype.writeBytes=function(X,Z){Z!=null&&(Z=jspb.utils.byteSourceToUint8Array(Z),this.writeFieldHeader_(X,jspb.BinaryConstants.WireType.DELIMITED),this.encoder_.writeUnsignedVarint32(Z.length),this.appendUint8Array_(Z))},goog.exportProperty(jspb.BinaryWriter.prototype,"writeBytes",jspb.BinaryWriter.prototype.writeBytes),jspb.BinaryWriter.prototype.writeMessage=function(X,Z,_){Z!=null&&(X=this.beginDelimited_(X),_(Z,this),this.endDelimited_(X))},goog.exportProperty(jspb.BinaryWriter.prototype,"writeMessage",jspb.BinaryWriter.prototype.writeMessage),jspb.BinaryWriter.prototype.writeMessageSet=function(X,Z,_){Z!=null&&(this.writeFieldHeader_(1,jspb.BinaryConstants.WireType.START_GROUP),this.writeFieldHeader_(2,jspb.BinaryConstants.WireType.VARINT),this.encoder_.writeSignedVarint32(X),X=this.beginDelimited_(3),_(Z,this),this.endDelimited_(X),this.writeFieldHeader_(1,jspb.BinaryConstants.WireType.END_GROUP))},jspb.BinaryWriter.prototype.writeGroup=function(X,Z,_){Z!=null&&(this.writeFieldHeader_(X,jspb.BinaryConstants.WireType.START_GROUP),_(Z,this),this.writeFieldHeader_(X,jspb.BinaryConstants.WireType.END_GROUP))},goog.exportProperty(jspb.BinaryWriter.prototype,"writeGroup",jspb.BinaryWriter.prototype.writeGroup),jspb.BinaryWriter.prototype.writeFixedHash64=function(X,Z){Z!=null&&(jspb.asserts.assert(Z.length==8),this.writeFieldHeader_(X,jspb.BinaryConstants.WireType.FIXED64),this.encoder_.writeFixedHash64(Z))},jspb.BinaryWriter.prototype.writeVarintHash64=function(X,Z){Z!=null&&(jspb.asserts.assert(Z.length==8),this.writeFieldHeader_(X,jspb.BinaryConstants.WireType.VARINT),this.encoder_.writeVarintHash64(Z))},jspb.BinaryWriter.prototype.writeSplitFixed64=function(X,Z,_){this.writeFieldHeader_(X,jspb.BinaryConstants.WireType.FIXED64),this.encoder_.writeSplitFixed64(Z,_)},jspb.BinaryWriter.prototype.writeSplitVarint64=function(X,Z,_){this.writeFieldHeader_(X,jspb.BinaryConstants.WireType.VARINT),this.encoder_.writeSplitVarint64(Z,_)},jspb.BinaryWriter.prototype.writeSplitZigzagVarint64=function(X,Z,_){this.writeFieldHeader_(X,jspb.BinaryConstants.WireType.VARINT);var K=this.encoder_;jspb.utils.toZigzag64(Z,_,function(te,ne){K.writeSplitVarint64(te>>>0,ne>>>0)})},jspb.BinaryWriter.prototype.writeRepeatedInt32=function(X,Z){if(Z!=null)for(var _=0;_<Z.length;_++)this.writeSignedVarint32_(X,Z[_])},goog.exportProperty(jspb.BinaryWriter.prototype,"writeRepeatedInt32",jspb.BinaryWriter.prototype.writeRepeatedInt32),jspb.BinaryWriter.prototype.writeRepeatedInt32String=function(X,Z){if(Z!=null)for(var _=0;_<Z.length;_++)this.writeInt32String(X,Z[_])},jspb.BinaryWriter.prototype.writeRepeatedInt64=function(X,Z){if(Z!=null)for(var _=0;_<Z.length;_++)this.writeSignedVarint64_(X,Z[_])},goog.exportProperty(jspb.BinaryWriter.prototype,"writeRepeatedInt64",jspb.BinaryWriter.prototype.writeRepeatedInt64),jspb.BinaryWriter.prototype.writeRepeatedSplitFixed64=function(X,Z,_,K){if(Z!=null)for(var te=0;te<Z.length;te++)this.writeSplitFixed64(X,_(Z[te]),K(Z[te]))},jspb.BinaryWriter.prototype.writeRepeatedSplitVarint64=function(X,Z,_,K){if(Z!=null)for(var te=0;te<Z.length;te++)this.writeSplitVarint64(X,_(Z[te]),K(Z[te]))},jspb.BinaryWriter.prototype.writeRepeatedSplitZigzagVarint64=function(X,Z,_,K){if(Z!=null)for(var te=0;te<Z.length;te++)this.writeSplitZigzagVarint64(X,_(Z[te]),K(Z[te]))},jspb.BinaryWriter.prototype.writeRepeatedInt64String=function(X,Z){if(Z!=null)for(var _=0;_<Z.length;_++)this.writeInt64String(X,Z[_])},jspb.BinaryWriter.prototype.writeRepeatedUint32=function(X,Z){if(Z!=null)for(var _=0;_<Z.length;_++)this.writeUnsignedVarint32_(X,Z[_])},goog.exportProperty(jspb.BinaryWriter.prototype,"writeRepeatedUint32",jspb.BinaryWriter.prototype.writeRepeatedUint32),jspb.BinaryWriter.prototype.writeRepeatedUint32String=function(X,Z){if(Z!=null)for(var _=0;_<Z.length;_++)this.writeUint32String(X,Z[_])},jspb.BinaryWriter.prototype.writeRepeatedUint64=function(X,Z){if(Z!=null)for(var _=0;_<Z.length;_++)this.writeUnsignedVarint64_(X,Z[_])},goog.exportProperty(jspb.BinaryWriter.prototype,"writeRepeatedUint64",jspb.BinaryWriter.prototype.writeRepeatedUint64),jspb.BinaryWriter.prototype.writeRepeatedUint64String=function(X,Z){if(Z!=null)for(var _=0;_<Z.length;_++)this.writeUint64String(X,Z[_])},jspb.BinaryWriter.prototype.writeRepeatedSint32=function(X,Z){if(Z!=null)for(var _=0;_<Z.length;_++)this.writeZigzagVarint32_(X,Z[_])},goog.exportProperty(jspb.BinaryWriter.prototype,"writeRepeatedSint32",jspb.BinaryWriter.prototype.writeRepeatedSint32),jspb.BinaryWriter.prototype.writeRepeatedSint64=function(X,Z){if(Z!=null)for(var _=0;_<Z.length;_++)this.writeZigzagVarint64_(X,Z[_])},goog.exportProperty(jspb.BinaryWriter.prototype,"writeRepeatedSint64",jspb.BinaryWriter.prototype.writeRepeatedSint64),jspb.BinaryWriter.prototype.writeRepeatedSint64String=function(X,Z){if(Z!=null)for(var _=0;_<Z.length;_++)this.writeZigzagVarint64String_(X,Z[_])},jspb.BinaryWriter.prototype.writeRepeatedSintHash64=function(X,Z){if(Z!=null)for(var _=0;_<Z.length;_++)this.writeZigzagVarintHash64_(X,Z[_])},jspb.BinaryWriter.prototype.writeRepeatedFixed32=function(X,Z){if(Z!=null)for(var _=0;_<Z.length;_++)this.writeFixed32(X,Z[_])},goog.exportProperty(jspb.BinaryWriter.prototype,"writeRepeatedFixed32",jspb.BinaryWriter.prototype.writeRepeatedFixed32),jspb.BinaryWriter.prototype.writeRepeatedFixed64=function(X,Z){if(Z!=null)for(var _=0;_<Z.length;_++)this.writeFixed64(X,Z[_])},goog.exportProperty(jspb.BinaryWriter.prototype,"writeRepeatedFixed64",jspb.BinaryWriter.prototype.writeRepeatedFixed64),jspb.BinaryWriter.prototype.writeRepeatedFixed64String=function(X,Z){if(Z!=null)for(var _=0;_<Z.length;_++)this.writeFixed64String(X,Z[_])},goog.exportProperty(jspb.BinaryWriter.prototype,"writeRepeatedFixed64String",jspb.BinaryWriter.prototype.writeRepeatedFixed64String),jspb.BinaryWriter.prototype.writeRepeatedSfixed32=function(X,Z){if(Z!=null)for(var _=0;_<Z.length;_++)this.writeSfixed32(X,Z[_])},goog.exportProperty(jspb.BinaryWriter.prototype,"writeRepeatedSfixed32",jspb.BinaryWriter.prototype.writeRepeatedSfixed32),jspb.BinaryWriter.prototype.writeRepeatedSfixed64=function(X,Z){if(Z!=null)for(var _=0;_<Z.length;_++)this.writeSfixed64(X,Z[_])},goog.exportProperty(jspb.BinaryWriter.prototype,"writeRepeatedSfixed64",jspb.BinaryWriter.prototype.writeRepeatedSfixed64),jspb.BinaryWriter.prototype.writeRepeatedSfixed64String=function(X,Z){if(Z!=null)for(var _=0;_<Z.length;_++)this.writeSfixed64String(X,Z[_])},jspb.BinaryWriter.prototype.writeRepeatedFloat=function(X,Z){if(Z!=null)for(var _=0;_<Z.length;_++)this.writeFloat(X,Z[_])},goog.exportProperty(jspb.BinaryWriter.prototype,"writeRepeatedFloat",jspb.BinaryWriter.prototype.writeRepeatedFloat),jspb.BinaryWriter.prototype.writeRepeatedDouble=function(X,Z){if(Z!=null)for(var _=0;_<Z.length;_++)this.writeDouble(X,Z[_])},goog.exportProperty(jspb.BinaryWriter.prototype,"writeRepeatedDouble",jspb.BinaryWriter.prototype.writeRepeatedDouble),jspb.BinaryWriter.prototype.writeRepeatedBool=function(X,Z){if(Z!=null)for(var _=0;_<Z.length;_++)this.writeBool(X,Z[_])},goog.exportProperty(jspb.BinaryWriter.prototype,"writeRepeatedBool",jspb.BinaryWriter.prototype.writeRepeatedBool),jspb.BinaryWriter.prototype.writeRepeatedEnum=function(X,Z){if(Z!=null)for(var _=0;_<Z.length;_++)this.writeEnum(X,Z[_])},goog.exportProperty(jspb.BinaryWriter.prototype,"writeRepeatedEnum",jspb.BinaryWriter.prototype.writeRepeatedEnum),jspb.BinaryWriter.prototype.writeRepeatedString=function(X,Z){if(Z!=null)for(var _=0;_<Z.length;_++)this.writeString(X,Z[_])},goog.exportProperty(jspb.BinaryWriter.prototype,"writeRepeatedString",jspb.BinaryWriter.prototype.writeRepeatedString),jspb.BinaryWriter.prototype.writeRepeatedBytes=function(X,Z){if(Z!=null)for(var _=0;_<Z.length;_++)this.writeBytes(X,Z[_])},goog.exportProperty(jspb.BinaryWriter.prototype,"writeRepeatedBytes",jspb.BinaryWriter.prototype.writeRepeatedBytes),jspb.BinaryWriter.prototype.writeRepeatedMessage=function(X,Z,_){if(Z!=null)for(var K=0;K<Z.length;K++){var te=this.beginDelimited_(X);_(Z[K],this),this.endDelimited_(te)}},goog.exportProperty(jspb.BinaryWriter.prototype,"writeRepeatedMessage",jspb.BinaryWriter.prototype.writeRepeatedMessage),jspb.BinaryWriter.prototype.writeRepeatedGroup=function(X,Z,_){if(Z!=null)for(var K=0;K<Z.length;K++)this.writeFieldHeader_(X,jspb.BinaryConstants.WireType.START_GROUP),_(Z[K],this),this.writeFieldHeader_(X,jspb.BinaryConstants.WireType.END_GROUP)},goog.exportProperty(jspb.BinaryWriter.prototype,"writeRepeatedGroup",jspb.BinaryWriter.prototype.writeRepeatedGroup),jspb.BinaryWriter.prototype.writeRepeatedFixedHash64=function(X,Z){if(Z!=null)for(var _=0;_<Z.length;_++)this.writeFixedHash64(X,Z[_])},jspb.BinaryWriter.prototype.writeRepeatedVarintHash64=function(X,Z){if(Z!=null)for(var _=0;_<Z.length;_++)this.writeVarintHash64(X,Z[_])},jspb.BinaryWriter.prototype.writePackedInt32=function(X,Z){if(Z!=null&&Z.length){X=this.beginDelimited_(X);for(var _=0;_<Z.length;_++)this.encoder_.writeSignedVarint32(Z[_]);this.endDelimited_(X)}},goog.exportProperty(jspb.BinaryWriter.prototype,"writePackedInt32",jspb.BinaryWriter.prototype.writePackedInt32),jspb.BinaryWriter.prototype.writePackedInt32String=function(X,Z){if(Z!=null&&Z.length){X=this.beginDelimited_(X);for(var _=0;_<Z.length;_++)this.encoder_.writeSignedVarint32(parseInt(Z[_],10));this.endDelimited_(X)}},jspb.BinaryWriter.prototype.writePackedInt64=function(X,Z){if(Z!=null&&Z.length){X=this.beginDelimited_(X);for(var _=0;_<Z.length;_++)this.encoder_.writeSignedVarint64(Z[_]);this.endDelimited_(X)}},goog.exportProperty(jspb.BinaryWriter.prototype,"writePackedInt64",jspb.BinaryWriter.prototype.writePackedInt64),jspb.BinaryWriter.prototype.writePackedSplitFixed64=function(X,Z,_,K){if(Z!=null){X=this.beginDelimited_(X);for(var te=0;te<Z.length;te++)this.encoder_.writeSplitFixed64(_(Z[te]),K(Z[te]));this.endDelimited_(X)}},jspb.BinaryWriter.prototype.writePackedSplitVarint64=function(X,Z,_,K){if(Z!=null){X=this.beginDelimited_(X);for(var te=0;te<Z.length;te++)this.encoder_.writeSplitVarint64(_(Z[te]),K(Z[te]));this.endDelimited_(X)}},jspb.BinaryWriter.prototype.writePackedSplitZigzagVarint64=function(X,Z,_,K){if(Z!=null){X=this.beginDelimited_(X);for(var te=this.encoder_,ne=0;ne<Z.length;ne++)jspb.utils.toZigzag64(_(Z[ne]),K(Z[ne]),function(oe,ie){te.writeSplitVarint64(oe>>>0,ie>>>0)});this.endDelimited_(X)}},jspb.BinaryWriter.prototype.writePackedInt64String=function(X,Z){if(Z!=null&&Z.length){X=this.beginDelimited_(X);for(var _=0;_<Z.length;_++){var K=jspb.arith.Int64.fromString(Z[_]);this.encoder_.writeSplitVarint64(K.lo,K.hi)}this.endDelimited_(X)}},jspb.BinaryWriter.prototype.writePackedUint32=function(X,Z){if(Z!=null&&Z.length){X=this.beginDelimited_(X);for(var _=0;_<Z.length;_++)this.encoder_.writeUnsignedVarint32(Z[_]);this.endDelimited_(X)}},goog.exportProperty(jspb.BinaryWriter.prototype,"writePackedUint32",jspb.BinaryWriter.prototype.writePackedUint32),jspb.BinaryWriter.prototype.writePackedUint32String=function(X,Z){if(Z!=null&&Z.length){X=this.beginDelimited_(X);for(var _=0;_<Z.length;_++)this.encoder_.writeUnsignedVarint32(parseInt(Z[_],10));this.endDelimited_(X)}},jspb.BinaryWriter.prototype.writePackedUint64=function(X,Z){if(Z!=null&&Z.length){X=this.beginDelimited_(X);for(var _=0;_<Z.length;_++)this.encoder_.writeUnsignedVarint64(Z[_]);this.endDelimited_(X)}},goog.exportProperty(jspb.BinaryWriter.prototype,"writePackedUint64",jspb.BinaryWriter.prototype.writePackedUint64),jspb.BinaryWriter.prototype.writePackedUint64String=function(X,Z){if(Z!=null&&Z.length){X=this.beginDelimited_(X);for(var _=0;_<Z.length;_++){var K=jspb.arith.UInt64.fromString(Z[_]);this.encoder_.writeSplitVarint64(K.lo,K.hi)}this.endDelimited_(X)}},jspb.BinaryWriter.prototype.writePackedSint32=function(X,Z){if(Z!=null&&Z.length){X=this.beginDelimited_(X);for(var _=0;_<Z.length;_++)this.encoder_.writeZigzagVarint32(Z[_]);this.endDelimited_(X)}},goog.exportProperty(jspb.BinaryWriter.prototype,"writePackedSint32",jspb.BinaryWriter.prototype.writePackedSint32),jspb.BinaryWriter.prototype.writePackedSint64=function(X,Z){if(Z!=null&&Z.length){X=this.beginDelimited_(X);for(var _=0;_<Z.length;_++)this.encoder_.writeZigzagVarint64(Z[_]);this.endDelimited_(X)}},goog.exportProperty(jspb.BinaryWriter.prototype,"writePackedSint64",jspb.BinaryWriter.prototype.writePackedSint64),jspb.BinaryWriter.prototype.writePackedSint64String=function(X,Z){if(Z!=null&&Z.length){X=this.beginDelimited_(X);for(var _=0;_<Z.length;_++)this.encoder_.writeZigzagVarintHash64(jspb.utils.decimalStringToHash64(Z[_]));this.endDelimited_(X)}},jspb.BinaryWriter.prototype.writePackedSintHash64=function(X,Z){if(Z!=null&&Z.length){X=this.beginDelimited_(X);for(var _=0;_<Z.length;_++)this.encoder_.writeZigzagVarintHash64(Z[_]);this.endDelimited_(X)}},jspb.BinaryWriter.prototype.writePackedFixed32=function(X,Z){if(Z!=null&&Z.length)for(this.writeFieldHeader_(X,jspb.BinaryConstants.WireType.DELIMITED),this.encoder_.writeUnsignedVarint32(4*Z.length),X=0;X<Z.length;X++)this.encoder_.writeUint32(Z[X])},goog.exportProperty(jspb.BinaryWriter.prototype,"writePackedFixed32",jspb.BinaryWriter.prototype.writePackedFixed32),jspb.BinaryWriter.prototype.writePackedFixed64=function(X,Z){if(Z!=null&&Z.length)for(this.writeFieldHeader_(X,jspb.BinaryConstants.WireType.DELIMITED),this.encoder_.writeUnsignedVarint32(8*Z.length),X=0;X<Z.length;X++)this.encoder_.writeUint64(Z[X])},goog.exportProperty(jspb.BinaryWriter.prototype,"writePackedFixed64",jspb.BinaryWriter.prototype.writePackedFixed64),jspb.BinaryWriter.prototype.writePackedFixed64String=function(X,Z){if(Z!=null&&Z.length)for(this.writeFieldHeader_(X,jspb.BinaryConstants.WireType.DELIMITED),this.encoder_.writeUnsignedVarint32(8*Z.length),X=0;X<Z.length;X++){var _=jspb.arith.UInt64.fromString(Z[X]);this.encoder_.writeSplitFixed64(_.lo,_.hi)}},jspb.BinaryWriter.prototype.writePackedSfixed32=function(X,Z){if(Z!=null&&Z.length)for(this.writeFieldHeader_(X,jspb.BinaryConstants.WireType.DELIMITED),this.encoder_.writeUnsignedVarint32(4*Z.length),X=0;X<Z.length;X++)this.encoder_.writeInt32(Z[X])},goog.exportProperty(jspb.BinaryWriter.prototype,"writePackedSfixed32",jspb.BinaryWriter.prototype.writePackedSfixed32),jspb.BinaryWriter.prototype.writePackedSfixed64=function(X,Z){if(Z!=null&&Z.length)for(this.writeFieldHeader_(X,jspb.BinaryConstants.WireType.DELIMITED),this.encoder_.writeUnsignedVarint32(8*Z.length),X=0;X<Z.length;X++)this.encoder_.writeInt64(Z[X])},goog.exportProperty(jspb.BinaryWriter.prototype,"writePackedSfixed64",jspb.BinaryWriter.prototype.writePackedSfixed64),jspb.BinaryWriter.prototype.writePackedSfixed64String=function(X,Z){if(Z!=null&&Z.length)for(this.writeFieldHeader_(X,jspb.BinaryConstants.WireType.DELIMITED),this.encoder_.writeUnsignedVarint32(8*Z.length),X=0;X<Z.length;X++)this.encoder_.writeInt64String(Z[X])},jspb.BinaryWriter.prototype.writePackedFloat=function(X,Z){if(Z!=null&&Z.length)for(this.writeFieldHeader_(X,jspb.BinaryConstants.WireType.DELIMITED),this.encoder_.writeUnsignedVarint32(4*Z.length),X=0;X<Z.length;X++)this.encoder_.writeFloat(Z[X])},goog.exportProperty(jspb.BinaryWriter.prototype,"writePackedFloat",jspb.BinaryWriter.prototype.writePackedFloat),jspb.BinaryWriter.prototype.writePackedDouble=function(X,Z){if(Z!=null&&Z.length)for(this.writeFieldHeader_(X,jspb.BinaryConstants.WireType.DELIMITED),this.encoder_.writeUnsignedVarint32(8*Z.length),X=0;X<Z.length;X++)this.encoder_.writeDouble(Z[X])},goog.exportProperty(jspb.BinaryWriter.prototype,"writePackedDouble",jspb.BinaryWriter.prototype.writePackedDouble),jspb.BinaryWriter.prototype.writePackedBool=function(X,Z){if(Z!=null&&Z.length)for(this.writeFieldHeader_(X,jspb.BinaryConstants.WireType.DELIMITED),this.encoder_.writeUnsignedVarint32(Z.length),X=0;X<Z.length;X++)this.encoder_.writeBool(Z[X])},goog.exportProperty(jspb.BinaryWriter.prototype,"writePackedBool",jspb.BinaryWriter.prototype.writePackedBool),jspb.BinaryWriter.prototype.writePackedEnum=function(X,Z){if(Z!=null&&Z.length){X=this.beginDelimited_(X);for(var _=0;_<Z.length;_++)this.encoder_.writeEnum(Z[_]);this.endDelimited_(X)}},goog.exportProperty(jspb.BinaryWriter.prototype,"writePackedEnum",jspb.BinaryWriter.prototype.writePackedEnum),jspb.BinaryWriter.prototype.writePackedFixedHash64=function(X,Z){if(Z!=null&&Z.length)for(this.writeFieldHeader_(X,jspb.BinaryConstants.WireType.DELIMITED),this.encoder_.writeUnsignedVarint32(8*Z.length),X=0;X<Z.length;X++)this.encoder_.writeFixedHash64(Z[X])},jspb.BinaryWriter.prototype.writePackedVarintHash64=function(X,Z){if(Z!=null&&Z.length){X=this.beginDelimited_(X);for(var _=0;_<Z.length;_++)this.encoder_.writeVarintHash64(Z[_]);this.endDelimited_(X)}},jspb.Map=function(X,Z){this.arr_=X,this.valueCtor_=Z,this.map_={},this.arrClean=!0,0<this.arr_.length&&this.loadFromArray_()},goog.exportSymbol("jspb.Map",jspb.Map),jspb.Map.prototype.loadFromArray_=function(){for(var X=0;X<this.arr_.length;X++){var Z=this.arr_[X],_=Z[0];this.map_[_.toString()]=new jspb.Map.Entry_(_,Z[1])}this.arrClean=!0},jspb.Map.prototype.toArray=function(){if(this.arrClean){if(this.valueCtor_){var X,Z=this.map_;for(X in Z)if(Object.prototype.hasOwnProperty.call(Z,X)){var _=Z[X].valueWrapper;_&&_.toArray()}}}else{for(this.arr_.length=0,(Z=this.stringKeys_()).sort(),X=0;X<Z.length;X++){var K=this.map_[Z[X]];(_=K.valueWrapper)&&_.toArray(),this.arr_.push([K.key,K.value])}this.arrClean=!0}return this.arr_},goog.exportProperty(jspb.Map.prototype,"toArray",jspb.Map.prototype.toArray),jspb.Map.prototype.toObject=function(X,Z){for(var _=this.toArray(),K=[],te=0;te<_.length;te++){var ne=this.map_[_[te][0].toString()];this.wrapEntry_(ne);var oe=ne.valueWrapper;oe?(jspb.asserts.assert(Z),K.push([ne.key,Z(X,oe)])):K.push([ne.key,ne.value])}return K},goog.exportProperty(jspb.Map.prototype,"toObject",jspb.Map.prototype.toObject),jspb.Map.fromObject=function(X,Z,_){Z=new jspb.Map([],Z);for(var K=0;K<X.length;K++){var te=X[K][0],ne=_(X[K][1]);Z.set(te,ne)}return Z},goog.exportProperty(jspb.Map,"fromObject",jspb.Map.fromObject),jspb.Map.ArrayIteratorIterable_=function(X){this.idx_=0,this.arr_=X},jspb.Map.ArrayIteratorIterable_.prototype.next=function(){return this.idx_<this.arr_.length?{done:!1,value:this.arr_[this.idx_++]}:{done:!0,value:void 0}},typeof Symbol<"u"&&(jspb.Map.ArrayIteratorIterable_.prototype[Symbol.iterator]=function(){return this}),jspb.Map.prototype.getLength=function(){return this.stringKeys_().length},goog.exportProperty(jspb.Map.prototype,"getLength",jspb.Map.prototype.getLength),jspb.Map.prototype.clear=function(){this.map_={},this.arrClean=!1},goog.exportProperty(jspb.Map.prototype,"clear",jspb.Map.prototype.clear),jspb.Map.prototype.del=function(X){X=X.toString();var Z=this.map_.hasOwnProperty(X);return delete this.map_[X],this.arrClean=!1,Z},goog.exportProperty(jspb.Map.prototype,"del",jspb.Map.prototype.del),jspb.Map.prototype.getEntryList=function(){var X=[],Z=this.stringKeys_();Z.sort();for(var _=0;_<Z.length;_++){var K=this.map_[Z[_]];X.push([K.key,K.value])}return X},goog.exportProperty(jspb.Map.prototype,"getEntryList",jspb.Map.prototype.getEntryList),jspb.Map.prototype.entries=function(){var X=[],Z=this.stringKeys_();Z.sort();for(var _=0;_<Z.length;_++){var K=this.map_[Z[_]];X.push([K.key,this.wrapEntry_(K)])}return new jspb.Map.ArrayIteratorIterable_(X)},goog.exportProperty(jspb.Map.prototype,"entries",jspb.Map.prototype.entries),jspb.Map.prototype.keys=function(){var X=[],Z=this.stringKeys_();Z.sort();for(var _=0;_<Z.length;_++)X.push(this.map_[Z[_]].key);return new jspb.Map.ArrayIteratorIterable_(X)},goog.exportProperty(jspb.Map.prototype,"keys",jspb.Map.prototype.keys),jspb.Map.prototype.values=function(){var X=[],Z=this.stringKeys_();Z.sort();for(var _=0;_<Z.length;_++)X.push(this.wrapEntry_(this.map_[Z[_]]));return new jspb.Map.ArrayIteratorIterable_(X)},goog.exportProperty(jspb.Map.prototype,"values",jspb.Map.prototype.values),jspb.Map.prototype.forEach=function(X,Z){var _=this.stringKeys_();_.sort();for(var K=0;K<_.length;K++){var te=this.map_[_[K]];X.call(Z,this.wrapEntry_(te),te.key,this)}},goog.exportProperty(jspb.Map.prototype,"forEach",jspb.Map.prototype.forEach),jspb.Map.prototype.set=function(X,Z){var _=new jspb.Map.Entry_(X);return this.valueCtor_?(_.valueWrapper=Z,_.value=Z.toArray()):_.value=Z,this.map_[X.toString()]=_,this.arrClean=!1,this},goog.exportProperty(jspb.Map.prototype,"set",jspb.Map.prototype.set),jspb.Map.prototype.wrapEntry_=function(X){return this.valueCtor_?(X.valueWrapper||(X.valueWrapper=new this.valueCtor_(X.value)),X.valueWrapper):X.value},jspb.Map.prototype.get=function(X){if(X=this.map_[X.toString()])return this.wrapEntry_(X)},goog.exportProperty(jspb.Map.prototype,"get",jspb.Map.prototype.get),jspb.Map.prototype.has=function(X){return X.toString()in this.map_},goog.exportProperty(jspb.Map.prototype,"has",jspb.Map.prototype.has),jspb.Map.prototype.serializeBinary=function(X,Z,_,K,te){var ne=this.stringKeys_();ne.sort();for(var oe=0;oe<ne.length;oe++){var ie=this.map_[ne[oe]];Z.beginSubMessage(X),_.call(Z,1,ie.key),this.valueCtor_?K.call(Z,2,this.wrapEntry_(ie),te):K.call(Z,2,ie.value),Z.endSubMessage()}},goog.exportProperty(jspb.Map.prototype,"serializeBinary",jspb.Map.prototype.serializeBinary),jspb.Map.deserializeBinary=function(X,Z,_,K,te,ne,oe){for(;Z.nextField()&&!Z.isEndGroup();){var ie=Z.getFieldNumber();ie==1?ne=_.call(Z):ie==2&&(X.valueCtor_?(jspb.asserts.assert(te),oe||(oe=new X.valueCtor_),K.call(Z,oe,te)):oe=K.call(Z))}jspb.asserts.assert(ne!=null),jspb.asserts.assert(oe!=null),X.set(ne,oe)},goog.exportProperty(jspb.Map,"deserializeBinary",jspb.Map.deserializeBinary),jspb.Map.prototype.stringKeys_=function(){var X,Z=this.map_,_=[];for(X in Z)Object.prototype.hasOwnProperty.call(Z,X)&&_.push(X);return _},jspb.Map.Entry_=function(X,Z){this.key=X,this.value=Z,this.valueWrapper=void 0},jspb.ExtensionFieldInfo=function(X,Z,_,K,te){this.fieldIndex=X,this.fieldName=Z,this.ctor=_,this.toObjectFn=K,this.isRepeated=te},goog.exportSymbol("jspb.ExtensionFieldInfo",jspb.ExtensionFieldInfo),jspb.ExtensionFieldBinaryInfo=function(X,Z,_,K,te,ne){this.fieldInfo=X,this.binaryReaderFn=Z,this.binaryWriterFn=_,this.binaryMessageSerializeFn=K,this.binaryMessageDeserializeFn=te,this.isPacked=ne},goog.exportSymbol("jspb.ExtensionFieldBinaryInfo",jspb.ExtensionFieldBinaryInfo),jspb.ExtensionFieldInfo.prototype.isMessageType=function(){return!!this.ctor},goog.exportProperty(jspb.ExtensionFieldInfo.prototype,"isMessageType",jspb.ExtensionFieldInfo.prototype.isMessageType),jspb.Message=function(){},goog.exportSymbol("jspb.Message",jspb.Message),jspb.Message.GENERATE_TO_OBJECT=!0,goog.exportProperty(jspb.Message,"GENERATE_TO_OBJECT",jspb.Message.GENERATE_TO_OBJECT),jspb.Message.GENERATE_FROM_OBJECT=!goog.DISALLOW_TEST_ONLY_CODE,goog.exportProperty(jspb.Message,"GENERATE_FROM_OBJECT",jspb.Message.GENERATE_FROM_OBJECT),jspb.Message.GENERATE_TO_STRING=!0,jspb.Message.ASSUME_LOCAL_ARRAYS=!1,jspb.Message.SERIALIZE_EMPTY_TRAILING_FIELDS=!0,jspb.Message.SUPPORTS_UINT8ARRAY_=typeof Uint8Array=="function",jspb.Message.prototype.getJsPbMessageId=function(){return this.messageId_},goog.exportProperty(jspb.Message.prototype,"getJsPbMessageId",jspb.Message.prototype.getJsPbMessageId),jspb.Message.getIndex_=function(X,Z){return Z+X.arrayIndexOffset_},jspb.Message.hiddenES6Property_=function(){},jspb.Message.getFieldNumber_=function(X,Z){return Z-X.arrayIndexOffset_},jspb.Message.initialize=function(X,Z,_,K,te,ne){if(X.wrappers_=null,Z||(Z=_?[_]:[]),X.messageId_=_?String(_):void 0,X.arrayIndexOffset_=_===0?-1:0,X.array=Z,jspb.Message.initPivotAndExtensionObject_(X,K),X.convertedPrimitiveFields_={},jspb.Message.SERIALIZE_EMPTY_TRAILING_FIELDS||(X.repeatedFields=te),te)for(Z=0;Z<te.length;Z++)(_=te[Z])<X.pivot_?(_=jspb.Message.getIndex_(X,_),X.array[_]=X.array[_]||jspb.Message.EMPTY_LIST_SENTINEL_):(jspb.Message.maybeInitEmptyExtensionObject_(X),X.extensionObject_[_]=X.extensionObject_[_]||jspb.Message.EMPTY_LIST_SENTINEL_);if(ne&&ne.length)for(Z=0;Z<ne.length;Z++)jspb.Message.computeOneofCase(X,ne[Z])},goog.exportProperty(jspb.Message,"initialize",jspb.Message.initialize),jspb.Message.EMPTY_LIST_SENTINEL_=goog.DEBUG&&Object.freeze?Object.freeze([]):[],jspb.Message.isArray_=function(X){return jspb.Message.ASSUME_LOCAL_ARRAYS?X instanceof Array:Array.isArray(X)},jspb.Message.isExtensionObject_=function(X){return!(X===null||typeof X!="object"||jspb.Message.isArray_(X)||jspb.Message.SUPPORTS_UINT8ARRAY_&&X instanceof Uint8Array)},jspb.Message.initPivotAndExtensionObject_=function(X,Z){var _=X.array.length,K=-1;if(_&&(K=_-1,_=X.array[K],jspb.Message.isExtensionObject_(_)))return X.pivot_=jspb.Message.getFieldNumber_(X,K),void(X.extensionObject_=_);-1<Z?(X.pivot_=Math.max(Z,jspb.Message.getFieldNumber_(X,K+1)),X.extensionObject_=null):X.pivot_=Number.MAX_VALUE},jspb.Message.maybeInitEmptyExtensionObject_=function(X){var Z=jspb.Message.getIndex_(X,X.pivot_);X.array[Z]||(X.extensionObject_=X.array[Z]={})},jspb.Message.toObjectList=function(X,Z,_){for(var K=[],te=0;te<X.length;te++)K[te]=Z.call(X[te],_,X[te]);return K},goog.exportProperty(jspb.Message,"toObjectList",jspb.Message.toObjectList),jspb.Message.toObjectExtension=function(X,Z,_,K,te){for(var ne in _){var oe=_[ne],ie=K.call(X,oe);if(ie!=null){for(var se in oe.fieldName)if(oe.fieldName.hasOwnProperty(se))break;Z[se]=oe.toObjectFn?oe.isRepeated?jspb.Message.toObjectList(ie,oe.toObjectFn,te):oe.toObjectFn(te,ie):ie}}},goog.exportProperty(jspb.Message,"toObjectExtension",jspb.Message.toObjectExtension),jspb.Message.serializeBinaryExtensions=function(X,Z,_,K){for(var te in _){var ne=_[te],oe=ne.fieldInfo;if(!ne.binaryWriterFn)throw Error("Message extension present that was generated without binary serialization support");var ie=K.call(X,oe);if(ie!=null)if(oe.isMessageType()){if(!ne.binaryMessageSerializeFn)throw Error("Message extension present holding submessage without binary support enabled, and message is being serialized to binary format");ne.binaryWriterFn.call(Z,oe.fieldIndex,ie,ne.binaryMessageSerializeFn)}else ne.binaryWriterFn.call(Z,oe.fieldIndex,ie)}},goog.exportProperty(jspb.Message,"serializeBinaryExtensions",jspb.Message.serializeBinaryExtensions),jspb.Message.readBinaryExtension=function(X,Z,_,K,te){var ne=_[Z.getFieldNumber()];if(ne){if(_=ne.fieldInfo,!ne.binaryReaderFn)throw Error("Deserializing extension whose generated code does not support binary format");if(_.isMessageType()){var oe=new _.ctor;ne.binaryReaderFn.call(Z,oe,ne.binaryMessageDeserializeFn)}else oe=ne.binaryReaderFn.call(Z);_.isRepeated&&!ne.isPacked?(Z=K.call(X,_))?Z.push(oe):te.call(X,_,[oe]):te.call(X,_,oe)}else Z.skipField()},goog.exportProperty(jspb.Message,"readBinaryExtension",jspb.Message.readBinaryExtension),jspb.Message.getField=function(X,Z){if(Z<X.pivot_){Z=jspb.Message.getIndex_(X,Z);var _=X.array[Z];return _===jspb.Message.EMPTY_LIST_SENTINEL_?X.array[Z]=[]:_}if(X.extensionObject_)return(_=X.extensionObject_[Z])===jspb.Message.EMPTY_LIST_SENTINEL_?X.extensionObject_[Z]=[]:_},goog.exportProperty(jspb.Message,"getField",jspb.Message.getField),jspb.Message.getRepeatedField=function(X,Z){return jspb.Message.getField(X,Z)},goog.exportProperty(jspb.Message,"getRepeatedField",jspb.Message.getRepeatedField),jspb.Message.getOptionalFloatingPointField=function(X,Z){return(X=jspb.Message.getField(X,Z))==null?X:+X},goog.exportProperty(jspb.Message,"getOptionalFloatingPointField",jspb.Message.getOptionalFloatingPointField),jspb.Message.getBooleanField=function(X,Z){return(X=jspb.Message.getField(X,Z))==null?X:!!X},goog.exportProperty(jspb.Message,"getBooleanField",jspb.Message.getBooleanField),jspb.Message.getRepeatedFloatingPointField=function(X,Z){var _=jspb.Message.getRepeatedField(X,Z);if(X.convertedPrimitiveFields_||(X.convertedPrimitiveFields_={}),!X.convertedPrimitiveFields_[Z]){for(var K=0;K<_.length;K++)_[K]=+_[K];X.convertedPrimitiveFields_[Z]=!0}return _},goog.exportProperty(jspb.Message,"getRepeatedFloatingPointField",jspb.Message.getRepeatedFloatingPointField),jspb.Message.getRepeatedBooleanField=function(X,Z){var _=jspb.Message.getRepeatedField(X,Z);if(X.convertedPrimitiveFields_||(X.convertedPrimitiveFields_={}),!X.convertedPrimitiveFields_[Z]){for(var K=0;K<_.length;K++)_[K]=!!_[K];X.convertedPrimitiveFields_[Z]=!0}return _},goog.exportProperty(jspb.Message,"getRepeatedBooleanField",jspb.Message.getRepeatedBooleanField),jspb.Message.bytesAsB64=function(X){return X==null||typeof X=="string"?X:jspb.Message.SUPPORTS_UINT8ARRAY_&&X instanceof Uint8Array?goog.crypt.base64.encodeByteArray(X):(jspb.asserts.fail("Cannot coerce to b64 string: "+goog.typeOf(X)),null)},goog.exportProperty(jspb.Message,"bytesAsB64",jspb.Message.bytesAsB64),jspb.Message.bytesAsU8=function(X){return X==null||X instanceof Uint8Array?X:typeof X=="string"?goog.crypt.base64.decodeStringToUint8Array(X):(jspb.asserts.fail("Cannot coerce to Uint8Array: "+goog.typeOf(X)),null)},goog.exportProperty(jspb.Message,"bytesAsU8",jspb.Message.bytesAsU8),jspb.Message.bytesListAsB64=function(X){return jspb.Message.assertConsistentTypes_(X),X.length&&typeof X[0]!="string"?goog.array.map(X,jspb.Message.bytesAsB64):X},goog.exportProperty(jspb.Message,"bytesListAsB64",jspb.Message.bytesListAsB64),jspb.Message.bytesListAsU8=function(X){return jspb.Message.assertConsistentTypes_(X),!X.length||X[0]instanceof Uint8Array?X:goog.array.map(X,jspb.Message.bytesAsU8)},goog.exportProperty(jspb.Message,"bytesListAsU8",jspb.Message.bytesListAsU8),jspb.Message.assertConsistentTypes_=function(X){if(goog.DEBUG&&X&&1<X.length){var Z=goog.typeOf(X[0]);goog.array.forEach(X,function(_){goog.typeOf(_)!=Z&&jspb.asserts.fail("Inconsistent type in JSPB repeated field array. Got "+goog.typeOf(_)+" expected "+Z)})}},jspb.Message.getFieldWithDefault=function(X,Z,_){return(X=jspb.Message.getField(X,Z))==null?_:X},goog.exportProperty(jspb.Message,"getFieldWithDefault",jspb.Message.getFieldWithDefault),jspb.Message.getBooleanFieldWithDefault=function(X,Z,_){return(X=jspb.Message.getBooleanField(X,Z))==null?_:X},goog.exportProperty(jspb.Message,"getBooleanFieldWithDefault",jspb.Message.getBooleanFieldWithDefault),jspb.Message.getFloatingPointFieldWithDefault=function(X,Z,_){return(X=jspb.Message.getOptionalFloatingPointField(X,Z))==null?_:X},goog.exportProperty(jspb.Message,"getFloatingPointFieldWithDefault",jspb.Message.getFloatingPointFieldWithDefault),jspb.Message.getFieldProto3=jspb.Message.getFieldWithDefault,goog.exportProperty(jspb.Message,"getFieldProto3",jspb.Message.getFieldProto3),jspb.Message.getMapField=function(X,Z,_,K){if(X.wrappers_||(X.wrappers_={}),Z in X.wrappers_)return X.wrappers_[Z];var te=jspb.Message.getField(X,Z);if(!te){if(_)return;te=[],jspb.Message.setField(X,Z,te)}return X.wrappers_[Z]=new jspb.Map(te,K)},goog.exportProperty(jspb.Message,"getMapField",jspb.Message.getMapField),jspb.Message.setField=function(X,Z,_){return jspb.asserts.assertInstanceof(X,jspb.Message),Z<X.pivot_?X.array[jspb.Message.getIndex_(X,Z)]=_:(jspb.Message.maybeInitEmptyExtensionObject_(X),X.extensionObject_[Z]=_),X},goog.exportProperty(jspb.Message,"setField",jspb.Message.setField),jspb.Message.setProto3IntField=function(X,Z,_){return jspb.Message.setFieldIgnoringDefault_(X,Z,_,0)},goog.exportProperty(jspb.Message,"setProto3IntField",jspb.Message.setProto3IntField),jspb.Message.setProto3FloatField=function(X,Z,_){return jspb.Message.setFieldIgnoringDefault_(X,Z,_,0)},goog.exportProperty(jspb.Message,"setProto3FloatField",jspb.Message.setProto3FloatField),jspb.Message.setProto3BooleanField=function(X,Z,_){return jspb.Message.setFieldIgnoringDefault_(X,Z,_,!1)},goog.exportProperty(jspb.Message,"setProto3BooleanField",jspb.Message.setProto3BooleanField),jspb.Message.setProto3StringField=function(X,Z,_){return jspb.Message.setFieldIgnoringDefault_(X,Z,_,"")},goog.exportProperty(jspb.Message,"setProto3StringField",jspb.Message.setProto3StringField),jspb.Message.setProto3BytesField=function(X,Z,_){return jspb.Message.setFieldIgnoringDefault_(X,Z,_,"")},goog.exportProperty(jspb.Message,"setProto3BytesField",jspb.Message.setProto3BytesField),jspb.Message.setProto3EnumField=function(X,Z,_){return jspb.Message.setFieldIgnoringDefault_(X,Z,_,0)},goog.exportProperty(jspb.Message,"setProto3EnumField",jspb.Message.setProto3EnumField),jspb.Message.setProto3StringIntField=function(X,Z,_){return jspb.Message.setFieldIgnoringDefault_(X,Z,_,"0")},goog.exportProperty(jspb.Message,"setProto3StringIntField",jspb.Message.setProto3StringIntField),jspb.Message.setFieldIgnoringDefault_=function(X,Z,_,K){return jspb.asserts.assertInstanceof(X,jspb.Message),_!==K?jspb.Message.setField(X,Z,_):Z<X.pivot_?X.array[jspb.Message.getIndex_(X,Z)]=null:(jspb.Message.maybeInitEmptyExtensionObject_(X),delete X.extensionObject_[Z]),X},jspb.Message.addToRepeatedField=function(X,Z,_,K){return jspb.asserts.assertInstanceof(X,jspb.Message),Z=jspb.Message.getRepeatedField(X,Z),K!=null?Z.splice(K,0,_):Z.push(_),X},goog.exportProperty(jspb.Message,"addToRepeatedField",jspb.Message.addToRepeatedField),jspb.Message.setOneofField=function(X,Z,_,K){return jspb.asserts.assertInstanceof(X,jspb.Message),(_=jspb.Message.computeOneofCase(X,_))&&_!==Z&&K!==void 0&&(X.wrappers_&&_ in X.wrappers_&&(X.wrappers_[_]=void 0),jspb.Message.setField(X,_,void 0)),jspb.Message.setField(X,Z,K)},goog.exportProperty(jspb.Message,"setOneofField",jspb.Message.setOneofField),jspb.Message.computeOneofCase=function(X,Z){for(var _,K,te=0;te<Z.length;te++){var ne=Z[te],oe=jspb.Message.getField(X,ne);oe!=null&&(_=ne,K=oe,jspb.Message.setField(X,ne,void 0))}return _?(jspb.Message.setField(X,_,K),_):0},goog.exportProperty(jspb.Message,"computeOneofCase",jspb.Message.computeOneofCase),jspb.Message.getWrapperField=function(X,Z,_,K){if(X.wrappers_||(X.wrappers_={}),!X.wrappers_[_]){var te=jspb.Message.getField(X,_);(K||te)&&(X.wrappers_[_]=new Z(te))}return X.wrappers_[_]},goog.exportProperty(jspb.Message,"getWrapperField",jspb.Message.getWrapperField),jspb.Message.getRepeatedWrapperField=function(X,Z,_){return jspb.Message.wrapRepeatedField_(X,Z,_),(Z=X.wrappers_[_])==jspb.Message.EMPTY_LIST_SENTINEL_&&(Z=X.wrappers_[_]=[]),Z},goog.exportProperty(jspb.Message,"getRepeatedWrapperField",jspb.Message.getRepeatedWrapperField),jspb.Message.wrapRepeatedField_=function(X,Z,_){if(X.wrappers_||(X.wrappers_={}),!X.wrappers_[_]){for(var K=jspb.Message.getRepeatedField(X,_),te=[],ne=0;ne<K.length;ne++)te[ne]=new Z(K[ne]);X.wrappers_[_]=te}},jspb.Message.setWrapperField=function(X,Z,_){jspb.asserts.assertInstanceof(X,jspb.Message),X.wrappers_||(X.wrappers_={});var K=_&&_.toArray();return X.wrappers_[Z]=_,jspb.Message.setField(X,Z,K)},goog.exportProperty(jspb.Message,"setWrapperField",jspb.Message.setWrapperField),jspb.Message.setOneofWrapperField=function(X,Z,_,K){jspb.asserts.assertInstanceof(X,jspb.Message),X.wrappers_||(X.wrappers_={});var te=K&&K.toArray();return X.wrappers_[Z]=K,jspb.Message.setOneofField(X,Z,_,te)},goog.exportProperty(jspb.Message,"setOneofWrapperField",jspb.Message.setOneofWrapperField),jspb.Message.setRepeatedWrapperField=function(X,Z,_){jspb.asserts.assertInstanceof(X,jspb.Message),X.wrappers_||(X.wrappers_={}),_=_||[];for(var K=[],te=0;te<_.length;te++)K[te]=_[te].toArray();return X.wrappers_[Z]=_,jspb.Message.setField(X,Z,K)},goog.exportProperty(jspb.Message,"setRepeatedWrapperField",jspb.Message.setRepeatedWrapperField),jspb.Message.addToRepeatedWrapperField=function(X,Z,_,K,te){jspb.Message.wrapRepeatedField_(X,K,Z);var ne=X.wrappers_[Z];return ne||(ne=X.wrappers_[Z]=[]),_=_||new K,X=jspb.Message.getRepeatedField(X,Z),te!=null?(ne.splice(te,0,_),X.splice(te,0,_.toArray())):(ne.push(_),X.push(_.toArray())),_},goog.exportProperty(jspb.Message,"addToRepeatedWrapperField",jspb.Message.addToRepeatedWrapperField),jspb.Message.toMap=function(X,Z,_,K){for(var te={},ne=0;ne<X.length;ne++)te[Z.call(X[ne])]=_?_.call(X[ne],K,X[ne]):X[ne];return te},goog.exportProperty(jspb.Message,"toMap",jspb.Message.toMap),jspb.Message.prototype.syncMapFields_=function(){if(this.wrappers_)for(var X in this.wrappers_){var Z=this.wrappers_[X];if(Array.isArray(Z))for(var _=0;_<Z.length;_++)Z[_]&&Z[_].toArray();else Z&&Z.toArray()}},jspb.Message.prototype.toArray=function(){return this.syncMapFields_(),this.array},goog.exportProperty(jspb.Message.prototype,"toArray",jspb.Message.prototype.toArray),jspb.Message.GENERATE_TO_STRING&&(jspb.Message.prototype.toString=function(){return this.syncMapFields_(),this.array.toString()}),jspb.Message.prototype.getExtension=function(X){if(this.extensionObject_){this.wrappers_||(this.wrappers_={});var Z=X.fieldIndex;if(X.isRepeated){if(X.isMessageType())return this.wrappers_[Z]||(this.wrappers_[Z]=goog.array.map(this.extensionObject_[Z]||[],function(_){return new X.ctor(_)})),this.wrappers_[Z]}else if(X.isMessageType())return!this.wrappers_[Z]&&this.extensionObject_[Z]&&(this.wrappers_[Z]=new X.ctor(this.extensionObject_[Z])),this.wrappers_[Z];return this.extensionObject_[Z]}},goog.exportProperty(jspb.Message.prototype,"getExtension",jspb.Message.prototype.getExtension),jspb.Message.prototype.setExtension=function(X,Z){this.wrappers_||(this.wrappers_={}),jspb.Message.maybeInitEmptyExtensionObject_(this);var _=X.fieldIndex;return X.isRepeated?(Z=Z||[],X.isMessageType()?(this.wrappers_[_]=Z,this.extensionObject_[_]=goog.array.map(Z,function(K){return K.toArray()})):this.extensionObject_[_]=Z):X.isMessageType()?(this.wrappers_[_]=Z,this.extensionObject_[_]=Z&&Z.toArray()):this.extensionObject_[_]=Z,this},goog.exportProperty(jspb.Message.prototype,"setExtension",jspb.Message.prototype.setExtension),jspb.Message.difference=function(X,Z){if(!(X instanceof Z.constructor))throw Error("Messages have different types.");var _=X.toArray();Z=Z.toArray();var K=[],te=0,ne=_.length>Z.length?_.length:Z.length;for(X.getJsPbMessageId()&&(K[0]=X.getJsPbMessageId(),te=1);te<ne;te++)jspb.Message.compareFields(_[te],Z[te])||(K[te]=Z[te]);return new X.constructor(K)},goog.exportProperty(jspb.Message,"difference",jspb.Message.difference),jspb.Message.equals=function(X,Z){return X==Z||!(!X||!Z)&&X instanceof Z.constructor&&jspb.Message.compareFields(X.toArray(),Z.toArray())},goog.exportProperty(jspb.Message,"equals",jspb.Message.equals),jspb.Message.compareExtensions=function(X,Z){X=X||{},Z=Z||{};var _,K={};for(_ in X)K[_]=0;for(_ in Z)K[_]=0;for(_ in K)if(!jspb.Message.compareFields(X[_],Z[_]))return!1;return!0},goog.exportProperty(jspb.Message,"compareExtensions",jspb.Message.compareExtensions),jspb.Message.compareFields=function(X,Z){if(X==Z)return!0;if(!goog.isObject(X)||!goog.isObject(Z))return!!(typeof X=="number"&&isNaN(X)||typeof Z=="number"&&isNaN(Z))&&String(X)==String(Z);if(X.constructor!=Z.constructor)return!1;if(jspb.Message.SUPPORTS_UINT8ARRAY_&&X.constructor===Uint8Array){if(X.length!=Z.length)return!1;for(var _=0;_<X.length;_++)if(X[_]!=Z[_])return!1;return!0}if(X.constructor===Array){var K=void 0,te=void 0,ne=Math.max(X.length,Z.length);for(_=0;_<ne;_++){var oe=X[_],ie=Z[_];if(oe&&oe.constructor==Object&&(jspb.asserts.assert(K===void 0),jspb.asserts.assert(_===X.length-1),K=oe,oe=void 0),ie&&ie.constructor==Object&&(jspb.asserts.assert(te===void 0),jspb.asserts.assert(_===Z.length-1),te=ie,ie=void 0),!jspb.Message.compareFields(oe,ie))return!1}return!K&&!te||(K=K||{},te=te||{},jspb.Message.compareExtensions(K,te))}if(X.constructor===Object)return jspb.Message.compareExtensions(X,Z);throw Error("Invalid type in JSPB array")},goog.exportProperty(jspb.Message,"compareFields",jspb.Message.compareFields),jspb.Message.prototype.cloneMessage=function(){return jspb.Message.cloneMessage(this)},goog.exportProperty(jspb.Message.prototype,"cloneMessage",jspb.Message.prototype.cloneMessage),jspb.Message.prototype.clone=function(){return jspb.Message.cloneMessage(this)},goog.exportProperty(jspb.Message.prototype,"clone",jspb.Message.prototype.clone),jspb.Message.clone=function(X){return jspb.Message.cloneMessage(X)},goog.exportProperty(jspb.Message,"clone",jspb.Message.clone),jspb.Message.cloneMessage=function(X){return new X.constructor(jspb.Message.clone_(X.toArray()))},jspb.Message.copyInto=function(X,Z){jspb.asserts.assertInstanceof(X,jspb.Message),jspb.asserts.assertInstanceof(Z,jspb.Message),jspb.asserts.assert(X.constructor==Z.constructor,"Copy source and target message should have the same type."),X=jspb.Message.clone(X);for(var _=Z.toArray(),K=X.toArray(),te=_.length=0;te<K.length;te++)_[te]=K[te];Z.wrappers_=X.wrappers_,Z.extensionObject_=X.extensionObject_},goog.exportProperty(jspb.Message,"copyInto",jspb.Message.copyInto),jspb.Message.clone_=function(X){if(Array.isArray(X)){for(var Z=Array(X.length),_=0;_<X.length;_++){var K=X[_];K!=null&&(Z[_]=typeof K=="object"?jspb.Message.clone_(jspb.asserts.assert(K)):K)}return Z}if(jspb.Message.SUPPORTS_UINT8ARRAY_&&X instanceof Uint8Array)return new Uint8Array(X);for(_ in Z={},X)(K=X[_])!=null&&(Z[_]=typeof K=="object"?jspb.Message.clone_(jspb.asserts.assert(K)):K);return Z},jspb.Message.registerMessageType=function(X,Z){Z.messageId=X},goog.exportProperty(jspb.Message,"registerMessageType",jspb.Message.registerMessageType),jspb.Message.messageSetExtensions={},jspb.Message.messageSetExtensionsBinary={},jspb.Export={},exports.Map=jspb.Map,exports.Message=jspb.Message,exports.BinaryReader=jspb.BinaryReader,exports.BinaryWriter=jspb.BinaryWriter,exports.ExtensionFieldInfo=jspb.ExtensionFieldInfo,exports.ExtensionFieldBinaryInfo=jspb.ExtensionFieldBinaryInfo,exports.exportSymbol=goog.exportSymbol,exports.inherits=goog.inherits,exports.object={extend:goog.object.extend},exports.typeOf=goog.typeOf}},__webpack_module_cache__={};function __webpack_require__(X){var Z=__webpack_module_cache__[X];if(Z!==void 0)return Z.exports;var _=__webpack_module_cache__[X]={exports:{}};return __webpack_modules__[X].call(_.exports,_,_.exports,__webpack_require__),_.exports}__webpack_require__.d=(X,Z)=>{for(var _ in Z)__webpack_require__.o(Z,_)&&!__webpack_require__.o(X,_)&&Object.defineProperty(X,_,{enumerable:!0,get:Z[_]})},__webpack_require__.g=function(){if(typeof globalThis=="object")return globalThis;try{return this||new Function("return this")()}catch{if(typeof window=="object")return window}}(),__webpack_require__.o=(X,Z)=>Object.prototype.hasOwnProperty.call(X,Z),__webpack_require__.r=X=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(X,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(X,"__esModule",{value:!0})};var __webpack_exports__={};return(()=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{ConvaiClient:()=>Xe,narrativeDesign:()=>X});var X={};__webpack_require__.r(X),__webpack_require__.d(X,{createSection:()=>me,createTrigger:()=>Ee,deleteSection:()=>Re,deleteTrigger:()=>Ze,editSection:()=>ye,getSection:()=>ve,getTrigger:()=>Ve,listSection:()=>Be,listTriggers:()=>_e,updateTrigger:()=>We});class Z{constructor(He){this.audioContext=null,this.sourceNode=null,this.audioQueue=[],this.gainNode=null,this.isMuted=!1,this.isPlaying=!1,this.isPaused=!1,this.pausedAt=0,this.startTime=0,this.currentBuffer=null,this.preloading=!1,this.channels=1,this.onPlay=null,this.onStop=null,this.onStateChangeCallback=null,this.sampleRate=He}initializeAudioContext(){try{this.audioContext=new(window.AudioContext||window.webkitAudioContext||window.mozAudioContext||window.oAudioContext||window.msAudioContext),this.gainNode=this.audioContext.createGain()}catch{alert("Web Audio API is not supported in this browser")}}preload(){this.preloading=!0}addChunk(He,Ke=null){if(this.audioContext?this.audioContext.state==="suspended"&&this.audioContext.resume():this.initializeAudioContext(),He!=null){this.sampleRate=Ke||this.sampleRate;const Ue=He.slice(44);this.audioQueue.push(Ue)}else this.audioQueue.push(null);this.preloading||this.isPlaying||this.isPaused||this.playNextChunk()}playAudio(){this.preloading&&(this.preloading=!1,this.isPlaying||this.isPaused||this.playNextChunk())}playNextChunk(){if(!this.audioContext)return;if(this.audioQueue.length===0)return this.isPlaying=!1,void this.notifyStateChange("stopped");const He=this.audioQueue.shift();if(this.pausedAt=0,He!==null){if(!(He.length<=0)){this.currentBuffer=this.audioContext.createBuffer(this.channels,He.length/(2*this.channels),this.sampleRate);for(let Ke=0;Ke<this.channels;Ke++){const Ue=this.currentBuffer.getChannelData(Ke);for(let tt=0;tt<Ue.length;tt++){const rt=He[2*tt],at=He[2*tt+1]<<8|rt,Oe=at>=32768?(at-65536)/32768:at/32767;Ue[tt]=Oe}}this.playBuffer(this.currentBuffer)}}else this.stopAudio()}playBuffer(He){this.audioContext&&this.gainNode&&(this.sourceNode=this.audioContext.createBufferSource(),this.sourceNode.buffer=He,this.sourceNode.connect(this.gainNode).connect(this.audioContext.destination),this.sourceNode.onended=()=>{var Ke;this.isPaused||((Ke=this.sourceNode)===null||Ke===void 0||Ke.disconnect(),this.sourceNode=null,this.playNextChunk())},this.sourceNode.start(0,this.pausedAt),this.startTime=this.audioContext.currentTime-this.pausedAt,this.isPlaying=!0,this.isPaused=!1,this.notifyStateChange("playing"),this.onPlay&&this.onPlay())}pauseAudio(){var He;if(this.isPlaying&&!this.isPaused){const Ke=this.audioContext.currentTime;this.pausedAt+=Ke-this.startTime,(He=this.sourceNode)===null||He===void 0||He.stop(),this.isPaused=!0,this.isPlaying=!1,this.notifyStateChange("paused")}}resumeAudio(){this.isPaused&&this.currentBuffer&&(this.playBuffer(this.currentBuffer),this.notifyStateChange("resumed"))}stopAudio(){var He;(this.isPlaying||this.isPaused)&&((He=this.sourceNode)===null||He===void 0||He.stop(),this.isPlaying=!1,this.isPaused=!1,this.pausedAt=0,this.startTime=0,this.notifyStateChange("stopped"),this.onStop&&this.onStop(),this.audioQueue=[])}notifyStateChange(He){this.onStateChangeCallback&&this.onStateChangeCallback(He)}getVolume(){return this.isMuted?0:1}setAudioVolume(He){if(this.gainNode){if(He<0||He>1)throw new Error("Invalid volume value. Volume must be between 0 and 1.");this.gainNode.gain.value=He,this.isMuted=He===0}}onPlayStart(He){this.onPlay=He}onPlayStop(He){this.onStop=He}onStateChange(He){this.onStateChangeCallback=He}}class _{constructor(){var He,Ke;this.audioContext=new AudioContext;let Ue=new Blob([`class AudioRecorderProcessor extends AudioWorkletProcessor {
  constructor() {
    super();
    this.recording = false;
    this.chunkSize = 4096;
    this.sampleAccumulator = new Float32Array(this.chunkSize);
    this.accumulatedSamples = 0;
    this.port.onmessage = (event) => {
      if (!event.data.command) {
        return;
      }
      if (event.data.command === 'start') {
        this.recording = true;
      } else if (event.data.command === 'stop') {
        this.recording = false;
      }
    };
  }

  process(inputs, outputs) {
    if (!this.recording) {
      return true;
    }
    const input = inputs[0];
    const output = outputs[0];
    // output[0].set(input[0]);
    for (let i = 0; i < input[0].length; i++) {
      this.sampleAccumulator[this.accumulatedSamples++] = input[0][i];
      if (this.accumulatedSamples >= this.chunkSize) {
        this.port.postMessage(this.sampleAccumulator.buffer);
        this.sampleAccumulator = new Float32Array(this.chunkSize);
        this.accumulatedSamples = 0;
      }
    }
    return true;
  }
}

registerProcessor('audio-recorder-processor', AudioRecorderProcessor);`],{type:"application/javascript"});this.audioWorkletModule=(Ke=(He=this.audioContext)===null||He===void 0?void 0:He.audioWorklet)===null||Ke===void 0?void 0:Ke.addModule(URL.createObjectURL(Ue)),this.mediaStream=null,this.workletNode=null,navigator.mediaDevices&&navigator.mediaDevices.getUserMedia&&this.getMicrophoneAccess()}convertoFloat32ToInt16(He){for(var Ke=He.length,Ue=new Int16Array(Ke);Ke--;)Ue[Ke]=65535*He[Ke];return Ue.buffer}start(He){this.audioCallback=He,this.mediaStream||this.getMicrophoneAccess(),this.userMedia.then(Ke=>{this.mediaStream=Ke,this.audioWorkletModule.then(()=>{const Ue=this.audioContext.createMediaStreamSource(this.mediaStream);this.workletNode=new AudioWorkletNode(this.audioContext,"audio-recorder-processor"),this.workletNode.port.onmessage=tt=>{if(tt.data.command)return;const rt=new Float32Array(tt.data),at=this.convertoFloat32ToInt16(rt);this.audioCallback(at)},Ue.connect(this.workletNode),this.audioContext.resume(),this.workletNode.port.postMessage({command:"start"})})})}stop(){this.workletNode&&(this.workletNode.port.postMessage({command:"stop"}),this.workletNode.disconnect(),this.workletNode=null)}removeMicrophoneAccess(){this.mediaStream&&(this.mediaStream.getTracks().forEach(He=>{He.stop()}),this.mediaStream=null)}getMicrophoneAccess(){this.userMedia=navigator.mediaDevices.getUserMedia({audio:!0})}}var K=__webpack_require__(553),te=__webpack_require__(820),ne=__webpack_require__(48);const oe="https://webstream.convai.com",ie=new K.grpc.Metadata;ie.set("source","Web3D");class se{constructor(He,Ke,Ue,tt,rt,at,Oe,$e,je=!1,Te=!1,De=3,ot,ct=null){this.apiKey=He,this.characterId=Ke,this.speaker=Ue,this.speakerId=tt,this.sessionId=rt,this.languageCode=$e,this.disableAudioGeneration=je,this.enableFacialData=Te,this.faceModel=De,this.narrativeTemplateKeysMap=ot,this.actionConfigParams=ct,this.client=K.grpc.client(te.C.GetResponse,{host:oe,transport:K.grpc.WebsocketTransport()}),this.feedbackClient=K.grpc.client(te.C.SubmitFeedback,{host:oe,transport:K.grpc.WebsocketTransport()}),this.client.onMessage(gt=>{at(gt)}),this.client.onEnd((gt,pt,ht)=>{gt!=K.grpc.Code.OK&&Oe("chatbotResponseError",pt,String(gt))}),this.feedbackClient.onMessage(gt=>{}),this.feedbackClient.onEnd((gt,pt,ht)=>{gt!=K.grpc.Code.OK&&Oe("feedbackResponseError",pt,String(gt))})}close(){this.isStarted&&(this.isStarted=!1,this.client.close())}invokeTrigger(He,Ke=""){if(!(He.length>0&&Ke.length>0)){this.isStarted||this.start();var Ue=new ne.GetResponseRequest,tt=new ne.GetResponseRequest.GetResponseData,rt=new ne.TriggerConfig;He||rt.setTriggerMessage(Ke),Ke||rt.setTriggerName(He),tt.setTriggerData(rt),Ue.setGetResponseData(tt),this.client.send(Ue),this.client.finishSend()}}sendFeedback(He,Ke,Ue,tt,rt){if(He){this.feedbackClient.start();var at=new ne.FeedbackRequest,Oe=new ne.FeedbackRequest.Feedback;Oe.setThumbsUp(tt),Oe.setFeedbackText(rt),at.setTextFeedback(Oe),at.setCharacterId(Ke||""),at.setInteractionId(He),at.setSessionId(Ue||""),this.feedbackClient.send(at),this.feedbackClient.finishSend()}}sendText(He){if(this.inputMode!="audio"){this.inputMode="text",this.isStarted||this.start();var Ke=new ne.GetResponseRequest,Ue=new ne.GetResponseRequest.GetResponseData;Ue.setTextData(He),Ke.setGetResponseData(Ue),this.client.send(Ke),this.client.finishSend()}}sendAudioChunk(He){if(this.inputMode!="text"){this.inputMode="audio",this.isStarted||this.start();var Ke=new ne.GetResponseRequest,Ue=new ne.GetResponseRequest.GetResponseData;Ue.setAudioData(new Uint8Array(He)),Ke.setGetResponseData(Ue),this.client.send(Ke)}}finishSend(){var He;this.isStarted&&((He=this.client)===null||He===void 0||He.finishSend())}setActionConfig(He){this.actionConfigParams&&(this.actionConfigParams.actions&&He.setActionsList(this.actionConfigParams.actions),this.actionConfigParams.characters&&this.actionConfigParams.characters.forEach(Ke=>{ne.ActionConfig.Character}),this.actionConfigParams.objects&&this.actionConfigParams.objects.forEach(Ke=>{ne.ActionConfig.Object}),this.actionConfigParams.classification&&He.setClassification(this.actionConfigParams.classification),typeof this.actionConfigParams.contextLevel=="number"&&He.setContextLevel(this.actionConfigParams.contextLevel),this.actionConfigParams.currentAttentionObject&&He.setCurrentAttentionObject(this.actionConfigParams.currentAttentionObject))}start(){var He;this.client.start(ie);var Ke=new ne.GetResponseRequest,Ue=new ne.GetResponseRequest.GetResponseConfig;Ue.setApiKey(this.apiKey),Ue.setCharacterId(this.characterId),Ue.setSessionId(this.sessionId),Ue.setLanguageCode(this.languageCode),Ue.setSpeaker(this.speaker),Ue.setSpeakerId(this.speakerId);var tt=Ue.getNarrativeTemplateKeysMap();tt&&((He=this.narrativeTemplateKeysMap)===null||He===void 0||He.forEach((Oe,$e)=>{tt.set($e,Oe)}));var rt=new ne.AudioConfig;rt.setSampleRateHertz(44100),rt.setDisableAudio(this.disableAudioGeneration),rt.setEnableFacialData(this.enableFacialData),rt.setFaceModel(this.faceModel),Ue.setAudioConfig(rt);var at=new ne.ActionConfig;this.setActionConfig(at),Ue.setActionConfig(at),Ke.setGetResponseConfig(Ue),this.client.send(Ke),this.isStarted=!0}}let ae,ge=null,ce=null;const de=Pe=>{ae=Pe},pe=Pe=>{let He=new se(ae.apiKey,ae.characterId,ae.speaker,ae.speakerId,ae.sessionId,ae.responseCallback,ae.errorCallback,ae.languageCode,ae.disableAudioGeneration,ae.enableFacialData,ae.faceModel,ae.narrativeTemplateKeysMap,ae.actionConfig);Pe===1?ce=He:ge=He},fe=Pe=>(Pe&&de(Pe),ge===null?((He=>{pe(0)})(),pe(1)):(ge=ce,pe(1)),ge);setInterval(()=>{ce!==null&&pe(1)},5e3);var be=function(Pe,He,Ke,Ue){return new(Ke||(Ke=Promise))(function(tt,rt){function at(je){try{$e(Ue.next(je))}catch(Te){rt(Te)}}function Oe(je){try{$e(Ue.throw(je))}catch(Te){rt(Te)}}function $e(je){var Te;je.done?tt(je.value):(Te=je.value,Te instanceof Ke?Te:new Ke(function(De){De(Te)})).then(at,Oe)}$e((Ue=Ue.apply(Pe,He||[])).next())})};const me=Pe=>be(void 0,[Pe],void 0,function*({objective:He,sectionName:Ke,behaviorTreeCode:Ue=null,btConstants:tt=null,apiKey:rt,characterId:at}){let Oe=fe().apiKey,$e=fe().characterId;rt&&(Oe=rt),at&&($e=at);try{const je=yield fetch("https://api.convai.com/character/narrative/create-section",{method:"POST",headers:{"CONVAI-API-KEY":Oe,"Content-Type":"application/json"},body:JSON.stringify({character_id:$e,objective:He,section_name:Ke,updated_character_data:{},behavior_tree_code:Ue,bt_constants:tt})});if(!je.ok)throw new Error(`HTTP error! status : ${je.status}`);return yield je.json()}catch(je){throw je}}),ye=Pe=>be(void 0,[Pe],void 0,function*({updatedCharacterData:He,sectionId:Ke,apiKey:Ue,characterId:tt}){let rt=fe().apiKey,at=fe().characterId;Ue&&(rt=Ue),tt&&(at=tt);try{const Oe=yield fetch("https://api.convai.com/character/narrative/edit-section",{method:"POST",headers:{"CONVAI-API-KEY":rt,"Content-Type":"application/json"},body:JSON.stringify({character_id:at,section_id:Ke,updated_data:He})});if(!Oe.ok)throw new Error(`HTTP error! status : ${Oe.status}`);return yield Oe.json()}catch(Oe){throw Oe}}),ve=Pe=>be(void 0,[Pe],void 0,function*({sectionId:He,apiKey:Ke,characterId:Ue}){let tt=fe().apiKey,rt=fe().characterId;Ke&&(tt=Ke),Ue&&(rt=Ue);try{const at=yield fetch("https://api.convai.com/character/narrative/get-section",{method:"POST",headers:{"CONVAI-API-KEY":tt,"Content-Type":"application/json"},body:JSON.stringify({character_id:rt,section_id:He})});if(!at.ok)throw new Error(`HTTP error! status : ${at.status}`);return yield at.json()}catch(at){throw at}}),Be=Pe=>be(void 0,[Pe],void 0,function*({apiKey:He,characterId:Ke}){let Ue=fe().apiKey,tt=fe().characterId;He&&(Ue=He),Ke&&(tt=Ke);try{const rt=yield fetch("https://api.convai.com/character/narrative/list-sections",{method:"POST",headers:{"CONVAI-API-KEY":Ue,"Content-Type":"application/json"},body:JSON.stringify({character_id:tt})});if(!rt.ok)throw new Error(`HTTP error! status : ${rt.status}`);return yield rt.json()}catch(rt){throw rt}}),Re=Pe=>be(void 0,[Pe],void 0,function*({sectionId:He,apiKey:Ke,characterId:Ue}){let tt=fe().apiKey,rt=fe().characterId;Ke&&(tt=Ke),Ue&&(rt=Ue);try{const at=yield fetch("https://api.convai.com/character/narrative/delete-section",{method:"POST",headers:{"CONVAI-API-KEY":tt,"Content-Type":"application/json"},body:JSON.stringify({character_id:rt,section_id:He})});if(!at.ok)throw new Error(`HTTP error! status : ${at.status}`);return yield at.json()}catch(at){throw at}}),Ee=Pe=>be(void 0,[Pe],void 0,function*({triggerName:He,triggerMessage:Ke,destinationSection:Ue,apiKey:tt,characterId:rt}){let at=fe().apiKey,Oe=fe().characterId;tt&&(at=tt),rt&&(Oe=rt);try{const $e=yield fetch("https://api.convai.com/character/narrative/create-trigger",{method:"POST",headers:{"CONVAI-API-KEY":at,"Content-Type":"application/json"},body:JSON.stringify({character_id:Oe,trigger_name:He,trigger_message:Ke,destination_section:Ue})});if(!$e.ok)throw new Error(`HTTP error! status : ${$e.status}`);return yield $e.json()}catch($e){throw $e}}),We=Pe=>be(void 0,[Pe],void 0,function*({triggerId:He,updatedTriggerData:Ke,apiKey:Ue,characterId:tt}){let rt=fe().apiKey,at=fe().characterId;Ue&&(rt=Ue),tt&&(at=tt);try{const Oe=yield fetch("https://api.convai.com/character/narrative/update-trigger",{method:"POST",headers:{"CONVAI-API-KEY":rt,"Content-Type":"application/json"},body:JSON.stringify({character_id:at,trigger_id:He,updated_data:Ke})});if(!Oe.ok)throw new Error(`HTTP error! status : ${Oe.status}`);return yield Oe.json()}catch(Oe){throw Oe}}),Ze=Pe=>be(void 0,[Pe],void 0,function*({triggerId:He,apiKey:Ke,characterId:Ue}){let tt=fe().apiKey,rt=fe().characterId;Ke&&(tt=Ke),Ue&&(rt=Ue);try{const at=yield fetch("https://api.convai.com/character/narrative/delete-trigger",{method:"POST",headers:{"CONVAI-API-KEY":tt,"Content-Type":"application/json"},body:JSON.stringify({character_id:rt,trigger_id:He})});if(!at.ok)throw new Error(`HTTP error! status : ${at.status}`);return yield at.json()}catch(at){throw at}}),Ve=Pe=>be(void 0,[Pe],void 0,function*({triggerId:He,apiKey:Ke,characterId:Ue}){let tt=fe().apiKey,rt=fe().characterId;Ke&&(tt=Ke),Ue&&(rt=Ue);try{const at=yield fetch("https://api.convai.com/character/narrative/get-trigger",{method:"POST",headers:{"CONVAI-API-KEY":tt,"Content-Type":"application/json"},body:JSON.stringify({character_id:rt,trigger_id:He})});if(!at.ok)throw new Error(`HTTP error! status : ${at.status}`);return yield at.json()}catch(at){throw at}}),_e=Pe=>be(void 0,[Pe],void 0,function*({apiKey:He,characterId:Ke}){let Ue=fe().apiKey,tt=fe().characterId;He&&(Ue=He),Ke&&(tt=Ke);try{const rt=yield fetch("https://api.convai.com/character/narrative/list-triggers",{method:"POST",headers:{"CONVAI-API-KEY":Ue,"Content-Type":"application/json"},body:JSON.stringify({character_id:tt})});if(!rt.ok)throw new Error(`HTTP error! status : ${rt.status}`);return yield rt.json()}catch(rt){throw rt}});class Xe{constructor(He){this.apiKey=He.apiKey,this.characterId=He.characterId,this.speaker=He.speaker,this.speakerId=He.speakerId,this.enableAudio=He.enableAudio,this.languageCode=He.languageCode||"en-US",this.sessionId=He.sessionId,this.disableAudioGeneration=!!He.hasOwnProperty("textOnlyResponse")&&He.textOnlyResponse,this.micUsage=!He.hasOwnProperty("micUsage")||He.micUsage,this.enableFacialData=!!He.hasOwnProperty("enableFacialData")&&He.enableFacialData,this.faceModel=He.faceModel||3,this.narrativeTemplateKeysMap=He.narrativeTemplateKeysMap,this.enableAddingChunk=this.micUsage,this.finalChunkReceived=!0,this.disableAudioGeneration&&(this.enableAudio=!1),this.actionConfig=null,this.enableAudio&&!this.disableAudioGeneration&&(this.audioPlayer=new Z(44100)),this.micUsage&&(this.audioRecorder=new _),console.warn=()=>{},this.convaiConfig={apiKey:this.apiKey,characterId:this.characterId,speaker:this.speaker,speakerId:this.speakerId,sessionId:this.sessionId,responseCallback:this.responseCallback,errorCallback:this.errorCallback,languageCode:this.languageCode,disableAudioGeneration:this.disableAudioGeneration,enableFacialData:this.enableFacialData,faceModel:this.faceModel,narrativeTemplateKeysMap:this.narrativeTemplateKeysMap,actionConfig:this.actionConfig}}validateBeforeRequest(){return this.responseCallback!=null}resetSession(){this.sessionId="-1",this.stopCharacterAudio()}setResponseCallback(He){this.responseCallback=Ke=>{var Ue,tt,rt;Ke.getSessionId()!=""&&(this.sessionId=Ke.getSessionId(),this.convaiConfig.sessionId=this.sessionId),this.enableAudio&&!this.disableAudioGeneration&&Ke.hasAudioResponse()&&(this.enableAddingChunk&&!(!((Ue=Ke.getAudioResponse())===null||Ue===void 0)&&Ue.hasVisemesData())&&Ke.getAudioResponse().getAudioData_asU8().length&&this.audioPlayer.addChunk(Ke.getAudioResponse().getAudioData_asU8(),(rt=(tt=Ke==null?void 0:Ke.getAudioResponse())===null||tt===void 0?void 0:tt.getAudioConfig())===null||rt===void 0?void 0:rt.getSampleRateHertz()),Ke.getAudioResponse().getEndOfResponse()?(this.finalChunkReceived=!0,this.audioPlayer.addChunk(null)):this.finalChunkReceived=!1),this.enableAddingChunk&&He(Ke)},this.convaiConfig.responseCallback=this.responseCallback,de(this.convaiConfig)}setErrorCallback(He){this.errorCallback=(Ke,Ue,tt)=>{if(tt!=="0")switch(tt){case"2":case"10":case"11":case"13":case"12":case"14":this.convaiGrpcClient=fe(this.convaiConfig);break;default:He(Ke,Ue,tt)}else He(Ke,Ue,tt)},this.convaiConfig.errorCallback=this.errorCallback,de(this.convaiConfig)}sendTextChunk(He){this.validateBeforeRequest()&&(this.enableAudio&&!this.disableAudioGeneration&&this.stopCharacterAudio(),de(this.convaiConfig),this.convaiGrpcClient=fe(this.convaiConfig),this.enableAudio&&!this.disableAudioGeneration&&(this.enableAddingChunk=!0,this.finalChunkReceived=!0),this.convaiGrpcClient.sendText(He))}startAudioChunk(){var He;this.validateBeforeRequest()&&this.micUsage==1&&(this.stopCharacterAudio(),de(this.convaiConfig),this.convaiGrpcClient=fe(this.convaiConfig),this.enableAddingChunk=!0,this.finalChunkReceived=!0,(He=this.audioRecorder)===null||He===void 0||He.start(Ke=>{var Ue;(Ue=this.convaiGrpcClient)===null||Ue===void 0||Ue.sendAudioChunk(Ke)}))}invokeTrigger(He,Ke=null,Ue){var tt;(He||Ke)&&this.validateBeforeRequest()&&(this.stopCharacterAudio(),de(this.convaiConfig),this.convaiGrpcClient=fe(this.convaiConfig),this.finalChunkReceived=!0,Ue&&((tt=this.audioPlayer)===null||tt===void 0||tt.preload()),this.convaiGrpcClient.invokeTrigger(He,Ke))}sendFeedback(He,Ke,Ue,tt,rt){this.validateBeforeRequest()&&(de(this.convaiConfig),this.convaiGrpcClient=fe(this.convaiConfig),this.convaiGrpcClient.sendFeedback(He,Ke,Ue,tt,rt))}endAudioChunk(){this.micUsage==1&&setTimeout(()=>{var He,Ke;(He=this.audioRecorder)===null||He===void 0||He.stop(),(Ke=this.convaiGrpcClient)===null||Ke===void 0||Ke.finishSend()},100)}toggleAudioVolume(){var He,Ke,Ue;this.enableAudio&&this.audioPlayer&&(((He=this.audioPlayer)===null||He===void 0?void 0:He.getVolume())===0?(Ke=this.audioPlayer)===null||Ke===void 0||Ke.setAudioVolume(1):(Ue=this.audioPlayer)===null||Ue===void 0||Ue.setAudioVolume(0))}getAudioVolume(){var He;if(this.audioPlayer)return(He=this.audioPlayer)===null||He===void 0?void 0:He.getVolume()}stopCharacterAudio(){var He,Ke;this.enableAudio&&((He=this.convaiGrpcClient)===null||He===void 0||He.close(),this.finalChunkReceived||(this.enableAddingChunk=!1),(Ke=this.audioPlayer)===null||Ke===void 0||Ke.stopAudio())}onAudioPlay(He){var Ke;this.enableAudio&&((Ke=this.audioPlayer)===null||Ke===void 0||Ke.onPlayStart(He))}onAudioStop(He){var Ke;this.enableAudio&&((Ke=this.audioPlayer)===null||Ke===void 0||Ke.onPlayStop(He))}pauseAudio(){var He;this.enableAudio&&((He=this.audioPlayer)===null||He===void 0||He.pauseAudio())}resumeAudio(){var He;this.enableAudio&&((He=this.audioPlayer)===null||He===void 0||He.resumeAudio())}onAudioStateChange(He){var Ke;(Ke=this.audioPlayer)===null||Ke===void 0||Ke.onStateChange(He)}playAudio(){var He;this.enableAudio&&this.audioPlayer&&((He=this.audioPlayer)===null||He===void 0||He.playAudio())}setActionConfig(He){this.convaiConfig.actionConfig=He,this.convaiGrpcClient=fe(this.convaiConfig)}}})(),__webpack_exports__})())}(convaiWebClient_umd$1)),convaiWebClient_umd$1.exports}var convaiWebClient_umdExports=requireConvaiWebClient_umd();function ChatInterface({characterId:X,setActiveScene:Z,isAvatarReady:_}){const[K,te]=reactExports.useState([]),[ne,oe]=reactExports.useState(""),[ie,se]=reactExports.useState(!1),ae=reactExports.useRef(null),ge=reactExports.useRef(null),ce=reactExports.useRef(null),de=reactExports.useRef(null),pe=reactExports.useRef(""),fe=reactExports.useRef("");reactExports.useRef(!1);const[be,me]=reactExports.useState(!0),[ye,ve]=reactExports.useState(!1),[Be,Re]=reactExports.useState(!1),[Ee,We]=reactExports.useState("");reactExports.useState("");const[Ze,Ve]=reactExports.useState(!1),[_e,Xe]=reactExports.useState(!1),[Pe,He]=reactExports.useState(""),[Ke,Ue]=reactExports.useState(!1),tt=reactExports.useRef([]),rt=reactExports.useRef(!1),at=reactExports.useRef(null),Oe=reactExports.useRef([]),$e=reactExports.useRef(null),[je,Te]=reactExports.useState(!1),De=reactExports.useRef(null),ot=reactExports.useRef(null),ct=(St,Rt)=>{var Wt,Ht,Pt;console.error(`Error in ${Rt}:`,St);let jt="Przepraszamy, wystąpił nieoczekiwany błąd. Spróbuj ponownie.";(Wt=St.message)!=null&&Wt.includes("permission")?jt="Brak dostępu do mikrofonu! Kliknij ikonę kłódki w pasku przeglądarki i zezwól na dostęp.":(Ht=St.message)!=null&&Ht.includes("network")?jt="Problem z połączeniem internetowym. Sprawdź swoje połączenie i spróbuj ponownie.":(Pt=St.message)!=null&&Pt.includes("audio")&&(jt="Problem z systemem audio. Sprawdź czy Twój mikrofon działa poprawnie."),He(jt),te(Mt=>[...Mt,{text:jt,sender:"error",timestamp:new Date().toISOString()}]),setTimeout(()=>{He("")},5e3)},gt=()=>{if(tt.current.length===0){rt.current=!1;return}if(Ke){tt.current=[],rt.current=!1;return}rt.current=!0;const St=tt.current.shift();try{de.current&&typeof de.current.playAudio=="function"?de.current.playAudio(St):gt()}catch(Rt){console.error("Błąd odtwarzania audio:",Rt),gt()}},pt=()=>{Oe.current.length>0&&(tt.current.push(...Oe.current),Oe.current=[],rt.current||gt())},ht=reactExports.useCallback(()=>{De.current&&clearTimeout(De.current),ot.current&&clearTimeout(ot.current),de.current&&(typeof de.current.destroy=="function"?de.current.destroy():typeof de.current.close=="function"&&de.current.close(),de.current=null),te([]),oe(""),se(!1),Ve(!1),Xe(!1),pe.current="",fe.current="",tt.current=[],rt.current=!1,at.current&&clearTimeout(at.current)},[]);reactExports.useEffect(()=>(ht(),X&&_&&(console.log("Initializing client for character:",X),De.current=setTimeout(()=>{At()},1e3)),ht),[X,_,ht]);const At=async()=>{if(!(!X||!_)){Te(!0);try{console.log("Creating new ConvaiClient instance");const St=new convaiWebClient_umdExports.ConvaiClient({apiKey:"2d12bd421e3af7ce47223bce45944908",characterId:X,enableAudio:!0,faceModal:3,enableFacialData:!0});ot.current=setTimeout(()=>{_e||(ct(new Error("Timeout podczas łączenia z awatarem"),"Connection Timeout"),ht())},15e3),St.setResponseCallback(Rt=>{if(ot.current&&(clearTimeout(ot.current),ot.current=null),_e||(console.log("Client connected successfully"),Xe(!0)),Rt.hasUserQuery()){const jt=Rt.getUserQuery();jt&&(pe.current+=" "+jt.getTextData(),jt.getIsFinal()&&(te(Wt=>[...Wt,{text:pe.current.trim(),sender:"user"}]),pe.current="",$e.current=Date.now()))}if(Rt.hasAudioResponse()){const jt=Rt.getAudioResponse(),Wt=jt.getTextData();if(Wt&&Wt.trim()&&(fe.current+=" "+Wt,te(Ht=>{const Pt=Ht[Ht.length-1];if((Pt==null?void 0:Pt.sender)==="bot"){const Mt=[...Ht];return Mt[Ht.length-1]={text:fe.current.trim(),sender:"bot"},Mt}return[...Ht,{text:fe.current.trim(),sender:"bot"}]}),se(!1),$e.current)){const Ht=Date.now()-$e.current;console.log(`Czas odpowiedzi: ${Ht}ms`),$e.current=null}if(jt.array&&jt.array[0]&&(Oe.current.push(jt.array[0]),at.current&&clearTimeout(at.current),at.current=setTimeout(()=>{pt()},Ke?50:200)),jt.hasVisemesData()){const Ht=jt.getVisemesData().array[0];Ht[0]!==-2&&(window.visemeData=window.visemeData||[],window.visemeData.push(Ht),window.visemeDataActive=!0,window.dispatchEvent(new Event("viseme-data-update")))}}}),St.onAudioPlay(()=>{window.dispatchEvent(new Event("avatar-talking-start"))}),St.onAudioStop(()=>{window.dispatchEvent(new Event("avatar-talking-end")),setTimeout(()=>{gt()},50)}),de.current=St,te([]),fe.current="",pe.current="",Ve(!1),Te(!1)}catch(St){console.error("Error initializing client:",St),Te(!1),ct(St,"Client Initialization"),ht()}}},Kt=async St=>{if(St==null||St.preventDefault(),!!ne.trim()){se(!0);try{if(te(Rt=>[...Rt,{text:ne,sender:"user"}]),!de.current)throw new Error("Połączenie z awatarem nie zostało ustanowione. Odśwież stronę i spróbuj ponownie.");$e.current=Date.now(),await de.current.sendTextChunk(ne),oe("")}catch(Rt){ct(Rt,"Send Text Message"),se(!1)}}},en=()=>{var St;(St=ae.current)==null||St.scrollIntoView({behavior:"smooth"})};reactExports.useEffect(()=>{en()},[K]);const Zt=async()=>{te([]),oe(""),se(!1),pe.current="",fe.current="",tt.current=[],rt.current=!1;try{de.current&&(typeof de.current.destroy=="function"?de.current.destroy():typeof de.current.close=="function"&&de.current.close(),de.current=null),await At()}catch(St){ct(St,"Refresh")}},st=()=>{me(!be)},Vt=async()=>{try{if(Be||((await navigator.mediaDevices.getUserMedia({audio:!0})).getTracks().forEach(Rt=>Rt.stop()),Re(!0)),ye)ve(!1),setTimeout(()=>{de.current&&de.current.endAudioChunk()},100);else{if(!de.current)throw new Error("Połączenie z awatarem nie zostało ustanowione. Odśwież stronę i spróbuj ponownie.");We(""),ve(!0),pe.current="",fe.current="",$e.current=Date.now(),de.current.startAudioChunk()}}catch(St){ct(St,"Microphone Access"),ve(!1),Re(!1)}};reactExports.useEffect(()=>{if(!_e||!X)return;const Rt=setTimeout(async()=>{if(de.current&&!Ze){se(!0);try{await de.current.sendTextChunk("Przywitaj się krótko i zapytaj w czym możesz pomóc"),Ve(!0)}catch(jt){ct(jt,"Automatic Greeting"),se(!1)}}},1e3);return()=>clearTimeout(Rt)},[_e,X,Ze]);const wt=()=>{Ue(!Ke),Ke||(tt.current=[],rt.current=!1)};return jsxRuntimeExports.jsx(Draggable,{nodeRef:ce,bounds:"body",cancel:".chat-input, .chat-send-button, .refresh-button",children:jsxRuntimeExports.jsxs("div",{ref:ce,className:"chat-interface",style:{height:be?"500px":"40px"},children:[jsxRuntimeExports.jsxs("div",{className:"chat-header",children:[jsxRuntimeExports.jsx("span",{children:"Chat"}),jsxRuntimeExports.jsxs("div",{className:"header-controls",children:[jsxRuntimeExports.jsx("button",{className:`fast-response-button ${Ke?"active":""}`,onClick:wt,title:Ke?"Wyłącz tryb szybkiej odpowiedzi":"Włącz tryb szybkiej odpowiedzi",children:jsxRuntimeExports.jsx(MdSpeed,{})}),jsxRuntimeExports.jsx("button",{className:"refresh-button",onClick:Zt,title:"Odśwież czat",children:jsxRuntimeExports.jsx(MdRefresh,{})}),jsxRuntimeExports.jsx("div",{className:"expand-icon-container",onClick:st,children:be?jsxRuntimeExports.jsx(MdExpandMore,{className:"expand-icon"}):jsxRuntimeExports.jsx(MdExpandLess,{className:"expand-icon"})}),jsxRuntimeExports.jsx("div",{className:"drag-handle",children:"⋮⋮"})]})]}),be&&jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsxs("div",{ref:ge,className:"chat-messages",children:[K.map((St,Rt)=>jsxRuntimeExports.jsx("div",{className:`message ${St.sender} ${St.sender==="error"?"error-message":""}`,children:St.text},Rt)),ie&&jsxRuntimeExports.jsx("div",{className:"message bot typing",children:jsxRuntimeExports.jsxs("div",{className:"typing-indicator",children:[jsxRuntimeExports.jsx("span",{}),jsxRuntimeExports.jsx("span",{}),jsxRuntimeExports.jsx("span",{})]})}),ye&&jsxRuntimeExports.jsxs("div",{className:"message user speech-preview",children:["Mów teraz...",jsxRuntimeExports.jsx("div",{className:"voice-wave"})]}),Pe&&jsxRuntimeExports.jsx("div",{className:"message error-message fade-out",children:Pe}),jsxRuntimeExports.jsx("div",{ref:ae})]}),jsxRuntimeExports.jsx("div",{className:"chat-controls",children:jsxRuntimeExports.jsxs("form",{onSubmit:Kt,className:"chat-input-form",children:[jsxRuntimeExports.jsx("button",{type:"button",className:`mic-button ${ye?"recording":""} ${Pe?"error":""}`,onClick:Vt,title:ye?"Zatrzymaj nagrywanie":"Rozpocznij nagrywanie",disabled:!!Pe,children:ye?jsxRuntimeExports.jsx(MdMicOff,{}):jsxRuntimeExports.jsx(MdMic,{})}),jsxRuntimeExports.jsx("input",{type:"text",value:ne,onChange:St=>oe(St.target.value),placeholder:"Napisz wiadomość...",className:"chat-input",disabled:!!Pe}),jsxRuntimeExports.jsx("button",{type:"submit",className:"chat-send-button",title:"Wyślij",disabled:!!Pe,children:jsxRuntimeExports.jsx(MdSend,{})})]})}),je&&jsxRuntimeExports.jsx("div",{className:"chat-loading",children:"Łączenie z awatarem..."})]})]})})}var events={exports:{}},R=typeof Reflect=="object"?Reflect:null,ReflectApply=R&&typeof R.apply=="function"?R.apply:function X(Z,_,K){return Function.prototype.apply.call(Z,_,K)},ReflectOwnKeys;R&&typeof R.ownKeys=="function"?ReflectOwnKeys=R.ownKeys:Object.getOwnPropertySymbols?ReflectOwnKeys=function(Z){return Object.getOwnPropertyNames(Z).concat(Object.getOwnPropertySymbols(Z))}:ReflectOwnKeys=function(Z){return Object.getOwnPropertyNames(Z)};function ProcessEmitWarning(X){console&&console.warn&&console.warn(X)}var NumberIsNaN=Number.isNaN||function X(Z){return Z!==Z};function EventEmitter(){EventEmitter.init.call(this)}events.exports=EventEmitter;events.exports.once=once;EventEmitter.EventEmitter=EventEmitter;EventEmitter.prototype._events=void 0;EventEmitter.prototype._eventsCount=0;EventEmitter.prototype._maxListeners=void 0;var defaultMaxListeners=10;function checkListener(X){if(typeof X!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof X)}Object.defineProperty(EventEmitter,"defaultMaxListeners",{enumerable:!0,get:function(){return defaultMaxListeners},set:function(X){if(typeof X!="number"||X<0||NumberIsNaN(X))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+X+".");defaultMaxListeners=X}});EventEmitter.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};EventEmitter.prototype.setMaxListeners=function X(Z){if(typeof Z!="number"||Z<0||NumberIsNaN(Z))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+Z+".");return this._maxListeners=Z,this};function _getMaxListeners(X){return X._maxListeners===void 0?EventEmitter.defaultMaxListeners:X._maxListeners}EventEmitter.prototype.getMaxListeners=function X(){return _getMaxListeners(this)};EventEmitter.prototype.emit=function X(Z){for(var _=[],K=1;K<arguments.length;K++)_.push(arguments[K]);var te=Z==="error",ne=this._events;if(ne!==void 0)te=te&&ne.error===void 0;else if(!te)return!1;if(te){var oe;if(_.length>0&&(oe=_[0]),oe instanceof Error)throw oe;var ie=new Error("Unhandled error."+(oe?" ("+oe.message+")":""));throw ie.context=oe,ie}var se=ne[Z];if(se===void 0)return!1;if(typeof se=="function")ReflectApply(se,this,_);else for(var ae=se.length,ge=arrayClone(se,ae),K=0;K<ae;++K)ReflectApply(ge[K],this,_);return!0};function _addListener(X,Z,_,K){var te,ne,oe;if(checkListener(_),ne=X._events,ne===void 0?(ne=X._events=Object.create(null),X._eventsCount=0):(ne.newListener!==void 0&&(X.emit("newListener",Z,_.listener?_.listener:_),ne=X._events),oe=ne[Z]),oe===void 0)oe=ne[Z]=_,++X._eventsCount;else if(typeof oe=="function"?oe=ne[Z]=K?[_,oe]:[oe,_]:K?oe.unshift(_):oe.push(_),te=_getMaxListeners(X),te>0&&oe.length>te&&!oe.warned){oe.warned=!0;var ie=new Error("Possible EventEmitter memory leak detected. "+oe.length+" "+String(Z)+" listeners added. Use emitter.setMaxListeners() to increase limit");ie.name="MaxListenersExceededWarning",ie.emitter=X,ie.type=Z,ie.count=oe.length,ProcessEmitWarning(ie)}return X}EventEmitter.prototype.addListener=function X(Z,_){return _addListener(this,Z,_,!1)};EventEmitter.prototype.on=EventEmitter.prototype.addListener;EventEmitter.prototype.prependListener=function X(Z,_){return _addListener(this,Z,_,!0)};function onceWrapper(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function _onceWrap(X,Z,_){var K={fired:!1,wrapFn:void 0,target:X,type:Z,listener:_},te=onceWrapper.bind(K);return te.listener=_,K.wrapFn=te,te}EventEmitter.prototype.once=function X(Z,_){return checkListener(_),this.on(Z,_onceWrap(this,Z,_)),this};EventEmitter.prototype.prependOnceListener=function X(Z,_){return checkListener(_),this.prependListener(Z,_onceWrap(this,Z,_)),this};EventEmitter.prototype.removeListener=function X(Z,_){var K,te,ne,oe,ie;if(checkListener(_),te=this._events,te===void 0)return this;if(K=te[Z],K===void 0)return this;if(K===_||K.listener===_)--this._eventsCount===0?this._events=Object.create(null):(delete te[Z],te.removeListener&&this.emit("removeListener",Z,K.listener||_));else if(typeof K!="function"){for(ne=-1,oe=K.length-1;oe>=0;oe--)if(K[oe]===_||K[oe].listener===_){ie=K[oe].listener,ne=oe;break}if(ne<0)return this;ne===0?K.shift():spliceOne(K,ne),K.length===1&&(te[Z]=K[0]),te.removeListener!==void 0&&this.emit("removeListener",Z,ie||_)}return this};EventEmitter.prototype.off=EventEmitter.prototype.removeListener;EventEmitter.prototype.removeAllListeners=function X(Z){var _,K,te;if(K=this._events,K===void 0)return this;if(K.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):K[Z]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete K[Z]),this;if(arguments.length===0){var ne=Object.keys(K),oe;for(te=0;te<ne.length;++te)oe=ne[te],oe!=="removeListener"&&this.removeAllListeners(oe);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(_=K[Z],typeof _=="function")this.removeListener(Z,_);else if(_!==void 0)for(te=_.length-1;te>=0;te--)this.removeListener(Z,_[te]);return this};function _listeners(X,Z,_){var K=X._events;if(K===void 0)return[];var te=K[Z];return te===void 0?[]:typeof te=="function"?_?[te.listener||te]:[te]:_?unwrapListeners(te):arrayClone(te,te.length)}EventEmitter.prototype.listeners=function X(Z){return _listeners(this,Z,!0)};EventEmitter.prototype.rawListeners=function X(Z){return _listeners(this,Z,!1)};EventEmitter.listenerCount=function(X,Z){return typeof X.listenerCount=="function"?X.listenerCount(Z):listenerCount.call(X,Z)};EventEmitter.prototype.listenerCount=listenerCount;function listenerCount(X){var Z=this._events;if(Z!==void 0){var _=Z[X];if(typeof _=="function")return 1;if(_!==void 0)return _.length}return 0}EventEmitter.prototype.eventNames=function X(){return this._eventsCount>0?ReflectOwnKeys(this._events):[]};function arrayClone(X,Z){for(var _=new Array(Z),K=0;K<Z;++K)_[K]=X[K];return _}function spliceOne(X,Z){for(;Z+1<X.length;Z++)X[Z]=X[Z+1];X.pop()}function unwrapListeners(X){for(var Z=new Array(X.length),_=0;_<Z.length;++_)Z[_]=X[_].listener||X[_];return Z}function once(X,Z){return new Promise(function(_,K){function te(oe){X.removeListener(Z,ne),K(oe)}function ne(){typeof X.removeListener=="function"&&X.removeListener("error",te),_([].slice.call(arguments))}eventTargetAgnosticAddListener(X,Z,ne,{once:!0}),Z!=="error"&&addErrorHandlerIfEventEmitter(X,te,{once:!0})})}function addErrorHandlerIfEventEmitter(X,Z,_){typeof X.on=="function"&&eventTargetAgnosticAddListener(X,"error",Z,_)}function eventTargetAgnosticAddListener(X,Z,_,K){if(typeof X.on=="function")K.once?X.once(Z,_):X.on(Z,_);else if(typeof X.addEventListener=="function")X.addEventListener(Z,function te(ne){K.once&&X.removeEventListener(Z,te),_(ne)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof X)}var EventEmitter$1=events.exports;function decodeBase64(X,Z){var _=atob(X);return _}function createURL(X,Z,_){var K=decodeBase64(X),te=K.indexOf(`
`,10)+1,ne=K.substring(te)+"",oe=new Blob([ne],{type:"application/javascript"});return URL.createObjectURL(oe)}function createBase64WorkerFactory(X,Z,_){var K;return function(ne){return K=K||createURL(X),new Worker(K,ne)}}var WorkerFactory=createBase64WorkerFactory("Lyogcm9sbHVwLXBsdWdpbi13ZWItd29ya2VyLWxvYWRlciAqLwooZnVuY3Rpb24gKCkgewogICd1c2Ugc3RyaWN0JzsKCiAgLyoqCiAgICogUmVjb3JkcyB3aGF0IG9iamVjdHMgYXJlIGNvbGxpZGluZyB3aXRoIGVhY2ggb3RoZXIKICAgKi8KCiAgLyoqCiAgICogQSAzeDMgbWF0cml4LgogICAqIEF1dGhvcmVkIGJ5IHtAbGluayBodHRwOi8vZ2l0aHViLmNvbS9zY2h0ZXBwZS8gc2NodGVwcGV9CiAgICovCiAgY2xhc3MgTWF0MyB7CiAgICAvKioKICAgICAqIEEgdmVjdG9yIG9mIGxlbmd0aCA5LCBjb250YWluaW5nIGFsbCBtYXRyaXggZWxlbWVudHMuCiAgICAgKi8KCiAgICAvKioKICAgICAqIEBwYXJhbSBlbGVtZW50cyBBIHZlY3RvciBvZiBsZW5ndGggOSwgY29udGFpbmluZyBhbGwgbWF0cml4IGVsZW1lbnRzLgogICAgICovCiAgICBjb25zdHJ1Y3RvcihlbGVtZW50cykgewogICAgICBpZiAoZWxlbWVudHMgPT09IHZvaWQgMCkgewogICAgICAgIGVsZW1lbnRzID0gWzAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDBdOwogICAgICB9CgogICAgICB0aGlzLmVsZW1lbnRzID0gZWxlbWVudHM7CiAgICB9CiAgICAvKioKICAgICAqIFNldHMgdGhlIG1hdHJpeCB0byBpZGVudGl0eQogICAgICogQHRvZG8gU2hvdWxkIHBlcmhhcHMgYmUgcmVuYW1lZCB0byBgc2V0SWRlbnRpdHkoKWAgdG8gYmUgbW9yZSBjbGVhci4KICAgICAqIEB0b2RvIENyZWF0ZSBhbm90aGVyIGZ1bmN0aW9uIHRoYXQgaW1tZWRpYXRlbHkgY3JlYXRlcyBhbiBpZGVudGl0eSBtYXRyaXggZWcuIGBleWUoKWAKICAgICAqLwoKCiAgICBpZGVudGl0eSgpIHsKICAgICAgY29uc3QgZSA9IHRoaXMuZWxlbWVudHM7CiAgICAgIGVbMF0gPSAxOwogICAgICBlWzFdID0gMDsKICAgICAgZVsyXSA9IDA7CiAgICAgIGVbM10gPSAwOwogICAgICBlWzRdID0gMTsKICAgICAgZVs1XSA9IDA7CiAgICAgIGVbNl0gPSAwOwogICAgICBlWzddID0gMDsKICAgICAgZVs4XSA9IDE7CiAgICB9CiAgICAvKioKICAgICAqIFNldCBhbGwgZWxlbWVudHMgdG8gemVybwogICAgICovCgoKICAgIHNldFplcm8oKSB7CiAgICAgIGNvbnN0IGUgPSB0aGlzLmVsZW1lbnRzOwogICAgICBlWzBdID0gMDsKICAgICAgZVsxXSA9IDA7CiAgICAgIGVbMl0gPSAwOwogICAgICBlWzNdID0gMDsKICAgICAgZVs0XSA9IDA7CiAgICAgIGVbNV0gPSAwOwogICAgICBlWzZdID0gMDsKICAgICAgZVs3XSA9IDA7CiAgICAgIGVbOF0gPSAwOwogICAgfQogICAgLyoqCiAgICAgKiBTZXRzIHRoZSBtYXRyaXggZGlhZ29uYWwgZWxlbWVudHMgZnJvbSBhIFZlYzMKICAgICAqLwoKCiAgICBzZXRUcmFjZSh2ZWN0b3IpIHsKICAgICAgY29uc3QgZSA9IHRoaXMuZWxlbWVudHM7CiAgICAgIGVbMF0gPSB2ZWN0b3IueDsKICAgICAgZVs0XSA9IHZlY3Rvci55OwogICAgICBlWzhdID0gdmVjdG9yLno7CiAgICB9CiAgICAvKioKICAgICAqIEdldHMgdGhlIG1hdHJpeCBkaWFnb25hbCBlbGVtZW50cwogICAgICovCgoKICAgIGdldFRyYWNlKHRhcmdldCkgewogICAgICBpZiAodGFyZ2V0ID09PSB2b2lkIDApIHsKICAgICAgICB0YXJnZXQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICBjb25zdCBlID0gdGhpcy5lbGVtZW50czsKICAgICAgdGFyZ2V0LnggPSBlWzBdOwogICAgICB0YXJnZXQueSA9IGVbNF07CiAgICAgIHRhcmdldC56ID0gZVs4XTsKICAgICAgcmV0dXJuIHRhcmdldDsKICAgIH0KICAgIC8qKgogICAgICogTWF0cml4LVZlY3RvciBtdWx0aXBsaWNhdGlvbgogICAgICogQHBhcmFtIHYgVGhlIHZlY3RvciB0byBtdWx0aXBseSB3aXRoCiAgICAgKiBAcGFyYW0gdGFyZ2V0IE9wdGlvbmFsLCB0YXJnZXQgdG8gc2F2ZSB0aGUgcmVzdWx0IGluLgogICAgICovCgoKICAgIHZtdWx0KHYsIHRhcmdldCkgewogICAgICBpZiAodGFyZ2V0ID09PSB2b2lkIDApIHsKICAgICAgICB0YXJnZXQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICBjb25zdCBlID0gdGhpcy5lbGVtZW50czsKICAgICAgY29uc3QgeCA9IHYueDsKICAgICAgY29uc3QgeSA9IHYueTsKICAgICAgY29uc3QgeiA9IHYuejsKICAgICAgdGFyZ2V0LnggPSBlWzBdICogeCArIGVbMV0gKiB5ICsgZVsyXSAqIHo7CiAgICAgIHRhcmdldC55ID0gZVszXSAqIHggKyBlWzRdICogeSArIGVbNV0gKiB6OwogICAgICB0YXJnZXQueiA9IGVbNl0gKiB4ICsgZVs3XSAqIHkgKyBlWzhdICogejsKICAgICAgcmV0dXJuIHRhcmdldDsKICAgIH0KICAgIC8qKgogICAgICogTWF0cml4LXNjYWxhciBtdWx0aXBsaWNhdGlvbgogICAgICovCgoKICAgIHNtdWx0KHMpIHsKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLmVsZW1lbnRzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgdGhpcy5lbGVtZW50c1tpXSAqPSBzOwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIE1hdHJpeCBtdWx0aXBsaWNhdGlvbgogICAgICogQHBhcmFtIG1hdHJpeCBNYXRyaXggdG8gbXVsdGlwbHkgd2l0aCBmcm9tIGxlZnQgc2lkZS4KICAgICAqLwoKCiAgICBtbXVsdChtYXRyaXgsIHRhcmdldCkgewogICAgICBpZiAodGFyZ2V0ID09PSB2b2lkIDApIHsKICAgICAgICB0YXJnZXQgPSBuZXcgTWF0MygpOwogICAgICB9CgogICAgICBjb25zdCBBID0gdGhpcy5lbGVtZW50czsKICAgICAgY29uc3QgQiA9IG1hdHJpeC5lbGVtZW50czsKICAgICAgY29uc3QgVCA9IHRhcmdldC5lbGVtZW50czsKICAgICAgY29uc3QgYTExID0gQVswXSwKICAgICAgICAgICAgYTEyID0gQVsxXSwKICAgICAgICAgICAgYTEzID0gQVsyXSwKICAgICAgICAgICAgYTIxID0gQVszXSwKICAgICAgICAgICAgYTIyID0gQVs0XSwKICAgICAgICAgICAgYTIzID0gQVs1XSwKICAgICAgICAgICAgYTMxID0gQVs2XSwKICAgICAgICAgICAgYTMyID0gQVs3XSwKICAgICAgICAgICAgYTMzID0gQVs4XTsKICAgICAgY29uc3QgYjExID0gQlswXSwKICAgICAgICAgICAgYjEyID0gQlsxXSwKICAgICAgICAgICAgYjEzID0gQlsyXSwKICAgICAgICAgICAgYjIxID0gQlszXSwKICAgICAgICAgICAgYjIyID0gQls0XSwKICAgICAgICAgICAgYjIzID0gQls1XSwKICAgICAgICAgICAgYjMxID0gQls2XSwKICAgICAgICAgICAgYjMyID0gQls3XSwKICAgICAgICAgICAgYjMzID0gQls4XTsKICAgICAgVFswXSA9IGExMSAqIGIxMSArIGExMiAqIGIyMSArIGExMyAqIGIzMTsKICAgICAgVFsxXSA9IGExMSAqIGIxMiArIGExMiAqIGIyMiArIGExMyAqIGIzMjsKICAgICAgVFsyXSA9IGExMSAqIGIxMyArIGExMiAqIGIyMyArIGExMyAqIGIzMzsKICAgICAgVFszXSA9IGEyMSAqIGIxMSArIGEyMiAqIGIyMSArIGEyMyAqIGIzMTsKICAgICAgVFs0XSA9IGEyMSAqIGIxMiArIGEyMiAqIGIyMiArIGEyMyAqIGIzMjsKICAgICAgVFs1XSA9IGEyMSAqIGIxMyArIGEyMiAqIGIyMyArIGEyMyAqIGIzMzsKICAgICAgVFs2XSA9IGEzMSAqIGIxMSArIGEzMiAqIGIyMSArIGEzMyAqIGIzMTsKICAgICAgVFs3XSA9IGEzMSAqIGIxMiArIGEzMiAqIGIyMiArIGEzMyAqIGIzMjsKICAgICAgVFs4XSA9IGEzMSAqIGIxMyArIGEzMiAqIGIyMyArIGEzMyAqIGIzMzsKICAgICAgcmV0dXJuIHRhcmdldDsKICAgIH0KICAgIC8qKgogICAgICogU2NhbGUgZWFjaCBjb2x1bW4gb2YgdGhlIG1hdHJpeAogICAgICovCgoKICAgIHNjYWxlKHZlY3RvciwgdGFyZ2V0KSB7CiAgICAgIGlmICh0YXJnZXQgPT09IHZvaWQgMCkgewogICAgICAgIHRhcmdldCA9IG5ldyBNYXQzKCk7CiAgICAgIH0KCiAgICAgIGNvbnN0IGUgPSB0aGlzLmVsZW1lbnRzOwogICAgICBjb25zdCB0ID0gdGFyZ2V0LmVsZW1lbnRzOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IDM7IGkrKykgewogICAgICAgIHRbMyAqIGkgKyAwXSA9IHZlY3Rvci54ICogZVszICogaSArIDBdOwogICAgICAgIHRbMyAqIGkgKyAxXSA9IHZlY3Rvci55ICogZVszICogaSArIDFdOwogICAgICAgIHRbMyAqIGkgKyAyXSA9IHZlY3Rvci56ICogZVszICogaSArIDJdOwogICAgICB9CgogICAgICByZXR1cm4gdGFyZ2V0OwogICAgfQogICAgLyoqCiAgICAgKiBTb2x2ZSBBeD1iCiAgICAgKiBAcGFyYW0gYiBUaGUgcmlnaHQgaGFuZCBzaWRlCiAgICAgKiBAcGFyYW0gdGFyZ2V0IE9wdGlvbmFsLiBUYXJnZXQgdmVjdG9yIHRvIHNhdmUgaW4uCiAgICAgKiBAcmV0dXJuIFRoZSBzb2x1dGlvbiB4CiAgICAgKiBAdG9kbyBzaG91bGQgcmV1c2UgYXJyYXlzCiAgICAgKi8KCgogICAgc29sdmUoYiwgdGFyZ2V0KSB7CiAgICAgIGlmICh0YXJnZXQgPT09IHZvaWQgMCkgewogICAgICAgIHRhcmdldCA9IG5ldyBWZWMzKCk7CiAgICAgIH0KCiAgICAgIC8vIENvbnN0cnVjdCBlcXVhdGlvbnMKICAgICAgY29uc3QgbnIgPSAzOyAvLyBudW0gcm93cwoKICAgICAgY29uc3QgbmMgPSA0OyAvLyBudW0gY29scwoKICAgICAgY29uc3QgZXFucyA9IFtdOwogICAgICBsZXQgaTsKICAgICAgbGV0IGo7CgogICAgICBmb3IgKGkgPSAwOyBpIDwgbnIgKiBuYzsgaSsrKSB7CiAgICAgICAgZXFucy5wdXNoKDApOwogICAgICB9CgogICAgICBmb3IgKGkgPSAwOyBpIDwgMzsgaSsrKSB7CiAgICAgICAgZm9yIChqID0gMDsgaiA8IDM7IGorKykgewogICAgICAgICAgZXFuc1tpICsgbmMgKiBqXSA9IHRoaXMuZWxlbWVudHNbaSArIDMgKiBqXTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIGVxbnNbMyArIDQgKiAwXSA9IGIueDsKICAgICAgZXFuc1szICsgNCAqIDFdID0gYi55OwogICAgICBlcW5zWzMgKyA0ICogMl0gPSBiLno7IC8vIENvbXB1dGUgcmlnaHQgdXBwZXIgdHJpYW5ndWxhciB2ZXJzaW9uIG9mIHRoZSBtYXRyaXggLSBHYXVzcyBlbGltaW5hdGlvbgoKICAgICAgbGV0IG4gPSAzOwogICAgICBjb25zdCBrID0gbjsKICAgICAgbGV0IG5wOwogICAgICBjb25zdCBrcCA9IDQ7IC8vIG51bSByb3dzCgogICAgICBsZXQgcDsKCiAgICAgIGRvIHsKICAgICAgICBpID0gayAtIG47CgogICAgICAgIGlmIChlcW5zW2kgKyBuYyAqIGldID09PSAwKSB7CiAgICAgICAgICAvLyB0aGUgcGl2b3QgaXMgbnVsbCwgc3dhcCBsaW5lcwogICAgICAgICAgZm9yIChqID0gaSArIDE7IGogPCBrOyBqKyspIHsKICAgICAgICAgICAgaWYgKGVxbnNbaSArIG5jICogal0gIT09IDApIHsKICAgICAgICAgICAgICBucCA9IGtwOwoKICAgICAgICAgICAgICBkbyB7CiAgICAgICAgICAgICAgICAvLyBkbyBsaWduZSggaSApID0gbGlnbmUoIGkgKSArIGxpZ25lKCBrICkKICAgICAgICAgICAgICAgIHAgPSBrcCAtIG5wOwogICAgICAgICAgICAgICAgZXFuc1twICsgbmMgKiBpXSArPSBlcW5zW3AgKyBuYyAqIGpdOwogICAgICAgICAgICAgIH0gd2hpbGUgKC0tbnApOwoKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgaWYgKGVxbnNbaSArIG5jICogaV0gIT09IDApIHsKICAgICAgICAgIGZvciAoaiA9IGkgKyAxOyBqIDwgazsgaisrKSB7CiAgICAgICAgICAgIGNvbnN0IG11bHRpcGxpZXIgPSBlcW5zW2kgKyBuYyAqIGpdIC8gZXFuc1tpICsgbmMgKiBpXTsKICAgICAgICAgICAgbnAgPSBrcDsKCiAgICAgICAgICAgIGRvIHsKICAgICAgICAgICAgICAvLyBkbyBsaWduZSggayApID0gbGlnbmUoIGsgKSAtIG11bHRpcGxpZXIgKiBsaWduZSggaSApCiAgICAgICAgICAgICAgcCA9IGtwIC0gbnA7CiAgICAgICAgICAgICAgZXFuc1twICsgbmMgKiBqXSA9IHAgPD0gaSA/IDAgOiBlcW5zW3AgKyBuYyAqIGpdIC0gZXFuc1twICsgbmMgKiBpXSAqIG11bHRpcGxpZXI7CiAgICAgICAgICAgIH0gd2hpbGUgKC0tbnApOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSB3aGlsZSAoLS1uKTsgLy8gR2V0IHRoZSBzb2x1dGlvbgoKCiAgICAgIHRhcmdldC56ID0gZXFuc1syICogbmMgKyAzXSAvIGVxbnNbMiAqIG5jICsgMl07CiAgICAgIHRhcmdldC55ID0gKGVxbnNbMSAqIG5jICsgM10gLSBlcW5zWzEgKiBuYyArIDJdICogdGFyZ2V0LnopIC8gZXFuc1sxICogbmMgKyAxXTsKICAgICAgdGFyZ2V0LnggPSAoZXFuc1swICogbmMgKyAzXSAtIGVxbnNbMCAqIG5jICsgMl0gKiB0YXJnZXQueiAtIGVxbnNbMCAqIG5jICsgMV0gKiB0YXJnZXQueSkgLyBlcW5zWzAgKiBuYyArIDBdOwoKICAgICAgaWYgKGlzTmFOKHRhcmdldC54KSB8fCBpc05hTih0YXJnZXQueSkgfHwgaXNOYU4odGFyZ2V0LnopIHx8IHRhcmdldC54ID09PSBJbmZpbml0eSB8fCB0YXJnZXQueSA9PT0gSW5maW5pdHkgfHwgdGFyZ2V0LnogPT09IEluZmluaXR5KSB7CiAgICAgICAgdGhyb3cgYENvdWxkIG5vdCBzb2x2ZSBlcXVhdGlvbiEgR290IHg9WyR7dGFyZ2V0LnRvU3RyaW5nKCl9XSwgYj1bJHtiLnRvU3RyaW5nKCl9XSwgQT1bJHt0aGlzLnRvU3RyaW5nKCl9XWA7CiAgICAgIH0KCiAgICAgIHJldHVybiB0YXJnZXQ7CiAgICB9CiAgICAvKioKICAgICAqIEdldCBhbiBlbGVtZW50IGluIHRoZSBtYXRyaXggYnkgaW5kZXguIEluZGV4IHN0YXJ0cyBhdCAwLCBub3QgMSEhIQogICAgICogQHBhcmFtIHZhbHVlIElmIHByb3ZpZGVkLCB0aGUgbWF0cml4IGVsZW1lbnQgd2lsbCBiZSBzZXQgdG8gdGhpcyB2YWx1ZS4KICAgICAqLwoKCiAgICBlKHJvdywgY29sdW1uLCB2YWx1ZSkgewogICAgICBpZiAodmFsdWUgPT09IHVuZGVmaW5lZCkgewogICAgICAgIHJldHVybiB0aGlzLmVsZW1lbnRzW2NvbHVtbiArIDMgKiByb3ddOwogICAgICB9IGVsc2UgewogICAgICAgIC8vIFNldCB2YWx1ZQogICAgICAgIHRoaXMuZWxlbWVudHNbY29sdW1uICsgMyAqIHJvd10gPSB2YWx1ZTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBDb3B5IGFub3RoZXIgbWF0cml4IGludG8gdGhpcyBtYXRyaXggb2JqZWN0LgogICAgICovCgoKICAgIGNvcHkobWF0cml4KSB7CiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbWF0cml4LmVsZW1lbnRzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgdGhpcy5lbGVtZW50c1tpXSA9IG1hdHJpeC5lbGVtZW50c1tpXTsKICAgICAgfQoKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICAvKioKICAgICAqIFJldHVybnMgYSBzdHJpbmcgcmVwcmVzZW50YXRpb24gb2YgdGhlIG1hdHJpeC4KICAgICAqLwoKCiAgICB0b1N0cmluZygpIHsKICAgICAgbGV0IHIgPSAnJzsKICAgICAgY29uc3Qgc2VwID0gJywnOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCA5OyBpKyspIHsKICAgICAgICByICs9IHRoaXMuZWxlbWVudHNbaV0gKyBzZXA7CiAgICAgIH0KCiAgICAgIHJldHVybiByOwogICAgfQogICAgLyoqCiAgICAgKiByZXZlcnNlIHRoZSBtYXRyaXgKICAgICAqIEBwYXJhbSB0YXJnZXQgVGFyZ2V0IG1hdHJpeCB0byBzYXZlIGluLgogICAgICogQHJldHVybiBUaGUgc29sdXRpb24geAogICAgICovCgoKICAgIHJldmVyc2UodGFyZ2V0KSB7CiAgICAgIGlmICh0YXJnZXQgPT09IHZvaWQgMCkgewogICAgICAgIHRhcmdldCA9IG5ldyBNYXQzKCk7CiAgICAgIH0KCiAgICAgIC8vIENvbnN0cnVjdCBlcXVhdGlvbnMKICAgICAgY29uc3QgbnIgPSAzOyAvLyBudW0gcm93cwoKICAgICAgY29uc3QgbmMgPSA2OyAvLyBudW0gY29scwoKICAgICAgY29uc3QgZXFucyA9IHJldmVyc2VfZXFuczsKICAgICAgbGV0IGk7CiAgICAgIGxldCBqOwoKICAgICAgZm9yIChpID0gMDsgaSA8IDM7IGkrKykgewogICAgICAgIGZvciAoaiA9IDA7IGogPCAzOyBqKyspIHsKICAgICAgICAgIGVxbnNbaSArIG5jICogal0gPSB0aGlzLmVsZW1lbnRzW2kgKyAzICogal07CiAgICAgICAgfQogICAgICB9CgogICAgICBlcW5zWzMgKyA2ICogMF0gPSAxOwogICAgICBlcW5zWzMgKyA2ICogMV0gPSAwOwogICAgICBlcW5zWzMgKyA2ICogMl0gPSAwOwogICAgICBlcW5zWzQgKyA2ICogMF0gPSAwOwogICAgICBlcW5zWzQgKyA2ICogMV0gPSAxOwogICAgICBlcW5zWzQgKyA2ICogMl0gPSAwOwogICAgICBlcW5zWzUgKyA2ICogMF0gPSAwOwogICAgICBlcW5zWzUgKyA2ICogMV0gPSAwOwogICAgICBlcW5zWzUgKyA2ICogMl0gPSAxOyAvLyBDb21wdXRlIHJpZ2h0IHVwcGVyIHRyaWFuZ3VsYXIgdmVyc2lvbiBvZiB0aGUgbWF0cml4IC0gR2F1c3MgZWxpbWluYXRpb24KCiAgICAgIGxldCBuID0gMzsKICAgICAgY29uc3QgayA9IG47CiAgICAgIGxldCBucDsKICAgICAgY29uc3Qga3AgPSBuYzsgLy8gbnVtIHJvd3MKCiAgICAgIGxldCBwOwoKICAgICAgZG8gewogICAgICAgIGkgPSBrIC0gbjsKCiAgICAgICAgaWYgKGVxbnNbaSArIG5jICogaV0gPT09IDApIHsKICAgICAgICAgIC8vIHRoZSBwaXZvdCBpcyBudWxsLCBzd2FwIGxpbmVzCiAgICAgICAgICBmb3IgKGogPSBpICsgMTsgaiA8IGs7IGorKykgewogICAgICAgICAgICBpZiAoZXFuc1tpICsgbmMgKiBqXSAhPT0gMCkgewogICAgICAgICAgICAgIG5wID0ga3A7CgogICAgICAgICAgICAgIGRvIHsKICAgICAgICAgICAgICAgIC8vIGRvIGxpbmUoIGkgKSA9IGxpbmUoIGkgKSArIGxpbmUoIGsgKQogICAgICAgICAgICAgICAgcCA9IGtwIC0gbnA7CiAgICAgICAgICAgICAgICBlcW5zW3AgKyBuYyAqIGldICs9IGVxbnNbcCArIG5jICogal07CiAgICAgICAgICAgICAgfSB3aGlsZSAoLS1ucCk7CgogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBpZiAoZXFuc1tpICsgbmMgKiBpXSAhPT0gMCkgewogICAgICAgICAgZm9yIChqID0gaSArIDE7IGogPCBrOyBqKyspIHsKICAgICAgICAgICAgY29uc3QgbXVsdGlwbGllciA9IGVxbnNbaSArIG5jICogal0gLyBlcW5zW2kgKyBuYyAqIGldOwogICAgICAgICAgICBucCA9IGtwOwoKICAgICAgICAgICAgZG8gewogICAgICAgICAgICAgIC8vIGRvIGxpbmUoIGsgKSA9IGxpbmUoIGsgKSAtIG11bHRpcGxpZXIgKiBsaW5lKCBpICkKICAgICAgICAgICAgICBwID0ga3AgLSBucDsKICAgICAgICAgICAgICBlcW5zW3AgKyBuYyAqIGpdID0gcCA8PSBpID8gMCA6IGVxbnNbcCArIG5jICogal0gLSBlcW5zW3AgKyBuYyAqIGldICogbXVsdGlwbGllcjsKICAgICAgICAgICAgfSB3aGlsZSAoLS1ucCk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9IHdoaWxlICgtLW4pOyAvLyBlbGltaW5hdGUgdGhlIHVwcGVyIGxlZnQgdHJpYW5nbGUgb2YgdGhlIG1hdHJpeAoKCiAgICAgIGkgPSAyOwoKICAgICAgZG8gewogICAgICAgIGogPSBpIC0gMTsKCiAgICAgICAgZG8gewogICAgICAgICAgY29uc3QgbXVsdGlwbGllciA9IGVxbnNbaSArIG5jICogal0gLyBlcW5zW2kgKyBuYyAqIGldOwogICAgICAgICAgbnAgPSBuYzsKCiAgICAgICAgICBkbyB7CiAgICAgICAgICAgIHAgPSBuYyAtIG5wOwogICAgICAgICAgICBlcW5zW3AgKyBuYyAqIGpdID0gZXFuc1twICsgbmMgKiBqXSAtIGVxbnNbcCArIG5jICogaV0gKiBtdWx0aXBsaWVyOwogICAgICAgICAgfSB3aGlsZSAoLS1ucCk7CiAgICAgICAgfSB3aGlsZSAoai0tKTsKICAgICAgfSB3aGlsZSAoLS1pKTsgLy8gb3BlcmF0aW9ucyBvbiB0aGUgZGlhZ29uYWwKCgogICAgICBpID0gMjsKCiAgICAgIGRvIHsKICAgICAgICBjb25zdCBtdWx0aXBsaWVyID0gMSAvIGVxbnNbaSArIG5jICogaV07CiAgICAgICAgbnAgPSBuYzsKCiAgICAgICAgZG8gewogICAgICAgICAgcCA9IG5jIC0gbnA7CiAgICAgICAgICBlcW5zW3AgKyBuYyAqIGldID0gZXFuc1twICsgbmMgKiBpXSAqIG11bHRpcGxpZXI7CiAgICAgICAgfSB3aGlsZSAoLS1ucCk7CiAgICAgIH0gd2hpbGUgKGktLSk7CgogICAgICBpID0gMjsKCiAgICAgIGRvIHsKICAgICAgICBqID0gMjsKCiAgICAgICAgZG8gewogICAgICAgICAgcCA9IGVxbnNbbnIgKyBqICsgbmMgKiBpXTsKCiAgICAgICAgICBpZiAoaXNOYU4ocCkgfHwgcCA9PT0gSW5maW5pdHkpIHsKICAgICAgICAgICAgdGhyb3cgYENvdWxkIG5vdCByZXZlcnNlISBBPVske3RoaXMudG9TdHJpbmcoKX1dYDsKICAgICAgICAgIH0KCiAgICAgICAgICB0YXJnZXQuZShpLCBqLCBwKTsKICAgICAgICB9IHdoaWxlIChqLS0pOwogICAgICB9IHdoaWxlIChpLS0pOwoKICAgICAgcmV0dXJuIHRhcmdldDsKICAgIH0KICAgIC8qKgogICAgICogU2V0IHRoZSBtYXRyaXggZnJvbSBhIHF1YXRlcmlvbgogICAgICovCgoKICAgIHNldFJvdGF0aW9uRnJvbVF1YXRlcm5pb24ocSkgewogICAgICBjb25zdCB4ID0gcS54OwogICAgICBjb25zdCB5ID0gcS55OwogICAgICBjb25zdCB6ID0gcS56OwogICAgICBjb25zdCB3ID0gcS53OwogICAgICBjb25zdCB4MiA9IHggKyB4OwogICAgICBjb25zdCB5MiA9IHkgKyB5OwogICAgICBjb25zdCB6MiA9IHogKyB6OwogICAgICBjb25zdCB4eCA9IHggKiB4MjsKICAgICAgY29uc3QgeHkgPSB4ICogeTI7CiAgICAgIGNvbnN0IHh6ID0geCAqIHoyOwogICAgICBjb25zdCB5eSA9IHkgKiB5MjsKICAgICAgY29uc3QgeXogPSB5ICogejI7CiAgICAgIGNvbnN0IHp6ID0geiAqIHoyOwogICAgICBjb25zdCB3eCA9IHcgKiB4MjsKICAgICAgY29uc3Qgd3kgPSB3ICogeTI7CiAgICAgIGNvbnN0IHd6ID0gdyAqIHoyOwogICAgICBjb25zdCBlID0gdGhpcy5lbGVtZW50czsKICAgICAgZVszICogMCArIDBdID0gMSAtICh5eSArIHp6KTsKICAgICAgZVszICogMCArIDFdID0geHkgLSB3ejsKICAgICAgZVszICogMCArIDJdID0geHogKyB3eTsKICAgICAgZVszICogMSArIDBdID0geHkgKyB3ejsKICAgICAgZVszICogMSArIDFdID0gMSAtICh4eCArIHp6KTsKICAgICAgZVszICogMSArIDJdID0geXogLSB3eDsKICAgICAgZVszICogMiArIDBdID0geHogLSB3eTsKICAgICAgZVszICogMiArIDFdID0geXogKyB3eDsKICAgICAgZVszICogMiArIDJdID0gMSAtICh4eCArIHl5KTsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICAvKioKICAgICAqIFRyYW5zcG9zZSB0aGUgbWF0cml4CiAgICAgKiBAcGFyYW0gdGFyZ2V0IE9wdGlvbmFsLiBXaGVyZSB0byBzdG9yZSB0aGUgcmVzdWx0LgogICAgICogQHJldHVybiBUaGUgdGFyZ2V0IE1hdDMsIG9yIGEgbmV3IE1hdDMgaWYgdGFyZ2V0IHdhcyBvbWl0dGVkLgogICAgICovCgoKICAgIHRyYW5zcG9zZSh0YXJnZXQpIHsKICAgICAgaWYgKHRhcmdldCA9PT0gdm9pZCAwKSB7CiAgICAgICAgdGFyZ2V0ID0gbmV3IE1hdDMoKTsKICAgICAgfQoKICAgICAgY29uc3QgTSA9IHRoaXMuZWxlbWVudHM7CiAgICAgIGNvbnN0IFQgPSB0YXJnZXQuZWxlbWVudHM7CiAgICAgIGxldCB0bXA7IC8vU2V0IGRpYWdvbmFscwoKICAgICAgVFswXSA9IE1bMF07CiAgICAgIFRbNF0gPSBNWzRdOwogICAgICBUWzhdID0gTVs4XTsKICAgICAgdG1wID0gTVsxXTsKICAgICAgVFsxXSA9IE1bM107CiAgICAgIFRbM10gPSB0bXA7CiAgICAgIHRtcCA9IE1bMl07CiAgICAgIFRbMl0gPSBNWzZdOwogICAgICBUWzZdID0gdG1wOwogICAgICB0bXAgPSBNWzVdOwogICAgICBUWzVdID0gTVs3XTsKICAgICAgVFs3XSA9IHRtcDsKICAgICAgcmV0dXJuIHRhcmdldDsKICAgIH0KCiAgfQogIGNvbnN0IHJldmVyc2VfZXFucyA9IFswLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwXTsKCiAgLyoqCiAgICogMy1kaW1lbnNpb25hbCB2ZWN0b3IKICAgKiBAZXhhbXBsZQogICAqICAgICBjb25zdCB2ID0gbmV3IFZlYzMoMSwgMiwgMykKICAgKiAgICAgY29uc29sZS5sb2coJ3g9JyArIHYueCkgLy8geD0xCiAgICovCgogIGNsYXNzIFZlYzMgewogICAgY29uc3RydWN0b3IoeCwgeSwgeikgewogICAgICBpZiAoeCA9PT0gdm9pZCAwKSB7CiAgICAgICAgeCA9IDAuMDsKICAgICAgfQoKICAgICAgaWYgKHkgPT09IHZvaWQgMCkgewogICAgICAgIHkgPSAwLjA7CiAgICAgIH0KCiAgICAgIGlmICh6ID09PSB2b2lkIDApIHsKICAgICAgICB6ID0gMC4wOwogICAgICB9CgogICAgICB0aGlzLnggPSB4OwogICAgICB0aGlzLnkgPSB5OwogICAgICB0aGlzLnogPSB6OwogICAgfQogICAgLyoqCiAgICAgKiBWZWN0b3IgY3Jvc3MgcHJvZHVjdAogICAgICogQHBhcmFtIHRhcmdldCBPcHRpb25hbCB0YXJnZXQgdG8gc2F2ZSBpbi4KICAgICAqLwoKCiAgICBjcm9zcyh2ZWN0b3IsIHRhcmdldCkgewogICAgICBpZiAodGFyZ2V0ID09PSB2b2lkIDApIHsKICAgICAgICB0YXJnZXQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICBjb25zdCB2eCA9IHZlY3Rvci54OwogICAgICBjb25zdCB2eSA9IHZlY3Rvci55OwogICAgICBjb25zdCB2eiA9IHZlY3Rvci56OwogICAgICBjb25zdCB4ID0gdGhpcy54OwogICAgICBjb25zdCB5ID0gdGhpcy55OwogICAgICBjb25zdCB6ID0gdGhpcy56OwogICAgICB0YXJnZXQueCA9IHkgKiB2eiAtIHogKiB2eTsKICAgICAgdGFyZ2V0LnkgPSB6ICogdnggLSB4ICogdno7CiAgICAgIHRhcmdldC56ID0geCAqIHZ5IC0geSAqIHZ4OwogICAgICByZXR1cm4gdGFyZ2V0OwogICAgfQogICAgLyoqCiAgICAgKiBTZXQgdGhlIHZlY3RvcnMnIDMgZWxlbWVudHMKICAgICAqLwoKCiAgICBzZXQoeCwgeSwgeikgewogICAgICB0aGlzLnggPSB4OwogICAgICB0aGlzLnkgPSB5OwogICAgICB0aGlzLnogPSB6OwogICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIC8qKgogICAgICogU2V0IGFsbCBjb21wb25lbnRzIG9mIHRoZSB2ZWN0b3IgdG8gemVyby4KICAgICAqLwoKCiAgICBzZXRaZXJvKCkgewogICAgICB0aGlzLnggPSB0aGlzLnkgPSB0aGlzLnogPSAwOwogICAgfQogICAgLyoqCiAgICAgKiBWZWN0b3IgYWRkaXRpb24KICAgICAqLwoKCiAgICB2YWRkKHZlY3RvciwgdGFyZ2V0KSB7CiAgICAgIGlmICh0YXJnZXQpIHsKICAgICAgICB0YXJnZXQueCA9IHZlY3Rvci54ICsgdGhpcy54OwogICAgICAgIHRhcmdldC55ID0gdmVjdG9yLnkgKyB0aGlzLnk7CiAgICAgICAgdGFyZ2V0LnogPSB2ZWN0b3IueiArIHRoaXMuejsKICAgICAgfSBlbHNlIHsKICAgICAgICByZXR1cm4gbmV3IFZlYzModGhpcy54ICsgdmVjdG9yLngsIHRoaXMueSArIHZlY3Rvci55LCB0aGlzLnogKyB2ZWN0b3Iueik7CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogVmVjdG9yIHN1YnRyYWN0aW9uCiAgICAgKiBAcGFyYW0gdGFyZ2V0IE9wdGlvbmFsIHRhcmdldCB0byBzYXZlIGluLgogICAgICovCgoKICAgIHZzdWIodmVjdG9yLCB0YXJnZXQpIHsKICAgICAgaWYgKHRhcmdldCkgewogICAgICAgIHRhcmdldC54ID0gdGhpcy54IC0gdmVjdG9yLng7CiAgICAgICAgdGFyZ2V0LnkgPSB0aGlzLnkgLSB2ZWN0b3IueTsKICAgICAgICB0YXJnZXQueiA9IHRoaXMueiAtIHZlY3Rvci56OwogICAgICB9IGVsc2UgewogICAgICAgIHJldHVybiBuZXcgVmVjMyh0aGlzLnggLSB2ZWN0b3IueCwgdGhpcy55IC0gdmVjdG9yLnksIHRoaXMueiAtIHZlY3Rvci56KTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBHZXQgdGhlIGNyb3NzIHByb2R1Y3QgbWF0cml4IGFfY3Jvc3MgZnJvbSBhIHZlY3Rvciwgc3VjaCB0aGF0IGEgeCBiID0gYV9jcm9zcyAqIGIgPSBjCiAgICAgKgogICAgICogU2VlIHtAbGluayBodHRwczovL3d3dzguY3MudW11LnNlL2t1cnNlci9UREJEMjQvVlQwNi9sZWN0dXJlcy9MZWN0dXJlNi5wZGYgVW1lw6UgVW5pdmVyc2l0eSBMZWN0dXJlfQogICAgICovCgoKICAgIGNyb3NzbWF0KCkgewogICAgICByZXR1cm4gbmV3IE1hdDMoWzAsIC10aGlzLnosIHRoaXMueSwgdGhpcy56LCAwLCAtdGhpcy54LCAtdGhpcy55LCB0aGlzLngsIDBdKTsKICAgIH0KICAgIC8qKgogICAgICogTm9ybWFsaXplIHRoZSB2ZWN0b3IuIE5vdGUgdGhhdCB0aGlzIGNoYW5nZXMgdGhlIHZhbHVlcyBpbiB0aGUgdmVjdG9yLgogICAgICAqIEByZXR1cm4gUmV0dXJucyB0aGUgbm9ybSBvZiB0aGUgdmVjdG9yCiAgICAgKi8KCgogICAgbm9ybWFsaXplKCkgewogICAgICBjb25zdCB4ID0gdGhpcy54OwogICAgICBjb25zdCB5ID0gdGhpcy55OwogICAgICBjb25zdCB6ID0gdGhpcy56OwogICAgICBjb25zdCBuID0gTWF0aC5zcXJ0KHggKiB4ICsgeSAqIHkgKyB6ICogeik7CgogICAgICBpZiAobiA+IDAuMCkgewogICAgICAgIGNvbnN0IGludk4gPSAxIC8gbjsKICAgICAgICB0aGlzLnggKj0gaW52TjsKICAgICAgICB0aGlzLnkgKj0gaW52TjsKICAgICAgICB0aGlzLnogKj0gaW52TjsKICAgICAgfSBlbHNlIHsKICAgICAgICAvLyBNYWtlIHNvbWV0aGluZyB1cAogICAgICAgIHRoaXMueCA9IDA7CiAgICAgICAgdGhpcy55ID0gMDsKICAgICAgICB0aGlzLnogPSAwOwogICAgICB9CgogICAgICByZXR1cm4gbjsKICAgIH0KICAgIC8qKgogICAgICogR2V0IHRoZSB2ZXJzaW9uIG9mIHRoaXMgdmVjdG9yIHRoYXQgaXMgb2YgbGVuZ3RoIDEuCiAgICAgKiBAcGFyYW0gdGFyZ2V0IE9wdGlvbmFsIHRhcmdldCB0byBzYXZlIGluCiAgICAgKiBAcmV0dXJuIFJldHVybnMgdGhlIHVuaXQgdmVjdG9yCiAgICAgKi8KCgogICAgdW5pdCh0YXJnZXQpIHsKICAgICAgaWYgKHRhcmdldCA9PT0gdm9pZCAwKSB7CiAgICAgICAgdGFyZ2V0ID0gbmV3IFZlYzMoKTsKICAgICAgfQoKICAgICAgY29uc3QgeCA9IHRoaXMueDsKICAgICAgY29uc3QgeSA9IHRoaXMueTsKICAgICAgY29uc3QgeiA9IHRoaXMuejsKICAgICAgbGV0IG5pbnYgPSBNYXRoLnNxcnQoeCAqIHggKyB5ICogeSArIHogKiB6KTsKCiAgICAgIGlmIChuaW52ID4gMC4wKSB7CiAgICAgICAgbmludiA9IDEuMCAvIG5pbnY7CiAgICAgICAgdGFyZ2V0LnggPSB4ICogbmludjsKICAgICAgICB0YXJnZXQueSA9IHkgKiBuaW52OwogICAgICAgIHRhcmdldC56ID0geiAqIG5pbnY7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGFyZ2V0LnggPSAxOwogICAgICAgIHRhcmdldC55ID0gMDsKICAgICAgICB0YXJnZXQueiA9IDA7CiAgICAgIH0KCiAgICAgIHJldHVybiB0YXJnZXQ7CiAgICB9CiAgICAvKioKICAgICAqIEdldCB0aGUgbGVuZ3RoIG9mIHRoZSB2ZWN0b3IKICAgICAqLwoKCiAgICBsZW5ndGgoKSB7CiAgICAgIGNvbnN0IHggPSB0aGlzLng7CiAgICAgIGNvbnN0IHkgPSB0aGlzLnk7CiAgICAgIGNvbnN0IHogPSB0aGlzLno7CiAgICAgIHJldHVybiBNYXRoLnNxcnQoeCAqIHggKyB5ICogeSArIHogKiB6KTsKICAgIH0KICAgIC8qKgogICAgICogR2V0IHRoZSBzcXVhcmVkIGxlbmd0aCBvZiB0aGUgdmVjdG9yLgogICAgICovCgoKICAgIGxlbmd0aFNxdWFyZWQoKSB7CiAgICAgIHJldHVybiB0aGlzLmRvdCh0aGlzKTsKICAgIH0KICAgIC8qKgogICAgICogR2V0IGRpc3RhbmNlIGZyb20gdGhpcyBwb2ludCB0byBhbm90aGVyIHBvaW50CiAgICAgKi8KCgogICAgZGlzdGFuY2VUbyhwKSB7CiAgICAgIGNvbnN0IHggPSB0aGlzLng7CiAgICAgIGNvbnN0IHkgPSB0aGlzLnk7CiAgICAgIGNvbnN0IHogPSB0aGlzLno7CiAgICAgIGNvbnN0IHB4ID0gcC54OwogICAgICBjb25zdCBweSA9IHAueTsKICAgICAgY29uc3QgcHogPSBwLno7CiAgICAgIHJldHVybiBNYXRoLnNxcnQoKHB4IC0geCkgKiAocHggLSB4KSArIChweSAtIHkpICogKHB5IC0geSkgKyAocHogLSB6KSAqIChweiAtIHopKTsKICAgIH0KICAgIC8qKgogICAgICogR2V0IHNxdWFyZWQgZGlzdGFuY2UgZnJvbSB0aGlzIHBvaW50IHRvIGFub3RoZXIgcG9pbnQKICAgICAqLwoKCiAgICBkaXN0YW5jZVNxdWFyZWQocCkgewogICAgICBjb25zdCB4ID0gdGhpcy54OwogICAgICBjb25zdCB5ID0gdGhpcy55OwogICAgICBjb25zdCB6ID0gdGhpcy56OwogICAgICBjb25zdCBweCA9IHAueDsKICAgICAgY29uc3QgcHkgPSBwLnk7CiAgICAgIGNvbnN0IHB6ID0gcC56OwogICAgICByZXR1cm4gKHB4IC0geCkgKiAocHggLSB4KSArIChweSAtIHkpICogKHB5IC0geSkgKyAocHogLSB6KSAqIChweiAtIHopOwogICAgfQogICAgLyoqCiAgICAgKiBNdWx0aXBseSBhbGwgdGhlIGNvbXBvbmVudHMgb2YgdGhlIHZlY3RvciB3aXRoIGEgc2NhbGFyLgogICAgICogQHBhcmFtIHRhcmdldCBUaGUgdmVjdG9yIHRvIHNhdmUgdGhlIHJlc3VsdCBpbi4KICAgICAqLwoKCiAgICBzY2FsZShzY2FsYXIsIHRhcmdldCkgewogICAgICBpZiAodGFyZ2V0ID09PSB2b2lkIDApIHsKICAgICAgICB0YXJnZXQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICBjb25zdCB4ID0gdGhpcy54OwogICAgICBjb25zdCB5ID0gdGhpcy55OwogICAgICBjb25zdCB6ID0gdGhpcy56OwogICAgICB0YXJnZXQueCA9IHNjYWxhciAqIHg7CiAgICAgIHRhcmdldC55ID0gc2NhbGFyICogeTsKICAgICAgdGFyZ2V0LnogPSBzY2FsYXIgKiB6OwogICAgICByZXR1cm4gdGFyZ2V0OwogICAgfQogICAgLyoqCiAgICAgKiBNdWx0aXBseSB0aGUgdmVjdG9yIHdpdGggYW4gb3RoZXIgdmVjdG9yLCBjb21wb25lbnQtd2lzZS4KICAgICAqIEBwYXJhbSB0YXJnZXQgVGhlIHZlY3RvciB0byBzYXZlIHRoZSByZXN1bHQgaW4uCiAgICAgKi8KCgogICAgdm11bCh2ZWN0b3IsIHRhcmdldCkgewogICAgICBpZiAodGFyZ2V0ID09PSB2b2lkIDApIHsKICAgICAgICB0YXJnZXQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICB0YXJnZXQueCA9IHZlY3Rvci54ICogdGhpcy54OwogICAgICB0YXJnZXQueSA9IHZlY3Rvci55ICogdGhpcy55OwogICAgICB0YXJnZXQueiA9IHZlY3Rvci56ICogdGhpcy56OwogICAgICByZXR1cm4gdGFyZ2V0OwogICAgfQogICAgLyoqCiAgICAgKiBTY2FsZSBhIHZlY3RvciBhbmQgYWRkIGl0IHRvIHRoaXMgdmVjdG9yLiBTYXZlIHRoZSByZXN1bHQgaW4gInRhcmdldCIuICh0YXJnZXQgPSB0aGlzICsgdmVjdG9yICogc2NhbGFyKQogICAgICogQHBhcmFtIHRhcmdldCBUaGUgdmVjdG9yIHRvIHNhdmUgdGhlIHJlc3VsdCBpbi4KICAgICAqLwoKCiAgICBhZGRTY2FsZWRWZWN0b3Ioc2NhbGFyLCB2ZWN0b3IsIHRhcmdldCkgewogICAgICBpZiAodGFyZ2V0ID09PSB2b2lkIDApIHsKICAgICAgICB0YXJnZXQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICB0YXJnZXQueCA9IHRoaXMueCArIHNjYWxhciAqIHZlY3Rvci54OwogICAgICB0YXJnZXQueSA9IHRoaXMueSArIHNjYWxhciAqIHZlY3Rvci55OwogICAgICB0YXJnZXQueiA9IHRoaXMueiArIHNjYWxhciAqIHZlY3Rvci56OwogICAgICByZXR1cm4gdGFyZ2V0OwogICAgfQogICAgLyoqCiAgICAgKiBDYWxjdWxhdGUgZG90IHByb2R1Y3QKICAgICAqIEBwYXJhbSB2ZWN0b3IKICAgICAqLwoKCiAgICBkb3QodmVjdG9yKSB7CiAgICAgIHJldHVybiB0aGlzLnggKiB2ZWN0b3IueCArIHRoaXMueSAqIHZlY3Rvci55ICsgdGhpcy56ICogdmVjdG9yLno7CiAgICB9CgogICAgaXNaZXJvKCkgewogICAgICByZXR1cm4gdGhpcy54ID09PSAwICYmIHRoaXMueSA9PT0gMCAmJiB0aGlzLnogPT09IDA7CiAgICB9CiAgICAvKioKICAgICAqIE1ha2UgdGhlIHZlY3RvciBwb2ludCBpbiB0aGUgb3Bwb3NpdGUgZGlyZWN0aW9uLgogICAgICogQHBhcmFtIHRhcmdldCBPcHRpb25hbCB0YXJnZXQgdG8gc2F2ZSBpbgogICAgICovCgoKICAgIG5lZ2F0ZSh0YXJnZXQpIHsKICAgICAgaWYgKHRhcmdldCA9PT0gdm9pZCAwKSB7CiAgICAgICAgdGFyZ2V0ID0gbmV3IFZlYzMoKTsKICAgICAgfQoKICAgICAgdGFyZ2V0LnggPSAtdGhpcy54OwogICAgICB0YXJnZXQueSA9IC10aGlzLnk7CiAgICAgIHRhcmdldC56ID0gLXRoaXMuejsKICAgICAgcmV0dXJuIHRhcmdldDsKICAgIH0KICAgIC8qKgogICAgICogQ29tcHV0ZSB0d28gYXJ0aWZpY2lhbCB0YW5nZW50cyB0byB0aGUgdmVjdG9yCiAgICAgKiBAcGFyYW0gdDEgVmVjdG9yIG9iamVjdCB0byBzYXZlIHRoZSBmaXJzdCB0YW5nZW50IGluCiAgICAgKiBAcGFyYW0gdDIgVmVjdG9yIG9iamVjdCB0byBzYXZlIHRoZSBzZWNvbmQgdGFuZ2VudCBpbgogICAgICovCgoKICAgIHRhbmdlbnRzKHQxLCB0MikgewogICAgICBjb25zdCBub3JtID0gdGhpcy5sZW5ndGgoKTsKCiAgICAgIGlmIChub3JtID4gMC4wKSB7CiAgICAgICAgY29uc3QgbiA9IFZlYzNfdGFuZ2VudHNfbjsKICAgICAgICBjb25zdCBpbm9ybSA9IDEgLyBub3JtOwogICAgICAgIG4uc2V0KHRoaXMueCAqIGlub3JtLCB0aGlzLnkgKiBpbm9ybSwgdGhpcy56ICogaW5vcm0pOwogICAgICAgIGNvbnN0IHJhbmRWZWMgPSBWZWMzX3RhbmdlbnRzX3JhbmRWZWM7CgogICAgICAgIGlmIChNYXRoLmFicyhuLngpIDwgMC45KSB7CiAgICAgICAgICByYW5kVmVjLnNldCgxLCAwLCAwKTsKICAgICAgICAgIG4uY3Jvc3MocmFuZFZlYywgdDEpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICByYW5kVmVjLnNldCgwLCAxLCAwKTsKICAgICAgICAgIG4uY3Jvc3MocmFuZFZlYywgdDEpOwogICAgICAgIH0KCiAgICAgICAgbi5jcm9zcyh0MSwgdDIpOwogICAgICB9IGVsc2UgewogICAgICAgIC8vIFRoZSBub3JtYWwgbGVuZ3RoIGlzIHplcm8sIG1ha2Ugc29tZXRoaW5nIHVwCiAgICAgICAgdDEuc2V0KDEsIDAsIDApOwogICAgICAgIHQyLnNldCgwLCAxLCAwKTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBDb252ZXJ0cyB0byBhIG1vcmUgcmVhZGFibGUgZm9ybWF0CiAgICAgKi8KCgogICAgdG9TdHJpbmcoKSB7CiAgICAgIHJldHVybiBgJHt0aGlzLnh9LCR7dGhpcy55fSwke3RoaXMuen1gOwogICAgfQogICAgLyoqCiAgICAgKiBDb252ZXJ0cyB0byBhbiBhcnJheQogICAgICovCgoKICAgIHRvQXJyYXkoKSB7CiAgICAgIHJldHVybiBbdGhpcy54LCB0aGlzLnksIHRoaXMuel07CiAgICB9CiAgICAvKioKICAgICAqIENvcGllcyB2YWx1ZSBvZiBzb3VyY2UgdG8gdGhpcyB2ZWN0b3IuCiAgICAgKi8KCgogICAgY29weSh2ZWN0b3IpIHsKICAgICAgdGhpcy54ID0gdmVjdG9yLng7CiAgICAgIHRoaXMueSA9IHZlY3Rvci55OwogICAgICB0aGlzLnogPSB2ZWN0b3IuejsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICAvKioKICAgICAqIERvIGEgbGluZWFyIGludGVycG9sYXRpb24gYmV0d2VlbiB0d28gdmVjdG9ycwogICAgICogQHBhcmFtIHQgQSBudW1iZXIgYmV0d2VlbiAwIGFuZCAxLiAwIHdpbGwgbWFrZSB0aGlzIGZ1bmN0aW9uIHJldHVybiB1LCBhbmQgMSB3aWxsIG1ha2UgaXQgcmV0dXJuIHYuIE51bWJlcnMgaW4gYmV0d2VlbiB3aWxsIGdlbmVyYXRlIGEgdmVjdG9yIGluIGJldHdlZW4gdGhlbS4KICAgICAqLwoKCiAgICBsZXJwKHZlY3RvciwgdCwgdGFyZ2V0KSB7CiAgICAgIGNvbnN0IHggPSB0aGlzLng7CiAgICAgIGNvbnN0IHkgPSB0aGlzLnk7CiAgICAgIGNvbnN0IHogPSB0aGlzLno7CiAgICAgIHRhcmdldC54ID0geCArICh2ZWN0b3IueCAtIHgpICogdDsKICAgICAgdGFyZ2V0LnkgPSB5ICsgKHZlY3Rvci55IC0geSkgKiB0OwogICAgICB0YXJnZXQueiA9IHogKyAodmVjdG9yLnogLSB6KSAqIHQ7CiAgICB9CiAgICAvKioKICAgICAqIENoZWNrIGlmIGEgdmVjdG9yIGVxdWFscyBpcyBhbG1vc3QgZXF1YWwgdG8gYW5vdGhlciBvbmUuCiAgICAgKi8KCgogICAgYWxtb3N0RXF1YWxzKHZlY3RvciwgcHJlY2lzaW9uKSB7CiAgICAgIGlmIChwcmVjaXNpb24gPT09IHZvaWQgMCkgewogICAgICAgIHByZWNpc2lvbiA9IDFlLTY7CiAgICAgIH0KCiAgICAgIGlmIChNYXRoLmFicyh0aGlzLnggLSB2ZWN0b3IueCkgPiBwcmVjaXNpb24gfHwgTWF0aC5hYnModGhpcy55IC0gdmVjdG9yLnkpID4gcHJlY2lzaW9uIHx8IE1hdGguYWJzKHRoaXMueiAtIHZlY3Rvci56KSA+IHByZWNpc2lvbikgewogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQoKICAgICAgcmV0dXJuIHRydWU7CiAgICB9CiAgICAvKioKICAgICAqIENoZWNrIGlmIGEgdmVjdG9yIGlzIGFsbW9zdCB6ZXJvCiAgICAgKi8KCgogICAgYWxtb3N0WmVybyhwcmVjaXNpb24pIHsKICAgICAgaWYgKHByZWNpc2lvbiA9PT0gdm9pZCAwKSB7CiAgICAgICAgcHJlY2lzaW9uID0gMWUtNjsKICAgICAgfQoKICAgICAgaWYgKE1hdGguYWJzKHRoaXMueCkgPiBwcmVjaXNpb24gfHwgTWF0aC5hYnModGhpcy55KSA+IHByZWNpc2lvbiB8fCBNYXRoLmFicyh0aGlzLnopID4gcHJlY2lzaW9uKSB7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9CgogICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KICAgIC8qKgogICAgICogQ2hlY2sgaWYgdGhlIHZlY3RvciBpcyBhbnRpLXBhcmFsbGVsIHRvIGFub3RoZXIgdmVjdG9yLgogICAgICogQHBhcmFtIHByZWNpc2lvbiBTZXQgdG8gemVybyBmb3IgZXhhY3QgY29tcGFyaXNvbnMKICAgICAqLwoKCiAgICBpc0FudGlwYXJhbGxlbFRvKHZlY3RvciwgcHJlY2lzaW9uKSB7CiAgICAgIHRoaXMubmVnYXRlKGFudGlwX25lZyk7CiAgICAgIHJldHVybiBhbnRpcF9uZWcuYWxtb3N0RXF1YWxzKHZlY3RvciwgcHJlY2lzaW9uKTsKICAgIH0KICAgIC8qKgogICAgICogQ2xvbmUgdGhlIHZlY3RvcgogICAgICovCgoKICAgIGNsb25lKCkgewogICAgICByZXR1cm4gbmV3IFZlYzModGhpcy54LCB0aGlzLnksIHRoaXMueik7CiAgICB9CgogIH0KICBWZWMzLlpFUk8gPSBuZXcgVmVjMygwLCAwLCAwKTsKICBWZWMzLlVOSVRfWCA9IG5ldyBWZWMzKDEsIDAsIDApOwogIFZlYzMuVU5JVF9ZID0gbmV3IFZlYzMoMCwgMSwgMCk7CiAgVmVjMy5VTklUX1ogPSBuZXcgVmVjMygwLCAwLCAxKTsKICBjb25zdCBWZWMzX3RhbmdlbnRzX24gPSBuZXcgVmVjMygpOwogIGNvbnN0IFZlYzNfdGFuZ2VudHNfcmFuZFZlYyA9IG5ldyBWZWMzKCk7CiAgY29uc3QgYW50aXBfbmVnID0gbmV3IFZlYzMoKTsKCiAgLyoqCiAgICogQXhpcyBhbGlnbmVkIGJvdW5kaW5nIGJveCBjbGFzcy4KICAgKi8KICBjbGFzcyBBQUJCIHsKICAgIC8qKgogICAgICogVGhlIGxvd2VyIGJvdW5kIG9mIHRoZSBib3VuZGluZyBib3gKICAgICAqLwoKICAgIC8qKgogICAgICogVGhlIHVwcGVyIGJvdW5kIG9mIHRoZSBib3VuZGluZyBib3gKICAgICAqLwogICAgY29uc3RydWN0b3Iob3B0aW9ucykgewogICAgICBpZiAob3B0aW9ucyA9PT0gdm9pZCAwKSB7CiAgICAgICAgb3B0aW9ucyA9IHt9OwogICAgICB9CgogICAgICB0aGlzLmxvd2VyQm91bmQgPSBuZXcgVmVjMygpOwogICAgICB0aGlzLnVwcGVyQm91bmQgPSBuZXcgVmVjMygpOwoKICAgICAgaWYgKG9wdGlvbnMubG93ZXJCb3VuZCkgewogICAgICAgIHRoaXMubG93ZXJCb3VuZC5jb3B5KG9wdGlvbnMubG93ZXJCb3VuZCk7CiAgICAgIH0KCiAgICAgIGlmIChvcHRpb25zLnVwcGVyQm91bmQpIHsKICAgICAgICB0aGlzLnVwcGVyQm91bmQuY29weShvcHRpb25zLnVwcGVyQm91bmQpOwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIFNldCB0aGUgQUFCQiBib3VuZHMgZnJvbSBhIHNldCBvZiBwb2ludHMuCiAgICAgKiBAcGFyYW0gcG9pbnRzIEFuIGFycmF5IG9mIFZlYzMncy4KICAgICAqIEByZXR1cm4gVGhlIHNlbGYgb2JqZWN0CiAgICAgKi8KCgogICAgc2V0RnJvbVBvaW50cyhwb2ludHMsIHBvc2l0aW9uLCBxdWF0ZXJuaW9uLCBza2luU2l6ZSkgewogICAgICBjb25zdCBsID0gdGhpcy5sb3dlckJvdW5kOwogICAgICBjb25zdCB1ID0gdGhpcy51cHBlckJvdW5kOwogICAgICBjb25zdCBxID0gcXVhdGVybmlvbjsgLy8gU2V0IHRvIHRoZSBmaXJzdCBwb2ludAoKICAgICAgbC5jb3B5KHBvaW50c1swXSk7CgogICAgICBpZiAocSkgewogICAgICAgIHEudm11bHQobCwgbCk7CiAgICAgIH0KCiAgICAgIHUuY29weShsKTsKCiAgICAgIGZvciAobGV0IGkgPSAxOyBpIDwgcG9pbnRzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgbGV0IHAgPSBwb2ludHNbaV07CgogICAgICAgIGlmIChxKSB7CiAgICAgICAgICBxLnZtdWx0KHAsIHRtcCQxKTsKICAgICAgICAgIHAgPSB0bXAkMTsKICAgICAgICB9CgogICAgICAgIGlmIChwLnggPiB1LngpIHsKICAgICAgICAgIHUueCA9IHAueDsKICAgICAgICB9CgogICAgICAgIGlmIChwLnggPCBsLngpIHsKICAgICAgICAgIGwueCA9IHAueDsKICAgICAgICB9CgogICAgICAgIGlmIChwLnkgPiB1LnkpIHsKICAgICAgICAgIHUueSA9IHAueTsKICAgICAgICB9CgogICAgICAgIGlmIChwLnkgPCBsLnkpIHsKICAgICAgICAgIGwueSA9IHAueTsKICAgICAgICB9CgogICAgICAgIGlmIChwLnogPiB1LnopIHsKICAgICAgICAgIHUueiA9IHAuejsKICAgICAgICB9CgogICAgICAgIGlmIChwLnogPCBsLnopIHsKICAgICAgICAgIGwueiA9IHAuejsKICAgICAgICB9CiAgICAgIH0gLy8gQWRkIG9mZnNldAoKCiAgICAgIGlmIChwb3NpdGlvbikgewogICAgICAgIHBvc2l0aW9uLnZhZGQobCwgbCk7CiAgICAgICAgcG9zaXRpb24udmFkZCh1LCB1KTsKICAgICAgfQoKICAgICAgaWYgKHNraW5TaXplKSB7CiAgICAgICAgbC54IC09IHNraW5TaXplOwogICAgICAgIGwueSAtPSBza2luU2l6ZTsKICAgICAgICBsLnogLT0gc2tpblNpemU7CiAgICAgICAgdS54ICs9IHNraW5TaXplOwogICAgICAgIHUueSArPSBza2luU2l6ZTsKICAgICAgICB1LnogKz0gc2tpblNpemU7CiAgICAgIH0KCiAgICAgIHJldHVybiB0aGlzOwogICAgfQogICAgLyoqCiAgICAgKiBDb3B5IGJvdW5kcyBmcm9tIGFuIEFBQkIgdG8gdGhpcyBBQUJCCiAgICAgKiBAcGFyYW0gYWFiYiBTb3VyY2UgdG8gY29weSBmcm9tCiAgICAgKiBAcmV0dXJuIFRoZSB0aGlzIG9iamVjdCwgZm9yIGNoYWluYWJpbGl0eQogICAgICovCgoKICAgIGNvcHkoYWFiYikgewogICAgICB0aGlzLmxvd2VyQm91bmQuY29weShhYWJiLmxvd2VyQm91bmQpOwogICAgICB0aGlzLnVwcGVyQm91bmQuY29weShhYWJiLnVwcGVyQm91bmQpOwogICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIC8qKgogICAgICogQ2xvbmUgYW4gQUFCQgogICAgICovCgoKICAgIGNsb25lKCkgewogICAgICByZXR1cm4gbmV3IEFBQkIoKS5jb3B5KHRoaXMpOwogICAgfQogICAgLyoqCiAgICAgKiBFeHRlbmQgdGhpcyBBQUJCIHNvIHRoYXQgaXQgY292ZXJzIHRoZSBnaXZlbiBBQUJCIHRvby4KICAgICAqLwoKCiAgICBleHRlbmQoYWFiYikgewogICAgICB0aGlzLmxvd2VyQm91bmQueCA9IE1hdGgubWluKHRoaXMubG93ZXJCb3VuZC54LCBhYWJiLmxvd2VyQm91bmQueCk7CiAgICAgIHRoaXMudXBwZXJCb3VuZC54ID0gTWF0aC5tYXgodGhpcy51cHBlckJvdW5kLngsIGFhYmIudXBwZXJCb3VuZC54KTsKICAgICAgdGhpcy5sb3dlckJvdW5kLnkgPSBNYXRoLm1pbih0aGlzLmxvd2VyQm91bmQueSwgYWFiYi5sb3dlckJvdW5kLnkpOwogICAgICB0aGlzLnVwcGVyQm91bmQueSA9IE1hdGgubWF4KHRoaXMudXBwZXJCb3VuZC55LCBhYWJiLnVwcGVyQm91bmQueSk7CiAgICAgIHRoaXMubG93ZXJCb3VuZC56ID0gTWF0aC5taW4odGhpcy5sb3dlckJvdW5kLnosIGFhYmIubG93ZXJCb3VuZC56KTsKICAgICAgdGhpcy51cHBlckJvdW5kLnogPSBNYXRoLm1heCh0aGlzLnVwcGVyQm91bmQueiwgYWFiYi51cHBlckJvdW5kLnopOwogICAgfQogICAgLyoqCiAgICAgKiBSZXR1cm5zIHRydWUgaWYgdGhlIGdpdmVuIEFBQkIgb3ZlcmxhcHMgdGhpcyBBQUJCLgogICAgICovCgoKICAgIG92ZXJsYXBzKGFhYmIpIHsKICAgICAgY29uc3QgbDEgPSB0aGlzLmxvd2VyQm91bmQ7CiAgICAgIGNvbnN0IHUxID0gdGhpcy51cHBlckJvdW5kOwogICAgICBjb25zdCBsMiA9IGFhYmIubG93ZXJCb3VuZDsKICAgICAgY29uc3QgdTIgPSBhYWJiLnVwcGVyQm91bmQ7IC8vICAgICAgbDIgICAgICAgIHUyCiAgICAgIC8vICAgICAgfC0tLS0tLS0tLXwKICAgICAgLy8gfC0tLS0tLS0tfAogICAgICAvLyBsMSAgICAgICB1MQoKICAgICAgY29uc3Qgb3ZlcmxhcHNYID0gbDIueCA8PSB1MS54ICYmIHUxLnggPD0gdTIueCB8fCBsMS54IDw9IHUyLnggJiYgdTIueCA8PSB1MS54OwogICAgICBjb25zdCBvdmVybGFwc1kgPSBsMi55IDw9IHUxLnkgJiYgdTEueSA8PSB1Mi55IHx8IGwxLnkgPD0gdTIueSAmJiB1Mi55IDw9IHUxLnk7CiAgICAgIGNvbnN0IG92ZXJsYXBzWiA9IGwyLnogPD0gdTEueiAmJiB1MS56IDw9IHUyLnogfHwgbDEueiA8PSB1Mi56ICYmIHUyLnogPD0gdTEuejsKICAgICAgcmV0dXJuIG92ZXJsYXBzWCAmJiBvdmVybGFwc1kgJiYgb3ZlcmxhcHNaOwogICAgfSAvLyBNb3N0bHkgZm9yIGRlYnVnZ2luZwoKCiAgICB2b2x1bWUoKSB7CiAgICAgIGNvbnN0IGwgPSB0aGlzLmxvd2VyQm91bmQ7CiAgICAgIGNvbnN0IHUgPSB0aGlzLnVwcGVyQm91bmQ7CiAgICAgIHJldHVybiAodS54IC0gbC54KSAqICh1LnkgLSBsLnkpICogKHUueiAtIGwueik7CiAgICB9CiAgICAvKioKICAgICAqIFJldHVybnMgdHJ1ZSBpZiB0aGUgZ2l2ZW4gQUFCQiBpcyBmdWxseSBjb250YWluZWQgaW4gdGhpcyBBQUJCLgogICAgICovCgoKICAgIGNvbnRhaW5zKGFhYmIpIHsKICAgICAgY29uc3QgbDEgPSB0aGlzLmxvd2VyQm91bmQ7CiAgICAgIGNvbnN0IHUxID0gdGhpcy51cHBlckJvdW5kOwogICAgICBjb25zdCBsMiA9IGFhYmIubG93ZXJCb3VuZDsKICAgICAgY29uc3QgdTIgPSBhYWJiLnVwcGVyQm91bmQ7IC8vICAgICAgbDIgICAgICAgIHUyCiAgICAgIC8vICAgICAgfC0tLS0tLS0tLXwKICAgICAgLy8gfC0tLS0tLS0tLS0tLS0tLXwKICAgICAgLy8gbDEgICAgICAgICAgICAgIHUxCgogICAgICByZXR1cm4gbDEueCA8PSBsMi54ICYmIHUxLnggPj0gdTIueCAmJiBsMS55IDw9IGwyLnkgJiYgdTEueSA+PSB1Mi55ICYmIGwxLnogPD0gbDIueiAmJiB1MS56ID49IHUyLno7CiAgICB9CgogICAgZ2V0Q29ybmVycyhhLCBiLCBjLCBkLCBlLCBmLCBnLCBoKSB7CiAgICAgIGNvbnN0IGwgPSB0aGlzLmxvd2VyQm91bmQ7CiAgICAgIGNvbnN0IHUgPSB0aGlzLnVwcGVyQm91bmQ7CiAgICAgIGEuY29weShsKTsKICAgICAgYi5zZXQodS54LCBsLnksIGwueik7CiAgICAgIGMuc2V0KHUueCwgdS55LCBsLnopOwogICAgICBkLnNldChsLngsIHUueSwgdS56KTsKICAgICAgZS5zZXQodS54LCBsLnksIHUueik7CiAgICAgIGYuc2V0KGwueCwgdS55LCBsLnopOwogICAgICBnLnNldChsLngsIGwueSwgdS56KTsKICAgICAgaC5jb3B5KHUpOwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgdGhlIHJlcHJlc2VudGF0aW9uIG9mIGFuIEFBQkIgaW4gYW5vdGhlciBmcmFtZS4KICAgICAqIEByZXR1cm4gVGhlICJ0YXJnZXQiIEFBQkIgb2JqZWN0LgogICAgICovCgoKICAgIHRvTG9jYWxGcmFtZShmcmFtZSwgdGFyZ2V0KSB7CiAgICAgIGNvbnN0IGNvcm5lcnMgPSB0cmFuc2Zvcm1JbnRvRnJhbWVfY29ybmVyczsKICAgICAgY29uc3QgYSA9IGNvcm5lcnNbMF07CiAgICAgIGNvbnN0IGIgPSBjb3JuZXJzWzFdOwogICAgICBjb25zdCBjID0gY29ybmVyc1syXTsKICAgICAgY29uc3QgZCA9IGNvcm5lcnNbM107CiAgICAgIGNvbnN0IGUgPSBjb3JuZXJzWzRdOwogICAgICBjb25zdCBmID0gY29ybmVyc1s1XTsKICAgICAgY29uc3QgZyA9IGNvcm5lcnNbNl07CiAgICAgIGNvbnN0IGggPSBjb3JuZXJzWzddOyAvLyBHZXQgY29ybmVycyBpbiBjdXJyZW50IGZyYW1lCgogICAgICB0aGlzLmdldENvcm5lcnMoYSwgYiwgYywgZCwgZSwgZiwgZywgaCk7IC8vIFRyYW5zZm9ybSB0aGVtIHRvIG5ldyBsb2NhbCBmcmFtZQoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IDg7IGkrKykgewogICAgICAgIGNvbnN0IGNvcm5lciA9IGNvcm5lcnNbaV07CiAgICAgICAgZnJhbWUucG9pbnRUb0xvY2FsKGNvcm5lciwgY29ybmVyKTsKICAgICAgfQoKICAgICAgcmV0dXJuIHRhcmdldC5zZXRGcm9tUG9pbnRzKGNvcm5lcnMpOwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgdGhlIHJlcHJlc2VudGF0aW9uIG9mIGFuIEFBQkIgaW4gdGhlIGdsb2JhbCBmcmFtZS4KICAgICAqIEByZXR1cm4gVGhlICJ0YXJnZXQiIEFBQkIgb2JqZWN0LgogICAgICovCgoKICAgIHRvV29ybGRGcmFtZShmcmFtZSwgdGFyZ2V0KSB7CiAgICAgIGNvbnN0IGNvcm5lcnMgPSB0cmFuc2Zvcm1JbnRvRnJhbWVfY29ybmVyczsKICAgICAgY29uc3QgYSA9IGNvcm5lcnNbMF07CiAgICAgIGNvbnN0IGIgPSBjb3JuZXJzWzFdOwogICAgICBjb25zdCBjID0gY29ybmVyc1syXTsKICAgICAgY29uc3QgZCA9IGNvcm5lcnNbM107CiAgICAgIGNvbnN0IGUgPSBjb3JuZXJzWzRdOwogICAgICBjb25zdCBmID0gY29ybmVyc1s1XTsKICAgICAgY29uc3QgZyA9IGNvcm5lcnNbNl07CiAgICAgIGNvbnN0IGggPSBjb3JuZXJzWzddOyAvLyBHZXQgY29ybmVycyBpbiBjdXJyZW50IGZyYW1lCgogICAgICB0aGlzLmdldENvcm5lcnMoYSwgYiwgYywgZCwgZSwgZiwgZywgaCk7IC8vIFRyYW5zZm9ybSB0aGVtIHRvIG5ldyBsb2NhbCBmcmFtZQoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IDg7IGkrKykgewogICAgICAgIGNvbnN0IGNvcm5lciA9IGNvcm5lcnNbaV07CiAgICAgICAgZnJhbWUucG9pbnRUb1dvcmxkKGNvcm5lciwgY29ybmVyKTsKICAgICAgfQoKICAgICAgcmV0dXJuIHRhcmdldC5zZXRGcm9tUG9pbnRzKGNvcm5lcnMpOwogICAgfQogICAgLyoqCiAgICAgKiBDaGVjayBpZiB0aGUgQUFCQiBpcyBoaXQgYnkgYSByYXkuCiAgICAgKi8KCgogICAgb3ZlcmxhcHNSYXkocmF5KSB7CiAgICAgIGNvbnN0IHsKICAgICAgICBkaXJlY3Rpb24sCiAgICAgICAgZnJvbQogICAgICB9ID0gcmF5OyAvLyBjb25zdCB0ID0gMAogICAgICAvLyByYXkuZGlyZWN0aW9uIGlzIHVuaXQgZGlyZWN0aW9uIHZlY3RvciBvZiByYXkKCiAgICAgIGNvbnN0IGRpckZyYWNYID0gMSAvIGRpcmVjdGlvbi54OwogICAgICBjb25zdCBkaXJGcmFjWSA9IDEgLyBkaXJlY3Rpb24ueTsKICAgICAgY29uc3QgZGlyRnJhY1ogPSAxIC8gZGlyZWN0aW9uLno7IC8vIHRoaXMubG93ZXJCb3VuZCBpcyB0aGUgY29ybmVyIG9mIEFBQkIgd2l0aCBtaW5pbWFsIGNvb3JkaW5hdGVzIC0gbGVmdCBib3R0b20sIHJ0IGlzIG1heGltYWwgY29ybmVyCgogICAgICBjb25zdCB0MSA9ICh0aGlzLmxvd2VyQm91bmQueCAtIGZyb20ueCkgKiBkaXJGcmFjWDsKICAgICAgY29uc3QgdDIgPSAodGhpcy51cHBlckJvdW5kLnggLSBmcm9tLngpICogZGlyRnJhY1g7CiAgICAgIGNvbnN0IHQzID0gKHRoaXMubG93ZXJCb3VuZC55IC0gZnJvbS55KSAqIGRpckZyYWNZOwogICAgICBjb25zdCB0NCA9ICh0aGlzLnVwcGVyQm91bmQueSAtIGZyb20ueSkgKiBkaXJGcmFjWTsKICAgICAgY29uc3QgdDUgPSAodGhpcy5sb3dlckJvdW5kLnogLSBmcm9tLnopICogZGlyRnJhY1o7CiAgICAgIGNvbnN0IHQ2ID0gKHRoaXMudXBwZXJCb3VuZC56IC0gZnJvbS56KSAqIGRpckZyYWNaOyAvLyBjb25zdCB0bWluID0gTWF0aC5tYXgoTWF0aC5tYXgoTWF0aC5taW4odDEsIHQyKSwgTWF0aC5taW4odDMsIHQ0KSkpOwogICAgICAvLyBjb25zdCB0bWF4ID0gTWF0aC5taW4oTWF0aC5taW4oTWF0aC5tYXgodDEsIHQyKSwgTWF0aC5tYXgodDMsIHQ0KSkpOwoKICAgICAgY29uc3QgdG1pbiA9IE1hdGgubWF4KE1hdGgubWF4KE1hdGgubWluKHQxLCB0MiksIE1hdGgubWluKHQzLCB0NCkpLCBNYXRoLm1pbih0NSwgdDYpKTsKICAgICAgY29uc3QgdG1heCA9IE1hdGgubWluKE1hdGgubWluKE1hdGgubWF4KHQxLCB0MiksIE1hdGgubWF4KHQzLCB0NCkpLCBNYXRoLm1heCh0NSwgdDYpKTsgLy8gaWYgdG1heCA8IDAsIHJheSAobGluZSkgaXMgaW50ZXJzZWN0aW5nIEFBQkIsIGJ1dCB3aG9sZSBBQUJCIGlzIGJlaGluZyB1cwoKICAgICAgaWYgKHRtYXggPCAwKSB7CiAgICAgICAgLy90ID0gdG1heDsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0gLy8gaWYgdG1pbiA+IHRtYXgsIHJheSBkb2Vzbid0IGludGVyc2VjdCBBQUJCCgoKICAgICAgaWYgKHRtaW4gPiB0bWF4KSB7CiAgICAgICAgLy90ID0gdG1heDsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0KCiAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICB9CiAgY29uc3QgdG1wJDEgPSBuZXcgVmVjMygpOwogIGNvbnN0IHRyYW5zZm9ybUludG9GcmFtZV9jb3JuZXJzID0gW25ldyBWZWMzKCksIG5ldyBWZWMzKCksIG5ldyBWZWMzKCksIG5ldyBWZWMzKCksIG5ldyBWZWMzKCksIG5ldyBWZWMzKCksIG5ldyBWZWMzKCksIG5ldyBWZWMzKCldOwoKICAvKioKICAgKiBDb2xsaXNpb24gIm1hdHJpeCIuCiAgICogSXQncyBhY3R1YWxseSBhIHRyaWFuZ3VsYXItc2hhcGVkIGFycmF5IG9mIHdoZXRoZXIgdHdvIGJvZGllcyBhcmUgdG91Y2hpbmcgdGhpcyBzdGVwLCBmb3IgcmVmZXJlbmNlIG5leHQgc3RlcAogICAqLwogIGNsYXNzIEFycmF5Q29sbGlzaW9uTWF0cml4IHsKICAgIC8qKgogICAgICogVGhlIG1hdHJpeCBzdG9yYWdlLgogICAgICovCiAgICBjb25zdHJ1Y3RvcigpIHsKICAgICAgdGhpcy5tYXRyaXggPSBbXTsKICAgIH0KICAgIC8qKgogICAgICogR2V0IGFuIGVsZW1lbnQKICAgICAqLwoKCiAgICBnZXQoYmksIGJqKSB7CiAgICAgIGxldCB7CiAgICAgICAgaW5kZXg6IGkKICAgICAgfSA9IGJpOwogICAgICBsZXQgewogICAgICAgIGluZGV4OiBqCiAgICAgIH0gPSBiajsKCiAgICAgIGlmIChqID4gaSkgewogICAgICAgIGNvbnN0IHRlbXAgPSBqOwogICAgICAgIGogPSBpOwogICAgICAgIGkgPSB0ZW1wOwogICAgICB9CgogICAgICByZXR1cm4gdGhpcy5tYXRyaXhbKGkgKiAoaSArIDEpID4+IDEpICsgaiAtIDFdOwogICAgfQogICAgLyoqCiAgICAgKiBTZXQgYW4gZWxlbWVudAogICAgICovCgoKICAgIHNldChiaSwgYmosIHZhbHVlKSB7CiAgICAgIGxldCB7CiAgICAgICAgaW5kZXg6IGkKICAgICAgfSA9IGJpOwogICAgICBsZXQgewogICAgICAgIGluZGV4OiBqCiAgICAgIH0gPSBiajsKCiAgICAgIGlmIChqID4gaSkgewogICAgICAgIGNvbnN0IHRlbXAgPSBqOwogICAgICAgIGogPSBpOwogICAgICAgIGkgPSB0ZW1wOwogICAgICB9CgogICAgICB0aGlzLm1hdHJpeFsoaSAqIChpICsgMSkgPj4gMSkgKyBqIC0gMV0gPSB2YWx1ZSA/IDEgOiAwOwogICAgfQogICAgLyoqCiAgICAgKiBTZXRzIGFsbCBlbGVtZW50cyB0byB6ZXJvCiAgICAgKi8KCgogICAgcmVzZXQoKSB7CiAgICAgIGZvciAobGV0IGkgPSAwLCBsID0gdGhpcy5tYXRyaXgubGVuZ3RoOyBpICE9PSBsOyBpKyspIHsKICAgICAgICB0aGlzLm1hdHJpeFtpXSA9IDA7CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogU2V0cyB0aGUgbWF4IG51bWJlciBvZiBvYmplY3RzCiAgICAgKi8KCgogICAgc2V0TnVtT2JqZWN0cyhuKSB7CiAgICAgIHRoaXMubWF0cml4Lmxlbmd0aCA9IG4gKiAobiAtIDEpID4+IDE7CiAgICB9CgogIH0KCiAgLyoqCiAgICogQmFzZSBjbGFzcyBmb3Igb2JqZWN0cyB0aGF0IGRpc3BhdGNoZXMgZXZlbnRzLgogICAqLwogIGNsYXNzIEV2ZW50VGFyZ2V0IHsKICAgIC8qKgogICAgICogQWRkIGFuIGV2ZW50IGxpc3RlbmVyCiAgICAgKiBAcmV0dXJuIFRoZSBzZWxmIG9iamVjdCwgZm9yIGNoYWluYWJpbGl0eS4KICAgICAqLwogICAgYWRkRXZlbnRMaXN0ZW5lcih0eXBlLCBsaXN0ZW5lcikgewogICAgICBpZiAodGhpcy5fbGlzdGVuZXJzID09PSB1bmRlZmluZWQpIHsKICAgICAgICB0aGlzLl9saXN0ZW5lcnMgPSB7fTsKICAgICAgfQoKICAgICAgY29uc3QgbGlzdGVuZXJzID0gdGhpcy5fbGlzdGVuZXJzOwoKICAgICAgaWYgKGxpc3RlbmVyc1t0eXBlXSA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgbGlzdGVuZXJzW3R5cGVdID0gW107CiAgICAgIH0KCiAgICAgIGlmICghbGlzdGVuZXJzW3R5cGVdLmluY2x1ZGVzKGxpc3RlbmVyKSkgewogICAgICAgIGxpc3RlbmVyc1t0eXBlXS5wdXNoKGxpc3RlbmVyKTsKICAgICAgfQoKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICAvKioKICAgICAqIENoZWNrIGlmIGFuIGV2ZW50IGxpc3RlbmVyIGlzIGFkZGVkCiAgICAgKi8KCgogICAgaGFzRXZlbnRMaXN0ZW5lcih0eXBlLCBsaXN0ZW5lcikgewogICAgICBpZiAodGhpcy5fbGlzdGVuZXJzID09PSB1bmRlZmluZWQpIHsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0KCiAgICAgIGNvbnN0IGxpc3RlbmVycyA9IHRoaXMuX2xpc3RlbmVyczsKCiAgICAgIGlmIChsaXN0ZW5lcnNbdHlwZV0gIT09IHVuZGVmaW5lZCAmJiBsaXN0ZW5lcnNbdHlwZV0uaW5jbHVkZXMobGlzdGVuZXIpKSB7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgIH0KCiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KICAgIC8qKgogICAgICogQ2hlY2sgaWYgYW55IGV2ZW50IGxpc3RlbmVyIG9mIHRoZSBnaXZlbiB0eXBlIGlzIGFkZGVkCiAgICAgKi8KCgogICAgaGFzQW55RXZlbnRMaXN0ZW5lcih0eXBlKSB7CiAgICAgIGlmICh0aGlzLl9saXN0ZW5lcnMgPT09IHVuZGVmaW5lZCkgewogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQoKICAgICAgY29uc3QgbGlzdGVuZXJzID0gdGhpcy5fbGlzdGVuZXJzOwogICAgICByZXR1cm4gbGlzdGVuZXJzW3R5cGVdICE9PSB1bmRlZmluZWQ7CiAgICB9CiAgICAvKioKICAgICAqIFJlbW92ZSBhbiBldmVudCBsaXN0ZW5lcgogICAgICogQHJldHVybiBUaGUgc2VsZiBvYmplY3QsIGZvciBjaGFpbmFiaWxpdHkuCiAgICAgKi8KCgogICAgcmVtb3ZlRXZlbnRMaXN0ZW5lcih0eXBlLCBsaXN0ZW5lcikgewogICAgICBpZiAodGhpcy5fbGlzdGVuZXJzID09PSB1bmRlZmluZWQpIHsKICAgICAgICByZXR1cm4gdGhpczsKICAgICAgfQoKICAgICAgY29uc3QgbGlzdGVuZXJzID0gdGhpcy5fbGlzdGVuZXJzOwoKICAgICAgaWYgKGxpc3RlbmVyc1t0eXBlXSA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgIH0KCiAgICAgIGNvbnN0IGluZGV4ID0gbGlzdGVuZXJzW3R5cGVdLmluZGV4T2YobGlzdGVuZXIpOwoKICAgICAgaWYgKGluZGV4ICE9PSAtMSkgewogICAgICAgIGxpc3RlbmVyc1t0eXBlXS5zcGxpY2UoaW5kZXgsIDEpOwogICAgICB9CgogICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIC8qKgogICAgICogRW1pdCBhbiBldmVudC4KICAgICAqIEByZXR1cm4gVGhlIHNlbGYgb2JqZWN0LCBmb3IgY2hhaW5hYmlsaXR5LgogICAgICovCgoKICAgIGRpc3BhdGNoRXZlbnQoZXZlbnQpIHsKICAgICAgaWYgKHRoaXMuX2xpc3RlbmVycyA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgIH0KCiAgICAgIGNvbnN0IGxpc3RlbmVycyA9IHRoaXMuX2xpc3RlbmVyczsKICAgICAgY29uc3QgbGlzdGVuZXJBcnJheSA9IGxpc3RlbmVyc1tldmVudC50eXBlXTsKCiAgICAgIGlmIChsaXN0ZW5lckFycmF5ICE9PSB1bmRlZmluZWQpIHsKICAgICAgICBldmVudC50YXJnZXQgPSB0aGlzOwoKICAgICAgICBmb3IgKGxldCBpID0gMCwgbCA9IGxpc3RlbmVyQXJyYXkubGVuZ3RoOyBpIDwgbDsgaSsrKSB7CiAgICAgICAgICBsaXN0ZW5lckFycmF5W2ldLmNhbGwodGhpcywgZXZlbnQpOwogICAgICAgIH0KICAgICAgfQoKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CgogIH0KCiAgLyoqCiAgICogQSBRdWF0ZXJuaW9uIGRlc2NyaWJlcyBhIHJvdGF0aW9uIGluIDNEIHNwYWNlLiBUaGUgUXVhdGVybmlvbiBpcyBtYXRoZW1hdGljYWxseSBkZWZpbmVkIGFzIFEgPSB4KmkgKyB5KmogKyB6KmsgKyB3LCB3aGVyZSAoaSxqLGspIGFyZSBpbWFnaW5hcnkgYmFzaXMgdmVjdG9ycy4gKHgseSx6KSBjYW4gYmUgc2VlbiBhcyBhIHZlY3RvciByZWxhdGVkIHRvIHRoZSBheGlzIG9mIHJvdGF0aW9uLCB3aGlsZSB0aGUgcmVhbCBtdWx0aXBsaWVyLCB3LCBpcyByZWxhdGVkIHRvIHRoZSBhbW91bnQgb2Ygcm90YXRpb24uCiAgICogQHBhcmFtIHggTXVsdGlwbGllciBvZiB0aGUgaW1hZ2luYXJ5IGJhc2lzIHZlY3RvciBpLgogICAqIEBwYXJhbSB5IE11bHRpcGxpZXIgb2YgdGhlIGltYWdpbmFyeSBiYXNpcyB2ZWN0b3Igai4KICAgKiBAcGFyYW0geiBNdWx0aXBsaWVyIG9mIHRoZSBpbWFnaW5hcnkgYmFzaXMgdmVjdG9yIGsuCiAgICogQHBhcmFtIHcgTXVsdGlwbGllciBvZiB0aGUgcmVhbCBwYXJ0LgogICAqIEBzZWUgaHR0cDovL2VuLndpa2lwZWRpYS5vcmcvd2lraS9RdWF0ZXJuaW9uCiAgICovCgogIGNsYXNzIFF1YXRlcm5pb24gewogICAgY29uc3RydWN0b3IoeCwgeSwgeiwgdykgewogICAgICBpZiAoeCA9PT0gdm9pZCAwKSB7CiAgICAgICAgeCA9IDA7CiAgICAgIH0KCiAgICAgIGlmICh5ID09PSB2b2lkIDApIHsKICAgICAgICB5ID0gMDsKICAgICAgfQoKICAgICAgaWYgKHogPT09IHZvaWQgMCkgewogICAgICAgIHogPSAwOwogICAgICB9CgogICAgICBpZiAodyA9PT0gdm9pZCAwKSB7CiAgICAgICAgdyA9IDE7CiAgICAgIH0KCiAgICAgIHRoaXMueCA9IHg7CiAgICAgIHRoaXMueSA9IHk7CiAgICAgIHRoaXMueiA9IHo7CiAgICAgIHRoaXMudyA9IHc7CiAgICB9CiAgICAvKioKICAgICAqIFNldCB0aGUgdmFsdWUgb2YgdGhlIHF1YXRlcm5pb24uCiAgICAgKi8KCgogICAgc2V0KHgsIHksIHosIHcpIHsKICAgICAgdGhpcy54ID0geDsKICAgICAgdGhpcy55ID0geTsKICAgICAgdGhpcy56ID0gejsKICAgICAgdGhpcy53ID0gdzsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICAvKioKICAgICAqIENvbnZlcnQgdG8gYSByZWFkYWJsZSBmb3JtYXQKICAgICAqIEByZXR1cm4gIngseSx6LHciCiAgICAgKi8KCgogICAgdG9TdHJpbmcoKSB7CiAgICAgIHJldHVybiBgJHt0aGlzLnh9LCR7dGhpcy55fSwke3RoaXMuen0sJHt0aGlzLnd9YDsKICAgIH0KICAgIC8qKgogICAgICogQ29udmVydCB0byBhbiBBcnJheQogICAgICogQHJldHVybiBbeCwgeSwgeiwgd10KICAgICAqLwoKCiAgICB0b0FycmF5KCkgewogICAgICByZXR1cm4gW3RoaXMueCwgdGhpcy55LCB0aGlzLnosIHRoaXMud107CiAgICB9CiAgICAvKioKICAgICAqIFNldCB0aGUgcXVhdGVybmlvbiBjb21wb25lbnRzIGdpdmVuIGFuIGF4aXMgYW5kIGFuIGFuZ2xlIGluIHJhZGlhbnMuCiAgICAgKi8KCgogICAgc2V0RnJvbUF4aXNBbmdsZSh2ZWN0b3IsIGFuZ2xlKSB7CiAgICAgIGNvbnN0IHMgPSBNYXRoLnNpbihhbmdsZSAqIDAuNSk7CiAgICAgIHRoaXMueCA9IHZlY3Rvci54ICogczsKICAgICAgdGhpcy55ID0gdmVjdG9yLnkgKiBzOwogICAgICB0aGlzLnogPSB2ZWN0b3IueiAqIHM7CiAgICAgIHRoaXMudyA9IE1hdGguY29zKGFuZ2xlICogMC41KTsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICAvKioKICAgICAqIENvbnZlcnRzIHRoZSBxdWF0ZXJuaW9uIHRvIFsgYXhpcywgYW5nbGUgXSByZXByZXNlbnRhdGlvbi4KICAgICAqIEBwYXJhbSB0YXJnZXRBeGlzIEEgdmVjdG9yIG9iamVjdCB0byByZXVzZSBmb3Igc3RvcmluZyB0aGUgYXhpcy4KICAgICAqIEByZXR1cm4gQW4gYXJyYXksIGZpcnN0IGVsZW1lbnQgaXMgdGhlIGF4aXMgYW5kIHRoZSBzZWNvbmQgaXMgdGhlIGFuZ2xlIGluIHJhZGlhbnMuCiAgICAgKi8KCgogICAgdG9BeGlzQW5nbGUodGFyZ2V0QXhpcykgewogICAgICBpZiAodGFyZ2V0QXhpcyA9PT0gdm9pZCAwKSB7CiAgICAgICAgdGFyZ2V0QXhpcyA9IG5ldyBWZWMzKCk7CiAgICAgIH0KCiAgICAgIHRoaXMubm9ybWFsaXplKCk7IC8vIGlmIHc+MSBhY29zIGFuZCBzcXJ0IHdpbGwgcHJvZHVjZSBlcnJvcnMsIHRoaXMgY2FudCBoYXBwZW4gaWYgcXVhdGVybmlvbiBpcyBub3JtYWxpc2VkCgogICAgICBjb25zdCBhbmdsZSA9IDIgKiBNYXRoLmFjb3ModGhpcy53KTsKICAgICAgY29uc3QgcyA9IE1hdGguc3FydCgxIC0gdGhpcy53ICogdGhpcy53KTsgLy8gYXNzdW1pbmcgcXVhdGVybmlvbiBub3JtYWxpc2VkIHRoZW4gdyBpcyBsZXNzIHRoYW4gMSwgc28gdGVybSBhbHdheXMgcG9zaXRpdmUuCgogICAgICBpZiAocyA8IDAuMDAxKSB7CiAgICAgICAgLy8gdGVzdCB0byBhdm9pZCBkaXZpZGUgYnkgemVybywgcyBpcyBhbHdheXMgcG9zaXRpdmUgZHVlIHRvIHNxcnQKICAgICAgICAvLyBpZiBzIGNsb3NlIHRvIHplcm8gdGhlbiBkaXJlY3Rpb24gb2YgYXhpcyBub3QgaW1wb3J0YW50CiAgICAgICAgdGFyZ2V0QXhpcy54ID0gdGhpcy54OyAvLyBpZiBpdCBpcyBpbXBvcnRhbnQgdGhhdCBheGlzIGlzIG5vcm1hbGlzZWQgdGhlbiByZXBsYWNlIHdpdGggeD0xOyB5PXo9MDsKCiAgICAgICAgdGFyZ2V0QXhpcy55ID0gdGhpcy55OwogICAgICAgIHRhcmdldEF4aXMueiA9IHRoaXMuejsKICAgICAgfSBlbHNlIHsKICAgICAgICB0YXJnZXRBeGlzLnggPSB0aGlzLnggLyBzOyAvLyBub3JtYWxpc2UgYXhpcwoKICAgICAgICB0YXJnZXRBeGlzLnkgPSB0aGlzLnkgLyBzOwogICAgICAgIHRhcmdldEF4aXMueiA9IHRoaXMueiAvIHM7CiAgICAgIH0KCiAgICAgIHJldHVybiBbdGFyZ2V0QXhpcywgYW5nbGVdOwogICAgfQogICAgLyoqCiAgICAgKiBTZXQgdGhlIHF1YXRlcm5pb24gdmFsdWUgZ2l2ZW4gdHdvIHZlY3RvcnMuIFRoZSByZXN1bHRpbmcgcm90YXRpb24gd2lsbCBiZSB0aGUgbmVlZGVkIHJvdGF0aW9uIHRvIHJvdGF0ZSB1IHRvIHYuCiAgICAgKi8KCgogICAgc2V0RnJvbVZlY3RvcnModSwgdikgewogICAgICBpZiAodS5pc0FudGlwYXJhbGxlbFRvKHYpKSB7CiAgICAgICAgY29uc3QgdDEgPSBzZnZfdDE7CiAgICAgICAgY29uc3QgdDIgPSBzZnZfdDI7CiAgICAgICAgdS50YW5nZW50cyh0MSwgdDIpOwogICAgICAgIHRoaXMuc2V0RnJvbUF4aXNBbmdsZSh0MSwgTWF0aC5QSSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgY29uc3QgYSA9IHUuY3Jvc3Modik7CiAgICAgICAgdGhpcy54ID0gYS54OwogICAgICAgIHRoaXMueSA9IGEueTsKICAgICAgICB0aGlzLnogPSBhLno7CiAgICAgICAgdGhpcy53ID0gTWF0aC5zcXJ0KHUubGVuZ3RoKCkgKiogMiAqIHYubGVuZ3RoKCkgKiogMikgKyB1LmRvdCh2KTsKICAgICAgICB0aGlzLm5vcm1hbGl6ZSgpOwogICAgICB9CgogICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIC8qKgogICAgICogTXVsdGlwbHkgdGhlIHF1YXRlcm5pb24gd2l0aCBhbiBvdGhlciBxdWF0ZXJuaW9uLgogICAgICovCgoKICAgIG11bHQocXVhdCwgdGFyZ2V0KSB7CiAgICAgIGlmICh0YXJnZXQgPT09IHZvaWQgMCkgewogICAgICAgIHRhcmdldCA9IG5ldyBRdWF0ZXJuaW9uKCk7CiAgICAgIH0KCiAgICAgIGNvbnN0IGF4ID0gdGhpcy54OwogICAgICBjb25zdCBheSA9IHRoaXMueTsKICAgICAgY29uc3QgYXogPSB0aGlzLno7CiAgICAgIGNvbnN0IGF3ID0gdGhpcy53OwogICAgICBjb25zdCBieCA9IHF1YXQueDsKICAgICAgY29uc3QgYnkgPSBxdWF0Lnk7CiAgICAgIGNvbnN0IGJ6ID0gcXVhdC56OwogICAgICBjb25zdCBidyA9IHF1YXQudzsKICAgICAgdGFyZ2V0LnggPSBheCAqIGJ3ICsgYXcgKiBieCArIGF5ICogYnogLSBheiAqIGJ5OwogICAgICB0YXJnZXQueSA9IGF5ICogYncgKyBhdyAqIGJ5ICsgYXogKiBieCAtIGF4ICogYno7CiAgICAgIHRhcmdldC56ID0gYXogKiBidyArIGF3ICogYnogKyBheCAqIGJ5IC0gYXkgKiBieDsKICAgICAgdGFyZ2V0LncgPSBhdyAqIGJ3IC0gYXggKiBieCAtIGF5ICogYnkgLSBheiAqIGJ6OwogICAgICByZXR1cm4gdGFyZ2V0OwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgdGhlIGludmVyc2UgcXVhdGVybmlvbiByb3RhdGlvbi4KICAgICAqLwoKCiAgICBpbnZlcnNlKHRhcmdldCkgewogICAgICBpZiAodGFyZ2V0ID09PSB2b2lkIDApIHsKICAgICAgICB0YXJnZXQgPSBuZXcgUXVhdGVybmlvbigpOwogICAgICB9CgogICAgICBjb25zdCB4ID0gdGhpcy54OwogICAgICBjb25zdCB5ID0gdGhpcy55OwogICAgICBjb25zdCB6ID0gdGhpcy56OwogICAgICBjb25zdCB3ID0gdGhpcy53OwogICAgICB0aGlzLmNvbmp1Z2F0ZSh0YXJnZXQpOwogICAgICBjb25zdCBpbm9ybTIgPSAxIC8gKHggKiB4ICsgeSAqIHkgKyB6ICogeiArIHcgKiB3KTsKICAgICAgdGFyZ2V0LnggKj0gaW5vcm0yOwogICAgICB0YXJnZXQueSAqPSBpbm9ybTI7CiAgICAgIHRhcmdldC56ICo9IGlub3JtMjsKICAgICAgdGFyZ2V0LncgKj0gaW5vcm0yOwogICAgICByZXR1cm4gdGFyZ2V0OwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgdGhlIHF1YXRlcm5pb24gY29uanVnYXRlCiAgICAgKi8KCgogICAgY29uanVnYXRlKHRhcmdldCkgewogICAgICBpZiAodGFyZ2V0ID09PSB2b2lkIDApIHsKICAgICAgICB0YXJnZXQgPSBuZXcgUXVhdGVybmlvbigpOwogICAgICB9CgogICAgICB0YXJnZXQueCA9IC10aGlzLng7CiAgICAgIHRhcmdldC55ID0gLXRoaXMueTsKICAgICAgdGFyZ2V0LnogPSAtdGhpcy56OwogICAgICB0YXJnZXQudyA9IHRoaXMudzsKICAgICAgcmV0dXJuIHRhcmdldDsKICAgIH0KICAgIC8qKgogICAgICogTm9ybWFsaXplIHRoZSBxdWF0ZXJuaW9uLiBOb3RlIHRoYXQgdGhpcyBjaGFuZ2VzIHRoZSB2YWx1ZXMgb2YgdGhlIHF1YXRlcm5pb24uCiAgICAgKi8KCgogICAgbm9ybWFsaXplKCkgewogICAgICBsZXQgbCA9IE1hdGguc3FydCh0aGlzLnggKiB0aGlzLnggKyB0aGlzLnkgKiB0aGlzLnkgKyB0aGlzLnogKiB0aGlzLnogKyB0aGlzLncgKiB0aGlzLncpOwoKICAgICAgaWYgKGwgPT09IDApIHsKICAgICAgICB0aGlzLnggPSAwOwogICAgICAgIHRoaXMueSA9IDA7CiAgICAgICAgdGhpcy56ID0gMDsKICAgICAgICB0aGlzLncgPSAwOwogICAgICB9IGVsc2UgewogICAgICAgIGwgPSAxIC8gbDsKICAgICAgICB0aGlzLnggKj0gbDsKICAgICAgICB0aGlzLnkgKj0gbDsKICAgICAgICB0aGlzLnogKj0gbDsKICAgICAgICB0aGlzLncgKj0gbDsKICAgICAgfQoKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICAvKioKICAgICAqIEFwcHJveGltYXRpb24gb2YgcXVhdGVybmlvbiBub3JtYWxpemF0aW9uLiBXb3JrcyBiZXN0IHdoZW4gcXVhdCBpcyBhbHJlYWR5IGFsbW9zdC1ub3JtYWxpemVkLgogICAgICogQGF1dGhvciB1bnBoYXNlZCwgaHR0cHM6Ly9naXRodWIuY29tL3VucGhhc2VkCiAgICAgKi8KCgogICAgbm9ybWFsaXplRmFzdCgpIHsKICAgICAgY29uc3QgZiA9ICgzLjAgLSAodGhpcy54ICogdGhpcy54ICsgdGhpcy55ICogdGhpcy55ICsgdGhpcy56ICogdGhpcy56ICsgdGhpcy53ICogdGhpcy53KSkgLyAyLjA7CgogICAgICBpZiAoZiA9PT0gMCkgewogICAgICAgIHRoaXMueCA9IDA7CiAgICAgICAgdGhpcy55ID0gMDsKICAgICAgICB0aGlzLnogPSAwOwogICAgICAgIHRoaXMudyA9IDA7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy54ICo9IGY7CiAgICAgICAgdGhpcy55ICo9IGY7CiAgICAgICAgdGhpcy56ICo9IGY7CiAgICAgICAgdGhpcy53ICo9IGY7CiAgICAgIH0KCiAgICAgIHJldHVybiB0aGlzOwogICAgfQogICAgLyoqCiAgICAgKiBNdWx0aXBseSB0aGUgcXVhdGVybmlvbiBieSBhIHZlY3RvcgogICAgICovCgoKICAgIHZtdWx0KHYsIHRhcmdldCkgewogICAgICBpZiAodGFyZ2V0ID09PSB2b2lkIDApIHsKICAgICAgICB0YXJnZXQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICBjb25zdCB4ID0gdi54OwogICAgICBjb25zdCB5ID0gdi55OwogICAgICBjb25zdCB6ID0gdi56OwogICAgICBjb25zdCBxeCA9IHRoaXMueDsKICAgICAgY29uc3QgcXkgPSB0aGlzLnk7CiAgICAgIGNvbnN0IHF6ID0gdGhpcy56OwogICAgICBjb25zdCBxdyA9IHRoaXMudzsgLy8gcSp2CgogICAgICBjb25zdCBpeCA9IHF3ICogeCArIHF5ICogeiAtIHF6ICogeTsKICAgICAgY29uc3QgaXkgPSBxdyAqIHkgKyBxeiAqIHggLSBxeCAqIHo7CiAgICAgIGNvbnN0IGl6ID0gcXcgKiB6ICsgcXggKiB5IC0gcXkgKiB4OwogICAgICBjb25zdCBpdyA9IC1xeCAqIHggLSBxeSAqIHkgLSBxeiAqIHo7CiAgICAgIHRhcmdldC54ID0gaXggKiBxdyArIGl3ICogLXF4ICsgaXkgKiAtcXogLSBpeiAqIC1xeTsKICAgICAgdGFyZ2V0LnkgPSBpeSAqIHF3ICsgaXcgKiAtcXkgKyBpeiAqIC1xeCAtIGl4ICogLXF6OwogICAgICB0YXJnZXQueiA9IGl6ICogcXcgKyBpdyAqIC1xeiArIGl4ICogLXF5IC0gaXkgKiAtcXg7CiAgICAgIHJldHVybiB0YXJnZXQ7CiAgICB9CiAgICAvKioKICAgICAqIENvcGllcyB2YWx1ZSBvZiBzb3VyY2UgdG8gdGhpcyBxdWF0ZXJuaW9uLgogICAgICogQHJldHVybiB0aGlzCiAgICAgKi8KCgogICAgY29weShxdWF0KSB7CiAgICAgIHRoaXMueCA9IHF1YXQueDsKICAgICAgdGhpcy55ID0gcXVhdC55OwogICAgICB0aGlzLnogPSBxdWF0Lno7CiAgICAgIHRoaXMudyA9IHF1YXQudzsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICAvKioKICAgICAqIENvbnZlcnQgdGhlIHF1YXRlcm5pb24gdG8gZXVsZXIgYW5nbGUgcmVwcmVzZW50YXRpb24uIE9yZGVyOiBZWlgsIGFzIHRoaXMgcGFnZSBkZXNjcmliZXM6IGh0dHBzOi8vd3d3LmV1Y2xpZGVhbnNwYWNlLmNvbS9tYXRocy9zdGFuZGFyZHMvaW5kZXguaHRtCiAgICAgKiBAcGFyYW0gb3JkZXIgVGhyZWUtY2hhcmFjdGVyIHN0cmluZywgZGVmYXVsdHMgdG8gIllaWCIKICAgICAqLwoKCiAgICB0b0V1bGVyKHRhcmdldCwgb3JkZXIpIHsKICAgICAgaWYgKG9yZGVyID09PSB2b2lkIDApIHsKICAgICAgICBvcmRlciA9ICdZWlgnOwogICAgICB9CgogICAgICBsZXQgaGVhZGluZzsKICAgICAgbGV0IGF0dGl0dWRlOwogICAgICBsZXQgYmFuazsKICAgICAgY29uc3QgeCA9IHRoaXMueDsKICAgICAgY29uc3QgeSA9IHRoaXMueTsKICAgICAgY29uc3QgeiA9IHRoaXMuejsKICAgICAgY29uc3QgdyA9IHRoaXMudzsKCiAgICAgIHN3aXRjaCAob3JkZXIpIHsKICAgICAgICBjYXNlICdZWlgnOgogICAgICAgICAgY29uc3QgdGVzdCA9IHggKiB5ICsgeiAqIHc7CgogICAgICAgICAgaWYgKHRlc3QgPiAwLjQ5OSkgewogICAgICAgICAgICAvLyBzaW5ndWxhcml0eSBhdCBub3J0aCBwb2xlCiAgICAgICAgICAgIGhlYWRpbmcgPSAyICogTWF0aC5hdGFuMih4LCB3KTsKICAgICAgICAgICAgYXR0aXR1ZGUgPSBNYXRoLlBJIC8gMjsKICAgICAgICAgICAgYmFuayA9IDA7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKHRlc3QgPCAtMC40OTkpIHsKICAgICAgICAgICAgLy8gc2luZ3VsYXJpdHkgYXQgc291dGggcG9sZQogICAgICAgICAgICBoZWFkaW5nID0gLTIgKiBNYXRoLmF0YW4yKHgsIHcpOwogICAgICAgICAgICBhdHRpdHVkZSA9IC1NYXRoLlBJIC8gMjsKICAgICAgICAgICAgYmFuayA9IDA7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKGhlYWRpbmcgPT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICBjb25zdCBzcXggPSB4ICogeDsKICAgICAgICAgICAgY29uc3Qgc3F5ID0geSAqIHk7CiAgICAgICAgICAgIGNvbnN0IHNxeiA9IHogKiB6OwogICAgICAgICAgICBoZWFkaW5nID0gTWF0aC5hdGFuMigyICogeSAqIHcgLSAyICogeCAqIHosIDEgLSAyICogc3F5IC0gMiAqIHNxeik7IC8vIEhlYWRpbmcKCiAgICAgICAgICAgIGF0dGl0dWRlID0gTWF0aC5hc2luKDIgKiB0ZXN0KTsgLy8gYXR0aXR1ZGUKCiAgICAgICAgICAgIGJhbmsgPSBNYXRoLmF0YW4yKDIgKiB4ICogdyAtIDIgKiB5ICogeiwgMSAtIDIgKiBzcXggLSAyICogc3F6KTsgLy8gYmFuawogICAgICAgICAgfQoKICAgICAgICAgIGJyZWFrOwoKICAgICAgICBkZWZhdWx0OgogICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBFdWxlciBvcmRlciAke29yZGVyfSBub3Qgc3VwcG9ydGVkIHlldC5gKTsKICAgICAgfQoKICAgICAgdGFyZ2V0LnkgPSBoZWFkaW5nOwogICAgICB0YXJnZXQueiA9IGF0dGl0dWRlOwogICAgICB0YXJnZXQueCA9IGJhbms7CiAgICB9CiAgICAvKioKICAgICAqIFNldCB0aGUgcXVhdGVybmlvbiBjb21wb25lbnRzIGdpdmVuIEV1bGVyIGFuZ2xlIHJlcHJlc2VudGF0aW9uLgogICAgICoKICAgICAqIEBwYXJhbSBvcmRlciBUaGUgb3JkZXIgdG8gYXBwbHkgYW5nbGVzOiAnWFlaJyBvciAnWVhaJyBvciBhbnkgb3RoZXIgY29tYmluYXRpb24uCiAgICAgKgogICAgICogU2VlIHtAbGluayBodHRwczovL3d3dy5tYXRod29ya3MuY29tL21hdGxhYmNlbnRyYWwvZmlsZWV4Y2hhbmdlLzIwNjk2LWZ1bmN0aW9uLXRvLWNvbnZlcnQtYmV0d2Vlbi1kY20tZXVsZXItYW5nbGVzLXF1YXRlcm5pb25zLWFuZC1ldWxlci12ZWN0b3JzIE1hdGhXb3Jrc30gcmVmZXJlbmNlCiAgICAgKi8KCgogICAgc2V0RnJvbUV1bGVyKHgsIHksIHosIG9yZGVyKSB7CiAgICAgIGlmIChvcmRlciA9PT0gdm9pZCAwKSB7CiAgICAgICAgb3JkZXIgPSAnWFlaJzsKICAgICAgfQoKICAgICAgY29uc3QgYzEgPSBNYXRoLmNvcyh4IC8gMik7CiAgICAgIGNvbnN0IGMyID0gTWF0aC5jb3MoeSAvIDIpOwogICAgICBjb25zdCBjMyA9IE1hdGguY29zKHogLyAyKTsKICAgICAgY29uc3QgczEgPSBNYXRoLnNpbih4IC8gMik7CiAgICAgIGNvbnN0IHMyID0gTWF0aC5zaW4oeSAvIDIpOwogICAgICBjb25zdCBzMyA9IE1hdGguc2luKHogLyAyKTsKCiAgICAgIGlmIChvcmRlciA9PT0gJ1hZWicpIHsKICAgICAgICB0aGlzLnggPSBzMSAqIGMyICogYzMgKyBjMSAqIHMyICogczM7CiAgICAgICAgdGhpcy55ID0gYzEgKiBzMiAqIGMzIC0gczEgKiBjMiAqIHMzOwogICAgICAgIHRoaXMueiA9IGMxICogYzIgKiBzMyArIHMxICogczIgKiBjMzsKICAgICAgICB0aGlzLncgPSBjMSAqIGMyICogYzMgLSBzMSAqIHMyICogczM7CiAgICAgIH0gZWxzZSBpZiAob3JkZXIgPT09ICdZWFonKSB7CiAgICAgICAgdGhpcy54ID0gczEgKiBjMiAqIGMzICsgYzEgKiBzMiAqIHMzOwogICAgICAgIHRoaXMueSA9IGMxICogczIgKiBjMyAtIHMxICogYzIgKiBzMzsKICAgICAgICB0aGlzLnogPSBjMSAqIGMyICogczMgLSBzMSAqIHMyICogYzM7CiAgICAgICAgdGhpcy53ID0gYzEgKiBjMiAqIGMzICsgczEgKiBzMiAqIHMzOwogICAgICB9IGVsc2UgaWYgKG9yZGVyID09PSAnWlhZJykgewogICAgICAgIHRoaXMueCA9IHMxICogYzIgKiBjMyAtIGMxICogczIgKiBzMzsKICAgICAgICB0aGlzLnkgPSBjMSAqIHMyICogYzMgKyBzMSAqIGMyICogczM7CiAgICAgICAgdGhpcy56ID0gYzEgKiBjMiAqIHMzICsgczEgKiBzMiAqIGMzOwogICAgICAgIHRoaXMudyA9IGMxICogYzIgKiBjMyAtIHMxICogczIgKiBzMzsKICAgICAgfSBlbHNlIGlmIChvcmRlciA9PT0gJ1pZWCcpIHsKICAgICAgICB0aGlzLnggPSBzMSAqIGMyICogYzMgLSBjMSAqIHMyICogczM7CiAgICAgICAgdGhpcy55ID0gYzEgKiBzMiAqIGMzICsgczEgKiBjMiAqIHMzOwogICAgICAgIHRoaXMueiA9IGMxICogYzIgKiBzMyAtIHMxICogczIgKiBjMzsKICAgICAgICB0aGlzLncgPSBjMSAqIGMyICogYzMgKyBzMSAqIHMyICogczM7CiAgICAgIH0gZWxzZSBpZiAob3JkZXIgPT09ICdZWlgnKSB7CiAgICAgICAgdGhpcy54ID0gczEgKiBjMiAqIGMzICsgYzEgKiBzMiAqIHMzOwogICAgICAgIHRoaXMueSA9IGMxICogczIgKiBjMyArIHMxICogYzIgKiBzMzsKICAgICAgICB0aGlzLnogPSBjMSAqIGMyICogczMgLSBzMSAqIHMyICogYzM7CiAgICAgICAgdGhpcy53ID0gYzEgKiBjMiAqIGMzIC0gczEgKiBzMiAqIHMzOwogICAgICB9IGVsc2UgaWYgKG9yZGVyID09PSAnWFpZJykgewogICAgICAgIHRoaXMueCA9IHMxICogYzIgKiBjMyAtIGMxICogczIgKiBzMzsKICAgICAgICB0aGlzLnkgPSBjMSAqIHMyICogYzMgLSBzMSAqIGMyICogczM7CiAgICAgICAgdGhpcy56ID0gYzEgKiBjMiAqIHMzICsgczEgKiBzMiAqIGMzOwogICAgICAgIHRoaXMudyA9IGMxICogYzIgKiBjMyArIHMxICogczIgKiBzMzsKICAgICAgfQoKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CgogICAgY2xvbmUoKSB7CiAgICAgIHJldHVybiBuZXcgUXVhdGVybmlvbih0aGlzLngsIHRoaXMueSwgdGhpcy56LCB0aGlzLncpOwogICAgfQogICAgLyoqCiAgICAgKiBQZXJmb3JtcyBhIHNwaGVyaWNhbCBsaW5lYXIgaW50ZXJwb2xhdGlvbiBiZXR3ZWVuIHR3byBxdWF0CiAgICAgKgogICAgICogQHBhcmFtIHRvUXVhdCBzZWNvbmQgb3BlcmFuZAogICAgICogQHBhcmFtIHQgaW50ZXJwb2xhdGlvbiBhbW91bnQgYmV0d2VlbiB0aGUgc2VsZiBxdWF0ZXJuaW9uIGFuZCB0b1F1YXQKICAgICAqIEBwYXJhbSB0YXJnZXQgQSBxdWF0ZXJuaW9uIHRvIHN0b3JlIHRoZSByZXN1bHQgaW4uIElmIG5vdCBwcm92aWRlZCwgYSBuZXcgb25lIHdpbGwgYmUgY3JlYXRlZC4KICAgICAqIEByZXR1cm5zIHtRdWF0ZXJuaW9ufSBUaGUgInRhcmdldCIgb2JqZWN0CiAgICAgKi8KCgogICAgc2xlcnAodG9RdWF0LCB0LCB0YXJnZXQpIHsKICAgICAgaWYgKHRhcmdldCA9PT0gdm9pZCAwKSB7CiAgICAgICAgdGFyZ2V0ID0gbmV3IFF1YXRlcm5pb24oKTsKICAgICAgfQoKICAgICAgY29uc3QgYXggPSB0aGlzLng7CiAgICAgIGNvbnN0IGF5ID0gdGhpcy55OwogICAgICBjb25zdCBheiA9IHRoaXMuejsKICAgICAgY29uc3QgYXcgPSB0aGlzLnc7CiAgICAgIGxldCBieCA9IHRvUXVhdC54OwogICAgICBsZXQgYnkgPSB0b1F1YXQueTsKICAgICAgbGV0IGJ6ID0gdG9RdWF0Lno7CiAgICAgIGxldCBidyA9IHRvUXVhdC53OwogICAgICBsZXQgb21lZ2E7CiAgICAgIGxldCBjb3NvbTsKICAgICAgbGV0IHNpbm9tOwogICAgICBsZXQgc2NhbGUwOwogICAgICBsZXQgc2NhbGUxOyAvLyBjYWxjIGNvc2luZQoKICAgICAgY29zb20gPSBheCAqIGJ4ICsgYXkgKiBieSArIGF6ICogYnogKyBhdyAqIGJ3OyAvLyBhZGp1c3Qgc2lnbnMgKGlmIG5lY2Vzc2FyeSkKCiAgICAgIGlmIChjb3NvbSA8IDAuMCkgewogICAgICAgIGNvc29tID0gLWNvc29tOwogICAgICAgIGJ4ID0gLWJ4OwogICAgICAgIGJ5ID0gLWJ5OwogICAgICAgIGJ6ID0gLWJ6OwogICAgICAgIGJ3ID0gLWJ3OwogICAgICB9IC8vIGNhbGN1bGF0ZSBjb2VmZmljaWVudHMKCgogICAgICBpZiAoMS4wIC0gY29zb20gPiAwLjAwMDAwMSkgewogICAgICAgIC8vIHN0YW5kYXJkIGNhc2UgKHNsZXJwKQogICAgICAgIG9tZWdhID0gTWF0aC5hY29zKGNvc29tKTsKICAgICAgICBzaW5vbSA9IE1hdGguc2luKG9tZWdhKTsKICAgICAgICBzY2FsZTAgPSBNYXRoLnNpbigoMS4wIC0gdCkgKiBvbWVnYSkgLyBzaW5vbTsKICAgICAgICBzY2FsZTEgPSBNYXRoLnNpbih0ICogb21lZ2EpIC8gc2lub207CiAgICAgIH0gZWxzZSB7CiAgICAgICAgLy8gImZyb20iIGFuZCAidG8iIHF1YXRlcm5pb25zIGFyZSB2ZXJ5IGNsb3NlCiAgICAgICAgLy8gIC4uLiBzbyB3ZSBjYW4gZG8gYSBsaW5lYXIgaW50ZXJwb2xhdGlvbgogICAgICAgIHNjYWxlMCA9IDEuMCAtIHQ7CiAgICAgICAgc2NhbGUxID0gdDsKICAgICAgfSAvLyBjYWxjdWxhdGUgZmluYWwgdmFsdWVzCgoKICAgICAgdGFyZ2V0LnggPSBzY2FsZTAgKiBheCArIHNjYWxlMSAqIGJ4OwogICAgICB0YXJnZXQueSA9IHNjYWxlMCAqIGF5ICsgc2NhbGUxICogYnk7CiAgICAgIHRhcmdldC56ID0gc2NhbGUwICogYXogKyBzY2FsZTEgKiBiejsKICAgICAgdGFyZ2V0LncgPSBzY2FsZTAgKiBhdyArIHNjYWxlMSAqIGJ3OwogICAgICByZXR1cm4gdGFyZ2V0OwogICAgfQogICAgLyoqCiAgICAgKiBSb3RhdGUgYW4gYWJzb2x1dGUgb3JpZW50YXRpb24gcXVhdGVybmlvbiBnaXZlbiBhbiBhbmd1bGFyIHZlbG9jaXR5IGFuZCBhIHRpbWUgc3RlcC4KICAgICAqLwoKCiAgICBpbnRlZ3JhdGUoYW5ndWxhclZlbG9jaXR5LCBkdCwgYW5ndWxhckZhY3RvciwgdGFyZ2V0KSB7CiAgICAgIGlmICh0YXJnZXQgPT09IHZvaWQgMCkgewogICAgICAgIHRhcmdldCA9IG5ldyBRdWF0ZXJuaW9uKCk7CiAgICAgIH0KCiAgICAgIGNvbnN0IGF4ID0gYW5ndWxhclZlbG9jaXR5LnggKiBhbmd1bGFyRmFjdG9yLngsCiAgICAgICAgICAgIGF5ID0gYW5ndWxhclZlbG9jaXR5LnkgKiBhbmd1bGFyRmFjdG9yLnksCiAgICAgICAgICAgIGF6ID0gYW5ndWxhclZlbG9jaXR5LnogKiBhbmd1bGFyRmFjdG9yLnosCiAgICAgICAgICAgIGJ4ID0gdGhpcy54LAogICAgICAgICAgICBieSA9IHRoaXMueSwKICAgICAgICAgICAgYnogPSB0aGlzLnosCiAgICAgICAgICAgIGJ3ID0gdGhpcy53OwogICAgICBjb25zdCBoYWxmX2R0ID0gZHQgKiAwLjU7CiAgICAgIHRhcmdldC54ICs9IGhhbGZfZHQgKiAoYXggKiBidyArIGF5ICogYnogLSBheiAqIGJ5KTsKICAgICAgdGFyZ2V0LnkgKz0gaGFsZl9kdCAqIChheSAqIGJ3ICsgYXogKiBieCAtIGF4ICogYnopOwogICAgICB0YXJnZXQueiArPSBoYWxmX2R0ICogKGF6ICogYncgKyBheCAqIGJ5IC0gYXkgKiBieCk7CiAgICAgIHRhcmdldC53ICs9IGhhbGZfZHQgKiAoLWF4ICogYnggLSBheSAqIGJ5IC0gYXogKiBieik7CiAgICAgIHJldHVybiB0YXJnZXQ7CiAgICB9CgogIH0KICBjb25zdCBzZnZfdDEgPSBuZXcgVmVjMygpOwogIGNvbnN0IHNmdl90MiA9IG5ldyBWZWMzKCk7CgogIC8qKgogICAqIFRoZSBhdmFpbGFibGUgc2hhcGUgdHlwZXMuCiAgICovCiAgY29uc3QgU0hBUEVfVFlQRVMgPSB7CiAgICAvKiogU1BIRVJFICovCiAgICBTUEhFUkU6IDEsCgogICAgLyoqIFBMQU5FICovCiAgICBQTEFORTogMiwKCiAgICAvKiogQk9YICovCiAgICBCT1g6IDQsCgogICAgLyoqIENPTVBPVU5EICovCiAgICBDT01QT1VORDogOCwKCiAgICAvKiogQ09OVkVYUE9MWUhFRFJPTiAqLwogICAgQ09OVkVYUE9MWUhFRFJPTjogMTYsCgogICAgLyoqIEhFSUdIVEZJRUxEICovCiAgICBIRUlHSFRGSUVMRDogMzIsCgogICAgLyoqIFBBUlRJQ0xFICovCiAgICBQQVJUSUNMRTogNjQsCgogICAgLyoqIENZTElOREVSICovCiAgICBDWUxJTkRFUjogMTI4LAoKICAgIC8qKiBUUklNRVNIICovCiAgICBUUklNRVNIOiAyNTYKICB9OwogIC8qKgogICAqIFNoYXBlVHlwZQogICAqLwoKICAvKioKICAgKiBCYXNlIGNsYXNzIGZvciBzaGFwZXMKICAgKi8KICBjbGFzcyBTaGFwZSB7CiAgICAvKioKICAgICAqIElkZW50aWZpZXIgb2YgdGhlIFNoYXBlLgogICAgICovCgogICAgLyoqCiAgICAgKiBUaGUgdHlwZSBvZiB0aGlzIHNoYXBlLiBNdXN0IGJlIHNldCB0byBhbiBpbnQgPiAwIGJ5IHN1YmNsYXNzZXMuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFRoZSBsb2NhbCBib3VuZGluZyBzcGhlcmUgcmFkaXVzIG9mIHRoaXMgc2hhcGUuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFdoZXRoZXIgdG8gcHJvZHVjZSBjb250YWN0IGZvcmNlcyB3aGVuIGluIGNvbnRhY3Qgd2l0aCBvdGhlciBib2RpZXMuIE5vdGUgdGhhdCBjb250YWN0cyB3aWxsIGJlIGdlbmVyYXRlZCwgYnV0IHRoZXkgd2lsbCBiZSBkaXNhYmxlZC4KICAgICAqIEBkZWZhdWx0IHRydWUKICAgICAqLwoKICAgIC8qKgogICAgICogQGRlZmF1bHQgMQogICAgICovCgogICAgLyoqCiAgICAgKiBAZGVmYXVsdCAtMQogICAgICovCgogICAgLyoqCiAgICAgKiBPcHRpb25hbCBtYXRlcmlhbCBvZiB0aGUgc2hhcGUgdGhhdCByZWd1bGF0ZXMgY29udGFjdCBwcm9wZXJ0aWVzLgogICAgICovCgogICAgLyoqCiAgICAgKiBUaGUgYm9keSB0byB3aGljaCB0aGUgc2hhcGUgaXMgYWRkZWQgdG8uCiAgICAgKi8KCiAgICAvKioKICAgICAqIEFsbCB0aGUgU2hhcGUgdHlwZXMuCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKG9wdGlvbnMpIHsKICAgICAgaWYgKG9wdGlvbnMgPT09IHZvaWQgMCkgewogICAgICAgIG9wdGlvbnMgPSB7fTsKICAgICAgfQoKICAgICAgdGhpcy5pZCA9IFNoYXBlLmlkQ291bnRlcisrOwogICAgICB0aGlzLnR5cGUgPSBvcHRpb25zLnR5cGUgfHwgMDsKICAgICAgdGhpcy5ib3VuZGluZ1NwaGVyZVJhZGl1cyA9IDA7CiAgICAgIHRoaXMuY29sbGlzaW9uUmVzcG9uc2UgPSBvcHRpb25zLmNvbGxpc2lvblJlc3BvbnNlID8gb3B0aW9ucy5jb2xsaXNpb25SZXNwb25zZSA6IHRydWU7CiAgICAgIHRoaXMuY29sbGlzaW9uRmlsdGVyR3JvdXAgPSBvcHRpb25zLmNvbGxpc2lvbkZpbHRlckdyb3VwICE9PSB1bmRlZmluZWQgPyBvcHRpb25zLmNvbGxpc2lvbkZpbHRlckdyb3VwIDogMTsKICAgICAgdGhpcy5jb2xsaXNpb25GaWx0ZXJNYXNrID0gb3B0aW9ucy5jb2xsaXNpb25GaWx0ZXJNYXNrICE9PSB1bmRlZmluZWQgPyBvcHRpb25zLmNvbGxpc2lvbkZpbHRlck1hc2sgOiAtMTsKICAgICAgdGhpcy5tYXRlcmlhbCA9IG9wdGlvbnMubWF0ZXJpYWwgPyBvcHRpb25zLm1hdGVyaWFsIDogbnVsbDsKICAgICAgdGhpcy5ib2R5ID0gbnVsbDsKICAgIH0KICAgIC8qKgogICAgICogQ29tcHV0ZXMgdGhlIGJvdW5kaW5nIHNwaGVyZSByYWRpdXMuCiAgICAgKiBUaGUgcmVzdWx0IGlzIHN0b3JlZCBpbiB0aGUgcHJvcGVydHkgYC5ib3VuZGluZ1NwaGVyZVJhZGl1c2AKICAgICAqLwoKCiAgICB1cGRhdGVCb3VuZGluZ1NwaGVyZVJhZGl1cygpIHsKICAgICAgdGhyb3cgYGNvbXB1dGVCb3VuZGluZ1NwaGVyZVJhZGl1cygpIG5vdCBpbXBsZW1lbnRlZCBmb3Igc2hhcGUgdHlwZSAke3RoaXMudHlwZX1gOwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgdGhlIHZvbHVtZSBvZiB0aGlzIHNoYXBlCiAgICAgKi8KCgogICAgdm9sdW1lKCkgewogICAgICB0aHJvdyBgdm9sdW1lKCkgbm90IGltcGxlbWVudGVkIGZvciBzaGFwZSB0eXBlICR7dGhpcy50eXBlfWA7CiAgICB9CiAgICAvKioKICAgICAqIENhbGN1bGF0ZXMgdGhlIGluZXJ0aWEgaW4gdGhlIGxvY2FsIGZyYW1lIGZvciB0aGlzIHNoYXBlLgogICAgICogQHNlZSBodHRwOi8vZW4ud2lraXBlZGlhLm9yZy93aWtpL0xpc3Rfb2ZfbW9tZW50c19vZl9pbmVydGlhCiAgICAgKi8KCgogICAgY2FsY3VsYXRlTG9jYWxJbmVydGlhKG1hc3MsIHRhcmdldCkgewogICAgICB0aHJvdyBgY2FsY3VsYXRlTG9jYWxJbmVydGlhKCkgbm90IGltcGxlbWVudGVkIGZvciBzaGFwZSB0eXBlICR7dGhpcy50eXBlfWA7CiAgICB9CiAgICAvKioKICAgICAqIEB0b2RvIHVzZSBhYnN0cmFjdCBmb3IgdGhlc2Uga2luZCBvZiBtZXRob2RzCiAgICAgKi8KCgogICAgY2FsY3VsYXRlV29ybGRBQUJCKHBvcywgcXVhdCwgbWluLCBtYXgpIHsKICAgICAgdGhyb3cgYGNhbGN1bGF0ZVdvcmxkQUFCQigpIG5vdCBpbXBsZW1lbnRlZCBmb3Igc2hhcGUgdHlwZSAke3RoaXMudHlwZX1gOwogICAgfQoKICB9CiAgU2hhcGUuaWRDb3VudGVyID0gMDsKICBTaGFwZS50eXBlcyA9IFNIQVBFX1RZUEVTOwoKICAvKioKICAgKiBUcmFuc2Zvcm1hdGlvbiB1dGlsaXRpZXMuCiAgICovCiAgY2xhc3MgVHJhbnNmb3JtIHsKICAgIC8qKgogICAgICogcG9zaXRpb24KICAgICAqLwoKICAgIC8qKgogICAgICogcXVhdGVybmlvbgogICAgICovCiAgICBjb25zdHJ1Y3RvcihvcHRpb25zKSB7CiAgICAgIGlmIChvcHRpb25zID09PSB2b2lkIDApIHsKICAgICAgICBvcHRpb25zID0ge307CiAgICAgIH0KCiAgICAgIHRoaXMucG9zaXRpb24gPSBuZXcgVmVjMygpOwogICAgICB0aGlzLnF1YXRlcm5pb24gPSBuZXcgUXVhdGVybmlvbigpOwoKICAgICAgaWYgKG9wdGlvbnMucG9zaXRpb24pIHsKICAgICAgICB0aGlzLnBvc2l0aW9uLmNvcHkob3B0aW9ucy5wb3NpdGlvbik7CiAgICAgIH0KCiAgICAgIGlmIChvcHRpb25zLnF1YXRlcm5pb24pIHsKICAgICAgICB0aGlzLnF1YXRlcm5pb24uY29weShvcHRpb25zLnF1YXRlcm5pb24pOwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIEdldCBhIGdsb2JhbCBwb2ludCBpbiBsb2NhbCB0cmFuc2Zvcm0gY29vcmRpbmF0ZXMuCiAgICAgKi8KCgogICAgcG9pbnRUb0xvY2FsKHdvcmxkUG9pbnQsIHJlc3VsdCkgewogICAgICByZXR1cm4gVHJhbnNmb3JtLnBvaW50VG9Mb2NhbEZyYW1lKHRoaXMucG9zaXRpb24sIHRoaXMucXVhdGVybmlvbiwgd29ybGRQb2ludCwgcmVzdWx0KTsKICAgIH0KICAgIC8qKgogICAgICogR2V0IGEgbG9jYWwgcG9pbnQgaW4gZ2xvYmFsIHRyYW5zZm9ybSBjb29yZGluYXRlcy4KICAgICAqLwoKCiAgICBwb2ludFRvV29ybGQobG9jYWxQb2ludCwgcmVzdWx0KSB7CiAgICAgIHJldHVybiBUcmFuc2Zvcm0ucG9pbnRUb1dvcmxkRnJhbWUodGhpcy5wb3NpdGlvbiwgdGhpcy5xdWF0ZXJuaW9uLCBsb2NhbFBvaW50LCByZXN1bHQpOwogICAgfQogICAgLyoqCiAgICAgKiB2ZWN0b3JUb1dvcmxkRnJhbWUKICAgICAqLwoKCiAgICB2ZWN0b3JUb1dvcmxkRnJhbWUobG9jYWxWZWN0b3IsIHJlc3VsdCkgewogICAgICBpZiAocmVzdWx0ID09PSB2b2lkIDApIHsKICAgICAgICByZXN1bHQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICB0aGlzLnF1YXRlcm5pb24udm11bHQobG9jYWxWZWN0b3IsIHJlc3VsdCk7CiAgICAgIHJldHVybiByZXN1bHQ7CiAgICB9CiAgICAvKioKICAgICAqIHBvaW50VG9Mb2NhbEZyYW1lCiAgICAgKi8KCgogICAgc3RhdGljIHBvaW50VG9Mb2NhbEZyYW1lKHBvc2l0aW9uLCBxdWF0ZXJuaW9uLCB3b3JsZFBvaW50LCByZXN1bHQpIHsKICAgICAgaWYgKHJlc3VsdCA9PT0gdm9pZCAwKSB7CiAgICAgICAgcmVzdWx0ID0gbmV3IFZlYzMoKTsKICAgICAgfQoKICAgICAgd29ybGRQb2ludC52c3ViKHBvc2l0aW9uLCByZXN1bHQpOwogICAgICBxdWF0ZXJuaW9uLmNvbmp1Z2F0ZSh0bXBRdWF0JDEpOwogICAgICB0bXBRdWF0JDEudm11bHQocmVzdWx0LCByZXN1bHQpOwogICAgICByZXR1cm4gcmVzdWx0OwogICAgfQogICAgLyoqCiAgICAgKiBwb2ludFRvV29ybGRGcmFtZQogICAgICovCgoKICAgIHN0YXRpYyBwb2ludFRvV29ybGRGcmFtZShwb3NpdGlvbiwgcXVhdGVybmlvbiwgbG9jYWxQb2ludCwgcmVzdWx0KSB7CiAgICAgIGlmIChyZXN1bHQgPT09IHZvaWQgMCkgewogICAgICAgIHJlc3VsdCA9IG5ldyBWZWMzKCk7CiAgICAgIH0KCiAgICAgIHF1YXRlcm5pb24udm11bHQobG9jYWxQb2ludCwgcmVzdWx0KTsKICAgICAgcmVzdWx0LnZhZGQocG9zaXRpb24sIHJlc3VsdCk7CiAgICAgIHJldHVybiByZXN1bHQ7CiAgICB9CiAgICAvKioKICAgICAqIHZlY3RvclRvV29ybGRGcmFtZQogICAgICovCgoKICAgIHN0YXRpYyB2ZWN0b3JUb1dvcmxkRnJhbWUocXVhdGVybmlvbiwgbG9jYWxWZWN0b3IsIHJlc3VsdCkgewogICAgICBpZiAocmVzdWx0ID09PSB2b2lkIDApIHsKICAgICAgICByZXN1bHQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICBxdWF0ZXJuaW9uLnZtdWx0KGxvY2FsVmVjdG9yLCByZXN1bHQpOwogICAgICByZXR1cm4gcmVzdWx0OwogICAgfQogICAgLyoqCiAgICAgKiB2ZWN0b3JUb0xvY2FsRnJhbWUKICAgICAqLwoKCiAgICBzdGF0aWMgdmVjdG9yVG9Mb2NhbEZyYW1lKHBvc2l0aW9uLCBxdWF0ZXJuaW9uLCB3b3JsZFZlY3RvciwgcmVzdWx0KSB7CiAgICAgIGlmIChyZXN1bHQgPT09IHZvaWQgMCkgewogICAgICAgIHJlc3VsdCA9IG5ldyBWZWMzKCk7CiAgICAgIH0KCiAgICAgIHF1YXRlcm5pb24udyAqPSAtMTsKICAgICAgcXVhdGVybmlvbi52bXVsdCh3b3JsZFZlY3RvciwgcmVzdWx0KTsKICAgICAgcXVhdGVybmlvbi53ICo9IC0xOwogICAgICByZXR1cm4gcmVzdWx0OwogICAgfQoKICB9CiAgY29uc3QgdG1wUXVhdCQxID0gbmV3IFF1YXRlcm5pb24oKTsKCiAgLyoqCiAgICogQSBzZXQgb2YgcG9seWdvbnMgZGVzY3JpYmluZyBhIGNvbnZleCBzaGFwZS4KICAgKgogICAqIFRoZSBzaGFwZSBNVVNUIGJlIGNvbnZleCBmb3IgdGhlIGNvZGUgdG8gd29yayBwcm9wZXJseS4gTm8gcG9seWdvbnMgbWF5IGJlIGNvcGxhbmFyIChjb250YWluZWQKICAgKiBpbiB0aGUgc2FtZSAzRCBwbGFuZSksIGluc3RlYWQgdGhlc2Ugc2hvdWxkIGJlIG1lcmdlZCBpbnRvIG9uZSBwb2x5Z29uLgogICAqCiAgICogQGF1dGhvciBxaWFvIC8gaHR0cHM6Ly9naXRodWIuY29tL3FpYW8gKG9yaWdpbmFsIGF1dGhvciwgc2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9xaWFvL3RocmVlLmpzL2NvbW1pdC84NTAyNmYwYzc2OWU0MDAwMTQ4YTY3ZDQ1YTllOWI5YzUxMDg4MzZmKQogICAqIEBhdXRob3Igc2NodGVwcGUgLyBodHRwczovL2dpdGh1Yi5jb20vc2NodGVwcGUKICAgKiBAc2VlIGh0dHBzOi8vd3d3LmFsdGRldmJsb2dhZGF5LmNvbS8yMDExLzA1LzEzL2NvbnRhY3QtZ2VuZXJhdGlvbi1iZXR3ZWVuLTNkLWNvbnZleC1tZXNoZXMvCiAgICoKICAgKiBAdG9kbyBNb3ZlIHRoZSBjbGlwcGluZyBmdW5jdGlvbnMgdG8gQ29udGFjdEdlbmVyYXRvcj8KICAgKiBAdG9kbyBBdXRvbWF0aWNhbGx5IG1lcmdlIGNvcGxhbmFyIHBvbHlnb25zIGluIGNvbnN0cnVjdG9yLgogICAqIEBleGFtcGxlCiAgICogICAgIGNvbnN0IGNvbnZleFNoYXBlID0gbmV3IENBTk5PTi5Db252ZXhQb2x5aGVkcm9uKHsgdmVydGljZXMsIGZhY2VzIH0pCiAgICogICAgIGNvbnN0IGNvbnZleEJvZHkgPSBuZXcgQ0FOTk9OLkJvZHkoeyBtYXNzOiAxLCBzaGFwZTogY29udmV4U2hhcGUgfSkKICAgKiAgICAgd29ybGQuYWRkQm9keShjb252ZXhCb2R5KQogICAqLwogIGNsYXNzIENvbnZleFBvbHloZWRyb24gZXh0ZW5kcyBTaGFwZSB7CiAgICAvKiogdmVydGljZXMgKi8KCiAgICAvKioKICAgICAqIEFycmF5IG9mIGludGVnZXIgYXJyYXlzLCBpbmRpY2F0aW5nIHdoaWNoIHZlcnRpY2VzIGVhY2ggZmFjZSBjb25zaXN0cyBvZgogICAgICovCgogICAgLyoqIGZhY2VOb3JtYWxzICovCgogICAgLyoqIHdvcmxkVmVydGljZXMgKi8KCiAgICAvKiogd29ybGRWZXJ0aWNlc05lZWRzVXBkYXRlICovCgogICAgLyoqIHdvcmxkRmFjZU5vcm1hbHMgKi8KCiAgICAvKiogd29ybGRGYWNlTm9ybWFsc05lZWRzVXBkYXRlICovCgogICAgLyoqCiAgICAgKiBJZiBnaXZlbiwgdGhlc2UgbG9jYWxseSBkZWZpbmVkLCBub3JtYWxpemVkIGF4ZXMgYXJlIHRoZSBvbmx5IG9uZXMgYmVpbmcgY2hlY2tlZCB3aGVuIGRvaW5nIHNlcGFyYXRpbmcgYXhpcyBjaGVjay4KICAgICAqLwoKICAgIC8qKiB1bmlxdWVFZGdlcyAqLwoKICAgIC8qKgogICAgICogQHBhcmFtIHZlcnRpY2VzIEFuIGFycmF5IG9mIFZlYzMncwogICAgICogQHBhcmFtIGZhY2VzIEFycmF5IG9mIGludGVnZXIgYXJyYXlzLCBkZXNjcmliaW5nIHdoaWNoIHZlcnRpY2VzIHRoYXQgaXMgaW5jbHVkZWQgaW4gZWFjaCBmYWNlLgogICAgICovCiAgICBjb25zdHJ1Y3Rvcihwcm9wcykgewogICAgICBpZiAocHJvcHMgPT09IHZvaWQgMCkgewogICAgICAgIHByb3BzID0ge307CiAgICAgIH0KCiAgICAgIGNvbnN0IHsKICAgICAgICB2ZXJ0aWNlcyA9IFtdLAogICAgICAgIGZhY2VzID0gW10sCiAgICAgICAgbm9ybWFscyA9IFtdLAogICAgICAgIGF4ZXMsCiAgICAgICAgYm91bmRpbmdTcGhlcmVSYWRpdXMKICAgICAgfSA9IHByb3BzOwogICAgICBzdXBlcih7CiAgICAgICAgdHlwZTogU2hhcGUudHlwZXMuQ09OVkVYUE9MWUhFRFJPTgogICAgICB9KTsKICAgICAgdGhpcy52ZXJ0aWNlcyA9IHZlcnRpY2VzOwogICAgICB0aGlzLmZhY2VzID0gZmFjZXM7CiAgICAgIHRoaXMuZmFjZU5vcm1hbHMgPSBub3JtYWxzOwoKICAgICAgaWYgKHRoaXMuZmFjZU5vcm1hbHMubGVuZ3RoID09PSAwKSB7CiAgICAgICAgdGhpcy5jb21wdXRlTm9ybWFscygpOwogICAgICB9CgogICAgICBpZiAoIWJvdW5kaW5nU3BoZXJlUmFkaXVzKSB7CiAgICAgICAgdGhpcy51cGRhdGVCb3VuZGluZ1NwaGVyZVJhZGl1cygpOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuYm91bmRpbmdTcGhlcmVSYWRpdXMgPSBib3VuZGluZ1NwaGVyZVJhZGl1czsKICAgICAgfQoKICAgICAgdGhpcy53b3JsZFZlcnRpY2VzID0gW107IC8vIFdvcmxkIHRyYW5zZm9ybWVkIHZlcnNpb24gb2YgLnZlcnRpY2VzCgogICAgICB0aGlzLndvcmxkVmVydGljZXNOZWVkc1VwZGF0ZSA9IHRydWU7CiAgICAgIHRoaXMud29ybGRGYWNlTm9ybWFscyA9IFtdOyAvLyBXb3JsZCB0cmFuc2Zvcm1lZCB2ZXJzaW9uIG9mIC5mYWNlTm9ybWFscwoKICAgICAgdGhpcy53b3JsZEZhY2VOb3JtYWxzTmVlZHNVcGRhdGUgPSB0cnVlOwogICAgICB0aGlzLnVuaXF1ZUF4ZXMgPSBheGVzID8gYXhlcy5zbGljZSgpIDogbnVsbDsKICAgICAgdGhpcy51bmlxdWVFZGdlcyA9IFtdOwogICAgICB0aGlzLmNvbXB1dGVFZGdlcygpOwogICAgfQogICAgLyoqCiAgICAgKiBDb21wdXRlcyB1bmlxdWVFZGdlcwogICAgICovCgoKICAgIGNvbXB1dGVFZGdlcygpIHsKICAgICAgY29uc3QgZmFjZXMgPSB0aGlzLmZhY2VzOwogICAgICBjb25zdCB2ZXJ0aWNlcyA9IHRoaXMudmVydGljZXM7CiAgICAgIGNvbnN0IGVkZ2VzID0gdGhpcy51bmlxdWVFZGdlczsKICAgICAgZWRnZXMubGVuZ3RoID0gMDsKICAgICAgY29uc3QgZWRnZSA9IG5ldyBWZWMzKCk7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gZmFjZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICBjb25zdCBmYWNlID0gZmFjZXNbaV07CiAgICAgICAgY29uc3QgbnVtVmVydGljZXMgPSBmYWNlLmxlbmd0aDsKCiAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogIT09IG51bVZlcnRpY2VzOyBqKyspIHsKICAgICAgICAgIGNvbnN0IGsgPSAoaiArIDEpICUgbnVtVmVydGljZXM7CiAgICAgICAgICB2ZXJ0aWNlc1tmYWNlW2pdXS52c3ViKHZlcnRpY2VzW2ZhY2Vba11dLCBlZGdlKTsKICAgICAgICAgIGVkZ2Uubm9ybWFsaXplKCk7CiAgICAgICAgICBsZXQgZm91bmQgPSBmYWxzZTsKCiAgICAgICAgICBmb3IgKGxldCBwID0gMDsgcCAhPT0gZWRnZXMubGVuZ3RoOyBwKyspIHsKICAgICAgICAgICAgaWYgKGVkZ2VzW3BdLmFsbW9zdEVxdWFscyhlZGdlKSB8fCBlZGdlc1twXS5hbG1vc3RFcXVhbHMoZWRnZSkpIHsKICAgICAgICAgICAgICBmb3VuZCA9IHRydWU7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoIWZvdW5kKSB7CiAgICAgICAgICAgIGVkZ2VzLnB1c2goZWRnZS5jbG9uZSgpKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogQ29tcHV0ZSB0aGUgbm9ybWFscyBvZiB0aGUgZmFjZXMuCiAgICAgKiBXaWxsIHJldXNlIGV4aXN0aW5nIFZlYzMgb2JqZWN0cyBpbiB0aGUgYGZhY2VOb3JtYWxzYCBhcnJheSBpZiB0aGV5IGV4aXN0LgogICAgICovCgoKICAgIGNvbXB1dGVOb3JtYWxzKCkgewogICAgICB0aGlzLmZhY2VOb3JtYWxzLmxlbmd0aCA9IHRoaXMuZmFjZXMubGVuZ3RoOyAvLyBHZW5lcmF0ZSBub3JtYWxzCgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMuZmFjZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAvLyBDaGVjayBzbyBhbGwgdmVydGljZXMgZXhpc3RzIGZvciB0aGlzIGZhY2UKICAgICAgICBmb3IgKGxldCBqID0gMDsgaiA8IHRoaXMuZmFjZXNbaV0ubGVuZ3RoOyBqKyspIHsKICAgICAgICAgIGlmICghdGhpcy52ZXJ0aWNlc1t0aGlzLmZhY2VzW2ldW2pdXSkgewogICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYFZlcnRleCAke3RoaXMuZmFjZXNbaV1bal19IG5vdCBmb3VuZCFgKTsKICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGNvbnN0IG4gPSB0aGlzLmZhY2VOb3JtYWxzW2ldIHx8IG5ldyBWZWMzKCk7CiAgICAgICAgdGhpcy5nZXRGYWNlTm9ybWFsKGksIG4pOwogICAgICAgIG4ubmVnYXRlKG4pOwogICAgICAgIHRoaXMuZmFjZU5vcm1hbHNbaV0gPSBuOwogICAgICAgIGNvbnN0IHZlcnRleCA9IHRoaXMudmVydGljZXNbdGhpcy5mYWNlc1tpXVswXV07CgogICAgICAgIGlmIChuLmRvdCh2ZXJ0ZXgpIDwgMCkgewogICAgICAgICAgY29uc29sZS5lcnJvcihgLmZhY2VOb3JtYWxzWyR7aX1dID0gVmVjMygke24udG9TdHJpbmcoKX0pIGxvb2tzIGxpa2UgaXQgcG9pbnRzIGludG8gdGhlIHNoYXBlPyBUaGUgdmVydGljZXMgZm9sbG93LiBNYWtlIHN1cmUgdGhleSBhcmUgb3JkZXJlZCBDQ1cgYXJvdW5kIHRoZSBub3JtYWwsIHVzaW5nIHRoZSByaWdodCBoYW5kIHJ1bGUuYCk7CgogICAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCB0aGlzLmZhY2VzW2ldLmxlbmd0aDsgaisrKSB7CiAgICAgICAgICAgIGNvbnNvbGUud2FybihgLnZlcnRpY2VzWyR7dGhpcy5mYWNlc1tpXVtqXX1dID0gVmVjMygke3RoaXMudmVydGljZXNbdGhpcy5mYWNlc1tpXVtqXV0udG9TdHJpbmcoKX0pYCk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIENvbXB1dGUgdGhlIG5vcm1hbCBvZiBhIGZhY2UgZnJvbSBpdHMgdmVydGljZXMKICAgICAqLwoKCiAgICBnZXRGYWNlTm9ybWFsKGksIHRhcmdldCkgewogICAgICBjb25zdCBmID0gdGhpcy5mYWNlc1tpXTsKICAgICAgY29uc3QgdmEgPSB0aGlzLnZlcnRpY2VzW2ZbMF1dOwogICAgICBjb25zdCB2YiA9IHRoaXMudmVydGljZXNbZlsxXV07CiAgICAgIGNvbnN0IHZjID0gdGhpcy52ZXJ0aWNlc1tmWzJdXTsKICAgICAgQ29udmV4UG9seWhlZHJvbi5jb21wdXRlTm9ybWFsKHZhLCB2YiwgdmMsIHRhcmdldCk7CiAgICB9CiAgICAvKioKICAgICAqIEdldCBmYWNlIG5vcm1hbCBnaXZlbiAzIHZlcnRpY2VzCiAgICAgKi8KCgogICAgc3RhdGljIGNvbXB1dGVOb3JtYWwodmEsIHZiLCB2YywgdGFyZ2V0KSB7CiAgICAgIGNvbnN0IGNiID0gbmV3IFZlYzMoKTsKICAgICAgY29uc3QgYWIgPSBuZXcgVmVjMygpOwogICAgICB2Yi52c3ViKHZhLCBhYik7CiAgICAgIHZjLnZzdWIodmIsIGNiKTsKICAgICAgY2IuY3Jvc3MoYWIsIHRhcmdldCk7CgogICAgICBpZiAoIXRhcmdldC5pc1plcm8oKSkgewogICAgICAgIHRhcmdldC5ub3JtYWxpemUoKTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBAcGFyYW0gbWluRGlzdCBDbGFtcCBkaXN0YW5jZQogICAgICogQHBhcmFtIHJlc3VsdCBUaGUgYW4gYXJyYXkgb2YgY29udGFjdCBwb2ludCBvYmplY3RzLCBzZWUgY2xpcEZhY2VBZ2FpbnN0SHVsbAogICAgICovCgoKICAgIGNsaXBBZ2FpbnN0SHVsbChwb3NBLCBxdWF0QSwgaHVsbEIsIHBvc0IsIHF1YXRCLCBzZXBhcmF0aW5nTm9ybWFsLCBtaW5EaXN0LCBtYXhEaXN0LCByZXN1bHQpIHsKICAgICAgY29uc3QgV29ybGROb3JtYWwgPSBuZXcgVmVjMygpOwogICAgICBsZXQgY2xvc2VzdEZhY2VCID0gLTE7CiAgICAgIGxldCBkbWF4ID0gLU51bWJlci5NQVhfVkFMVUU7CgogICAgICBmb3IgKGxldCBmYWNlID0gMDsgZmFjZSA8IGh1bGxCLmZhY2VzLmxlbmd0aDsgZmFjZSsrKSB7CiAgICAgICAgV29ybGROb3JtYWwuY29weShodWxsQi5mYWNlTm9ybWFsc1tmYWNlXSk7CiAgICAgICAgcXVhdEIudm11bHQoV29ybGROb3JtYWwsIFdvcmxkTm9ybWFsKTsKICAgICAgICBjb25zdCBkID0gV29ybGROb3JtYWwuZG90KHNlcGFyYXRpbmdOb3JtYWwpOwoKICAgICAgICBpZiAoZCA+IGRtYXgpIHsKICAgICAgICAgIGRtYXggPSBkOwogICAgICAgICAgY2xvc2VzdEZhY2VCID0gZmFjZTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIGNvbnN0IHdvcmxkVmVydHNCMSA9IFtdOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBodWxsQi5mYWNlc1tjbG9zZXN0RmFjZUJdLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgY29uc3QgYiA9IGh1bGxCLnZlcnRpY2VzW2h1bGxCLmZhY2VzW2Nsb3Nlc3RGYWNlQl1baV1dOwogICAgICAgIGNvbnN0IHdvcmxkYiA9IG5ldyBWZWMzKCk7CiAgICAgICAgd29ybGRiLmNvcHkoYik7CiAgICAgICAgcXVhdEIudm11bHQod29ybGRiLCB3b3JsZGIpOwogICAgICAgIHBvc0IudmFkZCh3b3JsZGIsIHdvcmxkYik7CiAgICAgICAgd29ybGRWZXJ0c0IxLnB1c2god29ybGRiKTsKICAgICAgfQoKICAgICAgaWYgKGNsb3Nlc3RGYWNlQiA+PSAwKSB7CiAgICAgICAgdGhpcy5jbGlwRmFjZUFnYWluc3RIdWxsKHNlcGFyYXRpbmdOb3JtYWwsIHBvc0EsIHF1YXRBLCB3b3JsZFZlcnRzQjEsIG1pbkRpc3QsIG1heERpc3QsIHJlc3VsdCk7CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogRmluZCB0aGUgc2VwYXJhdGluZyBheGlzIGJldHdlZW4gdGhpcyBodWxsIGFuZCBhbm90aGVyCiAgICAgKiBAcGFyYW0gdGFyZ2V0IFRoZSB0YXJnZXQgdmVjdG9yIHRvIHNhdmUgdGhlIGF4aXMgaW4KICAgICAqIEByZXR1cm4gUmV0dXJucyBmYWxzZSBpZiBhIHNlcGFyYXRpb24gaXMgZm91bmQsIGVsc2UgdHJ1ZQogICAgICovCgoKICAgIGZpbmRTZXBhcmF0aW5nQXhpcyhodWxsQiwgcG9zQSwgcXVhdEEsIHBvc0IsIHF1YXRCLCB0YXJnZXQsIGZhY2VMaXN0QSwgZmFjZUxpc3RCKSB7CiAgICAgIGNvbnN0IGZhY2VBTm9ybWFsV1MzID0gbmV3IFZlYzMoKTsKICAgICAgY29uc3QgV29ybGRub3JtYWwxID0gbmV3IFZlYzMoKTsKICAgICAgY29uc3QgZGVsdGFDID0gbmV3IFZlYzMoKTsKICAgICAgY29uc3Qgd29ybGRFZGdlMCA9IG5ldyBWZWMzKCk7CiAgICAgIGNvbnN0IHdvcmxkRWRnZTEgPSBuZXcgVmVjMygpOwogICAgICBjb25zdCBDcm9zcyA9IG5ldyBWZWMzKCk7CiAgICAgIGxldCBkbWluID0gTnVtYmVyLk1BWF9WQUxVRTsKICAgICAgY29uc3QgaHVsbEEgPSB0aGlzOwoKICAgICAgaWYgKCFodWxsQS51bmlxdWVBeGVzKSB7CiAgICAgICAgY29uc3QgbnVtRmFjZXNBID0gZmFjZUxpc3RBID8gZmFjZUxpc3RBLmxlbmd0aCA6IGh1bGxBLmZhY2VzLmxlbmd0aDsgLy8gVGVzdCBmYWNlIG5vcm1hbHMgZnJvbSBodWxsQQoKICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IG51bUZhY2VzQTsgaSsrKSB7CiAgICAgICAgICBjb25zdCBmaSA9IGZhY2VMaXN0QSA/IGZhY2VMaXN0QVtpXSA6IGk7IC8vIEdldCB3b3JsZCBmYWNlIG5vcm1hbAoKICAgICAgICAgIGZhY2VBTm9ybWFsV1MzLmNvcHkoaHVsbEEuZmFjZU5vcm1hbHNbZmldKTsKICAgICAgICAgIHF1YXRBLnZtdWx0KGZhY2VBTm9ybWFsV1MzLCBmYWNlQU5vcm1hbFdTMyk7CiAgICAgICAgICBjb25zdCBkID0gaHVsbEEudGVzdFNlcEF4aXMoZmFjZUFOb3JtYWxXUzMsIGh1bGxCLCBwb3NBLCBxdWF0QSwgcG9zQiwgcXVhdEIpOwoKICAgICAgICAgIGlmIChkID09PSBmYWxzZSkgewogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKGQgPCBkbWluKSB7CiAgICAgICAgICAgIGRtaW4gPSBkOwogICAgICAgICAgICB0YXJnZXQuY29weShmYWNlQU5vcm1hbFdTMyk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIC8vIFRlc3QgdW5pcXVlIGF4ZXMKICAgICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gaHVsbEEudW5pcXVlQXhlcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgLy8gR2V0IHdvcmxkIGF4aXMKICAgICAgICAgIHF1YXRBLnZtdWx0KGh1bGxBLnVuaXF1ZUF4ZXNbaV0sIGZhY2VBTm9ybWFsV1MzKTsKICAgICAgICAgIGNvbnN0IGQgPSBodWxsQS50ZXN0U2VwQXhpcyhmYWNlQU5vcm1hbFdTMywgaHVsbEIsIHBvc0EsIHF1YXRBLCBwb3NCLCBxdWF0Qik7CgogICAgICAgICAgaWYgKGQgPT09IGZhbHNlKSB7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoZCA8IGRtaW4pIHsKICAgICAgICAgICAgZG1pbiA9IGQ7CiAgICAgICAgICAgIHRhcmdldC5jb3B5KGZhY2VBTm9ybWFsV1MzKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KCiAgICAgIGlmICghaHVsbEIudW5pcXVlQXhlcykgewogICAgICAgIC8vIFRlc3QgZmFjZSBub3JtYWxzIGZyb20gaHVsbEIKICAgICAgICBjb25zdCBudW1GYWNlc0IgPSBmYWNlTGlzdEIgPyBmYWNlTGlzdEIubGVuZ3RoIDogaHVsbEIuZmFjZXMubGVuZ3RoOwoKICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IG51bUZhY2VzQjsgaSsrKSB7CiAgICAgICAgICBjb25zdCBmaSA9IGZhY2VMaXN0QiA/IGZhY2VMaXN0QltpXSA6IGk7CiAgICAgICAgICBXb3JsZG5vcm1hbDEuY29weShodWxsQi5mYWNlTm9ybWFsc1tmaV0pOwogICAgICAgICAgcXVhdEIudm11bHQoV29ybGRub3JtYWwxLCBXb3JsZG5vcm1hbDEpOwogICAgICAgICAgY29uc3QgZCA9IGh1bGxBLnRlc3RTZXBBeGlzKFdvcmxkbm9ybWFsMSwgaHVsbEIsIHBvc0EsIHF1YXRBLCBwb3NCLCBxdWF0Qik7CgogICAgICAgICAgaWYgKGQgPT09IGZhbHNlKSB7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoZCA8IGRtaW4pIHsKICAgICAgICAgICAgZG1pbiA9IGQ7CiAgICAgICAgICAgIHRhcmdldC5jb3B5KFdvcmxkbm9ybWFsMSk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIC8vIFRlc3QgdW5pcXVlIGF4ZXMgaW4gQgogICAgICAgIGZvciAobGV0IGkgPSAwOyBpICE9PSBodWxsQi51bmlxdWVBeGVzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICBxdWF0Qi52bXVsdChodWxsQi51bmlxdWVBeGVzW2ldLCBXb3JsZG5vcm1hbDEpOwogICAgICAgICAgY29uc3QgZCA9IGh1bGxBLnRlc3RTZXBBeGlzKFdvcmxkbm9ybWFsMSwgaHVsbEIsIHBvc0EsIHF1YXRBLCBwb3NCLCBxdWF0Qik7CgogICAgICAgICAgaWYgKGQgPT09IGZhbHNlKSB7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoZCA8IGRtaW4pIHsKICAgICAgICAgICAgZG1pbiA9IGQ7CiAgICAgICAgICAgIHRhcmdldC5jb3B5KFdvcmxkbm9ybWFsMSk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9IC8vIFRlc3QgZWRnZXMKCgogICAgICBmb3IgKGxldCBlMCA9IDA7IGUwICE9PSBodWxsQS51bmlxdWVFZGdlcy5sZW5ndGg7IGUwKyspIHsKICAgICAgICAvLyBHZXQgd29ybGQgZWRnZQogICAgICAgIHF1YXRBLnZtdWx0KGh1bGxBLnVuaXF1ZUVkZ2VzW2UwXSwgd29ybGRFZGdlMCk7CgogICAgICAgIGZvciAobGV0IGUxID0gMDsgZTEgIT09IGh1bGxCLnVuaXF1ZUVkZ2VzLmxlbmd0aDsgZTErKykgewogICAgICAgICAgLy8gR2V0IHdvcmxkIGVkZ2UgMgogICAgICAgICAgcXVhdEIudm11bHQoaHVsbEIudW5pcXVlRWRnZXNbZTFdLCB3b3JsZEVkZ2UxKTsKICAgICAgICAgIHdvcmxkRWRnZTAuY3Jvc3Mod29ybGRFZGdlMSwgQ3Jvc3MpOwoKICAgICAgICAgIGlmICghQ3Jvc3MuYWxtb3N0WmVybygpKSB7CiAgICAgICAgICAgIENyb3NzLm5vcm1hbGl6ZSgpOwogICAgICAgICAgICBjb25zdCBkaXN0ID0gaHVsbEEudGVzdFNlcEF4aXMoQ3Jvc3MsIGh1bGxCLCBwb3NBLCBxdWF0QSwgcG9zQiwgcXVhdEIpOwoKICAgICAgICAgICAgaWYgKGRpc3QgPT09IGZhbHNlKSB7CiAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoZGlzdCA8IGRtaW4pIHsKICAgICAgICAgICAgICBkbWluID0gZGlzdDsKICAgICAgICAgICAgICB0YXJnZXQuY29weShDcm9zcyk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KCiAgICAgIHBvc0IudnN1Yihwb3NBLCBkZWx0YUMpOwoKICAgICAgaWYgKGRlbHRhQy5kb3QodGFyZ2V0KSA+IDAuMCkgewogICAgICAgIHRhcmdldC5uZWdhdGUodGFyZ2V0KTsKICAgICAgfQoKICAgICAgcmV0dXJuIHRydWU7CiAgICB9CiAgICAvKioKICAgICAqIFRlc3Qgc2VwYXJhdGluZyBheGlzIGFnYWluc3QgdHdvIGh1bGxzLiBCb3RoIGh1bGxzIGFyZSBwcm9qZWN0ZWQgb250byB0aGUgYXhpcyBhbmQgdGhlIG92ZXJsYXAgc2l6ZSBpcyByZXR1cm5lZCBpZiB0aGVyZSBpcyBvbmUuCiAgICAgKiBAcmV0dXJuIFRoZSBvdmVybGFwIGRlcHRoLCBvciBGQUxTRSBpZiBubyBwZW5ldHJhdGlvbi4KICAgICAqLwoKCiAgICB0ZXN0U2VwQXhpcyhheGlzLCBodWxsQiwgcG9zQSwgcXVhdEEsIHBvc0IsIHF1YXRCKSB7CiAgICAgIGNvbnN0IGh1bGxBID0gdGhpczsKICAgICAgQ29udmV4UG9seWhlZHJvbi5wcm9qZWN0KGh1bGxBLCBheGlzLCBwb3NBLCBxdWF0QSwgbWF4bWluQSk7CiAgICAgIENvbnZleFBvbHloZWRyb24ucHJvamVjdChodWxsQiwgYXhpcywgcG9zQiwgcXVhdEIsIG1heG1pbkIpOwogICAgICBjb25zdCBtYXhBID0gbWF4bWluQVswXTsKICAgICAgY29uc3QgbWluQSA9IG1heG1pbkFbMV07CiAgICAgIGNvbnN0IG1heEIgPSBtYXhtaW5CWzBdOwogICAgICBjb25zdCBtaW5CID0gbWF4bWluQlsxXTsKCiAgICAgIGlmIChtYXhBIDwgbWluQiB8fCBtYXhCIDwgbWluQSkgewogICAgICAgIHJldHVybiBmYWxzZTsgLy8gU2VwYXJhdGVkCiAgICAgIH0KCiAgICAgIGNvbnN0IGQwID0gbWF4QSAtIG1pbkI7CiAgICAgIGNvbnN0IGQxID0gbWF4QiAtIG1pbkE7CiAgICAgIGNvbnN0IGRlcHRoID0gZDAgPCBkMSA/IGQwIDogZDE7CiAgICAgIHJldHVybiBkZXB0aDsKICAgIH0KICAgIC8qKgogICAgICogY2FsY3VsYXRlTG9jYWxJbmVydGlhCiAgICAgKi8KCgogICAgY2FsY3VsYXRlTG9jYWxJbmVydGlhKG1hc3MsIHRhcmdldCkgewogICAgICAvLyBBcHByb3hpbWF0ZSB3aXRoIGJveCBpbmVydGlhCiAgICAgIC8vIEV4YWN0IGluZXJ0aWEgY2FsY3VsYXRpb24gaXMgb3ZlcmtpbGwsIGJ1dCBzZWUgaHR0cDovL2dlb21ldHJpY3Rvb2xzLmNvbS9Eb2N1bWVudGF0aW9uL1BvbHloZWRyYWxNYXNzUHJvcGVydGllcy5wZGYgZm9yIHRoZSBjb3JyZWN0IHdheSB0byBkbyBpdAogICAgICBjb25zdCBhYWJibWF4ID0gbmV3IFZlYzMoKTsKICAgICAgY29uc3QgYWFiYm1pbiA9IG5ldyBWZWMzKCk7CiAgICAgIHRoaXMuY29tcHV0ZUxvY2FsQUFCQihhYWJibWluLCBhYWJibWF4KTsKICAgICAgY29uc3QgeCA9IGFhYmJtYXgueCAtIGFhYmJtaW4ueDsKICAgICAgY29uc3QgeSA9IGFhYmJtYXgueSAtIGFhYmJtaW4ueTsKICAgICAgY29uc3QgeiA9IGFhYmJtYXgueiAtIGFhYmJtaW4uejsKICAgICAgdGFyZ2V0LnggPSAxLjAgLyAxMi4wICogbWFzcyAqICgyICogeSAqIDIgKiB5ICsgMiAqIHogKiAyICogeik7CiAgICAgIHRhcmdldC55ID0gMS4wIC8gMTIuMCAqIG1hc3MgKiAoMiAqIHggKiAyICogeCArIDIgKiB6ICogMiAqIHopOwogICAgICB0YXJnZXQueiA9IDEuMCAvIDEyLjAgKiBtYXNzICogKDIgKiB5ICogMiAqIHkgKyAyICogeCAqIDIgKiB4KTsKICAgIH0KICAgIC8qKgogICAgICogQHBhcmFtIGZhY2VfaSBJbmRleCBvZiB0aGUgZmFjZQogICAgICovCgoKICAgIGdldFBsYW5lQ29uc3RhbnRPZkZhY2UoZmFjZV9pKSB7CiAgICAgIGNvbnN0IGYgPSB0aGlzLmZhY2VzW2ZhY2VfaV07CiAgICAgIGNvbnN0IG4gPSB0aGlzLmZhY2VOb3JtYWxzW2ZhY2VfaV07CiAgICAgIGNvbnN0IHYgPSB0aGlzLnZlcnRpY2VzW2ZbMF1dOwogICAgICBjb25zdCBjID0gLW4uZG90KHYpOwogICAgICByZXR1cm4gYzsKICAgIH0KICAgIC8qKgogICAgICogQ2xpcCBhIGZhY2UgYWdhaW5zdCBhIGh1bGwuCiAgICAgKiBAcGFyYW0gd29ybGRWZXJ0c0IxIEFuIGFycmF5IG9mIFZlYzMgd2l0aCB2ZXJ0aWNlcyBpbiB0aGUgd29ybGQgZnJhbWUuCiAgICAgKiBAcGFyYW0gbWluRGlzdCBEaXN0YW5jZSBjbGFtcGluZwogICAgICogQHBhcmFtIEFycmF5IHJlc3VsdCBBcnJheSB0byBzdG9yZSByZXN1bHRpbmcgY29udGFjdCBwb2ludHMgaW4uIFdpbGwgYmUgb2JqZWN0cyB3aXRoIHByb3BlcnRpZXM6IHBvaW50LCBkZXB0aCwgbm9ybWFsLiBUaGVzZSBhcmUgcmVwcmVzZW50ZWQgaW4gd29ybGQgY29vcmRpbmF0ZXMuCiAgICAgKi8KCgogICAgY2xpcEZhY2VBZ2FpbnN0SHVsbChzZXBhcmF0aW5nTm9ybWFsLCBwb3NBLCBxdWF0QSwgd29ybGRWZXJ0c0IxLCBtaW5EaXN0LCBtYXhEaXN0LCByZXN1bHQpIHsKICAgICAgY29uc3QgZmFjZUFOb3JtYWxXUyA9IG5ldyBWZWMzKCk7CiAgICAgIGNvbnN0IGVkZ2UwID0gbmV3IFZlYzMoKTsKICAgICAgY29uc3QgV29ybGRFZGdlMCA9IG5ldyBWZWMzKCk7CiAgICAgIGNvbnN0IHdvcmxkUGxhbmVBbm9ybWFsMSA9IG5ldyBWZWMzKCk7CiAgICAgIGNvbnN0IHBsYW5lTm9ybWFsV1MxID0gbmV3IFZlYzMoKTsKICAgICAgY29uc3Qgd29ybGRBMSA9IG5ldyBWZWMzKCk7CiAgICAgIGNvbnN0IGxvY2FsUGxhbmVOb3JtYWwgPSBuZXcgVmVjMygpOwogICAgICBjb25zdCBwbGFuZU5vcm1hbFdTID0gbmV3IFZlYzMoKTsKICAgICAgY29uc3QgaHVsbEEgPSB0aGlzOwogICAgICBjb25zdCB3b3JsZFZlcnRzQjIgPSBbXTsKICAgICAgY29uc3QgcFZ0eEluID0gd29ybGRWZXJ0c0IxOwogICAgICBjb25zdCBwVnR4T3V0ID0gd29ybGRWZXJ0c0IyOwogICAgICBsZXQgY2xvc2VzdEZhY2VBID0gLTE7CiAgICAgIGxldCBkbWluID0gTnVtYmVyLk1BWF9WQUxVRTsgLy8gRmluZCB0aGUgZmFjZSB3aXRoIG5vcm1hbCBjbG9zZXN0IHRvIHRoZSBzZXBhcmF0aW5nIGF4aXMKCiAgICAgIGZvciAobGV0IGZhY2UgPSAwOyBmYWNlIDwgaHVsbEEuZmFjZXMubGVuZ3RoOyBmYWNlKyspIHsKICAgICAgICBmYWNlQU5vcm1hbFdTLmNvcHkoaHVsbEEuZmFjZU5vcm1hbHNbZmFjZV0pOwogICAgICAgIHF1YXRBLnZtdWx0KGZhY2VBTm9ybWFsV1MsIGZhY2VBTm9ybWFsV1MpOwogICAgICAgIGNvbnN0IGQgPSBmYWNlQU5vcm1hbFdTLmRvdChzZXBhcmF0aW5nTm9ybWFsKTsKCiAgICAgICAgaWYgKGQgPCBkbWluKSB7CiAgICAgICAgICBkbWluID0gZDsKICAgICAgICAgIGNsb3Nlc3RGYWNlQSA9IGZhY2U7CiAgICAgICAgfQogICAgICB9CgogICAgICBpZiAoY2xvc2VzdEZhY2VBIDwgMCkgewogICAgICAgIHJldHVybjsKICAgICAgfSAvLyBHZXQgdGhlIGZhY2UgYW5kIGNvbnN0cnVjdCBjb25uZWN0ZWQgZmFjZXMKCgogICAgICBjb25zdCBwb2x5QSA9IGh1bGxBLmZhY2VzW2Nsb3Nlc3RGYWNlQV07CiAgICAgIHBvbHlBLmNvbm5lY3RlZEZhY2VzID0gW107CgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGh1bGxBLmZhY2VzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCBodWxsQS5mYWNlc1tpXS5sZW5ndGg7IGorKykgewogICAgICAgICAgaWYgKAogICAgICAgICAgLyogU2hhcmluZyBhIHZlcnRleCovCiAgICAgICAgICBwb2x5QS5pbmRleE9mKGh1bGxBLmZhY2VzW2ldW2pdKSAhPT0gLTEgJiYKICAgICAgICAgIC8qIE5vdCB0aGUgb25lIHdlIGFyZSBsb29raW5nIGZvciBjb25uZWN0aW9ucyBmcm9tICovCiAgICAgICAgICBpICE9PSBjbG9zZXN0RmFjZUEgJiYKICAgICAgICAgIC8qIE5vdCBhbHJlYWR5IGFkZGVkICovCiAgICAgICAgICBwb2x5QS5jb25uZWN0ZWRGYWNlcy5pbmRleE9mKGkpID09PSAtMSkgewogICAgICAgICAgICBwb2x5QS5jb25uZWN0ZWRGYWNlcy5wdXNoKGkpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSAvLyBDbGlwIHRoZSBwb2x5Z29uIHRvIHRoZSBiYWNrIG9mIHRoZSBwbGFuZXMgb2YgYWxsIGZhY2VzIG9mIGh1bGwgQSwKICAgICAgLy8gdGhhdCBhcmUgYWRqYWNlbnQgdG8gdGhlIHdpdG5lc3MgZmFjZQoKCiAgICAgIGNvbnN0IG51bVZlcnRpY2VzQSA9IHBvbHlBLmxlbmd0aDsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbnVtVmVydGljZXNBOyBpKyspIHsKICAgICAgICBjb25zdCBhID0gaHVsbEEudmVydGljZXNbcG9seUFbaV1dOwogICAgICAgIGNvbnN0IGIgPSBodWxsQS52ZXJ0aWNlc1twb2x5QVsoaSArIDEpICUgbnVtVmVydGljZXNBXV07CiAgICAgICAgYS52c3ViKGIsIGVkZ2UwKTsKICAgICAgICBXb3JsZEVkZ2UwLmNvcHkoZWRnZTApOwogICAgICAgIHF1YXRBLnZtdWx0KFdvcmxkRWRnZTAsIFdvcmxkRWRnZTApOwogICAgICAgIHBvc0EudmFkZChXb3JsZEVkZ2UwLCBXb3JsZEVkZ2UwKTsKICAgICAgICB3b3JsZFBsYW5lQW5vcm1hbDEuY29weSh0aGlzLmZhY2VOb3JtYWxzW2Nsb3Nlc3RGYWNlQV0pOwogICAgICAgIHF1YXRBLnZtdWx0KHdvcmxkUGxhbmVBbm9ybWFsMSwgd29ybGRQbGFuZUFub3JtYWwxKTsKICAgICAgICBwb3NBLnZhZGQod29ybGRQbGFuZUFub3JtYWwxLCB3b3JsZFBsYW5lQW5vcm1hbDEpOwogICAgICAgIFdvcmxkRWRnZTAuY3Jvc3Mod29ybGRQbGFuZUFub3JtYWwxLCBwbGFuZU5vcm1hbFdTMSk7CiAgICAgICAgcGxhbmVOb3JtYWxXUzEubmVnYXRlKHBsYW5lTm9ybWFsV1MxKTsKICAgICAgICB3b3JsZEExLmNvcHkoYSk7CiAgICAgICAgcXVhdEEudm11bHQod29ybGRBMSwgd29ybGRBMSk7CiAgICAgICAgcG9zQS52YWRkKHdvcmxkQTEsIHdvcmxkQTEpOwogICAgICAgIGNvbnN0IG90aGVyRmFjZSA9IHBvbHlBLmNvbm5lY3RlZEZhY2VzW2ldOwogICAgICAgIGxvY2FsUGxhbmVOb3JtYWwuY29weSh0aGlzLmZhY2VOb3JtYWxzW290aGVyRmFjZV0pOwogICAgICAgIGNvbnN0IGxvY2FsUGxhbmVFcSA9IHRoaXMuZ2V0UGxhbmVDb25zdGFudE9mRmFjZShvdGhlckZhY2UpOwogICAgICAgIHBsYW5lTm9ybWFsV1MuY29weShsb2NhbFBsYW5lTm9ybWFsKTsKICAgICAgICBxdWF0QS52bXVsdChwbGFuZU5vcm1hbFdTLCBwbGFuZU5vcm1hbFdTKTsKICAgICAgICBjb25zdCBwbGFuZUVxV1MgPSBsb2NhbFBsYW5lRXEgLSBwbGFuZU5vcm1hbFdTLmRvdChwb3NBKTsgLy8gQ2xpcCBmYWNlIGFnYWluc3Qgb3VyIGNvbnN0cnVjdGVkIHBsYW5lCgogICAgICAgIHRoaXMuY2xpcEZhY2VBZ2FpbnN0UGxhbmUocFZ0eEluLCBwVnR4T3V0LCBwbGFuZU5vcm1hbFdTLCBwbGFuZUVxV1MpOyAvLyBUaHJvdyBhd2F5IGFsbCBjbGlwcGVkIHBvaW50cywgYnV0IHNhdmUgdGhlIHJlbWFpbmluZyB1bnRpbCBuZXh0IGNsaXAKCiAgICAgICAgd2hpbGUgKHBWdHhJbi5sZW5ndGgpIHsKICAgICAgICAgIHBWdHhJbi5zaGlmdCgpOwogICAgICAgIH0KCiAgICAgICAgd2hpbGUgKHBWdHhPdXQubGVuZ3RoKSB7CiAgICAgICAgICBwVnR4SW4ucHVzaChwVnR4T3V0LnNoaWZ0KCkpOwogICAgICAgIH0KICAgICAgfSAvLyBvbmx5IGtlZXAgY29udGFjdCBwb2ludHMgdGhhdCBhcmUgYmVoaW5kIHRoZSB3aXRuZXNzIGZhY2UKCgogICAgICBsb2NhbFBsYW5lTm9ybWFsLmNvcHkodGhpcy5mYWNlTm9ybWFsc1tjbG9zZXN0RmFjZUFdKTsKICAgICAgY29uc3QgbG9jYWxQbGFuZUVxID0gdGhpcy5nZXRQbGFuZUNvbnN0YW50T2ZGYWNlKGNsb3Nlc3RGYWNlQSk7CiAgICAgIHBsYW5lTm9ybWFsV1MuY29weShsb2NhbFBsYW5lTm9ybWFsKTsKICAgICAgcXVhdEEudm11bHQocGxhbmVOb3JtYWxXUywgcGxhbmVOb3JtYWxXUyk7CiAgICAgIGNvbnN0IHBsYW5lRXFXUyA9IGxvY2FsUGxhbmVFcSAtIHBsYW5lTm9ybWFsV1MuZG90KHBvc0EpOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBwVnR4SW4ubGVuZ3RoOyBpKyspIHsKICAgICAgICBsZXQgZGVwdGggPSBwbGFuZU5vcm1hbFdTLmRvdChwVnR4SW5baV0pICsgcGxhbmVFcVdTOyAvLyA/Pz8KCiAgICAgICAgaWYgKGRlcHRoIDw9IG1pbkRpc3QpIHsKICAgICAgICAgIGNvbnNvbGUubG9nKGBjbGFtcGVkOiBkZXB0aD0ke2RlcHRofSB0byBtaW5EaXN0PSR7bWluRGlzdH1gKTsKICAgICAgICAgIGRlcHRoID0gbWluRGlzdDsKICAgICAgICB9CgogICAgICAgIGlmIChkZXB0aCA8PSBtYXhEaXN0KSB7CiAgICAgICAgICBjb25zdCBwb2ludCA9IHBWdHhJbltpXTsKCiAgICAgICAgICBpZiAoZGVwdGggPD0gMWUtNikgewogICAgICAgICAgICBjb25zdCBwID0gewogICAgICAgICAgICAgIHBvaW50LAogICAgICAgICAgICAgIG5vcm1hbDogcGxhbmVOb3JtYWxXUywKICAgICAgICAgICAgICBkZXB0aAogICAgICAgICAgICB9OwogICAgICAgICAgICByZXN1bHQucHVzaChwKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogQ2xpcCBhIGZhY2UgaW4gYSBodWxsIGFnYWluc3QgdGhlIGJhY2sgb2YgYSBwbGFuZS4KICAgICAqIEBwYXJhbSBwbGFuZUNvbnN0YW50IFRoZSBjb25zdGFudCBpbiB0aGUgbWF0aGVtYXRpY2FsIHBsYW5lIGVxdWF0aW9uCiAgICAgKi8KCgogICAgY2xpcEZhY2VBZ2FpbnN0UGxhbmUoaW5WZXJ0aWNlcywgb3V0VmVydGljZXMsIHBsYW5lTm9ybWFsLCBwbGFuZUNvbnN0YW50KSB7CiAgICAgIGxldCBuX2RvdF9maXJzdDsKICAgICAgbGV0IG5fZG90X2xhc3Q7CiAgICAgIGNvbnN0IG51bVZlcnRzID0gaW5WZXJ0aWNlcy5sZW5ndGg7CgogICAgICBpZiAobnVtVmVydHMgPCAyKSB7CiAgICAgICAgcmV0dXJuIG91dFZlcnRpY2VzOwogICAgICB9CgogICAgICBsZXQgZmlyc3RWZXJ0ZXggPSBpblZlcnRpY2VzW2luVmVydGljZXMubGVuZ3RoIC0gMV07CiAgICAgIGxldCBsYXN0VmVydGV4ID0gaW5WZXJ0aWNlc1swXTsKICAgICAgbl9kb3RfZmlyc3QgPSBwbGFuZU5vcm1hbC5kb3QoZmlyc3RWZXJ0ZXgpICsgcGxhbmVDb25zdGFudDsKCiAgICAgIGZvciAobGV0IHZpID0gMDsgdmkgPCBudW1WZXJ0czsgdmkrKykgewogICAgICAgIGxhc3RWZXJ0ZXggPSBpblZlcnRpY2VzW3ZpXTsKICAgICAgICBuX2RvdF9sYXN0ID0gcGxhbmVOb3JtYWwuZG90KGxhc3RWZXJ0ZXgpICsgcGxhbmVDb25zdGFudDsKCiAgICAgICAgaWYgKG5fZG90X2ZpcnN0IDwgMCkgewogICAgICAgICAgaWYgKG5fZG90X2xhc3QgPCAwKSB7CiAgICAgICAgICAgIC8vIFN0YXJ0IDwgMCwgZW5kIDwgMCwgc28gb3V0cHV0IGxhc3RWZXJ0ZXgKICAgICAgICAgICAgY29uc3QgbmV3diA9IG5ldyBWZWMzKCk7CiAgICAgICAgICAgIG5ld3YuY29weShsYXN0VmVydGV4KTsKICAgICAgICAgICAgb3V0VmVydGljZXMucHVzaChuZXd2KTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIC8vIFN0YXJ0IDwgMCwgZW5kID49IDAsIHNvIG91dHB1dCBpbnRlcnNlY3Rpb24KICAgICAgICAgICAgY29uc3QgbmV3diA9IG5ldyBWZWMzKCk7CiAgICAgICAgICAgIGZpcnN0VmVydGV4LmxlcnAobGFzdFZlcnRleCwgbl9kb3RfZmlyc3QgLyAobl9kb3RfZmlyc3QgLSBuX2RvdF9sYXN0KSwgbmV3dik7CiAgICAgICAgICAgIG91dFZlcnRpY2VzLnB1c2gobmV3dik7CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGlmIChuX2RvdF9sYXN0IDwgMCkgewogICAgICAgICAgICAvLyBTdGFydCA+PSAwLCBlbmQgPCAwIHNvIG91dHB1dCBpbnRlcnNlY3Rpb24gYW5kIGVuZAogICAgICAgICAgICBjb25zdCBuZXd2ID0gbmV3IFZlYzMoKTsKICAgICAgICAgICAgZmlyc3RWZXJ0ZXgubGVycChsYXN0VmVydGV4LCBuX2RvdF9maXJzdCAvIChuX2RvdF9maXJzdCAtIG5fZG90X2xhc3QpLCBuZXd2KTsKICAgICAgICAgICAgb3V0VmVydGljZXMucHVzaChuZXd2KTsKICAgICAgICAgICAgb3V0VmVydGljZXMucHVzaChsYXN0VmVydGV4KTsKICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGZpcnN0VmVydGV4ID0gbGFzdFZlcnRleDsKICAgICAgICBuX2RvdF9maXJzdCA9IG5fZG90X2xhc3Q7CiAgICAgIH0KCiAgICAgIHJldHVybiBvdXRWZXJ0aWNlczsKICAgIH0KICAgIC8qKgogICAgICogVXBkYXRlcyBgLndvcmxkVmVydGljZXNgIGFuZCBzZXRzIGAud29ybGRWZXJ0aWNlc05lZWRzVXBkYXRlYCB0byBmYWxzZS4KICAgICAqLwoKCiAgICBjb21wdXRlV29ybGRWZXJ0aWNlcyhwb3NpdGlvbiwgcXVhdCkgewogICAgICB3aGlsZSAodGhpcy53b3JsZFZlcnRpY2VzLmxlbmd0aCA8IHRoaXMudmVydGljZXMubGVuZ3RoKSB7CiAgICAgICAgdGhpcy53b3JsZFZlcnRpY2VzLnB1c2gobmV3IFZlYzMoKSk7CiAgICAgIH0KCiAgICAgIGNvbnN0IHZlcnRzID0gdGhpcy52ZXJ0aWNlczsKICAgICAgY29uc3Qgd29ybGRWZXJ0cyA9IHRoaXMud29ybGRWZXJ0aWNlczsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpICE9PSB0aGlzLnZlcnRpY2VzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgcXVhdC52bXVsdCh2ZXJ0c1tpXSwgd29ybGRWZXJ0c1tpXSk7CiAgICAgICAgcG9zaXRpb24udmFkZCh3b3JsZFZlcnRzW2ldLCB3b3JsZFZlcnRzW2ldKTsKICAgICAgfQoKICAgICAgdGhpcy53b3JsZFZlcnRpY2VzTmVlZHNVcGRhdGUgPSBmYWxzZTsKICAgIH0KCiAgICBjb21wdXRlTG9jYWxBQUJCKGFhYmJtaW4sIGFhYmJtYXgpIHsKICAgICAgY29uc3QgdmVydGljZXMgPSB0aGlzLnZlcnRpY2VzOwogICAgICBhYWJibWluLnNldChOdW1iZXIuTUFYX1ZBTFVFLCBOdW1iZXIuTUFYX1ZBTFVFLCBOdW1iZXIuTUFYX1ZBTFVFKTsKICAgICAgYWFiYm1heC5zZXQoLU51bWJlci5NQVhfVkFMVUUsIC1OdW1iZXIuTUFYX1ZBTFVFLCAtTnVtYmVyLk1BWF9WQUxVRSk7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMudmVydGljZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICBjb25zdCB2ID0gdmVydGljZXNbaV07CgogICAgICAgIGlmICh2LnggPCBhYWJibWluLngpIHsKICAgICAgICAgIGFhYmJtaW4ueCA9IHYueDsKICAgICAgICB9IGVsc2UgaWYgKHYueCA+IGFhYmJtYXgueCkgewogICAgICAgICAgYWFiYm1heC54ID0gdi54OwogICAgICAgIH0KCiAgICAgICAgaWYgKHYueSA8IGFhYmJtaW4ueSkgewogICAgICAgICAgYWFiYm1pbi55ID0gdi55OwogICAgICAgIH0gZWxzZSBpZiAodi55ID4gYWFiYm1heC55KSB7CiAgICAgICAgICBhYWJibWF4LnkgPSB2Lnk7CiAgICAgICAgfQoKICAgICAgICBpZiAodi56IDwgYWFiYm1pbi56KSB7CiAgICAgICAgICBhYWJibWluLnogPSB2Lno7CiAgICAgICAgfSBlbHNlIGlmICh2LnogPiBhYWJibWF4LnopIHsKICAgICAgICAgIGFhYmJtYXgueiA9IHYuejsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogVXBkYXRlcyBgd29ybGRWZXJ0aWNlc2AgYW5kIHNldHMgYHdvcmxkVmVydGljZXNOZWVkc1VwZGF0ZWAgdG8gZmFsc2UuCiAgICAgKi8KCgogICAgY29tcHV0ZVdvcmxkRmFjZU5vcm1hbHMocXVhdCkgewogICAgICBjb25zdCBOID0gdGhpcy5mYWNlTm9ybWFscy5sZW5ndGg7CgogICAgICB3aGlsZSAodGhpcy53b3JsZEZhY2VOb3JtYWxzLmxlbmd0aCA8IE4pIHsKICAgICAgICB0aGlzLndvcmxkRmFjZU5vcm1hbHMucHVzaChuZXcgVmVjMygpKTsKICAgICAgfQoKICAgICAgY29uc3Qgbm9ybWFscyA9IHRoaXMuZmFjZU5vcm1hbHM7CiAgICAgIGNvbnN0IHdvcmxkTm9ybWFscyA9IHRoaXMud29ybGRGYWNlTm9ybWFsczsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpICE9PSBOOyBpKyspIHsKICAgICAgICBxdWF0LnZtdWx0KG5vcm1hbHNbaV0sIHdvcmxkTm9ybWFsc1tpXSk7CiAgICAgIH0KCiAgICAgIHRoaXMud29ybGRGYWNlTm9ybWFsc05lZWRzVXBkYXRlID0gZmFsc2U7CiAgICB9CiAgICAvKioKICAgICAqIHVwZGF0ZUJvdW5kaW5nU3BoZXJlUmFkaXVzCiAgICAgKi8KCgogICAgdXBkYXRlQm91bmRpbmdTcGhlcmVSYWRpdXMoKSB7CiAgICAgIC8vIEFzc3VtZSBwb2ludHMgYXJlIGRpc3RyaWJ1dGVkIHdpdGggbG9jYWwgKDAsMCwwKSBhcyBjZW50ZXIKICAgICAgbGV0IG1heDIgPSAwOwogICAgICBjb25zdCB2ZXJ0cyA9IHRoaXMudmVydGljZXM7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gdmVydHMubGVuZ3RoOyBpKyspIHsKICAgICAgICBjb25zdCBub3JtMiA9IHZlcnRzW2ldLmxlbmd0aFNxdWFyZWQoKTsKCiAgICAgICAgaWYgKG5vcm0yID4gbWF4MikgewogICAgICAgICAgbWF4MiA9IG5vcm0yOwogICAgICAgIH0KICAgICAgfQoKICAgICAgdGhpcy5ib3VuZGluZ1NwaGVyZVJhZGl1cyA9IE1hdGguc3FydChtYXgyKTsKICAgIH0KICAgIC8qKgogICAgICogY2FsY3VsYXRlV29ybGRBQUJCCiAgICAgKi8KCgogICAgY2FsY3VsYXRlV29ybGRBQUJCKHBvcywgcXVhdCwgbWluLCBtYXgpIHsKICAgICAgY29uc3QgdmVydHMgPSB0aGlzLnZlcnRpY2VzOwogICAgICBsZXQgbWlueDsKICAgICAgbGV0IG1pbnk7CiAgICAgIGxldCBtaW56OwogICAgICBsZXQgbWF4eDsKICAgICAgbGV0IG1heHk7CiAgICAgIGxldCBtYXh6OwogICAgICBsZXQgdGVtcFdvcmxkVmVydGV4ID0gbmV3IFZlYzMoKTsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdmVydHMubGVuZ3RoOyBpKyspIHsKICAgICAgICB0ZW1wV29ybGRWZXJ0ZXguY29weSh2ZXJ0c1tpXSk7CiAgICAgICAgcXVhdC52bXVsdCh0ZW1wV29ybGRWZXJ0ZXgsIHRlbXBXb3JsZFZlcnRleCk7CiAgICAgICAgcG9zLnZhZGQodGVtcFdvcmxkVmVydGV4LCB0ZW1wV29ybGRWZXJ0ZXgpOwogICAgICAgIGNvbnN0IHYgPSB0ZW1wV29ybGRWZXJ0ZXg7CgogICAgICAgIGlmIChtaW54ID09PSB1bmRlZmluZWQgfHwgdi54IDwgbWlueCkgewogICAgICAgICAgbWlueCA9IHYueDsKICAgICAgICB9CgogICAgICAgIGlmIChtYXh4ID09PSB1bmRlZmluZWQgfHwgdi54ID4gbWF4eCkgewogICAgICAgICAgbWF4eCA9IHYueDsKICAgICAgICB9CgogICAgICAgIGlmIChtaW55ID09PSB1bmRlZmluZWQgfHwgdi55IDwgbWlueSkgewogICAgICAgICAgbWlueSA9IHYueTsKICAgICAgICB9CgogICAgICAgIGlmIChtYXh5ID09PSB1bmRlZmluZWQgfHwgdi55ID4gbWF4eSkgewogICAgICAgICAgbWF4eSA9IHYueTsKICAgICAgICB9CgogICAgICAgIGlmIChtaW56ID09PSB1bmRlZmluZWQgfHwgdi56IDwgbWlueikgewogICAgICAgICAgbWlueiA9IHYuejsKICAgICAgICB9CgogICAgICAgIGlmIChtYXh6ID09PSB1bmRlZmluZWQgfHwgdi56ID4gbWF4eikgewogICAgICAgICAgbWF4eiA9IHYuejsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIG1pbi5zZXQobWlueCwgbWlueSwgbWlueik7CiAgICAgIG1heC5zZXQobWF4eCwgbWF4eSwgbWF4eik7CiAgICB9CiAgICAvKioKICAgICAqIEdldCBhcHByb3hpbWF0ZSBjb252ZXggdm9sdW1lCiAgICAgKi8KCgogICAgdm9sdW1lKCkgewogICAgICByZXR1cm4gNC4wICogTWF0aC5QSSAqIHRoaXMuYm91bmRpbmdTcGhlcmVSYWRpdXMgLyAzLjA7CiAgICB9CiAgICAvKioKICAgICAqIEdldCBhbiBhdmVyYWdlIG9mIGFsbCB0aGUgdmVydGljZXMgcG9zaXRpb25zCiAgICAgKi8KCgogICAgZ2V0QXZlcmFnZVBvaW50TG9jYWwodGFyZ2V0KSB7CiAgICAgIGlmICh0YXJnZXQgPT09IHZvaWQgMCkgewogICAgICAgIHRhcmdldCA9IG5ldyBWZWMzKCk7CiAgICAgIH0KCiAgICAgIGNvbnN0IHZlcnRzID0gdGhpcy52ZXJ0aWNlczsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdmVydHMubGVuZ3RoOyBpKyspIHsKICAgICAgICB0YXJnZXQudmFkZCh2ZXJ0c1tpXSwgdGFyZ2V0KTsKICAgICAgfQoKICAgICAgdGFyZ2V0LnNjYWxlKDEgLyB2ZXJ0cy5sZW5ndGgsIHRhcmdldCk7CiAgICAgIHJldHVybiB0YXJnZXQ7CiAgICB9CiAgICAvKioKICAgICAqIFRyYW5zZm9ybSBhbGwgbG9jYWwgcG9pbnRzLiBXaWxsIGNoYW5nZSB0aGUgLnZlcnRpY2VzCiAgICAgKi8KCgogICAgdHJhbnNmb3JtQWxsUG9pbnRzKG9mZnNldCwgcXVhdCkgewogICAgICBjb25zdCBuID0gdGhpcy52ZXJ0aWNlcy5sZW5ndGg7CiAgICAgIGNvbnN0IHZlcnRzID0gdGhpcy52ZXJ0aWNlczsgLy8gQXBwbHkgcm90YXRpb24KCiAgICAgIGlmIChxdWF0KSB7CiAgICAgICAgLy8gUm90YXRlIHZlcnRpY2VzCiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBuOyBpKyspIHsKICAgICAgICAgIGNvbnN0IHYgPSB2ZXJ0c1tpXTsKICAgICAgICAgIHF1YXQudm11bHQodiwgdik7CiAgICAgICAgfSAvLyBSb3RhdGUgZmFjZSBub3JtYWxzCgoKICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMuZmFjZU5vcm1hbHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgIGNvbnN0IHYgPSB0aGlzLmZhY2VOb3JtYWxzW2ldOwogICAgICAgICAgcXVhdC52bXVsdCh2LCB2KTsKICAgICAgICB9CiAgICAgICAgLyoKICAgICAgICAgICAgICAvLyBSb3RhdGUgZWRnZXMKICAgICAgICAgICAgICBmb3IobGV0IGk9MDsgaTx0aGlzLnVuaXF1ZUVkZ2VzLmxlbmd0aDsgaSsrKXsKICAgICAgICAgICAgICAgICAgY29uc3QgdiA9IHRoaXMudW5pcXVlRWRnZXNbaV07CiAgICAgICAgICAgICAgICAgIHF1YXQudm11bHQodix2KTsKICAgICAgICAgICAgICB9Ki8KCiAgICAgIH0gLy8gQXBwbHkgb2Zmc2V0CgoKICAgICAgaWYgKG9mZnNldCkgewogICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbjsgaSsrKSB7CiAgICAgICAgICBjb25zdCB2ID0gdmVydHNbaV07CiAgICAgICAgICB2LnZhZGQob2Zmc2V0LCB2KTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogQ2hlY2tzIHdoZXRoZXIgcCBpcyBpbnNpZGUgdGhlIHBvbHloZWRyYS4gTXVzdCBiZSBpbiBsb2NhbCBjb29yZHMuCiAgICAgKiBUaGUgcG9pbnQgbGllcyBvdXRzaWRlIG9mIHRoZSBjb252ZXggaHVsbCBvZiB0aGUgb3RoZXIgcG9pbnRzIGlmIGFuZCBvbmx5IGlmIHRoZSBkaXJlY3Rpb24KICAgICAqIG9mIGFsbCB0aGUgdmVjdG9ycyBmcm9tIGl0IHRvIHRob3NlIG90aGVyIHBvaW50cyBhcmUgb24gbGVzcyB0aGFuIG9uZSBoYWxmIG9mIGEgc3BoZXJlIGFyb3VuZCBpdC4KICAgICAqIEBwYXJhbSBwIEEgcG9pbnQgZ2l2ZW4gaW4gbG9jYWwgY29vcmRpbmF0ZXMKICAgICAqLwoKCiAgICBwb2ludElzSW5zaWRlKHApIHsKICAgICAgY29uc3QgdmVydHMgPSB0aGlzLnZlcnRpY2VzOwogICAgICBjb25zdCBmYWNlcyA9IHRoaXMuZmFjZXM7CiAgICAgIGNvbnN0IG5vcm1hbHMgPSB0aGlzLmZhY2VOb3JtYWxzOwogICAgICBjb25zdCBwb3NpdGl2ZVJlc3VsdCA9IG51bGw7CiAgICAgIGNvbnN0IHBvaW50SW5zaWRlID0gbmV3IFZlYzMoKTsKICAgICAgdGhpcy5nZXRBdmVyYWdlUG9pbnRMb2NhbChwb2ludEluc2lkZSk7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMuZmFjZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICBsZXQgbiA9IG5vcm1hbHNbaV07CiAgICAgICAgY29uc3QgdiA9IHZlcnRzW2ZhY2VzW2ldWzBdXTsgLy8gV2Ugb25seSBuZWVkIG9uZSBwb2ludCBpbiB0aGUgZmFjZQogICAgICAgIC8vIFRoaXMgZG90IHByb2R1Y3QgZGV0ZXJtaW5lcyB3aGljaCBzaWRlIG9mIHRoZSBlZGdlIHRoZSBwb2ludCBpcwoKICAgICAgICBjb25zdCB2VG9QID0gbmV3IFZlYzMoKTsKICAgICAgICBwLnZzdWIodiwgdlRvUCk7CiAgICAgICAgY29uc3QgcjEgPSBuLmRvdCh2VG9QKTsKICAgICAgICBjb25zdCB2VG9Qb2ludEluc2lkZSA9IG5ldyBWZWMzKCk7CiAgICAgICAgcG9pbnRJbnNpZGUudnN1Yih2LCB2VG9Qb2ludEluc2lkZSk7CiAgICAgICAgY29uc3QgcjIgPSBuLmRvdCh2VG9Qb2ludEluc2lkZSk7CgogICAgICAgIGlmIChyMSA8IDAgJiYgcjIgPiAwIHx8IHIxID4gMCAmJiByMiA8IDApIHsKICAgICAgICAgIHJldHVybiBmYWxzZTsgLy8gRW5jb3VudGVyZWQgc29tZSBvdGhlciBzaWduLiBFeGl0LgogICAgICAgIH0KICAgICAgfSAvLyBJZiB3ZSBnb3QgaGVyZSwgYWxsIGRvdCBwcm9kdWN0cyB3ZXJlIG9mIHRoZSBzYW1lIHNpZ24uCgoKICAgICAgcmV0dXJuIHBvc2l0aXZlUmVzdWx0ID8gMSA6IC0xOwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgbWF4IGFuZCBtaW4gZG90IHByb2R1Y3Qgb2YgYSBjb252ZXggaHVsbCBhdCBwb3NpdGlvbiAocG9zLHF1YXQpIHByb2plY3RlZCBvbnRvIGFuIGF4aXMuCiAgICAgKiBSZXN1bHRzIGFyZSBzYXZlZCBpbiB0aGUgYXJyYXkgbWF4bWluLgogICAgICogQHBhcmFtIHJlc3VsdCByZXN1bHRbMF0gYW5kIHJlc3VsdFsxXSB3aWxsIGJlIHNldCB0byBtYXhpbXVtIGFuZCBtaW5pbXVtLCByZXNwZWN0aXZlbHkuCiAgICAgKi8KCgogICAgc3RhdGljIHByb2plY3Qoc2hhcGUsIGF4aXMsIHBvcywgcXVhdCwgcmVzdWx0KSB7CiAgICAgIGNvbnN0IG4gPSBzaGFwZS52ZXJ0aWNlcy5sZW5ndGg7CiAgICAgIGNvbnN0IGxvY2FsQXhpcyA9IHByb2plY3RfbG9jYWxBeGlzOwogICAgICBsZXQgbWF4ID0gMDsKICAgICAgbGV0IG1pbiA9IDA7CiAgICAgIGNvbnN0IGxvY2FsT3JpZ2luID0gcHJvamVjdF9sb2NhbE9yaWdpbjsKICAgICAgY29uc3QgdnMgPSBzaGFwZS52ZXJ0aWNlczsKICAgICAgbG9jYWxPcmlnaW4uc2V0WmVybygpOyAvLyBUcmFuc2Zvcm0gdGhlIGF4aXMgdG8gbG9jYWwKCiAgICAgIFRyYW5zZm9ybS52ZWN0b3JUb0xvY2FsRnJhbWUocG9zLCBxdWF0LCBheGlzLCBsb2NhbEF4aXMpOwogICAgICBUcmFuc2Zvcm0ucG9pbnRUb0xvY2FsRnJhbWUocG9zLCBxdWF0LCBsb2NhbE9yaWdpbiwgbG9jYWxPcmlnaW4pOwogICAgICBjb25zdCBhZGQgPSBsb2NhbE9yaWdpbi5kb3QobG9jYWxBeGlzKTsKICAgICAgbWluID0gbWF4ID0gdnNbMF0uZG90KGxvY2FsQXhpcyk7CgogICAgICBmb3IgKGxldCBpID0gMTsgaSA8IG47IGkrKykgewogICAgICAgIGNvbnN0IHZhbCA9IHZzW2ldLmRvdChsb2NhbEF4aXMpOwoKICAgICAgICBpZiAodmFsID4gbWF4KSB7CiAgICAgICAgICBtYXggPSB2YWw7CiAgICAgICAgfQoKICAgICAgICBpZiAodmFsIDwgbWluKSB7CiAgICAgICAgICBtaW4gPSB2YWw7CiAgICAgICAgfQogICAgICB9CgogICAgICBtaW4gLT0gYWRkOwogICAgICBtYXggLT0gYWRkOwoKICAgICAgaWYgKG1pbiA+IG1heCkgewogICAgICAgIC8vIEluY29uc2lzdGVudCAtIHN3YXAKICAgICAgICBjb25zdCB0ZW1wID0gbWluOwogICAgICAgIG1pbiA9IG1heDsKICAgICAgICBtYXggPSB0ZW1wOwogICAgICB9IC8vIE91dHB1dAoKCiAgICAgIHJlc3VsdFswXSA9IG1heDsKICAgICAgcmVzdWx0WzFdID0gbWluOwogICAgfQoKICB9CiAgY29uc3QgbWF4bWluQSA9IFtdOwogIGNvbnN0IG1heG1pbkIgPSBbXTsKICBuZXcgVmVjMygpOwogIGNvbnN0IHByb2plY3RfbG9jYWxBeGlzID0gbmV3IFZlYzMoKTsKICBjb25zdCBwcm9qZWN0X2xvY2FsT3JpZ2luID0gbmV3IFZlYzMoKTsKCiAgLyoqCiAgICogQSAzZCBib3ggc2hhcGUuCiAgICogQGV4YW1wbGUKICAgKiAgICAgY29uc3Qgc2l6ZSA9IDEKICAgKiAgICAgY29uc3QgaGFsZkV4dGVudHMgPSBuZXcgQ0FOTk9OLlZlYzMoc2l6ZSwgc2l6ZSwgc2l6ZSkKICAgKiAgICAgY29uc3QgYm94U2hhcGUgPSBuZXcgQ0FOTk9OLkJveChoYWxmRXh0ZW50cykKICAgKiAgICAgY29uc3QgYm94Qm9keSA9IG5ldyBDQU5OT04uQm9keSh7IG1hc3M6IDEsIHNoYXBlOiBib3hTaGFwZSB9KQogICAqICAgICB3b3JsZC5hZGRCb2R5KGJveEJvZHkpCiAgICovCiAgY2xhc3MgQm94IGV4dGVuZHMgU2hhcGUgewogICAgLyoqCiAgICAgKiBUaGUgaGFsZiBleHRlbnRzIG9mIHRoZSBib3guCiAgICAgKi8KCiAgICAvKioKICAgICAqIFVzZWQgYnkgdGhlIGNvbnRhY3QgZ2VuZXJhdG9yIHRvIG1ha2UgY29udGFjdHMgd2l0aCBvdGhlciBjb252ZXggcG9seWhlZHJhIGZvciBleGFtcGxlLgogICAgICovCiAgICBjb25zdHJ1Y3RvcihoYWxmRXh0ZW50cykgewogICAgICBzdXBlcih7CiAgICAgICAgdHlwZTogU2hhcGUudHlwZXMuQk9YCiAgICAgIH0pOwogICAgICB0aGlzLmhhbGZFeHRlbnRzID0gaGFsZkV4dGVudHM7CiAgICAgIHRoaXMuY29udmV4UG9seWhlZHJvblJlcHJlc2VudGF0aW9uID0gbnVsbDsKICAgICAgdGhpcy51cGRhdGVDb252ZXhQb2x5aGVkcm9uUmVwcmVzZW50YXRpb24oKTsKICAgICAgdGhpcy51cGRhdGVCb3VuZGluZ1NwaGVyZVJhZGl1cygpOwogICAgfQogICAgLyoqCiAgICAgKiBVcGRhdGVzIHRoZSBsb2NhbCBjb252ZXggcG9seWhlZHJvbiByZXByZXNlbnRhdGlvbiB1c2VkIGZvciBzb21lIGNvbGxpc2lvbnMuCiAgICAgKi8KCgogICAgdXBkYXRlQ29udmV4UG9seWhlZHJvblJlcHJlc2VudGF0aW9uKCkgewogICAgICBjb25zdCBzeCA9IHRoaXMuaGFsZkV4dGVudHMueDsKICAgICAgY29uc3Qgc3kgPSB0aGlzLmhhbGZFeHRlbnRzLnk7CiAgICAgIGNvbnN0IHN6ID0gdGhpcy5oYWxmRXh0ZW50cy56OwogICAgICBjb25zdCBWID0gVmVjMzsKICAgICAgY29uc3QgdmVydGljZXMgPSBbbmV3IFYoLXN4LCAtc3ksIC1zeiksIG5ldyBWKHN4LCAtc3ksIC1zeiksIG5ldyBWKHN4LCBzeSwgLXN6KSwgbmV3IFYoLXN4LCBzeSwgLXN6KSwgbmV3IFYoLXN4LCAtc3ksIHN6KSwgbmV3IFYoc3gsIC1zeSwgc3opLCBuZXcgVihzeCwgc3ksIHN6KSwgbmV3IFYoLXN4LCBzeSwgc3opXTsKICAgICAgY29uc3QgZmFjZXMgPSBbWzMsIDIsIDEsIDBdLCAvLyAtegogICAgICBbNCwgNSwgNiwgN10sIC8vICt6CiAgICAgIFs1LCA0LCAwLCAxXSwgLy8gLXkKICAgICAgWzIsIDMsIDcsIDZdLCAvLyAreQogICAgICBbMCwgNCwgNywgM10sIC8vIC14CiAgICAgIFsxLCAyLCA2LCA1XSAvLyAreAogICAgICBdOwogICAgICBjb25zdCBheGVzID0gW25ldyBWKDAsIDAsIDEpLCBuZXcgVigwLCAxLCAwKSwgbmV3IFYoMSwgMCwgMCldOwogICAgICBjb25zdCBoID0gbmV3IENvbnZleFBvbHloZWRyb24oewogICAgICAgIHZlcnRpY2VzLAogICAgICAgIGZhY2VzLAogICAgICAgIGF4ZXMKICAgICAgfSk7CiAgICAgIHRoaXMuY29udmV4UG9seWhlZHJvblJlcHJlc2VudGF0aW9uID0gaDsKICAgICAgaC5tYXRlcmlhbCA9IHRoaXMubWF0ZXJpYWw7CiAgICB9CiAgICAvKioKICAgICAqIENhbGN1bGF0ZSB0aGUgaW5lcnRpYSBvZiB0aGUgYm94LgogICAgICovCgoKICAgIGNhbGN1bGF0ZUxvY2FsSW5lcnRpYShtYXNzLCB0YXJnZXQpIHsKICAgICAgaWYgKHRhcmdldCA9PT0gdm9pZCAwKSB7CiAgICAgICAgdGFyZ2V0ID0gbmV3IFZlYzMoKTsKICAgICAgfQoKICAgICAgQm94LmNhbGN1bGF0ZUluZXJ0aWEodGhpcy5oYWxmRXh0ZW50cywgbWFzcywgdGFyZ2V0KTsKICAgICAgcmV0dXJuIHRhcmdldDsKICAgIH0KCiAgICBzdGF0aWMgY2FsY3VsYXRlSW5lcnRpYShoYWxmRXh0ZW50cywgbWFzcywgdGFyZ2V0KSB7CiAgICAgIGNvbnN0IGUgPSBoYWxmRXh0ZW50czsKICAgICAgdGFyZ2V0LnggPSAxLjAgLyAxMi4wICogbWFzcyAqICgyICogZS55ICogMiAqIGUueSArIDIgKiBlLnogKiAyICogZS56KTsKICAgICAgdGFyZ2V0LnkgPSAxLjAgLyAxMi4wICogbWFzcyAqICgyICogZS54ICogMiAqIGUueCArIDIgKiBlLnogKiAyICogZS56KTsKICAgICAgdGFyZ2V0LnogPSAxLjAgLyAxMi4wICogbWFzcyAqICgyICogZS55ICogMiAqIGUueSArIDIgKiBlLnggKiAyICogZS54KTsKICAgIH0KICAgIC8qKgogICAgICogR2V0IHRoZSBib3ggNiBzaWRlIG5vcm1hbHMKICAgICAqIEBwYXJhbSBzaXhUYXJnZXRWZWN0b3JzIEFuIGFycmF5IG9mIDYgdmVjdG9ycywgdG8gc3RvcmUgdGhlIHJlc3VsdGluZyBzaWRlIG5vcm1hbHMgaW4uCiAgICAgKiBAcGFyYW0gcXVhdCBPcmllbnRhdGlvbiB0byBhcHBseSB0byB0aGUgbm9ybWFsIHZlY3RvcnMuIElmIG5vdCBwcm92aWRlZCwgdGhlIHZlY3RvcnMgd2lsbCBiZSBpbiByZXNwZWN0IHRvIHRoZSBsb2NhbCBmcmFtZS4KICAgICAqLwoKCiAgICBnZXRTaWRlTm9ybWFscyhzaXhUYXJnZXRWZWN0b3JzLCBxdWF0KSB7CiAgICAgIGNvbnN0IHNpZGVzID0gc2l4VGFyZ2V0VmVjdG9yczsKICAgICAgY29uc3QgZXggPSB0aGlzLmhhbGZFeHRlbnRzOwogICAgICBzaWRlc1swXS5zZXQoZXgueCwgMCwgMCk7CiAgICAgIHNpZGVzWzFdLnNldCgwLCBleC55LCAwKTsKICAgICAgc2lkZXNbMl0uc2V0KDAsIDAsIGV4LnopOwogICAgICBzaWRlc1szXS5zZXQoLWV4LngsIDAsIDApOwogICAgICBzaWRlc1s0XS5zZXQoMCwgLWV4LnksIDApOwogICAgICBzaWRlc1s1XS5zZXQoMCwgMCwgLWV4LnopOwoKICAgICAgaWYgKHF1YXQgIT09IHVuZGVmaW5lZCkgewogICAgICAgIGZvciAobGV0IGkgPSAwOyBpICE9PSBzaWRlcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgcXVhdC52bXVsdChzaWRlc1tpXSwgc2lkZXNbaV0pOwogICAgICAgIH0KICAgICAgfQoKICAgICAgcmV0dXJuIHNpZGVzOwogICAgfQogICAgLyoqCiAgICAgKiBSZXR1cm5zIHRoZSB2b2x1bWUgb2YgdGhlIGJveC4KICAgICAqLwoKCiAgICB2b2x1bWUoKSB7CiAgICAgIHJldHVybiA4LjAgKiB0aGlzLmhhbGZFeHRlbnRzLnggKiB0aGlzLmhhbGZFeHRlbnRzLnkgKiB0aGlzLmhhbGZFeHRlbnRzLno7CiAgICB9CiAgICAvKioKICAgICAqIHVwZGF0ZUJvdW5kaW5nU3BoZXJlUmFkaXVzCiAgICAgKi8KCgogICAgdXBkYXRlQm91bmRpbmdTcGhlcmVSYWRpdXMoKSB7CiAgICAgIHRoaXMuYm91bmRpbmdTcGhlcmVSYWRpdXMgPSB0aGlzLmhhbGZFeHRlbnRzLmxlbmd0aCgpOwogICAgfQogICAgLyoqCiAgICAgKiBmb3JFYWNoV29ybGRDb3JuZXIKICAgICAqLwoKCiAgICBmb3JFYWNoV29ybGRDb3JuZXIocG9zLCBxdWF0LCBjYWxsYmFjaykgewogICAgICBjb25zdCBlID0gdGhpcy5oYWxmRXh0ZW50czsKICAgICAgY29uc3QgY29ybmVycyA9IFtbZS54LCBlLnksIGUuel0sIFstZS54LCBlLnksIGUuel0sIFstZS54LCAtZS55LCBlLnpdLCBbLWUueCwgLWUueSwgLWUuel0sIFtlLngsIC1lLnksIC1lLnpdLCBbZS54LCBlLnksIC1lLnpdLCBbLWUueCwgZS55LCAtZS56XSwgW2UueCwgLWUueSwgZS56XV07CgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGNvcm5lcnMubGVuZ3RoOyBpKyspIHsKICAgICAgICB3b3JsZENvcm5lclRlbXBQb3Muc2V0KGNvcm5lcnNbaV1bMF0sIGNvcm5lcnNbaV1bMV0sIGNvcm5lcnNbaV1bMl0pOwogICAgICAgIHF1YXQudm11bHQod29ybGRDb3JuZXJUZW1wUG9zLCB3b3JsZENvcm5lclRlbXBQb3MpOwogICAgICAgIHBvcy52YWRkKHdvcmxkQ29ybmVyVGVtcFBvcywgd29ybGRDb3JuZXJUZW1wUG9zKTsKICAgICAgICBjYWxsYmFjayh3b3JsZENvcm5lclRlbXBQb3MueCwgd29ybGRDb3JuZXJUZW1wUG9zLnksIHdvcmxkQ29ybmVyVGVtcFBvcy56KTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBjYWxjdWxhdGVXb3JsZEFBQkIKICAgICAqLwoKCiAgICBjYWxjdWxhdGVXb3JsZEFBQkIocG9zLCBxdWF0LCBtaW4sIG1heCkgewogICAgICBjb25zdCBlID0gdGhpcy5oYWxmRXh0ZW50czsKICAgICAgd29ybGRDb3JuZXJzVGVtcFswXS5zZXQoZS54LCBlLnksIGUueik7CiAgICAgIHdvcmxkQ29ybmVyc1RlbXBbMV0uc2V0KC1lLngsIGUueSwgZS56KTsKICAgICAgd29ybGRDb3JuZXJzVGVtcFsyXS5zZXQoLWUueCwgLWUueSwgZS56KTsKICAgICAgd29ybGRDb3JuZXJzVGVtcFszXS5zZXQoLWUueCwgLWUueSwgLWUueik7CiAgICAgIHdvcmxkQ29ybmVyc1RlbXBbNF0uc2V0KGUueCwgLWUueSwgLWUueik7CiAgICAgIHdvcmxkQ29ybmVyc1RlbXBbNV0uc2V0KGUueCwgZS55LCAtZS56KTsKICAgICAgd29ybGRDb3JuZXJzVGVtcFs2XS5zZXQoLWUueCwgZS55LCAtZS56KTsKICAgICAgd29ybGRDb3JuZXJzVGVtcFs3XS5zZXQoZS54LCAtZS55LCBlLnopOwogICAgICBjb25zdCB3YyA9IHdvcmxkQ29ybmVyc1RlbXBbMF07CiAgICAgIHF1YXQudm11bHQod2MsIHdjKTsKICAgICAgcG9zLnZhZGQod2MsIHdjKTsKICAgICAgbWF4LmNvcHkod2MpOwogICAgICBtaW4uY29weSh3Yyk7CgogICAgICBmb3IgKGxldCBpID0gMTsgaSA8IDg7IGkrKykgewogICAgICAgIGNvbnN0IHdjID0gd29ybGRDb3JuZXJzVGVtcFtpXTsKICAgICAgICBxdWF0LnZtdWx0KHdjLCB3Yyk7CiAgICAgICAgcG9zLnZhZGQod2MsIHdjKTsKICAgICAgICBjb25zdCB4ID0gd2MueDsKICAgICAgICBjb25zdCB5ID0gd2MueTsKICAgICAgICBjb25zdCB6ID0gd2MuejsKCiAgICAgICAgaWYgKHggPiBtYXgueCkgewogICAgICAgICAgbWF4LnggPSB4OwogICAgICAgIH0KCiAgICAgICAgaWYgKHkgPiBtYXgueSkgewogICAgICAgICAgbWF4LnkgPSB5OwogICAgICAgIH0KCiAgICAgICAgaWYgKHogPiBtYXgueikgewogICAgICAgICAgbWF4LnogPSB6OwogICAgICAgIH0KCiAgICAgICAgaWYgKHggPCBtaW4ueCkgewogICAgICAgICAgbWluLnggPSB4OwogICAgICAgIH0KCiAgICAgICAgaWYgKHkgPCBtaW4ueSkgewogICAgICAgICAgbWluLnkgPSB5OwogICAgICAgIH0KCiAgICAgICAgaWYgKHogPCBtaW4ueikgewogICAgICAgICAgbWluLnogPSB6OwogICAgICAgIH0KICAgICAgfSAvLyBHZXQgZWFjaCBheGlzIG1heAogICAgICAvLyBtaW4uc2V0KEluZmluaXR5LEluZmluaXR5LEluZmluaXR5KTsKICAgICAgLy8gbWF4LnNldCgtSW5maW5pdHksLUluZmluaXR5LC1JbmZpbml0eSk7CiAgICAgIC8vIHRoaXMuZm9yRWFjaFdvcmxkQ29ybmVyKHBvcyxxdWF0LGZ1bmN0aW9uKHgseSx6KXsKICAgICAgLy8gICAgIGlmKHggPiBtYXgueCl7CiAgICAgIC8vICAgICAgICAgbWF4LnggPSB4OwogICAgICAvLyAgICAgfQogICAgICAvLyAgICAgaWYoeSA+IG1heC55KXsKICAgICAgLy8gICAgICAgICBtYXgueSA9IHk7CiAgICAgIC8vICAgICB9CiAgICAgIC8vICAgICBpZih6ID4gbWF4LnopewogICAgICAvLyAgICAgICAgIG1heC56ID0gejsKICAgICAgLy8gICAgIH0KICAgICAgLy8gICAgIGlmKHggPCBtaW4ueCl7CiAgICAgIC8vICAgICAgICAgbWluLnggPSB4OwogICAgICAvLyAgICAgfQogICAgICAvLyAgICAgaWYoeSA8IG1pbi55KXsKICAgICAgLy8gICAgICAgICBtaW4ueSA9IHk7CiAgICAgIC8vICAgICB9CiAgICAgIC8vICAgICBpZih6IDwgbWluLnopewogICAgICAvLyAgICAgICAgIG1pbi56ID0gejsKICAgICAgLy8gICAgIH0KICAgICAgLy8gfSk7CgogICAgfQoKICB9CiAgY29uc3Qgd29ybGRDb3JuZXJUZW1wUG9zID0gbmV3IFZlYzMoKTsKICBjb25zdCB3b3JsZENvcm5lcnNUZW1wID0gW25ldyBWZWMzKCksIG5ldyBWZWMzKCksIG5ldyBWZWMzKCksIG5ldyBWZWMzKCksIG5ldyBWZWMzKCksIG5ldyBWZWMzKCksIG5ldyBWZWMzKCksIG5ldyBWZWMzKCldOwoKICAvKioKICAgKiBCT0RZX1RZUEVTCiAgICovCiAgY29uc3QgQk9EWV9UWVBFUyA9IHsKICAgIC8qKiBEWU5BTUlDICovCiAgICBEWU5BTUlDOiAxLAoKICAgIC8qKiBTVEFUSUMgKi8KICAgIFNUQVRJQzogMiwKCiAgICAvKiogS0lORU1BVElDICovCiAgICBLSU5FTUFUSUM6IDQKICB9OwogIC8qKgogICAqIEJvZHlUeXBlCiAgICovCgogIC8qKgogICAqIEJPRFlfU0xFRVBfU1RBVEVTCiAgICovCiAgY29uc3QgQk9EWV9TTEVFUF9TVEFURVMgPSB7CiAgICAvKiogQVdBS0UgKi8KICAgIEFXQUtFOiAwLAoKICAgIC8qKiBTTEVFUFkgKi8KICAgIFNMRUVQWTogMSwKCiAgICAvKiogU0xFRVBJTkcgKi8KICAgIFNMRUVQSU5HOiAyCiAgfTsKICAvKioKICAgKiBCb2R5U2xlZXBTdGF0ZQogICAqLwoKICAvKioKICAgKiBCYXNlIGNsYXNzIGZvciBhbGwgYm9keSB0eXBlcy4KICAgKiBAZXhhbXBsZQogICAqICAgICBjb25zdCBzaGFwZSA9IG5ldyBDQU5OT04uU3BoZXJlKDEpCiAgICogICAgIGNvbnN0IGJvZHkgPSBuZXcgQ0FOTk9OLkJvZHkoewogICAqICAgICAgIG1hc3M6IDEsCiAgICogICAgICAgc2hhcGUsCiAgICogICAgIH0pCiAgICogICAgIHdvcmxkLmFkZEJvZHkoYm9keSkKICAgKi8KICBjbGFzcyBCb2R5IGV4dGVuZHMgRXZlbnRUYXJnZXQgewogICAgLyoqCiAgICAgKiBEaXNwYXRjaGVkIGFmdGVyIHR3byBib2RpZXMgY29sbGlkZS4gVGhpcyBldmVudCBpcyBkaXNwYXRjaGVkIG9uIGVhY2gKICAgICAqIG9mIHRoZSB0d28gYm9kaWVzIGludm9sdmVkIGluIHRoZSBjb2xsaXNpb24uCiAgICAgKiBAZXZlbnQgY29sbGlkZQogICAgICogQHBhcmFtIGJvZHkgVGhlIGJvZHkgdGhhdCB3YXMgaW52b2x2ZWQgaW4gdGhlIGNvbGxpc2lvbi4KICAgICAqIEBwYXJhbSBjb250YWN0IFRoZSBkZXRhaWxzIG9mIHRoZSBjb2xsaXNpb24uCiAgICAgKi8KCiAgICAvKioKICAgICAqIEEgZHluYW1pYyBib2R5IGlzIGZ1bGx5IHNpbXVsYXRlZC4gQ2FuIGJlIG1vdmVkIG1hbnVhbGx5IGJ5IHRoZSB1c2VyLCBidXQgbm9ybWFsbHkgdGhleSBtb3ZlIGFjY29yZGluZyB0byBmb3JjZXMuIEEgZHluYW1pYyBib2R5IGNhbiBjb2xsaWRlIHdpdGggYWxsIGJvZHkgdHlwZXMuIEEgZHluYW1pYyBib2R5IGFsd2F5cyBoYXMgZmluaXRlLCBub24temVybyBtYXNzLgogICAgICovCgogICAgLyoqCiAgICAgKiBBIHN0YXRpYyBib2R5IGRvZXMgbm90IG1vdmUgZHVyaW5nIHNpbXVsYXRpb24gYW5kIGJlaGF2ZXMgYXMgaWYgaXQgaGFzIGluZmluaXRlIG1hc3MuIFN0YXRpYyBib2RpZXMgY2FuIGJlIG1vdmVkIG1hbnVhbGx5IGJ5IHNldHRpbmcgdGhlIHBvc2l0aW9uIG9mIHRoZSBib2R5LiBUaGUgdmVsb2NpdHkgb2YgYSBzdGF0aWMgYm9keSBpcyBhbHdheXMgemVyby4gU3RhdGljIGJvZGllcyBkbyBub3QgY29sbGlkZSB3aXRoIG90aGVyIHN0YXRpYyBvciBraW5lbWF0aWMgYm9kaWVzLgogICAgICovCgogICAgLyoqCiAgICAgKiBBIGtpbmVtYXRpYyBib2R5IG1vdmVzIHVuZGVyIHNpbXVsYXRpb24gYWNjb3JkaW5nIHRvIGl0cyB2ZWxvY2l0eS4gVGhleSBkbyBub3QgcmVzcG9uZCB0byBmb3JjZXMuIFRoZXkgY2FuIGJlIG1vdmVkIG1hbnVhbGx5LCBidXQgbm9ybWFsbHkgYSBraW5lbWF0aWMgYm9keSBpcyBtb3ZlZCBieSBzZXR0aW5nIGl0cyB2ZWxvY2l0eS4gQSBraW5lbWF0aWMgYm9keSBiZWhhdmVzIGFzIGlmIGl0IGhhcyBpbmZpbml0ZSBtYXNzLiBLaW5lbWF0aWMgYm9kaWVzIGRvIG5vdCBjb2xsaWRlIHdpdGggb3RoZXIgc3RhdGljIG9yIGtpbmVtYXRpYyBib2RpZXMuCiAgICAgKi8KCiAgICAvKioKICAgICAqIEFXQUtFCiAgICAgKi8KCiAgICAvKioKICAgICAqIFNMRUVQWQogICAgICovCgogICAgLyoqCiAgICAgKiBTTEVFUElORwogICAgICovCgogICAgLyoqCiAgICAgKiBEaXNwYXRjaGVkIGFmdGVyIGEgc2xlZXBpbmcgYm9keSBoYXMgd29rZW4gdXAuCiAgICAgKiBAZXZlbnQgd2FrZXVwCiAgICAgKi8KCiAgICAvKioKICAgICAqIERpc3BhdGNoZWQgYWZ0ZXIgYSBib2R5IGhhcyBnb25lIGluIHRvIHRoZSBzbGVlcHkgc3RhdGUuCiAgICAgKiBAZXZlbnQgc2xlZXB5CiAgICAgKi8KCiAgICAvKioKICAgICAqIERpc3BhdGNoZWQgYWZ0ZXIgYSBib2R5IGhhcyBmYWxsZW4gYXNsZWVwLgogICAgICogQGV2ZW50IHNsZWVwCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKG9wdGlvbnMpIHsKICAgICAgaWYgKG9wdGlvbnMgPT09IHZvaWQgMCkgewogICAgICAgIG9wdGlvbnMgPSB7fTsKICAgICAgfQoKICAgICAgc3VwZXIoKTsKICAgICAgdGhpcy5pZCA9IEJvZHkuaWRDb3VudGVyKys7CiAgICAgIHRoaXMuaW5kZXggPSAtMTsKICAgICAgdGhpcy53b3JsZCA9IG51bGw7CiAgICAgIHRoaXMudmxhbWJkYSA9IG5ldyBWZWMzKCk7CiAgICAgIHRoaXMuY29sbGlzaW9uRmlsdGVyR3JvdXAgPSB0eXBlb2Ygb3B0aW9ucy5jb2xsaXNpb25GaWx0ZXJHcm91cCA9PT0gJ251bWJlcicgPyBvcHRpb25zLmNvbGxpc2lvbkZpbHRlckdyb3VwIDogMTsKICAgICAgdGhpcy5jb2xsaXNpb25GaWx0ZXJNYXNrID0gdHlwZW9mIG9wdGlvbnMuY29sbGlzaW9uRmlsdGVyTWFzayA9PT0gJ251bWJlcicgPyBvcHRpb25zLmNvbGxpc2lvbkZpbHRlck1hc2sgOiAtMTsKICAgICAgdGhpcy5jb2xsaXNpb25SZXNwb25zZSA9IHR5cGVvZiBvcHRpb25zLmNvbGxpc2lvblJlc3BvbnNlID09PSAnYm9vbGVhbicgPyBvcHRpb25zLmNvbGxpc2lvblJlc3BvbnNlIDogdHJ1ZTsKICAgICAgdGhpcy5wb3NpdGlvbiA9IG5ldyBWZWMzKCk7CiAgICAgIHRoaXMucHJldmlvdXNQb3NpdGlvbiA9IG5ldyBWZWMzKCk7CiAgICAgIHRoaXMuaW50ZXJwb2xhdGVkUG9zaXRpb24gPSBuZXcgVmVjMygpOwogICAgICB0aGlzLmluaXRQb3NpdGlvbiA9IG5ldyBWZWMzKCk7CgogICAgICBpZiAob3B0aW9ucy5wb3NpdGlvbikgewogICAgICAgIHRoaXMucG9zaXRpb24uY29weShvcHRpb25zLnBvc2l0aW9uKTsKICAgICAgICB0aGlzLnByZXZpb3VzUG9zaXRpb24uY29weShvcHRpb25zLnBvc2l0aW9uKTsKICAgICAgICB0aGlzLmludGVycG9sYXRlZFBvc2l0aW9uLmNvcHkob3B0aW9ucy5wb3NpdGlvbik7CiAgICAgICAgdGhpcy5pbml0UG9zaXRpb24uY29weShvcHRpb25zLnBvc2l0aW9uKTsKICAgICAgfQoKICAgICAgdGhpcy52ZWxvY2l0eSA9IG5ldyBWZWMzKCk7CgogICAgICBpZiAob3B0aW9ucy52ZWxvY2l0eSkgewogICAgICAgIHRoaXMudmVsb2NpdHkuY29weShvcHRpb25zLnZlbG9jaXR5KTsKICAgICAgfQoKICAgICAgdGhpcy5pbml0VmVsb2NpdHkgPSBuZXcgVmVjMygpOwogICAgICB0aGlzLmZvcmNlID0gbmV3IFZlYzMoKTsKICAgICAgY29uc3QgbWFzcyA9IHR5cGVvZiBvcHRpb25zLm1hc3MgPT09ICdudW1iZXInID8gb3B0aW9ucy5tYXNzIDogMDsKICAgICAgdGhpcy5tYXNzID0gbWFzczsKICAgICAgdGhpcy5pbnZNYXNzID0gbWFzcyA+IDAgPyAxLjAgLyBtYXNzIDogMDsKICAgICAgdGhpcy5tYXRlcmlhbCA9IG9wdGlvbnMubWF0ZXJpYWwgfHwgbnVsbDsKICAgICAgdGhpcy5saW5lYXJEYW1waW5nID0gdHlwZW9mIG9wdGlvbnMubGluZWFyRGFtcGluZyA9PT0gJ251bWJlcicgPyBvcHRpb25zLmxpbmVhckRhbXBpbmcgOiAwLjAxOwogICAgICB0aGlzLnR5cGUgPSBtYXNzIDw9IDAuMCA/IEJvZHkuU1RBVElDIDogQm9keS5EWU5BTUlDOwoKICAgICAgaWYgKHR5cGVvZiBvcHRpb25zLnR5cGUgPT09IHR5cGVvZiBCb2R5LlNUQVRJQykgewogICAgICAgIHRoaXMudHlwZSA9IG9wdGlvbnMudHlwZTsKICAgICAgfQoKICAgICAgdGhpcy5hbGxvd1NsZWVwID0gdHlwZW9mIG9wdGlvbnMuYWxsb3dTbGVlcCAhPT0gJ3VuZGVmaW5lZCcgPyBvcHRpb25zLmFsbG93U2xlZXAgOiB0cnVlOwogICAgICB0aGlzLnNsZWVwU3RhdGUgPSBCb2R5LkFXQUtFOwogICAgICB0aGlzLnNsZWVwU3BlZWRMaW1pdCA9IHR5cGVvZiBvcHRpb25zLnNsZWVwU3BlZWRMaW1pdCAhPT0gJ3VuZGVmaW5lZCcgPyBvcHRpb25zLnNsZWVwU3BlZWRMaW1pdCA6IDAuMTsKICAgICAgdGhpcy5zbGVlcFRpbWVMaW1pdCA9IHR5cGVvZiBvcHRpb25zLnNsZWVwVGltZUxpbWl0ICE9PSAndW5kZWZpbmVkJyA/IG9wdGlvbnMuc2xlZXBUaW1lTGltaXQgOiAxOwogICAgICB0aGlzLnRpbWVMYXN0U2xlZXB5ID0gMDsKICAgICAgdGhpcy53YWtlVXBBZnRlck5hcnJvd3BoYXNlID0gZmFsc2U7CiAgICAgIHRoaXMudG9ycXVlID0gbmV3IFZlYzMoKTsKICAgICAgdGhpcy5xdWF0ZXJuaW9uID0gbmV3IFF1YXRlcm5pb24oKTsKICAgICAgdGhpcy5pbml0UXVhdGVybmlvbiA9IG5ldyBRdWF0ZXJuaW9uKCk7CiAgICAgIHRoaXMucHJldmlvdXNRdWF0ZXJuaW9uID0gbmV3IFF1YXRlcm5pb24oKTsKICAgICAgdGhpcy5pbnRlcnBvbGF0ZWRRdWF0ZXJuaW9uID0gbmV3IFF1YXRlcm5pb24oKTsKCiAgICAgIGlmIChvcHRpb25zLnF1YXRlcm5pb24pIHsKICAgICAgICB0aGlzLnF1YXRlcm5pb24uY29weShvcHRpb25zLnF1YXRlcm5pb24pOwogICAgICAgIHRoaXMuaW5pdFF1YXRlcm5pb24uY29weShvcHRpb25zLnF1YXRlcm5pb24pOwogICAgICAgIHRoaXMucHJldmlvdXNRdWF0ZXJuaW9uLmNvcHkob3B0aW9ucy5xdWF0ZXJuaW9uKTsKICAgICAgICB0aGlzLmludGVycG9sYXRlZFF1YXRlcm5pb24uY29weShvcHRpb25zLnF1YXRlcm5pb24pOwogICAgICB9CgogICAgICB0aGlzLmFuZ3VsYXJWZWxvY2l0eSA9IG5ldyBWZWMzKCk7CgogICAgICBpZiAob3B0aW9ucy5hbmd1bGFyVmVsb2NpdHkpIHsKICAgICAgICB0aGlzLmFuZ3VsYXJWZWxvY2l0eS5jb3B5KG9wdGlvbnMuYW5ndWxhclZlbG9jaXR5KTsKICAgICAgfQoKICAgICAgdGhpcy5pbml0QW5ndWxhclZlbG9jaXR5ID0gbmV3IFZlYzMoKTsKICAgICAgdGhpcy5zaGFwZXMgPSBbXTsKICAgICAgdGhpcy5zaGFwZU9mZnNldHMgPSBbXTsKICAgICAgdGhpcy5zaGFwZU9yaWVudGF0aW9ucyA9IFtdOwogICAgICB0aGlzLmluZXJ0aWEgPSBuZXcgVmVjMygpOwogICAgICB0aGlzLmludkluZXJ0aWEgPSBuZXcgVmVjMygpOwogICAgICB0aGlzLmludkluZXJ0aWFXb3JsZCA9IG5ldyBNYXQzKCk7CiAgICAgIHRoaXMuaW52TWFzc1NvbHZlID0gMDsKICAgICAgdGhpcy5pbnZJbmVydGlhU29sdmUgPSBuZXcgVmVjMygpOwogICAgICB0aGlzLmludkluZXJ0aWFXb3JsZFNvbHZlID0gbmV3IE1hdDMoKTsKICAgICAgdGhpcy5maXhlZFJvdGF0aW9uID0gdHlwZW9mIG9wdGlvbnMuZml4ZWRSb3RhdGlvbiAhPT0gJ3VuZGVmaW5lZCcgPyBvcHRpb25zLmZpeGVkUm90YXRpb24gOiBmYWxzZTsKICAgICAgdGhpcy5hbmd1bGFyRGFtcGluZyA9IHR5cGVvZiBvcHRpb25zLmFuZ3VsYXJEYW1waW5nICE9PSAndW5kZWZpbmVkJyA/IG9wdGlvbnMuYW5ndWxhckRhbXBpbmcgOiAwLjAxOwogICAgICB0aGlzLmxpbmVhckZhY3RvciA9IG5ldyBWZWMzKDEsIDEsIDEpOwoKICAgICAgaWYgKG9wdGlvbnMubGluZWFyRmFjdG9yKSB7CiAgICAgICAgdGhpcy5saW5lYXJGYWN0b3IuY29weShvcHRpb25zLmxpbmVhckZhY3Rvcik7CiAgICAgIH0KCiAgICAgIHRoaXMuYW5ndWxhckZhY3RvciA9IG5ldyBWZWMzKDEsIDEsIDEpOwoKICAgICAgaWYgKG9wdGlvbnMuYW5ndWxhckZhY3RvcikgewogICAgICAgIHRoaXMuYW5ndWxhckZhY3Rvci5jb3B5KG9wdGlvbnMuYW5ndWxhckZhY3Rvcik7CiAgICAgIH0KCiAgICAgIHRoaXMuYWFiYiA9IG5ldyBBQUJCKCk7CiAgICAgIHRoaXMuYWFiYk5lZWRzVXBkYXRlID0gdHJ1ZTsKICAgICAgdGhpcy5ib3VuZGluZ1JhZGl1cyA9IDA7CiAgICAgIHRoaXMud2xhbWJkYSA9IG5ldyBWZWMzKCk7CiAgICAgIHRoaXMuaXNUcmlnZ2VyID0gQm9vbGVhbihvcHRpb25zLmlzVHJpZ2dlcik7CgogICAgICBpZiAob3B0aW9ucy5zaGFwZSkgewogICAgICAgIHRoaXMuYWRkU2hhcGUob3B0aW9ucy5zaGFwZSk7CiAgICAgIH0KCiAgICAgIHRoaXMudXBkYXRlTWFzc1Byb3BlcnRpZXMoKTsKICAgIH0KICAgIC8qKgogICAgICogV2FrZSB0aGUgYm9keSB1cC4KICAgICAqLwoKCiAgICB3YWtlVXAoKSB7CiAgICAgIGNvbnN0IHByZXZTdGF0ZSA9IHRoaXMuc2xlZXBTdGF0ZTsKICAgICAgdGhpcy5zbGVlcFN0YXRlID0gQm9keS5BV0FLRTsKICAgICAgdGhpcy53YWtlVXBBZnRlck5hcnJvd3BoYXNlID0gZmFsc2U7CgogICAgICBpZiAocHJldlN0YXRlID09PSBCb2R5LlNMRUVQSU5HKSB7CiAgICAgICAgdGhpcy5kaXNwYXRjaEV2ZW50KEJvZHkud2FrZXVwRXZlbnQpOwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIEZvcmNlIGJvZHkgc2xlZXAKICAgICAqLwoKCiAgICBzbGVlcCgpIHsKICAgICAgdGhpcy5zbGVlcFN0YXRlID0gQm9keS5TTEVFUElORzsKICAgICAgdGhpcy52ZWxvY2l0eS5zZXQoMCwgMCwgMCk7CiAgICAgIHRoaXMuYW5ndWxhclZlbG9jaXR5LnNldCgwLCAwLCAwKTsKICAgICAgdGhpcy53YWtlVXBBZnRlck5hcnJvd3BoYXNlID0gZmFsc2U7CiAgICB9CiAgICAvKioKICAgICAqIENhbGxlZCBldmVyeSB0aW1lc3RlcCB0byB1cGRhdGUgaW50ZXJuYWwgc2xlZXAgdGltZXIgYW5kIGNoYW5nZSBzbGVlcCBzdGF0ZSBpZiBuZWVkZWQuCiAgICAgKiBAcGFyYW0gdGltZSBUaGUgd29ybGQgdGltZSBpbiBzZWNvbmRzCiAgICAgKi8KCgogICAgc2xlZXBUaWNrKHRpbWUpIHsKICAgICAgaWYgKHRoaXMuYWxsb3dTbGVlcCkgewogICAgICAgIGNvbnN0IHNsZWVwU3RhdGUgPSB0aGlzLnNsZWVwU3RhdGU7CiAgICAgICAgY29uc3Qgc3BlZWRTcXVhcmVkID0gdGhpcy52ZWxvY2l0eS5sZW5ndGhTcXVhcmVkKCkgKyB0aGlzLmFuZ3VsYXJWZWxvY2l0eS5sZW5ndGhTcXVhcmVkKCk7CiAgICAgICAgY29uc3Qgc3BlZWRMaW1pdFNxdWFyZWQgPSB0aGlzLnNsZWVwU3BlZWRMaW1pdCAqKiAyOwoKICAgICAgICBpZiAoc2xlZXBTdGF0ZSA9PT0gQm9keS5BV0FLRSAmJiBzcGVlZFNxdWFyZWQgPCBzcGVlZExpbWl0U3F1YXJlZCkgewogICAgICAgICAgdGhpcy5zbGVlcFN0YXRlID0gQm9keS5TTEVFUFk7IC8vIFNsZWVweQoKICAgICAgICAgIHRoaXMudGltZUxhc3RTbGVlcHkgPSB0aW1lOwogICAgICAgICAgdGhpcy5kaXNwYXRjaEV2ZW50KEJvZHkuc2xlZXB5RXZlbnQpOwogICAgICAgIH0gZWxzZSBpZiAoc2xlZXBTdGF0ZSA9PT0gQm9keS5TTEVFUFkgJiYgc3BlZWRTcXVhcmVkID4gc3BlZWRMaW1pdFNxdWFyZWQpIHsKICAgICAgICAgIHRoaXMud2FrZVVwKCk7IC8vIFdha2UgdXAKICAgICAgICB9IGVsc2UgaWYgKHNsZWVwU3RhdGUgPT09IEJvZHkuU0xFRVBZICYmIHRpbWUgLSB0aGlzLnRpbWVMYXN0U2xlZXB5ID4gdGhpcy5zbGVlcFRpbWVMaW1pdCkgewogICAgICAgICAgdGhpcy5zbGVlcCgpOyAvLyBTbGVlcGluZwoKICAgICAgICAgIHRoaXMuZGlzcGF0Y2hFdmVudChCb2R5LnNsZWVwRXZlbnQpOwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBJZiB0aGUgYm9keSBpcyBzbGVlcGluZywgaXQgc2hvdWxkIGJlIGltbW92YWJsZSAvIGhhdmUgaW5maW5pdGUgbWFzcyBkdXJpbmcgc29sdmUuIFdlIHNvbHZlIGl0IGJ5IGhhdmluZyBhIHNlcGFyYXRlICJzb2x2ZSBtYXNzIi4KICAgICAqLwoKCiAgICB1cGRhdGVTb2x2ZU1hc3NQcm9wZXJ0aWVzKCkgewogICAgICBpZiAodGhpcy5zbGVlcFN0YXRlID09PSBCb2R5LlNMRUVQSU5HIHx8IHRoaXMudHlwZSA9PT0gQm9keS5LSU5FTUFUSUMpIHsKICAgICAgICB0aGlzLmludk1hc3NTb2x2ZSA9IDA7CiAgICAgICAgdGhpcy5pbnZJbmVydGlhU29sdmUuc2V0WmVybygpOwogICAgICAgIHRoaXMuaW52SW5lcnRpYVdvcmxkU29sdmUuc2V0WmVybygpOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuaW52TWFzc1NvbHZlID0gdGhpcy5pbnZNYXNzOwogICAgICAgIHRoaXMuaW52SW5lcnRpYVNvbHZlLmNvcHkodGhpcy5pbnZJbmVydGlhKTsKICAgICAgICB0aGlzLmludkluZXJ0aWFXb3JsZFNvbHZlLmNvcHkodGhpcy5pbnZJbmVydGlhV29ybGQpOwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIENvbnZlcnQgYSB3b3JsZCBwb2ludCB0byBsb2NhbCBib2R5IGZyYW1lLgogICAgICovCgoKICAgIHBvaW50VG9Mb2NhbEZyYW1lKHdvcmxkUG9pbnQsIHJlc3VsdCkgewogICAgICBpZiAocmVzdWx0ID09PSB2b2lkIDApIHsKICAgICAgICByZXN1bHQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICB3b3JsZFBvaW50LnZzdWIodGhpcy5wb3NpdGlvbiwgcmVzdWx0KTsKICAgICAgdGhpcy5xdWF0ZXJuaW9uLmNvbmp1Z2F0ZSgpLnZtdWx0KHJlc3VsdCwgcmVzdWx0KTsKICAgICAgcmV0dXJuIHJlc3VsdDsKICAgIH0KICAgIC8qKgogICAgICogQ29udmVydCBhIHdvcmxkIHZlY3RvciB0byBsb2NhbCBib2R5IGZyYW1lLgogICAgICovCgoKICAgIHZlY3RvclRvTG9jYWxGcmFtZSh3b3JsZFZlY3RvciwgcmVzdWx0KSB7CiAgICAgIGlmIChyZXN1bHQgPT09IHZvaWQgMCkgewogICAgICAgIHJlc3VsdCA9IG5ldyBWZWMzKCk7CiAgICAgIH0KCiAgICAgIHRoaXMucXVhdGVybmlvbi5jb25qdWdhdGUoKS52bXVsdCh3b3JsZFZlY3RvciwgcmVzdWx0KTsKICAgICAgcmV0dXJuIHJlc3VsdDsKICAgIH0KICAgIC8qKgogICAgICogQ29udmVydCBhIGxvY2FsIGJvZHkgcG9pbnQgdG8gd29ybGQgZnJhbWUuCiAgICAgKi8KCgogICAgcG9pbnRUb1dvcmxkRnJhbWUobG9jYWxQb2ludCwgcmVzdWx0KSB7CiAgICAgIGlmIChyZXN1bHQgPT09IHZvaWQgMCkgewogICAgICAgIHJlc3VsdCA9IG5ldyBWZWMzKCk7CiAgICAgIH0KCiAgICAgIHRoaXMucXVhdGVybmlvbi52bXVsdChsb2NhbFBvaW50LCByZXN1bHQpOwogICAgICByZXN1bHQudmFkZCh0aGlzLnBvc2l0aW9uLCByZXN1bHQpOwogICAgICByZXR1cm4gcmVzdWx0OwogICAgfQogICAgLyoqCiAgICAgKiBDb252ZXJ0IGEgbG9jYWwgYm9keSBwb2ludCB0byB3b3JsZCBmcmFtZS4KICAgICAqLwoKCiAgICB2ZWN0b3JUb1dvcmxkRnJhbWUobG9jYWxWZWN0b3IsIHJlc3VsdCkgewogICAgICBpZiAocmVzdWx0ID09PSB2b2lkIDApIHsKICAgICAgICByZXN1bHQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICB0aGlzLnF1YXRlcm5pb24udm11bHQobG9jYWxWZWN0b3IsIHJlc3VsdCk7CiAgICAgIHJldHVybiByZXN1bHQ7CiAgICB9CiAgICAvKioKICAgICAqIEFkZCBhIHNoYXBlIHRvIHRoZSBib2R5IHdpdGggYSBsb2NhbCBvZmZzZXQgYW5kIG9yaWVudGF0aW9uLgogICAgICogQHJldHVybiBUaGUgYm9keSBvYmplY3QsIGZvciBjaGFpbmFiaWxpdHkuCiAgICAgKi8KCgogICAgYWRkU2hhcGUoc2hhcGUsIF9vZmZzZXQsIF9vcmllbnRhdGlvbikgewogICAgICBjb25zdCBvZmZzZXQgPSBuZXcgVmVjMygpOwogICAgICBjb25zdCBvcmllbnRhdGlvbiA9IG5ldyBRdWF0ZXJuaW9uKCk7CgogICAgICBpZiAoX29mZnNldCkgewogICAgICAgIG9mZnNldC5jb3B5KF9vZmZzZXQpOwogICAgICB9CgogICAgICBpZiAoX29yaWVudGF0aW9uKSB7CiAgICAgICAgb3JpZW50YXRpb24uY29weShfb3JpZW50YXRpb24pOwogICAgICB9CgogICAgICB0aGlzLnNoYXBlcy5wdXNoKHNoYXBlKTsKICAgICAgdGhpcy5zaGFwZU9mZnNldHMucHVzaChvZmZzZXQpOwogICAgICB0aGlzLnNoYXBlT3JpZW50YXRpb25zLnB1c2gob3JpZW50YXRpb24pOwogICAgICB0aGlzLnVwZGF0ZU1hc3NQcm9wZXJ0aWVzKCk7CiAgICAgIHRoaXMudXBkYXRlQm91bmRpbmdSYWRpdXMoKTsKICAgICAgdGhpcy5hYWJiTmVlZHNVcGRhdGUgPSB0cnVlOwogICAgICBzaGFwZS5ib2R5ID0gdGhpczsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICAvKioKICAgICAqIFJlbW92ZSBhIHNoYXBlIGZyb20gdGhlIGJvZHkuCiAgICAgKiBAcmV0dXJuIFRoZSBib2R5IG9iamVjdCwgZm9yIGNoYWluYWJpbGl0eS4KICAgICAqLwoKCiAgICByZW1vdmVTaGFwZShzaGFwZSkgewogICAgICBjb25zdCBpbmRleCA9IHRoaXMuc2hhcGVzLmluZGV4T2Yoc2hhcGUpOwoKICAgICAgaWYgKGluZGV4ID09PSAtMSkgewogICAgICAgIGNvbnNvbGUud2FybignU2hhcGUgZG9lcyBub3QgYmVsb25nIHRvIHRoZSBib2R5Jyk7CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgIH0KCiAgICAgIHRoaXMuc2hhcGVzLnNwbGljZShpbmRleCwgMSk7CiAgICAgIHRoaXMuc2hhcGVPZmZzZXRzLnNwbGljZShpbmRleCwgMSk7CiAgICAgIHRoaXMuc2hhcGVPcmllbnRhdGlvbnMuc3BsaWNlKGluZGV4LCAxKTsKICAgICAgdGhpcy51cGRhdGVNYXNzUHJvcGVydGllcygpOwogICAgICB0aGlzLnVwZGF0ZUJvdW5kaW5nUmFkaXVzKCk7CiAgICAgIHRoaXMuYWFiYk5lZWRzVXBkYXRlID0gdHJ1ZTsKICAgICAgc2hhcGUuYm9keSA9IG51bGw7CiAgICAgIHJldHVybiB0aGlzOwogICAgfQogICAgLyoqCiAgICAgKiBVcGRhdGUgdGhlIGJvdW5kaW5nIHJhZGl1cyBvZiB0aGUgYm9keS4gU2hvdWxkIGJlIGRvbmUgaWYgYW55IG9mIHRoZSBzaGFwZXMgYXJlIGNoYW5nZWQuCiAgICAgKi8KCgogICAgdXBkYXRlQm91bmRpbmdSYWRpdXMoKSB7CiAgICAgIGNvbnN0IHNoYXBlcyA9IHRoaXMuc2hhcGVzOwogICAgICBjb25zdCBzaGFwZU9mZnNldHMgPSB0aGlzLnNoYXBlT2Zmc2V0czsKICAgICAgY29uc3QgTiA9IHNoYXBlcy5sZW5ndGg7CiAgICAgIGxldCByYWRpdXMgPSAwOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IE47IGkrKykgewogICAgICAgIGNvbnN0IHNoYXBlID0gc2hhcGVzW2ldOwogICAgICAgIHNoYXBlLnVwZGF0ZUJvdW5kaW5nU3BoZXJlUmFkaXVzKCk7CiAgICAgICAgY29uc3Qgb2Zmc2V0ID0gc2hhcGVPZmZzZXRzW2ldLmxlbmd0aCgpOwogICAgICAgIGNvbnN0IHIgPSBzaGFwZS5ib3VuZGluZ1NwaGVyZVJhZGl1czsKCiAgICAgICAgaWYgKG9mZnNldCArIHIgPiByYWRpdXMpIHsKICAgICAgICAgIHJhZGl1cyA9IG9mZnNldCArIHI7CiAgICAgICAgfQogICAgICB9CgogICAgICB0aGlzLmJvdW5kaW5nUmFkaXVzID0gcmFkaXVzOwogICAgfQogICAgLyoqCiAgICAgKiBVcGRhdGVzIHRoZSAuYWFiYgogICAgICovCgoKICAgIHVwZGF0ZUFBQkIoKSB7CiAgICAgIGNvbnN0IHNoYXBlcyA9IHRoaXMuc2hhcGVzOwogICAgICBjb25zdCBzaGFwZU9mZnNldHMgPSB0aGlzLnNoYXBlT2Zmc2V0czsKICAgICAgY29uc3Qgc2hhcGVPcmllbnRhdGlvbnMgPSB0aGlzLnNoYXBlT3JpZW50YXRpb25zOwogICAgICBjb25zdCBOID0gc2hhcGVzLmxlbmd0aDsKICAgICAgY29uc3Qgb2Zmc2V0ID0gdG1wVmVjOwogICAgICBjb25zdCBvcmllbnRhdGlvbiA9IHRtcFF1YXQ7CiAgICAgIGNvbnN0IGJvZHlRdWF0ID0gdGhpcy5xdWF0ZXJuaW9uOwogICAgICBjb25zdCBhYWJiID0gdGhpcy5hYWJiOwogICAgICBjb25zdCBzaGFwZUFBQkIgPSB1cGRhdGVBQUJCX3NoYXBlQUFCQjsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpICE9PSBOOyBpKyspIHsKICAgICAgICBjb25zdCBzaGFwZSA9IHNoYXBlc1tpXTsgLy8gR2V0IHNoYXBlIHdvcmxkIHBvc2l0aW9uCgogICAgICAgIGJvZHlRdWF0LnZtdWx0KHNoYXBlT2Zmc2V0c1tpXSwgb2Zmc2V0KTsKICAgICAgICBvZmZzZXQudmFkZCh0aGlzLnBvc2l0aW9uLCBvZmZzZXQpOyAvLyBHZXQgc2hhcGUgd29ybGQgcXVhdGVybmlvbgoKICAgICAgICBib2R5UXVhdC5tdWx0KHNoYXBlT3JpZW50YXRpb25zW2ldLCBvcmllbnRhdGlvbik7IC8vIEdldCBzaGFwZSBBQUJCCgogICAgICAgIHNoYXBlLmNhbGN1bGF0ZVdvcmxkQUFCQihvZmZzZXQsIG9yaWVudGF0aW9uLCBzaGFwZUFBQkIubG93ZXJCb3VuZCwgc2hhcGVBQUJCLnVwcGVyQm91bmQpOwoKICAgICAgICBpZiAoaSA9PT0gMCkgewogICAgICAgICAgYWFiYi5jb3B5KHNoYXBlQUFCQik7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGFhYmIuZXh0ZW5kKHNoYXBlQUFCQik7CiAgICAgICAgfQogICAgICB9CgogICAgICB0aGlzLmFhYmJOZWVkc1VwZGF0ZSA9IGZhbHNlOwogICAgfQogICAgLyoqCiAgICAgKiBVcGRhdGUgYC5pbmVydGlhV29ybGRgIGFuZCBgLmludkluZXJ0aWFXb3JsZGAKICAgICAqLwoKCiAgICB1cGRhdGVJbmVydGlhV29ybGQoZm9yY2UpIHsKICAgICAgY29uc3QgSSA9IHRoaXMuaW52SW5lcnRpYTsKCiAgICAgIGlmIChJLnggPT09IEkueSAmJiBJLnkgPT09IEkueiAmJiAhZm9yY2UpIDsgZWxzZSB7CiAgICAgICAgY29uc3QgbTEgPSB1aXdfbTE7CiAgICAgICAgY29uc3QgbTIgPSB1aXdfbTI7CiAgICAgICAgbTEuc2V0Um90YXRpb25Gcm9tUXVhdGVybmlvbih0aGlzLnF1YXRlcm5pb24pOwogICAgICAgIG0xLnRyYW5zcG9zZShtMik7CiAgICAgICAgbTEuc2NhbGUoSSwgbTEpOwogICAgICAgIG0xLm1tdWx0KG0yLCB0aGlzLmludkluZXJ0aWFXb3JsZCk7CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogQXBwbHkgZm9yY2UgdG8gYSBwb2ludCBvZiB0aGUgYm9keS4gVGhpcyBjb3VsZCBmb3IgZXhhbXBsZSBiZSBhIHBvaW50IG9uIHRoZSBCb2R5IHN1cmZhY2UuCiAgICAgKiBBcHBseWluZyBmb3JjZSB0aGlzIHdheSB3aWxsIGFkZCB0byBCb2R5LmZvcmNlIGFuZCBCb2R5LnRvcnF1ZS4KICAgICAqIEBwYXJhbSBmb3JjZSBUaGUgYW1vdW50IG9mIGZvcmNlIHRvIGFkZC4KICAgICAqIEBwYXJhbSByZWxhdGl2ZVBvaW50IEEgcG9pbnQgcmVsYXRpdmUgdG8gdGhlIGNlbnRlciBvZiBtYXNzIHRvIGFwcGx5IHRoZSBmb3JjZSBvbi4KICAgICAqLwoKCiAgICBhcHBseUZvcmNlKGZvcmNlLCByZWxhdGl2ZVBvaW50KSB7CiAgICAgIGlmIChyZWxhdGl2ZVBvaW50ID09PSB2b2lkIDApIHsKICAgICAgICByZWxhdGl2ZVBvaW50ID0gbmV3IFZlYzMoKTsKICAgICAgfQoKICAgICAgLy8gTmVlZGVkPwogICAgICBpZiAodGhpcy50eXBlICE9PSBCb2R5LkRZTkFNSUMpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGlmICh0aGlzLnNsZWVwU3RhdGUgPT09IEJvZHkuU0xFRVBJTkcpIHsKICAgICAgICB0aGlzLndha2VVcCgpOwogICAgICB9IC8vIENvbXB1dGUgcHJvZHVjZWQgcm90YXRpb25hbCBmb3JjZQoKCiAgICAgIGNvbnN0IHJvdEZvcmNlID0gQm9keV9hcHBseUZvcmNlX3JvdEZvcmNlOwogICAgICByZWxhdGl2ZVBvaW50LmNyb3NzKGZvcmNlLCByb3RGb3JjZSk7IC8vIEFkZCBsaW5lYXIgZm9yY2UKCiAgICAgIHRoaXMuZm9yY2UudmFkZChmb3JjZSwgdGhpcy5mb3JjZSk7IC8vIEFkZCByb3RhdGlvbmFsIGZvcmNlCgogICAgICB0aGlzLnRvcnF1ZS52YWRkKHJvdEZvcmNlLCB0aGlzLnRvcnF1ZSk7CiAgICB9CiAgICAvKioKICAgICAqIEFwcGx5IGZvcmNlIHRvIGEgbG9jYWwgcG9pbnQgaW4gdGhlIGJvZHkuCiAgICAgKiBAcGFyYW0gZm9yY2UgVGhlIGZvcmNlIHZlY3RvciB0byBhcHBseSwgZGVmaW5lZCBsb2NhbGx5IGluIHRoZSBib2R5IGZyYW1lLgogICAgICogQHBhcmFtIGxvY2FsUG9pbnQgQSBsb2NhbCBwb2ludCBpbiB0aGUgYm9keSB0byBhcHBseSB0aGUgZm9yY2Ugb24uCiAgICAgKi8KCgogICAgYXBwbHlMb2NhbEZvcmNlKGxvY2FsRm9yY2UsIGxvY2FsUG9pbnQpIHsKICAgICAgaWYgKGxvY2FsUG9pbnQgPT09IHZvaWQgMCkgewogICAgICAgIGxvY2FsUG9pbnQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICBpZiAodGhpcy50eXBlICE9PSBCb2R5LkRZTkFNSUMpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGNvbnN0IHdvcmxkRm9yY2UgPSBCb2R5X2FwcGx5TG9jYWxGb3JjZV93b3JsZEZvcmNlOwogICAgICBjb25zdCByZWxhdGl2ZVBvaW50V29ybGQgPSBCb2R5X2FwcGx5TG9jYWxGb3JjZV9yZWxhdGl2ZVBvaW50V29ybGQ7IC8vIFRyYW5zZm9ybSB0aGUgZm9yY2UgdmVjdG9yIHRvIHdvcmxkIHNwYWNlCgogICAgICB0aGlzLnZlY3RvclRvV29ybGRGcmFtZShsb2NhbEZvcmNlLCB3b3JsZEZvcmNlKTsKICAgICAgdGhpcy52ZWN0b3JUb1dvcmxkRnJhbWUobG9jYWxQb2ludCwgcmVsYXRpdmVQb2ludFdvcmxkKTsKICAgICAgdGhpcy5hcHBseUZvcmNlKHdvcmxkRm9yY2UsIHJlbGF0aXZlUG9pbnRXb3JsZCk7CiAgICB9CiAgICAvKioKICAgICAqIEFwcGx5IHRvcnF1ZSB0byB0aGUgYm9keS4KICAgICAqIEBwYXJhbSB0b3JxdWUgVGhlIGFtb3VudCBvZiB0b3JxdWUgdG8gYWRkLgogICAgICovCgoKICAgIGFwcGx5VG9ycXVlKHRvcnF1ZSkgewogICAgICBpZiAodGhpcy50eXBlICE9PSBCb2R5LkRZTkFNSUMpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGlmICh0aGlzLnNsZWVwU3RhdGUgPT09IEJvZHkuU0xFRVBJTkcpIHsKICAgICAgICB0aGlzLndha2VVcCgpOwogICAgICB9IC8vIEFkZCByb3RhdGlvbmFsIGZvcmNlCgoKICAgICAgdGhpcy50b3JxdWUudmFkZCh0b3JxdWUsIHRoaXMudG9ycXVlKTsKICAgIH0KICAgIC8qKgogICAgICogQXBwbHkgaW1wdWxzZSB0byBhIHBvaW50IG9mIHRoZSBib2R5LiBUaGlzIGNvdWxkIGZvciBleGFtcGxlIGJlIGEgcG9pbnQgb24gdGhlIEJvZHkgc3VyZmFjZS4KICAgICAqIEFuIGltcHVsc2UgaXMgYSBmb3JjZSBhZGRlZCB0byBhIGJvZHkgZHVyaW5nIGEgc2hvcnQgcGVyaW9kIG9mIHRpbWUgKGltcHVsc2UgPSBmb3JjZSAqIHRpbWUpLgogICAgICogSW1wdWxzZXMgd2lsbCBiZSBhZGRlZCB0byBCb2R5LnZlbG9jaXR5IGFuZCBCb2R5LmFuZ3VsYXJWZWxvY2l0eS4KICAgICAqIEBwYXJhbSBpbXB1bHNlIFRoZSBhbW91bnQgb2YgaW1wdWxzZSB0byBhZGQuCiAgICAgKiBAcGFyYW0gcmVsYXRpdmVQb2ludCBBIHBvaW50IHJlbGF0aXZlIHRvIHRoZSBjZW50ZXIgb2YgbWFzcyB0byBhcHBseSB0aGUgZm9yY2Ugb24uCiAgICAgKi8KCgogICAgYXBwbHlJbXB1bHNlKGltcHVsc2UsIHJlbGF0aXZlUG9pbnQpIHsKICAgICAgaWYgKHJlbGF0aXZlUG9pbnQgPT09IHZvaWQgMCkgewogICAgICAgIHJlbGF0aXZlUG9pbnQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICBpZiAodGhpcy50eXBlICE9PSBCb2R5LkRZTkFNSUMpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGlmICh0aGlzLnNsZWVwU3RhdGUgPT09IEJvZHkuU0xFRVBJTkcpIHsKICAgICAgICB0aGlzLndha2VVcCgpOwogICAgICB9IC8vIENvbXB1dGUgcG9pbnQgcG9zaXRpb24gcmVsYXRpdmUgdG8gdGhlIGJvZHkgY2VudGVyCgoKICAgICAgY29uc3QgciA9IHJlbGF0aXZlUG9pbnQ7IC8vIENvbXB1dGUgcHJvZHVjZWQgY2VudHJhbCBpbXB1bHNlIHZlbG9jaXR5CgogICAgICBjb25zdCB2ZWxvID0gQm9keV9hcHBseUltcHVsc2VfdmVsbzsKICAgICAgdmVsby5jb3B5KGltcHVsc2UpOwogICAgICB2ZWxvLnNjYWxlKHRoaXMuaW52TWFzcywgdmVsbyk7IC8vIEFkZCBsaW5lYXIgaW1wdWxzZQoKICAgICAgdGhpcy52ZWxvY2l0eS52YWRkKHZlbG8sIHRoaXMudmVsb2NpdHkpOyAvLyBDb21wdXRlIHByb2R1Y2VkIHJvdGF0aW9uYWwgaW1wdWxzZSB2ZWxvY2l0eQoKICAgICAgY29uc3Qgcm90VmVsbyA9IEJvZHlfYXBwbHlJbXB1bHNlX3JvdFZlbG87CiAgICAgIHIuY3Jvc3MoaW1wdWxzZSwgcm90VmVsbyk7CiAgICAgIC8qCiAgICAgICByb3RWZWxvLnggKj0gdGhpcy5pbnZJbmVydGlhLng7CiAgICAgICByb3RWZWxvLnkgKj0gdGhpcy5pbnZJbmVydGlhLnk7CiAgICAgICByb3RWZWxvLnogKj0gdGhpcy5pbnZJbmVydGlhLno7CiAgICAgICAqLwoKICAgICAgdGhpcy5pbnZJbmVydGlhV29ybGQudm11bHQocm90VmVsbywgcm90VmVsbyk7IC8vIEFkZCByb3RhdGlvbmFsIEltcHVsc2UKCiAgICAgIHRoaXMuYW5ndWxhclZlbG9jaXR5LnZhZGQocm90VmVsbywgdGhpcy5hbmd1bGFyVmVsb2NpdHkpOwogICAgfQogICAgLyoqCiAgICAgKiBBcHBseSBsb2NhbGx5LWRlZmluZWQgaW1wdWxzZSB0byBhIGxvY2FsIHBvaW50IGluIHRoZSBib2R5LgogICAgICogQHBhcmFtIGZvcmNlIFRoZSBmb3JjZSB2ZWN0b3IgdG8gYXBwbHksIGRlZmluZWQgbG9jYWxseSBpbiB0aGUgYm9keSBmcmFtZS4KICAgICAqIEBwYXJhbSBsb2NhbFBvaW50IEEgbG9jYWwgcG9pbnQgaW4gdGhlIGJvZHkgdG8gYXBwbHkgdGhlIGZvcmNlIG9uLgogICAgICovCgoKICAgIGFwcGx5TG9jYWxJbXB1bHNlKGxvY2FsSW1wdWxzZSwgbG9jYWxQb2ludCkgewogICAgICBpZiAobG9jYWxQb2ludCA9PT0gdm9pZCAwKSB7CiAgICAgICAgbG9jYWxQb2ludCA9IG5ldyBWZWMzKCk7CiAgICAgIH0KCiAgICAgIGlmICh0aGlzLnR5cGUgIT09IEJvZHkuRFlOQU1JQykgewogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgY29uc3Qgd29ybGRJbXB1bHNlID0gQm9keV9hcHBseUxvY2FsSW1wdWxzZV93b3JsZEltcHVsc2U7CiAgICAgIGNvbnN0IHJlbGF0aXZlUG9pbnRXb3JsZCA9IEJvZHlfYXBwbHlMb2NhbEltcHVsc2VfcmVsYXRpdmVQb2ludDsgLy8gVHJhbnNmb3JtIHRoZSBmb3JjZSB2ZWN0b3IgdG8gd29ybGQgc3BhY2UKCiAgICAgIHRoaXMudmVjdG9yVG9Xb3JsZEZyYW1lKGxvY2FsSW1wdWxzZSwgd29ybGRJbXB1bHNlKTsKICAgICAgdGhpcy52ZWN0b3JUb1dvcmxkRnJhbWUobG9jYWxQb2ludCwgcmVsYXRpdmVQb2ludFdvcmxkKTsKICAgICAgdGhpcy5hcHBseUltcHVsc2Uod29ybGRJbXB1bHNlLCByZWxhdGl2ZVBvaW50V29ybGQpOwogICAgfQogICAgLyoqCiAgICAgKiBTaG91bGQgYmUgY2FsbGVkIHdoZW5ldmVyIHlvdSBjaGFuZ2UgdGhlIGJvZHkgc2hhcGUgb3IgbWFzcy4KICAgICAqLwoKCiAgICB1cGRhdGVNYXNzUHJvcGVydGllcygpIHsKICAgICAgY29uc3QgaGFsZkV4dGVudHMgPSBCb2R5X3VwZGF0ZU1hc3NQcm9wZXJ0aWVzX2hhbGZFeHRlbnRzOwogICAgICB0aGlzLmludk1hc3MgPSB0aGlzLm1hc3MgPiAwID8gMS4wIC8gdGhpcy5tYXNzIDogMDsKICAgICAgY29uc3QgSSA9IHRoaXMuaW5lcnRpYTsKICAgICAgY29uc3QgZml4ZWQgPSB0aGlzLmZpeGVkUm90YXRpb247IC8vIEFwcHJveGltYXRlIHdpdGggQUFCQiBib3gKCiAgICAgIHRoaXMudXBkYXRlQUFCQigpOwogICAgICBoYWxmRXh0ZW50cy5zZXQoKHRoaXMuYWFiYi51cHBlckJvdW5kLnggLSB0aGlzLmFhYmIubG93ZXJCb3VuZC54KSAvIDIsICh0aGlzLmFhYmIudXBwZXJCb3VuZC55IC0gdGhpcy5hYWJiLmxvd2VyQm91bmQueSkgLyAyLCAodGhpcy5hYWJiLnVwcGVyQm91bmQueiAtIHRoaXMuYWFiYi5sb3dlckJvdW5kLnopIC8gMik7CiAgICAgIEJveC5jYWxjdWxhdGVJbmVydGlhKGhhbGZFeHRlbnRzLCB0aGlzLm1hc3MsIEkpOwogICAgICB0aGlzLmludkluZXJ0aWEuc2V0KEkueCA+IDAgJiYgIWZpeGVkID8gMS4wIC8gSS54IDogMCwgSS55ID4gMCAmJiAhZml4ZWQgPyAxLjAgLyBJLnkgOiAwLCBJLnogPiAwICYmICFmaXhlZCA/IDEuMCAvIEkueiA6IDApOwogICAgICB0aGlzLnVwZGF0ZUluZXJ0aWFXb3JsZCh0cnVlKTsKICAgIH0KICAgIC8qKgogICAgICogR2V0IHdvcmxkIHZlbG9jaXR5IG9mIGEgcG9pbnQgaW4gdGhlIGJvZHkuCiAgICAgKiBAcGFyYW0gd29ybGRQb2ludAogICAgICogQHBhcmFtIHJlc3VsdAogICAgICogQHJldHVybiBUaGUgcmVzdWx0IHZlY3Rvci4KICAgICAqLwoKCiAgICBnZXRWZWxvY2l0eUF0V29ybGRQb2ludCh3b3JsZFBvaW50LCByZXN1bHQpIHsKICAgICAgY29uc3QgciA9IG5ldyBWZWMzKCk7CiAgICAgIHdvcmxkUG9pbnQudnN1Yih0aGlzLnBvc2l0aW9uLCByKTsKICAgICAgdGhpcy5hbmd1bGFyVmVsb2NpdHkuY3Jvc3MociwgcmVzdWx0KTsKICAgICAgdGhpcy52ZWxvY2l0eS52YWRkKHJlc3VsdCwgcmVzdWx0KTsKICAgICAgcmV0dXJuIHJlc3VsdDsKICAgIH0KICAgIC8qKgogICAgICogTW92ZSB0aGUgYm9keSBmb3J3YXJkIGluIHRpbWUuCiAgICAgKiBAcGFyYW0gZHQgVGltZSBzdGVwCiAgICAgKiBAcGFyYW0gcXVhdE5vcm1hbGl6ZSBTZXQgdG8gdHJ1ZSB0byBub3JtYWxpemUgdGhlIGJvZHkgcXVhdGVybmlvbgogICAgICogQHBhcmFtIHF1YXROb3JtYWxpemVGYXN0IElmIHRoZSBxdWF0ZXJuaW9uIHNob3VsZCBiZSBub3JtYWxpemVkIHVzaW5nICJmYXN0IiBxdWF0ZXJuaW9uIG5vcm1hbGl6YXRpb24KICAgICAqLwoKCiAgICBpbnRlZ3JhdGUoZHQsIHF1YXROb3JtYWxpemUsIHF1YXROb3JtYWxpemVGYXN0KSB7CiAgICAgIC8vIFNhdmUgcHJldmlvdXMgcG9zaXRpb24KICAgICAgdGhpcy5wcmV2aW91c1Bvc2l0aW9uLmNvcHkodGhpcy5wb3NpdGlvbik7CiAgICAgIHRoaXMucHJldmlvdXNRdWF0ZXJuaW9uLmNvcHkodGhpcy5xdWF0ZXJuaW9uKTsKCiAgICAgIGlmICghKHRoaXMudHlwZSA9PT0gQm9keS5EWU5BTUlDIHx8IHRoaXMudHlwZSA9PT0gQm9keS5LSU5FTUFUSUMpIHx8IHRoaXMuc2xlZXBTdGF0ZSA9PT0gQm9keS5TTEVFUElORykgewogICAgICAgIC8vIE9ubHkgZm9yIGR5bmFtaWMKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGNvbnN0IHZlbG8gPSB0aGlzLnZlbG9jaXR5OwogICAgICBjb25zdCBhbmd1bGFyVmVsbyA9IHRoaXMuYW5ndWxhclZlbG9jaXR5OwogICAgICBjb25zdCBwb3MgPSB0aGlzLnBvc2l0aW9uOwogICAgICBjb25zdCBmb3JjZSA9IHRoaXMuZm9yY2U7CiAgICAgIGNvbnN0IHRvcnF1ZSA9IHRoaXMudG9ycXVlOwogICAgICBjb25zdCBxdWF0ID0gdGhpcy5xdWF0ZXJuaW9uOwogICAgICBjb25zdCBpbnZNYXNzID0gdGhpcy5pbnZNYXNzOwogICAgICBjb25zdCBpbnZJbmVydGlhID0gdGhpcy5pbnZJbmVydGlhV29ybGQ7CiAgICAgIGNvbnN0IGxpbmVhckZhY3RvciA9IHRoaXMubGluZWFyRmFjdG9yOwogICAgICBjb25zdCBpTWR0ID0gaW52TWFzcyAqIGR0OwogICAgICB2ZWxvLnggKz0gZm9yY2UueCAqIGlNZHQgKiBsaW5lYXJGYWN0b3IueDsKICAgICAgdmVsby55ICs9IGZvcmNlLnkgKiBpTWR0ICogbGluZWFyRmFjdG9yLnk7CiAgICAgIHZlbG8ueiArPSBmb3JjZS56ICogaU1kdCAqIGxpbmVhckZhY3Rvci56OwogICAgICBjb25zdCBlID0gaW52SW5lcnRpYS5lbGVtZW50czsKICAgICAgY29uc3QgYW5ndWxhckZhY3RvciA9IHRoaXMuYW5ndWxhckZhY3RvcjsKICAgICAgY29uc3QgdHggPSB0b3JxdWUueCAqIGFuZ3VsYXJGYWN0b3IueDsKICAgICAgY29uc3QgdHkgPSB0b3JxdWUueSAqIGFuZ3VsYXJGYWN0b3IueTsKICAgICAgY29uc3QgdHogPSB0b3JxdWUueiAqIGFuZ3VsYXJGYWN0b3IuejsKICAgICAgYW5ndWxhclZlbG8ueCArPSBkdCAqIChlWzBdICogdHggKyBlWzFdICogdHkgKyBlWzJdICogdHopOwogICAgICBhbmd1bGFyVmVsby55ICs9IGR0ICogKGVbM10gKiB0eCArIGVbNF0gKiB0eSArIGVbNV0gKiB0eik7CiAgICAgIGFuZ3VsYXJWZWxvLnogKz0gZHQgKiAoZVs2XSAqIHR4ICsgZVs3XSAqIHR5ICsgZVs4XSAqIHR6KTsgLy8gVXNlIG5ldyB2ZWxvY2l0eSAgLSBsZWFwIGZyb2cKCiAgICAgIHBvcy54ICs9IHZlbG8ueCAqIGR0OwogICAgICBwb3MueSArPSB2ZWxvLnkgKiBkdDsKICAgICAgcG9zLnogKz0gdmVsby56ICogZHQ7CiAgICAgIHF1YXQuaW50ZWdyYXRlKHRoaXMuYW5ndWxhclZlbG9jaXR5LCBkdCwgdGhpcy5hbmd1bGFyRmFjdG9yLCBxdWF0KTsKCiAgICAgIGlmIChxdWF0Tm9ybWFsaXplKSB7CiAgICAgICAgaWYgKHF1YXROb3JtYWxpemVGYXN0KSB7CiAgICAgICAgICBxdWF0Lm5vcm1hbGl6ZUZhc3QoKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgcXVhdC5ub3JtYWxpemUoKTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIHRoaXMuYWFiYk5lZWRzVXBkYXRlID0gdHJ1ZTsgLy8gVXBkYXRlIHdvcmxkIGluZXJ0aWEKCiAgICAgIHRoaXMudXBkYXRlSW5lcnRpYVdvcmxkKCk7CiAgICB9CgogIH0KICBCb2R5LmlkQ291bnRlciA9IDA7CiAgQm9keS5DT0xMSURFX0VWRU5UX05BTUUgPSAnY29sbGlkZSc7CiAgQm9keS5EWU5BTUlDID0gQk9EWV9UWVBFUy5EWU5BTUlDOwogIEJvZHkuU1RBVElDID0gQk9EWV9UWVBFUy5TVEFUSUM7CiAgQm9keS5LSU5FTUFUSUMgPSBCT0RZX1RZUEVTLktJTkVNQVRJQzsKICBCb2R5LkFXQUtFID0gQk9EWV9TTEVFUF9TVEFURVMuQVdBS0U7CiAgQm9keS5TTEVFUFkgPSBCT0RZX1NMRUVQX1NUQVRFUy5TTEVFUFk7CiAgQm9keS5TTEVFUElORyA9IEJPRFlfU0xFRVBfU1RBVEVTLlNMRUVQSU5HOwogIEJvZHkud2FrZXVwRXZlbnQgPSB7CiAgICB0eXBlOiAnd2FrZXVwJwogIH07CiAgQm9keS5zbGVlcHlFdmVudCA9IHsKICAgIHR5cGU6ICdzbGVlcHknCiAgfTsKICBCb2R5LnNsZWVwRXZlbnQgPSB7CiAgICB0eXBlOiAnc2xlZXAnCiAgfTsKICBjb25zdCB0bXBWZWMgPSBuZXcgVmVjMygpOwogIGNvbnN0IHRtcFF1YXQgPSBuZXcgUXVhdGVybmlvbigpOwogIGNvbnN0IHVwZGF0ZUFBQkJfc2hhcGVBQUJCID0gbmV3IEFBQkIoKTsKICBjb25zdCB1aXdfbTEgPSBuZXcgTWF0MygpOwogIGNvbnN0IHVpd19tMiA9IG5ldyBNYXQzKCk7CiAgbmV3IE1hdDMoKTsKICBjb25zdCBCb2R5X2FwcGx5Rm9yY2Vfcm90Rm9yY2UgPSBuZXcgVmVjMygpOwogIGNvbnN0IEJvZHlfYXBwbHlMb2NhbEZvcmNlX3dvcmxkRm9yY2UgPSBuZXcgVmVjMygpOwogIGNvbnN0IEJvZHlfYXBwbHlMb2NhbEZvcmNlX3JlbGF0aXZlUG9pbnRXb3JsZCA9IG5ldyBWZWMzKCk7CiAgY29uc3QgQm9keV9hcHBseUltcHVsc2VfdmVsbyA9IG5ldyBWZWMzKCk7CiAgY29uc3QgQm9keV9hcHBseUltcHVsc2Vfcm90VmVsbyA9IG5ldyBWZWMzKCk7CiAgY29uc3QgQm9keV9hcHBseUxvY2FsSW1wdWxzZV93b3JsZEltcHVsc2UgPSBuZXcgVmVjMygpOwogIGNvbnN0IEJvZHlfYXBwbHlMb2NhbEltcHVsc2VfcmVsYXRpdmVQb2ludCA9IG5ldyBWZWMzKCk7CiAgY29uc3QgQm9keV91cGRhdGVNYXNzUHJvcGVydGllc19oYWxmRXh0ZW50cyA9IG5ldyBWZWMzKCk7CgogIC8qKgogICAqIEJhc2UgY2xhc3MgZm9yIGJyb2FkcGhhc2UgaW1wbGVtZW50YXRpb25zCiAgICogQGF1dGhvciBzY2h0ZXBwZQogICAqLwogIGNsYXNzIEJyb2FkcGhhc2UgewogICAgLyoqCiAgICAgKiBUaGUgd29ybGQgdG8gc2VhcmNoIGZvciBjb2xsaXNpb25zIGluLgogICAgICovCgogICAgLyoqCiAgICAgKiBJZiBzZXQgdG8gdHJ1ZSwgdGhlIGJyb2FkcGhhc2UgdXNlcyBib3VuZGluZyBib3hlcyBmb3IgaW50ZXJzZWN0aW9uIHRlc3RzLCBlbHNlIGl0IHVzZXMgYm91bmRpbmcgc3BoZXJlcy4KICAgICAqLwoKICAgIC8qKgogICAgICogU2V0IHRvIHRydWUgaWYgdGhlIG9iamVjdHMgaW4gdGhlIHdvcmxkIG1vdmVkLgogICAgICovCiAgICBjb25zdHJ1Y3RvcigpIHsKICAgICAgdGhpcy53b3JsZCA9IG51bGw7CiAgICAgIHRoaXMudXNlQm91bmRpbmdCb3hlcyA9IGZhbHNlOwogICAgICB0aGlzLmRpcnR5ID0gdHJ1ZTsKICAgIH0KICAgIC8qKgogICAgICogR2V0IHRoZSBjb2xsaXNpb24gcGFpcnMgZnJvbSB0aGUgd29ybGQKICAgICAqIEBwYXJhbSB3b3JsZCBUaGUgd29ybGQgdG8gc2VhcmNoIGluCiAgICAgKiBAcGFyYW0gcDEgRW1wdHkgYXJyYXkgdG8gYmUgZmlsbGVkIHdpdGggYm9keSBvYmplY3RzCiAgICAgKiBAcGFyYW0gcDIgRW1wdHkgYXJyYXkgdG8gYmUgZmlsbGVkIHdpdGggYm9keSBvYmplY3RzCiAgICAgKi8KCgogICAgY29sbGlzaW9uUGFpcnMod29ybGQsIHAxLCBwMikgewogICAgICB0aHJvdyBuZXcgRXJyb3IoJ2NvbGxpc2lvblBhaXJzIG5vdCBpbXBsZW1lbnRlZCBmb3IgdGhpcyBCcm9hZFBoYXNlIGNsYXNzIScpOwogICAgfQogICAgLyoqCiAgICAgKiBDaGVjayBpZiBhIGJvZHkgcGFpciBuZWVkcyB0byBiZSBpbnRlcnNlY3Rpb24gdGVzdGVkIGF0IGFsbC4KICAgICAqLwoKCiAgICBuZWVkQnJvYWRwaGFzZUNvbGxpc2lvbihib2R5QSwgYm9keUIpIHsKICAgICAgLy8gQ2hlY2sgY29sbGlzaW9uIGZpbHRlciBtYXNrcwogICAgICBpZiAoKGJvZHlBLmNvbGxpc2lvbkZpbHRlckdyb3VwICYgYm9keUIuY29sbGlzaW9uRmlsdGVyTWFzaykgPT09IDAgfHwgKGJvZHlCLmNvbGxpc2lvbkZpbHRlckdyb3VwICYgYm9keUEuY29sbGlzaW9uRmlsdGVyTWFzaykgPT09IDApIHsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0gLy8gQ2hlY2sgdHlwZXMKCgogICAgICBpZiAoKChib2R5QS50eXBlICYgQm9keS5TVEFUSUMpICE9PSAwIHx8IGJvZHlBLnNsZWVwU3RhdGUgPT09IEJvZHkuU0xFRVBJTkcpICYmICgoYm9keUIudHlwZSAmIEJvZHkuU1RBVElDKSAhPT0gMCB8fCBib2R5Qi5zbGVlcFN0YXRlID09PSBCb2R5LlNMRUVQSU5HKSkgewogICAgICAgIC8vIEJvdGggYm9kaWVzIGFyZSBzdGF0aWMgb3Igc2xlZXBpbmcuIFNraXAuCiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9CgogICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KICAgIC8qKgogICAgICogQ2hlY2sgaWYgdGhlIGJvdW5kaW5nIHZvbHVtZXMgb2YgdHdvIGJvZGllcyBpbnRlcnNlY3QuCiAgICAgKi8KCgogICAgaW50ZXJzZWN0aW9uVGVzdChib2R5QSwgYm9keUIsIHBhaXJzMSwgcGFpcnMyKSB7CiAgICAgIGlmICh0aGlzLnVzZUJvdW5kaW5nQm94ZXMpIHsKICAgICAgICB0aGlzLmRvQm91bmRpbmdCb3hCcm9hZHBoYXNlKGJvZHlBLCBib2R5QiwgcGFpcnMxLCBwYWlyczIpOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuZG9Cb3VuZGluZ1NwaGVyZUJyb2FkcGhhc2UoYm9keUEsIGJvZHlCLCBwYWlyczEsIHBhaXJzMik7CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogQ2hlY2sgaWYgdGhlIGJvdW5kaW5nIHNwaGVyZXMgb2YgdHdvIGJvZGllcyBhcmUgaW50ZXJzZWN0aW5nLgogICAgICogQHBhcmFtIHBhaXJzMSBib2R5QSBpcyBhcHBlbmRlZCB0byB0aGlzIGFycmF5IGlmIGludGVyc2VjdGlvbgogICAgICogQHBhcmFtIHBhaXJzMiBib2R5QiBpcyBhcHBlbmRlZCB0byB0aGlzIGFycmF5IGlmIGludGVyc2VjdGlvbgogICAgICovCgoKICAgIGRvQm91bmRpbmdTcGhlcmVCcm9hZHBoYXNlKGJvZHlBLCBib2R5QiwgcGFpcnMxLCBwYWlyczIpIHsKICAgICAgY29uc3QgciA9IEJyb2FkcGhhc2VfY29sbGlzaW9uUGFpcnNfcjsKICAgICAgYm9keUIucG9zaXRpb24udnN1Yihib2R5QS5wb3NpdGlvbiwgcik7CiAgICAgIGNvbnN0IGJvdW5kaW5nUmFkaXVzU3VtMiA9IChib2R5QS5ib3VuZGluZ1JhZGl1cyArIGJvZHlCLmJvdW5kaW5nUmFkaXVzKSAqKiAyOwogICAgICBjb25zdCBub3JtMiA9IHIubGVuZ3RoU3F1YXJlZCgpOwoKICAgICAgaWYgKG5vcm0yIDwgYm91bmRpbmdSYWRpdXNTdW0yKSB7CiAgICAgICAgcGFpcnMxLnB1c2goYm9keUEpOwogICAgICAgIHBhaXJzMi5wdXNoKGJvZHlCKTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBDaGVjayBpZiB0aGUgYm91bmRpbmcgYm94ZXMgb2YgdHdvIGJvZGllcyBhcmUgaW50ZXJzZWN0aW5nLgogICAgICovCgoKICAgIGRvQm91bmRpbmdCb3hCcm9hZHBoYXNlKGJvZHlBLCBib2R5QiwgcGFpcnMxLCBwYWlyczIpIHsKICAgICAgaWYgKGJvZHlBLmFhYmJOZWVkc1VwZGF0ZSkgewogICAgICAgIGJvZHlBLnVwZGF0ZUFBQkIoKTsKICAgICAgfQoKICAgICAgaWYgKGJvZHlCLmFhYmJOZWVkc1VwZGF0ZSkgewogICAgICAgIGJvZHlCLnVwZGF0ZUFBQkIoKTsKICAgICAgfSAvLyBDaGVjayBBQUJCIC8gQUFCQgoKCiAgICAgIGlmIChib2R5QS5hYWJiLm92ZXJsYXBzKGJvZHlCLmFhYmIpKSB7CiAgICAgICAgcGFpcnMxLnB1c2goYm9keUEpOwogICAgICAgIHBhaXJzMi5wdXNoKGJvZHlCKTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBSZW1vdmVzIGR1cGxpY2F0ZSBwYWlycyBmcm9tIHRoZSBwYWlyIGFycmF5cy4KICAgICAqLwoKCiAgICBtYWtlUGFpcnNVbmlxdWUocGFpcnMxLCBwYWlyczIpIHsKICAgICAgY29uc3QgdCA9IEJyb2FkcGhhc2VfbWFrZVBhaXJzVW5pcXVlX3RlbXA7CiAgICAgIGNvbnN0IHAxID0gQnJvYWRwaGFzZV9tYWtlUGFpcnNVbmlxdWVfcDE7CiAgICAgIGNvbnN0IHAyID0gQnJvYWRwaGFzZV9tYWtlUGFpcnNVbmlxdWVfcDI7CiAgICAgIGNvbnN0IE4gPSBwYWlyczEubGVuZ3RoOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IE47IGkrKykgewogICAgICAgIHAxW2ldID0gcGFpcnMxW2ldOwogICAgICAgIHAyW2ldID0gcGFpcnMyW2ldOwogICAgICB9CgogICAgICBwYWlyczEubGVuZ3RoID0gMDsKICAgICAgcGFpcnMyLmxlbmd0aCA9IDA7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gTjsgaSsrKSB7CiAgICAgICAgY29uc3QgaWQxID0gcDFbaV0uaWQ7CiAgICAgICAgY29uc3QgaWQyID0gcDJbaV0uaWQ7CiAgICAgICAgY29uc3Qga2V5ID0gaWQxIDwgaWQyID8gYCR7aWQxfSwke2lkMn1gIDogYCR7aWQyfSwke2lkMX1gOwogICAgICAgIHRba2V5XSA9IGk7CiAgICAgICAgdC5rZXlzLnB1c2goa2V5KTsKICAgICAgfQoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IHQua2V5cy5sZW5ndGg7IGkrKykgewogICAgICAgIGNvbnN0IGtleSA9IHQua2V5cy5wb3AoKTsKICAgICAgICBjb25zdCBwYWlySW5kZXggPSB0W2tleV07CiAgICAgICAgcGFpcnMxLnB1c2gocDFbcGFpckluZGV4XSk7CiAgICAgICAgcGFpcnMyLnB1c2gocDJbcGFpckluZGV4XSk7CiAgICAgICAgZGVsZXRlIHRba2V5XTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBUbyBiZSBpbXBsZW1lbnRlZCBieSBzdWJjYXNzZXMKICAgICAqLwoKCiAgICBzZXRXb3JsZCh3b3JsZCkge30KICAgIC8qKgogICAgICogQ2hlY2sgaWYgdGhlIGJvdW5kaW5nIHNwaGVyZXMgb2YgdHdvIGJvZGllcyBvdmVybGFwLgogICAgICovCgoKICAgIHN0YXRpYyBib3VuZGluZ1NwaGVyZUNoZWNrKGJvZHlBLCBib2R5QikgewogICAgICBjb25zdCBkaXN0ID0gbmV3IFZlYzMoKTsgLy8gYnNjX2Rpc3Q7CgogICAgICBib2R5QS5wb3NpdGlvbi52c3ViKGJvZHlCLnBvc2l0aW9uLCBkaXN0KTsKICAgICAgY29uc3Qgc2EgPSBib2R5QS5zaGFwZXNbMF07CiAgICAgIGNvbnN0IHNiID0gYm9keUIuc2hhcGVzWzBdOwogICAgICByZXR1cm4gTWF0aC5wb3coc2EuYm91bmRpbmdTcGhlcmVSYWRpdXMgKyBzYi5ib3VuZGluZ1NwaGVyZVJhZGl1cywgMikgPiBkaXN0Lmxlbmd0aFNxdWFyZWQoKTsKICAgIH0KICAgIC8qKgogICAgICogUmV0dXJucyBhbGwgdGhlIGJvZGllcyB3aXRoaW4gdGhlIEFBQkIuCiAgICAgKi8KCgogICAgYWFiYlF1ZXJ5KHdvcmxkLCBhYWJiLCByZXN1bHQpIHsKICAgICAgY29uc29sZS53YXJuKCcuYWFiYlF1ZXJ5IGlzIG5vdCBpbXBsZW1lbnRlZCBpbiB0aGlzIEJyb2FkcGhhc2Ugc3ViY2xhc3MuJyk7CiAgICAgIHJldHVybiBbXTsKICAgIH0KCiAgfSAvLyBUZW1wIG9iamVjdHMKCiAgY29uc3QgQnJvYWRwaGFzZV9jb2xsaXNpb25QYWlyc19yID0gbmV3IFZlYzMoKTsKICBuZXcgVmVjMygpOwogIG5ldyBRdWF0ZXJuaW9uKCk7CiAgbmV3IFZlYzMoKTsKICBjb25zdCBCcm9hZHBoYXNlX21ha2VQYWlyc1VuaXF1ZV90ZW1wID0gewogICAga2V5czogW10KICB9OwogIGNvbnN0IEJyb2FkcGhhc2VfbWFrZVBhaXJzVW5pcXVlX3AxID0gW107CiAgY29uc3QgQnJvYWRwaGFzZV9tYWtlUGFpcnNVbmlxdWVfcDIgPSBbXTsKICBuZXcgVmVjMygpOwogIG5ldyBWZWMzKCk7CiAgbmV3IFZlYzMoKTsKCiAgLyoqCiAgICogTmFpdmUgYnJvYWRwaGFzZSBpbXBsZW1lbnRhdGlvbiwgdXNlZCBpbiBsYWNrIG9mIGJldHRlciBvbmVzLgogICAqCiAgICogVGhlIG5haXZlIGJyb2FkcGhhc2UgbG9va3MgYXQgYWxsIHBvc3NpYmxlIHBhaXJzIHdpdGhvdXQgcmVzdHJpY3Rpb24sIHRoZXJlZm9yZSBpdCBoYXMgY29tcGxleGl0eSBOXjIgXyh3aGljaCBpcyBiYWQpXwogICAqLwogIGNsYXNzIE5haXZlQnJvYWRwaGFzZSBleHRlbmRzIEJyb2FkcGhhc2UgewogICAgLyoqCiAgICAgKiBAdG9kbyBSZW1vdmUgdXNlbGVzcyBjb25zdHJ1Y3RvcgogICAgICovCiAgICBjb25zdHJ1Y3RvcigpIHsKICAgICAgc3VwZXIoKTsKICAgIH0KICAgIC8qKgogICAgICogR2V0IGFsbCB0aGUgY29sbGlzaW9uIHBhaXJzIGluIHRoZSBwaHlzaWNzIHdvcmxkCiAgICAgKi8KCgogICAgY29sbGlzaW9uUGFpcnMod29ybGQsIHBhaXJzMSwgcGFpcnMyKSB7CiAgICAgIGNvbnN0IGJvZGllcyA9IHdvcmxkLmJvZGllczsKICAgICAgY29uc3QgbiA9IGJvZGllcy5sZW5ndGg7CiAgICAgIGxldCBiaTsKICAgICAgbGV0IGJqOyAvLyBOYWl2ZSBOXjIgZnR3IQoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IG47IGkrKykgewogICAgICAgIGZvciAobGV0IGogPSAwOyBqICE9PSBpOyBqKyspIHsKICAgICAgICAgIGJpID0gYm9kaWVzW2ldOwogICAgICAgICAgYmogPSBib2RpZXNbal07CgogICAgICAgICAgaWYgKCF0aGlzLm5lZWRCcm9hZHBoYXNlQ29sbGlzaW9uKGJpLCBiaikpIHsKICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICB9CgogICAgICAgICAgdGhpcy5pbnRlcnNlY3Rpb25UZXN0KGJpLCBiaiwgcGFpcnMxLCBwYWlyczIpOwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBSZXR1cm5zIGFsbCB0aGUgYm9kaWVzIHdpdGhpbiBhbiBBQUJCLgogICAgICogQHBhcmFtIHJlc3VsdCBBbiBhcnJheSB0byBzdG9yZSByZXN1bHRpbmcgYm9kaWVzIGluLgogICAgICovCgoKICAgIGFhYmJRdWVyeSh3b3JsZCwgYWFiYiwgcmVzdWx0KSB7CiAgICAgIGlmIChyZXN1bHQgPT09IHZvaWQgMCkgewogICAgICAgIHJlc3VsdCA9IFtdOwogICAgICB9CgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHdvcmxkLmJvZGllcy5sZW5ndGg7IGkrKykgewogICAgICAgIGNvbnN0IGIgPSB3b3JsZC5ib2RpZXNbaV07CgogICAgICAgIGlmIChiLmFhYmJOZWVkc1VwZGF0ZSkgewogICAgICAgICAgYi51cGRhdGVBQUJCKCk7CiAgICAgICAgfSAvLyBVZ2x5IGhhY2sgdW50aWwgQm9keSBnZXRzIGFhYmIKCgogICAgICAgIGlmIChiLmFhYmIub3ZlcmxhcHMoYWFiYikpIHsKICAgICAgICAgIHJlc3VsdC5wdXNoKGIpOwogICAgICAgIH0KICAgICAgfQoKICAgICAgcmV0dXJuIHJlc3VsdDsKICAgIH0KCiAgfQoKICAvKioKICAgKiBTdG9yYWdlIGZvciBSYXkgY2FzdGluZyBkYXRhCiAgICovCiAgY2xhc3MgUmF5Y2FzdFJlc3VsdCB7CiAgICAvKioKICAgICAqIHJheUZyb21Xb3JsZAogICAgICovCgogICAgLyoqCiAgICAgKiByYXlUb1dvcmxkCiAgICAgKi8KCiAgICAvKioKICAgICAqIGhpdE5vcm1hbFdvcmxkCiAgICAgKi8KCiAgICAvKioKICAgICAqIGhpdFBvaW50V29ybGQKICAgICAqLwoKICAgIC8qKgogICAgICogaGFzSGl0CiAgICAgKi8KCiAgICAvKioKICAgICAqIHNoYXBlCiAgICAgKi8KCiAgICAvKioKICAgICAqIGJvZHkKICAgICAqLwoKICAgIC8qKgogICAgICogVGhlIGluZGV4IG9mIHRoZSBoaXQgdHJpYW5nbGUsIGlmIHRoZSBoaXQgc2hhcGUgd2FzIGEgdHJpbWVzaAogICAgICovCgogICAgLyoqCiAgICAgKiBEaXN0YW5jZSB0byB0aGUgaGl0LiBXaWxsIGJlIHNldCB0byAtMSBpZiB0aGVyZSB3YXMgbm8gaGl0CiAgICAgKi8KCiAgICAvKioKICAgICAqIElmIHRoZSByYXkgc2hvdWxkIHN0b3AgdHJhdmVyc2luZyB0aGUgYm9kaWVzCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKCkgewogICAgICB0aGlzLnJheUZyb21Xb3JsZCA9IG5ldyBWZWMzKCk7CiAgICAgIHRoaXMucmF5VG9Xb3JsZCA9IG5ldyBWZWMzKCk7CiAgICAgIHRoaXMuaGl0Tm9ybWFsV29ybGQgPSBuZXcgVmVjMygpOwogICAgICB0aGlzLmhpdFBvaW50V29ybGQgPSBuZXcgVmVjMygpOwogICAgICB0aGlzLmhhc0hpdCA9IGZhbHNlOwogICAgICB0aGlzLnNoYXBlID0gbnVsbDsKICAgICAgdGhpcy5ib2R5ID0gbnVsbDsKICAgICAgdGhpcy5oaXRGYWNlSW5kZXggPSAtMTsKICAgICAgdGhpcy5kaXN0YW5jZSA9IC0xOwogICAgICB0aGlzLnNob3VsZFN0b3AgPSBmYWxzZTsKICAgIH0KICAgIC8qKgogICAgICogUmVzZXQgYWxsIHJlc3VsdCBkYXRhLgogICAgICovCgoKICAgIHJlc2V0KCkgewogICAgICB0aGlzLnJheUZyb21Xb3JsZC5zZXRaZXJvKCk7CiAgICAgIHRoaXMucmF5VG9Xb3JsZC5zZXRaZXJvKCk7CiAgICAgIHRoaXMuaGl0Tm9ybWFsV29ybGQuc2V0WmVybygpOwogICAgICB0aGlzLmhpdFBvaW50V29ybGQuc2V0WmVybygpOwogICAgICB0aGlzLmhhc0hpdCA9IGZhbHNlOwogICAgICB0aGlzLnNoYXBlID0gbnVsbDsKICAgICAgdGhpcy5ib2R5ID0gbnVsbDsKICAgICAgdGhpcy5oaXRGYWNlSW5kZXggPSAtMTsKICAgICAgdGhpcy5kaXN0YW5jZSA9IC0xOwogICAgICB0aGlzLnNob3VsZFN0b3AgPSBmYWxzZTsKICAgIH0KICAgIC8qKgogICAgICogYWJvcnQKICAgICAqLwoKCiAgICBhYm9ydCgpIHsKICAgICAgdGhpcy5zaG91bGRTdG9wID0gdHJ1ZTsKICAgIH0KICAgIC8qKgogICAgICogU2V0IHJlc3VsdCBkYXRhLgogICAgICovCgoKICAgIHNldChyYXlGcm9tV29ybGQsIHJheVRvV29ybGQsIGhpdE5vcm1hbFdvcmxkLCBoaXRQb2ludFdvcmxkLCBzaGFwZSwgYm9keSwgZGlzdGFuY2UpIHsKICAgICAgdGhpcy5yYXlGcm9tV29ybGQuY29weShyYXlGcm9tV29ybGQpOwogICAgICB0aGlzLnJheVRvV29ybGQuY29weShyYXlUb1dvcmxkKTsKICAgICAgdGhpcy5oaXROb3JtYWxXb3JsZC5jb3B5KGhpdE5vcm1hbFdvcmxkKTsKICAgICAgdGhpcy5oaXRQb2ludFdvcmxkLmNvcHkoaGl0UG9pbnRXb3JsZCk7CiAgICAgIHRoaXMuc2hhcGUgPSBzaGFwZTsKICAgICAgdGhpcy5ib2R5ID0gYm9keTsKICAgICAgdGhpcy5kaXN0YW5jZSA9IGRpc3RhbmNlOwogICAgfQoKICB9CgogIGxldCBfU2hhcGUkdHlwZXMkU1BIRVJFLCBfU2hhcGUkdHlwZXMkUExBTkUsIF9TaGFwZSR0eXBlcyRCT1gsIF9TaGFwZSR0eXBlcyRDWUxJTkRFUiwgX1NoYXBlJHR5cGVzJENPTlZFWFBPLCBfU2hhcGUkdHlwZXMkSEVJR0hURkksIF9TaGFwZSR0eXBlcyRUUklNRVNIOwoKICAvKioKICAgKiBSQVlfTU9ERVMKICAgKi8KICBjb25zdCBSQVlfTU9ERVMgPSB7CiAgICAvKiogQ0xPU0VTVCAqLwogICAgQ0xPU0VTVDogMSwKCiAgICAvKiogQU5ZICovCiAgICBBTlk6IDIsCgogICAgLyoqIEFMTCAqLwogICAgQUxMOiA0CiAgfTsKICAvKioKICAgKiBSYXlNb2RlCiAgICovCgogIF9TaGFwZSR0eXBlcyRTUEhFUkUgPSBTaGFwZS50eXBlcy5TUEhFUkU7CiAgX1NoYXBlJHR5cGVzJFBMQU5FID0gU2hhcGUudHlwZXMuUExBTkU7CiAgX1NoYXBlJHR5cGVzJEJPWCA9IFNoYXBlLnR5cGVzLkJPWDsKICBfU2hhcGUkdHlwZXMkQ1lMSU5ERVIgPSBTaGFwZS50eXBlcy5DWUxJTkRFUjsKICBfU2hhcGUkdHlwZXMkQ09OVkVYUE8gPSBTaGFwZS50eXBlcy5DT05WRVhQT0xZSEVEUk9OOwogIF9TaGFwZSR0eXBlcyRIRUlHSFRGSSA9IFNoYXBlLnR5cGVzLkhFSUdIVEZJRUxEOwogIF9TaGFwZSR0eXBlcyRUUklNRVNIID0gU2hhcGUudHlwZXMuVFJJTUVTSDsKCiAgLyoqCiAgICogQSBsaW5lIGluIDNEIHNwYWNlIHRoYXQgaW50ZXJzZWN0cyBib2RpZXMgYW5kIHJldHVybiBwb2ludHMuCiAgICovCiAgY2xhc3MgUmF5IHsKICAgIC8qKgogICAgICogZnJvbQogICAgICovCgogICAgLyoqCiAgICAgKiB0bwogICAgICovCgogICAgLyoqCiAgICAgKiBkaXJlY3Rpb24KICAgICAqLwoKICAgIC8qKgogICAgICogVGhlIHByZWNpc2lvbiBvZiB0aGUgcmF5LiBVc2VkIHdoZW4gY2hlY2tpbmcgcGFyYWxsZWxpdHkgZXRjLgogICAgICogQGRlZmF1bHQgMC4wMDAxCiAgICAgKi8KCiAgICAvKioKICAgICAqIFNldCB0byBgZmFsc2VgIGlmIHlvdSBkb24ndCB3YW50IHRoZSBSYXkgdG8gdGFrZSBgY29sbGlzaW9uUmVzcG9uc2VgIGZsYWdzIGludG8gYWNjb3VudCBvbiBib2RpZXMgYW5kIHNoYXBlcy4KICAgICAqIEBkZWZhdWx0IHRydWUKICAgICAqLwoKICAgIC8qKgogICAgICogSWYgc2V0IHRvIGB0cnVlYCwgdGhlIHJheSBza2lwcyBhbnkgaGl0cyB3aXRoIG5vcm1hbC5kb3QocmF5RGlyZWN0aW9uKSA8IDAuCiAgICAgKiBAZGVmYXVsdCBmYWxzZQogICAgICovCgogICAgLyoqCiAgICAgKiBjb2xsaXNpb25GaWx0ZXJNYXNrCiAgICAgKiBAZGVmYXVsdCAtMQogICAgICovCgogICAgLyoqCiAgICAgKiBjb2xsaXNpb25GaWx0ZXJHcm91cAogICAgICogQGRlZmF1bHQgLTEKICAgICAqLwoKICAgIC8qKgogICAgICogVGhlIGludGVyc2VjdGlvbiBtb2RlLiBTaG91bGQgYmUgUmF5LkFOWSwgUmF5LkFMTCBvciBSYXkuQ0xPU0VTVC4KICAgICAqIEBkZWZhdWx0IFJBWS5BTlkKICAgICAqLwoKICAgIC8qKgogICAgICogQ3VycmVudCByZXN1bHQgb2JqZWN0LgogICAgICovCgogICAgLyoqCiAgICAgKiBXaWxsIGJlIHNldCB0byBgdHJ1ZWAgZHVyaW5nIGludGVyc2VjdFdvcmxkKCkgaWYgdGhlIHJheSBoaXQgYW55dGhpbmcuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFVzZXItcHJvdmlkZWQgcmVzdWx0IGNhbGxiYWNrLiBXaWxsIGJlIHVzZWQgaWYgbW9kZSBpcyBSYXkuQUxMLgogICAgICovCgogICAgLyoqCiAgICAgKiBDTE9TRVNUCiAgICAgKi8KCiAgICAvKioKICAgICAqIEFOWQogICAgICovCgogICAgLyoqCiAgICAgKiBBTEwKICAgICAqLwogICAgZ2V0IFtfU2hhcGUkdHlwZXMkU1BIRVJFXSgpIHsKICAgICAgcmV0dXJuIHRoaXMuX2ludGVyc2VjdFNwaGVyZTsKICAgIH0KCiAgICBnZXQgW19TaGFwZSR0eXBlcyRQTEFORV0oKSB7CiAgICAgIHJldHVybiB0aGlzLl9pbnRlcnNlY3RQbGFuZTsKICAgIH0KCiAgICBnZXQgW19TaGFwZSR0eXBlcyRCT1hdKCkgewogICAgICByZXR1cm4gdGhpcy5faW50ZXJzZWN0Qm94OwogICAgfQoKICAgIGdldCBbX1NoYXBlJHR5cGVzJENZTElOREVSXSgpIHsKICAgICAgcmV0dXJuIHRoaXMuX2ludGVyc2VjdENvbnZleDsKICAgIH0KCiAgICBnZXQgW19TaGFwZSR0eXBlcyRDT05WRVhQT10oKSB7CiAgICAgIHJldHVybiB0aGlzLl9pbnRlcnNlY3RDb252ZXg7CiAgICB9CgogICAgZ2V0IFtfU2hhcGUkdHlwZXMkSEVJR0hURkldKCkgewogICAgICByZXR1cm4gdGhpcy5faW50ZXJzZWN0SGVpZ2h0ZmllbGQ7CiAgICB9CgogICAgZ2V0IFtfU2hhcGUkdHlwZXMkVFJJTUVTSF0oKSB7CiAgICAgIHJldHVybiB0aGlzLl9pbnRlcnNlY3RUcmltZXNoOwogICAgfQoKICAgIGNvbnN0cnVjdG9yKGZyb20sIHRvKSB7CiAgICAgIGlmIChmcm9tID09PSB2b2lkIDApIHsKICAgICAgICBmcm9tID0gbmV3IFZlYzMoKTsKICAgICAgfQoKICAgICAgaWYgKHRvID09PSB2b2lkIDApIHsKICAgICAgICB0byA9IG5ldyBWZWMzKCk7CiAgICAgIH0KCiAgICAgIHRoaXMuZnJvbSA9IGZyb20uY2xvbmUoKTsKICAgICAgdGhpcy50byA9IHRvLmNsb25lKCk7CiAgICAgIHRoaXMuZGlyZWN0aW9uID0gbmV3IFZlYzMoKTsKICAgICAgdGhpcy5wcmVjaXNpb24gPSAwLjAwMDE7CiAgICAgIHRoaXMuY2hlY2tDb2xsaXNpb25SZXNwb25zZSA9IHRydWU7CiAgICAgIHRoaXMuc2tpcEJhY2tmYWNlcyA9IGZhbHNlOwogICAgICB0aGlzLmNvbGxpc2lvbkZpbHRlck1hc2sgPSAtMTsKICAgICAgdGhpcy5jb2xsaXNpb25GaWx0ZXJHcm91cCA9IC0xOwogICAgICB0aGlzLm1vZGUgPSBSYXkuQU5ZOwogICAgICB0aGlzLnJlc3VsdCA9IG5ldyBSYXljYXN0UmVzdWx0KCk7CiAgICAgIHRoaXMuaGFzSGl0ID0gZmFsc2U7CgogICAgICB0aGlzLmNhbGxiYWNrID0gcmVzdWx0ID0+IHt9OwogICAgfQogICAgLyoqCiAgICAgKiBEbyBpdGVyc2VjdGlvbiBhZ2FpbnN0IGFsbCBib2RpZXMgaW4gdGhlIGdpdmVuIFdvcmxkLgogICAgICogQHJldHVybiBUcnVlIGlmIHRoZSByYXkgaGl0IGFueXRoaW5nLCBvdGhlcndpc2UgZmFsc2UuCiAgICAgKi8KCgogICAgaW50ZXJzZWN0V29ybGQod29ybGQsIG9wdGlvbnMpIHsKICAgICAgdGhpcy5tb2RlID0gb3B0aW9ucy5tb2RlIHx8IFJheS5BTlk7CiAgICAgIHRoaXMucmVzdWx0ID0gb3B0aW9ucy5yZXN1bHQgfHwgbmV3IFJheWNhc3RSZXN1bHQoKTsKICAgICAgdGhpcy5za2lwQmFja2ZhY2VzID0gISFvcHRpb25zLnNraXBCYWNrZmFjZXM7CiAgICAgIHRoaXMuY29sbGlzaW9uRmlsdGVyTWFzayA9IHR5cGVvZiBvcHRpb25zLmNvbGxpc2lvbkZpbHRlck1hc2sgIT09ICd1bmRlZmluZWQnID8gb3B0aW9ucy5jb2xsaXNpb25GaWx0ZXJNYXNrIDogLTE7CiAgICAgIHRoaXMuY29sbGlzaW9uRmlsdGVyR3JvdXAgPSB0eXBlb2Ygb3B0aW9ucy5jb2xsaXNpb25GaWx0ZXJHcm91cCAhPT0gJ3VuZGVmaW5lZCcgPyBvcHRpb25zLmNvbGxpc2lvbkZpbHRlckdyb3VwIDogLTE7CiAgICAgIHRoaXMuY2hlY2tDb2xsaXNpb25SZXNwb25zZSA9IHR5cGVvZiBvcHRpb25zLmNoZWNrQ29sbGlzaW9uUmVzcG9uc2UgIT09ICd1bmRlZmluZWQnID8gb3B0aW9ucy5jaGVja0NvbGxpc2lvblJlc3BvbnNlIDogdHJ1ZTsKCiAgICAgIGlmIChvcHRpb25zLmZyb20pIHsKICAgICAgICB0aGlzLmZyb20uY29weShvcHRpb25zLmZyb20pOwogICAgICB9CgogICAgICBpZiAob3B0aW9ucy50bykgewogICAgICAgIHRoaXMudG8uY29weShvcHRpb25zLnRvKTsKICAgICAgfQoKICAgICAgdGhpcy5jYWxsYmFjayA9IG9wdGlvbnMuY2FsbGJhY2sgfHwgKCgpID0+IHt9KTsKCiAgICAgIHRoaXMuaGFzSGl0ID0gZmFsc2U7CiAgICAgIHRoaXMucmVzdWx0LnJlc2V0KCk7CiAgICAgIHRoaXMudXBkYXRlRGlyZWN0aW9uKCk7CiAgICAgIHRoaXMuZ2V0QUFCQih0bXBBQUJCJDEpOwogICAgICB0bXBBcnJheS5sZW5ndGggPSAwOwogICAgICB3b3JsZC5icm9hZHBoYXNlLmFhYmJRdWVyeSh3b3JsZCwgdG1wQUFCQiQxLCB0bXBBcnJheSk7CiAgICAgIHRoaXMuaW50ZXJzZWN0Qm9kaWVzKHRtcEFycmF5KTsKICAgICAgcmV0dXJuIHRoaXMuaGFzSGl0OwogICAgfQogICAgLyoqCiAgICAgKiBTaG9vdCBhIHJheSBhdCBhIGJvZHksIGdldCBiYWNrIGluZm9ybWF0aW9uIGFib3V0IHRoZSBoaXQuCiAgICAgKiBAZGVwcmVjYXRlZCBAcGFyYW0gcmVzdWx0IHNldCB0aGUgcmVzdWx0IHByb3BlcnR5IG9mIHRoZSBSYXkgaW5zdGVhZC4KICAgICAqLwoKCiAgICBpbnRlcnNlY3RCb2R5KGJvZHksIHJlc3VsdCkgewogICAgICBpZiAocmVzdWx0KSB7CiAgICAgICAgdGhpcy5yZXN1bHQgPSByZXN1bHQ7CiAgICAgICAgdGhpcy51cGRhdGVEaXJlY3Rpb24oKTsKICAgICAgfQoKICAgICAgY29uc3QgY2hlY2tDb2xsaXNpb25SZXNwb25zZSA9IHRoaXMuY2hlY2tDb2xsaXNpb25SZXNwb25zZTsKCiAgICAgIGlmIChjaGVja0NvbGxpc2lvblJlc3BvbnNlICYmICFib2R5LmNvbGxpc2lvblJlc3BvbnNlKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICBpZiAoKHRoaXMuY29sbGlzaW9uRmlsdGVyR3JvdXAgJiBib2R5LmNvbGxpc2lvbkZpbHRlck1hc2spID09PSAwIHx8IChib2R5LmNvbGxpc2lvbkZpbHRlckdyb3VwICYgdGhpcy5jb2xsaXNpb25GaWx0ZXJNYXNrKSA9PT0gMCkgewogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgY29uc3QgeGkgPSBpbnRlcnNlY3RCb2R5X3hpOwogICAgICBjb25zdCBxaSA9IGludGVyc2VjdEJvZHlfcWk7CgogICAgICBmb3IgKGxldCBpID0gMCwgTiA9IGJvZHkuc2hhcGVzLmxlbmd0aDsgaSA8IE47IGkrKykgewogICAgICAgIGNvbnN0IHNoYXBlID0gYm9keS5zaGFwZXNbaV07CgogICAgICAgIGlmIChjaGVja0NvbGxpc2lvblJlc3BvbnNlICYmICFzaGFwZS5jb2xsaXNpb25SZXNwb25zZSkgewogICAgICAgICAgY29udGludWU7IC8vIFNraXAKICAgICAgICB9CgogICAgICAgIGJvZHkucXVhdGVybmlvbi5tdWx0KGJvZHkuc2hhcGVPcmllbnRhdGlvbnNbaV0sIHFpKTsKICAgICAgICBib2R5LnF1YXRlcm5pb24udm11bHQoYm9keS5zaGFwZU9mZnNldHNbaV0sIHhpKTsKICAgICAgICB4aS52YWRkKGJvZHkucG9zaXRpb24sIHhpKTsKICAgICAgICB0aGlzLmludGVyc2VjdFNoYXBlKHNoYXBlLCBxaSwgeGksIGJvZHkpOwoKICAgICAgICBpZiAodGhpcy5yZXN1bHQuc2hvdWxkU3RvcCkgewogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIFNob290IGEgcmF5IGF0IGFuIGFycmF5IGJvZGllcywgZ2V0IGJhY2sgaW5mb3JtYXRpb24gYWJvdXQgdGhlIGhpdC4KICAgICAqIEBwYXJhbSBib2RpZXMgQW4gYXJyYXkgb2YgQm9keSBvYmplY3RzLgogICAgICogQGRlcHJlY2F0ZWQgQHBhcmFtIHJlc3VsdCBzZXQgdGhlIHJlc3VsdCBwcm9wZXJ0eSBvZiB0aGUgUmF5IGluc3RlYWQuCiAgICAgKgogICAgICovCgoKICAgIGludGVyc2VjdEJvZGllcyhib2RpZXMsIHJlc3VsdCkgewogICAgICBpZiAocmVzdWx0KSB7CiAgICAgICAgdGhpcy5yZXN1bHQgPSByZXN1bHQ7CiAgICAgICAgdGhpcy51cGRhdGVEaXJlY3Rpb24oKTsKICAgICAgfQoKICAgICAgZm9yIChsZXQgaSA9IDAsIGwgPSBib2RpZXMubGVuZ3RoOyAhdGhpcy5yZXN1bHQuc2hvdWxkU3RvcCAmJiBpIDwgbDsgaSsrKSB7CiAgICAgICAgdGhpcy5pbnRlcnNlY3RCb2R5KGJvZGllc1tpXSk7CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogVXBkYXRlcyB0aGUgZGlyZWN0aW9uIHZlY3Rvci4KICAgICAqLwoKCiAgICB1cGRhdGVEaXJlY3Rpb24oKSB7CiAgICAgIHRoaXMudG8udnN1Yih0aGlzLmZyb20sIHRoaXMuZGlyZWN0aW9uKTsKICAgICAgdGhpcy5kaXJlY3Rpb24ubm9ybWFsaXplKCk7CiAgICB9CgogICAgaW50ZXJzZWN0U2hhcGUoc2hhcGUsIHF1YXQsIHBvc2l0aW9uLCBib2R5KSB7CiAgICAgIGNvbnN0IGZyb20gPSB0aGlzLmZyb207IC8vIENoZWNraW5nIGJvdW5kaW5nU3BoZXJlCgogICAgICBjb25zdCBkaXN0YW5jZSA9IGRpc3RhbmNlRnJvbUludGVyc2VjdGlvbihmcm9tLCB0aGlzLmRpcmVjdGlvbiwgcG9zaXRpb24pOwoKICAgICAgaWYgKGRpc3RhbmNlID4gc2hhcGUuYm91bmRpbmdTcGhlcmVSYWRpdXMpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGNvbnN0IGludGVyc2VjdE1ldGhvZCA9IHRoaXNbc2hhcGUudHlwZV07CgogICAgICBpZiAoaW50ZXJzZWN0TWV0aG9kKSB7CiAgICAgICAgaW50ZXJzZWN0TWV0aG9kLmNhbGwodGhpcywgc2hhcGUsIHF1YXQsIHBvc2l0aW9uLCBib2R5LCBzaGFwZSk7CiAgICAgIH0KICAgIH0KCiAgICBfaW50ZXJzZWN0Qm94KGJveCwgcXVhdCwgcG9zaXRpb24sIGJvZHksIHJlcG9ydGVkU2hhcGUpIHsKICAgICAgcmV0dXJuIHRoaXMuX2ludGVyc2VjdENvbnZleChib3guY29udmV4UG9seWhlZHJvblJlcHJlc2VudGF0aW9uLCBxdWF0LCBwb3NpdGlvbiwgYm9keSwgcmVwb3J0ZWRTaGFwZSk7CiAgICB9CgogICAgX2ludGVyc2VjdFBsYW5lKHNoYXBlLCBxdWF0LCBwb3NpdGlvbiwgYm9keSwgcmVwb3J0ZWRTaGFwZSkgewogICAgICBjb25zdCBmcm9tID0gdGhpcy5mcm9tOwogICAgICBjb25zdCB0byA9IHRoaXMudG87CiAgICAgIGNvbnN0IGRpcmVjdGlvbiA9IHRoaXMuZGlyZWN0aW9uOyAvLyBHZXQgcGxhbmUgbm9ybWFsCgogICAgICBjb25zdCB3b3JsZE5vcm1hbCA9IG5ldyBWZWMzKDAsIDAsIDEpOwogICAgICBxdWF0LnZtdWx0KHdvcmxkTm9ybWFsLCB3b3JsZE5vcm1hbCk7CiAgICAgIGNvbnN0IGxlbiA9IG5ldyBWZWMzKCk7CiAgICAgIGZyb20udnN1Yihwb3NpdGlvbiwgbGVuKTsKICAgICAgY29uc3QgcGxhbmVUb0Zyb20gPSBsZW4uZG90KHdvcmxkTm9ybWFsKTsKICAgICAgdG8udnN1Yihwb3NpdGlvbiwgbGVuKTsKICAgICAgY29uc3QgcGxhbmVUb1RvID0gbGVuLmRvdCh3b3JsZE5vcm1hbCk7CgogICAgICBpZiAocGxhbmVUb0Zyb20gKiBwbGFuZVRvVG8gPiAwKSB7CiAgICAgICAgLy8gImZyb20iIGFuZCAidG8iIGFyZSBvbiB0aGUgc2FtZSBzaWRlIG9mIHRoZSBwbGFuZS4uLiBiYWlsIG91dAogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgaWYgKGZyb20uZGlzdGFuY2VUbyh0bykgPCBwbGFuZVRvRnJvbSkgewogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgY29uc3Qgbl9kb3RfZGlyID0gd29ybGROb3JtYWwuZG90KGRpcmVjdGlvbik7CgogICAgICBpZiAoTWF0aC5hYnMobl9kb3RfZGlyKSA8IHRoaXMucHJlY2lzaW9uKSB7CiAgICAgICAgLy8gTm8gaW50ZXJzZWN0aW9uCiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICBjb25zdCBwbGFuZVBvaW50VG9Gcm9tID0gbmV3IFZlYzMoKTsKICAgICAgY29uc3QgZGlyX3NjYWxlZF93aXRoX3QgPSBuZXcgVmVjMygpOwogICAgICBjb25zdCBoaXRQb2ludFdvcmxkID0gbmV3IFZlYzMoKTsKICAgICAgZnJvbS52c3ViKHBvc2l0aW9uLCBwbGFuZVBvaW50VG9Gcm9tKTsKICAgICAgY29uc3QgdCA9IC13b3JsZE5vcm1hbC5kb3QocGxhbmVQb2ludFRvRnJvbSkgLyBuX2RvdF9kaXI7CiAgICAgIGRpcmVjdGlvbi5zY2FsZSh0LCBkaXJfc2NhbGVkX3dpdGhfdCk7CiAgICAgIGZyb20udmFkZChkaXJfc2NhbGVkX3dpdGhfdCwgaGl0UG9pbnRXb3JsZCk7CiAgICAgIHRoaXMucmVwb3J0SW50ZXJzZWN0aW9uKHdvcmxkTm9ybWFsLCBoaXRQb2ludFdvcmxkLCByZXBvcnRlZFNoYXBlLCBib2R5LCAtMSk7CiAgICB9CiAgICAvKioKICAgICAqIEdldCB0aGUgd29ybGQgQUFCQiBvZiB0aGUgcmF5LgogICAgICovCgoKICAgIGdldEFBQkIoYWFiYikgewogICAgICBjb25zdCB7CiAgICAgICAgbG93ZXJCb3VuZCwKICAgICAgICB1cHBlckJvdW5kCiAgICAgIH0gPSBhYWJiOwogICAgICBjb25zdCB0byA9IHRoaXMudG87CiAgICAgIGNvbnN0IGZyb20gPSB0aGlzLmZyb207CiAgICAgIGxvd2VyQm91bmQueCA9IE1hdGgubWluKHRvLngsIGZyb20ueCk7CiAgICAgIGxvd2VyQm91bmQueSA9IE1hdGgubWluKHRvLnksIGZyb20ueSk7CiAgICAgIGxvd2VyQm91bmQueiA9IE1hdGgubWluKHRvLnosIGZyb20ueik7CiAgICAgIHVwcGVyQm91bmQueCA9IE1hdGgubWF4KHRvLngsIGZyb20ueCk7CiAgICAgIHVwcGVyQm91bmQueSA9IE1hdGgubWF4KHRvLnksIGZyb20ueSk7CiAgICAgIHVwcGVyQm91bmQueiA9IE1hdGgubWF4KHRvLnosIGZyb20ueik7CiAgICB9CgogICAgX2ludGVyc2VjdEhlaWdodGZpZWxkKHNoYXBlLCBxdWF0LCBwb3NpdGlvbiwgYm9keSwgcmVwb3J0ZWRTaGFwZSkgewogICAgICBzaGFwZS5kYXRhOwogICAgICBzaGFwZS5lbGVtZW50U2l6ZTsgLy8gQ29udmVydCB0aGUgcmF5IHRvIGxvY2FsIGhlaWdodGZpZWxkIGNvb3JkaW5hdGVzCgogICAgICBjb25zdCBsb2NhbFJheSA9IGludGVyc2VjdEhlaWdodGZpZWxkX2xvY2FsUmF5OyAvL25ldyBSYXkodGhpcy5mcm9tLCB0aGlzLnRvKTsKCiAgICAgIGxvY2FsUmF5LmZyb20uY29weSh0aGlzLmZyb20pOwogICAgICBsb2NhbFJheS50by5jb3B5KHRoaXMudG8pOwogICAgICBUcmFuc2Zvcm0ucG9pbnRUb0xvY2FsRnJhbWUocG9zaXRpb24sIHF1YXQsIGxvY2FsUmF5LmZyb20sIGxvY2FsUmF5LmZyb20pOwogICAgICBUcmFuc2Zvcm0ucG9pbnRUb0xvY2FsRnJhbWUocG9zaXRpb24sIHF1YXQsIGxvY2FsUmF5LnRvLCBsb2NhbFJheS50byk7CiAgICAgIGxvY2FsUmF5LnVwZGF0ZURpcmVjdGlvbigpOyAvLyBHZXQgdGhlIGluZGV4IG9mIHRoZSBkYXRhIHBvaW50cyB0byB0ZXN0IGFnYWluc3QKCiAgICAgIGNvbnN0IGluZGV4ID0gaW50ZXJzZWN0SGVpZ2h0ZmllbGRfaW5kZXg7CiAgICAgIGxldCBpTWluWDsKICAgICAgbGV0IGlNaW5ZOwogICAgICBsZXQgaU1heFg7CiAgICAgIGxldCBpTWF4WTsgLy8gU2V0IHRvIG1heAoKICAgICAgaU1pblggPSBpTWluWSA9IDA7CiAgICAgIGlNYXhYID0gaU1heFkgPSBzaGFwZS5kYXRhLmxlbmd0aCAtIDE7CiAgICAgIGNvbnN0IGFhYmIgPSBuZXcgQUFCQigpOwogICAgICBsb2NhbFJheS5nZXRBQUJCKGFhYmIpOwogICAgICBzaGFwZS5nZXRJbmRleE9mUG9zaXRpb24oYWFiYi5sb3dlckJvdW5kLngsIGFhYmIubG93ZXJCb3VuZC55LCBpbmRleCwgdHJ1ZSk7CiAgICAgIGlNaW5YID0gTWF0aC5tYXgoaU1pblgsIGluZGV4WzBdKTsKICAgICAgaU1pblkgPSBNYXRoLm1heChpTWluWSwgaW5kZXhbMV0pOwogICAgICBzaGFwZS5nZXRJbmRleE9mUG9zaXRpb24oYWFiYi51cHBlckJvdW5kLngsIGFhYmIudXBwZXJCb3VuZC55LCBpbmRleCwgdHJ1ZSk7CiAgICAgIGlNYXhYID0gTWF0aC5taW4oaU1heFgsIGluZGV4WzBdICsgMSk7CiAgICAgIGlNYXhZID0gTWF0aC5taW4oaU1heFksIGluZGV4WzFdICsgMSk7CgogICAgICBmb3IgKGxldCBpID0gaU1pblg7IGkgPCBpTWF4WDsgaSsrKSB7CiAgICAgICAgZm9yIChsZXQgaiA9IGlNaW5ZOyBqIDwgaU1heFk7IGorKykgewogICAgICAgICAgaWYgKHRoaXMucmVzdWx0LnNob3VsZFN0b3ApIHsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgfQoKICAgICAgICAgIHNoYXBlLmdldEFhYmJBdEluZGV4KGksIGosIGFhYmIpOwoKICAgICAgICAgIGlmICghYWFiYi5vdmVybGFwc1JheShsb2NhbFJheSkpIHsKICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICB9IC8vIExvd2VyIHRyaWFuZ2xlCgoKICAgICAgICAgIHNoYXBlLmdldENvbnZleFRyaWFuZ2xlUGlsbGFyKGksIGosIGZhbHNlKTsKICAgICAgICAgIFRyYW5zZm9ybS5wb2ludFRvV29ybGRGcmFtZShwb3NpdGlvbiwgcXVhdCwgc2hhcGUucGlsbGFyT2Zmc2V0LCB3b3JsZFBpbGxhck9mZnNldCk7CgogICAgICAgICAgdGhpcy5faW50ZXJzZWN0Q29udmV4KHNoYXBlLnBpbGxhckNvbnZleCwgcXVhdCwgd29ybGRQaWxsYXJPZmZzZXQsIGJvZHksIHJlcG9ydGVkU2hhcGUsIGludGVyc2VjdENvbnZleE9wdGlvbnMpOwoKICAgICAgICAgIGlmICh0aGlzLnJlc3VsdC5zaG91bGRTdG9wKSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgIH0gLy8gVXBwZXIgdHJpYW5nbGUKCgogICAgICAgICAgc2hhcGUuZ2V0Q29udmV4VHJpYW5nbGVQaWxsYXIoaSwgaiwgdHJ1ZSk7CiAgICAgICAgICBUcmFuc2Zvcm0ucG9pbnRUb1dvcmxkRnJhbWUocG9zaXRpb24sIHF1YXQsIHNoYXBlLnBpbGxhck9mZnNldCwgd29ybGRQaWxsYXJPZmZzZXQpOwoKICAgICAgICAgIHRoaXMuX2ludGVyc2VjdENvbnZleChzaGFwZS5waWxsYXJDb252ZXgsIHF1YXQsIHdvcmxkUGlsbGFyT2Zmc2V0LCBib2R5LCByZXBvcnRlZFNoYXBlLCBpbnRlcnNlY3RDb252ZXhPcHRpb25zKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KCiAgICBfaW50ZXJzZWN0U3BoZXJlKHNwaGVyZSwgcXVhdCwgcG9zaXRpb24sIGJvZHksIHJlcG9ydGVkU2hhcGUpIHsKICAgICAgY29uc3QgZnJvbSA9IHRoaXMuZnJvbTsKICAgICAgY29uc3QgdG8gPSB0aGlzLnRvOwogICAgICBjb25zdCByID0gc3BoZXJlLnJhZGl1czsKICAgICAgY29uc3QgYSA9ICh0by54IC0gZnJvbS54KSAqKiAyICsgKHRvLnkgLSBmcm9tLnkpICoqIDIgKyAodG8ueiAtIGZyb20ueikgKiogMjsKICAgICAgY29uc3QgYiA9IDIgKiAoKHRvLnggLSBmcm9tLngpICogKGZyb20ueCAtIHBvc2l0aW9uLngpICsgKHRvLnkgLSBmcm9tLnkpICogKGZyb20ueSAtIHBvc2l0aW9uLnkpICsgKHRvLnogLSBmcm9tLnopICogKGZyb20ueiAtIHBvc2l0aW9uLnopKTsKICAgICAgY29uc3QgYyA9IChmcm9tLnggLSBwb3NpdGlvbi54KSAqKiAyICsgKGZyb20ueSAtIHBvc2l0aW9uLnkpICoqIDIgKyAoZnJvbS56IC0gcG9zaXRpb24ueikgKiogMiAtIHIgKiogMjsKICAgICAgY29uc3QgZGVsdGEgPSBiICoqIDIgLSA0ICogYSAqIGM7CiAgICAgIGNvbnN0IGludGVyc2VjdGlvblBvaW50ID0gUmF5X2ludGVyc2VjdFNwaGVyZV9pbnRlcnNlY3Rpb25Qb2ludDsKICAgICAgY29uc3Qgbm9ybWFsID0gUmF5X2ludGVyc2VjdFNwaGVyZV9ub3JtYWw7CgogICAgICBpZiAoZGVsdGEgPCAwKSB7CiAgICAgICAgLy8gTm8gaW50ZXJzZWN0aW9uCiAgICAgICAgcmV0dXJuOwogICAgICB9IGVsc2UgaWYgKGRlbHRhID09PSAwKSB7CiAgICAgICAgLy8gc2luZ2xlIGludGVyc2VjdGlvbiBwb2ludAogICAgICAgIGZyb20ubGVycCh0bywgZGVsdGEsIGludGVyc2VjdGlvblBvaW50KTsKICAgICAgICBpbnRlcnNlY3Rpb25Qb2ludC52c3ViKHBvc2l0aW9uLCBub3JtYWwpOwogICAgICAgIG5vcm1hbC5ub3JtYWxpemUoKTsKICAgICAgICB0aGlzLnJlcG9ydEludGVyc2VjdGlvbihub3JtYWwsIGludGVyc2VjdGlvblBvaW50LCByZXBvcnRlZFNoYXBlLCBib2R5LCAtMSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgY29uc3QgZDEgPSAoLWIgLSBNYXRoLnNxcnQoZGVsdGEpKSAvICgyICogYSk7CiAgICAgICAgY29uc3QgZDIgPSAoLWIgKyBNYXRoLnNxcnQoZGVsdGEpKSAvICgyICogYSk7CgogICAgICAgIGlmIChkMSA+PSAwICYmIGQxIDw9IDEpIHsKICAgICAgICAgIGZyb20ubGVycCh0bywgZDEsIGludGVyc2VjdGlvblBvaW50KTsKICAgICAgICAgIGludGVyc2VjdGlvblBvaW50LnZzdWIocG9zaXRpb24sIG5vcm1hbCk7CiAgICAgICAgICBub3JtYWwubm9ybWFsaXplKCk7CiAgICAgICAgICB0aGlzLnJlcG9ydEludGVyc2VjdGlvbihub3JtYWwsIGludGVyc2VjdGlvblBvaW50LCByZXBvcnRlZFNoYXBlLCBib2R5LCAtMSk7CiAgICAgICAgfQoKICAgICAgICBpZiAodGhpcy5yZXN1bHQuc2hvdWxkU3RvcCkgewogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgaWYgKGQyID49IDAgJiYgZDIgPD0gMSkgewogICAgICAgICAgZnJvbS5sZXJwKHRvLCBkMiwgaW50ZXJzZWN0aW9uUG9pbnQpOwogICAgICAgICAgaW50ZXJzZWN0aW9uUG9pbnQudnN1Yihwb3NpdGlvbiwgbm9ybWFsKTsKICAgICAgICAgIG5vcm1hbC5ub3JtYWxpemUoKTsKICAgICAgICAgIHRoaXMucmVwb3J0SW50ZXJzZWN0aW9uKG5vcm1hbCwgaW50ZXJzZWN0aW9uUG9pbnQsIHJlcG9ydGVkU2hhcGUsIGJvZHksIC0xKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KCiAgICBfaW50ZXJzZWN0Q29udmV4KHNoYXBlLCBxdWF0LCBwb3NpdGlvbiwgYm9keSwgcmVwb3J0ZWRTaGFwZSwgb3B0aW9ucykgewogICAgICBjb25zdCBub3JtYWwgPSBpbnRlcnNlY3RDb252ZXhfbm9ybWFsOwogICAgICBjb25zdCB2ZWN0b3IgPSBpbnRlcnNlY3RDb252ZXhfdmVjdG9yOwogICAgICBjb25zdCBmYWNlTGlzdCA9IG9wdGlvbnMgJiYgb3B0aW9ucy5mYWNlTGlzdCB8fCBudWxsOyAvLyBDaGVja2luZyBmYWNlcwoKICAgICAgY29uc3QgZmFjZXMgPSBzaGFwZS5mYWNlczsKICAgICAgY29uc3QgdmVydGljZXMgPSBzaGFwZS52ZXJ0aWNlczsKICAgICAgY29uc3Qgbm9ybWFscyA9IHNoYXBlLmZhY2VOb3JtYWxzOwogICAgICBjb25zdCBkaXJlY3Rpb24gPSB0aGlzLmRpcmVjdGlvbjsKICAgICAgY29uc3QgZnJvbSA9IHRoaXMuZnJvbTsKICAgICAgY29uc3QgdG8gPSB0aGlzLnRvOwogICAgICBjb25zdCBmcm9tVG9EaXN0YW5jZSA9IGZyb20uZGlzdGFuY2VUbyh0byk7CiAgICAgIGNvbnN0IE5mYWNlcyA9IGZhY2VMaXN0ID8gZmFjZUxpc3QubGVuZ3RoIDogZmFjZXMubGVuZ3RoOwogICAgICBjb25zdCByZXN1bHQgPSB0aGlzLnJlc3VsdDsKCiAgICAgIGZvciAobGV0IGogPSAwOyAhcmVzdWx0LnNob3VsZFN0b3AgJiYgaiA8IE5mYWNlczsgaisrKSB7CiAgICAgICAgY29uc3QgZmkgPSBmYWNlTGlzdCA/IGZhY2VMaXN0W2pdIDogajsKICAgICAgICBjb25zdCBmYWNlID0gZmFjZXNbZmldOwogICAgICAgIGNvbnN0IGZhY2VOb3JtYWwgPSBub3JtYWxzW2ZpXTsKICAgICAgICBjb25zdCBxID0gcXVhdDsKICAgICAgICBjb25zdCB4ID0gcG9zaXRpb247IC8vIGRldGVybWluZSBpZiByYXkgaW50ZXJzZWN0cyB0aGUgcGxhbmUgb2YgdGhlIGZhY2UKICAgICAgICAvLyBub3RlOiB0aGlzIHdvcmtzIHJlZ2FyZGxlc3Mgb2YgdGhlIGRpcmVjdGlvbiBvZiB0aGUgZmFjZSBub3JtYWwKICAgICAgICAvLyBHZXQgcGxhbmUgcG9pbnQgaW4gd29ybGQgY29vcmRpbmF0ZXMuLi4KCiAgICAgICAgdmVjdG9yLmNvcHkodmVydGljZXNbZmFjZVswXV0pOwogICAgICAgIHEudm11bHQodmVjdG9yLCB2ZWN0b3IpOwogICAgICAgIHZlY3Rvci52YWRkKHgsIHZlY3Rvcik7IC8vIC4uLmJ1dCBtYWtlIGl0IHJlbGF0aXZlIHRvIHRoZSByYXkgZnJvbS4gV2UnbGwgZml4IHRoaXMgbGF0ZXIuCgogICAgICAgIHZlY3Rvci52c3ViKGZyb20sIHZlY3Rvcik7IC8vIEdldCBwbGFuZSBub3JtYWwKCiAgICAgICAgcS52bXVsdChmYWNlTm9ybWFsLCBub3JtYWwpOyAvLyBJZiB0aGlzIGRvdCBwcm9kdWN0IGlzIG5lZ2F0aXZlLCB3ZSBoYXZlIHNvbWV0aGluZyBpbnRlcmVzdGluZwoKICAgICAgICBjb25zdCBkb3QgPSBkaXJlY3Rpb24uZG90KG5vcm1hbCk7IC8vIEJhaWwgb3V0IGlmIHJheSBhbmQgcGxhbmUgYXJlIHBhcmFsbGVsCgogICAgICAgIGlmIChNYXRoLmFicyhkb3QpIDwgdGhpcy5wcmVjaXNpb24pIHsKICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgIH0gLy8gY2FsYyBkaXN0YW5jZSB0byBwbGFuZQoKCiAgICAgICAgY29uc3Qgc2NhbGFyID0gbm9ybWFsLmRvdCh2ZWN0b3IpIC8gZG90OyAvLyBpZiBuZWdhdGl2ZSBkaXN0YW5jZSwgdGhlbiBwbGFuZSBpcyBiZWhpbmQgcmF5CgogICAgICAgIGlmIChzY2FsYXIgPCAwKSB7CiAgICAgICAgICBjb250aW51ZTsKICAgICAgICB9IC8vIGlmIChkb3QgPCAwKSB7CiAgICAgICAgLy8gSW50ZXJzZWN0aW9uIHBvaW50IGlzIGZyb20gKyBkaXJlY3Rpb24gKiBzY2FsYXIKCgogICAgICAgIGRpcmVjdGlvbi5zY2FsZShzY2FsYXIsIGludGVyc2VjdFBvaW50KTsKICAgICAgICBpbnRlcnNlY3RQb2ludC52YWRkKGZyb20sIGludGVyc2VjdFBvaW50KTsgLy8gYSBpcyB0aGUgcG9pbnQgd2UgY29tcGFyZSBwb2ludHMgYiBhbmQgYyB3aXRoLgoKICAgICAgICBhLmNvcHkodmVydGljZXNbZmFjZVswXV0pOwogICAgICAgIHEudm11bHQoYSwgYSk7CiAgICAgICAgeC52YWRkKGEsIGEpOwoKICAgICAgICBmb3IgKGxldCBpID0gMTsgIXJlc3VsdC5zaG91bGRTdG9wICYmIGkgPCBmYWNlLmxlbmd0aCAtIDE7IGkrKykgewogICAgICAgICAgLy8gVHJhbnNmb3JtIDMgdmVydGljZXMgdG8gd29ybGQgY29vcmRzCiAgICAgICAgICBiLmNvcHkodmVydGljZXNbZmFjZVtpXV0pOwogICAgICAgICAgYy5jb3B5KHZlcnRpY2VzW2ZhY2VbaSArIDFdXSk7CiAgICAgICAgICBxLnZtdWx0KGIsIGIpOwogICAgICAgICAgcS52bXVsdChjLCBjKTsKICAgICAgICAgIHgudmFkZChiLCBiKTsKICAgICAgICAgIHgudmFkZChjLCBjKTsKICAgICAgICAgIGNvbnN0IGRpc3RhbmNlID0gaW50ZXJzZWN0UG9pbnQuZGlzdGFuY2VUbyhmcm9tKTsKCiAgICAgICAgICBpZiAoIShSYXkucG9pbnRJblRyaWFuZ2xlKGludGVyc2VjdFBvaW50LCBhLCBiLCBjKSB8fCBSYXkucG9pbnRJblRyaWFuZ2xlKGludGVyc2VjdFBvaW50LCBiLCBhLCBjKSkgfHwgZGlzdGFuY2UgPiBmcm9tVG9EaXN0YW5jZSkgewogICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgIH0KCiAgICAgICAgICB0aGlzLnJlcG9ydEludGVyc2VjdGlvbihub3JtYWwsIGludGVyc2VjdFBvaW50LCByZXBvcnRlZFNoYXBlLCBib2R5LCBmaSk7CiAgICAgICAgfSAvLyB9CgogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIEB0b2RvIE9wdGltaXplIGJ5IHRyYW5zZm9ybWluZyB0aGUgd29ybGQgdG8gbG9jYWwgc3BhY2UgZmlyc3QuCiAgICAgKiBAdG9kbyBVc2UgT2N0cmVlIGxvb2t1cAogICAgICovCgoKICAgIF9pbnRlcnNlY3RUcmltZXNoKG1lc2gsIHF1YXQsIHBvc2l0aW9uLCBib2R5LCByZXBvcnRlZFNoYXBlLCBvcHRpb25zKSB7CiAgICAgIGNvbnN0IG5vcm1hbCA9IGludGVyc2VjdFRyaW1lc2hfbm9ybWFsOwogICAgICBjb25zdCB0cmlhbmdsZXMgPSBpbnRlcnNlY3RUcmltZXNoX3RyaWFuZ2xlczsKICAgICAgY29uc3QgdHJlZVRyYW5zZm9ybSA9IGludGVyc2VjdFRyaW1lc2hfdHJlZVRyYW5zZm9ybTsKICAgICAgY29uc3QgdmVjdG9yID0gaW50ZXJzZWN0Q29udmV4X3ZlY3RvcjsKICAgICAgY29uc3QgbG9jYWxEaXJlY3Rpb24gPSBpbnRlcnNlY3RUcmltZXNoX2xvY2FsRGlyZWN0aW9uOwogICAgICBjb25zdCBsb2NhbEZyb20gPSBpbnRlcnNlY3RUcmltZXNoX2xvY2FsRnJvbTsKICAgICAgY29uc3QgbG9jYWxUbyA9IGludGVyc2VjdFRyaW1lc2hfbG9jYWxUbzsKICAgICAgY29uc3Qgd29ybGRJbnRlcnNlY3RQb2ludCA9IGludGVyc2VjdFRyaW1lc2hfd29ybGRJbnRlcnNlY3RQb2ludDsKICAgICAgY29uc3Qgd29ybGROb3JtYWwgPSBpbnRlcnNlY3RUcmltZXNoX3dvcmxkTm9ybWFsOyAvLyBDaGVja2luZyBmYWNlcwoKICAgICAgY29uc3QgaW5kaWNlcyA9IG1lc2guaW5kaWNlczsKICAgICAgbWVzaC52ZXJ0aWNlczsgLy8gY29uc3Qgbm9ybWFscyA9IG1lc2guZmFjZU5vcm1hbHMKCiAgICAgIGNvbnN0IGZyb20gPSB0aGlzLmZyb207CiAgICAgIGNvbnN0IHRvID0gdGhpcy50bzsKICAgICAgY29uc3QgZGlyZWN0aW9uID0gdGhpcy5kaXJlY3Rpb247CiAgICAgIHRyZWVUcmFuc2Zvcm0ucG9zaXRpb24uY29weShwb3NpdGlvbik7CiAgICAgIHRyZWVUcmFuc2Zvcm0ucXVhdGVybmlvbi5jb3B5KHF1YXQpOyAvLyBUcmFuc2Zvcm0gcmF5IHRvIGxvY2FsIHNwYWNlIQoKICAgICAgVHJhbnNmb3JtLnZlY3RvclRvTG9jYWxGcmFtZShwb3NpdGlvbiwgcXVhdCwgZGlyZWN0aW9uLCBsb2NhbERpcmVjdGlvbik7CiAgICAgIFRyYW5zZm9ybS5wb2ludFRvTG9jYWxGcmFtZShwb3NpdGlvbiwgcXVhdCwgZnJvbSwgbG9jYWxGcm9tKTsKICAgICAgVHJhbnNmb3JtLnBvaW50VG9Mb2NhbEZyYW1lKHBvc2l0aW9uLCBxdWF0LCB0bywgbG9jYWxUbyk7CiAgICAgIGxvY2FsVG8ueCAqPSBtZXNoLnNjYWxlLng7CiAgICAgIGxvY2FsVG8ueSAqPSBtZXNoLnNjYWxlLnk7CiAgICAgIGxvY2FsVG8ueiAqPSBtZXNoLnNjYWxlLno7CiAgICAgIGxvY2FsRnJvbS54ICo9IG1lc2guc2NhbGUueDsKICAgICAgbG9jYWxGcm9tLnkgKj0gbWVzaC5zY2FsZS55OwogICAgICBsb2NhbEZyb20ueiAqPSBtZXNoLnNjYWxlLno7CiAgICAgIGxvY2FsVG8udnN1Yihsb2NhbEZyb20sIGxvY2FsRGlyZWN0aW9uKTsKICAgICAgbG9jYWxEaXJlY3Rpb24ubm9ybWFsaXplKCk7CiAgICAgIGNvbnN0IGZyb21Ub0Rpc3RhbmNlU3F1YXJlZCA9IGxvY2FsRnJvbS5kaXN0YW5jZVNxdWFyZWQobG9jYWxUbyk7CiAgICAgIG1lc2gudHJlZS5yYXlRdWVyeSh0aGlzLCB0cmVlVHJhbnNmb3JtLCB0cmlhbmdsZXMpOwoKICAgICAgZm9yIChsZXQgaSA9IDAsIE4gPSB0cmlhbmdsZXMubGVuZ3RoOyAhdGhpcy5yZXN1bHQuc2hvdWxkU3RvcCAmJiBpICE9PSBOOyBpKyspIHsKICAgICAgICBjb25zdCB0cmlhbmdsZXNJbmRleCA9IHRyaWFuZ2xlc1tpXTsKICAgICAgICBtZXNoLmdldE5vcm1hbCh0cmlhbmdsZXNJbmRleCwgbm9ybWFsKTsgLy8gZGV0ZXJtaW5lIGlmIHJheSBpbnRlcnNlY3RzIHRoZSBwbGFuZSBvZiB0aGUgZmFjZQogICAgICAgIC8vIG5vdGU6IHRoaXMgd29ya3MgcmVnYXJkbGVzcyBvZiB0aGUgZGlyZWN0aW9uIG9mIHRoZSBmYWNlIG5vcm1hbAogICAgICAgIC8vIEdldCBwbGFuZSBwb2ludCBpbiB3b3JsZCBjb29yZGluYXRlcy4uLgoKICAgICAgICBtZXNoLmdldFZlcnRleChpbmRpY2VzW3RyaWFuZ2xlc0luZGV4ICogM10sIGEpOyAvLyAuLi5idXQgbWFrZSBpdCByZWxhdGl2ZSB0byB0aGUgcmF5IGZyb20uIFdlJ2xsIGZpeCB0aGlzIGxhdGVyLgoKICAgICAgICBhLnZzdWIobG9jYWxGcm9tLCB2ZWN0b3IpOyAvLyBJZiB0aGlzIGRvdCBwcm9kdWN0IGlzIG5lZ2F0aXZlLCB3ZSBoYXZlIHNvbWV0aGluZyBpbnRlcmVzdGluZwoKICAgICAgICBjb25zdCBkb3QgPSBsb2NhbERpcmVjdGlvbi5kb3Qobm9ybWFsKTsgLy8gQmFpbCBvdXQgaWYgcmF5IGFuZCBwbGFuZSBhcmUgcGFyYWxsZWwKICAgICAgICAvLyBpZiAoTWF0aC5hYnMoIGRvdCApIDwgdGhpcy5wcmVjaXNpb24pewogICAgICAgIC8vICAgICBjb250aW51ZTsKICAgICAgICAvLyB9CiAgICAgICAgLy8gY2FsYyBkaXN0YW5jZSB0byBwbGFuZQoKICAgICAgICBjb25zdCBzY2FsYXIgPSBub3JtYWwuZG90KHZlY3RvcikgLyBkb3Q7IC8vIGlmIG5lZ2F0aXZlIGRpc3RhbmNlLCB0aGVuIHBsYW5lIGlzIGJlaGluZCByYXkKCiAgICAgICAgaWYgKHNjYWxhciA8IDApIHsKICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgIH0gLy8gSW50ZXJzZWN0aW9uIHBvaW50IGlzIGZyb20gKyBkaXJlY3Rpb24gKiBzY2FsYXIKCgogICAgICAgIGxvY2FsRGlyZWN0aW9uLnNjYWxlKHNjYWxhciwgaW50ZXJzZWN0UG9pbnQpOwogICAgICAgIGludGVyc2VjdFBvaW50LnZhZGQobG9jYWxGcm9tLCBpbnRlcnNlY3RQb2ludCk7IC8vIEdldCB0cmlhbmdsZSB2ZXJ0aWNlcwoKICAgICAgICBtZXNoLmdldFZlcnRleChpbmRpY2VzW3RyaWFuZ2xlc0luZGV4ICogMyArIDFdLCBiKTsKICAgICAgICBtZXNoLmdldFZlcnRleChpbmRpY2VzW3RyaWFuZ2xlc0luZGV4ICogMyArIDJdLCBjKTsKICAgICAgICBjb25zdCBzcXVhcmVkRGlzdGFuY2UgPSBpbnRlcnNlY3RQb2ludC5kaXN0YW5jZVNxdWFyZWQobG9jYWxGcm9tKTsKCiAgICAgICAgaWYgKCEoUmF5LnBvaW50SW5UcmlhbmdsZShpbnRlcnNlY3RQb2ludCwgYiwgYSwgYykgfHwgUmF5LnBvaW50SW5UcmlhbmdsZShpbnRlcnNlY3RQb2ludCwgYSwgYiwgYykpIHx8IHNxdWFyZWREaXN0YW5jZSA+IGZyb21Ub0Rpc3RhbmNlU3F1YXJlZCkgewogICAgICAgICAgY29udGludWU7CiAgICAgICAgfSAvLyB0cmFuc2Zvcm0gaW50ZXJzZWN0cG9pbnQgYW5kIG5vcm1hbCB0byB3b3JsZAoKCiAgICAgICAgVHJhbnNmb3JtLnZlY3RvclRvV29ybGRGcmFtZShxdWF0LCBub3JtYWwsIHdvcmxkTm9ybWFsKTsKICAgICAgICBUcmFuc2Zvcm0ucG9pbnRUb1dvcmxkRnJhbWUocG9zaXRpb24sIHF1YXQsIGludGVyc2VjdFBvaW50LCB3b3JsZEludGVyc2VjdFBvaW50KTsKICAgICAgICB0aGlzLnJlcG9ydEludGVyc2VjdGlvbih3b3JsZE5vcm1hbCwgd29ybGRJbnRlcnNlY3RQb2ludCwgcmVwb3J0ZWRTaGFwZSwgYm9keSwgdHJpYW5nbGVzSW5kZXgpOwogICAgICB9CgogICAgICB0cmlhbmdsZXMubGVuZ3RoID0gMDsKICAgIH0KICAgIC8qKgogICAgICogQHJldHVybiBUcnVlIGlmIHRoZSBpbnRlcnNlY3Rpb25zIHNob3VsZCBjb250aW51ZQogICAgICovCgoKICAgIHJlcG9ydEludGVyc2VjdGlvbihub3JtYWwsIGhpdFBvaW50V29ybGQsIHNoYXBlLCBib2R5LCBoaXRGYWNlSW5kZXgpIHsKICAgICAgY29uc3QgZnJvbSA9IHRoaXMuZnJvbTsKICAgICAgY29uc3QgdG8gPSB0aGlzLnRvOwogICAgICBjb25zdCBkaXN0YW5jZSA9IGZyb20uZGlzdGFuY2VUbyhoaXRQb2ludFdvcmxkKTsKICAgICAgY29uc3QgcmVzdWx0ID0gdGhpcy5yZXN1bHQ7IC8vIFNraXAgYmFjayBmYWNlcz8KCiAgICAgIGlmICh0aGlzLnNraXBCYWNrZmFjZXMgJiYgbm9ybWFsLmRvdCh0aGlzLmRpcmVjdGlvbikgPiAwKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICByZXN1bHQuaGl0RmFjZUluZGV4ID0gdHlwZW9mIGhpdEZhY2VJbmRleCAhPT0gJ3VuZGVmaW5lZCcgPyBoaXRGYWNlSW5kZXggOiAtMTsKCiAgICAgIHN3aXRjaCAodGhpcy5tb2RlKSB7CiAgICAgICAgY2FzZSBSYXkuQUxMOgogICAgICAgICAgdGhpcy5oYXNIaXQgPSB0cnVlOwogICAgICAgICAgcmVzdWx0LnNldChmcm9tLCB0bywgbm9ybWFsLCBoaXRQb2ludFdvcmxkLCBzaGFwZSwgYm9keSwgZGlzdGFuY2UpOwogICAgICAgICAgcmVzdWx0Lmhhc0hpdCA9IHRydWU7CiAgICAgICAgICB0aGlzLmNhbGxiYWNrKHJlc3VsdCk7CiAgICAgICAgICBicmVhazsKCiAgICAgICAgY2FzZSBSYXkuQ0xPU0VTVDoKICAgICAgICAgIC8vIFN0b3JlIGlmIGNsb3NlciB0aGFuIGN1cnJlbnQgY2xvc2VzdAogICAgICAgICAgaWYgKGRpc3RhbmNlIDwgcmVzdWx0LmRpc3RhbmNlIHx8ICFyZXN1bHQuaGFzSGl0KSB7CiAgICAgICAgICAgIHRoaXMuaGFzSGl0ID0gdHJ1ZTsKICAgICAgICAgICAgcmVzdWx0Lmhhc0hpdCA9IHRydWU7CiAgICAgICAgICAgIHJlc3VsdC5zZXQoZnJvbSwgdG8sIG5vcm1hbCwgaGl0UG9pbnRXb3JsZCwgc2hhcGUsIGJvZHksIGRpc3RhbmNlKTsKICAgICAgICAgIH0KCiAgICAgICAgICBicmVhazsKCiAgICAgICAgY2FzZSBSYXkuQU5ZOgogICAgICAgICAgLy8gUmVwb3J0IGFuZCBzdG9wLgogICAgICAgICAgdGhpcy5oYXNIaXQgPSB0cnVlOwogICAgICAgICAgcmVzdWx0Lmhhc0hpdCA9IHRydWU7CiAgICAgICAgICByZXN1bHQuc2V0KGZyb20sIHRvLCBub3JtYWwsIGhpdFBvaW50V29ybGQsIHNoYXBlLCBib2R5LCBkaXN0YW5jZSk7CiAgICAgICAgICByZXN1bHQuc2hvdWxkU3RvcCA9IHRydWU7CiAgICAgICAgICBicmVhazsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBBcyBwZXIgIkJhcnljZW50cmljIFRlY2huaXF1ZSIgYXMgbmFtZWQKICAgICAqIHtAbGluayBodHRwczovL3d3dy5ibGFja3Bhd24uY29tL3RleHRzL3BvaW50aW5wb2x5L2RlZmF1bHQuaHRtbCBoZXJlfSBidXQgd2l0aG91dCB0aGUgZGl2aXNpb24KICAgICAqLwoKCiAgICBzdGF0aWMgcG9pbnRJblRyaWFuZ2xlKHAsIGEsIGIsIGMpIHsKICAgICAgYy52c3ViKGEsIHYwKTsKICAgICAgYi52c3ViKGEsIHYxKTsKICAgICAgcC52c3ViKGEsIHYyKTsKICAgICAgY29uc3QgZG90MDAgPSB2MC5kb3QodjApOwogICAgICBjb25zdCBkb3QwMSA9IHYwLmRvdCh2MSk7CiAgICAgIGNvbnN0IGRvdDAyID0gdjAuZG90KHYyKTsKICAgICAgY29uc3QgZG90MTEgPSB2MS5kb3QodjEpOwogICAgICBjb25zdCBkb3QxMiA9IHYxLmRvdCh2Mik7CiAgICAgIGxldCB1OwogICAgICBsZXQgdjsKICAgICAgcmV0dXJuICh1ID0gZG90MTEgKiBkb3QwMiAtIGRvdDAxICogZG90MTIpID49IDAgJiYgKHYgPSBkb3QwMCAqIGRvdDEyIC0gZG90MDEgKiBkb3QwMikgPj0gMCAmJiB1ICsgdiA8IGRvdDAwICogZG90MTEgLSBkb3QwMSAqIGRvdDAxOwogICAgfQoKICB9CiAgUmF5LkNMT1NFU1QgPSBSQVlfTU9ERVMuQ0xPU0VTVDsKICBSYXkuQU5ZID0gUkFZX01PREVTLkFOWTsKICBSYXkuQUxMID0gUkFZX01PREVTLkFMTDsKICBjb25zdCB0bXBBQUJCJDEgPSBuZXcgQUFCQigpOwogIGNvbnN0IHRtcEFycmF5ID0gW107CiAgY29uc3QgdjEgPSBuZXcgVmVjMygpOwogIGNvbnN0IHYyID0gbmV3IFZlYzMoKTsKICBjb25zdCBpbnRlcnNlY3RCb2R5X3hpID0gbmV3IFZlYzMoKTsKICBjb25zdCBpbnRlcnNlY3RCb2R5X3FpID0gbmV3IFF1YXRlcm5pb24oKTsKICBjb25zdCBpbnRlcnNlY3RQb2ludCA9IG5ldyBWZWMzKCk7CiAgY29uc3QgYSA9IG5ldyBWZWMzKCk7CiAgY29uc3QgYiA9IG5ldyBWZWMzKCk7CiAgY29uc3QgYyA9IG5ldyBWZWMzKCk7CiAgbmV3IFZlYzMoKTsKICBuZXcgUmF5Y2FzdFJlc3VsdCgpOwogIGNvbnN0IGludGVyc2VjdENvbnZleE9wdGlvbnMgPSB7CiAgICBmYWNlTGlzdDogWzBdCiAgfTsKICBjb25zdCB3b3JsZFBpbGxhck9mZnNldCA9IG5ldyBWZWMzKCk7CiAgY29uc3QgaW50ZXJzZWN0SGVpZ2h0ZmllbGRfbG9jYWxSYXkgPSBuZXcgUmF5KCk7CiAgY29uc3QgaW50ZXJzZWN0SGVpZ2h0ZmllbGRfaW5kZXggPSBbXTsKICBjb25zdCBSYXlfaW50ZXJzZWN0U3BoZXJlX2ludGVyc2VjdGlvblBvaW50ID0gbmV3IFZlYzMoKTsKICBjb25zdCBSYXlfaW50ZXJzZWN0U3BoZXJlX25vcm1hbCA9IG5ldyBWZWMzKCk7CiAgY29uc3QgaW50ZXJzZWN0Q29udmV4X25vcm1hbCA9IG5ldyBWZWMzKCk7CiAgbmV3IFZlYzMoKTsKICBuZXcgVmVjMygpOwogIGNvbnN0IGludGVyc2VjdENvbnZleF92ZWN0b3IgPSBuZXcgVmVjMygpOwogIGNvbnN0IGludGVyc2VjdFRyaW1lc2hfbm9ybWFsID0gbmV3IFZlYzMoKTsKICBjb25zdCBpbnRlcnNlY3RUcmltZXNoX2xvY2FsRGlyZWN0aW9uID0gbmV3IFZlYzMoKTsKICBjb25zdCBpbnRlcnNlY3RUcmltZXNoX2xvY2FsRnJvbSA9IG5ldyBWZWMzKCk7CiAgY29uc3QgaW50ZXJzZWN0VHJpbWVzaF9sb2NhbFRvID0gbmV3IFZlYzMoKTsKICBjb25zdCBpbnRlcnNlY3RUcmltZXNoX3dvcmxkTm9ybWFsID0gbmV3IFZlYzMoKTsKICBjb25zdCBpbnRlcnNlY3RUcmltZXNoX3dvcmxkSW50ZXJzZWN0UG9pbnQgPSBuZXcgVmVjMygpOwogIG5ldyBBQUJCKCk7CiAgY29uc3QgaW50ZXJzZWN0VHJpbWVzaF90cmlhbmdsZXMgPSBbXTsKICBjb25zdCBpbnRlcnNlY3RUcmltZXNoX3RyZWVUcmFuc2Zvcm0gPSBuZXcgVHJhbnNmb3JtKCk7CiAgY29uc3QgdjAgPSBuZXcgVmVjMygpOwogIGNvbnN0IGludGVyc2VjdCA9IG5ldyBWZWMzKCk7CgogIGZ1bmN0aW9uIGRpc3RhbmNlRnJvbUludGVyc2VjdGlvbihmcm9tLCBkaXJlY3Rpb24sIHBvc2l0aW9uKSB7CiAgICAvLyB2MCBpcyB2ZWN0b3IgZnJvbSBmcm9tIHRvIHBvc2l0aW9uCiAgICBwb3NpdGlvbi52c3ViKGZyb20sIHYwKTsKICAgIGNvbnN0IGRvdCA9IHYwLmRvdChkaXJlY3Rpb24pOyAvLyBpbnRlcnNlY3QgPSBkaXJlY3Rpb24qZG90ICsgZnJvbQoKICAgIGRpcmVjdGlvbi5zY2FsZShkb3QsIGludGVyc2VjdCk7CiAgICBpbnRlcnNlY3QudmFkZChmcm9tLCBpbnRlcnNlY3QpOwogICAgY29uc3QgZGlzdGFuY2UgPSBwb3NpdGlvbi5kaXN0YW5jZVRvKGludGVyc2VjdCk7CiAgICByZXR1cm4gZGlzdGFuY2U7CiAgfQoKICAvKioKICAgKiBTd2VlcCBhbmQgcHJ1bmUgYnJvYWRwaGFzZSBhbG9uZyBvbmUgYXhpcy4KICAgKi8KICBjbGFzcyBTQVBCcm9hZHBoYXNlIGV4dGVuZHMgQnJvYWRwaGFzZSB7CiAgICAvKioKICAgICAqIExpc3Qgb2YgYm9kaWVzIGN1cnJlbnRseSBpbiB0aGUgYnJvYWRwaGFzZS4KICAgICAqLwoKICAgIC8qKgogICAgICogVGhlIHdvcmxkIHRvIHNlYXJjaCBpbi4KICAgICAqLwoKICAgIC8qKgogICAgICogQXhpcyB0byBzb3J0IHRoZSBib2RpZXMgYWxvbmcuCiAgICAgKiBTZXQgdG8gMCBmb3IgeCBheGlzLCBhbmQgMSBmb3IgeSBheGlzLgogICAgICogRm9yIGJlc3QgcGVyZm9ybWFuY2UsIHBpY2sgdGhlIGF4aXMgd2hlcmUgYm9kaWVzIGFyZSBtb3N0IGRpc3RyaWJ1dGVkLgogICAgICovCgogICAgLyoqCiAgICAgKiBDaGVjayBpZiB0aGUgYm91bmRzIG9mIHR3byBib2RpZXMgb3ZlcmxhcCwgYWxvbmcgdGhlIGdpdmVuIFNBUCBheGlzLgogICAgICovCiAgICBzdGF0aWMgY2hlY2tCb3VuZHMoYmksIGJqLCBheGlzSW5kZXgpIHsKICAgICAgbGV0IGJpUG9zOwogICAgICBsZXQgYmpQb3M7CgogICAgICBpZiAoYXhpc0luZGV4ID09PSAwKSB7CiAgICAgICAgYmlQb3MgPSBiaS5wb3NpdGlvbi54OwogICAgICAgIGJqUG9zID0gYmoucG9zaXRpb24ueDsKICAgICAgfSBlbHNlIGlmIChheGlzSW5kZXggPT09IDEpIHsKICAgICAgICBiaVBvcyA9IGJpLnBvc2l0aW9uLnk7CiAgICAgICAgYmpQb3MgPSBiai5wb3NpdGlvbi55OwogICAgICB9IGVsc2UgaWYgKGF4aXNJbmRleCA9PT0gMikgewogICAgICAgIGJpUG9zID0gYmkucG9zaXRpb24uejsKICAgICAgICBialBvcyA9IGJqLnBvc2l0aW9uLno7CiAgICAgIH0KCiAgICAgIGNvbnN0IHJpID0gYmkuYm91bmRpbmdSYWRpdXMsCiAgICAgICAgICAgIHJqID0gYmouYm91bmRpbmdSYWRpdXMsCiAgICAgICAgICAgIGJvdW5kQTIgPSBiaVBvcyArIHJpLAogICAgICAgICAgICBib3VuZEIxID0gYmpQb3MgLSByajsKICAgICAgcmV0dXJuIGJvdW5kQjEgPCBib3VuZEEyOwogICAgfSAvLyBOb3RlOiB0aGVzZSBhcmUgaWRlbnRpY2FsLCBzYXZlIGZvciB4L3kveiBsb3dlcmJvdW5kCgogICAgLyoqCiAgICAgKiBpbnNlcnRpb25Tb3J0WAogICAgICovCgoKICAgIHN0YXRpYyBpbnNlcnRpb25Tb3J0WChhKSB7CiAgICAgIGZvciAobGV0IGkgPSAxLCBsID0gYS5sZW5ndGg7IGkgPCBsOyBpKyspIHsKICAgICAgICBjb25zdCB2ID0gYVtpXTsKICAgICAgICBsZXQgajsKCiAgICAgICAgZm9yIChqID0gaSAtIDE7IGogPj0gMDsgai0tKSB7CiAgICAgICAgICBpZiAoYVtqXS5hYWJiLmxvd2VyQm91bmQueCA8PSB2LmFhYmIubG93ZXJCb3VuZC54KSB7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgfQoKICAgICAgICAgIGFbaiArIDFdID0gYVtqXTsKICAgICAgICB9CgogICAgICAgIGFbaiArIDFdID0gdjsKICAgICAgfQoKICAgICAgcmV0dXJuIGE7CiAgICB9CiAgICAvKioKICAgICAqIGluc2VydGlvblNvcnRZCiAgICAgKi8KCgogICAgc3RhdGljIGluc2VydGlvblNvcnRZKGEpIHsKICAgICAgZm9yIChsZXQgaSA9IDEsIGwgPSBhLmxlbmd0aDsgaSA8IGw7IGkrKykgewogICAgICAgIGNvbnN0IHYgPSBhW2ldOwogICAgICAgIGxldCBqOwoKICAgICAgICBmb3IgKGogPSBpIC0gMTsgaiA+PSAwOyBqLS0pIHsKICAgICAgICAgIGlmIChhW2pdLmFhYmIubG93ZXJCb3VuZC55IDw9IHYuYWFiYi5sb3dlckJvdW5kLnkpIHsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CgogICAgICAgICAgYVtqICsgMV0gPSBhW2pdOwogICAgICAgIH0KCiAgICAgICAgYVtqICsgMV0gPSB2OwogICAgICB9CgogICAgICByZXR1cm4gYTsKICAgIH0KICAgIC8qKgogICAgICogaW5zZXJ0aW9uU29ydFoKICAgICAqLwoKCiAgICBzdGF0aWMgaW5zZXJ0aW9uU29ydFooYSkgewogICAgICBmb3IgKGxldCBpID0gMSwgbCA9IGEubGVuZ3RoOyBpIDwgbDsgaSsrKSB7CiAgICAgICAgY29uc3QgdiA9IGFbaV07CiAgICAgICAgbGV0IGo7CgogICAgICAgIGZvciAoaiA9IGkgLSAxOyBqID49IDA7IGotLSkgewogICAgICAgICAgaWYgKGFbal0uYWFiYi5sb3dlckJvdW5kLnogPD0gdi5hYWJiLmxvd2VyQm91bmQueikgewogICAgICAgICAgICBicmVhazsKICAgICAgICAgIH0KCiAgICAgICAgICBhW2ogKyAxXSA9IGFbal07CiAgICAgICAgfQoKICAgICAgICBhW2ogKyAxXSA9IHY7CiAgICAgIH0KCiAgICAgIHJldHVybiBhOwogICAgfQoKICAgIGNvbnN0cnVjdG9yKHdvcmxkKSB7CiAgICAgIHN1cGVyKCk7CiAgICAgIHRoaXMuYXhpc0xpc3QgPSBbXTsKICAgICAgdGhpcy53b3JsZCA9IG51bGw7CiAgICAgIHRoaXMuYXhpc0luZGV4ID0gMDsKICAgICAgY29uc3QgYXhpc0xpc3QgPSB0aGlzLmF4aXNMaXN0OwoKICAgICAgdGhpcy5fYWRkQm9keUhhbmRsZXIgPSBldmVudCA9PiB7CiAgICAgICAgYXhpc0xpc3QucHVzaChldmVudC5ib2R5KTsKICAgICAgfTsKCiAgICAgIHRoaXMuX3JlbW92ZUJvZHlIYW5kbGVyID0gZXZlbnQgPT4gewogICAgICAgIGNvbnN0IGlkeCA9IGF4aXNMaXN0LmluZGV4T2YoZXZlbnQuYm9keSk7CgogICAgICAgIGlmIChpZHggIT09IC0xKSB7CiAgICAgICAgICBheGlzTGlzdC5zcGxpY2UoaWR4LCAxKTsKICAgICAgICB9CiAgICAgIH07CgogICAgICBpZiAod29ybGQpIHsKICAgICAgICB0aGlzLnNldFdvcmxkKHdvcmxkKTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBDaGFuZ2UgdGhlIHdvcmxkCiAgICAgKi8KCgogICAgc2V0V29ybGQod29ybGQpIHsKICAgICAgLy8gQ2xlYXIgdGhlIG9sZCBheGlzIGFycmF5CiAgICAgIHRoaXMuYXhpc0xpc3QubGVuZ3RoID0gMDsgLy8gQWRkIGFsbCBib2RpZXMgZnJvbSB0aGUgbmV3IHdvcmxkCgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHdvcmxkLmJvZGllcy5sZW5ndGg7IGkrKykgewogICAgICAgIHRoaXMuYXhpc0xpc3QucHVzaCh3b3JsZC5ib2RpZXNbaV0pOwogICAgICB9IC8vIFJlbW92ZSBvbGQgaGFuZGxlcnMsIGlmIGFueQoKCiAgICAgIHdvcmxkLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2FkZEJvZHknLCB0aGlzLl9hZGRCb2R5SGFuZGxlcik7CiAgICAgIHdvcmxkLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ3JlbW92ZUJvZHknLCB0aGlzLl9yZW1vdmVCb2R5SGFuZGxlcik7IC8vIEFkZCBoYW5kbGVycyB0byB1cGRhdGUgdGhlIGxpc3Qgb2YgYm9kaWVzLgoKICAgICAgd29ybGQuYWRkRXZlbnRMaXN0ZW5lcignYWRkQm9keScsIHRoaXMuX2FkZEJvZHlIYW5kbGVyKTsKICAgICAgd29ybGQuYWRkRXZlbnRMaXN0ZW5lcigncmVtb3ZlQm9keScsIHRoaXMuX3JlbW92ZUJvZHlIYW5kbGVyKTsKICAgICAgdGhpcy53b3JsZCA9IHdvcmxkOwogICAgICB0aGlzLmRpcnR5ID0gdHJ1ZTsKICAgIH0KICAgIC8qKgogICAgICogQ29sbGVjdCBhbGwgY29sbGlzaW9uIHBhaXJzCiAgICAgKi8KCgogICAgY29sbGlzaW9uUGFpcnMod29ybGQsIHAxLCBwMikgewogICAgICBjb25zdCBib2RpZXMgPSB0aGlzLmF4aXNMaXN0OwogICAgICBjb25zdCBOID0gYm9kaWVzLmxlbmd0aDsKICAgICAgY29uc3QgYXhpc0luZGV4ID0gdGhpcy5heGlzSW5kZXg7CiAgICAgIGxldCBpOwogICAgICBsZXQgajsKCiAgICAgIGlmICh0aGlzLmRpcnR5KSB7CiAgICAgICAgdGhpcy5zb3J0TGlzdCgpOwogICAgICAgIHRoaXMuZGlydHkgPSBmYWxzZTsKICAgICAgfSAvLyBMb29rIHRocm91Z2ggdGhlIGxpc3QKCgogICAgICBmb3IgKGkgPSAwOyBpICE9PSBOOyBpKyspIHsKICAgICAgICBjb25zdCBiaSA9IGJvZGllc1tpXTsKCiAgICAgICAgZm9yIChqID0gaSArIDE7IGogPCBOOyBqKyspIHsKICAgICAgICAgIGNvbnN0IGJqID0gYm9kaWVzW2pdOwoKICAgICAgICAgIGlmICghdGhpcy5uZWVkQnJvYWRwaGFzZUNvbGxpc2lvbihiaSwgYmopKSB7CiAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgfQoKICAgICAgICAgIGlmICghU0FQQnJvYWRwaGFzZS5jaGVja0JvdW5kcyhiaSwgYmosIGF4aXNJbmRleCkpIHsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CgogICAgICAgICAgdGhpcy5pbnRlcnNlY3Rpb25UZXN0KGJpLCBiaiwgcDEsIHAyKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KCiAgICBzb3J0TGlzdCgpIHsKICAgICAgY29uc3QgYXhpc0xpc3QgPSB0aGlzLmF4aXNMaXN0OwogICAgICBjb25zdCBheGlzSW5kZXggPSB0aGlzLmF4aXNJbmRleDsKICAgICAgY29uc3QgTiA9IGF4aXNMaXN0Lmxlbmd0aDsgLy8gVXBkYXRlIEFBQkJzCgogICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gTjsgaSsrKSB7CiAgICAgICAgY29uc3QgYmkgPSBheGlzTGlzdFtpXTsKCiAgICAgICAgaWYgKGJpLmFhYmJOZWVkc1VwZGF0ZSkgewogICAgICAgICAgYmkudXBkYXRlQUFCQigpOwogICAgICAgIH0KICAgICAgfSAvLyBTb3J0IHRoZSBsaXN0CgoKICAgICAgaWYgKGF4aXNJbmRleCA9PT0gMCkgewogICAgICAgIFNBUEJyb2FkcGhhc2UuaW5zZXJ0aW9uU29ydFgoYXhpc0xpc3QpOwogICAgICB9IGVsc2UgaWYgKGF4aXNJbmRleCA9PT0gMSkgewogICAgICAgIFNBUEJyb2FkcGhhc2UuaW5zZXJ0aW9uU29ydFkoYXhpc0xpc3QpOwogICAgICB9IGVsc2UgaWYgKGF4aXNJbmRleCA9PT0gMikgewogICAgICAgIFNBUEJyb2FkcGhhc2UuaW5zZXJ0aW9uU29ydFooYXhpc0xpc3QpOwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIENvbXB1dGVzIHRoZSB2YXJpYW5jZSBvZiB0aGUgYm9keSBwb3NpdGlvbnMgYW5kIGVzdGltYXRlcyB0aGUgYmVzdCBheGlzIHRvIHVzZS4KICAgICAqIFdpbGwgYXV0b21hdGljYWxseSBzZXQgcHJvcGVydHkgYGF4aXNJbmRleGAuCiAgICAgKi8KCgogICAgYXV0b0RldGVjdEF4aXMoKSB7CiAgICAgIGxldCBzdW1YID0gMDsKICAgICAgbGV0IHN1bVgyID0gMDsKICAgICAgbGV0IHN1bVkgPSAwOwogICAgICBsZXQgc3VtWTIgPSAwOwogICAgICBsZXQgc3VtWiA9IDA7CiAgICAgIGxldCBzdW1aMiA9IDA7CiAgICAgIGNvbnN0IGJvZGllcyA9IHRoaXMuYXhpc0xpc3Q7CiAgICAgIGNvbnN0IE4gPSBib2RpZXMubGVuZ3RoOwogICAgICBjb25zdCBpbnZOID0gMSAvIE47CgogICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gTjsgaSsrKSB7CiAgICAgICAgY29uc3QgYiA9IGJvZGllc1tpXTsKICAgICAgICBjb25zdCBjZW50ZXJYID0gYi5wb3NpdGlvbi54OwogICAgICAgIHN1bVggKz0gY2VudGVyWDsKICAgICAgICBzdW1YMiArPSBjZW50ZXJYICogY2VudGVyWDsKICAgICAgICBjb25zdCBjZW50ZXJZID0gYi5wb3NpdGlvbi55OwogICAgICAgIHN1bVkgKz0gY2VudGVyWTsKICAgICAgICBzdW1ZMiArPSBjZW50ZXJZICogY2VudGVyWTsKICAgICAgICBjb25zdCBjZW50ZXJaID0gYi5wb3NpdGlvbi56OwogICAgICAgIHN1bVogKz0gY2VudGVyWjsKICAgICAgICBzdW1aMiArPSBjZW50ZXJaICogY2VudGVyWjsKICAgICAgfQoKICAgICAgY29uc3QgdmFyaWFuY2VYID0gc3VtWDIgLSBzdW1YICogc3VtWCAqIGludk47CiAgICAgIGNvbnN0IHZhcmlhbmNlWSA9IHN1bVkyIC0gc3VtWSAqIHN1bVkgKiBpbnZOOwogICAgICBjb25zdCB2YXJpYW5jZVogPSBzdW1aMiAtIHN1bVogKiBzdW1aICogaW52TjsKCiAgICAgIGlmICh2YXJpYW5jZVggPiB2YXJpYW5jZVkpIHsKICAgICAgICBpZiAodmFyaWFuY2VYID4gdmFyaWFuY2VaKSB7CiAgICAgICAgICB0aGlzLmF4aXNJbmRleCA9IDA7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHRoaXMuYXhpc0luZGV4ID0gMjsKICAgICAgICB9CiAgICAgIH0gZWxzZSBpZiAodmFyaWFuY2VZID4gdmFyaWFuY2VaKSB7CiAgICAgICAgdGhpcy5heGlzSW5kZXggPSAxOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuYXhpc0luZGV4ID0gMjsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBSZXR1cm5zIGFsbCB0aGUgYm9kaWVzIHdpdGhpbiBhbiBBQUJCLgogICAgICogQHBhcmFtIHJlc3VsdCBBbiBhcnJheSB0byBzdG9yZSByZXN1bHRpbmcgYm9kaWVzIGluLgogICAgICovCgoKICAgIGFhYmJRdWVyeSh3b3JsZCwgYWFiYiwgcmVzdWx0KSB7CiAgICAgIGlmIChyZXN1bHQgPT09IHZvaWQgMCkgewogICAgICAgIHJlc3VsdCA9IFtdOwogICAgICB9CgogICAgICBpZiAodGhpcy5kaXJ0eSkgewogICAgICAgIHRoaXMuc29ydExpc3QoKTsKICAgICAgICB0aGlzLmRpcnR5ID0gZmFsc2U7CiAgICAgIH0KCiAgICAgIGNvbnN0IGF4aXNJbmRleCA9IHRoaXMuYXhpc0luZGV4OwogICAgICBsZXQgYXhpcyA9ICd4JzsKCiAgICAgIGlmIChheGlzSW5kZXggPT09IDEpIHsKICAgICAgICBheGlzID0gJ3knOwogICAgICB9CgogICAgICBpZiAoYXhpc0luZGV4ID09PSAyKSB7CiAgICAgICAgYXhpcyA9ICd6JzsKICAgICAgfQoKICAgICAgY29uc3QgYXhpc0xpc3QgPSB0aGlzLmF4aXNMaXN0OwogICAgICBhYWJiLmxvd2VyQm91bmRbYXhpc107CiAgICAgIGFhYmIudXBwZXJCb3VuZFtheGlzXTsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgYXhpc0xpc3QubGVuZ3RoOyBpKyspIHsKICAgICAgICBjb25zdCBiID0gYXhpc0xpc3RbaV07CgogICAgICAgIGlmIChiLmFhYmJOZWVkc1VwZGF0ZSkgewogICAgICAgICAgYi51cGRhdGVBQUJCKCk7CiAgICAgICAgfQoKICAgICAgICBpZiAoYi5hYWJiLm92ZXJsYXBzKGFhYmIpKSB7CiAgICAgICAgICByZXN1bHQucHVzaChiKTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIHJldHVybiByZXN1bHQ7CiAgICB9CgogIH0KCiAgY2xhc3MgVXRpbHMgewogICAgLyoqCiAgICAgKiBFeHRlbmQgYW4gb3B0aW9ucyBvYmplY3Qgd2l0aCBkZWZhdWx0IHZhbHVlcy4KICAgICAqIEBwYXJhbSBvcHRpb25zIFRoZSBvcHRpb25zIG9iamVjdC4gTWF5IGJlIGZhbHN5OiBpbiB0aGlzIGNhc2UsIGEgbmV3IG9iamVjdCBpcyBjcmVhdGVkIGFuZCByZXR1cm5lZC4KICAgICAqIEBwYXJhbSBkZWZhdWx0cyBBbiBvYmplY3QgY29udGFpbmluZyBkZWZhdWx0IHZhbHVlcy4KICAgICAqIEByZXR1cm4gVGhlIG1vZGlmaWVkIG9wdGlvbnMgb2JqZWN0LgogICAgICovCiAgICBzdGF0aWMgZGVmYXVsdHMob3B0aW9ucywgZGVmYXVsdHMpIHsKICAgICAgaWYgKG9wdGlvbnMgPT09IHZvaWQgMCkgewogICAgICAgIG9wdGlvbnMgPSB7fTsKICAgICAgfQoKICAgICAgZm9yIChsZXQga2V5IGluIGRlZmF1bHRzKSB7CiAgICAgICAgaWYgKCEoa2V5IGluIG9wdGlvbnMpKSB7CiAgICAgICAgICBvcHRpb25zW2tleV0gPSBkZWZhdWx0c1trZXldOwogICAgICAgIH0KICAgICAgfQoKICAgICAgcmV0dXJuIG9wdGlvbnM7CiAgICB9CgogIH0KCiAgLyoqCiAgICogQ29uc3RyYWludCBiYXNlIGNsYXNzCiAgICovCiAgY2xhc3MgQ29uc3RyYWludCB7CiAgICAvKioKICAgICAqIEVxdWF0aW9ucyB0byBiZSBzb2x2ZWQgaW4gdGhpcyBjb25zdHJhaW50LgogICAgICovCgogICAgLyoqCiAgICAgKiBCb2R5IEEuCiAgICAgKi8KCiAgICAvKioKICAgICAqIEJvZHkgQi4KICAgICAqLwoKICAgIC8qKgogICAgICogU2V0IHRvIGZhbHNlIGlmIHlvdSBkb24ndCB3YW50IHRoZSBib2RpZXMgdG8gY29sbGlkZSB3aGVuIHRoZXkgYXJlIGNvbm5lY3RlZC4KICAgICAqLwogICAgY29uc3RydWN0b3IoYm9keUEsIGJvZHlCLCBvcHRpb25zKSB7CiAgICAgIGlmIChvcHRpb25zID09PSB2b2lkIDApIHsKICAgICAgICBvcHRpb25zID0ge307CiAgICAgIH0KCiAgICAgIG9wdGlvbnMgPSBVdGlscy5kZWZhdWx0cyhvcHRpb25zLCB7CiAgICAgICAgY29sbGlkZUNvbm5lY3RlZDogdHJ1ZSwKICAgICAgICB3YWtlVXBCb2RpZXM6IHRydWUKICAgICAgfSk7CiAgICAgIHRoaXMuZXF1YXRpb25zID0gW107CiAgICAgIHRoaXMuYm9keUEgPSBib2R5QTsKICAgICAgdGhpcy5ib2R5QiA9IGJvZHlCOwogICAgICB0aGlzLmlkID0gQ29uc3RyYWludC5pZENvdW50ZXIrKzsKICAgICAgdGhpcy5jb2xsaWRlQ29ubmVjdGVkID0gb3B0aW9ucy5jb2xsaWRlQ29ubmVjdGVkOwoKICAgICAgaWYgKG9wdGlvbnMud2FrZVVwQm9kaWVzKSB7CiAgICAgICAgaWYgKGJvZHlBKSB7CiAgICAgICAgICBib2R5QS53YWtlVXAoKTsKICAgICAgICB9CgogICAgICAgIGlmIChib2R5QikgewogICAgICAgICAgYm9keUIud2FrZVVwKCk7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIFVwZGF0ZSBhbGwgdGhlIGVxdWF0aW9ucyB3aXRoIGRhdGEuCiAgICAgKi8KCgogICAgdXBkYXRlKCkgewogICAgICB0aHJvdyBuZXcgRXJyb3IoJ21ldGhvZCB1cGRhdGUoKSBub3QgaW1wbG1lbWVudGVkIGluIHRoaXMgQ29uc3RyYWludCBzdWJjbGFzcyEnKTsKICAgIH0KICAgIC8qKgogICAgICogRW5hYmxlcyBhbGwgZXF1YXRpb25zIGluIHRoZSBjb25zdHJhaW50LgogICAgICovCgoKICAgIGVuYWJsZSgpIHsKICAgICAgY29uc3QgZXFzID0gdGhpcy5lcXVhdGlvbnM7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGVxcy5sZW5ndGg7IGkrKykgewogICAgICAgIGVxc1tpXS5lbmFibGVkID0gdHJ1ZTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBEaXNhYmxlcyBhbGwgZXF1YXRpb25zIGluIHRoZSBjb25zdHJhaW50LgogICAgICovCgoKICAgIGRpc2FibGUoKSB7CiAgICAgIGNvbnN0IGVxcyA9IHRoaXMuZXF1YXRpb25zOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBlcXMubGVuZ3RoOyBpKyspIHsKICAgICAgICBlcXNbaV0uZW5hYmxlZCA9IGZhbHNlOwogICAgICB9CiAgICB9CgogIH0KICBDb25zdHJhaW50LmlkQ291bnRlciA9IDA7CgogIC8qKgogICAqIEFuIGVsZW1lbnQgY29udGFpbmluZyA2IGVudHJpZXMsIDMgc3BhdGlhbCBhbmQgMyByb3RhdGlvbmFsIGRlZ3JlZXMgb2YgZnJlZWRvbS4KICAgKi8KCiAgY2xhc3MgSmFjb2JpYW5FbGVtZW50IHsKICAgIC8qKgogICAgICogc3BhdGlhbAogICAgICovCgogICAgLyoqCiAgICAgKiByb3RhdGlvbmFsCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKCkgewogICAgICB0aGlzLnNwYXRpYWwgPSBuZXcgVmVjMygpOwogICAgICB0aGlzLnJvdGF0aW9uYWwgPSBuZXcgVmVjMygpOwogICAgfQogICAgLyoqCiAgICAgKiBNdWx0aXBseSB3aXRoIG90aGVyIEphY29iaWFuRWxlbWVudAogICAgICovCgoKICAgIG11bHRpcGx5RWxlbWVudChlbGVtZW50KSB7CiAgICAgIHJldHVybiBlbGVtZW50LnNwYXRpYWwuZG90KHRoaXMuc3BhdGlhbCkgKyBlbGVtZW50LnJvdGF0aW9uYWwuZG90KHRoaXMucm90YXRpb25hbCk7CiAgICB9CiAgICAvKioKICAgICAqIE11bHRpcGx5IHdpdGggdHdvIHZlY3RvcnMKICAgICAqLwoKCiAgICBtdWx0aXBseVZlY3RvcnMoc3BhdGlhbCwgcm90YXRpb25hbCkgewogICAgICByZXR1cm4gc3BhdGlhbC5kb3QodGhpcy5zcGF0aWFsKSArIHJvdGF0aW9uYWwuZG90KHRoaXMucm90YXRpb25hbCk7CiAgICB9CgogIH0KCiAgLyoqCiAgICogRXF1YXRpb24gYmFzZSBjbGFzcy4KICAgKgogICAqIGBhYCwgYGJgIGFuZCBgZXBzYCBhcmUge0BsaW5rIGh0dHBzOi8vd3d3OC5jcy51bXUuc2Uva3Vyc2VyLzVEVjA1OC9WVDE1L2xlY3R1cmVzL1NQT09LbGFibm90ZXMucGRmIFNQT09LfSBwYXJhbWV0ZXJzIHRoYXQgZGVmYXVsdCB0byBgMC4wYC4gU2VlIHtAbGluayBodHRwczovL2dpdGh1Yi5jb20vc2NodGVwcGUvY2Fubm9uLmpzL2lzc3Vlcy8yMzgjaXNzdWVjb21tZW50LTE0NzE3MjMyNyB0aGlzIGV4Y2hhbmdlfSBmb3IgbW9yZSBkZXRhaWxzIG9uIENhbm5vbidzIHBoeXNpY3MgaW1wbGVtZW50YXRpb24uCiAgICovCiAgY2xhc3MgRXF1YXRpb24gewogICAgLyoqCiAgICAgKiBNaW5pbXVtIChyZWFkOiBuZWdhdGl2ZSBtYXgpIGZvcmNlIHRvIGJlIGFwcGxpZWQgYnkgdGhlIGNvbnN0cmFpbnQuCiAgICAgKi8KCiAgICAvKioKICAgICAqIE1heGltdW0gKHJlYWQ6IHBvc2l0aXZlIG1heCkgZm9yY2UgdG8gYmUgYXBwbGllZCBieSB0aGUgY29uc3RyYWludC4KICAgICAqLwoKICAgIC8qKgogICAgICogU1BPT0sgcGFyYW1ldGVyCiAgICAgKi8KCiAgICAvKioKICAgICAqIFNQT09LIHBhcmFtZXRlcgogICAgICovCgogICAgLyoqCiAgICAgKiBTUE9PSyBwYXJhbWV0ZXIKICAgICAqLwoKICAgIC8qKgogICAgICogQSBudW1iZXIsIHByb3BvcnRpb25hbCB0byB0aGUgZm9yY2UgYWRkZWQgdG8gdGhlIGJvZGllcy4KICAgICAqLwogICAgY29uc3RydWN0b3IoYmksIGJqLCBtaW5Gb3JjZSwgbWF4Rm9yY2UpIHsKICAgICAgaWYgKG1pbkZvcmNlID09PSB2b2lkIDApIHsKICAgICAgICBtaW5Gb3JjZSA9IC0xZTY7CiAgICAgIH0KCiAgICAgIGlmIChtYXhGb3JjZSA9PT0gdm9pZCAwKSB7CiAgICAgICAgbWF4Rm9yY2UgPSAxZTY7CiAgICAgIH0KCiAgICAgIHRoaXMuaWQgPSBFcXVhdGlvbi5pZENvdW50ZXIrKzsKICAgICAgdGhpcy5taW5Gb3JjZSA9IG1pbkZvcmNlOwogICAgICB0aGlzLm1heEZvcmNlID0gbWF4Rm9yY2U7CiAgICAgIHRoaXMuYmkgPSBiaTsKICAgICAgdGhpcy5iaiA9IGJqOwogICAgICB0aGlzLmEgPSAwLjA7IC8vIFNQT09LIHBhcmFtZXRlcgoKICAgICAgdGhpcy5iID0gMC4wOyAvLyBTUE9PSyBwYXJhbWV0ZXIKCiAgICAgIHRoaXMuZXBzID0gMC4wOyAvLyBTUE9PSyBwYXJhbWV0ZXIKCiAgICAgIHRoaXMuamFjb2JpYW5FbGVtZW50QSA9IG5ldyBKYWNvYmlhbkVsZW1lbnQoKTsKICAgICAgdGhpcy5qYWNvYmlhbkVsZW1lbnRCID0gbmV3IEphY29iaWFuRWxlbWVudCgpOwogICAgICB0aGlzLmVuYWJsZWQgPSB0cnVlOwogICAgICB0aGlzLm11bHRpcGxpZXIgPSAwOwogICAgICB0aGlzLnNldFNwb29rUGFyYW1zKDFlNywgNCwgMSAvIDYwKTsgLy8gU2V0IHR5cGljYWwgc3Bvb2sgcGFyYW1zCiAgICB9CiAgICAvKioKICAgICAqIFJlY2FsY3VsYXRlcyBhLCBiLCBhbmQgZXBzLgogICAgICoKICAgICAqIFRoZSBFcXVhdGlvbiBjb25zdHJ1Y3RvciBzZXRzIHR5cGljYWwgU1BPT0sgcGFyYW1ldGVycyBhcyBzdWNoOgogICAgICogKiBgc3RpZmZuZXNzYCA9IDFlNwogICAgICogKiBgcmVsYXhhdGlvbmAgPSA0CiAgICAgKiAqIGB0aW1lU3RlcGA9IDEgLyA2MCwgX25vdGUgdGhlIGhhcmRjb2RlZCByZWZyZXNoIHJhdGUuXwogICAgICovCgoKICAgIHNldFNwb29rUGFyYW1zKHN0aWZmbmVzcywgcmVsYXhhdGlvbiwgdGltZVN0ZXApIHsKICAgICAgY29uc3QgZCA9IHJlbGF4YXRpb247CiAgICAgIGNvbnN0IGsgPSBzdGlmZm5lc3M7CiAgICAgIGNvbnN0IGggPSB0aW1lU3RlcDsKICAgICAgdGhpcy5hID0gNC4wIC8gKGggKiAoMSArIDQgKiBkKSk7CiAgICAgIHRoaXMuYiA9IDQuMCAqIGQgLyAoMSArIDQgKiBkKTsKICAgICAgdGhpcy5lcHMgPSA0LjAgLyAoaCAqIGggKiBrICogKDEgKyA0ICogZCkpOwogICAgfQogICAgLyoqCiAgICAgKiBDb21wdXRlcyB0aGUgcmlnaHQgaGFuZCBzaWRlIG9mIHRoZSBTUE9PSyBlcXVhdGlvbgogICAgICovCgoKICAgIGNvbXB1dGVCKGEsIGIsIGgpIHsKICAgICAgY29uc3QgR1cgPSB0aGlzLmNvbXB1dGVHVygpOwogICAgICBjb25zdCBHcSA9IHRoaXMuY29tcHV0ZUdxKCk7CiAgICAgIGNvbnN0IEdpTWYgPSB0aGlzLmNvbXB1dGVHaU1mKCk7CiAgICAgIHJldHVybiAtR3EgKiBhIC0gR1cgKiBiIC0gR2lNZiAqIGg7CiAgICB9CiAgICAvKioKICAgICAqIENvbXB1dGVzIEcqcSwgd2hlcmUgcSBhcmUgdGhlIGdlbmVyYWxpemVkIGJvZHkgY29vcmRpbmF0ZXMKICAgICAqLwoKCiAgICBjb21wdXRlR3EoKSB7CiAgICAgIGNvbnN0IEdBID0gdGhpcy5qYWNvYmlhbkVsZW1lbnRBOwogICAgICBjb25zdCBHQiA9IHRoaXMuamFjb2JpYW5FbGVtZW50QjsKICAgICAgY29uc3QgYmkgPSB0aGlzLmJpOwogICAgICBjb25zdCBiaiA9IHRoaXMuYmo7CiAgICAgIGNvbnN0IHhpID0gYmkucG9zaXRpb247CiAgICAgIGNvbnN0IHhqID0gYmoucG9zaXRpb247CiAgICAgIHJldHVybiBHQS5zcGF0aWFsLmRvdCh4aSkgKyBHQi5zcGF0aWFsLmRvdCh4aik7CiAgICB9CiAgICAvKioKICAgICAqIENvbXB1dGVzIEcqVywgd2hlcmUgVyBhcmUgdGhlIGJvZHkgdmVsb2NpdGllcwogICAgICovCgoKICAgIGNvbXB1dGVHVygpIHsKICAgICAgY29uc3QgR0EgPSB0aGlzLmphY29iaWFuRWxlbWVudEE7CiAgICAgIGNvbnN0IEdCID0gdGhpcy5qYWNvYmlhbkVsZW1lbnRCOwogICAgICBjb25zdCBiaSA9IHRoaXMuYmk7CiAgICAgIGNvbnN0IGJqID0gdGhpcy5iajsKICAgICAgY29uc3QgdmkgPSBiaS52ZWxvY2l0eTsKICAgICAgY29uc3QgdmogPSBiai52ZWxvY2l0eTsKICAgICAgY29uc3Qgd2kgPSBiaS5hbmd1bGFyVmVsb2NpdHk7CiAgICAgIGNvbnN0IHdqID0gYmouYW5ndWxhclZlbG9jaXR5OwogICAgICByZXR1cm4gR0EubXVsdGlwbHlWZWN0b3JzKHZpLCB3aSkgKyBHQi5tdWx0aXBseVZlY3RvcnModmosIHdqKTsKICAgIH0KICAgIC8qKgogICAgICogQ29tcHV0ZXMgRypXbGFtYmRhLCB3aGVyZSBXIGFyZSB0aGUgYm9keSB2ZWxvY2l0aWVzCiAgICAgKi8KCgogICAgY29tcHV0ZUdXbGFtYmRhKCkgewogICAgICBjb25zdCBHQSA9IHRoaXMuamFjb2JpYW5FbGVtZW50QTsKICAgICAgY29uc3QgR0IgPSB0aGlzLmphY29iaWFuRWxlbWVudEI7CiAgICAgIGNvbnN0IGJpID0gdGhpcy5iaTsKICAgICAgY29uc3QgYmogPSB0aGlzLmJqOwogICAgICBjb25zdCB2aSA9IGJpLnZsYW1iZGE7CiAgICAgIGNvbnN0IHZqID0gYmoudmxhbWJkYTsKICAgICAgY29uc3Qgd2kgPSBiaS53bGFtYmRhOwogICAgICBjb25zdCB3aiA9IGJqLndsYW1iZGE7CiAgICAgIHJldHVybiBHQS5tdWx0aXBseVZlY3RvcnModmksIHdpKSArIEdCLm11bHRpcGx5VmVjdG9ycyh2aiwgd2opOwogICAgfQogICAgLyoqCiAgICAgKiBDb21wdXRlcyBHKmludihNKSpmLCB3aGVyZSBNIGlzIHRoZSBtYXNzIG1hdHJpeCB3aXRoIGRpYWdvbmFsIGJsb2NrcyBmb3IgZWFjaCBib2R5LCBhbmQgZiBhcmUgdGhlIGZvcmNlcyBvbiB0aGUgYm9kaWVzLgogICAgICovCgoKICAgIGNvbXB1dGVHaU1mKCkgewogICAgICBjb25zdCBHQSA9IHRoaXMuamFjb2JpYW5FbGVtZW50QTsKICAgICAgY29uc3QgR0IgPSB0aGlzLmphY29iaWFuRWxlbWVudEI7CiAgICAgIGNvbnN0IGJpID0gdGhpcy5iaTsKICAgICAgY29uc3QgYmogPSB0aGlzLmJqOwogICAgICBjb25zdCBmaSA9IGJpLmZvcmNlOwogICAgICBjb25zdCB0aSA9IGJpLnRvcnF1ZTsKICAgICAgY29uc3QgZmogPSBiai5mb3JjZTsKICAgICAgY29uc3QgdGogPSBiai50b3JxdWU7CiAgICAgIGNvbnN0IGludk1hc3NpID0gYmkuaW52TWFzc1NvbHZlOwogICAgICBjb25zdCBpbnZNYXNzaiA9IGJqLmludk1hc3NTb2x2ZTsKICAgICAgZmkuc2NhbGUoaW52TWFzc2ksIGlNZmkpOwogICAgICBmai5zY2FsZShpbnZNYXNzaiwgaU1maik7CiAgICAgIGJpLmludkluZXJ0aWFXb3JsZFNvbHZlLnZtdWx0KHRpLCBpbnZJaV92bXVsdF90YXVpKTsKICAgICAgYmouaW52SW5lcnRpYVdvcmxkU29sdmUudm11bHQodGosIGludklqX3ZtdWx0X3RhdWopOwogICAgICByZXR1cm4gR0EubXVsdGlwbHlWZWN0b3JzKGlNZmksIGludklpX3ZtdWx0X3RhdWkpICsgR0IubXVsdGlwbHlWZWN0b3JzKGlNZmosIGludklqX3ZtdWx0X3RhdWopOwogICAgfQogICAgLyoqCiAgICAgKiBDb21wdXRlcyBHKmludihNKSpHJwogICAgICovCgoKICAgIGNvbXB1dGVHaU1HdCgpIHsKICAgICAgY29uc3QgR0EgPSB0aGlzLmphY29iaWFuRWxlbWVudEE7CiAgICAgIGNvbnN0IEdCID0gdGhpcy5qYWNvYmlhbkVsZW1lbnRCOwogICAgICBjb25zdCBiaSA9IHRoaXMuYmk7CiAgICAgIGNvbnN0IGJqID0gdGhpcy5iajsKICAgICAgY29uc3QgaW52TWFzc2kgPSBiaS5pbnZNYXNzU29sdmU7CiAgICAgIGNvbnN0IGludk1hc3NqID0gYmouaW52TWFzc1NvbHZlOwogICAgICBjb25zdCBpbnZJaSA9IGJpLmludkluZXJ0aWFXb3JsZFNvbHZlOwogICAgICBjb25zdCBpbnZJaiA9IGJqLmludkluZXJ0aWFXb3JsZFNvbHZlOwogICAgICBsZXQgcmVzdWx0ID0gaW52TWFzc2kgKyBpbnZNYXNzajsKICAgICAgaW52SWkudm11bHQoR0Eucm90YXRpb25hbCwgdG1wKTsKICAgICAgcmVzdWx0ICs9IHRtcC5kb3QoR0Eucm90YXRpb25hbCk7CiAgICAgIGludklqLnZtdWx0KEdCLnJvdGF0aW9uYWwsIHRtcCk7CiAgICAgIHJlc3VsdCArPSB0bXAuZG90KEdCLnJvdGF0aW9uYWwpOwogICAgICByZXR1cm4gcmVzdWx0OwogICAgfQogICAgLyoqCiAgICAgKiBBZGQgY29uc3RyYWludCB2ZWxvY2l0eSB0byB0aGUgYm9kaWVzLgogICAgICovCgoKICAgIGFkZFRvV2xhbWJkYShkZWx0YWxhbWJkYSkgewogICAgICBjb25zdCBHQSA9IHRoaXMuamFjb2JpYW5FbGVtZW50QTsKICAgICAgY29uc3QgR0IgPSB0aGlzLmphY29iaWFuRWxlbWVudEI7CiAgICAgIGNvbnN0IGJpID0gdGhpcy5iaTsKICAgICAgY29uc3QgYmogPSB0aGlzLmJqOwogICAgICBjb25zdCB0ZW1wID0gYWRkVG9XbGFtYmRhX3RlbXA7IC8vIEFkZCB0byBsaW5lYXIgdmVsb2NpdHkKICAgICAgLy8gdl9sYW1iZGEgKz0gaW52KE0pICogZGVsdGFfbGFtYmEgKiBHCgogICAgICBiaS52bGFtYmRhLmFkZFNjYWxlZFZlY3RvcihiaS5pbnZNYXNzU29sdmUgKiBkZWx0YWxhbWJkYSwgR0Euc3BhdGlhbCwgYmkudmxhbWJkYSk7CiAgICAgIGJqLnZsYW1iZGEuYWRkU2NhbGVkVmVjdG9yKGJqLmludk1hc3NTb2x2ZSAqIGRlbHRhbGFtYmRhLCBHQi5zcGF0aWFsLCBiai52bGFtYmRhKTsgLy8gQWRkIHRvIGFuZ3VsYXIgdmVsb2NpdHkKCiAgICAgIGJpLmludkluZXJ0aWFXb3JsZFNvbHZlLnZtdWx0KEdBLnJvdGF0aW9uYWwsIHRlbXApOwogICAgICBiaS53bGFtYmRhLmFkZFNjYWxlZFZlY3RvcihkZWx0YWxhbWJkYSwgdGVtcCwgYmkud2xhbWJkYSk7CiAgICAgIGJqLmludkluZXJ0aWFXb3JsZFNvbHZlLnZtdWx0KEdCLnJvdGF0aW9uYWwsIHRlbXApOwogICAgICBiai53bGFtYmRhLmFkZFNjYWxlZFZlY3RvcihkZWx0YWxhbWJkYSwgdGVtcCwgYmoud2xhbWJkYSk7CiAgICB9CiAgICAvKioKICAgICAqIENvbXB1dGUgdGhlIGRlbm9taW5hdG9yIHBhcnQgb2YgdGhlIFNQT09LIGVxdWF0aW9uOiBDID0gRyppbnYoTSkqRycgKyBlcHMKICAgICAqLwoKCiAgICBjb21wdXRlQygpIHsKICAgICAgcmV0dXJuIHRoaXMuY29tcHV0ZUdpTUd0KCkgKyB0aGlzLmVwczsKICAgIH0KCiAgfQogIEVxdWF0aW9uLmlkQ291bnRlciA9IDA7CiAgY29uc3QgaU1maSA9IG5ldyBWZWMzKCk7CiAgY29uc3QgaU1maiA9IG5ldyBWZWMzKCk7CiAgY29uc3QgaW52SWlfdm11bHRfdGF1aSA9IG5ldyBWZWMzKCk7CiAgY29uc3QgaW52SWpfdm11bHRfdGF1aiA9IG5ldyBWZWMzKCk7CiAgY29uc3QgdG1wID0gbmV3IFZlYzMoKTsKICBjb25zdCBhZGRUb1dsYW1iZGFfdGVtcCA9IG5ldyBWZWMzKCk7CgogIC8qKgogICAqIENvbnRhY3Qvbm9uLXBlbmV0cmF0aW9uIGNvbnN0cmFpbnQgZXF1YXRpb24KICAgKi8KICBjbGFzcyBDb250YWN0RXF1YXRpb24gZXh0ZW5kcyBFcXVhdGlvbiB7CiAgICAvKioKICAgICAqICJib3VuY2luZXNzIjogdTEgPSAtZSp1MAogICAgICovCgogICAgLyoqCiAgICAgKiBXb3JsZC1vcmllbnRlZCB2ZWN0b3IgdGhhdCBnb2VzIGZyb20gdGhlIGNlbnRlciBvZiBiaSB0byB0aGUgY29udGFjdCBwb2ludC4KICAgICAqLwoKICAgIC8qKgogICAgICogV29ybGQtb3JpZW50ZWQgdmVjdG9yIHRoYXQgc3RhcnRzIGluIGJvZHkgaiBwb3NpdGlvbiBhbmQgZ29lcyB0byB0aGUgY29udGFjdCBwb2ludC4KICAgICAqLwoKICAgIC8qKgogICAgICogQ29udGFjdCBub3JtYWwsIHBvaW50aW5nIG91dCBvZiBib2R5IGkuCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKGJvZHlBLCBib2R5QiwgbWF4Rm9yY2UpIHsKICAgICAgaWYgKG1heEZvcmNlID09PSB2b2lkIDApIHsKICAgICAgICBtYXhGb3JjZSA9IDFlNjsKICAgICAgfQoKICAgICAgc3VwZXIoYm9keUEsIGJvZHlCLCAwLCBtYXhGb3JjZSk7CiAgICAgIHRoaXMucmVzdGl0dXRpb24gPSAwLjA7CiAgICAgIHRoaXMucmkgPSBuZXcgVmVjMygpOwogICAgICB0aGlzLnJqID0gbmV3IFZlYzMoKTsKICAgICAgdGhpcy5uaSA9IG5ldyBWZWMzKCk7CiAgICB9CgogICAgY29tcHV0ZUIoaCkgewogICAgICBjb25zdCBhID0gdGhpcy5hOwogICAgICBjb25zdCBiID0gdGhpcy5iOwogICAgICBjb25zdCBiaSA9IHRoaXMuYmk7CiAgICAgIGNvbnN0IGJqID0gdGhpcy5iajsKICAgICAgY29uc3QgcmkgPSB0aGlzLnJpOwogICAgICBjb25zdCByaiA9IHRoaXMucmo7CiAgICAgIGNvbnN0IHJpeG4gPSBDb250YWN0RXF1YXRpb25fY29tcHV0ZUJfdGVtcDE7CiAgICAgIGNvbnN0IHJqeG4gPSBDb250YWN0RXF1YXRpb25fY29tcHV0ZUJfdGVtcDI7CiAgICAgIGNvbnN0IHZpID0gYmkudmVsb2NpdHk7CiAgICAgIGNvbnN0IHdpID0gYmkuYW5ndWxhclZlbG9jaXR5OwogICAgICBiaS5mb3JjZTsKICAgICAgYmkudG9ycXVlOwogICAgICBjb25zdCB2aiA9IGJqLnZlbG9jaXR5OwogICAgICBjb25zdCB3aiA9IGJqLmFuZ3VsYXJWZWxvY2l0eTsKICAgICAgYmouZm9yY2U7CiAgICAgIGJqLnRvcnF1ZTsKICAgICAgY29uc3QgcGVuZXRyYXRpb25WZWMgPSBDb250YWN0RXF1YXRpb25fY29tcHV0ZUJfdGVtcDM7CiAgICAgIGNvbnN0IEdBID0gdGhpcy5qYWNvYmlhbkVsZW1lbnRBOwogICAgICBjb25zdCBHQiA9IHRoaXMuamFjb2JpYW5FbGVtZW50QjsKICAgICAgY29uc3QgbiA9IHRoaXMubmk7IC8vIENhbHVjbGF0ZSBjcm9zcyBwcm9kdWN0cwoKICAgICAgcmkuY3Jvc3Mobiwgcml4bik7CiAgICAgIHJqLmNyb3NzKG4sIHJqeG4pOyAvLyBnID0geGorcmogLSh4aStyaSkKICAgICAgLy8gRyA9IFsgLW5pICAtcml4biAgbmkgIHJqeG4gXQoKICAgICAgbi5uZWdhdGUoR0Euc3BhdGlhbCk7CiAgICAgIHJpeG4ubmVnYXRlKEdBLnJvdGF0aW9uYWwpOwogICAgICBHQi5zcGF0aWFsLmNvcHkobik7CiAgICAgIEdCLnJvdGF0aW9uYWwuY29weShyanhuKTsgLy8gQ2FsY3VsYXRlIHRoZSBwZW5ldHJhdGlvbiB2ZWN0b3IKCiAgICAgIHBlbmV0cmF0aW9uVmVjLmNvcHkoYmoucG9zaXRpb24pOwogICAgICBwZW5ldHJhdGlvblZlYy52YWRkKHJqLCBwZW5ldHJhdGlvblZlYyk7CiAgICAgIHBlbmV0cmF0aW9uVmVjLnZzdWIoYmkucG9zaXRpb24sIHBlbmV0cmF0aW9uVmVjKTsKICAgICAgcGVuZXRyYXRpb25WZWMudnN1YihyaSwgcGVuZXRyYXRpb25WZWMpOwogICAgICBjb25zdCBnID0gbi5kb3QocGVuZXRyYXRpb25WZWMpOyAvLyBDb21wdXRlIGl0ZXJhdGlvbgoKICAgICAgY29uc3QgZVBsdXNPbmUgPSB0aGlzLnJlc3RpdHV0aW9uICsgMTsKICAgICAgY29uc3QgR1cgPSBlUGx1c09uZSAqIHZqLmRvdChuKSAtIGVQbHVzT25lICogdmkuZG90KG4pICsgd2ouZG90KHJqeG4pIC0gd2kuZG90KHJpeG4pOwogICAgICBjb25zdCBHaU1mID0gdGhpcy5jb21wdXRlR2lNZigpOwogICAgICBjb25zdCBCID0gLWcgKiBhIC0gR1cgKiBiIC0gaCAqIEdpTWY7CiAgICAgIHJldHVybiBCOwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgdGhlIGN1cnJlbnQgcmVsYXRpdmUgdmVsb2NpdHkgaW4gdGhlIGNvbnRhY3QgcG9pbnQuCiAgICAgKi8KCgogICAgZ2V0SW1wYWN0VmVsb2NpdHlBbG9uZ05vcm1hbCgpIHsKICAgICAgY29uc3QgdmkgPSBDb250YWN0RXF1YXRpb25fZ2V0SW1wYWN0VmVsb2NpdHlBbG9uZ05vcm1hbF92aTsKICAgICAgY29uc3QgdmogPSBDb250YWN0RXF1YXRpb25fZ2V0SW1wYWN0VmVsb2NpdHlBbG9uZ05vcm1hbF92ajsKICAgICAgY29uc3QgeGkgPSBDb250YWN0RXF1YXRpb25fZ2V0SW1wYWN0VmVsb2NpdHlBbG9uZ05vcm1hbF94aTsKICAgICAgY29uc3QgeGogPSBDb250YWN0RXF1YXRpb25fZ2V0SW1wYWN0VmVsb2NpdHlBbG9uZ05vcm1hbF94ajsKICAgICAgY29uc3QgcmVsVmVsID0gQ29udGFjdEVxdWF0aW9uX2dldEltcGFjdFZlbG9jaXR5QWxvbmdOb3JtYWxfcmVsVmVsOwogICAgICB0aGlzLmJpLnBvc2l0aW9uLnZhZGQodGhpcy5yaSwgeGkpOwogICAgICB0aGlzLmJqLnBvc2l0aW9uLnZhZGQodGhpcy5yaiwgeGopOwogICAgICB0aGlzLmJpLmdldFZlbG9jaXR5QXRXb3JsZFBvaW50KHhpLCB2aSk7CiAgICAgIHRoaXMuYmouZ2V0VmVsb2NpdHlBdFdvcmxkUG9pbnQoeGosIHZqKTsKICAgICAgdmkudnN1Yih2aiwgcmVsVmVsKTsKICAgICAgcmV0dXJuIHRoaXMubmkuZG90KHJlbFZlbCk7CiAgICB9CgogIH0KICBjb25zdCBDb250YWN0RXF1YXRpb25fY29tcHV0ZUJfdGVtcDEgPSBuZXcgVmVjMygpOyAvLyBUZW1wIHZlY3RvcnMKCiAgY29uc3QgQ29udGFjdEVxdWF0aW9uX2NvbXB1dGVCX3RlbXAyID0gbmV3IFZlYzMoKTsKICBjb25zdCBDb250YWN0RXF1YXRpb25fY29tcHV0ZUJfdGVtcDMgPSBuZXcgVmVjMygpOwogIGNvbnN0IENvbnRhY3RFcXVhdGlvbl9nZXRJbXBhY3RWZWxvY2l0eUFsb25nTm9ybWFsX3ZpID0gbmV3IFZlYzMoKTsKICBjb25zdCBDb250YWN0RXF1YXRpb25fZ2V0SW1wYWN0VmVsb2NpdHlBbG9uZ05vcm1hbF92aiA9IG5ldyBWZWMzKCk7CiAgY29uc3QgQ29udGFjdEVxdWF0aW9uX2dldEltcGFjdFZlbG9jaXR5QWxvbmdOb3JtYWxfeGkgPSBuZXcgVmVjMygpOwogIGNvbnN0IENvbnRhY3RFcXVhdGlvbl9nZXRJbXBhY3RWZWxvY2l0eUFsb25nTm9ybWFsX3hqID0gbmV3IFZlYzMoKTsKICBjb25zdCBDb250YWN0RXF1YXRpb25fZ2V0SW1wYWN0VmVsb2NpdHlBbG9uZ05vcm1hbF9yZWxWZWwgPSBuZXcgVmVjMygpOwoKICAvKioKICAgKiBDb25uZWN0cyB0d28gYm9kaWVzIGF0IGdpdmVuIG9mZnNldCBwb2ludHMuCiAgICogQGV4YW1wbGUKICAgKiAgICAgY29uc3QgYm9keUEgPSBuZXcgQm9keSh7IG1hc3M6IDEgfSkKICAgKiAgICAgY29uc3QgYm9keUIgPSBuZXcgQm9keSh7IG1hc3M6IDEgfSkKICAgKiAgICAgYm9keUEucG9zaXRpb24uc2V0KC0xLCAwLCAwKQogICAqICAgICBib2R5Qi5wb3NpdGlvbi5zZXQoMSwgMCwgMCkKICAgKiAgICAgYm9keUEuYWRkU2hhcGUoc2hhcGVBKQogICAqICAgICBib2R5Qi5hZGRTaGFwZShzaGFwZUIpCiAgICogICAgIHdvcmxkLmFkZEJvZHkoYm9keUEpCiAgICogICAgIHdvcmxkLmFkZEJvZHkoYm9keUIpCiAgICogICAgIGNvbnN0IGxvY2FsUGl2b3RBID0gbmV3IFZlYzMoMSwgMCwgMCkKICAgKiAgICAgY29uc3QgbG9jYWxQaXZvdEIgPSBuZXcgVmVjMygtMSwgMCwgMCkKICAgKiAgICAgY29uc3QgY29uc3RyYWludCA9IG5ldyBQb2ludFRvUG9pbnRDb25zdHJhaW50KGJvZHlBLCBsb2NhbFBpdm90QSwgYm9keUIsIGxvY2FsUGl2b3RCKQogICAqICAgICB3b3JsZC5hZGRDb25zdHJhaW50KGNvbnN0cmFpbnQpCiAgICovCiAgY2xhc3MgUG9pbnRUb1BvaW50Q29uc3RyYWludCBleHRlbmRzIENvbnN0cmFpbnQgewogICAgLyoqCiAgICAgKiBQaXZvdCwgZGVmaW5lZCBsb2NhbGx5IGluIGJvZHlBLgogICAgICovCgogICAgLyoqCiAgICAgKiBQaXZvdCwgZGVmaW5lZCBsb2NhbGx5IGluIGJvZHlCLgogICAgICovCgogICAgLyoqCiAgICAgKiBAcGFyYW0gcGl2b3RBIFRoZSBwb2ludCByZWxhdGl2ZSB0byB0aGUgY2VudGVyIG9mIG1hc3Mgb2YgYm9keUEgd2hpY2ggYm9keUEgaXMgY29uc3RyYWluZWQgdG8uCiAgICAgKiBAcGFyYW0gYm9keUIgQm9keSB0aGF0IHdpbGwgYmUgY29uc3RyYWluZWQgaW4gYSBzaW1pbGFyIHdheSB0byB0aGUgc2FtZSBwb2ludCBhcyBib2R5QS4gV2Ugd2lsbCB0aGVyZWZvcmUgZ2V0IGEgbGluayBiZXR3ZWVuIGJvZHlBIGFuZCBib2R5Qi4gSWYgbm90IHNwZWNpZmllZCwgYm9keUEgd2lsbCBiZSBjb25zdHJhaW5lZCB0byBhIHN0YXRpYyBwb2ludC4KICAgICAqIEBwYXJhbSBwaXZvdEIgVGhlIHBvaW50IHJlbGF0aXZlIHRvIHRoZSBjZW50ZXIgb2YgbWFzcyBvZiBib2R5QiB3aGljaCBib2R5QiBpcyBjb25zdHJhaW5lZCB0by4KICAgICAqIEBwYXJhbSBtYXhGb3JjZSBUaGUgbWF4aW11bSBmb3JjZSB0aGF0IHNob3VsZCBiZSBhcHBsaWVkIHRvIGNvbnN0cmFpbiB0aGUgYm9kaWVzLgogICAgICovCiAgICBjb25zdHJ1Y3Rvcihib2R5QSwgcGl2b3RBLCBib2R5QiwgcGl2b3RCLCBtYXhGb3JjZSkgewogICAgICBpZiAocGl2b3RBID09PSB2b2lkIDApIHsKICAgICAgICBwaXZvdEEgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICBpZiAocGl2b3RCID09PSB2b2lkIDApIHsKICAgICAgICBwaXZvdEIgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICBpZiAobWF4Rm9yY2UgPT09IHZvaWQgMCkgewogICAgICAgIG1heEZvcmNlID0gMWU2OwogICAgICB9CgogICAgICBzdXBlcihib2R5QSwgYm9keUIpOwogICAgICB0aGlzLnBpdm90QSA9IHBpdm90QS5jbG9uZSgpOwogICAgICB0aGlzLnBpdm90QiA9IHBpdm90Qi5jbG9uZSgpOwogICAgICBjb25zdCB4ID0gdGhpcy5lcXVhdGlvblggPSBuZXcgQ29udGFjdEVxdWF0aW9uKGJvZHlBLCBib2R5Qik7CiAgICAgIGNvbnN0IHkgPSB0aGlzLmVxdWF0aW9uWSA9IG5ldyBDb250YWN0RXF1YXRpb24oYm9keUEsIGJvZHlCKTsKICAgICAgY29uc3QgeiA9IHRoaXMuZXF1YXRpb25aID0gbmV3IENvbnRhY3RFcXVhdGlvbihib2R5QSwgYm9keUIpOyAvLyBFcXVhdGlvbnMgdG8gYmUgZmVkIHRvIHRoZSBzb2x2ZXIKCiAgICAgIHRoaXMuZXF1YXRpb25zLnB1c2goeCwgeSwgeik7IC8vIE1ha2UgdGhlIGVxdWF0aW9ucyBiaWRpcmVjdGlvbmFsCgogICAgICB4Lm1pbkZvcmNlID0geS5taW5Gb3JjZSA9IHoubWluRm9yY2UgPSAtbWF4Rm9yY2U7CiAgICAgIHgubWF4Rm9yY2UgPSB5Lm1heEZvcmNlID0gei5tYXhGb3JjZSA9IG1heEZvcmNlOwogICAgICB4Lm5pLnNldCgxLCAwLCAwKTsKICAgICAgeS5uaS5zZXQoMCwgMSwgMCk7CiAgICAgIHoubmkuc2V0KDAsIDAsIDEpOwogICAgfQoKICAgIHVwZGF0ZSgpIHsKICAgICAgY29uc3QgYm9keUEgPSB0aGlzLmJvZHlBOwogICAgICBjb25zdCBib2R5QiA9IHRoaXMuYm9keUI7CiAgICAgIGNvbnN0IHggPSB0aGlzLmVxdWF0aW9uWDsKICAgICAgY29uc3QgeSA9IHRoaXMuZXF1YXRpb25ZOwogICAgICBjb25zdCB6ID0gdGhpcy5lcXVhdGlvblo7IC8vIFJvdGF0ZSB0aGUgcGl2b3RzIHRvIHdvcmxkIHNwYWNlCgogICAgICBib2R5QS5xdWF0ZXJuaW9uLnZtdWx0KHRoaXMucGl2b3RBLCB4LnJpKTsKICAgICAgYm9keUIucXVhdGVybmlvbi52bXVsdCh0aGlzLnBpdm90QiwgeC5yaik7CiAgICAgIHkucmkuY29weSh4LnJpKTsKICAgICAgeS5yai5jb3B5KHgucmopOwogICAgICB6LnJpLmNvcHkoeC5yaSk7CiAgICAgIHoucmouY29weSh4LnJqKTsKICAgIH0KCiAgfQoKICAvKioKICAgKiBDb25lIGVxdWF0aW9uLiBXb3JrcyB0byBrZWVwIHRoZSBnaXZlbiBib2R5IHdvcmxkIHZlY3RvcnMgYWxpZ25lZCwgb3IgdGlsdGVkIHdpdGhpbiBhIGdpdmVuIGFuZ2xlIGZyb20gZWFjaCBvdGhlci4KICAgKi8KICBjbGFzcyBDb25lRXF1YXRpb24gZXh0ZW5kcyBFcXVhdGlvbiB7CiAgICAvKioKICAgICAqIExvY2FsIGF4aXMgaW4gQQogICAgICovCgogICAgLyoqCiAgICAgKiBMb2NhbCBheGlzIGluIEIKICAgICAqLwoKICAgIC8qKgogICAgICogVGhlICJjb25lIGFuZ2xlIiB0byBrZWVwCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKGJvZHlBLCBib2R5Qiwgb3B0aW9ucykgewogICAgICBpZiAob3B0aW9ucyA9PT0gdm9pZCAwKSB7CiAgICAgICAgb3B0aW9ucyA9IHt9OwogICAgICB9CgogICAgICBjb25zdCBtYXhGb3JjZSA9IHR5cGVvZiBvcHRpb25zLm1heEZvcmNlICE9PSAndW5kZWZpbmVkJyA/IG9wdGlvbnMubWF4Rm9yY2UgOiAxZTY7CiAgICAgIHN1cGVyKGJvZHlBLCBib2R5QiwgLW1heEZvcmNlLCBtYXhGb3JjZSk7CiAgICAgIHRoaXMuYXhpc0EgPSBvcHRpb25zLmF4aXNBID8gb3B0aW9ucy5heGlzQS5jbG9uZSgpIDogbmV3IFZlYzMoMSwgMCwgMCk7CiAgICAgIHRoaXMuYXhpc0IgPSBvcHRpb25zLmF4aXNCID8gb3B0aW9ucy5heGlzQi5jbG9uZSgpIDogbmV3IFZlYzMoMCwgMSwgMCk7CiAgICAgIHRoaXMuYW5nbGUgPSB0eXBlb2Ygb3B0aW9ucy5hbmdsZSAhPT0gJ3VuZGVmaW5lZCcgPyBvcHRpb25zLmFuZ2xlIDogMDsKICAgIH0KCiAgICBjb21wdXRlQihoKSB7CiAgICAgIGNvbnN0IGEgPSB0aGlzLmE7CiAgICAgIGNvbnN0IGIgPSB0aGlzLmI7CiAgICAgIGNvbnN0IG5pID0gdGhpcy5heGlzQTsKICAgICAgY29uc3QgbmogPSB0aGlzLmF4aXNCOwogICAgICBjb25zdCBuaXhuaiA9IHRtcFZlYzEkMjsKICAgICAgY29uc3Qgbmp4bmkgPSB0bXBWZWMyJDI7CiAgICAgIGNvbnN0IEdBID0gdGhpcy5qYWNvYmlhbkVsZW1lbnRBOwogICAgICBjb25zdCBHQiA9IHRoaXMuamFjb2JpYW5FbGVtZW50QjsgLy8gQ2FsdWNsYXRlIGNyb3NzIHByb2R1Y3RzCgogICAgICBuaS5jcm9zcyhuaiwgbml4bmopOwogICAgICBuai5jcm9zcyhuaSwgbmp4bmkpOyAvLyBUaGUgYW5nbGUgYmV0d2VlbiB0d28gdmVjdG9yIGlzOgogICAgICAvLyBjb3ModGhldGEpID0gYSAqIGIgLyAobGVuZ3RoKGEpICogbGVuZ3RoKGIpID0geyBsZW4oYSkgPSBsZW4oYikgPSAxIH0gPSBhICogYgogICAgICAvLyBnID0gYSAqIGIKICAgICAgLy8gZ2RvdCA9IChiIHggYSkgKiB3aSArIChhIHggYikgKiB3agogICAgICAvLyBHID0gWzAgYnhhIDAgYXhiXQogICAgICAvLyBXID0gW3ZpIHdpIHZqIHdqXQoKICAgICAgR0Eucm90YXRpb25hbC5jb3B5KG5qeG5pKTsKICAgICAgR0Iucm90YXRpb25hbC5jb3B5KG5peG5qKTsKICAgICAgY29uc3QgZyA9IE1hdGguY29zKHRoaXMuYW5nbGUpIC0gbmkuZG90KG5qKTsKICAgICAgY29uc3QgR1cgPSB0aGlzLmNvbXB1dGVHVygpOwogICAgICBjb25zdCBHaU1mID0gdGhpcy5jb21wdXRlR2lNZigpOwogICAgICBjb25zdCBCID0gLWcgKiBhIC0gR1cgKiBiIC0gaCAqIEdpTWY7CiAgICAgIHJldHVybiBCOwogICAgfQoKICB9CiAgY29uc3QgdG1wVmVjMSQyID0gbmV3IFZlYzMoKTsKICBjb25zdCB0bXBWZWMyJDIgPSBuZXcgVmVjMygpOwoKICAvKioKICAgKiBSb3RhdGlvbmFsIGNvbnN0cmFpbnQuIFdvcmtzIHRvIGtlZXAgdGhlIGxvY2FsIHZlY3RvcnMgb3J0aG9nb25hbCB0byBlYWNoIG90aGVyIGluIHdvcmxkIHNwYWNlLgogICAqLwogIGNsYXNzIFJvdGF0aW9uYWxFcXVhdGlvbiBleHRlbmRzIEVxdWF0aW9uIHsKICAgIC8qKgogICAgICogV29ybGQgb3JpZW50ZWQgcm90YXRpb25hbCBheGlzLgogICAgICovCgogICAgLyoqCiAgICAgKiBXb3JsZCBvcmllbnRlZCByb3RhdGlvbmFsIGF4aXMuCiAgICAgKi8KCiAgICAvKioKICAgICAqIG1heEFuZ2xlCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKGJvZHlBLCBib2R5Qiwgb3B0aW9ucykgewogICAgICBpZiAob3B0aW9ucyA9PT0gdm9pZCAwKSB7CiAgICAgICAgb3B0aW9ucyA9IHt9OwogICAgICB9CgogICAgICBjb25zdCBtYXhGb3JjZSA9IHR5cGVvZiBvcHRpb25zLm1heEZvcmNlICE9PSAndW5kZWZpbmVkJyA/IG9wdGlvbnMubWF4Rm9yY2UgOiAxZTY7CiAgICAgIHN1cGVyKGJvZHlBLCBib2R5QiwgLW1heEZvcmNlLCBtYXhGb3JjZSk7CiAgICAgIHRoaXMuYXhpc0EgPSBvcHRpb25zLmF4aXNBID8gb3B0aW9ucy5heGlzQS5jbG9uZSgpIDogbmV3IFZlYzMoMSwgMCwgMCk7CiAgICAgIHRoaXMuYXhpc0IgPSBvcHRpb25zLmF4aXNCID8gb3B0aW9ucy5heGlzQi5jbG9uZSgpIDogbmV3IFZlYzMoMCwgMSwgMCk7CiAgICAgIHRoaXMubWF4QW5nbGUgPSBNYXRoLlBJIC8gMjsKICAgIH0KCiAgICBjb21wdXRlQihoKSB7CiAgICAgIGNvbnN0IGEgPSB0aGlzLmE7CiAgICAgIGNvbnN0IGIgPSB0aGlzLmI7CiAgICAgIGNvbnN0IG5pID0gdGhpcy5heGlzQTsKICAgICAgY29uc3QgbmogPSB0aGlzLmF4aXNCOwogICAgICBjb25zdCBuaXhuaiA9IHRtcFZlYzEkMTsKICAgICAgY29uc3Qgbmp4bmkgPSB0bXBWZWMyJDE7CiAgICAgIGNvbnN0IEdBID0gdGhpcy5qYWNvYmlhbkVsZW1lbnRBOwogICAgICBjb25zdCBHQiA9IHRoaXMuamFjb2JpYW5FbGVtZW50QjsgLy8gQ2FsdWNsYXRlIGNyb3NzIHByb2R1Y3RzCgogICAgICBuaS5jcm9zcyhuaiwgbml4bmopOwogICAgICBuai5jcm9zcyhuaSwgbmp4bmkpOyAvLyBnID0gbmkgKiBuagogICAgICAvLyBnZG90ID0gKG5qIHggbmkpICogd2kgKyAobmkgeCBuaikgKiB3agogICAgICAvLyBHID0gWzAgbmp4bmkgMCBuaXhual0KICAgICAgLy8gVyA9IFt2aSB3aSB2aiB3al0KCiAgICAgIEdBLnJvdGF0aW9uYWwuY29weShuanhuaSk7CiAgICAgIEdCLnJvdGF0aW9uYWwuY29weShuaXhuaik7CiAgICAgIGNvbnN0IGcgPSBNYXRoLmNvcyh0aGlzLm1heEFuZ2xlKSAtIG5pLmRvdChuaik7CiAgICAgIGNvbnN0IEdXID0gdGhpcy5jb21wdXRlR1coKTsKICAgICAgY29uc3QgR2lNZiA9IHRoaXMuY29tcHV0ZUdpTWYoKTsKICAgICAgY29uc3QgQiA9IC1nICogYSAtIEdXICogYiAtIGggKiBHaU1mOwogICAgICByZXR1cm4gQjsKICAgIH0KCiAgfQogIGNvbnN0IHRtcFZlYzEkMSA9IG5ldyBWZWMzKCk7CiAgY29uc3QgdG1wVmVjMiQxID0gbmV3IFZlYzMoKTsKCiAgLyoqCiAgICogQSBDb25lIFR3aXN0IGNvbnN0cmFpbnQsIHVzZWZ1bCBmb3IgcmFnZG9sbHMuCiAgICovCiAgY2xhc3MgQ29uZVR3aXN0Q29uc3RyYWludCBleHRlbmRzIFBvaW50VG9Qb2ludENvbnN0cmFpbnQgewogICAgLyoqCiAgICAgKiBUaGUgYXhpcyBkaXJlY3Rpb24gZm9yIHRoZSBjb25zdHJhaW50IG9mIHRoZSBib2R5IEEuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFRoZSBheGlzIGRpcmVjdGlvbiBmb3IgdGhlIGNvbnN0cmFpbnQgb2YgdGhlIGJvZHkgQi4KICAgICAqLwoKICAgIC8qKgogICAgICogVGhlIGFwZXJ0dXJlIGFuZ2xlIG9mIHRoZSBjb25lLgogICAgICovCgogICAgLyoqCiAgICAgKiBUaGUgdHdpc3QgYW5nbGUgb2YgdGhlIGpvaW50LgogICAgICovCiAgICBjb25zdHJ1Y3Rvcihib2R5QSwgYm9keUIsIG9wdGlvbnMpIHsKICAgICAgaWYgKG9wdGlvbnMgPT09IHZvaWQgMCkgewogICAgICAgIG9wdGlvbnMgPSB7fTsKICAgICAgfQoKICAgICAgY29uc3QgbWF4Rm9yY2UgPSB0eXBlb2Ygb3B0aW9ucy5tYXhGb3JjZSAhPT0gJ3VuZGVmaW5lZCcgPyBvcHRpb25zLm1heEZvcmNlIDogMWU2OyAvLyBTZXQgcGl2b3QgcG9pbnQgaW4gYmV0d2VlbgoKICAgICAgY29uc3QgcGl2b3RBID0gb3B0aW9ucy5waXZvdEEgPyBvcHRpb25zLnBpdm90QS5jbG9uZSgpIDogbmV3IFZlYzMoKTsKICAgICAgY29uc3QgcGl2b3RCID0gb3B0aW9ucy5waXZvdEIgPyBvcHRpb25zLnBpdm90Qi5jbG9uZSgpIDogbmV3IFZlYzMoKTsKICAgICAgc3VwZXIoYm9keUEsIHBpdm90QSwgYm9keUIsIHBpdm90QiwgbWF4Rm9yY2UpOwogICAgICB0aGlzLmF4aXNBID0gb3B0aW9ucy5heGlzQSA/IG9wdGlvbnMuYXhpc0EuY2xvbmUoKSA6IG5ldyBWZWMzKCk7CiAgICAgIHRoaXMuYXhpc0IgPSBvcHRpb25zLmF4aXNCID8gb3B0aW9ucy5heGlzQi5jbG9uZSgpIDogbmV3IFZlYzMoKTsKICAgICAgdGhpcy5jb2xsaWRlQ29ubmVjdGVkID0gISFvcHRpb25zLmNvbGxpZGVDb25uZWN0ZWQ7CiAgICAgIHRoaXMuYW5nbGUgPSB0eXBlb2Ygb3B0aW9ucy5hbmdsZSAhPT0gJ3VuZGVmaW5lZCcgPyBvcHRpb25zLmFuZ2xlIDogMDsKICAgICAgY29uc3QgYyA9IHRoaXMuY29uZUVxdWF0aW9uID0gbmV3IENvbmVFcXVhdGlvbihib2R5QSwgYm9keUIsIG9wdGlvbnMpOwogICAgICBjb25zdCB0ID0gdGhpcy50d2lzdEVxdWF0aW9uID0gbmV3IFJvdGF0aW9uYWxFcXVhdGlvbihib2R5QSwgYm9keUIsIG9wdGlvbnMpOwogICAgICB0aGlzLnR3aXN0QW5nbGUgPSB0eXBlb2Ygb3B0aW9ucy50d2lzdEFuZ2xlICE9PSAndW5kZWZpbmVkJyA/IG9wdGlvbnMudHdpc3RBbmdsZSA6IDA7IC8vIE1ha2UgdGhlIGNvbmUgZXF1YXRpb24gcHVzaCB0aGUgYm9kaWVzIHRvd2FyZCB0aGUgY29uZSBheGlzLCBub3Qgb3V0d2FyZAoKICAgICAgYy5tYXhGb3JjZSA9IDA7CiAgICAgIGMubWluRm9yY2UgPSAtbWF4Rm9yY2U7IC8vIE1ha2UgdGhlIHR3aXN0IGVxdWF0aW9uIGFkZCB0b3JxdWUgdG93YXJkIHRoZSBpbml0aWFsIHBvc2l0aW9uCgogICAgICB0Lm1heEZvcmNlID0gMDsKICAgICAgdC5taW5Gb3JjZSA9IC1tYXhGb3JjZTsKICAgICAgdGhpcy5lcXVhdGlvbnMucHVzaChjLCB0KTsKICAgIH0KCiAgICB1cGRhdGUoKSB7CiAgICAgIGNvbnN0IGJvZHlBID0gdGhpcy5ib2R5QTsKICAgICAgY29uc3QgYm9keUIgPSB0aGlzLmJvZHlCOwogICAgICBjb25zdCBjb25lID0gdGhpcy5jb25lRXF1YXRpb247CiAgICAgIGNvbnN0IHR3aXN0ID0gdGhpcy50d2lzdEVxdWF0aW9uOwogICAgICBzdXBlci51cGRhdGUoKTsgLy8gVXBkYXRlIHRoZSBheGVzIHRvIHRoZSBjb25lIGNvbnN0cmFpbnQKCiAgICAgIGJvZHlBLnZlY3RvclRvV29ybGRGcmFtZSh0aGlzLmF4aXNBLCBjb25lLmF4aXNBKTsKICAgICAgYm9keUIudmVjdG9yVG9Xb3JsZEZyYW1lKHRoaXMuYXhpc0IsIGNvbmUuYXhpc0IpOyAvLyBVcGRhdGUgdGhlIHdvcmxkIGF4ZXMgaW4gdGhlIHR3aXN0IGNvbnN0cmFpbnQKCiAgICAgIHRoaXMuYXhpc0EudGFuZ2VudHModHdpc3QuYXhpc0EsIHR3aXN0LmF4aXNBKTsKICAgICAgYm9keUEudmVjdG9yVG9Xb3JsZEZyYW1lKHR3aXN0LmF4aXNBLCB0d2lzdC5heGlzQSk7CiAgICAgIHRoaXMuYXhpc0IudGFuZ2VudHModHdpc3QuYXhpc0IsIHR3aXN0LmF4aXNCKTsKICAgICAgYm9keUIudmVjdG9yVG9Xb3JsZEZyYW1lKHR3aXN0LmF4aXNCLCB0d2lzdC5heGlzQik7CiAgICAgIGNvbmUuYW5nbGUgPSB0aGlzLmFuZ2xlOwogICAgICB0d2lzdC5tYXhBbmdsZSA9IHRoaXMudHdpc3RBbmdsZTsKICAgIH0KCiAgfQogIG5ldyBWZWMzKCk7CiAgbmV3IFZlYzMoKTsKCiAgLyoqCiAgICogQ29uc3RyYWlucyB0d28gYm9kaWVzIHRvIGJlIGF0IGEgY29uc3RhbnQgZGlzdGFuY2UgZnJvbSBlYWNoIG90aGVycyBjZW50ZXIgb2YgbWFzcy4KICAgKi8KICBjbGFzcyBEaXN0YW5jZUNvbnN0cmFpbnQgZXh0ZW5kcyBDb25zdHJhaW50IHsKICAgIC8qKgogICAgICogVGhlIGRpc3RhbmNlIHRvIGtlZXAuIElmIHVuZGVmaW5lZCwgaXQgd2lsbCBiZSBzZXQgdG8gdGhlIGN1cnJlbnQgZGlzdGFuY2UgYmV0d2VlbiBib2R5QSBhbmQgYm9keUIKICAgICAqLwoKICAgIC8qKgogICAgICogQHBhcmFtIGRpc3RhbmNlIFRoZSBkaXN0YW5jZSB0byBrZWVwLiBJZiB1bmRlZmluZWQsIGl0IHdpbGwgYmUgc2V0IHRvIHRoZSBjdXJyZW50IGRpc3RhbmNlIGJldHdlZW4gYm9keUEgYW5kIGJvZHlCLgogICAgICogQHBhcmFtIG1heEZvcmNlIFRoZSBtYXhpbXVtIGZvcmNlIHRoYXQgc2hvdWxkIGJlIGFwcGxpZWQgdG8gY29uc3RyYWluIHRoZSBib2RpZXMuCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKGJvZHlBLCBib2R5QiwgZGlzdGFuY2UsIG1heEZvcmNlKSB7CiAgICAgIGlmIChtYXhGb3JjZSA9PT0gdm9pZCAwKSB7CiAgICAgICAgbWF4Rm9yY2UgPSAxZTY7CiAgICAgIH0KCiAgICAgIHN1cGVyKGJvZHlBLCBib2R5Qik7CgogICAgICBpZiAodHlwZW9mIGRpc3RhbmNlID09PSAndW5kZWZpbmVkJykgewogICAgICAgIGRpc3RhbmNlID0gYm9keUEucG9zaXRpb24uZGlzdGFuY2VUbyhib2R5Qi5wb3NpdGlvbik7CiAgICAgIH0KCiAgICAgIHRoaXMuZGlzdGFuY2UgPSBkaXN0YW5jZTsKICAgICAgY29uc3QgZXEgPSB0aGlzLmRpc3RhbmNlRXF1YXRpb24gPSBuZXcgQ29udGFjdEVxdWF0aW9uKGJvZHlBLCBib2R5Qik7CiAgICAgIHRoaXMuZXF1YXRpb25zLnB1c2goZXEpOyAvLyBNYWtlIGl0IGJpZGlyZWN0aW9uYWwKCiAgICAgIGVxLm1pbkZvcmNlID0gLW1heEZvcmNlOwogICAgICBlcS5tYXhGb3JjZSA9IG1heEZvcmNlOwogICAgfQogICAgLyoqCiAgICAgKiB1cGRhdGUKICAgICAqLwoKCiAgICB1cGRhdGUoKSB7CiAgICAgIGNvbnN0IGJvZHlBID0gdGhpcy5ib2R5QTsKICAgICAgY29uc3QgYm9keUIgPSB0aGlzLmJvZHlCOwogICAgICBjb25zdCBlcSA9IHRoaXMuZGlzdGFuY2VFcXVhdGlvbjsKICAgICAgY29uc3QgaGFsZkRpc3QgPSB0aGlzLmRpc3RhbmNlICogMC41OwogICAgICBjb25zdCBub3JtYWwgPSBlcS5uaTsKICAgICAgYm9keUIucG9zaXRpb24udnN1Yihib2R5QS5wb3NpdGlvbiwgbm9ybWFsKTsKICAgICAgbm9ybWFsLm5vcm1hbGl6ZSgpOwogICAgICBub3JtYWwuc2NhbGUoaGFsZkRpc3QsIGVxLnJpKTsKICAgICAgbm9ybWFsLnNjYWxlKC1oYWxmRGlzdCwgZXEucmopOwogICAgfQoKICB9CgogIC8qKgogICAqIExvY2sgY29uc3RyYWludC4gV2lsbCByZW1vdmUgYWxsIGRlZ3JlZXMgb2YgZnJlZWRvbSBiZXR3ZWVuIHRoZSBib2RpZXMuCiAgICovCiAgY2xhc3MgTG9ja0NvbnN0cmFpbnQgZXh0ZW5kcyBQb2ludFRvUG9pbnRDb25zdHJhaW50IHsKICAgIGNvbnN0cnVjdG9yKGJvZHlBLCBib2R5Qiwgb3B0aW9ucykgewogICAgICBpZiAob3B0aW9ucyA9PT0gdm9pZCAwKSB7CiAgICAgICAgb3B0aW9ucyA9IHt9OwogICAgICB9CgogICAgICBjb25zdCBtYXhGb3JjZSA9IHR5cGVvZiBvcHRpb25zLm1heEZvcmNlICE9PSAndW5kZWZpbmVkJyA/IG9wdGlvbnMubWF4Rm9yY2UgOiAxZTY7IC8vIFNldCBwaXZvdCBwb2ludCBpbiBiZXR3ZWVuCgogICAgICBjb25zdCBwaXZvdEEgPSBuZXcgVmVjMygpOwogICAgICBjb25zdCBwaXZvdEIgPSBuZXcgVmVjMygpOwogICAgICBjb25zdCBoYWxmV2F5ID0gbmV3IFZlYzMoKTsKICAgICAgYm9keUEucG9zaXRpb24udmFkZChib2R5Qi5wb3NpdGlvbiwgaGFsZldheSk7CiAgICAgIGhhbGZXYXkuc2NhbGUoMC41LCBoYWxmV2F5KTsKICAgICAgYm9keUIucG9pbnRUb0xvY2FsRnJhbWUoaGFsZldheSwgcGl2b3RCKTsKICAgICAgYm9keUEucG9pbnRUb0xvY2FsRnJhbWUoaGFsZldheSwgcGl2b3RBKTsgLy8gVGhlIHBvaW50LXRvLXBvaW50IGNvbnN0cmFpbnQgd2lsbCBrZWVwIGEgcG9pbnQgc2hhcmVkIGJldHdlZW4gdGhlIGJvZGllcwoKICAgICAgc3VwZXIoYm9keUEsIHBpdm90QSwgYm9keUIsIHBpdm90QiwgbWF4Rm9yY2UpOyAvLyBTdG9yZSBpbml0aWFsIHJvdGF0aW9uIG9mIHRoZSBib2RpZXMgYXMgdW5pdCB2ZWN0b3JzIGluIHRoZSBsb2NhbCBib2R5IHNwYWNlcwoKICAgICAgdGhpcy54QSA9IGJvZHlBLnZlY3RvclRvTG9jYWxGcmFtZShWZWMzLlVOSVRfWCk7CiAgICAgIHRoaXMueEIgPSBib2R5Qi52ZWN0b3JUb0xvY2FsRnJhbWUoVmVjMy5VTklUX1gpOwogICAgICB0aGlzLnlBID0gYm9keUEudmVjdG9yVG9Mb2NhbEZyYW1lKFZlYzMuVU5JVF9ZKTsKICAgICAgdGhpcy55QiA9IGJvZHlCLnZlY3RvclRvTG9jYWxGcmFtZShWZWMzLlVOSVRfWSk7CiAgICAgIHRoaXMuekEgPSBib2R5QS52ZWN0b3JUb0xvY2FsRnJhbWUoVmVjMy5VTklUX1opOwogICAgICB0aGlzLnpCID0gYm9keUIudmVjdG9yVG9Mb2NhbEZyYW1lKFZlYzMuVU5JVF9aKTsgLy8gLi4uYW5kIHRoZSBmb2xsb3dpbmcgcm90YXRpb25hbCBlcXVhdGlvbnMgd2lsbCBrZWVwIGFsbCByb3RhdGlvbmFsIERPRidzIGluIHBsYWNlCgogICAgICBjb25zdCByMSA9IHRoaXMucm90YXRpb25hbEVxdWF0aW9uMSA9IG5ldyBSb3RhdGlvbmFsRXF1YXRpb24oYm9keUEsIGJvZHlCLCBvcHRpb25zKTsKICAgICAgY29uc3QgcjIgPSB0aGlzLnJvdGF0aW9uYWxFcXVhdGlvbjIgPSBuZXcgUm90YXRpb25hbEVxdWF0aW9uKGJvZHlBLCBib2R5Qiwgb3B0aW9ucyk7CiAgICAgIGNvbnN0IHIzID0gdGhpcy5yb3RhdGlvbmFsRXF1YXRpb24zID0gbmV3IFJvdGF0aW9uYWxFcXVhdGlvbihib2R5QSwgYm9keUIsIG9wdGlvbnMpOwogICAgICB0aGlzLmVxdWF0aW9ucy5wdXNoKHIxLCByMiwgcjMpOwogICAgfQogICAgLyoqCiAgICAgKiB1cGRhdGUKICAgICAqLwoKCiAgICB1cGRhdGUoKSB7CiAgICAgIGNvbnN0IGJvZHlBID0gdGhpcy5ib2R5QTsKICAgICAgY29uc3QgYm9keUIgPSB0aGlzLmJvZHlCOwogICAgICB0aGlzLm1vdG9yRXF1YXRpb247CiAgICAgIGNvbnN0IHIxID0gdGhpcy5yb3RhdGlvbmFsRXF1YXRpb24xOwogICAgICBjb25zdCByMiA9IHRoaXMucm90YXRpb25hbEVxdWF0aW9uMjsKICAgICAgY29uc3QgcjMgPSB0aGlzLnJvdGF0aW9uYWxFcXVhdGlvbjM7CiAgICAgIHN1cGVyLnVwZGF0ZSgpOyAvLyBUaGVzZSB2ZWN0b3IgcGFpcnMgbXVzdCBiZSBvcnRob2dvbmFsCgogICAgICBib2R5QS52ZWN0b3JUb1dvcmxkRnJhbWUodGhpcy54QSwgcjEuYXhpc0EpOwogICAgICBib2R5Qi52ZWN0b3JUb1dvcmxkRnJhbWUodGhpcy55QiwgcjEuYXhpc0IpOwogICAgICBib2R5QS52ZWN0b3JUb1dvcmxkRnJhbWUodGhpcy55QSwgcjIuYXhpc0EpOwogICAgICBib2R5Qi52ZWN0b3JUb1dvcmxkRnJhbWUodGhpcy56QiwgcjIuYXhpc0IpOwogICAgICBib2R5QS52ZWN0b3JUb1dvcmxkRnJhbWUodGhpcy56QSwgcjMuYXhpc0EpOwogICAgICBib2R5Qi52ZWN0b3JUb1dvcmxkRnJhbWUodGhpcy54QiwgcjMuYXhpc0IpOwogICAgfQoKICB9CiAgbmV3IFZlYzMoKTsKICBuZXcgVmVjMygpOwoKICAvKioKICAgKiBSb3RhdGlvbmFsIG1vdG9yIGNvbnN0cmFpbnQuIFRyaWVzIHRvIGtlZXAgdGhlIHJlbGF0aXZlIGFuZ3VsYXIgdmVsb2NpdHkgb2YgdGhlIGJvZGllcyB0byBhIGdpdmVuIHZhbHVlLgogICAqLwogIGNsYXNzIFJvdGF0aW9uYWxNb3RvckVxdWF0aW9uIGV4dGVuZHMgRXF1YXRpb24gewogICAgLyoqCiAgICAgKiBXb3JsZCBvcmllbnRlZCByb3RhdGlvbmFsIGF4aXMuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFdvcmxkIG9yaWVudGVkIHJvdGF0aW9uYWwgYXhpcy4KICAgICAqLwoKICAgIC8qKgogICAgICogTW90b3IgdmVsb2NpdHkuCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKGJvZHlBLCBib2R5QiwgbWF4Rm9yY2UpIHsKICAgICAgaWYgKG1heEZvcmNlID09PSB2b2lkIDApIHsKICAgICAgICBtYXhGb3JjZSA9IDFlNjsKICAgICAgfQoKICAgICAgc3VwZXIoYm9keUEsIGJvZHlCLCAtbWF4Rm9yY2UsIG1heEZvcmNlKTsKICAgICAgdGhpcy5heGlzQSA9IG5ldyBWZWMzKCk7CiAgICAgIHRoaXMuYXhpc0IgPSBuZXcgVmVjMygpOwogICAgICB0aGlzLnRhcmdldFZlbG9jaXR5ID0gMDsKICAgIH0KCiAgICBjb21wdXRlQihoKSB7CiAgICAgIHRoaXMuYTsKICAgICAgY29uc3QgYiA9IHRoaXMuYjsKICAgICAgdGhpcy5iaTsKICAgICAgdGhpcy5iajsKICAgICAgY29uc3QgYXhpc0EgPSB0aGlzLmF4aXNBOwogICAgICBjb25zdCBheGlzQiA9IHRoaXMuYXhpc0I7CiAgICAgIGNvbnN0IEdBID0gdGhpcy5qYWNvYmlhbkVsZW1lbnRBOwogICAgICBjb25zdCBHQiA9IHRoaXMuamFjb2JpYW5FbGVtZW50QjsgLy8gZyA9IDAKICAgICAgLy8gZ2RvdCA9IGF4aXNBICogd2kgLSBheGlzQiAqIHdqCiAgICAgIC8vIGdkb3QgPSBHICogVyA9IEcgKiBbdmkgd2kgdmogd2pdCiAgICAgIC8vID0+CiAgICAgIC8vIEcgPSBbMCBheGlzQSAwIC1heGlzQl0KCiAgICAgIEdBLnJvdGF0aW9uYWwuY29weShheGlzQSk7CiAgICAgIGF4aXNCLm5lZ2F0ZShHQi5yb3RhdGlvbmFsKTsKICAgICAgY29uc3QgR1cgPSB0aGlzLmNvbXB1dGVHVygpIC0gdGhpcy50YXJnZXRWZWxvY2l0eTsKICAgICAgY29uc3QgR2lNZiA9IHRoaXMuY29tcHV0ZUdpTWYoKTsKICAgICAgY29uc3QgQiA9IC1HVyAqIGIgLSBoICogR2lNZjsKICAgICAgcmV0dXJuIEI7CiAgICB9CgogIH0KCiAgLyoqCiAgICogSGluZ2UgY29uc3RyYWludC4gVGhpbmsgb2YgaXQgYXMgYSBkb29yIGhpbmdlLiBJdCB0cmllcyB0byBrZWVwIHRoZSBkb29yIGluIHRoZSBjb3JyZWN0IHBsYWNlIGFuZCB3aXRoIHRoZSBjb3JyZWN0IG9yaWVudGF0aW9uLgogICAqLwogIGNsYXNzIEhpbmdlQ29uc3RyYWludCBleHRlbmRzIFBvaW50VG9Qb2ludENvbnN0cmFpbnQgewogICAgLyoqCiAgICAgKiBSb3RhdGlvbiBheGlzLCBkZWZpbmVkIGxvY2FsbHkgaW4gYm9keUEuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFJvdGF0aW9uIGF4aXMsIGRlZmluZWQgbG9jYWxseSBpbiBib2R5Qi4KICAgICAqLwogICAgY29uc3RydWN0b3IoYm9keUEsIGJvZHlCLCBvcHRpb25zKSB7CiAgICAgIGlmIChvcHRpb25zID09PSB2b2lkIDApIHsKICAgICAgICBvcHRpb25zID0ge307CiAgICAgIH0KCiAgICAgIGNvbnN0IG1heEZvcmNlID0gdHlwZW9mIG9wdGlvbnMubWF4Rm9yY2UgIT09ICd1bmRlZmluZWQnID8gb3B0aW9ucy5tYXhGb3JjZSA6IDFlNjsKICAgICAgY29uc3QgcGl2b3RBID0gb3B0aW9ucy5waXZvdEEgPyBvcHRpb25zLnBpdm90QS5jbG9uZSgpIDogbmV3IFZlYzMoKTsKICAgICAgY29uc3QgcGl2b3RCID0gb3B0aW9ucy5waXZvdEIgPyBvcHRpb25zLnBpdm90Qi5jbG9uZSgpIDogbmV3IFZlYzMoKTsKICAgICAgc3VwZXIoYm9keUEsIHBpdm90QSwgYm9keUIsIHBpdm90QiwgbWF4Rm9yY2UpOwogICAgICBjb25zdCBheGlzQSA9IHRoaXMuYXhpc0EgPSBvcHRpb25zLmF4aXNBID8gb3B0aW9ucy5heGlzQS5jbG9uZSgpIDogbmV3IFZlYzMoMSwgMCwgMCk7CiAgICAgIGF4aXNBLm5vcm1hbGl6ZSgpOwogICAgICBjb25zdCBheGlzQiA9IHRoaXMuYXhpc0IgPSBvcHRpb25zLmF4aXNCID8gb3B0aW9ucy5heGlzQi5jbG9uZSgpIDogbmV3IFZlYzMoMSwgMCwgMCk7CiAgICAgIGF4aXNCLm5vcm1hbGl6ZSgpOwogICAgICB0aGlzLmNvbGxpZGVDb25uZWN0ZWQgPSAhIW9wdGlvbnMuY29sbGlkZUNvbm5lY3RlZDsKICAgICAgY29uc3Qgcm90YXRpb25hbDEgPSB0aGlzLnJvdGF0aW9uYWxFcXVhdGlvbjEgPSBuZXcgUm90YXRpb25hbEVxdWF0aW9uKGJvZHlBLCBib2R5Qiwgb3B0aW9ucyk7CiAgICAgIGNvbnN0IHJvdGF0aW9uYWwyID0gdGhpcy5yb3RhdGlvbmFsRXF1YXRpb24yID0gbmV3IFJvdGF0aW9uYWxFcXVhdGlvbihib2R5QSwgYm9keUIsIG9wdGlvbnMpOwogICAgICBjb25zdCBtb3RvciA9IHRoaXMubW90b3JFcXVhdGlvbiA9IG5ldyBSb3RhdGlvbmFsTW90b3JFcXVhdGlvbihib2R5QSwgYm9keUIsIG1heEZvcmNlKTsKICAgICAgbW90b3IuZW5hYmxlZCA9IGZhbHNlOyAvLyBOb3QgZW5hYmxlZCBieSBkZWZhdWx0CiAgICAgIC8vIEVxdWF0aW9ucyB0byBiZSBmZWQgdG8gdGhlIHNvbHZlcgoKICAgICAgdGhpcy5lcXVhdGlvbnMucHVzaChyb3RhdGlvbmFsMSwgcm90YXRpb25hbDIsIG1vdG9yKTsKICAgIH0KICAgIC8qKgogICAgICogZW5hYmxlTW90b3IKICAgICAqLwoKCiAgICBlbmFibGVNb3RvcigpIHsKICAgICAgdGhpcy5tb3RvckVxdWF0aW9uLmVuYWJsZWQgPSB0cnVlOwogICAgfQogICAgLyoqCiAgICAgKiBkaXNhYmxlTW90b3IKICAgICAqLwoKCiAgICBkaXNhYmxlTW90b3IoKSB7CiAgICAgIHRoaXMubW90b3JFcXVhdGlvbi5lbmFibGVkID0gZmFsc2U7CiAgICB9CiAgICAvKioKICAgICAqIHNldE1vdG9yU3BlZWQKICAgICAqLwoKCiAgICBzZXRNb3RvclNwZWVkKHNwZWVkKSB7CiAgICAgIHRoaXMubW90b3JFcXVhdGlvbi50YXJnZXRWZWxvY2l0eSA9IHNwZWVkOwogICAgfQogICAgLyoqCiAgICAgKiBzZXRNb3Rvck1heEZvcmNlCiAgICAgKi8KCgogICAgc2V0TW90b3JNYXhGb3JjZShtYXhGb3JjZSkgewogICAgICB0aGlzLm1vdG9yRXF1YXRpb24ubWF4Rm9yY2UgPSBtYXhGb3JjZTsKICAgICAgdGhpcy5tb3RvckVxdWF0aW9uLm1pbkZvcmNlID0gLW1heEZvcmNlOwogICAgfQogICAgLyoqCiAgICAgKiB1cGRhdGUKICAgICAqLwoKCiAgICB1cGRhdGUoKSB7CiAgICAgIGNvbnN0IGJvZHlBID0gdGhpcy5ib2R5QTsKICAgICAgY29uc3QgYm9keUIgPSB0aGlzLmJvZHlCOwogICAgICBjb25zdCBtb3RvciA9IHRoaXMubW90b3JFcXVhdGlvbjsKICAgICAgY29uc3QgcjEgPSB0aGlzLnJvdGF0aW9uYWxFcXVhdGlvbjE7CiAgICAgIGNvbnN0IHIyID0gdGhpcy5yb3RhdGlvbmFsRXF1YXRpb24yOwogICAgICBjb25zdCB3b3JsZEF4aXNBID0gSGluZ2VDb25zdHJhaW50X3VwZGF0ZV90bXBWZWMxOwogICAgICBjb25zdCB3b3JsZEF4aXNCID0gSGluZ2VDb25zdHJhaW50X3VwZGF0ZV90bXBWZWMyOwogICAgICBjb25zdCBheGlzQSA9IHRoaXMuYXhpc0E7CiAgICAgIGNvbnN0IGF4aXNCID0gdGhpcy5heGlzQjsKICAgICAgc3VwZXIudXBkYXRlKCk7IC8vIEdldCB3b3JsZCBheGVzCgogICAgICBib2R5QS5xdWF0ZXJuaW9uLnZtdWx0KGF4aXNBLCB3b3JsZEF4aXNBKTsKICAgICAgYm9keUIucXVhdGVybmlvbi52bXVsdChheGlzQiwgd29ybGRBeGlzQik7CiAgICAgIHdvcmxkQXhpc0EudGFuZ2VudHMocjEuYXhpc0EsIHIyLmF4aXNBKTsKICAgICAgcjEuYXhpc0IuY29weSh3b3JsZEF4aXNCKTsKICAgICAgcjIuYXhpc0IuY29weSh3b3JsZEF4aXNCKTsKCiAgICAgIGlmICh0aGlzLm1vdG9yRXF1YXRpb24uZW5hYmxlZCkgewogICAgICAgIGJvZHlBLnF1YXRlcm5pb24udm11bHQodGhpcy5heGlzQSwgbW90b3IuYXhpc0EpOwogICAgICAgIGJvZHlCLnF1YXRlcm5pb24udm11bHQodGhpcy5heGlzQiwgbW90b3IuYXhpc0IpOwogICAgICB9CiAgICB9CgogIH0KICBjb25zdCBIaW5nZUNvbnN0cmFpbnRfdXBkYXRlX3RtcFZlYzEgPSBuZXcgVmVjMygpOwogIGNvbnN0IEhpbmdlQ29uc3RyYWludF91cGRhdGVfdG1wVmVjMiA9IG5ldyBWZWMzKCk7CgogIC8qKgogICAqIENvbnN0cmFpbnMgdGhlIHNsaXBwaW5nIGluIGEgY29udGFjdCBhbG9uZyBhIHRhbmdlbnQKICAgKi8KICBjbGFzcyBGcmljdGlvbkVxdWF0aW9uIGV4dGVuZHMgRXF1YXRpb24gewogICAgLy8gVGFuZ2VudAoKICAgIC8qKgogICAgICogQHBhcmFtIHNsaXBGb3JjZSBzaG91bGQgYmUgKy1GX2ZyaWN0aW9uID0gKy1tdSAqIEZfbm9ybWFsID0gKy1tdSAqIG0gKiBnCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKGJvZHlBLCBib2R5Qiwgc2xpcEZvcmNlKSB7CiAgICAgIHN1cGVyKGJvZHlBLCBib2R5QiwgLXNsaXBGb3JjZSwgc2xpcEZvcmNlKTsKICAgICAgdGhpcy5yaSA9IG5ldyBWZWMzKCk7CiAgICAgIHRoaXMucmogPSBuZXcgVmVjMygpOwogICAgICB0aGlzLnQgPSBuZXcgVmVjMygpOwogICAgfQoKICAgIGNvbXB1dGVCKGgpIHsKICAgICAgdGhpcy5hOwogICAgICBjb25zdCBiID0gdGhpcy5iOwogICAgICB0aGlzLmJpOwogICAgICB0aGlzLmJqOwogICAgICBjb25zdCByaSA9IHRoaXMucmk7CiAgICAgIGNvbnN0IHJqID0gdGhpcy5yajsKICAgICAgY29uc3Qgcml4dCA9IEZyaWN0aW9uRXF1YXRpb25fY29tcHV0ZUJfdGVtcDE7CiAgICAgIGNvbnN0IHJqeHQgPSBGcmljdGlvbkVxdWF0aW9uX2NvbXB1dGVCX3RlbXAyOwogICAgICBjb25zdCB0ID0gdGhpcy50OyAvLyBDYWx1Y2xhdGUgY3Jvc3MgcHJvZHVjdHMKCiAgICAgIHJpLmNyb3NzKHQsIHJpeHQpOwogICAgICByai5jcm9zcyh0LCByanh0KTsgLy8gRyA9IFstdCAtcml4dCB0IHJqeHRdCiAgICAgIC8vIEFuZCByZW1lbWJlciwgdGhpcyBpcyBhIHB1cmUgdmVsb2NpdHkgY29uc3RyYWludCwgZyBpcyBhbHdheXMgemVybyEKCiAgICAgIGNvbnN0IEdBID0gdGhpcy5qYWNvYmlhbkVsZW1lbnRBOwogICAgICBjb25zdCBHQiA9IHRoaXMuamFjb2JpYW5FbGVtZW50QjsKICAgICAgdC5uZWdhdGUoR0Euc3BhdGlhbCk7CiAgICAgIHJpeHQubmVnYXRlKEdBLnJvdGF0aW9uYWwpOwogICAgICBHQi5zcGF0aWFsLmNvcHkodCk7CiAgICAgIEdCLnJvdGF0aW9uYWwuY29weShyanh0KTsKICAgICAgY29uc3QgR1cgPSB0aGlzLmNvbXB1dGVHVygpOwogICAgICBjb25zdCBHaU1mID0gdGhpcy5jb21wdXRlR2lNZigpOwogICAgICBjb25zdCBCID0gLUdXICogYiAtIGggKiBHaU1mOwogICAgICByZXR1cm4gQjsKICAgIH0KCiAgfQogIGNvbnN0IEZyaWN0aW9uRXF1YXRpb25fY29tcHV0ZUJfdGVtcDEgPSBuZXcgVmVjMygpOwogIGNvbnN0IEZyaWN0aW9uRXF1YXRpb25fY29tcHV0ZUJfdGVtcDIgPSBuZXcgVmVjMygpOwoKICAvKioKICAgKiBEZWZpbmVzIHdoYXQgaGFwcGVucyB3aGVuIHR3byBtYXRlcmlhbHMgbWVldC4KICAgKiBAdG9kbyBSZWZhY3RvciBtYXRlcmlhbHMgdG8gbWF0ZXJpYWxBIGFuZCBtYXRlcmlhbEIKICAgKi8KICBjbGFzcyBDb250YWN0TWF0ZXJpYWwgewogICAgLyoqCiAgICAgKiBJZGVudGlmaWVyIG9mIHRoaXMgbWF0ZXJpYWwuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFBhcnRpY2lwYXRpbmcgbWF0ZXJpYWxzLgogICAgICovCgogICAgLyoqCiAgICAgKiBGcmljdGlvbiBjb2VmZmljaWVudC4KICAgICAqIEBkZWZhdWx0IDAuMwogICAgICovCgogICAgLyoqCiAgICAgKiBSZXN0aXR1dGlvbiBjb2VmZmljaWVudC4KICAgICAqIEBkZWZhdWx0IDAuMwogICAgICovCgogICAgLyoqCiAgICAgKiBTdGlmZm5lc3Mgb2YgdGhlIHByb2R1Y2VkIGNvbnRhY3QgZXF1YXRpb25zLgogICAgICogQGRlZmF1bHQgMWU3CiAgICAgKi8KCiAgICAvKioKICAgICAqIFJlbGF4YXRpb24gdGltZSBvZiB0aGUgcHJvZHVjZWQgY29udGFjdCBlcXVhdGlvbnMuCiAgICAgKiBAZGVmYXVsdCAzCiAgICAgKi8KCiAgICAvKioKICAgICAqIFN0aWZmbmVzcyBvZiB0aGUgcHJvZHVjZWQgZnJpY3Rpb24gZXF1YXRpb25zLgogICAgICogQGRlZmF1bHQgMWU3CiAgICAgKi8KCiAgICAvKioKICAgICAqIFJlbGF4YXRpb24gdGltZSBvZiB0aGUgcHJvZHVjZWQgZnJpY3Rpb24gZXF1YXRpb25zCiAgICAgKiBAZGVmYXVsdCAzCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKG0xLCBtMiwgb3B0aW9ucykgewogICAgICBvcHRpb25zID0gVXRpbHMuZGVmYXVsdHMob3B0aW9ucywgewogICAgICAgIGZyaWN0aW9uOiAwLjMsCiAgICAgICAgcmVzdGl0dXRpb246IDAuMywKICAgICAgICBjb250YWN0RXF1YXRpb25TdGlmZm5lc3M6IDFlNywKICAgICAgICBjb250YWN0RXF1YXRpb25SZWxheGF0aW9uOiAzLAogICAgICAgIGZyaWN0aW9uRXF1YXRpb25TdGlmZm5lc3M6IDFlNywKICAgICAgICBmcmljdGlvbkVxdWF0aW9uUmVsYXhhdGlvbjogMwogICAgICB9KTsKICAgICAgdGhpcy5pZCA9IENvbnRhY3RNYXRlcmlhbC5pZENvdW50ZXIrKzsKICAgICAgdGhpcy5tYXRlcmlhbHMgPSBbbTEsIG0yXTsKICAgICAgdGhpcy5mcmljdGlvbiA9IG9wdGlvbnMuZnJpY3Rpb247CiAgICAgIHRoaXMucmVzdGl0dXRpb24gPSBvcHRpb25zLnJlc3RpdHV0aW9uOwogICAgICB0aGlzLmNvbnRhY3RFcXVhdGlvblN0aWZmbmVzcyA9IG9wdGlvbnMuY29udGFjdEVxdWF0aW9uU3RpZmZuZXNzOwogICAgICB0aGlzLmNvbnRhY3RFcXVhdGlvblJlbGF4YXRpb24gPSBvcHRpb25zLmNvbnRhY3RFcXVhdGlvblJlbGF4YXRpb247CiAgICAgIHRoaXMuZnJpY3Rpb25FcXVhdGlvblN0aWZmbmVzcyA9IG9wdGlvbnMuZnJpY3Rpb25FcXVhdGlvblN0aWZmbmVzczsKICAgICAgdGhpcy5mcmljdGlvbkVxdWF0aW9uUmVsYXhhdGlvbiA9IG9wdGlvbnMuZnJpY3Rpb25FcXVhdGlvblJlbGF4YXRpb247CiAgICB9CgogIH0KICBDb250YWN0TWF0ZXJpYWwuaWRDb3VudGVyID0gMDsKCiAgLyoqCiAgICogRGVmaW5lcyBhIHBoeXNpY3MgbWF0ZXJpYWwuCiAgICovCiAgY2xhc3MgTWF0ZXJpYWwgewogICAgLyoqCiAgICAgKiBNYXRlcmlhbCBuYW1lLgogICAgICogSWYgb3B0aW9ucyBpcyBhIHN0cmluZywgbmFtZSB3aWxsIGJlIHNldCB0byB0aGF0IHN0cmluZy4KICAgICAqIEB0b2RvIERlcHJlY2F0ZSB0aGlzCiAgICAgKi8KCiAgICAvKiogTWF0ZXJpYWwgaWQuICovCgogICAgLyoqCiAgICAgKiBGcmljdGlvbiBmb3IgdGhpcyBtYXRlcmlhbC4KICAgICAqIElmIG5vbi1uZWdhdGl2ZSwgaXQgd2lsbCBiZSB1c2VkIGluc3RlYWQgb2YgdGhlIGZyaWN0aW9uIGdpdmVuIGJ5IENvbnRhY3RNYXRlcmlhbHMuIElmIHRoZXJlJ3Mgbm8gbWF0Y2hpbmcgQ29udGFjdE1hdGVyaWFsLCB0aGUgdmFsdWUgZnJvbSBgZGVmYXVsdENvbnRhY3RNYXRlcmlhbGAgaW4gdGhlIFdvcmxkIHdpbGwgYmUgdXNlZC4KICAgICAqLwoKICAgIC8qKgogICAgICogUmVzdGl0dXRpb24gZm9yIHRoaXMgbWF0ZXJpYWwuCiAgICAgKiBJZiBub24tbmVnYXRpdmUsIGl0IHdpbGwgYmUgdXNlZCBpbnN0ZWFkIG9mIHRoZSByZXN0aXR1dGlvbiBnaXZlbiBieSBDb250YWN0TWF0ZXJpYWxzLiBJZiB0aGVyZSdzIG5vIG1hdGNoaW5nIENvbnRhY3RNYXRlcmlhbCwgdGhlIHZhbHVlIGZyb20gYGRlZmF1bHRDb250YWN0TWF0ZXJpYWxgIGluIHRoZSBXb3JsZCB3aWxsIGJlIHVzZWQuCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKG9wdGlvbnMpIHsKICAgICAgaWYgKG9wdGlvbnMgPT09IHZvaWQgMCkgewogICAgICAgIG9wdGlvbnMgPSB7fTsKICAgICAgfQoKICAgICAgbGV0IG5hbWUgPSAnJzsgLy8gQmFja3dhcmRzIGNvbXBhdGliaWxpdHkgZml4CgogICAgICBpZiAodHlwZW9mIG9wdGlvbnMgPT09ICdzdHJpbmcnKSB7CiAgICAgICAgLy9jb25zb2xlLndhcm4oYFBhc3NpbmcgYSBzdHJpbmcgdG8gTWF0ZXJpYWxPcHRpb25zIGlzIGRlcHJlY2F0ZWQsIGFuZCBoYXMgbm8gZWZmZWN0YCkKICAgICAgICBuYW1lID0gb3B0aW9uczsKICAgICAgICBvcHRpb25zID0ge307CiAgICAgIH0KCiAgICAgIHRoaXMubmFtZSA9IG5hbWU7CiAgICAgIHRoaXMuaWQgPSBNYXRlcmlhbC5pZENvdW50ZXIrKzsKICAgICAgdGhpcy5mcmljdGlvbiA9IHR5cGVvZiBvcHRpb25zLmZyaWN0aW9uICE9PSAndW5kZWZpbmVkJyA/IG9wdGlvbnMuZnJpY3Rpb24gOiAtMTsKICAgICAgdGhpcy5yZXN0aXR1dGlvbiA9IHR5cGVvZiBvcHRpb25zLnJlc3RpdHV0aW9uICE9PSAndW5kZWZpbmVkJyA/IG9wdGlvbnMucmVzdGl0dXRpb24gOiAtMTsKICAgIH0KCiAgfQogIE1hdGVyaWFsLmlkQ291bnRlciA9IDA7CgogIC8qKgogICAqIEEgc3ByaW5nLCBjb25uZWN0aW5nIHR3byBib2RpZXMuCiAgICogQGV4YW1wbGUKICAgKiAgICAgY29uc3Qgc3ByaW5nID0gbmV3IFNwcmluZyhib3hCb2R5LCBzcGhlcmVCb2R5LCB7CiAgICogICAgICAgcmVzdExlbmd0aDogMCwKICAgKiAgICAgICBzdGlmZm5lc3M6IDUwLAogICAqICAgICAgIGRhbXBpbmc6IDEsCiAgICogICAgIH0pCiAgICoKICAgKiAgICAgLy8gQ29tcHV0ZSB0aGUgZm9yY2UgYWZ0ZXIgZWFjaCBzdGVwCiAgICogICAgIHdvcmxkLmFkZEV2ZW50TGlzdGVuZXIoJ3Bvc3RTdGVwJywgKGV2ZW50KSA9PiB7CiAgICogICAgICAgc3ByaW5nLmFwcGx5Rm9yY2UoKQogICAqICAgICB9KQogICAqLwogIGNsYXNzIFNwcmluZyB7CiAgICAvKioKICAgICAqIFJlc3QgbGVuZ3RoIG9mIHRoZSBzcHJpbmcuIEEgbnVtYmVyID4gMC4KICAgICAqIEBkZWZhdWx0IDEKICAgICAqLwoKICAgIC8qKgogICAgICogU3RpZmZuZXNzIG9mIHRoZSBzcHJpbmcuIEEgbnVtYmVyID49IDAuCiAgICAgKiBAZGVmYXVsdCAxMDAKICAgICAqLwoKICAgIC8qKgogICAgICogRGFtcGluZyBvZiB0aGUgc3ByaW5nLiBBIG51bWJlciA+PSAwLgogICAgICogQGRlZmF1bHQgMQogICAgICovCgogICAgLyoqCiAgICAgKiBGaXJzdCBjb25uZWN0ZWQgYm9keS4KICAgICAqLwoKICAgIC8qKgogICAgICogU2Vjb25kIGNvbm5lY3RlZCBib2R5LgogICAgICovCgogICAgLyoqCiAgICAgKiBBbmNob3IgZm9yIGJvZHlBIGluIGxvY2FsIGJvZHlBIGNvb3JkaW5hdGVzLgogICAgICogV2hlcmUgdG8gaG9vayB0aGUgc3ByaW5nIHRvIGJvZHkgQSwgaW4gbG9jYWwgYm9keSBjb29yZGluYXRlcy4KICAgICAqIEBkZWZhdWx0IG5ldyBWZWMzKCkKICAgICAqLwoKICAgIC8qKgogICAgICogQW5jaG9yIGZvciBib2R5QiBpbiBsb2NhbCBib2R5QiBjb29yZGluYXRlcy4KICAgICAqIFdoZXJlIHRvIGhvb2sgdGhlIHNwcmluZyB0byBib2R5IEIsIGluIGxvY2FsIGJvZHkgY29vcmRpbmF0ZXMuCiAgICAgKiBAZGVmYXVsdCBuZXcgVmVjMygpCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKGJvZHlBLCBib2R5Qiwgb3B0aW9ucykgewogICAgICBpZiAob3B0aW9ucyA9PT0gdm9pZCAwKSB7CiAgICAgICAgb3B0aW9ucyA9IHt9OwogICAgICB9CgogICAgICB0aGlzLnJlc3RMZW5ndGggPSB0eXBlb2Ygb3B0aW9ucy5yZXN0TGVuZ3RoID09PSAnbnVtYmVyJyA/IG9wdGlvbnMucmVzdExlbmd0aCA6IDE7CiAgICAgIHRoaXMuc3RpZmZuZXNzID0gb3B0aW9ucy5zdGlmZm5lc3MgfHwgMTAwOwogICAgICB0aGlzLmRhbXBpbmcgPSBvcHRpb25zLmRhbXBpbmcgfHwgMTsKICAgICAgdGhpcy5ib2R5QSA9IGJvZHlBOwogICAgICB0aGlzLmJvZHlCID0gYm9keUI7CiAgICAgIHRoaXMubG9jYWxBbmNob3JBID0gbmV3IFZlYzMoKTsKICAgICAgdGhpcy5sb2NhbEFuY2hvckIgPSBuZXcgVmVjMygpOwoKICAgICAgaWYgKG9wdGlvbnMubG9jYWxBbmNob3JBKSB7CiAgICAgICAgdGhpcy5sb2NhbEFuY2hvckEuY29weShvcHRpb25zLmxvY2FsQW5jaG9yQSk7CiAgICAgIH0KCiAgICAgIGlmIChvcHRpb25zLmxvY2FsQW5jaG9yQikgewogICAgICAgIHRoaXMubG9jYWxBbmNob3JCLmNvcHkob3B0aW9ucy5sb2NhbEFuY2hvckIpOwogICAgICB9CgogICAgICBpZiAob3B0aW9ucy53b3JsZEFuY2hvckEpIHsKICAgICAgICB0aGlzLnNldFdvcmxkQW5jaG9yQShvcHRpb25zLndvcmxkQW5jaG9yQSk7CiAgICAgIH0KCiAgICAgIGlmIChvcHRpb25zLndvcmxkQW5jaG9yQikgewogICAgICAgIHRoaXMuc2V0V29ybGRBbmNob3JCKG9wdGlvbnMud29ybGRBbmNob3JCKTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBTZXQgdGhlIGFuY2hvciBwb2ludCBvbiBib2R5IEEsIHVzaW5nIHdvcmxkIGNvb3JkaW5hdGVzLgogICAgICovCgoKICAgIHNldFdvcmxkQW5jaG9yQSh3b3JsZEFuY2hvckEpIHsKICAgICAgdGhpcy5ib2R5QS5wb2ludFRvTG9jYWxGcmFtZSh3b3JsZEFuY2hvckEsIHRoaXMubG9jYWxBbmNob3JBKTsKICAgIH0KICAgIC8qKgogICAgICogU2V0IHRoZSBhbmNob3IgcG9pbnQgb24gYm9keSBCLCB1c2luZyB3b3JsZCBjb29yZGluYXRlcy4KICAgICAqLwoKCiAgICBzZXRXb3JsZEFuY2hvckIod29ybGRBbmNob3JCKSB7CiAgICAgIHRoaXMuYm9keUIucG9pbnRUb0xvY2FsRnJhbWUod29ybGRBbmNob3JCLCB0aGlzLmxvY2FsQW5jaG9yQik7CiAgICB9CiAgICAvKioKICAgICAqIEdldCB0aGUgYW5jaG9yIHBvaW50IG9uIGJvZHkgQSwgaW4gd29ybGQgY29vcmRpbmF0ZXMuCiAgICAgKiBAcGFyYW0gcmVzdWx0IFRoZSB2ZWN0b3IgdG8gc3RvcmUgdGhlIHJlc3VsdCBpbi4KICAgICAqLwoKCiAgICBnZXRXb3JsZEFuY2hvckEocmVzdWx0KSB7CiAgICAgIHRoaXMuYm9keUEucG9pbnRUb1dvcmxkRnJhbWUodGhpcy5sb2NhbEFuY2hvckEsIHJlc3VsdCk7CiAgICB9CiAgICAvKioKICAgICAqIEdldCB0aGUgYW5jaG9yIHBvaW50IG9uIGJvZHkgQiwgaW4gd29ybGQgY29vcmRpbmF0ZXMuCiAgICAgKiBAcGFyYW0gcmVzdWx0IFRoZSB2ZWN0b3IgdG8gc3RvcmUgdGhlIHJlc3VsdCBpbi4KICAgICAqLwoKCiAgICBnZXRXb3JsZEFuY2hvckIocmVzdWx0KSB7CiAgICAgIHRoaXMuYm9keUIucG9pbnRUb1dvcmxkRnJhbWUodGhpcy5sb2NhbEFuY2hvckIsIHJlc3VsdCk7CiAgICB9CiAgICAvKioKICAgICAqIEFwcGx5IHRoZSBzcHJpbmcgZm9yY2UgdG8gdGhlIGNvbm5lY3RlZCBib2RpZXMuCiAgICAgKi8KCgogICAgYXBwbHlGb3JjZSgpIHsKICAgICAgY29uc3QgayA9IHRoaXMuc3RpZmZuZXNzOwogICAgICBjb25zdCBkID0gdGhpcy5kYW1waW5nOwogICAgICBjb25zdCBsID0gdGhpcy5yZXN0TGVuZ3RoOwogICAgICBjb25zdCBib2R5QSA9IHRoaXMuYm9keUE7CiAgICAgIGNvbnN0IGJvZHlCID0gdGhpcy5ib2R5QjsKICAgICAgY29uc3QgciA9IGFwcGx5Rm9yY2VfcjsKICAgICAgY29uc3Qgcl91bml0ID0gYXBwbHlGb3JjZV9yX3VuaXQ7CiAgICAgIGNvbnN0IHUgPSBhcHBseUZvcmNlX3U7CiAgICAgIGNvbnN0IGYgPSBhcHBseUZvcmNlX2Y7CiAgICAgIGNvbnN0IHRtcCA9IGFwcGx5Rm9yY2VfdG1wOwogICAgICBjb25zdCB3b3JsZEFuY2hvckEgPSBhcHBseUZvcmNlX3dvcmxkQW5jaG9yQTsKICAgICAgY29uc3Qgd29ybGRBbmNob3JCID0gYXBwbHlGb3JjZV93b3JsZEFuY2hvckI7CiAgICAgIGNvbnN0IHJpID0gYXBwbHlGb3JjZV9yaTsKICAgICAgY29uc3QgcmogPSBhcHBseUZvcmNlX3JqOwogICAgICBjb25zdCByaV94X2YgPSBhcHBseUZvcmNlX3JpX3hfZjsKICAgICAgY29uc3QgcmpfeF9mID0gYXBwbHlGb3JjZV9yal94X2Y7IC8vIEdldCB3b3JsZCBhbmNob3JzCgogICAgICB0aGlzLmdldFdvcmxkQW5jaG9yQSh3b3JsZEFuY2hvckEpOwogICAgICB0aGlzLmdldFdvcmxkQW5jaG9yQih3b3JsZEFuY2hvckIpOyAvLyBHZXQgb2Zmc2V0IHBvaW50cwoKICAgICAgd29ybGRBbmNob3JBLnZzdWIoYm9keUEucG9zaXRpb24sIHJpKTsKICAgICAgd29ybGRBbmNob3JCLnZzdWIoYm9keUIucG9zaXRpb24sIHJqKTsgLy8gQ29tcHV0ZSBkaXN0YW5jZSB2ZWN0b3IgYmV0d2VlbiB3b3JsZCBhbmNob3IgcG9pbnRzCgogICAgICB3b3JsZEFuY2hvckIudnN1Yih3b3JsZEFuY2hvckEsIHIpOwogICAgICBjb25zdCBybGVuID0gci5sZW5ndGgoKTsKICAgICAgcl91bml0LmNvcHkocik7CiAgICAgIHJfdW5pdC5ub3JtYWxpemUoKTsgLy8gQ29tcHV0ZSByZWxhdGl2ZSB2ZWxvY2l0eSBvZiB0aGUgYW5jaG9yIHBvaW50cywgdQoKICAgICAgYm9keUIudmVsb2NpdHkudnN1Yihib2R5QS52ZWxvY2l0eSwgdSk7IC8vIEFkZCByb3RhdGlvbmFsIHZlbG9jaXR5CgogICAgICBib2R5Qi5hbmd1bGFyVmVsb2NpdHkuY3Jvc3MocmosIHRtcCk7CiAgICAgIHUudmFkZCh0bXAsIHUpOwogICAgICBib2R5QS5hbmd1bGFyVmVsb2NpdHkuY3Jvc3MocmksIHRtcCk7CiAgICAgIHUudnN1Yih0bXAsIHUpOyAvLyBGID0gLSBrICogKCB4IC0gTCApIC0gRCAqICggdSApCgogICAgICByX3VuaXQuc2NhbGUoLWsgKiAocmxlbiAtIGwpIC0gZCAqIHUuZG90KHJfdW5pdCksIGYpOyAvLyBBZGQgZm9yY2VzIHRvIGJvZGllcwoKICAgICAgYm9keUEuZm9yY2UudnN1YihmLCBib2R5QS5mb3JjZSk7CiAgICAgIGJvZHlCLmZvcmNlLnZhZGQoZiwgYm9keUIuZm9yY2UpOyAvLyBBbmd1bGFyIGZvcmNlCgogICAgICByaS5jcm9zcyhmLCByaV94X2YpOwogICAgICByai5jcm9zcyhmLCByal94X2YpOwogICAgICBib2R5QS50b3JxdWUudnN1YihyaV94X2YsIGJvZHlBLnRvcnF1ZSk7CiAgICAgIGJvZHlCLnRvcnF1ZS52YWRkKHJqX3hfZiwgYm9keUIudG9ycXVlKTsKICAgIH0KCiAgfQogIGNvbnN0IGFwcGx5Rm9yY2VfciA9IG5ldyBWZWMzKCk7CiAgY29uc3QgYXBwbHlGb3JjZV9yX3VuaXQgPSBuZXcgVmVjMygpOwogIGNvbnN0IGFwcGx5Rm9yY2VfdSA9IG5ldyBWZWMzKCk7CiAgY29uc3QgYXBwbHlGb3JjZV9mID0gbmV3IFZlYzMoKTsKICBjb25zdCBhcHBseUZvcmNlX3dvcmxkQW5jaG9yQSA9IG5ldyBWZWMzKCk7CiAgY29uc3QgYXBwbHlGb3JjZV93b3JsZEFuY2hvckIgPSBuZXcgVmVjMygpOwogIGNvbnN0IGFwcGx5Rm9yY2VfcmkgPSBuZXcgVmVjMygpOwogIGNvbnN0IGFwcGx5Rm9yY2VfcmogPSBuZXcgVmVjMygpOwogIGNvbnN0IGFwcGx5Rm9yY2VfcmlfeF9mID0gbmV3IFZlYzMoKTsKICBjb25zdCBhcHBseUZvcmNlX3JqX3hfZiA9IG5ldyBWZWMzKCk7CiAgY29uc3QgYXBwbHlGb3JjZV90bXAgPSBuZXcgVmVjMygpOwoKICAvKioKICAgKiBXaGVlbEluZm8KICAgKi8KICBjbGFzcyBXaGVlbEluZm8gewogICAgLyoqCiAgICAgKiBNYXggdHJhdmVsIGRpc3RhbmNlIG9mIHRoZSBzdXNwZW5zaW9uLCBpbiBtZXRlcnMuCiAgICAgKiBAZGVmYXVsdCAxCiAgICAgKi8KCiAgICAvKioKICAgICAqIFNwZWVkIHRvIGFwcGx5IHRvIHRoZSB3aGVlbCByb3RhdGlvbiB3aGVuIHRoZSB3aGVlbCBpcyBzbGlkaW5nLgogICAgICogQGRlZmF1bHQgLTAuMQogICAgICovCgogICAgLyoqCiAgICAgKiBJZiB0aGUgY3VzdG9tU2xpZGluZ1JvdGF0aW9uYWxTcGVlZCBzaG91bGQgYmUgdXNlZC4KICAgICAqIEBkZWZhdWx0IGZhbHNlCiAgICAgKi8KCiAgICAvKioKICAgICAqIHNsaWRpbmcKICAgICAqLwoKICAgIC8qKgogICAgICogQ29ubmVjdGlvbiBwb2ludCwgZGVmaW5lZCBsb2NhbGx5IGluIHRoZSBjaGFzc2lzIGJvZHkgZnJhbWUuCiAgICAgKi8KCiAgICAvKioKICAgICAqIGNoYXNzaXNDb25uZWN0aW9uUG9pbnRXb3JsZAogICAgICovCgogICAgLyoqCiAgICAgKiBkaXJlY3Rpb25Mb2NhbAogICAgICovCgogICAgLyoqCiAgICAgKiBkaXJlY3Rpb25Xb3JsZAogICAgICovCgogICAgLyoqCiAgICAgKiBheGxlTG9jYWwKICAgICAqLwoKICAgIC8qKgogICAgICogYXhsZVdvcmxkCiAgICAgKi8KCiAgICAvKioKICAgICAqIHN1c3BlbnNpb25SZXN0TGVuZ3RoCiAgICAgKiBAZGVmYXVsdCAxCiAgICAgKi8KCiAgICAvKioKICAgICAqIHN1c3BlbnNpb25NYXhMZW5ndGgKICAgICAqIEBkZWZhdWx0IDIKICAgICAqLwoKICAgIC8qKgogICAgICogcmFkaXVzCiAgICAgKiBAZGVmYXVsdCAxCiAgICAgKi8KCiAgICAvKioKICAgICAqIHN1c3BlbnNpb25TdGlmZm5lc3MKICAgICAqIEBkZWZhdWx0IDEwMAogICAgICovCgogICAgLyoqCiAgICAgKiBkYW1waW5nQ29tcHJlc3Npb24KICAgICAqIEBkZWZhdWx0IDEwCiAgICAgKi8KCiAgICAvKioKICAgICAqIGRhbXBpbmdSZWxheGF0aW9uCiAgICAgKiBAZGVmYXVsdCAxMAogICAgICovCgogICAgLyoqCiAgICAgKiBmcmljdGlvblNsaXAKICAgICAqIEBkZWZhdWx0IDEwLjUKICAgICAqLwoKICAgIC8qKiBmb3J3YXJkQWNjZWxlcmF0aW9uICovCgogICAgLyoqIHNpZGVBY2NlbGVyYXRpb24gKi8KCiAgICAvKioKICAgICAqIHN0ZWVyaW5nCiAgICAgKiBAZGVmYXVsdCAwCiAgICAgKi8KCiAgICAvKioKICAgICAqIFJvdGF0aW9uIHZhbHVlLCBpbiByYWRpYW5zLgogICAgICogQGRlZmF1bHQgMAogICAgICovCgogICAgLyoqCiAgICAgKiBkZWx0YVJvdGF0aW9uCiAgICAgKiBAZGVmYXVsdCAwCiAgICAgKi8KCiAgICAvKioKICAgICAqIHJvbGxJbmZsdWVuY2UKICAgICAqIEBkZWZhdWx0IDAuMDEKICAgICAqLwoKICAgIC8qKgogICAgICogbWF4U3VzcGVuc2lvbkZvcmNlCiAgICAgKi8KCiAgICAvKioKICAgICAqIGVuZ2luZUZvcmNlCiAgICAgKi8KCiAgICAvKioKICAgICAqIGJyYWtlCiAgICAgKi8KCiAgICAvKioKICAgICAqIGlzRnJvbnRXaGVlbAogICAgICogQGRlZmF1bHQgdHJ1ZQogICAgICovCgogICAgLyoqCiAgICAgKiBjbGlwcGVkSW52Q29udGFjdERvdFN1c3BlbnNpb24KICAgICAqIEBkZWZhdWx0IDEKICAgICAqLwoKICAgIC8qKgogICAgICogc3VzcGVuc2lvblJlbGF0aXZlVmVsb2NpdHkKICAgICAqIEBkZWZhdWx0IDAKICAgICAqLwoKICAgIC8qKgogICAgICogc3VzcGVuc2lvbkZvcmNlCiAgICAgKiBAZGVmYXVsdCAwCiAgICAgKi8KCiAgICAvKioKICAgICAqIHNsaXBJbmZvCiAgICAgKi8KCiAgICAvKioKICAgICAqIHNraWRJbmZvCiAgICAgKiBAZGVmYXVsdCAwCiAgICAgKi8KCiAgICAvKioKICAgICAqIHN1c3BlbnNpb25MZW5ndGgKICAgICAqIEBkZWZhdWx0IDAKICAgICAqLwoKICAgIC8qKgogICAgICogc2lkZUltcHVsc2UKICAgICAqLwoKICAgIC8qKgogICAgICogZm9yd2FyZEltcHVsc2UKICAgICAqLwoKICAgIC8qKgogICAgICogVGhlIHJlc3VsdCBmcm9tIHJheWNhc3RpbmcuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFdoZWVsIHdvcmxkIHRyYW5zZm9ybS4KICAgICAqLwoKICAgIC8qKgogICAgICogaXNJbkNvbnRhY3QKICAgICAqLwogICAgY29uc3RydWN0b3Iob3B0aW9ucykgewogICAgICBpZiAob3B0aW9ucyA9PT0gdm9pZCAwKSB7CiAgICAgICAgb3B0aW9ucyA9IHt9OwogICAgICB9CgogICAgICBvcHRpb25zID0gVXRpbHMuZGVmYXVsdHMob3B0aW9ucywgewogICAgICAgIGNoYXNzaXNDb25uZWN0aW9uUG9pbnRMb2NhbDogbmV3IFZlYzMoKSwKICAgICAgICBjaGFzc2lzQ29ubmVjdGlvblBvaW50V29ybGQ6IG5ldyBWZWMzKCksCiAgICAgICAgZGlyZWN0aW9uTG9jYWw6IG5ldyBWZWMzKCksCiAgICAgICAgZGlyZWN0aW9uV29ybGQ6IG5ldyBWZWMzKCksCiAgICAgICAgYXhsZUxvY2FsOiBuZXcgVmVjMygpLAogICAgICAgIGF4bGVXb3JsZDogbmV3IFZlYzMoKSwKICAgICAgICBzdXNwZW5zaW9uUmVzdExlbmd0aDogMSwKICAgICAgICBzdXNwZW5zaW9uTWF4TGVuZ3RoOiAyLAogICAgICAgIHJhZGl1czogMSwKICAgICAgICBzdXNwZW5zaW9uU3RpZmZuZXNzOiAxMDAsCiAgICAgICAgZGFtcGluZ0NvbXByZXNzaW9uOiAxMCwKICAgICAgICBkYW1waW5nUmVsYXhhdGlvbjogMTAsCiAgICAgICAgZnJpY3Rpb25TbGlwOiAxMC41LAogICAgICAgIGZvcndhcmRBY2NlbGVyYXRpb246IDEsCiAgICAgICAgc2lkZUFjY2VsZXJhdGlvbjogMSwKICAgICAgICBzdGVlcmluZzogMCwKICAgICAgICByb3RhdGlvbjogMCwKICAgICAgICBkZWx0YVJvdGF0aW9uOiAwLAogICAgICAgIHJvbGxJbmZsdWVuY2U6IDAuMDEsCiAgICAgICAgbWF4U3VzcGVuc2lvbkZvcmNlOiBOdW1iZXIuTUFYX1ZBTFVFLAogICAgICAgIGlzRnJvbnRXaGVlbDogdHJ1ZSwKICAgICAgICBjbGlwcGVkSW52Q29udGFjdERvdFN1c3BlbnNpb246IDEsCiAgICAgICAgc3VzcGVuc2lvblJlbGF0aXZlVmVsb2NpdHk6IDAsCiAgICAgICAgc3VzcGVuc2lvbkZvcmNlOiAwLAogICAgICAgIHNsaXBJbmZvOiAwLAogICAgICAgIHNraWRJbmZvOiAwLAogICAgICAgIHN1c3BlbnNpb25MZW5ndGg6IDAsCiAgICAgICAgbWF4U3VzcGVuc2lvblRyYXZlbDogMSwKICAgICAgICB1c2VDdXN0b21TbGlkaW5nUm90YXRpb25hbFNwZWVkOiBmYWxzZSwKICAgICAgICBjdXN0b21TbGlkaW5nUm90YXRpb25hbFNwZWVkOiAtMC4xCiAgICAgIH0pOwogICAgICB0aGlzLm1heFN1c3BlbnNpb25UcmF2ZWwgPSBvcHRpb25zLm1heFN1c3BlbnNpb25UcmF2ZWw7CiAgICAgIHRoaXMuY3VzdG9tU2xpZGluZ1JvdGF0aW9uYWxTcGVlZCA9IG9wdGlvbnMuY3VzdG9tU2xpZGluZ1JvdGF0aW9uYWxTcGVlZDsKICAgICAgdGhpcy51c2VDdXN0b21TbGlkaW5nUm90YXRpb25hbFNwZWVkID0gb3B0aW9ucy51c2VDdXN0b21TbGlkaW5nUm90YXRpb25hbFNwZWVkOwogICAgICB0aGlzLnNsaWRpbmcgPSBmYWxzZTsKICAgICAgdGhpcy5jaGFzc2lzQ29ubmVjdGlvblBvaW50TG9jYWwgPSBvcHRpb25zLmNoYXNzaXNDb25uZWN0aW9uUG9pbnRMb2NhbC5jbG9uZSgpOwogICAgICB0aGlzLmNoYXNzaXNDb25uZWN0aW9uUG9pbnRXb3JsZCA9IG9wdGlvbnMuY2hhc3Npc0Nvbm5lY3Rpb25Qb2ludFdvcmxkLmNsb25lKCk7CiAgICAgIHRoaXMuZGlyZWN0aW9uTG9jYWwgPSBvcHRpb25zLmRpcmVjdGlvbkxvY2FsLmNsb25lKCk7CiAgICAgIHRoaXMuZGlyZWN0aW9uV29ybGQgPSBvcHRpb25zLmRpcmVjdGlvbldvcmxkLmNsb25lKCk7CiAgICAgIHRoaXMuYXhsZUxvY2FsID0gb3B0aW9ucy5heGxlTG9jYWwuY2xvbmUoKTsKICAgICAgdGhpcy5heGxlV29ybGQgPSBvcHRpb25zLmF4bGVXb3JsZC5jbG9uZSgpOwogICAgICB0aGlzLnN1c3BlbnNpb25SZXN0TGVuZ3RoID0gb3B0aW9ucy5zdXNwZW5zaW9uUmVzdExlbmd0aDsKICAgICAgdGhpcy5zdXNwZW5zaW9uTWF4TGVuZ3RoID0gb3B0aW9ucy5zdXNwZW5zaW9uTWF4TGVuZ3RoOwogICAgICB0aGlzLnJhZGl1cyA9IG9wdGlvbnMucmFkaXVzOwogICAgICB0aGlzLnN1c3BlbnNpb25TdGlmZm5lc3MgPSBvcHRpb25zLnN1c3BlbnNpb25TdGlmZm5lc3M7CiAgICAgIHRoaXMuZGFtcGluZ0NvbXByZXNzaW9uID0gb3B0aW9ucy5kYW1waW5nQ29tcHJlc3Npb247CiAgICAgIHRoaXMuZGFtcGluZ1JlbGF4YXRpb24gPSBvcHRpb25zLmRhbXBpbmdSZWxheGF0aW9uOwogICAgICB0aGlzLmZyaWN0aW9uU2xpcCA9IG9wdGlvbnMuZnJpY3Rpb25TbGlwOwogICAgICB0aGlzLmZvcndhcmRBY2NlbGVyYXRpb24gPSBvcHRpb25zLmZvcndhcmRBY2NlbGVyYXRpb247CiAgICAgIHRoaXMuc2lkZUFjY2VsZXJhdGlvbiA9IG9wdGlvbnMuc2lkZUFjY2VsZXJhdGlvbjsKICAgICAgdGhpcy5zdGVlcmluZyA9IDA7CiAgICAgIHRoaXMucm90YXRpb24gPSAwOwogICAgICB0aGlzLmRlbHRhUm90YXRpb24gPSAwOwogICAgICB0aGlzLnJvbGxJbmZsdWVuY2UgPSBvcHRpb25zLnJvbGxJbmZsdWVuY2U7CiAgICAgIHRoaXMubWF4U3VzcGVuc2lvbkZvcmNlID0gb3B0aW9ucy5tYXhTdXNwZW5zaW9uRm9yY2U7CiAgICAgIHRoaXMuZW5naW5lRm9yY2UgPSAwOwogICAgICB0aGlzLmJyYWtlID0gMDsKICAgICAgdGhpcy5pc0Zyb250V2hlZWwgPSBvcHRpb25zLmlzRnJvbnRXaGVlbDsKICAgICAgdGhpcy5jbGlwcGVkSW52Q29udGFjdERvdFN1c3BlbnNpb24gPSAxOwogICAgICB0aGlzLnN1c3BlbnNpb25SZWxhdGl2ZVZlbG9jaXR5ID0gMDsKICAgICAgdGhpcy5zdXNwZW5zaW9uRm9yY2UgPSAwOwogICAgICB0aGlzLnNsaXBJbmZvID0gMDsKICAgICAgdGhpcy5za2lkSW5mbyA9IDA7CiAgICAgIHRoaXMuc3VzcGVuc2lvbkxlbmd0aCA9IDA7CiAgICAgIHRoaXMuc2lkZUltcHVsc2UgPSAwOwogICAgICB0aGlzLmZvcndhcmRJbXB1bHNlID0gMDsKICAgICAgdGhpcy5yYXljYXN0UmVzdWx0ID0gbmV3IFJheWNhc3RSZXN1bHQoKTsKICAgICAgdGhpcy53b3JsZFRyYW5zZm9ybSA9IG5ldyBUcmFuc2Zvcm0oKTsKICAgICAgdGhpcy5pc0luQ29udGFjdCA9IGZhbHNlOwogICAgfQoKICAgIHVwZGF0ZVdoZWVsKGNoYXNzaXMpIHsKICAgICAgY29uc3QgcmF5Y2FzdFJlc3VsdCA9IHRoaXMucmF5Y2FzdFJlc3VsdDsKCiAgICAgIGlmICh0aGlzLmlzSW5Db250YWN0KSB7CiAgICAgICAgY29uc3QgcHJvamVjdCA9IHJheWNhc3RSZXN1bHQuaGl0Tm9ybWFsV29ybGQuZG90KHJheWNhc3RSZXN1bHQuZGlyZWN0aW9uV29ybGQpOwogICAgICAgIHJheWNhc3RSZXN1bHQuaGl0UG9pbnRXb3JsZC52c3ViKGNoYXNzaXMucG9zaXRpb24sIHJlbHBvcyk7CiAgICAgICAgY2hhc3Npcy5nZXRWZWxvY2l0eUF0V29ybGRQb2ludChyZWxwb3MsIGNoYXNzaXNfdmVsb2NpdHlfYXRfY29udGFjdFBvaW50KTsKICAgICAgICBjb25zdCBwcm9qVmVsID0gcmF5Y2FzdFJlc3VsdC5oaXROb3JtYWxXb3JsZC5kb3QoY2hhc3Npc192ZWxvY2l0eV9hdF9jb250YWN0UG9pbnQpOwoKICAgICAgICBpZiAocHJvamVjdCA+PSAtMC4xKSB7CiAgICAgICAgICB0aGlzLnN1c3BlbnNpb25SZWxhdGl2ZVZlbG9jaXR5ID0gMC4wOwogICAgICAgICAgdGhpcy5jbGlwcGVkSW52Q29udGFjdERvdFN1c3BlbnNpb24gPSAxLjAgLyAwLjE7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGNvbnN0IGludiA9IC0xIC8gcHJvamVjdDsKICAgICAgICAgIHRoaXMuc3VzcGVuc2lvblJlbGF0aXZlVmVsb2NpdHkgPSBwcm9qVmVsICogaW52OwogICAgICAgICAgdGhpcy5jbGlwcGVkSW52Q29udGFjdERvdFN1c3BlbnNpb24gPSBpbnY7CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIC8vIE5vdCBpbiBjb250YWN0IDogcG9zaXRpb24gd2hlZWwgaW4gYSBuaWNlIChyZXN0IGxlbmd0aCkgcG9zaXRpb24KICAgICAgICByYXljYXN0UmVzdWx0LnN1c3BlbnNpb25MZW5ndGggPSB0aGlzLnN1c3BlbnNpb25SZXN0TGVuZ3RoOwogICAgICAgIHRoaXMuc3VzcGVuc2lvblJlbGF0aXZlVmVsb2NpdHkgPSAwLjA7CiAgICAgICAgcmF5Y2FzdFJlc3VsdC5kaXJlY3Rpb25Xb3JsZC5zY2FsZSgtMSwgcmF5Y2FzdFJlc3VsdC5oaXROb3JtYWxXb3JsZCk7CiAgICAgICAgdGhpcy5jbGlwcGVkSW52Q29udGFjdERvdFN1c3BlbnNpb24gPSAxLjA7CiAgICAgIH0KICAgIH0KCiAgfQogIGNvbnN0IGNoYXNzaXNfdmVsb2NpdHlfYXRfY29udGFjdFBvaW50ID0gbmV3IFZlYzMoKTsKICBjb25zdCByZWxwb3MgPSBuZXcgVmVjMygpOwoKICAvKioKICAgKiBWZWhpY2xlIGhlbHBlciBjbGFzcyB0aGF0IGNhc3RzIHJheXMgZnJvbSB0aGUgd2hlZWwgcG9zaXRpb25zIHRvd2FyZHMgdGhlIGdyb3VuZCBhbmQgYXBwbGllcyBmb3JjZXMuCiAgICovCiAgY2xhc3MgUmF5Y2FzdFZlaGljbGUgewogICAgLyoqIFRoZSBjYXIgY2hhc3NpcyBib2R5LiAqLwoKICAgIC8qKiBUaGUgd2hlZWxzLiAqLwoKICAgIC8qKiBXaWxsIGJlIHNldCB0byB0cnVlIGlmIHRoZSBjYXIgaXMgc2xpZGluZy4gKi8KCiAgICAvKiogSW5kZXggb2YgdGhlIHJpZ2h0IGF4aXMuIHg9MCwgeT0xLCB6PTIgKi8KCiAgICAvKiogSW5kZXggb2YgdGhlIGZvcndhcmQgYXhpcy4geD0wLCB5PTEsIHo9MiAqLwoKICAgIC8qKiBJbmRleCBvZiB0aGUgdXAgYXhpcy4geD0wLCB5PTEsIHo9MiAqLwoKICAgIC8qKiBUaGUgY29uc3RyYWludHMuICovCgogICAgLyoqIE9wdGlvbmFsIHByZS1zdGVwIGNhbGxiYWNrLiAqLwoKICAgIC8qKiBOdW1iZXIgb2Ygd2hlZWxzIG9uIHRoZSBncm91bmQuICovCiAgICBjb25zdHJ1Y3RvcihvcHRpb25zKSB7CiAgICAgIHRoaXMuY2hhc3Npc0JvZHkgPSBvcHRpb25zLmNoYXNzaXNCb2R5OwogICAgICB0aGlzLndoZWVsSW5mb3MgPSBbXTsKICAgICAgdGhpcy5zbGlkaW5nID0gZmFsc2U7CiAgICAgIHRoaXMud29ybGQgPSBudWxsOwogICAgICB0aGlzLmluZGV4UmlnaHRBeGlzID0gdHlwZW9mIG9wdGlvbnMuaW5kZXhSaWdodEF4aXMgIT09ICd1bmRlZmluZWQnID8gb3B0aW9ucy5pbmRleFJpZ2h0QXhpcyA6IDI7CiAgICAgIHRoaXMuaW5kZXhGb3J3YXJkQXhpcyA9IHR5cGVvZiBvcHRpb25zLmluZGV4Rm9yd2FyZEF4aXMgIT09ICd1bmRlZmluZWQnID8gb3B0aW9ucy5pbmRleEZvcndhcmRBeGlzIDogMDsKICAgICAgdGhpcy5pbmRleFVwQXhpcyA9IHR5cGVvZiBvcHRpb25zLmluZGV4VXBBeGlzICE9PSAndW5kZWZpbmVkJyA/IG9wdGlvbnMuaW5kZXhVcEF4aXMgOiAxOwogICAgICB0aGlzLmNvbnN0cmFpbnRzID0gW107CgogICAgICB0aGlzLnByZVN0ZXBDYWxsYmFjayA9ICgpID0+IHt9OwoKICAgICAgdGhpcy5jdXJyZW50VmVoaWNsZVNwZWVkS21Ib3VyID0gMDsKICAgICAgdGhpcy5udW1XaGVlbHNPbkdyb3VuZCA9IDA7CiAgICB9CiAgICAvKioKICAgICAqIEFkZCBhIHdoZWVsLiBGb3IgaW5mb3JtYXRpb24gYWJvdXQgdGhlIG9wdGlvbnMsIHNlZSBgV2hlZWxJbmZvYC4KICAgICAqLwoKCiAgICBhZGRXaGVlbChvcHRpb25zKSB7CiAgICAgIGlmIChvcHRpb25zID09PSB2b2lkIDApIHsKICAgICAgICBvcHRpb25zID0ge307CiAgICAgIH0KCiAgICAgIGNvbnN0IGluZm8gPSBuZXcgV2hlZWxJbmZvKG9wdGlvbnMpOwogICAgICBjb25zdCBpbmRleCA9IHRoaXMud2hlZWxJbmZvcy5sZW5ndGg7CiAgICAgIHRoaXMud2hlZWxJbmZvcy5wdXNoKGluZm8pOwogICAgICByZXR1cm4gaW5kZXg7CiAgICB9CiAgICAvKioKICAgICAqIFNldCB0aGUgc3RlZXJpbmcgdmFsdWUgb2YgYSB3aGVlbC4KICAgICAqLwoKCiAgICBzZXRTdGVlcmluZ1ZhbHVlKHZhbHVlLCB3aGVlbEluZGV4KSB7CiAgICAgIGNvbnN0IHdoZWVsID0gdGhpcy53aGVlbEluZm9zW3doZWVsSW5kZXhdOwogICAgICB3aGVlbC5zdGVlcmluZyA9IHZhbHVlOwogICAgfQogICAgLyoqCiAgICAgKiBTZXQgdGhlIHdoZWVsIGZvcmNlIHRvIGFwcGx5IG9uIG9uZSBvZiB0aGUgd2hlZWxzIGVhY2ggdGltZSBzdGVwCiAgICAgKi8KCgogICAgYXBwbHlFbmdpbmVGb3JjZSh2YWx1ZSwgd2hlZWxJbmRleCkgewogICAgICB0aGlzLndoZWVsSW5mb3Nbd2hlZWxJbmRleF0uZW5naW5lRm9yY2UgPSB2YWx1ZTsKICAgIH0KICAgIC8qKgogICAgICogU2V0IHRoZSBicmFraW5nIGZvcmNlIG9mIGEgd2hlZWwKICAgICAqLwoKCiAgICBzZXRCcmFrZShicmFrZSwgd2hlZWxJbmRleCkgewogICAgICB0aGlzLndoZWVsSW5mb3Nbd2hlZWxJbmRleF0uYnJha2UgPSBicmFrZTsKICAgIH0KICAgIC8qKgogICAgICogQWRkIHRoZSB2ZWhpY2xlIGluY2x1ZGluZyBpdHMgY29uc3RyYWludHMgdG8gdGhlIHdvcmxkLgogICAgICovCgoKICAgIGFkZFRvV29ybGQod29ybGQpIHsKICAgICAgd29ybGQuYWRkQm9keSh0aGlzLmNoYXNzaXNCb2R5KTsKICAgICAgY29uc3QgdGhhdCA9IHRoaXM7CgogICAgICB0aGlzLnByZVN0ZXBDYWxsYmFjayA9ICgpID0+IHsKICAgICAgICB0aGF0LnVwZGF0ZVZlaGljbGUod29ybGQuZHQpOwogICAgICB9OwoKICAgICAgd29ybGQuYWRkRXZlbnRMaXN0ZW5lcigncHJlU3RlcCcsIHRoaXMucHJlU3RlcENhbGxiYWNrKTsKICAgICAgdGhpcy53b3JsZCA9IHdvcmxkOwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgb25lIG9mIHRoZSB3aGVlbCBheGxlcywgd29ybGQtb3JpZW50ZWQuCiAgICAgKi8KCgogICAgZ2V0VmVoaWNsZUF4aXNXb3JsZChheGlzSW5kZXgsIHJlc3VsdCkgewogICAgICByZXN1bHQuc2V0KGF4aXNJbmRleCA9PT0gMCA/IDEgOiAwLCBheGlzSW5kZXggPT09IDEgPyAxIDogMCwgYXhpc0luZGV4ID09PSAyID8gMSA6IDApOwogICAgICB0aGlzLmNoYXNzaXNCb2R5LnZlY3RvclRvV29ybGRGcmFtZShyZXN1bHQsIHJlc3VsdCk7CiAgICB9CgogICAgdXBkYXRlVmVoaWNsZSh0aW1lU3RlcCkgewogICAgICBjb25zdCB3aGVlbEluZm9zID0gdGhpcy53aGVlbEluZm9zOwogICAgICBjb25zdCBudW1XaGVlbHMgPSB3aGVlbEluZm9zLmxlbmd0aDsKICAgICAgY29uc3QgY2hhc3Npc0JvZHkgPSB0aGlzLmNoYXNzaXNCb2R5OwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBudW1XaGVlbHM7IGkrKykgewogICAgICAgIHRoaXMudXBkYXRlV2hlZWxUcmFuc2Zvcm0oaSk7CiAgICAgIH0KCiAgICAgIHRoaXMuY3VycmVudFZlaGljbGVTcGVlZEttSG91ciA9IDMuNiAqIGNoYXNzaXNCb2R5LnZlbG9jaXR5Lmxlbmd0aCgpOwogICAgICBjb25zdCBmb3J3YXJkV29ybGQgPSBuZXcgVmVjMygpOwogICAgICB0aGlzLmdldFZlaGljbGVBeGlzV29ybGQodGhpcy5pbmRleEZvcndhcmRBeGlzLCBmb3J3YXJkV29ybGQpOwoKICAgICAgaWYgKGZvcndhcmRXb3JsZC5kb3QoY2hhc3Npc0JvZHkudmVsb2NpdHkpIDwgMCkgewogICAgICAgIHRoaXMuY3VycmVudFZlaGljbGVTcGVlZEttSG91ciAqPSAtMTsKICAgICAgfSAvLyBzaW11bGF0ZSBzdXNwZW5zaW9uCgoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBudW1XaGVlbHM7IGkrKykgewogICAgICAgIHRoaXMuY2FzdFJheSh3aGVlbEluZm9zW2ldKTsKICAgICAgfQoKICAgICAgdGhpcy51cGRhdGVTdXNwZW5zaW9uKHRpbWVTdGVwKTsKICAgICAgY29uc3QgaW1wdWxzZSA9IG5ldyBWZWMzKCk7CiAgICAgIGNvbnN0IHJlbHBvcyA9IG5ldyBWZWMzKCk7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IG51bVdoZWVsczsgaSsrKSB7CiAgICAgICAgLy9hcHBseSBzdXNwZW5zaW9uIGZvcmNlCiAgICAgICAgY29uc3Qgd2hlZWwgPSB3aGVlbEluZm9zW2ldOwogICAgICAgIGxldCBzdXNwZW5zaW9uRm9yY2UgPSB3aGVlbC5zdXNwZW5zaW9uRm9yY2U7CgogICAgICAgIGlmIChzdXNwZW5zaW9uRm9yY2UgPiB3aGVlbC5tYXhTdXNwZW5zaW9uRm9yY2UpIHsKICAgICAgICAgIHN1c3BlbnNpb25Gb3JjZSA9IHdoZWVsLm1heFN1c3BlbnNpb25Gb3JjZTsKICAgICAgICB9CgogICAgICAgIHdoZWVsLnJheWNhc3RSZXN1bHQuaGl0Tm9ybWFsV29ybGQuc2NhbGUoc3VzcGVuc2lvbkZvcmNlICogdGltZVN0ZXAsIGltcHVsc2UpOwogICAgICAgIHdoZWVsLnJheWNhc3RSZXN1bHQuaGl0UG9pbnRXb3JsZC52c3ViKGNoYXNzaXNCb2R5LnBvc2l0aW9uLCByZWxwb3MpOwogICAgICAgIGNoYXNzaXNCb2R5LmFwcGx5SW1wdWxzZShpbXB1bHNlLCByZWxwb3MpOwogICAgICB9CgogICAgICB0aGlzLnVwZGF0ZUZyaWN0aW9uKHRpbWVTdGVwKTsKICAgICAgY29uc3QgaGl0Tm9ybWFsV29ybGRTY2FsZWRXaXRoUHJvaiA9IG5ldyBWZWMzKCk7CiAgICAgIGNvbnN0IGZ3ZCA9IG5ldyBWZWMzKCk7CiAgICAgIGNvbnN0IHZlbCA9IG5ldyBWZWMzKCk7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IG51bVdoZWVsczsgaSsrKSB7CiAgICAgICAgY29uc3Qgd2hlZWwgPSB3aGVlbEluZm9zW2ldOyAvL2NvbnN0IHJlbHBvcyA9IG5ldyBWZWMzKCk7CiAgICAgICAgLy93aGVlbC5jaGFzc2lzQ29ubmVjdGlvblBvaW50V29ybGQudnN1YihjaGFzc2lzQm9keS5wb3NpdGlvbiwgcmVscG9zKTsKCiAgICAgICAgY2hhc3Npc0JvZHkuZ2V0VmVsb2NpdHlBdFdvcmxkUG9pbnQod2hlZWwuY2hhc3Npc0Nvbm5lY3Rpb25Qb2ludFdvcmxkLCB2ZWwpOyAvLyBIYWNrIHRvIGdldCB0aGUgcm90YXRpb24gaW4gdGhlIGNvcnJlY3QgZGlyZWN0aW9uCgogICAgICAgIGxldCBtID0gMTsKCiAgICAgICAgc3dpdGNoICh0aGlzLmluZGV4VXBBeGlzKSB7CiAgICAgICAgICBjYXNlIDE6CiAgICAgICAgICAgIG0gPSAtMTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgfQoKICAgICAgICBpZiAod2hlZWwuaXNJbkNvbnRhY3QpIHsKICAgICAgICAgIHRoaXMuZ2V0VmVoaWNsZUF4aXNXb3JsZCh0aGlzLmluZGV4Rm9yd2FyZEF4aXMsIGZ3ZCk7CiAgICAgICAgICBjb25zdCBwcm9qID0gZndkLmRvdCh3aGVlbC5yYXljYXN0UmVzdWx0LmhpdE5vcm1hbFdvcmxkKTsKICAgICAgICAgIHdoZWVsLnJheWNhc3RSZXN1bHQuaGl0Tm9ybWFsV29ybGQuc2NhbGUocHJvaiwgaGl0Tm9ybWFsV29ybGRTY2FsZWRXaXRoUHJvaik7CiAgICAgICAgICBmd2QudnN1YihoaXROb3JtYWxXb3JsZFNjYWxlZFdpdGhQcm9qLCBmd2QpOwogICAgICAgICAgY29uc3QgcHJvajIgPSBmd2QuZG90KHZlbCk7CiAgICAgICAgICB3aGVlbC5kZWx0YVJvdGF0aW9uID0gbSAqIHByb2oyICogdGltZVN0ZXAgLyB3aGVlbC5yYWRpdXM7CiAgICAgICAgfQoKICAgICAgICBpZiAoKHdoZWVsLnNsaWRpbmcgfHwgIXdoZWVsLmlzSW5Db250YWN0KSAmJiB3aGVlbC5lbmdpbmVGb3JjZSAhPT0gMCAmJiB3aGVlbC51c2VDdXN0b21TbGlkaW5nUm90YXRpb25hbFNwZWVkKSB7CiAgICAgICAgICAvLyBBcHBseSBjdXN0b20gcm90YXRpb24gd2hlbiBhY2NlbGVyYXRpbmcgYW5kIHNsaWRpbmcKICAgICAgICAgIHdoZWVsLmRlbHRhUm90YXRpb24gPSAod2hlZWwuZW5naW5lRm9yY2UgPiAwID8gMSA6IC0xKSAqIHdoZWVsLmN1c3RvbVNsaWRpbmdSb3RhdGlvbmFsU3BlZWQgKiB0aW1lU3RlcDsKICAgICAgICB9IC8vIExvY2sgd2hlZWxzCgoKICAgICAgICBpZiAoTWF0aC5hYnMod2hlZWwuYnJha2UpID4gTWF0aC5hYnMod2hlZWwuZW5naW5lRm9yY2UpKSB7CiAgICAgICAgICB3aGVlbC5kZWx0YVJvdGF0aW9uID0gMDsKICAgICAgICB9CgogICAgICAgIHdoZWVsLnJvdGF0aW9uICs9IHdoZWVsLmRlbHRhUm90YXRpb247IC8vIFVzZSB0aGUgb2xkIHZhbHVlCgogICAgICAgIHdoZWVsLmRlbHRhUm90YXRpb24gKj0gMC45OTsgLy8gZGFtcGluZyBvZiByb3RhdGlvbiB3aGVuIG5vdCBpbiBjb250YWN0CiAgICAgIH0KICAgIH0KCiAgICB1cGRhdGVTdXNwZW5zaW9uKGRlbHRhVGltZSkgewogICAgICBjb25zdCBjaGFzc2lzQm9keSA9IHRoaXMuY2hhc3Npc0JvZHk7CiAgICAgIGNvbnN0IGNoYXNzaXNNYXNzID0gY2hhc3Npc0JvZHkubWFzczsKICAgICAgY29uc3Qgd2hlZWxJbmZvcyA9IHRoaXMud2hlZWxJbmZvczsKICAgICAgY29uc3QgbnVtV2hlZWxzID0gd2hlZWxJbmZvcy5sZW5ndGg7CgogICAgICBmb3IgKGxldCB3X2l0ID0gMDsgd19pdCA8IG51bVdoZWVsczsgd19pdCsrKSB7CiAgICAgICAgY29uc3Qgd2hlZWwgPSB3aGVlbEluZm9zW3dfaXRdOwoKICAgICAgICBpZiAod2hlZWwuaXNJbkNvbnRhY3QpIHsKICAgICAgICAgIGxldCBmb3JjZTsgLy8gU3ByaW5nCgogICAgICAgICAgY29uc3Qgc3VzcF9sZW5ndGggPSB3aGVlbC5zdXNwZW5zaW9uUmVzdExlbmd0aDsKICAgICAgICAgIGNvbnN0IGN1cnJlbnRfbGVuZ3RoID0gd2hlZWwuc3VzcGVuc2lvbkxlbmd0aDsKICAgICAgICAgIGNvbnN0IGxlbmd0aF9kaWZmID0gc3VzcF9sZW5ndGggLSBjdXJyZW50X2xlbmd0aDsKICAgICAgICAgIGZvcmNlID0gd2hlZWwuc3VzcGVuc2lvblN0aWZmbmVzcyAqIGxlbmd0aF9kaWZmICogd2hlZWwuY2xpcHBlZEludkNvbnRhY3REb3RTdXNwZW5zaW9uOyAvLyBEYW1wZXIKCiAgICAgICAgICBjb25zdCBwcm9qZWN0ZWRfcmVsX3ZlbCA9IHdoZWVsLnN1c3BlbnNpb25SZWxhdGl2ZVZlbG9jaXR5OwogICAgICAgICAgbGV0IHN1c3BfZGFtcGluZzsKCiAgICAgICAgICBpZiAocHJvamVjdGVkX3JlbF92ZWwgPCAwKSB7CiAgICAgICAgICAgIHN1c3BfZGFtcGluZyA9IHdoZWVsLmRhbXBpbmdDb21wcmVzc2lvbjsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHN1c3BfZGFtcGluZyA9IHdoZWVsLmRhbXBpbmdSZWxheGF0aW9uOwogICAgICAgICAgfQoKICAgICAgICAgIGZvcmNlIC09IHN1c3BfZGFtcGluZyAqIHByb2plY3RlZF9yZWxfdmVsOwogICAgICAgICAgd2hlZWwuc3VzcGVuc2lvbkZvcmNlID0gZm9yY2UgKiBjaGFzc2lzTWFzczsKCiAgICAgICAgICBpZiAod2hlZWwuc3VzcGVuc2lvbkZvcmNlIDwgMCkgewogICAgICAgICAgICB3aGVlbC5zdXNwZW5zaW9uRm9yY2UgPSAwOwogICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB3aGVlbC5zdXNwZW5zaW9uRm9yY2UgPSAwOwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBSZW1vdmUgdGhlIHZlaGljbGUgaW5jbHVkaW5nIGl0cyBjb25zdHJhaW50cyBmcm9tIHRoZSB3b3JsZC4KICAgICAqLwoKCiAgICByZW1vdmVGcm9tV29ybGQod29ybGQpIHsKICAgICAgdGhpcy5jb25zdHJhaW50czsKICAgICAgd29ybGQucmVtb3ZlQm9keSh0aGlzLmNoYXNzaXNCb2R5KTsKICAgICAgd29ybGQucmVtb3ZlRXZlbnRMaXN0ZW5lcigncHJlU3RlcCcsIHRoaXMucHJlU3RlcENhbGxiYWNrKTsKICAgICAgdGhpcy53b3JsZCA9IG51bGw7CiAgICB9CgogICAgY2FzdFJheSh3aGVlbCkgewogICAgICBjb25zdCByYXl2ZWN0b3IgPSBjYXN0UmF5X3JheXZlY3RvcjsKICAgICAgY29uc3QgdGFyZ2V0ID0gY2FzdFJheV90YXJnZXQ7CiAgICAgIHRoaXMudXBkYXRlV2hlZWxUcmFuc2Zvcm1Xb3JsZCh3aGVlbCk7CiAgICAgIGNvbnN0IGNoYXNzaXNCb2R5ID0gdGhpcy5jaGFzc2lzQm9keTsKICAgICAgbGV0IGRlcHRoID0gLTE7CiAgICAgIGNvbnN0IHJheWxlbiA9IHdoZWVsLnN1c3BlbnNpb25SZXN0TGVuZ3RoICsgd2hlZWwucmFkaXVzOwogICAgICB3aGVlbC5kaXJlY3Rpb25Xb3JsZC5zY2FsZShyYXlsZW4sIHJheXZlY3Rvcik7CiAgICAgIGNvbnN0IHNvdXJjZSA9IHdoZWVsLmNoYXNzaXNDb25uZWN0aW9uUG9pbnRXb3JsZDsKICAgICAgc291cmNlLnZhZGQocmF5dmVjdG9yLCB0YXJnZXQpOwogICAgICBjb25zdCByYXljYXN0UmVzdWx0ID0gd2hlZWwucmF5Y2FzdFJlc3VsdDsKICAgICAgcmF5Y2FzdFJlc3VsdC5yZXNldCgpOyAvLyBUdXJuIG9mZiByYXkgY29sbGlzaW9uIHdpdGggdGhlIGNoYXNzaXMgdGVtcG9yYXJpbHkKCiAgICAgIGNvbnN0IG9sZFN0YXRlID0gY2hhc3Npc0JvZHkuY29sbGlzaW9uUmVzcG9uc2U7CiAgICAgIGNoYXNzaXNCb2R5LmNvbGxpc2lvblJlc3BvbnNlID0gZmFsc2U7IC8vIENhc3QgcmF5IGFnYWluc3Qgd29ybGQKCiAgICAgIHRoaXMud29ybGQucmF5VGVzdChzb3VyY2UsIHRhcmdldCwgcmF5Y2FzdFJlc3VsdCk7CiAgICAgIGNoYXNzaXNCb2R5LmNvbGxpc2lvblJlc3BvbnNlID0gb2xkU3RhdGU7CiAgICAgIGNvbnN0IG9iamVjdCA9IHJheWNhc3RSZXN1bHQuYm9keTsKICAgICAgd2hlZWwucmF5Y2FzdFJlc3VsdC5ncm91bmRPYmplY3QgPSAwOwoKICAgICAgaWYgKG9iamVjdCkgewogICAgICAgIGRlcHRoID0gcmF5Y2FzdFJlc3VsdC5kaXN0YW5jZTsKICAgICAgICB3aGVlbC5yYXljYXN0UmVzdWx0LmhpdE5vcm1hbFdvcmxkID0gcmF5Y2FzdFJlc3VsdC5oaXROb3JtYWxXb3JsZDsKICAgICAgICB3aGVlbC5pc0luQ29udGFjdCA9IHRydWU7CiAgICAgICAgY29uc3QgaGl0RGlzdGFuY2UgPSByYXljYXN0UmVzdWx0LmRpc3RhbmNlOwogICAgICAgIHdoZWVsLnN1c3BlbnNpb25MZW5ndGggPSBoaXREaXN0YW5jZSAtIHdoZWVsLnJhZGl1czsgLy8gY2xhbXAgb24gbWF4IHN1c3BlbnNpb24gdHJhdmVsCgogICAgICAgIGNvbnN0IG1pblN1c3BlbnNpb25MZW5ndGggPSB3aGVlbC5zdXNwZW5zaW9uUmVzdExlbmd0aCAtIHdoZWVsLm1heFN1c3BlbnNpb25UcmF2ZWw7CiAgICAgICAgY29uc3QgbWF4U3VzcGVuc2lvbkxlbmd0aCA9IHdoZWVsLnN1c3BlbnNpb25SZXN0TGVuZ3RoICsgd2hlZWwubWF4U3VzcGVuc2lvblRyYXZlbDsKCiAgICAgICAgaWYgKHdoZWVsLnN1c3BlbnNpb25MZW5ndGggPCBtaW5TdXNwZW5zaW9uTGVuZ3RoKSB7CiAgICAgICAgICB3aGVlbC5zdXNwZW5zaW9uTGVuZ3RoID0gbWluU3VzcGVuc2lvbkxlbmd0aDsKICAgICAgICB9CgogICAgICAgIGlmICh3aGVlbC5zdXNwZW5zaW9uTGVuZ3RoID4gbWF4U3VzcGVuc2lvbkxlbmd0aCkgewogICAgICAgICAgd2hlZWwuc3VzcGVuc2lvbkxlbmd0aCA9IG1heFN1c3BlbnNpb25MZW5ndGg7CiAgICAgICAgICB3aGVlbC5yYXljYXN0UmVzdWx0LnJlc2V0KCk7CiAgICAgICAgfQoKICAgICAgICBjb25zdCBkZW5vbWluYXRvciA9IHdoZWVsLnJheWNhc3RSZXN1bHQuaGl0Tm9ybWFsV29ybGQuZG90KHdoZWVsLmRpcmVjdGlvbldvcmxkKTsKICAgICAgICBjb25zdCBjaGFzc2lzX3ZlbG9jaXR5X2F0X2NvbnRhY3RQb2ludCA9IG5ldyBWZWMzKCk7CiAgICAgICAgY2hhc3Npc0JvZHkuZ2V0VmVsb2NpdHlBdFdvcmxkUG9pbnQod2hlZWwucmF5Y2FzdFJlc3VsdC5oaXRQb2ludFdvcmxkLCBjaGFzc2lzX3ZlbG9jaXR5X2F0X2NvbnRhY3RQb2ludCk7CiAgICAgICAgY29uc3QgcHJvalZlbCA9IHdoZWVsLnJheWNhc3RSZXN1bHQuaGl0Tm9ybWFsV29ybGQuZG90KGNoYXNzaXNfdmVsb2NpdHlfYXRfY29udGFjdFBvaW50KTsKCiAgICAgICAgaWYgKGRlbm9taW5hdG9yID49IC0wLjEpIHsKICAgICAgICAgIHdoZWVsLnN1c3BlbnNpb25SZWxhdGl2ZVZlbG9jaXR5ID0gMDsKICAgICAgICAgIHdoZWVsLmNsaXBwZWRJbnZDb250YWN0RG90U3VzcGVuc2lvbiA9IDEgLyAwLjE7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGNvbnN0IGludiA9IC0xIC8gZGVub21pbmF0b3I7CiAgICAgICAgICB3aGVlbC5zdXNwZW5zaW9uUmVsYXRpdmVWZWxvY2l0eSA9IHByb2pWZWwgKiBpbnY7CiAgICAgICAgICB3aGVlbC5jbGlwcGVkSW52Q29udGFjdERvdFN1c3BlbnNpb24gPSBpbnY7CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIC8vcHV0IHdoZWVsIGluZm8gYXMgaW4gcmVzdCBwb3NpdGlvbgogICAgICAgIHdoZWVsLnN1c3BlbnNpb25MZW5ndGggPSB3aGVlbC5zdXNwZW5zaW9uUmVzdExlbmd0aCArIDAgKiB3aGVlbC5tYXhTdXNwZW5zaW9uVHJhdmVsOwogICAgICAgIHdoZWVsLnN1c3BlbnNpb25SZWxhdGl2ZVZlbG9jaXR5ID0gMC4wOwogICAgICAgIHdoZWVsLmRpcmVjdGlvbldvcmxkLnNjYWxlKC0xLCB3aGVlbC5yYXljYXN0UmVzdWx0LmhpdE5vcm1hbFdvcmxkKTsKICAgICAgICB3aGVlbC5jbGlwcGVkSW52Q29udGFjdERvdFN1c3BlbnNpb24gPSAxLjA7CiAgICAgIH0KCiAgICAgIHJldHVybiBkZXB0aDsKICAgIH0KCiAgICB1cGRhdGVXaGVlbFRyYW5zZm9ybVdvcmxkKHdoZWVsKSB7CiAgICAgIHdoZWVsLmlzSW5Db250YWN0ID0gZmFsc2U7CiAgICAgIGNvbnN0IGNoYXNzaXNCb2R5ID0gdGhpcy5jaGFzc2lzQm9keTsKICAgICAgY2hhc3Npc0JvZHkucG9pbnRUb1dvcmxkRnJhbWUod2hlZWwuY2hhc3Npc0Nvbm5lY3Rpb25Qb2ludExvY2FsLCB3aGVlbC5jaGFzc2lzQ29ubmVjdGlvblBvaW50V29ybGQpOwogICAgICBjaGFzc2lzQm9keS52ZWN0b3JUb1dvcmxkRnJhbWUod2hlZWwuZGlyZWN0aW9uTG9jYWwsIHdoZWVsLmRpcmVjdGlvbldvcmxkKTsKICAgICAgY2hhc3Npc0JvZHkudmVjdG9yVG9Xb3JsZEZyYW1lKHdoZWVsLmF4bGVMb2NhbCwgd2hlZWwuYXhsZVdvcmxkKTsKICAgIH0KICAgIC8qKgogICAgICogVXBkYXRlIG9uZSBvZiB0aGUgd2hlZWwgdHJhbnNmb3JtLgogICAgICogTm90ZSB3aGVuIHJlbmRlcmluZyB3aGVlbHM6IGR1cmluZyBlYWNoIHN0ZXAsIHdoZWVsIHRyYW5zZm9ybXMgYXJlIHVwZGF0ZWQgQkVGT1JFIHRoZSBjaGFzc2lzOyBpZS4gdGhlaXIgcG9zaXRpb24gYmVjb21lcyBpbnZhbGlkIGFmdGVyIHRoZSBzdGVwLiBUaHVzIHdoZW4geW91IHJlbmRlciB3aGVlbHMsIHlvdSBtdXN0IHVwZGF0ZSB3aGVlbCB0cmFuc2Zvcm1zIGJlZm9yZSByZW5kZXJpbmcgdGhlbS4gU2VlIHJheWNhc3RWZWhpY2xlIGRlbW8gZm9yIGFuIGV4YW1wbGUuCiAgICAgKiBAcGFyYW0gd2hlZWxJbmRleCBUaGUgd2hlZWwgaW5kZXggdG8gdXBkYXRlLgogICAgICovCgoKICAgIHVwZGF0ZVdoZWVsVHJhbnNmb3JtKHdoZWVsSW5kZXgpIHsKICAgICAgY29uc3QgdXAgPSB0bXBWZWM0OwogICAgICBjb25zdCByaWdodCA9IHRtcFZlYzU7CiAgICAgIGNvbnN0IGZ3ZCA9IHRtcFZlYzY7CiAgICAgIGNvbnN0IHdoZWVsID0gdGhpcy53aGVlbEluZm9zW3doZWVsSW5kZXhdOwogICAgICB0aGlzLnVwZGF0ZVdoZWVsVHJhbnNmb3JtV29ybGQod2hlZWwpOwogICAgICB3aGVlbC5kaXJlY3Rpb25Mb2NhbC5zY2FsZSgtMSwgdXApOwogICAgICByaWdodC5jb3B5KHdoZWVsLmF4bGVMb2NhbCk7CiAgICAgIHVwLmNyb3NzKHJpZ2h0LCBmd2QpOwogICAgICBmd2Qubm9ybWFsaXplKCk7CiAgICAgIHJpZ2h0Lm5vcm1hbGl6ZSgpOyAvLyBSb3RhdGUgYXJvdW5kIHN0ZWVyaW5nIG92ZXIgdGhlIHdoZWVsQXhsZQoKICAgICAgY29uc3Qgc3RlZXJpbmcgPSB3aGVlbC5zdGVlcmluZzsKICAgICAgY29uc3Qgc3RlZXJpbmdPcm4gPSBuZXcgUXVhdGVybmlvbigpOwogICAgICBzdGVlcmluZ09ybi5zZXRGcm9tQXhpc0FuZ2xlKHVwLCBzdGVlcmluZyk7CiAgICAgIGNvbnN0IHJvdGF0aW5nT3JuID0gbmV3IFF1YXRlcm5pb24oKTsKICAgICAgcm90YXRpbmdPcm4uc2V0RnJvbUF4aXNBbmdsZShyaWdodCwgd2hlZWwucm90YXRpb24pOyAvLyBXb3JsZCByb3RhdGlvbiBvZiB0aGUgd2hlZWwKCiAgICAgIGNvbnN0IHEgPSB3aGVlbC53b3JsZFRyYW5zZm9ybS5xdWF0ZXJuaW9uOwogICAgICB0aGlzLmNoYXNzaXNCb2R5LnF1YXRlcm5pb24ubXVsdChzdGVlcmluZ09ybiwgcSk7CiAgICAgIHEubXVsdChyb3RhdGluZ09ybiwgcSk7CiAgICAgIHEubm9ybWFsaXplKCk7IC8vIHdvcmxkIHBvc2l0aW9uIG9mIHRoZSB3aGVlbAoKICAgICAgY29uc3QgcCA9IHdoZWVsLndvcmxkVHJhbnNmb3JtLnBvc2l0aW9uOwogICAgICBwLmNvcHkod2hlZWwuZGlyZWN0aW9uV29ybGQpOwogICAgICBwLnNjYWxlKHdoZWVsLnN1c3BlbnNpb25MZW5ndGgsIHApOwogICAgICBwLnZhZGQod2hlZWwuY2hhc3Npc0Nvbm5lY3Rpb25Qb2ludFdvcmxkLCBwKTsKICAgIH0KICAgIC8qKgogICAgICogR2V0IHRoZSB3b3JsZCB0cmFuc2Zvcm0gb2Ygb25lIG9mIHRoZSB3aGVlbHMKICAgICAqLwoKCiAgICBnZXRXaGVlbFRyYW5zZm9ybVdvcmxkKHdoZWVsSW5kZXgpIHsKICAgICAgcmV0dXJuIHRoaXMud2hlZWxJbmZvc1t3aGVlbEluZGV4XS53b3JsZFRyYW5zZm9ybTsKICAgIH0KCiAgICB1cGRhdGVGcmljdGlvbih0aW1lU3RlcCkgewogICAgICBjb25zdCBzdXJmTm9ybWFsV1Nfc2NhbGVkX3Byb2ogPSB1cGRhdGVGcmljdGlvbl9zdXJmTm9ybWFsV1Nfc2NhbGVkX3Byb2o7IC8vY2FsY3VsYXRlIHRoZSBpbXB1bHNlLCBzbyB0aGF0IHRoZSB3aGVlbHMgZG9uJ3QgbW92ZSBzaWRld2FyZHMKCiAgICAgIGNvbnN0IHdoZWVsSW5mb3MgPSB0aGlzLndoZWVsSW5mb3M7CiAgICAgIGNvbnN0IG51bVdoZWVscyA9IHdoZWVsSW5mb3MubGVuZ3RoOwogICAgICBjb25zdCBjaGFzc2lzQm9keSA9IHRoaXMuY2hhc3Npc0JvZHk7CiAgICAgIGNvbnN0IGZvcndhcmRXUyA9IHVwZGF0ZUZyaWN0aW9uX2ZvcndhcmRXUzsKICAgICAgY29uc3QgYXhsZSA9IHVwZGF0ZUZyaWN0aW9uX2F4bGU7CiAgICAgIHRoaXMubnVtV2hlZWxzT25Hcm91bmQgPSAwOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBudW1XaGVlbHM7IGkrKykgewogICAgICAgIGNvbnN0IHdoZWVsID0gd2hlZWxJbmZvc1tpXTsKICAgICAgICBjb25zdCBncm91bmRPYmplY3QgPSB3aGVlbC5yYXljYXN0UmVzdWx0LmJvZHk7CgogICAgICAgIGlmIChncm91bmRPYmplY3QpIHsKICAgICAgICAgIHRoaXMubnVtV2hlZWxzT25Hcm91bmQrKzsKICAgICAgICB9CgogICAgICAgIHdoZWVsLnNpZGVJbXB1bHNlID0gMDsKICAgICAgICB3aGVlbC5mb3J3YXJkSW1wdWxzZSA9IDA7CgogICAgICAgIGlmICghZm9yd2FyZFdTW2ldKSB7CiAgICAgICAgICBmb3J3YXJkV1NbaV0gPSBuZXcgVmVjMygpOwogICAgICAgIH0KCiAgICAgICAgaWYgKCFheGxlW2ldKSB7CiAgICAgICAgICBheGxlW2ldID0gbmV3IFZlYzMoKTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbnVtV2hlZWxzOyBpKyspIHsKICAgICAgICBjb25zdCB3aGVlbCA9IHdoZWVsSW5mb3NbaV07CiAgICAgICAgY29uc3QgZ3JvdW5kT2JqZWN0ID0gd2hlZWwucmF5Y2FzdFJlc3VsdC5ib2R5OwoKICAgICAgICBpZiAoZ3JvdW5kT2JqZWN0KSB7CiAgICAgICAgICBjb25zdCBheGxlaSA9IGF4bGVbaV07CiAgICAgICAgICBjb25zdCB3aGVlbFRyYW5zID0gdGhpcy5nZXRXaGVlbFRyYW5zZm9ybVdvcmxkKGkpOyAvLyBHZXQgd29ybGQgYXhsZQoKICAgICAgICAgIHdoZWVsVHJhbnMudmVjdG9yVG9Xb3JsZEZyYW1lKGRpcmVjdGlvbnNbdGhpcy5pbmRleFJpZ2h0QXhpc10sIGF4bGVpKTsKICAgICAgICAgIGNvbnN0IHN1cmZOb3JtYWxXUyA9IHdoZWVsLnJheWNhc3RSZXN1bHQuaGl0Tm9ybWFsV29ybGQ7CiAgICAgICAgICBjb25zdCBwcm9qID0gYXhsZWkuZG90KHN1cmZOb3JtYWxXUyk7CiAgICAgICAgICBzdXJmTm9ybWFsV1Muc2NhbGUocHJvaiwgc3VyZk5vcm1hbFdTX3NjYWxlZF9wcm9qKTsKICAgICAgICAgIGF4bGVpLnZzdWIoc3VyZk5vcm1hbFdTX3NjYWxlZF9wcm9qLCBheGxlaSk7CiAgICAgICAgICBheGxlaS5ub3JtYWxpemUoKTsKICAgICAgICAgIHN1cmZOb3JtYWxXUy5jcm9zcyhheGxlaSwgZm9yd2FyZFdTW2ldKTsKICAgICAgICAgIGZvcndhcmRXU1tpXS5ub3JtYWxpemUoKTsKICAgICAgICAgIHdoZWVsLnNpZGVJbXB1bHNlID0gcmVzb2x2ZVNpbmdsZUJpbGF0ZXJhbChjaGFzc2lzQm9keSwgd2hlZWwucmF5Y2FzdFJlc3VsdC5oaXRQb2ludFdvcmxkLCBncm91bmRPYmplY3QsIHdoZWVsLnJheWNhc3RSZXN1bHQuaGl0UG9pbnRXb3JsZCwgYXhsZWkpOwogICAgICAgICAgd2hlZWwuc2lkZUltcHVsc2UgKj0gc2lkZUZyaWN0aW9uU3RpZmZuZXNzMjsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIGNvbnN0IHNpZGVGYWN0b3IgPSAxOwogICAgICBjb25zdCBmd2RGYWN0b3IgPSAwLjU7CiAgICAgIHRoaXMuc2xpZGluZyA9IGZhbHNlOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBudW1XaGVlbHM7IGkrKykgewogICAgICAgIGNvbnN0IHdoZWVsID0gd2hlZWxJbmZvc1tpXTsKICAgICAgICBjb25zdCBncm91bmRPYmplY3QgPSB3aGVlbC5yYXljYXN0UmVzdWx0LmJvZHk7CiAgICAgICAgbGV0IHJvbGxpbmdGcmljdGlvbiA9IDA7CiAgICAgICAgd2hlZWwuc2xpcEluZm8gPSAxOwoKICAgICAgICBpZiAoZ3JvdW5kT2JqZWN0KSB7CiAgICAgICAgICBjb25zdCBkZWZhdWx0Um9sbGluZ0ZyaWN0aW9uSW1wdWxzZSA9IDA7CiAgICAgICAgICBjb25zdCBtYXhJbXB1bHNlID0gd2hlZWwuYnJha2UgPyB3aGVlbC5icmFrZSA6IGRlZmF1bHRSb2xsaW5nRnJpY3Rpb25JbXB1bHNlOyAvLyBidFdoZWVsQ29udGFjdFBvaW50IGNvbnRhY3RQdChjaGFzc2lzQm9keSxncm91bmRPYmplY3Qsd2hlZWxJbmZyYXljYXN0SW5mby5oaXRQb2ludFdvcmxkLGZvcndhcmRXU1t3aGVlbF0sbWF4SW1wdWxzZSk7CiAgICAgICAgICAvLyByb2xsaW5nRnJpY3Rpb24gPSBjYWxjUm9sbGluZ0ZyaWN0aW9uKGNvbnRhY3RQdCk7CgogICAgICAgICAgcm9sbGluZ0ZyaWN0aW9uID0gY2FsY1JvbGxpbmdGcmljdGlvbihjaGFzc2lzQm9keSwgZ3JvdW5kT2JqZWN0LCB3aGVlbC5yYXljYXN0UmVzdWx0LmhpdFBvaW50V29ybGQsIGZvcndhcmRXU1tpXSwgbWF4SW1wdWxzZSk7CiAgICAgICAgICByb2xsaW5nRnJpY3Rpb24gKz0gd2hlZWwuZW5naW5lRm9yY2UgKiB0aW1lU3RlcDsgLy8gcm9sbGluZ0ZyaWN0aW9uID0gMDsKCiAgICAgICAgICBjb25zdCBmYWN0b3IgPSBtYXhJbXB1bHNlIC8gcm9sbGluZ0ZyaWN0aW9uOwogICAgICAgICAgd2hlZWwuc2xpcEluZm8gKj0gZmFjdG9yOwogICAgICAgIH0gLy9zd2l0Y2ggYmV0d2VlbiBhY3RpdmUgcm9sbGluZyAodGhyb3R0bGUpLCBicmFraW5nIGFuZCBub24tYWN0aXZlIHJvbGxpbmcgZnJpY3Rpb24gKG50aHJvdHRsZS9icmVhaykKCgogICAgICAgIHdoZWVsLmZvcndhcmRJbXB1bHNlID0gMDsKICAgICAgICB3aGVlbC5za2lkSW5mbyA9IDE7CgogICAgICAgIGlmIChncm91bmRPYmplY3QpIHsKICAgICAgICAgIHdoZWVsLnNraWRJbmZvID0gMTsKICAgICAgICAgIGNvbnN0IG1heGltcCA9IHdoZWVsLnN1c3BlbnNpb25Gb3JjZSAqIHRpbWVTdGVwICogd2hlZWwuZnJpY3Rpb25TbGlwOwogICAgICAgICAgY29uc3QgbWF4aW1wU2lkZSA9IG1heGltcDsKICAgICAgICAgIGNvbnN0IG1heGltcFNxdWFyZWQgPSBtYXhpbXAgKiBtYXhpbXBTaWRlOwogICAgICAgICAgd2hlZWwuZm9yd2FyZEltcHVsc2UgPSByb2xsaW5nRnJpY3Rpb247IC8vd2hlZWxJbmZvLmVuZ2luZUZvcmNlKiB0aW1lU3RlcDsKCiAgICAgICAgICBjb25zdCB4ID0gd2hlZWwuZm9yd2FyZEltcHVsc2UgKiBmd2RGYWN0b3IgLyB3aGVlbC5mb3J3YXJkQWNjZWxlcmF0aW9uOwogICAgICAgICAgY29uc3QgeSA9IHdoZWVsLnNpZGVJbXB1bHNlICogc2lkZUZhY3RvciAvIHdoZWVsLnNpZGVBY2NlbGVyYXRpb247CiAgICAgICAgICBjb25zdCBpbXB1bHNlU3F1YXJlZCA9IHggKiB4ICsgeSAqIHk7CiAgICAgICAgICB3aGVlbC5zbGlkaW5nID0gZmFsc2U7CgogICAgICAgICAgaWYgKGltcHVsc2VTcXVhcmVkID4gbWF4aW1wU3F1YXJlZCkgewogICAgICAgICAgICB0aGlzLnNsaWRpbmcgPSB0cnVlOwogICAgICAgICAgICB3aGVlbC5zbGlkaW5nID0gdHJ1ZTsKICAgICAgICAgICAgY29uc3QgZmFjdG9yID0gbWF4aW1wIC8gTWF0aC5zcXJ0KGltcHVsc2VTcXVhcmVkKTsKICAgICAgICAgICAgd2hlZWwuc2tpZEluZm8gKj0gZmFjdG9yOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQoKICAgICAgaWYgKHRoaXMuc2xpZGluZykgewogICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbnVtV2hlZWxzOyBpKyspIHsKICAgICAgICAgIGNvbnN0IHdoZWVsID0gd2hlZWxJbmZvc1tpXTsKCiAgICAgICAgICBpZiAod2hlZWwuc2lkZUltcHVsc2UgIT09IDApIHsKICAgICAgICAgICAgaWYgKHdoZWVsLnNraWRJbmZvIDwgMSkgewogICAgICAgICAgICAgIHdoZWVsLmZvcndhcmRJbXB1bHNlICo9IHdoZWVsLnNraWRJbmZvOwogICAgICAgICAgICAgIHdoZWVsLnNpZGVJbXB1bHNlICo9IHdoZWVsLnNraWRJbmZvOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9IC8vIGFwcGx5IHRoZSBpbXB1bHNlcwoKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbnVtV2hlZWxzOyBpKyspIHsKICAgICAgICBjb25zdCB3aGVlbCA9IHdoZWVsSW5mb3NbaV07CiAgICAgICAgY29uc3QgcmVsX3BvcyA9IG5ldyBWZWMzKCk7CiAgICAgICAgd2hlZWwucmF5Y2FzdFJlc3VsdC5oaXRQb2ludFdvcmxkLnZzdWIoY2hhc3Npc0JvZHkucG9zaXRpb24sIHJlbF9wb3MpOyAvLyBjYW5ub25zIGFwcGx5aW1wdWxzZSBpcyB1c2luZyB3b3JsZCBjb29yZCBmb3IgdGhlIHBvc2l0aW9uCiAgICAgICAgLy9yZWxfcG9zLmNvcHkod2hlZWwucmF5Y2FzdFJlc3VsdC5oaXRQb2ludFdvcmxkKTsKCiAgICAgICAgaWYgKHdoZWVsLmZvcndhcmRJbXB1bHNlICE9PSAwKSB7CiAgICAgICAgICBjb25zdCBpbXB1bHNlID0gbmV3IFZlYzMoKTsKICAgICAgICAgIGZvcndhcmRXU1tpXS5zY2FsZSh3aGVlbC5mb3J3YXJkSW1wdWxzZSwgaW1wdWxzZSk7CiAgICAgICAgICBjaGFzc2lzQm9keS5hcHBseUltcHVsc2UoaW1wdWxzZSwgcmVsX3Bvcyk7CiAgICAgICAgfQoKICAgICAgICBpZiAod2hlZWwuc2lkZUltcHVsc2UgIT09IDApIHsKICAgICAgICAgIGNvbnN0IGdyb3VuZE9iamVjdCA9IHdoZWVsLnJheWNhc3RSZXN1bHQuYm9keTsKICAgICAgICAgIGNvbnN0IHJlbF9wb3MyID0gbmV3IFZlYzMoKTsKICAgICAgICAgIHdoZWVsLnJheWNhc3RSZXN1bHQuaGl0UG9pbnRXb3JsZC52c3ViKGdyb3VuZE9iamVjdC5wb3NpdGlvbiwgcmVsX3BvczIpOyAvL3JlbF9wb3MyLmNvcHkod2hlZWwucmF5Y2FzdFJlc3VsdC5oaXRQb2ludFdvcmxkKTsKCiAgICAgICAgICBjb25zdCBzaWRlSW1wID0gbmV3IFZlYzMoKTsKICAgICAgICAgIGF4bGVbaV0uc2NhbGUod2hlZWwuc2lkZUltcHVsc2UsIHNpZGVJbXApOyAvLyBTY2FsZSB0aGUgcmVsYXRpdmUgcG9zaXRpb24gaW4gdGhlIHVwIGRpcmVjdGlvbiB3aXRoIHJvbGxJbmZsdWVuY2UuCiAgICAgICAgICAvLyBJZiByb2xsSW5mbHVlbmNlIGlzIDEsIHRoZSBpbXB1bHNlIHdpbGwgYmUgYXBwbGllZCBvbiB0aGUgaGl0UG9pbnQgKGVhc3kgdG8gcm9sbCBvdmVyKSwgaWYgaXQgaXMgemVybyBpdCB3aWxsIGJlIGFwcGxpZWQgaW4gdGhlIHNhbWUgcGxhbmUgYXMgdGhlIGNlbnRlciBvZiBtYXNzIChub3QgZWFzeSB0byByb2xsIG92ZXIpLgoKICAgICAgICAgIGNoYXNzaXNCb2R5LnZlY3RvclRvTG9jYWxGcmFtZShyZWxfcG9zLCByZWxfcG9zKTsKICAgICAgICAgIHJlbF9wb3NbJ3h5eidbdGhpcy5pbmRleFVwQXhpc11dICo9IHdoZWVsLnJvbGxJbmZsdWVuY2U7CiAgICAgICAgICBjaGFzc2lzQm9keS52ZWN0b3JUb1dvcmxkRnJhbWUocmVsX3BvcywgcmVsX3Bvcyk7CiAgICAgICAgICBjaGFzc2lzQm9keS5hcHBseUltcHVsc2Uoc2lkZUltcCwgcmVsX3Bvcyk7IC8vYXBwbHkgZnJpY3Rpb24gaW1wdWxzZSBvbiB0aGUgZ3JvdW5kCgogICAgICAgICAgc2lkZUltcC5zY2FsZSgtMSwgc2lkZUltcCk7CiAgICAgICAgICBncm91bmRPYmplY3QuYXBwbHlJbXB1bHNlKHNpZGVJbXAsIHJlbF9wb3MyKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KCiAgfQogIG5ldyBWZWMzKCk7CiAgbmV3IFZlYzMoKTsKICBuZXcgVmVjMygpOwogIGNvbnN0IHRtcFZlYzQgPSBuZXcgVmVjMygpOwogIGNvbnN0IHRtcFZlYzUgPSBuZXcgVmVjMygpOwogIGNvbnN0IHRtcFZlYzYgPSBuZXcgVmVjMygpOwogIG5ldyBSYXkoKTsKICBuZXcgVmVjMygpOwogIGNvbnN0IGNhc3RSYXlfcmF5dmVjdG9yID0gbmV3IFZlYzMoKTsKICBjb25zdCBjYXN0UmF5X3RhcmdldCA9IG5ldyBWZWMzKCk7CiAgY29uc3QgZGlyZWN0aW9ucyA9IFtuZXcgVmVjMygxLCAwLCAwKSwgbmV3IFZlYzMoMCwgMSwgMCksIG5ldyBWZWMzKDAsIDAsIDEpXTsKICBjb25zdCB1cGRhdGVGcmljdGlvbl9zdXJmTm9ybWFsV1Nfc2NhbGVkX3Byb2ogPSBuZXcgVmVjMygpOwogIGNvbnN0IHVwZGF0ZUZyaWN0aW9uX2F4bGUgPSBbXTsKICBjb25zdCB1cGRhdGVGcmljdGlvbl9mb3J3YXJkV1MgPSBbXTsKICBjb25zdCBzaWRlRnJpY3Rpb25TdGlmZm5lc3MyID0gMTsKICBjb25zdCBjYWxjUm9sbGluZ0ZyaWN0aW9uX3ZlbDEgPSBuZXcgVmVjMygpOwogIGNvbnN0IGNhbGNSb2xsaW5nRnJpY3Rpb25fdmVsMiA9IG5ldyBWZWMzKCk7CiAgY29uc3QgY2FsY1JvbGxpbmdGcmljdGlvbl92ZWwgPSBuZXcgVmVjMygpOwoKICBmdW5jdGlvbiBjYWxjUm9sbGluZ0ZyaWN0aW9uKGJvZHkwLCBib2R5MSwgZnJpY3Rpb25Qb3NXb3JsZCwgZnJpY3Rpb25EaXJlY3Rpb25Xb3JsZCwgbWF4SW1wdWxzZSkgewogICAgbGV0IGoxID0gMDsKICAgIGNvbnN0IGNvbnRhY3RQb3NXb3JsZCA9IGZyaWN0aW9uUG9zV29ybGQ7IC8vIGNvbnN0IHJlbF9wb3MxID0gbmV3IFZlYzMoKTsKICAgIC8vIGNvbnN0IHJlbF9wb3MyID0gbmV3IFZlYzMoKTsKCiAgICBjb25zdCB2ZWwxID0gY2FsY1JvbGxpbmdGcmljdGlvbl92ZWwxOwogICAgY29uc3QgdmVsMiA9IGNhbGNSb2xsaW5nRnJpY3Rpb25fdmVsMjsKICAgIGNvbnN0IHZlbCA9IGNhbGNSb2xsaW5nRnJpY3Rpb25fdmVsOyAvLyBjb250YWN0UG9zV29ybGQudnN1Yihib2R5MC5wb3NpdGlvbiwgcmVsX3BvczEpOwogICAgLy8gY29udGFjdFBvc1dvcmxkLnZzdWIoYm9keTEucG9zaXRpb24sIHJlbF9wb3MyKTsKCiAgICBib2R5MC5nZXRWZWxvY2l0eUF0V29ybGRQb2ludChjb250YWN0UG9zV29ybGQsIHZlbDEpOwogICAgYm9keTEuZ2V0VmVsb2NpdHlBdFdvcmxkUG9pbnQoY29udGFjdFBvc1dvcmxkLCB2ZWwyKTsKICAgIHZlbDEudnN1Yih2ZWwyLCB2ZWwpOwogICAgY29uc3QgdnJlbCA9IGZyaWN0aW9uRGlyZWN0aW9uV29ybGQuZG90KHZlbCk7CiAgICBjb25zdCBkZW5vbTAgPSBjb21wdXRlSW1wdWxzZURlbm9taW5hdG9yKGJvZHkwLCBmcmljdGlvblBvc1dvcmxkLCBmcmljdGlvbkRpcmVjdGlvbldvcmxkKTsKICAgIGNvbnN0IGRlbm9tMSA9IGNvbXB1dGVJbXB1bHNlRGVub21pbmF0b3IoYm9keTEsIGZyaWN0aW9uUG9zV29ybGQsIGZyaWN0aW9uRGlyZWN0aW9uV29ybGQpOwogICAgY29uc3QgcmVsYXhhdGlvbiA9IDE7CiAgICBjb25zdCBqYWNEaWFnQUJJbnYgPSByZWxheGF0aW9uIC8gKGRlbm9tMCArIGRlbm9tMSk7IC8vIGNhbGN1bGF0ZSBqIHRoYXQgbW92ZXMgdXMgdG8gemVybyByZWxhdGl2ZSB2ZWxvY2l0eQoKICAgIGoxID0gLXZyZWwgKiBqYWNEaWFnQUJJbnY7CgogICAgaWYgKG1heEltcHVsc2UgPCBqMSkgewogICAgICBqMSA9IG1heEltcHVsc2U7CiAgICB9CgogICAgaWYgKGoxIDwgLW1heEltcHVsc2UpIHsKICAgICAgajEgPSAtbWF4SW1wdWxzZTsKICAgIH0KCiAgICByZXR1cm4gajE7CiAgfQoKICBjb25zdCBjb21wdXRlSW1wdWxzZURlbm9taW5hdG9yX3IwID0gbmV3IFZlYzMoKTsKICBjb25zdCBjb21wdXRlSW1wdWxzZURlbm9taW5hdG9yX2MwID0gbmV3IFZlYzMoKTsKICBjb25zdCBjb21wdXRlSW1wdWxzZURlbm9taW5hdG9yX3ZlYyA9IG5ldyBWZWMzKCk7CiAgY29uc3QgY29tcHV0ZUltcHVsc2VEZW5vbWluYXRvcl9tID0gbmV3IFZlYzMoKTsKCiAgZnVuY3Rpb24gY29tcHV0ZUltcHVsc2VEZW5vbWluYXRvcihib2R5LCBwb3MsIG5vcm1hbCkgewogICAgY29uc3QgcjAgPSBjb21wdXRlSW1wdWxzZURlbm9taW5hdG9yX3IwOwogICAgY29uc3QgYzAgPSBjb21wdXRlSW1wdWxzZURlbm9taW5hdG9yX2MwOwogICAgY29uc3QgdmVjID0gY29tcHV0ZUltcHVsc2VEZW5vbWluYXRvcl92ZWM7CiAgICBjb25zdCBtID0gY29tcHV0ZUltcHVsc2VEZW5vbWluYXRvcl9tOwogICAgcG9zLnZzdWIoYm9keS5wb3NpdGlvbiwgcjApOwogICAgcjAuY3Jvc3Mobm9ybWFsLCBjMCk7CiAgICBib2R5LmludkluZXJ0aWFXb3JsZC52bXVsdChjMCwgbSk7CiAgICBtLmNyb3NzKHIwLCB2ZWMpOwogICAgcmV0dXJuIGJvZHkuaW52TWFzcyArIG5vcm1hbC5kb3QodmVjKTsKICB9CgogIGNvbnN0IHJlc29sdmVTaW5nbGVCaWxhdGVyYWxfdmVsMSA9IG5ldyBWZWMzKCk7CiAgY29uc3QgcmVzb2x2ZVNpbmdsZUJpbGF0ZXJhbF92ZWwyID0gbmV3IFZlYzMoKTsKICBjb25zdCByZXNvbHZlU2luZ2xlQmlsYXRlcmFsX3ZlbCA9IG5ldyBWZWMzKCk7IC8vIGJpbGF0ZXJhbCBjb25zdHJhaW50IGJldHdlZW4gdHdvIGR5bmFtaWMgb2JqZWN0cwoKICBmdW5jdGlvbiByZXNvbHZlU2luZ2xlQmlsYXRlcmFsKGJvZHkxLCBwb3MxLCBib2R5MiwgcG9zMiwgbm9ybWFsKSB7CiAgICBjb25zdCBub3JtYWxMZW5TcXIgPSBub3JtYWwubGVuZ3RoU3F1YXJlZCgpOwoKICAgIGlmIChub3JtYWxMZW5TcXIgPiAxLjEpIHsKICAgICAgcmV0dXJuIDA7IC8vIG5vIGltcHVsc2UKICAgIH0gLy8gY29uc3QgcmVsX3BvczEgPSBuZXcgVmVjMygpOwogICAgLy8gY29uc3QgcmVsX3BvczIgPSBuZXcgVmVjMygpOwogICAgLy8gcG9zMS52c3ViKGJvZHkxLnBvc2l0aW9uLCByZWxfcG9zMSk7CiAgICAvLyBwb3MyLnZzdWIoYm9keTIucG9zaXRpb24sIHJlbF9wb3MyKTsKCgogICAgY29uc3QgdmVsMSA9IHJlc29sdmVTaW5nbGVCaWxhdGVyYWxfdmVsMTsKICAgIGNvbnN0IHZlbDIgPSByZXNvbHZlU2luZ2xlQmlsYXRlcmFsX3ZlbDI7CiAgICBjb25zdCB2ZWwgPSByZXNvbHZlU2luZ2xlQmlsYXRlcmFsX3ZlbDsKICAgIGJvZHkxLmdldFZlbG9jaXR5QXRXb3JsZFBvaW50KHBvczEsIHZlbDEpOwogICAgYm9keTIuZ2V0VmVsb2NpdHlBdFdvcmxkUG9pbnQocG9zMiwgdmVsMik7CiAgICB2ZWwxLnZzdWIodmVsMiwgdmVsKTsKICAgIGNvbnN0IHJlbF92ZWwgPSBub3JtYWwuZG90KHZlbCk7CiAgICBjb25zdCBjb250YWN0RGFtcGluZyA9IDAuMjsKICAgIGNvbnN0IG1hc3NUZXJtID0gMSAvIChib2R5MS5pbnZNYXNzICsgYm9keTIuaW52TWFzcyk7CiAgICBjb25zdCBpbXB1bHNlID0gLWNvbnRhY3REYW1waW5nICogcmVsX3ZlbCAqIG1hc3NUZXJtOwogICAgcmV0dXJuIGltcHVsc2U7CiAgfQoKICAvKioKICAgKiBTcGhlcmljYWwgc2hhcGUKICAgKiBAZXhhbXBsZQogICAqICAgICBjb25zdCByYWRpdXMgPSAxCiAgICogICAgIGNvbnN0IHNwaGVyZVNoYXBlID0gbmV3IENBTk5PTi5TcGhlcmUocmFkaXVzKQogICAqICAgICBjb25zdCBzcGhlcmVCb2R5ID0gbmV3IENBTk5PTi5Cb2R5KHsgbWFzczogMSwgc2hhcGU6IHNwaGVyZVNoYXBlIH0pCiAgICogICAgIHdvcmxkLmFkZEJvZHkoc3BoZXJlQm9keSkKICAgKi8KICBjbGFzcyBTcGhlcmUgZXh0ZW5kcyBTaGFwZSB7CiAgICAvKioKICAgICAqIFRoZSByYWRpdXMgb2YgdGhlIHNwaGVyZS4KICAgICAqLwoKICAgIC8qKgogICAgICoKICAgICAqIEBwYXJhbSByYWRpdXMgVGhlIHJhZGl1cyBvZiB0aGUgc3BoZXJlLCBhIG5vbi1uZWdhdGl2ZSBudW1iZXIuCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKHJhZGl1cykgewogICAgICBzdXBlcih7CiAgICAgICAgdHlwZTogU2hhcGUudHlwZXMuU1BIRVJFCiAgICAgIH0pOwogICAgICB0aGlzLnJhZGl1cyA9IHJhZGl1cyAhPT0gdW5kZWZpbmVkID8gcmFkaXVzIDogMS4wOwoKICAgICAgaWYgKHRoaXMucmFkaXVzIDwgMCkgewogICAgICAgIHRocm93IG5ldyBFcnJvcignVGhlIHNwaGVyZSByYWRpdXMgY2Fubm90IGJlIG5lZ2F0aXZlLicpOwogICAgICB9CgogICAgICB0aGlzLnVwZGF0ZUJvdW5kaW5nU3BoZXJlUmFkaXVzKCk7CiAgICB9CiAgICAvKiogY2FsY3VsYXRlTG9jYWxJbmVydGlhICovCgoKICAgIGNhbGN1bGF0ZUxvY2FsSW5lcnRpYShtYXNzLCB0YXJnZXQpIHsKICAgICAgaWYgKHRhcmdldCA9PT0gdm9pZCAwKSB7CiAgICAgICAgdGFyZ2V0ID0gbmV3IFZlYzMoKTsKICAgICAgfQoKICAgICAgY29uc3QgSSA9IDIuMCAqIG1hc3MgKiB0aGlzLnJhZGl1cyAqIHRoaXMucmFkaXVzIC8gNS4wOwogICAgICB0YXJnZXQueCA9IEk7CiAgICAgIHRhcmdldC55ID0gSTsKICAgICAgdGFyZ2V0LnogPSBJOwogICAgICByZXR1cm4gdGFyZ2V0OwogICAgfQogICAgLyoqIHZvbHVtZSAqLwoKCiAgICB2b2x1bWUoKSB7CiAgICAgIHJldHVybiA0LjAgKiBNYXRoLlBJICogTWF0aC5wb3codGhpcy5yYWRpdXMsIDMpIC8gMy4wOwogICAgfQoKICAgIHVwZGF0ZUJvdW5kaW5nU3BoZXJlUmFkaXVzKCkgewogICAgICB0aGlzLmJvdW5kaW5nU3BoZXJlUmFkaXVzID0gdGhpcy5yYWRpdXM7CiAgICB9CgogICAgY2FsY3VsYXRlV29ybGRBQUJCKHBvcywgcXVhdCwgbWluLCBtYXgpIHsKICAgICAgY29uc3QgciA9IHRoaXMucmFkaXVzOwogICAgICBjb25zdCBheGVzID0gWyd4JywgJ3knLCAneiddOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBheGVzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgY29uc3QgYXggPSBheGVzW2ldOwogICAgICAgIG1pbltheF0gPSBwb3NbYXhdIC0gcjsKICAgICAgICBtYXhbYXhdID0gcG9zW2F4XSArIHI7CiAgICAgIH0KICAgIH0KCiAgfQogIG5ldyBWZWMzKCk7CiAgbmV3IFZlYzMoKTsKICBuZXcgVmVjMygpOyAvLyBUZW1wIHZlY3RvcnMgZm9yIGNhbGN1bGF0aW9uCgogIG5ldyBWZWMzKCk7IC8vIFJlbGF0aXZlIHZlbG9jaXR5CgogIG5ldyBWZWMzKCk7CiAgbmV3IFZlYzMoKTsKICBuZXcgVmVjMygpOwogIG5ldyBWZWMzKCk7CiAgbmV3IFZlYzMoKTsKCiAgLyoqCiAgICogQ3lsaW5kZXIgY2xhc3MuCiAgICogQGV4YW1wbGUKICAgKiAgICAgY29uc3QgcmFkaXVzVG9wID0gMC41CiAgICogICAgIGNvbnN0IHJhZGl1c0JvdHRvbSA9IDAuNQogICAqICAgICBjb25zdCBoZWlnaHQgPSAyCiAgICogICAgIGNvbnN0IG51bVNlZ21lbnRzID0gMTIKICAgKiAgICAgY29uc3QgY3lsaW5kZXJTaGFwZSA9IG5ldyBDQU5OT04uQ3lsaW5kZXIocmFkaXVzVG9wLCByYWRpdXNCb3R0b20sIGhlaWdodCwgbnVtU2VnbWVudHMpCiAgICogICAgIGNvbnN0IGN5bGluZGVyQm9keSA9IG5ldyBDQU5OT04uQm9keSh7IG1hc3M6IDEsIHNoYXBlOiBjeWxpbmRlclNoYXBlIH0pCiAgICogICAgIHdvcmxkLmFkZEJvZHkoY3lsaW5kZXJCb2R5KQogICAqLwoKICBjbGFzcyBDeWxpbmRlciBleHRlbmRzIENvbnZleFBvbHloZWRyb24gewogICAgLyoqIFRoZSByYWRpdXMgb2YgdGhlIHRvcCBvZiB0aGUgQ3lsaW5kZXIuICovCgogICAgLyoqIFRoZSByYWRpdXMgb2YgdGhlIGJvdHRvbSBvZiB0aGUgQ3lsaW5kZXIuICovCgogICAgLyoqIFRoZSBoZWlnaHQgb2YgdGhlIEN5bGluZGVyLiAqLwoKICAgIC8qKiBUaGUgbnVtYmVyIG9mIHNlZ21lbnRzIHRvIGJ1aWxkIHRoZSBjeWxpbmRlciBvdXQgb2YuICovCgogICAgLyoqCiAgICAgKiBAcGFyYW0gcmFkaXVzVG9wIFRoZSByYWRpdXMgb2YgdGhlIHRvcCBvZiB0aGUgQ3lsaW5kZXIuCiAgICAgKiBAcGFyYW0gcmFkaXVzQm90dG9tIFRoZSByYWRpdXMgb2YgdGhlIGJvdHRvbSBvZiB0aGUgQ3lsaW5kZXIuCiAgICAgKiBAcGFyYW0gaGVpZ2h0IFRoZSBoZWlnaHQgb2YgdGhlIEN5bGluZGVyLgogICAgICogQHBhcmFtIG51bVNlZ21lbnRzIFRoZSBudW1iZXIgb2Ygc2VnbWVudHMgdG8gYnVpbGQgdGhlIGN5bGluZGVyIG91dCBvZi4KICAgICAqLwogICAgY29uc3RydWN0b3IocmFkaXVzVG9wLCByYWRpdXNCb3R0b20sIGhlaWdodCwgbnVtU2VnbWVudHMpIHsKICAgICAgaWYgKHJhZGl1c1RvcCA9PT0gdm9pZCAwKSB7CiAgICAgICAgcmFkaXVzVG9wID0gMTsKICAgICAgfQoKICAgICAgaWYgKHJhZGl1c0JvdHRvbSA9PT0gdm9pZCAwKSB7CiAgICAgICAgcmFkaXVzQm90dG9tID0gMTsKICAgICAgfQoKICAgICAgaWYgKGhlaWdodCA9PT0gdm9pZCAwKSB7CiAgICAgICAgaGVpZ2h0ID0gMTsKICAgICAgfQoKICAgICAgaWYgKG51bVNlZ21lbnRzID09PSB2b2lkIDApIHsKICAgICAgICBudW1TZWdtZW50cyA9IDg7CiAgICAgIH0KCiAgICAgIGlmIChyYWRpdXNUb3AgPCAwKSB7CiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdUaGUgY3lsaW5kZXIgcmFkaXVzVG9wIGNhbm5vdCBiZSBuZWdhdGl2ZS4nKTsKICAgICAgfQoKICAgICAgaWYgKHJhZGl1c0JvdHRvbSA8IDApIHsKICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1RoZSBjeWxpbmRlciByYWRpdXNCb3R0b20gY2Fubm90IGJlIG5lZ2F0aXZlLicpOwogICAgICB9CgogICAgICBjb25zdCBOID0gbnVtU2VnbWVudHM7CiAgICAgIGNvbnN0IHZlcnRpY2VzID0gW107CiAgICAgIGNvbnN0IGF4ZXMgPSBbXTsKICAgICAgY29uc3QgZmFjZXMgPSBbXTsKICAgICAgY29uc3QgYm90dG9tZmFjZSA9IFtdOwogICAgICBjb25zdCB0b3BmYWNlID0gW107CiAgICAgIGNvbnN0IGNvcyA9IE1hdGguY29zOwogICAgICBjb25zdCBzaW4gPSBNYXRoLnNpbjsgLy8gRmlyc3QgYm90dG9tIHBvaW50CgogICAgICB2ZXJ0aWNlcy5wdXNoKG5ldyBWZWMzKC1yYWRpdXNCb3R0b20gKiBzaW4oMCksIC1oZWlnaHQgKiAwLjUsIHJhZGl1c0JvdHRvbSAqIGNvcygwKSkpOwogICAgICBib3R0b21mYWNlLnB1c2goMCk7IC8vIEZpcnN0IHRvcCBwb2ludAoKICAgICAgdmVydGljZXMucHVzaChuZXcgVmVjMygtcmFkaXVzVG9wICogc2luKDApLCBoZWlnaHQgKiAwLjUsIHJhZGl1c1RvcCAqIGNvcygwKSkpOwogICAgICB0b3BmYWNlLnB1c2goMSk7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IE47IGkrKykgewogICAgICAgIGNvbnN0IHRoZXRhID0gMiAqIE1hdGguUEkgLyBOICogKGkgKyAxKTsKICAgICAgICBjb25zdCB0aGV0YU4gPSAyICogTWF0aC5QSSAvIE4gKiAoaSArIDAuNSk7CgogICAgICAgIGlmIChpIDwgTiAtIDEpIHsKICAgICAgICAgIC8vIEJvdHRvbQogICAgICAgICAgdmVydGljZXMucHVzaChuZXcgVmVjMygtcmFkaXVzQm90dG9tICogc2luKHRoZXRhKSwgLWhlaWdodCAqIDAuNSwgcmFkaXVzQm90dG9tICogY29zKHRoZXRhKSkpOwogICAgICAgICAgYm90dG9tZmFjZS5wdXNoKDIgKiBpICsgMik7IC8vIFRvcAoKICAgICAgICAgIHZlcnRpY2VzLnB1c2gobmV3IFZlYzMoLXJhZGl1c1RvcCAqIHNpbih0aGV0YSksIGhlaWdodCAqIDAuNSwgcmFkaXVzVG9wICogY29zKHRoZXRhKSkpOwogICAgICAgICAgdG9wZmFjZS5wdXNoKDIgKiBpICsgMyk7IC8vIEZhY2UKCiAgICAgICAgICBmYWNlcy5wdXNoKFsyICogaSwgMiAqIGkgKyAxLCAyICogaSArIDMsIDIgKiBpICsgMl0pOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBmYWNlcy5wdXNoKFsyICogaSwgMiAqIGkgKyAxLCAxLCAwXSk7IC8vIENvbm5lY3QKICAgICAgICB9IC8vIEF4aXM6IHdlIGNhbiBjdXQgb2ZmIGhhbGYgb2YgdGhlbSBpZiB3ZSBoYXZlIGV2ZW4gbnVtYmVyIG9mIHNlZ21lbnRzCgoKICAgICAgICBpZiAoTiAlIDIgPT09IDEgfHwgaSA8IE4gLyAyKSB7CiAgICAgICAgICBheGVzLnB1c2gobmV3IFZlYzMoLXNpbih0aGV0YU4pLCAwLCBjb3ModGhldGFOKSkpOwogICAgICAgIH0KICAgICAgfQoKICAgICAgZmFjZXMucHVzaChib3R0b21mYWNlKTsKICAgICAgYXhlcy5wdXNoKG5ldyBWZWMzKDAsIDEsIDApKTsgLy8gUmVvcmRlciB0b3AgZmFjZQoKICAgICAgY29uc3QgdGVtcCA9IFtdOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0b3BmYWNlLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgdGVtcC5wdXNoKHRvcGZhY2VbdG9wZmFjZS5sZW5ndGggLSBpIC0gMV0pOwogICAgICB9CgogICAgICBmYWNlcy5wdXNoKHRlbXApOwogICAgICBzdXBlcih7CiAgICAgICAgdmVydGljZXMsCiAgICAgICAgZmFjZXMsCiAgICAgICAgYXhlcwogICAgICB9KTsKICAgICAgdGhpcy50eXBlID0gU2hhcGUudHlwZXMuQ1lMSU5ERVI7CiAgICAgIHRoaXMucmFkaXVzVG9wID0gcmFkaXVzVG9wOwogICAgICB0aGlzLnJhZGl1c0JvdHRvbSA9IHJhZGl1c0JvdHRvbTsKICAgICAgdGhpcy5oZWlnaHQgPSBoZWlnaHQ7CiAgICAgIHRoaXMubnVtU2VnbWVudHMgPSBudW1TZWdtZW50czsKICAgIH0KCiAgfQoKICAvKioKICAgKiBQYXJ0aWNsZSBzaGFwZS4KICAgKiBAZXhhbXBsZQogICAqICAgICBjb25zdCBwYXJ0aWNsZVNoYXBlID0gbmV3IENBTk5PTi5QYXJ0aWNsZSgpCiAgICogICAgIGNvbnN0IHBhcnRpY2xlQm9keSA9IG5ldyBDQU5OT04uQm9keSh7IG1hc3M6IDEsIHNoYXBlOiBwYXJ0aWNsZVNoYXBlIH0pCiAgICogICAgIHdvcmxkLmFkZEJvZHkocGFydGljbGVCb2R5KQogICAqLwogIGNsYXNzIFBhcnRpY2xlIGV4dGVuZHMgU2hhcGUgewogICAgY29uc3RydWN0b3IoKSB7CiAgICAgIHN1cGVyKHsKICAgICAgICB0eXBlOiBTaGFwZS50eXBlcy5QQVJUSUNMRQogICAgICB9KTsKICAgIH0KICAgIC8qKgogICAgICogY2FsY3VsYXRlTG9jYWxJbmVydGlhCiAgICAgKi8KCgogICAgY2FsY3VsYXRlTG9jYWxJbmVydGlhKG1hc3MsIHRhcmdldCkgewogICAgICBpZiAodGFyZ2V0ID09PSB2b2lkIDApIHsKICAgICAgICB0YXJnZXQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICB0YXJnZXQuc2V0KDAsIDAsIDApOwogICAgICByZXR1cm4gdGFyZ2V0OwogICAgfQoKICAgIHZvbHVtZSgpIHsKICAgICAgcmV0dXJuIDA7CiAgICB9CgogICAgdXBkYXRlQm91bmRpbmdTcGhlcmVSYWRpdXMoKSB7CiAgICAgIHRoaXMuYm91bmRpbmdTcGhlcmVSYWRpdXMgPSAwOwogICAgfQoKICAgIGNhbGN1bGF0ZVdvcmxkQUFCQihwb3MsIHF1YXQsIG1pbiwgbWF4KSB7CiAgICAgIC8vIEdldCBlYWNoIGF4aXMgbWF4CiAgICAgIG1pbi5jb3B5KHBvcyk7CiAgICAgIG1heC5jb3B5KHBvcyk7CiAgICB9CgogIH0KCiAgLyoqCiAgICogQSBwbGFuZSwgZmFjaW5nIGluIHRoZSBaIGRpcmVjdGlvbi4gVGhlIHBsYW5lIGhhcyBpdHMgc3VyZmFjZSBhdCB6PTAgYW5kIGV2ZXJ5dGhpbmcgYmVsb3cgej0wIGlzIGFzc3VtZWQgdG8gYmUgc29saWQgcGxhbmUuIFRvIG1ha2UgdGhlIHBsYW5lIGZhY2UgaW4gc29tZSBvdGhlciBkaXJlY3Rpb24gdGhhbiB6LCB5b3UgbXVzdCBwdXQgaXQgaW5zaWRlIGEgQm9keSBhbmQgcm90YXRlIHRoYXQgYm9keS4gU2VlIHRoZSBkZW1vcy4KICAgKiBAZXhhbXBsZQogICAqICAgICBjb25zdCBwbGFuZVNoYXBlID0gbmV3IENBTk5PTi5QbGFuZSgpCiAgICogICAgIGNvbnN0IHBsYW5lQm9keSA9IG5ldyBDQU5OT04uQm9keSh7IG1hc3M6IDAsIHNoYXBlOiAgcGxhbmVTaGFwZSB9KQogICAqICAgICBwbGFuZUJvZHkucXVhdGVybmlvbi5zZXRGcm9tRXVsZXIoLU1hdGguUEkgLyAyLCAwLCAwKSAvLyBtYWtlIGl0IGZhY2UgdXAKICAgKiAgICAgd29ybGQuYWRkQm9keShwbGFuZUJvZHkpCiAgICovCiAgY2xhc3MgUGxhbmUgZXh0ZW5kcyBTaGFwZSB7CiAgICAvKiogd29ybGROb3JtYWwgKi8KCiAgICAvKiogd29ybGROb3JtYWxOZWVkc1VwZGF0ZSAqLwogICAgY29uc3RydWN0b3IoKSB7CiAgICAgIHN1cGVyKHsKICAgICAgICB0eXBlOiBTaGFwZS50eXBlcy5QTEFORQogICAgICB9KTsgLy8gV29ybGQgb3JpZW50ZWQgbm9ybWFsCgogICAgICB0aGlzLndvcmxkTm9ybWFsID0gbmV3IFZlYzMoKTsKICAgICAgdGhpcy53b3JsZE5vcm1hbE5lZWRzVXBkYXRlID0gdHJ1ZTsKICAgICAgdGhpcy5ib3VuZGluZ1NwaGVyZVJhZGl1cyA9IE51bWJlci5NQVhfVkFMVUU7CiAgICB9CiAgICAvKiogY29tcHV0ZVdvcmxkTm9ybWFsICovCgoKICAgIGNvbXB1dGVXb3JsZE5vcm1hbChxdWF0KSB7CiAgICAgIGNvbnN0IG4gPSB0aGlzLndvcmxkTm9ybWFsOwogICAgICBuLnNldCgwLCAwLCAxKTsKICAgICAgcXVhdC52bXVsdChuLCBuKTsKICAgICAgdGhpcy53b3JsZE5vcm1hbE5lZWRzVXBkYXRlID0gZmFsc2U7CiAgICB9CgogICAgY2FsY3VsYXRlTG9jYWxJbmVydGlhKG1hc3MsIHRhcmdldCkgewogICAgICBpZiAodGFyZ2V0ID09PSB2b2lkIDApIHsKICAgICAgICB0YXJnZXQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICByZXR1cm4gdGFyZ2V0OwogICAgfQoKICAgIHZvbHVtZSgpIHsKICAgICAgcmV0dXJuICgvLyBUaGUgcGxhbmUgaXMgaW5maW5pdGUuLi4KICAgICAgICBOdW1iZXIuTUFYX1ZBTFVFCiAgICAgICk7CiAgICB9CgogICAgY2FsY3VsYXRlV29ybGRBQUJCKHBvcywgcXVhdCwgbWluLCBtYXgpIHsKICAgICAgLy8gVGhlIHBsYW5lIEFBQkIgaXMgaW5maW5pdGUsIGV4Y2VwdCBpZiB0aGUgbm9ybWFsIGlzIHBvaW50aW5nIGFsb25nIGFueSBheGlzCiAgICAgIHRlbXBOb3JtYWwuc2V0KDAsIDAsIDEpOyAvLyBEZWZhdWx0IHBsYW5lIG5vcm1hbCBpcyB6CgogICAgICBxdWF0LnZtdWx0KHRlbXBOb3JtYWwsIHRlbXBOb3JtYWwpOwogICAgICBjb25zdCBtYXhWYWwgPSBOdW1iZXIuTUFYX1ZBTFVFOwogICAgICBtaW4uc2V0KC1tYXhWYWwsIC1tYXhWYWwsIC1tYXhWYWwpOwogICAgICBtYXguc2V0KG1heFZhbCwgbWF4VmFsLCBtYXhWYWwpOwoKICAgICAgaWYgKHRlbXBOb3JtYWwueCA9PT0gMSkgewogICAgICAgIG1heC54ID0gcG9zLng7CiAgICAgIH0gZWxzZSBpZiAodGVtcE5vcm1hbC54ID09PSAtMSkgewogICAgICAgIG1pbi54ID0gcG9zLng7CiAgICAgIH0KCiAgICAgIGlmICh0ZW1wTm9ybWFsLnkgPT09IDEpIHsKICAgICAgICBtYXgueSA9IHBvcy55OwogICAgICB9IGVsc2UgaWYgKHRlbXBOb3JtYWwueSA9PT0gLTEpIHsKICAgICAgICBtaW4ueSA9IHBvcy55OwogICAgICB9CgogICAgICBpZiAodGVtcE5vcm1hbC56ID09PSAxKSB7CiAgICAgICAgbWF4LnogPSBwb3MuejsKICAgICAgfSBlbHNlIGlmICh0ZW1wTm9ybWFsLnogPT09IC0xKSB7CiAgICAgICAgbWluLnogPSBwb3MuejsKICAgICAgfQogICAgfQoKICAgIHVwZGF0ZUJvdW5kaW5nU3BoZXJlUmFkaXVzKCkgewogICAgICB0aGlzLmJvdW5kaW5nU3BoZXJlUmFkaXVzID0gTnVtYmVyLk1BWF9WQUxVRTsKICAgIH0KCiAgfQogIGNvbnN0IHRlbXBOb3JtYWwgPSBuZXcgVmVjMygpOwoKICAvKioKICAgKiBIZWlnaHRmaWVsZCBzaGFwZSBjbGFzcy4gSGVpZ2h0IGRhdGEgaXMgZ2l2ZW4gYXMgYW4gYXJyYXkuIFRoZXNlIGRhdGEgcG9pbnRzIGFyZSBzcHJlYWQgb3V0IGV2ZW5seSB3aXRoIGEgZ2l2ZW4gZGlzdGFuY2UuCiAgICogQHRvZG8gU2hvdWxkIGJlIHBvc3NpYmxlIHRvIHVzZSBhbG9uZyBhbGwgYXhlcywgbm90IGp1c3QgeQogICAqIEB0b2RvIHNob3VsZCBiZSBwb3NzaWJsZSB0byBzY2FsZSBhbG9uZyBhbGwgYXhlcwogICAqIEB0b2RvIFJlZmFjdG9yIGVsZW1lbnRTaXplIHRvIGVsZW1lbnRTaXplWCBhbmQgZWxlbWVudFNpemVZCiAgICoKICAgKiBAZXhhbXBsZQogICAqICAgICAvLyBHZW5lcmF0ZSBzb21lIGhlaWdodCBkYXRhICh5LXZhbHVlcykuCiAgICogICAgIGNvbnN0IGRhdGEgPSBbXQogICAqICAgICBmb3IgKGxldCBpID0gMDsgaSA8IDEwMDA7IGkrKykgewogICAqICAgICAgICAgY29uc3QgeSA9IDAuNSAqIE1hdGguY29zKDAuMiAqIGkpCiAgICogICAgICAgICBkYXRhLnB1c2goeSkKICAgKiAgICAgfQogICAqCiAgICogICAgIC8vIENyZWF0ZSB0aGUgaGVpZ2h0ZmllbGQgc2hhcGUKICAgKiAgICAgY29uc3QgaGVpZ2h0ZmllbGRTaGFwZSA9IG5ldyBDQU5OT04uSGVpZ2h0ZmllbGQoZGF0YSwgewogICAqICAgICAgICAgZWxlbWVudFNpemU6IDEgLy8gRGlzdGFuY2UgYmV0d2VlbiB0aGUgZGF0YSBwb2ludHMgaW4gWCBhbmQgWSBkaXJlY3Rpb25zCiAgICogICAgIH0pCiAgICogICAgIGNvbnN0IGhlaWdodGZpZWxkQm9keSA9IG5ldyBDQU5OT04uQm9keSh7IHNoYXBlOiBoZWlnaHRmaWVsZFNoYXBlIH0pCiAgICogICAgIHdvcmxkLmFkZEJvZHkoaGVpZ2h0ZmllbGRCb2R5KQogICAqLwogIGNsYXNzIEhlaWdodGZpZWxkIGV4dGVuZHMgU2hhcGUgewogICAgLyoqCiAgICAgKiBBbiBhcnJheSBvZiBudW1iZXJzLCBvciBoZWlnaHQgdmFsdWVzLCB0aGF0IGFyZSBzcHJlYWQgb3V0IGFsb25nIHRoZSB4IGF4aXMuCiAgICAgKi8KCiAgICAvKioKICAgICAqIE1heCB2YWx1ZSBvZiB0aGUgZGF0YSBwb2ludHMgaW4gdGhlIGRhdGEgYXJyYXkuCiAgICAgKi8KCiAgICAvKioKICAgICAqIE1pbmltdW0gdmFsdWUgb2YgdGhlIGRhdGEgcG9pbnRzIGluIHRoZSBkYXRhIGFycmF5LgogICAgICovCgogICAgLyoqCiAgICAgKiBXb3JsZCBzcGFjaW5nIGJldHdlZW4gdGhlIGRhdGEgcG9pbnRzIGluIFggYW5kIFkgZGlyZWN0aW9uLgogICAgICogQHRvZG8gZWxlbWVudFNpemVYIGFuZCBZCiAgICAgKiBAZGVmYXVsdCAxCiAgICAgKi8KCiAgICAvKioKICAgICAqIEBkZWZhdWx0IHRydWUKICAgICAqLwoKICAgIC8qKgogICAgICogQHBhcmFtIGRhdGEgQW4gYXJyYXkgb2YgbnVtYmVycywgb3IgaGVpZ2h0IHZhbHVlcywgdGhhdCBhcmUgc3ByZWFkIG91dCBhbG9uZyB0aGUgeCBheGlzLgogICAgICovCiAgICBjb25zdHJ1Y3RvcihkYXRhLCBvcHRpb25zKSB7CiAgICAgIGlmIChvcHRpb25zID09PSB2b2lkIDApIHsKICAgICAgICBvcHRpb25zID0ge307CiAgICAgIH0KCiAgICAgIG9wdGlvbnMgPSBVdGlscy5kZWZhdWx0cyhvcHRpb25zLCB7CiAgICAgICAgbWF4VmFsdWU6IG51bGwsCiAgICAgICAgbWluVmFsdWU6IG51bGwsCiAgICAgICAgZWxlbWVudFNpemU6IDEKICAgICAgfSk7CiAgICAgIHN1cGVyKHsKICAgICAgICB0eXBlOiBTaGFwZS50eXBlcy5IRUlHSFRGSUVMRAogICAgICB9KTsKICAgICAgdGhpcy5kYXRhID0gZGF0YTsKICAgICAgdGhpcy5tYXhWYWx1ZSA9IG9wdGlvbnMubWF4VmFsdWU7CiAgICAgIHRoaXMubWluVmFsdWUgPSBvcHRpb25zLm1pblZhbHVlOwogICAgICB0aGlzLmVsZW1lbnRTaXplID0gb3B0aW9ucy5lbGVtZW50U2l6ZTsKCiAgICAgIGlmIChvcHRpb25zLm1pblZhbHVlID09PSBudWxsKSB7CiAgICAgICAgdGhpcy51cGRhdGVNaW5WYWx1ZSgpOwogICAgICB9CgogICAgICBpZiAob3B0aW9ucy5tYXhWYWx1ZSA9PT0gbnVsbCkgewogICAgICAgIHRoaXMudXBkYXRlTWF4VmFsdWUoKTsKICAgICAgfQoKICAgICAgdGhpcy5jYWNoZUVuYWJsZWQgPSB0cnVlOwogICAgICB0aGlzLnBpbGxhckNvbnZleCA9IG5ldyBDb252ZXhQb2x5aGVkcm9uKCk7CiAgICAgIHRoaXMucGlsbGFyT2Zmc2V0ID0gbmV3IFZlYzMoKTsKICAgICAgdGhpcy51cGRhdGVCb3VuZGluZ1NwaGVyZVJhZGl1cygpOyAvLyAiaV9qX2lzVXBwZXIiID0+IHsgY29udmV4OiAuLi4sIG9mZnNldDogLi4uIH0KICAgICAgLy8gZm9yIGV4YW1wbGU6CiAgICAgIC8vIF9jYWNoZWRQaWxsYXJzWyIwXzJfMSJdCgogICAgICB0aGlzLl9jYWNoZWRQaWxsYXJzID0ge307CiAgICB9CiAgICAvKioKICAgICAqIENhbGwgd2hlbmV2ZXIgeW91IGNoYW5nZSB0aGUgZGF0YSBhcnJheS4KICAgICAqLwoKCiAgICB1cGRhdGUoKSB7CiAgICAgIHRoaXMuX2NhY2hlZFBpbGxhcnMgPSB7fTsKICAgIH0KICAgIC8qKgogICAgICogVXBkYXRlIHRoZSBgbWluVmFsdWVgIHByb3BlcnR5CiAgICAgKi8KCgogICAgdXBkYXRlTWluVmFsdWUoKSB7CiAgICAgIGNvbnN0IGRhdGEgPSB0aGlzLmRhdGE7CiAgICAgIGxldCBtaW5WYWx1ZSA9IGRhdGFbMF1bMF07CgogICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gZGF0YS5sZW5ndGg7IGkrKykgewogICAgICAgIGZvciAobGV0IGogPSAwOyBqICE9PSBkYXRhW2ldLmxlbmd0aDsgaisrKSB7CiAgICAgICAgICBjb25zdCB2ID0gZGF0YVtpXVtqXTsKCiAgICAgICAgICBpZiAodiA8IG1pblZhbHVlKSB7CiAgICAgICAgICAgIG1pblZhbHVlID0gdjsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KCiAgICAgIHRoaXMubWluVmFsdWUgPSBtaW5WYWx1ZTsKICAgIH0KICAgIC8qKgogICAgICogVXBkYXRlIHRoZSBgbWF4VmFsdWVgIHByb3BlcnR5CiAgICAgKi8KCgogICAgdXBkYXRlTWF4VmFsdWUoKSB7CiAgICAgIGNvbnN0IGRhdGEgPSB0aGlzLmRhdGE7CiAgICAgIGxldCBtYXhWYWx1ZSA9IGRhdGFbMF1bMF07CgogICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gZGF0YS5sZW5ndGg7IGkrKykgewogICAgICAgIGZvciAobGV0IGogPSAwOyBqICE9PSBkYXRhW2ldLmxlbmd0aDsgaisrKSB7CiAgICAgICAgICBjb25zdCB2ID0gZGF0YVtpXVtqXTsKCiAgICAgICAgICBpZiAodiA+IG1heFZhbHVlKSB7CiAgICAgICAgICAgIG1heFZhbHVlID0gdjsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KCiAgICAgIHRoaXMubWF4VmFsdWUgPSBtYXhWYWx1ZTsKICAgIH0KICAgIC8qKgogICAgICogU2V0IHRoZSBoZWlnaHQgdmFsdWUgYXQgYW4gaW5kZXguIERvbid0IGZvcmdldCB0byB1cGRhdGUgbWF4VmFsdWUgYW5kIG1pblZhbHVlIGFmdGVyIHlvdSdyZSBkb25lLgogICAgICovCgoKICAgIHNldEhlaWdodFZhbHVlQXRJbmRleCh4aSwgeWksIHZhbHVlKSB7CiAgICAgIGNvbnN0IGRhdGEgPSB0aGlzLmRhdGE7CiAgICAgIGRhdGFbeGldW3lpXSA9IHZhbHVlOyAvLyBJbnZhbGlkYXRlIGNhY2hlCgogICAgICB0aGlzLmNsZWFyQ2FjaGVkQ29udmV4VHJpYW5nbGVQaWxsYXIoeGksIHlpLCBmYWxzZSk7CgogICAgICBpZiAoeGkgPiAwKSB7CiAgICAgICAgdGhpcy5jbGVhckNhY2hlZENvbnZleFRyaWFuZ2xlUGlsbGFyKHhpIC0gMSwgeWksIHRydWUpOwogICAgICAgIHRoaXMuY2xlYXJDYWNoZWRDb252ZXhUcmlhbmdsZVBpbGxhcih4aSAtIDEsIHlpLCBmYWxzZSk7CiAgICAgIH0KCiAgICAgIGlmICh5aSA+IDApIHsKICAgICAgICB0aGlzLmNsZWFyQ2FjaGVkQ29udmV4VHJpYW5nbGVQaWxsYXIoeGksIHlpIC0gMSwgdHJ1ZSk7CiAgICAgICAgdGhpcy5jbGVhckNhY2hlZENvbnZleFRyaWFuZ2xlUGlsbGFyKHhpLCB5aSAtIDEsIGZhbHNlKTsKICAgICAgfQoKICAgICAgaWYgKHlpID4gMCAmJiB4aSA+IDApIHsKICAgICAgICB0aGlzLmNsZWFyQ2FjaGVkQ29udmV4VHJpYW5nbGVQaWxsYXIoeGkgLSAxLCB5aSAtIDEsIHRydWUpOwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIEdldCBtYXgvbWluIGluIGEgcmVjdGFuZ2xlIGluIHRoZSBtYXRyaXggZGF0YQogICAgICogQHBhcmFtIHJlc3VsdCBBbiBhcnJheSB0byBzdG9yZSB0aGUgcmVzdWx0cyBpbi4KICAgICAqIEByZXR1cm4gVGhlIHJlc3VsdCBhcnJheSwgaWYgaXQgd2FzIHBhc3NlZCBpbi4gTWluaW11bSB3aWxsIGJlIGF0IHBvc2l0aW9uIDAgYW5kIG1heCBhdCAxLgogICAgICovCgoKICAgIGdldFJlY3RNaW5NYXgoaU1pblgsIGlNaW5ZLCBpTWF4WCwgaU1heFksIHJlc3VsdCkgewogICAgICBpZiAocmVzdWx0ID09PSB2b2lkIDApIHsKICAgICAgICByZXN1bHQgPSBbXTsKICAgICAgfQoKICAgICAgLy8gR2V0IG1heCBhbmQgbWluIG9mIHRoZSBkYXRhCiAgICAgIGNvbnN0IGRhdGEgPSB0aGlzLmRhdGE7IC8vIFNldCBmaXJzdCB2YWx1ZQoKICAgICAgbGV0IG1heCA9IHRoaXMubWluVmFsdWU7CgogICAgICBmb3IgKGxldCBpID0gaU1pblg7IGkgPD0gaU1heFg7IGkrKykgewogICAgICAgIGZvciAobGV0IGogPSBpTWluWTsgaiA8PSBpTWF4WTsgaisrKSB7CiAgICAgICAgICBjb25zdCBoZWlnaHQgPSBkYXRhW2ldW2pdOwoKICAgICAgICAgIGlmIChoZWlnaHQgPiBtYXgpIHsKICAgICAgICAgICAgbWF4ID0gaGVpZ2h0OwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQoKICAgICAgcmVzdWx0WzBdID0gdGhpcy5taW5WYWx1ZTsKICAgICAgcmVzdWx0WzFdID0gbWF4OwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgdGhlIGluZGV4IG9mIGEgbG9jYWwgcG9zaXRpb24gb24gdGhlIGhlaWdodGZpZWxkLiBUaGUgaW5kZXhlcyBpbmRpY2F0ZSB0aGUgcmVjdGFuZ2xlcywgc28gaWYgeW91ciB0ZXJyYWluIGlzIG1hZGUgb2YgTiB4IE4gaGVpZ2h0IGRhdGEgcG9pbnRzLCB5b3Ugd2lsbCBoYXZlIHJlY3RhbmdsZSBpbmRleGVzIHJhbmdpbmcgZnJvbSAwIHRvIE4tMS4KICAgICAqIEBwYXJhbSByZXN1bHQgVHdvLWVsZW1lbnQgYXJyYXkKICAgICAqIEBwYXJhbSBjbGFtcCBJZiB0aGUgcG9zaXRpb24gc2hvdWxkIGJlIGNsYW1wZWQgdG8gdGhlIGhlaWdodGZpZWxkIGVkZ2UuCiAgICAgKi8KCgogICAgZ2V0SW5kZXhPZlBvc2l0aW9uKHgsIHksIHJlc3VsdCwgY2xhbXApIHsKICAgICAgLy8gR2V0IHRoZSBpbmRleCBvZiB0aGUgZGF0YSBwb2ludHMgdG8gdGVzdCBhZ2FpbnN0CiAgICAgIGNvbnN0IHcgPSB0aGlzLmVsZW1lbnRTaXplOwogICAgICBjb25zdCBkYXRhID0gdGhpcy5kYXRhOwogICAgICBsZXQgeGkgPSBNYXRoLmZsb29yKHggLyB3KTsKICAgICAgbGV0IHlpID0gTWF0aC5mbG9vcih5IC8gdyk7CiAgICAgIHJlc3VsdFswXSA9IHhpOwogICAgICByZXN1bHRbMV0gPSB5aTsKCiAgICAgIGlmIChjbGFtcCkgewogICAgICAgIC8vIENsYW1wIGluZGV4IHRvIGVkZ2VzCiAgICAgICAgaWYgKHhpIDwgMCkgewogICAgICAgICAgeGkgPSAwOwogICAgICAgIH0KCiAgICAgICAgaWYgKHlpIDwgMCkgewogICAgICAgICAgeWkgPSAwOwogICAgICAgIH0KCiAgICAgICAgaWYgKHhpID49IGRhdGEubGVuZ3RoIC0gMSkgewogICAgICAgICAgeGkgPSBkYXRhLmxlbmd0aCAtIDE7CiAgICAgICAgfQoKICAgICAgICBpZiAoeWkgPj0gZGF0YVswXS5sZW5ndGggLSAxKSB7CiAgICAgICAgICB5aSA9IGRhdGFbMF0ubGVuZ3RoIC0gMTsKICAgICAgICB9CiAgICAgIH0gLy8gQmFpbCBvdXQgaWYgd2UgYXJlIG91dCBvZiB0aGUgdGVycmFpbgoKCiAgICAgIGlmICh4aSA8IDAgfHwgeWkgPCAwIHx8IHhpID49IGRhdGEubGVuZ3RoIC0gMSB8fCB5aSA+PSBkYXRhWzBdLmxlbmd0aCAtIDEpIHsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0KCiAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIGdldFRyaWFuZ2xlQXQoeCwgeSwgZWRnZUNsYW1wLCBhLCBiLCBjKSB7CiAgICAgIGNvbnN0IGlkeCA9IGdldEhlaWdodEF0X2lkeDsKICAgICAgdGhpcy5nZXRJbmRleE9mUG9zaXRpb24oeCwgeSwgaWR4LCBlZGdlQ2xhbXApOwogICAgICBsZXQgeGkgPSBpZHhbMF07CiAgICAgIGxldCB5aSA9IGlkeFsxXTsKICAgICAgY29uc3QgZGF0YSA9IHRoaXMuZGF0YTsKCiAgICAgIGlmIChlZGdlQ2xhbXApIHsKICAgICAgICB4aSA9IE1hdGgubWluKGRhdGEubGVuZ3RoIC0gMiwgTWF0aC5tYXgoMCwgeGkpKTsKICAgICAgICB5aSA9IE1hdGgubWluKGRhdGFbMF0ubGVuZ3RoIC0gMiwgTWF0aC5tYXgoMCwgeWkpKTsKICAgICAgfQoKICAgICAgY29uc3QgZWxlbWVudFNpemUgPSB0aGlzLmVsZW1lbnRTaXplOwogICAgICBjb25zdCBsb3dlckRpc3QyID0gKHggLyBlbGVtZW50U2l6ZSAtIHhpKSAqKiAyICsgKHkgLyBlbGVtZW50U2l6ZSAtIHlpKSAqKiAyOwogICAgICBjb25zdCB1cHBlckRpc3QyID0gKHggLyBlbGVtZW50U2l6ZSAtICh4aSArIDEpKSAqKiAyICsgKHkgLyBlbGVtZW50U2l6ZSAtICh5aSArIDEpKSAqKiAyOwogICAgICBjb25zdCB1cHBlciA9IGxvd2VyRGlzdDIgPiB1cHBlckRpc3QyOwogICAgICB0aGlzLmdldFRyaWFuZ2xlKHhpLCB5aSwgdXBwZXIsIGEsIGIsIGMpOwogICAgICByZXR1cm4gdXBwZXI7CiAgICB9CgogICAgZ2V0Tm9ybWFsQXQoeCwgeSwgZWRnZUNsYW1wLCByZXN1bHQpIHsKICAgICAgY29uc3QgYSA9IGdldE5vcm1hbEF0X2E7CiAgICAgIGNvbnN0IGIgPSBnZXROb3JtYWxBdF9iOwogICAgICBjb25zdCBjID0gZ2V0Tm9ybWFsQXRfYzsKICAgICAgY29uc3QgZTAgPSBnZXROb3JtYWxBdF9lMDsKICAgICAgY29uc3QgZTEgPSBnZXROb3JtYWxBdF9lMTsKICAgICAgdGhpcy5nZXRUcmlhbmdsZUF0KHgsIHksIGVkZ2VDbGFtcCwgYSwgYiwgYyk7CiAgICAgIGIudnN1YihhLCBlMCk7CiAgICAgIGMudnN1YihhLCBlMSk7CiAgICAgIGUwLmNyb3NzKGUxLCByZXN1bHQpOwogICAgICByZXN1bHQubm9ybWFsaXplKCk7CiAgICB9CiAgICAvKioKICAgICAqIEdldCBhbiBBQUJCIG9mIGEgc3F1YXJlIGluIHRoZSBoZWlnaHRmaWVsZAogICAgICogQHBhcmFtIHhpCiAgICAgKiBAcGFyYW0geWkKICAgICAqIEBwYXJhbSByZXN1bHQKICAgICAqLwoKCiAgICBnZXRBYWJiQXRJbmRleCh4aSwgeWksIF9yZWYpIHsKICAgICAgbGV0IHsKICAgICAgICBsb3dlckJvdW5kLAogICAgICAgIHVwcGVyQm91bmQKICAgICAgfSA9IF9yZWY7CiAgICAgIGNvbnN0IGRhdGEgPSB0aGlzLmRhdGE7CiAgICAgIGNvbnN0IGVsZW1lbnRTaXplID0gdGhpcy5lbGVtZW50U2l6ZTsKICAgICAgbG93ZXJCb3VuZC5zZXQoeGkgKiBlbGVtZW50U2l6ZSwgeWkgKiBlbGVtZW50U2l6ZSwgZGF0YVt4aV1beWldKTsKICAgICAgdXBwZXJCb3VuZC5zZXQoKHhpICsgMSkgKiBlbGVtZW50U2l6ZSwgKHlpICsgMSkgKiBlbGVtZW50U2l6ZSwgZGF0YVt4aSArIDFdW3lpICsgMV0pOwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgdGhlIGhlaWdodCBpbiB0aGUgaGVpZ2h0ZmllbGQgYXQgYSBnaXZlbiBwb3NpdGlvbgogICAgICovCgoKICAgIGdldEhlaWdodEF0KHgsIHksIGVkZ2VDbGFtcCkgewogICAgICBjb25zdCBkYXRhID0gdGhpcy5kYXRhOwogICAgICBjb25zdCBhID0gZ2V0SGVpZ2h0QXRfYTsKICAgICAgY29uc3QgYiA9IGdldEhlaWdodEF0X2I7CiAgICAgIGNvbnN0IGMgPSBnZXRIZWlnaHRBdF9jOwogICAgICBjb25zdCBpZHggPSBnZXRIZWlnaHRBdF9pZHg7CiAgICAgIHRoaXMuZ2V0SW5kZXhPZlBvc2l0aW9uKHgsIHksIGlkeCwgZWRnZUNsYW1wKTsKICAgICAgbGV0IHhpID0gaWR4WzBdOwogICAgICBsZXQgeWkgPSBpZHhbMV07CgogICAgICBpZiAoZWRnZUNsYW1wKSB7CiAgICAgICAgeGkgPSBNYXRoLm1pbihkYXRhLmxlbmd0aCAtIDIsIE1hdGgubWF4KDAsIHhpKSk7CiAgICAgICAgeWkgPSBNYXRoLm1pbihkYXRhWzBdLmxlbmd0aCAtIDIsIE1hdGgubWF4KDAsIHlpKSk7CiAgICAgIH0KCiAgICAgIGNvbnN0IHVwcGVyID0gdGhpcy5nZXRUcmlhbmdsZUF0KHgsIHksIGVkZ2VDbGFtcCwgYSwgYiwgYyk7CiAgICAgIGJhcnljZW50cmljV2VpZ2h0cyh4LCB5LCBhLngsIGEueSwgYi54LCBiLnksIGMueCwgYy55LCBnZXRIZWlnaHRBdF93ZWlnaHRzKTsKICAgICAgY29uc3QgdyA9IGdldEhlaWdodEF0X3dlaWdodHM7CgogICAgICBpZiAodXBwZXIpIHsKICAgICAgICAvLyBUb3AgdHJpYW5nbGUgdmVydHMKICAgICAgICByZXR1cm4gZGF0YVt4aSArIDFdW3lpICsgMV0gKiB3LnggKyBkYXRhW3hpXVt5aSArIDFdICogdy55ICsgZGF0YVt4aSArIDFdW3lpXSAqIHcuejsKICAgICAgfSBlbHNlIHsKICAgICAgICAvLyBUb3AgdHJpYW5nbGUgdmVydHMKICAgICAgICByZXR1cm4gZGF0YVt4aV1beWldICogdy54ICsgZGF0YVt4aSArIDFdW3lpXSAqIHcueSArIGRhdGFbeGldW3lpICsgMV0gKiB3Lno7CiAgICAgIH0KICAgIH0KCiAgICBnZXRDYWNoZUNvbnZleFRyaWFuZ2xlUGlsbGFyS2V5KHhpLCB5aSwgZ2V0VXBwZXJUcmlhbmdsZSkgewogICAgICByZXR1cm4gYCR7eGl9XyR7eWl9XyR7Z2V0VXBwZXJUcmlhbmdsZSA/IDEgOiAwfWA7CiAgICB9CgogICAgZ2V0Q2FjaGVkQ29udmV4VHJpYW5nbGVQaWxsYXIoeGksIHlpLCBnZXRVcHBlclRyaWFuZ2xlKSB7CiAgICAgIHJldHVybiB0aGlzLl9jYWNoZWRQaWxsYXJzW3RoaXMuZ2V0Q2FjaGVDb252ZXhUcmlhbmdsZVBpbGxhcktleSh4aSwgeWksIGdldFVwcGVyVHJpYW5nbGUpXTsKICAgIH0KCiAgICBzZXRDYWNoZWRDb252ZXhUcmlhbmdsZVBpbGxhcih4aSwgeWksIGdldFVwcGVyVHJpYW5nbGUsIGNvbnZleCwgb2Zmc2V0KSB7CiAgICAgIHRoaXMuX2NhY2hlZFBpbGxhcnNbdGhpcy5nZXRDYWNoZUNvbnZleFRyaWFuZ2xlUGlsbGFyS2V5KHhpLCB5aSwgZ2V0VXBwZXJUcmlhbmdsZSldID0gewogICAgICAgIGNvbnZleCwKICAgICAgICBvZmZzZXQKICAgICAgfTsKICAgIH0KCiAgICBjbGVhckNhY2hlZENvbnZleFRyaWFuZ2xlUGlsbGFyKHhpLCB5aSwgZ2V0VXBwZXJUcmlhbmdsZSkgewogICAgICBkZWxldGUgdGhpcy5fY2FjaGVkUGlsbGFyc1t0aGlzLmdldENhY2hlQ29udmV4VHJpYW5nbGVQaWxsYXJLZXkoeGksIHlpLCBnZXRVcHBlclRyaWFuZ2xlKV07CiAgICB9CiAgICAvKioKICAgICAqIEdldCBhIHRyaWFuZ2xlIGZyb20gdGhlIGhlaWdodGZpZWxkCiAgICAgKi8KCgogICAgZ2V0VHJpYW5nbGUoeGksIHlpLCB1cHBlciwgYSwgYiwgYykgewogICAgICBjb25zdCBkYXRhID0gdGhpcy5kYXRhOwogICAgICBjb25zdCBlbGVtZW50U2l6ZSA9IHRoaXMuZWxlbWVudFNpemU7CgogICAgICBpZiAodXBwZXIpIHsKICAgICAgICAvLyBUb3AgdHJpYW5nbGUgdmVydHMKICAgICAgICBhLnNldCgoeGkgKyAxKSAqIGVsZW1lbnRTaXplLCAoeWkgKyAxKSAqIGVsZW1lbnRTaXplLCBkYXRhW3hpICsgMV1beWkgKyAxXSk7CiAgICAgICAgYi5zZXQoeGkgKiBlbGVtZW50U2l6ZSwgKHlpICsgMSkgKiBlbGVtZW50U2l6ZSwgZGF0YVt4aV1beWkgKyAxXSk7CiAgICAgICAgYy5zZXQoKHhpICsgMSkgKiBlbGVtZW50U2l6ZSwgeWkgKiBlbGVtZW50U2l6ZSwgZGF0YVt4aSArIDFdW3lpXSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgLy8gVG9wIHRyaWFuZ2xlIHZlcnRzCiAgICAgICAgYS5zZXQoeGkgKiBlbGVtZW50U2l6ZSwgeWkgKiBlbGVtZW50U2l6ZSwgZGF0YVt4aV1beWldKTsKICAgICAgICBiLnNldCgoeGkgKyAxKSAqIGVsZW1lbnRTaXplLCB5aSAqIGVsZW1lbnRTaXplLCBkYXRhW3hpICsgMV1beWldKTsKICAgICAgICBjLnNldCh4aSAqIGVsZW1lbnRTaXplLCAoeWkgKyAxKSAqIGVsZW1lbnRTaXplLCBkYXRhW3hpXVt5aSArIDFdKTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBHZXQgYSB0cmlhbmdsZSBpbiB0aGUgdGVycmFpbiBpbiB0aGUgZm9ybSBvZiBhIHRyaWFuZ3VsYXIgY29udmV4IHNoYXBlLgogICAgICovCgoKICAgIGdldENvbnZleFRyaWFuZ2xlUGlsbGFyKHhpLCB5aSwgZ2V0VXBwZXJUcmlhbmdsZSkgewogICAgICBsZXQgcmVzdWx0ID0gdGhpcy5waWxsYXJDb252ZXg7CiAgICAgIGxldCBvZmZzZXRSZXN1bHQgPSB0aGlzLnBpbGxhck9mZnNldDsKCiAgICAgIGlmICh0aGlzLmNhY2hlRW5hYmxlZCkgewogICAgICAgIGNvbnN0IGRhdGEgPSB0aGlzLmdldENhY2hlZENvbnZleFRyaWFuZ2xlUGlsbGFyKHhpLCB5aSwgZ2V0VXBwZXJUcmlhbmdsZSk7CgogICAgICAgIGlmIChkYXRhKSB7CiAgICAgICAgICB0aGlzLnBpbGxhckNvbnZleCA9IGRhdGEuY29udmV4OwogICAgICAgICAgdGhpcy5waWxsYXJPZmZzZXQgPSBkYXRhLm9mZnNldDsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIHJlc3VsdCA9IG5ldyBDb252ZXhQb2x5aGVkcm9uKCk7CiAgICAgICAgb2Zmc2V0UmVzdWx0ID0gbmV3IFZlYzMoKTsKICAgICAgICB0aGlzLnBpbGxhckNvbnZleCA9IHJlc3VsdDsKICAgICAgICB0aGlzLnBpbGxhck9mZnNldCA9IG9mZnNldFJlc3VsdDsKICAgICAgfQoKICAgICAgY29uc3QgZGF0YSA9IHRoaXMuZGF0YTsKICAgICAgY29uc3QgZWxlbWVudFNpemUgPSB0aGlzLmVsZW1lbnRTaXplOwogICAgICBjb25zdCBmYWNlcyA9IHJlc3VsdC5mYWNlczsgLy8gUmV1c2UgdmVydHMgaWYgcG9zc2libGUKCiAgICAgIHJlc3VsdC52ZXJ0aWNlcy5sZW5ndGggPSA2OwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCA2OyBpKyspIHsKICAgICAgICBpZiAoIXJlc3VsdC52ZXJ0aWNlc1tpXSkgewogICAgICAgICAgcmVzdWx0LnZlcnRpY2VzW2ldID0gbmV3IFZlYzMoKTsKICAgICAgICB9CiAgICAgIH0gLy8gUmV1c2UgZmFjZXMgaWYgcG9zc2libGUKCgogICAgICBmYWNlcy5sZW5ndGggPSA1OwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCA1OyBpKyspIHsKICAgICAgICBpZiAoIWZhY2VzW2ldKSB7CiAgICAgICAgICBmYWNlc1tpXSA9IFtdOwogICAgICAgIH0KICAgICAgfQoKICAgICAgY29uc3QgdmVydHMgPSByZXN1bHQudmVydGljZXM7CiAgICAgIGNvbnN0IGggPSAoTWF0aC5taW4oZGF0YVt4aV1beWldLCBkYXRhW3hpICsgMV1beWldLCBkYXRhW3hpXVt5aSArIDFdLCBkYXRhW3hpICsgMV1beWkgKyAxXSkgLSB0aGlzLm1pblZhbHVlKSAvIDIgKyB0aGlzLm1pblZhbHVlOwoKICAgICAgaWYgKCFnZXRVcHBlclRyaWFuZ2xlKSB7CiAgICAgICAgLy8gQ2VudGVyIG9mIHRoZSB0cmlhbmdsZSBwaWxsYXIgLSBhbGwgcG9seWdvbnMgYXJlIGdpdmVuIHJlbGF0aXZlIHRvIHRoaXMgb25lCiAgICAgICAgb2Zmc2V0UmVzdWx0LnNldCgoeGkgKyAwLjI1KSAqIGVsZW1lbnRTaXplLCAvLyBzb3J0IG9mIGNlbnRlciBvZiBhIHRyaWFuZ2xlCiAgICAgICAgKHlpICsgMC4yNSkgKiBlbGVtZW50U2l6ZSwgaCAvLyB2ZXJ0aWNhbCBjZW50ZXIKICAgICAgICApOyAvLyBUb3AgdHJpYW5nbGUgdmVydHMKCiAgICAgICAgdmVydHNbMF0uc2V0KC0wLjI1ICogZWxlbWVudFNpemUsIC0wLjI1ICogZWxlbWVudFNpemUsIGRhdGFbeGldW3lpXSAtIGgpOwogICAgICAgIHZlcnRzWzFdLnNldCgwLjc1ICogZWxlbWVudFNpemUsIC0wLjI1ICogZWxlbWVudFNpemUsIGRhdGFbeGkgKyAxXVt5aV0gLSBoKTsKICAgICAgICB2ZXJ0c1syXS5zZXQoLTAuMjUgKiBlbGVtZW50U2l6ZSwgMC43NSAqIGVsZW1lbnRTaXplLCBkYXRhW3hpXVt5aSArIDFdIC0gaCk7IC8vIGJvdHRvbSB0cmlhbmdsZSB2ZXJ0cwoKICAgICAgICB2ZXJ0c1szXS5zZXQoLTAuMjUgKiBlbGVtZW50U2l6ZSwgLTAuMjUgKiBlbGVtZW50U2l6ZSwgLU1hdGguYWJzKGgpIC0gMSk7CiAgICAgICAgdmVydHNbNF0uc2V0KDAuNzUgKiBlbGVtZW50U2l6ZSwgLTAuMjUgKiBlbGVtZW50U2l6ZSwgLU1hdGguYWJzKGgpIC0gMSk7CiAgICAgICAgdmVydHNbNV0uc2V0KC0wLjI1ICogZWxlbWVudFNpemUsIDAuNzUgKiBlbGVtZW50U2l6ZSwgLU1hdGguYWJzKGgpIC0gMSk7IC8vIHRvcCB0cmlhbmdsZQoKICAgICAgICBmYWNlc1swXVswXSA9IDA7CiAgICAgICAgZmFjZXNbMF1bMV0gPSAxOwogICAgICAgIGZhY2VzWzBdWzJdID0gMjsgLy8gYm90dG9tIHRyaWFuZ2xlCgogICAgICAgIGZhY2VzWzFdWzBdID0gNTsKICAgICAgICBmYWNlc1sxXVsxXSA9IDQ7CiAgICAgICAgZmFjZXNbMV1bMl0gPSAzOyAvLyAteCBmYWNpbmcgcXVhZAoKICAgICAgICBmYWNlc1syXVswXSA9IDA7CiAgICAgICAgZmFjZXNbMl1bMV0gPSAyOwogICAgICAgIGZhY2VzWzJdWzJdID0gNTsKICAgICAgICBmYWNlc1syXVszXSA9IDM7IC8vIC15IGZhY2luZyBxdWFkCgogICAgICAgIGZhY2VzWzNdWzBdID0gMTsKICAgICAgICBmYWNlc1szXVsxXSA9IDA7CiAgICAgICAgZmFjZXNbM11bMl0gPSAzOwogICAgICAgIGZhY2VzWzNdWzNdID0gNDsgLy8gK3h5IGZhY2luZyBxdWFkCgogICAgICAgIGZhY2VzWzRdWzBdID0gNDsKICAgICAgICBmYWNlc1s0XVsxXSA9IDU7CiAgICAgICAgZmFjZXNbNF1bMl0gPSAyOwogICAgICAgIGZhY2VzWzRdWzNdID0gMTsKICAgICAgfSBlbHNlIHsKICAgICAgICAvLyBDZW50ZXIgb2YgdGhlIHRyaWFuZ2xlIHBpbGxhciAtIGFsbCBwb2x5Z29ucyBhcmUgZ2l2ZW4gcmVsYXRpdmUgdG8gdGhpcyBvbmUKICAgICAgICBvZmZzZXRSZXN1bHQuc2V0KCh4aSArIDAuNzUpICogZWxlbWVudFNpemUsIC8vIHNvcnQgb2YgY2VudGVyIG9mIGEgdHJpYW5nbGUKICAgICAgICAoeWkgKyAwLjc1KSAqIGVsZW1lbnRTaXplLCBoIC8vIHZlcnRpY2FsIGNlbnRlcgogICAgICAgICk7IC8vIFRvcCB0cmlhbmdsZSB2ZXJ0cwoKICAgICAgICB2ZXJ0c1swXS5zZXQoMC4yNSAqIGVsZW1lbnRTaXplLCAwLjI1ICogZWxlbWVudFNpemUsIGRhdGFbeGkgKyAxXVt5aSArIDFdIC0gaCk7CiAgICAgICAgdmVydHNbMV0uc2V0KC0wLjc1ICogZWxlbWVudFNpemUsIDAuMjUgKiBlbGVtZW50U2l6ZSwgZGF0YVt4aV1beWkgKyAxXSAtIGgpOwogICAgICAgIHZlcnRzWzJdLnNldCgwLjI1ICogZWxlbWVudFNpemUsIC0wLjc1ICogZWxlbWVudFNpemUsIGRhdGFbeGkgKyAxXVt5aV0gLSBoKTsgLy8gYm90dG9tIHRyaWFuZ2xlIHZlcnRzCgogICAgICAgIHZlcnRzWzNdLnNldCgwLjI1ICogZWxlbWVudFNpemUsIDAuMjUgKiBlbGVtZW50U2l6ZSwgLU1hdGguYWJzKGgpIC0gMSk7CiAgICAgICAgdmVydHNbNF0uc2V0KC0wLjc1ICogZWxlbWVudFNpemUsIDAuMjUgKiBlbGVtZW50U2l6ZSwgLU1hdGguYWJzKGgpIC0gMSk7CiAgICAgICAgdmVydHNbNV0uc2V0KDAuMjUgKiBlbGVtZW50U2l6ZSwgLTAuNzUgKiBlbGVtZW50U2l6ZSwgLU1hdGguYWJzKGgpIC0gMSk7IC8vIFRvcCB0cmlhbmdsZQoKICAgICAgICBmYWNlc1swXVswXSA9IDA7CiAgICAgICAgZmFjZXNbMF1bMV0gPSAxOwogICAgICAgIGZhY2VzWzBdWzJdID0gMjsgLy8gYm90dG9tIHRyaWFuZ2xlCgogICAgICAgIGZhY2VzWzFdWzBdID0gNTsKICAgICAgICBmYWNlc1sxXVsxXSA9IDQ7CiAgICAgICAgZmFjZXNbMV1bMl0gPSAzOyAvLyAreCBmYWNpbmcgcXVhZAoKICAgICAgICBmYWNlc1syXVswXSA9IDI7CiAgICAgICAgZmFjZXNbMl1bMV0gPSA1OwogICAgICAgIGZhY2VzWzJdWzJdID0gMzsKICAgICAgICBmYWNlc1syXVszXSA9IDA7IC8vICt5IGZhY2luZyBxdWFkCgogICAgICAgIGZhY2VzWzNdWzBdID0gMzsKICAgICAgICBmYWNlc1szXVsxXSA9IDQ7CiAgICAgICAgZmFjZXNbM11bMl0gPSAxOwogICAgICAgIGZhY2VzWzNdWzNdID0gMDsgLy8gLXh5IGZhY2luZyBxdWFkCgogICAgICAgIGZhY2VzWzRdWzBdID0gMTsKICAgICAgICBmYWNlc1s0XVsxXSA9IDQ7CiAgICAgICAgZmFjZXNbNF1bMl0gPSA1OwogICAgICAgIGZhY2VzWzRdWzNdID0gMjsKICAgICAgfQoKICAgICAgcmVzdWx0LmNvbXB1dGVOb3JtYWxzKCk7CiAgICAgIHJlc3VsdC5jb21wdXRlRWRnZXMoKTsKICAgICAgcmVzdWx0LnVwZGF0ZUJvdW5kaW5nU3BoZXJlUmFkaXVzKCk7CiAgICAgIHRoaXMuc2V0Q2FjaGVkQ29udmV4VHJpYW5nbGVQaWxsYXIoeGksIHlpLCBnZXRVcHBlclRyaWFuZ2xlLCByZXN1bHQsIG9mZnNldFJlc3VsdCk7CiAgICB9CgogICAgY2FsY3VsYXRlTG9jYWxJbmVydGlhKG1hc3MsIHRhcmdldCkgewogICAgICBpZiAodGFyZ2V0ID09PSB2b2lkIDApIHsKICAgICAgICB0YXJnZXQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICB0YXJnZXQuc2V0KDAsIDAsIDApOwogICAgICByZXR1cm4gdGFyZ2V0OwogICAgfQoKICAgIHZvbHVtZSgpIHsKICAgICAgcmV0dXJuICgvLyBUaGUgdGVycmFpbiBpcyBpbmZpbml0ZQogICAgICAgIE51bWJlci5NQVhfVkFMVUUKICAgICAgKTsKICAgIH0KCiAgICBjYWxjdWxhdGVXb3JsZEFBQkIocG9zLCBxdWF0LCBtaW4sIG1heCkgewogICAgICAvKiogQFRPRE8gZG8gaXQgcHJvcGVybHkgKi8KICAgICAgbWluLnNldCgtTnVtYmVyLk1BWF9WQUxVRSwgLU51bWJlci5NQVhfVkFMVUUsIC1OdW1iZXIuTUFYX1ZBTFVFKTsKICAgICAgbWF4LnNldChOdW1iZXIuTUFYX1ZBTFVFLCBOdW1iZXIuTUFYX1ZBTFVFLCBOdW1iZXIuTUFYX1ZBTFVFKTsKICAgIH0KCiAgICB1cGRhdGVCb3VuZGluZ1NwaGVyZVJhZGl1cygpIHsKICAgICAgLy8gVXNlIHRoZSBib3VuZGluZyBib3ggb2YgdGhlIG1pbi9tYXggdmFsdWVzCiAgICAgIGNvbnN0IGRhdGEgPSB0aGlzLmRhdGE7CiAgICAgIGNvbnN0IHMgPSB0aGlzLmVsZW1lbnRTaXplOwogICAgICB0aGlzLmJvdW5kaW5nU3BoZXJlUmFkaXVzID0gbmV3IFZlYzMoZGF0YS5sZW5ndGggKiBzLCBkYXRhWzBdLmxlbmd0aCAqIHMsIE1hdGgubWF4KE1hdGguYWJzKHRoaXMubWF4VmFsdWUpLCBNYXRoLmFicyh0aGlzLm1pblZhbHVlKSkpLmxlbmd0aCgpOwogICAgfQogICAgLyoqCiAgICAgKiBTZXRzIHRoZSBoZWlnaHQgdmFsdWVzIGZyb20gYW4gaW1hZ2UuIEN1cnJlbnRseSBvbmx5IHN1cHBvcnRlZCBpbiBicm93c2VyLgogICAgICovCgoKICAgIHNldEhlaWdodHNGcm9tSW1hZ2UoaW1hZ2UsIHNjYWxlKSB7CiAgICAgIGNvbnN0IHsKICAgICAgICB4LAogICAgICAgIHosCiAgICAgICAgeQogICAgICB9ID0gc2NhbGU7CiAgICAgIGNvbnN0IGNhbnZhcyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2NhbnZhcycpOwogICAgICBjYW52YXMud2lkdGggPSBpbWFnZS53aWR0aDsKICAgICAgY2FudmFzLmhlaWdodCA9IGltYWdlLmhlaWdodDsKICAgICAgY29uc3QgY29udGV4dCA9IGNhbnZhcy5nZXRDb250ZXh0KCcyZCcpOwogICAgICBjb250ZXh0LmRyYXdJbWFnZShpbWFnZSwgMCwgMCk7CiAgICAgIGNvbnN0IGltYWdlRGF0YSA9IGNvbnRleHQuZ2V0SW1hZ2VEYXRhKDAsIDAsIGltYWdlLndpZHRoLCBpbWFnZS5oZWlnaHQpOwogICAgICBjb25zdCBtYXRyaXggPSB0aGlzLmRhdGE7CiAgICAgIG1hdHJpeC5sZW5ndGggPSAwOwogICAgICB0aGlzLmVsZW1lbnRTaXplID0gTWF0aC5hYnMoeCkgLyBpbWFnZURhdGEud2lkdGg7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGltYWdlRGF0YS5oZWlnaHQ7IGkrKykgewogICAgICAgIGNvbnN0IHJvdyA9IFtdOwoKICAgICAgICBmb3IgKGxldCBqID0gMDsgaiA8IGltYWdlRGF0YS53aWR0aDsgaisrKSB7CiAgICAgICAgICBjb25zdCBhID0gaW1hZ2VEYXRhLmRhdGFbKGkgKiBpbWFnZURhdGEuaGVpZ2h0ICsgaikgKiA0XTsKICAgICAgICAgIGNvbnN0IGIgPSBpbWFnZURhdGEuZGF0YVsoaSAqIGltYWdlRGF0YS5oZWlnaHQgKyBqKSAqIDQgKyAxXTsKICAgICAgICAgIGNvbnN0IGMgPSBpbWFnZURhdGEuZGF0YVsoaSAqIGltYWdlRGF0YS5oZWlnaHQgKyBqKSAqIDQgKyAyXTsKICAgICAgICAgIGNvbnN0IGhlaWdodCA9IChhICsgYiArIGMpIC8gNCAvIDI1NSAqIHo7CgogICAgICAgICAgaWYgKHggPCAwKSB7CiAgICAgICAgICAgIHJvdy5wdXNoKGhlaWdodCk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICByb3cudW5zaGlmdChoZWlnaHQpOwogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgaWYgKHkgPCAwKSB7CiAgICAgICAgICBtYXRyaXgudW5zaGlmdChyb3cpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBtYXRyaXgucHVzaChyb3cpOwogICAgICAgIH0KICAgICAgfQoKICAgICAgdGhpcy51cGRhdGVNYXhWYWx1ZSgpOwogICAgICB0aGlzLnVwZGF0ZU1pblZhbHVlKCk7CiAgICAgIHRoaXMudXBkYXRlKCk7CiAgICB9CgogIH0KICBjb25zdCBnZXRIZWlnaHRBdF9pZHggPSBbXTsKICBjb25zdCBnZXRIZWlnaHRBdF93ZWlnaHRzID0gbmV3IFZlYzMoKTsKICBjb25zdCBnZXRIZWlnaHRBdF9hID0gbmV3IFZlYzMoKTsKICBjb25zdCBnZXRIZWlnaHRBdF9iID0gbmV3IFZlYzMoKTsKICBjb25zdCBnZXRIZWlnaHRBdF9jID0gbmV3IFZlYzMoKTsKICBjb25zdCBnZXROb3JtYWxBdF9hID0gbmV3IFZlYzMoKTsKICBjb25zdCBnZXROb3JtYWxBdF9iID0gbmV3IFZlYzMoKTsKICBjb25zdCBnZXROb3JtYWxBdF9jID0gbmV3IFZlYzMoKTsKICBjb25zdCBnZXROb3JtYWxBdF9lMCA9IG5ldyBWZWMzKCk7CiAgY29uc3QgZ2V0Tm9ybWFsQXRfZTEgPSBuZXcgVmVjMygpOyAvLyBmcm9tIGh0dHBzOi8vZW4ud2lraXBlZGlhLm9yZy93aWtpL0JhcnljZW50cmljX2Nvb3JkaW5hdGVfc3lzdGVtCgogIGZ1bmN0aW9uIGJhcnljZW50cmljV2VpZ2h0cyh4LCB5LCBheCwgYXksIGJ4LCBieSwgY3gsIGN5LCByZXN1bHQpIHsKICAgIHJlc3VsdC54ID0gKChieSAtIGN5KSAqICh4IC0gY3gpICsgKGN4IC0gYngpICogKHkgLSBjeSkpIC8gKChieSAtIGN5KSAqIChheCAtIGN4KSArIChjeCAtIGJ4KSAqIChheSAtIGN5KSk7CiAgICByZXN1bHQueSA9ICgoY3kgLSBheSkgKiAoeCAtIGN4KSArIChheCAtIGN4KSAqICh5IC0gY3kpKSAvICgoYnkgLSBjeSkgKiAoYXggLSBjeCkgKyAoY3ggLSBieCkgKiAoYXkgLSBjeSkpOwogICAgcmVzdWx0LnogPSAxIC0gcmVzdWx0LnggLSByZXN1bHQueTsKICB9CgogIC8qKgogICAqIE9jdHJlZU5vZGUKICAgKi8KICBjbGFzcyBPY3RyZWVOb2RlIHsKICAgIC8qKiBUaGUgcm9vdCBub2RlICovCgogICAgLyoqIEJvdW5kYXJ5IG9mIHRoaXMgbm9kZSAqLwoKICAgIC8qKiBDb250YWluZWQgZGF0YSBhdCB0aGUgY3VycmVudCBub2RlIGxldmVsICovCgogICAgLyoqIENoaWxkcmVuIHRvIHRoaXMgbm9kZSAqLwogICAgY29uc3RydWN0b3Iob3B0aW9ucykgewogICAgICBpZiAob3B0aW9ucyA9PT0gdm9pZCAwKSB7CiAgICAgICAgb3B0aW9ucyA9IHt9OwogICAgICB9CgogICAgICB0aGlzLnJvb3QgPSBvcHRpb25zLnJvb3QgfHwgbnVsbDsKICAgICAgdGhpcy5hYWJiID0gb3B0aW9ucy5hYWJiID8gb3B0aW9ucy5hYWJiLmNsb25lKCkgOiBuZXcgQUFCQigpOwogICAgICB0aGlzLmRhdGEgPSBbXTsKICAgICAgdGhpcy5jaGlsZHJlbiA9IFtdOwogICAgfQogICAgLyoqCiAgICAgKiByZXNldAogICAgICovCgoKICAgIHJlc2V0KCkgewogICAgICB0aGlzLmNoaWxkcmVuLmxlbmd0aCA9IHRoaXMuZGF0YS5sZW5ndGggPSAwOwogICAgfQogICAgLyoqCiAgICAgKiBJbnNlcnQgZGF0YSBpbnRvIHRoaXMgbm9kZQogICAgICogQHJldHVybiBUcnVlIGlmIHN1Y2Nlc3NmdWwsIG90aGVyd2lzZSBmYWxzZQogICAgICovCgoKICAgIGluc2VydChhYWJiLCBlbGVtZW50RGF0YSwgbGV2ZWwpIHsKICAgICAgaWYgKGxldmVsID09PSB2b2lkIDApIHsKICAgICAgICBsZXZlbCA9IDA7CiAgICAgIH0KCiAgICAgIGNvbnN0IG5vZGVEYXRhID0gdGhpcy5kYXRhOyAvLyBJZ25vcmUgb2JqZWN0cyB0aGF0IGRvIG5vdCBiZWxvbmcgaW4gdGhpcyBub2RlCgogICAgICBpZiAoIXRoaXMuYWFiYi5jb250YWlucyhhYWJiKSkgewogICAgICAgIHJldHVybiBmYWxzZTsgLy8gb2JqZWN0IGNhbm5vdCBiZSBhZGRlZAogICAgICB9CgogICAgICBjb25zdCBjaGlsZHJlbiA9IHRoaXMuY2hpbGRyZW47CiAgICAgIGNvbnN0IG1heERlcHRoID0gdGhpcy5tYXhEZXB0aCB8fCB0aGlzLnJvb3QubWF4RGVwdGg7CgogICAgICBpZiAobGV2ZWwgPCBtYXhEZXB0aCkgewogICAgICAgIC8vIFN1YmRpdmlkZSBpZiB0aGVyZSBhcmUgbm8gY2hpbGRyZW4geWV0CiAgICAgICAgbGV0IHN1YmRpdmlkZWQgPSBmYWxzZTsKCiAgICAgICAgaWYgKCFjaGlsZHJlbi5sZW5ndGgpIHsKICAgICAgICAgIHRoaXMuc3ViZGl2aWRlKCk7CiAgICAgICAgICBzdWJkaXZpZGVkID0gdHJ1ZTsKICAgICAgICB9IC8vIGFkZCB0byB3aGljaGV2ZXIgbm9kZSB3aWxsIGFjY2VwdCBpdAoKCiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IDg7IGkrKykgewogICAgICAgICAgaWYgKGNoaWxkcmVuW2ldLmluc2VydChhYWJiLCBlbGVtZW50RGF0YSwgbGV2ZWwgKyAxKSkgewogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGlmIChzdWJkaXZpZGVkKSB7CiAgICAgICAgICAvLyBObyBjaGlsZHJlbiBhY2NlcHRlZCEgTWlnaHQgYXMgd2VsbCBqdXN0IHJlbW92ZSBlbSBzaW5jZSB0aGV5IGNvbnRhaW4gbm9uZQogICAgICAgICAgY2hpbGRyZW4ubGVuZ3RoID0gMDsKICAgICAgICB9CiAgICAgIH0gLy8gVG9vIGRlZXAsIG9yIGNoaWxkcmVuIGRpZG50IHdhbnQgaXQuIGFkZCBpdCBpbiBjdXJyZW50IG5vZGUKCgogICAgICBub2RlRGF0YS5wdXNoKGVsZW1lbnREYXRhKTsKICAgICAgcmV0dXJuIHRydWU7CiAgICB9CiAgICAvKioKICAgICAqIENyZWF0ZSA4IGVxdWFsbHkgc2l6ZWQgY2hpbGRyZW4gbm9kZXMgYW5kIHB1dCB0aGVtIGluIHRoZSBgY2hpbGRyZW5gIGFycmF5LgogICAgICovCgoKICAgIHN1YmRpdmlkZSgpIHsKICAgICAgY29uc3QgYWFiYiA9IHRoaXMuYWFiYjsKICAgICAgY29uc3QgbCA9IGFhYmIubG93ZXJCb3VuZDsKICAgICAgY29uc3QgdSA9IGFhYmIudXBwZXJCb3VuZDsKICAgICAgY29uc3QgY2hpbGRyZW4gPSB0aGlzLmNoaWxkcmVuOwogICAgICBjaGlsZHJlbi5wdXNoKG5ldyBPY3RyZWVOb2RlKHsKICAgICAgICBhYWJiOiBuZXcgQUFCQih7CiAgICAgICAgICBsb3dlckJvdW5kOiBuZXcgVmVjMygwLCAwLCAwKQogICAgICAgIH0pCiAgICAgIH0pLCBuZXcgT2N0cmVlTm9kZSh7CiAgICAgICAgYWFiYjogbmV3IEFBQkIoewogICAgICAgICAgbG93ZXJCb3VuZDogbmV3IFZlYzMoMSwgMCwgMCkKICAgICAgICB9KQogICAgICB9KSwgbmV3IE9jdHJlZU5vZGUoewogICAgICAgIGFhYmI6IG5ldyBBQUJCKHsKICAgICAgICAgIGxvd2VyQm91bmQ6IG5ldyBWZWMzKDEsIDEsIDApCiAgICAgICAgfSkKICAgICAgfSksIG5ldyBPY3RyZWVOb2RlKHsKICAgICAgICBhYWJiOiBuZXcgQUFCQih7CiAgICAgICAgICBsb3dlckJvdW5kOiBuZXcgVmVjMygxLCAxLCAxKQogICAgICAgIH0pCiAgICAgIH0pLCBuZXcgT2N0cmVlTm9kZSh7CiAgICAgICAgYWFiYjogbmV3IEFBQkIoewogICAgICAgICAgbG93ZXJCb3VuZDogbmV3IFZlYzMoMCwgMSwgMSkKICAgICAgICB9KQogICAgICB9KSwgbmV3IE9jdHJlZU5vZGUoewogICAgICAgIGFhYmI6IG5ldyBBQUJCKHsKICAgICAgICAgIGxvd2VyQm91bmQ6IG5ldyBWZWMzKDAsIDAsIDEpCiAgICAgICAgfSkKICAgICAgfSksIG5ldyBPY3RyZWVOb2RlKHsKICAgICAgICBhYWJiOiBuZXcgQUFCQih7CiAgICAgICAgICBsb3dlckJvdW5kOiBuZXcgVmVjMygxLCAwLCAxKQogICAgICAgIH0pCiAgICAgIH0pLCBuZXcgT2N0cmVlTm9kZSh7CiAgICAgICAgYWFiYjogbmV3IEFBQkIoewogICAgICAgICAgbG93ZXJCb3VuZDogbmV3IFZlYzMoMCwgMSwgMCkKICAgICAgICB9KQogICAgICB9KSk7CiAgICAgIHUudnN1YihsLCBoYWxmRGlhZ29uYWwpOwogICAgICBoYWxmRGlhZ29uYWwuc2NhbGUoMC41LCBoYWxmRGlhZ29uYWwpOwogICAgICBjb25zdCByb290ID0gdGhpcy5yb290IHx8IHRoaXM7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gODsgaSsrKSB7CiAgICAgICAgY29uc3QgY2hpbGQgPSBjaGlsZHJlbltpXTsgLy8gU2V0IGN1cnJlbnQgbm9kZSBhcyByb290CgogICAgICAgIGNoaWxkLnJvb3QgPSByb290OyAvLyBDb21wdXRlIGJvdW5kcwoKICAgICAgICBjb25zdCBsb3dlckJvdW5kID0gY2hpbGQuYWFiYi5sb3dlckJvdW5kOwogICAgICAgIGxvd2VyQm91bmQueCAqPSBoYWxmRGlhZ29uYWwueDsKICAgICAgICBsb3dlckJvdW5kLnkgKj0gaGFsZkRpYWdvbmFsLnk7CiAgICAgICAgbG93ZXJCb3VuZC56ICo9IGhhbGZEaWFnb25hbC56OwogICAgICAgIGxvd2VyQm91bmQudmFkZChsLCBsb3dlckJvdW5kKTsgLy8gVXBwZXIgYm91bmQgaXMgYWx3YXlzIGxvd2VyIGJvdW5kICsgaGFsZkRpYWdvbmFsCgogICAgICAgIGxvd2VyQm91bmQudmFkZChoYWxmRGlhZ29uYWwsIGNoaWxkLmFhYmIudXBwZXJCb3VuZCk7CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogR2V0IGFsbCBkYXRhLCBwb3RlbnRpYWxseSB3aXRoaW4gYW4gQUFCQgogICAgICogQHJldHVybiBUaGUgInJlc3VsdCIgb2JqZWN0CiAgICAgKi8KCgogICAgYWFiYlF1ZXJ5KGFhYmIsIHJlc3VsdCkgewogICAgICB0aGlzLmRhdGE7IC8vIGFib3J0IGlmIHRoZSByYW5nZSBkb2VzIG5vdCBpbnRlcnNlY3QgdGhpcyBub2RlCiAgICAgIC8vIGlmICghdGhpcy5hYWJiLm92ZXJsYXBzKGFhYmIpKXsKICAgICAgLy8gICAgIHJldHVybiByZXN1bHQ7CiAgICAgIC8vIH0KICAgICAgLy8gQWRkIG9iamVjdHMgYXQgdGhpcyBsZXZlbAogICAgICAvLyBBcnJheS5wcm90b3R5cGUucHVzaC5hcHBseShyZXN1bHQsIG5vZGVEYXRhKTsKICAgICAgLy8gQWRkIGNoaWxkIGRhdGEKICAgICAgLy8gQHRvZG8gdW53cmFwIHJlY3Vyc2lvbiBpbnRvIGEgcXVldWUgLyBsb29wLCB0aGF0J3MgZmFzdGVyIGluIEpTCgogICAgICB0aGlzLmNoaWxkcmVuOyAvLyBmb3IgKGxldCBpID0gMCwgTiA9IHRoaXMuY2hpbGRyZW4ubGVuZ3RoOyBpICE9PSBOOyBpKyspIHsKICAgICAgLy8gICAgIGNoaWxkcmVuW2ldLmFhYmJRdWVyeShhYWJiLCByZXN1bHQpOwogICAgICAvLyB9CgogICAgICBjb25zdCBxdWV1ZSA9IFt0aGlzXTsKCiAgICAgIHdoaWxlIChxdWV1ZS5sZW5ndGgpIHsKICAgICAgICBjb25zdCBub2RlID0gcXVldWUucG9wKCk7CgogICAgICAgIGlmIChub2RlLmFhYmIub3ZlcmxhcHMoYWFiYikpIHsKICAgICAgICAgIEFycmF5LnByb3RvdHlwZS5wdXNoLmFwcGx5KHJlc3VsdCwgbm9kZS5kYXRhKTsKICAgICAgICB9CgogICAgICAgIEFycmF5LnByb3RvdHlwZS5wdXNoLmFwcGx5KHF1ZXVlLCBub2RlLmNoaWxkcmVuKTsKICAgICAgfQoKICAgICAgcmV0dXJuIHJlc3VsdDsKICAgIH0KICAgIC8qKgogICAgICogR2V0IGFsbCBkYXRhLCBwb3RlbnRpYWxseSBpbnRlcnNlY3RlZCBieSBhIHJheS4KICAgICAqIEByZXR1cm4gVGhlICJyZXN1bHQiIG9iamVjdAogICAgICovCgoKICAgIHJheVF1ZXJ5KHJheSwgdHJlZVRyYW5zZm9ybSwgcmVzdWx0KSB7CiAgICAgIC8vIFVzZSBhYWJiIHF1ZXJ5IGZvciBub3cuCgogICAgICAvKiogQHRvZG8gaW1wbGVtZW50IHJlYWwgcmF5IHF1ZXJ5IHdoaWNoIG5lZWRzIGxlc3MgbG9va3VwcyAqLwogICAgICByYXkuZ2V0QUFCQih0bXBBQUJCKTsKICAgICAgdG1wQUFCQi50b0xvY2FsRnJhbWUodHJlZVRyYW5zZm9ybSwgdG1wQUFCQik7CiAgICAgIHRoaXMuYWFiYlF1ZXJ5KHRtcEFBQkIsIHJlc3VsdCk7CiAgICAgIHJldHVybiByZXN1bHQ7CiAgICB9CiAgICAvKioKICAgICAqIHJlbW92ZUVtcHR5Tm9kZXMKICAgICAqLwoKCiAgICByZW1vdmVFbXB0eU5vZGVzKCkgewogICAgICBmb3IgKGxldCBpID0gdGhpcy5jaGlsZHJlbi5sZW5ndGggLSAxOyBpID49IDA7IGktLSkgewogICAgICAgIHRoaXMuY2hpbGRyZW5baV0ucmVtb3ZlRW1wdHlOb2RlcygpOwoKICAgICAgICBpZiAoIXRoaXMuY2hpbGRyZW5baV0uY2hpbGRyZW4ubGVuZ3RoICYmICF0aGlzLmNoaWxkcmVuW2ldLmRhdGEubGVuZ3RoKSB7CiAgICAgICAgICB0aGlzLmNoaWxkcmVuLnNwbGljZShpLCAxKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KCiAgfQogIC8qKgogICAqIE9jdHJlZQogICAqLwoKCiAgY2xhc3MgT2N0cmVlIGV4dGVuZHMgT2N0cmVlTm9kZSB7CiAgICAvKioKICAgICAqIE1heGltdW0gc3ViZGl2aXNpb24gZGVwdGgKICAgICAqIEBkZWZhdWx0IDgKICAgICAqLwoKICAgIC8qKgogICAgICogQHBhcmFtIGFhYmIgVGhlIHRvdGFsIEFBQkIgb2YgdGhlIHRyZWUKICAgICAqLwogICAgY29uc3RydWN0b3IoYWFiYiwgb3B0aW9ucykgewogICAgICBpZiAob3B0aW9ucyA9PT0gdm9pZCAwKSB7CiAgICAgICAgb3B0aW9ucyA9IHt9OwogICAgICB9CgogICAgICBzdXBlcih7CiAgICAgICAgcm9vdDogbnVsbCwKICAgICAgICBhYWJiCiAgICAgIH0pOwogICAgICB0aGlzLm1heERlcHRoID0gdHlwZW9mIG9wdGlvbnMubWF4RGVwdGggIT09ICd1bmRlZmluZWQnID8gb3B0aW9ucy5tYXhEZXB0aCA6IDg7CiAgICB9CgogIH0KICBjb25zdCBoYWxmRGlhZ29uYWwgPSBuZXcgVmVjMygpOwogIGNvbnN0IHRtcEFBQkIgPSBuZXcgQUFCQigpOwoKICAvKioKICAgKiBUcmltZXNoLgogICAqIEBleGFtcGxlCiAgICogICAgIC8vIEhvdyB0byBtYWtlIGEgbWVzaCB3aXRoIGEgc2luZ2xlIHRyaWFuZ2xlCiAgICogICAgIGNvbnN0IHZlcnRpY2VzID0gWwogICAqICAgICAgICAgMCwgMCwgMCwgLy8gdmVydGV4IDAKICAgKiAgICAgICAgIDEsIDAsIDAsIC8vIHZlcnRleCAxCiAgICogICAgICAgICAwLCAxLCAwICAvLyB2ZXJ0ZXggMgogICAqICAgICBdCiAgICogICAgIGNvbnN0IGluZGljZXMgPSBbCiAgICogICAgICAgICAwLCAxLCAyICAvLyB0cmlhbmdsZSAwCiAgICogICAgIF0KICAgKiAgICAgY29uc3QgdHJpbWVzaFNoYXBlID0gbmV3IENBTk5PTi5UcmltZXNoKHZlcnRpY2VzLCBpbmRpY2VzKQogICAqLwogIGNsYXNzIFRyaW1lc2ggZXh0ZW5kcyBTaGFwZSB7CiAgICAvKioKICAgICAqIHZlcnRpY2VzCiAgICAgKi8KCiAgICAvKioKICAgICAqIEFycmF5IG9mIGludGVnZXJzLCBpbmRpY2F0aW5nIHdoaWNoIHZlcnRpY2VzIGVhY2ggdHJpYW5nbGUgY29uc2lzdHMgb2YuIFRoZSBsZW5ndGggb2YgdGhpcyBhcnJheSBpcyB0aHVzIDMgdGltZXMgdGhlIG51bWJlciBvZiB0cmlhbmdsZXMuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFRoZSBub3JtYWxzIGRhdGEuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFRoZSBsb2NhbCBBQUJCIG9mIHRoZSBtZXNoLgogICAgICovCgogICAgLyoqCiAgICAgKiBSZWZlcmVuY2VzIHRvIHZlcnRleCBwYWlycywgbWFraW5nIHVwIGFsbCB1bmlxdWUgZWRnZXMgaW4gdGhlIHRyaW1lc2guCiAgICAgKi8KCiAgICAvKioKICAgICAqIExvY2FsIHNjYWxpbmcgb2YgdGhlIG1lc2guIFVzZSAuc2V0U2NhbGUoKSB0byBzZXQgaXQuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFRoZSBpbmRleGVkIHRyaWFuZ2xlcy4gVXNlIC51cGRhdGVUcmVlKCkgdG8gdXBkYXRlIGl0LgogICAgICovCiAgICBjb25zdHJ1Y3Rvcih2ZXJ0aWNlcywgaW5kaWNlcykgewogICAgICBzdXBlcih7CiAgICAgICAgdHlwZTogU2hhcGUudHlwZXMuVFJJTUVTSAogICAgICB9KTsKICAgICAgdGhpcy52ZXJ0aWNlcyA9IG5ldyBGbG9hdDMyQXJyYXkodmVydGljZXMpOwogICAgICB0aGlzLmluZGljZXMgPSBuZXcgSW50MTZBcnJheShpbmRpY2VzKTsKICAgICAgdGhpcy5ub3JtYWxzID0gbmV3IEZsb2F0MzJBcnJheShpbmRpY2VzLmxlbmd0aCk7CiAgICAgIHRoaXMuYWFiYiA9IG5ldyBBQUJCKCk7CiAgICAgIHRoaXMuZWRnZXMgPSBudWxsOwogICAgICB0aGlzLnNjYWxlID0gbmV3IFZlYzMoMSwgMSwgMSk7CiAgICAgIHRoaXMudHJlZSA9IG5ldyBPY3RyZWUoKTsKICAgICAgdGhpcy51cGRhdGVFZGdlcygpOwogICAgICB0aGlzLnVwZGF0ZU5vcm1hbHMoKTsKICAgICAgdGhpcy51cGRhdGVBQUJCKCk7CiAgICAgIHRoaXMudXBkYXRlQm91bmRpbmdTcGhlcmVSYWRpdXMoKTsKICAgICAgdGhpcy51cGRhdGVUcmVlKCk7CiAgICB9CiAgICAvKioKICAgICAqIHVwZGF0ZVRyZWUKICAgICAqLwoKCiAgICB1cGRhdGVUcmVlKCkgewogICAgICBjb25zdCB0cmVlID0gdGhpcy50cmVlOwogICAgICB0cmVlLnJlc2V0KCk7CiAgICAgIHRyZWUuYWFiYi5jb3B5KHRoaXMuYWFiYik7CiAgICAgIGNvbnN0IHNjYWxlID0gdGhpcy5zY2FsZTsgLy8gVGhlIGxvY2FsIG1lc2ggQUFCQiBpcyBzY2FsZWQsIGJ1dCB0aGUgb2N0cmVlIEFBQkIgc2hvdWxkIGJlIHVuc2NhbGVkCgogICAgICB0cmVlLmFhYmIubG93ZXJCb3VuZC54ICo9IDEgLyBzY2FsZS54OwogICAgICB0cmVlLmFhYmIubG93ZXJCb3VuZC55ICo9IDEgLyBzY2FsZS55OwogICAgICB0cmVlLmFhYmIubG93ZXJCb3VuZC56ICo9IDEgLyBzY2FsZS56OwogICAgICB0cmVlLmFhYmIudXBwZXJCb3VuZC54ICo9IDEgLyBzY2FsZS54OwogICAgICB0cmVlLmFhYmIudXBwZXJCb3VuZC55ICo9IDEgLyBzY2FsZS55OwogICAgICB0cmVlLmFhYmIudXBwZXJCb3VuZC56ICo9IDEgLyBzY2FsZS56OyAvLyBJbnNlcnQgYWxsIHRyaWFuZ2xlcwoKICAgICAgY29uc3QgdHJpYW5nbGVBQUJCID0gbmV3IEFBQkIoKTsKICAgICAgY29uc3QgYSA9IG5ldyBWZWMzKCk7CiAgICAgIGNvbnN0IGIgPSBuZXcgVmVjMygpOwogICAgICBjb25zdCBjID0gbmV3IFZlYzMoKTsKICAgICAgY29uc3QgcG9pbnRzID0gW2EsIGIsIGNdOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLmluZGljZXMubGVuZ3RoIC8gMzsgaSsrKSB7CiAgICAgICAgLy90aGlzLmdldFRyaWFuZ2xlVmVydGljZXMoaSwgYSwgYiwgYyk7CiAgICAgICAgLy8gR2V0IHVuc2NhbGVkIHRyaWFuZ2xlIHZlcnRzCiAgICAgICAgY29uc3QgaTMgPSBpICogMzsKCiAgICAgICAgdGhpcy5fZ2V0VW5zY2FsZWRWZXJ0ZXgodGhpcy5pbmRpY2VzW2kzXSwgYSk7CgogICAgICAgIHRoaXMuX2dldFVuc2NhbGVkVmVydGV4KHRoaXMuaW5kaWNlc1tpMyArIDFdLCBiKTsKCiAgICAgICAgdGhpcy5fZ2V0VW5zY2FsZWRWZXJ0ZXgodGhpcy5pbmRpY2VzW2kzICsgMl0sIGMpOwoKICAgICAgICB0cmlhbmdsZUFBQkIuc2V0RnJvbVBvaW50cyhwb2ludHMpOwogICAgICAgIHRyZWUuaW5zZXJ0KHRyaWFuZ2xlQUFCQiwgaSk7CiAgICAgIH0KCiAgICAgIHRyZWUucmVtb3ZlRW1wdHlOb2RlcygpOwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgdHJpYW5nbGVzIGluIGEgbG9jYWwgQUFCQiBmcm9tIHRoZSB0cmltZXNoLgogICAgICogQHBhcmFtIHJlc3VsdCBBbiBhcnJheSBvZiBpbnRlZ2VycywgcmVmZXJlbmNpbmcgdGhlIHF1ZXJpZWQgdHJpYW5nbGVzLgogICAgICovCgoKICAgIGdldFRyaWFuZ2xlc0luQUFCQihhYWJiLCByZXN1bHQpIHsKICAgICAgdW5zY2FsZWRBQUJCLmNvcHkoYWFiYik7IC8vIFNjYWxlIGl0IHRvIGxvY2FsCgogICAgICBjb25zdCBzY2FsZSA9IHRoaXMuc2NhbGU7CiAgICAgIGNvbnN0IGlzeCA9IHNjYWxlLng7CiAgICAgIGNvbnN0IGlzeSA9IHNjYWxlLnk7CiAgICAgIGNvbnN0IGlzeiA9IHNjYWxlLno7CiAgICAgIGNvbnN0IGwgPSB1bnNjYWxlZEFBQkIubG93ZXJCb3VuZDsKICAgICAgY29uc3QgdSA9IHVuc2NhbGVkQUFCQi51cHBlckJvdW5kOwogICAgICBsLnggLz0gaXN4OwogICAgICBsLnkgLz0gaXN5OwogICAgICBsLnogLz0gaXN6OwogICAgICB1LnggLz0gaXN4OwogICAgICB1LnkgLz0gaXN5OwogICAgICB1LnogLz0gaXN6OwogICAgICByZXR1cm4gdGhpcy50cmVlLmFhYmJRdWVyeSh1bnNjYWxlZEFBQkIsIHJlc3VsdCk7CiAgICB9CiAgICAvKioKICAgICAqIHNldFNjYWxlCiAgICAgKi8KCgogICAgc2V0U2NhbGUoc2NhbGUpIHsKICAgICAgY29uc3Qgd2FzVW5pZm9ybSA9IHRoaXMuc2NhbGUueCA9PT0gdGhpcy5zY2FsZS55ICYmIHRoaXMuc2NhbGUueSA9PT0gdGhpcy5zY2FsZS56OwogICAgICBjb25zdCBpc1VuaWZvcm0gPSBzY2FsZS54ID09PSBzY2FsZS55ICYmIHNjYWxlLnkgPT09IHNjYWxlLno7CgogICAgICBpZiAoISh3YXNVbmlmb3JtICYmIGlzVW5pZm9ybSkpIHsKICAgICAgICAvLyBOb24tdW5pZm9ybSBzY2FsaW5nLiBOZWVkIHRvIHVwZGF0ZSBub3JtYWxzLgogICAgICAgIHRoaXMudXBkYXRlTm9ybWFscygpOwogICAgICB9CgogICAgICB0aGlzLnNjYWxlLmNvcHkoc2NhbGUpOwogICAgICB0aGlzLnVwZGF0ZUFBQkIoKTsKICAgICAgdGhpcy51cGRhdGVCb3VuZGluZ1NwaGVyZVJhZGl1cygpOwogICAgfQogICAgLyoqCiAgICAgKiBDb21wdXRlIHRoZSBub3JtYWxzIG9mIHRoZSBmYWNlcy4gV2lsbCBzYXZlIGluIHRoZSBgLm5vcm1hbHNgIGFycmF5LgogICAgICovCgoKICAgIHVwZGF0ZU5vcm1hbHMoKSB7CiAgICAgIGNvbnN0IG4gPSBjb21wdXRlTm9ybWFsc19uOyAvLyBHZW5lcmF0ZSBub3JtYWxzCgogICAgICBjb25zdCBub3JtYWxzID0gdGhpcy5ub3JtYWxzOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLmluZGljZXMubGVuZ3RoIC8gMzsgaSsrKSB7CiAgICAgICAgY29uc3QgaTMgPSBpICogMzsKICAgICAgICBjb25zdCBhID0gdGhpcy5pbmRpY2VzW2kzXTsKICAgICAgICBjb25zdCBiID0gdGhpcy5pbmRpY2VzW2kzICsgMV07CiAgICAgICAgY29uc3QgYyA9IHRoaXMuaW5kaWNlc1tpMyArIDJdOwogICAgICAgIHRoaXMuZ2V0VmVydGV4KGEsIHZhKTsKICAgICAgICB0aGlzLmdldFZlcnRleChiLCB2Yik7CiAgICAgICAgdGhpcy5nZXRWZXJ0ZXgoYywgdmMpOwogICAgICAgIFRyaW1lc2guY29tcHV0ZU5vcm1hbCh2YiwgdmEsIHZjLCBuKTsKICAgICAgICBub3JtYWxzW2kzXSA9IG4ueDsKICAgICAgICBub3JtYWxzW2kzICsgMV0gPSBuLnk7CiAgICAgICAgbm9ybWFsc1tpMyArIDJdID0gbi56OwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIFVwZGF0ZSB0aGUgYC5lZGdlc2AgcHJvcGVydHkKICAgICAqLwoKCiAgICB1cGRhdGVFZGdlcygpIHsKICAgICAgY29uc3QgZWRnZXMgPSB7fTsKCiAgICAgIGNvbnN0IGFkZCA9IChhLCBiKSA9PiB7CiAgICAgICAgY29uc3Qga2V5ID0gYSA8IGIgPyBgJHthfV8ke2J9YCA6IGAke2J9XyR7YX1gOwogICAgICAgIGVkZ2VzW2tleV0gPSB0cnVlOwogICAgICB9OwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLmluZGljZXMubGVuZ3RoIC8gMzsgaSsrKSB7CiAgICAgICAgY29uc3QgaTMgPSBpICogMzsKICAgICAgICBjb25zdCBhID0gdGhpcy5pbmRpY2VzW2kzXTsKICAgICAgICBjb25zdCBiID0gdGhpcy5pbmRpY2VzW2kzICsgMV07CiAgICAgICAgY29uc3QgYyA9IHRoaXMuaW5kaWNlc1tpMyArIDJdOwogICAgICAgIGFkZChhLCBiKTsKICAgICAgICBhZGQoYiwgYyk7CiAgICAgICAgYWRkKGMsIGEpOwogICAgICB9CgogICAgICBjb25zdCBrZXlzID0gT2JqZWN0LmtleXMoZWRnZXMpOwogICAgICB0aGlzLmVkZ2VzID0gbmV3IEludDE2QXJyYXkoa2V5cy5sZW5ndGggKiAyKTsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwga2V5cy5sZW5ndGg7IGkrKykgewogICAgICAgIGNvbnN0IGluZGljZXMgPSBrZXlzW2ldLnNwbGl0KCdfJyk7CiAgICAgICAgdGhpcy5lZGdlc1syICogaV0gPSBwYXJzZUludChpbmRpY2VzWzBdLCAxMCk7CiAgICAgICAgdGhpcy5lZGdlc1syICogaSArIDFdID0gcGFyc2VJbnQoaW5kaWNlc1sxXSwgMTApOwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIEdldCBhbiBlZGdlIHZlcnRleAogICAgICogQHBhcmFtIGZpcnN0T3JTZWNvbmQgMCBvciAxLCBkZXBlbmRpbmcgb24gd2hpY2ggb25lIG9mIHRoZSB2ZXJ0aWNlcyB5b3UgbmVlZC4KICAgICAqIEBwYXJhbSB2ZXJ0ZXhTdG9yZSBXaGVyZSB0byBzdG9yZSB0aGUgcmVzdWx0CiAgICAgKi8KCgogICAgZ2V0RWRnZVZlcnRleChlZGdlSW5kZXgsIGZpcnN0T3JTZWNvbmQsIHZlcnRleFN0b3JlKSB7CiAgICAgIGNvbnN0IHZlcnRleEluZGV4ID0gdGhpcy5lZGdlc1tlZGdlSW5kZXggKiAyICsgKGZpcnN0T3JTZWNvbmQgPyAxIDogMCldOwogICAgICB0aGlzLmdldFZlcnRleCh2ZXJ0ZXhJbmRleCwgdmVydGV4U3RvcmUpOwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgYSB2ZWN0b3IgYWxvbmcgYW4gZWRnZS4KICAgICAqLwoKCiAgICBnZXRFZGdlVmVjdG9yKGVkZ2VJbmRleCwgdmVjdG9yU3RvcmUpIHsKICAgICAgY29uc3QgdmEgPSBnZXRFZGdlVmVjdG9yX3ZhOwogICAgICBjb25zdCB2YiA9IGdldEVkZ2VWZWN0b3JfdmI7CiAgICAgIHRoaXMuZ2V0RWRnZVZlcnRleChlZGdlSW5kZXgsIDAsIHZhKTsKICAgICAgdGhpcy5nZXRFZGdlVmVydGV4KGVkZ2VJbmRleCwgMSwgdmIpOwogICAgICB2Yi52c3ViKHZhLCB2ZWN0b3JTdG9yZSk7CiAgICB9CiAgICAvKioKICAgICAqIEdldCBmYWNlIG5vcm1hbCBnaXZlbiAzIHZlcnRpY2VzCiAgICAgKi8KCgogICAgc3RhdGljIGNvbXB1dGVOb3JtYWwodmEsIHZiLCB2YywgdGFyZ2V0KSB7CiAgICAgIHZiLnZzdWIodmEsIGFiKTsKICAgICAgdmMudnN1Yih2YiwgY2IpOwogICAgICBjYi5jcm9zcyhhYiwgdGFyZ2V0KTsKCiAgICAgIGlmICghdGFyZ2V0LmlzWmVybygpKSB7CiAgICAgICAgdGFyZ2V0Lm5vcm1hbGl6ZSgpOwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIEdldCB2ZXJ0ZXggaS4KICAgICAqIEByZXR1cm4gVGhlICJvdXQiIHZlY3RvciBvYmplY3QKICAgICAqLwoKCiAgICBnZXRWZXJ0ZXgoaSwgb3V0KSB7CiAgICAgIGNvbnN0IHNjYWxlID0gdGhpcy5zY2FsZTsKCiAgICAgIHRoaXMuX2dldFVuc2NhbGVkVmVydGV4KGksIG91dCk7CgogICAgICBvdXQueCAqPSBzY2FsZS54OwogICAgICBvdXQueSAqPSBzY2FsZS55OwogICAgICBvdXQueiAqPSBzY2FsZS56OwogICAgICByZXR1cm4gb3V0OwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgcmF3IHZlcnRleCBpCiAgICAgKiBAcmV0dXJuIFRoZSAib3V0IiB2ZWN0b3Igb2JqZWN0CiAgICAgKi8KCgogICAgX2dldFVuc2NhbGVkVmVydGV4KGksIG91dCkgewogICAgICBjb25zdCBpMyA9IGkgKiAzOwogICAgICBjb25zdCB2ZXJ0aWNlcyA9IHRoaXMudmVydGljZXM7CiAgICAgIHJldHVybiBvdXQuc2V0KHZlcnRpY2VzW2kzXSwgdmVydGljZXNbaTMgKyAxXSwgdmVydGljZXNbaTMgKyAyXSk7CiAgICB9CiAgICAvKioKICAgICAqIEdldCBhIHZlcnRleCBmcm9tIHRoZSB0cmltZXNoLHRyYW5zZm9ybWVkIGJ5IHRoZSBnaXZlbiBwb3NpdGlvbiBhbmQgcXVhdGVybmlvbi4KICAgICAqIEByZXR1cm4gVGhlICJvdXQiIHZlY3RvciBvYmplY3QKICAgICAqLwoKCiAgICBnZXRXb3JsZFZlcnRleChpLCBwb3MsIHF1YXQsIG91dCkgewogICAgICB0aGlzLmdldFZlcnRleChpLCBvdXQpOwogICAgICBUcmFuc2Zvcm0ucG9pbnRUb1dvcmxkRnJhbWUocG9zLCBxdWF0LCBvdXQsIG91dCk7CiAgICAgIHJldHVybiBvdXQ7CiAgICB9CiAgICAvKioKICAgICAqIEdldCB0aGUgdGhyZWUgdmVydGljZXMgZm9yIHRyaWFuZ2xlIGkuCiAgICAgKi8KCgogICAgZ2V0VHJpYW5nbGVWZXJ0aWNlcyhpLCBhLCBiLCBjKSB7CiAgICAgIGNvbnN0IGkzID0gaSAqIDM7CiAgICAgIHRoaXMuZ2V0VmVydGV4KHRoaXMuaW5kaWNlc1tpM10sIGEpOwogICAgICB0aGlzLmdldFZlcnRleCh0aGlzLmluZGljZXNbaTMgKyAxXSwgYik7CiAgICAgIHRoaXMuZ2V0VmVydGV4KHRoaXMuaW5kaWNlc1tpMyArIDJdLCBjKTsKICAgIH0KICAgIC8qKgogICAgICogQ29tcHV0ZSB0aGUgbm9ybWFsIG9mIHRyaWFuZ2xlIGkuCiAgICAgKiBAcmV0dXJuIFRoZSAidGFyZ2V0IiB2ZWN0b3Igb2JqZWN0CiAgICAgKi8KCgogICAgZ2V0Tm9ybWFsKGksIHRhcmdldCkgewogICAgICBjb25zdCBpMyA9IGkgKiAzOwogICAgICByZXR1cm4gdGFyZ2V0LnNldCh0aGlzLm5vcm1hbHNbaTNdLCB0aGlzLm5vcm1hbHNbaTMgKyAxXSwgdGhpcy5ub3JtYWxzW2kzICsgMl0pOwogICAgfQogICAgLyoqCiAgICAgKiBAcmV0dXJuIFRoZSAidGFyZ2V0IiB2ZWN0b3Igb2JqZWN0CiAgICAgKi8KCgogICAgY2FsY3VsYXRlTG9jYWxJbmVydGlhKG1hc3MsIHRhcmdldCkgewogICAgICAvLyBBcHByb3hpbWF0ZSB3aXRoIGJveCBpbmVydGlhCiAgICAgIC8vIEV4YWN0IGluZXJ0aWEgY2FsY3VsYXRpb24gaXMgb3ZlcmtpbGwsIGJ1dCBzZWUgaHR0cDovL2dlb21ldHJpY3Rvb2xzLmNvbS9Eb2N1bWVudGF0aW9uL1BvbHloZWRyYWxNYXNzUHJvcGVydGllcy5wZGYgZm9yIHRoZSBjb3JyZWN0IHdheSB0byBkbyBpdAogICAgICB0aGlzLmNvbXB1dGVMb2NhbEFBQkIoY2xpX2FhYmIpOwogICAgICBjb25zdCB4ID0gY2xpX2FhYmIudXBwZXJCb3VuZC54IC0gY2xpX2FhYmIubG93ZXJCb3VuZC54OwogICAgICBjb25zdCB5ID0gY2xpX2FhYmIudXBwZXJCb3VuZC55IC0gY2xpX2FhYmIubG93ZXJCb3VuZC55OwogICAgICBjb25zdCB6ID0gY2xpX2FhYmIudXBwZXJCb3VuZC56IC0gY2xpX2FhYmIubG93ZXJCb3VuZC56OwogICAgICByZXR1cm4gdGFyZ2V0LnNldCgxLjAgLyAxMi4wICogbWFzcyAqICgyICogeSAqIDIgKiB5ICsgMiAqIHogKiAyICogeiksIDEuMCAvIDEyLjAgKiBtYXNzICogKDIgKiB4ICogMiAqIHggKyAyICogeiAqIDIgKiB6KSwgMS4wIC8gMTIuMCAqIG1hc3MgKiAoMiAqIHkgKiAyICogeSArIDIgKiB4ICogMiAqIHgpKTsKICAgIH0KICAgIC8qKgogICAgICogQ29tcHV0ZSB0aGUgbG9jYWwgQUFCQiBmb3IgdGhlIHRyaW1lc2gKICAgICAqLwoKCiAgICBjb21wdXRlTG9jYWxBQUJCKGFhYmIpIHsKICAgICAgY29uc3QgbCA9IGFhYmIubG93ZXJCb3VuZDsKICAgICAgY29uc3QgdSA9IGFhYmIudXBwZXJCb3VuZDsKICAgICAgY29uc3QgbiA9IHRoaXMudmVydGljZXMubGVuZ3RoOwogICAgICB0aGlzLnZlcnRpY2VzOwogICAgICBjb25zdCB2ID0gY29tcHV0ZUxvY2FsQUFCQl93b3JsZFZlcnQ7CiAgICAgIHRoaXMuZ2V0VmVydGV4KDAsIHYpOwogICAgICBsLmNvcHkodik7CiAgICAgIHUuY29weSh2KTsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpICE9PSBuOyBpKyspIHsKICAgICAgICB0aGlzLmdldFZlcnRleChpLCB2KTsKCiAgICAgICAgaWYgKHYueCA8IGwueCkgewogICAgICAgICAgbC54ID0gdi54OwogICAgICAgIH0gZWxzZSBpZiAodi54ID4gdS54KSB7CiAgICAgICAgICB1LnggPSB2Lng7CiAgICAgICAgfQoKICAgICAgICBpZiAodi55IDwgbC55KSB7CiAgICAgICAgICBsLnkgPSB2Lnk7CiAgICAgICAgfSBlbHNlIGlmICh2LnkgPiB1LnkpIHsKICAgICAgICAgIHUueSA9IHYueTsKICAgICAgICB9CgogICAgICAgIGlmICh2LnogPCBsLnopIHsKICAgICAgICAgIGwueiA9IHYuejsKICAgICAgICB9IGVsc2UgaWYgKHYueiA+IHUueikgewogICAgICAgICAgdS56ID0gdi56OwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBVcGRhdGUgdGhlIGAuYWFiYmAgcHJvcGVydHkKICAgICAqLwoKCiAgICB1cGRhdGVBQUJCKCkgewogICAgICB0aGlzLmNvbXB1dGVMb2NhbEFBQkIodGhpcy5hYWJiKTsKICAgIH0KICAgIC8qKgogICAgICogV2lsbCB1cGRhdGUgdGhlIGAuYm91bmRpbmdTcGhlcmVSYWRpdXNgIHByb3BlcnR5CiAgICAgKi8KCgogICAgdXBkYXRlQm91bmRpbmdTcGhlcmVSYWRpdXMoKSB7CiAgICAgIC8vIEFzc3VtZSBwb2ludHMgYXJlIGRpc3RyaWJ1dGVkIHdpdGggbG9jYWwgKDAsMCwwKSBhcyBjZW50ZXIKICAgICAgbGV0IG1heDIgPSAwOwogICAgICBjb25zdCB2ZXJ0aWNlcyA9IHRoaXMudmVydGljZXM7CiAgICAgIGNvbnN0IHYgPSBuZXcgVmVjMygpOwoKICAgICAgZm9yIChsZXQgaSA9IDAsIE4gPSB2ZXJ0aWNlcy5sZW5ndGggLyAzOyBpICE9PSBOOyBpKyspIHsKICAgICAgICB0aGlzLmdldFZlcnRleChpLCB2KTsKICAgICAgICBjb25zdCBub3JtMiA9IHYubGVuZ3RoU3F1YXJlZCgpOwoKICAgICAgICBpZiAobm9ybTIgPiBtYXgyKSB7CiAgICAgICAgICBtYXgyID0gbm9ybTI7CiAgICAgICAgfQogICAgICB9CgogICAgICB0aGlzLmJvdW5kaW5nU3BoZXJlUmFkaXVzID0gTWF0aC5zcXJ0KG1heDIpOwogICAgfQogICAgLyoqCiAgICAgKiBjYWxjdWxhdGVXb3JsZEFBQkIKICAgICAqLwoKCiAgICBjYWxjdWxhdGVXb3JsZEFBQkIocG9zLCBxdWF0LCBtaW4sIG1heCkgewogICAgICAvKgogICAgICAgICAgY29uc3QgbiA9IHRoaXMudmVydGljZXMubGVuZ3RoIC8gMywKICAgICAgICAgICAgICB2ZXJ0cyA9IHRoaXMudmVydGljZXM7CiAgICAgICAgICBjb25zdCBtaW54LG1pbnksbWlueixtYXh4LG1heHksbWF4ejsKICAgICAgICAgICBjb25zdCB2ID0gdGVtcFdvcmxkVmVydGV4OwogICAgICAgICAgZm9yKGxldCBpPTA7IGk8bjsgaSsrKXsKICAgICAgICAgICAgICB0aGlzLmdldFZlcnRleChpLCB2KTsKICAgICAgICAgICAgICBxdWF0LnZtdWx0KHYsIHYpOwogICAgICAgICAgICAgIHBvcy52YWRkKHYsIHYpOwogICAgICAgICAgICAgIGlmICh2LnggPCBtaW54IHx8IG1pbng9PT11bmRlZmluZWQpewogICAgICAgICAgICAgICAgICBtaW54ID0gdi54OwogICAgICAgICAgICAgIH0gZWxzZSBpZih2LnggPiBtYXh4IHx8IG1heHg9PT11bmRlZmluZWQpewogICAgICAgICAgICAgICAgICBtYXh4ID0gdi54OwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgaWYgKHYueSA8IG1pbnkgfHwgbWlueT09PXVuZGVmaW5lZCl7CiAgICAgICAgICAgICAgICAgIG1pbnkgPSB2Lnk7CiAgICAgICAgICAgICAgfSBlbHNlIGlmKHYueSA+IG1heHkgfHwgbWF4eT09PXVuZGVmaW5lZCl7CiAgICAgICAgICAgICAgICAgIG1heHkgPSB2Lnk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICBpZiAodi56IDwgbWlueiB8fCBtaW56PT09dW5kZWZpbmVkKXsKICAgICAgICAgICAgICAgICAgbWlueiA9IHYuejsKICAgICAgICAgICAgICB9IGVsc2UgaWYodi56ID4gbWF4eiB8fCBtYXh6PT09dW5kZWZpbmVkKXsKICAgICAgICAgICAgICAgICAgbWF4eiA9IHYuejsKICAgICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICBtaW4uc2V0KG1pbngsbWlueSxtaW56KTsKICAgICAgICAgIG1heC5zZXQobWF4eCxtYXh5LG1heHopOwogICAgICAgICAgKi8KICAgICAgLy8gRmFzdGVyIGFwcHJveGltYXRpb24gdXNpbmcgbG9jYWwgQUFCQgogICAgICBjb25zdCBmcmFtZSA9IGNhbGN1bGF0ZVdvcmxkQUFCQl9mcmFtZTsKICAgICAgY29uc3QgcmVzdWx0ID0gY2FsY3VsYXRlV29ybGRBQUJCX2FhYmI7CiAgICAgIGZyYW1lLnBvc2l0aW9uID0gcG9zOwogICAgICBmcmFtZS5xdWF0ZXJuaW9uID0gcXVhdDsKICAgICAgdGhpcy5hYWJiLnRvV29ybGRGcmFtZShmcmFtZSwgcmVzdWx0KTsKICAgICAgbWluLmNvcHkocmVzdWx0Lmxvd2VyQm91bmQpOwogICAgICBtYXguY29weShyZXN1bHQudXBwZXJCb3VuZCk7CiAgICB9CiAgICAvKioKICAgICAqIEdldCBhcHByb3hpbWF0ZSB2b2x1bWUKICAgICAqLwoKCiAgICB2b2x1bWUoKSB7CiAgICAgIHJldHVybiA0LjAgKiBNYXRoLlBJICogdGhpcy5ib3VuZGluZ1NwaGVyZVJhZGl1cyAvIDMuMDsKICAgIH0KICAgIC8qKgogICAgICogQ3JlYXRlIGEgVHJpbWVzaCBpbnN0YW5jZSwgc2hhcGVkIGFzIGEgdG9ydXMuCiAgICAgKi8KCgogICAgc3RhdGljIGNyZWF0ZVRvcnVzKHJhZGl1cywgdHViZSwgcmFkaWFsU2VnbWVudHMsIHR1YnVsYXJTZWdtZW50cywgYXJjKSB7CiAgICAgIGlmIChyYWRpdXMgPT09IHZvaWQgMCkgewogICAgICAgIHJhZGl1cyA9IDE7CiAgICAgIH0KCiAgICAgIGlmICh0dWJlID09PSB2b2lkIDApIHsKICAgICAgICB0dWJlID0gMC41OwogICAgICB9CgogICAgICBpZiAocmFkaWFsU2VnbWVudHMgPT09IHZvaWQgMCkgewogICAgICAgIHJhZGlhbFNlZ21lbnRzID0gODsKICAgICAgfQoKICAgICAgaWYgKHR1YnVsYXJTZWdtZW50cyA9PT0gdm9pZCAwKSB7CiAgICAgICAgdHVidWxhclNlZ21lbnRzID0gNjsKICAgICAgfQoKICAgICAgaWYgKGFyYyA9PT0gdm9pZCAwKSB7CiAgICAgICAgYXJjID0gTWF0aC5QSSAqIDI7CiAgICAgIH0KCiAgICAgIGNvbnN0IHZlcnRpY2VzID0gW107CiAgICAgIGNvbnN0IGluZGljZXMgPSBbXTsKCiAgICAgIGZvciAobGV0IGogPSAwOyBqIDw9IHJhZGlhbFNlZ21lbnRzOyBqKyspIHsKICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8PSB0dWJ1bGFyU2VnbWVudHM7IGkrKykgewogICAgICAgICAgY29uc3QgdSA9IGkgLyB0dWJ1bGFyU2VnbWVudHMgKiBhcmM7CiAgICAgICAgICBjb25zdCB2ID0gaiAvIHJhZGlhbFNlZ21lbnRzICogTWF0aC5QSSAqIDI7CiAgICAgICAgICBjb25zdCB4ID0gKHJhZGl1cyArIHR1YmUgKiBNYXRoLmNvcyh2KSkgKiBNYXRoLmNvcyh1KTsKICAgICAgICAgIGNvbnN0IHkgPSAocmFkaXVzICsgdHViZSAqIE1hdGguY29zKHYpKSAqIE1hdGguc2luKHUpOwogICAgICAgICAgY29uc3QgeiA9IHR1YmUgKiBNYXRoLnNpbih2KTsKICAgICAgICAgIHZlcnRpY2VzLnB1c2goeCwgeSwgeik7CiAgICAgICAgfQogICAgICB9CgogICAgICBmb3IgKGxldCBqID0gMTsgaiA8PSByYWRpYWxTZWdtZW50czsgaisrKSB7CiAgICAgICAgZm9yIChsZXQgaSA9IDE7IGkgPD0gdHVidWxhclNlZ21lbnRzOyBpKyspIHsKICAgICAgICAgIGNvbnN0IGEgPSAodHVidWxhclNlZ21lbnRzICsgMSkgKiBqICsgaSAtIDE7CiAgICAgICAgICBjb25zdCBiID0gKHR1YnVsYXJTZWdtZW50cyArIDEpICogKGogLSAxKSArIGkgLSAxOwogICAgICAgICAgY29uc3QgYyA9ICh0dWJ1bGFyU2VnbWVudHMgKyAxKSAqIChqIC0gMSkgKyBpOwogICAgICAgICAgY29uc3QgZCA9ICh0dWJ1bGFyU2VnbWVudHMgKyAxKSAqIGogKyBpOwogICAgICAgICAgaW5kaWNlcy5wdXNoKGEsIGIsIGQpOwogICAgICAgICAgaW5kaWNlcy5wdXNoKGIsIGMsIGQpOwogICAgICAgIH0KICAgICAgfQoKICAgICAgcmV0dXJuIG5ldyBUcmltZXNoKHZlcnRpY2VzLCBpbmRpY2VzKTsKICAgIH0KCiAgfQogIGNvbnN0IGNvbXB1dGVOb3JtYWxzX24gPSBuZXcgVmVjMygpOwogIGNvbnN0IHVuc2NhbGVkQUFCQiA9IG5ldyBBQUJCKCk7CiAgY29uc3QgZ2V0RWRnZVZlY3Rvcl92YSA9IG5ldyBWZWMzKCk7CiAgY29uc3QgZ2V0RWRnZVZlY3Rvcl92YiA9IG5ldyBWZWMzKCk7CiAgY29uc3QgY2IgPSBuZXcgVmVjMygpOwogIGNvbnN0IGFiID0gbmV3IFZlYzMoKTsKICBjb25zdCB2YSA9IG5ldyBWZWMzKCk7CiAgY29uc3QgdmIgPSBuZXcgVmVjMygpOwogIGNvbnN0IHZjID0gbmV3IFZlYzMoKTsKICBjb25zdCBjbGlfYWFiYiA9IG5ldyBBQUJCKCk7CiAgY29uc3QgY29tcHV0ZUxvY2FsQUFCQl93b3JsZFZlcnQgPSBuZXcgVmVjMygpOwogIGNvbnN0IGNhbGN1bGF0ZVdvcmxkQUFCQl9mcmFtZSA9IG5ldyBUcmFuc2Zvcm0oKTsKICBjb25zdCBjYWxjdWxhdGVXb3JsZEFBQkJfYWFiYiA9IG5ldyBBQUJCKCk7CgogIC8qKgogICAqIENvbnN0cmFpbnQgZXF1YXRpb24gc29sdmVyIGJhc2UgY2xhc3MuCiAgICovCiAgY2xhc3MgU29sdmVyIHsKICAgIC8qKgogICAgICogQWxsIGVxdWF0aW9ucyB0byBiZSBzb2x2ZWQKICAgICAqLwoKICAgIC8qKgogICAgICogQHRvZG8gcmVtb3ZlIHVzZWxlc3MgY29uc3RydWN0b3IKICAgICAqLwogICAgY29uc3RydWN0b3IoKSB7CiAgICAgIHRoaXMuZXF1YXRpb25zID0gW107CiAgICB9CiAgICAvKioKICAgICAqIFNob3VsZCBiZSBpbXBsZW1lbnRlZCBpbiBzdWJjbGFzc2VzIQogICAgICogQHRvZG8gdXNlIGFic3RyYWN0CiAgICAgKiBAcmV0dXJuIG51bWJlciBvZiBpdGVyYXRpb25zIHBlcmZvcm1lZAogICAgICovCgoKICAgIHNvbHZlKGR0LCB3b3JsZCkgewogICAgICByZXR1cm4gKC8vIFNob3VsZCByZXR1cm4gdGhlIG51bWJlciBvZiBpdGVyYXRpb25zIGRvbmUhCiAgICAgICAgMAogICAgICApOwogICAgfQogICAgLyoqCiAgICAgKiBBZGQgYW4gZXF1YXRpb24KICAgICAqLwoKCiAgICBhZGRFcXVhdGlvbihlcSkgewogICAgICBpZiAoZXEuZW5hYmxlZCAmJiAhZXEuYmkuaXNUcmlnZ2VyICYmICFlcS5iai5pc1RyaWdnZXIpIHsKICAgICAgICB0aGlzLmVxdWF0aW9ucy5wdXNoKGVxKTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBSZW1vdmUgYW4gZXF1YXRpb24KICAgICAqLwoKCiAgICByZW1vdmVFcXVhdGlvbihlcSkgewogICAgICBjb25zdCBlcXMgPSB0aGlzLmVxdWF0aW9uczsKICAgICAgY29uc3QgaSA9IGVxcy5pbmRleE9mKGVxKTsKCiAgICAgIGlmIChpICE9PSAtMSkgewogICAgICAgIGVxcy5zcGxpY2UoaSwgMSk7CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogQWRkIGFsbCBlcXVhdGlvbnMKICAgICAqLwoKCiAgICByZW1vdmVBbGxFcXVhdGlvbnMoKSB7CiAgICAgIHRoaXMuZXF1YXRpb25zLmxlbmd0aCA9IDA7CiAgICB9CgogIH0KCiAgLyoqCiAgICogQ29uc3RyYWludCBlcXVhdGlvbiBHYXVzcy1TZWlkZWwgc29sdmVyLgogICAqIEB0b2RvIFRoZSBzcG9vayBwYXJhbWV0ZXJzIHNob3VsZCBiZSBzcGVjaWZpZWQgZm9yIGVhY2ggY29uc3RyYWludCwgbm90IGdsb2JhbGx5LgogICAqIEBzZWUgaHR0cHM6Ly93d3c4LmNzLnVtdS5zZS9rdXJzZXIvNURWMDU4L1ZUMDkvbGVjdHVyZXMvc3Bvb2tub3Rlcy5wZGYKICAgKi8KICBjbGFzcyBHU1NvbHZlciBleHRlbmRzIFNvbHZlciB7CiAgICAvKioKICAgICAqIFRoZSBudW1iZXIgb2Ygc29sdmVyIGl0ZXJhdGlvbnMgZGV0ZXJtaW5lcyBxdWFsaXR5IG9mIHRoZSBjb25zdHJhaW50cyBpbiB0aGUgd29ybGQuCiAgICAgKiBUaGUgbW9yZSBpdGVyYXRpb25zLCB0aGUgbW9yZSBjb3JyZWN0IHNpbXVsYXRpb24uIE1vcmUgaXRlcmF0aW9ucyBuZWVkIG1vcmUgY29tcHV0YXRpb25zIHRob3VnaC4gSWYgeW91IGhhdmUgYSBsYXJnZSBncmF2aXR5IGZvcmNlIGluIHlvdXIgd29ybGQsIHlvdSB3aWxsIG5lZWQgbW9yZSBpdGVyYXRpb25zLgogICAgICovCgogICAgLyoqCiAgICAgKiBXaGVuIHRvbGVyYW5jZSBpcyByZWFjaGVkLCB0aGUgc3lzdGVtIGlzIGFzc3VtZWQgdG8gYmUgY29udmVyZ2VkLgogICAgICovCgogICAgLyoqCiAgICAgKiBAdG9kbyByZW1vdmUgdXNlbGVzcyBjb25zdHJ1Y3RvcgogICAgICovCiAgICBjb25zdHJ1Y3RvcigpIHsKICAgICAgc3VwZXIoKTsKICAgICAgdGhpcy5pdGVyYXRpb25zID0gMTA7CiAgICAgIHRoaXMudG9sZXJhbmNlID0gMWUtNzsKICAgIH0KICAgIC8qKgogICAgICogU29sdmUKICAgICAqIEByZXR1cm4gbnVtYmVyIG9mIGl0ZXJhdGlvbnMgcGVyZm9ybWVkCiAgICAgKi8KCgogICAgc29sdmUoZHQsIHdvcmxkKSB7CiAgICAgIGxldCBpdGVyID0gMDsKICAgICAgY29uc3QgbWF4SXRlciA9IHRoaXMuaXRlcmF0aW9uczsKICAgICAgY29uc3QgdG9sU3F1YXJlZCA9IHRoaXMudG9sZXJhbmNlICogdGhpcy50b2xlcmFuY2U7CiAgICAgIGNvbnN0IGVxdWF0aW9ucyA9IHRoaXMuZXF1YXRpb25zOwogICAgICBjb25zdCBOZXEgPSBlcXVhdGlvbnMubGVuZ3RoOwogICAgICBjb25zdCBib2RpZXMgPSB3b3JsZC5ib2RpZXM7CiAgICAgIGNvbnN0IE5ib2RpZXMgPSBib2RpZXMubGVuZ3RoOwogICAgICBjb25zdCBoID0gZHQ7CiAgICAgIGxldCBCOwogICAgICBsZXQgaW52QzsKICAgICAgbGV0IGRlbHRhbGFtYmRhOwogICAgICBsZXQgZGVsdGFsYW1iZGFUb3Q7CiAgICAgIGxldCBHV2xhbWJkYTsKICAgICAgbGV0IGxhbWJkYWo7IC8vIFVwZGF0ZSBzb2x2ZSBtYXNzCgogICAgICBpZiAoTmVxICE9PSAwKSB7CiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IE5ib2RpZXM7IGkrKykgewogICAgICAgICAgYm9kaWVzW2ldLnVwZGF0ZVNvbHZlTWFzc1Byb3BlcnRpZXMoKTsKICAgICAgICB9CiAgICAgIH0gLy8gVGhpbmdzIHRoYXQgZG8gbm90IGNoYW5nZSBkdXJpbmcgaXRlcmF0aW9uIGNhbiBiZSBjb21wdXRlZCBvbmNlCgoKICAgICAgY29uc3QgaW52Q3MgPSBHU1NvbHZlcl9zb2x2ZV9pbnZDczsKICAgICAgY29uc3QgQnMgPSBHU1NvbHZlcl9zb2x2ZV9CczsKICAgICAgY29uc3QgbGFtYmRhID0gR1NTb2x2ZXJfc29sdmVfbGFtYmRhOwogICAgICBpbnZDcy5sZW5ndGggPSBOZXE7CiAgICAgIEJzLmxlbmd0aCA9IE5lcTsKICAgICAgbGFtYmRhLmxlbmd0aCA9IE5lcTsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpICE9PSBOZXE7IGkrKykgewogICAgICAgIGNvbnN0IGMgPSBlcXVhdGlvbnNbaV07CiAgICAgICAgbGFtYmRhW2ldID0gMC4wOwogICAgICAgIEJzW2ldID0gYy5jb21wdXRlQihoKTsKICAgICAgICBpbnZDc1tpXSA9IDEuMCAvIGMuY29tcHV0ZUMoKTsKICAgICAgfQoKICAgICAgaWYgKE5lcSAhPT0gMCkgewogICAgICAgIC8vIFJlc2V0IHZsYW1iZGEKICAgICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gTmJvZGllczsgaSsrKSB7CiAgICAgICAgICBjb25zdCBiID0gYm9kaWVzW2ldOwogICAgICAgICAgY29uc3QgdmxhbWJkYSA9IGIudmxhbWJkYTsKICAgICAgICAgIGNvbnN0IHdsYW1iZGEgPSBiLndsYW1iZGE7CiAgICAgICAgICB2bGFtYmRhLnNldCgwLCAwLCAwKTsKICAgICAgICAgIHdsYW1iZGEuc2V0KDAsIDAsIDApOwogICAgICAgIH0gLy8gSXRlcmF0ZSBvdmVyIGVxdWF0aW9ucwoKCiAgICAgICAgZm9yIChpdGVyID0gMDsgaXRlciAhPT0gbWF4SXRlcjsgaXRlcisrKSB7CiAgICAgICAgICAvLyBBY2N1bXVsYXRlIHRoZSB0b3RhbCBlcnJvciBmb3IgZWFjaCBpdGVyYXRpb24uCiAgICAgICAgICBkZWx0YWxhbWJkYVRvdCA9IDAuMDsKCiAgICAgICAgICBmb3IgKGxldCBqID0gMDsgaiAhPT0gTmVxOyBqKyspIHsKICAgICAgICAgICAgY29uc3QgYyA9IGVxdWF0aW9uc1tqXTsgLy8gQ29tcHV0ZSBpdGVyYXRpb24KCiAgICAgICAgICAgIEIgPSBCc1tqXTsKICAgICAgICAgICAgaW52QyA9IGludkNzW2pdOwogICAgICAgICAgICBsYW1iZGFqID0gbGFtYmRhW2pdOwogICAgICAgICAgICBHV2xhbWJkYSA9IGMuY29tcHV0ZUdXbGFtYmRhKCk7CiAgICAgICAgICAgIGRlbHRhbGFtYmRhID0gaW52QyAqIChCIC0gR1dsYW1iZGEgLSBjLmVwcyAqIGxhbWJkYWopOyAvLyBDbGFtcCBpZiB3ZSBhcmUgbm90IHdpdGhpbiB0aGUgbWluL21heCBpbnRlcnZhbAoKICAgICAgICAgICAgaWYgKGxhbWJkYWogKyBkZWx0YWxhbWJkYSA8IGMubWluRm9yY2UpIHsKICAgICAgICAgICAgICBkZWx0YWxhbWJkYSA9IGMubWluRm9yY2UgLSBsYW1iZGFqOwogICAgICAgICAgICB9IGVsc2UgaWYgKGxhbWJkYWogKyBkZWx0YWxhbWJkYSA+IGMubWF4Rm9yY2UpIHsKICAgICAgICAgICAgICBkZWx0YWxhbWJkYSA9IGMubWF4Rm9yY2UgLSBsYW1iZGFqOwogICAgICAgICAgICB9CgogICAgICAgICAgICBsYW1iZGFbal0gKz0gZGVsdGFsYW1iZGE7CiAgICAgICAgICAgIGRlbHRhbGFtYmRhVG90ICs9IGRlbHRhbGFtYmRhID4gMC4wID8gZGVsdGFsYW1iZGEgOiAtZGVsdGFsYW1iZGE7IC8vIGFicyhkZWx0YWxhbWJkYSkKCiAgICAgICAgICAgIGMuYWRkVG9XbGFtYmRhKGRlbHRhbGFtYmRhKTsKICAgICAgICAgIH0gLy8gSWYgdGhlIHRvdGFsIGVycm9yIGlzIHNtYWxsIGVub3VnaCAtIHN0b3AgaXRlcmF0ZQoKCiAgICAgICAgICBpZiAoZGVsdGFsYW1iZGFUb3QgKiBkZWx0YWxhbWJkYVRvdCA8IHRvbFNxdWFyZWQpIHsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CiAgICAgICAgfSAvLyBBZGQgcmVzdWx0IHRvIHZlbG9jaXR5CgoKICAgICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gTmJvZGllczsgaSsrKSB7CiAgICAgICAgICBjb25zdCBiID0gYm9kaWVzW2ldOwogICAgICAgICAgY29uc3QgdiA9IGIudmVsb2NpdHk7CiAgICAgICAgICBjb25zdCB3ID0gYi5hbmd1bGFyVmVsb2NpdHk7CiAgICAgICAgICBiLnZsYW1iZGEudm11bChiLmxpbmVhckZhY3RvciwgYi52bGFtYmRhKTsKICAgICAgICAgIHYudmFkZChiLnZsYW1iZGEsIHYpOwogICAgICAgICAgYi53bGFtYmRhLnZtdWwoYi5hbmd1bGFyRmFjdG9yLCBiLndsYW1iZGEpOwogICAgICAgICAgdy52YWRkKGIud2xhbWJkYSwgdyk7CiAgICAgICAgfSAvLyBTZXQgdGhlIGAubXVsdGlwbGllcmAgcHJvcGVydHkgb2YgZWFjaCBlcXVhdGlvbgoKCiAgICAgICAgbGV0IGwgPSBlcXVhdGlvbnMubGVuZ3RoOwogICAgICAgIGNvbnN0IGludkR0ID0gMSAvIGg7CgogICAgICAgIHdoaWxlIChsLS0pIHsKICAgICAgICAgIGVxdWF0aW9uc1tsXS5tdWx0aXBsaWVyID0gbGFtYmRhW2xdICogaW52RHQ7CiAgICAgICAgfQogICAgICB9CgogICAgICByZXR1cm4gaXRlcjsKICAgIH0KCiAgfSAvLyBKdXN0IHRlbXBvcmFyeSBudW1iZXIgaG9sZGVycyB0aGF0IHdlIHdhbnQgdG8gcmV1c2UgZWFjaCBpdGVyYXRpb24uCgogIGNvbnN0IEdTU29sdmVyX3NvbHZlX2xhbWJkYSA9IFtdOwogIGNvbnN0IEdTU29sdmVyX3NvbHZlX2ludkNzID0gW107CiAgY29uc3QgR1NTb2x2ZXJfc29sdmVfQnMgPSBbXTsKCiAgLyoqCiAgICogU3BsaXRzIHRoZSBlcXVhdGlvbnMgaW50byBpc2xhbmRzIGFuZCBzb2x2ZXMgdGhlbSBpbmRlcGVuZGVudGx5LiBDYW4gaW1wcm92ZSBwZXJmb3JtYW5jZS4KICAgKi8KICBjbGFzcyBTcGxpdFNvbHZlciBleHRlbmRzIFNvbHZlciB7CiAgICAvKioKICAgICAqIFRoZSBudW1iZXIgb2Ygc29sdmVyIGl0ZXJhdGlvbnMgZGV0ZXJtaW5lcyBxdWFsaXR5IG9mIHRoZSBjb25zdHJhaW50cyBpbiB0aGUgd29ybGQuIFRoZSBtb3JlIGl0ZXJhdGlvbnMsIHRoZSBtb3JlIGNvcnJlY3Qgc2ltdWxhdGlvbi4gTW9yZSBpdGVyYXRpb25zIG5lZWQgbW9yZSBjb21wdXRhdGlvbnMgdGhvdWdoLiBJZiB5b3UgaGF2ZSBhIGxhcmdlIGdyYXZpdHkgZm9yY2UgaW4geW91ciB3b3JsZCwgeW91IHdpbGwgbmVlZCBtb3JlIGl0ZXJhdGlvbnMuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFdoZW4gdG9sZXJhbmNlIGlzIHJlYWNoZWQsIHRoZSBzeXN0ZW0gaXMgYXNzdW1lZCB0byBiZSBjb252ZXJnZWQuCiAgICAgKi8KCiAgICAvKiogc3Vic29sdmVyICovCiAgICBjb25zdHJ1Y3RvcihzdWJzb2x2ZXIpIHsKICAgICAgc3VwZXIoKTsKICAgICAgdGhpcy5pdGVyYXRpb25zID0gMTA7CiAgICAgIHRoaXMudG9sZXJhbmNlID0gMWUtNzsKICAgICAgdGhpcy5zdWJzb2x2ZXIgPSBzdWJzb2x2ZXI7CiAgICAgIHRoaXMubm9kZXMgPSBbXTsKICAgICAgdGhpcy5ub2RlUG9vbCA9IFtdOyAvLyBDcmVhdGUgbmVlZGVkIG5vZGVzLCByZXVzZSBpZiBwb3NzaWJsZQoKICAgICAgd2hpbGUgKHRoaXMubm9kZVBvb2wubGVuZ3RoIDwgMTI4KSB7CiAgICAgICAgdGhpcy5ub2RlUG9vbC5wdXNoKHRoaXMuY3JlYXRlTm9kZSgpKTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBjcmVhdGVOb2RlCiAgICAgKi8KCgogICAgY3JlYXRlTm9kZSgpIHsKICAgICAgcmV0dXJuIHsKICAgICAgICBib2R5OiBudWxsLAogICAgICAgIGNoaWxkcmVuOiBbXSwKICAgICAgICBlcXM6IFtdLAogICAgICAgIHZpc2l0ZWQ6IGZhbHNlCiAgICAgIH07CiAgICB9CiAgICAvKioKICAgICAqIFNvbHZlIHRoZSBzdWJzeXN0ZW1zCiAgICAgKiBAcmV0dXJuIG51bWJlciBvZiBpdGVyYXRpb25zIHBlcmZvcm1lZAogICAgICovCgoKICAgIHNvbHZlKGR0LCB3b3JsZCkgewogICAgICBjb25zdCBub2RlcyA9IFNwbGl0U29sdmVyX3NvbHZlX25vZGVzOwogICAgICBjb25zdCBub2RlUG9vbCA9IHRoaXMubm9kZVBvb2w7CiAgICAgIGNvbnN0IGJvZGllcyA9IHdvcmxkLmJvZGllczsKICAgICAgY29uc3QgZXF1YXRpb25zID0gdGhpcy5lcXVhdGlvbnM7CiAgICAgIGNvbnN0IE5lcSA9IGVxdWF0aW9ucy5sZW5ndGg7CiAgICAgIGNvbnN0IE5ib2RpZXMgPSBib2RpZXMubGVuZ3RoOwogICAgICBjb25zdCBzdWJzb2x2ZXIgPSB0aGlzLnN1YnNvbHZlcjsgLy8gQ3JlYXRlIG5lZWRlZCBub2RlcywgcmV1c2UgaWYgcG9zc2libGUKCiAgICAgIHdoaWxlIChub2RlUG9vbC5sZW5ndGggPCBOYm9kaWVzKSB7CiAgICAgICAgbm9kZVBvb2wucHVzaCh0aGlzLmNyZWF0ZU5vZGUoKSk7CiAgICAgIH0KCiAgICAgIG5vZGVzLmxlbmd0aCA9IE5ib2RpZXM7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IE5ib2RpZXM7IGkrKykgewogICAgICAgIG5vZGVzW2ldID0gbm9kZVBvb2xbaV07CiAgICAgIH0gLy8gUmVzZXQgbm9kZSB2YWx1ZXMKCgogICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gTmJvZGllczsgaSsrKSB7CiAgICAgICAgY29uc3Qgbm9kZSA9IG5vZGVzW2ldOwogICAgICAgIG5vZGUuYm9keSA9IGJvZGllc1tpXTsKICAgICAgICBub2RlLmNoaWxkcmVuLmxlbmd0aCA9IDA7CiAgICAgICAgbm9kZS5lcXMubGVuZ3RoID0gMDsKICAgICAgICBub2RlLnZpc2l0ZWQgPSBmYWxzZTsKICAgICAgfQoKICAgICAgZm9yIChsZXQgayA9IDA7IGsgIT09IE5lcTsgaysrKSB7CiAgICAgICAgY29uc3QgZXEgPSBlcXVhdGlvbnNba107CiAgICAgICAgY29uc3QgaSA9IGJvZGllcy5pbmRleE9mKGVxLmJpKTsKICAgICAgICBjb25zdCBqID0gYm9kaWVzLmluZGV4T2YoZXEuYmopOwogICAgICAgIGNvbnN0IG5pID0gbm9kZXNbaV07CiAgICAgICAgY29uc3QgbmogPSBub2Rlc1tqXTsKICAgICAgICBuaS5jaGlsZHJlbi5wdXNoKG5qKTsKICAgICAgICBuaS5lcXMucHVzaChlcSk7CiAgICAgICAgbmouY2hpbGRyZW4ucHVzaChuaSk7CiAgICAgICAgbmouZXFzLnB1c2goZXEpOwogICAgICB9CgogICAgICBsZXQgY2hpbGQ7CiAgICAgIGxldCBuID0gMDsKICAgICAgbGV0IGVxcyA9IFNwbGl0U29sdmVyX3NvbHZlX2VxczsKICAgICAgc3Vic29sdmVyLnRvbGVyYW5jZSA9IHRoaXMudG9sZXJhbmNlOwogICAgICBzdWJzb2x2ZXIuaXRlcmF0aW9ucyA9IHRoaXMuaXRlcmF0aW9uczsKICAgICAgY29uc3QgZHVtbXlXb3JsZCA9IFNwbGl0U29sdmVyX3NvbHZlX2R1bW15V29ybGQ7CgogICAgICB3aGlsZSAoY2hpbGQgPSBnZXRVbnZpc2l0ZWROb2RlKG5vZGVzKSkgewogICAgICAgIGVxcy5sZW5ndGggPSAwOwogICAgICAgIGR1bW15V29ybGQuYm9kaWVzLmxlbmd0aCA9IDA7CiAgICAgICAgYmZzKGNoaWxkLCB2aXNpdEZ1bmMsIGR1bW15V29ybGQuYm9kaWVzLCBlcXMpOwogICAgICAgIGNvbnN0IE5lcXMgPSBlcXMubGVuZ3RoOwogICAgICAgIGVxcyA9IGVxcy5zb3J0KHNvcnRCeUlkKTsKCiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IE5lcXM7IGkrKykgewogICAgICAgICAgc3Vic29sdmVyLmFkZEVxdWF0aW9uKGVxc1tpXSk7CiAgICAgICAgfQoKICAgICAgICBzdWJzb2x2ZXIuc29sdmUoZHQsIGR1bW15V29ybGQpOwogICAgICAgIHN1YnNvbHZlci5yZW1vdmVBbGxFcXVhdGlvbnMoKTsKICAgICAgICBuKys7CiAgICAgIH0KCiAgICAgIHJldHVybiBuOwogICAgfQoKICB9IC8vIFJldHVybnMgdGhlIG51bWJlciBvZiBzdWJzeXN0ZW1zCgogIGNvbnN0IFNwbGl0U29sdmVyX3NvbHZlX25vZGVzID0gW107IC8vIEFsbCBhbGxvY2F0ZWQgbm9kZSBvYmplY3RzCgogIGNvbnN0IFNwbGl0U29sdmVyX3NvbHZlX2VxcyA9IFtdOyAvLyBUZW1wIGFycmF5CgogIGNvbnN0IFNwbGl0U29sdmVyX3NvbHZlX2R1bW15V29ybGQgPSB7CiAgICBib2RpZXM6IFtdCiAgfTsgLy8gVGVtcCBvYmplY3QKCiAgY29uc3QgU1RBVElDID0gQm9keS5TVEFUSUM7CgogIGZ1bmN0aW9uIGdldFVudmlzaXRlZE5vZGUobm9kZXMpIHsKICAgIGNvbnN0IE5ub2RlcyA9IG5vZGVzLmxlbmd0aDsKCiAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gTm5vZGVzOyBpKyspIHsKICAgICAgY29uc3Qgbm9kZSA9IG5vZGVzW2ldOwoKICAgICAgaWYgKCFub2RlLnZpc2l0ZWQgJiYgIShub2RlLmJvZHkudHlwZSAmIFNUQVRJQykpIHsKICAgICAgICByZXR1cm4gbm9kZTsKICAgICAgfQogICAgfQoKICAgIHJldHVybiBmYWxzZTsKICB9CgogIGNvbnN0IHF1ZXVlID0gW107CgogIGZ1bmN0aW9uIGJmcyhyb290LCB2aXNpdEZ1bmMsIGJkcywgZXFzKSB7CiAgICBxdWV1ZS5wdXNoKHJvb3QpOwogICAgcm9vdC52aXNpdGVkID0gdHJ1ZTsKICAgIHZpc2l0RnVuYyhyb290LCBiZHMsIGVxcyk7CgogICAgd2hpbGUgKHF1ZXVlLmxlbmd0aCkgewogICAgICBjb25zdCBub2RlID0gcXVldWUucG9wKCk7IC8vIExvb3Agb3ZlciB1bnZpc2l0ZWQgY2hpbGQgbm9kZXMKCiAgICAgIGxldCBjaGlsZDsKCiAgICAgIHdoaWxlIChjaGlsZCA9IGdldFVudmlzaXRlZE5vZGUobm9kZS5jaGlsZHJlbikpIHsKICAgICAgICBjaGlsZC52aXNpdGVkID0gdHJ1ZTsKICAgICAgICB2aXNpdEZ1bmMoY2hpbGQsIGJkcywgZXFzKTsKICAgICAgICBxdWV1ZS5wdXNoKGNoaWxkKTsKICAgICAgfQogICAgfQogIH0KCiAgZnVuY3Rpb24gdmlzaXRGdW5jKG5vZGUsIGJkcywgZXFzKSB7CiAgICBiZHMucHVzaChub2RlLmJvZHkpOwogICAgY29uc3QgTmVxcyA9IG5vZGUuZXFzLmxlbmd0aDsKCiAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gTmVxczsgaSsrKSB7CiAgICAgIGNvbnN0IGVxID0gbm9kZS5lcXNbaV07CgogICAgICBpZiAoIWVxcy5pbmNsdWRlcyhlcSkpIHsKICAgICAgICBlcXMucHVzaChlcSk7CiAgICAgIH0KICAgIH0KICB9CgogIGZ1bmN0aW9uIHNvcnRCeUlkKGEsIGIpIHsKICAgIHJldHVybiBiLmlkIC0gYS5pZDsKICB9CgogIC8qKgogICAqIEZvciBwb29saW5nIG9iamVjdHMgdGhhdCBjYW4gYmUgcmV1c2VkLgogICAqLwogIGNsYXNzIFBvb2wgewogICAgY29uc3RydWN0b3IoKSB7CiAgICAgIHRoaXMub2JqZWN0cyA9IFtdOwogICAgICB0aGlzLnR5cGUgPSBPYmplY3Q7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZWxlYXNlIGFuIG9iamVjdCBhZnRlciB1c2UKICAgICAqLwogICAgcmVsZWFzZSgpIHsKICAgICAgY29uc3QgTmFyZ3MgPSBhcmd1bWVudHMubGVuZ3RoOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IE5hcmdzOyBpKyspIHsKICAgICAgICB0aGlzLm9iamVjdHMucHVzaChpIDwgMCB8fCBhcmd1bWVudHMubGVuZ3RoIDw9IGkgPyB1bmRlZmluZWQgOiBhcmd1bWVudHNbaV0pOwogICAgICB9CgogICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIC8qKgogICAgICogR2V0IGFuIG9iamVjdAogICAgICovCgoKICAgIGdldCgpIHsKICAgICAgaWYgKHRoaXMub2JqZWN0cy5sZW5ndGggPT09IDApIHsKICAgICAgICByZXR1cm4gdGhpcy5jb25zdHJ1Y3RPYmplY3QoKTsKICAgICAgfSBlbHNlIHsKICAgICAgICByZXR1cm4gdGhpcy5vYmplY3RzLnBvcCgpOwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIENvbnN0cnVjdCBhbiBvYmplY3QuIFNob3VsZCBiZSBpbXBsZW1lbnRlZCBpbiBlYWNoIHN1YmNsYXNzLgogICAgICovCgoKICAgIGNvbnN0cnVjdE9iamVjdCgpIHsKICAgICAgdGhyb3cgbmV3IEVycm9yKCdjb25zdHJ1Y3RPYmplY3QoKSBub3QgaW1wbGVtZW50ZWQgaW4gdGhpcyBQb29sIHN1YmNsYXNzIHlldCEnKTsKICAgIH0KICAgIC8qKgogICAgICogQHJldHVybiBTZWxmLCBmb3IgY2hhaW5pbmcKICAgICAqLwoKCiAgICByZXNpemUoc2l6ZSkgewogICAgICBjb25zdCBvYmplY3RzID0gdGhpcy5vYmplY3RzOwoKICAgICAgd2hpbGUgKG9iamVjdHMubGVuZ3RoID4gc2l6ZSkgewogICAgICAgIG9iamVjdHMucG9wKCk7CiAgICAgIH0KCiAgICAgIHdoaWxlIChvYmplY3RzLmxlbmd0aCA8IHNpemUpIHsKICAgICAgICBvYmplY3RzLnB1c2godGhpcy5jb25zdHJ1Y3RPYmplY3QoKSk7CiAgICAgIH0KCiAgICAgIHJldHVybiB0aGlzOwogICAgfQoKICB9CgogIC8qKgogICAqIFZlYzNQb29sCiAgICovCgogIGNsYXNzIFZlYzNQb29sIGV4dGVuZHMgUG9vbCB7CiAgICBjb25zdHJ1Y3RvcigpIHsKICAgICAgc3VwZXIoLi4uYXJndW1lbnRzKTsKICAgICAgdGhpcy50eXBlID0gVmVjMzsKICAgIH0KCiAgICAvKioKICAgICAqIENvbnN0cnVjdCBhIHZlY3RvcgogICAgICovCiAgICBjb25zdHJ1Y3RPYmplY3QoKSB7CiAgICAgIHJldHVybiBuZXcgVmVjMygpOwogICAgfQoKICB9CgogIC8vIE5hbWluZyBydWxlOiBiYXNlZCBvZiB0aGUgb3JkZXIgaW4gU0hBUEVfVFlQRVMsCiAgLy8gdGhlIGZpcnN0IHBhcnQgb2YgdGhlIG1ldGhvZCBpcyBmb3JtZWQgYnkgdGhlCiAgLy8gc2hhcGUgdHlwZSB0aGF0IGNvbWVzIGJlZm9yZSwgaW4gdGhlIHNlY29uZCBwYXJ0CiAgLy8gdGhlcmUgaXMgdGhlIHNoYXBlIHR5cGUgdGhhdCBjb21lcyBhZnRlciBpbiB0aGUgU0hBUEVfVFlQRVMgbGlzdAogIGNvbnN0IENPTExJU0lPTl9UWVBFUyA9IHsKICAgIHNwaGVyZVNwaGVyZTogU2hhcGUudHlwZXMuU1BIRVJFLAogICAgc3BoZXJlUGxhbmU6IFNoYXBlLnR5cGVzLlNQSEVSRSB8IFNoYXBlLnR5cGVzLlBMQU5FLAogICAgYm94Qm94OiBTaGFwZS50eXBlcy5CT1ggfCBTaGFwZS50eXBlcy5CT1gsCiAgICBzcGhlcmVCb3g6IFNoYXBlLnR5cGVzLlNQSEVSRSB8IFNoYXBlLnR5cGVzLkJPWCwKICAgIHBsYW5lQm94OiBTaGFwZS50eXBlcy5QTEFORSB8IFNoYXBlLnR5cGVzLkJPWCwKICAgIGNvbnZleENvbnZleDogU2hhcGUudHlwZXMuQ09OVkVYUE9MWUhFRFJPTiwKICAgIHNwaGVyZUNvbnZleDogU2hhcGUudHlwZXMuU1BIRVJFIHwgU2hhcGUudHlwZXMuQ09OVkVYUE9MWUhFRFJPTiwKICAgIHBsYW5lQ29udmV4OiBTaGFwZS50eXBlcy5QTEFORSB8IFNoYXBlLnR5cGVzLkNPTlZFWFBPTFlIRURST04sCiAgICBib3hDb252ZXg6IFNoYXBlLnR5cGVzLkJPWCB8IFNoYXBlLnR5cGVzLkNPTlZFWFBPTFlIRURST04sCiAgICBzcGhlcmVIZWlnaHRmaWVsZDogU2hhcGUudHlwZXMuU1BIRVJFIHwgU2hhcGUudHlwZXMuSEVJR0hURklFTEQsCiAgICBib3hIZWlnaHRmaWVsZDogU2hhcGUudHlwZXMuQk9YIHwgU2hhcGUudHlwZXMuSEVJR0hURklFTEQsCiAgICBjb252ZXhIZWlnaHRmaWVsZDogU2hhcGUudHlwZXMuQ09OVkVYUE9MWUhFRFJPTiB8IFNoYXBlLnR5cGVzLkhFSUdIVEZJRUxELAogICAgc3BoZXJlUGFydGljbGU6IFNoYXBlLnR5cGVzLlBBUlRJQ0xFIHwgU2hhcGUudHlwZXMuU1BIRVJFLAogICAgcGxhbmVQYXJ0aWNsZTogU2hhcGUudHlwZXMuUExBTkUgfCBTaGFwZS50eXBlcy5QQVJUSUNMRSwKICAgIGJveFBhcnRpY2xlOiBTaGFwZS50eXBlcy5CT1ggfCBTaGFwZS50eXBlcy5QQVJUSUNMRSwKICAgIGNvbnZleFBhcnRpY2xlOiBTaGFwZS50eXBlcy5QQVJUSUNMRSB8IFNoYXBlLnR5cGVzLkNPTlZFWFBPTFlIRURST04sCiAgICBjeWxpbmRlckN5bGluZGVyOiBTaGFwZS50eXBlcy5DWUxJTkRFUiwKICAgIHNwaGVyZUN5bGluZGVyOiBTaGFwZS50eXBlcy5TUEhFUkUgfCBTaGFwZS50eXBlcy5DWUxJTkRFUiwKICAgIHBsYW5lQ3lsaW5kZXI6IFNoYXBlLnR5cGVzLlBMQU5FIHwgU2hhcGUudHlwZXMuQ1lMSU5ERVIsCiAgICBib3hDeWxpbmRlcjogU2hhcGUudHlwZXMuQk9YIHwgU2hhcGUudHlwZXMuQ1lMSU5ERVIsCiAgICBjb252ZXhDeWxpbmRlcjogU2hhcGUudHlwZXMuQ09OVkVYUE9MWUhFRFJPTiB8IFNoYXBlLnR5cGVzLkNZTElOREVSLAogICAgaGVpZ2h0ZmllbGRDeWxpbmRlcjogU2hhcGUudHlwZXMuSEVJR0hURklFTEQgfCBTaGFwZS50eXBlcy5DWUxJTkRFUiwKICAgIHBhcnRpY2xlQ3lsaW5kZXI6IFNoYXBlLnR5cGVzLlBBUlRJQ0xFIHwgU2hhcGUudHlwZXMuQ1lMSU5ERVIsCiAgICBzcGhlcmVUcmltZXNoOiBTaGFwZS50eXBlcy5TUEhFUkUgfCBTaGFwZS50eXBlcy5UUklNRVNILAogICAgcGxhbmVUcmltZXNoOiBTaGFwZS50eXBlcy5QTEFORSB8IFNoYXBlLnR5cGVzLlRSSU1FU0gKICB9OwoKICAvKioKICAgKiBIZWxwZXIgY2xhc3MgZm9yIHRoZSBXb3JsZC4gR2VuZXJhdGVzIENvbnRhY3RFcXVhdGlvbnMuCiAgICogQHRvZG8gU3BoZXJlLUNvbnZleFBvbHloZWRyb24gY29udGFjdHMKICAgKiBAdG9kbyBDb250YWN0IHJlZHVjdGlvbgogICAqIEB0b2RvIHNob3VsZCBtb3ZlIG1ldGhvZHMgdG8gcHJvdG90eXBlCiAgICovCiAgY2xhc3MgTmFycm93cGhhc2UgewogICAgLyoqCiAgICAgKiBJbnRlcm5hbCBzdG9yYWdlIG9mIHBvb2xlZCBjb250YWN0IHBvaW50cy4KICAgICAqLwoKICAgIC8qKgogICAgICogUG9vbGVkIHZlY3RvcnMuCiAgICAgKi8KICAgIGdldCBbQ09MTElTSU9OX1RZUEVTLnNwaGVyZVNwaGVyZV0oKSB7CiAgICAgIHJldHVybiB0aGlzLnNwaGVyZVNwaGVyZTsKICAgIH0KCiAgICBnZXQgW0NPTExJU0lPTl9UWVBFUy5zcGhlcmVQbGFuZV0oKSB7CiAgICAgIHJldHVybiB0aGlzLnNwaGVyZVBsYW5lOwogICAgfQoKICAgIGdldCBbQ09MTElTSU9OX1RZUEVTLmJveEJveF0oKSB7CiAgICAgIHJldHVybiB0aGlzLmJveEJveDsKICAgIH0KCiAgICBnZXQgW0NPTExJU0lPTl9UWVBFUy5zcGhlcmVCb3hdKCkgewogICAgICByZXR1cm4gdGhpcy5zcGhlcmVCb3g7CiAgICB9CgogICAgZ2V0IFtDT0xMSVNJT05fVFlQRVMucGxhbmVCb3hdKCkgewogICAgICByZXR1cm4gdGhpcy5wbGFuZUJveDsKICAgIH0KCiAgICBnZXQgW0NPTExJU0lPTl9UWVBFUy5jb252ZXhDb252ZXhdKCkgewogICAgICByZXR1cm4gdGhpcy5jb252ZXhDb252ZXg7CiAgICB9CgogICAgZ2V0IFtDT0xMSVNJT05fVFlQRVMuc3BoZXJlQ29udmV4XSgpIHsKICAgICAgcmV0dXJuIHRoaXMuc3BoZXJlQ29udmV4OwogICAgfQoKICAgIGdldCBbQ09MTElTSU9OX1RZUEVTLnBsYW5lQ29udmV4XSgpIHsKICAgICAgcmV0dXJuIHRoaXMucGxhbmVDb252ZXg7CiAgICB9CgogICAgZ2V0IFtDT0xMSVNJT05fVFlQRVMuYm94Q29udmV4XSgpIHsKICAgICAgcmV0dXJuIHRoaXMuYm94Q29udmV4OwogICAgfQoKICAgIGdldCBbQ09MTElTSU9OX1RZUEVTLnNwaGVyZUhlaWdodGZpZWxkXSgpIHsKICAgICAgcmV0dXJuIHRoaXMuc3BoZXJlSGVpZ2h0ZmllbGQ7CiAgICB9CgogICAgZ2V0IFtDT0xMSVNJT05fVFlQRVMuYm94SGVpZ2h0ZmllbGRdKCkgewogICAgICByZXR1cm4gdGhpcy5ib3hIZWlnaHRmaWVsZDsKICAgIH0KCiAgICBnZXQgW0NPTExJU0lPTl9UWVBFUy5jb252ZXhIZWlnaHRmaWVsZF0oKSB7CiAgICAgIHJldHVybiB0aGlzLmNvbnZleEhlaWdodGZpZWxkOwogICAgfQoKICAgIGdldCBbQ09MTElTSU9OX1RZUEVTLnNwaGVyZVBhcnRpY2xlXSgpIHsKICAgICAgcmV0dXJuIHRoaXMuc3BoZXJlUGFydGljbGU7CiAgICB9CgogICAgZ2V0IFtDT0xMSVNJT05fVFlQRVMucGxhbmVQYXJ0aWNsZV0oKSB7CiAgICAgIHJldHVybiB0aGlzLnBsYW5lUGFydGljbGU7CiAgICB9CgogICAgZ2V0IFtDT0xMSVNJT05fVFlQRVMuYm94UGFydGljbGVdKCkgewogICAgICByZXR1cm4gdGhpcy5ib3hQYXJ0aWNsZTsKICAgIH0KCiAgICBnZXQgW0NPTExJU0lPTl9UWVBFUy5jb252ZXhQYXJ0aWNsZV0oKSB7CiAgICAgIHJldHVybiB0aGlzLmNvbnZleFBhcnRpY2xlOwogICAgfQoKICAgIGdldCBbQ09MTElTSU9OX1RZUEVTLmN5bGluZGVyQ3lsaW5kZXJdKCkgewogICAgICByZXR1cm4gdGhpcy5jb252ZXhDb252ZXg7CiAgICB9CgogICAgZ2V0IFtDT0xMSVNJT05fVFlQRVMuc3BoZXJlQ3lsaW5kZXJdKCkgewogICAgICByZXR1cm4gdGhpcy5zcGhlcmVDb252ZXg7CiAgICB9CgogICAgZ2V0IFtDT0xMSVNJT05fVFlQRVMucGxhbmVDeWxpbmRlcl0oKSB7CiAgICAgIHJldHVybiB0aGlzLnBsYW5lQ29udmV4OwogICAgfQoKICAgIGdldCBbQ09MTElTSU9OX1RZUEVTLmJveEN5bGluZGVyXSgpIHsKICAgICAgcmV0dXJuIHRoaXMuYm94Q29udmV4OwogICAgfQoKICAgIGdldCBbQ09MTElTSU9OX1RZUEVTLmNvbnZleEN5bGluZGVyXSgpIHsKICAgICAgcmV0dXJuIHRoaXMuY29udmV4Q29udmV4OwogICAgfQoKICAgIGdldCBbQ09MTElTSU9OX1RZUEVTLmhlaWdodGZpZWxkQ3lsaW5kZXJdKCkgewogICAgICByZXR1cm4gdGhpcy5oZWlnaHRmaWVsZEN5bGluZGVyOwogICAgfQoKICAgIGdldCBbQ09MTElTSU9OX1RZUEVTLnBhcnRpY2xlQ3lsaW5kZXJdKCkgewogICAgICByZXR1cm4gdGhpcy5wYXJ0aWNsZUN5bGluZGVyOwogICAgfQoKICAgIGdldCBbQ09MTElTSU9OX1RZUEVTLnNwaGVyZVRyaW1lc2hdKCkgewogICAgICByZXR1cm4gdGhpcy5zcGhlcmVUcmltZXNoOwogICAgfQoKICAgIGdldCBbQ09MTElTSU9OX1RZUEVTLnBsYW5lVHJpbWVzaF0oKSB7CiAgICAgIHJldHVybiB0aGlzLnBsYW5lVHJpbWVzaDsKICAgIH0gLy8gZ2V0IFtDT0xMSVNJT05fVFlQRVMuY29udmV4VHJpbWVzaF0oKSB7CiAgICAvLyAgIHJldHVybiB0aGlzLmNvbnZleFRyaW1lc2gKICAgIC8vIH0KCgogICAgY29uc3RydWN0b3Iod29ybGQpIHsKICAgICAgdGhpcy5jb250YWN0UG9pbnRQb29sID0gW107CiAgICAgIHRoaXMuZnJpY3Rpb25FcXVhdGlvblBvb2wgPSBbXTsKICAgICAgdGhpcy5yZXN1bHQgPSBbXTsKICAgICAgdGhpcy5mcmljdGlvblJlc3VsdCA9IFtdOwogICAgICB0aGlzLnYzcG9vbCA9IG5ldyBWZWMzUG9vbCgpOwogICAgICB0aGlzLndvcmxkID0gd29ybGQ7CiAgICAgIHRoaXMuY3VycmVudENvbnRhY3RNYXRlcmlhbCA9IHdvcmxkLmRlZmF1bHRDb250YWN0TWF0ZXJpYWw7CiAgICAgIHRoaXMuZW5hYmxlRnJpY3Rpb25SZWR1Y3Rpb24gPSBmYWxzZTsKICAgIH0KICAgIC8qKgogICAgICogTWFrZSBhIGNvbnRhY3Qgb2JqZWN0LCBieSB1c2luZyB0aGUgaW50ZXJuYWwgcG9vbCBvciBjcmVhdGluZyBhIG5ldyBvbmUuCiAgICAgKi8KCgogICAgY3JlYXRlQ29udGFjdEVxdWF0aW9uKGJpLCBiaiwgc2ksIHNqLCBvdmVycmlkZVNoYXBlQSwgb3ZlcnJpZGVTaGFwZUIpIHsKICAgICAgbGV0IGM7CgogICAgICBpZiAodGhpcy5jb250YWN0UG9pbnRQb29sLmxlbmd0aCkgewogICAgICAgIGMgPSB0aGlzLmNvbnRhY3RQb2ludFBvb2wucG9wKCk7CiAgICAgICAgYy5iaSA9IGJpOwogICAgICAgIGMuYmogPSBiajsKICAgICAgfSBlbHNlIHsKICAgICAgICBjID0gbmV3IENvbnRhY3RFcXVhdGlvbihiaSwgYmopOwogICAgICB9CgogICAgICBjLmVuYWJsZWQgPSBiaS5jb2xsaXNpb25SZXNwb25zZSAmJiBiai5jb2xsaXNpb25SZXNwb25zZSAmJiBzaS5jb2xsaXNpb25SZXNwb25zZSAmJiBzai5jb2xsaXNpb25SZXNwb25zZTsKICAgICAgY29uc3QgY20gPSB0aGlzLmN1cnJlbnRDb250YWN0TWF0ZXJpYWw7CiAgICAgIGMucmVzdGl0dXRpb24gPSBjbS5yZXN0aXR1dGlvbjsKICAgICAgYy5zZXRTcG9va1BhcmFtcyhjbS5jb250YWN0RXF1YXRpb25TdGlmZm5lc3MsIGNtLmNvbnRhY3RFcXVhdGlvblJlbGF4YXRpb24sIHRoaXMud29ybGQuZHQpOwogICAgICBjb25zdCBtYXRBID0gc2kubWF0ZXJpYWwgfHwgYmkubWF0ZXJpYWw7CiAgICAgIGNvbnN0IG1hdEIgPSBzai5tYXRlcmlhbCB8fCBiai5tYXRlcmlhbDsKCiAgICAgIGlmIChtYXRBICYmIG1hdEIgJiYgbWF0QS5yZXN0aXR1dGlvbiA+PSAwICYmIG1hdEIucmVzdGl0dXRpb24gPj0gMCkgewogICAgICAgIGMucmVzdGl0dXRpb24gPSBtYXRBLnJlc3RpdHV0aW9uICogbWF0Qi5yZXN0aXR1dGlvbjsKICAgICAgfQoKICAgICAgYy5zaSA9IG92ZXJyaWRlU2hhcGVBIHx8IHNpOwogICAgICBjLnNqID0gb3ZlcnJpZGVTaGFwZUIgfHwgc2o7CiAgICAgIHJldHVybiBjOwogICAgfQoKICAgIGNyZWF0ZUZyaWN0aW9uRXF1YXRpb25zRnJvbUNvbnRhY3QoY29udGFjdEVxdWF0aW9uLCBvdXRBcnJheSkgewogICAgICBjb25zdCBib2R5QSA9IGNvbnRhY3RFcXVhdGlvbi5iaTsKICAgICAgY29uc3QgYm9keUIgPSBjb250YWN0RXF1YXRpb24uYmo7CiAgICAgIGNvbnN0IHNoYXBlQSA9IGNvbnRhY3RFcXVhdGlvbi5zaTsKICAgICAgY29uc3Qgc2hhcGVCID0gY29udGFjdEVxdWF0aW9uLnNqOwogICAgICBjb25zdCB3b3JsZCA9IHRoaXMud29ybGQ7CiAgICAgIGNvbnN0IGNtID0gdGhpcy5jdXJyZW50Q29udGFjdE1hdGVyaWFsOyAvLyBJZiBmcmljdGlvbiBvciByZXN0aXR1dGlvbiB3ZXJlIHNwZWNpZmllZCBpbiB0aGUgbWF0ZXJpYWwsIHVzZSB0aGVtCgogICAgICBsZXQgZnJpY3Rpb24gPSBjbS5mcmljdGlvbjsKICAgICAgY29uc3QgbWF0QSA9IHNoYXBlQS5tYXRlcmlhbCB8fCBib2R5QS5tYXRlcmlhbDsKICAgICAgY29uc3QgbWF0QiA9IHNoYXBlQi5tYXRlcmlhbCB8fCBib2R5Qi5tYXRlcmlhbDsKCiAgICAgIGlmIChtYXRBICYmIG1hdEIgJiYgbWF0QS5mcmljdGlvbiA+PSAwICYmIG1hdEIuZnJpY3Rpb24gPj0gMCkgewogICAgICAgIGZyaWN0aW9uID0gbWF0QS5mcmljdGlvbiAqIG1hdEIuZnJpY3Rpb247CiAgICAgIH0KCiAgICAgIGlmIChmcmljdGlvbiA+IDApIHsKICAgICAgICAvLyBDcmVhdGUgMiB0YW5nZW50IGVxdWF0aW9ucwogICAgICAgIC8vIFVzZXJzIG1heSBwcm92aWRlIGEgZm9yY2UgZGlmZmVyZW50IGZyb20gZ2xvYmFsIGdyYXZpdHkgdG8gdXNlIHdoZW4gY29tcHV0aW5nIGNvbnRhY3QgZnJpY3Rpb24uCiAgICAgICAgY29uc3QgbXVnID0gZnJpY3Rpb24gKiAod29ybGQuZnJpY3Rpb25HcmF2aXR5IHx8IHdvcmxkLmdyYXZpdHkpLmxlbmd0aCgpOwogICAgICAgIGxldCByZWR1Y2VkTWFzcyA9IGJvZHlBLmludk1hc3MgKyBib2R5Qi5pbnZNYXNzOwoKICAgICAgICBpZiAocmVkdWNlZE1hc3MgPiAwKSB7CiAgICAgICAgICByZWR1Y2VkTWFzcyA9IDEgLyByZWR1Y2VkTWFzczsKICAgICAgICB9CgogICAgICAgIGNvbnN0IHBvb2wgPSB0aGlzLmZyaWN0aW9uRXF1YXRpb25Qb29sOwogICAgICAgIGNvbnN0IGMxID0gcG9vbC5sZW5ndGggPyBwb29sLnBvcCgpIDogbmV3IEZyaWN0aW9uRXF1YXRpb24oYm9keUEsIGJvZHlCLCBtdWcgKiByZWR1Y2VkTWFzcyk7CiAgICAgICAgY29uc3QgYzIgPSBwb29sLmxlbmd0aCA/IHBvb2wucG9wKCkgOiBuZXcgRnJpY3Rpb25FcXVhdGlvbihib2R5QSwgYm9keUIsIG11ZyAqIHJlZHVjZWRNYXNzKTsKICAgICAgICBjMS5iaSA9IGMyLmJpID0gYm9keUE7CiAgICAgICAgYzEuYmogPSBjMi5iaiA9IGJvZHlCOwogICAgICAgIGMxLm1pbkZvcmNlID0gYzIubWluRm9yY2UgPSAtbXVnICogcmVkdWNlZE1hc3M7CiAgICAgICAgYzEubWF4Rm9yY2UgPSBjMi5tYXhGb3JjZSA9IG11ZyAqIHJlZHVjZWRNYXNzOyAvLyBDb3B5IG92ZXIgdGhlIHJlbGF0aXZlIHZlY3RvcnMKCiAgICAgICAgYzEucmkuY29weShjb250YWN0RXF1YXRpb24ucmkpOwogICAgICAgIGMxLnJqLmNvcHkoY29udGFjdEVxdWF0aW9uLnJqKTsKICAgICAgICBjMi5yaS5jb3B5KGNvbnRhY3RFcXVhdGlvbi5yaSk7CiAgICAgICAgYzIucmouY29weShjb250YWN0RXF1YXRpb24ucmopOyAvLyBDb25zdHJ1Y3QgdGFuZ2VudHMKCiAgICAgICAgY29udGFjdEVxdWF0aW9uLm5pLnRhbmdlbnRzKGMxLnQsIGMyLnQpOyAvLyBTZXQgc3Bvb2sgcGFyYW1zCgogICAgICAgIGMxLnNldFNwb29rUGFyYW1zKGNtLmZyaWN0aW9uRXF1YXRpb25TdGlmZm5lc3MsIGNtLmZyaWN0aW9uRXF1YXRpb25SZWxheGF0aW9uLCB3b3JsZC5kdCk7CiAgICAgICAgYzIuc2V0U3Bvb2tQYXJhbXMoY20uZnJpY3Rpb25FcXVhdGlvblN0aWZmbmVzcywgY20uZnJpY3Rpb25FcXVhdGlvblJlbGF4YXRpb24sIHdvcmxkLmR0KTsKICAgICAgICBjMS5lbmFibGVkID0gYzIuZW5hYmxlZCA9IGNvbnRhY3RFcXVhdGlvbi5lbmFibGVkOwogICAgICAgIG91dEFycmF5LnB1c2goYzEsIGMyKTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgfQoKICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQogICAgLyoqCiAgICAgKiBUYWtlIHRoZSBhdmVyYWdlIE4gbGF0ZXN0IGNvbnRhY3QgcG9pbnQgb24gdGhlIHBsYW5lLgogICAgICovCgoKICAgIGNyZWF0ZUZyaWN0aW9uRnJvbUF2ZXJhZ2UobnVtQ29udGFjdHMpIHsKICAgICAgLy8gVGhlIGxhc3QgY29udGFjdEVxdWF0aW9uCiAgICAgIGxldCBjID0gdGhpcy5yZXN1bHRbdGhpcy5yZXN1bHQubGVuZ3RoIC0gMV07IC8vIENyZWF0ZSB0aGUgcmVzdWx0OiB0d28gImF2ZXJhZ2UiIGZyaWN0aW9uIGVxdWF0aW9ucwoKICAgICAgaWYgKCF0aGlzLmNyZWF0ZUZyaWN0aW9uRXF1YXRpb25zRnJvbUNvbnRhY3QoYywgdGhpcy5mcmljdGlvblJlc3VsdCkgfHwgbnVtQ29udGFjdHMgPT09IDEpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGNvbnN0IGYxID0gdGhpcy5mcmljdGlvblJlc3VsdFt0aGlzLmZyaWN0aW9uUmVzdWx0Lmxlbmd0aCAtIDJdOwogICAgICBjb25zdCBmMiA9IHRoaXMuZnJpY3Rpb25SZXN1bHRbdGhpcy5mcmljdGlvblJlc3VsdC5sZW5ndGggLSAxXTsKICAgICAgYXZlcmFnZU5vcm1hbC5zZXRaZXJvKCk7CiAgICAgIGF2ZXJhZ2VDb250YWN0UG9pbnRBLnNldFplcm8oKTsKICAgICAgYXZlcmFnZUNvbnRhY3RQb2ludEIuc2V0WmVybygpOwogICAgICBjb25zdCBib2R5QSA9IGMuYmk7CiAgICAgIGMuYmo7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gbnVtQ29udGFjdHM7IGkrKykgewogICAgICAgIGMgPSB0aGlzLnJlc3VsdFt0aGlzLnJlc3VsdC5sZW5ndGggLSAxIC0gaV07CgogICAgICAgIGlmIChjLmJpICE9PSBib2R5QSkgewogICAgICAgICAgYXZlcmFnZU5vcm1hbC52YWRkKGMubmksIGF2ZXJhZ2VOb3JtYWwpOwogICAgICAgICAgYXZlcmFnZUNvbnRhY3RQb2ludEEudmFkZChjLnJpLCBhdmVyYWdlQ29udGFjdFBvaW50QSk7CiAgICAgICAgICBhdmVyYWdlQ29udGFjdFBvaW50Qi52YWRkKGMucmosIGF2ZXJhZ2VDb250YWN0UG9pbnRCKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgYXZlcmFnZU5vcm1hbC52c3ViKGMubmksIGF2ZXJhZ2VOb3JtYWwpOwogICAgICAgICAgYXZlcmFnZUNvbnRhY3RQb2ludEEudmFkZChjLnJqLCBhdmVyYWdlQ29udGFjdFBvaW50QSk7CiAgICAgICAgICBhdmVyYWdlQ29udGFjdFBvaW50Qi52YWRkKGMucmksIGF2ZXJhZ2VDb250YWN0UG9pbnRCKTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIGNvbnN0IGludk51bUNvbnRhY3RzID0gMSAvIG51bUNvbnRhY3RzOwogICAgICBhdmVyYWdlQ29udGFjdFBvaW50QS5zY2FsZShpbnZOdW1Db250YWN0cywgZjEucmkpOwogICAgICBhdmVyYWdlQ29udGFjdFBvaW50Qi5zY2FsZShpbnZOdW1Db250YWN0cywgZjEucmopOwogICAgICBmMi5yaS5jb3B5KGYxLnJpKTsgLy8gU2hvdWxkIGJlIHRoZSBzYW1lCgogICAgICBmMi5yai5jb3B5KGYxLnJqKTsKICAgICAgYXZlcmFnZU5vcm1hbC5ub3JtYWxpemUoKTsKICAgICAgYXZlcmFnZU5vcm1hbC50YW5nZW50cyhmMS50LCBmMi50KTsgLy8gcmV0dXJuIGVxOwogICAgfQogICAgLyoqCiAgICAgKiBHZW5lcmF0ZSBhbGwgY29udGFjdHMgYmV0d2VlbiBhIGxpc3Qgb2YgYm9keSBwYWlycwogICAgICogQHBhcmFtIHAxIEFycmF5IG9mIGJvZHkgaW5kaWNlcwogICAgICogQHBhcmFtIHAyIEFycmF5IG9mIGJvZHkgaW5kaWNlcwogICAgICogQHBhcmFtIHJlc3VsdCBBcnJheSB0byBzdG9yZSBnZW5lcmF0ZWQgY29udGFjdHMKICAgICAqIEBwYXJhbSBvbGRjb250YWN0cyBPcHRpb25hbC4gQXJyYXkgb2YgcmV1c2FibGUgY29udGFjdCBvYmplY3RzCiAgICAgKi8KCgogICAgZ2V0Q29udGFjdHMocDEsIHAyLCB3b3JsZCwgcmVzdWx0LCBvbGRjb250YWN0cywgZnJpY3Rpb25SZXN1bHQsIGZyaWN0aW9uUG9vbCkgewogICAgICAvLyBTYXZlIG9sZCBjb250YWN0IG9iamVjdHMKICAgICAgdGhpcy5jb250YWN0UG9pbnRQb29sID0gb2xkY29udGFjdHM7CiAgICAgIHRoaXMuZnJpY3Rpb25FcXVhdGlvblBvb2wgPSBmcmljdGlvblBvb2w7CiAgICAgIHRoaXMucmVzdWx0ID0gcmVzdWx0OwogICAgICB0aGlzLmZyaWN0aW9uUmVzdWx0ID0gZnJpY3Rpb25SZXN1bHQ7CiAgICAgIGNvbnN0IHFpID0gdG1wUXVhdDE7CiAgICAgIGNvbnN0IHFqID0gdG1wUXVhdDI7CiAgICAgIGNvbnN0IHhpID0gdG1wVmVjMTsKICAgICAgY29uc3QgeGogPSB0bXBWZWMyOwoKICAgICAgZm9yIChsZXQgayA9IDAsIE4gPSBwMS5sZW5ndGg7IGsgIT09IE47IGsrKykgewogICAgICAgIC8vIEdldCBjdXJyZW50IGNvbGxpc2lvbiBib2RpZXMKICAgICAgICBjb25zdCBiaSA9IHAxW2tdOwogICAgICAgIGNvbnN0IGJqID0gcDJba107IC8vIEdldCBjb250YWN0IG1hdGVyaWFsCgogICAgICAgIGxldCBib2R5Q29udGFjdE1hdGVyaWFsID0gbnVsbDsKCiAgICAgICAgaWYgKGJpLm1hdGVyaWFsICYmIGJqLm1hdGVyaWFsKSB7CiAgICAgICAgICBib2R5Q29udGFjdE1hdGVyaWFsID0gd29ybGQuZ2V0Q29udGFjdE1hdGVyaWFsKGJpLm1hdGVyaWFsLCBiai5tYXRlcmlhbCkgfHwgbnVsbDsKICAgICAgICB9CgogICAgICAgIGNvbnN0IGp1c3RUZXN0ID0gYmkudHlwZSAmIEJvZHkuS0lORU1BVElDICYmIGJqLnR5cGUgJiBCb2R5LlNUQVRJQyB8fCBiaS50eXBlICYgQm9keS5TVEFUSUMgJiYgYmoudHlwZSAmIEJvZHkuS0lORU1BVElDIHx8IGJpLnR5cGUgJiBCb2R5LktJTkVNQVRJQyAmJiBiai50eXBlICYgQm9keS5LSU5FTUFUSUM7CgogICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgYmkuc2hhcGVzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICBiaS5xdWF0ZXJuaW9uLm11bHQoYmkuc2hhcGVPcmllbnRhdGlvbnNbaV0sIHFpKTsKICAgICAgICAgIGJpLnF1YXRlcm5pb24udm11bHQoYmkuc2hhcGVPZmZzZXRzW2ldLCB4aSk7CiAgICAgICAgICB4aS52YWRkKGJpLnBvc2l0aW9uLCB4aSk7CiAgICAgICAgICBjb25zdCBzaSA9IGJpLnNoYXBlc1tpXTsKCiAgICAgICAgICBmb3IgKGxldCBqID0gMDsgaiA8IGJqLnNoYXBlcy5sZW5ndGg7IGorKykgewogICAgICAgICAgICAvLyBDb21wdXRlIHdvcmxkIHRyYW5zZm9ybSBvZiBzaGFwZXMKICAgICAgICAgICAgYmoucXVhdGVybmlvbi5tdWx0KGJqLnNoYXBlT3JpZW50YXRpb25zW2pdLCBxaik7CiAgICAgICAgICAgIGJqLnF1YXRlcm5pb24udm11bHQoYmouc2hhcGVPZmZzZXRzW2pdLCB4aik7CiAgICAgICAgICAgIHhqLnZhZGQoYmoucG9zaXRpb24sIHhqKTsKICAgICAgICAgICAgY29uc3Qgc2ogPSBiai5zaGFwZXNbal07CgogICAgICAgICAgICBpZiAoIShzaS5jb2xsaXNpb25GaWx0ZXJNYXNrICYgc2ouY29sbGlzaW9uRmlsdGVyR3JvdXAgJiYgc2ouY29sbGlzaW9uRmlsdGVyTWFzayAmIHNpLmNvbGxpc2lvbkZpbHRlckdyb3VwKSkgewogICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoeGkuZGlzdGFuY2VUbyh4aikgPiBzaS5ib3VuZGluZ1NwaGVyZVJhZGl1cyArIHNqLmJvdW5kaW5nU3BoZXJlUmFkaXVzKSB7CiAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgIH0gLy8gR2V0IGNvbGxpc2lvbiBtYXRlcmlhbAoKCiAgICAgICAgICAgIGxldCBzaGFwZUNvbnRhY3RNYXRlcmlhbCA9IG51bGw7CgogICAgICAgICAgICBpZiAoc2kubWF0ZXJpYWwgJiYgc2oubWF0ZXJpYWwpIHsKICAgICAgICAgICAgICBzaGFwZUNvbnRhY3RNYXRlcmlhbCA9IHdvcmxkLmdldENvbnRhY3RNYXRlcmlhbChzaS5tYXRlcmlhbCwgc2oubWF0ZXJpYWwpIHx8IG51bGw7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHRoaXMuY3VycmVudENvbnRhY3RNYXRlcmlhbCA9IHNoYXBlQ29udGFjdE1hdGVyaWFsIHx8IGJvZHlDb250YWN0TWF0ZXJpYWwgfHwgd29ybGQuZGVmYXVsdENvbnRhY3RNYXRlcmlhbDsgLy8gR2V0IGNvbnRhY3RzCgogICAgICAgICAgICBjb25zdCByZXNvbHZlckluZGV4ID0gc2kudHlwZSB8IHNqLnR5cGU7CiAgICAgICAgICAgIGNvbnN0IHJlc29sdmVyID0gdGhpc1tyZXNvbHZlckluZGV4XTsKCiAgICAgICAgICAgIGlmIChyZXNvbHZlcikgewogICAgICAgICAgICAgIGxldCByZXR2YWwgPSBmYWxzZTsgLy8gVE8gRE86IGludmVzdGlnYXRlIHdoeSBzcGhlcmVQYXJ0aWNsZSBhbmQgY29udmV4UGFydGljbGUKICAgICAgICAgICAgICAvLyByZXNvbHZlcnMgZXhwZWN0IHNpIGFuZCBzaiBzaGFwZXMgdG8gYmUgaW4gcmV2ZXJzZSBvcmRlcgogICAgICAgICAgICAgIC8vIChpLmUuIGxhcmdlciBpbnRlZ2VyIHZhbHVlIHR5cGUgZmlyc3QgaW5zdGVhZCBvZiBzbWFsbGVyIGZpcnN0KQoKICAgICAgICAgICAgICBpZiAoc2kudHlwZSA8IHNqLnR5cGUpIHsKICAgICAgICAgICAgICAgIHJldHZhbCA9IHJlc29sdmVyLmNhbGwodGhpcywgc2ksIHNqLCB4aSwgeGosIHFpLCBxaiwgYmksIGJqLCBzaSwgc2osIGp1c3RUZXN0KTsKICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgcmV0dmFsID0gcmVzb2x2ZXIuY2FsbCh0aGlzLCBzaiwgc2ksIHhqLCB4aSwgcWosIHFpLCBiaiwgYmksIHNpLCBzaiwganVzdFRlc3QpOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgaWYgKHJldHZhbCAmJiBqdXN0VGVzdCkgewogICAgICAgICAgICAgICAgLy8gUmVnaXN0ZXIgb3ZlcmxhcAogICAgICAgICAgICAgICAgd29ybGQuc2hhcGVPdmVybGFwS2VlcGVyLnNldChzaS5pZCwgc2ouaWQpOwogICAgICAgICAgICAgICAgd29ybGQuYm9keU92ZXJsYXBLZWVwZXIuc2V0KGJpLmlkLCBiai5pZCk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICB9CgogICAgc3BoZXJlU3BoZXJlKHNpLCBzaiwgeGksIHhqLCBxaSwgcWosIGJpLCBiaiwgcnNpLCByc2osIGp1c3RUZXN0KSB7CiAgICAgIGlmIChqdXN0VGVzdCkgewogICAgICAgIHJldHVybiB4aS5kaXN0YW5jZVNxdWFyZWQoeGopIDwgKHNpLnJhZGl1cyArIHNqLnJhZGl1cykgKiogMjsKICAgICAgfSAvLyBXZSB3aWxsIGhhdmUgb25seSBvbmUgY29udGFjdCBpbiB0aGlzIGNhc2UKCgogICAgICBjb25zdCBjb250YWN0RXEgPSB0aGlzLmNyZWF0ZUNvbnRhY3RFcXVhdGlvbihiaSwgYmosIHNpLCBzaiwgcnNpLCByc2opOyAvLyBDb250YWN0IG5vcm1hbAoKICAgICAgeGoudnN1Yih4aSwgY29udGFjdEVxLm5pKTsKICAgICAgY29udGFjdEVxLm5pLm5vcm1hbGl6ZSgpOyAvLyBDb250YWN0IHBvaW50IGxvY2F0aW9ucwoKICAgICAgY29udGFjdEVxLnJpLmNvcHkoY29udGFjdEVxLm5pKTsKICAgICAgY29udGFjdEVxLnJqLmNvcHkoY29udGFjdEVxLm5pKTsKICAgICAgY29udGFjdEVxLnJpLnNjYWxlKHNpLnJhZGl1cywgY29udGFjdEVxLnJpKTsKICAgICAgY29udGFjdEVxLnJqLnNjYWxlKC1zai5yYWRpdXMsIGNvbnRhY3RFcS5yaik7CiAgICAgIGNvbnRhY3RFcS5yaS52YWRkKHhpLCBjb250YWN0RXEucmkpOwogICAgICBjb250YWN0RXEucmkudnN1YihiaS5wb3NpdGlvbiwgY29udGFjdEVxLnJpKTsKICAgICAgY29udGFjdEVxLnJqLnZhZGQoeGosIGNvbnRhY3RFcS5yaik7CiAgICAgIGNvbnRhY3RFcS5yai52c3ViKGJqLnBvc2l0aW9uLCBjb250YWN0RXEucmopOwogICAgICB0aGlzLnJlc3VsdC5wdXNoKGNvbnRhY3RFcSk7CiAgICAgIHRoaXMuY3JlYXRlRnJpY3Rpb25FcXVhdGlvbnNGcm9tQ29udGFjdChjb250YWN0RXEsIHRoaXMuZnJpY3Rpb25SZXN1bHQpOwogICAgfQoKICAgIHNwaGVyZVBsYW5lKHNpLCBzaiwgeGksIHhqLCBxaSwgcWosIGJpLCBiaiwgcnNpLCByc2osIGp1c3RUZXN0KSB7CiAgICAgIC8vIFdlIHdpbGwgaGF2ZSBvbmUgY29udGFjdCBpbiB0aGlzIGNhc2UKICAgICAgY29uc3QgciA9IHRoaXMuY3JlYXRlQ29udGFjdEVxdWF0aW9uKGJpLCBiaiwgc2ksIHNqLCByc2ksIHJzaik7IC8vIENvbnRhY3Qgbm9ybWFsCgogICAgICByLm5pLnNldCgwLCAwLCAxKTsKICAgICAgcWoudm11bHQoci5uaSwgci5uaSk7CiAgICAgIHIubmkubmVnYXRlKHIubmkpOyAvLyBib2R5IGkgaXMgdGhlIHNwaGVyZSwgZmxpcCBub3JtYWwKCiAgICAgIHIubmkubm9ybWFsaXplKCk7IC8vIE5lZWRlZD8KICAgICAgLy8gVmVjdG9yIGZyb20gc3BoZXJlIGNlbnRlciB0byBjb250YWN0IHBvaW50CgogICAgICByLm5pLnNjYWxlKHNpLnJhZGl1cywgci5yaSk7IC8vIFByb2plY3QgZG93biBzcGhlcmUgb24gcGxhbmUKCiAgICAgIHhpLnZzdWIoeGosIHBvaW50X29uX3BsYW5lX3RvX3NwaGVyZSk7CiAgICAgIHIubmkuc2NhbGUoci5uaS5kb3QocG9pbnRfb25fcGxhbmVfdG9fc3BoZXJlKSwgcGxhbmVfdG9fc3BoZXJlX29ydGhvKTsKICAgICAgcG9pbnRfb25fcGxhbmVfdG9fc3BoZXJlLnZzdWIocGxhbmVfdG9fc3BoZXJlX29ydGhvLCByLnJqKTsgLy8gVGhlIHNwaGVyZSBwb3NpdGlvbiBwcm9qZWN0ZWQgdG8gcGxhbmUKCiAgICAgIGlmICgtcG9pbnRfb25fcGxhbmVfdG9fc3BoZXJlLmRvdChyLm5pKSA8PSBzaS5yYWRpdXMpIHsKICAgICAgICBpZiAoanVzdFRlc3QpIHsKICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0gLy8gTWFrZSBpdCByZWxhdGl2ZSB0byB0aGUgYm9keQoKCiAgICAgICAgY29uc3QgcmkgPSByLnJpOwogICAgICAgIGNvbnN0IHJqID0gci5yajsKICAgICAgICByaS52YWRkKHhpLCByaSk7CiAgICAgICAgcmkudnN1YihiaS5wb3NpdGlvbiwgcmkpOwogICAgICAgIHJqLnZhZGQoeGosIHJqKTsKICAgICAgICByai52c3ViKGJqLnBvc2l0aW9uLCByaik7CiAgICAgICAgdGhpcy5yZXN1bHQucHVzaChyKTsKICAgICAgICB0aGlzLmNyZWF0ZUZyaWN0aW9uRXF1YXRpb25zRnJvbUNvbnRhY3QociwgdGhpcy5mcmljdGlvblJlc3VsdCk7CiAgICAgIH0KICAgIH0KCiAgICBib3hCb3goc2ksIHNqLCB4aSwgeGosIHFpLCBxaiwgYmksIGJqLCByc2ksIHJzaiwganVzdFRlc3QpIHsKICAgICAgc2kuY29udmV4UG9seWhlZHJvblJlcHJlc2VudGF0aW9uLm1hdGVyaWFsID0gc2kubWF0ZXJpYWw7CiAgICAgIHNqLmNvbnZleFBvbHloZWRyb25SZXByZXNlbnRhdGlvbi5tYXRlcmlhbCA9IHNqLm1hdGVyaWFsOwogICAgICBzaS5jb252ZXhQb2x5aGVkcm9uUmVwcmVzZW50YXRpb24uY29sbGlzaW9uUmVzcG9uc2UgPSBzaS5jb2xsaXNpb25SZXNwb25zZTsKICAgICAgc2ouY29udmV4UG9seWhlZHJvblJlcHJlc2VudGF0aW9uLmNvbGxpc2lvblJlc3BvbnNlID0gc2ouY29sbGlzaW9uUmVzcG9uc2U7CiAgICAgIHJldHVybiB0aGlzLmNvbnZleENvbnZleChzaS5jb252ZXhQb2x5aGVkcm9uUmVwcmVzZW50YXRpb24sIHNqLmNvbnZleFBvbHloZWRyb25SZXByZXNlbnRhdGlvbiwgeGksIHhqLCBxaSwgcWosIGJpLCBiaiwgc2ksIHNqLCBqdXN0VGVzdCk7CiAgICB9CgogICAgc3BoZXJlQm94KHNpLCBzaiwgeGksIHhqLCBxaSwgcWosIGJpLCBiaiwgcnNpLCByc2osIGp1c3RUZXN0KSB7CiAgICAgIGNvbnN0IHYzcG9vbCA9IHRoaXMudjNwb29sOyAvLyB3ZSByZWZlciB0byB0aGUgYm94IGFzIGJvZHkgagoKICAgICAgY29uc3Qgc2lkZXMgPSBzcGhlcmVCb3hfc2lkZXM7CiAgICAgIHhpLnZzdWIoeGosIGJveF90b19zcGhlcmUpOwogICAgICBzai5nZXRTaWRlTm9ybWFscyhzaWRlcywgcWopOwogICAgICBjb25zdCBSID0gc2kucmFkaXVzOwoKICAgICAgbGV0IGZvdW5kID0gZmFsc2U7IC8vIFN0b3JlIHRoZSByZXN1bHRpbmcgc2lkZSBwZW5ldHJhdGlvbiBpbmZvCgogICAgICBjb25zdCBzaWRlX25zID0gc3BoZXJlQm94X3NpZGVfbnM7CiAgICAgIGNvbnN0IHNpZGVfbnMxID0gc3BoZXJlQm94X3NpZGVfbnMxOwogICAgICBjb25zdCBzaWRlX25zMiA9IHNwaGVyZUJveF9zaWRlX25zMjsKICAgICAgbGV0IHNpZGVfaCA9IG51bGw7CiAgICAgIGxldCBzaWRlX3BlbmV0cmF0aW9ucyA9IDA7CiAgICAgIGxldCBzaWRlX2RvdDEgPSAwOwogICAgICBsZXQgc2lkZV9kb3QyID0gMDsKICAgICAgbGV0IHNpZGVfZGlzdGFuY2UgPSBudWxsOwoKICAgICAgZm9yIChsZXQgaWR4ID0gMCwgbnNpZGVzID0gc2lkZXMubGVuZ3RoOyBpZHggIT09IG5zaWRlcyAmJiBmb3VuZCA9PT0gZmFsc2U7IGlkeCsrKSB7CiAgICAgICAgLy8gR2V0IHRoZSBwbGFuZSBzaWRlIG5vcm1hbCAobnMpCiAgICAgICAgY29uc3QgbnMgPSBzcGhlcmVCb3hfbnM7CiAgICAgICAgbnMuY29weShzaWRlc1tpZHhdKTsKICAgICAgICBjb25zdCBoID0gbnMubGVuZ3RoKCk7CiAgICAgICAgbnMubm9ybWFsaXplKCk7IC8vIFRoZSBub3JtYWwvZGlzdGFuY2UgZG90IHByb2R1Y3QgdGVsbHMgd2hpY2ggc2lkZSBvZiB0aGUgcGxhbmUgd2UgYXJlCgogICAgICAgIGNvbnN0IGRvdCA9IGJveF90b19zcGhlcmUuZG90KG5zKTsKCiAgICAgICAgaWYgKGRvdCA8IGggKyBSICYmIGRvdCA+IDApIHsKICAgICAgICAgIC8vIEludGVyc2VjdHMgcGxhbmUuIE5vdyBjaGVjayB0aGUgb3RoZXIgdHdvIGRpbWVuc2lvbnMKICAgICAgICAgIGNvbnN0IG5zMSA9IHNwaGVyZUJveF9uczE7CiAgICAgICAgICBjb25zdCBuczIgPSBzcGhlcmVCb3hfbnMyOwogICAgICAgICAgbnMxLmNvcHkoc2lkZXNbKGlkeCArIDEpICUgM10pOwogICAgICAgICAgbnMyLmNvcHkoc2lkZXNbKGlkeCArIDIpICUgM10pOwogICAgICAgICAgY29uc3QgaDEgPSBuczEubGVuZ3RoKCk7CiAgICAgICAgICBjb25zdCBoMiA9IG5zMi5sZW5ndGgoKTsKICAgICAgICAgIG5zMS5ub3JtYWxpemUoKTsKICAgICAgICAgIG5zMi5ub3JtYWxpemUoKTsKICAgICAgICAgIGNvbnN0IGRvdDEgPSBib3hfdG9fc3BoZXJlLmRvdChuczEpOwogICAgICAgICAgY29uc3QgZG90MiA9IGJveF90b19zcGhlcmUuZG90KG5zMik7CgogICAgICAgICAgaWYgKGRvdDEgPCBoMSAmJiBkb3QxID4gLWgxICYmIGRvdDIgPCBoMiAmJiBkb3QyID4gLWgyKSB7CiAgICAgICAgICAgIGNvbnN0IGRpc3QgPSBNYXRoLmFicyhkb3QgLSBoIC0gUik7CgogICAgICAgICAgICBpZiAoc2lkZV9kaXN0YW5jZSA9PT0gbnVsbCB8fCBkaXN0IDwgc2lkZV9kaXN0YW5jZSkgewogICAgICAgICAgICAgIHNpZGVfZGlzdGFuY2UgPSBkaXN0OwogICAgICAgICAgICAgIHNpZGVfZG90MSA9IGRvdDE7CiAgICAgICAgICAgICAgc2lkZV9kb3QyID0gZG90MjsKICAgICAgICAgICAgICBzaWRlX2ggPSBoOwogICAgICAgICAgICAgIHNpZGVfbnMuY29weShucyk7CiAgICAgICAgICAgICAgc2lkZV9uczEuY29weShuczEpOwogICAgICAgICAgICAgIHNpZGVfbnMyLmNvcHkobnMyKTsKICAgICAgICAgICAgICBzaWRlX3BlbmV0cmF0aW9ucysrOwoKICAgICAgICAgICAgICBpZiAoanVzdFRlc3QpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQoKICAgICAgaWYgKHNpZGVfcGVuZXRyYXRpb25zKSB7CiAgICAgICAgZm91bmQgPSB0cnVlOwogICAgICAgIGNvbnN0IHIgPSB0aGlzLmNyZWF0ZUNvbnRhY3RFcXVhdGlvbihiaSwgYmosIHNpLCBzaiwgcnNpLCByc2opOwogICAgICAgIHNpZGVfbnMuc2NhbGUoLVIsIHIucmkpOyAvLyBTcGhlcmUgcgoKICAgICAgICByLm5pLmNvcHkoc2lkZV9ucyk7CiAgICAgICAgci5uaS5uZWdhdGUoci5uaSk7IC8vIE5vcm1hbCBzaG91bGQgYmUgb3V0IG9mIHNwaGVyZQoKICAgICAgICBzaWRlX25zLnNjYWxlKHNpZGVfaCwgc2lkZV9ucyk7CiAgICAgICAgc2lkZV9uczEuc2NhbGUoc2lkZV9kb3QxLCBzaWRlX25zMSk7CiAgICAgICAgc2lkZV9ucy52YWRkKHNpZGVfbnMxLCBzaWRlX25zKTsKICAgICAgICBzaWRlX25zMi5zY2FsZShzaWRlX2RvdDIsIHNpZGVfbnMyKTsKICAgICAgICBzaWRlX25zLnZhZGQoc2lkZV9uczIsIHIucmopOyAvLyBNYWtlIHJlbGF0aXZlIHRvIGJvZGllcwoKICAgICAgICByLnJpLnZhZGQoeGksIHIucmkpOwogICAgICAgIHIucmkudnN1YihiaS5wb3NpdGlvbiwgci5yaSk7CiAgICAgICAgci5yai52YWRkKHhqLCByLnJqKTsKICAgICAgICByLnJqLnZzdWIoYmoucG9zaXRpb24sIHIucmopOwogICAgICAgIHRoaXMucmVzdWx0LnB1c2gocik7CiAgICAgICAgdGhpcy5jcmVhdGVGcmljdGlvbkVxdWF0aW9uc0Zyb21Db250YWN0KHIsIHRoaXMuZnJpY3Rpb25SZXN1bHQpOwogICAgICB9IC8vIENoZWNrIGNvcm5lcnMKCgogICAgICBsZXQgcmogPSB2M3Bvb2wuZ2V0KCk7CiAgICAgIGNvbnN0IHNwaGVyZV90b19jb3JuZXIgPSBzcGhlcmVCb3hfc3BoZXJlX3RvX2Nvcm5lcjsKCiAgICAgIGZvciAobGV0IGogPSAwOyBqICE9PSAyICYmICFmb3VuZDsgaisrKSB7CiAgICAgICAgZm9yIChsZXQgayA9IDA7IGsgIT09IDIgJiYgIWZvdW5kOyBrKyspIHsKICAgICAgICAgIGZvciAobGV0IGwgPSAwOyBsICE9PSAyICYmICFmb3VuZDsgbCsrKSB7CiAgICAgICAgICAgIHJqLnNldCgwLCAwLCAwKTsKCiAgICAgICAgICAgIGlmIChqKSB7CiAgICAgICAgICAgICAgcmoudmFkZChzaWRlc1swXSwgcmopOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIHJqLnZzdWIoc2lkZXNbMF0sIHJqKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKGspIHsKICAgICAgICAgICAgICByai52YWRkKHNpZGVzWzFdLCByaik7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgcmoudnN1YihzaWRlc1sxXSwgcmopOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAobCkgewogICAgICAgICAgICAgIHJqLnZhZGQoc2lkZXNbMl0sIHJqKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICByai52c3ViKHNpZGVzWzJdLCByaik7CiAgICAgICAgICAgIH0gLy8gV29ybGQgcG9zaXRpb24gb2YgY29ybmVyCgoKICAgICAgICAgICAgeGoudmFkZChyaiwgc3BoZXJlX3RvX2Nvcm5lcik7CiAgICAgICAgICAgIHNwaGVyZV90b19jb3JuZXIudnN1Yih4aSwgc3BoZXJlX3RvX2Nvcm5lcik7CgogICAgICAgICAgICBpZiAoc3BoZXJlX3RvX2Nvcm5lci5sZW5ndGhTcXVhcmVkKCkgPCBSICogUikgewogICAgICAgICAgICAgIGlmIChqdXN0VGVzdCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBmb3VuZCA9IHRydWU7CiAgICAgICAgICAgICAgY29uc3QgciA9IHRoaXMuY3JlYXRlQ29udGFjdEVxdWF0aW9uKGJpLCBiaiwgc2ksIHNqLCByc2ksIHJzaik7CiAgICAgICAgICAgICAgci5yaS5jb3B5KHNwaGVyZV90b19jb3JuZXIpOwogICAgICAgICAgICAgIHIucmkubm9ybWFsaXplKCk7CiAgICAgICAgICAgICAgci5uaS5jb3B5KHIucmkpOwogICAgICAgICAgICAgIHIucmkuc2NhbGUoUiwgci5yaSk7CiAgICAgICAgICAgICAgci5yai5jb3B5KHJqKTsgLy8gTWFrZSByZWxhdGl2ZSB0byBib2RpZXMKCiAgICAgICAgICAgICAgci5yaS52YWRkKHhpLCByLnJpKTsKICAgICAgICAgICAgICByLnJpLnZzdWIoYmkucG9zaXRpb24sIHIucmkpOwogICAgICAgICAgICAgIHIucmoudmFkZCh4aiwgci5yaik7CiAgICAgICAgICAgICAgci5yai52c3ViKGJqLnBvc2l0aW9uLCByLnJqKTsKICAgICAgICAgICAgICB0aGlzLnJlc3VsdC5wdXNoKHIpOwogICAgICAgICAgICAgIHRoaXMuY3JlYXRlRnJpY3Rpb25FcXVhdGlvbnNGcm9tQ29udGFjdChyLCB0aGlzLmZyaWN0aW9uUmVzdWx0KTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQoKICAgICAgdjNwb29sLnJlbGVhc2UocmopOwogICAgICByaiA9IG51bGw7IC8vIENoZWNrIGVkZ2VzCgogICAgICBjb25zdCBlZGdlVGFuZ2VudCA9IHYzcG9vbC5nZXQoKTsKICAgICAgY29uc3QgZWRnZUNlbnRlciA9IHYzcG9vbC5nZXQoKTsKICAgICAgY29uc3QgciA9IHYzcG9vbC5nZXQoKTsgLy8gciA9IGVkZ2UgY2VudGVyIHRvIHNwaGVyZSBjZW50ZXIKCiAgICAgIGNvbnN0IG9ydGhvZ29uYWwgPSB2M3Bvb2wuZ2V0KCk7CiAgICAgIGNvbnN0IGRpc3QgPSB2M3Bvb2wuZ2V0KCk7CiAgICAgIGNvbnN0IE5zaWRlcyA9IHNpZGVzLmxlbmd0aDsKCiAgICAgIGZvciAobGV0IGogPSAwOyBqICE9PSBOc2lkZXMgJiYgIWZvdW5kOyBqKyspIHsKICAgICAgICBmb3IgKGxldCBrID0gMDsgayAhPT0gTnNpZGVzICYmICFmb3VuZDsgaysrKSB7CiAgICAgICAgICBpZiAoaiAlIDMgIT09IGsgJSAzKSB7CiAgICAgICAgICAgIC8vIEdldCBlZGdlIHRhbmdlbnQKICAgICAgICAgICAgc2lkZXNba10uY3Jvc3Moc2lkZXNbal0sIGVkZ2VUYW5nZW50KTsKICAgICAgICAgICAgZWRnZVRhbmdlbnQubm9ybWFsaXplKCk7CiAgICAgICAgICAgIHNpZGVzW2pdLnZhZGQoc2lkZXNba10sIGVkZ2VDZW50ZXIpOwogICAgICAgICAgICByLmNvcHkoeGkpOwogICAgICAgICAgICByLnZzdWIoZWRnZUNlbnRlciwgcik7CiAgICAgICAgICAgIHIudnN1Yih4aiwgcik7CiAgICAgICAgICAgIGNvbnN0IG9ydGhvbm9ybSA9IHIuZG90KGVkZ2VUYW5nZW50KTsgLy8gZGlzdGFuY2UgZnJvbSBlZGdlIGNlbnRlciB0byBzcGhlcmUgY2VudGVyIGluIHRoZSB0YW5nZW50IGRpcmVjdGlvbgoKICAgICAgICAgICAgZWRnZVRhbmdlbnQuc2NhbGUob3J0aG9ub3JtLCBvcnRob2dvbmFsKTsgLy8gVmVjdG9yIGZyb20gZWRnZSBjZW50ZXIgdG8gc3BoZXJlIGNlbnRlciBpbiB0aGUgdGFuZ2VudCBkaXJlY3Rpb24KICAgICAgICAgICAgLy8gRmluZCB0aGUgdGhpcmQgc2lkZSBvcnRob2dvbmFsIHRvIHRoaXMgb25lCgogICAgICAgICAgICBsZXQgbCA9IDA7CgogICAgICAgICAgICB3aGlsZSAobCA9PT0gaiAlIDMgfHwgbCA9PT0gayAlIDMpIHsKICAgICAgICAgICAgICBsKys7CiAgICAgICAgICAgIH0gLy8gdmVjIGZyb20gZWRnZSBjZW50ZXIgdG8gc3BoZXJlIHByb2plY3RlZCB0byB0aGUgcGxhbmUgb3J0aG9nb25hbCB0byB0aGUgZWRnZSB0YW5nZW50CgoKICAgICAgICAgICAgZGlzdC5jb3B5KHhpKTsKICAgICAgICAgICAgZGlzdC52c3ViKG9ydGhvZ29uYWwsIGRpc3QpOwogICAgICAgICAgICBkaXN0LnZzdWIoZWRnZUNlbnRlciwgZGlzdCk7CiAgICAgICAgICAgIGRpc3QudnN1Yih4aiwgZGlzdCk7IC8vIERpc3RhbmNlcyBpbiB0YW5nZW50IGRpcmVjdGlvbiBhbmQgZGlzdGFuY2UgaW4gdGhlIHBsYW5lIG9ydGhvZ29uYWwgdG8gaXQKCiAgICAgICAgICAgIGNvbnN0IHRkaXN0ID0gTWF0aC5hYnMob3J0aG9ub3JtKTsKICAgICAgICAgICAgY29uc3QgbmRpc3QgPSBkaXN0Lmxlbmd0aCgpOwoKICAgICAgICAgICAgaWYgKHRkaXN0IDwgc2lkZXNbbF0ubGVuZ3RoKCkgJiYgbmRpc3QgPCBSKSB7CiAgICAgICAgICAgICAgaWYgKGp1c3RUZXN0KSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIGZvdW5kID0gdHJ1ZTsKICAgICAgICAgICAgICBjb25zdCByZXMgPSB0aGlzLmNyZWF0ZUNvbnRhY3RFcXVhdGlvbihiaSwgYmosIHNpLCBzaiwgcnNpLCByc2opOwogICAgICAgICAgICAgIGVkZ2VDZW50ZXIudmFkZChvcnRob2dvbmFsLCByZXMucmopOyAvLyBib3ggcmoKCiAgICAgICAgICAgICAgcmVzLnJqLmNvcHkocmVzLnJqKTsKICAgICAgICAgICAgICBkaXN0Lm5lZ2F0ZShyZXMubmkpOwogICAgICAgICAgICAgIHJlcy5uaS5ub3JtYWxpemUoKTsKICAgICAgICAgICAgICByZXMucmkuY29weShyZXMucmopOwogICAgICAgICAgICAgIHJlcy5yaS52YWRkKHhqLCByZXMucmkpOwogICAgICAgICAgICAgIHJlcy5yaS52c3ViKHhpLCByZXMucmkpOwogICAgICAgICAgICAgIHJlcy5yaS5ub3JtYWxpemUoKTsKICAgICAgICAgICAgICByZXMucmkuc2NhbGUoUiwgcmVzLnJpKTsgLy8gTWFrZSByZWxhdGl2ZSB0byBib2RpZXMKCiAgICAgICAgICAgICAgcmVzLnJpLnZhZGQoeGksIHJlcy5yaSk7CiAgICAgICAgICAgICAgcmVzLnJpLnZzdWIoYmkucG9zaXRpb24sIHJlcy5yaSk7CiAgICAgICAgICAgICAgcmVzLnJqLnZhZGQoeGosIHJlcy5yaik7CiAgICAgICAgICAgICAgcmVzLnJqLnZzdWIoYmoucG9zaXRpb24sIHJlcy5yaik7CiAgICAgICAgICAgICAgdGhpcy5yZXN1bHQucHVzaChyZXMpOwogICAgICAgICAgICAgIHRoaXMuY3JlYXRlRnJpY3Rpb25FcXVhdGlvbnNGcm9tQ29udGFjdChyZXMsIHRoaXMuZnJpY3Rpb25SZXN1bHQpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CgogICAgICB2M3Bvb2wucmVsZWFzZShlZGdlVGFuZ2VudCwgZWRnZUNlbnRlciwgciwgb3J0aG9nb25hbCwgZGlzdCk7CiAgICB9CgogICAgcGxhbmVCb3goc2ksIHNqLCB4aSwgeGosIHFpLCBxaiwgYmksIGJqLCByc2ksIHJzaiwganVzdFRlc3QpIHsKICAgICAgc2ouY29udmV4UG9seWhlZHJvblJlcHJlc2VudGF0aW9uLm1hdGVyaWFsID0gc2oubWF0ZXJpYWw7CiAgICAgIHNqLmNvbnZleFBvbHloZWRyb25SZXByZXNlbnRhdGlvbi5jb2xsaXNpb25SZXNwb25zZSA9IHNqLmNvbGxpc2lvblJlc3BvbnNlOwogICAgICBzai5jb252ZXhQb2x5aGVkcm9uUmVwcmVzZW50YXRpb24uaWQgPSBzai5pZDsKICAgICAgcmV0dXJuIHRoaXMucGxhbmVDb252ZXgoc2ksIHNqLmNvbnZleFBvbHloZWRyb25SZXByZXNlbnRhdGlvbiwgeGksIHhqLCBxaSwgcWosIGJpLCBiaiwgc2ksIHNqLCBqdXN0VGVzdCk7CiAgICB9CgogICAgY29udmV4Q29udmV4KHNpLCBzaiwgeGksIHhqLCBxaSwgcWosIGJpLCBiaiwgcnNpLCByc2osIGp1c3RUZXN0LCBmYWNlTGlzdEEsIGZhY2VMaXN0QikgewogICAgICBjb25zdCBzZXBBeGlzID0gY29udmV4Q29udmV4X3NlcEF4aXM7CgogICAgICBpZiAoeGkuZGlzdGFuY2VUbyh4aikgPiBzaS5ib3VuZGluZ1NwaGVyZVJhZGl1cyArIHNqLmJvdW5kaW5nU3BoZXJlUmFkaXVzKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICBpZiAoc2kuZmluZFNlcGFyYXRpbmdBeGlzKHNqLCB4aSwgcWksIHhqLCBxaiwgc2VwQXhpcywgZmFjZUxpc3RBLCBmYWNlTGlzdEIpKSB7CiAgICAgICAgY29uc3QgcmVzID0gW107CiAgICAgICAgY29uc3QgcSA9IGNvbnZleENvbnZleF9xOwogICAgICAgIHNpLmNsaXBBZ2FpbnN0SHVsbCh4aSwgcWksIHNqLCB4aiwgcWosIHNlcEF4aXMsIC0xMDAsIDEwMCwgcmVzKTsKICAgICAgICBsZXQgbnVtQ29udGFjdHMgPSAwOwoKICAgICAgICBmb3IgKGxldCBqID0gMDsgaiAhPT0gcmVzLmxlbmd0aDsgaisrKSB7CiAgICAgICAgICBpZiAoanVzdFRlc3QpIHsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICB9CgogICAgICAgICAgY29uc3QgciA9IHRoaXMuY3JlYXRlQ29udGFjdEVxdWF0aW9uKGJpLCBiaiwgc2ksIHNqLCByc2ksIHJzaik7CiAgICAgICAgICBjb25zdCByaSA9IHIucmk7CiAgICAgICAgICBjb25zdCByaiA9IHIucmo7CiAgICAgICAgICBzZXBBeGlzLm5lZ2F0ZShyLm5pKTsKICAgICAgICAgIHJlc1tqXS5ub3JtYWwubmVnYXRlKHEpOwogICAgICAgICAgcS5zY2FsZShyZXNbal0uZGVwdGgsIHEpOwogICAgICAgICAgcmVzW2pdLnBvaW50LnZhZGQocSwgcmkpOwogICAgICAgICAgcmouY29weShyZXNbal0ucG9pbnQpOyAvLyBDb250YWN0IHBvaW50cyBhcmUgaW4gd29ybGQgY29vcmRpbmF0ZXMuIFRyYW5zZm9ybSBiYWNrIHRvIHJlbGF0aXZlCgogICAgICAgICAgcmkudnN1Yih4aSwgcmkpOwogICAgICAgICAgcmoudnN1Yih4aiwgcmopOyAvLyBNYWtlIHJlbGF0aXZlIHRvIGJvZGllcwoKICAgICAgICAgIHJpLnZhZGQoeGksIHJpKTsKICAgICAgICAgIHJpLnZzdWIoYmkucG9zaXRpb24sIHJpKTsKICAgICAgICAgIHJqLnZhZGQoeGosIHJqKTsKICAgICAgICAgIHJqLnZzdWIoYmoucG9zaXRpb24sIHJqKTsKICAgICAgICAgIHRoaXMucmVzdWx0LnB1c2gocik7CiAgICAgICAgICBudW1Db250YWN0cysrOwoKICAgICAgICAgIGlmICghdGhpcy5lbmFibGVGcmljdGlvblJlZHVjdGlvbikgewogICAgICAgICAgICB0aGlzLmNyZWF0ZUZyaWN0aW9uRXF1YXRpb25zRnJvbUNvbnRhY3QociwgdGhpcy5mcmljdGlvblJlc3VsdCk7CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBpZiAodGhpcy5lbmFibGVGcmljdGlvblJlZHVjdGlvbiAmJiBudW1Db250YWN0cykgewogICAgICAgICAgdGhpcy5jcmVhdGVGcmljdGlvbkZyb21BdmVyYWdlKG51bUNvbnRhY3RzKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KCiAgICBzcGhlcmVDb252ZXgoc2ksIHNqLCB4aSwgeGosIHFpLCBxaiwgYmksIGJqLCByc2ksIHJzaiwganVzdFRlc3QpIHsKICAgICAgY29uc3QgdjNwb29sID0gdGhpcy52M3Bvb2w7CiAgICAgIHhpLnZzdWIoeGosIGNvbnZleF90b19zcGhlcmUpOwogICAgICBjb25zdCBub3JtYWxzID0gc2ouZmFjZU5vcm1hbHM7CiAgICAgIGNvbnN0IGZhY2VzID0gc2ouZmFjZXM7CiAgICAgIGNvbnN0IHZlcnRzID0gc2oudmVydGljZXM7CiAgICAgIGNvbnN0IFIgPSBzaS5yYWRpdXM7CiAgICAgIC8vICAgICByZXR1cm47CiAgICAgIC8vIH0KCiAgICAgIGxldCBmb3VuZCA9IGZhbHNlOyAvLyBDaGVjayBjb3JuZXJzCgogICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gdmVydHMubGVuZ3RoOyBpKyspIHsKICAgICAgICBjb25zdCB2ID0gdmVydHNbaV07IC8vIFdvcmxkIHBvc2l0aW9uIG9mIGNvcm5lcgoKICAgICAgICBjb25zdCB3b3JsZENvcm5lciA9IHNwaGVyZUNvbnZleF93b3JsZENvcm5lcjsKICAgICAgICBxai52bXVsdCh2LCB3b3JsZENvcm5lcik7CiAgICAgICAgeGoudmFkZCh3b3JsZENvcm5lciwgd29ybGRDb3JuZXIpOwogICAgICAgIGNvbnN0IHNwaGVyZV90b19jb3JuZXIgPSBzcGhlcmVDb252ZXhfc3BoZXJlVG9Db3JuZXI7CiAgICAgICAgd29ybGRDb3JuZXIudnN1Yih4aSwgc3BoZXJlX3RvX2Nvcm5lcik7CgogICAgICAgIGlmIChzcGhlcmVfdG9fY29ybmVyLmxlbmd0aFNxdWFyZWQoKSA8IFIgKiBSKSB7CiAgICAgICAgICBpZiAoanVzdFRlc3QpIHsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICB9CgogICAgICAgICAgZm91bmQgPSB0cnVlOwogICAgICAgICAgY29uc3QgciA9IHRoaXMuY3JlYXRlQ29udGFjdEVxdWF0aW9uKGJpLCBiaiwgc2ksIHNqLCByc2ksIHJzaik7CiAgICAgICAgICByLnJpLmNvcHkoc3BoZXJlX3RvX2Nvcm5lcik7CiAgICAgICAgICByLnJpLm5vcm1hbGl6ZSgpOwogICAgICAgICAgci5uaS5jb3B5KHIucmkpOwogICAgICAgICAgci5yaS5zY2FsZShSLCByLnJpKTsKICAgICAgICAgIHdvcmxkQ29ybmVyLnZzdWIoeGosIHIucmopOyAvLyBTaG91bGQgYmUgcmVsYXRpdmUgdG8gdGhlIGJvZHkuCgogICAgICAgICAgci5yaS52YWRkKHhpLCByLnJpKTsKICAgICAgICAgIHIucmkudnN1YihiaS5wb3NpdGlvbiwgci5yaSk7IC8vIFNob3VsZCBiZSByZWxhdGl2ZSB0byB0aGUgYm9keS4KCiAgICAgICAgICByLnJqLnZhZGQoeGosIHIucmopOwogICAgICAgICAgci5yai52c3ViKGJqLnBvc2l0aW9uLCByLnJqKTsKICAgICAgICAgIHRoaXMucmVzdWx0LnB1c2gocik7CiAgICAgICAgICB0aGlzLmNyZWF0ZUZyaWN0aW9uRXF1YXRpb25zRnJvbUNvbnRhY3QociwgdGhpcy5mcmljdGlvblJlc3VsdCk7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICB9IC8vIENoZWNrIHNpZGUgKHBsYW5lKSBpbnRlcnNlY3Rpb25zCgoKICAgICAgZm9yIChsZXQgaSA9IDAsIG5mYWNlcyA9IGZhY2VzLmxlbmd0aDsgaSAhPT0gbmZhY2VzICYmIGZvdW5kID09PSBmYWxzZTsgaSsrKSB7CiAgICAgICAgY29uc3Qgbm9ybWFsID0gbm9ybWFsc1tpXTsKICAgICAgICBjb25zdCBmYWNlID0gZmFjZXNbaV07IC8vIEdldCB3b3JsZC10cmFuc2Zvcm1lZCBub3JtYWwgb2YgdGhlIGZhY2UKCiAgICAgICAgY29uc3Qgd29ybGROb3JtYWwgPSBzcGhlcmVDb252ZXhfd29ybGROb3JtYWw7CiAgICAgICAgcWoudm11bHQobm9ybWFsLCB3b3JsZE5vcm1hbCk7IC8vIEdldCBhIHdvcmxkIHZlcnRleCBmcm9tIHRoZSBmYWNlCgogICAgICAgIGNvbnN0IHdvcmxkUG9pbnQgPSBzcGhlcmVDb252ZXhfd29ybGRQb2ludDsKICAgICAgICBxai52bXVsdCh2ZXJ0c1tmYWNlWzBdXSwgd29ybGRQb2ludCk7CiAgICAgICAgd29ybGRQb2ludC52YWRkKHhqLCB3b3JsZFBvaW50KTsgLy8gR2V0IGEgcG9pbnQgb24gdGhlIHNwaGVyZSwgY2xvc2VzdCB0byB0aGUgZmFjZSBub3JtYWwKCiAgICAgICAgY29uc3Qgd29ybGRTcGhlcmVQb2ludENsb3Nlc3RUb1BsYW5lID0gc3BoZXJlQ29udmV4X3dvcmxkU3BoZXJlUG9pbnRDbG9zZXN0VG9QbGFuZTsKICAgICAgICB3b3JsZE5vcm1hbC5zY2FsZSgtUiwgd29ybGRTcGhlcmVQb2ludENsb3Nlc3RUb1BsYW5lKTsKICAgICAgICB4aS52YWRkKHdvcmxkU3BoZXJlUG9pbnRDbG9zZXN0VG9QbGFuZSwgd29ybGRTcGhlcmVQb2ludENsb3Nlc3RUb1BsYW5lKTsgLy8gVmVjdG9yIGZyb20gYSBmYWNlIHBvaW50IHRvIHRoZSBjbG9zZXN0IHBvaW50IG9uIHRoZSBzcGhlcmUKCiAgICAgICAgY29uc3QgcGVuZXRyYXRpb25WZWMgPSBzcGhlcmVDb252ZXhfcGVuZXRyYXRpb25WZWM7CiAgICAgICAgd29ybGRTcGhlcmVQb2ludENsb3Nlc3RUb1BsYW5lLnZzdWIod29ybGRQb2ludCwgcGVuZXRyYXRpb25WZWMpOyAvLyBUaGUgcGVuZXRyYXRpb24uIE5lZ2F0aXZlIHZhbHVlIG1lYW5zIG92ZXJsYXAuCgogICAgICAgIGNvbnN0IHBlbmV0cmF0aW9uID0gcGVuZXRyYXRpb25WZWMuZG90KHdvcmxkTm9ybWFsKTsKICAgICAgICBjb25zdCB3b3JsZFBvaW50VG9TcGhlcmUgPSBzcGhlcmVDb252ZXhfc3BoZXJlVG9Xb3JsZFBvaW50OwogICAgICAgIHhpLnZzdWIod29ybGRQb2ludCwgd29ybGRQb2ludFRvU3BoZXJlKTsKCiAgICAgICAgaWYgKHBlbmV0cmF0aW9uIDwgMCAmJiB3b3JsZFBvaW50VG9TcGhlcmUuZG90KHdvcmxkTm9ybWFsKSA+IDApIHsKICAgICAgICAgIC8vIEludGVyc2VjdHMgcGxhbmUuIE5vdyBjaGVjayBpZiB0aGUgc3BoZXJlIGlzIGluc2lkZSB0aGUgZmFjZSBwb2x5Z29uCiAgICAgICAgICBjb25zdCBmYWNlVmVydHMgPSBbXTsgLy8gRmFjZSB2ZXJ0aWNlcywgaW4gd29ybGQgY29vcmRzCgogICAgICAgICAgZm9yIChsZXQgaiA9IDAsIE52ZXJ0cyA9IGZhY2UubGVuZ3RoOyBqICE9PSBOdmVydHM7IGorKykgewogICAgICAgICAgICBjb25zdCB3b3JsZFZlcnRleCA9IHYzcG9vbC5nZXQoKTsKICAgICAgICAgICAgcWoudm11bHQodmVydHNbZmFjZVtqXV0sIHdvcmxkVmVydGV4KTsKICAgICAgICAgICAgeGoudmFkZCh3b3JsZFZlcnRleCwgd29ybGRWZXJ0ZXgpOwogICAgICAgICAgICBmYWNlVmVydHMucHVzaCh3b3JsZFZlcnRleCk7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKHBvaW50SW5Qb2x5Z29uKGZhY2VWZXJ0cywgd29ybGROb3JtYWwsIHhpKSkgewogICAgICAgICAgICAvLyBJcyB0aGUgc3BoZXJlIGNlbnRlciBpbiB0aGUgZmFjZSBwb2x5Z29uPwogICAgICAgICAgICBpZiAoanVzdFRlc3QpIHsKICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgZm91bmQgPSB0cnVlOwogICAgICAgICAgICBjb25zdCByID0gdGhpcy5jcmVhdGVDb250YWN0RXF1YXRpb24oYmksIGJqLCBzaSwgc2osIHJzaSwgcnNqKTsKICAgICAgICAgICAgd29ybGROb3JtYWwuc2NhbGUoLVIsIHIucmkpOyAvLyBDb250YWN0IG9mZnNldCwgZnJvbSBzcGhlcmUgY2VudGVyIHRvIGNvbnRhY3QKCiAgICAgICAgICAgIHdvcmxkTm9ybWFsLm5lZ2F0ZShyLm5pKTsgLy8gTm9ybWFsIHBvaW50aW5nIG91dCBvZiBzcGhlcmUKCiAgICAgICAgICAgIGNvbnN0IHBlbmV0cmF0aW9uVmVjMiA9IHYzcG9vbC5nZXQoKTsKICAgICAgICAgICAgd29ybGROb3JtYWwuc2NhbGUoLXBlbmV0cmF0aW9uLCBwZW5ldHJhdGlvblZlYzIpOwogICAgICAgICAgICBjb25zdCBwZW5ldHJhdGlvblNwaGVyZVBvaW50ID0gdjNwb29sLmdldCgpOwogICAgICAgICAgICB3b3JsZE5vcm1hbC5zY2FsZSgtUiwgcGVuZXRyYXRpb25TcGhlcmVQb2ludCk7IC8veGkudnN1Yih4aikudmFkZChwZW5ldHJhdGlvblNwaGVyZVBvaW50KS52YWRkKHBlbmV0cmF0aW9uVmVjMiAsIHIucmopOwoKICAgICAgICAgICAgeGkudnN1Yih4aiwgci5yaik7CiAgICAgICAgICAgIHIucmoudmFkZChwZW5ldHJhdGlvblNwaGVyZVBvaW50LCByLnJqKTsKICAgICAgICAgICAgci5yai52YWRkKHBlbmV0cmF0aW9uVmVjMiwgci5yaik7IC8vIFNob3VsZCBiZSByZWxhdGl2ZSB0byB0aGUgYm9keS4KCiAgICAgICAgICAgIHIucmoudmFkZCh4aiwgci5yaik7CiAgICAgICAgICAgIHIucmoudnN1Yihiai5wb3NpdGlvbiwgci5yaik7IC8vIFNob3VsZCBiZSByZWxhdGl2ZSB0byB0aGUgYm9keS4KCiAgICAgICAgICAgIHIucmkudmFkZCh4aSwgci5yaSk7CiAgICAgICAgICAgIHIucmkudnN1YihiaS5wb3NpdGlvbiwgci5yaSk7CiAgICAgICAgICAgIHYzcG9vbC5yZWxlYXNlKHBlbmV0cmF0aW9uVmVjMik7CiAgICAgICAgICAgIHYzcG9vbC5yZWxlYXNlKHBlbmV0cmF0aW9uU3BoZXJlUG9pbnQpOwogICAgICAgICAgICB0aGlzLnJlc3VsdC5wdXNoKHIpOwogICAgICAgICAgICB0aGlzLmNyZWF0ZUZyaWN0aW9uRXF1YXRpb25zRnJvbUNvbnRhY3QociwgdGhpcy5mcmljdGlvblJlc3VsdCk7IC8vIFJlbGVhc2Ugd29ybGQgdmVydGljZXMKCiAgICAgICAgICAgIGZvciAobGV0IGogPSAwLCBOZmFjZXZlcnRzID0gZmFjZVZlcnRzLmxlbmd0aDsgaiAhPT0gTmZhY2V2ZXJ0czsgaisrKSB7CiAgICAgICAgICAgICAgdjNwb29sLnJlbGVhc2UoZmFjZVZlcnRzW2pdKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuOyAvLyBXZSBvbmx5IGV4cGVjdCAqb25lKiBmYWNlIGNvbnRhY3QKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIC8vIEVkZ2U/CiAgICAgICAgICAgIGZvciAobGV0IGogPSAwOyBqICE9PSBmYWNlLmxlbmd0aDsgaisrKSB7CiAgICAgICAgICAgICAgLy8gR2V0IHR3byB3b3JsZCB0cmFuc2Zvcm1lZCB2ZXJ0aWNlcwogICAgICAgICAgICAgIGNvbnN0IHYxID0gdjNwb29sLmdldCgpOwogICAgICAgICAgICAgIGNvbnN0IHYyID0gdjNwb29sLmdldCgpOwogICAgICAgICAgICAgIHFqLnZtdWx0KHZlcnRzW2ZhY2VbKGogKyAxKSAlIGZhY2UubGVuZ3RoXV0sIHYxKTsKICAgICAgICAgICAgICBxai52bXVsdCh2ZXJ0c1tmYWNlWyhqICsgMikgJSBmYWNlLmxlbmd0aF1dLCB2Mik7CiAgICAgICAgICAgICAgeGoudmFkZCh2MSwgdjEpOwogICAgICAgICAgICAgIHhqLnZhZGQodjIsIHYyKTsgLy8gQ29uc3RydWN0IGVkZ2UgdmVjdG9yCgogICAgICAgICAgICAgIGNvbnN0IGVkZ2UgPSBzcGhlcmVDb252ZXhfZWRnZTsKICAgICAgICAgICAgICB2Mi52c3ViKHYxLCBlZGdlKTsgLy8gQ29uc3RydWN0IHRoZSBzYW1lIHZlY3RvciwgYnV0IG5vcm1hbGl6ZWQKCiAgICAgICAgICAgICAgY29uc3QgZWRnZVVuaXQgPSBzcGhlcmVDb252ZXhfZWRnZVVuaXQ7CiAgICAgICAgICAgICAgZWRnZS51bml0KGVkZ2VVbml0KTsgLy8gcCBpcyB4aSBwcm9qZWN0ZWQgb250byB0aGUgZWRnZQoKICAgICAgICAgICAgICBjb25zdCBwID0gdjNwb29sLmdldCgpOwogICAgICAgICAgICAgIGNvbnN0IHYxX3RvX3hpID0gdjNwb29sLmdldCgpOwogICAgICAgICAgICAgIHhpLnZzdWIodjEsIHYxX3RvX3hpKTsKICAgICAgICAgICAgICBjb25zdCBkb3QgPSB2MV90b194aS5kb3QoZWRnZVVuaXQpOwogICAgICAgICAgICAgIGVkZ2VVbml0LnNjYWxlKGRvdCwgcCk7CiAgICAgICAgICAgICAgcC52YWRkKHYxLCBwKTsgLy8gQ29tcHV0ZSBhIHZlY3RvciBmcm9tIHAgdG8gdGhlIGNlbnRlciBvZiB0aGUgc3BoZXJlCgogICAgICAgICAgICAgIGNvbnN0IHhpX3RvX3AgPSB2M3Bvb2wuZ2V0KCk7CiAgICAgICAgICAgICAgcC52c3ViKHhpLCB4aV90b19wKTsgLy8gQ29sbGlzaW9uIGlmIHRoZSBlZGdlLXNwaGVyZSBkaXN0YW5jZSBpcyBsZXNzIHRoYW4gdGhlIHJhZGl1cwogICAgICAgICAgICAgIC8vIEFORCBpZiBwIGlzIGluIGJldHdlZW4gdjEgYW5kIHYyCgogICAgICAgICAgICAgIGlmIChkb3QgPiAwICYmIGRvdCAqIGRvdCA8IGVkZ2UubGVuZ3RoU3F1YXJlZCgpICYmIHhpX3RvX3AubGVuZ3RoU3F1YXJlZCgpIDwgUiAqIFIpIHsKICAgICAgICAgICAgICAgIC8vIENvbGxpc2lvbiBpZiB0aGUgZWRnZS1zcGhlcmUgZGlzdGFuY2UgaXMgbGVzcyB0aGFuIHRoZSByYWRpdXMKICAgICAgICAgICAgICAgIC8vIEVkZ2UgY29udGFjdCEKICAgICAgICAgICAgICAgIGlmIChqdXN0VGVzdCkgewogICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBjb25zdCByID0gdGhpcy5jcmVhdGVDb250YWN0RXF1YXRpb24oYmksIGJqLCBzaSwgc2osIHJzaSwgcnNqKTsKICAgICAgICAgICAgICAgIHAudnN1Yih4aiwgci5yaik7CiAgICAgICAgICAgICAgICBwLnZzdWIoeGksIHIubmkpOwogICAgICAgICAgICAgICAgci5uaS5ub3JtYWxpemUoKTsKICAgICAgICAgICAgICAgIHIubmkuc2NhbGUoUiwgci5yaSk7IC8vIFNob3VsZCBiZSByZWxhdGl2ZSB0byB0aGUgYm9keS4KCiAgICAgICAgICAgICAgICByLnJqLnZhZGQoeGosIHIucmopOwogICAgICAgICAgICAgICAgci5yai52c3ViKGJqLnBvc2l0aW9uLCByLnJqKTsgLy8gU2hvdWxkIGJlIHJlbGF0aXZlIHRvIHRoZSBib2R5LgoKICAgICAgICAgICAgICAgIHIucmkudmFkZCh4aSwgci5yaSk7CiAgICAgICAgICAgICAgICByLnJpLnZzdWIoYmkucG9zaXRpb24sIHIucmkpOwogICAgICAgICAgICAgICAgdGhpcy5yZXN1bHQucHVzaChyKTsKICAgICAgICAgICAgICAgIHRoaXMuY3JlYXRlRnJpY3Rpb25FcXVhdGlvbnNGcm9tQ29udGFjdChyLCB0aGlzLmZyaWN0aW9uUmVzdWx0KTsgLy8gUmVsZWFzZSB3b3JsZCB2ZXJ0aWNlcwoKICAgICAgICAgICAgICAgIGZvciAobGV0IGogPSAwLCBOZmFjZXZlcnRzID0gZmFjZVZlcnRzLmxlbmd0aDsgaiAhPT0gTmZhY2V2ZXJ0czsgaisrKSB7CiAgICAgICAgICAgICAgICAgIHYzcG9vbC5yZWxlYXNlKGZhY2VWZXJ0c1tqXSk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgdjNwb29sLnJlbGVhc2UodjEpOwogICAgICAgICAgICAgICAgdjNwb29sLnJlbGVhc2UodjIpOwogICAgICAgICAgICAgICAgdjNwb29sLnJlbGVhc2UocCk7CiAgICAgICAgICAgICAgICB2M3Bvb2wucmVsZWFzZSh4aV90b19wKTsKICAgICAgICAgICAgICAgIHYzcG9vbC5yZWxlYXNlKHYxX3RvX3hpKTsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIHYzcG9vbC5yZWxlYXNlKHYxKTsKICAgICAgICAgICAgICB2M3Bvb2wucmVsZWFzZSh2Mik7CiAgICAgICAgICAgICAgdjNwb29sLnJlbGVhc2UocCk7CiAgICAgICAgICAgICAgdjNwb29sLnJlbGVhc2UoeGlfdG9fcCk7CiAgICAgICAgICAgICAgdjNwb29sLnJlbGVhc2UodjFfdG9feGkpOwogICAgICAgICAgICB9CiAgICAgICAgICB9IC8vIFJlbGVhc2Ugd29ybGQgdmVydGljZXMKCgogICAgICAgICAgZm9yIChsZXQgaiA9IDAsIE5mYWNldmVydHMgPSBmYWNlVmVydHMubGVuZ3RoOyBqICE9PSBOZmFjZXZlcnRzOyBqKyspIHsKICAgICAgICAgICAgdjNwb29sLnJlbGVhc2UoZmFjZVZlcnRzW2pdKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgIH0KCiAgICBwbGFuZUNvbnZleChwbGFuZVNoYXBlLCBjb252ZXhTaGFwZSwgcGxhbmVQb3NpdGlvbiwgY29udmV4UG9zaXRpb24sIHBsYW5lUXVhdCwgY29udmV4UXVhdCwgcGxhbmVCb2R5LCBjb252ZXhCb2R5LCBzaSwgc2osIGp1c3RUZXN0KSB7CiAgICAgIC8vIFNpbXBseSByZXR1cm4gdGhlIHBvaW50cyBiZWhpbmQgdGhlIHBsYW5lLgogICAgICBjb25zdCB3b3JsZFZlcnRleCA9IHBsYW5lQ29udmV4X3Y7CiAgICAgIGNvbnN0IHdvcmxkTm9ybWFsID0gcGxhbmVDb252ZXhfbm9ybWFsOwogICAgICB3b3JsZE5vcm1hbC5zZXQoMCwgMCwgMSk7CiAgICAgIHBsYW5lUXVhdC52bXVsdCh3b3JsZE5vcm1hbCwgd29ybGROb3JtYWwpOyAvLyBUdXJuIG5vcm1hbCBhY2NvcmRpbmcgdG8gcGxhbmUgb3JpZW50YXRpb24KCiAgICAgIGxldCBudW1Db250YWN0cyA9IDA7CiAgICAgIGNvbnN0IHJlbHBvcyA9IHBsYW5lQ29udmV4X3JlbHBvczsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpICE9PSBjb252ZXhTaGFwZS52ZXJ0aWNlcy5sZW5ndGg7IGkrKykgewogICAgICAgIC8vIEdldCB3b3JsZCBjb252ZXggdmVydGV4CiAgICAgICAgd29ybGRWZXJ0ZXguY29weShjb252ZXhTaGFwZS52ZXJ0aWNlc1tpXSk7CiAgICAgICAgY29udmV4UXVhdC52bXVsdCh3b3JsZFZlcnRleCwgd29ybGRWZXJ0ZXgpOwogICAgICAgIGNvbnZleFBvc2l0aW9uLnZhZGQod29ybGRWZXJ0ZXgsIHdvcmxkVmVydGV4KTsKICAgICAgICB3b3JsZFZlcnRleC52c3ViKHBsYW5lUG9zaXRpb24sIHJlbHBvcyk7CiAgICAgICAgY29uc3QgZG90ID0gd29ybGROb3JtYWwuZG90KHJlbHBvcyk7CgogICAgICAgIGlmIChkb3QgPD0gMC4wKSB7CiAgICAgICAgICBpZiAoanVzdFRlc3QpIHsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICB9CgogICAgICAgICAgY29uc3QgciA9IHRoaXMuY3JlYXRlQ29udGFjdEVxdWF0aW9uKHBsYW5lQm9keSwgY29udmV4Qm9keSwgcGxhbmVTaGFwZSwgY29udmV4U2hhcGUsIHNpLCBzaik7IC8vIEdldCB2ZXJ0ZXggcG9zaXRpb24gcHJvamVjdGVkIG9uIHBsYW5lCgogICAgICAgICAgY29uc3QgcHJvamVjdGVkID0gcGxhbmVDb252ZXhfcHJvamVjdGVkOwogICAgICAgICAgd29ybGROb3JtYWwuc2NhbGUod29ybGROb3JtYWwuZG90KHJlbHBvcyksIHByb2plY3RlZCk7CiAgICAgICAgICB3b3JsZFZlcnRleC52c3ViKHByb2plY3RlZCwgcHJvamVjdGVkKTsKICAgICAgICAgIHByb2plY3RlZC52c3ViKHBsYW5lUG9zaXRpb24sIHIucmkpOyAvLyBGcm9tIHBsYW5lIHRvIHZlcnRleCBwcm9qZWN0ZWQgb24gcGxhbmUKCiAgICAgICAgICByLm5pLmNvcHkod29ybGROb3JtYWwpOyAvLyBDb250YWN0IG5vcm1hbCBpcyB0aGUgcGxhbmUgbm9ybWFsIG91dCBmcm9tIHBsYW5lCiAgICAgICAgICAvLyByaiBpcyBub3cganVzdCB0aGUgdmVjdG9yIGZyb20gdGhlIGNvbnZleCBjZW50ZXIgdG8gdGhlIHZlcnRleAoKICAgICAgICAgIHdvcmxkVmVydGV4LnZzdWIoY29udmV4UG9zaXRpb24sIHIucmopOyAvLyBNYWtlIGl0IHJlbGF0aXZlIHRvIHRoZSBib2R5CgogICAgICAgICAgci5yaS52YWRkKHBsYW5lUG9zaXRpb24sIHIucmkpOwogICAgICAgICAgci5yaS52c3ViKHBsYW5lQm9keS5wb3NpdGlvbiwgci5yaSk7CiAgICAgICAgICByLnJqLnZhZGQoY29udmV4UG9zaXRpb24sIHIucmopOwogICAgICAgICAgci5yai52c3ViKGNvbnZleEJvZHkucG9zaXRpb24sIHIucmopOwogICAgICAgICAgdGhpcy5yZXN1bHQucHVzaChyKTsKICAgICAgICAgIG51bUNvbnRhY3RzKys7CgogICAgICAgICAgaWYgKCF0aGlzLmVuYWJsZUZyaWN0aW9uUmVkdWN0aW9uKSB7CiAgICAgICAgICAgIHRoaXMuY3JlYXRlRnJpY3Rpb25FcXVhdGlvbnNGcm9tQ29udGFjdChyLCB0aGlzLmZyaWN0aW9uUmVzdWx0KTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KCiAgICAgIGlmICh0aGlzLmVuYWJsZUZyaWN0aW9uUmVkdWN0aW9uICYmIG51bUNvbnRhY3RzKSB7CiAgICAgICAgdGhpcy5jcmVhdGVGcmljdGlvbkZyb21BdmVyYWdlKG51bUNvbnRhY3RzKTsKICAgICAgfQogICAgfQoKICAgIGJveENvbnZleChzaSwgc2osIHhpLCB4aiwgcWksIHFqLCBiaSwgYmosIHJzaSwgcnNqLCBqdXN0VGVzdCkgewogICAgICBzaS5jb252ZXhQb2x5aGVkcm9uUmVwcmVzZW50YXRpb24ubWF0ZXJpYWwgPSBzaS5tYXRlcmlhbDsKICAgICAgc2kuY29udmV4UG9seWhlZHJvblJlcHJlc2VudGF0aW9uLmNvbGxpc2lvblJlc3BvbnNlID0gc2kuY29sbGlzaW9uUmVzcG9uc2U7CiAgICAgIHJldHVybiB0aGlzLmNvbnZleENvbnZleChzaS5jb252ZXhQb2x5aGVkcm9uUmVwcmVzZW50YXRpb24sIHNqLCB4aSwgeGosIHFpLCBxaiwgYmksIGJqLCBzaSwgc2osIGp1c3RUZXN0KTsKICAgIH0KCiAgICBzcGhlcmVIZWlnaHRmaWVsZChzcGhlcmVTaGFwZSwgaGZTaGFwZSwgc3BoZXJlUG9zLCBoZlBvcywgc3BoZXJlUXVhdCwgaGZRdWF0LCBzcGhlcmVCb2R5LCBoZkJvZHksIHJzaSwgcnNqLCBqdXN0VGVzdCkgewogICAgICBjb25zdCBkYXRhID0gaGZTaGFwZS5kYXRhOwogICAgICBjb25zdCByYWRpdXMgPSBzcGhlcmVTaGFwZS5yYWRpdXM7CiAgICAgIGNvbnN0IHcgPSBoZlNoYXBlLmVsZW1lbnRTaXplOwogICAgICBjb25zdCB3b3JsZFBpbGxhck9mZnNldCA9IHNwaGVyZUhlaWdodGZpZWxkX3RtcDI7IC8vIEdldCBzcGhlcmUgcG9zaXRpb24gdG8gaGVpZ2h0ZmllbGQgbG9jYWwhCgogICAgICBjb25zdCBsb2NhbFNwaGVyZVBvcyA9IHNwaGVyZUhlaWdodGZpZWxkX3RtcDE7CiAgICAgIFRyYW5zZm9ybS5wb2ludFRvTG9jYWxGcmFtZShoZlBvcywgaGZRdWF0LCBzcGhlcmVQb3MsIGxvY2FsU3BoZXJlUG9zKTsgLy8gR2V0IHRoZSBpbmRleCBvZiB0aGUgZGF0YSBwb2ludHMgdG8gdGVzdCBhZ2FpbnN0CgogICAgICBsZXQgaU1pblggPSBNYXRoLmZsb29yKChsb2NhbFNwaGVyZVBvcy54IC0gcmFkaXVzKSAvIHcpIC0gMTsKICAgICAgbGV0IGlNYXhYID0gTWF0aC5jZWlsKChsb2NhbFNwaGVyZVBvcy54ICsgcmFkaXVzKSAvIHcpICsgMTsKICAgICAgbGV0IGlNaW5ZID0gTWF0aC5mbG9vcigobG9jYWxTcGhlcmVQb3MueSAtIHJhZGl1cykgLyB3KSAtIDE7CiAgICAgIGxldCBpTWF4WSA9IE1hdGguY2VpbCgobG9jYWxTcGhlcmVQb3MueSArIHJhZGl1cykgLyB3KSArIDE7IC8vIEJhaWwgb3V0IGlmIHdlIGFyZSBvdXQgb2YgdGhlIHRlcnJhaW4KCiAgICAgIGlmIChpTWF4WCA8IDAgfHwgaU1heFkgPCAwIHx8IGlNaW5YID4gZGF0YS5sZW5ndGggfHwgaU1pblkgPiBkYXRhWzBdLmxlbmd0aCkgewogICAgICAgIHJldHVybjsKICAgICAgfSAvLyBDbGFtcCBpbmRleCB0byBlZGdlcwoKCiAgICAgIGlmIChpTWluWCA8IDApIHsKICAgICAgICBpTWluWCA9IDA7CiAgICAgIH0KCiAgICAgIGlmIChpTWF4WCA8IDApIHsKICAgICAgICBpTWF4WCA9IDA7CiAgICAgIH0KCiAgICAgIGlmIChpTWluWSA8IDApIHsKICAgICAgICBpTWluWSA9IDA7CiAgICAgIH0KCiAgICAgIGlmIChpTWF4WSA8IDApIHsKICAgICAgICBpTWF4WSA9IDA7CiAgICAgIH0KCiAgICAgIGlmIChpTWluWCA+PSBkYXRhLmxlbmd0aCkgewogICAgICAgIGlNaW5YID0gZGF0YS5sZW5ndGggLSAxOwogICAgICB9CgogICAgICBpZiAoaU1heFggPj0gZGF0YS5sZW5ndGgpIHsKICAgICAgICBpTWF4WCA9IGRhdGEubGVuZ3RoIC0gMTsKICAgICAgfQoKICAgICAgaWYgKGlNYXhZID49IGRhdGFbMF0ubGVuZ3RoKSB7CiAgICAgICAgaU1heFkgPSBkYXRhWzBdLmxlbmd0aCAtIDE7CiAgICAgIH0KCiAgICAgIGlmIChpTWluWSA+PSBkYXRhWzBdLmxlbmd0aCkgewogICAgICAgIGlNaW5ZID0gZGF0YVswXS5sZW5ndGggLSAxOwogICAgICB9CgogICAgICBjb25zdCBtaW5NYXggPSBbXTsKICAgICAgaGZTaGFwZS5nZXRSZWN0TWluTWF4KGlNaW5YLCBpTWluWSwgaU1heFgsIGlNYXhZLCBtaW5NYXgpOwogICAgICBjb25zdCBtaW4gPSBtaW5NYXhbMF07CiAgICAgIGNvbnN0IG1heCA9IG1pbk1heFsxXTsgLy8gQmFpbCBvdXQgaWYgd2UgY2FuJ3QgdG91Y2ggdGhlIGJvdW5kaW5nIGhlaWdodCBib3gKCiAgICAgIGlmIChsb2NhbFNwaGVyZVBvcy56IC0gcmFkaXVzID4gbWF4IHx8IGxvY2FsU3BoZXJlUG9zLnogKyByYWRpdXMgPCBtaW4pIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGNvbnN0IHJlc3VsdCA9IHRoaXMucmVzdWx0OwoKICAgICAgZm9yIChsZXQgaSA9IGlNaW5YOyBpIDwgaU1heFg7IGkrKykgewogICAgICAgIGZvciAobGV0IGogPSBpTWluWTsgaiA8IGlNYXhZOyBqKyspIHsKICAgICAgICAgIGNvbnN0IG51bUNvbnRhY3RzQmVmb3JlID0gcmVzdWx0Lmxlbmd0aDsKICAgICAgICAgIGxldCBpbnRlcnNlY3RpbmcgPSBmYWxzZTsgLy8gTG93ZXIgdHJpYW5nbGUKCiAgICAgICAgICBoZlNoYXBlLmdldENvbnZleFRyaWFuZ2xlUGlsbGFyKGksIGosIGZhbHNlKTsKICAgICAgICAgIFRyYW5zZm9ybS5wb2ludFRvV29ybGRGcmFtZShoZlBvcywgaGZRdWF0LCBoZlNoYXBlLnBpbGxhck9mZnNldCwgd29ybGRQaWxsYXJPZmZzZXQpOwoKICAgICAgICAgIGlmIChzcGhlcmVQb3MuZGlzdGFuY2VUbyh3b3JsZFBpbGxhck9mZnNldCkgPCBoZlNoYXBlLnBpbGxhckNvbnZleC5ib3VuZGluZ1NwaGVyZVJhZGl1cyArIHNwaGVyZVNoYXBlLmJvdW5kaW5nU3BoZXJlUmFkaXVzKSB7CiAgICAgICAgICAgIGludGVyc2VjdGluZyA9IHRoaXMuc3BoZXJlQ29udmV4KHNwaGVyZVNoYXBlLCBoZlNoYXBlLnBpbGxhckNvbnZleCwgc3BoZXJlUG9zLCB3b3JsZFBpbGxhck9mZnNldCwgc3BoZXJlUXVhdCwgaGZRdWF0LCBzcGhlcmVCb2R5LCBoZkJvZHksIHNwaGVyZVNoYXBlLCBoZlNoYXBlLCBqdXN0VGVzdCk7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKGp1c3RUZXN0ICYmIGludGVyc2VjdGluZykgewogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgIH0gLy8gVXBwZXIgdHJpYW5nbGUKCgogICAgICAgICAgaGZTaGFwZS5nZXRDb252ZXhUcmlhbmdsZVBpbGxhcihpLCBqLCB0cnVlKTsKICAgICAgICAgIFRyYW5zZm9ybS5wb2ludFRvV29ybGRGcmFtZShoZlBvcywgaGZRdWF0LCBoZlNoYXBlLnBpbGxhck9mZnNldCwgd29ybGRQaWxsYXJPZmZzZXQpOwoKICAgICAgICAgIGlmIChzcGhlcmVQb3MuZGlzdGFuY2VUbyh3b3JsZFBpbGxhck9mZnNldCkgPCBoZlNoYXBlLnBpbGxhckNvbnZleC5ib3VuZGluZ1NwaGVyZVJhZGl1cyArIHNwaGVyZVNoYXBlLmJvdW5kaW5nU3BoZXJlUmFkaXVzKSB7CiAgICAgICAgICAgIGludGVyc2VjdGluZyA9IHRoaXMuc3BoZXJlQ29udmV4KHNwaGVyZVNoYXBlLCBoZlNoYXBlLnBpbGxhckNvbnZleCwgc3BoZXJlUG9zLCB3b3JsZFBpbGxhck9mZnNldCwgc3BoZXJlUXVhdCwgaGZRdWF0LCBzcGhlcmVCb2R5LCBoZkJvZHksIHNwaGVyZVNoYXBlLCBoZlNoYXBlLCBqdXN0VGVzdCk7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKGp1c3RUZXN0ICYmIGludGVyc2VjdGluZykgewogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgIH0KCiAgICAgICAgICBjb25zdCBudW1Db250YWN0cyA9IHJlc3VsdC5sZW5ndGggLSBudW1Db250YWN0c0JlZm9yZTsKCiAgICAgICAgICBpZiAobnVtQ29udGFjdHMgPiAyKSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgIH0KICAgICAgICAgIC8qCiAgICAgICAgICAgIC8vIFNraXAgYWxsIGJ1dCAxCiAgICAgICAgICAgIGZvciAobGV0IGsgPSAwOyBrIDwgbnVtQ29udGFjdHMgLSAxOyBrKyspIHsKICAgICAgICAgICAgICAgIHJlc3VsdC5wb3AoKTsKICAgICAgICAgICAgfQogICAgICAgICAgKi8KCiAgICAgICAgfQogICAgICB9CiAgICB9CgogICAgYm94SGVpZ2h0ZmllbGQoc2ksIHNqLCB4aSwgeGosIHFpLCBxaiwgYmksIGJqLCByc2ksIHJzaiwganVzdFRlc3QpIHsKICAgICAgc2kuY29udmV4UG9seWhlZHJvblJlcHJlc2VudGF0aW9uLm1hdGVyaWFsID0gc2kubWF0ZXJpYWw7CiAgICAgIHNpLmNvbnZleFBvbHloZWRyb25SZXByZXNlbnRhdGlvbi5jb2xsaXNpb25SZXNwb25zZSA9IHNpLmNvbGxpc2lvblJlc3BvbnNlOwogICAgICByZXR1cm4gdGhpcy5jb252ZXhIZWlnaHRmaWVsZChzaS5jb252ZXhQb2x5aGVkcm9uUmVwcmVzZW50YXRpb24sIHNqLCB4aSwgeGosIHFpLCBxaiwgYmksIGJqLCBzaSwgc2osIGp1c3RUZXN0KTsKICAgIH0KCiAgICBjb252ZXhIZWlnaHRmaWVsZChjb252ZXhTaGFwZSwgaGZTaGFwZSwgY29udmV4UG9zLCBoZlBvcywgY29udmV4UXVhdCwgaGZRdWF0LCBjb252ZXhCb2R5LCBoZkJvZHksIHJzaSwgcnNqLCBqdXN0VGVzdCkgewogICAgICBjb25zdCBkYXRhID0gaGZTaGFwZS5kYXRhOwogICAgICBjb25zdCB3ID0gaGZTaGFwZS5lbGVtZW50U2l6ZTsKICAgICAgY29uc3QgcmFkaXVzID0gY29udmV4U2hhcGUuYm91bmRpbmdTcGhlcmVSYWRpdXM7CiAgICAgIGNvbnN0IHdvcmxkUGlsbGFyT2Zmc2V0ID0gY29udmV4SGVpZ2h0ZmllbGRfdG1wMjsKICAgICAgY29uc3QgZmFjZUxpc3QgPSBjb252ZXhIZWlnaHRmaWVsZF9mYWNlTGlzdDsgLy8gR2V0IHNwaGVyZSBwb3NpdGlvbiB0byBoZWlnaHRmaWVsZCBsb2NhbCEKCiAgICAgIGNvbnN0IGxvY2FsQ29udmV4UG9zID0gY29udmV4SGVpZ2h0ZmllbGRfdG1wMTsKICAgICAgVHJhbnNmb3JtLnBvaW50VG9Mb2NhbEZyYW1lKGhmUG9zLCBoZlF1YXQsIGNvbnZleFBvcywgbG9jYWxDb252ZXhQb3MpOyAvLyBHZXQgdGhlIGluZGV4IG9mIHRoZSBkYXRhIHBvaW50cyB0byB0ZXN0IGFnYWluc3QKCiAgICAgIGxldCBpTWluWCA9IE1hdGguZmxvb3IoKGxvY2FsQ29udmV4UG9zLnggLSByYWRpdXMpIC8gdykgLSAxOwogICAgICBsZXQgaU1heFggPSBNYXRoLmNlaWwoKGxvY2FsQ29udmV4UG9zLnggKyByYWRpdXMpIC8gdykgKyAxOwogICAgICBsZXQgaU1pblkgPSBNYXRoLmZsb29yKChsb2NhbENvbnZleFBvcy55IC0gcmFkaXVzKSAvIHcpIC0gMTsKICAgICAgbGV0IGlNYXhZID0gTWF0aC5jZWlsKChsb2NhbENvbnZleFBvcy55ICsgcmFkaXVzKSAvIHcpICsgMTsgLy8gQmFpbCBvdXQgaWYgd2UgYXJlIG91dCBvZiB0aGUgdGVycmFpbgoKICAgICAgaWYgKGlNYXhYIDwgMCB8fCBpTWF4WSA8IDAgfHwgaU1pblggPiBkYXRhLmxlbmd0aCB8fCBpTWluWSA+IGRhdGFbMF0ubGVuZ3RoKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9IC8vIENsYW1wIGluZGV4IHRvIGVkZ2VzCgoKICAgICAgaWYgKGlNaW5YIDwgMCkgewogICAgICAgIGlNaW5YID0gMDsKICAgICAgfQoKICAgICAgaWYgKGlNYXhYIDwgMCkgewogICAgICAgIGlNYXhYID0gMDsKICAgICAgfQoKICAgICAgaWYgKGlNaW5ZIDwgMCkgewogICAgICAgIGlNaW5ZID0gMDsKICAgICAgfQoKICAgICAgaWYgKGlNYXhZIDwgMCkgewogICAgICAgIGlNYXhZID0gMDsKICAgICAgfQoKICAgICAgaWYgKGlNaW5YID49IGRhdGEubGVuZ3RoKSB7CiAgICAgICAgaU1pblggPSBkYXRhLmxlbmd0aCAtIDE7CiAgICAgIH0KCiAgICAgIGlmIChpTWF4WCA+PSBkYXRhLmxlbmd0aCkgewogICAgICAgIGlNYXhYID0gZGF0YS5sZW5ndGggLSAxOwogICAgICB9CgogICAgICBpZiAoaU1heFkgPj0gZGF0YVswXS5sZW5ndGgpIHsKICAgICAgICBpTWF4WSA9IGRhdGFbMF0ubGVuZ3RoIC0gMTsKICAgICAgfQoKICAgICAgaWYgKGlNaW5ZID49IGRhdGFbMF0ubGVuZ3RoKSB7CiAgICAgICAgaU1pblkgPSBkYXRhWzBdLmxlbmd0aCAtIDE7CiAgICAgIH0KCiAgICAgIGNvbnN0IG1pbk1heCA9IFtdOwogICAgICBoZlNoYXBlLmdldFJlY3RNaW5NYXgoaU1pblgsIGlNaW5ZLCBpTWF4WCwgaU1heFksIG1pbk1heCk7CiAgICAgIGNvbnN0IG1pbiA9IG1pbk1heFswXTsKICAgICAgY29uc3QgbWF4ID0gbWluTWF4WzFdOyAvLyBCYWlsIG91dCBpZiB3ZSdyZSBjYW50IHRvdWNoIHRoZSBib3VuZGluZyBoZWlnaHQgYm94CgogICAgICBpZiAobG9jYWxDb252ZXhQb3MueiAtIHJhZGl1cyA+IG1heCB8fCBsb2NhbENvbnZleFBvcy56ICsgcmFkaXVzIDwgbWluKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICBmb3IgKGxldCBpID0gaU1pblg7IGkgPCBpTWF4WDsgaSsrKSB7CiAgICAgICAgZm9yIChsZXQgaiA9IGlNaW5ZOyBqIDwgaU1heFk7IGorKykgewogICAgICAgICAgbGV0IGludGVyc2VjdGluZyA9IGZhbHNlOyAvLyBMb3dlciB0cmlhbmdsZQoKICAgICAgICAgIGhmU2hhcGUuZ2V0Q29udmV4VHJpYW5nbGVQaWxsYXIoaSwgaiwgZmFsc2UpOwogICAgICAgICAgVHJhbnNmb3JtLnBvaW50VG9Xb3JsZEZyYW1lKGhmUG9zLCBoZlF1YXQsIGhmU2hhcGUucGlsbGFyT2Zmc2V0LCB3b3JsZFBpbGxhck9mZnNldCk7CgogICAgICAgICAgaWYgKGNvbnZleFBvcy5kaXN0YW5jZVRvKHdvcmxkUGlsbGFyT2Zmc2V0KSA8IGhmU2hhcGUucGlsbGFyQ29udmV4LmJvdW5kaW5nU3BoZXJlUmFkaXVzICsgY29udmV4U2hhcGUuYm91bmRpbmdTcGhlcmVSYWRpdXMpIHsKICAgICAgICAgICAgaW50ZXJzZWN0aW5nID0gdGhpcy5jb252ZXhDb252ZXgoY29udmV4U2hhcGUsIGhmU2hhcGUucGlsbGFyQ29udmV4LCBjb252ZXhQb3MsIHdvcmxkUGlsbGFyT2Zmc2V0LCBjb252ZXhRdWF0LCBoZlF1YXQsIGNvbnZleEJvZHksIGhmQm9keSwgbnVsbCwgbnVsbCwganVzdFRlc3QsIGZhY2VMaXN0LCBudWxsKTsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoanVzdFRlc3QgJiYgaW50ZXJzZWN0aW5nKSB7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgfSAvLyBVcHBlciB0cmlhbmdsZQoKCiAgICAgICAgICBoZlNoYXBlLmdldENvbnZleFRyaWFuZ2xlUGlsbGFyKGksIGosIHRydWUpOwogICAgICAgICAgVHJhbnNmb3JtLnBvaW50VG9Xb3JsZEZyYW1lKGhmUG9zLCBoZlF1YXQsIGhmU2hhcGUucGlsbGFyT2Zmc2V0LCB3b3JsZFBpbGxhck9mZnNldCk7CgogICAgICAgICAgaWYgKGNvbnZleFBvcy5kaXN0YW5jZVRvKHdvcmxkUGlsbGFyT2Zmc2V0KSA8IGhmU2hhcGUucGlsbGFyQ29udmV4LmJvdW5kaW5nU3BoZXJlUmFkaXVzICsgY29udmV4U2hhcGUuYm91bmRpbmdTcGhlcmVSYWRpdXMpIHsKICAgICAgICAgICAgaW50ZXJzZWN0aW5nID0gdGhpcy5jb252ZXhDb252ZXgoY29udmV4U2hhcGUsIGhmU2hhcGUucGlsbGFyQ29udmV4LCBjb252ZXhQb3MsIHdvcmxkUGlsbGFyT2Zmc2V0LCBjb252ZXhRdWF0LCBoZlF1YXQsIGNvbnZleEJvZHksIGhmQm9keSwgbnVsbCwgbnVsbCwganVzdFRlc3QsIGZhY2VMaXN0LCBudWxsKTsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoanVzdFRlc3QgJiYgaW50ZXJzZWN0aW5nKSB7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgfQoKICAgIHNwaGVyZVBhcnRpY2xlKHNqLCBzaSwgeGosIHhpLCBxaiwgcWksIGJqLCBiaSwgcnNpLCByc2osIGp1c3RUZXN0KSB7CiAgICAgIC8vIFRoZSBub3JtYWwgaXMgdGhlIHVuaXQgdmVjdG9yIGZyb20gc3BoZXJlIGNlbnRlciB0byBwYXJ0aWNsZSBjZW50ZXIKICAgICAgY29uc3Qgbm9ybWFsID0gcGFydGljbGVTcGhlcmVfbm9ybWFsOwogICAgICBub3JtYWwuc2V0KDAsIDAsIDEpOwogICAgICB4aS52c3ViKHhqLCBub3JtYWwpOwogICAgICBjb25zdCBsZW5ndGhTcXVhcmVkID0gbm9ybWFsLmxlbmd0aFNxdWFyZWQoKTsKCiAgICAgIGlmIChsZW5ndGhTcXVhcmVkIDw9IHNqLnJhZGl1cyAqIHNqLnJhZGl1cykgewogICAgICAgIGlmIChqdXN0VGVzdCkgewogICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQoKICAgICAgICBjb25zdCByID0gdGhpcy5jcmVhdGVDb250YWN0RXF1YXRpb24oYmksIGJqLCBzaSwgc2osIHJzaSwgcnNqKTsKICAgICAgICBub3JtYWwubm9ybWFsaXplKCk7CiAgICAgICAgci5yai5jb3B5KG5vcm1hbCk7CiAgICAgICAgci5yai5zY2FsZShzai5yYWRpdXMsIHIucmopOwogICAgICAgIHIubmkuY29weShub3JtYWwpOyAvLyBDb250YWN0IG5vcm1hbAoKICAgICAgICByLm5pLm5lZ2F0ZShyLm5pKTsKICAgICAgICByLnJpLnNldCgwLCAwLCAwKTsgLy8gQ2VudGVyIG9mIHBhcnRpY2xlCgogICAgICAgIHRoaXMucmVzdWx0LnB1c2gocik7CiAgICAgICAgdGhpcy5jcmVhdGVGcmljdGlvbkVxdWF0aW9uc0Zyb21Db250YWN0KHIsIHRoaXMuZnJpY3Rpb25SZXN1bHQpOwogICAgICB9CiAgICB9CgogICAgcGxhbmVQYXJ0aWNsZShzaiwgc2ksIHhqLCB4aSwgcWosIHFpLCBiaiwgYmksIHJzaSwgcnNqLCBqdXN0VGVzdCkgewogICAgICBjb25zdCBub3JtYWwgPSBwYXJ0aWNsZVBsYW5lX25vcm1hbDsKICAgICAgbm9ybWFsLnNldCgwLCAwLCAxKTsKICAgICAgYmoucXVhdGVybmlvbi52bXVsdChub3JtYWwsIG5vcm1hbCk7IC8vIFR1cm4gbm9ybWFsIGFjY29yZGluZyB0byBwbGFuZSBvcmllbnRhdGlvbgoKICAgICAgY29uc3QgcmVscG9zID0gcGFydGljbGVQbGFuZV9yZWxwb3M7CiAgICAgIHhpLnZzdWIoYmoucG9zaXRpb24sIHJlbHBvcyk7CiAgICAgIGNvbnN0IGRvdCA9IG5vcm1hbC5kb3QocmVscG9zKTsKCiAgICAgIGlmIChkb3QgPD0gMC4wKSB7CiAgICAgICAgaWYgKGp1c3RUZXN0KSB7CiAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CgogICAgICAgIGNvbnN0IHIgPSB0aGlzLmNyZWF0ZUNvbnRhY3RFcXVhdGlvbihiaSwgYmosIHNpLCBzaiwgcnNpLCByc2opOwogICAgICAgIHIubmkuY29weShub3JtYWwpOyAvLyBDb250YWN0IG5vcm1hbCBpcyB0aGUgcGxhbmUgbm9ybWFsCgogICAgICAgIHIubmkubmVnYXRlKHIubmkpOwogICAgICAgIHIucmkuc2V0KDAsIDAsIDApOyAvLyBDZW50ZXIgb2YgcGFydGljbGUKICAgICAgICAvLyBHZXQgcGFydGljbGUgcG9zaXRpb24gcHJvamVjdGVkIG9uIHBsYW5lCgogICAgICAgIGNvbnN0IHByb2plY3RlZCA9IHBhcnRpY2xlUGxhbmVfcHJvamVjdGVkOwogICAgICAgIG5vcm1hbC5zY2FsZShub3JtYWwuZG90KHhpKSwgcHJvamVjdGVkKTsKICAgICAgICB4aS52c3ViKHByb2plY3RlZCwgcHJvamVjdGVkKTsgLy9wcm9qZWN0ZWQudmFkZChiai5wb3NpdGlvbixwcm9qZWN0ZWQpOwogICAgICAgIC8vIHJqIGlzIG5vdyB0aGUgcHJvamVjdGVkIHdvcmxkIHBvc2l0aW9uIG1pbnVzIHBsYW5lIHBvc2l0aW9uCgogICAgICAgIHIucmouY29weShwcm9qZWN0ZWQpOwogICAgICAgIHRoaXMucmVzdWx0LnB1c2gocik7CiAgICAgICAgdGhpcy5jcmVhdGVGcmljdGlvbkVxdWF0aW9uc0Zyb21Db250YWN0KHIsIHRoaXMuZnJpY3Rpb25SZXN1bHQpOwogICAgICB9CiAgICB9CgogICAgYm94UGFydGljbGUoc2ksIHNqLCB4aSwgeGosIHFpLCBxaiwgYmksIGJqLCByc2ksIHJzaiwganVzdFRlc3QpIHsKICAgICAgc2kuY29udmV4UG9seWhlZHJvblJlcHJlc2VudGF0aW9uLm1hdGVyaWFsID0gc2kubWF0ZXJpYWw7CiAgICAgIHNpLmNvbnZleFBvbHloZWRyb25SZXByZXNlbnRhdGlvbi5jb2xsaXNpb25SZXNwb25zZSA9IHNpLmNvbGxpc2lvblJlc3BvbnNlOwogICAgICByZXR1cm4gdGhpcy5jb252ZXhQYXJ0aWNsZShzaS5jb252ZXhQb2x5aGVkcm9uUmVwcmVzZW50YXRpb24sIHNqLCB4aSwgeGosIHFpLCBxaiwgYmksIGJqLCBzaSwgc2osIGp1c3RUZXN0KTsKICAgIH0KCiAgICBjb252ZXhQYXJ0aWNsZShzaiwgc2ksIHhqLCB4aSwgcWosIHFpLCBiaiwgYmksIHJzaSwgcnNqLCBqdXN0VGVzdCkgewogICAgICBsZXQgcGVuZXRyYXRlZEZhY2VJbmRleCA9IC0xOwogICAgICBjb25zdCBwZW5ldHJhdGVkRmFjZU5vcm1hbCA9IGNvbnZleFBhcnRpY2xlX3BlbmV0cmF0ZWRGYWNlTm9ybWFsOwogICAgICBjb25zdCB3b3JsZFBlbmV0cmF0aW9uVmVjID0gY29udmV4UGFydGljbGVfd29ybGRQZW5ldHJhdGlvblZlYzsKICAgICAgbGV0IG1pblBlbmV0cmF0aW9uID0gbnVsbDsKCiAgICAgIGNvbnN0IGxvY2FsID0gY29udmV4UGFydGljbGVfbG9jYWw7CiAgICAgIGxvY2FsLmNvcHkoeGkpOwogICAgICBsb2NhbC52c3ViKHhqLCBsb2NhbCk7IC8vIENvbnZlcnQgcG9zaXRpb24gdG8gcmVsYXRpdmUgdGhlIGNvbnZleCBvcmlnaW4KCiAgICAgIHFqLmNvbmp1Z2F0ZShjcWopOwogICAgICBjcWoudm11bHQobG9jYWwsIGxvY2FsKTsKCiAgICAgIGlmIChzai5wb2ludElzSW5zaWRlKGxvY2FsKSkgewogICAgICAgIGlmIChzai53b3JsZFZlcnRpY2VzTmVlZHNVcGRhdGUpIHsKICAgICAgICAgIHNqLmNvbXB1dGVXb3JsZFZlcnRpY2VzKHhqLCBxaik7CiAgICAgICAgfQoKICAgICAgICBpZiAoc2oud29ybGRGYWNlTm9ybWFsc05lZWRzVXBkYXRlKSB7CiAgICAgICAgICBzai5jb21wdXRlV29ybGRGYWNlTm9ybWFscyhxaik7CiAgICAgICAgfSAvLyBGb3IgZWFjaCB3b3JsZCBwb2x5Z29uIGluIHRoZSBwb2x5aGVkcmEKCgogICAgICAgIGZvciAobGV0IGkgPSAwLCBuZmFjZXMgPSBzai5mYWNlcy5sZW5ndGg7IGkgIT09IG5mYWNlczsgaSsrKSB7CiAgICAgICAgICAvLyBDb25zdHJ1Y3Qgd29ybGQgZmFjZSB2ZXJ0aWNlcwogICAgICAgICAgY29uc3QgdmVydHMgPSBbc2oud29ybGRWZXJ0aWNlc1tzai5mYWNlc1tpXVswXV1dOwogICAgICAgICAgY29uc3Qgbm9ybWFsID0gc2oud29ybGRGYWNlTm9ybWFsc1tpXTsgLy8gQ2hlY2sgaG93IG11Y2ggdGhlIHBhcnRpY2xlIHBlbmV0cmF0ZXMgdGhlIHBvbHlnb24gcGxhbmUuCgogICAgICAgICAgeGkudnN1Yih2ZXJ0c1swXSwgY29udmV4UGFydGljbGVfdmVydGV4VG9QYXJ0aWNsZSk7CiAgICAgICAgICBjb25zdCBwZW5ldHJhdGlvbiA9IC1ub3JtYWwuZG90KGNvbnZleFBhcnRpY2xlX3ZlcnRleFRvUGFydGljbGUpOwoKICAgICAgICAgIGlmIChtaW5QZW5ldHJhdGlvbiA9PT0gbnVsbCB8fCBNYXRoLmFicyhwZW5ldHJhdGlvbikgPCBNYXRoLmFicyhtaW5QZW5ldHJhdGlvbikpIHsKICAgICAgICAgICAgaWYgKGp1c3RUZXN0KSB7CiAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIG1pblBlbmV0cmF0aW9uID0gcGVuZXRyYXRpb247CiAgICAgICAgICAgIHBlbmV0cmF0ZWRGYWNlSW5kZXggPSBpOwogICAgICAgICAgICBwZW5ldHJhdGVkRmFjZU5vcm1hbC5jb3B5KG5vcm1hbCk7CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBpZiAocGVuZXRyYXRlZEZhY2VJbmRleCAhPT0gLTEpIHsKICAgICAgICAgIC8vIFNldHVwIGNvbnRhY3QKICAgICAgICAgIGNvbnN0IHIgPSB0aGlzLmNyZWF0ZUNvbnRhY3RFcXVhdGlvbihiaSwgYmosIHNpLCBzaiwgcnNpLCByc2opOwogICAgICAgICAgcGVuZXRyYXRlZEZhY2VOb3JtYWwuc2NhbGUobWluUGVuZXRyYXRpb24sIHdvcmxkUGVuZXRyYXRpb25WZWMpOyAvLyByaiBpcyB0aGUgcGFydGljbGUgcG9zaXRpb24gcHJvamVjdGVkIHRvIHRoZSBmYWNlCgogICAgICAgICAgd29ybGRQZW5ldHJhdGlvblZlYy52YWRkKHhpLCB3b3JsZFBlbmV0cmF0aW9uVmVjKTsKICAgICAgICAgIHdvcmxkUGVuZXRyYXRpb25WZWMudnN1Yih4aiwgd29ybGRQZW5ldHJhdGlvblZlYyk7CiAgICAgICAgICByLnJqLmNvcHkod29ybGRQZW5ldHJhdGlvblZlYyk7IC8vY29uc3QgcHJvamVjdGVkVG9GYWNlID0geGkudnN1Yih4aikudmFkZCh3b3JsZFBlbmV0cmF0aW9uVmVjKTsKICAgICAgICAgIC8vcHJvamVjdGVkVG9GYWNlLmNvcHkoci5yaik7CiAgICAgICAgICAvL3FqLnZtdWx0KHIucmosci5yaik7CgogICAgICAgICAgcGVuZXRyYXRlZEZhY2VOb3JtYWwubmVnYXRlKHIubmkpOyAvLyBDb250YWN0IG5vcm1hbAoKICAgICAgICAgIHIucmkuc2V0KDAsIDAsIDApOyAvLyBDZW50ZXIgb2YgcGFydGljbGUKCiAgICAgICAgICBjb25zdCByaSA9IHIucmk7CiAgICAgICAgICBjb25zdCByaiA9IHIucmo7IC8vIE1ha2UgcmVsYXRpdmUgdG8gYm9kaWVzCgogICAgICAgICAgcmkudmFkZCh4aSwgcmkpOwogICAgICAgICAgcmkudnN1YihiaS5wb3NpdGlvbiwgcmkpOwogICAgICAgICAgcmoudmFkZCh4aiwgcmopOwogICAgICAgICAgcmoudnN1Yihiai5wb3NpdGlvbiwgcmopOwogICAgICAgICAgdGhpcy5yZXN1bHQucHVzaChyKTsKICAgICAgICAgIHRoaXMuY3JlYXRlRnJpY3Rpb25FcXVhdGlvbnNGcm9tQ29udGFjdChyLCB0aGlzLmZyaWN0aW9uUmVzdWx0KTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgY29uc29sZS53YXJuKCdQb2ludCBmb3VuZCBpbnNpZGUgY29udmV4LCBidXQgZGlkIG5vdCBmaW5kIHBlbmV0cmF0aW5nIGZhY2UhJyk7CiAgICAgICAgfQogICAgICB9CiAgICB9CgogICAgaGVpZ2h0ZmllbGRDeWxpbmRlcihoZlNoYXBlLCBjb252ZXhTaGFwZSwgaGZQb3MsIGNvbnZleFBvcywgaGZRdWF0LCBjb252ZXhRdWF0LCBoZkJvZHksIGNvbnZleEJvZHksIHJzaSwgcnNqLCBqdXN0VGVzdCkgewogICAgICByZXR1cm4gdGhpcy5jb252ZXhIZWlnaHRmaWVsZChjb252ZXhTaGFwZSwgaGZTaGFwZSwgY29udmV4UG9zLCBoZlBvcywgY29udmV4UXVhdCwgaGZRdWF0LCBjb252ZXhCb2R5LCBoZkJvZHksIHJzaSwgcnNqLCBqdXN0VGVzdCk7CiAgICB9CgogICAgcGFydGljbGVDeWxpbmRlcihzaSwgc2osIHhpLCB4aiwgcWksIHFqLCBiaSwgYmosIHJzaSwgcnNqLCBqdXN0VGVzdCkgewogICAgICByZXR1cm4gdGhpcy5jb252ZXhQYXJ0aWNsZShzaiwgc2ksIHhqLCB4aSwgcWosIHFpLCBiaiwgYmksIHJzaSwgcnNqLCBqdXN0VGVzdCk7CiAgICB9CgogICAgc3BoZXJlVHJpbWVzaChzcGhlcmVTaGFwZSwgdHJpbWVzaFNoYXBlLCBzcGhlcmVQb3MsIHRyaW1lc2hQb3MsIHNwaGVyZVF1YXQsIHRyaW1lc2hRdWF0LCBzcGhlcmVCb2R5LCB0cmltZXNoQm9keSwgcnNpLCByc2osIGp1c3RUZXN0KSB7CiAgICAgIGNvbnN0IGVkZ2VWZXJ0ZXhBID0gc3BoZXJlVHJpbWVzaF9lZGdlVmVydGV4QTsKICAgICAgY29uc3QgZWRnZVZlcnRleEIgPSBzcGhlcmVUcmltZXNoX2VkZ2VWZXJ0ZXhCOwogICAgICBjb25zdCBlZGdlVmVjdG9yID0gc3BoZXJlVHJpbWVzaF9lZGdlVmVjdG9yOwogICAgICBjb25zdCBlZGdlVmVjdG9yVW5pdCA9IHNwaGVyZVRyaW1lc2hfZWRnZVZlY3RvclVuaXQ7CiAgICAgIGNvbnN0IGxvY2FsU3BoZXJlUG9zID0gc3BoZXJlVHJpbWVzaF9sb2NhbFNwaGVyZVBvczsKICAgICAgY29uc3QgdG1wID0gc3BoZXJlVHJpbWVzaF90bXA7CiAgICAgIGNvbnN0IGxvY2FsU3BoZXJlQUFCQiA9IHNwaGVyZVRyaW1lc2hfbG9jYWxTcGhlcmVBQUJCOwogICAgICBjb25zdCB2MiA9IHNwaGVyZVRyaW1lc2hfdjI7CiAgICAgIGNvbnN0IHJlbHBvcyA9IHNwaGVyZVRyaW1lc2hfcmVscG9zOwogICAgICBjb25zdCB0cmlhbmdsZXMgPSBzcGhlcmVUcmltZXNoX3RyaWFuZ2xlczsgLy8gQ29udmVydCBzcGhlcmUgcG9zaXRpb24gdG8gbG9jYWwgaW4gdGhlIHRyaW1lc2gKCiAgICAgIFRyYW5zZm9ybS5wb2ludFRvTG9jYWxGcmFtZSh0cmltZXNoUG9zLCB0cmltZXNoUXVhdCwgc3BoZXJlUG9zLCBsb2NhbFNwaGVyZVBvcyk7IC8vIEdldCB0aGUgYWFiYiBvZiB0aGUgc3BoZXJlIGxvY2FsbHkgaW4gdGhlIHRyaW1lc2gKCiAgICAgIGNvbnN0IHNwaGVyZVJhZGl1cyA9IHNwaGVyZVNoYXBlLnJhZGl1czsKICAgICAgbG9jYWxTcGhlcmVBQUJCLmxvd2VyQm91bmQuc2V0KGxvY2FsU3BoZXJlUG9zLnggLSBzcGhlcmVSYWRpdXMsIGxvY2FsU3BoZXJlUG9zLnkgLSBzcGhlcmVSYWRpdXMsIGxvY2FsU3BoZXJlUG9zLnogLSBzcGhlcmVSYWRpdXMpOwogICAgICBsb2NhbFNwaGVyZUFBQkIudXBwZXJCb3VuZC5zZXQobG9jYWxTcGhlcmVQb3MueCArIHNwaGVyZVJhZGl1cywgbG9jYWxTcGhlcmVQb3MueSArIHNwaGVyZVJhZGl1cywgbG9jYWxTcGhlcmVQb3MueiArIHNwaGVyZVJhZGl1cyk7CiAgICAgIHRyaW1lc2hTaGFwZS5nZXRUcmlhbmdsZXNJbkFBQkIobG9jYWxTcGhlcmVBQUJCLCB0cmlhbmdsZXMpOyAvL2ZvciAobGV0IGkgPSAwOyBpIDwgdHJpbWVzaFNoYXBlLmluZGljZXMubGVuZ3RoIC8gMzsgaSsrKSB0cmlhbmdsZXMucHVzaChpKTsgLy8gQWxsCiAgICAgIC8vIFZlcnRpY2VzCgogICAgICBjb25zdCB2ID0gc3BoZXJlVHJpbWVzaF92OwogICAgICBjb25zdCByYWRpdXNTcXVhcmVkID0gc3BoZXJlU2hhcGUucmFkaXVzICogc3BoZXJlU2hhcGUucmFkaXVzOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0cmlhbmdsZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICBmb3IgKGxldCBqID0gMDsgaiA8IDM7IGorKykgewogICAgICAgICAgdHJpbWVzaFNoYXBlLmdldFZlcnRleCh0cmltZXNoU2hhcGUuaW5kaWNlc1t0cmlhbmdsZXNbaV0gKiAzICsgal0sIHYpOyAvLyBDaGVjayB2ZXJ0ZXggb3ZlcmxhcCBpbiBzcGhlcmUKCiAgICAgICAgICB2LnZzdWIobG9jYWxTcGhlcmVQb3MsIHJlbHBvcyk7CgogICAgICAgICAgaWYgKHJlbHBvcy5sZW5ndGhTcXVhcmVkKCkgPD0gcmFkaXVzU3F1YXJlZCkgewogICAgICAgICAgICAvLyBTYWZlIHVwCiAgICAgICAgICAgIHYyLmNvcHkodik7CiAgICAgICAgICAgIFRyYW5zZm9ybS5wb2ludFRvV29ybGRGcmFtZSh0cmltZXNoUG9zLCB0cmltZXNoUXVhdCwgdjIsIHYpOwogICAgICAgICAgICB2LnZzdWIoc3BoZXJlUG9zLCByZWxwb3MpOwoKICAgICAgICAgICAgaWYgKGp1c3RUZXN0KSB7CiAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGxldCByID0gdGhpcy5jcmVhdGVDb250YWN0RXF1YXRpb24oc3BoZXJlQm9keSwgdHJpbWVzaEJvZHksIHNwaGVyZVNoYXBlLCB0cmltZXNoU2hhcGUsIHJzaSwgcnNqKTsKICAgICAgICAgICAgci5uaS5jb3B5KHJlbHBvcyk7CiAgICAgICAgICAgIHIubmkubm9ybWFsaXplKCk7IC8vIHJpIGlzIHRoZSB2ZWN0b3IgZnJvbSBzcGhlcmUgY2VudGVyIHRvIHRoZSBzcGhlcmUgc3VyZmFjZQoKICAgICAgICAgICAgci5yaS5jb3B5KHIubmkpOwogICAgICAgICAgICByLnJpLnNjYWxlKHNwaGVyZVNoYXBlLnJhZGl1cywgci5yaSk7CiAgICAgICAgICAgIHIucmkudmFkZChzcGhlcmVQb3MsIHIucmkpOwogICAgICAgICAgICByLnJpLnZzdWIoc3BoZXJlQm9keS5wb3NpdGlvbiwgci5yaSk7CiAgICAgICAgICAgIHIucmouY29weSh2KTsKICAgICAgICAgICAgci5yai52c3ViKHRyaW1lc2hCb2R5LnBvc2l0aW9uLCByLnJqKTsgLy8gU3RvcmUgcmVzdWx0CgogICAgICAgICAgICB0aGlzLnJlc3VsdC5wdXNoKHIpOwogICAgICAgICAgICB0aGlzLmNyZWF0ZUZyaWN0aW9uRXF1YXRpb25zRnJvbUNvbnRhY3QociwgdGhpcy5mcmljdGlvblJlc3VsdCk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9IC8vIENoZWNrIGFsbCBlZGdlcwoKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdHJpYW5nbGVzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCAzOyBqKyspIHsKICAgICAgICAgIHRyaW1lc2hTaGFwZS5nZXRWZXJ0ZXgodHJpbWVzaFNoYXBlLmluZGljZXNbdHJpYW5nbGVzW2ldICogMyArIGpdLCBlZGdlVmVydGV4QSk7CiAgICAgICAgICB0cmltZXNoU2hhcGUuZ2V0VmVydGV4KHRyaW1lc2hTaGFwZS5pbmRpY2VzW3RyaWFuZ2xlc1tpXSAqIDMgKyAoaiArIDEpICUgM10sIGVkZ2VWZXJ0ZXhCKTsKICAgICAgICAgIGVkZ2VWZXJ0ZXhCLnZzdWIoZWRnZVZlcnRleEEsIGVkZ2VWZWN0b3IpOyAvLyBQcm9qZWN0IHNwaGVyZSBwb3NpdGlvbiB0byB0aGUgZWRnZQoKICAgICAgICAgIGxvY2FsU3BoZXJlUG9zLnZzdWIoZWRnZVZlcnRleEIsIHRtcCk7CiAgICAgICAgICBjb25zdCBwb3NpdGlvbkFsb25nRWRnZUIgPSB0bXAuZG90KGVkZ2VWZWN0b3IpOwogICAgICAgICAgbG9jYWxTcGhlcmVQb3MudnN1YihlZGdlVmVydGV4QSwgdG1wKTsKICAgICAgICAgIGxldCBwb3NpdGlvbkFsb25nRWRnZUEgPSB0bXAuZG90KGVkZ2VWZWN0b3IpOwoKICAgICAgICAgIGlmIChwb3NpdGlvbkFsb25nRWRnZUEgPiAwICYmIHBvc2l0aW9uQWxvbmdFZGdlQiA8IDApIHsKICAgICAgICAgICAgLy8gTm93IGNoZWNrIHRoZSBvcnRob2dvbmFsIGRpc3RhbmNlIGZyb20gZWRnZSB0byBzcGhlcmUgY2VudGVyCiAgICAgICAgICAgIGxvY2FsU3BoZXJlUG9zLnZzdWIoZWRnZVZlcnRleEEsIHRtcCk7CiAgICAgICAgICAgIGVkZ2VWZWN0b3JVbml0LmNvcHkoZWRnZVZlY3Rvcik7CiAgICAgICAgICAgIGVkZ2VWZWN0b3JVbml0Lm5vcm1hbGl6ZSgpOwogICAgICAgICAgICBwb3NpdGlvbkFsb25nRWRnZUEgPSB0bXAuZG90KGVkZ2VWZWN0b3JVbml0KTsKICAgICAgICAgICAgZWRnZVZlY3RvclVuaXQuc2NhbGUocG9zaXRpb25BbG9uZ0VkZ2VBLCB0bXApOwogICAgICAgICAgICB0bXAudmFkZChlZGdlVmVydGV4QSwgdG1wKTsgLy8gdG1wIGlzIG5vdyB0aGUgc3BoZXJlIGNlbnRlciBwb3NpdGlvbiBwcm9qZWN0ZWQgdG8gdGhlIGVkZ2UsIGRlZmluZWQgbG9jYWxseSBpbiB0aGUgdHJpbWVzaCBmcmFtZQoKICAgICAgICAgICAgY29uc3QgZGlzdCA9IHRtcC5kaXN0YW5jZVRvKGxvY2FsU3BoZXJlUG9zKTsKCiAgICAgICAgICAgIGlmIChkaXN0IDwgc3BoZXJlU2hhcGUucmFkaXVzKSB7CiAgICAgICAgICAgICAgaWYgKGp1c3RUZXN0KSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIGNvbnN0IHIgPSB0aGlzLmNyZWF0ZUNvbnRhY3RFcXVhdGlvbihzcGhlcmVCb2R5LCB0cmltZXNoQm9keSwgc3BoZXJlU2hhcGUsIHRyaW1lc2hTaGFwZSwgcnNpLCByc2opOwogICAgICAgICAgICAgIHRtcC52c3ViKGxvY2FsU3BoZXJlUG9zLCByLm5pKTsKICAgICAgICAgICAgICByLm5pLm5vcm1hbGl6ZSgpOwogICAgICAgICAgICAgIHIubmkuc2NhbGUoc3BoZXJlU2hhcGUucmFkaXVzLCByLnJpKTsKICAgICAgICAgICAgICByLnJpLnZhZGQoc3BoZXJlUG9zLCByLnJpKTsKICAgICAgICAgICAgICByLnJpLnZzdWIoc3BoZXJlQm9keS5wb3NpdGlvbiwgci5yaSk7CiAgICAgICAgICAgICAgVHJhbnNmb3JtLnBvaW50VG9Xb3JsZEZyYW1lKHRyaW1lc2hQb3MsIHRyaW1lc2hRdWF0LCB0bXAsIHRtcCk7CiAgICAgICAgICAgICAgdG1wLnZzdWIodHJpbWVzaEJvZHkucG9zaXRpb24sIHIucmopOwogICAgICAgICAgICAgIFRyYW5zZm9ybS52ZWN0b3JUb1dvcmxkRnJhbWUodHJpbWVzaFF1YXQsIHIubmksIHIubmkpOwogICAgICAgICAgICAgIFRyYW5zZm9ybS52ZWN0b3JUb1dvcmxkRnJhbWUodHJpbWVzaFF1YXQsIHIucmksIHIucmkpOwogICAgICAgICAgICAgIHRoaXMucmVzdWx0LnB1c2gocik7CiAgICAgICAgICAgICAgdGhpcy5jcmVhdGVGcmljdGlvbkVxdWF0aW9uc0Zyb21Db250YWN0KHIsIHRoaXMuZnJpY3Rpb25SZXN1bHQpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9IC8vIFRyaWFuZ2xlIGZhY2VzCgoKICAgICAgY29uc3QgdmEgPSBzcGhlcmVUcmltZXNoX3ZhOwogICAgICBjb25zdCB2YiA9IHNwaGVyZVRyaW1lc2hfdmI7CiAgICAgIGNvbnN0IHZjID0gc3BoZXJlVHJpbWVzaF92YzsKICAgICAgY29uc3Qgbm9ybWFsID0gc3BoZXJlVHJpbWVzaF9ub3JtYWw7CgogICAgICBmb3IgKGxldCBpID0gMCwgTiA9IHRyaWFuZ2xlcy5sZW5ndGg7IGkgIT09IE47IGkrKykgewogICAgICAgIHRyaW1lc2hTaGFwZS5nZXRUcmlhbmdsZVZlcnRpY2VzKHRyaWFuZ2xlc1tpXSwgdmEsIHZiLCB2Yyk7CiAgICAgICAgdHJpbWVzaFNoYXBlLmdldE5vcm1hbCh0cmlhbmdsZXNbaV0sIG5vcm1hbCk7CiAgICAgICAgbG9jYWxTcGhlcmVQb3MudnN1Yih2YSwgdG1wKTsKICAgICAgICBsZXQgZGlzdCA9IHRtcC5kb3Qobm9ybWFsKTsKICAgICAgICBub3JtYWwuc2NhbGUoZGlzdCwgdG1wKTsKICAgICAgICBsb2NhbFNwaGVyZVBvcy52c3ViKHRtcCwgdG1wKTsgLy8gdG1wIGlzIG5vdyB0aGUgc3BoZXJlIHBvc2l0aW9uIHByb2plY3RlZCB0byB0aGUgdHJpYW5nbGUgcGxhbmUKCiAgICAgICAgZGlzdCA9IHRtcC5kaXN0YW5jZVRvKGxvY2FsU3BoZXJlUG9zKTsKCiAgICAgICAgaWYgKFJheS5wb2ludEluVHJpYW5nbGUodG1wLCB2YSwgdmIsIHZjKSAmJiBkaXN0IDwgc3BoZXJlU2hhcGUucmFkaXVzKSB7CiAgICAgICAgICBpZiAoanVzdFRlc3QpIHsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICB9CgogICAgICAgICAgbGV0IHIgPSB0aGlzLmNyZWF0ZUNvbnRhY3RFcXVhdGlvbihzcGhlcmVCb2R5LCB0cmltZXNoQm9keSwgc3BoZXJlU2hhcGUsIHRyaW1lc2hTaGFwZSwgcnNpLCByc2opOwogICAgICAgICAgdG1wLnZzdWIobG9jYWxTcGhlcmVQb3MsIHIubmkpOwogICAgICAgICAgci5uaS5ub3JtYWxpemUoKTsKICAgICAgICAgIHIubmkuc2NhbGUoc3BoZXJlU2hhcGUucmFkaXVzLCByLnJpKTsKICAgICAgICAgIHIucmkudmFkZChzcGhlcmVQb3MsIHIucmkpOwogICAgICAgICAgci5yaS52c3ViKHNwaGVyZUJvZHkucG9zaXRpb24sIHIucmkpOwogICAgICAgICAgVHJhbnNmb3JtLnBvaW50VG9Xb3JsZEZyYW1lKHRyaW1lc2hQb3MsIHRyaW1lc2hRdWF0LCB0bXAsIHRtcCk7CiAgICAgICAgICB0bXAudnN1Yih0cmltZXNoQm9keS5wb3NpdGlvbiwgci5yaik7CiAgICAgICAgICBUcmFuc2Zvcm0udmVjdG9yVG9Xb3JsZEZyYW1lKHRyaW1lc2hRdWF0LCByLm5pLCByLm5pKTsKICAgICAgICAgIFRyYW5zZm9ybS52ZWN0b3JUb1dvcmxkRnJhbWUodHJpbWVzaFF1YXQsIHIucmksIHIucmkpOwogICAgICAgICAgdGhpcy5yZXN1bHQucHVzaChyKTsKICAgICAgICAgIHRoaXMuY3JlYXRlRnJpY3Rpb25FcXVhdGlvbnNGcm9tQ29udGFjdChyLCB0aGlzLmZyaWN0aW9uUmVzdWx0KTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIHRyaWFuZ2xlcy5sZW5ndGggPSAwOwogICAgfQoKICAgIHBsYW5lVHJpbWVzaChwbGFuZVNoYXBlLCB0cmltZXNoU2hhcGUsIHBsYW5lUG9zLCB0cmltZXNoUG9zLCBwbGFuZVF1YXQsIHRyaW1lc2hRdWF0LCBwbGFuZUJvZHksIHRyaW1lc2hCb2R5LCByc2ksIHJzaiwganVzdFRlc3QpIHsKICAgICAgLy8gTWFrZSBjb250YWN0cyEKICAgICAgY29uc3QgdiA9IG5ldyBWZWMzKCk7CiAgICAgIGNvbnN0IG5vcm1hbCA9IHBsYW5lVHJpbWVzaF9ub3JtYWw7CiAgICAgIG5vcm1hbC5zZXQoMCwgMCwgMSk7CiAgICAgIHBsYW5lUXVhdC52bXVsdChub3JtYWwsIG5vcm1hbCk7IC8vIFR1cm4gbm9ybWFsIGFjY29yZGluZyB0byBwbGFuZQoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0cmltZXNoU2hhcGUudmVydGljZXMubGVuZ3RoIC8gMzsgaSsrKSB7CiAgICAgICAgLy8gR2V0IHdvcmxkIHZlcnRleCBmcm9tIHRyaW1lc2gKICAgICAgICB0cmltZXNoU2hhcGUuZ2V0VmVydGV4KGksIHYpOyAvLyBTYWZlIHVwCgogICAgICAgIGNvbnN0IHYyID0gbmV3IFZlYzMoKTsKICAgICAgICB2Mi5jb3B5KHYpOwogICAgICAgIFRyYW5zZm9ybS5wb2ludFRvV29ybGRGcmFtZSh0cmltZXNoUG9zLCB0cmltZXNoUXVhdCwgdjIsIHYpOyAvLyBDaGVjayBwbGFuZSBzaWRlCgogICAgICAgIGNvbnN0IHJlbHBvcyA9IHBsYW5lVHJpbWVzaF9yZWxwb3M7CiAgICAgICAgdi52c3ViKHBsYW5lUG9zLCByZWxwb3MpOwogICAgICAgIGNvbnN0IGRvdCA9IG5vcm1hbC5kb3QocmVscG9zKTsKCiAgICAgICAgaWYgKGRvdCA8PSAwLjApIHsKICAgICAgICAgIGlmIChqdXN0VGVzdCkgewogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgIH0KCiAgICAgICAgICBjb25zdCByID0gdGhpcy5jcmVhdGVDb250YWN0RXF1YXRpb24ocGxhbmVCb2R5LCB0cmltZXNoQm9keSwgcGxhbmVTaGFwZSwgdHJpbWVzaFNoYXBlLCByc2ksIHJzaik7CiAgICAgICAgICByLm5pLmNvcHkobm9ybWFsKTsgLy8gQ29udGFjdCBub3JtYWwgaXMgdGhlIHBsYW5lIG5vcm1hbAogICAgICAgICAgLy8gR2V0IHZlcnRleCBwb3NpdGlvbiBwcm9qZWN0ZWQgb24gcGxhbmUKCiAgICAgICAgICBjb25zdCBwcm9qZWN0ZWQgPSBwbGFuZVRyaW1lc2hfcHJvamVjdGVkOwogICAgICAgICAgbm9ybWFsLnNjYWxlKHJlbHBvcy5kb3Qobm9ybWFsKSwgcHJvamVjdGVkKTsKICAgICAgICAgIHYudnN1Yihwcm9qZWN0ZWQsIHByb2plY3RlZCk7IC8vIHJpIGlzIHRoZSBwcm9qZWN0ZWQgd29ybGQgcG9zaXRpb24gbWludXMgcGxhbmUgcG9zaXRpb24KCiAgICAgICAgICByLnJpLmNvcHkocHJvamVjdGVkKTsKICAgICAgICAgIHIucmkudnN1YihwbGFuZUJvZHkucG9zaXRpb24sIHIucmkpOwogICAgICAgICAgci5yai5jb3B5KHYpOwogICAgICAgICAgci5yai52c3ViKHRyaW1lc2hCb2R5LnBvc2l0aW9uLCByLnJqKTsgLy8gU3RvcmUgcmVzdWx0CgogICAgICAgICAgdGhpcy5yZXN1bHQucHVzaChyKTsKICAgICAgICAgIHRoaXMuY3JlYXRlRnJpY3Rpb25FcXVhdGlvbnNGcm9tQ29udGFjdChyLCB0aGlzLmZyaWN0aW9uUmVzdWx0KTsKICAgICAgICB9CiAgICAgIH0KICAgIH0gLy8gY29udmV4VHJpbWVzaCgKICAgIC8vICAgc2k6IENvbnZleFBvbHloZWRyb24sIHNqOiBUcmltZXNoLCB4aTogVmVjMywgeGo6IFZlYzMsIHFpOiBRdWF0ZXJuaW9uLCBxajogUXVhdGVybmlvbiwKICAgIC8vICAgYmk6IEJvZHksIGJqOiBCb2R5LCByc2k/OiBTaGFwZSB8IG51bGwsIHJzaj86IFNoYXBlIHwgbnVsbCwKICAgIC8vICAgZmFjZUxpc3RBPzogbnVtYmVyW10gfCBudWxsLCBmYWNlTGlzdEI/OiBudW1iZXJbXSB8IG51bGwsCiAgICAvLyApIHsKICAgIC8vICAgY29uc3Qgc2VwQXhpcyA9IGNvbnZleENvbnZleF9zZXBBeGlzOwogICAgLy8gICBpZih4aS5kaXN0YW5jZVRvKHhqKSA+IHNpLmJvdW5kaW5nU3BoZXJlUmFkaXVzICsgc2ouYm91bmRpbmdTcGhlcmVSYWRpdXMpewogICAgLy8gICAgICAgcmV0dXJuOwogICAgLy8gICB9CiAgICAvLyAgIC8vIENvbnN0cnVjdCBhIHRlbXAgaHVsbCBmb3IgZWFjaCB0cmlhbmdsZQogICAgLy8gICBjb25zdCBodWxsQiA9IG5ldyBDb252ZXhQb2x5aGVkcm9uKCk7CiAgICAvLyAgIGh1bGxCLmZhY2VzID0gW1swLDEsMl1dOwogICAgLy8gICBjb25zdCB2YSA9IG5ldyBWZWMzKCk7CiAgICAvLyAgIGNvbnN0IHZiID0gbmV3IFZlYzMoKTsKICAgIC8vICAgY29uc3QgdmMgPSBuZXcgVmVjMygpOwogICAgLy8gICBodWxsQi52ZXJ0aWNlcyA9IFsKICAgIC8vICAgICAgIHZhLAogICAgLy8gICAgICAgdmIsCiAgICAvLyAgICAgICB2YwogICAgLy8gICBdOwogICAgLy8gICBmb3IgKGxldCBpID0gMDsgaSA8IHNqLmluZGljZXMubGVuZ3RoIC8gMzsgaSsrKSB7CiAgICAvLyAgICAgICBjb25zdCB0cmlhbmdsZU5vcm1hbCA9IG5ldyBWZWMzKCk7CiAgICAvLyAgICAgICBzai5nZXROb3JtYWwoaSwgdHJpYW5nbGVOb3JtYWwpOwogICAgLy8gICAgICAgaHVsbEIuZmFjZU5vcm1hbHMgPSBbdHJpYW5nbGVOb3JtYWxdOwogICAgLy8gICAgICAgc2ouZ2V0VHJpYW5nbGVWZXJ0aWNlcyhpLCB2YSwgdmIsIHZjKTsKICAgIC8vICAgICAgIGxldCBkID0gc2kudGVzdFNlcEF4aXModHJpYW5nbGVOb3JtYWwsIGh1bGxCLCB4aSwgcWksIHhqLCBxaik7CiAgICAvLyAgICAgICBpZighZCl7CiAgICAvLyAgICAgICAgICAgdHJpYW5nbGVOb3JtYWwuc2NhbGUoLTEsIHRyaWFuZ2xlTm9ybWFsKTsKICAgIC8vICAgICAgICAgICBkID0gc2kudGVzdFNlcEF4aXModHJpYW5nbGVOb3JtYWwsIGh1bGxCLCB4aSwgcWksIHhqLCBxaik7CiAgICAvLyAgICAgICAgICAgaWYoIWQpewogICAgLy8gICAgICAgICAgICAgICBjb250aW51ZTsKICAgIC8vICAgICAgICAgICB9CiAgICAvLyAgICAgICB9CiAgICAvLyAgICAgICBjb25zdCByZXM6IENvbnZleFBvbHloZWRyb25Db250YWN0UG9pbnRbXSA9IFtdOwogICAgLy8gICAgICAgY29uc3QgcSA9IGNvbnZleENvbnZleF9xOwogICAgLy8gICAgICAgc2kuY2xpcEFnYWluc3RIdWxsKHhpLHFpLGh1bGxCLHhqLHFqLHRyaWFuZ2xlTm9ybWFsLC0xMDAsMTAwLHJlcyk7CiAgICAvLyAgICAgICBmb3IobGV0IGogPSAwOyBqICE9PSByZXMubGVuZ3RoOyBqKyspewogICAgLy8gICAgICAgICAgIGNvbnN0IHIgPSB0aGlzLmNyZWF0ZUNvbnRhY3RFcXVhdGlvbihiaSxiaixzaSxzaixyc2kscnNqKSwKICAgIC8vICAgICAgICAgICAgICAgcmkgPSByLnJpLAogICAgLy8gICAgICAgICAgICAgICByaiA9IHIucmo7CiAgICAvLyAgICAgICAgICAgci5uaS5jb3B5KHRyaWFuZ2xlTm9ybWFsKTsKICAgIC8vICAgICAgICAgICByLm5pLm5lZ2F0ZShyLm5pKTsKICAgIC8vICAgICAgICAgICByZXNbal0ubm9ybWFsLm5lZ2F0ZShxKTsKICAgIC8vICAgICAgICAgICBxLm11bHQocmVzW2pdLmRlcHRoLCBxKTsKICAgIC8vICAgICAgICAgICByZXNbal0ucG9pbnQudmFkZChxLCByaSk7CiAgICAvLyAgICAgICAgICAgcmouY29weShyZXNbal0ucG9pbnQpOwogICAgLy8gICAgICAgICAgIC8vIENvbnRhY3QgcG9pbnRzIGFyZSBpbiB3b3JsZCBjb29yZGluYXRlcy4gVHJhbnNmb3JtIGJhY2sgdG8gcmVsYXRpdmUKICAgIC8vICAgICAgICAgICByaS52c3ViKHhpLHJpKTsKICAgIC8vICAgICAgICAgICByai52c3ViKHhqLHJqKTsKICAgIC8vICAgICAgICAgICAvLyBNYWtlIHJlbGF0aXZlIHRvIGJvZGllcwogICAgLy8gICAgICAgICAgIHJpLnZhZGQoeGksIHJpKTsKICAgIC8vICAgICAgICAgICByaS52c3ViKGJpLnBvc2l0aW9uLCByaSk7CiAgICAvLyAgICAgICAgICAgcmoudmFkZCh4aiwgcmopOwogICAgLy8gICAgICAgICAgIHJqLnZzdWIoYmoucG9zaXRpb24sIHJqKTsKICAgIC8vICAgICAgICAgICByZXN1bHQucHVzaChyKTsKICAgIC8vICAgICAgIH0KICAgIC8vICAgfQogICAgLy8gfQoKCiAgfQogIGNvbnN0IGF2ZXJhZ2VOb3JtYWwgPSBuZXcgVmVjMygpOwogIGNvbnN0IGF2ZXJhZ2VDb250YWN0UG9pbnRBID0gbmV3IFZlYzMoKTsKICBjb25zdCBhdmVyYWdlQ29udGFjdFBvaW50QiA9IG5ldyBWZWMzKCk7CiAgY29uc3QgdG1wVmVjMSA9IG5ldyBWZWMzKCk7CiAgY29uc3QgdG1wVmVjMiA9IG5ldyBWZWMzKCk7CiAgY29uc3QgdG1wUXVhdDEgPSBuZXcgUXVhdGVybmlvbigpOwogIGNvbnN0IHRtcFF1YXQyID0gbmV3IFF1YXRlcm5pb24oKTsKCiAgY29uc3QgcGxhbmVUcmltZXNoX25vcm1hbCA9IG5ldyBWZWMzKCk7CiAgY29uc3QgcGxhbmVUcmltZXNoX3JlbHBvcyA9IG5ldyBWZWMzKCk7CiAgY29uc3QgcGxhbmVUcmltZXNoX3Byb2plY3RlZCA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlVHJpbWVzaF9ub3JtYWwgPSBuZXcgVmVjMygpOwogIGNvbnN0IHNwaGVyZVRyaW1lc2hfcmVscG9zID0gbmV3IFZlYzMoKTsKICBuZXcgVmVjMygpOwogIGNvbnN0IHNwaGVyZVRyaW1lc2hfdiA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlVHJpbWVzaF92MiA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlVHJpbWVzaF9lZGdlVmVydGV4QSA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlVHJpbWVzaF9lZGdlVmVydGV4QiA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlVHJpbWVzaF9lZGdlVmVjdG9yID0gbmV3IFZlYzMoKTsKICBjb25zdCBzcGhlcmVUcmltZXNoX2VkZ2VWZWN0b3JVbml0ID0gbmV3IFZlYzMoKTsKICBjb25zdCBzcGhlcmVUcmltZXNoX2xvY2FsU3BoZXJlUG9zID0gbmV3IFZlYzMoKTsKICBjb25zdCBzcGhlcmVUcmltZXNoX3RtcCA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlVHJpbWVzaF92YSA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlVHJpbWVzaF92YiA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlVHJpbWVzaF92YyA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlVHJpbWVzaF9sb2NhbFNwaGVyZUFBQkIgPSBuZXcgQUFCQigpOwogIGNvbnN0IHNwaGVyZVRyaW1lc2hfdHJpYW5nbGVzID0gW107CiAgY29uc3QgcG9pbnRfb25fcGxhbmVfdG9fc3BoZXJlID0gbmV3IFZlYzMoKTsKICBjb25zdCBwbGFuZV90b19zcGhlcmVfb3J0aG8gPSBuZXcgVmVjMygpOyAvLyBTZWUgaHR0cDovL2J1bGxldHBoeXNpY3MuY29tL0J1bGxldC9CdWxsZXRGdWxsL1NwaGVyZVRyaWFuZ2xlRGV0ZWN0b3JfOGNwcF9zb3VyY2UuaHRtbAoKICBjb25zdCBwb2ludEluUG9seWdvbl9lZGdlID0gbmV3IFZlYzMoKTsKICBjb25zdCBwb2ludEluUG9seWdvbl9lZGdlX3hfbm9ybWFsID0gbmV3IFZlYzMoKTsKICBjb25zdCBwb2ludEluUG9seWdvbl92dHAgPSBuZXcgVmVjMygpOwoKICBmdW5jdGlvbiBwb2ludEluUG9seWdvbih2ZXJ0cywgbm9ybWFsLCBwKSB7CiAgICBsZXQgcG9zaXRpdmVSZXN1bHQgPSBudWxsOwogICAgY29uc3QgTiA9IHZlcnRzLmxlbmd0aDsKCiAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gTjsgaSsrKSB7CiAgICAgIGNvbnN0IHYgPSB2ZXJ0c1tpXTsgLy8gR2V0IGVkZ2UgdG8gdGhlIG5leHQgdmVydGV4CgogICAgICBjb25zdCBlZGdlID0gcG9pbnRJblBvbHlnb25fZWRnZTsKICAgICAgdmVydHNbKGkgKyAxKSAlIE5dLnZzdWIodiwgZWRnZSk7IC8vIEdldCBjcm9zcyBwcm9kdWN0IGJldHdlZW4gcG9seWdvbiBub3JtYWwgYW5kIHRoZSBlZGdlCgogICAgICBjb25zdCBlZGdlX3hfbm9ybWFsID0gcG9pbnRJblBvbHlnb25fZWRnZV94X25vcm1hbDsgLy9jb25zdCBlZGdlX3hfbm9ybWFsID0gbmV3IFZlYzMoKTsKCiAgICAgIGVkZ2UuY3Jvc3Mobm9ybWFsLCBlZGdlX3hfbm9ybWFsKTsgLy8gR2V0IHZlY3RvciBiZXR3ZWVuIHBvaW50IGFuZCBjdXJyZW50IHZlcnRleAoKICAgICAgY29uc3QgdmVydGV4X3RvX3AgPSBwb2ludEluUG9seWdvbl92dHA7CiAgICAgIHAudnN1Yih2LCB2ZXJ0ZXhfdG9fcCk7IC8vIFRoaXMgZG90IHByb2R1Y3QgZGV0ZXJtaW5lcyB3aGljaCBzaWRlIG9mIHRoZSBlZGdlIHRoZSBwb2ludCBpcwoKICAgICAgY29uc3QgciA9IGVkZ2VfeF9ub3JtYWwuZG90KHZlcnRleF90b19wKTsgLy8gSWYgYWxsIHN1Y2ggZG90IHByb2R1Y3RzIGhhdmUgc2FtZSBzaWduLCB3ZSBhcmUgaW5zaWRlIHRoZSBwb2x5Z29uLgoKICAgICAgaWYgKHBvc2l0aXZlUmVzdWx0ID09PSBudWxsIHx8IHIgPiAwICYmIHBvc2l0aXZlUmVzdWx0ID09PSB0cnVlIHx8IHIgPD0gMCAmJiBwb3NpdGl2ZVJlc3VsdCA9PT0gZmFsc2UpIHsKICAgICAgICBpZiAocG9zaXRpdmVSZXN1bHQgPT09IG51bGwpIHsKICAgICAgICAgIHBvc2l0aXZlUmVzdWx0ID0gciA+IDA7CiAgICAgICAgfQoKICAgICAgICBjb250aW51ZTsKICAgICAgfSBlbHNlIHsKICAgICAgICByZXR1cm4gZmFsc2U7IC8vIEVuY291bnRlcmVkIHNvbWUgb3RoZXIgc2lnbi4gRXhpdC4KICAgICAgfQogICAgfSAvLyBJZiB3ZSBnb3QgaGVyZSwgYWxsIGRvdCBwcm9kdWN0cyB3ZXJlIG9mIHRoZSBzYW1lIHNpZ24uCgoKICAgIHJldHVybiB0cnVlOwogIH0KCiAgY29uc3QgYm94X3RvX3NwaGVyZSA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlQm94X25zID0gbmV3IFZlYzMoKTsKICBjb25zdCBzcGhlcmVCb3hfbnMxID0gbmV3IFZlYzMoKTsKICBjb25zdCBzcGhlcmVCb3hfbnMyID0gbmV3IFZlYzMoKTsKICBjb25zdCBzcGhlcmVCb3hfc2lkZXMgPSBbbmV3IFZlYzMoKSwgbmV3IFZlYzMoKSwgbmV3IFZlYzMoKSwgbmV3IFZlYzMoKSwgbmV3IFZlYzMoKSwgbmV3IFZlYzMoKV07CiAgY29uc3Qgc3BoZXJlQm94X3NwaGVyZV90b19jb3JuZXIgPSBuZXcgVmVjMygpOwogIGNvbnN0IHNwaGVyZUJveF9zaWRlX25zID0gbmV3IFZlYzMoKTsKICBjb25zdCBzcGhlcmVCb3hfc2lkZV9uczEgPSBuZXcgVmVjMygpOwogIGNvbnN0IHNwaGVyZUJveF9zaWRlX25zMiA9IG5ldyBWZWMzKCk7CiAgY29uc3QgY29udmV4X3RvX3NwaGVyZSA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlQ29udmV4X2VkZ2UgPSBuZXcgVmVjMygpOwogIGNvbnN0IHNwaGVyZUNvbnZleF9lZGdlVW5pdCA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlQ29udmV4X3NwaGVyZVRvQ29ybmVyID0gbmV3IFZlYzMoKTsKICBjb25zdCBzcGhlcmVDb252ZXhfd29ybGRDb3JuZXIgPSBuZXcgVmVjMygpOwogIGNvbnN0IHNwaGVyZUNvbnZleF93b3JsZE5vcm1hbCA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlQ29udmV4X3dvcmxkUG9pbnQgPSBuZXcgVmVjMygpOwogIGNvbnN0IHNwaGVyZUNvbnZleF93b3JsZFNwaGVyZVBvaW50Q2xvc2VzdFRvUGxhbmUgPSBuZXcgVmVjMygpOwogIGNvbnN0IHNwaGVyZUNvbnZleF9wZW5ldHJhdGlvblZlYyA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlQ29udmV4X3NwaGVyZVRvV29ybGRQb2ludCA9IG5ldyBWZWMzKCk7CiAgbmV3IFZlYzMoKTsKICBuZXcgVmVjMygpOwogIGNvbnN0IHBsYW5lQ29udmV4X3YgPSBuZXcgVmVjMygpOwogIGNvbnN0IHBsYW5lQ29udmV4X25vcm1hbCA9IG5ldyBWZWMzKCk7CiAgY29uc3QgcGxhbmVDb252ZXhfcmVscG9zID0gbmV3IFZlYzMoKTsKICBjb25zdCBwbGFuZUNvbnZleF9wcm9qZWN0ZWQgPSBuZXcgVmVjMygpOwogIGNvbnN0IGNvbnZleENvbnZleF9zZXBBeGlzID0gbmV3IFZlYzMoKTsKICBjb25zdCBjb252ZXhDb252ZXhfcSA9IG5ldyBWZWMzKCk7CiAgY29uc3QgcGFydGljbGVQbGFuZV9ub3JtYWwgPSBuZXcgVmVjMygpOwogIGNvbnN0IHBhcnRpY2xlUGxhbmVfcmVscG9zID0gbmV3IFZlYzMoKTsKICBjb25zdCBwYXJ0aWNsZVBsYW5lX3Byb2plY3RlZCA9IG5ldyBWZWMzKCk7CiAgY29uc3QgcGFydGljbGVTcGhlcmVfbm9ybWFsID0gbmV3IFZlYzMoKTsgLy8gV0lQCgogIGNvbnN0IGNxaiA9IG5ldyBRdWF0ZXJuaW9uKCk7CiAgY29uc3QgY29udmV4UGFydGljbGVfbG9jYWwgPSBuZXcgVmVjMygpOwogIG5ldyBWZWMzKCk7CiAgY29uc3QgY29udmV4UGFydGljbGVfcGVuZXRyYXRlZEZhY2VOb3JtYWwgPSBuZXcgVmVjMygpOwogIGNvbnN0IGNvbnZleFBhcnRpY2xlX3ZlcnRleFRvUGFydGljbGUgPSBuZXcgVmVjMygpOwogIGNvbnN0IGNvbnZleFBhcnRpY2xlX3dvcmxkUGVuZXRyYXRpb25WZWMgPSBuZXcgVmVjMygpOwogIGNvbnN0IGNvbnZleEhlaWdodGZpZWxkX3RtcDEgPSBuZXcgVmVjMygpOwogIGNvbnN0IGNvbnZleEhlaWdodGZpZWxkX3RtcDIgPSBuZXcgVmVjMygpOwogIGNvbnN0IGNvbnZleEhlaWdodGZpZWxkX2ZhY2VMaXN0ID0gWzBdOwogIGNvbnN0IHNwaGVyZUhlaWdodGZpZWxkX3RtcDEgPSBuZXcgVmVjMygpOwogIGNvbnN0IHNwaGVyZUhlaWdodGZpZWxkX3RtcDIgPSBuZXcgVmVjMygpOwoKICBjbGFzcyBPdmVybGFwS2VlcGVyIHsKICAgIC8qKgogICAgICogQHRvZG8gUmVtb3ZlIHVzZWxlc3MgY29uc3RydWN0b3IKICAgICAqLwogICAgY29uc3RydWN0b3IoKSB7CiAgICAgIHRoaXMuY3VycmVudCA9IFtdOwogICAgICB0aGlzLnByZXZpb3VzID0gW107CiAgICB9CiAgICAvKioKICAgICAqIGdldEtleQogICAgICovCgoKICAgIGdldEtleShpLCBqKSB7CiAgICAgIGlmIChqIDwgaSkgewogICAgICAgIGNvbnN0IHRlbXAgPSBqOwogICAgICAgIGogPSBpOwogICAgICAgIGkgPSB0ZW1wOwogICAgICB9CgogICAgICByZXR1cm4gaSA8PCAxNiB8IGo7CiAgICB9CiAgICAvKioKICAgICAqIHNldAogICAgICovCgoKICAgIHNldChpLCBqKSB7CiAgICAgIC8vIEluc2VydGlvbiBzb3J0LiBUaGlzIHdheSB0aGUgZGlmZiB3aWxsIGhhdmUgbGluZWFyIGNvbXBsZXhpdHkuCiAgICAgIGNvbnN0IGtleSA9IHRoaXMuZ2V0S2V5KGksIGopOwogICAgICBjb25zdCBjdXJyZW50ID0gdGhpcy5jdXJyZW50OwogICAgICBsZXQgaW5kZXggPSAwOwoKICAgICAgd2hpbGUgKGtleSA+IGN1cnJlbnRbaW5kZXhdKSB7CiAgICAgICAgaW5kZXgrKzsKICAgICAgfQoKICAgICAgaWYgKGtleSA9PT0gY3VycmVudFtpbmRleF0pIHsKICAgICAgICByZXR1cm47IC8vIFBhaXIgd2FzIGFscmVhZHkgYWRkZWQKICAgICAgfQoKICAgICAgZm9yIChsZXQgaiA9IGN1cnJlbnQubGVuZ3RoIC0gMTsgaiA+PSBpbmRleDsgai0tKSB7CiAgICAgICAgY3VycmVudFtqICsgMV0gPSBjdXJyZW50W2pdOwogICAgICB9CgogICAgICBjdXJyZW50W2luZGV4XSA9IGtleTsKICAgIH0KICAgIC8qKgogICAgICogdGljawogICAgICovCgoKICAgIHRpY2soKSB7CiAgICAgIGNvbnN0IHRtcCA9IHRoaXMuY3VycmVudDsKICAgICAgdGhpcy5jdXJyZW50ID0gdGhpcy5wcmV2aW91czsKICAgICAgdGhpcy5wcmV2aW91cyA9IHRtcDsKICAgICAgdGhpcy5jdXJyZW50Lmxlbmd0aCA9IDA7CiAgICB9CiAgICAvKioKICAgICAqIGdldERpZmYKICAgICAqLwoKCiAgICBnZXREaWZmKGFkZGl0aW9ucywgcmVtb3ZhbHMpIHsKICAgICAgY29uc3QgYSA9IHRoaXMuY3VycmVudDsKICAgICAgY29uc3QgYiA9IHRoaXMucHJldmlvdXM7CiAgICAgIGNvbnN0IGFsID0gYS5sZW5ndGg7CiAgICAgIGNvbnN0IGJsID0gYi5sZW5ndGg7CiAgICAgIGxldCBqID0gMDsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgYWw7IGkrKykgewogICAgICAgIGxldCBmb3VuZCA9IGZhbHNlOwogICAgICAgIGNvbnN0IGtleUEgPSBhW2ldOwoKICAgICAgICB3aGlsZSAoa2V5QSA+IGJbal0pIHsKICAgICAgICAgIGorKzsKICAgICAgICB9CgogICAgICAgIGZvdW5kID0ga2V5QSA9PT0gYltqXTsKCiAgICAgICAgaWYgKCFmb3VuZCkgewogICAgICAgICAgdW5wYWNrQW5kUHVzaChhZGRpdGlvbnMsIGtleUEpOwogICAgICAgIH0KICAgICAgfQoKICAgICAgaiA9IDA7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGJsOyBpKyspIHsKICAgICAgICBsZXQgZm91bmQgPSBmYWxzZTsKICAgICAgICBjb25zdCBrZXlCID0gYltpXTsKCiAgICAgICAgd2hpbGUgKGtleUIgPiBhW2pdKSB7CiAgICAgICAgICBqKys7CiAgICAgICAgfQoKICAgICAgICBmb3VuZCA9IGFbal0gPT09IGtleUI7CgogICAgICAgIGlmICghZm91bmQpIHsKICAgICAgICAgIHVucGFja0FuZFB1c2gocmVtb3ZhbHMsIGtleUIpOwogICAgICAgIH0KICAgICAgfQogICAgfQoKICB9CgogIGZ1bmN0aW9uIHVucGFja0FuZFB1c2goYXJyYXksIGtleSkgewogICAgYXJyYXkucHVzaCgoa2V5ICYgMHhmZmZmMDAwMCkgPj4gMTYsIGtleSAmIDB4MDAwMGZmZmYpOwogIH0KCiAgY29uc3QgZ2V0S2V5ID0gKGksIGopID0+IGkgPCBqID8gYCR7aX0tJHtqfWAgOiBgJHtqfS0ke2l9YDsKICAvKioKICAgKiBUdXBsZURpY3Rpb25hcnkKICAgKi8KCgogIGNsYXNzIFR1cGxlRGljdGlvbmFyeSB7CiAgICBjb25zdHJ1Y3RvcigpIHsKICAgICAgdGhpcy5kYXRhID0gewogICAgICAgIGtleXM6IFtdCiAgICAgIH07CiAgICB9CgogICAgLyoqIGdldCAqLwogICAgZ2V0KGksIGopIHsKICAgICAgY29uc3Qga2V5ID0gZ2V0S2V5KGksIGopOwogICAgICByZXR1cm4gdGhpcy5kYXRhW2tleV07CiAgICB9CiAgICAvKiogc2V0ICovCgoKICAgIHNldChpLCBqLCB2YWx1ZSkgewogICAgICBjb25zdCBrZXkgPSBnZXRLZXkoaSwgaik7IC8vIENoZWNrIGlmIGtleSBhbHJlYWR5IGV4aXN0cwoKICAgICAgaWYgKCF0aGlzLmdldChpLCBqKSkgewogICAgICAgIHRoaXMuZGF0YS5rZXlzLnB1c2goa2V5KTsKICAgICAgfQoKICAgICAgdGhpcy5kYXRhW2tleV0gPSB2YWx1ZTsKICAgIH0KICAgIC8qKiBkZWxldGUgKi8KCgogICAgZGVsZXRlKGksIGopIHsKICAgICAgY29uc3Qga2V5ID0gZ2V0S2V5KGksIGopOwogICAgICBjb25zdCBpbmRleCA9IHRoaXMuZGF0YS5rZXlzLmluZGV4T2Yoa2V5KTsKCiAgICAgIGlmIChpbmRleCAhPT0gLTEpIHsKICAgICAgICB0aGlzLmRhdGEua2V5cy5zcGxpY2UoaW5kZXgsIDEpOwogICAgICB9CgogICAgICBkZWxldGUgdGhpcy5kYXRhW2tleV07CiAgICB9CiAgICAvKiogcmVzZXQgKi8KCgogICAgcmVzZXQoKSB7CiAgICAgIGNvbnN0IGRhdGEgPSB0aGlzLmRhdGE7CiAgICAgIGNvbnN0IGtleXMgPSBkYXRhLmtleXM7CgogICAgICB3aGlsZSAoa2V5cy5sZW5ndGggPiAwKSB7CiAgICAgICAgY29uc3Qga2V5ID0ga2V5cy5wb3AoKTsKICAgICAgICBkZWxldGUgZGF0YVtrZXldOwogICAgICB9CiAgICB9CgogIH0KCiAgLyoqCiAgICogVGhlIHBoeXNpY3Mgd29ybGQKICAgKi8KICBjbGFzcyBXb3JsZCBleHRlbmRzIEV2ZW50VGFyZ2V0IHsKICAgIC8qKgogICAgICogQ3VycmVudGx5IC8gbGFzdCB1c2VkIHRpbWVzdGVwLiBJcyBzZXQgdG8gLTEgaWYgbm90IGF2YWlsYWJsZS4gVGhpcyB2YWx1ZSBpcyB1cGRhdGVkIGJlZm9yZSBlYWNoIGludGVybmFsIHN0ZXAsIHdoaWNoIG1lYW5zIHRoYXQgaXQgaXMgImZyZXNoIiBpbnNpZGUgZXZlbnQgY2FsbGJhY2tzLgogICAgICovCgogICAgLyoqCiAgICAgKiBNYWtlcyBib2RpZXMgZ28gdG8gc2xlZXAgd2hlbiB0aGV5J3ZlIGJlZW4gaW5hY3RpdmUuCiAgICAgKiBAZGVmYXVsdCBmYWxzZQogICAgICovCgogICAgLyoqCiAgICAgKiBBbGwgdGhlIGN1cnJlbnQgY29udGFjdHMgKGluc3RhbmNlcyBvZiBDb250YWN0RXF1YXRpb24pIGluIHRoZSB3b3JsZC4KICAgICAqLwoKICAgIC8qKgogICAgICogSG93IG9mdGVuIHRvIG5vcm1hbGl6ZSBxdWF0ZXJuaW9ucy4gU2V0IHRvIDAgZm9yIGV2ZXJ5IHN0ZXAsIDEgZm9yIGV2ZXJ5IHNlY29uZCBldGMuLiBBIGxhcmdlciB2YWx1ZSBpbmNyZWFzZXMgcGVyZm9ybWFuY2UuIElmIGJvZGllcyB0ZW5kIHRvIGV4cGxvZGUsIHNldCB0byBhIHNtYWxsZXIgdmFsdWUgKHplcm8gdG8gYmUgc3VyZSBub3RoaW5nIGNhbiBnbyB3cm9uZykuCiAgICAgKiBAZGVmYXVsdCAwCiAgICAgKi8KCiAgICAvKioKICAgICAqIFNldCB0byB0cnVlIHRvIHVzZSBmYXN0IHF1YXRlcm5pb24gbm9ybWFsaXphdGlvbi4gSXQgaXMgb2Z0ZW4gZW5vdWdoIGFjY3VyYXRlIHRvIHVzZS4KICAgICAqIElmIGJvZGllcyB0ZW5kIHRvIGV4cGxvZGUsIHNldCB0byBmYWxzZS4KICAgICAqIEBkZWZhdWx0IGZhbHNlCiAgICAgKi8KCiAgICAvKioKICAgICAqIFRoZSB3YWxsLWNsb2NrIHRpbWUgc2luY2Ugc2ltdWxhdGlvbiBzdGFydC4KICAgICAqLwoKICAgIC8qKgogICAgICogTnVtYmVyIG9mIHRpbWVzdGVwcyB0YWtlbiBzaW5jZSBzdGFydC4KICAgICAqLwoKICAgIC8qKgogICAgICogRGVmYXVsdCBhbmQgbGFzdCB0aW1lc3RlcCBzaXplcy4KICAgICAqLwoKICAgIC8qKgogICAgICogVGhlIGdyYXZpdHkgb2YgdGhlIHdvcmxkLgogICAgICovCgogICAgLyoqCiAgICAgKiBHcmF2aXR5IHRvIHVzZSB3aGVuIGFwcHJveGltYXRpbmcgdGhlIGZyaWN0aW9uIG1heCBmb3JjZSAobXUqbWFzcypncmF2aXR5KS4KICAgICAqIElmIHVuZGVmaW5lZCwgZ2xvYmFsIGdyYXZpdHkgd2lsbCBiZSB1c2VkLgogICAgICogVXNlIHRvIGVuYWJsZSBmcmljdGlvbiBpbiBhIFdvcmxkIHdpdGggYSBudWxsIGdyYXZpdHkgdmVjdG9yIChubyBncmF2aXR5KS4KICAgICAqLwoKICAgIC8qKgogICAgICogVGhlIGJyb2FkcGhhc2UgYWxnb3JpdGhtIHRvIHVzZS4KICAgICAqIEBkZWZhdWx0IE5haXZlQnJvYWRwaGFzZQogICAgICovCgogICAgLyoqCiAgICAgKiBBbGwgYm9kaWVzIGluIHRoaXMgd29ybGQKICAgICAqLwoKICAgIC8qKgogICAgICogVHJ1ZSBpZiBhbnkgYm9kaWVzIGFyZSBub3Qgc2xlZXBpbmcsIGZhbHNlIGlmIGV2ZXJ5IGJvZHkgaXMgc2xlZXBpbmcuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFRoZSBzb2x2ZXIgYWxnb3JpdGhtIHRvIHVzZS4KICAgICAqIEBkZWZhdWx0IEdTU29sdmVyCiAgICAgKi8KCiAgICAvKioKICAgICAqIGNvbGxpc2lvbk1hdHJpeAogICAgICovCgogICAgLyoqCiAgICAgKiBDb2xsaXNpb25NYXRyaXggZnJvbSB0aGUgcHJldmlvdXMgc3RlcC4KICAgICAqLwoKICAgIC8qKgogICAgICogQWxsIGFkZGVkIGNvbnRhY3RtYXRlcmlhbHMuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFVzZWQgdG8gbG9vayB1cCBhIENvbnRhY3RNYXRlcmlhbCBnaXZlbiB0d28gaW5zdGFuY2VzIG9mIE1hdGVyaWFsLgogICAgICovCgogICAgLyoqCiAgICAgKiBUaGUgZGVmYXVsdCBtYXRlcmlhbCBvZiB0aGUgYm9kaWVzLgogICAgICovCgogICAgLyoqCiAgICAgKiBUaGlzIGNvbnRhY3QgbWF0ZXJpYWwgaXMgdXNlZCBpZiBubyBzdWl0YWJsZSBjb250YWN0bWF0ZXJpYWwgaXMgZm91bmQgZm9yIGEgY29udGFjdC4KICAgICAqLwoKICAgIC8qKgogICAgICogVGltZSBhY2N1bXVsYXRvciBmb3IgaW50ZXJwb2xhdGlvbi4KICAgICAqIEBzZWUgaHR0cHM6Ly9nYWZmZXJvbmdhbWVzLmNvbS9nYW1lLXBoeXNpY3MvZml4LXlvdXItdGltZXN0ZXAvCiAgICAgKi8KCiAgICAvKioKICAgICAqIERpc3BhdGNoZWQgYWZ0ZXIgYSBib2R5IGhhcyBiZWVuIGFkZGVkIHRvIHRoZSB3b3JsZC4KICAgICAqLwoKICAgIC8qKgogICAgICogRGlzcGF0Y2hlZCBhZnRlciBhIGJvZHkgaGFzIGJlZW4gcmVtb3ZlZCBmcm9tIHRoZSB3b3JsZC4KICAgICAqLwogICAgY29uc3RydWN0b3Iob3B0aW9ucykgewogICAgICBpZiAob3B0aW9ucyA9PT0gdm9pZCAwKSB7CiAgICAgICAgb3B0aW9ucyA9IHt9OwogICAgICB9CgogICAgICBzdXBlcigpOwogICAgICB0aGlzLmR0ID0gLTE7CiAgICAgIHRoaXMuYWxsb3dTbGVlcCA9ICEhb3B0aW9ucy5hbGxvd1NsZWVwOwogICAgICB0aGlzLmNvbnRhY3RzID0gW107CiAgICAgIHRoaXMuZnJpY3Rpb25FcXVhdGlvbnMgPSBbXTsKICAgICAgdGhpcy5xdWF0Tm9ybWFsaXplU2tpcCA9IG9wdGlvbnMucXVhdE5vcm1hbGl6ZVNraXAgIT09IHVuZGVmaW5lZCA/IG9wdGlvbnMucXVhdE5vcm1hbGl6ZVNraXAgOiAwOwogICAgICB0aGlzLnF1YXROb3JtYWxpemVGYXN0ID0gb3B0aW9ucy5xdWF0Tm9ybWFsaXplRmFzdCAhPT0gdW5kZWZpbmVkID8gb3B0aW9ucy5xdWF0Tm9ybWFsaXplRmFzdCA6IGZhbHNlOwogICAgICB0aGlzLnRpbWUgPSAwLjA7CiAgICAgIHRoaXMuc3RlcG51bWJlciA9IDA7CiAgICAgIHRoaXMuZGVmYXVsdF9kdCA9IDEgLyA2MDsKICAgICAgdGhpcy5uZXh0SWQgPSAwOwogICAgICB0aGlzLmdyYXZpdHkgPSBuZXcgVmVjMygpOwoKICAgICAgaWYgKG9wdGlvbnMuZ3Jhdml0eSkgewogICAgICAgIHRoaXMuZ3Jhdml0eS5jb3B5KG9wdGlvbnMuZ3Jhdml0eSk7CiAgICAgIH0KCiAgICAgIGlmIChvcHRpb25zLmZyaWN0aW9uR3Jhdml0eSkgewogICAgICAgIHRoaXMuZnJpY3Rpb25HcmF2aXR5ID0gbmV3IFZlYzMoKTsKICAgICAgICB0aGlzLmZyaWN0aW9uR3Jhdml0eS5jb3B5KG9wdGlvbnMuZnJpY3Rpb25HcmF2aXR5KTsKICAgICAgfQoKICAgICAgdGhpcy5icm9hZHBoYXNlID0gb3B0aW9ucy5icm9hZHBoYXNlICE9PSB1bmRlZmluZWQgPyBvcHRpb25zLmJyb2FkcGhhc2UgOiBuZXcgTmFpdmVCcm9hZHBoYXNlKCk7CiAgICAgIHRoaXMuYm9kaWVzID0gW107CiAgICAgIHRoaXMuaGFzQWN0aXZlQm9kaWVzID0gZmFsc2U7CiAgICAgIHRoaXMuc29sdmVyID0gb3B0aW9ucy5zb2x2ZXIgIT09IHVuZGVmaW5lZCA/IG9wdGlvbnMuc29sdmVyIDogbmV3IEdTU29sdmVyKCk7CiAgICAgIHRoaXMuY29uc3RyYWludHMgPSBbXTsKICAgICAgdGhpcy5uYXJyb3dwaGFzZSA9IG5ldyBOYXJyb3dwaGFzZSh0aGlzKTsKICAgICAgdGhpcy5jb2xsaXNpb25NYXRyaXggPSBuZXcgQXJyYXlDb2xsaXNpb25NYXRyaXgoKTsKICAgICAgdGhpcy5jb2xsaXNpb25NYXRyaXhQcmV2aW91cyA9IG5ldyBBcnJheUNvbGxpc2lvbk1hdHJpeCgpOwogICAgICB0aGlzLmJvZHlPdmVybGFwS2VlcGVyID0gbmV3IE92ZXJsYXBLZWVwZXIoKTsKICAgICAgdGhpcy5zaGFwZU92ZXJsYXBLZWVwZXIgPSBuZXcgT3ZlcmxhcEtlZXBlcigpOwogICAgICB0aGlzLmNvbnRhY3RtYXRlcmlhbHMgPSBbXTsKICAgICAgdGhpcy5jb250YWN0TWF0ZXJpYWxUYWJsZSA9IG5ldyBUdXBsZURpY3Rpb25hcnkoKTsKICAgICAgdGhpcy5kZWZhdWx0TWF0ZXJpYWwgPSBuZXcgTWF0ZXJpYWwoJ2RlZmF1bHQnKTsKICAgICAgdGhpcy5kZWZhdWx0Q29udGFjdE1hdGVyaWFsID0gbmV3IENvbnRhY3RNYXRlcmlhbCh0aGlzLmRlZmF1bHRNYXRlcmlhbCwgdGhpcy5kZWZhdWx0TWF0ZXJpYWwsIHsKICAgICAgICBmcmljdGlvbjogMC4zLAogICAgICAgIHJlc3RpdHV0aW9uOiAwLjAKICAgICAgfSk7CiAgICAgIHRoaXMuZG9Qcm9maWxpbmcgPSBmYWxzZTsKICAgICAgdGhpcy5wcm9maWxlID0gewogICAgICAgIHNvbHZlOiAwLAogICAgICAgIG1ha2VDb250YWN0Q29uc3RyYWludHM6IDAsCiAgICAgICAgYnJvYWRwaGFzZTogMCwKICAgICAgICBpbnRlZ3JhdGU6IDAsCiAgICAgICAgbmFycm93cGhhc2U6IDAKICAgICAgfTsKICAgICAgdGhpcy5hY2N1bXVsYXRvciA9IDA7CiAgICAgIHRoaXMuc3Vic3lzdGVtcyA9IFtdOwogICAgICB0aGlzLmFkZEJvZHlFdmVudCA9IHsKICAgICAgICB0eXBlOiAnYWRkQm9keScsCiAgICAgICAgYm9keTogbnVsbAogICAgICB9OwogICAgICB0aGlzLnJlbW92ZUJvZHlFdmVudCA9IHsKICAgICAgICB0eXBlOiAncmVtb3ZlQm9keScsCiAgICAgICAgYm9keTogbnVsbAogICAgICB9OwogICAgICB0aGlzLmlkVG9Cb2R5TWFwID0ge307CiAgICAgIHRoaXMuYnJvYWRwaGFzZS5zZXRXb3JsZCh0aGlzKTsKICAgIH0KICAgIC8qKgogICAgICogR2V0IHRoZSBjb250YWN0IG1hdGVyaWFsIGJldHdlZW4gbWF0ZXJpYWxzIG0xIGFuZCBtMgogICAgICogQHJldHVybiBUaGUgY29udGFjdCBtYXRlcmlhbCBpZiBpdCB3YXMgZm91bmQuCiAgICAgKi8KCgogICAgZ2V0Q29udGFjdE1hdGVyaWFsKG0xLCBtMikgewogICAgICByZXR1cm4gdGhpcy5jb250YWN0TWF0ZXJpYWxUYWJsZS5nZXQobTEuaWQsIG0yLmlkKTsKICAgIH0KICAgIC8qKgogICAgICogU3RvcmUgb2xkIGNvbGxpc2lvbiBzdGF0ZSBpbmZvCiAgICAgKi8KCgogICAgY29sbGlzaW9uTWF0cml4VGljaygpIHsKICAgICAgY29uc3QgdGVtcCA9IHRoaXMuY29sbGlzaW9uTWF0cml4UHJldmlvdXM7CiAgICAgIHRoaXMuY29sbGlzaW9uTWF0cml4UHJldmlvdXMgPSB0aGlzLmNvbGxpc2lvbk1hdHJpeDsKICAgICAgdGhpcy5jb2xsaXNpb25NYXRyaXggPSB0ZW1wOwogICAgICB0aGlzLmNvbGxpc2lvbk1hdHJpeC5yZXNldCgpOwogICAgICB0aGlzLmJvZHlPdmVybGFwS2VlcGVyLnRpY2soKTsKICAgICAgdGhpcy5zaGFwZU92ZXJsYXBLZWVwZXIudGljaygpOwogICAgfQogICAgLyoqCiAgICAgKiBBZGQgYSBjb25zdHJhaW50IHRvIHRoZSBzaW11bGF0aW9uLgogICAgICovCgoKICAgIGFkZENvbnN0cmFpbnQoYykgewogICAgICB0aGlzLmNvbnN0cmFpbnRzLnB1c2goYyk7CiAgICB9CiAgICAvKioKICAgICAqIFJlbW92ZXMgYSBjb25zdHJhaW50CiAgICAgKi8KCgogICAgcmVtb3ZlQ29uc3RyYWludChjKSB7CiAgICAgIGNvbnN0IGlkeCA9IHRoaXMuY29uc3RyYWludHMuaW5kZXhPZihjKTsKCiAgICAgIGlmIChpZHggIT09IC0xKSB7CiAgICAgICAgdGhpcy5jb25zdHJhaW50cy5zcGxpY2UoaWR4LCAxKTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBSYXljYXN0IHRlc3QKICAgICAqIEBkZXByZWNhdGVkIFVzZSAucmF5Y2FzdEFsbCwgLnJheWNhc3RDbG9zZXN0IG9yIC5yYXljYXN0QW55IGluc3RlYWQuCiAgICAgKi8KCgogICAgcmF5VGVzdChmcm9tLCB0bywgcmVzdWx0KSB7CiAgICAgIGlmIChyZXN1bHQgaW5zdGFuY2VvZiBSYXljYXN0UmVzdWx0KSB7CiAgICAgICAgLy8gRG8gcmF5Y2FzdENsb3Nlc3QKICAgICAgICB0aGlzLnJheWNhc3RDbG9zZXN0KGZyb20sIHRvLCB7CiAgICAgICAgICBza2lwQmFja2ZhY2VzOiB0cnVlCiAgICAgICAgfSwgcmVzdWx0KTsKICAgICAgfSBlbHNlIHsKICAgICAgICAvLyBEbyByYXljYXN0QWxsCiAgICAgICAgdGhpcy5yYXljYXN0QWxsKGZyb20sIHRvLCB7CiAgICAgICAgICBza2lwQmFja2ZhY2VzOiB0cnVlCiAgICAgICAgfSwgcmVzdWx0KTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBSYXkgY2FzdCBhZ2FpbnN0IGFsbCBib2RpZXMuIFRoZSBwcm92aWRlZCBjYWxsYmFjayB3aWxsIGJlIGV4ZWN1dGVkIGZvciBlYWNoIGhpdCB3aXRoIGEgUmF5Y2FzdFJlc3VsdCBhcyBzaW5nbGUgYXJndW1lbnQuCiAgICAgKiBAcmV0dXJuIFRydWUgaWYgYW55IGJvZHkgd2FzIGhpdC4KICAgICAqLwoKCiAgICByYXljYXN0QWxsKGZyb20sIHRvLCBvcHRpb25zLCBjYWxsYmFjaykgewogICAgICBpZiAob3B0aW9ucyA9PT0gdm9pZCAwKSB7CiAgICAgICAgb3B0aW9ucyA9IHt9OwogICAgICB9CgogICAgICBvcHRpb25zLm1vZGUgPSBSYXkuQUxMOwogICAgICBvcHRpb25zLmZyb20gPSBmcm9tOwogICAgICBvcHRpb25zLnRvID0gdG87CiAgICAgIG9wdGlvbnMuY2FsbGJhY2sgPSBjYWxsYmFjazsKICAgICAgcmV0dXJuIHRtcFJheS5pbnRlcnNlY3RXb3JsZCh0aGlzLCBvcHRpb25zKTsKICAgIH0KICAgIC8qKgogICAgICogUmF5IGNhc3QsIGFuZCBzdG9wIGF0IHRoZSBmaXJzdCByZXN1bHQuIE5vdGUgdGhhdCB0aGUgb3JkZXIgaXMgcmFuZG9tIC0gYnV0IHRoZSBtZXRob2QgaXMgZmFzdC4KICAgICAqIEByZXR1cm4gVHJ1ZSBpZiBhbnkgYm9keSB3YXMgaGl0LgogICAgICovCgoKICAgIHJheWNhc3RBbnkoZnJvbSwgdG8sIG9wdGlvbnMsIHJlc3VsdCkgewogICAgICBpZiAob3B0aW9ucyA9PT0gdm9pZCAwKSB7CiAgICAgICAgb3B0aW9ucyA9IHt9OwogICAgICB9CgogICAgICBvcHRpb25zLm1vZGUgPSBSYXkuQU5ZOwogICAgICBvcHRpb25zLmZyb20gPSBmcm9tOwogICAgICBvcHRpb25zLnRvID0gdG87CiAgICAgIG9wdGlvbnMucmVzdWx0ID0gcmVzdWx0OwogICAgICByZXR1cm4gdG1wUmF5LmludGVyc2VjdFdvcmxkKHRoaXMsIG9wdGlvbnMpOwogICAgfQogICAgLyoqCiAgICAgKiBSYXkgY2FzdCwgYW5kIHJldHVybiBpbmZvcm1hdGlvbiBvZiB0aGUgY2xvc2VzdCBoaXQuCiAgICAgKiBAcmV0dXJuIFRydWUgaWYgYW55IGJvZHkgd2FzIGhpdC4KICAgICAqLwoKCiAgICByYXljYXN0Q2xvc2VzdChmcm9tLCB0bywgb3B0aW9ucywgcmVzdWx0KSB7CiAgICAgIGlmIChvcHRpb25zID09PSB2b2lkIDApIHsKICAgICAgICBvcHRpb25zID0ge307CiAgICAgIH0KCiAgICAgIG9wdGlvbnMubW9kZSA9IFJheS5DTE9TRVNUOwogICAgICBvcHRpb25zLmZyb20gPSBmcm9tOwogICAgICBvcHRpb25zLnRvID0gdG87CiAgICAgIG9wdGlvbnMucmVzdWx0ID0gcmVzdWx0OwogICAgICByZXR1cm4gdG1wUmF5LmludGVyc2VjdFdvcmxkKHRoaXMsIG9wdGlvbnMpOwogICAgfQogICAgLyoqCiAgICAgKiBBZGQgYSByaWdpZCBib2R5IHRvIHRoZSBzaW11bGF0aW9uLgogICAgICogQHRvZG8gSWYgdGhlIHNpbXVsYXRpb24gaGFzIG5vdCB5ZXQgc3RhcnRlZCwgd2h5IHJlY3JldGUgYW5kIGNvcHkgYXJyYXlzIGZvciBlYWNoIGJvZHk/IEFjY3VtdWxhdGUgaW4gZHluYW1pYyBhcnJheXMgaW4gdGhpcyBjYXNlLgogICAgICogQHRvZG8gQWRkaW5nIGFuIGFycmF5IG9mIGJvZGllcyBzaG91bGQgYmUgcG9zc2libGUuIFRoaXMgd291bGQgc2F2ZSBzb21lIGxvb3BzIHRvbwogICAgICovCgoKICAgIGFkZEJvZHkoYm9keSkgewogICAgICBpZiAodGhpcy5ib2RpZXMuaW5jbHVkZXMoYm9keSkpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGJvZHkuaW5kZXggPSB0aGlzLmJvZGllcy5sZW5ndGg7CiAgICAgIHRoaXMuYm9kaWVzLnB1c2goYm9keSk7CiAgICAgIGJvZHkud29ybGQgPSB0aGlzOwogICAgICBib2R5LmluaXRQb3NpdGlvbi5jb3B5KGJvZHkucG9zaXRpb24pOwogICAgICBib2R5LmluaXRWZWxvY2l0eS5jb3B5KGJvZHkudmVsb2NpdHkpOwogICAgICBib2R5LnRpbWVMYXN0U2xlZXB5ID0gdGhpcy50aW1lOwoKICAgICAgaWYgKGJvZHkgaW5zdGFuY2VvZiBCb2R5KSB7CiAgICAgICAgYm9keS5pbml0QW5ndWxhclZlbG9jaXR5LmNvcHkoYm9keS5hbmd1bGFyVmVsb2NpdHkpOwogICAgICAgIGJvZHkuaW5pdFF1YXRlcm5pb24uY29weShib2R5LnF1YXRlcm5pb24pOwogICAgICB9CgogICAgICB0aGlzLmNvbGxpc2lvbk1hdHJpeC5zZXROdW1PYmplY3RzKHRoaXMuYm9kaWVzLmxlbmd0aCk7CiAgICAgIHRoaXMuYWRkQm9keUV2ZW50LmJvZHkgPSBib2R5OwogICAgICB0aGlzLmlkVG9Cb2R5TWFwW2JvZHkuaWRdID0gYm9keTsKICAgICAgdGhpcy5kaXNwYXRjaEV2ZW50KHRoaXMuYWRkQm9keUV2ZW50KTsKICAgIH0KICAgIC8qKgogICAgICogUmVtb3ZlIGEgcmlnaWQgYm9keSBmcm9tIHRoZSBzaW11bGF0aW9uLgogICAgICovCgoKICAgIHJlbW92ZUJvZHkoYm9keSkgewogICAgICBib2R5LndvcmxkID0gbnVsbDsKICAgICAgY29uc3QgbiA9IHRoaXMuYm9kaWVzLmxlbmd0aCAtIDE7CiAgICAgIGNvbnN0IGJvZGllcyA9IHRoaXMuYm9kaWVzOwogICAgICBjb25zdCBpZHggPSBib2RpZXMuaW5kZXhPZihib2R5KTsKCiAgICAgIGlmIChpZHggIT09IC0xKSB7CiAgICAgICAgYm9kaWVzLnNwbGljZShpZHgsIDEpOyAvLyBUb2RvOiBzaG91bGQgdXNlIGEgZ2FyYmFnZSBmcmVlIG1ldGhvZAogICAgICAgIC8vIFJlY29tcHV0ZSBpbmRleAoKICAgICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gYm9kaWVzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICBib2RpZXNbaV0uaW5kZXggPSBpOwogICAgICAgIH0KCiAgICAgICAgdGhpcy5jb2xsaXNpb25NYXRyaXguc2V0TnVtT2JqZWN0cyhuKTsKICAgICAgICB0aGlzLnJlbW92ZUJvZHlFdmVudC5ib2R5ID0gYm9keTsKICAgICAgICBkZWxldGUgdGhpcy5pZFRvQm9keU1hcFtib2R5LmlkXTsKICAgICAgICB0aGlzLmRpc3BhdGNoRXZlbnQodGhpcy5yZW1vdmVCb2R5RXZlbnQpOwogICAgICB9CiAgICB9CgogICAgZ2V0Qm9keUJ5SWQoaWQpIHsKICAgICAgcmV0dXJuIHRoaXMuaWRUb0JvZHlNYXBbaWRdOwogICAgfQogICAgLyoqCiAgICAgKiBAdG9kbyBNYWtlIGEgZmFzdGVyIG1hcAogICAgICovCgoKICAgIGdldFNoYXBlQnlJZChpZCkgewogICAgICBjb25zdCBib2RpZXMgPSB0aGlzLmJvZGllczsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgYm9kaWVzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgY29uc3Qgc2hhcGVzID0gYm9kaWVzW2ldLnNoYXBlczsKCiAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCBzaGFwZXMubGVuZ3RoOyBqKyspIHsKICAgICAgICAgIGNvbnN0IHNoYXBlID0gc2hhcGVzW2pdOwoKICAgICAgICAgIGlmIChzaGFwZS5pZCA9PT0gaWQpIHsKICAgICAgICAgICAgcmV0dXJuIHNoYXBlOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQoKICAgICAgcmV0dXJuIG51bGw7CiAgICB9CiAgICAvKioKICAgICAqIEFkZHMgYSBjb250YWN0IG1hdGVyaWFsIHRvIHRoZSBXb3JsZAogICAgICovCgoKICAgIGFkZENvbnRhY3RNYXRlcmlhbChjbWF0KSB7CiAgICAgIC8vIEFkZCBjb250YWN0IG1hdGVyaWFsCiAgICAgIHRoaXMuY29udGFjdG1hdGVyaWFscy5wdXNoKGNtYXQpOyAvLyBBZGQgY3VycmVudCBjb250YWN0IG1hdGVyaWFsIHRvIHRoZSBtYXRlcmlhbCB0YWJsZQoKICAgICAgdGhpcy5jb250YWN0TWF0ZXJpYWxUYWJsZS5zZXQoY21hdC5tYXRlcmlhbHNbMF0uaWQsIGNtYXQubWF0ZXJpYWxzWzFdLmlkLCBjbWF0KTsKICAgIH0KICAgIC8qKgogICAgICogUmVtb3ZlcyBhIGNvbnRhY3QgbWF0ZXJpYWwgZnJvbSB0aGUgV29ybGQuCiAgICAgKi8KCgogICAgcmVtb3ZlQ29udGFjdE1hdGVyaWFsKGNtYXQpIHsKICAgICAgY29uc3QgaWR4ID0gdGhpcy5jb250YWN0bWF0ZXJpYWxzLmluZGV4T2YoY21hdCk7CgogICAgICBpZiAoaWR4ID09PSAtMSkgewogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgdGhpcy5jb250YWN0bWF0ZXJpYWxzLnNwbGljZShpZHgsIDEpOwogICAgICB0aGlzLmNvbnRhY3RNYXRlcmlhbFRhYmxlLmRlbGV0ZShjbWF0Lm1hdGVyaWFsc1swXS5pZCwgY21hdC5tYXRlcmlhbHNbMV0uaWQpOwogICAgfQogICAgLyoqCiAgICAgKiBTdGVwIHRoZSBzaW11bGF0aW9uIGZvcndhcmQga2VlcGluZyB0cmFjayBvZiBsYXN0IGNhbGxlZCB0aW1lCiAgICAgKiB0byBiZSBhYmxlIHRvIHN0ZXAgdGhlIHdvcmxkIGF0IGEgZml4ZWQgcmF0ZSwgaW5kZXBlbmRlbnRseSBvZiBmcmFtZXJhdGUuCiAgICAgKgogICAgICogQHBhcmFtIGR0IFRoZSBmaXhlZCB0aW1lIHN0ZXAgc2l6ZSB0byB1c2UgKGRlZmF1bHQ6IDEgLyA2MCkuCiAgICAgKiBAcGFyYW0gbWF4U3ViU3RlcHMgTWF4aW11bSBudW1iZXIgb2YgZml4ZWQgc3RlcHMgdG8gdGFrZSBwZXIgZnVuY3Rpb24gY2FsbCAoZGVmYXVsdDogMTApLgogICAgICogQHNlZSBodHRwczovL2dhZmZlcm9uZ2FtZXMuY29tL3Bvc3QvZml4X3lvdXJfdGltZXN0ZXAvCiAgICAgKiBAZXhhbXBsZQogICAgICogICAgIC8vIFJ1biB0aGUgc2ltdWxhdGlvbiBpbmRlcGVuZGVudGx5IG9mIGZyYW1lcmF0ZSBldmVyeSAxIC8gNjAgbXMKICAgICAqICAgICB3b3JsZC5maXhlZFN0ZXAoKQogICAgICovCgoKICAgIGZpeGVkU3RlcChkdCwgbWF4U3ViU3RlcHMpIHsKICAgICAgaWYgKGR0ID09PSB2b2lkIDApIHsKICAgICAgICBkdCA9IDEgLyA2MDsKICAgICAgfQoKICAgICAgaWYgKG1heFN1YlN0ZXBzID09PSB2b2lkIDApIHsKICAgICAgICBtYXhTdWJTdGVwcyA9IDEwOwogICAgICB9CgogICAgICBjb25zdCB0aW1lID0gcGVyZm9ybWFuY2Uubm93KCkgLyAxMDAwOyAvLyBzZWNvbmRzCgogICAgICBpZiAoIXRoaXMubGFzdENhbGxUaW1lKSB7CiAgICAgICAgdGhpcy5zdGVwKGR0LCB1bmRlZmluZWQsIG1heFN1YlN0ZXBzKTsKICAgICAgfSBlbHNlIHsKICAgICAgICBjb25zdCB0aW1lU2luY2VMYXN0Q2FsbGVkID0gdGltZSAtIHRoaXMubGFzdENhbGxUaW1lOwogICAgICAgIHRoaXMuc3RlcChkdCwgdGltZVNpbmNlTGFzdENhbGxlZCwgbWF4U3ViU3RlcHMpOwogICAgICB9CgogICAgICB0aGlzLmxhc3RDYWxsVGltZSA9IHRpbWU7CiAgICB9CiAgICAvKioKICAgICAqIFN0ZXAgdGhlIHBoeXNpY3Mgd29ybGQgZm9yd2FyZCBpbiB0aW1lLgogICAgICoKICAgICAqIFRoZXJlIGFyZSB0d28gbW9kZXMuIFRoZSBzaW1wbGUgbW9kZSBpcyBmaXhlZCB0aW1lc3RlcHBpbmcgd2l0aG91dCBpbnRlcnBvbGF0aW9uLiBJbiB0aGlzIGNhc2UgeW91IG9ubHkgdXNlIHRoZSBmaXJzdCBhcmd1bWVudC4gVGhlIHNlY29uZCBjYXNlIHVzZXMgaW50ZXJwb2xhdGlvbi4gSW4gdGhhdCB5b3UgYWxzbyBwcm92aWRlIHRoZSB0aW1lIHNpbmNlIHRoZSBmdW5jdGlvbiB3YXMgbGFzdCB1c2VkLCBhcyB3ZWxsIGFzIHRoZSBtYXhpbXVtIGZpeGVkIHRpbWVzdGVwcyB0byB0YWtlLgogICAgICoKICAgICAqIEBwYXJhbSBkdCBUaGUgZml4ZWQgdGltZSBzdGVwIHNpemUgdG8gdXNlLgogICAgICogQHBhcmFtIHRpbWVTaW5jZUxhc3RDYWxsZWQgVGhlIHRpbWUgZWxhcHNlZCBzaW5jZSB0aGUgZnVuY3Rpb24gd2FzIGxhc3QgY2FsbGVkLgogICAgICogQHBhcmFtIG1heFN1YlN0ZXBzIE1heGltdW0gbnVtYmVyIG9mIGZpeGVkIHN0ZXBzIHRvIHRha2UgcGVyIGZ1bmN0aW9uIGNhbGwgKGRlZmF1bHQ6IDEwKS4KICAgICAqIEBzZWUgaHR0cHM6Ly93ZWIuYXJjaGl2ZS5vcmcvd2ViLzIwMTgwNDI2MTU0NTMxL2h0dHA6Ly9idWxsZXRwaHlzaWNzLm9yZy9tZWRpYXdpa2ktMS41LjgvaW5kZXgucGhwL1N0ZXBwaW5nX1RoZV9Xb3JsZCNXaGF0X2RvX3RoZV9wYXJhbWV0ZXJzX3RvX2J0RHluYW1pY3NXb3JsZDo6c3RlcFNpbXVsYXRpb25fbWVhbi4zRgogICAgICogQGV4YW1wbGUKICAgICAqICAgICAvLyBmaXhlZCB0aW1lc3RlcHBpbmcgd2l0aG91dCBpbnRlcnBvbGF0aW9uCiAgICAgKiAgICAgd29ybGQuc3RlcCgxIC8gNjApCiAgICAgKi8KCgogICAgc3RlcChkdCwgdGltZVNpbmNlTGFzdENhbGxlZCwgbWF4U3ViU3RlcHMpIHsKICAgICAgaWYgKG1heFN1YlN0ZXBzID09PSB2b2lkIDApIHsKICAgICAgICBtYXhTdWJTdGVwcyA9IDEwOwogICAgICB9CgogICAgICBpZiAodGltZVNpbmNlTGFzdENhbGxlZCA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgLy8gRml4ZWQsIHNpbXBsZSBzdGVwcGluZwogICAgICAgIHRoaXMuaW50ZXJuYWxTdGVwKGR0KTsgLy8gSW5jcmVtZW50IHRpbWUKCiAgICAgICAgdGhpcy50aW1lICs9IGR0OwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuYWNjdW11bGF0b3IgKz0gdGltZVNpbmNlTGFzdENhbGxlZDsKICAgICAgICBjb25zdCB0MCA9IHBlcmZvcm1hbmNlLm5vdygpOwogICAgICAgIGxldCBzdWJzdGVwcyA9IDA7CgogICAgICAgIHdoaWxlICh0aGlzLmFjY3VtdWxhdG9yID49IGR0ICYmIHN1YnN0ZXBzIDwgbWF4U3ViU3RlcHMpIHsKICAgICAgICAgIC8vIERvIGZpeGVkIHN0ZXBzIHRvIGNhdGNoIHVwCiAgICAgICAgICB0aGlzLmludGVybmFsU3RlcChkdCk7CiAgICAgICAgICB0aGlzLmFjY3VtdWxhdG9yIC09IGR0OwogICAgICAgICAgc3Vic3RlcHMrKzsKCiAgICAgICAgICBpZiAocGVyZm9ybWFuY2Uubm93KCkgLSB0MCA+IGR0ICogMTAwMCkgewogICAgICAgICAgICAvLyBUaGUgZnJhbWVyYXRlIGlzIG5vdCBpbnRlcmFjdGl2ZSBhbnltb3JlLgogICAgICAgICAgICAvLyBXZSBhcmUgYmVsb3cgdGhlIHRhcmdldCBmcmFtZXJhdGUuCiAgICAgICAgICAgIC8vIEJldHRlciBiYWlsIG91dC4KICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CiAgICAgICAgfSAvLyBSZW1vdmUgdGhlIGV4Y2VzcyBhY2N1bXVsYXRvciwgc2luY2Ugd2UgbWF5IG5vdAogICAgICAgIC8vIGhhdmUgaGFkIGVub3VnaCBzdWJzdGVwcyBhdmFpbGFibGUgdG8gY2F0Y2ggdXAKCgogICAgICAgIHRoaXMuYWNjdW11bGF0b3IgPSB0aGlzLmFjY3VtdWxhdG9yICUgZHQ7CiAgICAgICAgY29uc3QgdCA9IHRoaXMuYWNjdW11bGF0b3IgLyBkdDsKCiAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogIT09IHRoaXMuYm9kaWVzLmxlbmd0aDsgaisrKSB7CiAgICAgICAgICBjb25zdCBiID0gdGhpcy5ib2RpZXNbal07CiAgICAgICAgICBiLnByZXZpb3VzUG9zaXRpb24ubGVycChiLnBvc2l0aW9uLCB0LCBiLmludGVycG9sYXRlZFBvc2l0aW9uKTsKICAgICAgICAgIGIucHJldmlvdXNRdWF0ZXJuaW9uLnNsZXJwKGIucXVhdGVybmlvbiwgdCwgYi5pbnRlcnBvbGF0ZWRRdWF0ZXJuaW9uKTsKICAgICAgICAgIGIucHJldmlvdXNRdWF0ZXJuaW9uLm5vcm1hbGl6ZSgpOwogICAgICAgIH0KCiAgICAgICAgdGhpcy50aW1lICs9IHRpbWVTaW5jZUxhc3RDYWxsZWQ7CiAgICAgIH0KICAgIH0KCiAgICBpbnRlcm5hbFN0ZXAoZHQpIHsKICAgICAgdGhpcy5kdCA9IGR0OwogICAgICBjb25zdCBjb250YWN0cyA9IHRoaXMuY29udGFjdHM7CiAgICAgIGNvbnN0IHAxID0gV29ybGRfc3RlcF9wMTsKICAgICAgY29uc3QgcDIgPSBXb3JsZF9zdGVwX3AyOwogICAgICBjb25zdCBOID0gdGhpcy5ib2RpZXMubGVuZ3RoOwogICAgICBjb25zdCBib2RpZXMgPSB0aGlzLmJvZGllczsKICAgICAgY29uc3Qgc29sdmVyID0gdGhpcy5zb2x2ZXI7CiAgICAgIGNvbnN0IGdyYXZpdHkgPSB0aGlzLmdyYXZpdHk7CiAgICAgIGNvbnN0IGRvUHJvZmlsaW5nID0gdGhpcy5kb1Byb2ZpbGluZzsKICAgICAgY29uc3QgcHJvZmlsZSA9IHRoaXMucHJvZmlsZTsKICAgICAgY29uc3QgRFlOQU1JQyA9IEJvZHkuRFlOQU1JQzsKICAgICAgbGV0IHByb2ZpbGluZ1N0YXJ0ID0gLUluZmluaXR5OwogICAgICBjb25zdCBjb25zdHJhaW50cyA9IHRoaXMuY29uc3RyYWludHM7CiAgICAgIGNvbnN0IGZyaWN0aW9uRXF1YXRpb25Qb29sID0gV29ybGRfc3RlcF9mcmljdGlvbkVxdWF0aW9uUG9vbDsKICAgICAgZ3Jhdml0eS5sZW5ndGgoKTsKICAgICAgY29uc3QgZ3ggPSBncmF2aXR5Lng7CiAgICAgIGNvbnN0IGd5ID0gZ3Jhdml0eS55OwogICAgICBjb25zdCBneiA9IGdyYXZpdHkuejsKICAgICAgbGV0IGkgPSAwOwoKICAgICAgaWYgKGRvUHJvZmlsaW5nKSB7CiAgICAgICAgcHJvZmlsaW5nU3RhcnQgPSBwZXJmb3JtYW5jZS5ub3coKTsKICAgICAgfSAvLyBBZGQgZ3Jhdml0eSB0byBhbGwgb2JqZWN0cwoKCiAgICAgIGZvciAoaSA9IDA7IGkgIT09IE47IGkrKykgewogICAgICAgIGNvbnN0IGJpID0gYm9kaWVzW2ldOwoKICAgICAgICBpZiAoYmkudHlwZSA9PT0gRFlOQU1JQykgewogICAgICAgICAgLy8gT25seSBmb3IgZHluYW1pYyBib2RpZXMKICAgICAgICAgIGNvbnN0IGYgPSBiaS5mb3JjZTsKICAgICAgICAgIGNvbnN0IG0gPSBiaS5tYXNzOwogICAgICAgICAgZi54ICs9IG0gKiBneDsKICAgICAgICAgIGYueSArPSBtICogZ3k7CiAgICAgICAgICBmLnogKz0gbSAqIGd6OwogICAgICAgIH0KICAgICAgfSAvLyBVcGRhdGUgc3Vic3lzdGVtcwoKCiAgICAgIGZvciAobGV0IGkgPSAwLCBOc3Vic3lzdGVtcyA9IHRoaXMuc3Vic3lzdGVtcy5sZW5ndGg7IGkgIT09IE5zdWJzeXN0ZW1zOyBpKyspIHsKICAgICAgICB0aGlzLnN1YnN5c3RlbXNbaV0udXBkYXRlKCk7CiAgICAgIH0gLy8gQ29sbGlzaW9uIGRldGVjdGlvbgoKCiAgICAgIGlmIChkb1Byb2ZpbGluZykgewogICAgICAgIHByb2ZpbGluZ1N0YXJ0ID0gcGVyZm9ybWFuY2Uubm93KCk7CiAgICAgIH0KCiAgICAgIHAxLmxlbmd0aCA9IDA7IC8vIENsZWFuIHVwIHBhaXIgYXJyYXlzIGZyb20gbGFzdCBzdGVwCgogICAgICBwMi5sZW5ndGggPSAwOwogICAgICB0aGlzLmJyb2FkcGhhc2UuY29sbGlzaW9uUGFpcnModGhpcywgcDEsIHAyKTsKCiAgICAgIGlmIChkb1Byb2ZpbGluZykgewogICAgICAgIHByb2ZpbGUuYnJvYWRwaGFzZSA9IHBlcmZvcm1hbmNlLm5vdygpIC0gcHJvZmlsaW5nU3RhcnQ7CiAgICAgIH0gLy8gUmVtb3ZlIGNvbnN0cmFpbmVkIHBhaXJzIHdpdGggY29sbGlkZUNvbm5lY3RlZCA9PSBmYWxzZQoKCiAgICAgIGxldCBOY29uc3RyYWludHMgPSBjb25zdHJhaW50cy5sZW5ndGg7CgogICAgICBmb3IgKGkgPSAwOyBpICE9PSBOY29uc3RyYWludHM7IGkrKykgewogICAgICAgIGNvbnN0IGMgPSBjb25zdHJhaW50c1tpXTsKCiAgICAgICAgaWYgKCFjLmNvbGxpZGVDb25uZWN0ZWQpIHsKICAgICAgICAgIGZvciAobGV0IGogPSBwMS5sZW5ndGggLSAxOyBqID49IDA7IGogLT0gMSkgewogICAgICAgICAgICBpZiAoYy5ib2R5QSA9PT0gcDFbal0gJiYgYy5ib2R5QiA9PT0gcDJbal0gfHwgYy5ib2R5QiA9PT0gcDFbal0gJiYgYy5ib2R5QSA9PT0gcDJbal0pIHsKICAgICAgICAgICAgICBwMS5zcGxpY2UoaiwgMSk7CiAgICAgICAgICAgICAgcDIuc3BsaWNlKGosIDEpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CgogICAgICB0aGlzLmNvbGxpc2lvbk1hdHJpeFRpY2soKTsgLy8gR2VuZXJhdGUgY29udGFjdHMKCiAgICAgIGlmIChkb1Byb2ZpbGluZykgewogICAgICAgIHByb2ZpbGluZ1N0YXJ0ID0gcGVyZm9ybWFuY2Uubm93KCk7CiAgICAgIH0KCiAgICAgIGNvbnN0IG9sZGNvbnRhY3RzID0gV29ybGRfc3RlcF9vbGRDb250YWN0czsKICAgICAgY29uc3QgTm9sZENvbnRhY3RzID0gY29udGFjdHMubGVuZ3RoOwoKICAgICAgZm9yIChpID0gMDsgaSAhPT0gTm9sZENvbnRhY3RzOyBpKyspIHsKICAgICAgICBvbGRjb250YWN0cy5wdXNoKGNvbnRhY3RzW2ldKTsKICAgICAgfQoKICAgICAgY29udGFjdHMubGVuZ3RoID0gMDsgLy8gVHJhbnNmZXIgRnJpY3Rpb25FcXVhdGlvbiBmcm9tIGN1cnJlbnQgbGlzdCB0byB0aGUgcG9vbCBmb3IgcmV1c2UKCiAgICAgIGNvbnN0IE5vbGRGcmljdGlvbkVxdWF0aW9ucyA9IHRoaXMuZnJpY3Rpb25FcXVhdGlvbnMubGVuZ3RoOwoKICAgICAgZm9yIChpID0gMDsgaSAhPT0gTm9sZEZyaWN0aW9uRXF1YXRpb25zOyBpKyspIHsKICAgICAgICBmcmljdGlvbkVxdWF0aW9uUG9vbC5wdXNoKHRoaXMuZnJpY3Rpb25FcXVhdGlvbnNbaV0pOwogICAgICB9CgogICAgICB0aGlzLmZyaWN0aW9uRXF1YXRpb25zLmxlbmd0aCA9IDA7CiAgICAgIHRoaXMubmFycm93cGhhc2UuZ2V0Q29udGFjdHMocDEsIHAyLCB0aGlzLCBjb250YWN0cywgb2xkY29udGFjdHMsIC8vIFRvIGJlIHJldXNlZAogICAgICB0aGlzLmZyaWN0aW9uRXF1YXRpb25zLCBmcmljdGlvbkVxdWF0aW9uUG9vbCk7CgogICAgICBpZiAoZG9Qcm9maWxpbmcpIHsKICAgICAgICBwcm9maWxlLm5hcnJvd3BoYXNlID0gcGVyZm9ybWFuY2Uubm93KCkgLSBwcm9maWxpbmdTdGFydDsKICAgICAgfSAvLyBMb29wIG92ZXIgYWxsIGNvbGxpc2lvbnMKCgogICAgICBpZiAoZG9Qcm9maWxpbmcpIHsKICAgICAgICBwcm9maWxpbmdTdGFydCA9IHBlcmZvcm1hbmNlLm5vdygpOwogICAgICB9IC8vIEFkZCBhbGwgZnJpY3Rpb24gZXFzCgoKICAgICAgZm9yIChpID0gMDsgaSA8IHRoaXMuZnJpY3Rpb25FcXVhdGlvbnMubGVuZ3RoOyBpKyspIHsKICAgICAgICBzb2x2ZXIuYWRkRXF1YXRpb24odGhpcy5mcmljdGlvbkVxdWF0aW9uc1tpXSk7CiAgICAgIH0KCiAgICAgIGNvbnN0IG5jb250YWN0cyA9IGNvbnRhY3RzLmxlbmd0aDsKCiAgICAgIGZvciAobGV0IGsgPSAwOyBrICE9PSBuY29udGFjdHM7IGsrKykgewogICAgICAgIC8vIEN1cnJlbnQgY29udGFjdAogICAgICAgIGNvbnN0IGMgPSBjb250YWN0c1trXTsgLy8gR2V0IGN1cnJlbnQgY29sbGlzaW9uIGluZGVjZXMKCiAgICAgICAgY29uc3QgYmkgPSBjLmJpOwogICAgICAgIGNvbnN0IGJqID0gYy5iajsKICAgICAgICBjb25zdCBzaSA9IGMuc2k7CiAgICAgICAgY29uc3Qgc2ogPSBjLnNqOyAvLyBHZXQgY29sbGlzaW9uIHByb3BlcnRpZXMKCiAgICAgICAgbGV0IGNtOwoKICAgICAgICBpZiAoYmkubWF0ZXJpYWwgJiYgYmoubWF0ZXJpYWwpIHsKICAgICAgICAgIGNtID0gdGhpcy5nZXRDb250YWN0TWF0ZXJpYWwoYmkubWF0ZXJpYWwsIGJqLm1hdGVyaWFsKSB8fCB0aGlzLmRlZmF1bHRDb250YWN0TWF0ZXJpYWw7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGNtID0gdGhpcy5kZWZhdWx0Q29udGFjdE1hdGVyaWFsOwogICAgICAgIH0gLy8gYy5lbmFibGVkID0gYmkuY29sbGlzaW9uUmVzcG9uc2UgJiYgYmouY29sbGlzaW9uUmVzcG9uc2UgJiYgc2kuY29sbGlzaW9uUmVzcG9uc2UgJiYgc2ouY29sbGlzaW9uUmVzcG9uc2U7CgoKICAgICAgICBjbS5mcmljdGlvbjsgLy8gYy5yZXN0aXR1dGlvbiA9IGNtLnJlc3RpdHV0aW9uOwogICAgICAgIC8vIElmIGZyaWN0aW9uIG9yIHJlc3RpdHV0aW9uIHdlcmUgc3BlY2lmaWVkIGluIHRoZSBtYXRlcmlhbCwgdXNlIHRoZW0KCiAgICAgICAgaWYgKGJpLm1hdGVyaWFsICYmIGJqLm1hdGVyaWFsKSB7CiAgICAgICAgICBpZiAoYmkubWF0ZXJpYWwuZnJpY3Rpb24gPj0gMCAmJiBiai5tYXRlcmlhbC5mcmljdGlvbiA+PSAwKSB7CiAgICAgICAgICAgIGJpLm1hdGVyaWFsLmZyaWN0aW9uICogYmoubWF0ZXJpYWwuZnJpY3Rpb247CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKGJpLm1hdGVyaWFsLnJlc3RpdHV0aW9uID49IDAgJiYgYmoubWF0ZXJpYWwucmVzdGl0dXRpb24gPj0gMCkgewogICAgICAgICAgICBjLnJlc3RpdHV0aW9uID0gYmkubWF0ZXJpYWwucmVzdGl0dXRpb24gKiBiai5tYXRlcmlhbC5yZXN0aXR1dGlvbjsKICAgICAgICAgIH0KICAgICAgICB9IC8vIGMuc2V0U3Bvb2tQYXJhbXMoCiAgICAgICAgLy8gICAgICAgICAgIGNtLmNvbnRhY3RFcXVhdGlvblN0aWZmbmVzcywKICAgICAgICAvLyAgICAgICAgICAgY20uY29udGFjdEVxdWF0aW9uUmVsYXhhdGlvbiwKICAgICAgICAvLyAgICAgICAgICAgZHQKICAgICAgICAvLyAgICAgICApOwoKCiAgICAgICAgc29sdmVyLmFkZEVxdWF0aW9uKGMpOyAvLyAvLyBBZGQgZnJpY3Rpb24gY29uc3RyYWludCBlcXVhdGlvbgogICAgICAgIC8vIGlmKG11ID4gMCl7CiAgICAgICAgLy8gCS8vIENyZWF0ZSAyIHRhbmdlbnQgZXF1YXRpb25zCiAgICAgICAgLy8gCWNvbnN0IG11ZyA9IG11ICogZ25vcm07CiAgICAgICAgLy8gCWNvbnN0IHJlZHVjZWRNYXNzID0gKGJpLmludk1hc3MgKyBiai5pbnZNYXNzKTsKICAgICAgICAvLyAJaWYocmVkdWNlZE1hc3MgPiAwKXsKICAgICAgICAvLyAJCXJlZHVjZWRNYXNzID0gMS9yZWR1Y2VkTWFzczsKICAgICAgICAvLyAJfQogICAgICAgIC8vIAljb25zdCBwb29sID0gZnJpY3Rpb25FcXVhdGlvblBvb2w7CiAgICAgICAgLy8gCWNvbnN0IGMxID0gcG9vbC5sZW5ndGggPyBwb29sLnBvcCgpIDogbmV3IEZyaWN0aW9uRXF1YXRpb24oYmksYmosbXVnKnJlZHVjZWRNYXNzKTsKICAgICAgICAvLyAJY29uc3QgYzIgPSBwb29sLmxlbmd0aCA/IHBvb2wucG9wKCkgOiBuZXcgRnJpY3Rpb25FcXVhdGlvbihiaSxiaixtdWcqcmVkdWNlZE1hc3MpOwogICAgICAgIC8vIAl0aGlzLmZyaWN0aW9uRXF1YXRpb25zLnB1c2goYzEsIGMyKTsKICAgICAgICAvLyAJYzEuYmkgPSBjMi5iaSA9IGJpOwogICAgICAgIC8vIAljMS5iaiA9IGMyLmJqID0gYmo7CiAgICAgICAgLy8gCWMxLm1pbkZvcmNlID0gYzIubWluRm9yY2UgPSAtbXVnKnJlZHVjZWRNYXNzOwogICAgICAgIC8vIAljMS5tYXhGb3JjZSA9IGMyLm1heEZvcmNlID0gbXVnKnJlZHVjZWRNYXNzOwogICAgICAgIC8vIAkvLyBDb3B5IG92ZXIgdGhlIHJlbGF0aXZlIHZlY3RvcnMKICAgICAgICAvLyAJYzEucmkuY29weShjLnJpKTsKICAgICAgICAvLyAJYzEucmouY29weShjLnJqKTsKICAgICAgICAvLyAJYzIucmkuY29weShjLnJpKTsKICAgICAgICAvLyAJYzIucmouY29weShjLnJqKTsKICAgICAgICAvLyAJLy8gQ29uc3RydWN0IHRhbmdlbnRzCiAgICAgICAgLy8gCWMubmkudGFuZ2VudHMoYzEudCwgYzIudCk7CiAgICAgICAgLy8gICAgICAgICAgIC8vIFNldCBzcG9vayBwYXJhbXMKICAgICAgICAvLyAgICAgICAgICAgYzEuc2V0U3Bvb2tQYXJhbXMoY20uZnJpY3Rpb25FcXVhdGlvblN0aWZmbmVzcywgY20uZnJpY3Rpb25FcXVhdGlvblJlbGF4YXRpb24sIGR0KTsKICAgICAgICAvLyAgICAgICAgICAgYzIuc2V0U3Bvb2tQYXJhbXMoY20uZnJpY3Rpb25FcXVhdGlvblN0aWZmbmVzcywgY20uZnJpY3Rpb25FcXVhdGlvblJlbGF4YXRpb24sIGR0KTsKICAgICAgICAvLyAgICAgICAgICAgYzEuZW5hYmxlZCA9IGMyLmVuYWJsZWQgPSBjLmVuYWJsZWQ7CiAgICAgICAgLy8gCS8vIEFkZCBlcXVhdGlvbnMgdG8gc29sdmVyCiAgICAgICAgLy8gCXNvbHZlci5hZGRFcXVhdGlvbihjMSk7CiAgICAgICAgLy8gCXNvbHZlci5hZGRFcXVhdGlvbihjMik7CiAgICAgICAgLy8gfQoKICAgICAgICBpZiAoYmkuYWxsb3dTbGVlcCAmJiBiaS50eXBlID09PSBCb2R5LkRZTkFNSUMgJiYgYmkuc2xlZXBTdGF0ZSA9PT0gQm9keS5TTEVFUElORyAmJiBiai5zbGVlcFN0YXRlID09PSBCb2R5LkFXQUtFICYmIGJqLnR5cGUgIT09IEJvZHkuU1RBVElDKSB7CiAgICAgICAgICBjb25zdCBzcGVlZFNxdWFyZWRCID0gYmoudmVsb2NpdHkubGVuZ3RoU3F1YXJlZCgpICsgYmouYW5ndWxhclZlbG9jaXR5Lmxlbmd0aFNxdWFyZWQoKTsKICAgICAgICAgIGNvbnN0IHNwZWVkTGltaXRTcXVhcmVkQiA9IGJqLnNsZWVwU3BlZWRMaW1pdCAqKiAyOwoKICAgICAgICAgIGlmIChzcGVlZFNxdWFyZWRCID49IHNwZWVkTGltaXRTcXVhcmVkQiAqIDIpIHsKICAgICAgICAgICAgYmkud2FrZVVwQWZ0ZXJOYXJyb3dwaGFzZSA9IHRydWU7CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBpZiAoYmouYWxsb3dTbGVlcCAmJiBiai50eXBlID09PSBCb2R5LkRZTkFNSUMgJiYgYmouc2xlZXBTdGF0ZSA9PT0gQm9keS5TTEVFUElORyAmJiBiaS5zbGVlcFN0YXRlID09PSBCb2R5LkFXQUtFICYmIGJpLnR5cGUgIT09IEJvZHkuU1RBVElDKSB7CiAgICAgICAgICBjb25zdCBzcGVlZFNxdWFyZWRBID0gYmkudmVsb2NpdHkubGVuZ3RoU3F1YXJlZCgpICsgYmkuYW5ndWxhclZlbG9jaXR5Lmxlbmd0aFNxdWFyZWQoKTsKICAgICAgICAgIGNvbnN0IHNwZWVkTGltaXRTcXVhcmVkQSA9IGJpLnNsZWVwU3BlZWRMaW1pdCAqKiAyOwoKICAgICAgICAgIGlmIChzcGVlZFNxdWFyZWRBID49IHNwZWVkTGltaXRTcXVhcmVkQSAqIDIpIHsKICAgICAgICAgICAgYmoud2FrZVVwQWZ0ZXJOYXJyb3dwaGFzZSA9IHRydWU7CiAgICAgICAgICB9CiAgICAgICAgfSAvLyBOb3cgd2Uga25vdyB0aGF0IGkgYW5kIGogYXJlIGluIGNvbnRhY3QuIFNldCBjb2xsaXNpb24gbWF0cml4IHN0YXRlCgoKICAgICAgICB0aGlzLmNvbGxpc2lvbk1hdHJpeC5zZXQoYmksIGJqLCB0cnVlKTsKCiAgICAgICAgaWYgKCF0aGlzLmNvbGxpc2lvbk1hdHJpeFByZXZpb3VzLmdldChiaSwgYmopKSB7CiAgICAgICAgICAvLyBGaXJzdCBjb250YWN0IQogICAgICAgICAgLy8gV2UgcmV1c2UgdGhlIGNvbGxpZGVFdmVudCBvYmplY3QsIG90aGVyd2lzZSB3ZSB3aWxsIGVuZCB1cCBjcmVhdGluZyBuZXcgb2JqZWN0cyBmb3IgZWFjaCBuZXcgY29udGFjdCwgZXZlbiBpZiB0aGVyZSdzIG5vIGV2ZW50IGxpc3RlbmVyIGF0dGFjaGVkLgogICAgICAgICAgV29ybGRfc3RlcF9jb2xsaWRlRXZlbnQuYm9keSA9IGJqOwogICAgICAgICAgV29ybGRfc3RlcF9jb2xsaWRlRXZlbnQuY29udGFjdCA9IGM7CiAgICAgICAgICBiaS5kaXNwYXRjaEV2ZW50KFdvcmxkX3N0ZXBfY29sbGlkZUV2ZW50KTsKICAgICAgICAgIFdvcmxkX3N0ZXBfY29sbGlkZUV2ZW50LmJvZHkgPSBiaTsKICAgICAgICAgIGJqLmRpc3BhdGNoRXZlbnQoV29ybGRfc3RlcF9jb2xsaWRlRXZlbnQpOwogICAgICAgIH0KCiAgICAgICAgdGhpcy5ib2R5T3ZlcmxhcEtlZXBlci5zZXQoYmkuaWQsIGJqLmlkKTsKICAgICAgICB0aGlzLnNoYXBlT3ZlcmxhcEtlZXBlci5zZXQoc2kuaWQsIHNqLmlkKTsKICAgICAgfQoKICAgICAgdGhpcy5lbWl0Q29udGFjdEV2ZW50cygpOwoKICAgICAgaWYgKGRvUHJvZmlsaW5nKSB7CiAgICAgICAgcHJvZmlsZS5tYWtlQ29udGFjdENvbnN0cmFpbnRzID0gcGVyZm9ybWFuY2Uubm93KCkgLSBwcm9maWxpbmdTdGFydDsKICAgICAgICBwcm9maWxpbmdTdGFydCA9IHBlcmZvcm1hbmNlLm5vdygpOwogICAgICB9IC8vIFdha2UgdXAgYm9kaWVzCgoKICAgICAgZm9yIChpID0gMDsgaSAhPT0gTjsgaSsrKSB7CiAgICAgICAgY29uc3QgYmkgPSBib2RpZXNbaV07CgogICAgICAgIGlmIChiaS53YWtlVXBBZnRlck5hcnJvd3BoYXNlKSB7CiAgICAgICAgICBiaS53YWtlVXAoKTsKICAgICAgICAgIGJpLndha2VVcEFmdGVyTmFycm93cGhhc2UgPSBmYWxzZTsKICAgICAgICB9CiAgICAgIH0gLy8gQWRkIHVzZXItYWRkZWQgY29uc3RyYWludHMKCgogICAgICBOY29uc3RyYWludHMgPSBjb25zdHJhaW50cy5sZW5ndGg7CgogICAgICBmb3IgKGkgPSAwOyBpICE9PSBOY29uc3RyYWludHM7IGkrKykgewogICAgICAgIGNvbnN0IGMgPSBjb25zdHJhaW50c1tpXTsKICAgICAgICBjLnVwZGF0ZSgpOwoKICAgICAgICBmb3IgKGxldCBqID0gMCwgTmVxID0gYy5lcXVhdGlvbnMubGVuZ3RoOyBqICE9PSBOZXE7IGorKykgewogICAgICAgICAgY29uc3QgZXEgPSBjLmVxdWF0aW9uc1tqXTsKICAgICAgICAgIHNvbHZlci5hZGRFcXVhdGlvbihlcSk7CiAgICAgICAgfQogICAgICB9IC8vIFNvbHZlIHRoZSBjb25zdHJhaW5lZCBzeXN0ZW0KCgogICAgICBzb2x2ZXIuc29sdmUoZHQsIHRoaXMpOwoKICAgICAgaWYgKGRvUHJvZmlsaW5nKSB7CiAgICAgICAgcHJvZmlsZS5zb2x2ZSA9IHBlcmZvcm1hbmNlLm5vdygpIC0gcHJvZmlsaW5nU3RhcnQ7CiAgICAgIH0gLy8gUmVtb3ZlIGFsbCBjb250YWN0cyBmcm9tIHNvbHZlcgoKCiAgICAgIHNvbHZlci5yZW1vdmVBbGxFcXVhdGlvbnMoKTsgLy8gQXBwbHkgZGFtcGluZywgc2VlIGh0dHA6Ly9jb2RlLmdvb2dsZS5jb20vcC9idWxsZXQvaXNzdWVzL2RldGFpbD9pZD03NCBmb3IgZGV0YWlscwoKICAgICAgY29uc3QgcG93ID0gTWF0aC5wb3c7CgogICAgICBmb3IgKGkgPSAwOyBpICE9PSBOOyBpKyspIHsKICAgICAgICBjb25zdCBiaSA9IGJvZGllc1tpXTsKCiAgICAgICAgaWYgKGJpLnR5cGUgJiBEWU5BTUlDKSB7CiAgICAgICAgICAvLyBPbmx5IGZvciBkeW5hbWljIGJvZGllcwogICAgICAgICAgY29uc3QgbGQgPSBwb3coMS4wIC0gYmkubGluZWFyRGFtcGluZywgZHQpOwogICAgICAgICAgY29uc3QgdiA9IGJpLnZlbG9jaXR5OwogICAgICAgICAgdi5zY2FsZShsZCwgdik7CiAgICAgICAgICBjb25zdCBhdiA9IGJpLmFuZ3VsYXJWZWxvY2l0eTsKCiAgICAgICAgICBpZiAoYXYpIHsKICAgICAgICAgICAgY29uc3QgYWQgPSBwb3coMS4wIC0gYmkuYW5ndWxhckRhbXBpbmcsIGR0KTsKICAgICAgICAgICAgYXYuc2NhbGUoYWQsIGF2KTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KCiAgICAgIHRoaXMuZGlzcGF0Y2hFdmVudChXb3JsZF9zdGVwX3ByZVN0ZXBFdmVudCk7IC8vIExlYXAgZnJvZwogICAgICAvLyB2bmV3ID0gdiArIGgqZi9tCiAgICAgIC8vIHhuZXcgPSB4ICsgaCp2bmV3CgogICAgICBpZiAoZG9Qcm9maWxpbmcpIHsKICAgICAgICBwcm9maWxpbmdTdGFydCA9IHBlcmZvcm1hbmNlLm5vdygpOwogICAgICB9CgogICAgICBjb25zdCBzdGVwbnVtYmVyID0gdGhpcy5zdGVwbnVtYmVyOwogICAgICBjb25zdCBxdWF0Tm9ybWFsaXplID0gc3RlcG51bWJlciAlICh0aGlzLnF1YXROb3JtYWxpemVTa2lwICsgMSkgPT09IDA7CiAgICAgIGNvbnN0IHF1YXROb3JtYWxpemVGYXN0ID0gdGhpcy5xdWF0Tm9ybWFsaXplRmFzdDsKCiAgICAgIGZvciAoaSA9IDA7IGkgIT09IE47IGkrKykgewogICAgICAgIGJvZGllc1tpXS5pbnRlZ3JhdGUoZHQsIHF1YXROb3JtYWxpemUsIHF1YXROb3JtYWxpemVGYXN0KTsKICAgICAgfQoKICAgICAgdGhpcy5jbGVhckZvcmNlcygpOwogICAgICB0aGlzLmJyb2FkcGhhc2UuZGlydHkgPSB0cnVlOwoKICAgICAgaWYgKGRvUHJvZmlsaW5nKSB7CiAgICAgICAgcHJvZmlsZS5pbnRlZ3JhdGUgPSBwZXJmb3JtYW5jZS5ub3coKSAtIHByb2ZpbGluZ1N0YXJ0OwogICAgICB9IC8vIFVwZGF0ZSBzdGVwIG51bWJlcgoKCiAgICAgIHRoaXMuc3RlcG51bWJlciArPSAxOwogICAgICB0aGlzLmRpc3BhdGNoRXZlbnQoV29ybGRfc3RlcF9wb3N0U3RlcEV2ZW50KTsgLy8gU2xlZXBpbmcgdXBkYXRlCgogICAgICBsZXQgaGFzQWN0aXZlQm9kaWVzID0gdHJ1ZTsKCiAgICAgIGlmICh0aGlzLmFsbG93U2xlZXApIHsKICAgICAgICBoYXNBY3RpdmVCb2RpZXMgPSBmYWxzZTsKCiAgICAgICAgZm9yIChpID0gMDsgaSAhPT0gTjsgaSsrKSB7CiAgICAgICAgICBjb25zdCBiaSA9IGJvZGllc1tpXTsKICAgICAgICAgIGJpLnNsZWVwVGljayh0aGlzLnRpbWUpOwoKICAgICAgICAgIGlmIChiaS5zbGVlcFN0YXRlICE9PSBCb2R5LlNMRUVQSU5HKSB7CiAgICAgICAgICAgIGhhc0FjdGl2ZUJvZGllcyA9IHRydWU7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CgogICAgICB0aGlzLmhhc0FjdGl2ZUJvZGllcyA9IGhhc0FjdGl2ZUJvZGllczsKICAgIH0KCiAgICBlbWl0Q29udGFjdEV2ZW50cygpIHsKICAgICAgY29uc3QgaGFzQmVnaW5Db250YWN0ID0gdGhpcy5oYXNBbnlFdmVudExpc3RlbmVyKCdiZWdpbkNvbnRhY3QnKTsKICAgICAgY29uc3QgaGFzRW5kQ29udGFjdCA9IHRoaXMuaGFzQW55RXZlbnRMaXN0ZW5lcignZW5kQ29udGFjdCcpOwoKICAgICAgaWYgKGhhc0JlZ2luQ29udGFjdCB8fCBoYXNFbmRDb250YWN0KSB7CiAgICAgICAgdGhpcy5ib2R5T3ZlcmxhcEtlZXBlci5nZXREaWZmKGFkZGl0aW9ucywgcmVtb3ZhbHMpOwogICAgICB9CgogICAgICBpZiAoaGFzQmVnaW5Db250YWN0KSB7CiAgICAgICAgZm9yIChsZXQgaSA9IDAsIGwgPSBhZGRpdGlvbnMubGVuZ3RoOyBpIDwgbDsgaSArPSAyKSB7CiAgICAgICAgICBiZWdpbkNvbnRhY3RFdmVudC5ib2R5QSA9IHRoaXMuZ2V0Qm9keUJ5SWQoYWRkaXRpb25zW2ldKTsKICAgICAgICAgIGJlZ2luQ29udGFjdEV2ZW50LmJvZHlCID0gdGhpcy5nZXRCb2R5QnlJZChhZGRpdGlvbnNbaSArIDFdKTsKICAgICAgICAgIHRoaXMuZGlzcGF0Y2hFdmVudChiZWdpbkNvbnRhY3RFdmVudCk7CiAgICAgICAgfQoKICAgICAgICBiZWdpbkNvbnRhY3RFdmVudC5ib2R5QSA9IGJlZ2luQ29udGFjdEV2ZW50LmJvZHlCID0gbnVsbDsKICAgICAgfQoKICAgICAgaWYgKGhhc0VuZENvbnRhY3QpIHsKICAgICAgICBmb3IgKGxldCBpID0gMCwgbCA9IHJlbW92YWxzLmxlbmd0aDsgaSA8IGw7IGkgKz0gMikgewogICAgICAgICAgZW5kQ29udGFjdEV2ZW50LmJvZHlBID0gdGhpcy5nZXRCb2R5QnlJZChyZW1vdmFsc1tpXSk7CiAgICAgICAgICBlbmRDb250YWN0RXZlbnQuYm9keUIgPSB0aGlzLmdldEJvZHlCeUlkKHJlbW92YWxzW2kgKyAxXSk7CiAgICAgICAgICB0aGlzLmRpc3BhdGNoRXZlbnQoZW5kQ29udGFjdEV2ZW50KTsKICAgICAgICB9CgogICAgICAgIGVuZENvbnRhY3RFdmVudC5ib2R5QSA9IGVuZENvbnRhY3RFdmVudC5ib2R5QiA9IG51bGw7CiAgICAgIH0KCiAgICAgIGFkZGl0aW9ucy5sZW5ndGggPSByZW1vdmFscy5sZW5ndGggPSAwOwogICAgICBjb25zdCBoYXNCZWdpblNoYXBlQ29udGFjdCA9IHRoaXMuaGFzQW55RXZlbnRMaXN0ZW5lcignYmVnaW5TaGFwZUNvbnRhY3QnKTsKICAgICAgY29uc3QgaGFzRW5kU2hhcGVDb250YWN0ID0gdGhpcy5oYXNBbnlFdmVudExpc3RlbmVyKCdlbmRTaGFwZUNvbnRhY3QnKTsKCiAgICAgIGlmIChoYXNCZWdpblNoYXBlQ29udGFjdCB8fCBoYXNFbmRTaGFwZUNvbnRhY3QpIHsKICAgICAgICB0aGlzLnNoYXBlT3ZlcmxhcEtlZXBlci5nZXREaWZmKGFkZGl0aW9ucywgcmVtb3ZhbHMpOwogICAgICB9CgogICAgICBpZiAoaGFzQmVnaW5TaGFwZUNvbnRhY3QpIHsKICAgICAgICBmb3IgKGxldCBpID0gMCwgbCA9IGFkZGl0aW9ucy5sZW5ndGg7IGkgPCBsOyBpICs9IDIpIHsKICAgICAgICAgIGNvbnN0IHNoYXBlQSA9IHRoaXMuZ2V0U2hhcGVCeUlkKGFkZGl0aW9uc1tpXSk7CiAgICAgICAgICBjb25zdCBzaGFwZUIgPSB0aGlzLmdldFNoYXBlQnlJZChhZGRpdGlvbnNbaSArIDFdKTsKICAgICAgICAgIGJlZ2luU2hhcGVDb250YWN0RXZlbnQuc2hhcGVBID0gc2hhcGVBOwogICAgICAgICAgYmVnaW5TaGFwZUNvbnRhY3RFdmVudC5zaGFwZUIgPSBzaGFwZUI7CiAgICAgICAgICBpZiAoc2hhcGVBKSBiZWdpblNoYXBlQ29udGFjdEV2ZW50LmJvZHlBID0gc2hhcGVBLmJvZHk7CiAgICAgICAgICBpZiAoc2hhcGVCKSBiZWdpblNoYXBlQ29udGFjdEV2ZW50LmJvZHlCID0gc2hhcGVCLmJvZHk7CiAgICAgICAgICB0aGlzLmRpc3BhdGNoRXZlbnQoYmVnaW5TaGFwZUNvbnRhY3RFdmVudCk7CiAgICAgICAgfQoKICAgICAgICBiZWdpblNoYXBlQ29udGFjdEV2ZW50LmJvZHlBID0gYmVnaW5TaGFwZUNvbnRhY3RFdmVudC5ib2R5QiA9IGJlZ2luU2hhcGVDb250YWN0RXZlbnQuc2hhcGVBID0gYmVnaW5TaGFwZUNvbnRhY3RFdmVudC5zaGFwZUIgPSBudWxsOwogICAgICB9CgogICAgICBpZiAoaGFzRW5kU2hhcGVDb250YWN0KSB7CiAgICAgICAgZm9yIChsZXQgaSA9IDAsIGwgPSByZW1vdmFscy5sZW5ndGg7IGkgPCBsOyBpICs9IDIpIHsKICAgICAgICAgIGNvbnN0IHNoYXBlQSA9IHRoaXMuZ2V0U2hhcGVCeUlkKHJlbW92YWxzW2ldKTsKICAgICAgICAgIGNvbnN0IHNoYXBlQiA9IHRoaXMuZ2V0U2hhcGVCeUlkKHJlbW92YWxzW2kgKyAxXSk7CiAgICAgICAgICBlbmRTaGFwZUNvbnRhY3RFdmVudC5zaGFwZUEgPSBzaGFwZUE7CiAgICAgICAgICBlbmRTaGFwZUNvbnRhY3RFdmVudC5zaGFwZUIgPSBzaGFwZUI7CiAgICAgICAgICBpZiAoc2hhcGVBKSBlbmRTaGFwZUNvbnRhY3RFdmVudC5ib2R5QSA9IHNoYXBlQS5ib2R5OwogICAgICAgICAgaWYgKHNoYXBlQikgZW5kU2hhcGVDb250YWN0RXZlbnQuYm9keUIgPSBzaGFwZUIuYm9keTsKICAgICAgICAgIHRoaXMuZGlzcGF0Y2hFdmVudChlbmRTaGFwZUNvbnRhY3RFdmVudCk7CiAgICAgICAgfQoKICAgICAgICBlbmRTaGFwZUNvbnRhY3RFdmVudC5ib2R5QSA9IGVuZFNoYXBlQ29udGFjdEV2ZW50LmJvZHlCID0gZW5kU2hhcGVDb250YWN0RXZlbnQuc2hhcGVBID0gZW5kU2hhcGVDb250YWN0RXZlbnQuc2hhcGVCID0gbnVsbDsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBTZXRzIGFsbCBib2R5IGZvcmNlcyBpbiB0aGUgd29ybGQgdG8gemVyby4KICAgICAqLwoKCiAgICBjbGVhckZvcmNlcygpIHsKICAgICAgY29uc3QgYm9kaWVzID0gdGhpcy5ib2RpZXM7CiAgICAgIGNvbnN0IE4gPSBib2RpZXMubGVuZ3RoOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IE47IGkrKykgewogICAgICAgIGNvbnN0IGIgPSBib2RpZXNbaV07CiAgICAgICAgYi5mb3JjZTsKICAgICAgICBiLnRvcnF1ZTsKICAgICAgICBiLmZvcmNlLnNldCgwLCAwLCAwKTsKICAgICAgICBiLnRvcnF1ZS5zZXQoMCwgMCwgMCk7CiAgICAgIH0KICAgIH0KCiAgfSAvLyBUZW1wIHN0dWZmCgogIG5ldyBBQUJCKCk7CiAgY29uc3QgdG1wUmF5ID0gbmV3IFJheSgpOyAvLyBwZXJmb3JtYW5jZS5ub3coKSBmYWxsYmFjayBvbiBEYXRlLm5vdygpCgogIGNvbnN0IHBlcmZvcm1hbmNlID0gZ2xvYmFsVGhpcy5wZXJmb3JtYW5jZSB8fCB7fTsKCiAgaWYgKCFwZXJmb3JtYW5jZS5ub3cpIHsKICAgIGxldCBub3dPZmZzZXQgPSBEYXRlLm5vdygpOwoKICAgIGlmIChwZXJmb3JtYW5jZS50aW1pbmcgJiYgcGVyZm9ybWFuY2UudGltaW5nLm5hdmlnYXRpb25TdGFydCkgewogICAgICBub3dPZmZzZXQgPSBwZXJmb3JtYW5jZS50aW1pbmcubmF2aWdhdGlvblN0YXJ0OwogICAgfQoKICAgIHBlcmZvcm1hbmNlLm5vdyA9ICgpID0+IERhdGUubm93KCkgLSBub3dPZmZzZXQ7CiAgfQoKICBuZXcgVmVjMygpOyAvLyBEaXNwYXRjaGVkIGFmdGVyIHRoZSB3b3JsZCBoYXMgc3RlcHBlZCBmb3J3YXJkIGluIHRpbWUuCiAgLy8gUmV1c2FibGUgZXZlbnQgb2JqZWN0cyB0byBzYXZlIG1lbW9yeS4KCiAgY29uc3QgV29ybGRfc3RlcF9wb3N0U3RlcEV2ZW50ID0gewogICAgdHlwZTogJ3Bvc3RTdGVwJwogIH07IC8vIERpc3BhdGNoZWQgYmVmb3JlIHRoZSB3b3JsZCBzdGVwcyBmb3J3YXJkIGluIHRpbWUuCgogIGNvbnN0IFdvcmxkX3N0ZXBfcHJlU3RlcEV2ZW50ID0gewogICAgdHlwZTogJ3ByZVN0ZXAnCiAgfTsKICBjb25zdCBXb3JsZF9zdGVwX2NvbGxpZGVFdmVudCA9IHsKICAgIHR5cGU6IEJvZHkuQ09MTElERV9FVkVOVF9OQU1FLAogICAgYm9keTogbnVsbCwKICAgIGNvbnRhY3Q6IG51bGwKICB9OyAvLyBQb29scyBmb3IgdW51c2VkIG9iamVjdHMKCiAgY29uc3QgV29ybGRfc3RlcF9vbGRDb250YWN0cyA9IFtdOwogIGNvbnN0IFdvcmxkX3N0ZXBfZnJpY3Rpb25FcXVhdGlvblBvb2wgPSBbXTsgLy8gUmV1c2FibGUgYXJyYXlzIGZvciBjb2xsaXNpb24gcGFpcnMKCiAgY29uc3QgV29ybGRfc3RlcF9wMSA9IFtdOwogIGNvbnN0IFdvcmxkX3N0ZXBfcDIgPSBbXTsgLy8gU3R1ZmYgZm9yIGVtaXRDb250YWN0RXZlbnRzCgogIGNvbnN0IGFkZGl0aW9ucyA9IFtdOwogIGNvbnN0IHJlbW92YWxzID0gW107CiAgY29uc3QgYmVnaW5Db250YWN0RXZlbnQgPSB7CiAgICB0eXBlOiAnYmVnaW5Db250YWN0JywKICAgIGJvZHlBOiBudWxsLAogICAgYm9keUI6IG51bGwKICB9OwogIGNvbnN0IGVuZENvbnRhY3RFdmVudCA9IHsKICAgIHR5cGU6ICdlbmRDb250YWN0JywKICAgIGJvZHlBOiBudWxsLAogICAgYm9keUI6IG51bGwKICB9OwogIGNvbnN0IGJlZ2luU2hhcGVDb250YWN0RXZlbnQgPSB7CiAgICB0eXBlOiAnYmVnaW5TaGFwZUNvbnRhY3QnLAogICAgYm9keUE6IG51bGwsCiAgICBib2R5QjogbnVsbCwKICAgIHNoYXBlQTogbnVsbCwKICAgIHNoYXBlQjogbnVsbAogIH07CiAgY29uc3QgZW5kU2hhcGVDb250YWN0RXZlbnQgPSB7CiAgICB0eXBlOiAnZW5kU2hhcGVDb250YWN0JywKICAgIGJvZHlBOiBudWxsLAogICAgYm9keUI6IG51bGwsCiAgICBzaGFwZUE6IG51bGwsCiAgICBzaGFwZUI6IG51bGwKICB9OwoKICBjb25zdCBhZGRDb250YWN0TWF0ZXJpYWwgPSAod29ybGQsIGNyZWF0ZU1hdGVyaWFsLCBfcmVmLCB1dWlkKSA9PiB7CiAgICBsZXQgW21hdGVyaWFsQSwgbWF0ZXJpYWxCLCBvcHRpb25zXSA9IF9yZWY7CiAgICBjb25zdCBtYXRBID0gY3JlYXRlTWF0ZXJpYWwobWF0ZXJpYWxBKTsKICAgIGNvbnN0IG1hdEIgPSBjcmVhdGVNYXRlcmlhbChtYXRlcmlhbEIpOwogICAgY29uc3QgY29udGFjdE1hdGVyaWFsID0gbmV3IENvbnRhY3RNYXRlcmlhbChtYXRBLCBtYXRCLCBvcHRpb25zKTsKICAgIGNvbnRhY3RNYXRlcmlhbC51dWlkID0gdXVpZDsKICAgIHdvcmxkLmFkZENvbnRhY3RNYXRlcmlhbChjb250YWN0TWF0ZXJpYWwpOwogIH07CiAgY29uc3QgcmVtb3ZlQ29udGFjdE1hdGVyaWFsID0gKHdvcmxkLCBjbVVVSUQpID0+IHsKICAgIGNvbnN0IGluZGV4ID0gd29ybGQuY29udGFjdG1hdGVyaWFscy5maW5kSW5kZXgoX3JlZjIgPT4gewogICAgICBsZXQgewogICAgICAgIHV1aWQKICAgICAgfSA9IF9yZWYyOwogICAgICByZXR1cm4gdXVpZCA9PT0gY21VVUlEOwogICAgfSk7CiAgICBjb25zdCBbewogICAgICBpZDogaQogICAgfSwgewogICAgICBpZDogagogICAgfV0gPSB3b3JsZC5jb250YWN0bWF0ZXJpYWxzW2luZGV4XS5tYXRlcmlhbHM7CiAgICB3b3JsZC5jb250YWN0bWF0ZXJpYWxzLnNwbGljZShpbmRleCwgMSk7CiAgICBkZWxldGUgd29ybGQuY29udGFjdE1hdGVyaWFsVGFibGUuZGF0YVtpIDwgaiA/IGAke2l9LSR7an1gIDogYCR7an0tJHtpfWBdOwogIH07CgogIGxldCBtYXRlcmlhbElkID0gMDsKICBjb25zdCBjcmVhdGVNYXRlcmlhbEZhY3RvcnkgPSBtYXRlcmlhbHMgPT4gZnVuY3Rpb24gKG5hbWVPck9wdGlvbnMpIHsKICAgIGlmIChuYW1lT3JPcHRpb25zID09PSB2b2lkIDApIHsKICAgICAgbmFtZU9yT3B0aW9ucyA9IHt9OwogICAgfQogICAgY29uc3QgbWF0ZXJpYWxPcHRpb25zID0gdHlwZW9mIG5hbWVPck9wdGlvbnMgPT09ICdzdHJpbmcnID8gewogICAgICBuYW1lOiBuYW1lT3JPcHRpb25zCiAgICB9IDogewogICAgICBuYW1lOiBTeW1ib2wuZm9yKGBNYXRlcmlhbCR7bWF0ZXJpYWxJZCsrfWApLAogICAgICAuLi5uYW1lT3JPcHRpb25zCiAgICB9OwogICAgY29uc3QgewogICAgICBuYW1lCiAgICB9ID0gbWF0ZXJpYWxPcHRpb25zOwogICAgbWF0ZXJpYWxzW25hbWVdID0gbWF0ZXJpYWxzW25hbWVdIHx8IG5ldyBNYXRlcmlhbChtYXRlcmlhbE9wdGlvbnMpOwogICAgcmV0dXJuIG1hdGVyaWFsc1tuYW1lXTsKICB9OwoKICAvKioKICAgKiBAdHlwZWRlZiB7IGltcG9ydCgnY2Fubm9uLWVzJykuTWF0ZXJpYWxPcHRpb25zIH0gTWF0ZXJpYWxPcHRpb25zCiAgICovCgogIGNvbnN0IG1ha2VWZWMzID0gX3JlZiA9PiB7CiAgICBsZXQgW3gsIHksIHpdID0gX3JlZjsKICAgIHJldHVybiBuZXcgVmVjMyh4LCB5LCB6KTsKICB9OwogIGNvbnN0IHByZXBhcmVTcGhlcmUgPSBhcmdzID0+IEFycmF5LmlzQXJyYXkoYXJncykgPyBhcmdzIDogW2FyZ3NdOwogIGNvbnN0IHByZXBhcmVDb252ZXhQb2x5aGVkcm9uID0gX3JlZjIgPT4gewogICAgbGV0IFt2LCBmYWNlcywgbiwgYSwgYm91bmRpbmdTcGhlcmVSYWRpdXNdID0gX3JlZjI7CiAgICByZXR1cm4gW3sKICAgICAgYXhlczogYSA/IGEubWFwKG1ha2VWZWMzKSA6IHVuZGVmaW5lZCwKICAgICAgYm91bmRpbmdTcGhlcmVSYWRpdXMsCiAgICAgIGZhY2VzLAogICAgICBub3JtYWxzOiBuID8gbi5tYXAobWFrZVZlYzMpIDogdW5kZWZpbmVkLAogICAgICB2ZXJ0aWNlczogdiA/IHYubWFwKG1ha2VWZWMzKSA6IHVuZGVmaW5lZAogICAgfV07CiAgfTsKICBmdW5jdGlvbiBjcmVhdGVTaGFwZSh0eXBlLCBhcmdzKSB7CiAgICBzd2l0Y2ggKHR5cGUpIHsKICAgICAgY2FzZSAnQm94JzoKICAgICAgICByZXR1cm4gbmV3IEJveChuZXcgVmVjMyguLi5hcmdzLm1hcCh2ID0+IHYgLyAyKSkpOwogICAgICAvLyBleHRlbnRzID0+IGhhbGZFeHRlbnRzCiAgICAgIGNhc2UgJ0NvbnZleFBvbHloZWRyb24nOgogICAgICAgIHJldHVybiBuZXcgQ29udmV4UG9seWhlZHJvbiguLi5wcmVwYXJlQ29udmV4UG9seWhlZHJvbihhcmdzKSk7CiAgICAgIGNhc2UgJ0N5bGluZGVyJzoKICAgICAgICByZXR1cm4gbmV3IEN5bGluZGVyKC4uLmFyZ3MpOwogICAgICAvLyBbIHJhZGl1c1RvcCwgcmFkaXVzQm90dG9tLCBoZWlnaHQsIG51bVNlZ21lbnRzIF0gPSBhcmdzCiAgICAgIGNhc2UgJ0hlaWdodGZpZWxkJzoKICAgICAgICByZXR1cm4gbmV3IEhlaWdodGZpZWxkKC4uLmFyZ3MpOwogICAgICAvLyBbIEFycmF5IGRhdGEsIG9wdGlvbnM6IHttaW5WYWx1ZSwgbWF4VmFsdWUsIGVsZW1lbnRTaXplfSAgXSA9IGFyZ3MKICAgICAgY2FzZSAnUGFydGljbGUnOgogICAgICAgIHJldHVybiBuZXcgUGFydGljbGUoKTsKICAgICAgLy8gbm8gYXJncwogICAgICBjYXNlICdQbGFuZSc6CiAgICAgICAgcmV0dXJuIG5ldyBQbGFuZSgpOwogICAgICAvLyBubyBhcmdzLCBpbmZpbml0ZSB4IGFuZCB5CiAgICAgIGNhc2UgJ1NwaGVyZSc6CiAgICAgICAgcmV0dXJuIG5ldyBTcGhlcmUoLi4ucHJlcGFyZVNwaGVyZShhcmdzKSk7CiAgICAgIC8vIHJhZGl1cyA9IGFyZ3MKICAgICAgY2FzZSAnVHJpbWVzaCc6CiAgICAgICAgcmV0dXJuIG5ldyBUcmltZXNoKC4uLmFyZ3MpOwogICAgICAvLyBbdmVydGljZXMsIGluZGljZXNdID0gYXJncwogICAgfQogIH0KCiAgLyoqCiAgICogQHBhcmFtIHtUSFJFRS5RdWF0ZXJuaW9ufSB0YXJnZXQKICAgKiBAcGFyYW0ge3sgcm90YXRpb24/OiBUSFJFRS5WZWN0b3IzVHVwbGUgcXVhdGVybmlvbj86IFRIUkVFLlZlY3RvcjRUdXBsZSB9fSBwcm9wcwogICAqIEByZXR1cm5zIHtUSFJFRS5RdWF0ZXJuaW9ufQogICAqLwogIGNvbnN0IHNldFF1YXRlcm5pb24gPSAodGFyZ2V0LCBfcmVmMykgPT4gewogICAgbGV0IHsKICAgICAgcXVhdGVybmlvbiwKICAgICAgcm90YXRpb24KICAgIH0gPSBfcmVmMzsKICAgIGlmIChxdWF0ZXJuaW9uKSB7CiAgICAgIHRhcmdldC5zZXQoLi4ucXVhdGVybmlvbik7CiAgICB9IGVsc2UgaWYgKHJvdGF0aW9uKSB7CiAgICAgIHRhcmdldC5zZXRGcm9tRXVsZXIoLi4ucm90YXRpb24pOwogICAgfQogICAgcmV0dXJuIHRhcmdldDsKICB9OwoKICAvKioKICAgKiBAZnVuY3Rpb24KICAgKiBAcGFyYW0ge09iamVjdH0gb3B0aW9ucwogICAqIEBwYXJhbSB7c3RyaW5nfSBvcHRpb25zLnV1aWQKICAgKiBAcGFyYW0ge0JvZHlQcm9wc30gb3B0aW9ucy5wcm9wcwogICAqIEBwYXJhbSB7Qm9keVNoYXBlVHlwZX0gb3B0aW9ucy50eXBlCiAgICogQHBhcmFtIHsobWF0ZXJpYWxPcHRpb25zOiBNYXRlcmlhbE9wdGlvbnMpID0+IE1hdGVyaWFsID19IG9wdGlvbnMuY3JlYXRlTWF0ZXJpYWwKICAgKiBAcmV0dXJucyB7Qm9keX0KICAgKi8KICBjb25zdCBwcm9wc1RvQm9keSA9IG9wdGlvbnMgPT4gewogICAgY29uc3QgewogICAgICB1dWlkLAogICAgICBwcm9wcywKICAgICAgdHlwZSwKICAgICAgY3JlYXRlTWF0ZXJpYWwgPSBtYXRlcmlhbE9wdGlvbnMgPT4gbmV3IE1hdGVyaWFsKG1hdGVyaWFsT3B0aW9ucykKICAgIH0gPSBvcHRpb25zOwogICAgY29uc3QgewogICAgICBhbmd1bGFyRmFjdG9yID0gWzEsIDEsIDFdLAogICAgICBhbmd1bGFyVmVsb2NpdHkgPSBbMCwgMCwgMF0sCiAgICAgIGFyZ3MgPSBbXSwKICAgICAgY29sbGlzaW9uUmVzcG9uc2UsCiAgICAgIGxpbmVhckZhY3RvciA9IFsxLCAxLCAxXSwKICAgICAgbWFzcywKICAgICAgbWF0ZXJpYWwsCiAgICAgIG9uQ29sbGlkZSwKICAgICAgcG9zaXRpb24gPSBbMCwgMCwgMF0sCiAgICAgIHJvdGF0aW9uLAogICAgICBxdWF0ZXJuaW9uLAogICAgICBzaGFwZXMsCiAgICAgIHR5cGU6IGJvZHlUeXBlLAogICAgICB2ZWxvY2l0eSA9IFswLCAwLCAwXSwKICAgICAgLi4uZXh0cmEKICAgIH0gPSBwcm9wczsKICAgIGNvbnN0IGJvZHkgPSBuZXcgQm9keSh7CiAgICAgIC4uLmV4dHJhLAogICAgICBtYXNzOiBib2R5VHlwZSA9PT0gJ1N0YXRpYycgPyAwIDogbWFzcywKICAgICAgbWF0ZXJpYWw6IG1hdGVyaWFsID8gY3JlYXRlTWF0ZXJpYWwobWF0ZXJpYWwpIDogdW5kZWZpbmVkLAogICAgICB0eXBlOiBib2R5VHlwZSA/IEJvZHlbYm9keVR5cGUudG9VcHBlckNhc2UoKV0gOiB1bmRlZmluZWQKICAgIH0pOwogICAgYm9keS51dWlkID0gdXVpZDsKICAgIGlmIChjb2xsaXNpb25SZXNwb25zZSAhPT0gdW5kZWZpbmVkKSB7CiAgICAgIGJvZHkuY29sbGlzaW9uUmVzcG9uc2UgPSBjb2xsaXNpb25SZXNwb25zZTsKICAgIH0KICAgIGlmICh0eXBlID09PSAnQ29tcG91bmQnKSB7CiAgICAgIHNoYXBlcy5mb3JFYWNoKF9yZWY0ID0+IHsKICAgICAgICBsZXQgewogICAgICAgICAgdHlwZSwKICAgICAgICAgIGFyZ3MsCiAgICAgICAgICBwb3NpdGlvbiwKICAgICAgICAgIHJvdGF0aW9uLAogICAgICAgICAgcXVhdGVybmlvbiwKICAgICAgICAgIG1hdGVyaWFsLAogICAgICAgICAgLi4uZXh0cmEKICAgICAgICB9ID0gX3JlZjQ7CiAgICAgICAgY29uc3Qgc2hhcGVCb2R5ID0gYm9keS5hZGRTaGFwZShjcmVhdGVTaGFwZSh0eXBlLCBhcmdzKSwgcG9zaXRpb24gPyBuZXcgVmVjMyguLi5wb3NpdGlvbikgOiB1bmRlZmluZWQsIHNldFF1YXRlcm5pb24obmV3IFF1YXRlcm5pb24oMCwgMCwgMCwgMSksIHsKICAgICAgICAgIHF1YXRlcm5pb24sCiAgICAgICAgICByb3RhdGlvbgogICAgICAgIH0pKTsKICAgICAgICBpZiAobWF0ZXJpYWwpIHNoYXBlQm9keS5tYXRlcmlhbCA9IGNyZWF0ZU1hdGVyaWFsKG1hdGVyaWFsKTsKICAgICAgICBPYmplY3QuYXNzaWduKHNoYXBlQm9keSwgZXh0cmEpOwogICAgICB9KTsKICAgIH0gZWxzZSB7CiAgICAgIGJvZHkuYWRkU2hhcGUoY3JlYXRlU2hhcGUodHlwZSwgYXJncykpOwogICAgfQogICAgYm9keS5wb3NpdGlvbi5zZXQocG9zaXRpb25bMF0sIHBvc2l0aW9uWzFdLCBwb3NpdGlvblsyXSk7CiAgICBib2R5LnZlbG9jaXR5LnNldCh2ZWxvY2l0eVswXSwgdmVsb2NpdHlbMV0sIHZlbG9jaXR5WzJdKTsKICAgIGJvZHkuYW5ndWxhclZlbG9jaXR5LnNldChhbmd1bGFyVmVsb2NpdHlbMF0sIGFuZ3VsYXJWZWxvY2l0eVsxXSwgYW5ndWxhclZlbG9jaXR5WzJdKTsKICAgIGJvZHkubGluZWFyRmFjdG9yLnNldChsaW5lYXJGYWN0b3JbMF0sIGxpbmVhckZhY3RvclsxXSwgbGluZWFyRmFjdG9yWzJdKTsKICAgIGJvZHkuYW5ndWxhckZhY3Rvci5zZXQoYW5ndWxhckZhY3RvclswXSwgYW5ndWxhckZhY3RvclsxXSwgYW5ndWxhckZhY3RvclsyXSk7CiAgICBzZXRRdWF0ZXJuaW9uKGJvZHkucXVhdGVybmlvbiwgewogICAgICBxdWF0ZXJuaW9uLAogICAgICByb3RhdGlvbgogICAgfSk7CiAgICByZXR1cm4gYm9keTsKICB9OwoKICBjb25zdCBhZGRCb2RpZXMgPSAoc3RhdGUsIGNyZWF0ZU1hdGVyaWFsLCBfcmVmKSA9PiB7CiAgICBsZXQgewogICAgICBwcm9wcywKICAgICAgdHlwZSwKICAgICAgdXVpZAogICAgfSA9IF9yZWY7CiAgICBmb3IgKGxldCBpID0gMDsgaSA8IHV1aWQubGVuZ3RoOyBpKyspIHsKICAgICAgY29uc3QgYm9keSA9IHByb3BzVG9Cb2R5KHsKICAgICAgICBjcmVhdGVNYXRlcmlhbCwKICAgICAgICBwcm9wczogcHJvcHNbaV0sCiAgICAgICAgdHlwZSwKICAgICAgICB1dWlkOiB1dWlkW2ldCiAgICAgIH0pOwogICAgICBzdGF0ZS53b3JsZC5hZGRCb2R5KGJvZHkpOwogICAgICBpZiAocHJvcHNbaV0ub25Db2xsaWRlKSBib2R5LmFkZEV2ZW50TGlzdGVuZXIoJ2NvbGxpZGUnLCBfcmVmMiA9PiB7CiAgICAgICAgbGV0IHsKICAgICAgICAgIHR5cGUsCiAgICAgICAgICBib2R5LAogICAgICAgICAgdGFyZ2V0LAogICAgICAgICAgY29udGFjdAogICAgICAgIH0gPSBfcmVmMjsKICAgICAgICBpZiAoIWJvZHkudXVpZCB8fCAhdGFyZ2V0LnV1aWQpIHJldHVybjsKICAgICAgICBjb25zdCB7CiAgICAgICAgICBuaSwKICAgICAgICAgIHJpLAogICAgICAgICAgcmosCiAgICAgICAgICBiaSwKICAgICAgICAgIGJqLAogICAgICAgICAgaWQKICAgICAgICB9ID0gY29udGFjdDsKICAgICAgICBjb25zdCBjb250YWN0UG9pbnQgPSBiaS5wb3NpdGlvbi52YWRkKHJpKTsKICAgICAgICBjb25zdCBjb250YWN0Tm9ybWFsID0gYmkgPT09IGJvZHkgPyBuaSA6IG5pLnNjYWxlKC0xKTsKICAgICAgICBzZWxmLnBvc3RNZXNzYWdlKHsKICAgICAgICAgIGJvZHk6IGJvZHkudXVpZCwKICAgICAgICAgIGNvbGxpc2lvbkZpbHRlcnM6IHsKICAgICAgICAgICAgYm9keUZpbHRlckdyb3VwOiBib2R5LmNvbGxpc2lvbkZpbHRlckdyb3VwLAogICAgICAgICAgICBib2R5RmlsdGVyTWFzazogYm9keS5jb2xsaXNpb25GaWx0ZXJNYXNrLAogICAgICAgICAgICB0YXJnZXRGaWx0ZXJHcm91cDogdGFyZ2V0LmNvbGxpc2lvbkZpbHRlckdyb3VwLAogICAgICAgICAgICB0YXJnZXRGaWx0ZXJNYXNrOiB0YXJnZXQuY29sbGlzaW9uRmlsdGVyTWFzawogICAgICAgICAgfSwKICAgICAgICAgIGNvbnRhY3Q6IHsKICAgICAgICAgICAgLy8gQHRzLWV4cGVjdC1lcnJvciBUT0RPOiB1c2UgaWQgaW5zdGVhZCBvZiB1dWlkCiAgICAgICAgICAgIGJpOiBiaS51dWlkLAogICAgICAgICAgICAvLyBAdHMtZXhwZWN0LWVycm9yIFRPRE86IHVzZSBpZCBpbnN0ZWFkIG9mIHV1aWQKICAgICAgICAgICAgYmo6IGJqLnV1aWQsCiAgICAgICAgICAgIC8vIE5vcm1hbCBvZiB0aGUgY29udGFjdCwgcmVsYXRpdmUgdG8gdGhlIGNvbGxpZGluZyBib2R5CiAgICAgICAgICAgIGNvbnRhY3ROb3JtYWw6IGNvbnRhY3ROb3JtYWwudG9BcnJheSgpLAogICAgICAgICAgICAvLyBXb3JsZCBwb3NpdGlvbiBvZiB0aGUgY29udGFjdAogICAgICAgICAgICBjb250YWN0UG9pbnQ6IGNvbnRhY3RQb2ludC50b0FycmF5KCksCiAgICAgICAgICAgIGlkLAogICAgICAgICAgICBpbXBhY3RWZWxvY2l0eTogY29udGFjdC5nZXRJbXBhY3RWZWxvY2l0eUFsb25nTm9ybWFsKCksCiAgICAgICAgICAgIG5pOiBuaS50b0FycmF5KCksCiAgICAgICAgICAgIHJpOiByaS50b0FycmF5KCksCiAgICAgICAgICAgIHJqOiByai50b0FycmF5KCkKICAgICAgICAgIH0sCiAgICAgICAgICBvcDogJ2V2ZW50JywKICAgICAgICAgIHRhcmdldDogdGFyZ2V0LnV1aWQsCiAgICAgICAgICB0eXBlCiAgICAgICAgfSk7CiAgICAgIH0pOwogICAgfQogIH07CgogIGNvbnN0IHRyaXBsZXRUb1ZlYzMgPSB0ID0+IHQgPyBuZXcgVmVjMyguLi50KSA6IHVuZGVmaW5lZDsKCiAgY29uc3QgYWRkQ29uc3RyYWludCA9IChzdGF0ZSwgX3JlZikgPT4gewogICAgbGV0IHsKICAgICAgcHJvcHM6IFtib2R5QSwgYm9keUIsIHsKICAgICAgICBhbmdsZSwKICAgICAgICBheGlzQSwKICAgICAgICBheGlzQiwKICAgICAgICBjb2xsaWRlQ29ubmVjdGVkLAogICAgICAgIGRpc3RhbmNlLAogICAgICAgIG1heEZvcmNlLAogICAgICAgIG1heE11bHRpcGxpZXIsCiAgICAgICAgcGl2b3RBLAogICAgICAgIHBpdm90QiwKICAgICAgICB0d2lzdEFuZ2xlLAogICAgICAgIHdha2VVcEJvZGllcwogICAgICB9XSwKICAgICAgdHlwZSwKICAgICAgdXVpZAogICAgfSA9IF9yZWY7CiAgICBsZXQgY29uc3RyYWludDsKICAgIHN3aXRjaCAodHlwZSkgewogICAgICBjYXNlICdQb2ludFRvUG9pbnQnOgogICAgICAgIGNvbnN0cmFpbnQgPSBuZXcgUG9pbnRUb1BvaW50Q29uc3RyYWludChzdGF0ZS5ib2RpZXNbYm9keUFdLCB0cmlwbGV0VG9WZWMzKHBpdm90QSksIHN0YXRlLmJvZGllc1tib2R5Ql0sIHRyaXBsZXRUb1ZlYzMocGl2b3RCKSwgbWF4Rm9yY2UpOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlICdDb25lVHdpc3QnOgogICAgICAgIGNvbnN0cmFpbnQgPSBuZXcgQ29uZVR3aXN0Q29uc3RyYWludChzdGF0ZS5ib2RpZXNbYm9keUFdLCBzdGF0ZS5ib2RpZXNbYm9keUJdLCB7CiAgICAgICAgICBhbmdsZSwKICAgICAgICAgIGF4aXNBOiB0cmlwbGV0VG9WZWMzKGF4aXNBKSwKICAgICAgICAgIGF4aXNCOiB0cmlwbGV0VG9WZWMzKGF4aXNCKSwKICAgICAgICAgIGNvbGxpZGVDb25uZWN0ZWQsCiAgICAgICAgICBtYXhGb3JjZSwKICAgICAgICAgIHBpdm90QTogdHJpcGxldFRvVmVjMyhwaXZvdEEpLAogICAgICAgICAgcGl2b3RCOiB0cmlwbGV0VG9WZWMzKHBpdm90QiksCiAgICAgICAgICB0d2lzdEFuZ2xlCiAgICAgICAgfSk7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgJ0hpbmdlJzoKICAgICAgICBjb25zdHJhaW50ID0gbmV3IEhpbmdlQ29uc3RyYWludChzdGF0ZS5ib2RpZXNbYm9keUFdLCBzdGF0ZS5ib2RpZXNbYm9keUJdLCB7CiAgICAgICAgICBheGlzQTogdHJpcGxldFRvVmVjMyhheGlzQSksCiAgICAgICAgICBheGlzQjogdHJpcGxldFRvVmVjMyhheGlzQiksCiAgICAgICAgICBjb2xsaWRlQ29ubmVjdGVkLAogICAgICAgICAgbWF4Rm9yY2UsCiAgICAgICAgICBwaXZvdEE6IHRyaXBsZXRUb1ZlYzMocGl2b3RBKSwKICAgICAgICAgIHBpdm90QjogdHJpcGxldFRvVmVjMyhwaXZvdEIpCiAgICAgICAgfSk7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgJ0Rpc3RhbmNlJzoKICAgICAgICBjb25zdHJhaW50ID0gbmV3IERpc3RhbmNlQ29uc3RyYWludChzdGF0ZS5ib2RpZXNbYm9keUFdLCBzdGF0ZS5ib2RpZXNbYm9keUJdLCBkaXN0YW5jZSwgbWF4Rm9yY2UpOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlICdMb2NrJzoKICAgICAgICBjb25zdHJhaW50ID0gbmV3IExvY2tDb25zdHJhaW50KHN0YXRlLmJvZGllc1tib2R5QV0sIHN0YXRlLmJvZGllc1tib2R5Ql0sIHsKICAgICAgICAgIG1heEZvcmNlCiAgICAgICAgfSk7CiAgICAgICAgYnJlYWs7CiAgICAgIGRlZmF1bHQ6CiAgICAgICAgY29uc3RyYWludCA9IG5ldyBDb25zdHJhaW50KHN0YXRlLmJvZGllc1tib2R5QV0sIHN0YXRlLmJvZGllc1tib2R5Ql0sIHsKICAgICAgICAgIGNvbGxpZGVDb25uZWN0ZWQsCiAgICAgICAgICB3YWtlVXBCb2RpZXMKICAgICAgICB9KTsKICAgICAgICBicmVhazsKICAgIH0KICAgIGNvbnN0cmFpbnQudXVpZCA9IHV1aWQ7CiAgICBzdGF0ZS53b3JsZC5hZGRDb25zdHJhaW50KGNvbnN0cmFpbnQpOwogICAgaWYgKG1heE11bHRpcGxpZXIgIT09IHVuZGVmaW5lZCkgewogICAgICBjb25zdCBwb3N0U3RlcENvbnN0cmFpbnQgPSAoKSA9PiB7CiAgICAgICAgLy8gVGhlIG11bHRpcGxpZXIgaXMgcHJvcG9ydGlvbmFsIHRvIGhvdyBtdWNoIGZvcmNlIGlzIGFkZGVkIHRvIHRoZSBib2RpZXMgYnkgdGhlIGNvbnN0cmFpbnQuCiAgICAgICAgLy8gSWYgdGhpcyBleGNlZWRzIGEgbGltaXQgdGhlIGNvbnN0cmFpbnQgaXMgZGlzYWJsZWQuCiAgICAgICAgY29uc3QgbXVsdGlwbGllciA9IE1hdGguYWJzKGNvbnN0cmFpbnQuZXF1YXRpb25zWzBdLm11bHRpcGxpZXIpOwogICAgICAgIGlmIChtdWx0aXBsaWVyID4gbWF4TXVsdGlwbGllcikgewogICAgICAgICAgY29uc3RyYWludC5kaXNhYmxlKCk7CiAgICAgICAgfQogICAgICB9OwogICAgICBzdGF0ZS5jb25zdHJhaW50c1t1dWlkXSA9IHBvc3RTdGVwQ29uc3RyYWludDsKICAgICAgc3RhdGUud29ybGQuYWRkRXZlbnRMaXN0ZW5lcigncG9zdFN0ZXAnLCBzdGF0ZS5jb25zdHJhaW50c1t1dWlkXSk7CiAgICB9CiAgfTsKCiAgZnVuY3Rpb24gdG9VcHBlcmNhc2Uoc3RyKSB7CiAgICByZXR1cm4gc3RyLnRvVXBwZXJDYXNlKCk7CiAgfQogIGNvbnN0IGFkZFJheSA9IChzdGF0ZSwgX3JlZikgPT4gewogICAgbGV0IHsKICAgICAgcHJvcHM6IHsKICAgICAgICBmcm9tLAogICAgICAgIG1vZGUsCiAgICAgICAgdG8sCiAgICAgICAgLi4ucmF5T3B0aW9ucwogICAgICB9LAogICAgICB1dWlkCiAgICB9ID0gX3JlZjsKICAgIGNvbnN0IHJheSA9IG5ldyBSYXkodHJpcGxldFRvVmVjMyhmcm9tKSwgdHJpcGxldFRvVmVjMyh0bykpOwogICAgY29uc3Qgb3B0aW9ucyA9IHsKICAgICAgbW9kZTogUkFZX01PREVTW3RvVXBwZXJjYXNlKG1vZGUpXSwKICAgICAgcmVzdWx0OiBuZXcgUmF5Y2FzdFJlc3VsdCgpLAogICAgICAuLi5yYXlPcHRpb25zCiAgICB9OwogICAgc3RhdGUucmF5c1t1dWlkXSA9ICgpID0+IHsKICAgICAgcmF5LmludGVyc2VjdFdvcmxkKHN0YXRlLndvcmxkLCBvcHRpb25zKTsKICAgICAgaWYgKCFvcHRpb25zLnJlc3VsdCB8fCAhb3B0aW9ucy5yZXN1bHQuYm9keSkgcmV0dXJuOwogICAgICBjb25zdCB7CiAgICAgICAgYm9keSwKICAgICAgICBzaGFwZSwKICAgICAgICByYXlGcm9tV29ybGQsCiAgICAgICAgcmF5VG9Xb3JsZCwKICAgICAgICBoaXROb3JtYWxXb3JsZCwKICAgICAgICBoaXRQb2ludFdvcmxkLAogICAgICAgIC4uLnJlc3QKICAgICAgfSA9IG9wdGlvbnMucmVzdWx0OwogICAgICBjb25zdCBib2R5VVVJRCA9IGJvZHkudXVpZDsKICAgICAgaWYgKCFib2R5VVVJRCkgcmV0dXJuOwogICAgICBzZWxmLnBvc3RNZXNzYWdlKHsKICAgICAgICBib2R5OiBib2R5VVVJRCwKICAgICAgICBoaXROb3JtYWxXb3JsZDogaGl0Tm9ybWFsV29ybGQudG9BcnJheSgpLAogICAgICAgIGhpdFBvaW50V29ybGQ6IGhpdFBvaW50V29ybGQudG9BcnJheSgpLAogICAgICAgIG9wOiAnZXZlbnQnLAogICAgICAgIHJheTogewogICAgICAgICAgY29sbGlzaW9uRmlsdGVyR3JvdXA6IHJheS5jb2xsaXNpb25GaWx0ZXJHcm91cCwKICAgICAgICAgIGNvbGxpc2lvbkZpbHRlck1hc2s6IHJheS5jb2xsaXNpb25GaWx0ZXJNYXNrLAogICAgICAgICAgZGlyZWN0aW9uOiByYXkuZGlyZWN0aW9uLnRvQXJyYXkoKSwKICAgICAgICAgIGZyb20sCiAgICAgICAgICB0bywKICAgICAgICAgIHV1aWQKICAgICAgICB9LAogICAgICAgIHJheUZyb21Xb3JsZDogcmF5RnJvbVdvcmxkLnRvQXJyYXkoKSwKICAgICAgICByYXlUb1dvcmxkOiByYXlUb1dvcmxkLnRvQXJyYXkoKSwKICAgICAgICBzaGFwZTogc2hhcGUgPyB7CiAgICAgICAgICAuLi5zaGFwZSwKICAgICAgICAgIGJvZHk6IGJvZHlVVUlECiAgICAgICAgfSA6IG51bGwsCiAgICAgICAgdHlwZTogJ3JheWhpdCcsCiAgICAgICAgLi4ucmVzdAogICAgICB9KTsKICAgIH07CiAgICBzdGF0ZS53b3JsZC5hZGRFdmVudExpc3RlbmVyKCdwcmVTdGVwJywgc3RhdGUucmF5c1t1dWlkXSk7CiAgfTsKCiAgY29uc3QgYWRkUmF5Y2FzdFZlaGljbGUgPSAoc3RhdGUsIGRhdGEpID0+IHsKICAgIGNvbnN0IFtjaGFzc2lzQm9keSwgd2hlZWxzLCB3aGVlbEluZm9zLCBpbmRleEZvcndhcmRBeGlzLCBpbmRleFJpZ2h0QXhpcywgaW5kZXhVcEF4aXNdID0gZGF0YS5wcm9wczsKICAgIGNvbnN0IHZlaGljbGUgPSBuZXcgUmF5Y2FzdFZlaGljbGUoewogICAgICBjaGFzc2lzQm9keTogc3RhdGUuYm9kaWVzW2NoYXNzaXNCb2R5XSwKICAgICAgaW5kZXhGb3J3YXJkQXhpcywKICAgICAgaW5kZXhSaWdodEF4aXMsCiAgICAgIGluZGV4VXBBeGlzCiAgICB9KTsKICAgIHZlaGljbGUud29ybGQgPSBzdGF0ZS53b3JsZDsKICAgIGZvciAobGV0IGkgPSAwOyBpIDwgd2hlZWxJbmZvcy5sZW5ndGg7IGkrKykgewogICAgICBjb25zdCB7CiAgICAgICAgYXhsZUxvY2FsLAogICAgICAgIGNoYXNzaXNDb25uZWN0aW9uUG9pbnRMb2NhbCwKICAgICAgICBkaXJlY3Rpb25Mb2NhbCwKICAgICAgICAuLi5yZXN0CiAgICAgIH0gPSB3aGVlbEluZm9zW2ldOwogICAgICB2ZWhpY2xlLmFkZFdoZWVsKHsKICAgICAgICBheGxlTG9jYWw6IHRyaXBsZXRUb1ZlYzMoYXhsZUxvY2FsKSwKICAgICAgICBjaGFzc2lzQ29ubmVjdGlvblBvaW50TG9jYWw6IHRyaXBsZXRUb1ZlYzMoY2hhc3Npc0Nvbm5lY3Rpb25Qb2ludExvY2FsKSwKICAgICAgICBkaXJlY3Rpb25Mb2NhbDogdHJpcGxldFRvVmVjMyhkaXJlY3Rpb25Mb2NhbCksCiAgICAgICAgLi4ucmVzdAogICAgICB9KTsKICAgIH0KICAgIGNvbnN0IHByZVN0ZXAgPSAoKSA9PiB7CiAgICAgIHZlaGljbGUudXBkYXRlVmVoaWNsZShzdGF0ZS53b3JsZC5kdCk7CiAgICB9OwogICAgY29uc3QgcG9zdFN0ZXAgPSAoKSA9PiB7CiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdmVoaWNsZS53aGVlbEluZm9zLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgdmVoaWNsZS51cGRhdGVXaGVlbFRyYW5zZm9ybShpKTsKICAgICAgICBjb25zdCB0ID0gdmVoaWNsZS53aGVlbEluZm9zW2ldLndvcmxkVHJhbnNmb3JtOwogICAgICAgIGNvbnN0IHdoZWVsQm9keSA9IHN0YXRlLmJvZGllc1t3aGVlbHNbaV1dOwogICAgICAgIHdoZWVsQm9keS5wb3NpdGlvbi5jb3B5KHQucG9zaXRpb24pOwogICAgICAgIHdoZWVsQm9keS5xdWF0ZXJuaW9uLmNvcHkodC5xdWF0ZXJuaW9uKTsKICAgICAgfQogICAgfTsKICAgIHN0YXRlLnZlaGljbGVzW2RhdGEudXVpZF0gPSB7CiAgICAgIHBvc3RTdGVwLAogICAgICBwcmVTdGVwLAogICAgICB2ZWhpY2xlCiAgICB9OwogICAgc3RhdGUud29ybGQuYWRkRXZlbnRMaXN0ZW5lcigncHJlU3RlcCcsIHByZVN0ZXApOwogICAgc3RhdGUud29ybGQuYWRkRXZlbnRMaXN0ZW5lcigncG9zdFN0ZXAnLCBwb3N0U3RlcCk7CiAgfTsKCiAgY29uc3QgYWRkU3ByaW5nID0gKHN0YXRlLCBfcmVmKSA9PiB7CiAgICBsZXQgewogICAgICBwcm9wczogW2JvZHlBLCBib2R5QiwgewogICAgICAgIGRhbXBpbmcsCiAgICAgICAgbG9jYWxBbmNob3JBLAogICAgICAgIGxvY2FsQW5jaG9yQiwKICAgICAgICByZXN0TGVuZ3RoLAogICAgICAgIHN0aWZmbmVzcywKICAgICAgICB3b3JsZEFuY2hvckEsCiAgICAgICAgd29ybGRBbmNob3JCCiAgICAgIH1dLAogICAgICB1dWlkCiAgICB9ID0gX3JlZjsKICAgIGNvbnN0IHNwcmluZyA9IG5ldyBTcHJpbmcoc3RhdGUuYm9kaWVzW2JvZHlBXSwgc3RhdGUuYm9kaWVzW2JvZHlCXSwgewogICAgICBkYW1waW5nLAogICAgICBsb2NhbEFuY2hvckE6IHRyaXBsZXRUb1ZlYzMobG9jYWxBbmNob3JBKSwKICAgICAgbG9jYWxBbmNob3JCOiB0cmlwbGV0VG9WZWMzKGxvY2FsQW5jaG9yQiksCiAgICAgIHJlc3RMZW5ndGgsCiAgICAgIHN0aWZmbmVzcywKICAgICAgd29ybGRBbmNob3JBOiB0cmlwbGV0VG9WZWMzKHdvcmxkQW5jaG9yQSksCiAgICAgIHdvcmxkQW5jaG9yQjogdHJpcGxldFRvVmVjMyh3b3JsZEFuY2hvckIpCiAgICB9KTsKICAgIHNwcmluZy51dWlkID0gdXVpZDsKICAgIGNvbnN0IHBvc3RTdGVwU3ByaW5nID0gKCkgPT4gc3ByaW5nLmFwcGx5Rm9yY2UoKTsKICAgIHN0YXRlLnNwcmluZ3NbdXVpZF0gPSBwb3N0U3RlcFNwcmluZzsKICAgIHN0YXRlLnNwcmluZ0luc3RhbmNlc1t1dWlkXSA9IHNwcmluZzsKCiAgICAvLyBDb21wdXRlIHRoZSBmb3JjZSBhZnRlciBlYWNoIHN0ZXAKICAgIHN0YXRlLndvcmxkLmFkZEV2ZW50TGlzdGVuZXIoJ3Bvc3RTdGVwJywgc3RhdGUuc3ByaW5nc1t1dWlkXSk7CiAgfTsKCiAgZnVuY3Rpb24gZW1pdEJlZ2luQ29udGFjdChfcmVmKSB7CiAgICBsZXQgewogICAgICBib2R5QSwKICAgICAgYm9keUIKICAgIH0gPSBfcmVmOwogICAgaWYgKCEoYm9keUEgIT0gbnVsbCAmJiBib2R5QS51dWlkKSB8fCAhKGJvZHlCICE9IG51bGwgJiYgYm9keUIudXVpZCkpIHJldHVybjsKICAgIHNlbGYucG9zdE1lc3NhZ2UoewogICAgICBib2R5QTogYm9keUEudXVpZCwKICAgICAgYm9keUI6IGJvZHlCLnV1aWQsCiAgICAgIG9wOiAnZXZlbnQnLAogICAgICB0eXBlOiAnY29sbGlkZUJlZ2luJwogICAgfSk7CiAgfQogIGZ1bmN0aW9uIGVtaXRFbmRDb250YWN0KF9yZWYyKSB7CiAgICBsZXQgewogICAgICBib2R5QSwKICAgICAgYm9keUIKICAgIH0gPSBfcmVmMjsKICAgIGlmICghKGJvZHlBICE9IG51bGwgJiYgYm9keUEudXVpZCkgfHwgIShib2R5QiAhPSBudWxsICYmIGJvZHlCLnV1aWQpKSByZXR1cm47CiAgICBzZWxmLnBvc3RNZXNzYWdlKHsKICAgICAgYm9keUE6IGJvZHlBLnV1aWQsCiAgICAgIGJvZHlCOiBib2R5Qi51dWlkLAogICAgICBvcDogJ2V2ZW50JywKICAgICAgdHlwZTogJ2NvbGxpZGVFbmQnCiAgICB9KTsKICB9CiAgY29uc3QgaW5pdCA9ICh3b3JsZCwgX3JlZjMpID0+IHsKICAgIGxldCB7CiAgICAgIGFsbG93U2xlZXAsCiAgICAgIGF4aXNJbmRleCA9IDAsCiAgICAgIGJyb2FkcGhhc2UsCiAgICAgIGRlZmF1bHRDb250YWN0TWF0ZXJpYWwsCiAgICAgIGZyaWN0aW9uR3Jhdml0eSwKICAgICAgZ3Jhdml0eSwKICAgICAgaXRlcmF0aW9ucywKICAgICAgcXVhdE5vcm1hbGl6ZUZhc3QsCiAgICAgIHF1YXROb3JtYWxpemVTa2lwLAogICAgICBzb2x2ZXIsCiAgICAgIHRvbGVyYW5jZQogICAgfSA9IF9yZWYzOwogICAgd29ybGQuYWxsb3dTbGVlcCA9IGFsbG93U2xlZXA7CiAgICB3b3JsZC5ncmF2aXR5LnNldCguLi5ncmF2aXR5KTsKICAgIHdvcmxkLmZyaWN0aW9uR3Jhdml0eSA9IGZyaWN0aW9uR3Jhdml0eSA/IG5ldyBWZWMzKC4uLmZyaWN0aW9uR3Jhdml0eSkgOiB1bmRlZmluZWQ7CiAgICB3b3JsZC5xdWF0Tm9ybWFsaXplRmFzdCA9IHF1YXROb3JtYWxpemVGYXN0OwogICAgd29ybGQucXVhdE5vcm1hbGl6ZVNraXAgPSBxdWF0Tm9ybWFsaXplU2tpcDsKICAgIGlmIChzb2x2ZXIgPT09ICdTcGxpdCcpIHsKICAgICAgd29ybGQuc29sdmVyID0gbmV3IFNwbGl0U29sdmVyKG5ldyBHU1NvbHZlcigpKTsKICAgIH0KICAgIGlmICh3b3JsZC5zb2x2ZXIgaW5zdGFuY2VvZiBHU1NvbHZlcikgewogICAgICB3b3JsZC5zb2x2ZXIudG9sZXJhbmNlID0gdG9sZXJhbmNlOwogICAgICB3b3JsZC5zb2x2ZXIuaXRlcmF0aW9ucyA9IGl0ZXJhdGlvbnM7CiAgICB9CiAgICB3b3JsZC5icm9hZHBoYXNlID0gYnJvYWRwaGFzZSA9PT0gJ1NBUCcgPyBuZXcgU0FQQnJvYWRwaGFzZSh3b3JsZCkgOiBuZXcgTmFpdmVCcm9hZHBoYXNlKCk7CiAgICBpZiAod29ybGQuYnJvYWRwaGFzZSBpbnN0YW5jZW9mIFNBUEJyb2FkcGhhc2UpIHsKICAgICAgd29ybGQuYnJvYWRwaGFzZS5heGlzSW5kZXggPSBheGlzSW5kZXg7CiAgICB9CiAgICB3b3JsZC5hZGRFdmVudExpc3RlbmVyKCdiZWdpbkNvbnRhY3QnLCBlbWl0QmVnaW5Db250YWN0KTsKICAgIHdvcmxkLmFkZEV2ZW50TGlzdGVuZXIoJ2VuZENvbnRhY3QnLCBlbWl0RW5kQ29udGFjdCk7CiAgICBPYmplY3QuYXNzaWduKHdvcmxkLmRlZmF1bHRDb250YWN0TWF0ZXJpYWwsIGRlZmF1bHRDb250YWN0TWF0ZXJpYWwpOwogIH07CgogIGNvbnN0IGlzUW9yViA9IHYgPT4gdiBpbnN0YW5jZW9mIFF1YXRlcm5pb24gfHwgdiBpbnN0YW5jZW9mIFZlYzM7CiAgY29uc3Qgc3RlcCA9IChzdGF0ZSwgX3JlZikgPT4gewogICAgbGV0IHsKICAgICAgcG9zaXRpb25zLAogICAgICBwcm9wczogewogICAgICAgIG1heFN1YlN0ZXBzLAogICAgICAgIHN0ZXBTaXplLAogICAgICAgIHRpbWVTaW5jZUxhc3RDYWxsZWQKICAgICAgfSwKICAgICAgcXVhdGVybmlvbnMKICAgIH0gPSBfcmVmOwogICAgc3RhdGUud29ybGQuc3RlcChzdGVwU2l6ZSwgdGltZVNpbmNlTGFzdENhbGxlZCwgbWF4U3ViU3RlcHMpOwogICAgZm9yIChsZXQgaSA9IDA7IGkgPCBzdGF0ZS53b3JsZC5ib2RpZXMubGVuZ3RoOyBpICs9IDEpIHsKICAgICAgY29uc3QgcCA9IHN0YXRlLndvcmxkLmJvZGllc1tpXS5wb3NpdGlvbjsKICAgICAgY29uc3QgcSA9IHN0YXRlLndvcmxkLmJvZGllc1tpXS5xdWF0ZXJuaW9uOwogICAgICBwb3NpdGlvbnNbMyAqIGkgKyAwXSA9IHAueDsKICAgICAgcG9zaXRpb25zWzMgKiBpICsgMV0gPSBwLnk7CiAgICAgIHBvc2l0aW9uc1szICogaSArIDJdID0gcC56OwogICAgICBxdWF0ZXJuaW9uc1s0ICogaSArIDBdID0gcS54OwogICAgICBxdWF0ZXJuaW9uc1s0ICogaSArIDFdID0gcS55OwogICAgICBxdWF0ZXJuaW9uc1s0ICogaSArIDJdID0gcS56OwogICAgICBxdWF0ZXJuaW9uc1s0ICogaSArIDNdID0gcS53OwogICAgfQogICAgY29uc3Qgb2JzZXJ2YXRpb25zID0gW107CiAgICBmb3IgKGNvbnN0IGlkIG9mIE9iamVjdC5rZXlzKHN0YXRlLnN1YnNjcmlwdGlvbnMpKSB7CiAgICAgIGNvbnN0IFt1dWlkLCB0eXBlLCB0YXJnZXQgPSAnYm9kaWVzJ10gPSBzdGF0ZS5zdWJzY3JpcHRpb25zW2lkXTsKICAgICAgY29uc3QgewogICAgICAgIGJvZGllcywKICAgICAgICB2ZWhpY2xlcwogICAgICB9ID0gc3RhdGU7CiAgICAgIGNvbnN0IHZhbHVlID0gdGFyZ2V0ID09PSAndmVoaWNsZXMnID8KICAgICAgLy8gQHRzLWV4cGVjdC1lcnJvciBUT0RPOiBEaWZmZXJlbnRpYXRlIHRoZXNlICJ0eXBlcyIKICAgICAgdmVoaWNsZXNbdXVpZF0udmVoaWNsZVt0eXBlXSA6CiAgICAgIC8vIEB0cy1leHBlY3QtZXJyb3IgVE9ETzogRGlmZmVyZW50aWF0ZSB0aGVzZSAidHlwZXMiCiAgICAgIGJvZGllc1t1dWlkXVt0eXBlXTsKICAgICAgY29uc3Qgc2VyaWFsaXphYmxlVmFsdWUgPSBpc1FvclYodmFsdWUpID8gdmFsdWUudG9BcnJheSgpIDogdmFsdWU7CiAgICAgIG9ic2VydmF0aW9ucy5wdXNoKFtOdW1iZXIoaWQpLCBzZXJpYWxpemFibGVWYWx1ZSwKICAgICAgLy8gQHRzLWV4cGVjdC1lcnJvciBUT0RPOiBEaWZmZXJlbnRpYXRlIHRoZXNlICJ0eXBlcyIKICAgICAgdHlwZV0pOwogICAgfQogICAgY29uc3QgbWVzc2FnZSA9IHsKICAgICAgYWN0aXZlOiBzdGF0ZS53b3JsZC5oYXNBY3RpdmVCb2RpZXMsCiAgICAgIG9ic2VydmF0aW9ucywKICAgICAgb3A6ICdmcmFtZScsCiAgICAgIHBvc2l0aW9ucywKICAgICAgcXVhdGVybmlvbnMKICAgIH07CiAgICBpZiAoc3RhdGUuYm9kaWVzTmVlZFN5bmNpbmcpIHsKICAgICAgbWVzc2FnZS5ib2RpZXMgPSBzdGF0ZS53b3JsZC5ib2RpZXMucmVkdWNlKChib2RpZXMsIGJvZHkpID0+IHsKICAgICAgICBpZiAoYm9keS51dWlkKSBib2RpZXMucHVzaChib2R5LnV1aWQpOwogICAgICAgIHJldHVybiBib2RpZXM7CiAgICAgIH0sIFtdKTsKICAgICAgc3RhdGUuYm9kaWVzTmVlZFN5bmNpbmcgPSBmYWxzZTsKICAgIH0KICAgIHNlbGYucG9zdE1lc3NhZ2UobWVzc2FnZSwgW3Bvc2l0aW9ucy5idWZmZXIsIHF1YXRlcm5pb25zLmJ1ZmZlcl0pOwogIH07CgogIGNvbnN0IHN0YXRlID0gewogICAgYm9kaWVzOiB7fSwKICAgIGJvZGllc05lZWRTeW5jaW5nOiBmYWxzZSwKICAgIGNvbnN0cmFpbnRzOiB7fSwKICAgIG1hdGVyaWFsczoge30sCiAgICByYXlzOiB7fSwKICAgIHNwcmluZ0luc3RhbmNlczoge30sCiAgICBzcHJpbmdzOiB7fSwKICAgIHN1YnNjcmlwdGlvbnM6IHt9LAogICAgdmVoaWNsZXM6IHt9LAogICAgd29ybGQ6IG5ldyBXb3JsZCgpCiAgfTsKCiAgLy8vIDxyZWZlcmVuY2Ugbm8tZGVmYXVsdC1saWI9InRydWUiLz4KICBjb25zdCBpc0hpbmdlQ29uc3RyYWludCA9IGMgPT4gYyBpbnN0YW5jZW9mIEhpbmdlQ29uc3RyYWludDsKICBmdW5jdGlvbiBzeW5jQm9kaWVzKCkgewogICAgc3RhdGUuYm9kaWVzTmVlZFN5bmNpbmcgPSB0cnVlOwogICAgc3RhdGUuYm9kaWVzID0gc3RhdGUud29ybGQuYm9kaWVzLnJlZHVjZSgoYm9kaWVzLCBib2R5KSA9PiBib2R5LnV1aWQgPyB7CiAgICAgIC4uLmJvZGllcywKICAgICAgW2JvZHkudXVpZF06IGJvZHkKICAgIH0gOiBib2RpZXMsIHt9KTsKICB9CiAgY29uc3QgYnJvYWRwaGFzZXMgPSB7CiAgICBOYWl2ZUJyb2FkcGhhc2UsCiAgICBTQVBCcm9hZHBoYXNlCiAgfTsKICBjb25zdCBjcmVhdGVNYXRlcmlhbCA9IGNyZWF0ZU1hdGVyaWFsRmFjdG9yeShzdGF0ZS5tYXRlcmlhbHMpOwogIHNlbGYub25tZXNzYWdlID0gX3JlZiA9PiB7CiAgICBsZXQgewogICAgICBkYXRhCiAgICB9ID0gX3JlZjsKICAgIHN3aXRjaCAoZGF0YS5vcCkgewogICAgICBjYXNlICdpbml0JzoKICAgICAgICB7CiAgICAgICAgICBpbml0KHN0YXRlLndvcmxkLCBkYXRhLnByb3BzKTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgY2FzZSAnc3RlcCc6CiAgICAgICAgewogICAgICAgICAgc3RlcChzdGF0ZSwgZGF0YSk7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgIGNhc2UgJ2FkZEJvZGllcyc6CiAgICAgICAgewogICAgICAgICAgYWRkQm9kaWVzKHN0YXRlLCBjcmVhdGVNYXRlcmlhbCwgZGF0YSk7CiAgICAgICAgICBzeW5jQm9kaWVzKCk7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgIGNhc2UgJ3JlbW92ZUJvZGllcyc6CiAgICAgICAgewogICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBkYXRhLnV1aWQubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgc3RhdGUud29ybGQucmVtb3ZlQm9keShzdGF0ZS5ib2RpZXNbZGF0YS51dWlkW2ldXSk7CiAgICAgICAgICAgIGNvbnN0IGtleSA9IE9iamVjdC5rZXlzKHN0YXRlLnN1YnNjcmlwdGlvbnMpLmZpbmQoayA9PiBzdGF0ZS5zdWJzY3JpcHRpb25zW2tdWzBdID09PSBkYXRhLnV1aWRbaV0pOwogICAgICAgICAgICBpZiAoa2V5KSB7CiAgICAgICAgICAgICAgZGVsZXRlIHN0YXRlLnN1YnNjcmlwdGlvbnNba2V5XTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgc3luY0JvZGllcygpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICBjYXNlICdzdWJzY3JpYmUnOgogICAgICAgIHsKICAgICAgICAgIGNvbnN0IHsKICAgICAgICAgICAgaWQsCiAgICAgICAgICAgIHRhcmdldCwKICAgICAgICAgICAgdHlwZQogICAgICAgICAgfSA9IGRhdGEucHJvcHM7CiAgICAgICAgICBzdGF0ZS5zdWJzY3JpcHRpb25zW2lkXSA9IFtkYXRhLnV1aWQsIHR5cGUsIHRhcmdldF07CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgIGNhc2UgJ3Vuc3Vic2NyaWJlJzoKICAgICAgICB7CiAgICAgICAgICBkZWxldGUgc3RhdGUuc3Vic2NyaXB0aW9uc1tkYXRhLnByb3BzXTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgY2FzZSAnc2V0UG9zaXRpb24nOgogICAgICAgIHN0YXRlLmJvZGllc1tkYXRhLnV1aWRdLnBvc2l0aW9uLnNldChkYXRhLnByb3BzWzBdLCBkYXRhLnByb3BzWzFdLCBkYXRhLnByb3BzWzJdKTsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAnc2V0UXVhdGVybmlvbic6CiAgICAgICAgc3RhdGUuYm9kaWVzW2RhdGEudXVpZF0ucXVhdGVybmlvbi5zZXQoZGF0YS5wcm9wc1swXSwgZGF0YS5wcm9wc1sxXSwgZGF0YS5wcm9wc1syXSwgZGF0YS5wcm9wc1szXSk7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgJ3NldFJvdGF0aW9uJzoKICAgICAgICBzdGF0ZS5ib2RpZXNbZGF0YS51dWlkXS5xdWF0ZXJuaW9uLnNldEZyb21FdWxlcihkYXRhLnByb3BzWzBdLCBkYXRhLnByb3BzWzFdLCBkYXRhLnByb3BzWzJdKTsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAnc2V0VmVsb2NpdHknOgogICAgICAgIHN0YXRlLmJvZGllc1tkYXRhLnV1aWRdLnZlbG9jaXR5LnNldChkYXRhLnByb3BzWzBdLCBkYXRhLnByb3BzWzFdLCBkYXRhLnByb3BzWzJdKTsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAnc2V0QW5ndWxhclZlbG9jaXR5JzoKICAgICAgICBzdGF0ZS5ib2RpZXNbZGF0YS51dWlkXS5hbmd1bGFyVmVsb2NpdHkuc2V0KGRhdGEucHJvcHNbMF0sIGRhdGEucHJvcHNbMV0sIGRhdGEucHJvcHNbMl0pOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlICdzZXRMaW5lYXJGYWN0b3InOgogICAgICAgIHN0YXRlLmJvZGllc1tkYXRhLnV1aWRdLmxpbmVhckZhY3Rvci5zZXQoZGF0YS5wcm9wc1swXSwgZGF0YS5wcm9wc1sxXSwgZGF0YS5wcm9wc1syXSk7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgJ3NldEFuZ3VsYXJGYWN0b3InOgogICAgICAgIHN0YXRlLmJvZGllc1tkYXRhLnV1aWRdLmFuZ3VsYXJGYWN0b3Iuc2V0KGRhdGEucHJvcHNbMF0sIGRhdGEucHJvcHNbMV0sIGRhdGEucHJvcHNbMl0pOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlICdzZXRNYXNzJzoKICAgICAgICBzdGF0ZS5ib2RpZXNbZGF0YS51dWlkXS5tYXNzID0gZGF0YS5wcm9wczsKICAgICAgICBzdGF0ZS5ib2RpZXNbZGF0YS51dWlkXS51cGRhdGVNYXNzUHJvcGVydGllcygpOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlICdzZXRNYXRlcmlhbCc6CiAgICAgICAgc3RhdGUuYm9kaWVzW2RhdGEudXVpZF0ubWF0ZXJpYWwgPSBkYXRhLnByb3BzID8gY3JlYXRlTWF0ZXJpYWwoZGF0YS5wcm9wcykgOiBudWxsOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlICdzZXRMaW5lYXJEYW1waW5nJzoKICAgICAgICBzdGF0ZS5ib2RpZXNbZGF0YS51dWlkXS5saW5lYXJEYW1waW5nID0gZGF0YS5wcm9wczsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAnc2V0QW5ndWxhckRhbXBpbmcnOgogICAgICAgIHN0YXRlLmJvZGllc1tkYXRhLnV1aWRdLmFuZ3VsYXJEYW1waW5nID0gZGF0YS5wcm9wczsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAnc2V0QWxsb3dTbGVlcCc6CiAgICAgICAgc3RhdGUuYm9kaWVzW2RhdGEudXVpZF0uYWxsb3dTbGVlcCA9IGRhdGEucHJvcHM7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgJ3NldFNsZWVwU3BlZWRMaW1pdCc6CiAgICAgICAgc3RhdGUuYm9kaWVzW2RhdGEudXVpZF0uc2xlZXBTcGVlZExpbWl0ID0gZGF0YS5wcm9wczsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAnc2V0U2xlZXBUaW1lTGltaXQnOgogICAgICAgIHN0YXRlLmJvZGllc1tkYXRhLnV1aWRdLnNsZWVwVGltZUxpbWl0ID0gZGF0YS5wcm9wczsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAnc2V0Q29sbGlzaW9uRmlsdGVyR3JvdXAnOgogICAgICAgIHN0YXRlLmJvZGllc1tkYXRhLnV1aWRdLmNvbGxpc2lvbkZpbHRlckdyb3VwID0gZGF0YS5wcm9wczsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAnc2V0Q29sbGlzaW9uRmlsdGVyTWFzayc6CiAgICAgICAgc3RhdGUuYm9kaWVzW2RhdGEudXVpZF0uY29sbGlzaW9uRmlsdGVyTWFzayA9IGRhdGEucHJvcHM7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgJ3NldENvbGxpc2lvblJlc3BvbnNlJzoKICAgICAgICBzdGF0ZS5ib2RpZXNbZGF0YS51dWlkXS5jb2xsaXNpb25SZXNwb25zZSA9IGRhdGEucHJvcHM7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgJ3NldEZpeGVkUm90YXRpb24nOgogICAgICAgIHN0YXRlLmJvZGllc1tkYXRhLnV1aWRdLmZpeGVkUm90YXRpb24gPSBkYXRhLnByb3BzOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlICdzZXRGcmljdGlvbkdyYXZpdHknOgogICAgICAgIHN0YXRlLndvcmxkLmZyaWN0aW9uR3Jhdml0eSA9IGRhdGEucHJvcHMgPyBuZXcgVmVjMyguLi5kYXRhLnByb3BzKSA6IHVuZGVmaW5lZDsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAnc2V0SXNUcmlnZ2VyJzoKICAgICAgICBzdGF0ZS5ib2RpZXNbZGF0YS51dWlkXS5pc1RyaWdnZXIgPSBkYXRhLnByb3BzOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlICdzZXRHcmF2aXR5JzoKICAgICAgICBzdGF0ZS53b3JsZC5ncmF2aXR5LnNldChkYXRhLnByb3BzWzBdLCBkYXRhLnByb3BzWzFdLCBkYXRhLnByb3BzWzJdKTsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAnc2V0VG9sZXJhbmNlJzoKICAgICAgICBpZiAoc3RhdGUud29ybGQuc29sdmVyIGluc3RhbmNlb2YgR1NTb2x2ZXIpIHsKICAgICAgICAgIHN0YXRlLndvcmxkLnNvbHZlci50b2xlcmFuY2UgPSBkYXRhLnByb3BzOwogICAgICAgIH0KICAgICAgICBicmVhazsKICAgICAgY2FzZSAnc2V0SXRlcmF0aW9ucyc6CiAgICAgICAgaWYgKHN0YXRlLndvcmxkLnNvbHZlciBpbnN0YW5jZW9mIEdTU29sdmVyKSB7CiAgICAgICAgICBzdGF0ZS53b3JsZC5zb2x2ZXIuaXRlcmF0aW9ucyA9IGRhdGEucHJvcHM7CiAgICAgICAgfQogICAgICAgIGJyZWFrOwogICAgICBjYXNlICdzZXRCcm9hZHBoYXNlJzoKICAgICAgICBzdGF0ZS53b3JsZC5icm9hZHBoYXNlID0gbmV3IChicm9hZHBoYXNlc1tgJHtkYXRhLnByb3BzfUJyb2FkcGhhc2VgXSB8fCBOYWl2ZUJyb2FkcGhhc2UpKHN0YXRlLndvcmxkKTsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAnc2V0QXhpc0luZGV4JzoKICAgICAgICBpZiAoc3RhdGUud29ybGQuYnJvYWRwaGFzZSBpbnN0YW5jZW9mIFNBUEJyb2FkcGhhc2UpIHsKICAgICAgICAgIHN0YXRlLndvcmxkLmJyb2FkcGhhc2UuYXhpc0luZGV4ID0gZGF0YS5wcm9wcyA9PT0gdW5kZWZpbmVkIHx8IGRhdGEucHJvcHMgPT09IG51bGwgPyAwIDogZGF0YS5wcm9wczsKICAgICAgICB9CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgJ2FwcGx5Rm9yY2UnOgogICAgICAgIHN0YXRlLmJvZGllc1tkYXRhLnV1aWRdLmFwcGx5Rm9yY2UobmV3IFZlYzMoLi4uZGF0YS5wcm9wc1swXSksIG5ldyBWZWMzKC4uLmRhdGEucHJvcHNbMV0pKTsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAnYXBwbHlJbXB1bHNlJzoKICAgICAgICBzdGF0ZS5ib2RpZXNbZGF0YS51dWlkXS5hcHBseUltcHVsc2UobmV3IFZlYzMoLi4uZGF0YS5wcm9wc1swXSksIG5ldyBWZWMzKC4uLmRhdGEucHJvcHNbMV0pKTsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAnYXBwbHlMb2NhbEZvcmNlJzoKICAgICAgICBzdGF0ZS5ib2RpZXNbZGF0YS51dWlkXS5hcHBseUxvY2FsRm9yY2UobmV3IFZlYzMoLi4uZGF0YS5wcm9wc1swXSksIG5ldyBWZWMzKC4uLmRhdGEucHJvcHNbMV0pKTsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAnYXBwbHlMb2NhbEltcHVsc2UnOgogICAgICAgIHN0YXRlLmJvZGllc1tkYXRhLnV1aWRdLmFwcGx5TG9jYWxJbXB1bHNlKG5ldyBWZWMzKC4uLmRhdGEucHJvcHNbMF0pLCBuZXcgVmVjMyguLi5kYXRhLnByb3BzWzFdKSk7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgJ2FwcGx5VG9ycXVlJzoKICAgICAgICBzdGF0ZS5ib2RpZXNbZGF0YS51dWlkXS5hcHBseVRvcnF1ZShuZXcgVmVjMyguLi5kYXRhLnByb3BzWzBdKSk7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgJ2FkZENvbnN0cmFpbnQnOgogICAgICAgIHsKICAgICAgICAgIGFkZENvbnN0cmFpbnQoc3RhdGUsIGRhdGEpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICBjYXNlICdyZW1vdmVDb25zdHJhaW50JzoKICAgICAgICBzdGF0ZS53b3JsZC5jb25zdHJhaW50cy5maWx0ZXIoX3JlZjIgPT4gewogICAgICAgICAgbGV0IHsKICAgICAgICAgICAgdXVpZAogICAgICAgICAgfSA9IF9yZWYyOwogICAgICAgICAgcmV0dXJuIHV1aWQgPT09IGRhdGEudXVpZDsKICAgICAgICB9KS5tYXAoYyA9PiBzdGF0ZS53b3JsZC5yZW1vdmVDb25zdHJhaW50KGMpKTsKICAgICAgICBpZiAoc3RhdGUuY29uc3RyYWludHNbZGF0YS51dWlkXSkgewogICAgICAgICAgc3RhdGUud29ybGQucmVtb3ZlRXZlbnRMaXN0ZW5lcigncG9zdFN0ZXAnLCBzdGF0ZS5jb25zdHJhaW50c1tkYXRhLnV1aWRdKTsKICAgICAgICAgIGRlbGV0ZSBzdGF0ZS5jb25zdHJhaW50c1tkYXRhLnV1aWRdOwogICAgICAgIH0KICAgICAgICBicmVhazsKICAgICAgY2FzZSAnZW5hYmxlQ29uc3RyYWludCc6CiAgICAgICAgc3RhdGUud29ybGQuY29uc3RyYWludHMuZmlsdGVyKGMgPT4gYy51dWlkID09PSBkYXRhLnV1aWQpLm1hcChjID0+IGMuZW5hYmxlKCkpOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlICdkaXNhYmxlQ29uc3RyYWludCc6CiAgICAgICAgc3RhdGUud29ybGQuY29uc3RyYWludHMuZmlsdGVyKGMgPT4gYy51dWlkID09PSBkYXRhLnV1aWQpLm1hcChjID0+IGMuZGlzYWJsZSgpKTsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAnZW5hYmxlQ29uc3RyYWludE1vdG9yJzoKICAgICAgICBzdGF0ZS53b3JsZC5jb25zdHJhaW50cy5maWx0ZXIoYyA9PiBjLnV1aWQgPT09IGRhdGEudXVpZCkuZmlsdGVyKGlzSGluZ2VDb25zdHJhaW50KS5tYXAoYyA9PiBjLmVuYWJsZU1vdG9yKCkpOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlICdkaXNhYmxlQ29uc3RyYWludE1vdG9yJzoKICAgICAgICBzdGF0ZS53b3JsZC5jb25zdHJhaW50cy5maWx0ZXIoYyA9PiBjLnV1aWQgPT09IGRhdGEudXVpZCkuZmlsdGVyKGlzSGluZ2VDb25zdHJhaW50KS5tYXAoYyA9PiBjLmRpc2FibGVNb3RvcigpKTsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAnc2V0Q29uc3RyYWludE1vdG9yU3BlZWQnOgogICAgICAgIHN0YXRlLndvcmxkLmNvbnN0cmFpbnRzLmZpbHRlcihjID0+IGMudXVpZCA9PT0gZGF0YS51dWlkKS5maWx0ZXIoaXNIaW5nZUNvbnN0cmFpbnQpLm1hcChjID0+IGMuc2V0TW90b3JTcGVlZChkYXRhLnByb3BzKSk7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgJ3NldENvbnN0cmFpbnRNb3Rvck1heEZvcmNlJzoKICAgICAgICBzdGF0ZS53b3JsZC5jb25zdHJhaW50cy5maWx0ZXIoYyA9PiBjLnV1aWQgPT09IGRhdGEudXVpZCkuZmlsdGVyKGlzSGluZ2VDb25zdHJhaW50KS5tYXAoYyA9PiBjLnNldE1vdG9yTWF4Rm9yY2UoZGF0YS5wcm9wcykpOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlICdhZGRTcHJpbmcnOgogICAgICAgIHsKICAgICAgICAgIGFkZFNwcmluZyhzdGF0ZSwgZGF0YSk7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgIGNhc2UgJ3NldFNwcmluZ1N0aWZmbmVzcyc6CiAgICAgICAgewogICAgICAgICAgc3RhdGUuc3ByaW5nSW5zdGFuY2VzW2RhdGEudXVpZF0uc3RpZmZuZXNzID0gZGF0YS5wcm9wczsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgY2FzZSAnc2V0U3ByaW5nUmVzdExlbmd0aCc6CiAgICAgICAgewogICAgICAgICAgc3RhdGUuc3ByaW5nSW5zdGFuY2VzW2RhdGEudXVpZF0ucmVzdExlbmd0aCA9IGRhdGEucHJvcHM7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgIGNhc2UgJ3NldFNwcmluZ0RhbXBpbmcnOgogICAgICAgIHsKICAgICAgICAgIHN0YXRlLnNwcmluZ0luc3RhbmNlc1tkYXRhLnV1aWRdLmRhbXBpbmcgPSBkYXRhLnByb3BzOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICBjYXNlICdyZW1vdmVTcHJpbmcnOgogICAgICAgIHsKICAgICAgICAgIHN0YXRlLndvcmxkLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ3Bvc3RTdGVwJywgc3RhdGUuc3ByaW5nc1tkYXRhLnV1aWRdKTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgY2FzZSAnYWRkUmF5JzoKICAgICAgICB7CiAgICAgICAgICBhZGRSYXkoc3RhdGUsIGRhdGEpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICBjYXNlICdyZW1vdmVSYXknOgogICAgICAgIHsKICAgICAgICAgIHN0YXRlLndvcmxkLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ3ByZVN0ZXAnLCBzdGF0ZS5yYXlzW2RhdGEudXVpZF0pOwogICAgICAgICAgZGVsZXRlIHN0YXRlLnJheXNbZGF0YS51dWlkXTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgY2FzZSAnYWRkUmF5Y2FzdFZlaGljbGUnOgogICAgICAgIHsKICAgICAgICAgIGFkZFJheWNhc3RWZWhpY2xlKHN0YXRlLCBkYXRhKTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgY2FzZSAncmVtb3ZlUmF5Y2FzdFZlaGljbGUnOgogICAgICAgIHsKICAgICAgICAgIHN0YXRlLndvcmxkLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ3ByZVN0ZXAnLCBzdGF0ZS52ZWhpY2xlc1tkYXRhLnV1aWRdLnByZVN0ZXApOwogICAgICAgICAgc3RhdGUud29ybGQucmVtb3ZlRXZlbnRMaXN0ZW5lcigncG9zdFN0ZXAnLCBzdGF0ZS52ZWhpY2xlc1tkYXRhLnV1aWRdLnBvc3RTdGVwKTsKICAgICAgICAgIHN0YXRlLnZlaGljbGVzW2RhdGEudXVpZF0udmVoaWNsZS53b3JsZCA9IG51bGw7CiAgICAgICAgICBkZWxldGUgc3RhdGUudmVoaWNsZXNbZGF0YS51dWlkXTsKICAgICAgICAgIGNvbnN0IGtleSA9IE9iamVjdC5rZXlzKHN0YXRlLnN1YnNjcmlwdGlvbnMpLmZpbmQoayA9PiBzdGF0ZS5zdWJzY3JpcHRpb25zW2tdWzBdID09PSBkYXRhLnV1aWQpOwogICAgICAgICAgaWYgKGtleSkgewogICAgICAgICAgICBkZWxldGUgc3RhdGUuc3Vic2NyaXB0aW9uc1trZXldOwogICAgICAgICAgfQogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICBjYXNlICdzZXRSYXljYXN0VmVoaWNsZVN0ZWVyaW5nVmFsdWUnOgogICAgICAgIHsKICAgICAgICAgIGNvbnN0IFt2YWx1ZSwgd2hlZWxJbmRleF0gPSBkYXRhLnByb3BzOwogICAgICAgICAgc3RhdGUudmVoaWNsZXNbZGF0YS51dWlkXS52ZWhpY2xlLnNldFN0ZWVyaW5nVmFsdWUodmFsdWUsIHdoZWVsSW5kZXgpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICBjYXNlICdhcHBseVJheWNhc3RWZWhpY2xlRW5naW5lRm9yY2UnOgogICAgICAgIHsKICAgICAgICAgIGNvbnN0IFt2YWx1ZSwgd2hlZWxJbmRleF0gPSBkYXRhLnByb3BzOwogICAgICAgICAgc3RhdGUudmVoaWNsZXNbZGF0YS51dWlkXS52ZWhpY2xlLmFwcGx5RW5naW5lRm9yY2UodmFsdWUsIHdoZWVsSW5kZXgpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICBjYXNlICdzZXRSYXljYXN0VmVoaWNsZUJyYWtlJzoKICAgICAgICB7CiAgICAgICAgICBjb25zdCBbYnJha2UsIHdoZWVsSW5kZXhdID0gZGF0YS5wcm9wczsKICAgICAgICAgIHN0YXRlLnZlaGljbGVzW2RhdGEudXVpZF0udmVoaWNsZS5zZXRCcmFrZShicmFrZSwgd2hlZWxJbmRleCk7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgIGNhc2UgJ2FkZENvbnRhY3RNYXRlcmlhbCc6CiAgICAgICAgewogICAgICAgICAgYWRkQ29udGFjdE1hdGVyaWFsKHN0YXRlLndvcmxkLCBjcmVhdGVNYXRlcmlhbCwgZGF0YS5wcm9wcywgZGF0YS51dWlkKTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgY2FzZSAncmVtb3ZlQ29udGFjdE1hdGVyaWFsJzoKICAgICAgICB7CiAgICAgICAgICByZW1vdmVDb250YWN0TWF0ZXJpYWwoc3RhdGUud29ybGQsIGRhdGEudXVpZCk7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgIGNhc2UgJ3dha2VVcCc6CiAgICAgICAgewogICAgICAgICAgc3RhdGUuYm9kaWVzW2RhdGEudXVpZF0ud2FrZVVwKCk7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgIGNhc2UgJ3NsZWVwJzoKICAgICAgICB7CiAgICAgICAgICBzdGF0ZS5ib2RpZXNbZGF0YS51dWlkXS5zbGVlcCgpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgfQogIH07Cgp9KSgpOwoK");class CannonWorkerAPI extends EventEmitter$1{constructor(_){let{allowSleep:K=!1,axisIndex:te=0,broadphase:ne="Naive",defaultContactMaterial:oe={contactEquationStiffness:1e6},frictionGravity:ie=null,gravity:se=[0,-9.81,0],iterations:ae=5,quatNormalizeFast:ge=!1,quatNormalizeSkip:ce=0,size:de=1e3,solver:pe="GS",tolerance:fe=.001}=_;super();hu(this,"messageQueue",[]);hu(this,"worker",null);this.config={allowSleep:K,axisIndex:te,broadphase:ne,defaultContactMaterial:oe,frictionGravity:ie,gravity:se,iterations:ae,quatNormalizeFast:ge,quatNormalizeSkip:ce,size:de,solver:pe,tolerance:fe},this.buffers={positions:new Float32Array(de*3),quaternions:new Float32Array(de*4)}}get axisIndex(){return this.config.axisIndex}set axisIndex(_){this.config.axisIndex=_,this.postMessage({op:"setAxisIndex",props:_})}get broadphase(){return this.config.broadphase}set broadphase(_){this.config.broadphase=_,this.postMessage({op:"setBroadphase",props:_})}get frictionGravity(){return this.config.frictionGravity}set frictionGravity(_){this.config.frictionGravity=_,this.postMessage({op:"setFrictionGravity",props:_})}get gravity(){return this.config.gravity}set gravity(_){this.config.gravity=_,this.postMessage({op:"setGravity",props:_})}get iterations(){return this.config.iterations}set iterations(_){this.config.iterations=_,this.postMessage({op:"setIterations",props:_})}get tolerance(){return this.config.tolerance}set tolerance(_){this.config.tolerance=_,this.postMessage({op:"setTolerance",props:_})}addBodies(_){let{props:K,type:te,uuid:ne}=_;this.postMessage({op:"addBodies",props:K,type:te,uuid:ne})}addConstraint(_){let{props:[K,te,ne],type:oe,uuid:ie}=_;this.postMessage({op:"addConstraint",props:[K,te,ne],type:oe,uuid:ie})}addContactMaterial(_){let{props:K,uuid:te}=_;this.postMessage({op:"addContactMaterial",props:K,uuid:te})}addRay(_){let{props:K,uuid:te}=_;this.postMessage({op:"addRay",props:K,uuid:te})}addRaycastVehicle(_){let{props:[K,te,ne,oe,ie,se],uuid:ae}=_;this.postMessage({op:"addRaycastVehicle",props:[K,te,ne,oe,ie,se],uuid:ae})}addSpring(_){let{props:[K,te,ne],uuid:oe}=_;this.postMessage({op:"addSpring",props:[K,te,ne],uuid:oe})}applyForce(_){let{props:K,uuid:te}=_;this.postMessage({op:"applyForce",props:K,uuid:te})}applyImpulse(_){let{props:K,uuid:te}=_;this.postMessage({op:"applyImpulse",props:K,uuid:te})}applyLocalForce(_){let{props:K,uuid:te}=_;this.postMessage({op:"applyLocalForce",props:K,uuid:te})}applyLocalImpulse(_){let{props:K,uuid:te}=_;this.postMessage({op:"applyLocalImpulse",props:K,uuid:te})}applyRaycastVehicleEngineForce(_){let{props:K,uuid:te}=_;this.postMessage({op:"applyRaycastVehicleEngineForce",props:K,uuid:te})}applyTorque(_){let{props:K,uuid:te}=_;this.postMessage({op:"applyTorque",props:K,uuid:te})}connect(){this.worker=new WorkerFactory,this.worker.onmessage=_=>{if(_.data.op==="frame"){this.buffers.positions=_.data.positions,this.buffers.quaternions=_.data.quaternions,this.emit(_.data.op,_.data);return}this.emit(_.data.type,_.data)};for(const _ of this.messageQueue)this.worker.postMessage(_);this.messageQueue.length=0}disableConstraint(_){let{uuid:K}=_;this.postMessage({op:"disableConstraint",uuid:K})}disableConstraintMotor(_){let{uuid:K}=_;this.postMessage({op:"disableConstraintMotor",uuid:K})}disconnect(){this.worker&&(this.worker.onmessage=null)}enableConstraint(_){let{uuid:K}=_;this.postMessage({op:"enableConstraint",uuid:K})}enableConstraintMotor(_){let{uuid:K}=_;this.postMessage({op:"enableConstraintMotor",uuid:K})}init(){const{allowSleep:_,axisIndex:K,broadphase:te,defaultContactMaterial:ne,frictionGravity:oe,gravity:ie,iterations:se,quatNormalizeFast:ae,quatNormalizeSkip:ge,solver:ce,tolerance:de}=this.config;this.postMessage({op:"init",props:{allowSleep:_,axisIndex:K,broadphase:te,defaultContactMaterial:ne,frictionGravity:oe,gravity:ie,iterations:se,quatNormalizeFast:ae,quatNormalizeSkip:ge,solver:ce,tolerance:de}})}removeBodies(_){let{uuid:K}=_;this.postMessage({op:"removeBodies",uuid:K})}removeConstraint(_){let{uuid:K}=_;this.postMessage({op:"removeConstraint",uuid:K})}removeContactMaterial(_){let{uuid:K}=_;this.postMessage({op:"removeContactMaterial",uuid:K})}removeRay(_){let{uuid:K}=_;this.postMessage({op:"removeRay",uuid:K})}removeRaycastVehicle(_){let{uuid:K}=_;this.postMessage({op:"removeRaycastVehicle",uuid:K})}removeSpring(_){let{uuid:K}=_;this.postMessage({op:"removeSpring",uuid:K})}setAllowSleep(_){let{props:K,uuid:te}=_;this.postMessage({op:"setAllowSleep",props:K,uuid:te})}setAngularDamping(_){let{props:K,uuid:te}=_;this.postMessage({op:"setAngularDamping",props:K,uuid:te})}setAngularFactor(_){let{props:K,uuid:te}=_;this.postMessage({op:"setAngularFactor",props:K,uuid:te})}setAngularVelocity(_){let{props:K,uuid:te}=_;this.postMessage({op:"setAngularVelocity",props:K,uuid:te})}setCollisionFilterGroup(_){let{props:K,uuid:te}=_;this.postMessage({op:"setCollisionFilterGroup",props:K,uuid:te})}setCollisionFilterMask(_){let{props:K,uuid:te}=_;this.postMessage({op:"setCollisionFilterMask",props:K,uuid:te})}setCollisionResponse(_){let{props:K,uuid:te}=_;this.postMessage({op:"setCollisionResponse",props:K,uuid:te})}setConstraintMotorMaxForce(_){let{props:K,uuid:te}=_;this.postMessage({op:"setConstraintMotorMaxForce",props:K,uuid:te})}setConstraintMotorSpeed(_){let{props:K,uuid:te}=_;this.postMessage({op:"setConstraintMotorSpeed",props:K,uuid:te})}setFixedRotation(_){let{props:K,uuid:te}=_;this.postMessage({op:"setFixedRotation",props:K,uuid:te})}setIsTrigger(_){let{props:K,uuid:te}=_;this.postMessage({op:"setIsTrigger",props:K,uuid:te})}setLinearDamping(_){let{props:K,uuid:te}=_;this.postMessage({op:"setLinearDamping",props:K,uuid:te})}setLinearFactor(_){let{props:K,uuid:te}=_;this.postMessage({op:"setLinearFactor",props:K,uuid:te})}setMass(_){let{props:K,uuid:te}=_;this.postMessage({op:"setMass",props:K,uuid:te})}setMaterial(_){let{props:K,uuid:te}=_;this.postMessage({op:"setMaterial",props:K,uuid:te})}setPosition(_){let{props:K,uuid:te}=_;this.postMessage({op:"setPosition",props:K,uuid:te})}setQuaternion(_){let{props:[K,te,ne,oe],uuid:ie}=_;this.postMessage({op:"setQuaternion",props:[K,te,ne,oe],uuid:ie})}setRaycastVehicleBrake(_){let{props:K,uuid:te}=_;this.postMessage({op:"setRaycastVehicleBrake",props:K,uuid:te})}setRaycastVehicleSteeringValue(_){let{props:K,uuid:te}=_;this.postMessage({op:"setRaycastVehicleSteeringValue",props:K,uuid:te})}setRotation(_){let{props:K,uuid:te}=_;this.postMessage({op:"setRotation",props:K,uuid:te})}setSleepSpeedLimit(_){let{props:K,uuid:te}=_;this.postMessage({op:"setSleepSpeedLimit",props:K,uuid:te})}setSleepTimeLimit(_){let{props:K,uuid:te}=_;this.postMessage({op:"setSleepTimeLimit",props:K,uuid:te})}setSpringDamping(_){let{props:K,uuid:te}=_;this.postMessage({op:"setSpringDamping",props:K,uuid:te})}setSpringRestLength(_){let{props:K,uuid:te}=_;this.postMessage({op:"setSpringRestLength",props:K,uuid:te})}setSpringStiffness(_){let{props:K,uuid:te}=_;this.postMessage({op:"setSpringStiffness",props:K,uuid:te})}setUserData(_){let{props:K,uuid:te}=_;this.postMessage({op:"setUserData",props:K,uuid:te})}setVelocity(_){let{props:K,uuid:te}=_;this.postMessage({op:"setVelocity",props:K,uuid:te})}sleep(_){let{uuid:K}=_;this.postMessage({op:"sleep",uuid:K})}step(_){var K;const{buffers:{positions:te,quaternions:ne}}=this;!te.byteLength&&!ne.byteLength||(K=this.worker)==null||K.postMessage({op:"step",positions:te,props:_,quaternions:ne},[te.buffer,ne.buffer])}subscribe(_){let{props:{id:K,target:te,type:ne},uuid:oe}=_;this.postMessage({op:"subscribe",props:{id:K,target:te,type:ne},uuid:oe})}terminate(){var _;(_=this.worker)==null||_.terminate(),this.worker=null}unsubscribe(_){let{props:K}=_;this.postMessage({op:"unsubscribe",props:K})}wakeUp(_){let{uuid:K}=_;this.postMessage({op:"wakeUp",uuid:K})}postMessage(_){if(this.worker)return this.worker.postMessage(_);this.messageQueue.push(_)}}class Mat3$1{constructor(Z){Z===void 0&&(Z=[0,0,0,0,0,0,0,0,0]),this.elements=Z}identity(){const Z=this.elements;Z[0]=1,Z[1]=0,Z[2]=0,Z[3]=0,Z[4]=1,Z[5]=0,Z[6]=0,Z[7]=0,Z[8]=1}setZero(){const Z=this.elements;Z[0]=0,Z[1]=0,Z[2]=0,Z[3]=0,Z[4]=0,Z[5]=0,Z[6]=0,Z[7]=0,Z[8]=0}setTrace(Z){const _=this.elements;_[0]=Z.x,_[4]=Z.y,_[8]=Z.z}getTrace(Z){Z===void 0&&(Z=new Vec3$1);const _=this.elements;return Z.x=_[0],Z.y=_[4],Z.z=_[8],Z}vmult(Z,_){_===void 0&&(_=new Vec3$1);const K=this.elements,te=Z.x,ne=Z.y,oe=Z.z;return _.x=K[0]*te+K[1]*ne+K[2]*oe,_.y=K[3]*te+K[4]*ne+K[5]*oe,_.z=K[6]*te+K[7]*ne+K[8]*oe,_}smult(Z){for(let _=0;_<this.elements.length;_++)this.elements[_]*=Z}mmult(Z,_){_===void 0&&(_=new Mat3$1);const K=this.elements,te=Z.elements,ne=_.elements,oe=K[0],ie=K[1],se=K[2],ae=K[3],ge=K[4],ce=K[5],de=K[6],pe=K[7],fe=K[8],be=te[0],me=te[1],ye=te[2],ve=te[3],Be=te[4],Re=te[5],Ee=te[6],We=te[7],Ze=te[8];return ne[0]=oe*be+ie*ve+se*Ee,ne[1]=oe*me+ie*Be+se*We,ne[2]=oe*ye+ie*Re+se*Ze,ne[3]=ae*be+ge*ve+ce*Ee,ne[4]=ae*me+ge*Be+ce*We,ne[5]=ae*ye+ge*Re+ce*Ze,ne[6]=de*be+pe*ve+fe*Ee,ne[7]=de*me+pe*Be+fe*We,ne[8]=de*ye+pe*Re+fe*Ze,_}scale(Z,_){_===void 0&&(_=new Mat3$1);const K=this.elements,te=_.elements;for(let ne=0;ne!==3;ne++)te[3*ne+0]=Z.x*K[3*ne+0],te[3*ne+1]=Z.y*K[3*ne+1],te[3*ne+2]=Z.z*K[3*ne+2];return _}solve(Z,_){_===void 0&&(_=new Vec3$1);const K=3,te=4,ne=[];let oe,ie;for(oe=0;oe<K*te;oe++)ne.push(0);for(oe=0;oe<3;oe++)for(ie=0;ie<3;ie++)ne[oe+te*ie]=this.elements[oe+3*ie];ne[3+4*0]=Z.x,ne[3+4*1]=Z.y,ne[3+4*2]=Z.z;let se=3;const ae=se;let ge;const ce=4;let de;do{if(oe=ae-se,ne[oe+te*oe]===0){for(ie=oe+1;ie<ae;ie++)if(ne[oe+te*ie]!==0){ge=ce;do de=ce-ge,ne[de+te*oe]+=ne[de+te*ie];while(--ge);break}}if(ne[oe+te*oe]!==0)for(ie=oe+1;ie<ae;ie++){const pe=ne[oe+te*ie]/ne[oe+te*oe];ge=ce;do de=ce-ge,ne[de+te*ie]=de<=oe?0:ne[de+te*ie]-ne[de+te*oe]*pe;while(--ge)}}while(--se);if(_.z=ne[2*te+3]/ne[2*te+2],_.y=(ne[1*te+3]-ne[1*te+2]*_.z)/ne[1*te+1],_.x=(ne[0*te+3]-ne[0*te+2]*_.z-ne[0*te+1]*_.y)/ne[0*te+0],isNaN(_.x)||isNaN(_.y)||isNaN(_.z)||_.x===1/0||_.y===1/0||_.z===1/0)throw`Could not solve equation! Got x=[${_.toString()}], b=[${Z.toString()}], A=[${this.toString()}]`;return _}e(Z,_,K){if(K===void 0)return this.elements[_+3*Z];this.elements[_+3*Z]=K}copy(Z){for(let _=0;_<Z.elements.length;_++)this.elements[_]=Z.elements[_];return this}toString(){let Z="";const _=",";for(let K=0;K<9;K++)Z+=this.elements[K]+_;return Z}reverse(Z){Z===void 0&&(Z=new Mat3$1);const _=3,K=6,te=reverse_eqns$1;let ne,oe;for(ne=0;ne<3;ne++)for(oe=0;oe<3;oe++)te[ne+K*oe]=this.elements[ne+3*oe];te[3+6*0]=1,te[3+6*1]=0,te[3+6*2]=0,te[4+6*0]=0,te[4+6*1]=1,te[4+6*2]=0,te[5+6*0]=0,te[5+6*1]=0,te[5+6*2]=1;let ie=3;const se=ie;let ae;const ge=K;let ce;do{if(ne=se-ie,te[ne+K*ne]===0){for(oe=ne+1;oe<se;oe++)if(te[ne+K*oe]!==0){ae=ge;do ce=ge-ae,te[ce+K*ne]+=te[ce+K*oe];while(--ae);break}}if(te[ne+K*ne]!==0)for(oe=ne+1;oe<se;oe++){const de=te[ne+K*oe]/te[ne+K*ne];ae=ge;do ce=ge-ae,te[ce+K*oe]=ce<=ne?0:te[ce+K*oe]-te[ce+K*ne]*de;while(--ae)}}while(--ie);ne=2;do{oe=ne-1;do{const de=te[ne+K*oe]/te[ne+K*ne];ae=K;do ce=K-ae,te[ce+K*oe]=te[ce+K*oe]-te[ce+K*ne]*de;while(--ae)}while(oe--)}while(--ne);ne=2;do{const de=1/te[ne+K*ne];ae=K;do ce=K-ae,te[ce+K*ne]=te[ce+K*ne]*de;while(--ae)}while(ne--);ne=2;do{oe=2;do{if(ce=te[_+oe+K*ne],isNaN(ce)||ce===1/0)throw`Could not reverse! A=[${this.toString()}]`;Z.e(ne,oe,ce)}while(oe--)}while(ne--);return Z}setRotationFromQuaternion(Z){const _=Z.x,K=Z.y,te=Z.z,ne=Z.w,oe=_+_,ie=K+K,se=te+te,ae=_*oe,ge=_*ie,ce=_*se,de=K*ie,pe=K*se,fe=te*se,be=ne*oe,me=ne*ie,ye=ne*se,ve=this.elements;return ve[3*0+0]=1-(de+fe),ve[3*0+1]=ge-ye,ve[3*0+2]=ce+me,ve[3*1+0]=ge+ye,ve[3*1+1]=1-(ae+fe),ve[3*1+2]=pe-be,ve[3*2+0]=ce-me,ve[3*2+1]=pe+be,ve[3*2+2]=1-(ae+de),this}transpose(Z){Z===void 0&&(Z=new Mat3$1);const _=this.elements,K=Z.elements;let te;return K[0]=_[0],K[4]=_[4],K[8]=_[8],te=_[1],K[1]=_[3],K[3]=te,te=_[2],K[2]=_[6],K[6]=te,te=_[5],K[5]=_[7],K[7]=te,Z}}const reverse_eqns$1=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];class Vec3$1{constructor(Z,_,K){Z===void 0&&(Z=0),_===void 0&&(_=0),K===void 0&&(K=0),this.x=Z,this.y=_,this.z=K}cross(Z,_){_===void 0&&(_=new Vec3$1);const K=Z.x,te=Z.y,ne=Z.z,oe=this.x,ie=this.y,se=this.z;return _.x=ie*ne-se*te,_.y=se*K-oe*ne,_.z=oe*te-ie*K,_}set(Z,_,K){return this.x=Z,this.y=_,this.z=K,this}setZero(){this.x=this.y=this.z=0}vadd(Z,_){if(_)_.x=Z.x+this.x,_.y=Z.y+this.y,_.z=Z.z+this.z;else return new Vec3$1(this.x+Z.x,this.y+Z.y,this.z+Z.z)}vsub(Z,_){if(_)_.x=this.x-Z.x,_.y=this.y-Z.y,_.z=this.z-Z.z;else return new Vec3$1(this.x-Z.x,this.y-Z.y,this.z-Z.z)}crossmat(){return new Mat3$1([0,-this.z,this.y,this.z,0,-this.x,-this.y,this.x,0])}normalize(){const Z=this.x,_=this.y,K=this.z,te=Math.sqrt(Z*Z+_*_+K*K);if(te>0){const ne=1/te;this.x*=ne,this.y*=ne,this.z*=ne}else this.x=0,this.y=0,this.z=0;return te}unit(Z){Z===void 0&&(Z=new Vec3$1);const _=this.x,K=this.y,te=this.z;let ne=Math.sqrt(_*_+K*K+te*te);return ne>0?(ne=1/ne,Z.x=_*ne,Z.y=K*ne,Z.z=te*ne):(Z.x=1,Z.y=0,Z.z=0),Z}length(){const Z=this.x,_=this.y,K=this.z;return Math.sqrt(Z*Z+_*_+K*K)}lengthSquared(){return this.dot(this)}distanceTo(Z){const _=this.x,K=this.y,te=this.z,ne=Z.x,oe=Z.y,ie=Z.z;return Math.sqrt((ne-_)*(ne-_)+(oe-K)*(oe-K)+(ie-te)*(ie-te))}distanceSquared(Z){const _=this.x,K=this.y,te=this.z,ne=Z.x,oe=Z.y,ie=Z.z;return(ne-_)*(ne-_)+(oe-K)*(oe-K)+(ie-te)*(ie-te)}scale(Z,_){_===void 0&&(_=new Vec3$1);const K=this.x,te=this.y,ne=this.z;return _.x=Z*K,_.y=Z*te,_.z=Z*ne,_}vmul(Z,_){return _===void 0&&(_=new Vec3$1),_.x=Z.x*this.x,_.y=Z.y*this.y,_.z=Z.z*this.z,_}addScaledVector(Z,_,K){return K===void 0&&(K=new Vec3$1),K.x=this.x+Z*_.x,K.y=this.y+Z*_.y,K.z=this.z+Z*_.z,K}dot(Z){return this.x*Z.x+this.y*Z.y+this.z*Z.z}isZero(){return this.x===0&&this.y===0&&this.z===0}negate(Z){return Z===void 0&&(Z=new Vec3$1),Z.x=-this.x,Z.y=-this.y,Z.z=-this.z,Z}tangents(Z,_){const K=this.length();if(K>0){const te=Vec3_tangents_n$1,ne=1/K;te.set(this.x*ne,this.y*ne,this.z*ne);const oe=Vec3_tangents_randVec$1;Math.abs(te.x)<.9?(oe.set(1,0,0),te.cross(oe,Z)):(oe.set(0,1,0),te.cross(oe,Z)),te.cross(Z,_)}else Z.set(1,0,0),_.set(0,1,0)}toString(){return`${this.x},${this.y},${this.z}`}toArray(){return[this.x,this.y,this.z]}copy(Z){return this.x=Z.x,this.y=Z.y,this.z=Z.z,this}lerp(Z,_,K){const te=this.x,ne=this.y,oe=this.z;K.x=te+(Z.x-te)*_,K.y=ne+(Z.y-ne)*_,K.z=oe+(Z.z-oe)*_}almostEquals(Z,_){return _===void 0&&(_=1e-6),!(Math.abs(this.x-Z.x)>_||Math.abs(this.y-Z.y)>_||Math.abs(this.z-Z.z)>_)}almostZero(Z){return Z===void 0&&(Z=1e-6),!(Math.abs(this.x)>Z||Math.abs(this.y)>Z||Math.abs(this.z)>Z)}isAntiparallelTo(Z,_){return this.negate(antip_neg$1),antip_neg$1.almostEquals(Z,_)}clone(){return new Vec3$1(this.x,this.y,this.z)}}Vec3$1.ZERO=new Vec3$1(0,0,0);Vec3$1.UNIT_X=new Vec3$1(1,0,0);Vec3$1.UNIT_Y=new Vec3$1(0,1,0);Vec3$1.UNIT_Z=new Vec3$1(0,0,1);const Vec3_tangents_n$1=new Vec3$1,Vec3_tangents_randVec$1=new Vec3$1,antip_neg$1=new Vec3$1;class AABB$1{constructor(Z){Z===void 0&&(Z={}),this.lowerBound=new Vec3$1,this.upperBound=new Vec3$1,Z.lowerBound&&this.lowerBound.copy(Z.lowerBound),Z.upperBound&&this.upperBound.copy(Z.upperBound)}setFromPoints(Z,_,K,te){const ne=this.lowerBound,oe=this.upperBound,ie=K;ne.copy(Z[0]),ie&&ie.vmult(ne,ne),oe.copy(ne);for(let se=1;se<Z.length;se++){let ae=Z[se];ie&&(ie.vmult(ae,tmp$1$1),ae=tmp$1$1),ae.x>oe.x&&(oe.x=ae.x),ae.x<ne.x&&(ne.x=ae.x),ae.y>oe.y&&(oe.y=ae.y),ae.y<ne.y&&(ne.y=ae.y),ae.z>oe.z&&(oe.z=ae.z),ae.z<ne.z&&(ne.z=ae.z)}return _&&(_.vadd(ne,ne),_.vadd(oe,oe)),te&&(ne.x-=te,ne.y-=te,ne.z-=te,oe.x+=te,oe.y+=te,oe.z+=te),this}copy(Z){return this.lowerBound.copy(Z.lowerBound),this.upperBound.copy(Z.upperBound),this}clone(){return new AABB$1().copy(this)}extend(Z){this.lowerBound.x=Math.min(this.lowerBound.x,Z.lowerBound.x),this.upperBound.x=Math.max(this.upperBound.x,Z.upperBound.x),this.lowerBound.y=Math.min(this.lowerBound.y,Z.lowerBound.y),this.upperBound.y=Math.max(this.upperBound.y,Z.upperBound.y),this.lowerBound.z=Math.min(this.lowerBound.z,Z.lowerBound.z),this.upperBound.z=Math.max(this.upperBound.z,Z.upperBound.z)}overlaps(Z){const _=this.lowerBound,K=this.upperBound,te=Z.lowerBound,ne=Z.upperBound,oe=te.x<=K.x&&K.x<=ne.x||_.x<=ne.x&&ne.x<=K.x,ie=te.y<=K.y&&K.y<=ne.y||_.y<=ne.y&&ne.y<=K.y,se=te.z<=K.z&&K.z<=ne.z||_.z<=ne.z&&ne.z<=K.z;return oe&&ie&&se}volume(){const Z=this.lowerBound,_=this.upperBound;return(_.x-Z.x)*(_.y-Z.y)*(_.z-Z.z)}contains(Z){const _=this.lowerBound,K=this.upperBound,te=Z.lowerBound,ne=Z.upperBound;return _.x<=te.x&&K.x>=ne.x&&_.y<=te.y&&K.y>=ne.y&&_.z<=te.z&&K.z>=ne.z}getCorners(Z,_,K,te,ne,oe,ie,se){const ae=this.lowerBound,ge=this.upperBound;Z.copy(ae),_.set(ge.x,ae.y,ae.z),K.set(ge.x,ge.y,ae.z),te.set(ae.x,ge.y,ge.z),ne.set(ge.x,ae.y,ge.z),oe.set(ae.x,ge.y,ae.z),ie.set(ae.x,ae.y,ge.z),se.copy(ge)}toLocalFrame(Z,_){const K=transformIntoFrame_corners$1,te=K[0],ne=K[1],oe=K[2],ie=K[3],se=K[4],ae=K[5],ge=K[6],ce=K[7];this.getCorners(te,ne,oe,ie,se,ae,ge,ce);for(let de=0;de!==8;de++){const pe=K[de];Z.pointToLocal(pe,pe)}return _.setFromPoints(K)}toWorldFrame(Z,_){const K=transformIntoFrame_corners$1,te=K[0],ne=K[1],oe=K[2],ie=K[3],se=K[4],ae=K[5],ge=K[6],ce=K[7];this.getCorners(te,ne,oe,ie,se,ae,ge,ce);for(let de=0;de!==8;de++){const pe=K[de];Z.pointToWorld(pe,pe)}return _.setFromPoints(K)}overlapsRay(Z){const{direction:_,from:K}=Z,te=1/_.x,ne=1/_.y,oe=1/_.z,ie=(this.lowerBound.x-K.x)*te,se=(this.upperBound.x-K.x)*te,ae=(this.lowerBound.y-K.y)*ne,ge=(this.upperBound.y-K.y)*ne,ce=(this.lowerBound.z-K.z)*oe,de=(this.upperBound.z-K.z)*oe,pe=Math.max(Math.max(Math.min(ie,se),Math.min(ae,ge)),Math.min(ce,de)),fe=Math.min(Math.min(Math.max(ie,se),Math.max(ae,ge)),Math.max(ce,de));return!(fe<0||pe>fe)}}const tmp$1$1=new Vec3$1,transformIntoFrame_corners$1=[new Vec3$1,new Vec3$1,new Vec3$1,new Vec3$1,new Vec3$1,new Vec3$1,new Vec3$1,new Vec3$1];class Quaternion$1{constructor(Z,_,K,te){Z===void 0&&(Z=0),_===void 0&&(_=0),K===void 0&&(K=0),te===void 0&&(te=1),this.x=Z,this.y=_,this.z=K,this.w=te}set(Z,_,K,te){return this.x=Z,this.y=_,this.z=K,this.w=te,this}toString(){return`${this.x},${this.y},${this.z},${this.w}`}toArray(){return[this.x,this.y,this.z,this.w]}setFromAxisAngle(Z,_){const K=Math.sin(_*.5);return this.x=Z.x*K,this.y=Z.y*K,this.z=Z.z*K,this.w=Math.cos(_*.5),this}toAxisAngle(Z){Z===void 0&&(Z=new Vec3$1),this.normalize();const _=2*Math.acos(this.w),K=Math.sqrt(1-this.w*this.w);return K<.001?(Z.x=this.x,Z.y=this.y,Z.z=this.z):(Z.x=this.x/K,Z.y=this.y/K,Z.z=this.z/K),[Z,_]}setFromVectors(Z,_){if(Z.isAntiparallelTo(_)){const K=sfv_t1$1,te=sfv_t2$1;Z.tangents(K,te),this.setFromAxisAngle(K,Math.PI)}else{const K=Z.cross(_);this.x=K.x,this.y=K.y,this.z=K.z,this.w=Math.sqrt(Z.length()**2*_.length()**2)+Z.dot(_),this.normalize()}return this}mult(Z,_){_===void 0&&(_=new Quaternion$1);const K=this.x,te=this.y,ne=this.z,oe=this.w,ie=Z.x,se=Z.y,ae=Z.z,ge=Z.w;return _.x=K*ge+oe*ie+te*ae-ne*se,_.y=te*ge+oe*se+ne*ie-K*ae,_.z=ne*ge+oe*ae+K*se-te*ie,_.w=oe*ge-K*ie-te*se-ne*ae,_}inverse(Z){Z===void 0&&(Z=new Quaternion$1);const _=this.x,K=this.y,te=this.z,ne=this.w;this.conjugate(Z);const oe=1/(_*_+K*K+te*te+ne*ne);return Z.x*=oe,Z.y*=oe,Z.z*=oe,Z.w*=oe,Z}conjugate(Z){return Z===void 0&&(Z=new Quaternion$1),Z.x=-this.x,Z.y=-this.y,Z.z=-this.z,Z.w=this.w,Z}normalize(){let Z=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);return Z===0?(this.x=0,this.y=0,this.z=0,this.w=0):(Z=1/Z,this.x*=Z,this.y*=Z,this.z*=Z,this.w*=Z),this}normalizeFast(){const Z=(3-(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w))/2;return Z===0?(this.x=0,this.y=0,this.z=0,this.w=0):(this.x*=Z,this.y*=Z,this.z*=Z,this.w*=Z),this}vmult(Z,_){_===void 0&&(_=new Vec3$1);const K=Z.x,te=Z.y,ne=Z.z,oe=this.x,ie=this.y,se=this.z,ae=this.w,ge=ae*K+ie*ne-se*te,ce=ae*te+se*K-oe*ne,de=ae*ne+oe*te-ie*K,pe=-oe*K-ie*te-se*ne;return _.x=ge*ae+pe*-oe+ce*-se-de*-ie,_.y=ce*ae+pe*-ie+de*-oe-ge*-se,_.z=de*ae+pe*-se+ge*-ie-ce*-oe,_}copy(Z){return this.x=Z.x,this.y=Z.y,this.z=Z.z,this.w=Z.w,this}toEuler(Z,_){_===void 0&&(_="YZX");let K,te,ne;const oe=this.x,ie=this.y,se=this.z,ae=this.w;switch(_){case"YZX":const ge=oe*ie+se*ae;if(ge>.499&&(K=2*Math.atan2(oe,ae),te=Math.PI/2,ne=0),ge<-.499&&(K=-2*Math.atan2(oe,ae),te=-Math.PI/2,ne=0),K===void 0){const ce=oe*oe,de=ie*ie,pe=se*se;K=Math.atan2(2*ie*ae-2*oe*se,1-2*de-2*pe),te=Math.asin(2*ge),ne=Math.atan2(2*oe*ae-2*ie*se,1-2*ce-2*pe)}break;default:throw new Error(`Euler order ${_} not supported yet.`)}Z.y=K,Z.z=te,Z.x=ne}setFromEuler(Z,_,K,te){te===void 0&&(te="XYZ");const ne=Math.cos(Z/2),oe=Math.cos(_/2),ie=Math.cos(K/2),se=Math.sin(Z/2),ae=Math.sin(_/2),ge=Math.sin(K/2);return te==="XYZ"?(this.x=se*oe*ie+ne*ae*ge,this.y=ne*ae*ie-se*oe*ge,this.z=ne*oe*ge+se*ae*ie,this.w=ne*oe*ie-se*ae*ge):te==="YXZ"?(this.x=se*oe*ie+ne*ae*ge,this.y=ne*ae*ie-se*oe*ge,this.z=ne*oe*ge-se*ae*ie,this.w=ne*oe*ie+se*ae*ge):te==="ZXY"?(this.x=se*oe*ie-ne*ae*ge,this.y=ne*ae*ie+se*oe*ge,this.z=ne*oe*ge+se*ae*ie,this.w=ne*oe*ie-se*ae*ge):te==="ZYX"?(this.x=se*oe*ie-ne*ae*ge,this.y=ne*ae*ie+se*oe*ge,this.z=ne*oe*ge-se*ae*ie,this.w=ne*oe*ie+se*ae*ge):te==="YZX"?(this.x=se*oe*ie+ne*ae*ge,this.y=ne*ae*ie+se*oe*ge,this.z=ne*oe*ge-se*ae*ie,this.w=ne*oe*ie-se*ae*ge):te==="XZY"&&(this.x=se*oe*ie-ne*ae*ge,this.y=ne*ae*ie-se*oe*ge,this.z=ne*oe*ge+se*ae*ie,this.w=ne*oe*ie+se*ae*ge),this}clone(){return new Quaternion$1(this.x,this.y,this.z,this.w)}slerp(Z,_,K){K===void 0&&(K=new Quaternion$1);const te=this.x,ne=this.y,oe=this.z,ie=this.w;let se=Z.x,ae=Z.y,ge=Z.z,ce=Z.w,de,pe,fe,be,me;return pe=te*se+ne*ae+oe*ge+ie*ce,pe<0&&(pe=-pe,se=-se,ae=-ae,ge=-ge,ce=-ce),1-pe>1e-6?(de=Math.acos(pe),fe=Math.sin(de),be=Math.sin((1-_)*de)/fe,me=Math.sin(_*de)/fe):(be=1-_,me=_),K.x=be*te+me*se,K.y=be*ne+me*ae,K.z=be*oe+me*ge,K.w=be*ie+me*ce,K}integrate(Z,_,K,te){te===void 0&&(te=new Quaternion$1);const ne=Z.x*K.x,oe=Z.y*K.y,ie=Z.z*K.z,se=this.x,ae=this.y,ge=this.z,ce=this.w,de=_*.5;return te.x+=de*(ne*ce+oe*ge-ie*ae),te.y+=de*(oe*ce+ie*se-ne*ge),te.z+=de*(ie*ce+ne*ae-oe*se),te.w+=de*(-ne*se-oe*ae-ie*ge),te}}const sfv_t1$1=new Vec3$1,sfv_t2$1=new Vec3$1,SHAPE_TYPES$1={SPHERE:1,PLANE:2,BOX:4,COMPOUND:8,CONVEXPOLYHEDRON:16,HEIGHTFIELD:32,PARTICLE:64,CYLINDER:128,TRIMESH:256};class Shape$1{constructor(Z){Z===void 0&&(Z={}),this.id=Shape$1.idCounter++,this.type=Z.type||0,this.boundingSphereRadius=0,this.collisionResponse=Z.collisionResponse?Z.collisionResponse:!0,this.collisionFilterGroup=Z.collisionFilterGroup!==void 0?Z.collisionFilterGroup:1,this.collisionFilterMask=Z.collisionFilterMask!==void 0?Z.collisionFilterMask:-1,this.material=Z.material?Z.material:null,this.body=null}updateBoundingSphereRadius(){throw`computeBoundingSphereRadius() not implemented for shape type ${this.type}`}volume(){throw`volume() not implemented for shape type ${this.type}`}calculateLocalInertia(Z,_){throw`calculateLocalInertia() not implemented for shape type ${this.type}`}calculateWorldAABB(Z,_,K,te){throw`calculateWorldAABB() not implemented for shape type ${this.type}`}}Shape$1.idCounter=0;Shape$1.types=SHAPE_TYPES$1;class Transform$1{constructor(Z){Z===void 0&&(Z={}),this.position=new Vec3$1,this.quaternion=new Quaternion$1,Z.position&&this.position.copy(Z.position),Z.quaternion&&this.quaternion.copy(Z.quaternion)}pointToLocal(Z,_){return Transform$1.pointToLocalFrame(this.position,this.quaternion,Z,_)}pointToWorld(Z,_){return Transform$1.pointToWorldFrame(this.position,this.quaternion,Z,_)}vectorToWorldFrame(Z,_){return _===void 0&&(_=new Vec3$1),this.quaternion.vmult(Z,_),_}static pointToLocalFrame(Z,_,K,te){return te===void 0&&(te=new Vec3$1),K.vsub(Z,te),_.conjugate(tmpQuat$1$1),tmpQuat$1$1.vmult(te,te),te}static pointToWorldFrame(Z,_,K,te){return te===void 0&&(te=new Vec3$1),_.vmult(K,te),te.vadd(Z,te),te}static vectorToWorldFrame(Z,_,K){return K===void 0&&(K=new Vec3$1),Z.vmult(_,K),K}static vectorToLocalFrame(Z,_,K,te){return te===void 0&&(te=new Vec3$1),_.w*=-1,_.vmult(K,te),_.w*=-1,te}}const tmpQuat$1$1=new Quaternion$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1,new Vec3$1,new Vec3$1,new Vec3$1,new Vec3$1,new Vec3$1,new Vec3$1,new Vec3$1;new Vec3$1;new Quaternion$1;new AABB$1;new Mat3$1;new Mat3$1;new Mat3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Quaternion$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;class RaycastResult$1{constructor(){this.rayFromWorld=new Vec3$1,this.rayToWorld=new Vec3$1,this.hitNormalWorld=new Vec3$1,this.hitPointWorld=new Vec3$1,this.hasHit=!1,this.shape=null,this.body=null,this.hitFaceIndex=-1,this.distance=-1,this.shouldStop=!1}reset(){this.rayFromWorld.setZero(),this.rayToWorld.setZero(),this.hitNormalWorld.setZero(),this.hitPointWorld.setZero(),this.hasHit=!1,this.shape=null,this.body=null,this.hitFaceIndex=-1,this.distance=-1,this.shouldStop=!1}abort(){this.shouldStop=!0}set(Z,_,K,te,ne,oe,ie){this.rayFromWorld.copy(Z),this.rayToWorld.copy(_),this.hitNormalWorld.copy(K),this.hitPointWorld.copy(te),this.shape=ne,this.body=oe,this.distance=ie}}let _Shape$types$SPHERE$1,_Shape$types$PLANE$1,_Shape$types$BOX$1,_Shape$types$CYLINDER$1,_Shape$types$CONVEXPO$1,_Shape$types$HEIGHTFI$1,_Shape$types$TRIMESH$1;const RAY_MODES$1={CLOSEST:1,ANY:2,ALL:4};_Shape$types$SPHERE$1=Shape$1.types.SPHERE;_Shape$types$PLANE$1=Shape$1.types.PLANE;_Shape$types$BOX$1=Shape$1.types.BOX;_Shape$types$CYLINDER$1=Shape$1.types.CYLINDER;_Shape$types$CONVEXPO$1=Shape$1.types.CONVEXPOLYHEDRON;_Shape$types$HEIGHTFI$1=Shape$1.types.HEIGHTFIELD;_Shape$types$TRIMESH$1=Shape$1.types.TRIMESH;class Ray$1{get[_Shape$types$SPHERE$1](){return this._intersectSphere}get[_Shape$types$PLANE$1](){return this._intersectPlane}get[_Shape$types$BOX$1](){return this._intersectBox}get[_Shape$types$CYLINDER$1](){return this._intersectConvex}get[_Shape$types$CONVEXPO$1](){return this._intersectConvex}get[_Shape$types$HEIGHTFI$1](){return this._intersectHeightfield}get[_Shape$types$TRIMESH$1](){return this._intersectTrimesh}constructor(Z,_){Z===void 0&&(Z=new Vec3$1),_===void 0&&(_=new Vec3$1),this.from=Z.clone(),this.to=_.clone(),this.direction=new Vec3$1,this.precision=1e-4,this.checkCollisionResponse=!0,this.skipBackfaces=!1,this.collisionFilterMask=-1,this.collisionFilterGroup=-1,this.mode=Ray$1.ANY,this.result=new RaycastResult$1,this.hasHit=!1,this.callback=K=>{}}intersectWorld(Z,_){return this.mode=_.mode||Ray$1.ANY,this.result=_.result||new RaycastResult$1,this.skipBackfaces=!!_.skipBackfaces,this.collisionFilterMask=typeof _.collisionFilterMask<"u"?_.collisionFilterMask:-1,this.collisionFilterGroup=typeof _.collisionFilterGroup<"u"?_.collisionFilterGroup:-1,this.checkCollisionResponse=typeof _.checkCollisionResponse<"u"?_.checkCollisionResponse:!0,_.from&&this.from.copy(_.from),_.to&&this.to.copy(_.to),this.callback=_.callback||(()=>{}),this.hasHit=!1,this.result.reset(),this.updateDirection(),this.getAABB(tmpAABB$1$1),tmpArray$1.length=0,Z.broadphase.aabbQuery(Z,tmpAABB$1$1,tmpArray$1),this.intersectBodies(tmpArray$1),this.hasHit}intersectBody(Z,_){_&&(this.result=_,this.updateDirection());const K=this.checkCollisionResponse;if(K&&!Z.collisionResponse||(this.collisionFilterGroup&Z.collisionFilterMask)===0||(Z.collisionFilterGroup&this.collisionFilterMask)===0)return;const te=intersectBody_xi$1,ne=intersectBody_qi$1;for(let oe=0,ie=Z.shapes.length;oe<ie;oe++){const se=Z.shapes[oe];if(!(K&&!se.collisionResponse)&&(Z.quaternion.mult(Z.shapeOrientations[oe],ne),Z.quaternion.vmult(Z.shapeOffsets[oe],te),te.vadd(Z.position,te),this.intersectShape(se,ne,te,Z),this.result.shouldStop))break}}intersectBodies(Z,_){_&&(this.result=_,this.updateDirection());for(let K=0,te=Z.length;!this.result.shouldStop&&K<te;K++)this.intersectBody(Z[K])}updateDirection(){this.to.vsub(this.from,this.direction),this.direction.normalize()}intersectShape(Z,_,K,te){const ne=this.from;if(distanceFromIntersection$1(ne,this.direction,K)>Z.boundingSphereRadius)return;const ie=this[Z.type];ie&&ie.call(this,Z,_,K,te,Z)}_intersectBox(Z,_,K,te,ne){return this._intersectConvex(Z.convexPolyhedronRepresentation,_,K,te,ne)}_intersectPlane(Z,_,K,te,ne){const oe=this.from,ie=this.to,se=this.direction,ae=new Vec3$1(0,0,1);_.vmult(ae,ae);const ge=new Vec3$1;oe.vsub(K,ge);const ce=ge.dot(ae);ie.vsub(K,ge);const de=ge.dot(ae);if(ce*de>0||oe.distanceTo(ie)<ce)return;const pe=ae.dot(se);if(Math.abs(pe)<this.precision)return;const fe=new Vec3$1,be=new Vec3$1,me=new Vec3$1;oe.vsub(K,fe);const ye=-ae.dot(fe)/pe;se.scale(ye,be),oe.vadd(be,me),this.reportIntersection(ae,me,ne,te,-1)}getAABB(Z){const{lowerBound:_,upperBound:K}=Z,te=this.to,ne=this.from;_.x=Math.min(te.x,ne.x),_.y=Math.min(te.y,ne.y),_.z=Math.min(te.z,ne.z),K.x=Math.max(te.x,ne.x),K.y=Math.max(te.y,ne.y),K.z=Math.max(te.z,ne.z)}_intersectHeightfield(Z,_,K,te,ne){Z.data,Z.elementSize;const oe=intersectHeightfield_localRay$1;oe.from.copy(this.from),oe.to.copy(this.to),Transform$1.pointToLocalFrame(K,_,oe.from,oe.from),Transform$1.pointToLocalFrame(K,_,oe.to,oe.to),oe.updateDirection();const ie=intersectHeightfield_index$1;let se,ae,ge,ce;se=ae=0,ge=ce=Z.data.length-1;const de=new AABB$1;oe.getAABB(de),Z.getIndexOfPosition(de.lowerBound.x,de.lowerBound.y,ie,!0),se=Math.max(se,ie[0]),ae=Math.max(ae,ie[1]),Z.getIndexOfPosition(de.upperBound.x,de.upperBound.y,ie,!0),ge=Math.min(ge,ie[0]+1),ce=Math.min(ce,ie[1]+1);for(let pe=se;pe<ge;pe++)for(let fe=ae;fe<ce;fe++){if(this.result.shouldStop)return;if(Z.getAabbAtIndex(pe,fe,de),!!de.overlapsRay(oe)){if(Z.getConvexTrianglePillar(pe,fe,!1),Transform$1.pointToWorldFrame(K,_,Z.pillarOffset,worldPillarOffset$1),this._intersectConvex(Z.pillarConvex,_,worldPillarOffset$1,te,ne,intersectConvexOptions$1),this.result.shouldStop)return;Z.getConvexTrianglePillar(pe,fe,!0),Transform$1.pointToWorldFrame(K,_,Z.pillarOffset,worldPillarOffset$1),this._intersectConvex(Z.pillarConvex,_,worldPillarOffset$1,te,ne,intersectConvexOptions$1)}}}_intersectSphere(Z,_,K,te,ne){const oe=this.from,ie=this.to,se=Z.radius,ae=(ie.x-oe.x)**2+(ie.y-oe.y)**2+(ie.z-oe.z)**2,ge=2*((ie.x-oe.x)*(oe.x-K.x)+(ie.y-oe.y)*(oe.y-K.y)+(ie.z-oe.z)*(oe.z-K.z)),ce=(oe.x-K.x)**2+(oe.y-K.y)**2+(oe.z-K.z)**2-se**2,de=ge**2-4*ae*ce,pe=Ray_intersectSphere_intersectionPoint$1,fe=Ray_intersectSphere_normal$1;if(!(de<0))if(de===0)oe.lerp(ie,de,pe),pe.vsub(K,fe),fe.normalize(),this.reportIntersection(fe,pe,ne,te,-1);else{const be=(-ge-Math.sqrt(de))/(2*ae),me=(-ge+Math.sqrt(de))/(2*ae);if(be>=0&&be<=1&&(oe.lerp(ie,be,pe),pe.vsub(K,fe),fe.normalize(),this.reportIntersection(fe,pe,ne,te,-1)),this.result.shouldStop)return;me>=0&&me<=1&&(oe.lerp(ie,me,pe),pe.vsub(K,fe),fe.normalize(),this.reportIntersection(fe,pe,ne,te,-1))}}_intersectConvex(Z,_,K,te,ne,oe){const ie=intersectConvex_normal$1,se=intersectConvex_vector$1,ae=oe&&oe.faceList||null,ge=Z.faces,ce=Z.vertices,de=Z.faceNormals,pe=this.direction,fe=this.from,be=this.to,me=fe.distanceTo(be),ye=ae?ae.length:ge.length,ve=this.result;for(let Be=0;!ve.shouldStop&&Be<ye;Be++){const Re=ae?ae[Be]:Be,Ee=ge[Re],We=de[Re],Ze=_,Ve=K;se.copy(ce[Ee[0]]),Ze.vmult(se,se),se.vadd(Ve,se),se.vsub(fe,se),Ze.vmult(We,ie);const _e=pe.dot(ie);if(Math.abs(_e)<this.precision)continue;const Xe=ie.dot(se)/_e;if(!(Xe<0)){pe.scale(Xe,intersectPoint$1),intersectPoint$1.vadd(fe,intersectPoint$1),a$1.copy(ce[Ee[0]]),Ze.vmult(a$1,a$1),Ve.vadd(a$1,a$1);for(let Pe=1;!ve.shouldStop&&Pe<Ee.length-1;Pe++){b$1.copy(ce[Ee[Pe]]),c$1.copy(ce[Ee[Pe+1]]),Ze.vmult(b$1,b$1),Ze.vmult(c$1,c$1),Ve.vadd(b$1,b$1),Ve.vadd(c$1,c$1);const He=intersectPoint$1.distanceTo(fe);!(Ray$1.pointInTriangle(intersectPoint$1,a$1,b$1,c$1)||Ray$1.pointInTriangle(intersectPoint$1,b$1,a$1,c$1))||He>me||this.reportIntersection(ie,intersectPoint$1,ne,te,Re)}}}}_intersectTrimesh(Z,_,K,te,ne,oe){const ie=intersectTrimesh_normal$1,se=intersectTrimesh_triangles$1,ae=intersectTrimesh_treeTransform$1,ge=intersectConvex_vector$1,ce=intersectTrimesh_localDirection$1,de=intersectTrimesh_localFrom$1,pe=intersectTrimesh_localTo$1,fe=intersectTrimesh_worldIntersectPoint$1,be=intersectTrimesh_worldNormal$1,me=Z.indices;Z.vertices;const ye=this.from,ve=this.to,Be=this.direction;ae.position.copy(K),ae.quaternion.copy(_),Transform$1.vectorToLocalFrame(K,_,Be,ce),Transform$1.pointToLocalFrame(K,_,ye,de),Transform$1.pointToLocalFrame(K,_,ve,pe),pe.x*=Z.scale.x,pe.y*=Z.scale.y,pe.z*=Z.scale.z,de.x*=Z.scale.x,de.y*=Z.scale.y,de.z*=Z.scale.z,pe.vsub(de,ce),ce.normalize();const Re=de.distanceSquared(pe);Z.tree.rayQuery(this,ae,se);for(let Ee=0,We=se.length;!this.result.shouldStop&&Ee!==We;Ee++){const Ze=se[Ee];Z.getNormal(Ze,ie),Z.getVertex(me[Ze*3],a$1),a$1.vsub(de,ge);const Ve=ce.dot(ie),_e=ie.dot(ge)/Ve;if(_e<0)continue;ce.scale(_e,intersectPoint$1),intersectPoint$1.vadd(de,intersectPoint$1),Z.getVertex(me[Ze*3+1],b$1),Z.getVertex(me[Ze*3+2],c$1);const Xe=intersectPoint$1.distanceSquared(de);!(Ray$1.pointInTriangle(intersectPoint$1,b$1,a$1,c$1)||Ray$1.pointInTriangle(intersectPoint$1,a$1,b$1,c$1))||Xe>Re||(Transform$1.vectorToWorldFrame(_,ie,be),Transform$1.pointToWorldFrame(K,_,intersectPoint$1,fe),this.reportIntersection(be,fe,ne,te,Ze))}se.length=0}reportIntersection(Z,_,K,te,ne){const oe=this.from,ie=this.to,se=oe.distanceTo(_),ae=this.result;if(!(this.skipBackfaces&&Z.dot(this.direction)>0))switch(ae.hitFaceIndex=typeof ne<"u"?ne:-1,this.mode){case Ray$1.ALL:this.hasHit=!0,ae.set(oe,ie,Z,_,K,te,se),ae.hasHit=!0,this.callback(ae);break;case Ray$1.CLOSEST:(se<ae.distance||!ae.hasHit)&&(this.hasHit=!0,ae.hasHit=!0,ae.set(oe,ie,Z,_,K,te,se));break;case Ray$1.ANY:this.hasHit=!0,ae.hasHit=!0,ae.set(oe,ie,Z,_,K,te,se),ae.shouldStop=!0;break}}static pointInTriangle(Z,_,K,te){te.vsub(_,v0$1),K.vsub(_,v1$1),Z.vsub(_,v2$1);const ne=v0$1.dot(v0$1),oe=v0$1.dot(v1$1),ie=v0$1.dot(v2$1),se=v1$1.dot(v1$1),ae=v1$1.dot(v2$1);let ge,ce;return(ge=se*ie-oe*ae)>=0&&(ce=ne*ae-oe*ie)>=0&&ge+ce<ne*se-oe*oe}}Ray$1.CLOSEST=RAY_MODES$1.CLOSEST;Ray$1.ANY=RAY_MODES$1.ANY;Ray$1.ALL=RAY_MODES$1.ALL;const tmpAABB$1$1=new AABB$1,tmpArray$1=[],v1$1=new Vec3$1,v2$1=new Vec3$1,intersectBody_xi$1=new Vec3$1,intersectBody_qi$1=new Quaternion$1,intersectPoint$1=new Vec3$1,a$1=new Vec3$1,b$1=new Vec3$1,c$1=new Vec3$1;new Vec3$1;new RaycastResult$1;const intersectConvexOptions$1={faceList:[0]},worldPillarOffset$1=new Vec3$1,intersectHeightfield_localRay$1=new Ray$1,intersectHeightfield_index$1=[],Ray_intersectSphere_intersectionPoint$1=new Vec3$1,Ray_intersectSphere_normal$1=new Vec3$1,intersectConvex_normal$1=new Vec3$1;new Vec3$1;new Vec3$1;const intersectConvex_vector$1=new Vec3$1,intersectTrimesh_normal$1=new Vec3$1,intersectTrimesh_localDirection$1=new Vec3$1,intersectTrimesh_localFrom$1=new Vec3$1,intersectTrimesh_localTo$1=new Vec3$1,intersectTrimesh_worldNormal$1=new Vec3$1,intersectTrimesh_worldIntersectPoint$1=new Vec3$1;new AABB$1;const intersectTrimesh_triangles$1=[],intersectTrimesh_treeTransform$1=new Transform$1,v0$1=new Vec3$1,intersect$1=new Vec3$1;function distanceFromIntersection$1(X,Z,_){_.vsub(X,v0$1);const K=v0$1.dot(Z);return Z.scale(K,intersect$1),intersect$1.vadd(X,intersect$1),_.distanceTo(intersect$1)}new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Ray$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1(1,0,0),new Vec3$1(0,1,0),new Vec3$1(0,0,1);new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new AABB$1;new Vec3$1;new AABB$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new AABB$1;new Vec3$1;new Transform$1;new AABB$1;Shape$1.types.SPHERE,Shape$1.types.SPHERE|Shape$1.types.PLANE,Shape$1.types.BOX|Shape$1.types.BOX,Shape$1.types.SPHERE|Shape$1.types.BOX,Shape$1.types.PLANE|Shape$1.types.BOX,Shape$1.types.CONVEXPOLYHEDRON,Shape$1.types.SPHERE|Shape$1.types.CONVEXPOLYHEDRON,Shape$1.types.PLANE|Shape$1.types.CONVEXPOLYHEDRON,Shape$1.types.BOX|Shape$1.types.CONVEXPOLYHEDRON,Shape$1.types.SPHERE|Shape$1.types.HEIGHTFIELD,Shape$1.types.BOX|Shape$1.types.HEIGHTFIELD,Shape$1.types.CONVEXPOLYHEDRON|Shape$1.types.HEIGHTFIELD,Shape$1.types.PARTICLE|Shape$1.types.SPHERE,Shape$1.types.PLANE|Shape$1.types.PARTICLE,Shape$1.types.BOX|Shape$1.types.PARTICLE,Shape$1.types.PARTICLE|Shape$1.types.CONVEXPOLYHEDRON,Shape$1.types.CYLINDER,Shape$1.types.SPHERE|Shape$1.types.CYLINDER,Shape$1.types.PLANE|Shape$1.types.CYLINDER,Shape$1.types.BOX|Shape$1.types.CYLINDER,Shape$1.types.CONVEXPOLYHEDRON|Shape$1.types.CYLINDER,Shape$1.types.HEIGHTFIELD|Shape$1.types.CYLINDER,Shape$1.types.PARTICLE|Shape$1.types.CYLINDER,Shape$1.types.SPHERE|Shape$1.types.TRIMESH,Shape$1.types.PLANE|Shape$1.types.TRIMESH;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Quaternion$1;new Quaternion$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new AABB$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1,new Vec3$1,new Vec3$1,new Vec3$1,new Vec3$1,new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Quaternion$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new AABB$1;new Ray$1;const performance$1=globalThis.performance||{};if(!performance$1.now){let X=Date.now();performance$1.timing&&performance$1.timing.navigationStart&&(X=performance$1.timing.navigationStart),performance$1.now=()=>Date.now()-X}new Vec3$1;class Mat3{constructor(Z){Z===void 0&&(Z=[0,0,0,0,0,0,0,0,0]),this.elements=Z}identity(){const Z=this.elements;Z[0]=1,Z[1]=0,Z[2]=0,Z[3]=0,Z[4]=1,Z[5]=0,Z[6]=0,Z[7]=0,Z[8]=1}setZero(){const Z=this.elements;Z[0]=0,Z[1]=0,Z[2]=0,Z[3]=0,Z[4]=0,Z[5]=0,Z[6]=0,Z[7]=0,Z[8]=0}setTrace(Z){const _=this.elements;_[0]=Z.x,_[4]=Z.y,_[8]=Z.z}getTrace(Z){Z===void 0&&(Z=new Vec3);const _=this.elements;return Z.x=_[0],Z.y=_[4],Z.z=_[8],Z}vmult(Z,_){_===void 0&&(_=new Vec3);const K=this.elements,te=Z.x,ne=Z.y,oe=Z.z;return _.x=K[0]*te+K[1]*ne+K[2]*oe,_.y=K[3]*te+K[4]*ne+K[5]*oe,_.z=K[6]*te+K[7]*ne+K[8]*oe,_}smult(Z){for(let _=0;_<this.elements.length;_++)this.elements[_]*=Z}mmult(Z,_){_===void 0&&(_=new Mat3);const K=this.elements,te=Z.elements,ne=_.elements,oe=K[0],ie=K[1],se=K[2],ae=K[3],ge=K[4],ce=K[5],de=K[6],pe=K[7],fe=K[8],be=te[0],me=te[1],ye=te[2],ve=te[3],Be=te[4],Re=te[5],Ee=te[6],We=te[7],Ze=te[8];return ne[0]=oe*be+ie*ve+se*Ee,ne[1]=oe*me+ie*Be+se*We,ne[2]=oe*ye+ie*Re+se*Ze,ne[3]=ae*be+ge*ve+ce*Ee,ne[4]=ae*me+ge*Be+ce*We,ne[5]=ae*ye+ge*Re+ce*Ze,ne[6]=de*be+pe*ve+fe*Ee,ne[7]=de*me+pe*Be+fe*We,ne[8]=de*ye+pe*Re+fe*Ze,_}scale(Z,_){_===void 0&&(_=new Mat3);const K=this.elements,te=_.elements;for(let ne=0;ne!==3;ne++)te[3*ne+0]=Z.x*K[3*ne+0],te[3*ne+1]=Z.y*K[3*ne+1],te[3*ne+2]=Z.z*K[3*ne+2];return _}solve(Z,_){_===void 0&&(_=new Vec3);const K=3,te=4,ne=[];let oe,ie;for(oe=0;oe<K*te;oe++)ne.push(0);for(oe=0;oe<3;oe++)for(ie=0;ie<3;ie++)ne[oe+te*ie]=this.elements[oe+3*ie];ne[3+4*0]=Z.x,ne[3+4*1]=Z.y,ne[3+4*2]=Z.z;let se=3;const ae=se;let ge;const ce=4;let de;do{if(oe=ae-se,ne[oe+te*oe]===0){for(ie=oe+1;ie<ae;ie++)if(ne[oe+te*ie]!==0){ge=ce;do de=ce-ge,ne[de+te*oe]+=ne[de+te*ie];while(--ge);break}}if(ne[oe+te*oe]!==0)for(ie=oe+1;ie<ae;ie++){const pe=ne[oe+te*ie]/ne[oe+te*oe];ge=ce;do de=ce-ge,ne[de+te*ie]=de<=oe?0:ne[de+te*ie]-ne[de+te*oe]*pe;while(--ge)}}while(--se);if(_.z=ne[2*te+3]/ne[2*te+2],_.y=(ne[1*te+3]-ne[1*te+2]*_.z)/ne[1*te+1],_.x=(ne[0*te+3]-ne[0*te+2]*_.z-ne[0*te+1]*_.y)/ne[0*te+0],isNaN(_.x)||isNaN(_.y)||isNaN(_.z)||_.x===1/0||_.y===1/0||_.z===1/0)throw`Could not solve equation! Got x=[${_.toString()}], b=[${Z.toString()}], A=[${this.toString()}]`;return _}e(Z,_,K){if(K===void 0)return this.elements[_+3*Z];this.elements[_+3*Z]=K}copy(Z){for(let _=0;_<Z.elements.length;_++)this.elements[_]=Z.elements[_];return this}toString(){let Z="";const _=",";for(let K=0;K<9;K++)Z+=this.elements[K]+_;return Z}reverse(Z){Z===void 0&&(Z=new Mat3);const _=3,K=6,te=reverse_eqns;let ne,oe;for(ne=0;ne<3;ne++)for(oe=0;oe<3;oe++)te[ne+K*oe]=this.elements[ne+3*oe];te[3+6*0]=1,te[3+6*1]=0,te[3+6*2]=0,te[4+6*0]=0,te[4+6*1]=1,te[4+6*2]=0,te[5+6*0]=0,te[5+6*1]=0,te[5+6*2]=1;let ie=3;const se=ie;let ae;const ge=K;let ce;do{if(ne=se-ie,te[ne+K*ne]===0){for(oe=ne+1;oe<se;oe++)if(te[ne+K*oe]!==0){ae=ge;do ce=ge-ae,te[ce+K*ne]+=te[ce+K*oe];while(--ae);break}}if(te[ne+K*ne]!==0)for(oe=ne+1;oe<se;oe++){const de=te[ne+K*oe]/te[ne+K*ne];ae=ge;do ce=ge-ae,te[ce+K*oe]=ce<=ne?0:te[ce+K*oe]-te[ce+K*ne]*de;while(--ae)}}while(--ie);ne=2;do{oe=ne-1;do{const de=te[ne+K*oe]/te[ne+K*ne];ae=K;do ce=K-ae,te[ce+K*oe]=te[ce+K*oe]-te[ce+K*ne]*de;while(--ae)}while(oe--)}while(--ne);ne=2;do{const de=1/te[ne+K*ne];ae=K;do ce=K-ae,te[ce+K*ne]=te[ce+K*ne]*de;while(--ae)}while(ne--);ne=2;do{oe=2;do{if(ce=te[_+oe+K*ne],isNaN(ce)||ce===1/0)throw`Could not reverse! A=[${this.toString()}]`;Z.e(ne,oe,ce)}while(oe--)}while(ne--);return Z}setRotationFromQuaternion(Z){const _=Z.x,K=Z.y,te=Z.z,ne=Z.w,oe=_+_,ie=K+K,se=te+te,ae=_*oe,ge=_*ie,ce=_*se,de=K*ie,pe=K*se,fe=te*se,be=ne*oe,me=ne*ie,ye=ne*se,ve=this.elements;return ve[3*0+0]=1-(de+fe),ve[3*0+1]=ge-ye,ve[3*0+2]=ce+me,ve[3*1+0]=ge+ye,ve[3*1+1]=1-(ae+fe),ve[3*1+2]=pe-be,ve[3*2+0]=ce-me,ve[3*2+1]=pe+be,ve[3*2+2]=1-(ae+de),this}transpose(Z){Z===void 0&&(Z=new Mat3);const _=this.elements,K=Z.elements;let te;return K[0]=_[0],K[4]=_[4],K[8]=_[8],te=_[1],K[1]=_[3],K[3]=te,te=_[2],K[2]=_[6],K[6]=te,te=_[5],K[5]=_[7],K[7]=te,Z}}const reverse_eqns=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];class Vec3{constructor(Z,_,K){Z===void 0&&(Z=0),_===void 0&&(_=0),K===void 0&&(K=0),this.x=Z,this.y=_,this.z=K}cross(Z,_){_===void 0&&(_=new Vec3);const K=Z.x,te=Z.y,ne=Z.z,oe=this.x,ie=this.y,se=this.z;return _.x=ie*ne-se*te,_.y=se*K-oe*ne,_.z=oe*te-ie*K,_}set(Z,_,K){return this.x=Z,this.y=_,this.z=K,this}setZero(){this.x=this.y=this.z=0}vadd(Z,_){if(_)_.x=Z.x+this.x,_.y=Z.y+this.y,_.z=Z.z+this.z;else return new Vec3(this.x+Z.x,this.y+Z.y,this.z+Z.z)}vsub(Z,_){if(_)_.x=this.x-Z.x,_.y=this.y-Z.y,_.z=this.z-Z.z;else return new Vec3(this.x-Z.x,this.y-Z.y,this.z-Z.z)}crossmat(){return new Mat3([0,-this.z,this.y,this.z,0,-this.x,-this.y,this.x,0])}normalize(){const Z=this.x,_=this.y,K=this.z,te=Math.sqrt(Z*Z+_*_+K*K);if(te>0){const ne=1/te;this.x*=ne,this.y*=ne,this.z*=ne}else this.x=0,this.y=0,this.z=0;return te}unit(Z){Z===void 0&&(Z=new Vec3);const _=this.x,K=this.y,te=this.z;let ne=Math.sqrt(_*_+K*K+te*te);return ne>0?(ne=1/ne,Z.x=_*ne,Z.y=K*ne,Z.z=te*ne):(Z.x=1,Z.y=0,Z.z=0),Z}length(){const Z=this.x,_=this.y,K=this.z;return Math.sqrt(Z*Z+_*_+K*K)}lengthSquared(){return this.dot(this)}distanceTo(Z){const _=this.x,K=this.y,te=this.z,ne=Z.x,oe=Z.y,ie=Z.z;return Math.sqrt((ne-_)*(ne-_)+(oe-K)*(oe-K)+(ie-te)*(ie-te))}distanceSquared(Z){const _=this.x,K=this.y,te=this.z,ne=Z.x,oe=Z.y,ie=Z.z;return(ne-_)*(ne-_)+(oe-K)*(oe-K)+(ie-te)*(ie-te)}scale(Z,_){_===void 0&&(_=new Vec3);const K=this.x,te=this.y,ne=this.z;return _.x=Z*K,_.y=Z*te,_.z=Z*ne,_}vmul(Z,_){return _===void 0&&(_=new Vec3),_.x=Z.x*this.x,_.y=Z.y*this.y,_.z=Z.z*this.z,_}addScaledVector(Z,_,K){return K===void 0&&(K=new Vec3),K.x=this.x+Z*_.x,K.y=this.y+Z*_.y,K.z=this.z+Z*_.z,K}dot(Z){return this.x*Z.x+this.y*Z.y+this.z*Z.z}isZero(){return this.x===0&&this.y===0&&this.z===0}negate(Z){return Z===void 0&&(Z=new Vec3),Z.x=-this.x,Z.y=-this.y,Z.z=-this.z,Z}tangents(Z,_){const K=this.length();if(K>0){const te=Vec3_tangents_n,ne=1/K;te.set(this.x*ne,this.y*ne,this.z*ne);const oe=Vec3_tangents_randVec;Math.abs(te.x)<.9?(oe.set(1,0,0),te.cross(oe,Z)):(oe.set(0,1,0),te.cross(oe,Z)),te.cross(Z,_)}else Z.set(1,0,0),_.set(0,1,0)}toString(){return`${this.x},${this.y},${this.z}`}toArray(){return[this.x,this.y,this.z]}copy(Z){return this.x=Z.x,this.y=Z.y,this.z=Z.z,this}lerp(Z,_,K){const te=this.x,ne=this.y,oe=this.z;K.x=te+(Z.x-te)*_,K.y=ne+(Z.y-ne)*_,K.z=oe+(Z.z-oe)*_}almostEquals(Z,_){return _===void 0&&(_=1e-6),!(Math.abs(this.x-Z.x)>_||Math.abs(this.y-Z.y)>_||Math.abs(this.z-Z.z)>_)}almostZero(Z){return Z===void 0&&(Z=1e-6),!(Math.abs(this.x)>Z||Math.abs(this.y)>Z||Math.abs(this.z)>Z)}isAntiparallelTo(Z,_){return this.negate(antip_neg),antip_neg.almostEquals(Z,_)}clone(){return new Vec3(this.x,this.y,this.z)}}Vec3.ZERO=new Vec3(0,0,0);Vec3.UNIT_X=new Vec3(1,0,0);Vec3.UNIT_Y=new Vec3(0,1,0);Vec3.UNIT_Z=new Vec3(0,0,1);const Vec3_tangents_n=new Vec3,Vec3_tangents_randVec=new Vec3,antip_neg=new Vec3;class AABB{constructor(Z){Z===void 0&&(Z={}),this.lowerBound=new Vec3,this.upperBound=new Vec3,Z.lowerBound&&this.lowerBound.copy(Z.lowerBound),Z.upperBound&&this.upperBound.copy(Z.upperBound)}setFromPoints(Z,_,K,te){const ne=this.lowerBound,oe=this.upperBound,ie=K;ne.copy(Z[0]),ie&&ie.vmult(ne,ne),oe.copy(ne);for(let se=1;se<Z.length;se++){let ae=Z[se];ie&&(ie.vmult(ae,tmp$1),ae=tmp$1),ae.x>oe.x&&(oe.x=ae.x),ae.x<ne.x&&(ne.x=ae.x),ae.y>oe.y&&(oe.y=ae.y),ae.y<ne.y&&(ne.y=ae.y),ae.z>oe.z&&(oe.z=ae.z),ae.z<ne.z&&(ne.z=ae.z)}return _&&(_.vadd(ne,ne),_.vadd(oe,oe)),te&&(ne.x-=te,ne.y-=te,ne.z-=te,oe.x+=te,oe.y+=te,oe.z+=te),this}copy(Z){return this.lowerBound.copy(Z.lowerBound),this.upperBound.copy(Z.upperBound),this}clone(){return new AABB().copy(this)}extend(Z){this.lowerBound.x=Math.min(this.lowerBound.x,Z.lowerBound.x),this.upperBound.x=Math.max(this.upperBound.x,Z.upperBound.x),this.lowerBound.y=Math.min(this.lowerBound.y,Z.lowerBound.y),this.upperBound.y=Math.max(this.upperBound.y,Z.upperBound.y),this.lowerBound.z=Math.min(this.lowerBound.z,Z.lowerBound.z),this.upperBound.z=Math.max(this.upperBound.z,Z.upperBound.z)}overlaps(Z){const _=this.lowerBound,K=this.upperBound,te=Z.lowerBound,ne=Z.upperBound,oe=te.x<=K.x&&K.x<=ne.x||_.x<=ne.x&&ne.x<=K.x,ie=te.y<=K.y&&K.y<=ne.y||_.y<=ne.y&&ne.y<=K.y,se=te.z<=K.z&&K.z<=ne.z||_.z<=ne.z&&ne.z<=K.z;return oe&&ie&&se}volume(){const Z=this.lowerBound,_=this.upperBound;return(_.x-Z.x)*(_.y-Z.y)*(_.z-Z.z)}contains(Z){const _=this.lowerBound,K=this.upperBound,te=Z.lowerBound,ne=Z.upperBound;return _.x<=te.x&&K.x>=ne.x&&_.y<=te.y&&K.y>=ne.y&&_.z<=te.z&&K.z>=ne.z}getCorners(Z,_,K,te,ne,oe,ie,se){const ae=this.lowerBound,ge=this.upperBound;Z.copy(ae),_.set(ge.x,ae.y,ae.z),K.set(ge.x,ge.y,ae.z),te.set(ae.x,ge.y,ge.z),ne.set(ge.x,ae.y,ge.z),oe.set(ae.x,ge.y,ae.z),ie.set(ae.x,ae.y,ge.z),se.copy(ge)}toLocalFrame(Z,_){const K=transformIntoFrame_corners,te=K[0],ne=K[1],oe=K[2],ie=K[3],se=K[4],ae=K[5],ge=K[6],ce=K[7];this.getCorners(te,ne,oe,ie,se,ae,ge,ce);for(let de=0;de!==8;de++){const pe=K[de];Z.pointToLocal(pe,pe)}return _.setFromPoints(K)}toWorldFrame(Z,_){const K=transformIntoFrame_corners,te=K[0],ne=K[1],oe=K[2],ie=K[3],se=K[4],ae=K[5],ge=K[6],ce=K[7];this.getCorners(te,ne,oe,ie,se,ae,ge,ce);for(let de=0;de!==8;de++){const pe=K[de];Z.pointToWorld(pe,pe)}return _.setFromPoints(K)}overlapsRay(Z){const{direction:_,from:K}=Z,te=1/_.x,ne=1/_.y,oe=1/_.z,ie=(this.lowerBound.x-K.x)*te,se=(this.upperBound.x-K.x)*te,ae=(this.lowerBound.y-K.y)*ne,ge=(this.upperBound.y-K.y)*ne,ce=(this.lowerBound.z-K.z)*oe,de=(this.upperBound.z-K.z)*oe,pe=Math.max(Math.max(Math.min(ie,se),Math.min(ae,ge)),Math.min(ce,de)),fe=Math.min(Math.min(Math.max(ie,se),Math.max(ae,ge)),Math.max(ce,de));return!(fe<0||pe>fe)}}const tmp$1=new Vec3,transformIntoFrame_corners=[new Vec3,new Vec3,new Vec3,new Vec3,new Vec3,new Vec3,new Vec3,new Vec3];class Quaternion{constructor(Z,_,K,te){Z===void 0&&(Z=0),_===void 0&&(_=0),K===void 0&&(K=0),te===void 0&&(te=1),this.x=Z,this.y=_,this.z=K,this.w=te}set(Z,_,K,te){return this.x=Z,this.y=_,this.z=K,this.w=te,this}toString(){return`${this.x},${this.y},${this.z},${this.w}`}toArray(){return[this.x,this.y,this.z,this.w]}setFromAxisAngle(Z,_){const K=Math.sin(_*.5);return this.x=Z.x*K,this.y=Z.y*K,this.z=Z.z*K,this.w=Math.cos(_*.5),this}toAxisAngle(Z){Z===void 0&&(Z=new Vec3),this.normalize();const _=2*Math.acos(this.w),K=Math.sqrt(1-this.w*this.w);return K<.001?(Z.x=this.x,Z.y=this.y,Z.z=this.z):(Z.x=this.x/K,Z.y=this.y/K,Z.z=this.z/K),[Z,_]}setFromVectors(Z,_){if(Z.isAntiparallelTo(_)){const K=sfv_t1,te=sfv_t2;Z.tangents(K,te),this.setFromAxisAngle(K,Math.PI)}else{const K=Z.cross(_);this.x=K.x,this.y=K.y,this.z=K.z,this.w=Math.sqrt(Z.length()**2*_.length()**2)+Z.dot(_),this.normalize()}return this}mult(Z,_){_===void 0&&(_=new Quaternion);const K=this.x,te=this.y,ne=this.z,oe=this.w,ie=Z.x,se=Z.y,ae=Z.z,ge=Z.w;return _.x=K*ge+oe*ie+te*ae-ne*se,_.y=te*ge+oe*se+ne*ie-K*ae,_.z=ne*ge+oe*ae+K*se-te*ie,_.w=oe*ge-K*ie-te*se-ne*ae,_}inverse(Z){Z===void 0&&(Z=new Quaternion);const _=this.x,K=this.y,te=this.z,ne=this.w;this.conjugate(Z);const oe=1/(_*_+K*K+te*te+ne*ne);return Z.x*=oe,Z.y*=oe,Z.z*=oe,Z.w*=oe,Z}conjugate(Z){return Z===void 0&&(Z=new Quaternion),Z.x=-this.x,Z.y=-this.y,Z.z=-this.z,Z.w=this.w,Z}normalize(){let Z=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);return Z===0?(this.x=0,this.y=0,this.z=0,this.w=0):(Z=1/Z,this.x*=Z,this.y*=Z,this.z*=Z,this.w*=Z),this}normalizeFast(){const Z=(3-(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w))/2;return Z===0?(this.x=0,this.y=0,this.z=0,this.w=0):(this.x*=Z,this.y*=Z,this.z*=Z,this.w*=Z),this}vmult(Z,_){_===void 0&&(_=new Vec3);const K=Z.x,te=Z.y,ne=Z.z,oe=this.x,ie=this.y,se=this.z,ae=this.w,ge=ae*K+ie*ne-se*te,ce=ae*te+se*K-oe*ne,de=ae*ne+oe*te-ie*K,pe=-oe*K-ie*te-se*ne;return _.x=ge*ae+pe*-oe+ce*-se-de*-ie,_.y=ce*ae+pe*-ie+de*-oe-ge*-se,_.z=de*ae+pe*-se+ge*-ie-ce*-oe,_}copy(Z){return this.x=Z.x,this.y=Z.y,this.z=Z.z,this.w=Z.w,this}toEuler(Z,_){_===void 0&&(_="YZX");let K,te,ne;const oe=this.x,ie=this.y,se=this.z,ae=this.w;switch(_){case"YZX":const ge=oe*ie+se*ae;if(ge>.499&&(K=2*Math.atan2(oe,ae),te=Math.PI/2,ne=0),ge<-.499&&(K=-2*Math.atan2(oe,ae),te=-Math.PI/2,ne=0),K===void 0){const ce=oe*oe,de=ie*ie,pe=se*se;K=Math.atan2(2*ie*ae-2*oe*se,1-2*de-2*pe),te=Math.asin(2*ge),ne=Math.atan2(2*oe*ae-2*ie*se,1-2*ce-2*pe)}break;default:throw new Error(`Euler order ${_} not supported yet.`)}Z.y=K,Z.z=te,Z.x=ne}setFromEuler(Z,_,K,te){te===void 0&&(te="XYZ");const ne=Math.cos(Z/2),oe=Math.cos(_/2),ie=Math.cos(K/2),se=Math.sin(Z/2),ae=Math.sin(_/2),ge=Math.sin(K/2);return te==="XYZ"?(this.x=se*oe*ie+ne*ae*ge,this.y=ne*ae*ie-se*oe*ge,this.z=ne*oe*ge+se*ae*ie,this.w=ne*oe*ie-se*ae*ge):te==="YXZ"?(this.x=se*oe*ie+ne*ae*ge,this.y=ne*ae*ie-se*oe*ge,this.z=ne*oe*ge-se*ae*ie,this.w=ne*oe*ie+se*ae*ge):te==="ZXY"?(this.x=se*oe*ie-ne*ae*ge,this.y=ne*ae*ie+se*oe*ge,this.z=ne*oe*ge+se*ae*ie,this.w=ne*oe*ie-se*ae*ge):te==="ZYX"?(this.x=se*oe*ie-ne*ae*ge,this.y=ne*ae*ie+se*oe*ge,this.z=ne*oe*ge-se*ae*ie,this.w=ne*oe*ie+se*ae*ge):te==="YZX"?(this.x=se*oe*ie+ne*ae*ge,this.y=ne*ae*ie+se*oe*ge,this.z=ne*oe*ge-se*ae*ie,this.w=ne*oe*ie-se*ae*ge):te==="XZY"&&(this.x=se*oe*ie-ne*ae*ge,this.y=ne*ae*ie-se*oe*ge,this.z=ne*oe*ge+se*ae*ie,this.w=ne*oe*ie+se*ae*ge),this}clone(){return new Quaternion(this.x,this.y,this.z,this.w)}slerp(Z,_,K){K===void 0&&(K=new Quaternion);const te=this.x,ne=this.y,oe=this.z,ie=this.w;let se=Z.x,ae=Z.y,ge=Z.z,ce=Z.w,de,pe,fe,be,me;return pe=te*se+ne*ae+oe*ge+ie*ce,pe<0&&(pe=-pe,se=-se,ae=-ae,ge=-ge,ce=-ce),1-pe>1e-6?(de=Math.acos(pe),fe=Math.sin(de),be=Math.sin((1-_)*de)/fe,me=Math.sin(_*de)/fe):(be=1-_,me=_),K.x=be*te+me*se,K.y=be*ne+me*ae,K.z=be*oe+me*ge,K.w=be*ie+me*ce,K}integrate(Z,_,K,te){te===void 0&&(te=new Quaternion);const ne=Z.x*K.x,oe=Z.y*K.y,ie=Z.z*K.z,se=this.x,ae=this.y,ge=this.z,ce=this.w,de=_*.5;return te.x+=de*(ne*ce+oe*ge-ie*ae),te.y+=de*(oe*ce+ie*se-ne*ge),te.z+=de*(ie*ce+ne*ae-oe*se),te.w+=de*(-ne*se-oe*ae-ie*ge),te}}const sfv_t1=new Vec3,sfv_t2=new Vec3,SHAPE_TYPES={SPHERE:1,PLANE:2,BOX:4,COMPOUND:8,CONVEXPOLYHEDRON:16,HEIGHTFIELD:32,PARTICLE:64,CYLINDER:128,TRIMESH:256};class Shape{constructor(Z){Z===void 0&&(Z={}),this.id=Shape.idCounter++,this.type=Z.type||0,this.boundingSphereRadius=0,this.collisionResponse=Z.collisionResponse?Z.collisionResponse:!0,this.collisionFilterGroup=Z.collisionFilterGroup!==void 0?Z.collisionFilterGroup:1,this.collisionFilterMask=Z.collisionFilterMask!==void 0?Z.collisionFilterMask:-1,this.material=Z.material?Z.material:null,this.body=null}updateBoundingSphereRadius(){throw`computeBoundingSphereRadius() not implemented for shape type ${this.type}`}volume(){throw`volume() not implemented for shape type ${this.type}`}calculateLocalInertia(Z,_){throw`calculateLocalInertia() not implemented for shape type ${this.type}`}calculateWorldAABB(Z,_,K,te){throw`calculateWorldAABB() not implemented for shape type ${this.type}`}}Shape.idCounter=0;Shape.types=SHAPE_TYPES;class Transform{constructor(Z){Z===void 0&&(Z={}),this.position=new Vec3,this.quaternion=new Quaternion,Z.position&&this.position.copy(Z.position),Z.quaternion&&this.quaternion.copy(Z.quaternion)}pointToLocal(Z,_){return Transform.pointToLocalFrame(this.position,this.quaternion,Z,_)}pointToWorld(Z,_){return Transform.pointToWorldFrame(this.position,this.quaternion,Z,_)}vectorToWorldFrame(Z,_){return _===void 0&&(_=new Vec3),this.quaternion.vmult(Z,_),_}static pointToLocalFrame(Z,_,K,te){return te===void 0&&(te=new Vec3),K.vsub(Z,te),_.conjugate(tmpQuat$1),tmpQuat$1.vmult(te,te),te}static pointToWorldFrame(Z,_,K,te){return te===void 0&&(te=new Vec3),_.vmult(K,te),te.vadd(Z,te),te}static vectorToWorldFrame(Z,_,K){return K===void 0&&(K=new Vec3),Z.vmult(_,K),K}static vectorToLocalFrame(Z,_,K,te){return te===void 0&&(te=new Vec3),_.w*=-1,_.vmult(K,te),_.w*=-1,te}}const tmpQuat$1=new Quaternion;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3,new Vec3,new Vec3,new Vec3,new Vec3,new Vec3,new Vec3,new Vec3;new Vec3;new Quaternion;new AABB;new Mat3;new Mat3;new Mat3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Quaternion;new Vec3;new Vec3;new Vec3;new Vec3;class RaycastResult{constructor(){this.rayFromWorld=new Vec3,this.rayToWorld=new Vec3,this.hitNormalWorld=new Vec3,this.hitPointWorld=new Vec3,this.hasHit=!1,this.shape=null,this.body=null,this.hitFaceIndex=-1,this.distance=-1,this.shouldStop=!1}reset(){this.rayFromWorld.setZero(),this.rayToWorld.setZero(),this.hitNormalWorld.setZero(),this.hitPointWorld.setZero(),this.hasHit=!1,this.shape=null,this.body=null,this.hitFaceIndex=-1,this.distance=-1,this.shouldStop=!1}abort(){this.shouldStop=!0}set(Z,_,K,te,ne,oe,ie){this.rayFromWorld.copy(Z),this.rayToWorld.copy(_),this.hitNormalWorld.copy(K),this.hitPointWorld.copy(te),this.shape=ne,this.body=oe,this.distance=ie}}let _Shape$types$SPHERE,_Shape$types$PLANE,_Shape$types$BOX,_Shape$types$CYLINDER,_Shape$types$CONVEXPO,_Shape$types$HEIGHTFI,_Shape$types$TRIMESH;const RAY_MODES={CLOSEST:1,ANY:2,ALL:4};_Shape$types$SPHERE=Shape.types.SPHERE;_Shape$types$PLANE=Shape.types.PLANE;_Shape$types$BOX=Shape.types.BOX;_Shape$types$CYLINDER=Shape.types.CYLINDER;_Shape$types$CONVEXPO=Shape.types.CONVEXPOLYHEDRON;_Shape$types$HEIGHTFI=Shape.types.HEIGHTFIELD;_Shape$types$TRIMESH=Shape.types.TRIMESH;class Ray{get[_Shape$types$SPHERE](){return this._intersectSphere}get[_Shape$types$PLANE](){return this._intersectPlane}get[_Shape$types$BOX](){return this._intersectBox}get[_Shape$types$CYLINDER](){return this._intersectConvex}get[_Shape$types$CONVEXPO](){return this._intersectConvex}get[_Shape$types$HEIGHTFI](){return this._intersectHeightfield}get[_Shape$types$TRIMESH](){return this._intersectTrimesh}constructor(Z,_){Z===void 0&&(Z=new Vec3),_===void 0&&(_=new Vec3),this.from=Z.clone(),this.to=_.clone(),this.direction=new Vec3,this.precision=1e-4,this.checkCollisionResponse=!0,this.skipBackfaces=!1,this.collisionFilterMask=-1,this.collisionFilterGroup=-1,this.mode=Ray.ANY,this.result=new RaycastResult,this.hasHit=!1,this.callback=K=>{}}intersectWorld(Z,_){return this.mode=_.mode||Ray.ANY,this.result=_.result||new RaycastResult,this.skipBackfaces=!!_.skipBackfaces,this.collisionFilterMask=typeof _.collisionFilterMask<"u"?_.collisionFilterMask:-1,this.collisionFilterGroup=typeof _.collisionFilterGroup<"u"?_.collisionFilterGroup:-1,this.checkCollisionResponse=typeof _.checkCollisionResponse<"u"?_.checkCollisionResponse:!0,_.from&&this.from.copy(_.from),_.to&&this.to.copy(_.to),this.callback=_.callback||(()=>{}),this.hasHit=!1,this.result.reset(),this.updateDirection(),this.getAABB(tmpAABB$1),tmpArray.length=0,Z.broadphase.aabbQuery(Z,tmpAABB$1,tmpArray),this.intersectBodies(tmpArray),this.hasHit}intersectBody(Z,_){_&&(this.result=_,this.updateDirection());const K=this.checkCollisionResponse;if(K&&!Z.collisionResponse||(this.collisionFilterGroup&Z.collisionFilterMask)===0||(Z.collisionFilterGroup&this.collisionFilterMask)===0)return;const te=intersectBody_xi,ne=intersectBody_qi;for(let oe=0,ie=Z.shapes.length;oe<ie;oe++){const se=Z.shapes[oe];if(!(K&&!se.collisionResponse)&&(Z.quaternion.mult(Z.shapeOrientations[oe],ne),Z.quaternion.vmult(Z.shapeOffsets[oe],te),te.vadd(Z.position,te),this.intersectShape(se,ne,te,Z),this.result.shouldStop))break}}intersectBodies(Z,_){_&&(this.result=_,this.updateDirection());for(let K=0,te=Z.length;!this.result.shouldStop&&K<te;K++)this.intersectBody(Z[K])}updateDirection(){this.to.vsub(this.from,this.direction),this.direction.normalize()}intersectShape(Z,_,K,te){const ne=this.from;if(distanceFromIntersection(ne,this.direction,K)>Z.boundingSphereRadius)return;const ie=this[Z.type];ie&&ie.call(this,Z,_,K,te,Z)}_intersectBox(Z,_,K,te,ne){return this._intersectConvex(Z.convexPolyhedronRepresentation,_,K,te,ne)}_intersectPlane(Z,_,K,te,ne){const oe=this.from,ie=this.to,se=this.direction,ae=new Vec3(0,0,1);_.vmult(ae,ae);const ge=new Vec3;oe.vsub(K,ge);const ce=ge.dot(ae);ie.vsub(K,ge);const de=ge.dot(ae);if(ce*de>0||oe.distanceTo(ie)<ce)return;const pe=ae.dot(se);if(Math.abs(pe)<this.precision)return;const fe=new Vec3,be=new Vec3,me=new Vec3;oe.vsub(K,fe);const ye=-ae.dot(fe)/pe;se.scale(ye,be),oe.vadd(be,me),this.reportIntersection(ae,me,ne,te,-1)}getAABB(Z){const{lowerBound:_,upperBound:K}=Z,te=this.to,ne=this.from;_.x=Math.min(te.x,ne.x),_.y=Math.min(te.y,ne.y),_.z=Math.min(te.z,ne.z),K.x=Math.max(te.x,ne.x),K.y=Math.max(te.y,ne.y),K.z=Math.max(te.z,ne.z)}_intersectHeightfield(Z,_,K,te,ne){Z.data,Z.elementSize;const oe=intersectHeightfield_localRay;oe.from.copy(this.from),oe.to.copy(this.to),Transform.pointToLocalFrame(K,_,oe.from,oe.from),Transform.pointToLocalFrame(K,_,oe.to,oe.to),oe.updateDirection();const ie=intersectHeightfield_index;let se,ae,ge,ce;se=ae=0,ge=ce=Z.data.length-1;const de=new AABB;oe.getAABB(de),Z.getIndexOfPosition(de.lowerBound.x,de.lowerBound.y,ie,!0),se=Math.max(se,ie[0]),ae=Math.max(ae,ie[1]),Z.getIndexOfPosition(de.upperBound.x,de.upperBound.y,ie,!0),ge=Math.min(ge,ie[0]+1),ce=Math.min(ce,ie[1]+1);for(let pe=se;pe<ge;pe++)for(let fe=ae;fe<ce;fe++){if(this.result.shouldStop)return;if(Z.getAabbAtIndex(pe,fe,de),!!de.overlapsRay(oe)){if(Z.getConvexTrianglePillar(pe,fe,!1),Transform.pointToWorldFrame(K,_,Z.pillarOffset,worldPillarOffset),this._intersectConvex(Z.pillarConvex,_,worldPillarOffset,te,ne,intersectConvexOptions),this.result.shouldStop)return;Z.getConvexTrianglePillar(pe,fe,!0),Transform.pointToWorldFrame(K,_,Z.pillarOffset,worldPillarOffset),this._intersectConvex(Z.pillarConvex,_,worldPillarOffset,te,ne,intersectConvexOptions)}}}_intersectSphere(Z,_,K,te,ne){const oe=this.from,ie=this.to,se=Z.radius,ae=(ie.x-oe.x)**2+(ie.y-oe.y)**2+(ie.z-oe.z)**2,ge=2*((ie.x-oe.x)*(oe.x-K.x)+(ie.y-oe.y)*(oe.y-K.y)+(ie.z-oe.z)*(oe.z-K.z)),ce=(oe.x-K.x)**2+(oe.y-K.y)**2+(oe.z-K.z)**2-se**2,de=ge**2-4*ae*ce,pe=Ray_intersectSphere_intersectionPoint,fe=Ray_intersectSphere_normal;if(!(de<0))if(de===0)oe.lerp(ie,de,pe),pe.vsub(K,fe),fe.normalize(),this.reportIntersection(fe,pe,ne,te,-1);else{const be=(-ge-Math.sqrt(de))/(2*ae),me=(-ge+Math.sqrt(de))/(2*ae);if(be>=0&&be<=1&&(oe.lerp(ie,be,pe),pe.vsub(K,fe),fe.normalize(),this.reportIntersection(fe,pe,ne,te,-1)),this.result.shouldStop)return;me>=0&&me<=1&&(oe.lerp(ie,me,pe),pe.vsub(K,fe),fe.normalize(),this.reportIntersection(fe,pe,ne,te,-1))}}_intersectConvex(Z,_,K,te,ne,oe){const ie=intersectConvex_normal,se=intersectConvex_vector,ae=oe&&oe.faceList||null,ge=Z.faces,ce=Z.vertices,de=Z.faceNormals,pe=this.direction,fe=this.from,be=this.to,me=fe.distanceTo(be),ye=ae?ae.length:ge.length,ve=this.result;for(let Be=0;!ve.shouldStop&&Be<ye;Be++){const Re=ae?ae[Be]:Be,Ee=ge[Re],We=de[Re],Ze=_,Ve=K;se.copy(ce[Ee[0]]),Ze.vmult(se,se),se.vadd(Ve,se),se.vsub(fe,se),Ze.vmult(We,ie);const _e=pe.dot(ie);if(Math.abs(_e)<this.precision)continue;const Xe=ie.dot(se)/_e;if(!(Xe<0)){pe.scale(Xe,intersectPoint),intersectPoint.vadd(fe,intersectPoint),a.copy(ce[Ee[0]]),Ze.vmult(a,a),Ve.vadd(a,a);for(let Pe=1;!ve.shouldStop&&Pe<Ee.length-1;Pe++){b.copy(ce[Ee[Pe]]),c.copy(ce[Ee[Pe+1]]),Ze.vmult(b,b),Ze.vmult(c,c),Ve.vadd(b,b),Ve.vadd(c,c);const He=intersectPoint.distanceTo(fe);!(Ray.pointInTriangle(intersectPoint,a,b,c)||Ray.pointInTriangle(intersectPoint,b,a,c))||He>me||this.reportIntersection(ie,intersectPoint,ne,te,Re)}}}}_intersectTrimesh(Z,_,K,te,ne,oe){const ie=intersectTrimesh_normal,se=intersectTrimesh_triangles,ae=intersectTrimesh_treeTransform,ge=intersectConvex_vector,ce=intersectTrimesh_localDirection,de=intersectTrimesh_localFrom,pe=intersectTrimesh_localTo,fe=intersectTrimesh_worldIntersectPoint,be=intersectTrimesh_worldNormal,me=Z.indices;Z.vertices;const ye=this.from,ve=this.to,Be=this.direction;ae.position.copy(K),ae.quaternion.copy(_),Transform.vectorToLocalFrame(K,_,Be,ce),Transform.pointToLocalFrame(K,_,ye,de),Transform.pointToLocalFrame(K,_,ve,pe),pe.x*=Z.scale.x,pe.y*=Z.scale.y,pe.z*=Z.scale.z,de.x*=Z.scale.x,de.y*=Z.scale.y,de.z*=Z.scale.z,pe.vsub(de,ce),ce.normalize();const Re=de.distanceSquared(pe);Z.tree.rayQuery(this,ae,se);for(let Ee=0,We=se.length;!this.result.shouldStop&&Ee!==We;Ee++){const Ze=se[Ee];Z.getNormal(Ze,ie),Z.getVertex(me[Ze*3],a),a.vsub(de,ge);const Ve=ce.dot(ie),_e=ie.dot(ge)/Ve;if(_e<0)continue;ce.scale(_e,intersectPoint),intersectPoint.vadd(de,intersectPoint),Z.getVertex(me[Ze*3+1],b),Z.getVertex(me[Ze*3+2],c);const Xe=intersectPoint.distanceSquared(de);!(Ray.pointInTriangle(intersectPoint,b,a,c)||Ray.pointInTriangle(intersectPoint,a,b,c))||Xe>Re||(Transform.vectorToWorldFrame(_,ie,be),Transform.pointToWorldFrame(K,_,intersectPoint,fe),this.reportIntersection(be,fe,ne,te,Ze))}se.length=0}reportIntersection(Z,_,K,te,ne){const oe=this.from,ie=this.to,se=oe.distanceTo(_),ae=this.result;if(!(this.skipBackfaces&&Z.dot(this.direction)>0))switch(ae.hitFaceIndex=typeof ne<"u"?ne:-1,this.mode){case Ray.ALL:this.hasHit=!0,ae.set(oe,ie,Z,_,K,te,se),ae.hasHit=!0,this.callback(ae);break;case Ray.CLOSEST:(se<ae.distance||!ae.hasHit)&&(this.hasHit=!0,ae.hasHit=!0,ae.set(oe,ie,Z,_,K,te,se));break;case Ray.ANY:this.hasHit=!0,ae.hasHit=!0,ae.set(oe,ie,Z,_,K,te,se),ae.shouldStop=!0;break}}static pointInTriangle(Z,_,K,te){te.vsub(_,v0),K.vsub(_,v1),Z.vsub(_,v2);const ne=v0.dot(v0),oe=v0.dot(v1),ie=v0.dot(v2),se=v1.dot(v1),ae=v1.dot(v2);let ge,ce;return(ge=se*ie-oe*ae)>=0&&(ce=ne*ae-oe*ie)>=0&&ge+ce<ne*se-oe*oe}}Ray.CLOSEST=RAY_MODES.CLOSEST;Ray.ANY=RAY_MODES.ANY;Ray.ALL=RAY_MODES.ALL;const tmpAABB$1=new AABB,tmpArray=[],v1=new Vec3,v2=new Vec3,intersectBody_xi=new Vec3,intersectBody_qi=new Quaternion,intersectPoint=new Vec3,a=new Vec3,b=new Vec3,c=new Vec3;new Vec3;new RaycastResult;const intersectConvexOptions={faceList:[0]},worldPillarOffset=new Vec3,intersectHeightfield_localRay=new Ray,intersectHeightfield_index=[],Ray_intersectSphere_intersectionPoint=new Vec3,Ray_intersectSphere_normal=new Vec3,intersectConvex_normal=new Vec3;new Vec3;new Vec3;const intersectConvex_vector=new Vec3,intersectTrimesh_normal=new Vec3,intersectTrimesh_localDirection=new Vec3,intersectTrimesh_localFrom=new Vec3,intersectTrimesh_localTo=new Vec3,intersectTrimesh_worldNormal=new Vec3,intersectTrimesh_worldIntersectPoint=new Vec3;new AABB;const intersectTrimesh_triangles=[],intersectTrimesh_treeTransform=new Transform,v0=new Vec3,intersect=new Vec3;function distanceFromIntersection(X,Z,_){_.vsub(X,v0);const K=v0.dot(Z);return Z.scale(K,intersect),intersect.vadd(X,intersect),_.distanceTo(intersect)}new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Ray;new Vec3;new Vec3;new Vec3;new Vec3(1,0,0),new Vec3(0,1,0),new Vec3(0,0,1);new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new AABB;new Vec3;new AABB;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new AABB;new Vec3;new Transform;new AABB;Shape.types.SPHERE,Shape.types.SPHERE|Shape.types.PLANE,Shape.types.BOX|Shape.types.BOX,Shape.types.SPHERE|Shape.types.BOX,Shape.types.PLANE|Shape.types.BOX,Shape.types.CONVEXPOLYHEDRON,Shape.types.SPHERE|Shape.types.CONVEXPOLYHEDRON,Shape.types.PLANE|Shape.types.CONVEXPOLYHEDRON,Shape.types.BOX|Shape.types.CONVEXPOLYHEDRON,Shape.types.SPHERE|Shape.types.HEIGHTFIELD,Shape.types.BOX|Shape.types.HEIGHTFIELD,Shape.types.CONVEXPOLYHEDRON|Shape.types.HEIGHTFIELD,Shape.types.PARTICLE|Shape.types.SPHERE,Shape.types.PLANE|Shape.types.PARTICLE,Shape.types.BOX|Shape.types.PARTICLE,Shape.types.PARTICLE|Shape.types.CONVEXPOLYHEDRON,Shape.types.CYLINDER,Shape.types.SPHERE|Shape.types.CYLINDER,Shape.types.PLANE|Shape.types.CYLINDER,Shape.types.BOX|Shape.types.CYLINDER,Shape.types.CONVEXPOLYHEDRON|Shape.types.CYLINDER,Shape.types.HEIGHTFIELD|Shape.types.CYLINDER,Shape.types.PARTICLE|Shape.types.CYLINDER,Shape.types.SPHERE|Shape.types.TRIMESH,Shape.types.PLANE|Shape.types.TRIMESH;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Quaternion;new Quaternion;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new AABB;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3,new Vec3,new Vec3,new Vec3,new Vec3,new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Quaternion;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new AABB;new Ray;const performance$2=globalThis.performance||{};if(!performance$2.now){let X=Date.now();performance$2.timing&&performance$2.timing.navigationStart&&(X=performance$2.timing.navigationStart),performance$2.now=()=>Date.now()-X}new Vec3;const debugContext=reactExports.createContext(null),useDebugContext=()=>reactExports.useContext(debugContext),physicsContext=reactExports.createContext(null),usePhysicsContext=()=>{const X=reactExports.useContext(physicsContext);if(!X)throw new Error("Physics context not found. @react-three/cannon & components can only be used within a Physics provider");return X};new Vector3(1,1,1);new Vector3;new Matrix4;const temp=new Object3D;function useForwardedRef(X){const Z=reactExports.useRef(null);return X&&typeof X!="function"?X:Z}function capitalize(X){return X.charAt(0).toUpperCase()+X.slice(1)}function getUUID(X,Z){const _=Z===void 0?"":`/${Z}`;return typeof X=="function"?null:X&&X.current&&`${X.current.uuid}${_}`}const e=new Euler,q$1=new Quaternion$2,quaternionToRotation=X=>Z=>X(e.setFromQuaternion(q$1.fromArray(Z)).toArray());let incrementingId=0;function subscribe(X,Z,_,K,te,ne){return ne===void 0&&(ne="bodies"),oe=>{const ie=incrementingId++;_[ie]={[K]:oe};const se=getUUID(X,te);return se&&Z.subscribe({props:{id:ie,target:ne,type:K},uuid:se}),()=>{delete _[ie],Z.unsubscribe({props:ie})}}}function prepare(X,Z){let{position:_=[0,0,0],rotation:K=[0,0,0],userData:te={}}=Z;X.userData=te,X.position.set(..._),X.rotation.set(...K),X.updateMatrix()}function setupCollision(X,Z,_){let{onCollide:K,onCollideBegin:te,onCollideEnd:ne}=Z;X[_]={collide:K,collideBegin:te,collideEnd:ne}}function useBody(X,Z,_,K,te){K===void 0&&(K=null),te===void 0&&(te=[]);const ne=useForwardedRef(K),{events:oe,refs:ie,scaleOverrides:se,subscriptions:ae,worker:ge}=usePhysicsContext(),ce=useDebugContext();reactExports.useLayoutEffect(()=>{ne.current||(ne.current=new Object3D);const pe=ne.current,fe=ge,be=pe instanceof InstancedMesh?(pe.instanceMatrix.setUsage(DynamicDrawUsage),pe.count):1,me=pe instanceof InstancedMesh?new Array(be).fill(0).map((ve,Be)=>`${pe.uuid}/${Be}`):[pe.uuid],ye=pe instanceof InstancedMesh?me.map((ve,Be)=>{const Re=Z(Be);return prepare(temp,Re),pe.setMatrixAt(Be,temp.matrix),pe.instanceMatrix.needsUpdate=!0,ie[ve]=pe,ce==null||ce.add(ve,Re,X),setupCollision(oe,Re,ve),{...Re,args:_(Re.args)}}):me.map((ve,Be)=>{const Re=Z(Be);return prepare(pe,Re),ie[ve]=pe,ce==null||ce.add(ve,Re,X),setupCollision(oe,Re,ve),{...Re,args:_(Re.args)}});return fe.addBodies({props:ye.map(ve=>{let{onCollide:Be,onCollideBegin:Re,onCollideEnd:Ee,...We}=ve;return{onCollide:!!Be,...We}}),type:X,uuid:me}),()=>{me.forEach(ve=>{delete ie[ve],ce==null||ce.remove(ve),delete oe[ve]}),fe.removeBodies({uuid:me})}},te);const de=reactExports.useMemo(()=>{const pe=(Be,Re)=>{const Ee=`set${capitalize(Be)}`;return{set:We=>{const Ze=getUUID(ne,Re);Ze&&ge[Ee]({props:We,uuid:Ze})},subscribe:subscribe(ne,ge,ae,Be,Re)}},fe=Be=>({copy:Ee=>{let{w:We,x:Ze,y:Ve,z:_e}=Ee;const Xe=getUUID(ne,Be);Xe&&ge.setQuaternion({props:[Ze,Ve,_e,We],uuid:Xe})},set:(Ee,We,Ze,Ve)=>{const _e=getUUID(ne,Be);_e&&ge.setQuaternion({props:[Ee,We,Ze,Ve],uuid:_e})},subscribe:subscribe(ne,ge,ae,"quaternion",Be)}),be=Be=>({copy:Re=>{let{x:Ee,y:We,z:Ze}=Re;const Ve=getUUID(ne,Be);Ve&&ge.setRotation({props:[Ee,We,Ze],uuid:Ve})},set:(Re,Ee,We)=>{const Ze=getUUID(ne,Be);Ze&&ge.setRotation({props:[Re,Ee,We],uuid:Ze})},subscribe:Re=>{const Ee=incrementingId++,We="bodies",Ze="quaternion",Ve=getUUID(ne,Be);return ae[Ee]={[Ze]:quaternionToRotation(Re)},Ve&&ge.subscribe({props:{id:Ee,target:We,type:Ze},uuid:Ve}),()=>{delete ae[Ee],ge.unsubscribe({props:Ee})}}}),me=(Be,Re)=>{const Ee=`set${capitalize(Be)}`;return{copy:We=>{let{x:Ze,y:Ve,z:_e}=We;const Xe=getUUID(ne,Re);Xe&&ge[Ee]({props:[Ze,Ve,_e],uuid:Xe})},set:(We,Ze,Ve)=>{const _e=getUUID(ne,Re);_e&&ge[Ee]({props:[We,Ze,Ve],uuid:_e})},subscribe:subscribe(ne,ge,ae,Be,Re)}};function ye(Be){return{allowSleep:pe("allowSleep",Be),angularDamping:pe("angularDamping",Be),angularFactor:me("angularFactor",Be),angularVelocity:me("angularVelocity",Be),applyForce(Re,Ee){const We=getUUID(ne,Be);We&&ge.applyForce({props:[Re,Ee],uuid:We})},applyImpulse(Re,Ee){const We=getUUID(ne,Be);We&&ge.applyImpulse({props:[Re,Ee],uuid:We})},applyLocalForce(Re,Ee){const We=getUUID(ne,Be);We&&ge.applyLocalForce({props:[Re,Ee],uuid:We})},applyLocalImpulse(Re,Ee){const We=getUUID(ne,Be);We&&ge.applyLocalImpulse({props:[Re,Ee],uuid:We})},applyTorque(Re){const Ee=getUUID(ne,Be);Ee&&ge.applyTorque({props:[Re],uuid:Ee})},collisionFilterGroup:pe("collisionFilterGroup",Be),collisionFilterMask:pe("collisionFilterMask",Be),collisionResponse:pe("collisionResponse",Be),fixedRotation:pe("fixedRotation",Be),isTrigger:pe("isTrigger",Be),linearDamping:pe("linearDamping",Be),linearFactor:me("linearFactor",Be),mass:pe("mass",Be),material:pe("material",Be),position:me("position",Be),quaternion:fe(Be),rotation:be(Be),scaleOverride(Re){const Ee=getUUID(ne,Be);Ee&&(se[Ee]=new Vector3(...Re))},sleep(){const Re=getUUID(ne,Be);Re&&ge.sleep({uuid:Re})},sleepSpeedLimit:pe("sleepSpeedLimit",Be),sleepTimeLimit:pe("sleepTimeLimit",Be),userData:pe("userData",Be),velocity:me("velocity",Be),wakeUp(){const Re=getUUID(ne,Be);Re&&ge.wakeUp({uuid:Re})}}}const ve={};return{...ye(void 0),at:Be=>ve[Be]||(ve[Be]=ye(Be))}},[]);return[ne,de]}function usePlane(X,Z,_){return useBody("Plane",X,()=>[],Z,_)}function useBox(X,Z,_){const K=[1,1,1];return useBody("Box",X,function(te){return te===void 0&&(te=K),te},Z,_)}const v=new Vector3,s=new Vector3(1,1,1),q=new Quaternion$2,m=new Matrix4;function apply(X,Z,_,K,te){return K===void 0&&(K=s),X!==void 0?(m.compose(v.fromArray(Z,X*3),q.fromArray(_,X*4),K),te&&(te.matrixAutoUpdate=!1,te.matrix.copy(m)),m):m.identity()}const unique=()=>{const X=[];return Z=>X.includes(Z)?!1:!!X.push(Z)};function PhysicsProvider(X){let{allowSleep:Z=!1,axisIndex:_=0,broadphase:K="Naive",children:te,defaultContactMaterial:ne={contactEquationStiffness:1e6},frictionGravity:oe=null,gravity:ie=[0,-9.81,0],isPaused:se=!1,iterations:ae=5,maxSubSteps:ge=10,quatNormalizeFast:ce=!1,quatNormalizeSkip:de=0,shouldInvalidate:pe=!0,size:fe=1e3,solver:be="GS",stepSize:me=1/60,tolerance:ye=.001}=X;const{invalidate:ve}=useThree(),[{bodies:Be,events:Re,refs:Ee,scaleOverrides:We,subscriptions:Ze,worker:Ve}]=reactExports.useState(()=>({bodies:{},events:{},refs:{},scaleOverrides:{},subscriptions:{},worker:new CannonWorkerAPI({allowSleep:Z,axisIndex:_,broadphase:K,defaultContactMaterial:ne,frictionGravity:oe,gravity:ie,iterations:ae,quatNormalizeFast:ce,quatNormalizeSkip:de,size:fe,solver:be,tolerance:ye})}));let _e=0;const Xe=reactExports.useCallback((at,Oe)=>{se||(_e+=Oe,Ve.step({maxSubSteps:ge,stepSize:me,timeSinceLastCalled:_e}),_e=0)},[se,ge,me]),Pe=at=>{var Oe;let{body:$e,contact:{bi:je,bj:Te,...De},target:ot,...ct}=at;const gt=(Oe=Re[ot])==null?void 0:Oe.collide;gt&&gt({body:Ee[$e],contact:{bi:Ee[je],bj:Ee[Te],...De},target:Ee[ot],...ct})},He=at=>{var Oe,$e;let{bodyA:je,bodyB:Te}=at;const De=(Oe=Re[je])==null?void 0:Oe.collideBegin;De&&De({body:Ee[Te],op:"event",target:Ee[je],type:"collideBegin"});const ot=($e=Re[Te])==null?void 0:$e.collideBegin;ot&&ot({body:Ee[je],op:"event",target:Ee[Te],type:"collideBegin"})},Ke=at=>{var Oe,$e;let{bodyA:je,bodyB:Te}=at;const De=(Oe=Re[je])==null?void 0:Oe.collideEnd;De&&De({body:Ee[Te],op:"event",target:Ee[je],type:"collideEnd"});const ot=($e=Re[Te])==null?void 0:$e.collideEnd;ot&&ot({body:Ee[je],op:"event",target:Ee[Te],type:"collideEnd"})},Ue=at=>{let{active:Oe,bodies:$e=[],observations:je,positions:Te,quaternions:De}=at;for(let ot=0;ot<$e.length;ot++)Be[$e[ot]]=ot;if(je.forEach(ot=>{let[ct,gt,pt]=ot;const At=(Ze[ct]||{})[pt];At&&At(gt)}),!!Oe){for(const ot of Object.values(Ee).filter(unique()))if(ot instanceof InstancedMesh)for(let ct=0;ct<ot.count;ct++){const gt=`${ot.uuid}/${ct}`,pt=Be[gt];pt!==void 0&&(ot.setMatrixAt(ct,apply(pt,Te,De,We[gt])),ot.instanceMatrix.needsUpdate=!0)}else{const ct=We[ot.uuid]||ot.scale;apply(Be[ot.uuid],Te,De,ct,ot)}pe&&ve()}},tt=at=>{var Oe;let{body:$e,ray:{uuid:je,...Te},...De}=at;const ot=(Oe=Re[je])==null?void 0:Oe.rayhit;ot&&ot({body:$e?Ee[$e]:null,ray:{uuid:je,...Te},...De})};useFrame(Xe),reactExports.useEffect(()=>(Ve.connect(),Ve.init(),Ve.on("collide",Pe),Ve.on("collideBegin",He),Ve.on("collideEnd",Ke),Ve.on("frame",Ue),Ve.on("rayhit",tt),()=>{Ve.terminate(),Ve.removeAllListeners()}),[]),reactExports.useEffect(()=>{Ve.axisIndex=_},[_]),reactExports.useEffect(()=>{Ve.broadphase=K},[K]),reactExports.useEffect(()=>{Ve.gravity=ie},[ie]),reactExports.useEffect(()=>{Ve.iterations=ae},[ae]),reactExports.useEffect(()=>{Ve.tolerance=ye},[ye]);const rt=reactExports.useMemo(()=>({bodies:Be,events:Re,refs:Ee,scaleOverrides:We,subscriptions:Ze,worker:Ve}),[Be,Re,Ee,Ze,Ve]);return jsxRuntimeExports.jsx(physicsContext.Provider,{value:rt,children:te})}function Floor({...X}){const[Z,_]=reactExports.useState(1);reactExports.useEffect(()=>{const pe=fe=>{setTimeout(()=>{_(fe.detail)},100)};return window.addEventListener("avatar-type-change",pe),()=>{window.removeEventListener("avatar-type-change",pe)}},[]);const K={1:"#4a4a4a",2:"#3b4a3b",3:"#3b424a",4:"#4a463b"},te={1:{metalness:.2,roughness:.8,envMapIntensity:1},2:{metalness:.3,roughness:.7,envMapIntensity:1.2},3:{metalness:.25,roughness:.75,envMapIntensity:1.1},4:{metalness:.35,roughness:.65,envMapIntensity:1.3}},[ne]=usePlane(()=>({rotation:[-Math.PI/2,0,0],position:[0,-.05,0],...X})),[oe,ie,se,ae,ge]=useTexture(["/textures/floorTextures/Poliigon_WoodVeneerOak_7760_BaseColor.jpg","/textures/floorTextures/Poliigon_WoodVeneerOak_7760_Displacement.jpg","/textures/floorTextures/Poliigon_WoodVeneerOak_7760_Metallic.jpg","/textures/floorTextures/Poliigon_WoodVeneerOak_7760_Normal.png","/textures/floorTextures/Poliigon_WoodVeneerOak_7760_Roughness.jpg"]),ce=K[Z]||K[1],de=te[Z]||te[1];return jsxRuntimeExports.jsxs("mesh",{ref:ne,receiveShadow:!0,children:[jsxRuntimeExports.jsx("planeGeometry",{args:[10,10]}),jsxRuntimeExports.jsx("meshStandardMaterial",{color:ce,map:oe,displacementMap:ie,displacementScale:.1,normalMap:ae,roughnessMap:ge,metalnessMap:se,metalness:de.metalness,roughness:de.roughness,envMapIntensity:de.envMapIntensity})]})}function Wall({name:X,initialPosition:Z=[0,0,0],initialSize:_=[1,1,1],...K}){const[te,ne]=reactExports.useState(1),oe=useControls(X||"Wall",{position:{value:Z,label:"Position"},size:{value:_,label:"Size"},visible:{value:!0,label:"Visible"}});reactExports.useEffect(()=>{const be=me=>{setTimeout(()=>{ne(me.detail)},100)};return window.addEventListener("avatar-type-change",be),()=>{window.removeEventListener("avatar-type-change",be)}},[]);const ie={1:"#e0e0e0",2:"#c8e6c9",3:"#bbdefb",4:"#ffecb3"},[se,ae,ge,ce,de]=useTexture(["/textures/walltextures/Poliigon_BrickWallReclaimed_8320_BaseColor.jpg","/textures/walltextures/Poliigon_BrickWallReclaimed_8320_Displacement.jpg","/textures/walltextures/Poliigon_BrickWallReclaimed_8320_Metallic.jpg","/textures/walltextures/Poliigon_BrickWallReclaimed_8320_Normal.png","/textures/walltextures/Poliigon_BrickWallReclaimed_8320_Roughness.jpg"]),[pe]=useBox(()=>({type:"Static",args:oe.size,position:oe.position,material:{friction:.5},...K}));if(!oe.visible)return null;const fe=ie[te]||ie[1];return jsxRuntimeExports.jsxs("mesh",{ref:pe,receiveShadow:!0,children:[jsxRuntimeExports.jsx("boxGeometry",{args:oe.size}),jsxRuntimeExports.jsx("meshStandardMaterial",{color:fe,map:se,displacementMap:ae,displacementScale:.1,normalMap:ce,roughnessMap:de,metalnessMap:ge,metalness:te>1?.3:.1,roughness:te>1?.6:.8,envMapIntensity:te>1?1.2:.8})]})}function Tv(){const{scene:X}=useGLTF("./models/Tv.glb"),Z=reactExports.useRef(),_=reactExports.useRef(),K=reactExports.useRef(),{position:te,rotation:ne,scale:oe}=useControls("TV",{position:{value:[3,2,-4.8],step:.1},rotation:{value:[0,Math.PI*1.5,0],step:.01},scale:{value:1.2,min:.1,max:5,step:.1}});useControls("TV Screen Debug",{visible:{value:!0,onChange:se=>{K.current&&(K.current.visible=se)}},rotateUV:{value:Math.PI/2,min:0,max:Math.PI*2,step:.1,onChange:se=>{K.current&&K.current.map&&(K.current.map.rotation=se,K.current.map.needsUpdate=!0)}},flipX:{value:!0,onChange:se=>{K.current&&K.current.map&&(K.current.map.repeat.x=se?-1:1,K.current.map.offset.x=se?1:0,K.current.map.needsUpdate=!0)}},flipY:{value:!0,onChange:se=>{K.current&&K.current.map&&(K.current.map.repeat.y=se?-1:1,K.current.map.needsUpdate=!0)}},offsetX:{value:0,min:-1,max:1,step:.1,onChange:se=>{K.current&&K.current.map&&(K.current.map.offset.x=se,K.current.map.needsUpdate=!0)}},offsetY:{value:1,min:-1,max:1,step:.1,onChange:se=>{K.current&&K.current.map&&(K.current.map.offset.y=se,K.current.map.needsUpdate=!0)}}});const[ie]=useBox(()=>({type:"Static",args:[1.5,.5,.1],position:[0,.5,-2],material:{friction:.5}}));return reactExports.useEffect(()=>{const se=setTimeout(()=>{const ae=X.getObjectByName("Ekran");if(!ae){console.error('Could not find TV screen mesh named "Ekran"');return}const ge=document.createElement("video");ge.src="/videos/logo_film.mp4",ge.crossOrigin="anonymous",ge.loop=!0,ge.muted=!0,ge.playsInline=!0,ge.preload="auto";const ce=new VideoTexture(ge);ce.minFilter=LinearFilter,ce.magFilter=LinearFilter,ce.format=void 0,ce.generateMipmaps=!1,ce.repeat.x=-1,ce.offset.x=1,ce.wrapS=RepeatWrapping;const de=new MeshBasicMaterial({map:ce,side:DoubleSide,toneMapped:!1});ae.material=de,K.current=de;const pe=()=>{ge.play().catch(fe=>{})};ge.readyState>=3?pe():ge.addEventListener("loadeddata",pe,{once:!0}),_.current=ge},5e3);return()=>{var ae;clearTimeout(se),_.current&&(_.current.pause(),_.current.src="",_.current.load(),_.current.remove(),K.current&&((ae=K.current.map)==null||ae.dispose(),K.current.dispose()))}},[X]),reactExports.useEffect(()=>{const se=()=>{var ae,ge;document.hidden?(ae=_.current)==null||ae.pause():(ge=_.current)==null||ge.play().catch(console.error)};return document.addEventListener("visibilitychange",se),()=>{document.removeEventListener("visibilitychange",se)}},[]),jsxRuntimeExports.jsxs("group",{ref:Z,position:te,rotation:new Euler(ne[0],ne[1],ne[2]),scale:oe,children:[jsxRuntimeExports.jsx("primitive",{object:X}),jsxRuntimeExports.jsx("mesh",{ref:ie,castShadow:!0,receiveShadow:!0})]})}useGLTF.preload("./models/Tv.glb");function Zegar(){const{scene:X}=useGLTF("./models/Zegar.glb",{draco:!0,meshOptimizer:!0}),Z=reactExports.useRef(),_=reactExports.useRef(),K=reactExports.useRef(),te=reactExports.useCallback(()=>{try{Z.current=X.getObjectByName("sekundy"),_.current=X.getObjectByName("Minuty"),K.current=X.getObjectByName("Godziny"),Z.current&&(Z.current.visible=!0,Z.current.renderOrder=1)}catch(ae){console.error("Error initializing clock hands:",ae)}},[X]);reactExports.useEffect(()=>(te(),()=>{Z.current=null,_.current=null,K.current=null}),[te]);const ne=reactExports.useCallback(()=>{const ae=new Date,ge=ae.getSeconds(),ce=ae.getMinutes(),de=ae.getHours(),pe=ge/60*360,fe=(ce+ge/60)/60*360,be=(de%12+ce/60)/12*360,me=ye=>ye*(-Math.PI/180);Z.current&&(Z.current.rotation.x=me(pe),Z.current.visible=!0),_.current&&(_.current.rotation.x=me(fe)),K.current&&(K.current.rotation.x=me(be))},[]);useFrame(ne);const{position:oe,rotationY:ie,scale:se}=useControls("Zegar",{position:{value:[-2,2,-5],step:.1},rotationY:{value:272,min:0,max:360,step:1},scale:{value:2.4,min:.1,max:5,step:.1}});return jsxRuntimeExports.jsx(reactExports.Suspense,{fallback:null,children:jsxRuntimeExports.jsx("primitive",{object:X,position:oe,rotation:[0,MathUtils.degToRad(ie),0],scale:se,castShadow:!0,receiveShadow:!0})})}useGLTF.preload("./models/Zegar.glb",{draco:!0,meshOptimizer:!0});function ReceptionDesk({currentAction:X,position:Z,rotation:_,scale:K}){const[te,ne]=reactExports.useState(1),{scene:oe}=useGLTF("./models/resize_reception.glb",{draco:!0,meshOptimizer:!0});reactExports.useEffect(()=>{const se=ae=>{setTimeout(()=>{ne(ae.detail)},100)};return window.addEventListener("avatar-type-change",se),()=>{window.removeEventListener("avatar-type-change",se)}},[]);const ie=reactExports.useMemo(()=>{const se=SkeletonUtils.clone(oe),ae={1:new Color$1("#FFFFFF"),2:new Color$1("#FFD700"),3:new Color$1("#C0C0C0"),4:new Color$1("#CD7F32")},ge=ae[te]||ae[1];return se.traverse(ce=>{ce.isMesh&&ce.name==="Cube008"&&ce.material&&(ce.material=ce.material.clone(),ce.material.color.copy(ge),te>1?(ce.material.metalness=.8,ce.material.roughness=.2):(ce.material.metalness=0,ce.material.roughness=.5))}),se},[oe,te]);return jsxRuntimeExports.jsx("group",{position:Z,rotation:_,scale:K,children:jsxRuntimeExports.jsx("primitive",{object:ie,position:[0,0,.7]})})}useGLTF.preload("./models/resize_reception.glb",{draco:!0,meshOptimizer:!0});function Vase({currentAction:X}){const{position:Z,rotation:_,scale:K}=useControls("Vase",{position:{value:[1.2,.95,.7],step:.1},rotation:{value:[0,Math.PI/4,0],step:.01},scale:{value:.4,min:.1,max:5,step:.1}}),{scene:te}=useGLTF("./models/vase1.glb",{draco:!0,meshOptimizer:!0}),ne=reactExports.useMemo(()=>SkeletonUtils.clone(te),[te]),[oe]=useBox(()=>({type:"Static",args:[.3,.5,.3],position:[1.5,.25,1.5],material:{friction:.5}}));return jsxRuntimeExports.jsxs("group",{children:[jsxRuntimeExports.jsx("primitive",{object:ne,position:Z,scale:K,rotation:_}),jsxRuntimeExports.jsx("mesh",{ref:oe,castShadow:!0,receiveShadow:!0})]})}useGLTF.preload("./models/vase1.glb",{draco:!0,meshOptimizer:!0});function Chair({currentAction:X}){const{position:Z,rotation:_,scale:K}=useControls("Chair",{position:{value:[3.1,0,-.7],step:.1},rotation:{value:[0,-Math.PI/4.5,0],step:.01},scale:{value:1,min:.1,max:5,step:.1}}),{scene:te}=useGLTF("./models/resized_chair.glb",{draco:!0,meshOptimizer:!0}),ne=reactExports.useMemo(()=>SkeletonUtils.clone(te),[te]),[oe]=useBox(()=>({type:"Static",args:[.5,1,.5],position:Z,material:{friction:.5}}));return reactExports.useEffect(()=>{oe.current&&oe.current.position.set(...Z)},[Z,oe]),jsxRuntimeExports.jsxs("group",{children:[jsxRuntimeExports.jsx("primitive",{object:ne,position:Z,scale:K,rotation:_}),jsxRuntimeExports.jsx("mesh",{ref:oe,castShadow:!0,receiveShadow:!0})]})}useGLTF.preload("./models/resized_chair.glb",{draco:!0,meshOptimizer:!0});function CoffeeTable(){const{position:X,rotation:Z,scale:_}=useControls("Coffee Table",{position:{value:[2.4,0,.4],step:.1},rotation:{value:[0,Math.PI/2,0],step:.01},scale:{value:1.2,min:.1,max:2,step:.1}}),{scene:K}=useGLTF("./models/coffee_table.glb",{draco:!0,meshOptimizer:!0}),te=reactExports.useMemo(()=>SkeletonUtils.clone(K),[K]),[ne]=useBox(()=>({type:"Static",args:[1.5,.5,1.5],position:[0,.25,0],material:{friction:.5}}));return jsxRuntimeExports.jsxs("group",{children:[jsxRuntimeExports.jsx("primitive",{object:te,position:X,rotation:Z,scale:_}),jsxRuntimeExports.jsx("mesh",{ref:ne,castShadow:!0,receiveShadow:!0})]})}useGLTF.preload("./models/coffee_table.glb",{draco:!0,meshOptimizer:!0});function LoadingSpinner({progress:X}){const[Z,_]=reactExports.useState(0);return reactExports.useEffect(()=>{const K=setInterval(()=>{_(te=>te>=X?te:Math.min(te+1,X))},50);return()=>clearInterval(K)},[X]),jsxRuntimeExports.jsxs("div",{className:"loading-container",children:[jsxRuntimeExports.jsx("div",{className:"spinner"}),jsxRuntimeExports.jsx("div",{className:"progress-bar",children:jsxRuntimeExports.jsx("div",{className:"progress-fill",style:{width:`${Z}%`}})}),jsxRuntimeExports.jsxs("div",{className:"progress-text",children:[Z,"%"]})]})}function ChairOffice(X){const{position:Z,rotation:_,scale:K}=useControls("ChairOffice",{position:{value:[3,.07,-1],step:.1},rotation:{value:[0,-Math.PI/2.2,0],step:.01},scale:{value:.3,min:.1,max:2,step:.1}}),{scene:te}=useGLTF("/models/office_chair.glb",{draco:!0,meshOptimizer:!0}),ne=reactExports.useMemo(()=>SkeletonUtils.clone(te),[te]),[oe]=useBox(()=>({type:"Static",args:[.6,1.2,.6],position:Z,rotation:_,material:{friction:.2}}));return jsxRuntimeExports.jsxs("group",{...X,children:[jsxRuntimeExports.jsx("primitive",{object:ne,position:Z,scale:K,rotation:_,castShadow:!0,receiveShadow:!0}),jsxRuntimeExports.jsx("mesh",{ref:oe,visible:!1})]})}useGLTF.preload("/models/office_chair.glb",{draco:!0,meshOptimizer:!0});function Ceiling(){const[X,Z]=reactExports.useState(1);reactExports.useEffect(()=>{const pe=fe=>{setTimeout(()=>{Z(fe.detail)},100)};return window.addEventListener("avatar-type-change",pe),()=>{window.removeEventListener("avatar-type-change",pe)}},[]);const _={1:"#606060",2:"#7AACFF",3:"#C5FF7A",4:"#F76155"},[K,te,ne,oe,ie,se,ae]=useTexture(["/textures/ceilingTextures/brown_planks_03_ao_1k.jpg","/textures/ceilingTextures/brown_planks_03_rough_1k.jpg","/textures/ceilingTextures/brown_planks_03_ao_1k.jpg","/textures/ceilingTextures/brown_planks_03_arm_1k.jpg","/textures/ceilingTextures/brown_planks_03_disp_1k.png","/textures/ceilingTextures/brown_planks_03_nor_dx_1k.jpg","/textures/ceilingTextures/brown_planks_03_nor_gl_1k.jpg"]),ge={1:{metalness:.8,roughness:.8,envMapIntensity:.3,aoMapIntensity:.3,displacementScale:-.1},2:{metalness:.8,roughness:.6,envMapIntensity:1.2,aoMapIntensity:.8,displacementScale:-.1},3:{metalness:.15,roughness:.65,envMapIntensity:1.1,aoMapIntensity:.9,displacementScale:-.1},4:{metalness:.25,roughness:.55,envMapIntensity:1.3,aoMapIntensity:.7,displacementScale:-.1}},ce=_[X]||_[1],de=ge[X]||ge[1];return jsxRuntimeExports.jsxs("group",{position:[0,4.02,0],children:[jsxRuntimeExports.jsxs("mesh",{receiveShadow:!0,children:[jsxRuntimeExports.jsx("boxGeometry",{args:[10,.2,10]}),jsxRuntimeExports.jsx("meshStandardMaterial",{color:ce,map:K,roughnessMap:te,aoMap:ne,metalnessMap:oe,displacementMap:ie,normalMap:se,metalness:de.metalness,roughness:de.roughness,envMapIntensity:de.envMapIntensity,aoMapIntensity:de.aoMapIntensity,displacementScale:de.displacementScale})]}),jsxRuntimeExports.jsx("group",{position:[0,-.1,0],children:reactExports.useMemo(()=>{const pe=[];for(let ye=-2/2;ye<=2/2;ye++)for(let ve=-2/2;ve<=2/2;ve++)pe.push(jsxRuntimeExports.jsxs("mesh",{position:[ye*2,0,ve*2],children:[jsxRuntimeExports.jsx("boxGeometry",{args:[3.5,.1,1.2]}),jsxRuntimeExports.jsx("meshStandardMaterial",{color:"#ffffff",emissive:"#ffffff",emissiveIntensity:1.5,metalness:1,roughness:.8,envMapIntensity:de.envMapIntensity})]},`light-${ye}-${ve}`));return pe},[X,ce,de])})]})}const LABELS$1={1:"TRANSFORMACJA ENERGETYCZNA FIRM",2:"HUB ENERGETYCZNY I WODOROWY",3:"POPRAWA EFEKTYWNOŚCI OZE",4:"CZYSTE POWIETRZE"};function Sign({activeScene:X}){const{position:Z,scale:_,color:K}=useControls("Sign",{position:{value:[0,3.5,-4.8],step:.1},scale:{value:1,min:.5,max:3},color:{value:"#ffffff"}});return React.useLayoutEffect(()=>{},[X]),jsxRuntimeExports.jsx(Text,{position:Z,rotation:[Math.PI,Math.PI,Math.PI],fontSize:.4,color:K,anchorX:"center",anchorY:"middle",scale:_,children:LABELS$1[X]||`Scena ${X}`},`text-${X}`)}function PlantOne(X){const{position:Z,rotation:_,scale:K}=useControls("PlantOne",{position:{value:[-2.1,.01,-.2],step:.1},rotation:{value:[0,-Math.PI/4,0],step:.01},scale:{value:.02,min:1e-4,max:2,step:.1}}),{scene:te}=useGLTF("/plants/plants_one.glb",{draco:!0,meshOptimizer:!0}),ne=reactExports.useMemo(()=>SkeletonUtils.clone(te),[te]),[oe]=useBox(()=>({type:"Static",args:[.5,1,.5],position:[1.5,.5,-1.8],material:{friction:.3}}));return jsxRuntimeExports.jsxs("group",{...X,children:[jsxRuntimeExports.jsx("primitive",{object:ne,position:Z,scale:K,rotation:_,castShadow:!0,receiveShadow:!0}),jsxRuntimeExports.jsx("mesh",{ref:oe,visible:!1})]})}useGLTF.preload("/plants/plants_one.glb",{draco:!0,meshOptimizer:!0});function RollUpDisplay(X){const{position:Z,rotation:_,scale:K}=useControls("RollUpDisplay",{position:{value:[-5,0,4],step:.1},rotation:{value:[0,-Math.PI/1.7,0],step:.01},scale:{value:5,min:.1,max:10,step:.1}}),{scene:te}=useGLTF("/models/roll-up_display.glb",{draco:!0,meshOptimizer:!0}),ne=reactExports.useMemo(()=>SkeletonUtils.clone(te),[te]),[oe]=useBox(()=>({type:"Static",args:[1,2,.1],position:[1.5,1,2.5],material:{friction:.1}}));return jsxRuntimeExports.jsxs("group",{...X,children:[jsxRuntimeExports.jsx("primitive",{object:ne,position:Z,scale:K,rotation:_,castShadow:!0,receiveShadow:!0}),jsxRuntimeExports.jsx("mesh",{ref:oe,visible:!1})]})}useGLTF.preload("/models/roll-up_display.glb",{draco:!0,meshOptimizer:!0});function OfficeCabinet(X){const{position:Z,rotation:_,scale:K}=useControls("OfficeCabinet",{position:{value:[2.4,1.17,-.5],step:.1},rotation:{value:[0,Math.PI,0],step:.01},scale:{value:.2,min:0,max:2,step:.1}}),{scene:te}=useGLTF("/models/file_cabinet.glb",{draco:!0,meshOptimizer:!0}),ne=reactExports.useMemo(()=>SkeletonUtils.clone(te),[te]),[oe]=useBox(()=>({type:"Static",args:[1,1,1],position:Z,rotation:_,material:{friction:.5}}));return jsxRuntimeExports.jsxs("group",{...X,children:[jsxRuntimeExports.jsx("primitive",{object:ne,position:Z,scale:K,rotation:_,castShadow:!0,receiveShadow:!0}),jsxRuntimeExports.jsx("mesh",{ref:oe,visible:!1})]})}useGLTF.preload("/models/file_cabinet.glb");const MobileNotification=()=>jsxRuntimeExports.jsx("div",{className:"mobile-notification",style:{position:"fixed",top:0,left:0,width:"100%",height:"100%",display:"flex",justifyContent:"center",alignItems:"center",backgroundColor:"rgba(0, 0, 0, 0.9)",zIndex:9999,color:"white",textAlign:"center"},children:jsxRuntimeExports.jsxs("div",{className:"notification-content",style:{padding:"30px",backgroundColor:"rgba(33, 150, 243, 0.8)",borderRadius:"10px",maxWidth:"80%"},children:[jsxRuntimeExports.jsx("h2",{style:{marginBottom:"15px",fontSize:"24px"},children:"Trwają prace nad wersją mobilną"}),jsxRuntimeExports.jsx("p",{style:{marginBottom:"10px",fontSize:"16px"},children:"Aplikacja jest obecnie dostępna na laptopach oraz wszystkich większych ekranach."}),jsxRuntimeExports.jsx("p",{style:{fontSize:"16px"},children:"Zapraszamy do korzystania z wersji pełnoekranowej."})]})}),AVATAR_IDS={1:"fe2da934-6aa4-11ef-8fba-42010a7be011",2:"881e4aac-50d5-11ef-9461-42010a7be011",3:"9ff38f44-437d-11ef-9187-42010a7be011",4:"2734589a-ef8f-11ef-9966-42010a7be016"},LABELS={1:"ENERGY TRANSFORMATION OF COMPANIES",2:"ENERGY AND HYDROGEN HUB",3:"IMPROVEMENT OF RENEWABLE ENERGY EFFICIENCY",4:"CLEAN AIR"};class Scene3DErrorBoundary extends reactExports.Component{constructor(Z){super(Z),this.state={hasError:!1,errorDetails:null}}static getDerivedStateFromError(Z){return{hasError:!0}}componentDidCatch(Z,_){console.error("3D Scene Error:",Z,_),this.setState({errorDetails:Z.message})}render(){return this.state.hasError?jsxRuntimeExports.jsxs("div",{className:"error-container",children:[jsxRuntimeExports.jsx("h2",{children:"Error loading 3D scene"}),jsxRuntimeExports.jsx("p",{children:this.state.errorDetails}),jsxRuntimeExports.jsx("button",{onClick:()=>window.location.reload(),children:"Reload Application"})]}):this.props.children}}const Scene=({activeScene:X,isAvatarLoaded:Z,onAvatarLoaded:_,currentAction:K,selectedAvatar:te,isLoading:ne,forceUpdate:oe,avatars:ie,visibleAvatar:se,onAvatarReady:ae})=>jsxRuntimeExports.jsx(Canvas$1,{shadows:!0,style:{background:"#646464"},camera:{position:[0,1,3],fov:75,rotation:[0,Math.PI,0]},onCreated:({gl:ge,camera:ce})=>{ge.domElement.style.touchAction="none",ce.lookAt(0,0,0)},children:jsxRuntimeExports.jsxs(PhysicsProvider,{gravity:[0,-9.81,0],children:[jsxRuntimeExports.jsx(Leva,{hidden:!0}),jsxRuntimeExports.jsx(Environment,{preset:"night",background:!0,blur:.5,resolution:512,backgroundIntensity:1.5,environmentIntensity:1.5}),jsxRuntimeExports.jsxs(PresentationControls,{global:!0,position:[0,-.5,0],rotation:[0,0,0],polar:[-.2,.2],azimuth:[-.3,.3],config:{mass:2,tension:400},snap:{mass:3,tension:200},speed:1.5,zoom:1,children:[jsxRuntimeExports.jsx("ambientLight",{intensity:2,color:"#ffffff"}),jsxRuntimeExports.jsx("directionalLight",{position:[15,15,15],intensity:2,castShadow:!0,"shadow-mapSize":[4096,4096],"shadow-camera-far":100,"shadow-camera-left":-30,"shadow-camera-right":30,"shadow-camera-top":30,"shadow-camera-bottom":-30}),jsxRuntimeExports.jsx("pointLight",{position:[-15,10,-15],intensity:1.2,color:"#ffeedd",decay:.5}),jsxRuntimeExports.jsx("hemisphereLight",{intensity:.5,color:"#ffffff",groundColor:"#404040"}),jsxRuntimeExports.jsx("directionalLight",{position:[-15,15,-15],intensity:1,color:"#ffffff"}),jsxRuntimeExports.jsx(reactExports.Suspense,{fallback:null,children:jsxRuntimeExports.jsxs("group",{position:[0,-1,0],children:[!ne&&ie&&jsxRuntimeExports.jsx(jsxRuntimeExports.Fragment,{children:Object.entries(ie).map(([ge,ce])=>jsxRuntimeExports.jsxs("group",{visible:Number(ge)===se,children:[React.cloneElement(ce,{visible:Number(ge)===se,onReady:ae}),Number(ge)===1&&jsxRuntimeExports.jsx(OfficeCabinet,{position:[2,0,0]})]},ge))}),jsxRuntimeExports.jsx(ReceptionDesk,{currentAction:K,position:[0,0,0],rotation:[0,Math.PI*0,0],scale:1.1}),jsxRuntimeExports.jsx(Floor,{}),jsxRuntimeExports.jsx(Ceiling,{}),X===1&&jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(Tv,{}),jsxRuntimeExports.jsx(Zegar,{}),jsxRuntimeExports.jsx(ChairOffice,{}),jsxRuntimeExports.jsx(RollUpDisplay,{position:[2.2,0,1.5],rotation:[0,-Math.PI/3,0],scale:.9})]}),X===2&&jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(Chair,{}),jsxRuntimeExports.jsx(CoffeeTable,{})]}),X===3&&jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(Vase,{}),jsxRuntimeExports.jsx(Zegar,{}),jsxRuntimeExports.jsx(PlantOne,{})]}),X===4&&jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(Tv,{}),jsxRuntimeExports.jsx(CoffeeTable,{})]}),jsxRuntimeExports.jsx(Sign,{position:[0,3.5,-4.9],scale:1.2,activeScene:X}),jsxRuntimeExports.jsx(Wall,{name:"Left Wall",initialPosition:[-5,2,0],initialSize:[.2,4,10]}),jsxRuntimeExports.jsx(Wall,{name:"Right Wall",initialPosition:[5,2,0],initialSize:[.2,4,10]}),jsxRuntimeExports.jsx(Wall,{name:"Back Wall",initialPosition:[0,2,-5],initialSize:[10,4,.2]}),jsxRuntimeExports.jsx(Wall,{name:"Front Wall",initialPosition:[0,2,5],initialSize:[10,4,.2]})]})})]})]})});function AvatarButtons({selectedAvatar:X,isLoading:Z,handleAvatarChange:_,setActiveScene:K}){const te=ne=>{_(ne),K(ne)};return[1,2,3,4].map(ne=>jsxRuntimeExports.jsx("button",{onClick:()=>te(ne),style:{padding:"12px 24px",margin:"0 8px",backgroundColor:X===ne?"#2196F3":"#666",color:"white",border:"none",borderRadius:"4px",cursor:"pointer",fontSize:"16px",transition:"all 0.3s ease",opacity:Z?X===ne?1:.3:1,pointerEvents:Z?"none":"auto"},children:Z&&X===ne?"Loading...":LABELS[ne]},ne))}const App=()=>{const[X,Z]=reactExports.useState(""),[_,K]=reactExports.useState(1),[te,ne]=reactExports.useState(!1),[oe,ie]=reactExports.useState(1),[se,ae]=reactExports.useState(!1),[ge,ce]=reactExports.useState(0),[de,pe]=reactExports.useState({}),[fe,be]=reactExports.useState(!0),[me,ye]=reactExports.useState(1),[ve,Be]=reactExports.useState(!1),[Re,Ee]=reactExports.useState(!1);reactExports.useEffect(()=>{const _e=()=>{Ee(window.innerWidth<1e3)};return _e(),window.addEventListener("resize",_e),()=>window.removeEventListener("resize",_e)},[]);const We=reactExports.useCallback(_e=>{ne(!1),Be(!1),ie(_e),ye(_e),K(_e),de[_e]&&setTimeout(()=>{ne(!0)},500)},[de]);reactExports.useCallback(_e=>{ce(He=>He+1);const Pe={"ENERGY TRANSFORMATION":1,"ENERGY AND HYDROGEN HUB":2,"IMPROVEMENT OF RENEWABLE ENERGY EFFICIENCY":3,"CLEAN AIR":4}[_e]||1;ie(Pe),ye(Pe)},[]),reactExports.useEffect(()=>{(async()=>{try{pe({1:jsxRuntimeExports.jsx(ConvaiAvatar,{onLoad:()=>Ze(1)}),2:jsxRuntimeExports.jsx(ConvaiAvatar2,{onLoad:()=>Ze(2)}),3:jsxRuntimeExports.jsx(ConvaiAvatar3,{onLoad:()=>Ze(3)}),4:jsxRuntimeExports.jsx(ConvaiAvatar4,{onLoad:()=>Ze(4)})}),be(!1)}catch(Xe){console.error("Error loading avatars:",Xe)}})()},[]);const Ze=_e=>{_e===oe&&ne(!0)},Ve=reactExports.useCallback(_e=>{console.log("Avatar ready state:",_e),Be(_e)},[]);return jsxRuntimeExports.jsxs("div",{className:"app-container",style:{height:"100vh",width:"100vw",position:"fixed",top:0,left:0},children:[Re&&jsxRuntimeExports.jsx(MobileNotification,{}),jsxRuntimeExports.jsxs("div",{className:"scene-container",children:[jsxRuntimeExports.jsx("div",{style:{position:"absolute",bottom:"20px",left:"50%",transform:"translateX(-50%)",zIndex:1e3,display:"flex",gap:"10px",padding:"10px",backgroundColor:"rgba(0,0,0,0.5)",borderRadius:"8px",backdropFilter:"blur(4px)"},children:jsxRuntimeExports.jsx(AvatarButtons,{selectedAvatar:oe,isLoading:se,handleAvatarChange:We,setActiveScene:K})}),!te&&jsxRuntimeExports.jsx("div",{className:"loading-overlay",children:jsxRuntimeExports.jsx(LoadingSpinner,{progress:100})}),jsxRuntimeExports.jsx(Scene3DErrorBoundary,{children:jsxRuntimeExports.jsx(Scene,{activeScene:_,isAvatarLoaded:te,onAvatarLoaded:()=>ne(!0),currentAction:X,selectedAvatar:oe,isLoading:se,forceUpdate:ge,avatars:de,visibleAvatar:me,onAvatarReady:Ve},`scene-${ge}`)}),te&&ve&&jsxRuntimeExports.jsx(ChatInterface,{characterId:AVATAR_IDS[oe],setActiveScene:K,isAvatarReady:ve}),jsxRuntimeExports.jsx(SceneButtons,{setActiveScene:K})]})]})};function SceneButtons({setActiveScene:X}){return jsxRuntimeExports.jsxs("div",{className:"scene-buttons",children:[jsxRuntimeExports.jsx("button",{onClick:()=>X(1),children:"Energy Transformation"}),jsxRuntimeExports.jsx("button",{onClick:()=>X(2),children:"Energy Hub"}),jsxRuntimeExports.jsx("button",{onClick:()=>X(3),children:"IMPROVEMENT OF RENEWABLE ENERGY EFFICIENCY"}),jsxRuntimeExports.jsx("button",{onClick:()=>{const Z="TEST "+Math.floor(Math.random()*1e3);X(Z)},children:"Test Random Text"})]})}ReactDOM.createRoot(document.getElementById("root")).render(jsxRuntimeExports.jsx(React.StrictMode,{children:jsxRuntimeExports.jsx(App,{})}));
