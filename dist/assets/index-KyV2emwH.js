var md=Object.defineProperty;var bd=(X,Z,_)=>Z in X?md(X,Z,{enumerable:!0,configurable:!0,writable:!0,value:_}):X[Z]=_;var Cu=(X,Z,_)=>bd(X,typeof Z!="symbol"?Z+"":Z,_);function _mergeNamespaces(X,Z){for(var _=0;_<Z.length;_++){const K=Z[_];if(typeof K!="string"&&!Array.isArray(K)){for(const te in K)if(te!=="default"&&!(te in X)){const ne=Object.getOwnPropertyDescriptor(K,te);ne&&Object.defineProperty(X,te,ne.get?ne:{enumerable:!0,get:()=>K[te]})}}}return Object.freeze(Object.defineProperty(X,Symbol.toStringTag,{value:"Module"}))}(function(){const Z=document.createElement("link").relList;if(Z&&Z.supports&&Z.supports("modulepreload"))return;for(const te of document.querySelectorAll('link[rel="modulepreload"]'))K(te);new MutationObserver(te=>{for(const ne of te)if(ne.type==="childList")for(const ie of ne.addedNodes)ie.tagName==="LINK"&&ie.rel==="modulepreload"&&K(ie)}).observe(document,{childList:!0,subtree:!0});function _(te){const ne={};return te.integrity&&(ne.integrity=te.integrity),te.referrerPolicy&&(ne.referrerPolicy=te.referrerPolicy),te.crossOrigin==="use-credentials"?ne.credentials="include":te.crossOrigin==="anonymous"?ne.credentials="omit":ne.credentials="same-origin",ne}function K(te){if(te.ep)return;te.ep=!0;const ne=_(te);fetch(te.href,ne)}})();function getDefaultExportFromCjs(X){return X&&X.__esModule&&Object.prototype.hasOwnProperty.call(X,"default")?X.default:X}function getAugmentedNamespace(X){if(X.__esModule)return X;var Z=X.default;if(typeof Z=="function"){var _=function K(){return this instanceof K?Reflect.construct(Z,arguments,this.constructor):Z.apply(this,arguments)};_.prototype=Z.prototype}else _={};return Object.defineProperty(_,"__esModule",{value:!0}),Object.keys(X).forEach(function(K){var te=Object.getOwnPropertyDescriptor(X,K);Object.defineProperty(_,K,te.get?te:{enumerable:!0,get:function(){return X[K]}})}),_}var jsxRuntime={exports:{}},reactJsxRuntime_production_min={},react={exports:{}},react_production_min={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var hasRequiredReact_production_min;function requireReact_production_min(){if(hasRequiredReact_production_min)return react_production_min;hasRequiredReact_production_min=1;var X=Symbol.for("react.element"),Z=Symbol.for("react.portal"),_=Symbol.for("react.fragment"),K=Symbol.for("react.strict_mode"),te=Symbol.for("react.profiler"),ne=Symbol.for("react.provider"),ie=Symbol.for("react.context"),oe=Symbol.for("react.forward_ref"),se=Symbol.for("react.suspense"),ae=Symbol.for("react.memo"),ge=Symbol.for("react.lazy"),ce=Symbol.iterator;function de(Ye){return Ye===null||typeof Ye!="object"?null:(Ye=ce&&Ye[ce]||Ye["@@iterator"],typeof Ye=="function"?Ye:null)}var Ie={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},fe=Object.assign,be={};function Ae(Ye,$e,ut){this.props=Ye,this.context=$e,this.refs=be,this.updater=ut||Ie}Ae.prototype.isReactComponent={},Ae.prototype.setState=function(Ye,$e){if(typeof Ye!="object"&&typeof Ye!="function"&&Ye!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,Ye,$e,"setState")},Ae.prototype.forceUpdate=function(Ye){this.updater.enqueueForceUpdate(this,Ye,"forceUpdate")};function ye(){}ye.prototype=Ae.prototype;function ve(Ye,$e,ut){this.props=Ye,this.context=$e,this.refs=be,this.updater=ut||Ie}var Be=ve.prototype=new ye;Be.constructor=ve,fe(Be,Ae.prototype),Be.isPureReactComponent=!0;var Re=Array.isArray,Ve=Object.prototype.hasOwnProperty,Ee={current:null},Ze={key:!0,ref:!0,__self:!0,__source:!0};function _e(Ye,$e,ut){var ot,gt={},ht=null,dt=null;if($e!=null)for(ot in $e.ref!==void 0&&(dt=$e.ref),$e.key!==void 0&&(ht=""+$e.key),$e)Ve.call($e,ot)&&!Ze.hasOwnProperty(ot)&&(gt[ot]=$e[ot]);var bt=arguments.length-2;if(bt===1)gt.children=ut;else if(1<bt){for(var Ht=Array(bt),Dt=0;Dt<bt;Dt++)Ht[Dt]=arguments[Dt+2];gt.children=Ht}if(Ye&&Ye.defaultProps)for(ot in bt=Ye.defaultProps,bt)gt[ot]===void 0&&(gt[ot]=bt[ot]);return{$$typeof:X,type:Ye,key:ht,ref:dt,props:gt,_owner:Ee.current}}function Fe(Ye,$e){return{$$typeof:X,type:Ye.type,key:$e,ref:Ye.ref,props:Ye.props,_owner:Ye._owner}}function Te(Ye){return typeof Ye=="object"&&Ye!==null&&Ye.$$typeof===X}function ke(Ye){var $e={"=":"=0",":":"=2"};return"$"+Ye.replace(/[=:]/g,function(ut){return $e[ut]})}var Le=/\/+/g;function Ke(Ye,$e){return typeof Ye=="object"&&Ye!==null&&Ye.key!=null?ke(""+Ye.key):$e.toString(36)}function Ue(Ye,$e,ut,ot,gt){var ht=typeof Ye;(ht==="undefined"||ht==="boolean")&&(Ye=null);var dt=!1;if(Ye===null)dt=!0;else switch(ht){case"string":case"number":dt=!0;break;case"object":switch(Ye.$$typeof){case X:case Z:dt=!0}}if(dt)return dt=Ye,gt=gt(dt),Ye=ot===""?"."+Ke(dt,0):ot,Re(gt)?(ut="",Ye!=null&&(ut=Ye.replace(Le,"$&/")+"/"),Ue(gt,$e,ut,"",function(Dt){return Dt})):gt!=null&&(Te(gt)&&(gt=Fe(gt,ut+(!gt.key||dt&&dt.key===gt.key?"":(""+gt.key).replace(Le,"$&/")+"/")+Ye)),$e.push(gt)),1;if(dt=0,ot=ot===""?".":ot+":",Re(Ye))for(var bt=0;bt<Ye.length;bt++){ht=Ye[bt];var Ht=ot+Ke(ht,bt);dt+=Ue(ht,$e,ut,Ht,gt)}else if(Ht=de(Ye),typeof Ht=="function")for(Ye=Ht.call(Ye),bt=0;!(ht=Ye.next()).done;)ht=ht.value,Ht=ot+Ke(ht,bt++),dt+=Ue(ht,$e,ut,Ht,gt);else if(ht==="object")throw $e=String(Ye),Error("Objects are not valid as a React child (found: "+($e==="[object Object]"?"object with keys {"+Object.keys(Ye).join(", ")+"}":$e)+"). If you meant to render a collection of children, use an array instead.");return dt}function rt(Ye,$e,ut){if(Ye==null)return Ye;var ot=[],gt=0;return Ue(Ye,ot,"","",function(ht){return $e.call(ut,ht,gt++)}),ot}function tt(Ye){if(Ye._status===-1){var $e=Ye._result;$e=$e(),$e.then(function(ut){(Ye._status===0||Ye._status===-1)&&(Ye._status=1,Ye._result=ut)},function(ut){(Ye._status===0||Ye._status===-1)&&(Ye._status=2,Ye._result=ut)}),Ye._status===-1&&(Ye._status=0,Ye._result=$e)}if(Ye._status===1)return Ye._result.default;throw Ye._result}var at={current:null},ze={transition:null},qe={ReactCurrentDispatcher:at,ReactCurrentBatchConfig:ze,ReactCurrentOwner:Ee};function Pe(){throw Error("act(...) is not supported in production builds of React.")}return react_production_min.Children={map:rt,forEach:function(Ye,$e,ut){rt(Ye,function(){$e.apply(this,arguments)},ut)},count:function(Ye){var $e=0;return rt(Ye,function(){$e++}),$e},toArray:function(Ye){return rt(Ye,function($e){return $e})||[]},only:function(Ye){if(!Te(Ye))throw Error("React.Children.only expected to receive a single React element child.");return Ye}},react_production_min.Component=Ae,react_production_min.Fragment=_,react_production_min.Profiler=te,react_production_min.PureComponent=ve,react_production_min.StrictMode=K,react_production_min.Suspense=se,react_production_min.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=qe,react_production_min.act=Pe,react_production_min.cloneElement=function(Ye,$e,ut){if(Ye==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+Ye+".");var ot=fe({},Ye.props),gt=Ye.key,ht=Ye.ref,dt=Ye._owner;if($e!=null){if($e.ref!==void 0&&(ht=$e.ref,dt=Ee.current),$e.key!==void 0&&(gt=""+$e.key),Ye.type&&Ye.type.defaultProps)var bt=Ye.type.defaultProps;for(Ht in $e)Ve.call($e,Ht)&&!Ze.hasOwnProperty(Ht)&&(ot[Ht]=$e[Ht]===void 0&&bt!==void 0?bt[Ht]:$e[Ht])}var Ht=arguments.length-2;if(Ht===1)ot.children=ut;else if(1<Ht){bt=Array(Ht);for(var Dt=0;Dt<Ht;Dt++)bt[Dt]=arguments[Dt+2];ot.children=bt}return{$$typeof:X,type:Ye.type,key:gt,ref:ht,props:ot,_owner:dt}},react_production_min.createContext=function(Ye){return Ye={$$typeof:ie,_currentValue:Ye,_currentValue2:Ye,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},Ye.Provider={$$typeof:ne,_context:Ye},Ye.Consumer=Ye},react_production_min.createElement=_e,react_production_min.createFactory=function(Ye){var $e=_e.bind(null,Ye);return $e.type=Ye,$e},react_production_min.createRef=function(){return{current:null}},react_production_min.forwardRef=function(Ye){return{$$typeof:oe,render:Ye}},react_production_min.isValidElement=Te,react_production_min.lazy=function(Ye){return{$$typeof:ge,_payload:{_status:-1,_result:Ye},_init:tt}},react_production_min.memo=function(Ye,$e){return{$$typeof:ae,type:Ye,compare:$e===void 0?null:$e}},react_production_min.startTransition=function(Ye){var $e=ze.transition;ze.transition={};try{Ye()}finally{ze.transition=$e}},react_production_min.unstable_act=Pe,react_production_min.useCallback=function(Ye,$e){return at.current.useCallback(Ye,$e)},react_production_min.useContext=function(Ye){return at.current.useContext(Ye)},react_production_min.useDebugValue=function(){},react_production_min.useDeferredValue=function(Ye){return at.current.useDeferredValue(Ye)},react_production_min.useEffect=function(Ye,$e){return at.current.useEffect(Ye,$e)},react_production_min.useId=function(){return at.current.useId()},react_production_min.useImperativeHandle=function(Ye,$e,ut){return at.current.useImperativeHandle(Ye,$e,ut)},react_production_min.useInsertionEffect=function(Ye,$e){return at.current.useInsertionEffect(Ye,$e)},react_production_min.useLayoutEffect=function(Ye,$e){return at.current.useLayoutEffect(Ye,$e)},react_production_min.useMemo=function(Ye,$e){return at.current.useMemo(Ye,$e)},react_production_min.useReducer=function(Ye,$e,ut){return at.current.useReducer(Ye,$e,ut)},react_production_min.useRef=function(Ye){return at.current.useRef(Ye)},react_production_min.useState=function(Ye){return at.current.useState(Ye)},react_production_min.useSyncExternalStore=function(Ye,$e,ut){return at.current.useSyncExternalStore(Ye,$e,ut)},react_production_min.useTransition=function(){return at.current.useTransition()},react_production_min.version="18.3.1",react_production_min}var hasRequiredReact;function requireReact(){return hasRequiredReact||(hasRequiredReact=1,react.exports=requireReact_production_min()),react.exports}/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var hasRequiredReactJsxRuntime_production_min;function requireReactJsxRuntime_production_min(){if(hasRequiredReactJsxRuntime_production_min)return reactJsxRuntime_production_min;hasRequiredReactJsxRuntime_production_min=1;var X=requireReact(),Z=Symbol.for("react.element"),_=Symbol.for("react.fragment"),K=Object.prototype.hasOwnProperty,te=X.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,ne={key:!0,ref:!0,__self:!0,__source:!0};function ie(oe,se,ae){var ge,ce={},de=null,Ie=null;ae!==void 0&&(de=""+ae),se.key!==void 0&&(de=""+se.key),se.ref!==void 0&&(Ie=se.ref);for(ge in se)K.call(se,ge)&&!ne.hasOwnProperty(ge)&&(ce[ge]=se[ge]);if(oe&&oe.defaultProps)for(ge in se=oe.defaultProps,se)ce[ge]===void 0&&(ce[ge]=se[ge]);return{$$typeof:Z,type:oe,key:de,ref:Ie,props:ce,_owner:te.current}}return reactJsxRuntime_production_min.Fragment=_,reactJsxRuntime_production_min.jsx=ie,reactJsxRuntime_production_min.jsxs=ie,reactJsxRuntime_production_min}var hasRequiredJsxRuntime;function requireJsxRuntime(){return hasRequiredJsxRuntime||(hasRequiredJsxRuntime=1,jsxRuntime.exports=requireReactJsxRuntime_production_min()),jsxRuntime.exports}var jsxRuntimeExports=requireJsxRuntime(),reactExports=requireReact();const React=getDefaultExportFromCjs(reactExports),$2AODx$react=_mergeNamespaces({__proto__:null,default:React},[reactExports]);var client={},reactDom={exports:{}},reactDom_production_min={},scheduler$2={exports:{}},scheduler_production_min$2={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var hasRequiredScheduler_production_min$2;function requireScheduler_production_min$2(){return hasRequiredScheduler_production_min$2||(hasRequiredScheduler_production_min$2=1,function(X){function Z(ze,qe){var Pe=ze.length;ze.push(qe);e:for(;0<Pe;){var Ye=Pe-1>>>1,$e=ze[Ye];if(0<te($e,qe))ze[Ye]=qe,ze[Pe]=$e,Pe=Ye;else break e}}function _(ze){return ze.length===0?null:ze[0]}function K(ze){if(ze.length===0)return null;var qe=ze[0],Pe=ze.pop();if(Pe!==qe){ze[0]=Pe;e:for(var Ye=0,$e=ze.length,ut=$e>>>1;Ye<ut;){var ot=2*(Ye+1)-1,gt=ze[ot],ht=ot+1,dt=ze[ht];if(0>te(gt,Pe))ht<$e&&0>te(dt,gt)?(ze[Ye]=dt,ze[ht]=Pe,Ye=ht):(ze[Ye]=gt,ze[ot]=Pe,Ye=ot);else if(ht<$e&&0>te(dt,Pe))ze[Ye]=dt,ze[ht]=Pe,Ye=ht;else break e}}return qe}function te(ze,qe){var Pe=ze.sortIndex-qe.sortIndex;return Pe!==0?Pe:ze.id-qe.id}if(typeof performance=="object"&&typeof performance.now=="function"){var ne=performance;X.unstable_now=function(){return ne.now()}}else{var ie=Date,oe=ie.now();X.unstable_now=function(){return ie.now()-oe}}var se=[],ae=[],ge=1,ce=null,de=3,Ie=!1,fe=!1,be=!1,Ae=typeof setTimeout=="function"?setTimeout:null,ye=typeof clearTimeout=="function"?clearTimeout:null,ve=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function Be(ze){for(var qe=_(ae);qe!==null;){if(qe.callback===null)K(ae);else if(qe.startTime<=ze)K(ae),qe.sortIndex=qe.expirationTime,Z(se,qe);else break;qe=_(ae)}}function Re(ze){if(be=!1,Be(ze),!fe)if(_(se)!==null)fe=!0,tt(Ve);else{var qe=_(ae);qe!==null&&at(Re,qe.startTime-ze)}}function Ve(ze,qe){fe=!1,be&&(be=!1,ye(_e),_e=-1),Ie=!0;var Pe=de;try{for(Be(qe),ce=_(se);ce!==null&&(!(ce.expirationTime>qe)||ze&&!ke());){var Ye=ce.callback;if(typeof Ye=="function"){ce.callback=null,de=ce.priorityLevel;var $e=Ye(ce.expirationTime<=qe);qe=X.unstable_now(),typeof $e=="function"?ce.callback=$e:ce===_(se)&&K(se),Be(qe)}else K(se);ce=_(se)}if(ce!==null)var ut=!0;else{var ot=_(ae);ot!==null&&at(Re,ot.startTime-qe),ut=!1}return ut}finally{ce=null,de=Pe,Ie=!1}}var Ee=!1,Ze=null,_e=-1,Fe=5,Te=-1;function ke(){return!(X.unstable_now()-Te<Fe)}function Le(){if(Ze!==null){var ze=X.unstable_now();Te=ze;var qe=!0;try{qe=Ze(!0,ze)}finally{qe?Ke():(Ee=!1,Ze=null)}}else Ee=!1}var Ke;if(typeof ve=="function")Ke=function(){ve(Le)};else if(typeof MessageChannel<"u"){var Ue=new MessageChannel,rt=Ue.port2;Ue.port1.onmessage=Le,Ke=function(){rt.postMessage(null)}}else Ke=function(){Ae(Le,0)};function tt(ze){Ze=ze,Ee||(Ee=!0,Ke())}function at(ze,qe){_e=Ae(function(){ze(X.unstable_now())},qe)}X.unstable_IdlePriority=5,X.unstable_ImmediatePriority=1,X.unstable_LowPriority=4,X.unstable_NormalPriority=3,X.unstable_Profiling=null,X.unstable_UserBlockingPriority=2,X.unstable_cancelCallback=function(ze){ze.callback=null},X.unstable_continueExecution=function(){fe||Ie||(fe=!0,tt(Ve))},X.unstable_forceFrameRate=function(ze){0>ze||125<ze?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):Fe=0<ze?Math.floor(1e3/ze):5},X.unstable_getCurrentPriorityLevel=function(){return de},X.unstable_getFirstCallbackNode=function(){return _(se)},X.unstable_next=function(ze){switch(de){case 1:case 2:case 3:var qe=3;break;default:qe=de}var Pe=de;de=qe;try{return ze()}finally{de=Pe}},X.unstable_pauseExecution=function(){},X.unstable_requestPaint=function(){},X.unstable_runWithPriority=function(ze,qe){switch(ze){case 1:case 2:case 3:case 4:case 5:break;default:ze=3}var Pe=de;de=ze;try{return qe()}finally{de=Pe}},X.unstable_scheduleCallback=function(ze,qe,Pe){var Ye=X.unstable_now();switch(typeof Pe=="object"&&Pe!==null?(Pe=Pe.delay,Pe=typeof Pe=="number"&&0<Pe?Ye+Pe:Ye):Pe=Ye,ze){case 1:var $e=-1;break;case 2:$e=250;break;case 5:$e=1073741823;break;case 4:$e=1e4;break;default:$e=5e3}return $e=Pe+$e,ze={id:ge++,callback:qe,priorityLevel:ze,startTime:Pe,expirationTime:$e,sortIndex:-1},Pe>Ye?(ze.sortIndex=Pe,Z(ae,ze),_(se)===null&&ze===_(ae)&&(be?(ye(_e),_e=-1):be=!0,at(Re,Pe-Ye))):(ze.sortIndex=$e,Z(se,ze),fe||Ie||(fe=!0,tt(Ve))),ze},X.unstable_shouldYield=ke,X.unstable_wrapCallback=function(ze){var qe=de;return function(){var Pe=de;de=qe;try{return ze.apply(this,arguments)}finally{de=Pe}}}}(scheduler_production_min$2)),scheduler_production_min$2}var hasRequiredScheduler$2;function requireScheduler$2(){return hasRequiredScheduler$2||(hasRequiredScheduler$2=1,scheduler$2.exports=requireScheduler_production_min$2()),scheduler$2.exports}/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var hasRequiredReactDom_production_min;function requireReactDom_production_min(){if(hasRequiredReactDom_production_min)return reactDom_production_min;hasRequiredReactDom_production_min=1;var X=requireReact(),Z=requireScheduler$2();function _(le){for(var ue="https://reactjs.org/docs/error-decoder.html?invariant="+le,me=1;me<arguments.length;me++)ue+="&args[]="+encodeURIComponent(arguments[me]);return"Minified React error #"+le+"; visit "+ue+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var K=new Set,te={};function ne(le,ue){ie(le,ue),ie(le+"Capture",ue)}function ie(le,ue){for(te[le]=ue,le=0;le<ue.length;le++)K.add(ue[le])}var oe=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),se=Object.prototype.hasOwnProperty,ae=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,ge={},ce={};function de(le){return se.call(ce,le)?!0:se.call(ge,le)?!1:ae.test(le)?ce[le]=!0:(ge[le]=!0,!1)}function Ie(le,ue,me,Se){if(me!==null&&me.type===0)return!1;switch(typeof ue){case"function":case"symbol":return!0;case"boolean":return Se?!1:me!==null?!me.acceptsBooleans:(le=le.toLowerCase().slice(0,5),le!=="data-"&&le!=="aria-");default:return!1}}function fe(le,ue,me,Se){if(ue===null||typeof ue>"u"||Ie(le,ue,me,Se))return!0;if(Se)return!1;if(me!==null)switch(me.type){case 3:return!ue;case 4:return ue===!1;case 5:return isNaN(ue);case 6:return isNaN(ue)||1>ue}return!1}function be(le,ue,me,Se,We,Xe,nt){this.acceptsBooleans=ue===2||ue===3||ue===4,this.attributeName=Se,this.attributeNamespace=We,this.mustUseProperty=me,this.propertyName=le,this.type=ue,this.sanitizeURL=Xe,this.removeEmptyString=nt}var Ae={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(le){Ae[le]=new be(le,0,!1,le,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(le){var ue=le[0];Ae[ue]=new be(ue,1,!1,le[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(le){Ae[le]=new be(le,2,!1,le.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(le){Ae[le]=new be(le,2,!1,le,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(le){Ae[le]=new be(le,3,!1,le.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(le){Ae[le]=new be(le,3,!0,le,null,!1,!1)}),["capture","download"].forEach(function(le){Ae[le]=new be(le,4,!1,le,null,!1,!1)}),["cols","rows","size","span"].forEach(function(le){Ae[le]=new be(le,6,!1,le,null,!1,!1)}),["rowSpan","start"].forEach(function(le){Ae[le]=new be(le,5,!1,le.toLowerCase(),null,!1,!1)});var ye=/[\-:]([a-z])/g;function ve(le){return le[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(le){var ue=le.replace(ye,ve);Ae[ue]=new be(ue,1,!1,le,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(le){var ue=le.replace(ye,ve);Ae[ue]=new be(ue,1,!1,le,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(le){var ue=le.replace(ye,ve);Ae[ue]=new be(ue,1,!1,le,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(le){Ae[le]=new be(le,1,!1,le.toLowerCase(),null,!1,!1)}),Ae.xlinkHref=new be("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(le){Ae[le]=new be(le,1,!1,le.toLowerCase(),null,!0,!0)});function Be(le,ue,me,Se){var We=Ae.hasOwnProperty(ue)?Ae[ue]:null;(We!==null?We.type!==0:Se||!(2<ue.length)||ue[0]!=="o"&&ue[0]!=="O"||ue[1]!=="n"&&ue[1]!=="N")&&(fe(ue,me,We,Se)&&(me=null),Se||We===null?de(ue)&&(me===null?le.removeAttribute(ue):le.setAttribute(ue,""+me)):We.mustUseProperty?le[We.propertyName]=me===null?We.type===3?!1:"":me:(ue=We.attributeName,Se=We.attributeNamespace,me===null?le.removeAttribute(ue):(We=We.type,me=We===3||We===4&&me===!0?"":""+me,Se?le.setAttributeNS(Se,ue,me):le.setAttribute(ue,me))))}var Re=X.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,Ve=Symbol.for("react.element"),Ee=Symbol.for("react.portal"),Ze=Symbol.for("react.fragment"),_e=Symbol.for("react.strict_mode"),Fe=Symbol.for("react.profiler"),Te=Symbol.for("react.provider"),ke=Symbol.for("react.context"),Le=Symbol.for("react.forward_ref"),Ke=Symbol.for("react.suspense"),Ue=Symbol.for("react.suspense_list"),rt=Symbol.for("react.memo"),tt=Symbol.for("react.lazy"),at=Symbol.for("react.offscreen"),ze=Symbol.iterator;function qe(le){return le===null||typeof le!="object"?null:(le=ze&&le[ze]||le["@@iterator"],typeof le=="function"?le:null)}var Pe=Object.assign,Ye;function $e(le){if(Ye===void 0)try{throw Error()}catch(me){var ue=me.stack.trim().match(/\n( *(at )?)/);Ye=ue&&ue[1]||""}return`
`+Ye+le}var ut=!1;function ot(le,ue){if(!le||ut)return"";ut=!0;var me=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(ue)if(ue=function(){throw Error()},Object.defineProperty(ue.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(ue,[])}catch(Pt){var Se=Pt}Reflect.construct(le,[],ue)}else{try{ue.call()}catch(Pt){Se=Pt}le.call(ue.prototype)}else{try{throw Error()}catch(Pt){Se=Pt}le()}}catch(Pt){if(Pt&&Se&&typeof Pt.stack=="string"){for(var We=Pt.stack.split(`
`),Xe=Se.stack.split(`
`),nt=We.length-1,Ct=Xe.length-1;1<=nt&&0<=Ct&&We[nt]!==Xe[Ct];)Ct--;for(;1<=nt&&0<=Ct;nt--,Ct--)if(We[nt]!==Xe[Ct]){if(nt!==1||Ct!==1)do if(nt--,Ct--,0>Ct||We[nt]!==Xe[Ct]){var Gt=`
`+We[nt].replace(" at new "," at ");return le.displayName&&Gt.includes("<anonymous>")&&(Gt=Gt.replace("<anonymous>",le.displayName)),Gt}while(1<=nt&&0<=Ct);break}}}finally{ut=!1,Error.prepareStackTrace=me}return(le=le?le.displayName||le.name:"")?$e(le):""}function gt(le){switch(le.tag){case 5:return $e(le.type);case 16:return $e("Lazy");case 13:return $e("Suspense");case 19:return $e("SuspenseList");case 0:case 2:case 15:return le=ot(le.type,!1),le;case 11:return le=ot(le.type.render,!1),le;case 1:return le=ot(le.type,!0),le;default:return""}}function ht(le){if(le==null)return null;if(typeof le=="function")return le.displayName||le.name||null;if(typeof le=="string")return le;switch(le){case Ze:return"Fragment";case Ee:return"Portal";case Fe:return"Profiler";case _e:return"StrictMode";case Ke:return"Suspense";case Ue:return"SuspenseList"}if(typeof le=="object")switch(le.$$typeof){case ke:return(le.displayName||"Context")+".Consumer";case Te:return(le._context.displayName||"Context")+".Provider";case Le:var ue=le.render;return le=le.displayName,le||(le=ue.displayName||ue.name||"",le=le!==""?"ForwardRef("+le+")":"ForwardRef"),le;case rt:return ue=le.displayName||null,ue!==null?ue:ht(le.type)||"Memo";case tt:ue=le._payload,le=le._init;try{return ht(le(ue))}catch{}}return null}function dt(le){var ue=le.type;switch(le.tag){case 24:return"Cache";case 9:return(ue.displayName||"Context")+".Consumer";case 10:return(ue._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return le=ue.render,le=le.displayName||le.name||"",ue.displayName||(le!==""?"ForwardRef("+le+")":"ForwardRef");case 7:return"Fragment";case 5:return ue;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return ht(ue);case 8:return ue===_e?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof ue=="function")return ue.displayName||ue.name||null;if(typeof ue=="string")return ue}return null}function bt(le){switch(typeof le){case"boolean":case"number":case"string":case"undefined":return le;case"object":return le;default:return""}}function Ht(le){var ue=le.type;return(le=le.nodeName)&&le.toLowerCase()==="input"&&(ue==="checkbox"||ue==="radio")}function Dt(le){var ue=Ht(le)?"checked":"value",me=Object.getOwnPropertyDescriptor(le.constructor.prototype,ue),Se=""+le[ue];if(!le.hasOwnProperty(ue)&&typeof me<"u"&&typeof me.get=="function"&&typeof me.set=="function"){var We=me.get,Xe=me.set;return Object.defineProperty(le,ue,{configurable:!0,get:function(){return We.call(this)},set:function(nt){Se=""+nt,Xe.call(this,nt)}}),Object.defineProperty(le,ue,{enumerable:me.enumerable}),{getValue:function(){return Se},setValue:function(nt){Se=""+nt},stopTracking:function(){le._valueTracker=null,delete le[ue]}}}}function Vt(le){le._valueTracker||(le._valueTracker=Dt(le))}function mt(le){if(!le)return!1;var ue=le._valueTracker;if(!ue)return!0;var me=ue.getValue(),Se="";return le&&(Se=Ht(le)?le.checked?"true":"false":le.value),le=Se,le!==me?(ue.setValue(le),!0):!1}function Ft(le){if(le=le||(typeof document<"u"?document:void 0),typeof le>"u")return null;try{return le.activeElement||le.body}catch{return le.body}}function it(le,ue){var me=ue.checked;return Pe({},ue,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:me??le._wrapperState.initialChecked})}function Lt(le,ue){var me=ue.defaultValue==null?"":ue.defaultValue,Se=ue.checked!=null?ue.checked:ue.defaultChecked;me=bt(ue.value!=null?ue.value:me),le._wrapperState={initialChecked:Se,initialValue:me,controlled:ue.type==="checkbox"||ue.type==="radio"?ue.checked!=null:ue.value!=null}}function Et(le,ue){ue=ue.checked,ue!=null&&Be(le,"checked",ue,!1)}function Ut(le,ue){Et(le,ue);var me=bt(ue.value),Se=ue.type;if(me!=null)Se==="number"?(me===0&&le.value===""||le.value!=me)&&(le.value=""+me):le.value!==""+me&&(le.value=""+me);else if(Se==="submit"||Se==="reset"){le.removeAttribute("value");return}ue.hasOwnProperty("value")?Ot(le,ue.type,me):ue.hasOwnProperty("defaultValue")&&Ot(le,ue.type,bt(ue.defaultValue)),ue.checked==null&&ue.defaultChecked!=null&&(le.defaultChecked=!!ue.defaultChecked)}function Zt(le,ue,me){if(ue.hasOwnProperty("value")||ue.hasOwnProperty("defaultValue")){var Se=ue.type;if(!(Se!=="submit"&&Se!=="reset"||ue.value!==void 0&&ue.value!==null))return;ue=""+le._wrapperState.initialValue,me||ue===le.value||(le.value=ue),le.defaultValue=ue}me=le.name,me!==""&&(le.name=""),le.defaultChecked=!!le._wrapperState.initialChecked,me!==""&&(le.name=me)}function Ot(le,ue,me){(ue!=="number"||Ft(le.ownerDocument)!==le)&&(me==null?le.defaultValue=""+le._wrapperState.initialValue:le.defaultValue!==""+me&&(le.defaultValue=""+me))}var Tt=Array.isArray;function Je(le,ue,me,Se){if(le=le.options,ue){ue={};for(var We=0;We<me.length;We++)ue["$"+me[We]]=!0;for(me=0;me<le.length;me++)We=ue.hasOwnProperty("$"+le[me].value),le[me].selected!==We&&(le[me].selected=We),We&&Se&&(le[me].defaultSelected=!0)}else{for(me=""+bt(me),ue=null,We=0;We<le.length;We++){if(le[We].value===me){le[We].selected=!0,Se&&(le[We].defaultSelected=!0);return}ue!==null||le[We].disabled||(ue=le[We])}ue!==null&&(ue.selected=!0)}}function Oe(le,ue){if(ue.dangerouslySetInnerHTML!=null)throw Error(_(91));return Pe({},ue,{value:void 0,defaultValue:void 0,children:""+le._wrapperState.initialValue})}function lt(le,ue){var me=ue.value;if(me==null){if(me=ue.children,ue=ue.defaultValue,me!=null){if(ue!=null)throw Error(_(92));if(Tt(me)){if(1<me.length)throw Error(_(93));me=me[0]}ue=me}ue==null&&(ue=""),me=ue}le._wrapperState={initialValue:bt(me)}}function ft(le,ue){var me=bt(ue.value),Se=bt(ue.defaultValue);me!=null&&(me=""+me,me!==le.value&&(le.value=me),ue.defaultValue==null&&le.defaultValue!==me&&(le.defaultValue=me)),Se!=null&&(le.defaultValue=""+Se)}function St(le){var ue=le.textContent;ue===le._wrapperState.initialValue&&ue!==""&&ue!==null&&(le.value=ue)}function Wt(le){switch(le){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function zt(le,ue){return le==null||le==="http://www.w3.org/1999/xhtml"?Wt(ue):le==="http://www.w3.org/2000/svg"&&ue==="foreignObject"?"http://www.w3.org/1999/xhtml":le}var $t,rn=function(le){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(ue,me,Se,We){MSApp.execUnsafeLocalFunction(function(){return le(ue,me,Se,We)})}:le}(function(le,ue){if(le.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in le)le.innerHTML=ue;else{for($t=$t||document.createElement("div"),$t.innerHTML="<svg>"+ue.valueOf().toString()+"</svg>",ue=$t.firstChild;le.firstChild;)le.removeChild(le.firstChild);for(;ue.firstChild;)le.appendChild(ue.firstChild)}});function Gn(le,ue){if(ue){var me=le.firstChild;if(me&&me===le.lastChild&&me.nodeType===3){me.nodeValue=ue;return}}le.textContent=ue}var en={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},In=["Webkit","ms","Moz","O"];Object.keys(en).forEach(function(le){In.forEach(function(ue){ue=ue+le.charAt(0).toUpperCase()+le.substring(1),en[ue]=en[le]})});function un(le,ue,me){return ue==null||typeof ue=="boolean"||ue===""?"":me||typeof ue!="number"||ue===0||en.hasOwnProperty(le)&&en[le]?(""+ue).trim():ue+"px"}function ln(le,ue){le=le.style;for(var me in ue)if(ue.hasOwnProperty(me)){var Se=me.indexOf("--")===0,We=un(me,ue[me],Se);me==="float"&&(me="cssFloat"),Se?le.setProperty(me,We):le[me]=We}}var tn=Pe({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Sn(le,ue){if(ue){if(tn[le]&&(ue.children!=null||ue.dangerouslySetInnerHTML!=null))throw Error(_(137,le));if(ue.dangerouslySetInnerHTML!=null){if(ue.children!=null)throw Error(_(60));if(typeof ue.dangerouslySetInnerHTML!="object"||!("__html"in ue.dangerouslySetInnerHTML))throw Error(_(61))}if(ue.style!=null&&typeof ue.style!="object")throw Error(_(62))}}function yn(le,ue){if(le.indexOf("-")===-1)return typeof ue.is=="string";switch(le){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Tn=null;function vt(le){return le=le.target||le.srcElement||window,le.correspondingUseElement&&(le=le.correspondingUseElement),le.nodeType===3?le.parentNode:le}var wt=null,Mt=null,on=null;function dn(le){if(le=Qo(le)){if(typeof wt!="function")throw Error(_(280));var ue=le.stateNode;ue&&(ue=Kl(ue),wt(le.stateNode,le.type,ue))}}function an(le){Mt?on?on.push(le):on=[le]:Mt=le}function Mn(){if(Mt){var le=Mt,ue=on;if(on=Mt=null,dn(le),ue)for(le=0;le<ue.length;le++)dn(ue[le])}}function Pn(le,ue){return le(ue)}function Nn(){}var kn=!1;function Ir(le,ue,me){if(kn)return le(ue,me);kn=!0;try{return Pn(le,ue,me)}finally{kn=!1,(Mt!==null||on!==null)&&(Nn(),Mn())}}function dr(le,ue){var me=le.stateNode;if(me===null)return null;var Se=Kl(me);if(Se===null)return null;me=Se[ue];e:switch(ue){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(Se=!Se.disabled)||(le=le.type,Se=!(le==="button"||le==="input"||le==="select"||le==="textarea")),le=!Se;break e;default:le=!1}if(le)return null;if(me&&typeof me!="function")throw Error(_(231,ue,typeof me));return me}var vr=!1;if(oe)try{var Yr={};Object.defineProperty(Yr,"passive",{get:function(){vr=!0}}),window.addEventListener("test",Yr,Yr),window.removeEventListener("test",Yr,Yr)}catch{vr=!1}function Fr(le,ue,me,Se,We,Xe,nt,Ct,Gt){var Pt=Array.prototype.slice.call(arguments,3);try{ue.apply(me,Pt)}catch(Cn){this.onError(Cn)}}var Nr=!1,Kr=null,_r=!1,Un=null,Lr={onError:function(le){Nr=!0,Kr=le}};function Bi(le,ue,me,Se,We,Xe,nt,Ct,Gt){Nr=!1,Kr=null,Fr.apply(Lr,arguments)}function je(le,ue,me,Se,We,Xe,nt,Ct,Gt){if(Bi.apply(this,arguments),Nr){if(Nr){var Pt=Kr;Nr=!1,Kr=null}else throw Error(_(198));_r||(_r=!0,Un=Pt)}}function st(le){var ue=le,me=le;if(le.alternate)for(;ue.return;)ue=ue.return;else{le=ue;do ue=le,ue.flags&4098&&(me=ue.return),le=ue.return;while(le)}return ue.tag===3?me:null}function yt(le){if(le.tag===13){var ue=le.memoizedState;if(ue===null&&(le=le.alternate,le!==null&&(ue=le.memoizedState)),ue!==null)return ue.dehydrated}return null}function Yt(le){if(st(le)!==le)throw Error(_(188))}function jt(le){var ue=le.alternate;if(!ue){if(ue=st(le),ue===null)throw Error(_(188));return ue!==le?null:le}for(var me=le,Se=ue;;){var We=me.return;if(We===null)break;var Xe=We.alternate;if(Xe===null){if(Se=We.return,Se!==null){me=Se;continue}break}if(We.child===Xe.child){for(Xe=We.child;Xe;){if(Xe===me)return Yt(We),le;if(Xe===Se)return Yt(We),ue;Xe=Xe.sibling}throw Error(_(188))}if(me.return!==Se.return)me=We,Se=Xe;else{for(var nt=!1,Ct=We.child;Ct;){if(Ct===me){nt=!0,me=We,Se=Xe;break}if(Ct===Se){nt=!0,Se=We,me=Xe;break}Ct=Ct.sibling}if(!nt){for(Ct=Xe.child;Ct;){if(Ct===me){nt=!0,me=Xe,Se=We;break}if(Ct===Se){nt=!0,Se=Xe,me=We;break}Ct=Ct.sibling}if(!nt)throw Error(_(189))}}if(me.alternate!==Se)throw Error(_(190))}if(me.tag!==3)throw Error(_(188));return me.stateNode.current===me?le:ue}function Jt(le){return le=jt(le),le!==null?fn(le):null}function fn(le){if(le.tag===5||le.tag===6)return le;for(le=le.child;le!==null;){var ue=fn(le);if(ue!==null)return ue;le=le.sibling}return null}var pn=Z.unstable_scheduleCallback,Qe=Z.unstable_cancelCallback,pt=Z.unstable_shouldYield,At=Z.unstable_requestPaint,ct=Z.unstable_now,Bt=Z.unstable_getCurrentPriorityLevel,Xt=Z.unstable_ImmediatePriority,Qt=Z.unstable_UserBlockingPriority,sn=Z.unstable_NormalPriority,cn=Z.unstable_LowPriority,Bn=Z.unstable_IdlePriority,bn=null,gn=null;function xn(le){if(gn&&typeof gn.onCommitFiberRoot=="function")try{gn.onCommitFiberRoot(bn,le,void 0,(le.current.flags&128)===128)}catch{}}var wn=Math.clz32?Math.clz32:Hn,Jn=Math.log,Wn=Math.LN2;function Hn(le){return le>>>=0,le===0?32:31-(Jn(le)/Wn|0)|0}var Zn=64,nr=4194304;function Kn(le){switch(le&-le){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return le&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return le&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return le}}function er(le,ue){var me=le.pendingLanes;if(me===0)return 0;var Se=0,We=le.suspendedLanes,Xe=le.pingedLanes,nt=me&268435455;if(nt!==0){var Ct=nt&~We;Ct!==0?Se=Kn(Ct):(Xe&=nt,Xe!==0&&(Se=Kn(Xe)))}else nt=me&~We,nt!==0?Se=Kn(nt):Xe!==0&&(Se=Kn(Xe));if(Se===0)return 0;if(ue!==0&&ue!==Se&&!(ue&We)&&(We=Se&-Se,Xe=ue&-ue,We>=Xe||We===16&&(Xe&4194240)!==0))return ue;if(Se&4&&(Se|=me&16),ue=le.entangledLanes,ue!==0)for(le=le.entanglements,ue&=Se;0<ue;)me=31-wn(ue),We=1<<me,Se|=le[me],ue&=~We;return Se}function Ar(le,ue){switch(le){case 1:case 2:case 4:return ue+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return ue+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function tr(le,ue){for(var me=le.suspendedLanes,Se=le.pingedLanes,We=le.expirationTimes,Xe=le.pendingLanes;0<Xe;){var nt=31-wn(Xe),Ct=1<<nt,Gt=We[nt];Gt===-1?(!(Ct&me)||Ct&Se)&&(We[nt]=Ar(Ct,ue)):Gt<=ue&&(le.expiredLanes|=Ct),Xe&=~Ct}}function Qn(le){return le=le.pendingLanes&-1073741825,le!==0?le:le&1073741824?1073741824:0}function On(){var le=Zn;return Zn<<=1,!(Zn&4194240)&&(Zn=64),le}function br(le){for(var ue=[],me=0;31>me;me++)ue.push(le);return ue}function ur(le,ue,me){le.pendingLanes|=ue,ue!==536870912&&(le.suspendedLanes=0,le.pingedLanes=0),le=le.eventTimes,ue=31-wn(ue),le[ue]=me}function yr(le,ue){var me=le.pendingLanes&~ue;le.pendingLanes=ue,le.suspendedLanes=0,le.pingedLanes=0,le.expiredLanes&=ue,le.mutableReadLanes&=ue,le.entangledLanes&=ue,ue=le.entanglements;var Se=le.eventTimes;for(le=le.expirationTimes;0<me;){var We=31-wn(me),Xe=1<<We;ue[We]=0,Se[We]=-1,le[We]=-1,me&=~Xe}}function Rr(le,ue){var me=le.entangledLanes|=ue;for(le=le.entanglements;me;){var Se=31-wn(me),We=1<<Se;We&ue|le[Se]&ue&&(le[Se]|=ue),me&=~We}}var lr=0;function ii(le){return le&=-le,1<le?4<le?le&268435455?16:536870912:4:1}var hs,aa,la,Zo,Fs,oo=!1,Ao=[],hi=null,rr=null,so=null,Ui=new Map,_o=new Map,ao=[],Al="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Wr(le,ue){switch(le){case"focusin":case"focusout":hi=null;break;case"dragenter":case"dragleave":rr=null;break;case"mouseover":case"mouseout":so=null;break;case"pointerover":case"pointerout":Ui.delete(ue.pointerId);break;case"gotpointercapture":case"lostpointercapture":_o.delete(ue.pointerId)}}function mo(le,ue,me,Se,We,Xe){return le===null||le.nativeEvent!==Xe?(le={blockedOn:ue,domEventName:me,eventSystemFlags:Se,nativeEvent:Xe,targetContainers:[We]},ue!==null&&(ue=Qo(ue),ue!==null&&aa(ue)),le):(le.eventSystemFlags|=Se,ue=le.targetContainers,We!==null&&ue.indexOf(We)===-1&&ue.push(We),le)}function ml(le,ue,me,Se,We){switch(ue){case"focusin":return hi=mo(hi,le,ue,me,Se,We),!0;case"dragenter":return rr=mo(rr,le,ue,me,Se,We),!0;case"mouseover":return so=mo(so,le,ue,me,Se,We),!0;case"pointerover":var Xe=We.pointerId;return Ui.set(Xe,mo(Ui.get(Xe)||null,le,ue,me,Se,We)),!0;case"gotpointercapture":return Xe=We.pointerId,_o.set(Xe,mo(_o.get(Xe)||null,le,ue,me,Se,We)),!0}return!1}function Gi(le){var ue=ws(le.target);if(ue!==null){var me=st(ue);if(me!==null){if(ue=me.tag,ue===13){if(ue=yt(me),ue!==null){le.blockedOn=ue,Fs(le.priority,function(){la(me)});return}}else if(ue===3&&me.stateNode.current.memoizedState.isDehydrated){le.blockedOn=me.tag===3?me.stateNode.containerInfo:null;return}}}le.blockedOn=null}function Cs(le){if(le.blockedOn!==null)return!1;for(var ue=le.targetContainers;0<ue.length;){var me=Si(le.domEventName,le.eventSystemFlags,ue[0],le.nativeEvent);if(me===null){me=le.nativeEvent;var Se=new me.constructor(me.type,me);Tn=Se,me.target.dispatchEvent(Se),Tn=null}else return ue=Qo(me),ue!==null&&aa(ue),le.blockedOn=me,!1;ue.shift()}return!0}function fs(le,ue,me){Cs(le)&&me.delete(ue)}function Pi(){oo=!1,hi!==null&&Cs(hi)&&(hi=null),rr!==null&&Cs(rr)&&(rr=null),so!==null&&Cs(so)&&(so=null),Ui.forEach(fs),_o.forEach(fs)}function Xo(le,ue){le.blockedOn===ue&&(le.blockedOn=null,oo||(oo=!0,Z.unstable_scheduleCallback(Z.unstable_NormalPriority,Pi)))}function As(le){function ue(We){return Xo(We,le)}if(0<Ao.length){Xo(Ao[0],le);for(var me=1;me<Ao.length;me++){var Se=Ao[me];Se.blockedOn===le&&(Se.blockedOn=null)}}for(hi!==null&&Xo(hi,le),rr!==null&&Xo(rr,le),so!==null&&Xo(so,le),Ui.forEach(ue),_o.forEach(ue),me=0;me<ao.length;me++)Se=ao[me],Se.blockedOn===le&&(Se.blockedOn=null);for(;0<ao.length&&(me=ao[0],me.blockedOn===null);)Gi(me),me.blockedOn===null&&ao.shift()}var oi=Re.ReactCurrentBatchConfig,si=!0;function Eo(le,ue,me,Se){var We=lr,Xe=oi.transition;oi.transition=null;try{lr=1,Ws(le,ue,me,Se)}finally{lr=We,oi.transition=Xe}}function lo(le,ue,me,Se){var We=lr,Xe=oi.transition;oi.transition=null;try{lr=4,Ws(le,ue,me,Se)}finally{lr=We,oi.transition=Xe}}function Ws(le,ue,me,Se){if(si){var We=Si(le,ue,me,Se);if(We===null)Nl(le,ue,Se,ms,me),Wr(le,Se);else if(ml(We,le,ue,me,Se))Se.stopPropagation();else if(Wr(le,Se),ue&4&&-1<Al.indexOf(le)){for(;We!==null;){var Xe=Qo(We);if(Xe!==null&&hs(Xe),Xe=Si(le,ue,me,Se),Xe===null&&Nl(le,ue,Se,ms,me),Xe===We)break;We=Xe}We!==null&&Se.stopPropagation()}else Nl(le,ue,Se,null,me)}}var ms=null;function Si(le,ue,me,Se){if(ms=null,le=vt(Se),le=ws(le),le!==null)if(ue=st(le),ue===null)le=null;else if(me=ue.tag,me===13){if(le=yt(ue),le!==null)return le;le=null}else if(me===3){if(ue.stateNode.current.memoizedState.isDehydrated)return ue.tag===3?ue.stateNode.containerInfo:null;le=null}else ue!==le&&(le=null);return ms=le,null}function bs(le){switch(le){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Bt()){case Xt:return 1;case Qt:return 4;case sn:case cn:return 16;case Bn:return 536870912;default:return 16}default:return 16}}var Hi=null,ko=null,ai=null;function ei(){if(ai)return ai;var le,ue=ko,me=ue.length,Se,We="value"in Hi?Hi.value:Hi.textContent,Xe=We.length;for(le=0;le<me&&ue[le]===We[le];le++);var nt=me-le;for(Se=1;Se<=nt&&ue[me-Se]===We[Xe-Se];Se++);return ai=We.slice(le,1<Se?1-Se:void 0)}function Yo(le){var ue=le.keyCode;return"charCode"in le?(le=le.charCode,le===0&&ue===13&&(le=13)):le=ue,le===10&&(le=13),32<=le||le===13?le:0}function Xi(){return!0}function Ko(){return!1}function li(le){function ue(me,Se,We,Xe,nt){this._reactName=me,this._targetInst=We,this.type=Se,this.nativeEvent=Xe,this.target=nt,this.currentTarget=null;for(var Ct in le)le.hasOwnProperty(Ct)&&(me=le[Ct],this[Ct]=me?me(Xe):Xe[Ct]);return this.isDefaultPrevented=(Xe.defaultPrevented!=null?Xe.defaultPrevented:Xe.returnValue===!1)?Xi:Ko,this.isPropagationStopped=Ko,this}return Pe(ue.prototype,{preventDefault:function(){this.defaultPrevented=!0;var me=this.nativeEvent;me&&(me.preventDefault?me.preventDefault():typeof me.returnValue!="unknown"&&(me.returnValue=!1),this.isDefaultPrevented=Xi)},stopPropagation:function(){var me=this.nativeEvent;me&&(me.stopPropagation?me.stopPropagation():typeof me.cancelBubble!="unknown"&&(me.cancelBubble=!0),this.isPropagationStopped=Xi)},persist:function(){},isPersistent:Xi}),ue}var Do={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(le){return le.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Jr=li(Do),ti=Pe({},Do,{view:0,detail:0}),Pr=li(ti),Hr,Ei,go,ga=Pe({},ti,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:vs,button:0,buttons:0,relatedTarget:function(le){return le.relatedTarget===void 0?le.fromElement===le.srcElement?le.toElement:le.fromElement:le.relatedTarget},movementX:function(le){return"movementX"in le?le.movementX:(le!==go&&(go&&le.type==="mousemove"?(Hr=le.screenX-go.screenX,Ei=le.screenY-go.screenY):Ei=Hr=0,go=le),Hr)},movementY:function(le){return"movementY"in le?le.movementY:Ei}}),lg=li(ga),zo=Pe({},ga,{dataTransfer:0}),ys=li(zo),bl=Pe({},ti,{relatedTarget:0}),yl=li(bl),vl=Pe({},Do,{animationName:0,elapsedTime:0,pseudoElement:0}),qg=li(vl),ec=Pe({},Do,{clipboardData:function(le){return"clipboardData"in le?le.clipboardData:window.clipboardData}}),gg=li(ec),Bl=Pe({},Do,{data:0}),cg=li(Bl),tc={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},nc={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},ug={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function ca(le){var ue=this.nativeEvent;return ue.getModifierState?ue.getModifierState(le):(le=ug[le])?!!ue[le]:!1}function vs(){return ca}var Gl=Pe({},ti,{key:function(le){if(le.key){var ue=tc[le.key]||le.key;if(ue!=="Unidentified")return ue}return le.type==="keypress"?(le=Yo(le),le===13?"Enter":String.fromCharCode(le)):le.type==="keydown"||le.type==="keyup"?nc[le.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:vs,charCode:function(le){return le.type==="keypress"?Yo(le):0},keyCode:function(le){return le.type==="keydown"||le.type==="keyup"?le.keyCode:0},which:function(le){return le.type==="keypress"?Yo(le):le.type==="keydown"||le.type==="keyup"?le.keyCode:0}}),Sl=li(Gl),co=Pe({},ga,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Oi=li(co),Vs=Pe({},ti,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:vs}),Uo=li(Vs),Po=Pe({},Do,{propertyName:0,elapsedTime:0,pseudoElement:0}),Ts=li(Po),rc=Pe({},ga,{deltaX:function(le){return"deltaX"in le?le.deltaX:"wheelDeltaX"in le?-le.wheelDeltaX:0},deltaY:function(le){return"deltaY"in le?le.deltaY:"wheelDeltaY"in le?-le.wheelDeltaY:"wheelDelta"in le?-le.wheelDelta:0},deltaZ:0,deltaMode:0}),dg=li(rc),pg=[9,13,27,32],Mi=oe&&"CompositionEvent"in window,Ci=null;oe&&"documentMode"in document&&(Ci=document.documentMode);var Vr=oe&&"TextEvent"in window&&!Ci,ua=oe&&(!Mi||Ci&&8<Ci&&11>=Ci),uo=" ",Ig=!1;function hg(le,ue){switch(le){case"keyup":return pg.indexOf(ue.keyCode)!==-1;case"keydown":return ue.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Rl(le){return le=le.detail,typeof le=="object"&&"data"in le?le.data:null}var Bs=!1;function ic(le,ue){switch(le){case"compositionend":return Rl(ue);case"keypress":return ue.which!==32?null:(Ig=!0,uo);case"textInput":return le=ue.data,le===uo&&Ig?null:le;default:return null}}function La(le,ue){if(Bs)return le==="compositionend"||!Mi&&hg(le,ue)?(le=ei(),ai=ko=Hi=null,Bs=!1,le):null;switch(le){case"paste":return null;case"keypress":if(!(ue.ctrlKey||ue.altKey||ue.metaKey)||ue.ctrlKey&&ue.altKey){if(ue.char&&1<ue.char.length)return ue.char;if(ue.which)return String.fromCharCode(ue.which)}return null;case"compositionend":return ua&&ue.locale!=="ko"?null:ue.data;default:return null}}var da={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function wl(le){var ue=le&&le.nodeName&&le.nodeName.toLowerCase();return ue==="input"?!!da[le.type]:ue==="textarea"}function pa(le,ue,me,Se){an(Se),ue=Ll(ue,"onChange"),0<ue.length&&(me=new Jr("onChange","change",null,me,Se),le.push({event:me,listeners:ue}))}var Gs=null,Ia=null;function oc(le){Aa(le,0)}function Oo(le){var ue=Or(le);if(mt(ue))return le}function sc(le,ue){if(le==="change")return ue}var ha=!1;if(oe){var ki;if(oe){var Ns="oninput"in document;if(!Ns){var Ls=document.createElement("div");Ls.setAttribute("oninput","return;"),Ns=typeof Ls.oninput=="function"}ki=Ns}else ki=!1;ha=ki&&(!document.documentMode||9<document.documentMode)}function bo(){Gs&&(Gs.detachEvent("onpropertychange",xl),Ia=Gs=null)}function xl(le){if(le.propertyName==="value"&&Oo(Ia)){var ue=[];pa(ue,Ia,le,vt(le)),Ir(oc,ue)}}function Ca(le,ue,me){le==="focusin"?(bo(),Gs=ue,Ia=me,Gs.attachEvent("onpropertychange",xl)):le==="focusout"&&bo()}function ac(le){if(le==="selectionchange"||le==="keyup"||le==="keydown")return Oo(Ia)}function Cg(le,ue){if(le==="click")return Oo(ue)}function Xr(le,ue){if(le==="input"||le==="change")return Oo(ue)}function Zl(le,ue){return le===ue&&(le!==0||1/le===1/ue)||le!==le&&ue!==ue}var ji=typeof Object.is=="function"?Object.is:Zl;function Hs(le,ue){if(ji(le,ue))return!0;if(typeof le!="object"||le===null||typeof ue!="object"||ue===null)return!1;var me=Object.keys(le),Se=Object.keys(ue);if(me.length!==Se.length)return!1;for(Se=0;Se<me.length;Se++){var We=me[Se];if(!se.call(ue,We)||!ji(le[We],ue[We]))return!1}return!0}function Ha(le){for(;le&&le.firstChild;)le=le.firstChild;return le}function Ji(le,ue){var me=Ha(le);le=0;for(var Se;me;){if(me.nodeType===3){if(Se=le+me.textContent.length,le<=ue&&Se>=ue)return{node:me,offset:ue-le};le=Se}e:{for(;me;){if(me.nextSibling){me=me.nextSibling;break e}me=me.parentNode}me=void 0}me=Ha(me)}}function Xs(le,ue){return le&&ue?le===ue?!0:le&&le.nodeType===3?!1:ue&&ue.nodeType===3?Xs(le,ue.parentNode):"contains"in le?le.contains(ue):le.compareDocumentPosition?!!(le.compareDocumentPosition(ue)&16):!1:!1}function kr(){for(var le=window,ue=Ft();ue instanceof le.HTMLIFrameElement;){try{var me=typeof ue.contentWindow.location.href=="string"}catch{me=!1}if(me)le=ue.contentWindow;else break;ue=Ft(le.document)}return ue}function gi(le){var ue=le&&le.nodeName&&le.nodeName.toLowerCase();return ue&&(ue==="input"&&(le.type==="text"||le.type==="search"||le.type==="tel"||le.type==="url"||le.type==="password")||ue==="textarea"||le.contentEditable==="true")}function ci(le){var ue=kr(),me=le.focusedElem,Se=le.selectionRange;if(ue!==me&&me&&me.ownerDocument&&Xs(me.ownerDocument.documentElement,me)){if(Se!==null&&gi(me)){if(ue=Se.start,le=Se.end,le===void 0&&(le=ue),"selectionStart"in me)me.selectionStart=ue,me.selectionEnd=Math.min(le,me.value.length);else if(le=(ue=me.ownerDocument||document)&&ue.defaultView||window,le.getSelection){le=le.getSelection();var We=me.textContent.length,Xe=Math.min(Se.start,We);Se=Se.end===void 0?Xe:Math.min(Se.end,We),!le.extend&&Xe>Se&&(We=Se,Se=Xe,Xe=We),We=Ji(me,Xe);var nt=Ji(me,Se);We&&nt&&(le.rangeCount!==1||le.anchorNode!==We.node||le.anchorOffset!==We.offset||le.focusNode!==nt.node||le.focusOffset!==nt.offset)&&(ue=ue.createRange(),ue.setStart(We.node,We.offset),le.removeAllRanges(),Xe>Se?(le.addRange(ue),le.extend(nt.node,nt.offset)):(ue.setEnd(nt.node,nt.offset),le.addRange(ue)))}}for(ue=[],le=me;le=le.parentNode;)le.nodeType===1&&ue.push({element:le,left:le.scrollLeft,top:le.scrollTop});for(typeof me.focus=="function"&&me.focus(),me=0;me<ue.length;me++)le=ue[me],le.element.scrollLeft=le.left,le.element.scrollTop=le.top}}var _l=oe&&"documentMode"in document&&11>=document.documentMode,Mo=null,ks=null,Xa=null,ui=!1;function El(le,ue,me){var Se=me.window===me?me.document:me.nodeType===9?me:me.ownerDocument;ui||Mo==null||Mo!==Ft(Se)||(Se=Mo,"selectionStart"in Se&&gi(Se)?Se={start:Se.selectionStart,end:Se.selectionEnd}:(Se=(Se.ownerDocument&&Se.ownerDocument.defaultView||window).getSelection(),Se={anchorNode:Se.anchorNode,anchorOffset:Se.anchorOffset,focusNode:Se.focusNode,focusOffset:Se.focusOffset}),Xa&&Hs(Xa,Se)||(Xa=Se,Se=Ll(ks,"onSelect"),0<Se.length&&(ue=new Jr("onSelect","select",null,ue,me),le.push({event:ue,listeners:Se}),ue.target=Mo)))}function fa(le,ue){var me={};return me[le.toLowerCase()]=ue.toLowerCase(),me["Webkit"+le]="webkit"+ue,me["Moz"+le]="moz"+ue,me}var Ss={animationend:fa("Animation","AnimationEnd"),animationiteration:fa("Animation","AnimationIteration"),animationstart:fa("Animation","AnimationStart"),transitionend:fa("Transition","TransitionEnd")},yo={},vo={};oe&&(vo=document.createElement("div").style,"AnimationEvent"in window||(delete Ss.animationend.animation,delete Ss.animationiteration.animation,delete Ss.animationstart.animation),"TransitionEvent"in window||delete Ss.transitionend.transition);function Fo(le){if(yo[le])return yo[le];if(!Ss[le])return le;var ue=Ss[le],me;for(me in ue)if(ue.hasOwnProperty(me)&&me in vo)return yo[le]=ue[me];return le}var ka=Fo("animationend"),Ya=Fo("animationiteration"),fg=Fo("animationstart"),Ag=Fo("transitionend"),mg=new Map,bg="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function jo(le,ue){mg.set(le,ue),ne(ue,[le])}for(var Ml=0;Ml<bg.length;Ml++){var Ka=bg[Ml],Da=Ka.toLowerCase(),lc=Ka[0].toUpperCase()+Ka.slice(1);jo(Da,"on"+lc)}jo(ka,"onAnimationEnd"),jo(Ya,"onAnimationIteration"),jo(fg,"onAnimationStart"),jo("dblclick","onDoubleClick"),jo("focusin","onFocus"),jo("focusout","onBlur"),jo(Ag,"onTransitionEnd"),ie("onMouseEnter",["mouseout","mouseover"]),ie("onMouseLeave",["mouseout","mouseover"]),ie("onPointerEnter",["pointerout","pointerover"]),ie("onPointerLeave",["pointerout","pointerover"]),ne("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),ne("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),ne("onBeforeInput",["compositionend","keypress","textInput","paste"]),ne("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),ne("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),ne("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Rs="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Fl=new Set("cancel close invalid load scroll toggle".split(" ").concat(Rs));function Wl(le,ue,me){var Se=le.type||"unknown-event";le.currentTarget=me,je(Se,ue,void 0,le),le.currentTarget=null}function Aa(le,ue){ue=(ue&4)!==0;for(var me=0;me<le.length;me++){var Se=le[me],We=Se.event;Se=Se.listeners;e:{var Xe=void 0;if(ue)for(var nt=Se.length-1;0<=nt;nt--){var Ct=Se[nt],Gt=Ct.instance,Pt=Ct.currentTarget;if(Ct=Ct.listener,Gt!==Xe&&We.isPropagationStopped())break e;Wl(We,Ct,Pt),Xe=Gt}else for(nt=0;nt<Se.length;nt++){if(Ct=Se[nt],Gt=Ct.instance,Pt=Ct.currentTarget,Ct=Ct.listener,Gt!==Xe&&We.isPropagationStopped())break e;Wl(We,Ct,Pt),Xe=Gt}}}if(_r)throw le=Un,_r=!1,Un=null,le}function wr(le,ue){var me=ue[Ds];me===void 0&&(me=ue[Ds]=new Set);var Se=le+"__bubble";me.has(Se)||(Tl(ue,le,2,!1),me.add(Se))}function Vl(le,ue,me){var Se=0;ue&&(Se|=4),Tl(me,le,Se,ue)}var za="_reactListening"+Math.random().toString(36).slice(2);function ma(le){if(!le[za]){le[za]=!0,K.forEach(function(me){me!=="selectionchange"&&(Fl.has(me)||Vl(me,!1,le),Vl(me,!0,le))});var ue=le.nodeType===9?le:le.ownerDocument;ue===null||ue[za]||(ue[za]=!0,Vl("selectionchange",!1,ue))}}function Tl(le,ue,me,Se){switch(bs(ue)){case 1:var We=Eo;break;case 4:We=lo;break;default:We=Ws}me=We.bind(null,ue,me,le),We=void 0,!vr||ue!=="touchstart"&&ue!=="touchmove"&&ue!=="wheel"||(We=!0),Se?We!==void 0?le.addEventListener(ue,me,{capture:!0,passive:We}):le.addEventListener(ue,me,!0):We!==void 0?le.addEventListener(ue,me,{passive:We}):le.addEventListener(ue,me,!1)}function Nl(le,ue,me,Se,We){var Xe=Se;if(!(ue&1)&&!(ue&2)&&Se!==null)e:for(;;){if(Se===null)return;var nt=Se.tag;if(nt===3||nt===4){var Ct=Se.stateNode.containerInfo;if(Ct===We||Ct.nodeType===8&&Ct.parentNode===We)break;if(nt===4)for(nt=Se.return;nt!==null;){var Gt=nt.tag;if((Gt===3||Gt===4)&&(Gt=nt.stateNode.containerInfo,Gt===We||Gt.nodeType===8&&Gt.parentNode===We))return;nt=nt.return}for(;Ct!==null;){if(nt=ws(Ct),nt===null)return;if(Gt=nt.tag,Gt===5||Gt===6){Se=Xe=nt;continue e}Ct=Ct.parentNode}}Se=Se.return}Ir(function(){var Pt=Xe,Cn=vt(me),An=[];e:{var hn=mg.get(le);if(hn!==void 0){var Fn=Jr,Xn=le;switch(le){case"keypress":if(Yo(me)===0)break e;case"keydown":case"keyup":Fn=Sl;break;case"focusin":Xn="focus",Fn=yl;break;case"focusout":Xn="blur",Fn=yl;break;case"beforeblur":case"afterblur":Fn=yl;break;case"click":if(me.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":Fn=lg;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":Fn=ys;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":Fn=Uo;break;case ka:case Ya:case fg:Fn=qg;break;case Ag:Fn=Ts;break;case"scroll":Fn=Pr;break;case"wheel":Fn=dg;break;case"copy":case"cut":case"paste":Fn=gg;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":Fn=Oi}var Yn=(ue&4)!==0,ri=!Yn&&le==="scroll",Nt=Yn?hn!==null?hn+"Capture":null:hn;Yn=[];for(var Rt=Pt,kt;Rt!==null;){kt=Rt;var vn=kt.stateNode;if(kt.tag===5&&vn!==null&&(kt=vn,Nt!==null&&(vn=dr(Rt,Nt),vn!=null&&Yn.push(ba(Rt,vn,kt)))),ri)break;Rt=Rt.return}0<Yn.length&&(hn=new Fn(hn,Xn,null,me,Cn),An.push({event:hn,listeners:Yn}))}}if(!(ue&7)){e:{if(hn=le==="mouseover"||le==="pointerover",Fn=le==="mouseout"||le==="pointerout",hn&&me!==Tn&&(Xn=me.relatedTarget||me.fromElement)&&(ws(Xn)||Xn[Qi]))break e;if((Fn||hn)&&(hn=Cn.window===Cn?Cn:(hn=Cn.ownerDocument)?hn.defaultView||hn.parentWindow:window,Fn?(Xn=me.relatedTarget||me.toElement,Fn=Pt,Xn=Xn?ws(Xn):null,Xn!==null&&(ri=st(Xn),Xn!==ri||Xn.tag!==5&&Xn.tag!==6)&&(Xn=null)):(Fn=null,Xn=Pt),Fn!==Xn)){if(Yn=lg,vn="onMouseLeave",Nt="onMouseEnter",Rt="mouse",(le==="pointerout"||le==="pointerover")&&(Yn=Oi,vn="onPointerLeave",Nt="onPointerEnter",Rt="pointer"),ri=Fn==null?hn:Or(Fn),kt=Xn==null?hn:Or(Xn),hn=new Yn(vn,Rt+"leave",Fn,me,Cn),hn.target=ri,hn.relatedTarget=kt,vn=null,ws(Cn)===Pt&&(Yn=new Yn(Nt,Rt+"enter",Xn,me,Cn),Yn.target=kt,Yn.relatedTarget=ri,vn=Yn),ri=vn,Fn&&Xn)t:{for(Yn=Fn,Nt=Xn,Rt=0,kt=Yn;kt;kt=Ys(kt))Rt++;for(kt=0,vn=Nt;vn;vn=Ys(vn))kt++;for(;0<Rt-kt;)Yn=Ys(Yn),Rt--;for(;0<kt-Rt;)Nt=Ys(Nt),kt--;for(;Rt--;){if(Yn===Nt||Nt!==null&&Yn===Nt.alternate)break t;Yn=Ys(Yn),Nt=Ys(Nt)}Yn=null}else Yn=null;Fn!==null&&gc(An,hn,Fn,Yn,!1),Xn!==null&&ri!==null&&gc(An,ri,Xn,Yn,!0)}}e:{if(hn=Pt?Or(Pt):window,Fn=hn.nodeName&&hn.nodeName.toLowerCase(),Fn==="select"||Fn==="input"&&hn.type==="file")var zn=sc;else if(wl(hn))if(ha)zn=Xr;else{zn=ac;var $n=Ca}else(Fn=hn.nodeName)&&Fn.toLowerCase()==="input"&&(hn.type==="checkbox"||hn.type==="radio")&&(zn=Cg);if(zn&&(zn=zn(le,Pt))){pa(An,zn,me,Cn);break e}$n&&$n(le,hn,Pt),le==="focusout"&&($n=hn._wrapperState)&&$n.controlled&&hn.type==="number"&&Ot(hn,"number",hn.value)}switch($n=Pt?Or(Pt):window,le){case"focusin":(wl($n)||$n.contentEditable==="true")&&(Mo=$n,ks=Pt,Xa=null);break;case"focusout":Xa=ks=Mo=null;break;case"mousedown":ui=!0;break;case"contextmenu":case"mouseup":case"dragend":ui=!1,El(An,me,Cn);break;case"selectionchange":if(_l)break;case"keydown":case"keyup":El(An,me,Cn)}var qn;if(Mi)e:{switch(le){case"compositionstart":var ir="onCompositionStart";break e;case"compositionend":ir="onCompositionEnd";break e;case"compositionupdate":ir="onCompositionUpdate";break e}ir=void 0}else Bs?hg(le,me)&&(ir="onCompositionEnd"):le==="keydown"&&me.keyCode===229&&(ir="onCompositionStart");ir&&(ua&&me.locale!=="ko"&&(Bs||ir!=="onCompositionStart"?ir==="onCompositionEnd"&&Bs&&(qn=ei()):(Hi=Cn,ko="value"in Hi?Hi.value:Hi.textContent,Bs=!0)),$n=Ll(Pt,ir),0<$n.length&&(ir=new cg(ir,le,null,me,Cn),An.push({event:ir,listeners:$n}),qn?ir.data=qn:(qn=Rl(me),qn!==null&&(ir.data=qn)))),(qn=Vr?ic(le,me):La(le,me))&&(Pt=Ll(Pt,"onBeforeInput"),0<Pt.length&&(Cn=new cg("onBeforeInput","beforeinput",null,me,Cn),An.push({event:Cn,listeners:Pt}),Cn.data=qn))}Aa(An,ue)})}function ba(le,ue,me){return{instance:le,listener:ue,currentTarget:me}}function Ll(le,ue){for(var me=ue+"Capture",Se=[];le!==null;){var We=le,Xe=We.stateNode;We.tag===5&&Xe!==null&&(We=Xe,Xe=dr(le,me),Xe!=null&&Se.unshift(ba(le,Xe,We)),Xe=dr(le,ue),Xe!=null&&Se.push(ba(le,Xe,We))),le=le.return}return Se}function Ys(le){if(le===null)return null;do le=le.return;while(le&&le.tag!==5);return le||null}function gc(le,ue,me,Se,We){for(var Xe=ue._reactName,nt=[];me!==null&&me!==Se;){var Ct=me,Gt=Ct.alternate,Pt=Ct.stateNode;if(Gt!==null&&Gt===Se)break;Ct.tag===5&&Pt!==null&&(Ct=Pt,We?(Gt=dr(me,Xe),Gt!=null&&nt.unshift(ba(me,Gt,Ct))):We||(Gt=dr(me,Xe),Gt!=null&&nt.push(ba(me,Gt,Ct)))),me=me.return}nt.length!==0&&le.push({event:ue,listeners:nt})}var Kc=/\r\n?/g,cc=/\u0000|\uFFFD/g;function yg(le){return(typeof le=="string"?le:""+le).replace(Kc,`
`).replace(cc,"")}function Ua(le,ue,me){if(ue=yg(ue),yg(le)!==ue&&me)throw Error(_(425))}function Pa(){}var ya=null,vg=null;function Bg(le,ue){return le==="textarea"||le==="noscript"||typeof ue.children=="string"||typeof ue.children=="number"||typeof ue.dangerouslySetInnerHTML=="object"&&ue.dangerouslySetInnerHTML!==null&&ue.dangerouslySetInnerHTML.__html!=null}var Gg=typeof setTimeout=="function"?setTimeout:void 0,Sg=typeof clearTimeout=="function"?clearTimeout:void 0,Hl=typeof Promise=="function"?Promise:void 0,Dc=typeof queueMicrotask=="function"?queueMicrotask:typeof Hl<"u"?function(le){return Hl.resolve(null).then(le).catch(uc)}:Gg;function uc(le){setTimeout(function(){throw le})}function Xl(le,ue){var me=ue,Se=0;do{var We=me.nextSibling;if(le.removeChild(me),We&&We.nodeType===8)if(me=We.data,me==="/$"){if(Se===0){le.removeChild(We),As(ue);return}Se--}else me!=="$"&&me!=="$?"&&me!=="$!"||Se++;me=We}while(me);As(ue)}function Jo(le){for(;le!=null;le=le.nextSibling){var ue=le.nodeType;if(ue===1||ue===3)break;if(ue===8){if(ue=le.data,ue==="$"||ue==="$!"||ue==="$?")break;if(ue==="/$")return null}}return le}function Rg(le){le=le.previousSibling;for(var ue=0;le;){if(le.nodeType===8){var me=le.data;if(me==="$"||me==="$!"||me==="$?"){if(ue===0)return le;ue--}else me==="/$"&&ue++}le=le.previousSibling}return null}var Ks=Math.random().toString(36).slice(2),ni="__reactFiber$"+Ks,va="__reactProps$"+Ks,Qi="__reactContainer$"+Ks,Ds="__reactEvents$"+Ks,kl="__reactListeners$"+Ks,Yl="__reactHandles$"+Ks;function ws(le){var ue=le[ni];if(ue)return ue;for(var me=le.parentNode;me;){if(ue=me[Qi]||me[ni]){if(me=ue.alternate,ue.child!==null||me!==null&&me.child!==null)for(le=Rg(le);le!==null;){if(me=le[ni])return me;le=Rg(le)}return ue}le=me,me=le.parentNode}return null}function Qo(le){return le=le[ni]||le[Qi],!le||le.tag!==5&&le.tag!==6&&le.tag!==13&&le.tag!==3?null:le}function Or(le){if(le.tag===5||le.tag===6)return le.stateNode;throw Error(_(33))}function Kl(le){return le[va]||null}var wg=[],di=-1;function Dr(le){return{current:le}}function xr(le){0>di||(le.current=wg[di],wg[di]=null,di--)}function Sr(le,ue){di++,wg[di]=le.current,le.current=ue}var $o={},fi=Dr($o),Fi=Dr(!1),qo=$o;function zs(le,ue){var me=le.type.contextTypes;if(!me)return $o;var Se=le.stateNode;if(Se&&Se.__reactInternalMemoizedUnmaskedChildContext===ue)return Se.__reactInternalMemoizedMaskedChildContext;var We={},Xe;for(Xe in me)We[Xe]=ue[Xe];return Se&&(le=le.stateNode,le.__reactInternalMemoizedUnmaskedChildContext=ue,le.__reactInternalMemoizedMaskedChildContext=We),We}function Ri(le){return le=le.childContextTypes,le!=null}function Oa(){xr(Fi),xr(fi)}function xg(le,ue,me){if(fi.current!==$o)throw Error(_(168));Sr(fi,ue),Sr(Fi,me)}function ja(le,ue,me){var Se=le.stateNode;if(ue=ue.childContextTypes,typeof Se.getChildContext!="function")return me;Se=Se.getChildContext();for(var We in Se)if(!(We in ue))throw Error(_(108,dt(le)||"Unknown",We));return Pe({},me,Se)}function Us(le){return le=(le=le.stateNode)&&le.__reactInternalMemoizedMergedChildContext||$o,qo=fi.current,Sr(fi,le),Sr(Fi,Fi.current),!0}function Zg(le,ue,me){var Se=le.stateNode;if(!Se)throw Error(_(169));me?(le=ja(le,ue,qo),Se.__reactInternalMemoizedMergedChildContext=le,xr(Fi),xr(fi),Sr(fi,le)):xr(Fi),Sr(Fi,me)}var Bo=null,Ja=!1,Dl=!1;function Qa(le){Bo===null?Bo=[le]:Bo.push(le)}function dc(le){Ja=!0,Qa(le)}function Wo(){if(!Dl&&Bo!==null){Dl=!0;var le=0,ue=lr;try{var me=Bo;for(lr=1;le<me.length;le++){var Se=me[le];do Se=Se(!0);while(Se!==null)}Bo=null,Ja=!1}catch(We){throw Bo!==null&&(Bo=Bo.slice(le+1)),pn(Xt,Wo),We}finally{lr=ue,Dl=!1}}return null}var Ps=[],Yi=0,zl=null,Ul=0,Wi=[],pi=0,Os=null,Rn=1,po="";function ns(le,ue){Ps[Yi++]=Ul,Ps[Yi++]=zl,zl=le,Ul=ue}function _g(le,ue,me){Wi[pi++]=Rn,Wi[pi++]=po,Wi[pi++]=Os,Os=le;var Se=Rn;le=po;var We=32-wn(Se)-1;Se&=~(1<<We),me+=1;var Xe=32-wn(ue)+We;if(30<Xe){var nt=We-We%5;Xe=(Se&(1<<nt)-1).toString(32),Se>>=nt,We-=nt,Rn=1<<32-wn(ue)+We|me<<We|Se,po=Xe+le}else Rn=1<<Xe|me<<We|Se,po=le}function Eg(le){le.return!==null&&(ns(le,1),_g(le,1,0))}function rs(le){for(;le===zl;)zl=Ps[--Yi],Ps[Yi]=null,Ul=Ps[--Yi],Ps[Yi]=null;for(;le===Os;)Os=Wi[--pi],Wi[pi]=null,po=Wi[--pi],Wi[pi]=null,Rn=Wi[--pi],Wi[pi]=null}var Ai=null,Vi=null,Er=!1,Io=null;function Mg(le,ue){var me=Ho(5,null,null,0);me.elementType="DELETED",me.stateNode=ue,me.return=le,ue=le.deletions,ue===null?(le.deletions=[me],le.flags|=16):ue.push(me)}function Fg(le,ue){switch(le.tag){case 5:var me=le.type;return ue=ue.nodeType!==1||me.toLowerCase()!==ue.nodeName.toLowerCase()?null:ue,ue!==null?(le.stateNode=ue,Ai=le,Vi=Jo(ue.firstChild),!0):!1;case 6:return ue=le.pendingProps===""||ue.nodeType!==3?null:ue,ue!==null?(le.stateNode=ue,Ai=le,Vi=null,!0):!1;case 13:return ue=ue.nodeType!==8?null:ue,ue!==null?(me=Os!==null?{id:Rn,overflow:po}:null,le.memoizedState={dehydrated:ue,treeContext:me,retryLane:1073741824},me=Ho(18,null,null,0),me.stateNode=ue,me.return=le,le.child=me,Ai=le,Vi=null,!0):!1;default:return!1}}function Pl(le){return(le.mode&1)!==0&&(le.flags&128)===0}function Ol(le){if(Er){var ue=Vi;if(ue){var me=ue;if(!Fg(le,ue)){if(Pl(le))throw Error(_(418));ue=Jo(me.nextSibling);var Se=Ai;ue&&Fg(le,ue)?Mg(Se,me):(le.flags=le.flags&-4097|2,Er=!1,Ai=le)}}else{if(Pl(le))throw Error(_(418));le.flags=le.flags&-4097|2,Er=!1,Ai=le}}}function jl(le){for(le=le.return;le!==null&&le.tag!==5&&le.tag!==3&&le.tag!==13;)le=le.return;Ai=le}function Ba(le){if(le!==Ai)return!1;if(!Er)return jl(le),Er=!0,!1;var ue;if((ue=le.tag!==3)&&!(ue=le.tag!==5)&&(ue=le.type,ue=ue!=="head"&&ue!=="body"&&!Bg(le.type,le.memoizedProps)),ue&&(ue=Vi)){if(Pl(le))throw Wg(),Error(_(418));for(;ue;)Mg(le,ue),ue=Jo(ue.nextSibling)}if(jl(le),le.tag===13){if(le=le.memoizedState,le=le!==null?le.dehydrated:null,!le)throw Error(_(317));e:{for(le=le.nextSibling,ue=0;le;){if(le.nodeType===8){var me=le.data;if(me==="/$"){if(ue===0){Vi=Jo(le.nextSibling);break e}ue--}else me!=="$"&&me!=="$!"&&me!=="$?"||ue++}le=le.nextSibling}Vi=null}}else Vi=Ai?Jo(le.stateNode.nextSibling):null;return!0}function Wg(){for(var le=Vi;le;)le=Jo(le.nextSibling)}function xs(){Vi=Ai=null,Er=!1}function Ga(le){Io===null?Io=[le]:Io.push(le)}var zc=Re.ReactCurrentBatchConfig;function $a(le,ue,me){if(le=me.ref,le!==null&&typeof le!="function"&&typeof le!="object"){if(me._owner){if(me=me._owner,me){if(me.tag!==1)throw Error(_(309));var Se=me.stateNode}if(!Se)throw Error(_(147,le));var We=Se,Xe=""+le;return ue!==null&&ue.ref!==null&&typeof ue.ref=="function"&&ue.ref._stringRef===Xe?ue.ref:(ue=function(nt){var Ct=We.refs;nt===null?delete Ct[Xe]:Ct[Xe]=nt},ue._stringRef=Xe,ue)}if(typeof le!="string")throw Error(_(284));if(!me._owner)throw Error(_(290,le))}return le}function qa(le,ue){throw le=Object.prototype.toString.call(ue),Error(_(31,le==="[object Object]"?"object with keys {"+Object.keys(ue).join(", ")+"}":le))}function Vg(le){var ue=le._init;return ue(le._payload)}function Tg(le){function ue(Nt,Rt){if(le){var kt=Nt.deletions;kt===null?(Nt.deletions=[Rt],Nt.flags|=16):kt.push(Rt)}}function me(Nt,Rt){if(!le)return null;for(;Rt!==null;)ue(Nt,Rt),Rt=Rt.sibling;return null}function Se(Nt,Rt){for(Nt=new Map;Rt!==null;)Rt.key!==null?Nt.set(Rt.key,Rt):Nt.set(Rt.index,Rt),Rt=Rt.sibling;return Nt}function We(Nt,Rt){return Nt=Ta(Nt,Rt),Nt.index=0,Nt.sibling=null,Nt}function Xe(Nt,Rt,kt){return Nt.index=kt,le?(kt=Nt.alternate,kt!==null?(kt=kt.index,kt<Rt?(Nt.flags|=2,Rt):kt):(Nt.flags|=2,Rt)):(Nt.flags|=1048576,Rt)}function nt(Nt){return le&&Nt.alternate===null&&(Nt.flags|=2),Nt}function Ct(Nt,Rt,kt,vn){return Rt===null||Rt.tag!==6?(Rt=cu(kt,Nt.mode,vn),Rt.return=Nt,Rt):(Rt=We(Rt,kt),Rt.return=Nt,Rt)}function Gt(Nt,Rt,kt,vn){var zn=kt.type;return zn===Ze?Cn(Nt,Rt,kt.props.children,vn,kt.key):Rt!==null&&(Rt.elementType===zn||typeof zn=="object"&&zn!==null&&zn.$$typeof===tt&&Vg(zn)===Rt.type)?(vn=We(Rt,kt.props),vn.ref=$a(Nt,Rt,kt),vn.return=Nt,vn):(vn=Vc(kt.type,kt.key,kt.props,null,Nt.mode,vn),vn.ref=$a(Nt,Rt,kt),vn.return=Nt,vn)}function Pt(Nt,Rt,kt,vn){return Rt===null||Rt.tag!==4||Rt.stateNode.containerInfo!==kt.containerInfo||Rt.stateNode.implementation!==kt.implementation?(Rt=uu(kt,Nt.mode,vn),Rt.return=Nt,Rt):(Rt=We(Rt,kt.children||[]),Rt.return=Nt,Rt)}function Cn(Nt,Rt,kt,vn,zn){return Rt===null||Rt.tag!==7?(Rt=Cl(kt,Nt.mode,vn,zn),Rt.return=Nt,Rt):(Rt=We(Rt,kt),Rt.return=Nt,Rt)}function An(Nt,Rt,kt){if(typeof Rt=="string"&&Rt!==""||typeof Rt=="number")return Rt=cu(""+Rt,Nt.mode,kt),Rt.return=Nt,Rt;if(typeof Rt=="object"&&Rt!==null){switch(Rt.$$typeof){case Ve:return kt=Vc(Rt.type,Rt.key,Rt.props,null,Nt.mode,kt),kt.ref=$a(Nt,null,Rt),kt.return=Nt,kt;case Ee:return Rt=uu(Rt,Nt.mode,kt),Rt.return=Nt,Rt;case tt:var vn=Rt._init;return An(Nt,vn(Rt._payload),kt)}if(Tt(Rt)||qe(Rt))return Rt=Cl(Rt,Nt.mode,kt,null),Rt.return=Nt,Rt;qa(Nt,Rt)}return null}function hn(Nt,Rt,kt,vn){var zn=Rt!==null?Rt.key:null;if(typeof kt=="string"&&kt!==""||typeof kt=="number")return zn!==null?null:Ct(Nt,Rt,""+kt,vn);if(typeof kt=="object"&&kt!==null){switch(kt.$$typeof){case Ve:return kt.key===zn?Gt(Nt,Rt,kt,vn):null;case Ee:return kt.key===zn?Pt(Nt,Rt,kt,vn):null;case tt:return zn=kt._init,hn(Nt,Rt,zn(kt._payload),vn)}if(Tt(kt)||qe(kt))return zn!==null?null:Cn(Nt,Rt,kt,vn,null);qa(Nt,kt)}return null}function Fn(Nt,Rt,kt,vn,zn){if(typeof vn=="string"&&vn!==""||typeof vn=="number")return Nt=Nt.get(kt)||null,Ct(Rt,Nt,""+vn,zn);if(typeof vn=="object"&&vn!==null){switch(vn.$$typeof){case Ve:return Nt=Nt.get(vn.key===null?kt:vn.key)||null,Gt(Rt,Nt,vn,zn);case Ee:return Nt=Nt.get(vn.key===null?kt:vn.key)||null,Pt(Rt,Nt,vn,zn);case tt:var $n=vn._init;return Fn(Nt,Rt,kt,$n(vn._payload),zn)}if(Tt(vn)||qe(vn))return Nt=Nt.get(kt)||null,Cn(Rt,Nt,vn,zn,null);qa(Rt,vn)}return null}function Xn(Nt,Rt,kt,vn){for(var zn=null,$n=null,qn=Rt,ir=Rt=0,_i=null;qn!==null&&ir<kt.length;ir++){qn.index>ir?(_i=qn,qn=null):_i=qn.sibling;var mr=hn(Nt,qn,kt[ir],vn);if(mr===null){qn===null&&(qn=_i);break}le&&qn&&mr.alternate===null&&ue(Nt,qn),Rt=Xe(mr,Rt,ir),$n===null?zn=mr:$n.sibling=mr,$n=mr,qn=_i}if(ir===kt.length)return me(Nt,qn),Er&&ns(Nt,ir),zn;if(qn===null){for(;ir<kt.length;ir++)qn=An(Nt,kt[ir],vn),qn!==null&&(Rt=Xe(qn,Rt,ir),$n===null?zn=qn:$n.sibling=qn,$n=qn);return Er&&ns(Nt,ir),zn}for(qn=Se(Nt,qn);ir<kt.length;ir++)_i=Fn(qn,Nt,ir,kt[ir],vn),_i!==null&&(le&&_i.alternate!==null&&qn.delete(_i.key===null?ir:_i.key),Rt=Xe(_i,Rt,ir),$n===null?zn=_i:$n.sibling=_i,$n=_i);return le&&qn.forEach(function(Na){return ue(Nt,Na)}),Er&&ns(Nt,ir),zn}function Yn(Nt,Rt,kt,vn){var zn=qe(kt);if(typeof zn!="function")throw Error(_(150));if(kt=zn.call(kt),kt==null)throw Error(_(151));for(var $n=zn=null,qn=Rt,ir=Rt=0,_i=null,mr=kt.next();qn!==null&&!mr.done;ir++,mr=kt.next()){qn.index>ir?(_i=qn,qn=null):_i=qn.sibling;var Na=hn(Nt,qn,mr.value,vn);if(Na===null){qn===null&&(qn=_i);break}le&&qn&&Na.alternate===null&&ue(Nt,qn),Rt=Xe(Na,Rt,ir),$n===null?zn=Na:$n.sibling=Na,$n=Na,qn=_i}if(mr.done)return me(Nt,qn),Er&&ns(Nt,ir),zn;if(qn===null){for(;!mr.done;ir++,mr=kt.next())mr=An(Nt,mr.value,vn),mr!==null&&(Rt=Xe(mr,Rt,ir),$n===null?zn=mr:$n.sibling=mr,$n=mr);return Er&&ns(Nt,ir),zn}for(qn=Se(Nt,qn);!mr.done;ir++,mr=kt.next())mr=Fn(qn,Nt,ir,mr.value,vn),mr!==null&&(le&&mr.alternate!==null&&qn.delete(mr.key===null?ir:mr.key),Rt=Xe(mr,Rt,ir),$n===null?zn=mr:$n.sibling=mr,$n=mr);return le&&qn.forEach(function(Ad){return ue(Nt,Ad)}),Er&&ns(Nt,ir),zn}function ri(Nt,Rt,kt,vn){if(typeof kt=="object"&&kt!==null&&kt.type===Ze&&kt.key===null&&(kt=kt.props.children),typeof kt=="object"&&kt!==null){switch(kt.$$typeof){case Ve:e:{for(var zn=kt.key,$n=Rt;$n!==null;){if($n.key===zn){if(zn=kt.type,zn===Ze){if($n.tag===7){me(Nt,$n.sibling),Rt=We($n,kt.props.children),Rt.return=Nt,Nt=Rt;break e}}else if($n.elementType===zn||typeof zn=="object"&&zn!==null&&zn.$$typeof===tt&&Vg(zn)===$n.type){me(Nt,$n.sibling),Rt=We($n,kt.props),Rt.ref=$a(Nt,$n,kt),Rt.return=Nt,Nt=Rt;break e}me(Nt,$n);break}else ue(Nt,$n);$n=$n.sibling}kt.type===Ze?(Rt=Cl(kt.props.children,Nt.mode,vn,kt.key),Rt.return=Nt,Nt=Rt):(vn=Vc(kt.type,kt.key,kt.props,null,Nt.mode,vn),vn.ref=$a(Nt,Rt,kt),vn.return=Nt,Nt=vn)}return nt(Nt);case Ee:e:{for($n=kt.key;Rt!==null;){if(Rt.key===$n)if(Rt.tag===4&&Rt.stateNode.containerInfo===kt.containerInfo&&Rt.stateNode.implementation===kt.implementation){me(Nt,Rt.sibling),Rt=We(Rt,kt.children||[]),Rt.return=Nt,Nt=Rt;break e}else{me(Nt,Rt);break}else ue(Nt,Rt);Rt=Rt.sibling}Rt=uu(kt,Nt.mode,vn),Rt.return=Nt,Nt=Rt}return nt(Nt);case tt:return $n=kt._init,ri(Nt,Rt,$n(kt._payload),vn)}if(Tt(kt))return Xn(Nt,Rt,kt,vn);if(qe(kt))return Yn(Nt,Rt,kt,vn);qa(Nt,kt)}return typeof kt=="string"&&kt!==""||typeof kt=="number"?(kt=""+kt,Rt!==null&&Rt.tag===6?(me(Nt,Rt.sibling),Rt=We(Rt,kt),Rt.return=Nt,Nt=Rt):(me(Nt,Rt),Rt=cu(kt,Nt.mode,vn),Rt.return=Nt,Nt=Rt),nt(Nt)):me(Nt,Rt)}return ri}var js=Tg(!0),el=Tg(!1),Js=Dr(null),Qs=null,os=null,Sa=null;function $s(){Sa=os=Qs=null}function tl(le){var ue=Js.current;xr(Js),le._currentValue=ue}function nl(le,ue,me){for(;le!==null;){var Se=le.alternate;if((le.childLanes&ue)!==ue?(le.childLanes|=ue,Se!==null&&(Se.childLanes|=ue)):Se!==null&&(Se.childLanes&ue)!==ue&&(Se.childLanes|=ue),le===me)break;le=le.return}}function Zs(le,ue){Qs=le,Sa=os=null,le=le.dependencies,le!==null&&le.firstContext!==null&&(le.lanes&ue&&(cr=!0),le.firstContext=null)}function $i(le){var ue=le._currentValue;if(Sa!==le)if(le={context:le,memoizedValue:ue,next:null},os===null){if(Qs===null)throw Error(_(308));os=le,Qs.dependencies={lanes:0,firstContext:le}}else os=os.next=le;return ue}var ss=null;function Ng(le){ss===null?ss=[le]:ss.push(le)}function rl(le,ue,me,Se){var We=ue.interleaved;return We===null?(me.next=me,Ng(ue)):(me.next=We.next,We.next=me),ue.interleaved=me,Go(le,Se)}function Go(le,ue){le.lanes|=ue;var me=le.alternate;for(me!==null&&(me.lanes|=ue),me=le,le=le.return;le!==null;)le.childLanes|=ue,me=le.alternate,me!==null&&(me.childLanes|=ue),me=le,le=le.return;return me.tag===3?me.stateNode:null}var Br=!1;function gr(le){le.updateQueue={baseState:le.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function jr(le,ue){le=le.updateQueue,ue.updateQueue===le&&(ue.updateQueue={baseState:le.baseState,firstBaseUpdate:le.firstBaseUpdate,lastBaseUpdate:le.lastBaseUpdate,shared:le.shared,effects:le.effects})}function Gr(le,ue){return{eventTime:le,lane:ue,tag:0,payload:null,callback:null,next:null}}function Tr(le,ue,me){var Se=le.updateQueue;if(Se===null)return null;if(Se=Se.shared,fr&2){var We=Se.pending;return We===null?ue.next=ue:(ue.next=We.next,We.next=ue),Se.pending=ue,Go(le,me)}return We=Se.interleaved,We===null?(ue.next=ue,Ng(Se)):(ue.next=We.next,We.next=ue),Se.interleaved=ue,Go(le,me)}function wi(le,ue,me){if(ue=ue.updateQueue,ue!==null&&(ue=ue.shared,(me&4194240)!==0)){var Se=ue.lanes;Se&=le.pendingLanes,me|=Se,ue.lanes=me,Rr(le,me)}}function qs(le,ue){var me=le.updateQueue,Se=le.alternate;if(Se!==null&&(Se=Se.updateQueue,me===Se)){var We=null,Xe=null;if(me=me.firstBaseUpdate,me!==null){do{var nt={eventTime:me.eventTime,lane:me.lane,tag:me.tag,payload:me.payload,callback:me.callback,next:null};Xe===null?We=Xe=nt:Xe=Xe.next=nt,me=me.next}while(me!==null);Xe===null?We=Xe=ue:Xe=Xe.next=ue}else We=Xe=ue;me={baseState:Se.baseState,firstBaseUpdate:We,lastBaseUpdate:Xe,shared:Se.shared,effects:Se.effects},le.updateQueue=me;return}le=me.lastBaseUpdate,le===null?me.firstBaseUpdate=ue:le.next=ue,me.lastBaseUpdate=ue}function zr(le,ue,me,Se){var We=le.updateQueue;Br=!1;var Xe=We.firstBaseUpdate,nt=We.lastBaseUpdate,Ct=We.shared.pending;if(Ct!==null){We.shared.pending=null;var Gt=Ct,Pt=Gt.next;Gt.next=null,nt===null?Xe=Pt:nt.next=Pt,nt=Gt;var Cn=le.alternate;Cn!==null&&(Cn=Cn.updateQueue,Ct=Cn.lastBaseUpdate,Ct!==nt&&(Ct===null?Cn.firstBaseUpdate=Pt:Ct.next=Pt,Cn.lastBaseUpdate=Gt))}if(Xe!==null){var An=We.baseState;nt=0,Cn=Pt=Gt=null,Ct=Xe;do{var hn=Ct.lane,Fn=Ct.eventTime;if((Se&hn)===hn){Cn!==null&&(Cn=Cn.next={eventTime:Fn,lane:0,tag:Ct.tag,payload:Ct.payload,callback:Ct.callback,next:null});e:{var Xn=le,Yn=Ct;switch(hn=ue,Fn=me,Yn.tag){case 1:if(Xn=Yn.payload,typeof Xn=="function"){An=Xn.call(Fn,An,hn);break e}An=Xn;break e;case 3:Xn.flags=Xn.flags&-65537|128;case 0:if(Xn=Yn.payload,hn=typeof Xn=="function"?Xn.call(Fn,An,hn):Xn,hn==null)break e;An=Pe({},An,hn);break e;case 2:Br=!0}}Ct.callback!==null&&Ct.lane!==0&&(le.flags|=64,hn=We.effects,hn===null?We.effects=[Ct]:hn.push(Ct))}else Fn={eventTime:Fn,lane:hn,tag:Ct.tag,payload:Ct.payload,callback:Ct.callback,next:null},Cn===null?(Pt=Cn=Fn,Gt=An):Cn=Cn.next=Fn,nt|=hn;if(Ct=Ct.next,Ct===null){if(Ct=We.shared.pending,Ct===null)break;hn=Ct,Ct=hn.next,hn.next=null,We.lastBaseUpdate=hn,We.shared.pending=null}}while(!0);if(Cn===null&&(Gt=An),We.baseState=Gt,We.firstBaseUpdate=Pt,We.lastBaseUpdate=Cn,ue=We.shared.interleaved,ue!==null){We=ue;do nt|=We.lane,We=We.next;while(We!==ue)}else Xe===null&&(We.shared.lanes=0);dl|=nt,le.lanes=nt,le.memoizedState=An}}function Ra(le,ue,me){if(le=ue.effects,ue.effects=null,le!==null)for(ue=0;ue<le.length;ue++){var Se=le[ue],We=Se.callback;if(We!==null){if(Se.callback=null,Se=me,typeof We!="function")throw Error(_(191,We));We.call(Se)}}}var Vo={},qi=Dr(Vo),ea=Dr(Vo),as=Dr(Vo);function Qr(le){if(le===Vo)throw Error(_(174));return le}function il(le,ue){switch(Sr(as,ue),Sr(ea,le),Sr(qi,Vo),le=ue.nodeType,le){case 9:case 11:ue=(ue=ue.documentElement)?ue.namespaceURI:zt(null,"");break;default:le=le===8?ue.parentNode:ue,ue=le.namespaceURI||null,le=le.tagName,ue=zt(ue,le)}xr(qi),Sr(qi,ue)}function _s(){xr(qi),xr(ea),xr(as)}function ta(le){Qr(as.current);var ue=Qr(qi.current),me=zt(ue,le.type);ue!==me&&(Sr(ea,le),Sr(qi,me))}function wa(le){ea.current===le&&(xr(qi),xr(ea))}var Mr=Dr(0);function So(le){for(var ue=le;ue!==null;){if(ue.tag===13){var me=ue.memoizedState;if(me!==null&&(me=me.dehydrated,me===null||me.data==="$?"||me.data==="$!"))return ue}else if(ue.tag===19&&ue.memoizedProps.revealOrder!==void 0){if(ue.flags&128)return ue}else if(ue.child!==null){ue.child.return=ue,ue=ue.child;continue}if(ue===le)break;for(;ue.sibling===null;){if(ue.return===null||ue.return===le)return null;ue=ue.return}ue.sibling.return=ue.return,ue=ue.sibling}return null}var xa=[];function To(){for(var le=0;le<xa.length;le++)xa[le]._workInProgressVersionPrimary=null;xa.length=0}var na=Re.ReactCurrentDispatcher,ra=Re.ReactCurrentBatchConfig,ls=0,Zr=null,Ur=null,Cr=null,Ro=!1,xi=!1,Es=0,Ki=0;function mi(){throw Error(_(321))}function ol(le,ue){if(ue===null)return!1;for(var me=0;me<ue.length&&me<le.length;me++)if(!ji(le[me],ue[me]))return!1;return!0}function sl(le,ue,me,Se,We,Xe){if(ls=Xe,Zr=ue,ue.memoizedState=null,ue.updateQueue=null,ue.lanes=0,na.current=le===null||le.memoizedState===null?mc:bc,le=me(Se,We),xi){Xe=0;do{if(xi=!1,Es=0,25<=Xe)throw Error(_(301));Xe+=1,Cr=Ur=null,ue.updateQueue=null,na.current=yc,le=me(Se,We)}while(xi)}if(na.current=ng,ue=Ur!==null&&Ur.next!==null,ls=0,Cr=Ur=Zr=null,Ro=!1,ue)throw Error(_(300));return le}function Lg(){var le=Es!==0;return Es=0,le}function bi(){var le={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Cr===null?Zr.memoizedState=Cr=le:Cr=Cr.next=le,Cr}function eo(){if(Ur===null){var le=Zr.alternate;le=le!==null?le.memoizedState:null}else le=Ur.next;var ue=Cr===null?Zr.memoizedState:Cr.next;if(ue!==null)Cr=ue,Ur=le;else{if(le===null)throw Error(_(310));Ur=le,le={memoizedState:Ur.memoizedState,baseState:Ur.baseState,baseQueue:Ur.baseQueue,queue:Ur.queue,next:null},Cr===null?Zr.memoizedState=Cr=le:Cr=Cr.next=le}return Cr}function Za(le,ue){return typeof ue=="function"?ue(le):ue}function al(le){var ue=eo(),me=ue.queue;if(me===null)throw Error(_(311));me.lastRenderedReducer=le;var Se=Ur,We=Se.baseQueue,Xe=me.pending;if(Xe!==null){if(We!==null){var nt=We.next;We.next=Xe.next,Xe.next=nt}Se.baseQueue=We=Xe,me.pending=null}if(We!==null){Xe=We.next,Se=Se.baseState;var Ct=nt=null,Gt=null,Pt=Xe;do{var Cn=Pt.lane;if((ls&Cn)===Cn)Gt!==null&&(Gt=Gt.next={lane:0,action:Pt.action,hasEagerState:Pt.hasEagerState,eagerState:Pt.eagerState,next:null}),Se=Pt.hasEagerState?Pt.eagerState:le(Se,Pt.action);else{var An={lane:Cn,action:Pt.action,hasEagerState:Pt.hasEagerState,eagerState:Pt.eagerState,next:null};Gt===null?(Ct=Gt=An,nt=Se):Gt=Gt.next=An,Zr.lanes|=Cn,dl|=Cn}Pt=Pt.next}while(Pt!==null&&Pt!==Xe);Gt===null?nt=Se:Gt.next=Ct,ji(Se,ue.memoizedState)||(cr=!0),ue.memoizedState=Se,ue.baseState=nt,ue.baseQueue=Gt,me.lastRenderedState=Se}if(le=me.interleaved,le!==null){We=le;do Xe=We.lane,Zr.lanes|=Xe,dl|=Xe,We=We.next;while(We!==le)}else We===null&&(me.lanes=0);return[ue.memoizedState,me.dispatch]}function gs(le){var ue=eo(),me=ue.queue;if(me===null)throw Error(_(311));me.lastRenderedReducer=le;var Se=me.dispatch,We=me.pending,Xe=ue.memoizedState;if(We!==null){me.pending=null;var nt=We=We.next;do Xe=le(Xe,nt.action),nt=nt.next;while(nt!==We);ji(Xe,ue.memoizedState)||(cr=!0),ue.memoizedState=Xe,ue.baseQueue===null&&(ue.baseState=Xe),me.lastRenderedState=Xe}return[Xe,Se]}function Hg(){}function Xg(le,ue){var me=Zr,Se=eo(),We=ue(),Xe=!ji(Se.memoizedState,We);if(Xe&&(Se.memoizedState=We,cr=!0),Se=Se.queue,Kg(pc.bind(null,me,Se,le),[le]),Se.getSnapshot!==ue||Xe||Cr!==null&&Cr.memoizedState.tag&1){if(me.flags|=2048,wo(9,ll.bind(null,me,Se,We,ue),void 0,null),Zi===null)throw Error(_(349));ls&30||Jl(me,ue,We)}return We}function Jl(le,ue,me){le.flags|=16384,le={getSnapshot:ue,value:me},ue=Zr.updateQueue,ue===null?(ue={lastEffect:null,stores:null},Zr.updateQueue=ue,ue.stores=[le]):(me=ue.stores,me===null?ue.stores=[le]:me.push(le))}function ll(le,ue,me,Se){ue.value=me,ue.getSnapshot=Se,Ic(ue)&&kg(le)}function pc(le,ue,me){return me(function(){Ic(ue)&&kg(le)})}function Ic(le){var ue=le.getSnapshot;le=le.value;try{var me=ue();return!ji(le,me)}catch{return!0}}function kg(le){var ue=Go(le,1);ue!==null&&Is(ue,le,1,-1)}function Yg(le){var ue=bi();return typeof le=="function"&&(le=le()),ue.memoizedState=ue.baseState=le,le={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Za,lastRenderedState:le},ue.queue=le,le=le.dispatch=ia.bind(null,Zr,le),[ue.memoizedState,le]}function wo(le,ue,me,Se){return le={tag:le,create:ue,destroy:me,deps:Se,next:null},ue=Zr.updateQueue,ue===null?(ue={lastEffect:null,stores:null},Zr.updateQueue=ue,ue.lastEffect=le.next=le):(me=ue.lastEffect,me===null?ue.lastEffect=le.next=le:(Se=me.next,me.next=le,le.next=Se,ue.lastEffect=le)),le}function hc(){return eo().memoizedState}function No(le,ue,me,Se){var We=bi();Zr.flags|=le,We.memoizedState=wo(1|ue,me,void 0,Se===void 0?null:Se)}function gl(le,ue,me,Se){var We=eo();Se=Se===void 0?null:Se;var Xe=void 0;if(Ur!==null){var nt=Ur.memoizedState;if(Xe=nt.destroy,Se!==null&&ol(Se,nt.deps)){We.memoizedState=wo(ue,me,Xe,Se);return}}Zr.flags|=le,We.memoizedState=wo(1|ue,me,Xe,Se)}function Ti(le,ue){return No(8390656,8,le,ue)}function Kg(le,ue){return gl(2048,8,le,ue)}function Dg(le,ue){return gl(4,2,le,ue)}function Cc(le,ue){return gl(4,4,le,ue)}function fc(le,ue){if(typeof ue=="function")return le=le(),ue(le),function(){ue(null)};if(ue!=null)return le=le(),ue.current=le,function(){ue.current=null}}function zg(le,ue,me){return me=me!=null?me.concat([le]):null,gl(4,4,fc.bind(null,ue,le),me)}function Ql(){}function Ac(le,ue){var me=eo();ue=ue===void 0?null:ue;var Se=me.memoizedState;return Se!==null&&ue!==null&&ol(ue,Se[1])?Se[0]:(me.memoizedState=[le,ue],le)}function no(le,ue){var me=eo();ue=ue===void 0?null:ue;var Se=me.memoizedState;return Se!==null&&ue!==null&&ol(ue,Se[1])?Se[0]:(le=le(),me.memoizedState=[le,ue],le)}function $l(le,ue,me){return ls&21?(ji(me,ue)||(me=On(),Zr.lanes|=me,dl|=me,le.baseState=!0),ue):(le.baseState&&(le.baseState=!1,cr=!0),le.memoizedState=me)}function Uc(le,ue){var me=lr;lr=me!==0&&4>me?me:4,le(!0);var Se=ra.transition;ra.transition={};try{le(!1),ue()}finally{lr=me,ra.transition=Se}}function cs(){return eo().memoizedState}function ql(le,ue,me){var Se=Wa(le);if(me={lane:Se,action:me,hasEagerState:!1,eagerState:null,next:null},cl(le))eg(ue,me);else if(me=rl(le,ue,me,Se),me!==null){var We=io();Is(me,le,Se,We),tg(me,ue,Se)}}function ia(le,ue,me){var Se=Wa(le),We={lane:Se,action:me,hasEagerState:!1,eagerState:null,next:null};if(cl(le))eg(ue,We);else{var Xe=le.alternate;if(le.lanes===0&&(Xe===null||Xe.lanes===0)&&(Xe=ue.lastRenderedReducer,Xe!==null))try{var nt=ue.lastRenderedState,Ct=Xe(nt,me);if(We.hasEagerState=!0,We.eagerState=Ct,ji(Ct,nt)){var Gt=ue.interleaved;Gt===null?(We.next=We,Ng(ue)):(We.next=Gt.next,Gt.next=We),ue.interleaved=We;return}}catch{}finally{}me=rl(le,ue,We,Se),me!==null&&(We=io(),Is(me,le,Se,We),tg(me,ue,Se))}}function cl(le){var ue=le.alternate;return le===Zr||ue!==null&&ue===Zr}function eg(le,ue){xi=Ro=!0;var me=le.pending;me===null?ue.next=ue:(ue.next=me.next,me.next=ue),le.pending=ue}function tg(le,ue,me){if(me&4194240){var Se=ue.lanes;Se&=le.pendingLanes,me|=Se,ue.lanes=me,Rr(le,me)}}var ng={readContext:$i,useCallback:mi,useContext:mi,useEffect:mi,useImperativeHandle:mi,useInsertionEffect:mi,useLayoutEffect:mi,useMemo:mi,useReducer:mi,useRef:mi,useState:mi,useDebugValue:mi,useDeferredValue:mi,useTransition:mi,useMutableSource:mi,useSyncExternalStore:mi,useId:mi,unstable_isNewReconciler:!1},mc={readContext:$i,useCallback:function(le,ue){return bi().memoizedState=[le,ue===void 0?null:ue],le},useContext:$i,useEffect:Ti,useImperativeHandle:function(le,ue,me){return me=me!=null?me.concat([le]):null,No(4194308,4,fc.bind(null,ue,le),me)},useLayoutEffect:function(le,ue){return No(4194308,4,le,ue)},useInsertionEffect:function(le,ue){return No(4,2,le,ue)},useMemo:function(le,ue){var me=bi();return ue=ue===void 0?null:ue,le=le(),me.memoizedState=[le,ue],le},useReducer:function(le,ue,me){var Se=bi();return ue=me!==void 0?me(ue):ue,Se.memoizedState=Se.baseState=ue,le={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:le,lastRenderedState:ue},Se.queue=le,le=le.dispatch=ql.bind(null,Zr,le),[Se.memoizedState,le]},useRef:function(le){var ue=bi();return le={current:le},ue.memoizedState=le},useState:Yg,useDebugValue:Ql,useDeferredValue:function(le){return bi().memoizedState=le},useTransition:function(){var le=Yg(!1),ue=le[0];return le=Uc.bind(null,le[1]),bi().memoizedState=le,[ue,le]},useMutableSource:function(){},useSyncExternalStore:function(le,ue,me){var Se=Zr,We=bi();if(Er){if(me===void 0)throw Error(_(407));me=me()}else{if(me=ue(),Zi===null)throw Error(_(349));ls&30||Jl(Se,ue,me)}We.memoizedState=me;var Xe={value:me,getSnapshot:ue};return We.queue=Xe,Ti(pc.bind(null,Se,Xe,le),[le]),Se.flags|=2048,wo(9,ll.bind(null,Se,Xe,me,ue),void 0,null),me},useId:function(){var le=bi(),ue=Zi.identifierPrefix;if(Er){var me=po,Se=Rn;me=(Se&~(1<<32-wn(Se)-1)).toString(32)+me,ue=":"+ue+"R"+me,me=Es++,0<me&&(ue+="H"+me.toString(32)),ue+=":"}else me=Ki++,ue=":"+ue+"r"+me.toString(32)+":";return le.memoizedState=ue},unstable_isNewReconciler:!1},bc={readContext:$i,useCallback:Ac,useContext:$i,useEffect:Kg,useImperativeHandle:zg,useInsertionEffect:Dg,useLayoutEffect:Cc,useMemo:no,useReducer:al,useRef:hc,useState:function(){return al(Za)},useDebugValue:Ql,useDeferredValue:function(le){var ue=eo();return $l(ue,Ur.memoizedState,le)},useTransition:function(){var le=al(Za)[0],ue=eo().memoizedState;return[le,ue]},useMutableSource:Hg,useSyncExternalStore:Xg,useId:cs,unstable_isNewReconciler:!1},yc={readContext:$i,useCallback:Ac,useContext:$i,useEffect:Kg,useImperativeHandle:zg,useInsertionEffect:Dg,useLayoutEffect:Cc,useMemo:no,useReducer:gs,useRef:hc,useState:function(){return gs(Za)},useDebugValue:Ql,useDeferredValue:function(le){var ue=eo();return Ur===null?ue.memoizedState=le:$l(ue,Ur.memoizedState,le)},useTransition:function(){var le=gs(Za)[0],ue=eo().memoizedState;return[le,ue]},useMutableSource:Hg,useSyncExternalStore:Xg,useId:cs,unstable_isNewReconciler:!1};function ho(le,ue){if(le&&le.defaultProps){ue=Pe({},ue),le=le.defaultProps;for(var me in le)ue[me]===void 0&&(ue[me]=le[me]);return ue}return ue}function ul(le,ue,me,Se){ue=le.memoizedState,me=me(Se,ue),me=me==null?ue:Pe({},ue,me),le.memoizedState=me,le.lanes===0&&(le.updateQueue.baseState=me)}var rg={isMounted:function(le){return(le=le._reactInternals)?st(le)===le:!1},enqueueSetState:function(le,ue,me){le=le._reactInternals;var Se=io(),We=Wa(le),Xe=Gr(Se,We);Xe.payload=ue,me!=null&&(Xe.callback=me),ue=Tr(le,Xe,We),ue!==null&&(Is(ue,le,We,Se),wi(ue,le,We))},enqueueReplaceState:function(le,ue,me){le=le._reactInternals;var Se=io(),We=Wa(le),Xe=Gr(Se,We);Xe.tag=1,Xe.payload=ue,me!=null&&(Xe.callback=me),ue=Tr(le,Xe,We),ue!==null&&(Is(ue,le,We,Se),wi(ue,le,We))},enqueueForceUpdate:function(le,ue){le=le._reactInternals;var me=io(),Se=Wa(le),We=Gr(me,Se);We.tag=2,ue!=null&&(We.callback=ue),ue=Tr(le,We,Se),ue!==null&&(Is(ue,le,Se,me),wi(ue,le,Se))}};function vc(le,ue,me,Se,We,Xe,nt){return le=le.stateNode,typeof le.shouldComponentUpdate=="function"?le.shouldComponentUpdate(Se,Xe,nt):ue.prototype&&ue.prototype.isPureReactComponent?!Hs(me,Se)||!Hs(We,Xe):!0}function pe(le,ue,me){var Se=!1,We=$o,Xe=ue.contextType;return typeof Xe=="object"&&Xe!==null?Xe=$i(Xe):(We=Ri(ue)?qo:fi.current,Se=ue.contextTypes,Xe=(Se=Se!=null)?zs(le,We):$o),ue=new ue(me,Xe),le.memoizedState=ue.state!==null&&ue.state!==void 0?ue.state:null,ue.updater=rg,le.stateNode=ue,ue._reactInternals=le,Se&&(le=le.stateNode,le.__reactInternalMemoizedUnmaskedChildContext=We,le.__reactInternalMemoizedMaskedChildContext=Xe),ue}function he(le,ue,me,Se){le=ue.state,typeof ue.componentWillReceiveProps=="function"&&ue.componentWillReceiveProps(me,Se),typeof ue.UNSAFE_componentWillReceiveProps=="function"&&ue.UNSAFE_componentWillReceiveProps(me,Se),ue.state!==le&&rg.enqueueReplaceState(ue,ue.state,null)}function Ge(le,ue,me,Se){var We=le.stateNode;We.props=me,We.state=le.memoizedState,We.refs={},gr(le);var Xe=ue.contextType;typeof Xe=="object"&&Xe!==null?We.context=$i(Xe):(Xe=Ri(ue)?qo:fi.current,We.context=zs(le,Xe)),We.state=le.memoizedState,Xe=ue.getDerivedStateFromProps,typeof Xe=="function"&&(ul(le,ue,Xe,me),We.state=le.memoizedState),typeof ue.getDerivedStateFromProps=="function"||typeof We.getSnapshotBeforeUpdate=="function"||typeof We.UNSAFE_componentWillMount!="function"&&typeof We.componentWillMount!="function"||(ue=We.state,typeof We.componentWillMount=="function"&&We.componentWillMount(),typeof We.UNSAFE_componentWillMount=="function"&&We.UNSAFE_componentWillMount(),ue!==We.state&&rg.enqueueReplaceState(We,We.state,null),zr(le,me,We,Se),We.state=le.memoizedState),typeof We.componentDidMount=="function"&&(le.flags|=4194308)}function we(le,ue){try{var me="",Se=ue;do me+=gt(Se),Se=Se.return;while(Se);var We=me}catch(Xe){We=`
Error generating stack: `+Xe.message+`
`+Xe.stack}return{value:le,source:ue,stack:We,digest:null}}function He(le,ue,me){return{value:le,source:null,stack:me??null,digest:ue??null}}function De(le,ue){try{console.error(ue.value)}catch(me){setTimeout(function(){throw me})}}var It=typeof WeakMap=="function"?WeakMap:Map;function xt(le,ue,me){me=Gr(-1,me),me.tag=3,me.payload={element:null};var Se=ue.value;return me.callback=function(){Zc||(Zc=!0,nu=Se),De(le,ue)},me}function nn(le,ue,me){me=Gr(-1,me),me.tag=3;var Se=le.type.getDerivedStateFromError;if(typeof Se=="function"){var We=ue.value;me.payload=function(){return Se(We)},me.callback=function(){De(le,ue)}}var Xe=le.stateNode;return Xe!==null&&typeof Xe.componentDidCatch=="function"&&(me.callback=function(){De(le,ue),typeof Se!="function"&&(Ma===null?Ma=new Set([this]):Ma.add(this));var nt=ue.stack;this.componentDidCatch(ue.value,{componentStack:nt!==null?nt:""})}),me}function mn(le,ue,me){var Se=le.pingCache;if(Se===null){Se=le.pingCache=new It;var We=new Set;Se.set(ue,We)}else We=Se.get(ue),We===void 0&&(We=new Set,Se.set(ue,We));We.has(me)||(We.add(me),le=ad.bind(null,le,ue,me),ue.then(le,le))}function Vn(le){do{var ue;if((ue=le.tag===13)&&(ue=le.memoizedState,ue=ue!==null?ue.dehydrated!==null:!0),ue)return le;le=le.return}while(le!==null);return null}function or(le,ue,me,Se,We){return le.mode&1?(le.flags|=65536,le.lanes=We,le):(le===ue?le.flags|=65536:(le.flags|=128,me.flags|=131072,me.flags&=-52805,me.tag===1&&(me.alternate===null?me.tag=17:(ue=Gr(-1,1),ue.tag=2,Tr(me,ue,1))),me.lanes|=1),le)}var jn=Re.ReactCurrentOwner,cr=!1;function En(le,ue,me,Se){ue.child=le===null?el(ue,null,me,Se):js(ue,le.child,me,Se)}function yi(le,ue,me,Se,We){me=me.render;var Xe=ue.ref;return Zs(ue,We),Se=sl(le,ue,me,Se,Xe,We),me=Lg(),le!==null&&!cr?(ue.updateQueue=le.updateQueue,ue.flags&=-2053,le.lanes&=~We,oa(le,ue,We)):(Er&&me&&Eg(ue),ue.flags|=1,En(le,ue,Se,We),ue.child)}function ro(le,ue,me,Se,We){if(le===null){var Xe=me.type;return typeof Xe=="function"&&!gu(Xe)&&Xe.defaultProps===void 0&&me.compare===null&&me.defaultProps===void 0?(ue.tag=15,ue.type=Xe,Kt(le,ue,Xe,Se,We)):(le=Vc(me.type,null,Se,ue,ue.mode,We),le.ref=ue.ref,le.return=ue,ue.child=le)}if(Xe=le.child,!(le.lanes&We)){var nt=Xe.memoizedProps;if(me=me.compare,me=me!==null?me:Hs,me(nt,Se)&&le.ref===ue.ref)return oa(le,ue,We)}return ue.flags|=1,le=Ta(Xe,Se),le.ref=ue.ref,le.return=ue,ue.child=le}function Kt(le,ue,me,Se,We){if(le!==null){var Xe=le.memoizedProps;if(Hs(Xe,Se)&&le.ref===ue.ref)if(cr=!1,ue.pendingProps=Se=Xe,(le.lanes&We)!==0)le.flags&131072&&(cr=!0);else return ue.lanes=le.lanes,oa(le,ue,We)}return _n(le,ue,me,Se,We)}function _t(le,ue,me){var Se=ue.pendingProps,We=Se.children,Xe=le!==null?le.memoizedState:null;if(Se.mode==="hidden")if(!(ue.mode&1))ue.memoizedState={baseLanes:0,cachePool:null,transitions:null},Sr(og,xo),xo|=me;else{if(!(me&1073741824))return le=Xe!==null?Xe.baseLanes|me:me,ue.lanes=ue.childLanes=1073741824,ue.memoizedState={baseLanes:le,cachePool:null,transitions:null},ue.updateQueue=null,Sr(og,xo),xo|=le,null;ue.memoizedState={baseLanes:0,cachePool:null,transitions:null},Se=Xe!==null?Xe.baseLanes:me,Sr(og,xo),xo|=Se}else Xe!==null?(Se=Xe.baseLanes|me,ue.memoizedState=null):Se=me,Sr(og,xo),xo|=Se;return En(le,ue,We,me),ue.child}function qt(le,ue){var me=ue.ref;(le===null&&me!==null||le!==null&&le.ref!==me)&&(ue.flags|=512,ue.flags|=2097152)}function _n(le,ue,me,Se,We){var Xe=Ri(me)?qo:fi.current;return Xe=zs(ue,Xe),Zs(ue,We),me=sl(le,ue,me,Se,Xe,We),Se=Lg(),le!==null&&!cr?(ue.updateQueue=le.updateQueue,ue.flags&=-2053,le.lanes&=~We,oa(le,ue,We)):(Er&&Se&&Eg(ue),ue.flags|=1,En(le,ue,me,We),ue.child)}function Dn(le,ue,me,Se,We){if(Ri(me)){var Xe=!0;Us(ue)}else Xe=!1;if(Zs(ue,We),ue.stateNode===null)Gc(le,ue),pe(ue,me,Se),Ge(ue,me,Se,We),Se=!0;else if(le===null){var nt=ue.stateNode,Ct=ue.memoizedProps;nt.props=Ct;var Gt=nt.context,Pt=me.contextType;typeof Pt=="object"&&Pt!==null?Pt=$i(Pt):(Pt=Ri(me)?qo:fi.current,Pt=zs(ue,Pt));var Cn=me.getDerivedStateFromProps,An=typeof Cn=="function"||typeof nt.getSnapshotBeforeUpdate=="function";An||typeof nt.UNSAFE_componentWillReceiveProps!="function"&&typeof nt.componentWillReceiveProps!="function"||(Ct!==Se||Gt!==Pt)&&he(ue,nt,Se,Pt),Br=!1;var hn=ue.memoizedState;nt.state=hn,zr(ue,Se,nt,We),Gt=ue.memoizedState,Ct!==Se||hn!==Gt||Fi.current||Br?(typeof Cn=="function"&&(ul(ue,me,Cn,Se),Gt=ue.memoizedState),(Ct=Br||vc(ue,me,Ct,Se,hn,Gt,Pt))?(An||typeof nt.UNSAFE_componentWillMount!="function"&&typeof nt.componentWillMount!="function"||(typeof nt.componentWillMount=="function"&&nt.componentWillMount(),typeof nt.UNSAFE_componentWillMount=="function"&&nt.UNSAFE_componentWillMount()),typeof nt.componentDidMount=="function"&&(ue.flags|=4194308)):(typeof nt.componentDidMount=="function"&&(ue.flags|=4194308),ue.memoizedProps=Se,ue.memoizedState=Gt),nt.props=Se,nt.state=Gt,nt.context=Pt,Se=Ct):(typeof nt.componentDidMount=="function"&&(ue.flags|=4194308),Se=!1)}else{nt=ue.stateNode,jr(le,ue),Ct=ue.memoizedProps,Pt=ue.type===ue.elementType?Ct:ho(ue.type,Ct),nt.props=Pt,An=ue.pendingProps,hn=nt.context,Gt=me.contextType,typeof Gt=="object"&&Gt!==null?Gt=$i(Gt):(Gt=Ri(me)?qo:fi.current,Gt=zs(ue,Gt));var Fn=me.getDerivedStateFromProps;(Cn=typeof Fn=="function"||typeof nt.getSnapshotBeforeUpdate=="function")||typeof nt.UNSAFE_componentWillReceiveProps!="function"&&typeof nt.componentWillReceiveProps!="function"||(Ct!==An||hn!==Gt)&&he(ue,nt,Se,Gt),Br=!1,hn=ue.memoizedState,nt.state=hn,zr(ue,Se,nt,We);var Xn=ue.memoizedState;Ct!==An||hn!==Xn||Fi.current||Br?(typeof Fn=="function"&&(ul(ue,me,Fn,Se),Xn=ue.memoizedState),(Pt=Br||vc(ue,me,Pt,Se,hn,Xn,Gt)||!1)?(Cn||typeof nt.UNSAFE_componentWillUpdate!="function"&&typeof nt.componentWillUpdate!="function"||(typeof nt.componentWillUpdate=="function"&&nt.componentWillUpdate(Se,Xn,Gt),typeof nt.UNSAFE_componentWillUpdate=="function"&&nt.UNSAFE_componentWillUpdate(Se,Xn,Gt)),typeof nt.componentDidUpdate=="function"&&(ue.flags|=4),typeof nt.getSnapshotBeforeUpdate=="function"&&(ue.flags|=1024)):(typeof nt.componentDidUpdate!="function"||Ct===le.memoizedProps&&hn===le.memoizedState||(ue.flags|=4),typeof nt.getSnapshotBeforeUpdate!="function"||Ct===le.memoizedProps&&hn===le.memoizedState||(ue.flags|=1024),ue.memoizedProps=Se,ue.memoizedState=Xn),nt.props=Se,nt.state=Xn,nt.context=Gt,Se=Pt):(typeof nt.componentDidUpdate!="function"||Ct===le.memoizedProps&&hn===le.memoizedState||(ue.flags|=4),typeof nt.getSnapshotBeforeUpdate!="function"||Ct===le.memoizedProps&&hn===le.memoizedState||(ue.flags|=1024),Se=!1)}return ar(le,ue,me,Se,Xe,We)}function ar(le,ue,me,Se,We,Xe){qt(le,ue);var nt=(ue.flags&128)!==0;if(!Se&&!nt)return We&&Zg(ue,me,!1),oa(le,ue,Xe);Se=ue.stateNode,jn.current=ue;var Ct=nt&&typeof me.getDerivedStateFromError!="function"?null:Se.render();return ue.flags|=1,le!==null&&nt?(ue.child=js(ue,le.child,null,Xe),ue.child=js(ue,null,Ct,Xe)):En(le,ue,Ct,Xe),ue.memoizedState=Se.state,We&&Zg(ue,me,!0),ue.child}function sr(le){var ue=le.stateNode;ue.pendingContext?xg(le,ue.pendingContext,ue.pendingContext!==ue.context):ue.context&&xg(le,ue.context,!1),il(le,ue.containerInfo)}function hr(le,ue,me,Se,We){return xs(),Ga(We),ue.flags|=256,En(le,ue,me,Se),ue.child}var $r={dehydrated:null,treeContext:null,retryLane:0};function pr(le){return{baseLanes:le,cachePool:null,transitions:null}}function us(le,ue,me){var Se=ue.pendingProps,We=Mr.current,Xe=!1,nt=(ue.flags&128)!==0,Ct;if((Ct=nt)||(Ct=le!==null&&le.memoizedState===null?!1:(We&2)!==0),Ct?(Xe=!0,ue.flags&=-129):(le===null||le.memoizedState!==null)&&(We|=1),Sr(Mr,We&1),le===null)return Ol(ue),le=ue.memoizedState,le!==null&&(le=le.dehydrated,le!==null)?(ue.mode&1?le.data==="$!"?ue.lanes=8:ue.lanes=1073741824:ue.lanes=1,null):(nt=Se.children,le=Se.fallback,Xe?(Se=ue.mode,Xe=ue.child,nt={mode:"hidden",children:nt},!(Se&1)&&Xe!==null?(Xe.childLanes=0,Xe.pendingProps=nt):Xe=Tc(nt,Se,0,null),le=Cl(le,Se,me,null),Xe.return=ue,le.return=ue,Xe.sibling=le,ue.child=Xe,ue.child.memoizedState=pr(me),ue.memoizedState=$r,le):Ug(ue,nt));if(We=le.memoizedState,We!==null&&(Ct=We.dehydrated,Ct!==null))return Ou(le,ue,nt,Se,Ct,We,me);if(Xe){Xe=Se.fallback,nt=ue.mode,We=le.child,Ct=We.sibling;var Gt={mode:"hidden",children:Se.children};return!(nt&1)&&ue.child!==We?(Se=ue.child,Se.childLanes=0,Se.pendingProps=Gt,ue.deletions=null):(Se=Ta(We,Gt),Se.subtreeFlags=We.subtreeFlags&14680064),Ct!==null?Xe=Ta(Ct,Xe):(Xe=Cl(Xe,nt,me,null),Xe.flags|=2),Xe.return=ue,Se.return=ue,Se.sibling=Xe,ue.child=Se,Se=Xe,Xe=ue.child,nt=le.child.memoizedState,nt=nt===null?pr(me):{baseLanes:nt.baseLanes|me,cachePool:null,transitions:nt.transitions},Xe.memoizedState=nt,Xe.childLanes=le.childLanes&~me,ue.memoizedState=$r,Se}return Xe=le.child,le=Xe.sibling,Se=Ta(Xe,{mode:"visible",children:Se.children}),!(ue.mode&1)&&(Se.lanes=me),Se.return=ue,Se.sibling=null,le!==null&&(me=ue.deletions,me===null?(ue.deletions=[le],ue.flags|=16):me.push(le)),ue.child=Se,ue.memoizedState=null,Se}function Ug(le,ue){return ue=Tc({mode:"visible",children:ue},le.mode,0,null),ue.return=le,le.child=ue}function Bc(le,ue,me,Se){return Se!==null&&Ga(Se),js(ue,le.child,null,me),le=Ug(ue,ue.pendingProps.children),le.flags|=2,ue.memoizedState=null,le}function Ou(le,ue,me,Se,We,Xe,nt){if(me)return ue.flags&256?(ue.flags&=-257,Se=He(Error(_(422))),Bc(le,ue,nt,Se)):ue.memoizedState!==null?(ue.child=le.child,ue.flags|=128,null):(Xe=Se.fallback,We=ue.mode,Se=Tc({mode:"visible",children:Se.children},We,0,null),Xe=Cl(Xe,We,nt,null),Xe.flags|=2,Se.return=ue,Xe.return=ue,Se.sibling=Xe,ue.child=Se,ue.mode&1&&js(ue,le.child,null,nt),ue.child.memoizedState=pr(nt),ue.memoizedState=$r,Xe);if(!(ue.mode&1))return Bc(le,ue,nt,null);if(We.data==="$!"){if(Se=We.nextSibling&&We.nextSibling.dataset,Se)var Ct=Se.dgst;return Se=Ct,Xe=Error(_(419)),Se=He(Xe,Se,void 0),Bc(le,ue,nt,Se)}if(Ct=(nt&le.childLanes)!==0,cr||Ct){if(Se=Zi,Se!==null){switch(nt&-nt){case 4:We=2;break;case 16:We=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:We=32;break;case 536870912:We=268435456;break;default:We=0}We=We&(Se.suspendedLanes|nt)?0:We,We!==0&&We!==Xe.retryLane&&(Xe.retryLane=We,Go(le,We),Is(Se,le,We,-1))}return lu(),Se=He(Error(_(421))),Bc(le,ue,nt,Se)}return We.data==="$?"?(ue.flags|=128,ue.child=le.child,ue=ld.bind(null,le),We._reactRetry=ue,null):(le=Xe.treeContext,Vi=Jo(We.nextSibling),Ai=ue,Er=!0,Io=null,le!==null&&(Wi[pi++]=Rn,Wi[pi++]=po,Wi[pi++]=Os,Rn=le.id,po=le.overflow,Os=ue),ue=Ug(ue,Se.children),ue.flags|=4096,ue)}function fu(le,ue,me){le.lanes|=ue;var Se=le.alternate;Se!==null&&(Se.lanes|=ue),nl(le.return,ue,me)}function Pc(le,ue,me,Se,We){var Xe=le.memoizedState;Xe===null?le.memoizedState={isBackwards:ue,rendering:null,renderingStartTime:0,last:Se,tail:me,tailMode:We}:(Xe.isBackwards=ue,Xe.rendering=null,Xe.renderingStartTime=0,Xe.last=Se,Xe.tail=me,Xe.tailMode=We)}function Au(le,ue,me){var Se=ue.pendingProps,We=Se.revealOrder,Xe=Se.tail;if(En(le,ue,Se.children,me),Se=Mr.current,Se&2)Se=Se&1|2,ue.flags|=128;else{if(le!==null&&le.flags&128)e:for(le=ue.child;le!==null;){if(le.tag===13)le.memoizedState!==null&&fu(le,me,ue);else if(le.tag===19)fu(le,me,ue);else if(le.child!==null){le.child.return=le,le=le.child;continue}if(le===ue)break e;for(;le.sibling===null;){if(le.return===null||le.return===ue)break e;le=le.return}le.sibling.return=le.return,le=le.sibling}Se&=1}if(Sr(Mr,Se),!(ue.mode&1))ue.memoizedState=null;else switch(We){case"forwards":for(me=ue.child,We=null;me!==null;)le=me.alternate,le!==null&&So(le)===null&&(We=me),me=me.sibling;me=We,me===null?(We=ue.child,ue.child=null):(We=me.sibling,me.sibling=null),Pc(ue,!1,We,me,Xe);break;case"backwards":for(me=null,We=ue.child,ue.child=null;We!==null;){if(le=We.alternate,le!==null&&So(le)===null){ue.child=We;break}le=We.sibling,We.sibling=me,me=We,We=le}Pc(ue,!0,me,null,Xe);break;case"together":Pc(ue,!1,null,null,void 0);break;default:ue.memoizedState=null}return ue.child}function Gc(le,ue){!(ue.mode&1)&&le!==null&&(le.alternate=null,ue.alternate=null,ue.flags|=2)}function oa(le,ue,me){if(le!==null&&(ue.dependencies=le.dependencies),dl|=ue.lanes,!(me&ue.childLanes))return null;if(le!==null&&ue.child!==le.child)throw Error(_(153));if(ue.child!==null){for(le=ue.child,me=Ta(le,le.pendingProps),ue.child=me,me.return=ue;le.sibling!==null;)le=le.sibling,me=me.sibling=Ta(le,le.pendingProps),me.return=ue;me.sibling=null}return ue.child}function ju(le,ue,me){switch(ue.tag){case 3:sr(ue),xs();break;case 5:ta(ue);break;case 1:Ri(ue.type)&&Us(ue);break;case 4:il(ue,ue.stateNode.containerInfo);break;case 10:var Se=ue.type._context,We=ue.memoizedProps.value;Sr(Js,Se._currentValue),Se._currentValue=We;break;case 13:if(Se=ue.memoizedState,Se!==null)return Se.dehydrated!==null?(Sr(Mr,Mr.current&1),ue.flags|=128,null):me&ue.child.childLanes?us(le,ue,me):(Sr(Mr,Mr.current&1),le=oa(le,ue,me),le!==null?le.sibling:null);Sr(Mr,Mr.current&1);break;case 19:if(Se=(me&ue.childLanes)!==0,le.flags&128){if(Se)return Au(le,ue,me);ue.flags|=128}if(We=ue.memoizedState,We!==null&&(We.rendering=null,We.tail=null,We.lastEffect=null),Sr(Mr,Mr.current),Se)break;return null;case 22:case 23:return ue.lanes=0,_t(le,ue,me)}return oa(le,ue,me)}var mu,Oc,bu,yu;mu=function(le,ue){for(var me=ue.child;me!==null;){if(me.tag===5||me.tag===6)le.appendChild(me.stateNode);else if(me.tag!==4&&me.child!==null){me.child.return=me,me=me.child;continue}if(me===ue)break;for(;me.sibling===null;){if(me.return===null||me.return===ue)return;me=me.return}me.sibling.return=me.return,me=me.sibling}},Oc=function(){},bu=function(le,ue,me,Se){var We=le.memoizedProps;if(We!==Se){le=ue.stateNode,Qr(qi.current);var Xe=null;switch(me){case"input":We=it(le,We),Se=it(le,Se),Xe=[];break;case"select":We=Pe({},We,{value:void 0}),Se=Pe({},Se,{value:void 0}),Xe=[];break;case"textarea":We=Oe(le,We),Se=Oe(le,Se),Xe=[];break;default:typeof We.onClick!="function"&&typeof Se.onClick=="function"&&(le.onclick=Pa)}Sn(me,Se);var nt;me=null;for(Pt in We)if(!Se.hasOwnProperty(Pt)&&We.hasOwnProperty(Pt)&&We[Pt]!=null)if(Pt==="style"){var Ct=We[Pt];for(nt in Ct)Ct.hasOwnProperty(nt)&&(me||(me={}),me[nt]="")}else Pt!=="dangerouslySetInnerHTML"&&Pt!=="children"&&Pt!=="suppressContentEditableWarning"&&Pt!=="suppressHydrationWarning"&&Pt!=="autoFocus"&&(te.hasOwnProperty(Pt)?Xe||(Xe=[]):(Xe=Xe||[]).push(Pt,null));for(Pt in Se){var Gt=Se[Pt];if(Ct=We!=null?We[Pt]:void 0,Se.hasOwnProperty(Pt)&&Gt!==Ct&&(Gt!=null||Ct!=null))if(Pt==="style")if(Ct){for(nt in Ct)!Ct.hasOwnProperty(nt)||Gt&&Gt.hasOwnProperty(nt)||(me||(me={}),me[nt]="");for(nt in Gt)Gt.hasOwnProperty(nt)&&Ct[nt]!==Gt[nt]&&(me||(me={}),me[nt]=Gt[nt])}else me||(Xe||(Xe=[]),Xe.push(Pt,me)),me=Gt;else Pt==="dangerouslySetInnerHTML"?(Gt=Gt?Gt.__html:void 0,Ct=Ct?Ct.__html:void 0,Gt!=null&&Ct!==Gt&&(Xe=Xe||[]).push(Pt,Gt)):Pt==="children"?typeof Gt!="string"&&typeof Gt!="number"||(Xe=Xe||[]).push(Pt,""+Gt):Pt!=="suppressContentEditableWarning"&&Pt!=="suppressHydrationWarning"&&(te.hasOwnProperty(Pt)?(Gt!=null&&Pt==="onScroll"&&wr("scroll",le),Xe||Ct===Gt||(Xe=[])):(Xe=Xe||[]).push(Pt,Gt))}me&&(Xe=Xe||[]).push("style",me);var Pt=Xe;(ue.updateQueue=Pt)&&(ue.flags|=4)}},yu=function(le,ue,me,Se){me!==Se&&(ue.flags|=4)};function Pg(le,ue){if(!Er)switch(le.tailMode){case"hidden":ue=le.tail;for(var me=null;ue!==null;)ue.alternate!==null&&(me=ue),ue=ue.sibling;me===null?le.tail=null:me.sibling=null;break;case"collapsed":me=le.tail;for(var Se=null;me!==null;)me.alternate!==null&&(Se=me),me=me.sibling;Se===null?ue||le.tail===null?le.tail=null:le.tail.sibling=null:Se.sibling=null}}function Di(le){var ue=le.alternate!==null&&le.alternate.child===le.child,me=0,Se=0;if(ue)for(var We=le.child;We!==null;)me|=We.lanes|We.childLanes,Se|=We.subtreeFlags&14680064,Se|=We.flags&14680064,We.return=le,We=We.sibling;else for(We=le.child;We!==null;)me|=We.lanes|We.childLanes,Se|=We.subtreeFlags,Se|=We.flags,We.return=le,We=We.sibling;return le.subtreeFlags|=Se,le.childLanes=me,ue}function Ju(le,ue,me){var Se=ue.pendingProps;switch(rs(ue),ue.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Di(ue),null;case 1:return Ri(ue.type)&&Oa(),Di(ue),null;case 3:return Se=ue.stateNode,_s(),xr(Fi),xr(fi),To(),Se.pendingContext&&(Se.context=Se.pendingContext,Se.pendingContext=null),(le===null||le.child===null)&&(Ba(ue)?ue.flags|=4:le===null||le.memoizedState.isDehydrated&&!(ue.flags&256)||(ue.flags|=1024,Io!==null&&(ou(Io),Io=null))),Oc(le,ue),Di(ue),null;case 5:wa(ue);var We=Qr(as.current);if(me=ue.type,le!==null&&ue.stateNode!=null)bu(le,ue,me,Se,We),le.ref!==ue.ref&&(ue.flags|=512,ue.flags|=2097152);else{if(!Se){if(ue.stateNode===null)throw Error(_(166));return Di(ue),null}if(le=Qr(qi.current),Ba(ue)){Se=ue.stateNode,me=ue.type;var Xe=ue.memoizedProps;switch(Se[ni]=ue,Se[va]=Xe,le=(ue.mode&1)!==0,me){case"dialog":wr("cancel",Se),wr("close",Se);break;case"iframe":case"object":case"embed":wr("load",Se);break;case"video":case"audio":for(We=0;We<Rs.length;We++)wr(Rs[We],Se);break;case"source":wr("error",Se);break;case"img":case"image":case"link":wr("error",Se),wr("load",Se);break;case"details":wr("toggle",Se);break;case"input":Lt(Se,Xe),wr("invalid",Se);break;case"select":Se._wrapperState={wasMultiple:!!Xe.multiple},wr("invalid",Se);break;case"textarea":lt(Se,Xe),wr("invalid",Se)}Sn(me,Xe),We=null;for(var nt in Xe)if(Xe.hasOwnProperty(nt)){var Ct=Xe[nt];nt==="children"?typeof Ct=="string"?Se.textContent!==Ct&&(Xe.suppressHydrationWarning!==!0&&Ua(Se.textContent,Ct,le),We=["children",Ct]):typeof Ct=="number"&&Se.textContent!==""+Ct&&(Xe.suppressHydrationWarning!==!0&&Ua(Se.textContent,Ct,le),We=["children",""+Ct]):te.hasOwnProperty(nt)&&Ct!=null&&nt==="onScroll"&&wr("scroll",Se)}switch(me){case"input":Vt(Se),Zt(Se,Xe,!0);break;case"textarea":Vt(Se),St(Se);break;case"select":case"option":break;default:typeof Xe.onClick=="function"&&(Se.onclick=Pa)}Se=We,ue.updateQueue=Se,Se!==null&&(ue.flags|=4)}else{nt=We.nodeType===9?We:We.ownerDocument,le==="http://www.w3.org/1999/xhtml"&&(le=Wt(me)),le==="http://www.w3.org/1999/xhtml"?me==="script"?(le=nt.createElement("div"),le.innerHTML="<script><\/script>",le=le.removeChild(le.firstChild)):typeof Se.is=="string"?le=nt.createElement(me,{is:Se.is}):(le=nt.createElement(me),me==="select"&&(nt=le,Se.multiple?nt.multiple=!0:Se.size&&(nt.size=Se.size))):le=nt.createElementNS(le,me),le[ni]=ue,le[va]=Se,mu(le,ue,!1,!1),ue.stateNode=le;e:{switch(nt=yn(me,Se),me){case"dialog":wr("cancel",le),wr("close",le),We=Se;break;case"iframe":case"object":case"embed":wr("load",le),We=Se;break;case"video":case"audio":for(We=0;We<Rs.length;We++)wr(Rs[We],le);We=Se;break;case"source":wr("error",le),We=Se;break;case"img":case"image":case"link":wr("error",le),wr("load",le),We=Se;break;case"details":wr("toggle",le),We=Se;break;case"input":Lt(le,Se),We=it(le,Se),wr("invalid",le);break;case"option":We=Se;break;case"select":le._wrapperState={wasMultiple:!!Se.multiple},We=Pe({},Se,{value:void 0}),wr("invalid",le);break;case"textarea":lt(le,Se),We=Oe(le,Se),wr("invalid",le);break;default:We=Se}Sn(me,We),Ct=We;for(Xe in Ct)if(Ct.hasOwnProperty(Xe)){var Gt=Ct[Xe];Xe==="style"?ln(le,Gt):Xe==="dangerouslySetInnerHTML"?(Gt=Gt?Gt.__html:void 0,Gt!=null&&rn(le,Gt)):Xe==="children"?typeof Gt=="string"?(me!=="textarea"||Gt!=="")&&Gn(le,Gt):typeof Gt=="number"&&Gn(le,""+Gt):Xe!=="suppressContentEditableWarning"&&Xe!=="suppressHydrationWarning"&&Xe!=="autoFocus"&&(te.hasOwnProperty(Xe)?Gt!=null&&Xe==="onScroll"&&wr("scroll",le):Gt!=null&&Be(le,Xe,Gt,nt))}switch(me){case"input":Vt(le),Zt(le,Se,!1);break;case"textarea":Vt(le),St(le);break;case"option":Se.value!=null&&le.setAttribute("value",""+bt(Se.value));break;case"select":le.multiple=!!Se.multiple,Xe=Se.value,Xe!=null?Je(le,!!Se.multiple,Xe,!1):Se.defaultValue!=null&&Je(le,!!Se.multiple,Se.defaultValue,!0);break;default:typeof We.onClick=="function"&&(le.onclick=Pa)}switch(me){case"button":case"input":case"select":case"textarea":Se=!!Se.autoFocus;break e;case"img":Se=!0;break e;default:Se=!1}}Se&&(ue.flags|=4)}ue.ref!==null&&(ue.flags|=512,ue.flags|=2097152)}return Di(ue),null;case 6:if(le&&ue.stateNode!=null)yu(le,ue,le.memoizedProps,Se);else{if(typeof Se!="string"&&ue.stateNode===null)throw Error(_(166));if(me=Qr(as.current),Qr(qi.current),Ba(ue)){if(Se=ue.stateNode,me=ue.memoizedProps,Se[ni]=ue,(Xe=Se.nodeValue!==me)&&(le=Ai,le!==null))switch(le.tag){case 3:Ua(Se.nodeValue,me,(le.mode&1)!==0);break;case 5:le.memoizedProps.suppressHydrationWarning!==!0&&Ua(Se.nodeValue,me,(le.mode&1)!==0)}Xe&&(ue.flags|=4)}else Se=(me.nodeType===9?me:me.ownerDocument).createTextNode(Se),Se[ni]=ue,ue.stateNode=Se}return Di(ue),null;case 13:if(xr(Mr),Se=ue.memoizedState,le===null||le.memoizedState!==null&&le.memoizedState.dehydrated!==null){if(Er&&Vi!==null&&ue.mode&1&&!(ue.flags&128))Wg(),xs(),ue.flags|=98560,Xe=!1;else if(Xe=Ba(ue),Se!==null&&Se.dehydrated!==null){if(le===null){if(!Xe)throw Error(_(318));if(Xe=ue.memoizedState,Xe=Xe!==null?Xe.dehydrated:null,!Xe)throw Error(_(317));Xe[ni]=ue}else xs(),!(ue.flags&128)&&(ue.memoizedState=null),ue.flags|=4;Di(ue),Xe=!1}else Io!==null&&(ou(Io),Io=null),Xe=!0;if(!Xe)return ue.flags&65536?ue:null}return ue.flags&128?(ue.lanes=me,ue):(Se=Se!==null,Se!==(le!==null&&le.memoizedState!==null)&&Se&&(ue.child.flags|=8192,ue.mode&1&&(le===null||Mr.current&1?vi===0&&(vi=3):lu())),ue.updateQueue!==null&&(ue.flags|=4),Di(ue),null);case 4:return _s(),Oc(le,ue),le===null&&ma(ue.stateNode.containerInfo),Di(ue),null;case 10:return tl(ue.type._context),Di(ue),null;case 17:return Ri(ue.type)&&Oa(),Di(ue),null;case 19:if(xr(Mr),Xe=ue.memoizedState,Xe===null)return Di(ue),null;if(Se=(ue.flags&128)!==0,nt=Xe.rendering,nt===null)if(Se)Pg(Xe,!1);else{if(vi!==0||le!==null&&le.flags&128)for(le=ue.child;le!==null;){if(nt=So(le),nt!==null){for(ue.flags|=128,Pg(Xe,!1),Se=nt.updateQueue,Se!==null&&(ue.updateQueue=Se,ue.flags|=4),ue.subtreeFlags=0,Se=me,me=ue.child;me!==null;)Xe=me,le=Se,Xe.flags&=14680066,nt=Xe.alternate,nt===null?(Xe.childLanes=0,Xe.lanes=le,Xe.child=null,Xe.subtreeFlags=0,Xe.memoizedProps=null,Xe.memoizedState=null,Xe.updateQueue=null,Xe.dependencies=null,Xe.stateNode=null):(Xe.childLanes=nt.childLanes,Xe.lanes=nt.lanes,Xe.child=nt.child,Xe.subtreeFlags=0,Xe.deletions=null,Xe.memoizedProps=nt.memoizedProps,Xe.memoizedState=nt.memoizedState,Xe.updateQueue=nt.updateQueue,Xe.type=nt.type,le=nt.dependencies,Xe.dependencies=le===null?null:{lanes:le.lanes,firstContext:le.firstContext}),me=me.sibling;return Sr(Mr,Mr.current&1|2),ue.child}le=le.sibling}Xe.tail!==null&&ct()>sg&&(ue.flags|=128,Se=!0,Pg(Xe,!1),ue.lanes=4194304)}else{if(!Se)if(le=So(nt),le!==null){if(ue.flags|=128,Se=!0,me=le.updateQueue,me!==null&&(ue.updateQueue=me,ue.flags|=4),Pg(Xe,!0),Xe.tail===null&&Xe.tailMode==="hidden"&&!nt.alternate&&!Er)return Di(ue),null}else 2*ct()-Xe.renderingStartTime>sg&&me!==1073741824&&(ue.flags|=128,Se=!0,Pg(Xe,!1),ue.lanes=4194304);Xe.isBackwards?(nt.sibling=ue.child,ue.child=nt):(me=Xe.last,me!==null?me.sibling=nt:ue.child=nt,Xe.last=nt)}return Xe.tail!==null?(ue=Xe.tail,Xe.rendering=ue,Xe.tail=ue.sibling,Xe.renderingStartTime=ct(),ue.sibling=null,me=Mr.current,Sr(Mr,Se?me&1|2:me&1),ue):(Di(ue),null);case 22:case 23:return au(),Se=ue.memoizedState!==null,le!==null&&le.memoizedState!==null!==Se&&(ue.flags|=8192),Se&&ue.mode&1?xo&1073741824&&(Di(ue),ue.subtreeFlags&6&&(ue.flags|=8192)):Di(ue),null;case 24:return null;case 25:return null}throw Error(_(156,ue.tag))}function Qu(le,ue){switch(rs(ue),ue.tag){case 1:return Ri(ue.type)&&Oa(),le=ue.flags,le&65536?(ue.flags=le&-65537|128,ue):null;case 3:return _s(),xr(Fi),xr(fi),To(),le=ue.flags,le&65536&&!(le&128)?(ue.flags=le&-65537|128,ue):null;case 5:return wa(ue),null;case 13:if(xr(Mr),le=ue.memoizedState,le!==null&&le.dehydrated!==null){if(ue.alternate===null)throw Error(_(340));xs()}return le=ue.flags,le&65536?(ue.flags=le&-65537|128,ue):null;case 19:return xr(Mr),null;case 4:return _s(),null;case 10:return tl(ue.type._context),null;case 22:case 23:return au(),null;case 24:return null;default:return null}}var Sc=!1,zi=!1,$u=typeof WeakSet=="function"?WeakSet:Set,Ln=null;function ig(le,ue){var me=le.ref;if(me!==null)if(typeof me=="function")try{me(null)}catch(Se){qr(le,ue,Se)}else me.current=null}function jc(le,ue,me){try{me()}catch(Se){qr(le,ue,Se)}}var vu=!1;function qu(le,ue){if(ya=si,le=kr(),gi(le)){if("selectionStart"in le)var me={start:le.selectionStart,end:le.selectionEnd};else e:{me=(me=le.ownerDocument)&&me.defaultView||window;var Se=me.getSelection&&me.getSelection();if(Se&&Se.rangeCount!==0){me=Se.anchorNode;var We=Se.anchorOffset,Xe=Se.focusNode;Se=Se.focusOffset;try{me.nodeType,Xe.nodeType}catch{me=null;break e}var nt=0,Ct=-1,Gt=-1,Pt=0,Cn=0,An=le,hn=null;t:for(;;){for(var Fn;An!==me||We!==0&&An.nodeType!==3||(Ct=nt+We),An!==Xe||Se!==0&&An.nodeType!==3||(Gt=nt+Se),An.nodeType===3&&(nt+=An.nodeValue.length),(Fn=An.firstChild)!==null;)hn=An,An=Fn;for(;;){if(An===le)break t;if(hn===me&&++Pt===We&&(Ct=nt),hn===Xe&&++Cn===Se&&(Gt=nt),(Fn=An.nextSibling)!==null)break;An=hn,hn=An.parentNode}An=Fn}me=Ct===-1||Gt===-1?null:{start:Ct,end:Gt}}else me=null}me=me||{start:0,end:0}}else me=null;for(vg={focusedElem:le,selectionRange:me},si=!1,Ln=ue;Ln!==null;)if(ue=Ln,le=ue.child,(ue.subtreeFlags&1028)!==0&&le!==null)le.return=ue,Ln=le;else for(;Ln!==null;){ue=Ln;try{var Xn=ue.alternate;if(ue.flags&1024)switch(ue.tag){case 0:case 11:case 15:break;case 1:if(Xn!==null){var Yn=Xn.memoizedProps,ri=Xn.memoizedState,Nt=ue.stateNode,Rt=Nt.getSnapshotBeforeUpdate(ue.elementType===ue.type?Yn:ho(ue.type,Yn),ri);Nt.__reactInternalSnapshotBeforeUpdate=Rt}break;case 3:var kt=ue.stateNode.containerInfo;kt.nodeType===1?kt.textContent="":kt.nodeType===9&&kt.documentElement&&kt.removeChild(kt.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(_(163))}}catch(vn){qr(ue,ue.return,vn)}if(le=ue.sibling,le!==null){le.return=ue.return,Ln=le;break}Ln=ue.return}return Xn=vu,vu=!1,Xn}function Og(le,ue,me){var Se=ue.updateQueue;if(Se=Se!==null?Se.lastEffect:null,Se!==null){var We=Se=Se.next;do{if((We.tag&le)===le){var Xe=We.destroy;We.destroy=void 0,Xe!==void 0&&jc(ue,me,Xe)}We=We.next}while(We!==Se)}}function Rc(le,ue){if(ue=ue.updateQueue,ue=ue!==null?ue.lastEffect:null,ue!==null){var me=ue=ue.next;do{if((me.tag&le)===le){var Se=me.create;me.destroy=Se()}me=me.next}while(me!==ue)}}function Jc(le){var ue=le.ref;if(ue!==null){var me=le.stateNode;switch(le.tag){case 5:le=me;break;default:le=me}typeof ue=="function"?ue(le):ue.current=le}}function Bu(le){var ue=le.alternate;ue!==null&&(le.alternate=null,Bu(ue)),le.child=null,le.deletions=null,le.sibling=null,le.tag===5&&(ue=le.stateNode,ue!==null&&(delete ue[ni],delete ue[va],delete ue[Ds],delete ue[kl],delete ue[Yl])),le.stateNode=null,le.return=null,le.dependencies=null,le.memoizedProps=null,le.memoizedState=null,le.pendingProps=null,le.stateNode=null,le.updateQueue=null}function Gu(le){return le.tag===5||le.tag===3||le.tag===4}function Su(le){e:for(;;){for(;le.sibling===null;){if(le.return===null||Gu(le.return))return null;le=le.return}for(le.sibling.return=le.return,le=le.sibling;le.tag!==5&&le.tag!==6&&le.tag!==18;){if(le.flags&2||le.child===null||le.tag===4)continue e;le.child.return=le,le=le.child}if(!(le.flags&2))return le.stateNode}}function Qc(le,ue,me){var Se=le.tag;if(Se===5||Se===6)le=le.stateNode,ue?me.nodeType===8?me.parentNode.insertBefore(le,ue):me.insertBefore(le,ue):(me.nodeType===8?(ue=me.parentNode,ue.insertBefore(le,me)):(ue=me,ue.appendChild(le)),me=me._reactRootContainer,me!=null||ue.onclick!==null||(ue.onclick=Pa));else if(Se!==4&&(le=le.child,le!==null))for(Qc(le,ue,me),le=le.sibling;le!==null;)Qc(le,ue,me),le=le.sibling}function $c(le,ue,me){var Se=le.tag;if(Se===5||Se===6)le=le.stateNode,ue?me.insertBefore(le,ue):me.appendChild(le);else if(Se!==4&&(le=le.child,le!==null))for($c(le,ue,me),le=le.sibling;le!==null;)$c(le,ue,me),le=le.sibling}var Ni=null,ds=!1;function Ea(le,ue,me){for(me=me.child;me!==null;)Ru(le,ue,me),me=me.sibling}function Ru(le,ue,me){if(gn&&typeof gn.onCommitFiberUnmount=="function")try{gn.onCommitFiberUnmount(bn,me)}catch{}switch(me.tag){case 5:zi||ig(me,ue);case 6:var Se=Ni,We=ds;Ni=null,Ea(le,ue,me),Ni=Se,ds=We,Ni!==null&&(ds?(le=Ni,me=me.stateNode,le.nodeType===8?le.parentNode.removeChild(me):le.removeChild(me)):Ni.removeChild(me.stateNode));break;case 18:Ni!==null&&(ds?(le=Ni,me=me.stateNode,le.nodeType===8?Xl(le.parentNode,me):le.nodeType===1&&Xl(le,me),As(le)):Xl(Ni,me.stateNode));break;case 4:Se=Ni,We=ds,Ni=me.stateNode.containerInfo,ds=!0,Ea(le,ue,me),Ni=Se,ds=We;break;case 0:case 11:case 14:case 15:if(!zi&&(Se=me.updateQueue,Se!==null&&(Se=Se.lastEffect,Se!==null))){We=Se=Se.next;do{var Xe=We,nt=Xe.destroy;Xe=Xe.tag,nt!==void 0&&(Xe&2||Xe&4)&&jc(me,ue,nt),We=We.next}while(We!==Se)}Ea(le,ue,me);break;case 1:if(!zi&&(ig(me,ue),Se=me.stateNode,typeof Se.componentWillUnmount=="function"))try{Se.props=me.memoizedProps,Se.state=me.memoizedState,Se.componentWillUnmount()}catch(Ct){qr(me,ue,Ct)}Ea(le,ue,me);break;case 21:Ea(le,ue,me);break;case 22:me.mode&1?(zi=(Se=zi)||me.memoizedState!==null,Ea(le,ue,me),zi=Se):Ea(le,ue,me);break;default:Ea(le,ue,me)}}function wu(le){var ue=le.updateQueue;if(ue!==null){le.updateQueue=null;var me=le.stateNode;me===null&&(me=le.stateNode=new $u),ue.forEach(function(Se){var We=gd.bind(null,le,Se);me.has(Se)||(me.add(Se),Se.then(We,We))})}}function ps(le,ue){var me=ue.deletions;if(me!==null)for(var Se=0;Se<me.length;Se++){var We=me[Se];try{var Xe=le,nt=ue,Ct=nt;e:for(;Ct!==null;){switch(Ct.tag){case 5:Ni=Ct.stateNode,ds=!1;break e;case 3:Ni=Ct.stateNode.containerInfo,ds=!0;break e;case 4:Ni=Ct.stateNode.containerInfo,ds=!0;break e}Ct=Ct.return}if(Ni===null)throw Error(_(160));Ru(Xe,nt,We),Ni=null,ds=!1;var Gt=We.alternate;Gt!==null&&(Gt.return=null),We.return=null}catch(Pt){qr(We,ue,Pt)}}if(ue.subtreeFlags&12854)for(ue=ue.child;ue!==null;)xu(ue,le),ue=ue.sibling}function xu(le,ue){var me=le.alternate,Se=le.flags;switch(le.tag){case 0:case 11:case 14:case 15:if(ps(ue,le),Ms(le),Se&4){try{Og(3,le,le.return),Rc(3,le)}catch(Yn){qr(le,le.return,Yn)}try{Og(5,le,le.return)}catch(Yn){qr(le,le.return,Yn)}}break;case 1:ps(ue,le),Ms(le),Se&512&&me!==null&&ig(me,me.return);break;case 5:if(ps(ue,le),Ms(le),Se&512&&me!==null&&ig(me,me.return),le.flags&32){var We=le.stateNode;try{Gn(We,"")}catch(Yn){qr(le,le.return,Yn)}}if(Se&4&&(We=le.stateNode,We!=null)){var Xe=le.memoizedProps,nt=me!==null?me.memoizedProps:Xe,Ct=le.type,Gt=le.updateQueue;if(le.updateQueue=null,Gt!==null)try{Ct==="input"&&Xe.type==="radio"&&Xe.name!=null&&Et(We,Xe),yn(Ct,nt);var Pt=yn(Ct,Xe);for(nt=0;nt<Gt.length;nt+=2){var Cn=Gt[nt],An=Gt[nt+1];Cn==="style"?ln(We,An):Cn==="dangerouslySetInnerHTML"?rn(We,An):Cn==="children"?Gn(We,An):Be(We,Cn,An,Pt)}switch(Ct){case"input":Ut(We,Xe);break;case"textarea":ft(We,Xe);break;case"select":var hn=We._wrapperState.wasMultiple;We._wrapperState.wasMultiple=!!Xe.multiple;var Fn=Xe.value;Fn!=null?Je(We,!!Xe.multiple,Fn,!1):hn!==!!Xe.multiple&&(Xe.defaultValue!=null?Je(We,!!Xe.multiple,Xe.defaultValue,!0):Je(We,!!Xe.multiple,Xe.multiple?[]:"",!1))}We[va]=Xe}catch(Yn){qr(le,le.return,Yn)}}break;case 6:if(ps(ue,le),Ms(le),Se&4){if(le.stateNode===null)throw Error(_(162));We=le.stateNode,Xe=le.memoizedProps;try{We.nodeValue=Xe}catch(Yn){qr(le,le.return,Yn)}}break;case 3:if(ps(ue,le),Ms(le),Se&4&&me!==null&&me.memoizedState.isDehydrated)try{As(ue.containerInfo)}catch(Yn){qr(le,le.return,Yn)}break;case 4:ps(ue,le),Ms(le);break;case 13:ps(ue,le),Ms(le),We=le.child,We.flags&8192&&(Xe=We.memoizedState!==null,We.stateNode.isHidden=Xe,!Xe||We.alternate!==null&&We.alternate.memoizedState!==null||(tu=ct())),Se&4&&wu(le);break;case 22:if(Cn=me!==null&&me.memoizedState!==null,le.mode&1?(zi=(Pt=zi)||Cn,ps(ue,le),zi=Pt):ps(ue,le),Ms(le),Se&8192){if(Pt=le.memoizedState!==null,(le.stateNode.isHidden=Pt)&&!Cn&&le.mode&1)for(Ln=le,Cn=le.child;Cn!==null;){for(An=Ln=Cn;Ln!==null;){switch(hn=Ln,Fn=hn.child,hn.tag){case 0:case 11:case 14:case 15:Og(4,hn,hn.return);break;case 1:ig(hn,hn.return);var Xn=hn.stateNode;if(typeof Xn.componentWillUnmount=="function"){Se=hn,me=hn.return;try{ue=Se,Xn.props=ue.memoizedProps,Xn.state=ue.memoizedState,Xn.componentWillUnmount()}catch(Yn){qr(Se,me,Yn)}}break;case 5:ig(hn,hn.return);break;case 22:if(hn.memoizedState!==null){Eu(An);continue}}Fn!==null?(Fn.return=hn,Ln=Fn):Eu(An)}Cn=Cn.sibling}e:for(Cn=null,An=le;;){if(An.tag===5){if(Cn===null){Cn=An;try{We=An.stateNode,Pt?(Xe=We.style,typeof Xe.setProperty=="function"?Xe.setProperty("display","none","important"):Xe.display="none"):(Ct=An.stateNode,Gt=An.memoizedProps.style,nt=Gt!=null&&Gt.hasOwnProperty("display")?Gt.display:null,Ct.style.display=un("display",nt))}catch(Yn){qr(le,le.return,Yn)}}}else if(An.tag===6){if(Cn===null)try{An.stateNode.nodeValue=Pt?"":An.memoizedProps}catch(Yn){qr(le,le.return,Yn)}}else if((An.tag!==22&&An.tag!==23||An.memoizedState===null||An===le)&&An.child!==null){An.child.return=An,An=An.child;continue}if(An===le)break e;for(;An.sibling===null;){if(An.return===null||An.return===le)break e;Cn===An&&(Cn=null),An=An.return}Cn===An&&(Cn=null),An.sibling.return=An.return,An=An.sibling}}break;case 19:ps(ue,le),Ms(le),Se&4&&wu(le);break;case 21:break;default:ps(ue,le),Ms(le)}}function Ms(le){var ue=le.flags;if(ue&2){try{e:{for(var me=le.return;me!==null;){if(Gu(me)){var Se=me;break e}me=me.return}throw Error(_(160))}switch(Se.tag){case 5:var We=Se.stateNode;Se.flags&32&&(Gn(We,""),Se.flags&=-33);var Xe=Su(le);$c(le,Xe,We);break;case 3:case 4:var nt=Se.stateNode.containerInfo,Ct=Su(le);Qc(le,Ct,nt);break;default:throw Error(_(161))}}catch(Gt){qr(le,le.return,Gt)}le.flags&=-3}ue&4096&&(le.flags&=-4097)}function ed(le,ue,me){Ln=le,Zu(le)}function Zu(le,ue,me){for(var Se=(le.mode&1)!==0;Ln!==null;){var We=Ln,Xe=We.child;if(We.tag===22&&Se){var nt=We.memoizedState!==null||Sc;if(!nt){var Ct=We.alternate,Gt=Ct!==null&&Ct.memoizedState!==null||zi;Ct=Sc;var Pt=zi;if(Sc=nt,(zi=Gt)&&!Pt)for(Ln=We;Ln!==null;)nt=Ln,Gt=nt.child,nt.tag===22&&nt.memoizedState!==null?Mu(We):Gt!==null?(Gt.return=nt,Ln=Gt):Mu(We);for(;Xe!==null;)Ln=Xe,Zu(Xe),Xe=Xe.sibling;Ln=We,Sc=Ct,zi=Pt}_u(le)}else We.subtreeFlags&8772&&Xe!==null?(Xe.return=We,Ln=Xe):_u(le)}}function _u(le){for(;Ln!==null;){var ue=Ln;if(ue.flags&8772){var me=ue.alternate;try{if(ue.flags&8772)switch(ue.tag){case 0:case 11:case 15:zi||Rc(5,ue);break;case 1:var Se=ue.stateNode;if(ue.flags&4&&!zi)if(me===null)Se.componentDidMount();else{var We=ue.elementType===ue.type?me.memoizedProps:ho(ue.type,me.memoizedProps);Se.componentDidUpdate(We,me.memoizedState,Se.__reactInternalSnapshotBeforeUpdate)}var Xe=ue.updateQueue;Xe!==null&&Ra(ue,Xe,Se);break;case 3:var nt=ue.updateQueue;if(nt!==null){if(me=null,ue.child!==null)switch(ue.child.tag){case 5:me=ue.child.stateNode;break;case 1:me=ue.child.stateNode}Ra(ue,nt,me)}break;case 5:var Ct=ue.stateNode;if(me===null&&ue.flags&4){me=Ct;var Gt=ue.memoizedProps;switch(ue.type){case"button":case"input":case"select":case"textarea":Gt.autoFocus&&me.focus();break;case"img":Gt.src&&(me.src=Gt.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(ue.memoizedState===null){var Pt=ue.alternate;if(Pt!==null){var Cn=Pt.memoizedState;if(Cn!==null){var An=Cn.dehydrated;An!==null&&As(An)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(_(163))}zi||ue.flags&512&&Jc(ue)}catch(hn){qr(ue,ue.return,hn)}}if(ue===le){Ln=null;break}if(me=ue.sibling,me!==null){me.return=ue.return,Ln=me;break}Ln=ue.return}}function Eu(le){for(;Ln!==null;){var ue=Ln;if(ue===le){Ln=null;break}var me=ue.sibling;if(me!==null){me.return=ue.return,Ln=me;break}Ln=ue.return}}function Mu(le){for(;Ln!==null;){var ue=Ln;try{switch(ue.tag){case 0:case 11:case 15:var me=ue.return;try{Rc(4,ue)}catch(Gt){qr(ue,me,Gt)}break;case 1:var Se=ue.stateNode;if(typeof Se.componentDidMount=="function"){var We=ue.return;try{Se.componentDidMount()}catch(Gt){qr(ue,We,Gt)}}var Xe=ue.return;try{Jc(ue)}catch(Gt){qr(ue,Xe,Gt)}break;case 5:var nt=ue.return;try{Jc(ue)}catch(Gt){qr(ue,nt,Gt)}}}catch(Gt){qr(ue,ue.return,Gt)}if(ue===le){Ln=null;break}var Ct=ue.sibling;if(Ct!==null){Ct.return=ue.return,Ln=Ct;break}Ln=ue.return}}var nd=Math.ceil,wc=Re.ReactCurrentDispatcher,qc=Re.ReactCurrentOwner,Lo=Re.ReactCurrentBatchConfig,fr=0,Zi=null,Ii=null,Li=0,xo=0,og=Dr(0),vi=0,jg=null,dl=0,xc=0,eu=0,Jg=null,Co=null,tu=0,sg=1/0,sa=null,Zc=!1,nu=null,Ma=null,_c=!1,Fa=null,Ec=0,Qg=0,ru=null,Mc=-1,Fc=0;function io(){return fr&6?ct():Mc!==-1?Mc:Mc=ct()}function Wa(le){return le.mode&1?fr&2&&Li!==0?Li&-Li:zc.transition!==null?(Fc===0&&(Fc=On()),Fc):(le=lr,le!==0||(le=window.event,le=le===void 0?16:bs(le.type)),le):1}function Is(le,ue,me,Se){if(50<Qg)throw Qg=0,ru=null,Error(_(185));ur(le,me,Se),(!(fr&2)||le!==Zi)&&(le===Zi&&(!(fr&2)&&(xc|=me),vi===4&&Va(le,Li)),fo(le,Se),me===1&&fr===0&&!(ue.mode&1)&&(sg=ct()+500,Ja&&Wo()))}function fo(le,ue){var me=le.callbackNode;tr(le,ue);var Se=er(le,le===Zi?Li:0);if(Se===0)me!==null&&Qe(me),le.callbackNode=null,le.callbackPriority=0;else if(ue=Se&-Se,le.callbackPriority!==ue){if(me!=null&&Qe(me),ue===1)le.tag===0?dc(Wu.bind(null,le)):Qa(Wu.bind(null,le)),Dc(function(){!(fr&6)&&Wo()}),me=null;else{switch(ii(Se)){case 1:me=Xt;break;case 4:me=Qt;break;case 16:me=sn;break;case 536870912:me=Bn;break;default:me=sn}me=Yu(me,Fu.bind(null,le))}le.callbackPriority=ue,le.callbackNode=me}}function Fu(le,ue){if(Mc=-1,Fc=0,fr&6)throw Error(_(327));var me=le.callbackNode;if(ag()&&le.callbackNode!==me)return null;var Se=er(le,le===Zi?Li:0);if(Se===0)return null;if(Se&30||Se&le.expiredLanes||ue)ue=Wc(le,Se);else{ue=Se;var We=fr;fr|=2;var Xe=Tu();(Zi!==le||Li!==ue)&&(sa=null,sg=ct()+500,Il(le,ue));do try{od();break}catch(Ct){Vu(le,Ct)}while(!0);$s(),wc.current=Xe,fr=We,Ii!==null?ue=0:(Zi=null,Li=0,ue=vi)}if(ue!==0){if(ue===2&&(We=Qn(le),We!==0&&(Se=We,ue=iu(le,We))),ue===1)throw me=jg,Il(le,0),Va(le,Se),fo(le,ct()),me;if(ue===6)Va(le,Se);else{if(We=le.current.alternate,!(Se&30)&&!rd(We)&&(ue=Wc(le,Se),ue===2&&(Xe=Qn(le),Xe!==0&&(Se=Xe,ue=iu(le,Xe))),ue===1))throw me=jg,Il(le,0),Va(le,Se),fo(le,ct()),me;switch(le.finishedWork=We,le.finishedLanes=Se,ue){case 0:case 1:throw Error(_(345));case 2:hl(le,Co,sa);break;case 3:if(Va(le,Se),(Se&130023424)===Se&&(ue=tu+500-ct(),10<ue)){if(er(le,0)!==0)break;if(We=le.suspendedLanes,(We&Se)!==Se){io(),le.pingedLanes|=le.suspendedLanes&We;break}le.timeoutHandle=Gg(hl.bind(null,le,Co,sa),ue);break}hl(le,Co,sa);break;case 4:if(Va(le,Se),(Se&4194240)===Se)break;for(ue=le.eventTimes,We=-1;0<Se;){var nt=31-wn(Se);Xe=1<<nt,nt=ue[nt],nt>We&&(We=nt),Se&=~Xe}if(Se=We,Se=ct()-Se,Se=(120>Se?120:480>Se?480:1080>Se?1080:1920>Se?1920:3e3>Se?3e3:4320>Se?4320:1960*nd(Se/1960))-Se,10<Se){le.timeoutHandle=Gg(hl.bind(null,le,Co,sa),Se);break}hl(le,Co,sa);break;case 5:hl(le,Co,sa);break;default:throw Error(_(329))}}}return fo(le,ct()),le.callbackNode===me?Fu.bind(null,le):null}function iu(le,ue){var me=Jg;return le.current.memoizedState.isDehydrated&&(Il(le,ue).flags|=256),le=Wc(le,ue),le!==2&&(ue=Co,Co=me,ue!==null&&ou(ue)),le}function ou(le){Co===null?Co=le:Co.push.apply(Co,le)}function rd(le){for(var ue=le;;){if(ue.flags&16384){var me=ue.updateQueue;if(me!==null&&(me=me.stores,me!==null))for(var Se=0;Se<me.length;Se++){var We=me[Se],Xe=We.getSnapshot;We=We.value;try{if(!ji(Xe(),We))return!1}catch{return!1}}}if(me=ue.child,ue.subtreeFlags&16384&&me!==null)me.return=ue,ue=me;else{if(ue===le)break;for(;ue.sibling===null;){if(ue.return===null||ue.return===le)return!0;ue=ue.return}ue.sibling.return=ue.return,ue=ue.sibling}}return!0}function Va(le,ue){for(ue&=~eu,ue&=~xc,le.suspendedLanes|=ue,le.pingedLanes&=~ue,le=le.expirationTimes;0<ue;){var me=31-wn(ue),Se=1<<me;le[me]=-1,ue&=~Se}}function Wu(le){if(fr&6)throw Error(_(327));ag();var ue=er(le,0);if(!(ue&1))return fo(le,ct()),null;var me=Wc(le,ue);if(le.tag!==0&&me===2){var Se=Qn(le);Se!==0&&(ue=Se,me=iu(le,Se))}if(me===1)throw me=jg,Il(le,0),Va(le,ue),fo(le,ct()),me;if(me===6)throw Error(_(345));return le.finishedWork=le.current.alternate,le.finishedLanes=ue,hl(le,Co,sa),fo(le,ct()),null}function su(le,ue){var me=fr;fr|=1;try{return le(ue)}finally{fr=me,fr===0&&(sg=ct()+500,Ja&&Wo())}}function pl(le){Fa!==null&&Fa.tag===0&&!(fr&6)&&ag();var ue=fr;fr|=1;var me=Lo.transition,Se=lr;try{if(Lo.transition=null,lr=1,le)return le()}finally{lr=Se,Lo.transition=me,fr=ue,!(fr&6)&&Wo()}}function au(){xo=og.current,xr(og)}function Il(le,ue){le.finishedWork=null,le.finishedLanes=0;var me=le.timeoutHandle;if(me!==-1&&(le.timeoutHandle=-1,Sg(me)),Ii!==null)for(me=Ii.return;me!==null;){var Se=me;switch(rs(Se),Se.tag){case 1:Se=Se.type.childContextTypes,Se!=null&&Oa();break;case 3:_s(),xr(Fi),xr(fi),To();break;case 5:wa(Se);break;case 4:_s();break;case 13:xr(Mr);break;case 19:xr(Mr);break;case 10:tl(Se.type._context);break;case 22:case 23:au()}me=me.return}if(Zi=le,Ii=le=Ta(le.current,null),Li=xo=ue,vi=0,jg=null,eu=xc=dl=0,Co=Jg=null,ss!==null){for(ue=0;ue<ss.length;ue++)if(me=ss[ue],Se=me.interleaved,Se!==null){me.interleaved=null;var We=Se.next,Xe=me.pending;if(Xe!==null){var nt=Xe.next;Xe.next=We,Se.next=nt}me.pending=Se}ss=null}return le}function Vu(le,ue){do{var me=Ii;try{if($s(),na.current=ng,Ro){for(var Se=Zr.memoizedState;Se!==null;){var We=Se.queue;We!==null&&(We.pending=null),Se=Se.next}Ro=!1}if(ls=0,Cr=Ur=Zr=null,xi=!1,Es=0,qc.current=null,me===null||me.return===null){vi=1,jg=ue,Ii=null;break}e:{var Xe=le,nt=me.return,Ct=me,Gt=ue;if(ue=Li,Ct.flags|=32768,Gt!==null&&typeof Gt=="object"&&typeof Gt.then=="function"){var Pt=Gt,Cn=Ct,An=Cn.tag;if(!(Cn.mode&1)&&(An===0||An===11||An===15)){var hn=Cn.alternate;hn?(Cn.updateQueue=hn.updateQueue,Cn.memoizedState=hn.memoizedState,Cn.lanes=hn.lanes):(Cn.updateQueue=null,Cn.memoizedState=null)}var Fn=Vn(nt);if(Fn!==null){Fn.flags&=-257,or(Fn,nt,Ct,Xe,ue),Fn.mode&1&&mn(Xe,Pt,ue),ue=Fn,Gt=Pt;var Xn=ue.updateQueue;if(Xn===null){var Yn=new Set;Yn.add(Gt),ue.updateQueue=Yn}else Xn.add(Gt);break e}else{if(!(ue&1)){mn(Xe,Pt,ue),lu();break e}Gt=Error(_(426))}}else if(Er&&Ct.mode&1){var ri=Vn(nt);if(ri!==null){!(ri.flags&65536)&&(ri.flags|=256),or(ri,nt,Ct,Xe,ue),Ga(we(Gt,Ct));break e}}Xe=Gt=we(Gt,Ct),vi!==4&&(vi=2),Jg===null?Jg=[Xe]:Jg.push(Xe),Xe=nt;do{switch(Xe.tag){case 3:Xe.flags|=65536,ue&=-ue,Xe.lanes|=ue;var Nt=xt(Xe,Gt,ue);qs(Xe,Nt);break e;case 1:Ct=Gt;var Rt=Xe.type,kt=Xe.stateNode;if(!(Xe.flags&128)&&(typeof Rt.getDerivedStateFromError=="function"||kt!==null&&typeof kt.componentDidCatch=="function"&&(Ma===null||!Ma.has(kt)))){Xe.flags|=65536,ue&=-ue,Xe.lanes|=ue;var vn=nn(Xe,Ct,ue);qs(Xe,vn);break e}}Xe=Xe.return}while(Xe!==null)}Lu(me)}catch(zn){ue=zn,Ii===me&&me!==null&&(Ii=me=me.return);continue}break}while(!0)}function Tu(){var le=wc.current;return wc.current=ng,le===null?ng:le}function lu(){(vi===0||vi===3||vi===2)&&(vi=4),Zi===null||!(dl&268435455)&&!(xc&268435455)||Va(Zi,Li)}function Wc(le,ue){var me=fr;fr|=2;var Se=Tu();(Zi!==le||Li!==ue)&&(sa=null,Il(le,ue));do try{id();break}catch(We){Vu(le,We)}while(!0);if($s(),fr=me,wc.current=Se,Ii!==null)throw Error(_(261));return Zi=null,Li=0,vi}function id(){for(;Ii!==null;)Nu(Ii)}function od(){for(;Ii!==null&&!pt();)Nu(Ii)}function Nu(le){var ue=ku(le.alternate,le,xo);le.memoizedProps=le.pendingProps,ue===null?Lu(le):Ii=ue,qc.current=null}function Lu(le){var ue=le;do{var me=ue.alternate;if(le=ue.return,ue.flags&32768){if(me=Qu(me,ue),me!==null){me.flags&=32767,Ii=me;return}if(le!==null)le.flags|=32768,le.subtreeFlags=0,le.deletions=null;else{vi=6,Ii=null;return}}else if(me=Ju(me,ue,xo),me!==null){Ii=me;return}if(ue=ue.sibling,ue!==null){Ii=ue;return}Ii=ue=le}while(ue!==null);vi===0&&(vi=5)}function hl(le,ue,me){var Se=lr,We=Lo.transition;try{Lo.transition=null,lr=1,sd(le,ue,me,Se)}finally{Lo.transition=We,lr=Se}return null}function sd(le,ue,me,Se){do ag();while(Fa!==null);if(fr&6)throw Error(_(327));me=le.finishedWork;var We=le.finishedLanes;if(me===null)return null;if(le.finishedWork=null,le.finishedLanes=0,me===le.current)throw Error(_(177));le.callbackNode=null,le.callbackPriority=0;var Xe=me.lanes|me.childLanes;if(yr(le,Xe),le===Zi&&(Ii=Zi=null,Li=0),!(me.subtreeFlags&2064)&&!(me.flags&2064)||_c||(_c=!0,Yu(sn,function(){return ag(),null})),Xe=(me.flags&15990)!==0,me.subtreeFlags&15990||Xe){Xe=Lo.transition,Lo.transition=null;var nt=lr;lr=1;var Ct=fr;fr|=4,qc.current=null,qu(le,me),xu(me,le),ci(vg),si=!!ya,vg=ya=null,le.current=me,ed(me),At(),fr=Ct,lr=nt,Lo.transition=Xe}else le.current=me;if(_c&&(_c=!1,Fa=le,Ec=We),Xe=le.pendingLanes,Xe===0&&(Ma=null),xn(me.stateNode),fo(le,ct()),ue!==null)for(Se=le.onRecoverableError,me=0;me<ue.length;me++)We=ue[me],Se(We.value,{componentStack:We.stack,digest:We.digest});if(Zc)throw Zc=!1,le=nu,nu=null,le;return Ec&1&&le.tag!==0&&ag(),Xe=le.pendingLanes,Xe&1?le===ru?Qg++:(Qg=0,ru=le):Qg=0,Wo(),null}function ag(){if(Fa!==null){var le=ii(Ec),ue=Lo.transition,me=lr;try{if(Lo.transition=null,lr=16>le?16:le,Fa===null)var Se=!1;else{if(le=Fa,Fa=null,Ec=0,fr&6)throw Error(_(331));var We=fr;for(fr|=4,Ln=le.current;Ln!==null;){var Xe=Ln,nt=Xe.child;if(Ln.flags&16){var Ct=Xe.deletions;if(Ct!==null){for(var Gt=0;Gt<Ct.length;Gt++){var Pt=Ct[Gt];for(Ln=Pt;Ln!==null;){var Cn=Ln;switch(Cn.tag){case 0:case 11:case 15:Og(8,Cn,Xe)}var An=Cn.child;if(An!==null)An.return=Cn,Ln=An;else for(;Ln!==null;){Cn=Ln;var hn=Cn.sibling,Fn=Cn.return;if(Bu(Cn),Cn===Pt){Ln=null;break}if(hn!==null){hn.return=Fn,Ln=hn;break}Ln=Fn}}}var Xn=Xe.alternate;if(Xn!==null){var Yn=Xn.child;if(Yn!==null){Xn.child=null;do{var ri=Yn.sibling;Yn.sibling=null,Yn=ri}while(Yn!==null)}}Ln=Xe}}if(Xe.subtreeFlags&2064&&nt!==null)nt.return=Xe,Ln=nt;else e:for(;Ln!==null;){if(Xe=Ln,Xe.flags&2048)switch(Xe.tag){case 0:case 11:case 15:Og(9,Xe,Xe.return)}var Nt=Xe.sibling;if(Nt!==null){Nt.return=Xe.return,Ln=Nt;break e}Ln=Xe.return}}var Rt=le.current;for(Ln=Rt;Ln!==null;){nt=Ln;var kt=nt.child;if(nt.subtreeFlags&2064&&kt!==null)kt.return=nt,Ln=kt;else e:for(nt=Rt;Ln!==null;){if(Ct=Ln,Ct.flags&2048)try{switch(Ct.tag){case 0:case 11:case 15:Rc(9,Ct)}}catch(zn){qr(Ct,Ct.return,zn)}if(Ct===nt){Ln=null;break e}var vn=Ct.sibling;if(vn!==null){vn.return=Ct.return,Ln=vn;break e}Ln=Ct.return}}if(fr=We,Wo(),gn&&typeof gn.onPostCommitFiberRoot=="function")try{gn.onPostCommitFiberRoot(bn,le)}catch{}Se=!0}return Se}finally{lr=me,Lo.transition=ue}}return!1}function Hu(le,ue,me){ue=we(me,ue),ue=xt(le,ue,1),le=Tr(le,ue,1),ue=io(),le!==null&&(ur(le,1,ue),fo(le,ue))}function qr(le,ue,me){if(le.tag===3)Hu(le,le,me);else for(;ue!==null;){if(ue.tag===3){Hu(ue,le,me);break}else if(ue.tag===1){var Se=ue.stateNode;if(typeof ue.type.getDerivedStateFromError=="function"||typeof Se.componentDidCatch=="function"&&(Ma===null||!Ma.has(Se))){le=we(me,le),le=nn(ue,le,1),ue=Tr(ue,le,1),le=io(),ue!==null&&(ur(ue,1,le),fo(ue,le));break}}ue=ue.return}}function ad(le,ue,me){var Se=le.pingCache;Se!==null&&Se.delete(ue),ue=io(),le.pingedLanes|=le.suspendedLanes&me,Zi===le&&(Li&me)===me&&(vi===4||vi===3&&(Li&130023424)===Li&&500>ct()-tu?Il(le,0):eu|=me),fo(le,ue)}function Xu(le,ue){ue===0&&(le.mode&1?(ue=nr,nr<<=1,!(nr&130023424)&&(nr=4194304)):ue=1);var me=io();le=Go(le,ue),le!==null&&(ur(le,ue,me),fo(le,me))}function ld(le){var ue=le.memoizedState,me=0;ue!==null&&(me=ue.retryLane),Xu(le,me)}function gd(le,ue){var me=0;switch(le.tag){case 13:var Se=le.stateNode,We=le.memoizedState;We!==null&&(me=We.retryLane);break;case 19:Se=le.stateNode;break;default:throw Error(_(314))}Se!==null&&Se.delete(ue),Xu(le,me)}var ku;ku=function(le,ue,me){if(le!==null)if(le.memoizedProps!==ue.pendingProps||Fi.current)cr=!0;else{if(!(le.lanes&me)&&!(ue.flags&128))return cr=!1,ju(le,ue,me);cr=!!(le.flags&131072)}else cr=!1,Er&&ue.flags&1048576&&_g(ue,Ul,ue.index);switch(ue.lanes=0,ue.tag){case 2:var Se=ue.type;Gc(le,ue),le=ue.pendingProps;var We=zs(ue,fi.current);Zs(ue,me),We=sl(null,ue,Se,le,We,me);var Xe=Lg();return ue.flags|=1,typeof We=="object"&&We!==null&&typeof We.render=="function"&&We.$$typeof===void 0?(ue.tag=1,ue.memoizedState=null,ue.updateQueue=null,Ri(Se)?(Xe=!0,Us(ue)):Xe=!1,ue.memoizedState=We.state!==null&&We.state!==void 0?We.state:null,gr(ue),We.updater=rg,ue.stateNode=We,We._reactInternals=ue,Ge(ue,Se,le,me),ue=ar(null,ue,Se,!0,Xe,me)):(ue.tag=0,Er&&Xe&&Eg(ue),En(null,ue,We,me),ue=ue.child),ue;case 16:Se=ue.elementType;e:{switch(Gc(le,ue),le=ue.pendingProps,We=Se._init,Se=We(Se._payload),ue.type=Se,We=ue.tag=ud(Se),le=ho(Se,le),We){case 0:ue=_n(null,ue,Se,le,me);break e;case 1:ue=Dn(null,ue,Se,le,me);break e;case 11:ue=yi(null,ue,Se,le,me);break e;case 14:ue=ro(null,ue,Se,ho(Se.type,le),me);break e}throw Error(_(306,Se,""))}return ue;case 0:return Se=ue.type,We=ue.pendingProps,We=ue.elementType===Se?We:ho(Se,We),_n(le,ue,Se,We,me);case 1:return Se=ue.type,We=ue.pendingProps,We=ue.elementType===Se?We:ho(Se,We),Dn(le,ue,Se,We,me);case 3:e:{if(sr(ue),le===null)throw Error(_(387));Se=ue.pendingProps,Xe=ue.memoizedState,We=Xe.element,jr(le,ue),zr(ue,Se,null,me);var nt=ue.memoizedState;if(Se=nt.element,Xe.isDehydrated)if(Xe={element:Se,isDehydrated:!1,cache:nt.cache,pendingSuspenseBoundaries:nt.pendingSuspenseBoundaries,transitions:nt.transitions},ue.updateQueue.baseState=Xe,ue.memoizedState=Xe,ue.flags&256){We=we(Error(_(423)),ue),ue=hr(le,ue,Se,me,We);break e}else if(Se!==We){We=we(Error(_(424)),ue),ue=hr(le,ue,Se,me,We);break e}else for(Vi=Jo(ue.stateNode.containerInfo.firstChild),Ai=ue,Er=!0,Io=null,me=el(ue,null,Se,me),ue.child=me;me;)me.flags=me.flags&-3|4096,me=me.sibling;else{if(xs(),Se===We){ue=oa(le,ue,me);break e}En(le,ue,Se,me)}ue=ue.child}return ue;case 5:return ta(ue),le===null&&Ol(ue),Se=ue.type,We=ue.pendingProps,Xe=le!==null?le.memoizedProps:null,nt=We.children,Bg(Se,We)?nt=null:Xe!==null&&Bg(Se,Xe)&&(ue.flags|=32),qt(le,ue),En(le,ue,nt,me),ue.child;case 6:return le===null&&Ol(ue),null;case 13:return us(le,ue,me);case 4:return il(ue,ue.stateNode.containerInfo),Se=ue.pendingProps,le===null?ue.child=js(ue,null,Se,me):En(le,ue,Se,me),ue.child;case 11:return Se=ue.type,We=ue.pendingProps,We=ue.elementType===Se?We:ho(Se,We),yi(le,ue,Se,We,me);case 7:return En(le,ue,ue.pendingProps,me),ue.child;case 8:return En(le,ue,ue.pendingProps.children,me),ue.child;case 12:return En(le,ue,ue.pendingProps.children,me),ue.child;case 10:e:{if(Se=ue.type._context,We=ue.pendingProps,Xe=ue.memoizedProps,nt=We.value,Sr(Js,Se._currentValue),Se._currentValue=nt,Xe!==null)if(ji(Xe.value,nt)){if(Xe.children===We.children&&!Fi.current){ue=oa(le,ue,me);break e}}else for(Xe=ue.child,Xe!==null&&(Xe.return=ue);Xe!==null;){var Ct=Xe.dependencies;if(Ct!==null){nt=Xe.child;for(var Gt=Ct.firstContext;Gt!==null;){if(Gt.context===Se){if(Xe.tag===1){Gt=Gr(-1,me&-me),Gt.tag=2;var Pt=Xe.updateQueue;if(Pt!==null){Pt=Pt.shared;var Cn=Pt.pending;Cn===null?Gt.next=Gt:(Gt.next=Cn.next,Cn.next=Gt),Pt.pending=Gt}}Xe.lanes|=me,Gt=Xe.alternate,Gt!==null&&(Gt.lanes|=me),nl(Xe.return,me,ue),Ct.lanes|=me;break}Gt=Gt.next}}else if(Xe.tag===10)nt=Xe.type===ue.type?null:Xe.child;else if(Xe.tag===18){if(nt=Xe.return,nt===null)throw Error(_(341));nt.lanes|=me,Ct=nt.alternate,Ct!==null&&(Ct.lanes|=me),nl(nt,me,ue),nt=Xe.sibling}else nt=Xe.child;if(nt!==null)nt.return=Xe;else for(nt=Xe;nt!==null;){if(nt===ue){nt=null;break}if(Xe=nt.sibling,Xe!==null){Xe.return=nt.return,nt=Xe;break}nt=nt.return}Xe=nt}En(le,ue,We.children,me),ue=ue.child}return ue;case 9:return We=ue.type,Se=ue.pendingProps.children,Zs(ue,me),We=$i(We),Se=Se(We),ue.flags|=1,En(le,ue,Se,me),ue.child;case 14:return Se=ue.type,We=ho(Se,ue.pendingProps),We=ho(Se.type,We),ro(le,ue,Se,We,me);case 15:return Kt(le,ue,ue.type,ue.pendingProps,me);case 17:return Se=ue.type,We=ue.pendingProps,We=ue.elementType===Se?We:ho(Se,We),Gc(le,ue),ue.tag=1,Ri(Se)?(le=!0,Us(ue)):le=!1,Zs(ue,me),pe(ue,Se,We),Ge(ue,Se,We,me),ar(null,ue,Se,!0,le,me);case 19:return Au(le,ue,me);case 22:return _t(le,ue,me)}throw Error(_(156,ue.tag))};function Yu(le,ue){return pn(le,ue)}function cd(le,ue,me,Se){this.tag=le,this.key=me,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=ue,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=Se,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Ho(le,ue,me,Se){return new cd(le,ue,me,Se)}function gu(le){return le=le.prototype,!(!le||!le.isReactComponent)}function ud(le){if(typeof le=="function")return gu(le)?1:0;if(le!=null){if(le=le.$$typeof,le===Le)return 11;if(le===rt)return 14}return 2}function Ta(le,ue){var me=le.alternate;return me===null?(me=Ho(le.tag,ue,le.key,le.mode),me.elementType=le.elementType,me.type=le.type,me.stateNode=le.stateNode,me.alternate=le,le.alternate=me):(me.pendingProps=ue,me.type=le.type,me.flags=0,me.subtreeFlags=0,me.deletions=null),me.flags=le.flags&14680064,me.childLanes=le.childLanes,me.lanes=le.lanes,me.child=le.child,me.memoizedProps=le.memoizedProps,me.memoizedState=le.memoizedState,me.updateQueue=le.updateQueue,ue=le.dependencies,me.dependencies=ue===null?null:{lanes:ue.lanes,firstContext:ue.firstContext},me.sibling=le.sibling,me.index=le.index,me.ref=le.ref,me}function Vc(le,ue,me,Se,We,Xe){var nt=2;if(Se=le,typeof le=="function")gu(le)&&(nt=1);else if(typeof le=="string")nt=5;else e:switch(le){case Ze:return Cl(me.children,We,Xe,ue);case _e:nt=8,We|=8;break;case Fe:return le=Ho(12,me,ue,We|2),le.elementType=Fe,le.lanes=Xe,le;case Ke:return le=Ho(13,me,ue,We),le.elementType=Ke,le.lanes=Xe,le;case Ue:return le=Ho(19,me,ue,We),le.elementType=Ue,le.lanes=Xe,le;case at:return Tc(me,We,Xe,ue);default:if(typeof le=="object"&&le!==null)switch(le.$$typeof){case Te:nt=10;break e;case ke:nt=9;break e;case Le:nt=11;break e;case rt:nt=14;break e;case tt:nt=16,Se=null;break e}throw Error(_(130,le==null?le:typeof le,""))}return ue=Ho(nt,me,ue,We),ue.elementType=le,ue.type=Se,ue.lanes=Xe,ue}function Cl(le,ue,me,Se){return le=Ho(7,le,Se,ue),le.lanes=me,le}function Tc(le,ue,me,Se){return le=Ho(22,le,Se,ue),le.elementType=at,le.lanes=me,le.stateNode={isHidden:!1},le}function cu(le,ue,me){return le=Ho(6,le,null,ue),le.lanes=me,le}function uu(le,ue,me){return ue=Ho(4,le.children!==null?le.children:[],le.key,ue),ue.lanes=me,ue.stateNode={containerInfo:le.containerInfo,pendingChildren:null,implementation:le.implementation},ue}function dd(le,ue,me,Se,We){this.tag=ue,this.containerInfo=le,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=br(0),this.expirationTimes=br(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=br(0),this.identifierPrefix=Se,this.onRecoverableError=We,this.mutableSourceEagerHydrationData=null}function du(le,ue,me,Se,We,Xe,nt,Ct,Gt){return le=new dd(le,ue,me,Ct,Gt),ue===1?(ue=1,Xe===!0&&(ue|=8)):ue=0,Xe=Ho(3,null,null,ue),le.current=Xe,Xe.stateNode=le,Xe.memoizedState={element:Se,isDehydrated:me,cache:null,transitions:null,pendingSuspenseBoundaries:null},gr(Xe),le}function pd(le,ue,me){var Se=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Ee,key:Se==null?null:""+Se,children:le,containerInfo:ue,implementation:me}}function Ku(le){if(!le)return $o;le=le._reactInternals;e:{if(st(le)!==le||le.tag!==1)throw Error(_(170));var ue=le;do{switch(ue.tag){case 3:ue=ue.stateNode.context;break e;case 1:if(Ri(ue.type)){ue=ue.stateNode.__reactInternalMemoizedMergedChildContext;break e}}ue=ue.return}while(ue!==null);throw Error(_(171))}if(le.tag===1){var me=le.type;if(Ri(me))return ja(le,me,ue)}return ue}function Du(le,ue,me,Se,We,Xe,nt,Ct,Gt){return le=du(me,Se,!0,le,We,Xe,nt,Ct,Gt),le.context=Ku(null),me=le.current,Se=io(),We=Wa(me),Xe=Gr(Se,We),Xe.callback=ue??null,Tr(me,Xe,We),le.current.lanes=We,ur(le,We,Se),fo(le,Se),le}function Nc(le,ue,me,Se){var We=ue.current,Xe=io(),nt=Wa(We);return me=Ku(me),ue.context===null?ue.context=me:ue.pendingContext=me,ue=Gr(Xe,nt),ue.payload={element:le},Se=Se===void 0?null:Se,Se!==null&&(ue.callback=Se),le=Tr(We,ue,nt),le!==null&&(Is(le,We,nt,Xe),wi(le,We,nt)),nt}function Lc(le){if(le=le.current,!le.child)return null;switch(le.child.tag){case 5:return le.child.stateNode;default:return le.child.stateNode}}function zu(le,ue){if(le=le.memoizedState,le!==null&&le.dehydrated!==null){var me=le.retryLane;le.retryLane=me!==0&&me<ue?me:ue}}function pu(le,ue){zu(le,ue),(le=le.alternate)&&zu(le,ue)}var Uu=typeof reportError=="function"?reportError:function(le){console.error(le)};function Iu(le){this._internalRoot=le}Hc.prototype.render=Iu.prototype.render=function(le){var ue=this._internalRoot;if(ue===null)throw Error(_(409));Nc(le,ue,null,null)},Hc.prototype.unmount=Iu.prototype.unmount=function(){var le=this._internalRoot;if(le!==null){this._internalRoot=null;var ue=le.containerInfo;pl(function(){Nc(null,le,null,null)}),ue[Qi]=null}};function Hc(le){this._internalRoot=le}Hc.prototype.unstable_scheduleHydration=function(le){if(le){var ue=Zo();le={blockedOn:null,target:le,priority:ue};for(var me=0;me<ao.length&&ue!==0&&ue<ao[me].priority;me++);ao.splice(me,0,le),me===0&&Gi(le)}};function hu(le){return!(!le||le.nodeType!==1&&le.nodeType!==9&&le.nodeType!==11)}function Xc(le){return!(!le||le.nodeType!==1&&le.nodeType!==9&&le.nodeType!==11&&(le.nodeType!==8||le.nodeValue!==" react-mount-point-unstable "))}function Pu(){}function Id(le,ue,me,Se,We){if(We){if(typeof Se=="function"){var Xe=Se;Se=function(){var Pt=Lc(nt);Xe.call(Pt)}}var nt=Du(ue,Se,le,0,null,!1,!1,"",Pu);return le._reactRootContainer=nt,le[Qi]=nt.current,ma(le.nodeType===8?le.parentNode:le),pl(),nt}for(;We=le.lastChild;)le.removeChild(We);if(typeof Se=="function"){var Ct=Se;Se=function(){var Pt=Lc(Gt);Ct.call(Pt)}}var Gt=du(le,0,!1,null,null,!1,!1,"",Pu);return le._reactRootContainer=Gt,le[Qi]=Gt.current,ma(le.nodeType===8?le.parentNode:le),pl(function(){Nc(ue,Gt,me,Se)}),Gt}function kc(le,ue,me,Se,We){var Xe=me._reactRootContainer;if(Xe){var nt=Xe;if(typeof We=="function"){var Ct=We;We=function(){var Gt=Lc(nt);Ct.call(Gt)}}Nc(ue,nt,le,We)}else nt=Id(me,ue,le,We,Se);return Lc(nt)}hs=function(le){switch(le.tag){case 3:var ue=le.stateNode;if(ue.current.memoizedState.isDehydrated){var me=Kn(ue.pendingLanes);me!==0&&(Rr(ue,me|1),fo(ue,ct()),!(fr&6)&&(sg=ct()+500,Wo()))}break;case 13:pl(function(){var Se=Go(le,1);if(Se!==null){var We=io();Is(Se,le,1,We)}}),pu(le,1)}},aa=function(le){if(le.tag===13){var ue=Go(le,134217728);if(ue!==null){var me=io();Is(ue,le,134217728,me)}pu(le,134217728)}},la=function(le){if(le.tag===13){var ue=Wa(le),me=Go(le,ue);if(me!==null){var Se=io();Is(me,le,ue,Se)}pu(le,ue)}},Zo=function(){return lr},Fs=function(le,ue){var me=lr;try{return lr=le,ue()}finally{lr=me}},wt=function(le,ue,me){switch(ue){case"input":if(Ut(le,me),ue=me.name,me.type==="radio"&&ue!=null){for(me=le;me.parentNode;)me=me.parentNode;for(me=me.querySelectorAll("input[name="+JSON.stringify(""+ue)+'][type="radio"]'),ue=0;ue<me.length;ue++){var Se=me[ue];if(Se!==le&&Se.form===le.form){var We=Kl(Se);if(!We)throw Error(_(90));mt(Se),Ut(Se,We)}}}break;case"textarea":ft(le,me);break;case"select":ue=me.value,ue!=null&&Je(le,!!me.multiple,ue,!1)}},Pn=su,Nn=pl;var hd={usingClientEntryPoint:!1,Events:[Qo,Or,Kl,an,Mn,su]},$g={findFiberByHostInstance:ws,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},Cd={bundleType:$g.bundleType,version:$g.version,rendererPackageName:$g.rendererPackageName,rendererConfig:$g.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Re.ReactCurrentDispatcher,findHostInstanceByFiber:function(le){return le=Jt(le),le===null?null:le.stateNode},findFiberByHostInstance:$g.findFiberByHostInstance,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Yc=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Yc.isDisabled&&Yc.supportsFiber)try{bn=Yc.inject(Cd),gn=Yc}catch{}}return reactDom_production_min.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=hd,reactDom_production_min.createPortal=function(le,ue){var me=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!hu(ue))throw Error(_(200));return pd(le,ue,null,me)},reactDom_production_min.createRoot=function(le,ue){if(!hu(le))throw Error(_(299));var me=!1,Se="",We=Uu;return ue!=null&&(ue.unstable_strictMode===!0&&(me=!0),ue.identifierPrefix!==void 0&&(Se=ue.identifierPrefix),ue.onRecoverableError!==void 0&&(We=ue.onRecoverableError)),ue=du(le,1,!1,null,null,me,!1,Se,We),le[Qi]=ue.current,ma(le.nodeType===8?le.parentNode:le),new Iu(ue)},reactDom_production_min.findDOMNode=function(le){if(le==null)return null;if(le.nodeType===1)return le;var ue=le._reactInternals;if(ue===void 0)throw typeof le.render=="function"?Error(_(188)):(le=Object.keys(le).join(","),Error(_(268,le)));return le=Jt(ue),le=le===null?null:le.stateNode,le},reactDom_production_min.flushSync=function(le){return pl(le)},reactDom_production_min.hydrate=function(le,ue,me){if(!Xc(ue))throw Error(_(200));return kc(null,le,ue,!0,me)},reactDom_production_min.hydrateRoot=function(le,ue,me){if(!hu(le))throw Error(_(405));var Se=me!=null&&me.hydratedSources||null,We=!1,Xe="",nt=Uu;if(me!=null&&(me.unstable_strictMode===!0&&(We=!0),me.identifierPrefix!==void 0&&(Xe=me.identifierPrefix),me.onRecoverableError!==void 0&&(nt=me.onRecoverableError)),ue=Du(ue,null,le,1,me??null,We,!1,Xe,nt),le[Qi]=ue.current,ma(le),Se)for(le=0;le<Se.length;le++)me=Se[le],We=me._getVersion,We=We(me._source),ue.mutableSourceEagerHydrationData==null?ue.mutableSourceEagerHydrationData=[me,We]:ue.mutableSourceEagerHydrationData.push(me,We);return new Hc(ue)},reactDom_production_min.render=function(le,ue,me){if(!Xc(ue))throw Error(_(200));return kc(null,le,ue,!1,me)},reactDom_production_min.unmountComponentAtNode=function(le){if(!Xc(le))throw Error(_(40));return le._reactRootContainer?(pl(function(){kc(null,null,le,!1,function(){le._reactRootContainer=null,le[Qi]=null})}),!0):!1},reactDom_production_min.unstable_batchedUpdates=su,reactDom_production_min.unstable_renderSubtreeIntoContainer=function(le,ue,me,Se){if(!Xc(me))throw Error(_(200));if(le==null||le._reactInternals===void 0)throw Error(_(38));return kc(le,ue,me,!1,Se)},reactDom_production_min.version="18.3.1-next-f1338f8080-20240426",reactDom_production_min}var hasRequiredReactDom;function requireReactDom(){if(hasRequiredReactDom)return reactDom.exports;hasRequiredReactDom=1;function X(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(X)}catch(Z){console.error(Z)}}return X(),reactDom.exports=requireReactDom_production_min(),reactDom.exports}var hasRequiredClient;function requireClient(){if(hasRequiredClient)return client;hasRequiredClient=1;var X=requireReactDom();return client.createRoot=X.createRoot,client.hydrateRoot=X.hydrateRoot,client}var clientExports=requireClient();const ReactDOM=getDefaultExportFromCjs(clientExports);/**
 * @license
 * Copyright 2010-2024 Three.js Authors
 * SPDX-License-Identifier: MIT
 */const REVISION="172",MOUSE={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},TOUCH={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},CullFaceNone=0,CullFaceBack=1,CullFaceFront=2,CullFaceFrontBack=3,BasicShadowMap=0,PCFShadowMap=1,PCFSoftShadowMap=2,VSMShadowMap=3,FrontSide=0,BackSide=1,DoubleSide=2,NoBlending=0,NormalBlending=1,AdditiveBlending=2,SubtractiveBlending=3,MultiplyBlending=4,CustomBlending=5,AddEquation=100,SubtractEquation=101,ReverseSubtractEquation=102,MinEquation=103,MaxEquation=104,ZeroFactor=200,OneFactor=201,SrcColorFactor=202,OneMinusSrcColorFactor=203,SrcAlphaFactor=204,OneMinusSrcAlphaFactor=205,DstAlphaFactor=206,OneMinusDstAlphaFactor=207,DstColorFactor=208,OneMinusDstColorFactor=209,SrcAlphaSaturateFactor=210,ConstantColorFactor=211,OneMinusConstantColorFactor=212,ConstantAlphaFactor=213,OneMinusConstantAlphaFactor=214,NeverDepth=0,AlwaysDepth=1,LessDepth=2,LessEqualDepth=3,EqualDepth=4,GreaterEqualDepth=5,GreaterDepth=6,NotEqualDepth=7,MultiplyOperation=0,MixOperation=1,AddOperation=2,NoToneMapping=0,LinearToneMapping=1,ReinhardToneMapping=2,CineonToneMapping=3,ACESFilmicToneMapping=4,CustomToneMapping=5,AgXToneMapping=6,NeutralToneMapping=7,AttachedBindMode="attached",DetachedBindMode="detached",UVMapping=300,CubeReflectionMapping=301,CubeRefractionMapping=302,EquirectangularReflectionMapping=303,EquirectangularRefractionMapping=304,CubeUVReflectionMapping=306,RepeatWrapping=1e3,ClampToEdgeWrapping=1001,MirroredRepeatWrapping=1002,NearestFilter=1003,NearestMipmapNearestFilter=1004,NearestMipMapNearestFilter=1004,NearestMipmapLinearFilter=1005,NearestMipMapLinearFilter=1005,LinearFilter=1006,LinearMipmapNearestFilter=1007,LinearMipMapNearestFilter=1007,LinearMipmapLinearFilter=1008,LinearMipMapLinearFilter=1008,UnsignedByteType=1009,ByteType=1010,ShortType=1011,UnsignedShortType=1012,IntType=1013,UnsignedIntType=1014,FloatType=1015,HalfFloatType=1016,UnsignedShort4444Type=1017,UnsignedShort5551Type=1018,UnsignedInt248Type=1020,UnsignedInt5999Type=35902,AlphaFormat=1021,RGBFormat=1022,RGBAFormat=1023,LuminanceFormat=1024,LuminanceAlphaFormat=1025,DepthFormat=1026,DepthStencilFormat=1027,RedFormat=1028,RedIntegerFormat=1029,RGFormat=1030,RGIntegerFormat=1031,RGBIntegerFormat=1032,RGBAIntegerFormat=1033,RGB_S3TC_DXT1_Format=33776,RGBA_S3TC_DXT1_Format=33777,RGBA_S3TC_DXT3_Format=33778,RGBA_S3TC_DXT5_Format=33779,RGB_PVRTC_4BPPV1_Format=35840,RGB_PVRTC_2BPPV1_Format=35841,RGBA_PVRTC_4BPPV1_Format=35842,RGBA_PVRTC_2BPPV1_Format=35843,RGB_ETC1_Format=36196,RGB_ETC2_Format=37492,RGBA_ETC2_EAC_Format=37496,RGBA_ASTC_4x4_Format=37808,RGBA_ASTC_5x4_Format=37809,RGBA_ASTC_5x5_Format=37810,RGBA_ASTC_6x5_Format=37811,RGBA_ASTC_6x6_Format=37812,RGBA_ASTC_8x5_Format=37813,RGBA_ASTC_8x6_Format=37814,RGBA_ASTC_8x8_Format=37815,RGBA_ASTC_10x5_Format=37816,RGBA_ASTC_10x6_Format=37817,RGBA_ASTC_10x8_Format=37818,RGBA_ASTC_10x10_Format=37819,RGBA_ASTC_12x10_Format=37820,RGBA_ASTC_12x12_Format=37821,RGBA_BPTC_Format=36492,RGB_BPTC_SIGNED_Format=36494,RGB_BPTC_UNSIGNED_Format=36495,RED_RGTC1_Format=36283,SIGNED_RED_RGTC1_Format=36284,RED_GREEN_RGTC2_Format=36285,SIGNED_RED_GREEN_RGTC2_Format=36286,LoopOnce=2200,LoopRepeat=2201,LoopPingPong=2202,InterpolateDiscrete=2300,InterpolateLinear=2301,InterpolateSmooth=2302,ZeroCurvatureEnding=2400,ZeroSlopeEnding=2401,WrapAroundEnding=2402,NormalAnimationBlendMode=2500,AdditiveAnimationBlendMode=2501,TrianglesDrawMode=0,TriangleStripDrawMode=1,TriangleFanDrawMode=2,BasicDepthPacking=3200,RGBADepthPacking=3201,RGBDepthPacking=3202,RGDepthPacking=3203,TangentSpaceNormalMap=0,ObjectSpaceNormalMap=1,NoColorSpace="",SRGBColorSpace$1="srgb",LinearSRGBColorSpace$1="srgb-linear",LinearTransfer="linear",SRGBTransfer="srgb",ZeroStencilOp=0,KeepStencilOp=7680,ReplaceStencilOp=7681,IncrementStencilOp=7682,DecrementStencilOp=7683,IncrementWrapStencilOp=34055,DecrementWrapStencilOp=34056,InvertStencilOp=5386,NeverStencilFunc=512,LessStencilFunc=513,EqualStencilFunc=514,LessEqualStencilFunc=515,GreaterStencilFunc=516,NotEqualStencilFunc=517,GreaterEqualStencilFunc=518,AlwaysStencilFunc=519,NeverCompare=512,LessCompare=513,EqualCompare=514,LessEqualCompare=515,GreaterCompare=516,NotEqualCompare=517,GreaterEqualCompare=518,AlwaysCompare=519,StaticDrawUsage=35044,DynamicDrawUsage=35048,StreamDrawUsage=35040,StaticReadUsage=35045,DynamicReadUsage=35049,StreamReadUsage=35041,StaticCopyUsage=35046,DynamicCopyUsage=35050,StreamCopyUsage=35042,GLSL1="100",GLSL3="300 es",WebGLCoordinateSystem=2e3,WebGPUCoordinateSystem=2001;class EventDispatcher{addEventListener(Z,_){this._listeners===void 0&&(this._listeners={});const K=this._listeners;K[Z]===void 0&&(K[Z]=[]),K[Z].indexOf(_)===-1&&K[Z].push(_)}hasEventListener(Z,_){if(this._listeners===void 0)return!1;const K=this._listeners;return K[Z]!==void 0&&K[Z].indexOf(_)!==-1}removeEventListener(Z,_){if(this._listeners===void 0)return;const te=this._listeners[Z];if(te!==void 0){const ne=te.indexOf(_);ne!==-1&&te.splice(ne,1)}}dispatchEvent(Z){if(this._listeners===void 0)return;const K=this._listeners[Z.type];if(K!==void 0){Z.target=this;const te=K.slice(0);for(let ne=0,ie=te.length;ne<ie;ne++)te[ne].call(this,Z);Z.target=null}}}const _lut$1=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let _seed=1234567;const DEG2RAD=Math.PI/180,RAD2DEG=180/Math.PI;function generateUUID$1(){const X=Math.random()*4294967295|0,Z=Math.random()*4294967295|0,_=Math.random()*4294967295|0,K=Math.random()*4294967295|0;return(_lut$1[X&255]+_lut$1[X>>8&255]+_lut$1[X>>16&255]+_lut$1[X>>24&255]+"-"+_lut$1[Z&255]+_lut$1[Z>>8&255]+"-"+_lut$1[Z>>16&15|64]+_lut$1[Z>>24&255]+"-"+_lut$1[_&63|128]+_lut$1[_>>8&255]+"-"+_lut$1[_>>16&255]+_lut$1[_>>24&255]+_lut$1[K&255]+_lut$1[K>>8&255]+_lut$1[K>>16&255]+_lut$1[K>>24&255]).toLowerCase()}function clamp$3(X,Z,_){return Math.max(Z,Math.min(_,X))}function euclideanModulo(X,Z){return(X%Z+Z)%Z}function mapLinear(X,Z,_,K,te){return K+(X-Z)*(te-K)/(_-Z)}function inverseLerp(X,Z,_){return X!==Z?(_-X)/(Z-X):0}function lerp(X,Z,_){return(1-_)*X+_*Z}function damp(X,Z,_,K){return lerp(X,Z,1-Math.exp(-_*K))}function pingpong(X,Z=1){return Z-Math.abs(euclideanModulo(X,Z*2)-Z)}function smoothstep(X,Z,_){return X<=Z?0:X>=_?1:(X=(X-Z)/(_-Z),X*X*(3-2*X))}function smootherstep(X,Z,_){return X<=Z?0:X>=_?1:(X=(X-Z)/(_-Z),X*X*X*(X*(X*6-15)+10))}function randInt(X,Z){return X+Math.floor(Math.random()*(Z-X+1))}function randFloat(X,Z){return X+Math.random()*(Z-X)}function randFloatSpread(X){return X*(.5-Math.random())}function seededRandom(X){X!==void 0&&(_seed=X);let Z=_seed+=1831565813;return Z=Math.imul(Z^Z>>>15,Z|1),Z^=Z+Math.imul(Z^Z>>>7,Z|61),((Z^Z>>>14)>>>0)/4294967296}function degToRad(X){return X*DEG2RAD}function radToDeg(X){return X*RAD2DEG}function isPowerOfTwo(X){return(X&X-1)===0&&X!==0}function ceilPowerOfTwo(X){return Math.pow(2,Math.ceil(Math.log(X)/Math.LN2))}function floorPowerOfTwo(X){return Math.pow(2,Math.floor(Math.log(X)/Math.LN2))}function setQuaternionFromProperEuler(X,Z,_,K,te){const ne=Math.cos,ie=Math.sin,oe=ne(_/2),se=ie(_/2),ae=ne((Z+K)/2),ge=ie((Z+K)/2),ce=ne((Z-K)/2),de=ie((Z-K)/2),Ie=ne((K-Z)/2),fe=ie((K-Z)/2);switch(te){case"XYX":X.set(oe*ge,se*ce,se*de,oe*ae);break;case"YZY":X.set(se*de,oe*ge,se*ce,oe*ae);break;case"ZXZ":X.set(se*ce,se*de,oe*ge,oe*ae);break;case"XZX":X.set(oe*ge,se*fe,se*Ie,oe*ae);break;case"YXY":X.set(se*Ie,oe*ge,se*fe,oe*ae);break;case"ZYZ":X.set(se*fe,se*Ie,oe*ge,oe*ae);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+te)}}function denormalize(X,Z){switch(Z.constructor){case Float32Array:return X;case Uint32Array:return X/4294967295;case Uint16Array:return X/65535;case Uint8Array:return X/255;case Int32Array:return Math.max(X/2147483647,-1);case Int16Array:return Math.max(X/32767,-1);case Int8Array:return Math.max(X/127,-1);default:throw new Error("Invalid component type.")}}function normalize$5(X,Z){switch(Z.constructor){case Float32Array:return X;case Uint32Array:return Math.round(X*4294967295);case Uint16Array:return Math.round(X*65535);case Uint8Array:return Math.round(X*255);case Int32Array:return Math.round(X*2147483647);case Int16Array:return Math.round(X*32767);case Int8Array:return Math.round(X*127);default:throw new Error("Invalid component type.")}}const MathUtils={DEG2RAD,RAD2DEG,generateUUID:generateUUID$1,clamp:clamp$3,euclideanModulo,mapLinear,inverseLerp,lerp,damp,pingpong,smoothstep,smootherstep,randInt,randFloat,randFloatSpread,seededRandom,degToRad,radToDeg,isPowerOfTwo,ceilPowerOfTwo,floorPowerOfTwo,setQuaternionFromProperEuler,normalize:normalize$5,denormalize};class Vector2{constructor(Z=0,_=0){Vector2.prototype.isVector2=!0,this.x=Z,this.y=_}get width(){return this.x}set width(Z){this.x=Z}get height(){return this.y}set height(Z){this.y=Z}set(Z,_){return this.x=Z,this.y=_,this}setScalar(Z){return this.x=Z,this.y=Z,this}setX(Z){return this.x=Z,this}setY(Z){return this.y=Z,this}setComponent(Z,_){switch(Z){case 0:this.x=_;break;case 1:this.y=_;break;default:throw new Error("index is out of range: "+Z)}return this}getComponent(Z){switch(Z){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+Z)}}clone(){return new this.constructor(this.x,this.y)}copy(Z){return this.x=Z.x,this.y=Z.y,this}add(Z){return this.x+=Z.x,this.y+=Z.y,this}addScalar(Z){return this.x+=Z,this.y+=Z,this}addVectors(Z,_){return this.x=Z.x+_.x,this.y=Z.y+_.y,this}addScaledVector(Z,_){return this.x+=Z.x*_,this.y+=Z.y*_,this}sub(Z){return this.x-=Z.x,this.y-=Z.y,this}subScalar(Z){return this.x-=Z,this.y-=Z,this}subVectors(Z,_){return this.x=Z.x-_.x,this.y=Z.y-_.y,this}multiply(Z){return this.x*=Z.x,this.y*=Z.y,this}multiplyScalar(Z){return this.x*=Z,this.y*=Z,this}divide(Z){return this.x/=Z.x,this.y/=Z.y,this}divideScalar(Z){return this.multiplyScalar(1/Z)}applyMatrix3(Z){const _=this.x,K=this.y,te=Z.elements;return this.x=te[0]*_+te[3]*K+te[6],this.y=te[1]*_+te[4]*K+te[7],this}min(Z){return this.x=Math.min(this.x,Z.x),this.y=Math.min(this.y,Z.y),this}max(Z){return this.x=Math.max(this.x,Z.x),this.y=Math.max(this.y,Z.y),this}clamp(Z,_){return this.x=clamp$3(this.x,Z.x,_.x),this.y=clamp$3(this.y,Z.y,_.y),this}clampScalar(Z,_){return this.x=clamp$3(this.x,Z,_),this.y=clamp$3(this.y,Z,_),this}clampLength(Z,_){const K=this.length();return this.divideScalar(K||1).multiplyScalar(clamp$3(K,Z,_))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(Z){return this.x*Z.x+this.y*Z.y}cross(Z){return this.x*Z.y-this.y*Z.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(Z){const _=Math.sqrt(this.lengthSq()*Z.lengthSq());if(_===0)return Math.PI/2;const K=this.dot(Z)/_;return Math.acos(clamp$3(K,-1,1))}distanceTo(Z){return Math.sqrt(this.distanceToSquared(Z))}distanceToSquared(Z){const _=this.x-Z.x,K=this.y-Z.y;return _*_+K*K}manhattanDistanceTo(Z){return Math.abs(this.x-Z.x)+Math.abs(this.y-Z.y)}setLength(Z){return this.normalize().multiplyScalar(Z)}lerp(Z,_){return this.x+=(Z.x-this.x)*_,this.y+=(Z.y-this.y)*_,this}lerpVectors(Z,_,K){return this.x=Z.x+(_.x-Z.x)*K,this.y=Z.y+(_.y-Z.y)*K,this}equals(Z){return Z.x===this.x&&Z.y===this.y}fromArray(Z,_=0){return this.x=Z[_],this.y=Z[_+1],this}toArray(Z=[],_=0){return Z[_]=this.x,Z[_+1]=this.y,Z}fromBufferAttribute(Z,_){return this.x=Z.getX(_),this.y=Z.getY(_),this}rotateAround(Z,_){const K=Math.cos(_),te=Math.sin(_),ne=this.x-Z.x,ie=this.y-Z.y;return this.x=ne*K-ie*te+Z.x,this.y=ne*te+ie*K+Z.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class Matrix3{constructor(Z,_,K,te,ne,ie,oe,se,ae){Matrix3.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],Z!==void 0&&this.set(Z,_,K,te,ne,ie,oe,se,ae)}set(Z,_,K,te,ne,ie,oe,se,ae){const ge=this.elements;return ge[0]=Z,ge[1]=te,ge[2]=oe,ge[3]=_,ge[4]=ne,ge[5]=se,ge[6]=K,ge[7]=ie,ge[8]=ae,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(Z){const _=this.elements,K=Z.elements;return _[0]=K[0],_[1]=K[1],_[2]=K[2],_[3]=K[3],_[4]=K[4],_[5]=K[5],_[6]=K[6],_[7]=K[7],_[8]=K[8],this}extractBasis(Z,_,K){return Z.setFromMatrix3Column(this,0),_.setFromMatrix3Column(this,1),K.setFromMatrix3Column(this,2),this}setFromMatrix4(Z){const _=Z.elements;return this.set(_[0],_[4],_[8],_[1],_[5],_[9],_[2],_[6],_[10]),this}multiply(Z){return this.multiplyMatrices(this,Z)}premultiply(Z){return this.multiplyMatrices(Z,this)}multiplyMatrices(Z,_){const K=Z.elements,te=_.elements,ne=this.elements,ie=K[0],oe=K[3],se=K[6],ae=K[1],ge=K[4],ce=K[7],de=K[2],Ie=K[5],fe=K[8],be=te[0],Ae=te[3],ye=te[6],ve=te[1],Be=te[4],Re=te[7],Ve=te[2],Ee=te[5],Ze=te[8];return ne[0]=ie*be+oe*ve+se*Ve,ne[3]=ie*Ae+oe*Be+se*Ee,ne[6]=ie*ye+oe*Re+se*Ze,ne[1]=ae*be+ge*ve+ce*Ve,ne[4]=ae*Ae+ge*Be+ce*Ee,ne[7]=ae*ye+ge*Re+ce*Ze,ne[2]=de*be+Ie*ve+fe*Ve,ne[5]=de*Ae+Ie*Be+fe*Ee,ne[8]=de*ye+Ie*Re+fe*Ze,this}multiplyScalar(Z){const _=this.elements;return _[0]*=Z,_[3]*=Z,_[6]*=Z,_[1]*=Z,_[4]*=Z,_[7]*=Z,_[2]*=Z,_[5]*=Z,_[8]*=Z,this}determinant(){const Z=this.elements,_=Z[0],K=Z[1],te=Z[2],ne=Z[3],ie=Z[4],oe=Z[5],se=Z[6],ae=Z[7],ge=Z[8];return _*ie*ge-_*oe*ae-K*ne*ge+K*oe*se+te*ne*ae-te*ie*se}invert(){const Z=this.elements,_=Z[0],K=Z[1],te=Z[2],ne=Z[3],ie=Z[4],oe=Z[5],se=Z[6],ae=Z[7],ge=Z[8],ce=ge*ie-oe*ae,de=oe*se-ge*ne,Ie=ae*ne-ie*se,fe=_*ce+K*de+te*Ie;if(fe===0)return this.set(0,0,0,0,0,0,0,0,0);const be=1/fe;return Z[0]=ce*be,Z[1]=(te*ae-ge*K)*be,Z[2]=(oe*K-te*ie)*be,Z[3]=de*be,Z[4]=(ge*_-te*se)*be,Z[5]=(te*ne-oe*_)*be,Z[6]=Ie*be,Z[7]=(K*se-ae*_)*be,Z[8]=(ie*_-K*ne)*be,this}transpose(){let Z;const _=this.elements;return Z=_[1],_[1]=_[3],_[3]=Z,Z=_[2],_[2]=_[6],_[6]=Z,Z=_[5],_[5]=_[7],_[7]=Z,this}getNormalMatrix(Z){return this.setFromMatrix4(Z).invert().transpose()}transposeIntoArray(Z){const _=this.elements;return Z[0]=_[0],Z[1]=_[3],Z[2]=_[6],Z[3]=_[1],Z[4]=_[4],Z[5]=_[7],Z[6]=_[2],Z[7]=_[5],Z[8]=_[8],this}setUvTransform(Z,_,K,te,ne,ie,oe){const se=Math.cos(ne),ae=Math.sin(ne);return this.set(K*se,K*ae,-K*(se*ie+ae*oe)+ie+Z,-te*ae,te*se,-te*(-ae*ie+se*oe)+oe+_,0,0,1),this}scale(Z,_){return this.premultiply(_m3.makeScale(Z,_)),this}rotate(Z){return this.premultiply(_m3.makeRotation(-Z)),this}translate(Z,_){return this.premultiply(_m3.makeTranslation(Z,_)),this}makeTranslation(Z,_){return Z.isVector2?this.set(1,0,Z.x,0,1,Z.y,0,0,1):this.set(1,0,Z,0,1,_,0,0,1),this}makeRotation(Z){const _=Math.cos(Z),K=Math.sin(Z);return this.set(_,-K,0,K,_,0,0,0,1),this}makeScale(Z,_){return this.set(Z,0,0,0,_,0,0,0,1),this}equals(Z){const _=this.elements,K=Z.elements;for(let te=0;te<9;te++)if(_[te]!==K[te])return!1;return!0}fromArray(Z,_=0){for(let K=0;K<9;K++)this.elements[K]=Z[K+_];return this}toArray(Z=[],_=0){const K=this.elements;return Z[_]=K[0],Z[_+1]=K[1],Z[_+2]=K[2],Z[_+3]=K[3],Z[_+4]=K[4],Z[_+5]=K[5],Z[_+6]=K[6],Z[_+7]=K[7],Z[_+8]=K[8],Z}clone(){return new this.constructor().fromArray(this.elements)}}const _m3=new Matrix3;function arrayNeedsUint32(X){for(let Z=X.length-1;Z>=0;--Z)if(X[Z]>=65535)return!0;return!1}const TYPED_ARRAYS={Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array};function getTypedArray(X,Z){return new TYPED_ARRAYS[X](Z)}function createElementNS(X){return document.createElementNS("http://www.w3.org/1999/xhtml",X)}function createCanvasElement(){const X=createElementNS("canvas");return X.style.display="block",X}const _cache={};function warnOnce(X){X in _cache||(_cache[X]=!0,console.warn(X))}function probeAsync(X,Z,_){return new Promise(function(K,te){function ne(){switch(X.clientWaitSync(Z,X.SYNC_FLUSH_COMMANDS_BIT,0)){case X.WAIT_FAILED:te();break;case X.TIMEOUT_EXPIRED:setTimeout(ne,_);break;default:K()}}setTimeout(ne,_)})}function toNormalizedProjectionMatrix(X){const Z=X.elements;Z[2]=.5*Z[2]+.5*Z[3],Z[6]=.5*Z[6]+.5*Z[7],Z[10]=.5*Z[10]+.5*Z[11],Z[14]=.5*Z[14]+.5*Z[15]}function toReversedProjectionMatrix(X){const Z=X.elements;Z[11]===-1?(Z[10]=-Z[10]-1,Z[14]=-Z[14]):(Z[10]=-Z[10],Z[14]=-Z[14]+1)}const LINEAR_REC709_TO_XYZ=new Matrix3().set(.4123908,.3575843,.1804808,.212639,.7151687,.0721923,.0193308,.1191948,.9505322),XYZ_TO_LINEAR_REC709=new Matrix3().set(3.2409699,-1.5373832,-.4986108,-.9692436,1.8759675,.0415551,.0556301,-.203977,1.0569715);function createColorManagement(){const X={enabled:!0,workingColorSpace:LinearSRGBColorSpace$1,spaces:{},convert:function(te,ne,ie){return this.enabled===!1||ne===ie||!ne||!ie||(this.spaces[ne].transfer===SRGBTransfer&&(te.r=SRGBToLinear(te.r),te.g=SRGBToLinear(te.g),te.b=SRGBToLinear(te.b)),this.spaces[ne].primaries!==this.spaces[ie].primaries&&(te.applyMatrix3(this.spaces[ne].toXYZ),te.applyMatrix3(this.spaces[ie].fromXYZ)),this.spaces[ie].transfer===SRGBTransfer&&(te.r=LinearToSRGB(te.r),te.g=LinearToSRGB(te.g),te.b=LinearToSRGB(te.b))),te},fromWorkingColorSpace:function(te,ne){return this.convert(te,this.workingColorSpace,ne)},toWorkingColorSpace:function(te,ne){return this.convert(te,ne,this.workingColorSpace)},getPrimaries:function(te){return this.spaces[te].primaries},getTransfer:function(te){return te===NoColorSpace?LinearTransfer:this.spaces[te].transfer},getLuminanceCoefficients:function(te,ne=this.workingColorSpace){return te.fromArray(this.spaces[ne].luminanceCoefficients)},define:function(te){Object.assign(this.spaces,te)},_getMatrix:function(te,ne,ie){return te.copy(this.spaces[ne].toXYZ).multiply(this.spaces[ie].fromXYZ)},_getDrawingBufferColorSpace:function(te){return this.spaces[te].outputColorSpaceConfig.drawingBufferColorSpace},_getUnpackColorSpace:function(te=this.workingColorSpace){return this.spaces[te].workingColorSpaceConfig.unpackColorSpace}},Z=[.64,.33,.3,.6,.15,.06],_=[.2126,.7152,.0722],K=[.3127,.329];return X.define({[LinearSRGBColorSpace$1]:{primaries:Z,whitePoint:K,transfer:LinearTransfer,toXYZ:LINEAR_REC709_TO_XYZ,fromXYZ:XYZ_TO_LINEAR_REC709,luminanceCoefficients:_,workingColorSpaceConfig:{unpackColorSpace:SRGBColorSpace$1},outputColorSpaceConfig:{drawingBufferColorSpace:SRGBColorSpace$1}},[SRGBColorSpace$1]:{primaries:Z,whitePoint:K,transfer:SRGBTransfer,toXYZ:LINEAR_REC709_TO_XYZ,fromXYZ:XYZ_TO_LINEAR_REC709,luminanceCoefficients:_,outputColorSpaceConfig:{drawingBufferColorSpace:SRGBColorSpace$1}}}),X}const ColorManagement=createColorManagement();function SRGBToLinear(X){return X<.04045?X*.0773993808:Math.pow(X*.9478672986+.0521327014,2.4)}function LinearToSRGB(X){return X<.0031308?X*12.92:1.055*Math.pow(X,.41666)-.055}let _canvas;class ImageUtils{static getDataURL(Z){if(/^data:/i.test(Z.src)||typeof HTMLCanvasElement>"u")return Z.src;let _;if(Z instanceof HTMLCanvasElement)_=Z;else{_canvas===void 0&&(_canvas=createElementNS("canvas")),_canvas.width=Z.width,_canvas.height=Z.height;const K=_canvas.getContext("2d");Z instanceof ImageData?K.putImageData(Z,0,0):K.drawImage(Z,0,0,Z.width,Z.height),_=_canvas}return _.width>2048||_.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",Z),_.toDataURL("image/jpeg",.6)):_.toDataURL("image/png")}static sRGBToLinear(Z){if(typeof HTMLImageElement<"u"&&Z instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&Z instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&Z instanceof ImageBitmap){const _=createElementNS("canvas");_.width=Z.width,_.height=Z.height;const K=_.getContext("2d");K.drawImage(Z,0,0,Z.width,Z.height);const te=K.getImageData(0,0,Z.width,Z.height),ne=te.data;for(let ie=0;ie<ne.length;ie++)ne[ie]=SRGBToLinear(ne[ie]/255)*255;return K.putImageData(te,0,0),_}else if(Z.data){const _=Z.data.slice(0);for(let K=0;K<_.length;K++)_ instanceof Uint8Array||_ instanceof Uint8ClampedArray?_[K]=Math.floor(SRGBToLinear(_[K]/255)*255):_[K]=SRGBToLinear(_[K]);return{data:_,width:Z.width,height:Z.height}}else return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),Z}}let _sourceId=0;class Source{constructor(Z=null){this.isSource=!0,Object.defineProperty(this,"id",{value:_sourceId++}),this.uuid=generateUUID$1(),this.data=Z,this.dataReady=!0,this.version=0}set needsUpdate(Z){Z===!0&&this.version++}toJSON(Z){const _=Z===void 0||typeof Z=="string";if(!_&&Z.images[this.uuid]!==void 0)return Z.images[this.uuid];const K={uuid:this.uuid,url:""},te=this.data;if(te!==null){let ne;if(Array.isArray(te)){ne=[];for(let ie=0,oe=te.length;ie<oe;ie++)te[ie].isDataTexture?ne.push(serializeImage(te[ie].image)):ne.push(serializeImage(te[ie]))}else ne=serializeImage(te);K.url=ne}return _||(Z.images[this.uuid]=K),K}}function serializeImage(X){return typeof HTMLImageElement<"u"&&X instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&X instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&X instanceof ImageBitmap?ImageUtils.getDataURL(X):X.data?{data:Array.from(X.data),width:X.width,height:X.height,type:X.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let _textureId=0;class Texture extends EventDispatcher{constructor(Z=Texture.DEFAULT_IMAGE,_=Texture.DEFAULT_MAPPING,K=ClampToEdgeWrapping,te=ClampToEdgeWrapping,ne=LinearFilter,ie=LinearMipmapLinearFilter,oe=RGBAFormat,se=UnsignedByteType,ae=Texture.DEFAULT_ANISOTROPY,ge=NoColorSpace){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:_textureId++}),this.uuid=generateUUID$1(),this.name="",this.source=new Source(Z),this.mipmaps=[],this.mapping=_,this.channel=0,this.wrapS=K,this.wrapT=te,this.magFilter=ne,this.minFilter=ie,this.anisotropy=ae,this.format=oe,this.internalFormat=null,this.type=se,this.offset=new Vector2(0,0),this.repeat=new Vector2(1,1),this.center=new Vector2(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Matrix3,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.colorSpace=ge,this.userData={},this.version=0,this.onUpdate=null,this.renderTarget=null,this.isRenderTargetTexture=!1,this.pmremVersion=0}get image(){return this.source.data}set image(Z=null){this.source.data=Z}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(Z){return this.name=Z.name,this.source=Z.source,this.mipmaps=Z.mipmaps.slice(0),this.mapping=Z.mapping,this.channel=Z.channel,this.wrapS=Z.wrapS,this.wrapT=Z.wrapT,this.magFilter=Z.magFilter,this.minFilter=Z.minFilter,this.anisotropy=Z.anisotropy,this.format=Z.format,this.internalFormat=Z.internalFormat,this.type=Z.type,this.offset.copy(Z.offset),this.repeat.copy(Z.repeat),this.center.copy(Z.center),this.rotation=Z.rotation,this.matrixAutoUpdate=Z.matrixAutoUpdate,this.matrix.copy(Z.matrix),this.generateMipmaps=Z.generateMipmaps,this.premultiplyAlpha=Z.premultiplyAlpha,this.flipY=Z.flipY,this.unpackAlignment=Z.unpackAlignment,this.colorSpace=Z.colorSpace,this.renderTarget=Z.renderTarget,this.isRenderTargetTexture=Z.isRenderTargetTexture,this.userData=JSON.parse(JSON.stringify(Z.userData)),this.needsUpdate=!0,this}toJSON(Z){const _=Z===void 0||typeof Z=="string";if(!_&&Z.textures[this.uuid]!==void 0)return Z.textures[this.uuid];const K={metadata:{version:4.6,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(Z).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(K.userData=this.userData),_||(Z.textures[this.uuid]=K),K}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(Z){if(this.mapping!==UVMapping)return Z;if(Z.applyMatrix3(this.matrix),Z.x<0||Z.x>1)switch(this.wrapS){case RepeatWrapping:Z.x=Z.x-Math.floor(Z.x);break;case ClampToEdgeWrapping:Z.x=Z.x<0?0:1;break;case MirroredRepeatWrapping:Math.abs(Math.floor(Z.x)%2)===1?Z.x=Math.ceil(Z.x)-Z.x:Z.x=Z.x-Math.floor(Z.x);break}if(Z.y<0||Z.y>1)switch(this.wrapT){case RepeatWrapping:Z.y=Z.y-Math.floor(Z.y);break;case ClampToEdgeWrapping:Z.y=Z.y<0?0:1;break;case MirroredRepeatWrapping:Math.abs(Math.floor(Z.y)%2)===1?Z.y=Math.ceil(Z.y)-Z.y:Z.y=Z.y-Math.floor(Z.y);break}return this.flipY&&(Z.y=1-Z.y),Z}set needsUpdate(Z){Z===!0&&(this.version++,this.source.needsUpdate=!0)}set needsPMREMUpdate(Z){Z===!0&&this.pmremVersion++}}Texture.DEFAULT_IMAGE=null;Texture.DEFAULT_MAPPING=UVMapping;Texture.DEFAULT_ANISOTROPY=1;class Vector4{constructor(Z=0,_=0,K=0,te=1){Vector4.prototype.isVector4=!0,this.x=Z,this.y=_,this.z=K,this.w=te}get width(){return this.z}set width(Z){this.z=Z}get height(){return this.w}set height(Z){this.w=Z}set(Z,_,K,te){return this.x=Z,this.y=_,this.z=K,this.w=te,this}setScalar(Z){return this.x=Z,this.y=Z,this.z=Z,this.w=Z,this}setX(Z){return this.x=Z,this}setY(Z){return this.y=Z,this}setZ(Z){return this.z=Z,this}setW(Z){return this.w=Z,this}setComponent(Z,_){switch(Z){case 0:this.x=_;break;case 1:this.y=_;break;case 2:this.z=_;break;case 3:this.w=_;break;default:throw new Error("index is out of range: "+Z)}return this}getComponent(Z){switch(Z){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+Z)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(Z){return this.x=Z.x,this.y=Z.y,this.z=Z.z,this.w=Z.w!==void 0?Z.w:1,this}add(Z){return this.x+=Z.x,this.y+=Z.y,this.z+=Z.z,this.w+=Z.w,this}addScalar(Z){return this.x+=Z,this.y+=Z,this.z+=Z,this.w+=Z,this}addVectors(Z,_){return this.x=Z.x+_.x,this.y=Z.y+_.y,this.z=Z.z+_.z,this.w=Z.w+_.w,this}addScaledVector(Z,_){return this.x+=Z.x*_,this.y+=Z.y*_,this.z+=Z.z*_,this.w+=Z.w*_,this}sub(Z){return this.x-=Z.x,this.y-=Z.y,this.z-=Z.z,this.w-=Z.w,this}subScalar(Z){return this.x-=Z,this.y-=Z,this.z-=Z,this.w-=Z,this}subVectors(Z,_){return this.x=Z.x-_.x,this.y=Z.y-_.y,this.z=Z.z-_.z,this.w=Z.w-_.w,this}multiply(Z){return this.x*=Z.x,this.y*=Z.y,this.z*=Z.z,this.w*=Z.w,this}multiplyScalar(Z){return this.x*=Z,this.y*=Z,this.z*=Z,this.w*=Z,this}applyMatrix4(Z){const _=this.x,K=this.y,te=this.z,ne=this.w,ie=Z.elements;return this.x=ie[0]*_+ie[4]*K+ie[8]*te+ie[12]*ne,this.y=ie[1]*_+ie[5]*K+ie[9]*te+ie[13]*ne,this.z=ie[2]*_+ie[6]*K+ie[10]*te+ie[14]*ne,this.w=ie[3]*_+ie[7]*K+ie[11]*te+ie[15]*ne,this}divide(Z){return this.x/=Z.x,this.y/=Z.y,this.z/=Z.z,this.w/=Z.w,this}divideScalar(Z){return this.multiplyScalar(1/Z)}setAxisAngleFromQuaternion(Z){this.w=2*Math.acos(Z.w);const _=Math.sqrt(1-Z.w*Z.w);return _<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=Z.x/_,this.y=Z.y/_,this.z=Z.z/_),this}setAxisAngleFromRotationMatrix(Z){let _,K,te,ne;const se=Z.elements,ae=se[0],ge=se[4],ce=se[8],de=se[1],Ie=se[5],fe=se[9],be=se[2],Ae=se[6],ye=se[10];if(Math.abs(ge-de)<.01&&Math.abs(ce-be)<.01&&Math.abs(fe-Ae)<.01){if(Math.abs(ge+de)<.1&&Math.abs(ce+be)<.1&&Math.abs(fe+Ae)<.1&&Math.abs(ae+Ie+ye-3)<.1)return this.set(1,0,0,0),this;_=Math.PI;const Be=(ae+1)/2,Re=(Ie+1)/2,Ve=(ye+1)/2,Ee=(ge+de)/4,Ze=(ce+be)/4,_e=(fe+Ae)/4;return Be>Re&&Be>Ve?Be<.01?(K=0,te=.707106781,ne=.707106781):(K=Math.sqrt(Be),te=Ee/K,ne=Ze/K):Re>Ve?Re<.01?(K=.707106781,te=0,ne=.707106781):(te=Math.sqrt(Re),K=Ee/te,ne=_e/te):Ve<.01?(K=.707106781,te=.707106781,ne=0):(ne=Math.sqrt(Ve),K=Ze/ne,te=_e/ne),this.set(K,te,ne,_),this}let ve=Math.sqrt((Ae-fe)*(Ae-fe)+(ce-be)*(ce-be)+(de-ge)*(de-ge));return Math.abs(ve)<.001&&(ve=1),this.x=(Ae-fe)/ve,this.y=(ce-be)/ve,this.z=(de-ge)/ve,this.w=Math.acos((ae+Ie+ye-1)/2),this}setFromMatrixPosition(Z){const _=Z.elements;return this.x=_[12],this.y=_[13],this.z=_[14],this.w=_[15],this}min(Z){return this.x=Math.min(this.x,Z.x),this.y=Math.min(this.y,Z.y),this.z=Math.min(this.z,Z.z),this.w=Math.min(this.w,Z.w),this}max(Z){return this.x=Math.max(this.x,Z.x),this.y=Math.max(this.y,Z.y),this.z=Math.max(this.z,Z.z),this.w=Math.max(this.w,Z.w),this}clamp(Z,_){return this.x=clamp$3(this.x,Z.x,_.x),this.y=clamp$3(this.y,Z.y,_.y),this.z=clamp$3(this.z,Z.z,_.z),this.w=clamp$3(this.w,Z.w,_.w),this}clampScalar(Z,_){return this.x=clamp$3(this.x,Z,_),this.y=clamp$3(this.y,Z,_),this.z=clamp$3(this.z,Z,_),this.w=clamp$3(this.w,Z,_),this}clampLength(Z,_){const K=this.length();return this.divideScalar(K||1).multiplyScalar(clamp$3(K,Z,_))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this.w=Math.trunc(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(Z){return this.x*Z.x+this.y*Z.y+this.z*Z.z+this.w*Z.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(Z){return this.normalize().multiplyScalar(Z)}lerp(Z,_){return this.x+=(Z.x-this.x)*_,this.y+=(Z.y-this.y)*_,this.z+=(Z.z-this.z)*_,this.w+=(Z.w-this.w)*_,this}lerpVectors(Z,_,K){return this.x=Z.x+(_.x-Z.x)*K,this.y=Z.y+(_.y-Z.y)*K,this.z=Z.z+(_.z-Z.z)*K,this.w=Z.w+(_.w-Z.w)*K,this}equals(Z){return Z.x===this.x&&Z.y===this.y&&Z.z===this.z&&Z.w===this.w}fromArray(Z,_=0){return this.x=Z[_],this.y=Z[_+1],this.z=Z[_+2],this.w=Z[_+3],this}toArray(Z=[],_=0){return Z[_]=this.x,Z[_+1]=this.y,Z[_+2]=this.z,Z[_+3]=this.w,Z}fromBufferAttribute(Z,_){return this.x=Z.getX(_),this.y=Z.getY(_),this.z=Z.getZ(_),this.w=Z.getW(_),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class RenderTarget extends EventDispatcher{constructor(Z=1,_=1,K={}){super(),this.isRenderTarget=!0,this.width=Z,this.height=_,this.depth=1,this.scissor=new Vector4(0,0,Z,_),this.scissorTest=!1,this.viewport=new Vector4(0,0,Z,_);const te={width:Z,height:_,depth:1};K=Object.assign({generateMipmaps:!1,internalFormat:null,minFilter:LinearFilter,depthBuffer:!0,stencilBuffer:!1,resolveDepthBuffer:!0,resolveStencilBuffer:!0,depthTexture:null,samples:0,count:1},K);const ne=new Texture(te,K.mapping,K.wrapS,K.wrapT,K.magFilter,K.minFilter,K.format,K.type,K.anisotropy,K.colorSpace);ne.flipY=!1,ne.generateMipmaps=K.generateMipmaps,ne.internalFormat=K.internalFormat,this.textures=[];const ie=K.count;for(let oe=0;oe<ie;oe++)this.textures[oe]=ne.clone(),this.textures[oe].isRenderTargetTexture=!0,this.textures[oe].renderTarget=this;this.depthBuffer=K.depthBuffer,this.stencilBuffer=K.stencilBuffer,this.resolveDepthBuffer=K.resolveDepthBuffer,this.resolveStencilBuffer=K.resolveStencilBuffer,this._depthTexture=null,this.depthTexture=K.depthTexture,this.samples=K.samples}get texture(){return this.textures[0]}set texture(Z){this.textures[0]=Z}set depthTexture(Z){this._depthTexture!==null&&(this._depthTexture.renderTarget=null),Z!==null&&(Z.renderTarget=this),this._depthTexture=Z}get depthTexture(){return this._depthTexture}setSize(Z,_,K=1){if(this.width!==Z||this.height!==_||this.depth!==K){this.width=Z,this.height=_,this.depth=K;for(let te=0,ne=this.textures.length;te<ne;te++)this.textures[te].image.width=Z,this.textures[te].image.height=_,this.textures[te].image.depth=K;this.dispose()}this.viewport.set(0,0,Z,_),this.scissor.set(0,0,Z,_)}clone(){return new this.constructor().copy(this)}copy(Z){this.width=Z.width,this.height=Z.height,this.depth=Z.depth,this.scissor.copy(Z.scissor),this.scissorTest=Z.scissorTest,this.viewport.copy(Z.viewport),this.textures.length=0;for(let K=0,te=Z.textures.length;K<te;K++)this.textures[K]=Z.textures[K].clone(),this.textures[K].isRenderTargetTexture=!0,this.textures[K].renderTarget=this;const _=Object.assign({},Z.texture.image);return this.texture.source=new Source(_),this.depthBuffer=Z.depthBuffer,this.stencilBuffer=Z.stencilBuffer,this.resolveDepthBuffer=Z.resolveDepthBuffer,this.resolveStencilBuffer=Z.resolveStencilBuffer,Z.depthTexture!==null&&(this.depthTexture=Z.depthTexture.clone()),this.samples=Z.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class WebGLRenderTarget extends RenderTarget{constructor(Z=1,_=1,K={}){super(Z,_,K),this.isWebGLRenderTarget=!0}}class DataArrayTexture extends Texture{constructor(Z=null,_=1,K=1,te=1){super(null),this.isDataArrayTexture=!0,this.image={data:Z,width:_,height:K,depth:te},this.magFilter=NearestFilter,this.minFilter=NearestFilter,this.wrapR=ClampToEdgeWrapping,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.layerUpdates=new Set}addLayerUpdate(Z){this.layerUpdates.add(Z)}clearLayerUpdates(){this.layerUpdates.clear()}}class WebGLArrayRenderTarget extends WebGLRenderTarget{constructor(Z=1,_=1,K=1,te={}){super(Z,_,te),this.isWebGLArrayRenderTarget=!0,this.depth=K,this.texture=new DataArrayTexture(null,Z,_,K),this.texture.isRenderTargetTexture=!0}}class Data3DTexture extends Texture{constructor(Z=null,_=1,K=1,te=1){super(null),this.isData3DTexture=!0,this.image={data:Z,width:_,height:K,depth:te},this.magFilter=NearestFilter,this.minFilter=NearestFilter,this.wrapR=ClampToEdgeWrapping,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class WebGL3DRenderTarget extends WebGLRenderTarget{constructor(Z=1,_=1,K=1,te={}){super(Z,_,te),this.isWebGL3DRenderTarget=!0,this.depth=K,this.texture=new Data3DTexture(null,Z,_,K),this.texture.isRenderTargetTexture=!0}}let Quaternion$2=class{constructor(Z=0,_=0,K=0,te=1){this.isQuaternion=!0,this._x=Z,this._y=_,this._z=K,this._w=te}static slerpFlat(Z,_,K,te,ne,ie,oe){let se=K[te+0],ae=K[te+1],ge=K[te+2],ce=K[te+3];const de=ne[ie+0],Ie=ne[ie+1],fe=ne[ie+2],be=ne[ie+3];if(oe===0){Z[_+0]=se,Z[_+1]=ae,Z[_+2]=ge,Z[_+3]=ce;return}if(oe===1){Z[_+0]=de,Z[_+1]=Ie,Z[_+2]=fe,Z[_+3]=be;return}if(ce!==be||se!==de||ae!==Ie||ge!==fe){let Ae=1-oe;const ye=se*de+ae*Ie+ge*fe+ce*be,ve=ye>=0?1:-1,Be=1-ye*ye;if(Be>Number.EPSILON){const Ve=Math.sqrt(Be),Ee=Math.atan2(Ve,ye*ve);Ae=Math.sin(Ae*Ee)/Ve,oe=Math.sin(oe*Ee)/Ve}const Re=oe*ve;if(se=se*Ae+de*Re,ae=ae*Ae+Ie*Re,ge=ge*Ae+fe*Re,ce=ce*Ae+be*Re,Ae===1-oe){const Ve=1/Math.sqrt(se*se+ae*ae+ge*ge+ce*ce);se*=Ve,ae*=Ve,ge*=Ve,ce*=Ve}}Z[_]=se,Z[_+1]=ae,Z[_+2]=ge,Z[_+3]=ce}static multiplyQuaternionsFlat(Z,_,K,te,ne,ie){const oe=K[te],se=K[te+1],ae=K[te+2],ge=K[te+3],ce=ne[ie],de=ne[ie+1],Ie=ne[ie+2],fe=ne[ie+3];return Z[_]=oe*fe+ge*ce+se*Ie-ae*de,Z[_+1]=se*fe+ge*de+ae*ce-oe*Ie,Z[_+2]=ae*fe+ge*Ie+oe*de-se*ce,Z[_+3]=ge*fe-oe*ce-se*de-ae*Ie,Z}get x(){return this._x}set x(Z){this._x=Z,this._onChangeCallback()}get y(){return this._y}set y(Z){this._y=Z,this._onChangeCallback()}get z(){return this._z}set z(Z){this._z=Z,this._onChangeCallback()}get w(){return this._w}set w(Z){this._w=Z,this._onChangeCallback()}set(Z,_,K,te){return this._x=Z,this._y=_,this._z=K,this._w=te,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(Z){return this._x=Z.x,this._y=Z.y,this._z=Z.z,this._w=Z.w,this._onChangeCallback(),this}setFromEuler(Z,_=!0){const K=Z._x,te=Z._y,ne=Z._z,ie=Z._order,oe=Math.cos,se=Math.sin,ae=oe(K/2),ge=oe(te/2),ce=oe(ne/2),de=se(K/2),Ie=se(te/2),fe=se(ne/2);switch(ie){case"XYZ":this._x=de*ge*ce+ae*Ie*fe,this._y=ae*Ie*ce-de*ge*fe,this._z=ae*ge*fe+de*Ie*ce,this._w=ae*ge*ce-de*Ie*fe;break;case"YXZ":this._x=de*ge*ce+ae*Ie*fe,this._y=ae*Ie*ce-de*ge*fe,this._z=ae*ge*fe-de*Ie*ce,this._w=ae*ge*ce+de*Ie*fe;break;case"ZXY":this._x=de*ge*ce-ae*Ie*fe,this._y=ae*Ie*ce+de*ge*fe,this._z=ae*ge*fe+de*Ie*ce,this._w=ae*ge*ce-de*Ie*fe;break;case"ZYX":this._x=de*ge*ce-ae*Ie*fe,this._y=ae*Ie*ce+de*ge*fe,this._z=ae*ge*fe-de*Ie*ce,this._w=ae*ge*ce+de*Ie*fe;break;case"YZX":this._x=de*ge*ce+ae*Ie*fe,this._y=ae*Ie*ce+de*ge*fe,this._z=ae*ge*fe-de*Ie*ce,this._w=ae*ge*ce-de*Ie*fe;break;case"XZY":this._x=de*ge*ce-ae*Ie*fe,this._y=ae*Ie*ce-de*ge*fe,this._z=ae*ge*fe+de*Ie*ce,this._w=ae*ge*ce+de*Ie*fe;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+ie)}return _===!0&&this._onChangeCallback(),this}setFromAxisAngle(Z,_){const K=_/2,te=Math.sin(K);return this._x=Z.x*te,this._y=Z.y*te,this._z=Z.z*te,this._w=Math.cos(K),this._onChangeCallback(),this}setFromRotationMatrix(Z){const _=Z.elements,K=_[0],te=_[4],ne=_[8],ie=_[1],oe=_[5],se=_[9],ae=_[2],ge=_[6],ce=_[10],de=K+oe+ce;if(de>0){const Ie=.5/Math.sqrt(de+1);this._w=.25/Ie,this._x=(ge-se)*Ie,this._y=(ne-ae)*Ie,this._z=(ie-te)*Ie}else if(K>oe&&K>ce){const Ie=2*Math.sqrt(1+K-oe-ce);this._w=(ge-se)/Ie,this._x=.25*Ie,this._y=(te+ie)/Ie,this._z=(ne+ae)/Ie}else if(oe>ce){const Ie=2*Math.sqrt(1+oe-K-ce);this._w=(ne-ae)/Ie,this._x=(te+ie)/Ie,this._y=.25*Ie,this._z=(se+ge)/Ie}else{const Ie=2*Math.sqrt(1+ce-K-oe);this._w=(ie-te)/Ie,this._x=(ne+ae)/Ie,this._y=(se+ge)/Ie,this._z=.25*Ie}return this._onChangeCallback(),this}setFromUnitVectors(Z,_){let K=Z.dot(_)+1;return K<Number.EPSILON?(K=0,Math.abs(Z.x)>Math.abs(Z.z)?(this._x=-Z.y,this._y=Z.x,this._z=0,this._w=K):(this._x=0,this._y=-Z.z,this._z=Z.y,this._w=K)):(this._x=Z.y*_.z-Z.z*_.y,this._y=Z.z*_.x-Z.x*_.z,this._z=Z.x*_.y-Z.y*_.x,this._w=K),this.normalize()}angleTo(Z){return 2*Math.acos(Math.abs(clamp$3(this.dot(Z),-1,1)))}rotateTowards(Z,_){const K=this.angleTo(Z);if(K===0)return this;const te=Math.min(1,_/K);return this.slerp(Z,te),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(Z){return this._x*Z._x+this._y*Z._y+this._z*Z._z+this._w*Z._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let Z=this.length();return Z===0?(this._x=0,this._y=0,this._z=0,this._w=1):(Z=1/Z,this._x=this._x*Z,this._y=this._y*Z,this._z=this._z*Z,this._w=this._w*Z),this._onChangeCallback(),this}multiply(Z){return this.multiplyQuaternions(this,Z)}premultiply(Z){return this.multiplyQuaternions(Z,this)}multiplyQuaternions(Z,_){const K=Z._x,te=Z._y,ne=Z._z,ie=Z._w,oe=_._x,se=_._y,ae=_._z,ge=_._w;return this._x=K*ge+ie*oe+te*ae-ne*se,this._y=te*ge+ie*se+ne*oe-K*ae,this._z=ne*ge+ie*ae+K*se-te*oe,this._w=ie*ge-K*oe-te*se-ne*ae,this._onChangeCallback(),this}slerp(Z,_){if(_===0)return this;if(_===1)return this.copy(Z);const K=this._x,te=this._y,ne=this._z,ie=this._w;let oe=ie*Z._w+K*Z._x+te*Z._y+ne*Z._z;if(oe<0?(this._w=-Z._w,this._x=-Z._x,this._y=-Z._y,this._z=-Z._z,oe=-oe):this.copy(Z),oe>=1)return this._w=ie,this._x=K,this._y=te,this._z=ne,this;const se=1-oe*oe;if(se<=Number.EPSILON){const Ie=1-_;return this._w=Ie*ie+_*this._w,this._x=Ie*K+_*this._x,this._y=Ie*te+_*this._y,this._z=Ie*ne+_*this._z,this.normalize(),this}const ae=Math.sqrt(se),ge=Math.atan2(ae,oe),ce=Math.sin((1-_)*ge)/ae,de=Math.sin(_*ge)/ae;return this._w=ie*ce+this._w*de,this._x=K*ce+this._x*de,this._y=te*ce+this._y*de,this._z=ne*ce+this._z*de,this._onChangeCallback(),this}slerpQuaternions(Z,_,K){return this.copy(Z).slerp(_,K)}random(){const Z=2*Math.PI*Math.random(),_=2*Math.PI*Math.random(),K=Math.random(),te=Math.sqrt(1-K),ne=Math.sqrt(K);return this.set(te*Math.sin(Z),te*Math.cos(Z),ne*Math.sin(_),ne*Math.cos(_))}equals(Z){return Z._x===this._x&&Z._y===this._y&&Z._z===this._z&&Z._w===this._w}fromArray(Z,_=0){return this._x=Z[_],this._y=Z[_+1],this._z=Z[_+2],this._w=Z[_+3],this._onChangeCallback(),this}toArray(Z=[],_=0){return Z[_]=this._x,Z[_+1]=this._y,Z[_+2]=this._z,Z[_+3]=this._w,Z}fromBufferAttribute(Z,_){return this._x=Z.getX(_),this._y=Z.getY(_),this._z=Z.getZ(_),this._w=Z.getW(_),this._onChangeCallback(),this}toJSON(){return this.toArray()}_onChange(Z){return this._onChangeCallback=Z,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}};class Vector3{constructor(Z=0,_=0,K=0){Vector3.prototype.isVector3=!0,this.x=Z,this.y=_,this.z=K}set(Z,_,K){return K===void 0&&(K=this.z),this.x=Z,this.y=_,this.z=K,this}setScalar(Z){return this.x=Z,this.y=Z,this.z=Z,this}setX(Z){return this.x=Z,this}setY(Z){return this.y=Z,this}setZ(Z){return this.z=Z,this}setComponent(Z,_){switch(Z){case 0:this.x=_;break;case 1:this.y=_;break;case 2:this.z=_;break;default:throw new Error("index is out of range: "+Z)}return this}getComponent(Z){switch(Z){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+Z)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(Z){return this.x=Z.x,this.y=Z.y,this.z=Z.z,this}add(Z){return this.x+=Z.x,this.y+=Z.y,this.z+=Z.z,this}addScalar(Z){return this.x+=Z,this.y+=Z,this.z+=Z,this}addVectors(Z,_){return this.x=Z.x+_.x,this.y=Z.y+_.y,this.z=Z.z+_.z,this}addScaledVector(Z,_){return this.x+=Z.x*_,this.y+=Z.y*_,this.z+=Z.z*_,this}sub(Z){return this.x-=Z.x,this.y-=Z.y,this.z-=Z.z,this}subScalar(Z){return this.x-=Z,this.y-=Z,this.z-=Z,this}subVectors(Z,_){return this.x=Z.x-_.x,this.y=Z.y-_.y,this.z=Z.z-_.z,this}multiply(Z){return this.x*=Z.x,this.y*=Z.y,this.z*=Z.z,this}multiplyScalar(Z){return this.x*=Z,this.y*=Z,this.z*=Z,this}multiplyVectors(Z,_){return this.x=Z.x*_.x,this.y=Z.y*_.y,this.z=Z.z*_.z,this}applyEuler(Z){return this.applyQuaternion(_quaternion$4.setFromEuler(Z))}applyAxisAngle(Z,_){return this.applyQuaternion(_quaternion$4.setFromAxisAngle(Z,_))}applyMatrix3(Z){const _=this.x,K=this.y,te=this.z,ne=Z.elements;return this.x=ne[0]*_+ne[3]*K+ne[6]*te,this.y=ne[1]*_+ne[4]*K+ne[7]*te,this.z=ne[2]*_+ne[5]*K+ne[8]*te,this}applyNormalMatrix(Z){return this.applyMatrix3(Z).normalize()}applyMatrix4(Z){const _=this.x,K=this.y,te=this.z,ne=Z.elements,ie=1/(ne[3]*_+ne[7]*K+ne[11]*te+ne[15]);return this.x=(ne[0]*_+ne[4]*K+ne[8]*te+ne[12])*ie,this.y=(ne[1]*_+ne[5]*K+ne[9]*te+ne[13])*ie,this.z=(ne[2]*_+ne[6]*K+ne[10]*te+ne[14])*ie,this}applyQuaternion(Z){const _=this.x,K=this.y,te=this.z,ne=Z.x,ie=Z.y,oe=Z.z,se=Z.w,ae=2*(ie*te-oe*K),ge=2*(oe*_-ne*te),ce=2*(ne*K-ie*_);return this.x=_+se*ae+ie*ce-oe*ge,this.y=K+se*ge+oe*ae-ne*ce,this.z=te+se*ce+ne*ge-ie*ae,this}project(Z){return this.applyMatrix4(Z.matrixWorldInverse).applyMatrix4(Z.projectionMatrix)}unproject(Z){return this.applyMatrix4(Z.projectionMatrixInverse).applyMatrix4(Z.matrixWorld)}transformDirection(Z){const _=this.x,K=this.y,te=this.z,ne=Z.elements;return this.x=ne[0]*_+ne[4]*K+ne[8]*te,this.y=ne[1]*_+ne[5]*K+ne[9]*te,this.z=ne[2]*_+ne[6]*K+ne[10]*te,this.normalize()}divide(Z){return this.x/=Z.x,this.y/=Z.y,this.z/=Z.z,this}divideScalar(Z){return this.multiplyScalar(1/Z)}min(Z){return this.x=Math.min(this.x,Z.x),this.y=Math.min(this.y,Z.y),this.z=Math.min(this.z,Z.z),this}max(Z){return this.x=Math.max(this.x,Z.x),this.y=Math.max(this.y,Z.y),this.z=Math.max(this.z,Z.z),this}clamp(Z,_){return this.x=clamp$3(this.x,Z.x,_.x),this.y=clamp$3(this.y,Z.y,_.y),this.z=clamp$3(this.z,Z.z,_.z),this}clampScalar(Z,_){return this.x=clamp$3(this.x,Z,_),this.y=clamp$3(this.y,Z,_),this.z=clamp$3(this.z,Z,_),this}clampLength(Z,_){const K=this.length();return this.divideScalar(K||1).multiplyScalar(clamp$3(K,Z,_))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(Z){return this.x*Z.x+this.y*Z.y+this.z*Z.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(Z){return this.normalize().multiplyScalar(Z)}lerp(Z,_){return this.x+=(Z.x-this.x)*_,this.y+=(Z.y-this.y)*_,this.z+=(Z.z-this.z)*_,this}lerpVectors(Z,_,K){return this.x=Z.x+(_.x-Z.x)*K,this.y=Z.y+(_.y-Z.y)*K,this.z=Z.z+(_.z-Z.z)*K,this}cross(Z){return this.crossVectors(this,Z)}crossVectors(Z,_){const K=Z.x,te=Z.y,ne=Z.z,ie=_.x,oe=_.y,se=_.z;return this.x=te*se-ne*oe,this.y=ne*ie-K*se,this.z=K*oe-te*ie,this}projectOnVector(Z){const _=Z.lengthSq();if(_===0)return this.set(0,0,0);const K=Z.dot(this)/_;return this.copy(Z).multiplyScalar(K)}projectOnPlane(Z){return _vector$c.copy(this).projectOnVector(Z),this.sub(_vector$c)}reflect(Z){return this.sub(_vector$c.copy(Z).multiplyScalar(2*this.dot(Z)))}angleTo(Z){const _=Math.sqrt(this.lengthSq()*Z.lengthSq());if(_===0)return Math.PI/2;const K=this.dot(Z)/_;return Math.acos(clamp$3(K,-1,1))}distanceTo(Z){return Math.sqrt(this.distanceToSquared(Z))}distanceToSquared(Z){const _=this.x-Z.x,K=this.y-Z.y,te=this.z-Z.z;return _*_+K*K+te*te}manhattanDistanceTo(Z){return Math.abs(this.x-Z.x)+Math.abs(this.y-Z.y)+Math.abs(this.z-Z.z)}setFromSpherical(Z){return this.setFromSphericalCoords(Z.radius,Z.phi,Z.theta)}setFromSphericalCoords(Z,_,K){const te=Math.sin(_)*Z;return this.x=te*Math.sin(K),this.y=Math.cos(_)*Z,this.z=te*Math.cos(K),this}setFromCylindrical(Z){return this.setFromCylindricalCoords(Z.radius,Z.theta,Z.y)}setFromCylindricalCoords(Z,_,K){return this.x=Z*Math.sin(_),this.y=K,this.z=Z*Math.cos(_),this}setFromMatrixPosition(Z){const _=Z.elements;return this.x=_[12],this.y=_[13],this.z=_[14],this}setFromMatrixScale(Z){const _=this.setFromMatrixColumn(Z,0).length(),K=this.setFromMatrixColumn(Z,1).length(),te=this.setFromMatrixColumn(Z,2).length();return this.x=_,this.y=K,this.z=te,this}setFromMatrixColumn(Z,_){return this.fromArray(Z.elements,_*4)}setFromMatrix3Column(Z,_){return this.fromArray(Z.elements,_*3)}setFromEuler(Z){return this.x=Z._x,this.y=Z._y,this.z=Z._z,this}setFromColor(Z){return this.x=Z.r,this.y=Z.g,this.z=Z.b,this}equals(Z){return Z.x===this.x&&Z.y===this.y&&Z.z===this.z}fromArray(Z,_=0){return this.x=Z[_],this.y=Z[_+1],this.z=Z[_+2],this}toArray(Z=[],_=0){return Z[_]=this.x,Z[_+1]=this.y,Z[_+2]=this.z,Z}fromBufferAttribute(Z,_){return this.x=Z.getX(_),this.y=Z.getY(_),this.z=Z.getZ(_),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const Z=Math.random()*Math.PI*2,_=Math.random()*2-1,K=Math.sqrt(1-_*_);return this.x=K*Math.cos(Z),this.y=_,this.z=K*Math.sin(Z),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const _vector$c=new Vector3,_quaternion$4=new Quaternion$2;class Box3{constructor(Z=new Vector3(1/0,1/0,1/0),_=new Vector3(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=Z,this.max=_}set(Z,_){return this.min.copy(Z),this.max.copy(_),this}setFromArray(Z){this.makeEmpty();for(let _=0,K=Z.length;_<K;_+=3)this.expandByPoint(_vector$b.fromArray(Z,_));return this}setFromBufferAttribute(Z){this.makeEmpty();for(let _=0,K=Z.count;_<K;_++)this.expandByPoint(_vector$b.fromBufferAttribute(Z,_));return this}setFromPoints(Z){this.makeEmpty();for(let _=0,K=Z.length;_<K;_++)this.expandByPoint(Z[_]);return this}setFromCenterAndSize(Z,_){const K=_vector$b.copy(_).multiplyScalar(.5);return this.min.copy(Z).sub(K),this.max.copy(Z).add(K),this}setFromObject(Z,_=!1){return this.makeEmpty(),this.expandByObject(Z,_)}clone(){return new this.constructor().copy(this)}copy(Z){return this.min.copy(Z.min),this.max.copy(Z.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(Z){return this.isEmpty()?Z.set(0,0,0):Z.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(Z){return this.isEmpty()?Z.set(0,0,0):Z.subVectors(this.max,this.min)}expandByPoint(Z){return this.min.min(Z),this.max.max(Z),this}expandByVector(Z){return this.min.sub(Z),this.max.add(Z),this}expandByScalar(Z){return this.min.addScalar(-Z),this.max.addScalar(Z),this}expandByObject(Z,_=!1){Z.updateWorldMatrix(!1,!1);const K=Z.geometry;if(K!==void 0){const ne=K.getAttribute("position");if(_===!0&&ne!==void 0&&Z.isInstancedMesh!==!0)for(let ie=0,oe=ne.count;ie<oe;ie++)Z.isMesh===!0?Z.getVertexPosition(ie,_vector$b):_vector$b.fromBufferAttribute(ne,ie),_vector$b.applyMatrix4(Z.matrixWorld),this.expandByPoint(_vector$b);else Z.boundingBox!==void 0?(Z.boundingBox===null&&Z.computeBoundingBox(),_box$4.copy(Z.boundingBox)):(K.boundingBox===null&&K.computeBoundingBox(),_box$4.copy(K.boundingBox)),_box$4.applyMatrix4(Z.matrixWorld),this.union(_box$4)}const te=Z.children;for(let ne=0,ie=te.length;ne<ie;ne++)this.expandByObject(te[ne],_);return this}containsPoint(Z){return Z.x>=this.min.x&&Z.x<=this.max.x&&Z.y>=this.min.y&&Z.y<=this.max.y&&Z.z>=this.min.z&&Z.z<=this.max.z}containsBox(Z){return this.min.x<=Z.min.x&&Z.max.x<=this.max.x&&this.min.y<=Z.min.y&&Z.max.y<=this.max.y&&this.min.z<=Z.min.z&&Z.max.z<=this.max.z}getParameter(Z,_){return _.set((Z.x-this.min.x)/(this.max.x-this.min.x),(Z.y-this.min.y)/(this.max.y-this.min.y),(Z.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(Z){return Z.max.x>=this.min.x&&Z.min.x<=this.max.x&&Z.max.y>=this.min.y&&Z.min.y<=this.max.y&&Z.max.z>=this.min.z&&Z.min.z<=this.max.z}intersectsSphere(Z){return this.clampPoint(Z.center,_vector$b),_vector$b.distanceToSquared(Z.center)<=Z.radius*Z.radius}intersectsPlane(Z){let _,K;return Z.normal.x>0?(_=Z.normal.x*this.min.x,K=Z.normal.x*this.max.x):(_=Z.normal.x*this.max.x,K=Z.normal.x*this.min.x),Z.normal.y>0?(_+=Z.normal.y*this.min.y,K+=Z.normal.y*this.max.y):(_+=Z.normal.y*this.max.y,K+=Z.normal.y*this.min.y),Z.normal.z>0?(_+=Z.normal.z*this.min.z,K+=Z.normal.z*this.max.z):(_+=Z.normal.z*this.max.z,K+=Z.normal.z*this.min.z),_<=-Z.constant&&K>=-Z.constant}intersectsTriangle(Z){if(this.isEmpty())return!1;this.getCenter(_center),_extents.subVectors(this.max,_center),_v0$2.subVectors(Z.a,_center),_v1$7.subVectors(Z.b,_center),_v2$4.subVectors(Z.c,_center),_f0.subVectors(_v1$7,_v0$2),_f1.subVectors(_v2$4,_v1$7),_f2.subVectors(_v0$2,_v2$4);let _=[0,-_f0.z,_f0.y,0,-_f1.z,_f1.y,0,-_f2.z,_f2.y,_f0.z,0,-_f0.x,_f1.z,0,-_f1.x,_f2.z,0,-_f2.x,-_f0.y,_f0.x,0,-_f1.y,_f1.x,0,-_f2.y,_f2.x,0];return!satForAxes(_,_v0$2,_v1$7,_v2$4,_extents)||(_=[1,0,0,0,1,0,0,0,1],!satForAxes(_,_v0$2,_v1$7,_v2$4,_extents))?!1:(_triangleNormal.crossVectors(_f0,_f1),_=[_triangleNormal.x,_triangleNormal.y,_triangleNormal.z],satForAxes(_,_v0$2,_v1$7,_v2$4,_extents))}clampPoint(Z,_){return _.copy(Z).clamp(this.min,this.max)}distanceToPoint(Z){return this.clampPoint(Z,_vector$b).distanceTo(Z)}getBoundingSphere(Z){return this.isEmpty()?Z.makeEmpty():(this.getCenter(Z.center),Z.radius=this.getSize(_vector$b).length()*.5),Z}intersect(Z){return this.min.max(Z.min),this.max.min(Z.max),this.isEmpty()&&this.makeEmpty(),this}union(Z){return this.min.min(Z.min),this.max.max(Z.max),this}applyMatrix4(Z){return this.isEmpty()?this:(_points[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(Z),_points[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(Z),_points[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(Z),_points[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(Z),_points[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(Z),_points[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(Z),_points[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(Z),_points[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(Z),this.setFromPoints(_points),this)}translate(Z){return this.min.add(Z),this.max.add(Z),this}equals(Z){return Z.min.equals(this.min)&&Z.max.equals(this.max)}}const _points=[new Vector3,new Vector3,new Vector3,new Vector3,new Vector3,new Vector3,new Vector3,new Vector3],_vector$b=new Vector3,_box$4=new Box3,_v0$2=new Vector3,_v1$7=new Vector3,_v2$4=new Vector3,_f0=new Vector3,_f1=new Vector3,_f2=new Vector3,_center=new Vector3,_extents=new Vector3,_triangleNormal=new Vector3,_testAxis=new Vector3;function satForAxes(X,Z,_,K,te){for(let ne=0,ie=X.length-3;ne<=ie;ne+=3){_testAxis.fromArray(X,ne);const oe=te.x*Math.abs(_testAxis.x)+te.y*Math.abs(_testAxis.y)+te.z*Math.abs(_testAxis.z),se=Z.dot(_testAxis),ae=_.dot(_testAxis),ge=K.dot(_testAxis);if(Math.max(-Math.max(se,ae,ge),Math.min(se,ae,ge))>oe)return!1}return!0}const _box$3=new Box3,_v1$6=new Vector3,_v2$3=new Vector3;class Sphere{constructor(Z=new Vector3,_=-1){this.isSphere=!0,this.center=Z,this.radius=_}set(Z,_){return this.center.copy(Z),this.radius=_,this}setFromPoints(Z,_){const K=this.center;_!==void 0?K.copy(_):_box$3.setFromPoints(Z).getCenter(K);let te=0;for(let ne=0,ie=Z.length;ne<ie;ne++)te=Math.max(te,K.distanceToSquared(Z[ne]));return this.radius=Math.sqrt(te),this}copy(Z){return this.center.copy(Z.center),this.radius=Z.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(Z){return Z.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(Z){return Z.distanceTo(this.center)-this.radius}intersectsSphere(Z){const _=this.radius+Z.radius;return Z.center.distanceToSquared(this.center)<=_*_}intersectsBox(Z){return Z.intersectsSphere(this)}intersectsPlane(Z){return Math.abs(Z.distanceToPoint(this.center))<=this.radius}clampPoint(Z,_){const K=this.center.distanceToSquared(Z);return _.copy(Z),K>this.radius*this.radius&&(_.sub(this.center).normalize(),_.multiplyScalar(this.radius).add(this.center)),_}getBoundingBox(Z){return this.isEmpty()?(Z.makeEmpty(),Z):(Z.set(this.center,this.center),Z.expandByScalar(this.radius),Z)}applyMatrix4(Z){return this.center.applyMatrix4(Z),this.radius=this.radius*Z.getMaxScaleOnAxis(),this}translate(Z){return this.center.add(Z),this}expandByPoint(Z){if(this.isEmpty())return this.center.copy(Z),this.radius=0,this;_v1$6.subVectors(Z,this.center);const _=_v1$6.lengthSq();if(_>this.radius*this.radius){const K=Math.sqrt(_),te=(K-this.radius)*.5;this.center.addScaledVector(_v1$6,te/K),this.radius+=te}return this}union(Z){return Z.isEmpty()?this:this.isEmpty()?(this.copy(Z),this):(this.center.equals(Z.center)===!0?this.radius=Math.max(this.radius,Z.radius):(_v2$3.subVectors(Z.center,this.center).setLength(Z.radius),this.expandByPoint(_v1$6.copy(Z.center).add(_v2$3)),this.expandByPoint(_v1$6.copy(Z.center).sub(_v2$3))),this)}equals(Z){return Z.center.equals(this.center)&&Z.radius===this.radius}clone(){return new this.constructor().copy(this)}}const _vector$a=new Vector3,_segCenter=new Vector3,_segDir=new Vector3,_diff=new Vector3,_edge1=new Vector3,_edge2=new Vector3,_normal$1=new Vector3;let Ray$2=class{constructor(Z=new Vector3,_=new Vector3(0,0,-1)){this.origin=Z,this.direction=_}set(Z,_){return this.origin.copy(Z),this.direction.copy(_),this}copy(Z){return this.origin.copy(Z.origin),this.direction.copy(Z.direction),this}at(Z,_){return _.copy(this.origin).addScaledVector(this.direction,Z)}lookAt(Z){return this.direction.copy(Z).sub(this.origin).normalize(),this}recast(Z){return this.origin.copy(this.at(Z,_vector$a)),this}closestPointToPoint(Z,_){_.subVectors(Z,this.origin);const K=_.dot(this.direction);return K<0?_.copy(this.origin):_.copy(this.origin).addScaledVector(this.direction,K)}distanceToPoint(Z){return Math.sqrt(this.distanceSqToPoint(Z))}distanceSqToPoint(Z){const _=_vector$a.subVectors(Z,this.origin).dot(this.direction);return _<0?this.origin.distanceToSquared(Z):(_vector$a.copy(this.origin).addScaledVector(this.direction,_),_vector$a.distanceToSquared(Z))}distanceSqToSegment(Z,_,K,te){_segCenter.copy(Z).add(_).multiplyScalar(.5),_segDir.copy(_).sub(Z).normalize(),_diff.copy(this.origin).sub(_segCenter);const ne=Z.distanceTo(_)*.5,ie=-this.direction.dot(_segDir),oe=_diff.dot(this.direction),se=-_diff.dot(_segDir),ae=_diff.lengthSq(),ge=Math.abs(1-ie*ie);let ce,de,Ie,fe;if(ge>0)if(ce=ie*se-oe,de=ie*oe-se,fe=ne*ge,ce>=0)if(de>=-fe)if(de<=fe){const be=1/ge;ce*=be,de*=be,Ie=ce*(ce+ie*de+2*oe)+de*(ie*ce+de+2*se)+ae}else de=ne,ce=Math.max(0,-(ie*de+oe)),Ie=-ce*ce+de*(de+2*se)+ae;else de=-ne,ce=Math.max(0,-(ie*de+oe)),Ie=-ce*ce+de*(de+2*se)+ae;else de<=-fe?(ce=Math.max(0,-(-ie*ne+oe)),de=ce>0?-ne:Math.min(Math.max(-ne,-se),ne),Ie=-ce*ce+de*(de+2*se)+ae):de<=fe?(ce=0,de=Math.min(Math.max(-ne,-se),ne),Ie=de*(de+2*se)+ae):(ce=Math.max(0,-(ie*ne+oe)),de=ce>0?ne:Math.min(Math.max(-ne,-se),ne),Ie=-ce*ce+de*(de+2*se)+ae);else de=ie>0?-ne:ne,ce=Math.max(0,-(ie*de+oe)),Ie=-ce*ce+de*(de+2*se)+ae;return K&&K.copy(this.origin).addScaledVector(this.direction,ce),te&&te.copy(_segCenter).addScaledVector(_segDir,de),Ie}intersectSphere(Z,_){_vector$a.subVectors(Z.center,this.origin);const K=_vector$a.dot(this.direction),te=_vector$a.dot(_vector$a)-K*K,ne=Z.radius*Z.radius;if(te>ne)return null;const ie=Math.sqrt(ne-te),oe=K-ie,se=K+ie;return se<0?null:oe<0?this.at(se,_):this.at(oe,_)}intersectsSphere(Z){return this.distanceSqToPoint(Z.center)<=Z.radius*Z.radius}distanceToPlane(Z){const _=Z.normal.dot(this.direction);if(_===0)return Z.distanceToPoint(this.origin)===0?0:null;const K=-(this.origin.dot(Z.normal)+Z.constant)/_;return K>=0?K:null}intersectPlane(Z,_){const K=this.distanceToPlane(Z);return K===null?null:this.at(K,_)}intersectsPlane(Z){const _=Z.distanceToPoint(this.origin);return _===0||Z.normal.dot(this.direction)*_<0}intersectBox(Z,_){let K,te,ne,ie,oe,se;const ae=1/this.direction.x,ge=1/this.direction.y,ce=1/this.direction.z,de=this.origin;return ae>=0?(K=(Z.min.x-de.x)*ae,te=(Z.max.x-de.x)*ae):(K=(Z.max.x-de.x)*ae,te=(Z.min.x-de.x)*ae),ge>=0?(ne=(Z.min.y-de.y)*ge,ie=(Z.max.y-de.y)*ge):(ne=(Z.max.y-de.y)*ge,ie=(Z.min.y-de.y)*ge),K>ie||ne>te||((ne>K||isNaN(K))&&(K=ne),(ie<te||isNaN(te))&&(te=ie),ce>=0?(oe=(Z.min.z-de.z)*ce,se=(Z.max.z-de.z)*ce):(oe=(Z.max.z-de.z)*ce,se=(Z.min.z-de.z)*ce),K>se||oe>te)||((oe>K||K!==K)&&(K=oe),(se<te||te!==te)&&(te=se),te<0)?null:this.at(K>=0?K:te,_)}intersectsBox(Z){return this.intersectBox(Z,_vector$a)!==null}intersectTriangle(Z,_,K,te,ne){_edge1.subVectors(_,Z),_edge2.subVectors(K,Z),_normal$1.crossVectors(_edge1,_edge2);let ie=this.direction.dot(_normal$1),oe;if(ie>0){if(te)return null;oe=1}else if(ie<0)oe=-1,ie=-ie;else return null;_diff.subVectors(this.origin,Z);const se=oe*this.direction.dot(_edge2.crossVectors(_diff,_edge2));if(se<0)return null;const ae=oe*this.direction.dot(_edge1.cross(_diff));if(ae<0||se+ae>ie)return null;const ge=-oe*_diff.dot(_normal$1);return ge<0?null:this.at(ge/ie,ne)}applyMatrix4(Z){return this.origin.applyMatrix4(Z),this.direction.transformDirection(Z),this}equals(Z){return Z.origin.equals(this.origin)&&Z.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}};class Matrix4{constructor(Z,_,K,te,ne,ie,oe,se,ae,ge,ce,de,Ie,fe,be,Ae){Matrix4.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],Z!==void 0&&this.set(Z,_,K,te,ne,ie,oe,se,ae,ge,ce,de,Ie,fe,be,Ae)}set(Z,_,K,te,ne,ie,oe,se,ae,ge,ce,de,Ie,fe,be,Ae){const ye=this.elements;return ye[0]=Z,ye[4]=_,ye[8]=K,ye[12]=te,ye[1]=ne,ye[5]=ie,ye[9]=oe,ye[13]=se,ye[2]=ae,ye[6]=ge,ye[10]=ce,ye[14]=de,ye[3]=Ie,ye[7]=fe,ye[11]=be,ye[15]=Ae,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new Matrix4().fromArray(this.elements)}copy(Z){const _=this.elements,K=Z.elements;return _[0]=K[0],_[1]=K[1],_[2]=K[2],_[3]=K[3],_[4]=K[4],_[5]=K[5],_[6]=K[6],_[7]=K[7],_[8]=K[8],_[9]=K[9],_[10]=K[10],_[11]=K[11],_[12]=K[12],_[13]=K[13],_[14]=K[14],_[15]=K[15],this}copyPosition(Z){const _=this.elements,K=Z.elements;return _[12]=K[12],_[13]=K[13],_[14]=K[14],this}setFromMatrix3(Z){const _=Z.elements;return this.set(_[0],_[3],_[6],0,_[1],_[4],_[7],0,_[2],_[5],_[8],0,0,0,0,1),this}extractBasis(Z,_,K){return Z.setFromMatrixColumn(this,0),_.setFromMatrixColumn(this,1),K.setFromMatrixColumn(this,2),this}makeBasis(Z,_,K){return this.set(Z.x,_.x,K.x,0,Z.y,_.y,K.y,0,Z.z,_.z,K.z,0,0,0,0,1),this}extractRotation(Z){const _=this.elements,K=Z.elements,te=1/_v1$5.setFromMatrixColumn(Z,0).length(),ne=1/_v1$5.setFromMatrixColumn(Z,1).length(),ie=1/_v1$5.setFromMatrixColumn(Z,2).length();return _[0]=K[0]*te,_[1]=K[1]*te,_[2]=K[2]*te,_[3]=0,_[4]=K[4]*ne,_[5]=K[5]*ne,_[6]=K[6]*ne,_[7]=0,_[8]=K[8]*ie,_[9]=K[9]*ie,_[10]=K[10]*ie,_[11]=0,_[12]=0,_[13]=0,_[14]=0,_[15]=1,this}makeRotationFromEuler(Z){const _=this.elements,K=Z.x,te=Z.y,ne=Z.z,ie=Math.cos(K),oe=Math.sin(K),se=Math.cos(te),ae=Math.sin(te),ge=Math.cos(ne),ce=Math.sin(ne);if(Z.order==="XYZ"){const de=ie*ge,Ie=ie*ce,fe=oe*ge,be=oe*ce;_[0]=se*ge,_[4]=-se*ce,_[8]=ae,_[1]=Ie+fe*ae,_[5]=de-be*ae,_[9]=-oe*se,_[2]=be-de*ae,_[6]=fe+Ie*ae,_[10]=ie*se}else if(Z.order==="YXZ"){const de=se*ge,Ie=se*ce,fe=ae*ge,be=ae*ce;_[0]=de+be*oe,_[4]=fe*oe-Ie,_[8]=ie*ae,_[1]=ie*ce,_[5]=ie*ge,_[9]=-oe,_[2]=Ie*oe-fe,_[6]=be+de*oe,_[10]=ie*se}else if(Z.order==="ZXY"){const de=se*ge,Ie=se*ce,fe=ae*ge,be=ae*ce;_[0]=de-be*oe,_[4]=-ie*ce,_[8]=fe+Ie*oe,_[1]=Ie+fe*oe,_[5]=ie*ge,_[9]=be-de*oe,_[2]=-ie*ae,_[6]=oe,_[10]=ie*se}else if(Z.order==="ZYX"){const de=ie*ge,Ie=ie*ce,fe=oe*ge,be=oe*ce;_[0]=se*ge,_[4]=fe*ae-Ie,_[8]=de*ae+be,_[1]=se*ce,_[5]=be*ae+de,_[9]=Ie*ae-fe,_[2]=-ae,_[6]=oe*se,_[10]=ie*se}else if(Z.order==="YZX"){const de=ie*se,Ie=ie*ae,fe=oe*se,be=oe*ae;_[0]=se*ge,_[4]=be-de*ce,_[8]=fe*ce+Ie,_[1]=ce,_[5]=ie*ge,_[9]=-oe*ge,_[2]=-ae*ge,_[6]=Ie*ce+fe,_[10]=de-be*ce}else if(Z.order==="XZY"){const de=ie*se,Ie=ie*ae,fe=oe*se,be=oe*ae;_[0]=se*ge,_[4]=-ce,_[8]=ae*ge,_[1]=de*ce+be,_[5]=ie*ge,_[9]=Ie*ce-fe,_[2]=fe*ce-Ie,_[6]=oe*ge,_[10]=be*ce+de}return _[3]=0,_[7]=0,_[11]=0,_[12]=0,_[13]=0,_[14]=0,_[15]=1,this}makeRotationFromQuaternion(Z){return this.compose(_zero,Z,_one)}lookAt(Z,_,K){const te=this.elements;return _z.subVectors(Z,_),_z.lengthSq()===0&&(_z.z=1),_z.normalize(),_x.crossVectors(K,_z),_x.lengthSq()===0&&(Math.abs(K.z)===1?_z.x+=1e-4:_z.z+=1e-4,_z.normalize(),_x.crossVectors(K,_z)),_x.normalize(),_y.crossVectors(_z,_x),te[0]=_x.x,te[4]=_y.x,te[8]=_z.x,te[1]=_x.y,te[5]=_y.y,te[9]=_z.y,te[2]=_x.z,te[6]=_y.z,te[10]=_z.z,this}multiply(Z){return this.multiplyMatrices(this,Z)}premultiply(Z){return this.multiplyMatrices(Z,this)}multiplyMatrices(Z,_){const K=Z.elements,te=_.elements,ne=this.elements,ie=K[0],oe=K[4],se=K[8],ae=K[12],ge=K[1],ce=K[5],de=K[9],Ie=K[13],fe=K[2],be=K[6],Ae=K[10],ye=K[14],ve=K[3],Be=K[7],Re=K[11],Ve=K[15],Ee=te[0],Ze=te[4],_e=te[8],Fe=te[12],Te=te[1],ke=te[5],Le=te[9],Ke=te[13],Ue=te[2],rt=te[6],tt=te[10],at=te[14],ze=te[3],qe=te[7],Pe=te[11],Ye=te[15];return ne[0]=ie*Ee+oe*Te+se*Ue+ae*ze,ne[4]=ie*Ze+oe*ke+se*rt+ae*qe,ne[8]=ie*_e+oe*Le+se*tt+ae*Pe,ne[12]=ie*Fe+oe*Ke+se*at+ae*Ye,ne[1]=ge*Ee+ce*Te+de*Ue+Ie*ze,ne[5]=ge*Ze+ce*ke+de*rt+Ie*qe,ne[9]=ge*_e+ce*Le+de*tt+Ie*Pe,ne[13]=ge*Fe+ce*Ke+de*at+Ie*Ye,ne[2]=fe*Ee+be*Te+Ae*Ue+ye*ze,ne[6]=fe*Ze+be*ke+Ae*rt+ye*qe,ne[10]=fe*_e+be*Le+Ae*tt+ye*Pe,ne[14]=fe*Fe+be*Ke+Ae*at+ye*Ye,ne[3]=ve*Ee+Be*Te+Re*Ue+Ve*ze,ne[7]=ve*Ze+Be*ke+Re*rt+Ve*qe,ne[11]=ve*_e+Be*Le+Re*tt+Ve*Pe,ne[15]=ve*Fe+Be*Ke+Re*at+Ve*Ye,this}multiplyScalar(Z){const _=this.elements;return _[0]*=Z,_[4]*=Z,_[8]*=Z,_[12]*=Z,_[1]*=Z,_[5]*=Z,_[9]*=Z,_[13]*=Z,_[2]*=Z,_[6]*=Z,_[10]*=Z,_[14]*=Z,_[3]*=Z,_[7]*=Z,_[11]*=Z,_[15]*=Z,this}determinant(){const Z=this.elements,_=Z[0],K=Z[4],te=Z[8],ne=Z[12],ie=Z[1],oe=Z[5],se=Z[9],ae=Z[13],ge=Z[2],ce=Z[6],de=Z[10],Ie=Z[14],fe=Z[3],be=Z[7],Ae=Z[11],ye=Z[15];return fe*(+ne*se*ce-te*ae*ce-ne*oe*de+K*ae*de+te*oe*Ie-K*se*Ie)+be*(+_*se*Ie-_*ae*de+ne*ie*de-te*ie*Ie+te*ae*ge-ne*se*ge)+Ae*(+_*ae*ce-_*oe*Ie-ne*ie*ce+K*ie*Ie+ne*oe*ge-K*ae*ge)+ye*(-te*oe*ge-_*se*ce+_*oe*de+te*ie*ce-K*ie*de+K*se*ge)}transpose(){const Z=this.elements;let _;return _=Z[1],Z[1]=Z[4],Z[4]=_,_=Z[2],Z[2]=Z[8],Z[8]=_,_=Z[6],Z[6]=Z[9],Z[9]=_,_=Z[3],Z[3]=Z[12],Z[12]=_,_=Z[7],Z[7]=Z[13],Z[13]=_,_=Z[11],Z[11]=Z[14],Z[14]=_,this}setPosition(Z,_,K){const te=this.elements;return Z.isVector3?(te[12]=Z.x,te[13]=Z.y,te[14]=Z.z):(te[12]=Z,te[13]=_,te[14]=K),this}invert(){const Z=this.elements,_=Z[0],K=Z[1],te=Z[2],ne=Z[3],ie=Z[4],oe=Z[5],se=Z[6],ae=Z[7],ge=Z[8],ce=Z[9],de=Z[10],Ie=Z[11],fe=Z[12],be=Z[13],Ae=Z[14],ye=Z[15],ve=ce*Ae*ae-be*de*ae+be*se*Ie-oe*Ae*Ie-ce*se*ye+oe*de*ye,Be=fe*de*ae-ge*Ae*ae-fe*se*Ie+ie*Ae*Ie+ge*se*ye-ie*de*ye,Re=ge*be*ae-fe*ce*ae+fe*oe*Ie-ie*be*Ie-ge*oe*ye+ie*ce*ye,Ve=fe*ce*se-ge*be*se-fe*oe*de+ie*be*de+ge*oe*Ae-ie*ce*Ae,Ee=_*ve+K*Be+te*Re+ne*Ve;if(Ee===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const Ze=1/Ee;return Z[0]=ve*Ze,Z[1]=(be*de*ne-ce*Ae*ne-be*te*Ie+K*Ae*Ie+ce*te*ye-K*de*ye)*Ze,Z[2]=(oe*Ae*ne-be*se*ne+be*te*ae-K*Ae*ae-oe*te*ye+K*se*ye)*Ze,Z[3]=(ce*se*ne-oe*de*ne-ce*te*ae+K*de*ae+oe*te*Ie-K*se*Ie)*Ze,Z[4]=Be*Ze,Z[5]=(ge*Ae*ne-fe*de*ne+fe*te*Ie-_*Ae*Ie-ge*te*ye+_*de*ye)*Ze,Z[6]=(fe*se*ne-ie*Ae*ne-fe*te*ae+_*Ae*ae+ie*te*ye-_*se*ye)*Ze,Z[7]=(ie*de*ne-ge*se*ne+ge*te*ae-_*de*ae-ie*te*Ie+_*se*Ie)*Ze,Z[8]=Re*Ze,Z[9]=(fe*ce*ne-ge*be*ne-fe*K*Ie+_*be*Ie+ge*K*ye-_*ce*ye)*Ze,Z[10]=(ie*be*ne-fe*oe*ne+fe*K*ae-_*be*ae-ie*K*ye+_*oe*ye)*Ze,Z[11]=(ge*oe*ne-ie*ce*ne-ge*K*ae+_*ce*ae+ie*K*Ie-_*oe*Ie)*Ze,Z[12]=Ve*Ze,Z[13]=(ge*be*te-fe*ce*te+fe*K*de-_*be*de-ge*K*Ae+_*ce*Ae)*Ze,Z[14]=(fe*oe*te-ie*be*te-fe*K*se+_*be*se+ie*K*Ae-_*oe*Ae)*Ze,Z[15]=(ie*ce*te-ge*oe*te+ge*K*se-_*ce*se-ie*K*de+_*oe*de)*Ze,this}scale(Z){const _=this.elements,K=Z.x,te=Z.y,ne=Z.z;return _[0]*=K,_[4]*=te,_[8]*=ne,_[1]*=K,_[5]*=te,_[9]*=ne,_[2]*=K,_[6]*=te,_[10]*=ne,_[3]*=K,_[7]*=te,_[11]*=ne,this}getMaxScaleOnAxis(){const Z=this.elements,_=Z[0]*Z[0]+Z[1]*Z[1]+Z[2]*Z[2],K=Z[4]*Z[4]+Z[5]*Z[5]+Z[6]*Z[6],te=Z[8]*Z[8]+Z[9]*Z[9]+Z[10]*Z[10];return Math.sqrt(Math.max(_,K,te))}makeTranslation(Z,_,K){return Z.isVector3?this.set(1,0,0,Z.x,0,1,0,Z.y,0,0,1,Z.z,0,0,0,1):this.set(1,0,0,Z,0,1,0,_,0,0,1,K,0,0,0,1),this}makeRotationX(Z){const _=Math.cos(Z),K=Math.sin(Z);return this.set(1,0,0,0,0,_,-K,0,0,K,_,0,0,0,0,1),this}makeRotationY(Z){const _=Math.cos(Z),K=Math.sin(Z);return this.set(_,0,K,0,0,1,0,0,-K,0,_,0,0,0,0,1),this}makeRotationZ(Z){const _=Math.cos(Z),K=Math.sin(Z);return this.set(_,-K,0,0,K,_,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(Z,_){const K=Math.cos(_),te=Math.sin(_),ne=1-K,ie=Z.x,oe=Z.y,se=Z.z,ae=ne*ie,ge=ne*oe;return this.set(ae*ie+K,ae*oe-te*se,ae*se+te*oe,0,ae*oe+te*se,ge*oe+K,ge*se-te*ie,0,ae*se-te*oe,ge*se+te*ie,ne*se*se+K,0,0,0,0,1),this}makeScale(Z,_,K){return this.set(Z,0,0,0,0,_,0,0,0,0,K,0,0,0,0,1),this}makeShear(Z,_,K,te,ne,ie){return this.set(1,K,ne,0,Z,1,ie,0,_,te,1,0,0,0,0,1),this}compose(Z,_,K){const te=this.elements,ne=_._x,ie=_._y,oe=_._z,se=_._w,ae=ne+ne,ge=ie+ie,ce=oe+oe,de=ne*ae,Ie=ne*ge,fe=ne*ce,be=ie*ge,Ae=ie*ce,ye=oe*ce,ve=se*ae,Be=se*ge,Re=se*ce,Ve=K.x,Ee=K.y,Ze=K.z;return te[0]=(1-(be+ye))*Ve,te[1]=(Ie+Re)*Ve,te[2]=(fe-Be)*Ve,te[3]=0,te[4]=(Ie-Re)*Ee,te[5]=(1-(de+ye))*Ee,te[6]=(Ae+ve)*Ee,te[7]=0,te[8]=(fe+Be)*Ze,te[9]=(Ae-ve)*Ze,te[10]=(1-(de+be))*Ze,te[11]=0,te[12]=Z.x,te[13]=Z.y,te[14]=Z.z,te[15]=1,this}decompose(Z,_,K){const te=this.elements;let ne=_v1$5.set(te[0],te[1],te[2]).length();const ie=_v1$5.set(te[4],te[5],te[6]).length(),oe=_v1$5.set(te[8],te[9],te[10]).length();this.determinant()<0&&(ne=-ne),Z.x=te[12],Z.y=te[13],Z.z=te[14],_m1$2.copy(this);const ae=1/ne,ge=1/ie,ce=1/oe;return _m1$2.elements[0]*=ae,_m1$2.elements[1]*=ae,_m1$2.elements[2]*=ae,_m1$2.elements[4]*=ge,_m1$2.elements[5]*=ge,_m1$2.elements[6]*=ge,_m1$2.elements[8]*=ce,_m1$2.elements[9]*=ce,_m1$2.elements[10]*=ce,_.setFromRotationMatrix(_m1$2),K.x=ne,K.y=ie,K.z=oe,this}makePerspective(Z,_,K,te,ne,ie,oe=WebGLCoordinateSystem){const se=this.elements,ae=2*ne/(_-Z),ge=2*ne/(K-te),ce=(_+Z)/(_-Z),de=(K+te)/(K-te);let Ie,fe;if(oe===WebGLCoordinateSystem)Ie=-(ie+ne)/(ie-ne),fe=-2*ie*ne/(ie-ne);else if(oe===WebGPUCoordinateSystem)Ie=-ie/(ie-ne),fe=-ie*ne/(ie-ne);else throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+oe);return se[0]=ae,se[4]=0,se[8]=ce,se[12]=0,se[1]=0,se[5]=ge,se[9]=de,se[13]=0,se[2]=0,se[6]=0,se[10]=Ie,se[14]=fe,se[3]=0,se[7]=0,se[11]=-1,se[15]=0,this}makeOrthographic(Z,_,K,te,ne,ie,oe=WebGLCoordinateSystem){const se=this.elements,ae=1/(_-Z),ge=1/(K-te),ce=1/(ie-ne),de=(_+Z)*ae,Ie=(K+te)*ge;let fe,be;if(oe===WebGLCoordinateSystem)fe=(ie+ne)*ce,be=-2*ce;else if(oe===WebGPUCoordinateSystem)fe=ne*ce,be=-1*ce;else throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+oe);return se[0]=2*ae,se[4]=0,se[8]=0,se[12]=-de,se[1]=0,se[5]=2*ge,se[9]=0,se[13]=-Ie,se[2]=0,se[6]=0,se[10]=be,se[14]=-fe,se[3]=0,se[7]=0,se[11]=0,se[15]=1,this}equals(Z){const _=this.elements,K=Z.elements;for(let te=0;te<16;te++)if(_[te]!==K[te])return!1;return!0}fromArray(Z,_=0){for(let K=0;K<16;K++)this.elements[K]=Z[K+_];return this}toArray(Z=[],_=0){const K=this.elements;return Z[_]=K[0],Z[_+1]=K[1],Z[_+2]=K[2],Z[_+3]=K[3],Z[_+4]=K[4],Z[_+5]=K[5],Z[_+6]=K[6],Z[_+7]=K[7],Z[_+8]=K[8],Z[_+9]=K[9],Z[_+10]=K[10],Z[_+11]=K[11],Z[_+12]=K[12],Z[_+13]=K[13],Z[_+14]=K[14],Z[_+15]=K[15],Z}}const _v1$5=new Vector3,_m1$2=new Matrix4,_zero=new Vector3(0,0,0),_one=new Vector3(1,1,1),_x=new Vector3,_y=new Vector3,_z=new Vector3,_matrix$2=new Matrix4,_quaternion$3=new Quaternion$2;class Euler{constructor(Z=0,_=0,K=0,te=Euler.DEFAULT_ORDER){this.isEuler=!0,this._x=Z,this._y=_,this._z=K,this._order=te}get x(){return this._x}set x(Z){this._x=Z,this._onChangeCallback()}get y(){return this._y}set y(Z){this._y=Z,this._onChangeCallback()}get z(){return this._z}set z(Z){this._z=Z,this._onChangeCallback()}get order(){return this._order}set order(Z){this._order=Z,this._onChangeCallback()}set(Z,_,K,te=this._order){return this._x=Z,this._y=_,this._z=K,this._order=te,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(Z){return this._x=Z._x,this._y=Z._y,this._z=Z._z,this._order=Z._order,this._onChangeCallback(),this}setFromRotationMatrix(Z,_=this._order,K=!0){const te=Z.elements,ne=te[0],ie=te[4],oe=te[8],se=te[1],ae=te[5],ge=te[9],ce=te[2],de=te[6],Ie=te[10];switch(_){case"XYZ":this._y=Math.asin(clamp$3(oe,-1,1)),Math.abs(oe)<.9999999?(this._x=Math.atan2(-ge,Ie),this._z=Math.atan2(-ie,ne)):(this._x=Math.atan2(de,ae),this._z=0);break;case"YXZ":this._x=Math.asin(-clamp$3(ge,-1,1)),Math.abs(ge)<.9999999?(this._y=Math.atan2(oe,Ie),this._z=Math.atan2(se,ae)):(this._y=Math.atan2(-ce,ne),this._z=0);break;case"ZXY":this._x=Math.asin(clamp$3(de,-1,1)),Math.abs(de)<.9999999?(this._y=Math.atan2(-ce,Ie),this._z=Math.atan2(-ie,ae)):(this._y=0,this._z=Math.atan2(se,ne));break;case"ZYX":this._y=Math.asin(-clamp$3(ce,-1,1)),Math.abs(ce)<.9999999?(this._x=Math.atan2(de,Ie),this._z=Math.atan2(se,ne)):(this._x=0,this._z=Math.atan2(-ie,ae));break;case"YZX":this._z=Math.asin(clamp$3(se,-1,1)),Math.abs(se)<.9999999?(this._x=Math.atan2(-ge,ae),this._y=Math.atan2(-ce,ne)):(this._x=0,this._y=Math.atan2(oe,Ie));break;case"XZY":this._z=Math.asin(-clamp$3(ie,-1,1)),Math.abs(ie)<.9999999?(this._x=Math.atan2(de,ae),this._y=Math.atan2(oe,ne)):(this._x=Math.atan2(-ge,Ie),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+_)}return this._order=_,K===!0&&this._onChangeCallback(),this}setFromQuaternion(Z,_,K){return _matrix$2.makeRotationFromQuaternion(Z),this.setFromRotationMatrix(_matrix$2,_,K)}setFromVector3(Z,_=this._order){return this.set(Z.x,Z.y,Z.z,_)}reorder(Z){return _quaternion$3.setFromEuler(this),this.setFromQuaternion(_quaternion$3,Z)}equals(Z){return Z._x===this._x&&Z._y===this._y&&Z._z===this._z&&Z._order===this._order}fromArray(Z){return this._x=Z[0],this._y=Z[1],this._z=Z[2],Z[3]!==void 0&&(this._order=Z[3]),this._onChangeCallback(),this}toArray(Z=[],_=0){return Z[_]=this._x,Z[_+1]=this._y,Z[_+2]=this._z,Z[_+3]=this._order,Z}_onChange(Z){return this._onChangeCallback=Z,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}Euler.DEFAULT_ORDER="XYZ";class Layers{constructor(){this.mask=1}set(Z){this.mask=(1<<Z|0)>>>0}enable(Z){this.mask|=1<<Z|0}enableAll(){this.mask=-1}toggle(Z){this.mask^=1<<Z|0}disable(Z){this.mask&=~(1<<Z|0)}disableAll(){this.mask=0}test(Z){return(this.mask&Z.mask)!==0}isEnabled(Z){return(this.mask&(1<<Z|0))!==0}}let _object3DId=0;const _v1$4=new Vector3,_q1=new Quaternion$2,_m1$1$1=new Matrix4,_target=new Vector3,_position$3=new Vector3,_scale$2=new Vector3,_quaternion$2=new Quaternion$2,_xAxis=new Vector3(1,0,0),_yAxis=new Vector3(0,1,0),_zAxis=new Vector3(0,0,1),_addedEvent={type:"added"},_removedEvent={type:"removed"},_childaddedEvent={type:"childadded",child:null},_childremovedEvent={type:"childremoved",child:null};class Object3D extends EventDispatcher{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:_object3DId++}),this.uuid=generateUUID$1(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Object3D.DEFAULT_UP.clone();const Z=new Vector3,_=new Euler,K=new Quaternion$2,te=new Vector3(1,1,1);function ne(){K.setFromEuler(_,!1)}function ie(){_.setFromQuaternion(K,void 0,!1)}_._onChange(ne),K._onChange(ie),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:Z},rotation:{configurable:!0,enumerable:!0,value:_},quaternion:{configurable:!0,enumerable:!0,value:K},scale:{configurable:!0,enumerable:!0,value:te},modelViewMatrix:{value:new Matrix4},normalMatrix:{value:new Matrix3}}),this.matrix=new Matrix4,this.matrixWorld=new Matrix4,this.matrixAutoUpdate=Object3D.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldAutoUpdate=Object3D.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.layers=new Layers,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeShadow(){}onAfterShadow(){}onBeforeRender(){}onAfterRender(){}applyMatrix4(Z){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(Z),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(Z){return this.quaternion.premultiply(Z),this}setRotationFromAxisAngle(Z,_){this.quaternion.setFromAxisAngle(Z,_)}setRotationFromEuler(Z){this.quaternion.setFromEuler(Z,!0)}setRotationFromMatrix(Z){this.quaternion.setFromRotationMatrix(Z)}setRotationFromQuaternion(Z){this.quaternion.copy(Z)}rotateOnAxis(Z,_){return _q1.setFromAxisAngle(Z,_),this.quaternion.multiply(_q1),this}rotateOnWorldAxis(Z,_){return _q1.setFromAxisAngle(Z,_),this.quaternion.premultiply(_q1),this}rotateX(Z){return this.rotateOnAxis(_xAxis,Z)}rotateY(Z){return this.rotateOnAxis(_yAxis,Z)}rotateZ(Z){return this.rotateOnAxis(_zAxis,Z)}translateOnAxis(Z,_){return _v1$4.copy(Z).applyQuaternion(this.quaternion),this.position.add(_v1$4.multiplyScalar(_)),this}translateX(Z){return this.translateOnAxis(_xAxis,Z)}translateY(Z){return this.translateOnAxis(_yAxis,Z)}translateZ(Z){return this.translateOnAxis(_zAxis,Z)}localToWorld(Z){return this.updateWorldMatrix(!0,!1),Z.applyMatrix4(this.matrixWorld)}worldToLocal(Z){return this.updateWorldMatrix(!0,!1),Z.applyMatrix4(_m1$1$1.copy(this.matrixWorld).invert())}lookAt(Z,_,K){Z.isVector3?_target.copy(Z):_target.set(Z,_,K);const te=this.parent;this.updateWorldMatrix(!0,!1),_position$3.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?_m1$1$1.lookAt(_position$3,_target,this.up):_m1$1$1.lookAt(_target,_position$3,this.up),this.quaternion.setFromRotationMatrix(_m1$1$1),te&&(_m1$1$1.extractRotation(te.matrixWorld),_q1.setFromRotationMatrix(_m1$1$1),this.quaternion.premultiply(_q1.invert()))}add(Z){if(arguments.length>1){for(let _=0;_<arguments.length;_++)this.add(arguments[_]);return this}return Z===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",Z),this):(Z&&Z.isObject3D?(Z.removeFromParent(),Z.parent=this,this.children.push(Z),Z.dispatchEvent(_addedEvent),_childaddedEvent.child=Z,this.dispatchEvent(_childaddedEvent),_childaddedEvent.child=null):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",Z),this)}remove(Z){if(arguments.length>1){for(let K=0;K<arguments.length;K++)this.remove(arguments[K]);return this}const _=this.children.indexOf(Z);return _!==-1&&(Z.parent=null,this.children.splice(_,1),Z.dispatchEvent(_removedEvent),_childremovedEvent.child=Z,this.dispatchEvent(_childremovedEvent),_childremovedEvent.child=null),this}removeFromParent(){const Z=this.parent;return Z!==null&&Z.remove(this),this}clear(){return this.remove(...this.children)}attach(Z){return this.updateWorldMatrix(!0,!1),_m1$1$1.copy(this.matrixWorld).invert(),Z.parent!==null&&(Z.parent.updateWorldMatrix(!0,!1),_m1$1$1.multiply(Z.parent.matrixWorld)),Z.applyMatrix4(_m1$1$1),Z.removeFromParent(),Z.parent=this,this.children.push(Z),Z.updateWorldMatrix(!1,!0),Z.dispatchEvent(_addedEvent),_childaddedEvent.child=Z,this.dispatchEvent(_childaddedEvent),_childaddedEvent.child=null,this}getObjectById(Z){return this.getObjectByProperty("id",Z)}getObjectByName(Z){return this.getObjectByProperty("name",Z)}getObjectByProperty(Z,_){if(this[Z]===_)return this;for(let K=0,te=this.children.length;K<te;K++){const ie=this.children[K].getObjectByProperty(Z,_);if(ie!==void 0)return ie}}getObjectsByProperty(Z,_,K=[]){this[Z]===_&&K.push(this);const te=this.children;for(let ne=0,ie=te.length;ne<ie;ne++)te[ne].getObjectsByProperty(Z,_,K);return K}getWorldPosition(Z){return this.updateWorldMatrix(!0,!1),Z.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(Z){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(_position$3,Z,_scale$2),Z}getWorldScale(Z){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(_position$3,_quaternion$2,Z),Z}getWorldDirection(Z){this.updateWorldMatrix(!0,!1);const _=this.matrixWorld.elements;return Z.set(_[8],_[9],_[10]).normalize()}raycast(){}traverse(Z){Z(this);const _=this.children;for(let K=0,te=_.length;K<te;K++)_[K].traverse(Z)}traverseVisible(Z){if(this.visible===!1)return;Z(this);const _=this.children;for(let K=0,te=_.length;K<te;K++)_[K].traverseVisible(Z)}traverseAncestors(Z){const _=this.parent;_!==null&&(Z(_),_.traverseAncestors(Z))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(Z){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||Z)&&(this.matrixWorldAutoUpdate===!0&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),this.matrixWorldNeedsUpdate=!1,Z=!0);const _=this.children;for(let K=0,te=_.length;K<te;K++)_[K].updateMatrixWorld(Z)}updateWorldMatrix(Z,_){const K=this.parent;if(Z===!0&&K!==null&&K.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.matrixWorldAutoUpdate===!0&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),_===!0){const te=this.children;for(let ne=0,ie=te.length;ne<ie;ne++)te[ne].updateWorldMatrix(!1,!0)}}toJSON(Z){const _=Z===void 0||typeof Z=="string",K={};_&&(Z={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},K.metadata={version:4.6,type:"Object",generator:"Object3D.toJSON"});const te={};te.uuid=this.uuid,te.type=this.type,this.name!==""&&(te.name=this.name),this.castShadow===!0&&(te.castShadow=!0),this.receiveShadow===!0&&(te.receiveShadow=!0),this.visible===!1&&(te.visible=!1),this.frustumCulled===!1&&(te.frustumCulled=!1),this.renderOrder!==0&&(te.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(te.userData=this.userData),te.layers=this.layers.mask,te.matrix=this.matrix.toArray(),te.up=this.up.toArray(),this.matrixAutoUpdate===!1&&(te.matrixAutoUpdate=!1),this.isInstancedMesh&&(te.type="InstancedMesh",te.count=this.count,te.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(te.instanceColor=this.instanceColor.toJSON())),this.isBatchedMesh&&(te.type="BatchedMesh",te.perObjectFrustumCulled=this.perObjectFrustumCulled,te.sortObjects=this.sortObjects,te.drawRanges=this._drawRanges,te.reservedRanges=this._reservedRanges,te.visibility=this._visibility,te.active=this._active,te.bounds=this._bounds.map(oe=>({boxInitialized:oe.boxInitialized,boxMin:oe.box.min.toArray(),boxMax:oe.box.max.toArray(),sphereInitialized:oe.sphereInitialized,sphereRadius:oe.sphere.radius,sphereCenter:oe.sphere.center.toArray()})),te.maxInstanceCount=this._maxInstanceCount,te.maxVertexCount=this._maxVertexCount,te.maxIndexCount=this._maxIndexCount,te.geometryInitialized=this._geometryInitialized,te.geometryCount=this._geometryCount,te.matricesTexture=this._matricesTexture.toJSON(Z),this._colorsTexture!==null&&(te.colorsTexture=this._colorsTexture.toJSON(Z)),this.boundingSphere!==null&&(te.boundingSphere={center:te.boundingSphere.center.toArray(),radius:te.boundingSphere.radius}),this.boundingBox!==null&&(te.boundingBox={min:te.boundingBox.min.toArray(),max:te.boundingBox.max.toArray()}));function ne(oe,se){return oe[se.uuid]===void 0&&(oe[se.uuid]=se.toJSON(Z)),se.uuid}if(this.isScene)this.background&&(this.background.isColor?te.background=this.background.toJSON():this.background.isTexture&&(te.background=this.background.toJSON(Z).uuid)),this.environment&&this.environment.isTexture&&this.environment.isRenderTargetTexture!==!0&&(te.environment=this.environment.toJSON(Z).uuid);else if(this.isMesh||this.isLine||this.isPoints){te.geometry=ne(Z.geometries,this.geometry);const oe=this.geometry.parameters;if(oe!==void 0&&oe.shapes!==void 0){const se=oe.shapes;if(Array.isArray(se))for(let ae=0,ge=se.length;ae<ge;ae++){const ce=se[ae];ne(Z.shapes,ce)}else ne(Z.shapes,se)}}if(this.isSkinnedMesh&&(te.bindMode=this.bindMode,te.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(ne(Z.skeletons,this.skeleton),te.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){const oe=[];for(let se=0,ae=this.material.length;se<ae;se++)oe.push(ne(Z.materials,this.material[se]));te.material=oe}else te.material=ne(Z.materials,this.material);if(this.children.length>0){te.children=[];for(let oe=0;oe<this.children.length;oe++)te.children.push(this.children[oe].toJSON(Z).object)}if(this.animations.length>0){te.animations=[];for(let oe=0;oe<this.animations.length;oe++){const se=this.animations[oe];te.animations.push(ne(Z.animations,se))}}if(_){const oe=ie(Z.geometries),se=ie(Z.materials),ae=ie(Z.textures),ge=ie(Z.images),ce=ie(Z.shapes),de=ie(Z.skeletons),Ie=ie(Z.animations),fe=ie(Z.nodes);oe.length>0&&(K.geometries=oe),se.length>0&&(K.materials=se),ae.length>0&&(K.textures=ae),ge.length>0&&(K.images=ge),ce.length>0&&(K.shapes=ce),de.length>0&&(K.skeletons=de),Ie.length>0&&(K.animations=Ie),fe.length>0&&(K.nodes=fe)}return K.object=te,K;function ie(oe){const se=[];for(const ae in oe){const ge=oe[ae];delete ge.metadata,se.push(ge)}return se}}clone(Z){return new this.constructor().copy(this,Z)}copy(Z,_=!0){if(this.name=Z.name,this.up.copy(Z.up),this.position.copy(Z.position),this.rotation.order=Z.rotation.order,this.quaternion.copy(Z.quaternion),this.scale.copy(Z.scale),this.matrix.copy(Z.matrix),this.matrixWorld.copy(Z.matrixWorld),this.matrixAutoUpdate=Z.matrixAutoUpdate,this.matrixWorldAutoUpdate=Z.matrixWorldAutoUpdate,this.matrixWorldNeedsUpdate=Z.matrixWorldNeedsUpdate,this.layers.mask=Z.layers.mask,this.visible=Z.visible,this.castShadow=Z.castShadow,this.receiveShadow=Z.receiveShadow,this.frustumCulled=Z.frustumCulled,this.renderOrder=Z.renderOrder,this.animations=Z.animations.slice(),this.userData=JSON.parse(JSON.stringify(Z.userData)),_===!0)for(let K=0;K<Z.children.length;K++){const te=Z.children[K];this.add(te.clone())}return this}}Object3D.DEFAULT_UP=new Vector3(0,1,0);Object3D.DEFAULT_MATRIX_AUTO_UPDATE=!0;Object3D.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;const _v0$1=new Vector3,_v1$3=new Vector3,_v2$2=new Vector3,_v3$2=new Vector3,_vab=new Vector3,_vac=new Vector3,_vbc=new Vector3,_vap=new Vector3,_vbp=new Vector3,_vcp=new Vector3,_v40=new Vector4,_v41=new Vector4,_v42=new Vector4;class Triangle{constructor(Z=new Vector3,_=new Vector3,K=new Vector3){this.a=Z,this.b=_,this.c=K}static getNormal(Z,_,K,te){te.subVectors(K,_),_v0$1.subVectors(Z,_),te.cross(_v0$1);const ne=te.lengthSq();return ne>0?te.multiplyScalar(1/Math.sqrt(ne)):te.set(0,0,0)}static getBarycoord(Z,_,K,te,ne){_v0$1.subVectors(te,_),_v1$3.subVectors(K,_),_v2$2.subVectors(Z,_);const ie=_v0$1.dot(_v0$1),oe=_v0$1.dot(_v1$3),se=_v0$1.dot(_v2$2),ae=_v1$3.dot(_v1$3),ge=_v1$3.dot(_v2$2),ce=ie*ae-oe*oe;if(ce===0)return ne.set(0,0,0),null;const de=1/ce,Ie=(ae*se-oe*ge)*de,fe=(ie*ge-oe*se)*de;return ne.set(1-Ie-fe,fe,Ie)}static containsPoint(Z,_,K,te){return this.getBarycoord(Z,_,K,te,_v3$2)===null?!1:_v3$2.x>=0&&_v3$2.y>=0&&_v3$2.x+_v3$2.y<=1}static getInterpolation(Z,_,K,te,ne,ie,oe,se){return this.getBarycoord(Z,_,K,te,_v3$2)===null?(se.x=0,se.y=0,"z"in se&&(se.z=0),"w"in se&&(se.w=0),null):(se.setScalar(0),se.addScaledVector(ne,_v3$2.x),se.addScaledVector(ie,_v3$2.y),se.addScaledVector(oe,_v3$2.z),se)}static getInterpolatedAttribute(Z,_,K,te,ne,ie){return _v40.setScalar(0),_v41.setScalar(0),_v42.setScalar(0),_v40.fromBufferAttribute(Z,_),_v41.fromBufferAttribute(Z,K),_v42.fromBufferAttribute(Z,te),ie.setScalar(0),ie.addScaledVector(_v40,ne.x),ie.addScaledVector(_v41,ne.y),ie.addScaledVector(_v42,ne.z),ie}static isFrontFacing(Z,_,K,te){return _v0$1.subVectors(K,_),_v1$3.subVectors(Z,_),_v0$1.cross(_v1$3).dot(te)<0}set(Z,_,K){return this.a.copy(Z),this.b.copy(_),this.c.copy(K),this}setFromPointsAndIndices(Z,_,K,te){return this.a.copy(Z[_]),this.b.copy(Z[K]),this.c.copy(Z[te]),this}setFromAttributeAndIndices(Z,_,K,te){return this.a.fromBufferAttribute(Z,_),this.b.fromBufferAttribute(Z,K),this.c.fromBufferAttribute(Z,te),this}clone(){return new this.constructor().copy(this)}copy(Z){return this.a.copy(Z.a),this.b.copy(Z.b),this.c.copy(Z.c),this}getArea(){return _v0$1.subVectors(this.c,this.b),_v1$3.subVectors(this.a,this.b),_v0$1.cross(_v1$3).length()*.5}getMidpoint(Z){return Z.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(Z){return Triangle.getNormal(this.a,this.b,this.c,Z)}getPlane(Z){return Z.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(Z,_){return Triangle.getBarycoord(Z,this.a,this.b,this.c,_)}getInterpolation(Z,_,K,te,ne){return Triangle.getInterpolation(Z,this.a,this.b,this.c,_,K,te,ne)}containsPoint(Z){return Triangle.containsPoint(Z,this.a,this.b,this.c)}isFrontFacing(Z){return Triangle.isFrontFacing(this.a,this.b,this.c,Z)}intersectsBox(Z){return Z.intersectsTriangle(this)}closestPointToPoint(Z,_){const K=this.a,te=this.b,ne=this.c;let ie,oe;_vab.subVectors(te,K),_vac.subVectors(ne,K),_vap.subVectors(Z,K);const se=_vab.dot(_vap),ae=_vac.dot(_vap);if(se<=0&&ae<=0)return _.copy(K);_vbp.subVectors(Z,te);const ge=_vab.dot(_vbp),ce=_vac.dot(_vbp);if(ge>=0&&ce<=ge)return _.copy(te);const de=se*ce-ge*ae;if(de<=0&&se>=0&&ge<=0)return ie=se/(se-ge),_.copy(K).addScaledVector(_vab,ie);_vcp.subVectors(Z,ne);const Ie=_vab.dot(_vcp),fe=_vac.dot(_vcp);if(fe>=0&&Ie<=fe)return _.copy(ne);const be=Ie*ae-se*fe;if(be<=0&&ae>=0&&fe<=0)return oe=ae/(ae-fe),_.copy(K).addScaledVector(_vac,oe);const Ae=ge*fe-Ie*ce;if(Ae<=0&&ce-ge>=0&&Ie-fe>=0)return _vbc.subVectors(ne,te),oe=(ce-ge)/(ce-ge+(Ie-fe)),_.copy(te).addScaledVector(_vbc,oe);const ye=1/(Ae+be+de);return ie=be*ye,oe=de*ye,_.copy(K).addScaledVector(_vab,ie).addScaledVector(_vac,oe)}equals(Z){return Z.a.equals(this.a)&&Z.b.equals(this.b)&&Z.c.equals(this.c)}}const _colorKeywords={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},_hslA={h:0,s:0,l:0},_hslB={h:0,s:0,l:0};function hue2rgb$1(X,Z,_){return _<0&&(_+=1),_>1&&(_-=1),_<1/6?X+(Z-X)*6*_:_<1/2?Z:_<2/3?X+(Z-X)*6*(2/3-_):X}let Color$1=class{constructor(Z,_,K){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(Z,_,K)}set(Z,_,K){if(_===void 0&&K===void 0){const te=Z;te&&te.isColor?this.copy(te):typeof te=="number"?this.setHex(te):typeof te=="string"&&this.setStyle(te)}else this.setRGB(Z,_,K);return this}setScalar(Z){return this.r=Z,this.g=Z,this.b=Z,this}setHex(Z,_=SRGBColorSpace$1){return Z=Math.floor(Z),this.r=(Z>>16&255)/255,this.g=(Z>>8&255)/255,this.b=(Z&255)/255,ColorManagement.toWorkingColorSpace(this,_),this}setRGB(Z,_,K,te=ColorManagement.workingColorSpace){return this.r=Z,this.g=_,this.b=K,ColorManagement.toWorkingColorSpace(this,te),this}setHSL(Z,_,K,te=ColorManagement.workingColorSpace){if(Z=euclideanModulo(Z,1),_=clamp$3(_,0,1),K=clamp$3(K,0,1),_===0)this.r=this.g=this.b=K;else{const ne=K<=.5?K*(1+_):K+_-K*_,ie=2*K-ne;this.r=hue2rgb$1(ie,ne,Z+1/3),this.g=hue2rgb$1(ie,ne,Z),this.b=hue2rgb$1(ie,ne,Z-1/3)}return ColorManagement.toWorkingColorSpace(this,te),this}setStyle(Z,_=SRGBColorSpace$1){function K(ne){ne!==void 0&&parseFloat(ne)<1&&console.warn("THREE.Color: Alpha component of "+Z+" will be ignored.")}let te;if(te=/^(\w+)\(([^\)]*)\)/.exec(Z)){let ne;const ie=te[1],oe=te[2];switch(ie){case"rgb":case"rgba":if(ne=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(oe))return K(ne[4]),this.setRGB(Math.min(255,parseInt(ne[1],10))/255,Math.min(255,parseInt(ne[2],10))/255,Math.min(255,parseInt(ne[3],10))/255,_);if(ne=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(oe))return K(ne[4]),this.setRGB(Math.min(100,parseInt(ne[1],10))/100,Math.min(100,parseInt(ne[2],10))/100,Math.min(100,parseInt(ne[3],10))/100,_);break;case"hsl":case"hsla":if(ne=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(oe))return K(ne[4]),this.setHSL(parseFloat(ne[1])/360,parseFloat(ne[2])/100,parseFloat(ne[3])/100,_);break;default:console.warn("THREE.Color: Unknown color model "+Z)}}else if(te=/^\#([A-Fa-f\d]+)$/.exec(Z)){const ne=te[1],ie=ne.length;if(ie===3)return this.setRGB(parseInt(ne.charAt(0),16)/15,parseInt(ne.charAt(1),16)/15,parseInt(ne.charAt(2),16)/15,_);if(ie===6)return this.setHex(parseInt(ne,16),_);console.warn("THREE.Color: Invalid hex color "+Z)}else if(Z&&Z.length>0)return this.setColorName(Z,_);return this}setColorName(Z,_=SRGBColorSpace$1){const K=_colorKeywords[Z.toLowerCase()];return K!==void 0?this.setHex(K,_):console.warn("THREE.Color: Unknown color "+Z),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(Z){return this.r=Z.r,this.g=Z.g,this.b=Z.b,this}copySRGBToLinear(Z){return this.r=SRGBToLinear(Z.r),this.g=SRGBToLinear(Z.g),this.b=SRGBToLinear(Z.b),this}copyLinearToSRGB(Z){return this.r=LinearToSRGB(Z.r),this.g=LinearToSRGB(Z.g),this.b=LinearToSRGB(Z.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(Z=SRGBColorSpace$1){return ColorManagement.fromWorkingColorSpace(_color.copy(this),Z),Math.round(clamp$3(_color.r*255,0,255))*65536+Math.round(clamp$3(_color.g*255,0,255))*256+Math.round(clamp$3(_color.b*255,0,255))}getHexString(Z=SRGBColorSpace$1){return("000000"+this.getHex(Z).toString(16)).slice(-6)}getHSL(Z,_=ColorManagement.workingColorSpace){ColorManagement.fromWorkingColorSpace(_color.copy(this),_);const K=_color.r,te=_color.g,ne=_color.b,ie=Math.max(K,te,ne),oe=Math.min(K,te,ne);let se,ae;const ge=(oe+ie)/2;if(oe===ie)se=0,ae=0;else{const ce=ie-oe;switch(ae=ge<=.5?ce/(ie+oe):ce/(2-ie-oe),ie){case K:se=(te-ne)/ce+(te<ne?6:0);break;case te:se=(ne-K)/ce+2;break;case ne:se=(K-te)/ce+4;break}se/=6}return Z.h=se,Z.s=ae,Z.l=ge,Z}getRGB(Z,_=ColorManagement.workingColorSpace){return ColorManagement.fromWorkingColorSpace(_color.copy(this),_),Z.r=_color.r,Z.g=_color.g,Z.b=_color.b,Z}getStyle(Z=SRGBColorSpace$1){ColorManagement.fromWorkingColorSpace(_color.copy(this),Z);const _=_color.r,K=_color.g,te=_color.b;return Z!==SRGBColorSpace$1?`color(${Z} ${_.toFixed(3)} ${K.toFixed(3)} ${te.toFixed(3)})`:`rgb(${Math.round(_*255)},${Math.round(K*255)},${Math.round(te*255)})`}offsetHSL(Z,_,K){return this.getHSL(_hslA),this.setHSL(_hslA.h+Z,_hslA.s+_,_hslA.l+K)}add(Z){return this.r+=Z.r,this.g+=Z.g,this.b+=Z.b,this}addColors(Z,_){return this.r=Z.r+_.r,this.g=Z.g+_.g,this.b=Z.b+_.b,this}addScalar(Z){return this.r+=Z,this.g+=Z,this.b+=Z,this}sub(Z){return this.r=Math.max(0,this.r-Z.r),this.g=Math.max(0,this.g-Z.g),this.b=Math.max(0,this.b-Z.b),this}multiply(Z){return this.r*=Z.r,this.g*=Z.g,this.b*=Z.b,this}multiplyScalar(Z){return this.r*=Z,this.g*=Z,this.b*=Z,this}lerp(Z,_){return this.r+=(Z.r-this.r)*_,this.g+=(Z.g-this.g)*_,this.b+=(Z.b-this.b)*_,this}lerpColors(Z,_,K){return this.r=Z.r+(_.r-Z.r)*K,this.g=Z.g+(_.g-Z.g)*K,this.b=Z.b+(_.b-Z.b)*K,this}lerpHSL(Z,_){this.getHSL(_hslA),Z.getHSL(_hslB);const K=lerp(_hslA.h,_hslB.h,_),te=lerp(_hslA.s,_hslB.s,_),ne=lerp(_hslA.l,_hslB.l,_);return this.setHSL(K,te,ne),this}setFromVector3(Z){return this.r=Z.x,this.g=Z.y,this.b=Z.z,this}applyMatrix3(Z){const _=this.r,K=this.g,te=this.b,ne=Z.elements;return this.r=ne[0]*_+ne[3]*K+ne[6]*te,this.g=ne[1]*_+ne[4]*K+ne[7]*te,this.b=ne[2]*_+ne[5]*K+ne[8]*te,this}equals(Z){return Z.r===this.r&&Z.g===this.g&&Z.b===this.b}fromArray(Z,_=0){return this.r=Z[_],this.g=Z[_+1],this.b=Z[_+2],this}toArray(Z=[],_=0){return Z[_]=this.r,Z[_+1]=this.g,Z[_+2]=this.b,Z}fromBufferAttribute(Z,_){return this.r=Z.getX(_),this.g=Z.getY(_),this.b=Z.getZ(_),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}};const _color=new Color$1;Color$1.NAMES=_colorKeywords;let _materialId=0;class Material extends EventDispatcher{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:_materialId++}),this.uuid=generateUUID$1(),this.name="",this.type="Material",this.blending=NormalBlending,this.side=FrontSide,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.alphaHash=!1,this.blendSrc=SrcAlphaFactor,this.blendDst=OneMinusSrcAlphaFactor,this.blendEquation=AddEquation,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.blendColor=new Color$1(0,0,0),this.blendAlpha=0,this.depthFunc=LessEqualDepth,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=AlwaysStencilFunc,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=KeepStencilOp,this.stencilZFail=KeepStencilOp,this.stencilZPass=KeepStencilOp,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(Z){this._alphaTest>0!=Z>0&&this.version++,this._alphaTest=Z}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(Z){if(Z!==void 0)for(const _ in Z){const K=Z[_];if(K===void 0){console.warn(`THREE.Material: parameter '${_}' has value of undefined.`);continue}const te=this[_];if(te===void 0){console.warn(`THREE.Material: '${_}' is not a property of THREE.${this.type}.`);continue}te&&te.isColor?te.set(K):te&&te.isVector3&&K&&K.isVector3?te.copy(K):this[_]=K}}toJSON(Z){const _=Z===void 0||typeof Z=="string";_&&(Z={textures:{},images:{}});const K={metadata:{version:4.6,type:"Material",generator:"Material.toJSON"}};K.uuid=this.uuid,K.type=this.type,this.name!==""&&(K.name=this.name),this.color&&this.color.isColor&&(K.color=this.color.getHex()),this.roughness!==void 0&&(K.roughness=this.roughness),this.metalness!==void 0&&(K.metalness=this.metalness),this.sheen!==void 0&&(K.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(K.sheenColor=this.sheenColor.getHex()),this.sheenRoughness!==void 0&&(K.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(K.emissive=this.emissive.getHex()),this.emissiveIntensity!==void 0&&this.emissiveIntensity!==1&&(K.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(K.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(K.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(K.specularColor=this.specularColor.getHex()),this.shininess!==void 0&&(K.shininess=this.shininess),this.clearcoat!==void 0&&(K.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(K.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(K.clearcoatMap=this.clearcoatMap.toJSON(Z).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(K.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(Z).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(K.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(Z).uuid,K.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.dispersion!==void 0&&(K.dispersion=this.dispersion),this.iridescence!==void 0&&(K.iridescence=this.iridescence),this.iridescenceIOR!==void 0&&(K.iridescenceIOR=this.iridescenceIOR),this.iridescenceThicknessRange!==void 0&&(K.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(K.iridescenceMap=this.iridescenceMap.toJSON(Z).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(K.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(Z).uuid),this.anisotropy!==void 0&&(K.anisotropy=this.anisotropy),this.anisotropyRotation!==void 0&&(K.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(K.anisotropyMap=this.anisotropyMap.toJSON(Z).uuid),this.map&&this.map.isTexture&&(K.map=this.map.toJSON(Z).uuid),this.matcap&&this.matcap.isTexture&&(K.matcap=this.matcap.toJSON(Z).uuid),this.alphaMap&&this.alphaMap.isTexture&&(K.alphaMap=this.alphaMap.toJSON(Z).uuid),this.lightMap&&this.lightMap.isTexture&&(K.lightMap=this.lightMap.toJSON(Z).uuid,K.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(K.aoMap=this.aoMap.toJSON(Z).uuid,K.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(K.bumpMap=this.bumpMap.toJSON(Z).uuid,K.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(K.normalMap=this.normalMap.toJSON(Z).uuid,K.normalMapType=this.normalMapType,K.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(K.displacementMap=this.displacementMap.toJSON(Z).uuid,K.displacementScale=this.displacementScale,K.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(K.roughnessMap=this.roughnessMap.toJSON(Z).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(K.metalnessMap=this.metalnessMap.toJSON(Z).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(K.emissiveMap=this.emissiveMap.toJSON(Z).uuid),this.specularMap&&this.specularMap.isTexture&&(K.specularMap=this.specularMap.toJSON(Z).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(K.specularIntensityMap=this.specularIntensityMap.toJSON(Z).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(K.specularColorMap=this.specularColorMap.toJSON(Z).uuid),this.envMap&&this.envMap.isTexture&&(K.envMap=this.envMap.toJSON(Z).uuid,this.combine!==void 0&&(K.combine=this.combine)),this.envMapRotation!==void 0&&(K.envMapRotation=this.envMapRotation.toArray()),this.envMapIntensity!==void 0&&(K.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(K.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(K.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(K.gradientMap=this.gradientMap.toJSON(Z).uuid),this.transmission!==void 0&&(K.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(K.transmissionMap=this.transmissionMap.toJSON(Z).uuid),this.thickness!==void 0&&(K.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(K.thicknessMap=this.thicknessMap.toJSON(Z).uuid),this.attenuationDistance!==void 0&&this.attenuationDistance!==1/0&&(K.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&(K.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&(K.size=this.size),this.shadowSide!==null&&(K.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(K.sizeAttenuation=this.sizeAttenuation),this.blending!==NormalBlending&&(K.blending=this.blending),this.side!==FrontSide&&(K.side=this.side),this.vertexColors===!0&&(K.vertexColors=!0),this.opacity<1&&(K.opacity=this.opacity),this.transparent===!0&&(K.transparent=!0),this.blendSrc!==SrcAlphaFactor&&(K.blendSrc=this.blendSrc),this.blendDst!==OneMinusSrcAlphaFactor&&(K.blendDst=this.blendDst),this.blendEquation!==AddEquation&&(K.blendEquation=this.blendEquation),this.blendSrcAlpha!==null&&(K.blendSrcAlpha=this.blendSrcAlpha),this.blendDstAlpha!==null&&(K.blendDstAlpha=this.blendDstAlpha),this.blendEquationAlpha!==null&&(K.blendEquationAlpha=this.blendEquationAlpha),this.blendColor&&this.blendColor.isColor&&(K.blendColor=this.blendColor.getHex()),this.blendAlpha!==0&&(K.blendAlpha=this.blendAlpha),this.depthFunc!==LessEqualDepth&&(K.depthFunc=this.depthFunc),this.depthTest===!1&&(K.depthTest=this.depthTest),this.depthWrite===!1&&(K.depthWrite=this.depthWrite),this.colorWrite===!1&&(K.colorWrite=this.colorWrite),this.stencilWriteMask!==255&&(K.stencilWriteMask=this.stencilWriteMask),this.stencilFunc!==AlwaysStencilFunc&&(K.stencilFunc=this.stencilFunc),this.stencilRef!==0&&(K.stencilRef=this.stencilRef),this.stencilFuncMask!==255&&(K.stencilFuncMask=this.stencilFuncMask),this.stencilFail!==KeepStencilOp&&(K.stencilFail=this.stencilFail),this.stencilZFail!==KeepStencilOp&&(K.stencilZFail=this.stencilZFail),this.stencilZPass!==KeepStencilOp&&(K.stencilZPass=this.stencilZPass),this.stencilWrite===!0&&(K.stencilWrite=this.stencilWrite),this.rotation!==void 0&&this.rotation!==0&&(K.rotation=this.rotation),this.polygonOffset===!0&&(K.polygonOffset=!0),this.polygonOffsetFactor!==0&&(K.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(K.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth!==void 0&&this.linewidth!==1&&(K.linewidth=this.linewidth),this.dashSize!==void 0&&(K.dashSize=this.dashSize),this.gapSize!==void 0&&(K.gapSize=this.gapSize),this.scale!==void 0&&(K.scale=this.scale),this.dithering===!0&&(K.dithering=!0),this.alphaTest>0&&(K.alphaTest=this.alphaTest),this.alphaHash===!0&&(K.alphaHash=!0),this.alphaToCoverage===!0&&(K.alphaToCoverage=!0),this.premultipliedAlpha===!0&&(K.premultipliedAlpha=!0),this.forceSinglePass===!0&&(K.forceSinglePass=!0),this.wireframe===!0&&(K.wireframe=!0),this.wireframeLinewidth>1&&(K.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(K.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(K.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(K.flatShading=!0),this.visible===!1&&(K.visible=!1),this.toneMapped===!1&&(K.toneMapped=!1),this.fog===!1&&(K.fog=!1),Object.keys(this.userData).length>0&&(K.userData=this.userData);function te(ne){const ie=[];for(const oe in ne){const se=ne[oe];delete se.metadata,ie.push(se)}return ie}if(_){const ne=te(Z.textures),ie=te(Z.images);ne.length>0&&(K.textures=ne),ie.length>0&&(K.images=ie)}return K}clone(){return new this.constructor().copy(this)}copy(Z){this.name=Z.name,this.blending=Z.blending,this.side=Z.side,this.vertexColors=Z.vertexColors,this.opacity=Z.opacity,this.transparent=Z.transparent,this.blendSrc=Z.blendSrc,this.blendDst=Z.blendDst,this.blendEquation=Z.blendEquation,this.blendSrcAlpha=Z.blendSrcAlpha,this.blendDstAlpha=Z.blendDstAlpha,this.blendEquationAlpha=Z.blendEquationAlpha,this.blendColor.copy(Z.blendColor),this.blendAlpha=Z.blendAlpha,this.depthFunc=Z.depthFunc,this.depthTest=Z.depthTest,this.depthWrite=Z.depthWrite,this.stencilWriteMask=Z.stencilWriteMask,this.stencilFunc=Z.stencilFunc,this.stencilRef=Z.stencilRef,this.stencilFuncMask=Z.stencilFuncMask,this.stencilFail=Z.stencilFail,this.stencilZFail=Z.stencilZFail,this.stencilZPass=Z.stencilZPass,this.stencilWrite=Z.stencilWrite;const _=Z.clippingPlanes;let K=null;if(_!==null){const te=_.length;K=new Array(te);for(let ne=0;ne!==te;++ne)K[ne]=_[ne].clone()}return this.clippingPlanes=K,this.clipIntersection=Z.clipIntersection,this.clipShadows=Z.clipShadows,this.shadowSide=Z.shadowSide,this.colorWrite=Z.colorWrite,this.precision=Z.precision,this.polygonOffset=Z.polygonOffset,this.polygonOffsetFactor=Z.polygonOffsetFactor,this.polygonOffsetUnits=Z.polygonOffsetUnits,this.dithering=Z.dithering,this.alphaTest=Z.alphaTest,this.alphaHash=Z.alphaHash,this.alphaToCoverage=Z.alphaToCoverage,this.premultipliedAlpha=Z.premultipliedAlpha,this.forceSinglePass=Z.forceSinglePass,this.visible=Z.visible,this.toneMapped=Z.toneMapped,this.userData=JSON.parse(JSON.stringify(Z.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(Z){Z===!0&&this.version++}onBuild(){console.warn("Material: onBuild() has been removed.")}}class MeshBasicMaterial extends Material{constructor(Z){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new Color$1(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Euler,this.combine=MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(Z)}copy(Z){return super.copy(Z),this.color.copy(Z.color),this.map=Z.map,this.lightMap=Z.lightMap,this.lightMapIntensity=Z.lightMapIntensity,this.aoMap=Z.aoMap,this.aoMapIntensity=Z.aoMapIntensity,this.specularMap=Z.specularMap,this.alphaMap=Z.alphaMap,this.envMap=Z.envMap,this.envMapRotation.copy(Z.envMapRotation),this.combine=Z.combine,this.reflectivity=Z.reflectivity,this.refractionRatio=Z.refractionRatio,this.wireframe=Z.wireframe,this.wireframeLinewidth=Z.wireframeLinewidth,this.wireframeLinecap=Z.wireframeLinecap,this.wireframeLinejoin=Z.wireframeLinejoin,this.fog=Z.fog,this}}const _tables=_generateTables();function _generateTables(){const X=new ArrayBuffer(4),Z=new Float32Array(X),_=new Uint32Array(X),K=new Uint32Array(512),te=new Uint32Array(512);for(let se=0;se<256;++se){const ae=se-127;ae<-27?(K[se]=0,K[se|256]=32768,te[se]=24,te[se|256]=24):ae<-14?(K[se]=1024>>-ae-14,K[se|256]=1024>>-ae-14|32768,te[se]=-ae-1,te[se|256]=-ae-1):ae<=15?(K[se]=ae+15<<10,K[se|256]=ae+15<<10|32768,te[se]=13,te[se|256]=13):ae<128?(K[se]=31744,K[se|256]=64512,te[se]=24,te[se|256]=24):(K[se]=31744,K[se|256]=64512,te[se]=13,te[se|256]=13)}const ne=new Uint32Array(2048),ie=new Uint32Array(64),oe=new Uint32Array(64);for(let se=1;se<1024;++se){let ae=se<<13,ge=0;for(;!(ae&8388608);)ae<<=1,ge-=8388608;ae&=-8388609,ge+=947912704,ne[se]=ae|ge}for(let se=1024;se<2048;++se)ne[se]=939524096+(se-1024<<13);for(let se=1;se<31;++se)ie[se]=se<<23;ie[31]=1199570944,ie[32]=2147483648;for(let se=33;se<63;++se)ie[se]=2147483648+(se-32<<23);ie[63]=3347054592;for(let se=1;se<64;++se)se!==32&&(oe[se]=1024);return{floatView:Z,uint32View:_,baseTable:K,shiftTable:te,mantissaTable:ne,exponentTable:ie,offsetTable:oe}}function toHalfFloat(X){Math.abs(X)>65504&&console.warn("THREE.DataUtils.toHalfFloat(): Value out of range."),X=clamp$3(X,-65504,65504),_tables.floatView[0]=X;const Z=_tables.uint32View[0],_=Z>>23&511;return _tables.baseTable[_]+((Z&8388607)>>_tables.shiftTable[_])}function fromHalfFloat(X){const Z=X>>10;return _tables.uint32View[0]=_tables.mantissaTable[_tables.offsetTable[Z]+(X&1023)]+_tables.exponentTable[Z],_tables.floatView[0]}const DataUtils={toHalfFloat,fromHalfFloat},_vector$9=new Vector3,_vector2$1=new Vector2;class BufferAttribute{constructor(Z,_,K=!1){if(Array.isArray(Z))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=Z,this.itemSize=_,this.count=Z!==void 0?Z.length/_:0,this.normalized=K,this.usage=StaticDrawUsage,this.updateRanges=[],this.gpuType=FloatType,this.version=0}onUploadCallback(){}set needsUpdate(Z){Z===!0&&this.version++}setUsage(Z){return this.usage=Z,this}addUpdateRange(Z,_){this.updateRanges.push({start:Z,count:_})}clearUpdateRanges(){this.updateRanges.length=0}copy(Z){return this.name=Z.name,this.array=new Z.array.constructor(Z.array),this.itemSize=Z.itemSize,this.count=Z.count,this.normalized=Z.normalized,this.usage=Z.usage,this.gpuType=Z.gpuType,this}copyAt(Z,_,K){Z*=this.itemSize,K*=_.itemSize;for(let te=0,ne=this.itemSize;te<ne;te++)this.array[Z+te]=_.array[K+te];return this}copyArray(Z){return this.array.set(Z),this}applyMatrix3(Z){if(this.itemSize===2)for(let _=0,K=this.count;_<K;_++)_vector2$1.fromBufferAttribute(this,_),_vector2$1.applyMatrix3(Z),this.setXY(_,_vector2$1.x,_vector2$1.y);else if(this.itemSize===3)for(let _=0,K=this.count;_<K;_++)_vector$9.fromBufferAttribute(this,_),_vector$9.applyMatrix3(Z),this.setXYZ(_,_vector$9.x,_vector$9.y,_vector$9.z);return this}applyMatrix4(Z){for(let _=0,K=this.count;_<K;_++)_vector$9.fromBufferAttribute(this,_),_vector$9.applyMatrix4(Z),this.setXYZ(_,_vector$9.x,_vector$9.y,_vector$9.z);return this}applyNormalMatrix(Z){for(let _=0,K=this.count;_<K;_++)_vector$9.fromBufferAttribute(this,_),_vector$9.applyNormalMatrix(Z),this.setXYZ(_,_vector$9.x,_vector$9.y,_vector$9.z);return this}transformDirection(Z){for(let _=0,K=this.count;_<K;_++)_vector$9.fromBufferAttribute(this,_),_vector$9.transformDirection(Z),this.setXYZ(_,_vector$9.x,_vector$9.y,_vector$9.z);return this}set(Z,_=0){return this.array.set(Z,_),this}getComponent(Z,_){let K=this.array[Z*this.itemSize+_];return this.normalized&&(K=denormalize(K,this.array)),K}setComponent(Z,_,K){return this.normalized&&(K=normalize$5(K,this.array)),this.array[Z*this.itemSize+_]=K,this}getX(Z){let _=this.array[Z*this.itemSize];return this.normalized&&(_=denormalize(_,this.array)),_}setX(Z,_){return this.normalized&&(_=normalize$5(_,this.array)),this.array[Z*this.itemSize]=_,this}getY(Z){let _=this.array[Z*this.itemSize+1];return this.normalized&&(_=denormalize(_,this.array)),_}setY(Z,_){return this.normalized&&(_=normalize$5(_,this.array)),this.array[Z*this.itemSize+1]=_,this}getZ(Z){let _=this.array[Z*this.itemSize+2];return this.normalized&&(_=denormalize(_,this.array)),_}setZ(Z,_){return this.normalized&&(_=normalize$5(_,this.array)),this.array[Z*this.itemSize+2]=_,this}getW(Z){let _=this.array[Z*this.itemSize+3];return this.normalized&&(_=denormalize(_,this.array)),_}setW(Z,_){return this.normalized&&(_=normalize$5(_,this.array)),this.array[Z*this.itemSize+3]=_,this}setXY(Z,_,K){return Z*=this.itemSize,this.normalized&&(_=normalize$5(_,this.array),K=normalize$5(K,this.array)),this.array[Z+0]=_,this.array[Z+1]=K,this}setXYZ(Z,_,K,te){return Z*=this.itemSize,this.normalized&&(_=normalize$5(_,this.array),K=normalize$5(K,this.array),te=normalize$5(te,this.array)),this.array[Z+0]=_,this.array[Z+1]=K,this.array[Z+2]=te,this}setXYZW(Z,_,K,te,ne){return Z*=this.itemSize,this.normalized&&(_=normalize$5(_,this.array),K=normalize$5(K,this.array),te=normalize$5(te,this.array),ne=normalize$5(ne,this.array)),this.array[Z+0]=_,this.array[Z+1]=K,this.array[Z+2]=te,this.array[Z+3]=ne,this}onUpload(Z){return this.onUploadCallback=Z,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const Z={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return this.name!==""&&(Z.name=this.name),this.usage!==StaticDrawUsage&&(Z.usage=this.usage),Z}}class Int8BufferAttribute extends BufferAttribute{constructor(Z,_,K){super(new Int8Array(Z),_,K)}}class Uint8BufferAttribute extends BufferAttribute{constructor(Z,_,K){super(new Uint8Array(Z),_,K)}}class Uint8ClampedBufferAttribute extends BufferAttribute{constructor(Z,_,K){super(new Uint8ClampedArray(Z),_,K)}}class Int16BufferAttribute extends BufferAttribute{constructor(Z,_,K){super(new Int16Array(Z),_,K)}}class Uint16BufferAttribute extends BufferAttribute{constructor(Z,_,K){super(new Uint16Array(Z),_,K)}}class Int32BufferAttribute extends BufferAttribute{constructor(Z,_,K){super(new Int32Array(Z),_,K)}}class Uint32BufferAttribute extends BufferAttribute{constructor(Z,_,K){super(new Uint32Array(Z),_,K)}}class Float16BufferAttribute extends BufferAttribute{constructor(Z,_,K){super(new Uint16Array(Z),_,K),this.isFloat16BufferAttribute=!0}getX(Z){let _=fromHalfFloat(this.array[Z*this.itemSize]);return this.normalized&&(_=denormalize(_,this.array)),_}setX(Z,_){return this.normalized&&(_=normalize$5(_,this.array)),this.array[Z*this.itemSize]=toHalfFloat(_),this}getY(Z){let _=fromHalfFloat(this.array[Z*this.itemSize+1]);return this.normalized&&(_=denormalize(_,this.array)),_}setY(Z,_){return this.normalized&&(_=normalize$5(_,this.array)),this.array[Z*this.itemSize+1]=toHalfFloat(_),this}getZ(Z){let _=fromHalfFloat(this.array[Z*this.itemSize+2]);return this.normalized&&(_=denormalize(_,this.array)),_}setZ(Z,_){return this.normalized&&(_=normalize$5(_,this.array)),this.array[Z*this.itemSize+2]=toHalfFloat(_),this}getW(Z){let _=fromHalfFloat(this.array[Z*this.itemSize+3]);return this.normalized&&(_=denormalize(_,this.array)),_}setW(Z,_){return this.normalized&&(_=normalize$5(_,this.array)),this.array[Z*this.itemSize+3]=toHalfFloat(_),this}setXY(Z,_,K){return Z*=this.itemSize,this.normalized&&(_=normalize$5(_,this.array),K=normalize$5(K,this.array)),this.array[Z+0]=toHalfFloat(_),this.array[Z+1]=toHalfFloat(K),this}setXYZ(Z,_,K,te){return Z*=this.itemSize,this.normalized&&(_=normalize$5(_,this.array),K=normalize$5(K,this.array),te=normalize$5(te,this.array)),this.array[Z+0]=toHalfFloat(_),this.array[Z+1]=toHalfFloat(K),this.array[Z+2]=toHalfFloat(te),this}setXYZW(Z,_,K,te,ne){return Z*=this.itemSize,this.normalized&&(_=normalize$5(_,this.array),K=normalize$5(K,this.array),te=normalize$5(te,this.array),ne=normalize$5(ne,this.array)),this.array[Z+0]=toHalfFloat(_),this.array[Z+1]=toHalfFloat(K),this.array[Z+2]=toHalfFloat(te),this.array[Z+3]=toHalfFloat(ne),this}}class Float32BufferAttribute extends BufferAttribute{constructor(Z,_,K){super(new Float32Array(Z),_,K)}}let _id$1=0;const _m1$3=new Matrix4,_obj=new Object3D,_offset=new Vector3,_box$2=new Box3,_boxMorphTargets=new Box3,_vector$8=new Vector3;class BufferGeometry extends EventDispatcher{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:_id$1++}),this.uuid=generateUUID$1(),this.name="",this.type="BufferGeometry",this.index=null,this.indirect=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(Z){return Array.isArray(Z)?this.index=new(arrayNeedsUint32(Z)?Uint32BufferAttribute:Uint16BufferAttribute)(Z,1):this.index=Z,this}setIndirect(Z){return this.indirect=Z,this}getIndirect(){return this.indirect}getAttribute(Z){return this.attributes[Z]}setAttribute(Z,_){return this.attributes[Z]=_,this}deleteAttribute(Z){return delete this.attributes[Z],this}hasAttribute(Z){return this.attributes[Z]!==void 0}addGroup(Z,_,K=0){this.groups.push({start:Z,count:_,materialIndex:K})}clearGroups(){this.groups=[]}setDrawRange(Z,_){this.drawRange.start=Z,this.drawRange.count=_}applyMatrix4(Z){const _=this.attributes.position;_!==void 0&&(_.applyMatrix4(Z),_.needsUpdate=!0);const K=this.attributes.normal;if(K!==void 0){const ne=new Matrix3().getNormalMatrix(Z);K.applyNormalMatrix(ne),K.needsUpdate=!0}const te=this.attributes.tangent;return te!==void 0&&(te.transformDirection(Z),te.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(Z){return _m1$3.makeRotationFromQuaternion(Z),this.applyMatrix4(_m1$3),this}rotateX(Z){return _m1$3.makeRotationX(Z),this.applyMatrix4(_m1$3),this}rotateY(Z){return _m1$3.makeRotationY(Z),this.applyMatrix4(_m1$3),this}rotateZ(Z){return _m1$3.makeRotationZ(Z),this.applyMatrix4(_m1$3),this}translate(Z,_,K){return _m1$3.makeTranslation(Z,_,K),this.applyMatrix4(_m1$3),this}scale(Z,_,K){return _m1$3.makeScale(Z,_,K),this.applyMatrix4(_m1$3),this}lookAt(Z){return _obj.lookAt(Z),_obj.updateMatrix(),this.applyMatrix4(_obj.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(_offset).negate(),this.translate(_offset.x,_offset.y,_offset.z),this}setFromPoints(Z){const _=this.getAttribute("position");if(_===void 0){const K=[];for(let te=0,ne=Z.length;te<ne;te++){const ie=Z[te];K.push(ie.x,ie.y,ie.z||0)}this.setAttribute("position",new Float32BufferAttribute(K,3))}else{const K=Math.min(Z.length,_.count);for(let te=0;te<K;te++){const ne=Z[te];_.setXYZ(te,ne.x,ne.y,ne.z||0)}Z.length>_.count&&console.warn("THREE.BufferGeometry: Buffer size too small for points data. Use .dispose() and create a new geometry."),_.needsUpdate=!0}return this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new Box3);const Z=this.attributes.position,_=this.morphAttributes.position;if(Z&&Z.isGLBufferAttribute){console.error("THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box.",this),this.boundingBox.set(new Vector3(-1/0,-1/0,-1/0),new Vector3(1/0,1/0,1/0));return}if(Z!==void 0){if(this.boundingBox.setFromBufferAttribute(Z),_)for(let K=0,te=_.length;K<te;K++){const ne=_[K];_box$2.setFromBufferAttribute(ne),this.morphTargetsRelative?(_vector$8.addVectors(this.boundingBox.min,_box$2.min),this.boundingBox.expandByPoint(_vector$8),_vector$8.addVectors(this.boundingBox.max,_box$2.max),this.boundingBox.expandByPoint(_vector$8)):(this.boundingBox.expandByPoint(_box$2.min),this.boundingBox.expandByPoint(_box$2.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new Sphere);const Z=this.attributes.position,_=this.morphAttributes.position;if(Z&&Z.isGLBufferAttribute){console.error("THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere.",this),this.boundingSphere.set(new Vector3,1/0);return}if(Z){const K=this.boundingSphere.center;if(_box$2.setFromBufferAttribute(Z),_)for(let ne=0,ie=_.length;ne<ie;ne++){const oe=_[ne];_boxMorphTargets.setFromBufferAttribute(oe),this.morphTargetsRelative?(_vector$8.addVectors(_box$2.min,_boxMorphTargets.min),_box$2.expandByPoint(_vector$8),_vector$8.addVectors(_box$2.max,_boxMorphTargets.max),_box$2.expandByPoint(_vector$8)):(_box$2.expandByPoint(_boxMorphTargets.min),_box$2.expandByPoint(_boxMorphTargets.max))}_box$2.getCenter(K);let te=0;for(let ne=0,ie=Z.count;ne<ie;ne++)_vector$8.fromBufferAttribute(Z,ne),te=Math.max(te,K.distanceToSquared(_vector$8));if(_)for(let ne=0,ie=_.length;ne<ie;ne++){const oe=_[ne],se=this.morphTargetsRelative;for(let ae=0,ge=oe.count;ae<ge;ae++)_vector$8.fromBufferAttribute(oe,ae),se&&(_offset.fromBufferAttribute(Z,ae),_vector$8.add(_offset)),te=Math.max(te,K.distanceToSquared(_vector$8))}this.boundingSphere.radius=Math.sqrt(te),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const Z=this.index,_=this.attributes;if(Z===null||_.position===void 0||_.normal===void 0||_.uv===void 0){console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}const K=_.position,te=_.normal,ne=_.uv;this.hasAttribute("tangent")===!1&&this.setAttribute("tangent",new BufferAttribute(new Float32Array(4*K.count),4));const ie=this.getAttribute("tangent"),oe=[],se=[];for(let _e=0;_e<K.count;_e++)oe[_e]=new Vector3,se[_e]=new Vector3;const ae=new Vector3,ge=new Vector3,ce=new Vector3,de=new Vector2,Ie=new Vector2,fe=new Vector2,be=new Vector3,Ae=new Vector3;function ye(_e,Fe,Te){ae.fromBufferAttribute(K,_e),ge.fromBufferAttribute(K,Fe),ce.fromBufferAttribute(K,Te),de.fromBufferAttribute(ne,_e),Ie.fromBufferAttribute(ne,Fe),fe.fromBufferAttribute(ne,Te),ge.sub(ae),ce.sub(ae),Ie.sub(de),fe.sub(de);const ke=1/(Ie.x*fe.y-fe.x*Ie.y);isFinite(ke)&&(be.copy(ge).multiplyScalar(fe.y).addScaledVector(ce,-Ie.y).multiplyScalar(ke),Ae.copy(ce).multiplyScalar(Ie.x).addScaledVector(ge,-fe.x).multiplyScalar(ke),oe[_e].add(be),oe[Fe].add(be),oe[Te].add(be),se[_e].add(Ae),se[Fe].add(Ae),se[Te].add(Ae))}let ve=this.groups;ve.length===0&&(ve=[{start:0,count:Z.count}]);for(let _e=0,Fe=ve.length;_e<Fe;++_e){const Te=ve[_e],ke=Te.start,Le=Te.count;for(let Ke=ke,Ue=ke+Le;Ke<Ue;Ke+=3)ye(Z.getX(Ke+0),Z.getX(Ke+1),Z.getX(Ke+2))}const Be=new Vector3,Re=new Vector3,Ve=new Vector3,Ee=new Vector3;function Ze(_e){Ve.fromBufferAttribute(te,_e),Ee.copy(Ve);const Fe=oe[_e];Be.copy(Fe),Be.sub(Ve.multiplyScalar(Ve.dot(Fe))).normalize(),Re.crossVectors(Ee,Fe);const ke=Re.dot(se[_e])<0?-1:1;ie.setXYZW(_e,Be.x,Be.y,Be.z,ke)}for(let _e=0,Fe=ve.length;_e<Fe;++_e){const Te=ve[_e],ke=Te.start,Le=Te.count;for(let Ke=ke,Ue=ke+Le;Ke<Ue;Ke+=3)Ze(Z.getX(Ke+0)),Ze(Z.getX(Ke+1)),Ze(Z.getX(Ke+2))}}computeVertexNormals(){const Z=this.index,_=this.getAttribute("position");if(_!==void 0){let K=this.getAttribute("normal");if(K===void 0)K=new BufferAttribute(new Float32Array(_.count*3),3),this.setAttribute("normal",K);else for(let de=0,Ie=K.count;de<Ie;de++)K.setXYZ(de,0,0,0);const te=new Vector3,ne=new Vector3,ie=new Vector3,oe=new Vector3,se=new Vector3,ae=new Vector3,ge=new Vector3,ce=new Vector3;if(Z)for(let de=0,Ie=Z.count;de<Ie;de+=3){const fe=Z.getX(de+0),be=Z.getX(de+1),Ae=Z.getX(de+2);te.fromBufferAttribute(_,fe),ne.fromBufferAttribute(_,be),ie.fromBufferAttribute(_,Ae),ge.subVectors(ie,ne),ce.subVectors(te,ne),ge.cross(ce),oe.fromBufferAttribute(K,fe),se.fromBufferAttribute(K,be),ae.fromBufferAttribute(K,Ae),oe.add(ge),se.add(ge),ae.add(ge),K.setXYZ(fe,oe.x,oe.y,oe.z),K.setXYZ(be,se.x,se.y,se.z),K.setXYZ(Ae,ae.x,ae.y,ae.z)}else for(let de=0,Ie=_.count;de<Ie;de+=3)te.fromBufferAttribute(_,de+0),ne.fromBufferAttribute(_,de+1),ie.fromBufferAttribute(_,de+2),ge.subVectors(ie,ne),ce.subVectors(te,ne),ge.cross(ce),K.setXYZ(de+0,ge.x,ge.y,ge.z),K.setXYZ(de+1,ge.x,ge.y,ge.z),K.setXYZ(de+2,ge.x,ge.y,ge.z);this.normalizeNormals(),K.needsUpdate=!0}}normalizeNormals(){const Z=this.attributes.normal;for(let _=0,K=Z.count;_<K;_++)_vector$8.fromBufferAttribute(Z,_),_vector$8.normalize(),Z.setXYZ(_,_vector$8.x,_vector$8.y,_vector$8.z)}toNonIndexed(){function Z(oe,se){const ae=oe.array,ge=oe.itemSize,ce=oe.normalized,de=new ae.constructor(se.length*ge);let Ie=0,fe=0;for(let be=0,Ae=se.length;be<Ae;be++){oe.isInterleavedBufferAttribute?Ie=se[be]*oe.data.stride+oe.offset:Ie=se[be]*ge;for(let ye=0;ye<ge;ye++)de[fe++]=ae[Ie++]}return new BufferAttribute(de,ge,ce)}if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const _=new BufferGeometry,K=this.index.array,te=this.attributes;for(const oe in te){const se=te[oe],ae=Z(se,K);_.setAttribute(oe,ae)}const ne=this.morphAttributes;for(const oe in ne){const se=[],ae=ne[oe];for(let ge=0,ce=ae.length;ge<ce;ge++){const de=ae[ge],Ie=Z(de,K);se.push(Ie)}_.morphAttributes[oe]=se}_.morphTargetsRelative=this.morphTargetsRelative;const ie=this.groups;for(let oe=0,se=ie.length;oe<se;oe++){const ae=ie[oe];_.addGroup(ae.start,ae.count,ae.materialIndex)}return _}toJSON(){const Z={metadata:{version:4.6,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(Z.uuid=this.uuid,Z.type=this.type,this.name!==""&&(Z.name=this.name),Object.keys(this.userData).length>0&&(Z.userData=this.userData),this.parameters!==void 0){const se=this.parameters;for(const ae in se)se[ae]!==void 0&&(Z[ae]=se[ae]);return Z}Z.data={attributes:{}};const _=this.index;_!==null&&(Z.data.index={type:_.array.constructor.name,array:Array.prototype.slice.call(_.array)});const K=this.attributes;for(const se in K){const ae=K[se];Z.data.attributes[se]=ae.toJSON(Z.data)}const te={};let ne=!1;for(const se in this.morphAttributes){const ae=this.morphAttributes[se],ge=[];for(let ce=0,de=ae.length;ce<de;ce++){const Ie=ae[ce];ge.push(Ie.toJSON(Z.data))}ge.length>0&&(te[se]=ge,ne=!0)}ne&&(Z.data.morphAttributes=te,Z.data.morphTargetsRelative=this.morphTargetsRelative);const ie=this.groups;ie.length>0&&(Z.data.groups=JSON.parse(JSON.stringify(ie)));const oe=this.boundingSphere;return oe!==null&&(Z.data.boundingSphere={center:oe.center.toArray(),radius:oe.radius}),Z}clone(){return new this.constructor().copy(this)}copy(Z){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const _={};this.name=Z.name;const K=Z.index;K!==null&&this.setIndex(K.clone(_));const te=Z.attributes;for(const ae in te){const ge=te[ae];this.setAttribute(ae,ge.clone(_))}const ne=Z.morphAttributes;for(const ae in ne){const ge=[],ce=ne[ae];for(let de=0,Ie=ce.length;de<Ie;de++)ge.push(ce[de].clone(_));this.morphAttributes[ae]=ge}this.morphTargetsRelative=Z.morphTargetsRelative;const ie=Z.groups;for(let ae=0,ge=ie.length;ae<ge;ae++){const ce=ie[ae];this.addGroup(ce.start,ce.count,ce.materialIndex)}const oe=Z.boundingBox;oe!==null&&(this.boundingBox=oe.clone());const se=Z.boundingSphere;return se!==null&&(this.boundingSphere=se.clone()),this.drawRange.start=Z.drawRange.start,this.drawRange.count=Z.drawRange.count,this.userData=Z.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}const _inverseMatrix$3=new Matrix4,_ray$3=new Ray$2,_sphere$6=new Sphere,_sphereHitAt=new Vector3,_vA$1=new Vector3,_vB$1=new Vector3,_vC$1=new Vector3,_tempA=new Vector3,_morphA=new Vector3,_intersectionPoint=new Vector3,_intersectionPointWorld=new Vector3;class Mesh extends Object3D{constructor(Z=new BufferGeometry,_=new MeshBasicMaterial){super(),this.isMesh=!0,this.type="Mesh",this.geometry=Z,this.material=_,this.updateMorphTargets()}copy(Z,_){return super.copy(Z,_),Z.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=Z.morphTargetInfluences.slice()),Z.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},Z.morphTargetDictionary)),this.material=Array.isArray(Z.material)?Z.material.slice():Z.material,this.geometry=Z.geometry,this}updateMorphTargets(){const _=this.geometry.morphAttributes,K=Object.keys(_);if(K.length>0){const te=_[K[0]];if(te!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let ne=0,ie=te.length;ne<ie;ne++){const oe=te[ne].name||String(ne);this.morphTargetInfluences.push(0),this.morphTargetDictionary[oe]=ne}}}}getVertexPosition(Z,_){const K=this.geometry,te=K.attributes.position,ne=K.morphAttributes.position,ie=K.morphTargetsRelative;_.fromBufferAttribute(te,Z);const oe=this.morphTargetInfluences;if(ne&&oe){_morphA.set(0,0,0);for(let se=0,ae=ne.length;se<ae;se++){const ge=oe[se],ce=ne[se];ge!==0&&(_tempA.fromBufferAttribute(ce,Z),ie?_morphA.addScaledVector(_tempA,ge):_morphA.addScaledVector(_tempA.sub(_),ge))}_.add(_morphA)}return _}raycast(Z,_){const K=this.geometry,te=this.material,ne=this.matrixWorld;te!==void 0&&(K.boundingSphere===null&&K.computeBoundingSphere(),_sphere$6.copy(K.boundingSphere),_sphere$6.applyMatrix4(ne),_ray$3.copy(Z.ray).recast(Z.near),!(_sphere$6.containsPoint(_ray$3.origin)===!1&&(_ray$3.intersectSphere(_sphere$6,_sphereHitAt)===null||_ray$3.origin.distanceToSquared(_sphereHitAt)>(Z.far-Z.near)**2))&&(_inverseMatrix$3.copy(ne).invert(),_ray$3.copy(Z.ray).applyMatrix4(_inverseMatrix$3),!(K.boundingBox!==null&&_ray$3.intersectsBox(K.boundingBox)===!1)&&this._computeIntersections(Z,_,_ray$3)))}_computeIntersections(Z,_,K){let te;const ne=this.geometry,ie=this.material,oe=ne.index,se=ne.attributes.position,ae=ne.attributes.uv,ge=ne.attributes.uv1,ce=ne.attributes.normal,de=ne.groups,Ie=ne.drawRange;if(oe!==null)if(Array.isArray(ie))for(let fe=0,be=de.length;fe<be;fe++){const Ae=de[fe],ye=ie[Ae.materialIndex],ve=Math.max(Ae.start,Ie.start),Be=Math.min(oe.count,Math.min(Ae.start+Ae.count,Ie.start+Ie.count));for(let Re=ve,Ve=Be;Re<Ve;Re+=3){const Ee=oe.getX(Re),Ze=oe.getX(Re+1),_e=oe.getX(Re+2);te=checkGeometryIntersection(this,ye,Z,K,ae,ge,ce,Ee,Ze,_e),te&&(te.faceIndex=Math.floor(Re/3),te.face.materialIndex=Ae.materialIndex,_.push(te))}}else{const fe=Math.max(0,Ie.start),be=Math.min(oe.count,Ie.start+Ie.count);for(let Ae=fe,ye=be;Ae<ye;Ae+=3){const ve=oe.getX(Ae),Be=oe.getX(Ae+1),Re=oe.getX(Ae+2);te=checkGeometryIntersection(this,ie,Z,K,ae,ge,ce,ve,Be,Re),te&&(te.faceIndex=Math.floor(Ae/3),_.push(te))}}else if(se!==void 0)if(Array.isArray(ie))for(let fe=0,be=de.length;fe<be;fe++){const Ae=de[fe],ye=ie[Ae.materialIndex],ve=Math.max(Ae.start,Ie.start),Be=Math.min(se.count,Math.min(Ae.start+Ae.count,Ie.start+Ie.count));for(let Re=ve,Ve=Be;Re<Ve;Re+=3){const Ee=Re,Ze=Re+1,_e=Re+2;te=checkGeometryIntersection(this,ye,Z,K,ae,ge,ce,Ee,Ze,_e),te&&(te.faceIndex=Math.floor(Re/3),te.face.materialIndex=Ae.materialIndex,_.push(te))}}else{const fe=Math.max(0,Ie.start),be=Math.min(se.count,Ie.start+Ie.count);for(let Ae=fe,ye=be;Ae<ye;Ae+=3){const ve=Ae,Be=Ae+1,Re=Ae+2;te=checkGeometryIntersection(this,ie,Z,K,ae,ge,ce,ve,Be,Re),te&&(te.faceIndex=Math.floor(Ae/3),_.push(te))}}}}function checkIntersection$1(X,Z,_,K,te,ne,ie,oe){let se;if(Z.side===BackSide?se=K.intersectTriangle(ie,ne,te,!0,oe):se=K.intersectTriangle(te,ne,ie,Z.side===FrontSide,oe),se===null)return null;_intersectionPointWorld.copy(oe),_intersectionPointWorld.applyMatrix4(X.matrixWorld);const ae=_.ray.origin.distanceTo(_intersectionPointWorld);return ae<_.near||ae>_.far?null:{distance:ae,point:_intersectionPointWorld.clone(),object:X}}function checkGeometryIntersection(X,Z,_,K,te,ne,ie,oe,se,ae){X.getVertexPosition(oe,_vA$1),X.getVertexPosition(se,_vB$1),X.getVertexPosition(ae,_vC$1);const ge=checkIntersection$1(X,Z,_,K,_vA$1,_vB$1,_vC$1,_intersectionPoint);if(ge){const ce=new Vector3;Triangle.getBarycoord(_intersectionPoint,_vA$1,_vB$1,_vC$1,ce),te&&(ge.uv=Triangle.getInterpolatedAttribute(te,oe,se,ae,ce,new Vector2)),ne&&(ge.uv1=Triangle.getInterpolatedAttribute(ne,oe,se,ae,ce,new Vector2)),ie&&(ge.normal=Triangle.getInterpolatedAttribute(ie,oe,se,ae,ce,new Vector3),ge.normal.dot(K.direction)>0&&ge.normal.multiplyScalar(-1));const de={a:oe,b:se,c:ae,normal:new Vector3,materialIndex:0};Triangle.getNormal(_vA$1,_vB$1,_vC$1,de.normal),ge.face=de,ge.barycoord=ce}return ge}class BoxGeometry extends BufferGeometry{constructor(Z=1,_=1,K=1,te=1,ne=1,ie=1){super(),this.type="BoxGeometry",this.parameters={width:Z,height:_,depth:K,widthSegments:te,heightSegments:ne,depthSegments:ie};const oe=this;te=Math.floor(te),ne=Math.floor(ne),ie=Math.floor(ie);const se=[],ae=[],ge=[],ce=[];let de=0,Ie=0;fe("z","y","x",-1,-1,K,_,Z,ie,ne,0),fe("z","y","x",1,-1,K,_,-Z,ie,ne,1),fe("x","z","y",1,1,Z,K,_,te,ie,2),fe("x","z","y",1,-1,Z,K,-_,te,ie,3),fe("x","y","z",1,-1,Z,_,K,te,ne,4),fe("x","y","z",-1,-1,Z,_,-K,te,ne,5),this.setIndex(se),this.setAttribute("position",new Float32BufferAttribute(ae,3)),this.setAttribute("normal",new Float32BufferAttribute(ge,3)),this.setAttribute("uv",new Float32BufferAttribute(ce,2));function fe(be,Ae,ye,ve,Be,Re,Ve,Ee,Ze,_e,Fe){const Te=Re/Ze,ke=Ve/_e,Le=Re/2,Ke=Ve/2,Ue=Ee/2,rt=Ze+1,tt=_e+1;let at=0,ze=0;const qe=new Vector3;for(let Pe=0;Pe<tt;Pe++){const Ye=Pe*ke-Ke;for(let $e=0;$e<rt;$e++){const ut=$e*Te-Le;qe[be]=ut*ve,qe[Ae]=Ye*Be,qe[ye]=Ue,ae.push(qe.x,qe.y,qe.z),qe[be]=0,qe[Ae]=0,qe[ye]=Ee>0?1:-1,ge.push(qe.x,qe.y,qe.z),ce.push($e/Ze),ce.push(1-Pe/_e),at+=1}}for(let Pe=0;Pe<_e;Pe++)for(let Ye=0;Ye<Ze;Ye++){const $e=de+Ye+rt*Pe,ut=de+Ye+rt*(Pe+1),ot=de+(Ye+1)+rt*(Pe+1),gt=de+(Ye+1)+rt*Pe;se.push($e,ut,gt),se.push(ut,ot,gt),ze+=6}oe.addGroup(Ie,ze,Fe),Ie+=ze,de+=at}}copy(Z){return super.copy(Z),this.parameters=Object.assign({},Z.parameters),this}static fromJSON(Z){return new BoxGeometry(Z.width,Z.height,Z.depth,Z.widthSegments,Z.heightSegments,Z.depthSegments)}}function cloneUniforms(X){const Z={};for(const _ in X){Z[_]={};for(const K in X[_]){const te=X[_][K];te&&(te.isColor||te.isMatrix3||te.isMatrix4||te.isVector2||te.isVector3||te.isVector4||te.isTexture||te.isQuaternion)?te.isRenderTargetTexture?(console.warn("UniformsUtils: Textures of render targets cannot be cloned via cloneUniforms() or mergeUniforms()."),Z[_][K]=null):Z[_][K]=te.clone():Array.isArray(te)?Z[_][K]=te.slice():Z[_][K]=te}}return Z}function mergeUniforms(X){const Z={};for(let _=0;_<X.length;_++){const K=cloneUniforms(X[_]);for(const te in K)Z[te]=K[te]}return Z}function cloneUniformsGroups(X){const Z=[];for(let _=0;_<X.length;_++)Z.push(X[_].clone());return Z}function getUnlitUniformColorSpace(X){const Z=X.getRenderTarget();return Z===null?X.outputColorSpace:Z.isXRRenderTarget===!0?Z.texture.colorSpace:ColorManagement.workingColorSpace}const UniformsUtils={clone:cloneUniforms,merge:mergeUniforms};var default_vertex=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,default_fragment=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`;class ShaderMaterial extends Material{constructor(Z){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader=default_vertex,this.fragmentShader=default_fragment,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.forceSinglePass=!0,this.extensions={clipCullDistance:!1,multiDraw:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv1:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,Z!==void 0&&this.setValues(Z)}copy(Z){return super.copy(Z),this.fragmentShader=Z.fragmentShader,this.vertexShader=Z.vertexShader,this.uniforms=cloneUniforms(Z.uniforms),this.uniformsGroups=cloneUniformsGroups(Z.uniformsGroups),this.defines=Object.assign({},Z.defines),this.wireframe=Z.wireframe,this.wireframeLinewidth=Z.wireframeLinewidth,this.fog=Z.fog,this.lights=Z.lights,this.clipping=Z.clipping,this.extensions=Object.assign({},Z.extensions),this.glslVersion=Z.glslVersion,this}toJSON(Z){const _=super.toJSON(Z);_.glslVersion=this.glslVersion,_.uniforms={};for(const te in this.uniforms){const ie=this.uniforms[te].value;ie&&ie.isTexture?_.uniforms[te]={type:"t",value:ie.toJSON(Z).uuid}:ie&&ie.isColor?_.uniforms[te]={type:"c",value:ie.getHex()}:ie&&ie.isVector2?_.uniforms[te]={type:"v2",value:ie.toArray()}:ie&&ie.isVector3?_.uniforms[te]={type:"v3",value:ie.toArray()}:ie&&ie.isVector4?_.uniforms[te]={type:"v4",value:ie.toArray()}:ie&&ie.isMatrix3?_.uniforms[te]={type:"m3",value:ie.toArray()}:ie&&ie.isMatrix4?_.uniforms[te]={type:"m4",value:ie.toArray()}:_.uniforms[te]={value:ie}}Object.keys(this.defines).length>0&&(_.defines=this.defines),_.vertexShader=this.vertexShader,_.fragmentShader=this.fragmentShader,_.lights=this.lights,_.clipping=this.clipping;const K={};for(const te in this.extensions)this.extensions[te]===!0&&(K[te]=!0);return Object.keys(K).length>0&&(_.extensions=K),_}}class Camera extends Object3D{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new Matrix4,this.projectionMatrix=new Matrix4,this.projectionMatrixInverse=new Matrix4,this.coordinateSystem=WebGLCoordinateSystem}copy(Z,_){return super.copy(Z,_),this.matrixWorldInverse.copy(Z.matrixWorldInverse),this.projectionMatrix.copy(Z.projectionMatrix),this.projectionMatrixInverse.copy(Z.projectionMatrixInverse),this.coordinateSystem=Z.coordinateSystem,this}getWorldDirection(Z){return super.getWorldDirection(Z).negate()}updateMatrixWorld(Z){super.updateMatrixWorld(Z),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(Z,_){super.updateWorldMatrix(Z,_),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}}const _v3$1=new Vector3,_minTarget=new Vector2,_maxTarget=new Vector2;class PerspectiveCamera extends Camera{constructor(Z=50,_=1,K=.1,te=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=Z,this.zoom=1,this.near=K,this.far=te,this.focus=10,this.aspect=_,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(Z,_){return super.copy(Z,_),this.fov=Z.fov,this.zoom=Z.zoom,this.near=Z.near,this.far=Z.far,this.focus=Z.focus,this.aspect=Z.aspect,this.view=Z.view===null?null:Object.assign({},Z.view),this.filmGauge=Z.filmGauge,this.filmOffset=Z.filmOffset,this}setFocalLength(Z){const _=.5*this.getFilmHeight()/Z;this.fov=RAD2DEG*2*Math.atan(_),this.updateProjectionMatrix()}getFocalLength(){const Z=Math.tan(DEG2RAD*.5*this.fov);return .5*this.getFilmHeight()/Z}getEffectiveFOV(){return RAD2DEG*2*Math.atan(Math.tan(DEG2RAD*.5*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}getViewBounds(Z,_,K){_v3$1.set(-1,-1,.5).applyMatrix4(this.projectionMatrixInverse),_.set(_v3$1.x,_v3$1.y).multiplyScalar(-Z/_v3$1.z),_v3$1.set(1,1,.5).applyMatrix4(this.projectionMatrixInverse),K.set(_v3$1.x,_v3$1.y).multiplyScalar(-Z/_v3$1.z)}getViewSize(Z,_){return this.getViewBounds(Z,_minTarget,_maxTarget),_.subVectors(_maxTarget,_minTarget)}setViewOffset(Z,_,K,te,ne,ie){this.aspect=Z/_,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=Z,this.view.fullHeight=_,this.view.offsetX=K,this.view.offsetY=te,this.view.width=ne,this.view.height=ie,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const Z=this.near;let _=Z*Math.tan(DEG2RAD*.5*this.fov)/this.zoom,K=2*_,te=this.aspect*K,ne=-.5*te;const ie=this.view;if(this.view!==null&&this.view.enabled){const se=ie.fullWidth,ae=ie.fullHeight;ne+=ie.offsetX*te/se,_-=ie.offsetY*K/ae,te*=ie.width/se,K*=ie.height/ae}const oe=this.filmOffset;oe!==0&&(ne+=Z*oe/this.getFilmWidth()),this.projectionMatrix.makePerspective(ne,ne+te,_,_-K,Z,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(Z){const _=super.toJSON(Z);return _.object.fov=this.fov,_.object.zoom=this.zoom,_.object.near=this.near,_.object.far=this.far,_.object.focus=this.focus,_.object.aspect=this.aspect,this.view!==null&&(_.object.view=Object.assign({},this.view)),_.object.filmGauge=this.filmGauge,_.object.filmOffset=this.filmOffset,_}}const fov=-90,aspect=1;class CubeCamera extends Object3D{constructor(Z,_,K){super(),this.type="CubeCamera",this.renderTarget=K,this.coordinateSystem=null,this.activeMipmapLevel=0;const te=new PerspectiveCamera(fov,aspect,Z,_);te.layers=this.layers,this.add(te);const ne=new PerspectiveCamera(fov,aspect,Z,_);ne.layers=this.layers,this.add(ne);const ie=new PerspectiveCamera(fov,aspect,Z,_);ie.layers=this.layers,this.add(ie);const oe=new PerspectiveCamera(fov,aspect,Z,_);oe.layers=this.layers,this.add(oe);const se=new PerspectiveCamera(fov,aspect,Z,_);se.layers=this.layers,this.add(se);const ae=new PerspectiveCamera(fov,aspect,Z,_);ae.layers=this.layers,this.add(ae)}updateCoordinateSystem(){const Z=this.coordinateSystem,_=this.children.concat(),[K,te,ne,ie,oe,se]=_;for(const ae of _)this.remove(ae);if(Z===WebGLCoordinateSystem)K.up.set(0,1,0),K.lookAt(1,0,0),te.up.set(0,1,0),te.lookAt(-1,0,0),ne.up.set(0,0,-1),ne.lookAt(0,1,0),ie.up.set(0,0,1),ie.lookAt(0,-1,0),oe.up.set(0,1,0),oe.lookAt(0,0,1),se.up.set(0,1,0),se.lookAt(0,0,-1);else if(Z===WebGPUCoordinateSystem)K.up.set(0,-1,0),K.lookAt(-1,0,0),te.up.set(0,-1,0),te.lookAt(1,0,0),ne.up.set(0,0,1),ne.lookAt(0,1,0),ie.up.set(0,0,-1),ie.lookAt(0,-1,0),oe.up.set(0,-1,0),oe.lookAt(0,0,1),se.up.set(0,-1,0),se.lookAt(0,0,-1);else throw new Error("THREE.CubeCamera.updateCoordinateSystem(): Invalid coordinate system: "+Z);for(const ae of _)this.add(ae),ae.updateMatrixWorld()}update(Z,_){this.parent===null&&this.updateMatrixWorld();const{renderTarget:K,activeMipmapLevel:te}=this;this.coordinateSystem!==Z.coordinateSystem&&(this.coordinateSystem=Z.coordinateSystem,this.updateCoordinateSystem());const[ne,ie,oe,se,ae,ge]=this.children,ce=Z.getRenderTarget(),de=Z.getActiveCubeFace(),Ie=Z.getActiveMipmapLevel(),fe=Z.xr.enabled;Z.xr.enabled=!1;const be=K.texture.generateMipmaps;K.texture.generateMipmaps=!1,Z.setRenderTarget(K,0,te),Z.render(_,ne),Z.setRenderTarget(K,1,te),Z.render(_,ie),Z.setRenderTarget(K,2,te),Z.render(_,oe),Z.setRenderTarget(K,3,te),Z.render(_,se),Z.setRenderTarget(K,4,te),Z.render(_,ae),K.texture.generateMipmaps=be,Z.setRenderTarget(K,5,te),Z.render(_,ge),Z.setRenderTarget(ce,de,Ie),Z.xr.enabled=fe,K.texture.needsPMREMUpdate=!0}}class CubeTexture extends Texture{constructor(Z,_,K,te,ne,ie,oe,se,ae,ge){Z=Z!==void 0?Z:[],_=_!==void 0?_:CubeReflectionMapping,super(Z,_,K,te,ne,ie,oe,se,ae,ge),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(Z){this.image=Z}}class WebGLCubeRenderTarget extends WebGLRenderTarget{constructor(Z=1,_={}){super(Z,Z,_),this.isWebGLCubeRenderTarget=!0;const K={width:Z,height:Z,depth:1},te=[K,K,K,K,K,K];this.texture=new CubeTexture(te,_.mapping,_.wrapS,_.wrapT,_.magFilter,_.minFilter,_.format,_.type,_.anisotropy,_.colorSpace),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=_.generateMipmaps!==void 0?_.generateMipmaps:!1,this.texture.minFilter=_.minFilter!==void 0?_.minFilter:LinearFilter}fromEquirectangularTexture(Z,_){this.texture.type=_.type,this.texture.colorSpace=_.colorSpace,this.texture.generateMipmaps=_.generateMipmaps,this.texture.minFilter=_.minFilter,this.texture.magFilter=_.magFilter;const K={uniforms:{tEquirect:{value:null}},vertexShader:`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,fragmentShader:`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`},te=new BoxGeometry(5,5,5),ne=new ShaderMaterial({name:"CubemapFromEquirect",uniforms:cloneUniforms(K.uniforms),vertexShader:K.vertexShader,fragmentShader:K.fragmentShader,side:BackSide,blending:NoBlending});ne.uniforms.tEquirect.value=_;const ie=new Mesh(te,ne),oe=_.minFilter;return _.minFilter===LinearMipmapLinearFilter&&(_.minFilter=LinearFilter),new CubeCamera(1,10,this).update(Z,ie),_.minFilter=oe,ie.geometry.dispose(),ie.material.dispose(),this}clear(Z,_,K,te){const ne=Z.getRenderTarget();for(let ie=0;ie<6;ie++)Z.setRenderTarget(this,ie),Z.clear(_,K,te);Z.setRenderTarget(ne)}}class FogExp2{constructor(Z,_=25e-5){this.isFogExp2=!0,this.name="",this.color=new Color$1(Z),this.density=_}clone(){return new FogExp2(this.color,this.density)}toJSON(){return{type:"FogExp2",name:this.name,color:this.color.getHex(),density:this.density}}}class Fog{constructor(Z,_=1,K=1e3){this.isFog=!0,this.name="",this.color=new Color$1(Z),this.near=_,this.far=K}clone(){return new Fog(this.color,this.near,this.far)}toJSON(){return{type:"Fog",name:this.name,color:this.color.getHex(),near:this.near,far:this.far}}}let Scene$1=class extends Object3D{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.backgroundRotation=new Euler,this.environmentIntensity=1,this.environmentRotation=new Euler,this.overrideMaterial=null,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(Z,_){return super.copy(Z,_),Z.background!==null&&(this.background=Z.background.clone()),Z.environment!==null&&(this.environment=Z.environment.clone()),Z.fog!==null&&(this.fog=Z.fog.clone()),this.backgroundBlurriness=Z.backgroundBlurriness,this.backgroundIntensity=Z.backgroundIntensity,this.backgroundRotation.copy(Z.backgroundRotation),this.environmentIntensity=Z.environmentIntensity,this.environmentRotation.copy(Z.environmentRotation),Z.overrideMaterial!==null&&(this.overrideMaterial=Z.overrideMaterial.clone()),this.matrixAutoUpdate=Z.matrixAutoUpdate,this}toJSON(Z){const _=super.toJSON(Z);return this.fog!==null&&(_.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(_.object.backgroundBlurriness=this.backgroundBlurriness),this.backgroundIntensity!==1&&(_.object.backgroundIntensity=this.backgroundIntensity),_.object.backgroundRotation=this.backgroundRotation.toArray(),this.environmentIntensity!==1&&(_.object.environmentIntensity=this.environmentIntensity),_.object.environmentRotation=this.environmentRotation.toArray(),_}};class InterleavedBuffer{constructor(Z,_){this.isInterleavedBuffer=!0,this.array=Z,this.stride=_,this.count=Z!==void 0?Z.length/_:0,this.usage=StaticDrawUsage,this.updateRanges=[],this.version=0,this.uuid=generateUUID$1()}onUploadCallback(){}set needsUpdate(Z){Z===!0&&this.version++}setUsage(Z){return this.usage=Z,this}addUpdateRange(Z,_){this.updateRanges.push({start:Z,count:_})}clearUpdateRanges(){this.updateRanges.length=0}copy(Z){return this.array=new Z.array.constructor(Z.array),this.count=Z.count,this.stride=Z.stride,this.usage=Z.usage,this}copyAt(Z,_,K){Z*=this.stride,K*=_.stride;for(let te=0,ne=this.stride;te<ne;te++)this.array[Z+te]=_.array[K+te];return this}set(Z,_=0){return this.array.set(Z,_),this}clone(Z){Z.arrayBuffers===void 0&&(Z.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=generateUUID$1()),Z.arrayBuffers[this.array.buffer._uuid]===void 0&&(Z.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const _=new this.array.constructor(Z.arrayBuffers[this.array.buffer._uuid]),K=new this.constructor(_,this.stride);return K.setUsage(this.usage),K}onUpload(Z){return this.onUploadCallback=Z,this}toJSON(Z){return Z.arrayBuffers===void 0&&(Z.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=generateUUID$1()),Z.arrayBuffers[this.array.buffer._uuid]===void 0&&(Z.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}const _vector$7=new Vector3;class InterleavedBufferAttribute{constructor(Z,_,K,te=!1){this.isInterleavedBufferAttribute=!0,this.name="",this.data=Z,this.itemSize=_,this.offset=K,this.normalized=te}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(Z){this.data.needsUpdate=Z}applyMatrix4(Z){for(let _=0,K=this.data.count;_<K;_++)_vector$7.fromBufferAttribute(this,_),_vector$7.applyMatrix4(Z),this.setXYZ(_,_vector$7.x,_vector$7.y,_vector$7.z);return this}applyNormalMatrix(Z){for(let _=0,K=this.count;_<K;_++)_vector$7.fromBufferAttribute(this,_),_vector$7.applyNormalMatrix(Z),this.setXYZ(_,_vector$7.x,_vector$7.y,_vector$7.z);return this}transformDirection(Z){for(let _=0,K=this.count;_<K;_++)_vector$7.fromBufferAttribute(this,_),_vector$7.transformDirection(Z),this.setXYZ(_,_vector$7.x,_vector$7.y,_vector$7.z);return this}getComponent(Z,_){let K=this.array[Z*this.data.stride+this.offset+_];return this.normalized&&(K=denormalize(K,this.array)),K}setComponent(Z,_,K){return this.normalized&&(K=normalize$5(K,this.array)),this.data.array[Z*this.data.stride+this.offset+_]=K,this}setX(Z,_){return this.normalized&&(_=normalize$5(_,this.array)),this.data.array[Z*this.data.stride+this.offset]=_,this}setY(Z,_){return this.normalized&&(_=normalize$5(_,this.array)),this.data.array[Z*this.data.stride+this.offset+1]=_,this}setZ(Z,_){return this.normalized&&(_=normalize$5(_,this.array)),this.data.array[Z*this.data.stride+this.offset+2]=_,this}setW(Z,_){return this.normalized&&(_=normalize$5(_,this.array)),this.data.array[Z*this.data.stride+this.offset+3]=_,this}getX(Z){let _=this.data.array[Z*this.data.stride+this.offset];return this.normalized&&(_=denormalize(_,this.array)),_}getY(Z){let _=this.data.array[Z*this.data.stride+this.offset+1];return this.normalized&&(_=denormalize(_,this.array)),_}getZ(Z){let _=this.data.array[Z*this.data.stride+this.offset+2];return this.normalized&&(_=denormalize(_,this.array)),_}getW(Z){let _=this.data.array[Z*this.data.stride+this.offset+3];return this.normalized&&(_=denormalize(_,this.array)),_}setXY(Z,_,K){return Z=Z*this.data.stride+this.offset,this.normalized&&(_=normalize$5(_,this.array),K=normalize$5(K,this.array)),this.data.array[Z+0]=_,this.data.array[Z+1]=K,this}setXYZ(Z,_,K,te){return Z=Z*this.data.stride+this.offset,this.normalized&&(_=normalize$5(_,this.array),K=normalize$5(K,this.array),te=normalize$5(te,this.array)),this.data.array[Z+0]=_,this.data.array[Z+1]=K,this.data.array[Z+2]=te,this}setXYZW(Z,_,K,te,ne){return Z=Z*this.data.stride+this.offset,this.normalized&&(_=normalize$5(_,this.array),K=normalize$5(K,this.array),te=normalize$5(te,this.array),ne=normalize$5(ne,this.array)),this.data.array[Z+0]=_,this.data.array[Z+1]=K,this.data.array[Z+2]=te,this.data.array[Z+3]=ne,this}clone(Z){if(Z===void 0){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will de-interleave buffer data.");const _=[];for(let K=0;K<this.count;K++){const te=K*this.data.stride+this.offset;for(let ne=0;ne<this.itemSize;ne++)_.push(this.data.array[te+ne])}return new BufferAttribute(new this.array.constructor(_),this.itemSize,this.normalized)}else return Z.interleavedBuffers===void 0&&(Z.interleavedBuffers={}),Z.interleavedBuffers[this.data.uuid]===void 0&&(Z.interleavedBuffers[this.data.uuid]=this.data.clone(Z)),new InterleavedBufferAttribute(Z.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(Z){if(Z===void 0){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will de-interleave buffer data.");const _=[];for(let K=0;K<this.count;K++){const te=K*this.data.stride+this.offset;for(let ne=0;ne<this.itemSize;ne++)_.push(this.data.array[te+ne])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:_,normalized:this.normalized}}else return Z.interleavedBuffers===void 0&&(Z.interleavedBuffers={}),Z.interleavedBuffers[this.data.uuid]===void 0&&(Z.interleavedBuffers[this.data.uuid]=this.data.toJSON(Z)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}class SpriteMaterial extends Material{constructor(Z){super(),this.isSpriteMaterial=!0,this.type="SpriteMaterial",this.color=new Color$1(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.fog=!0,this.setValues(Z)}copy(Z){return super.copy(Z),this.color.copy(Z.color),this.map=Z.map,this.alphaMap=Z.alphaMap,this.rotation=Z.rotation,this.sizeAttenuation=Z.sizeAttenuation,this.fog=Z.fog,this}}let _geometry;const _intersectPoint=new Vector3,_worldScale=new Vector3,_mvPosition=new Vector3,_alignedPosition=new Vector2,_rotatedPosition=new Vector2,_viewWorldMatrix=new Matrix4,_vA=new Vector3,_vB=new Vector3,_vC=new Vector3,_uvA=new Vector2,_uvB=new Vector2,_uvC=new Vector2;class Sprite extends Object3D{constructor(Z=new SpriteMaterial){if(super(),this.isSprite=!0,this.type="Sprite",_geometry===void 0){_geometry=new BufferGeometry;const _=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),K=new InterleavedBuffer(_,5);_geometry.setIndex([0,1,2,0,2,3]),_geometry.setAttribute("position",new InterleavedBufferAttribute(K,3,0,!1)),_geometry.setAttribute("uv",new InterleavedBufferAttribute(K,2,3,!1))}this.geometry=_geometry,this.material=Z,this.center=new Vector2(.5,.5)}raycast(Z,_){Z.camera===null&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),_worldScale.setFromMatrixScale(this.matrixWorld),_viewWorldMatrix.copy(Z.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(Z.camera.matrixWorldInverse,this.matrixWorld),_mvPosition.setFromMatrixPosition(this.modelViewMatrix),Z.camera.isPerspectiveCamera&&this.material.sizeAttenuation===!1&&_worldScale.multiplyScalar(-_mvPosition.z);const K=this.material.rotation;let te,ne;K!==0&&(ne=Math.cos(K),te=Math.sin(K));const ie=this.center;transformVertex(_vA.set(-.5,-.5,0),_mvPosition,ie,_worldScale,te,ne),transformVertex(_vB.set(.5,-.5,0),_mvPosition,ie,_worldScale,te,ne),transformVertex(_vC.set(.5,.5,0),_mvPosition,ie,_worldScale,te,ne),_uvA.set(0,0),_uvB.set(1,0),_uvC.set(1,1);let oe=Z.ray.intersectTriangle(_vA,_vB,_vC,!1,_intersectPoint);if(oe===null&&(transformVertex(_vB.set(-.5,.5,0),_mvPosition,ie,_worldScale,te,ne),_uvB.set(0,1),oe=Z.ray.intersectTriangle(_vA,_vC,_vB,!1,_intersectPoint),oe===null))return;const se=Z.ray.origin.distanceTo(_intersectPoint);se<Z.near||se>Z.far||_.push({distance:se,point:_intersectPoint.clone(),uv:Triangle.getInterpolation(_intersectPoint,_vA,_vB,_vC,_uvA,_uvB,_uvC,new Vector2),face:null,object:this})}copy(Z,_){return super.copy(Z,_),Z.center!==void 0&&this.center.copy(Z.center),this.material=Z.material,this}}function transformVertex(X,Z,_,K,te,ne){_alignedPosition.subVectors(X,_).addScalar(.5).multiply(K),te!==void 0?(_rotatedPosition.x=ne*_alignedPosition.x-te*_alignedPosition.y,_rotatedPosition.y=te*_alignedPosition.x+ne*_alignedPosition.y):_rotatedPosition.copy(_alignedPosition),X.copy(Z),X.x+=_rotatedPosition.x,X.y+=_rotatedPosition.y,X.applyMatrix4(_viewWorldMatrix)}const _v1$2=new Vector3,_v2$1=new Vector3;class LOD extends Object3D{constructor(){super(),this._currentLevel=0,this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]},isLOD:{value:!0}}),this.autoUpdate=!0}copy(Z){super.copy(Z,!1);const _=Z.levels;for(let K=0,te=_.length;K<te;K++){const ne=_[K];this.addLevel(ne.object.clone(),ne.distance,ne.hysteresis)}return this.autoUpdate=Z.autoUpdate,this}addLevel(Z,_=0,K=0){_=Math.abs(_);const te=this.levels;let ne;for(ne=0;ne<te.length&&!(_<te[ne].distance);ne++);return te.splice(ne,0,{distance:_,hysteresis:K,object:Z}),this.add(Z),this}removeLevel(Z){const _=this.levels;for(let K=0;K<_.length;K++)if(_[K].distance===Z){const te=_.splice(K,1);return this.remove(te[0].object),!0}return!1}getCurrentLevel(){return this._currentLevel}getObjectForDistance(Z){const _=this.levels;if(_.length>0){let K,te;for(K=1,te=_.length;K<te;K++){let ne=_[K].distance;if(_[K].object.visible&&(ne-=ne*_[K].hysteresis),Z<ne)break}return _[K-1].object}return null}raycast(Z,_){if(this.levels.length>0){_v1$2.setFromMatrixPosition(this.matrixWorld);const te=Z.ray.origin.distanceTo(_v1$2);this.getObjectForDistance(te).raycast(Z,_)}}update(Z){const _=this.levels;if(_.length>1){_v1$2.setFromMatrixPosition(Z.matrixWorld),_v2$1.setFromMatrixPosition(this.matrixWorld);const K=_v1$2.distanceTo(_v2$1)/Z.zoom;_[0].object.visible=!0;let te,ne;for(te=1,ne=_.length;te<ne;te++){let ie=_[te].distance;if(_[te].object.visible&&(ie-=ie*_[te].hysteresis),K>=ie)_[te-1].object.visible=!1,_[te].object.visible=!0;else break}for(this._currentLevel=te-1;te<ne;te++)_[te].object.visible=!1}}toJSON(Z){const _=super.toJSON(Z);this.autoUpdate===!1&&(_.object.autoUpdate=!1),_.object.levels=[];const K=this.levels;for(let te=0,ne=K.length;te<ne;te++){const ie=K[te];_.object.levels.push({object:ie.object.uuid,distance:ie.distance,hysteresis:ie.hysteresis})}return _}}const _basePosition=new Vector3,_skinIndex=new Vector4,_skinWeight=new Vector4,_vector3=new Vector3,_matrix4=new Matrix4,_vertex=new Vector3,_sphere$5=new Sphere,_inverseMatrix$2=new Matrix4,_ray$2=new Ray$2;class SkinnedMesh extends Mesh{constructor(Z,_){super(Z,_),this.isSkinnedMesh=!0,this.type="SkinnedMesh",this.bindMode=AttachedBindMode,this.bindMatrix=new Matrix4,this.bindMatrixInverse=new Matrix4,this.boundingBox=null,this.boundingSphere=null}computeBoundingBox(){const Z=this.geometry;this.boundingBox===null&&(this.boundingBox=new Box3),this.boundingBox.makeEmpty();const _=Z.getAttribute("position");for(let K=0;K<_.count;K++)this.getVertexPosition(K,_vertex),this.boundingBox.expandByPoint(_vertex)}computeBoundingSphere(){const Z=this.geometry;this.boundingSphere===null&&(this.boundingSphere=new Sphere),this.boundingSphere.makeEmpty();const _=Z.getAttribute("position");for(let K=0;K<_.count;K++)this.getVertexPosition(K,_vertex),this.boundingSphere.expandByPoint(_vertex)}copy(Z,_){return super.copy(Z,_),this.bindMode=Z.bindMode,this.bindMatrix.copy(Z.bindMatrix),this.bindMatrixInverse.copy(Z.bindMatrixInverse),this.skeleton=Z.skeleton,Z.boundingBox!==null&&(this.boundingBox=Z.boundingBox.clone()),Z.boundingSphere!==null&&(this.boundingSphere=Z.boundingSphere.clone()),this}raycast(Z,_){const K=this.material,te=this.matrixWorld;K!==void 0&&(this.boundingSphere===null&&this.computeBoundingSphere(),_sphere$5.copy(this.boundingSphere),_sphere$5.applyMatrix4(te),Z.ray.intersectsSphere(_sphere$5)!==!1&&(_inverseMatrix$2.copy(te).invert(),_ray$2.copy(Z.ray).applyMatrix4(_inverseMatrix$2),!(this.boundingBox!==null&&_ray$2.intersectsBox(this.boundingBox)===!1)&&this._computeIntersections(Z,_,_ray$2)))}getVertexPosition(Z,_){return super.getVertexPosition(Z,_),this.applyBoneTransform(Z,_),_}bind(Z,_){this.skeleton=Z,_===void 0&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),_=this.matrixWorld),this.bindMatrix.copy(_),this.bindMatrixInverse.copy(_).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const Z=new Vector4,_=this.geometry.attributes.skinWeight;for(let K=0,te=_.count;K<te;K++){Z.fromBufferAttribute(_,K);const ne=1/Z.manhattanLength();ne!==1/0?Z.multiplyScalar(ne):Z.set(1,0,0,0),_.setXYZW(K,Z.x,Z.y,Z.z,Z.w)}}updateMatrixWorld(Z){super.updateMatrixWorld(Z),this.bindMode===AttachedBindMode?this.bindMatrixInverse.copy(this.matrixWorld).invert():this.bindMode===DetachedBindMode?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}applyBoneTransform(Z,_){const K=this.skeleton,te=this.geometry;_skinIndex.fromBufferAttribute(te.attributes.skinIndex,Z),_skinWeight.fromBufferAttribute(te.attributes.skinWeight,Z),_basePosition.copy(_).applyMatrix4(this.bindMatrix),_.set(0,0,0);for(let ne=0;ne<4;ne++){const ie=_skinWeight.getComponent(ne);if(ie!==0){const oe=_skinIndex.getComponent(ne);_matrix4.multiplyMatrices(K.bones[oe].matrixWorld,K.boneInverses[oe]),_.addScaledVector(_vector3.copy(_basePosition).applyMatrix4(_matrix4),ie)}}return _.applyMatrix4(this.bindMatrixInverse)}}class Bone extends Object3D{constructor(){super(),this.isBone=!0,this.type="Bone"}}class DataTexture extends Texture{constructor(Z=null,_=1,K=1,te,ne,ie,oe,se,ae=NearestFilter,ge=NearestFilter,ce,de){super(null,ie,oe,se,ae,ge,te,ne,ce,de),this.isDataTexture=!0,this.image={data:Z,width:_,height:K},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}const _offsetMatrix=new Matrix4,_identityMatrix$1=new Matrix4;class Skeleton{constructor(Z=[],_=[]){this.uuid=generateUUID$1(),this.bones=Z.slice(0),this.boneInverses=_,this.boneMatrices=null,this.boneTexture=null,this.init()}init(){const Z=this.bones,_=this.boneInverses;if(this.boneMatrices=new Float32Array(Z.length*16),_.length===0)this.calculateInverses();else if(Z.length!==_.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let K=0,te=this.bones.length;K<te;K++)this.boneInverses.push(new Matrix4)}}calculateInverses(){this.boneInverses.length=0;for(let Z=0,_=this.bones.length;Z<_;Z++){const K=new Matrix4;this.bones[Z]&&K.copy(this.bones[Z].matrixWorld).invert(),this.boneInverses.push(K)}}pose(){for(let Z=0,_=this.bones.length;Z<_;Z++){const K=this.bones[Z];K&&K.matrixWorld.copy(this.boneInverses[Z]).invert()}for(let Z=0,_=this.bones.length;Z<_;Z++){const K=this.bones[Z];K&&(K.parent&&K.parent.isBone?(K.matrix.copy(K.parent.matrixWorld).invert(),K.matrix.multiply(K.matrixWorld)):K.matrix.copy(K.matrixWorld),K.matrix.decompose(K.position,K.quaternion,K.scale))}}update(){const Z=this.bones,_=this.boneInverses,K=this.boneMatrices,te=this.boneTexture;for(let ne=0,ie=Z.length;ne<ie;ne++){const oe=Z[ne]?Z[ne].matrixWorld:_identityMatrix$1;_offsetMatrix.multiplyMatrices(oe,_[ne]),_offsetMatrix.toArray(K,ne*16)}te!==null&&(te.needsUpdate=!0)}clone(){return new Skeleton(this.bones,this.boneInverses)}computeBoneTexture(){let Z=Math.sqrt(this.bones.length*4);Z=Math.ceil(Z/4)*4,Z=Math.max(Z,4);const _=new Float32Array(Z*Z*4);_.set(this.boneMatrices);const K=new DataTexture(_,Z,Z,RGBAFormat,FloatType);return K.needsUpdate=!0,this.boneMatrices=_,this.boneTexture=K,this}getBoneByName(Z){for(let _=0,K=this.bones.length;_<K;_++){const te=this.bones[_];if(te.name===Z)return te}}dispose(){this.boneTexture!==null&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(Z,_){this.uuid=Z.uuid;for(let K=0,te=Z.bones.length;K<te;K++){const ne=Z.bones[K];let ie=_[ne];ie===void 0&&(console.warn("THREE.Skeleton: No bone found with UUID:",ne),ie=new Bone),this.bones.push(ie),this.boneInverses.push(new Matrix4().fromArray(Z.boneInverses[K]))}return this.init(),this}toJSON(){const Z={metadata:{version:4.6,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};Z.uuid=this.uuid;const _=this.bones,K=this.boneInverses;for(let te=0,ne=_.length;te<ne;te++){const ie=_[te];Z.bones.push(ie.uuid);const oe=K[te];Z.boneInverses.push(oe.toArray())}return Z}}class InstancedBufferAttribute extends BufferAttribute{constructor(Z,_,K,te=1){super(Z,_,K),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=te}copy(Z){return super.copy(Z),this.meshPerAttribute=Z.meshPerAttribute,this}toJSON(){const Z=super.toJSON();return Z.meshPerAttribute=this.meshPerAttribute,Z.isInstancedBufferAttribute=!0,Z}}const _instanceLocalMatrix=new Matrix4,_instanceWorldMatrix=new Matrix4,_instanceIntersects=[],_box3=new Box3,_identity=new Matrix4,_mesh$1=new Mesh,_sphere$4=new Sphere;class InstancedMesh extends Mesh{constructor(Z,_,K){super(Z,_),this.isInstancedMesh=!0,this.instanceMatrix=new InstancedBufferAttribute(new Float32Array(K*16),16),this.instanceColor=null,this.morphTexture=null,this.count=K,this.boundingBox=null,this.boundingSphere=null;for(let te=0;te<K;te++)this.setMatrixAt(te,_identity)}computeBoundingBox(){const Z=this.geometry,_=this.count;this.boundingBox===null&&(this.boundingBox=new Box3),Z.boundingBox===null&&Z.computeBoundingBox(),this.boundingBox.makeEmpty();for(let K=0;K<_;K++)this.getMatrixAt(K,_instanceLocalMatrix),_box3.copy(Z.boundingBox).applyMatrix4(_instanceLocalMatrix),this.boundingBox.union(_box3)}computeBoundingSphere(){const Z=this.geometry,_=this.count;this.boundingSphere===null&&(this.boundingSphere=new Sphere),Z.boundingSphere===null&&Z.computeBoundingSphere(),this.boundingSphere.makeEmpty();for(let K=0;K<_;K++)this.getMatrixAt(K,_instanceLocalMatrix),_sphere$4.copy(Z.boundingSphere).applyMatrix4(_instanceLocalMatrix),this.boundingSphere.union(_sphere$4)}copy(Z,_){return super.copy(Z,_),this.instanceMatrix.copy(Z.instanceMatrix),Z.morphTexture!==null&&(this.morphTexture=Z.morphTexture.clone()),Z.instanceColor!==null&&(this.instanceColor=Z.instanceColor.clone()),this.count=Z.count,Z.boundingBox!==null&&(this.boundingBox=Z.boundingBox.clone()),Z.boundingSphere!==null&&(this.boundingSphere=Z.boundingSphere.clone()),this}getColorAt(Z,_){_.fromArray(this.instanceColor.array,Z*3)}getMatrixAt(Z,_){_.fromArray(this.instanceMatrix.array,Z*16)}getMorphAt(Z,_){const K=_.morphTargetInfluences,te=this.morphTexture.source.data.data,ne=K.length+1,ie=Z*ne+1;for(let oe=0;oe<K.length;oe++)K[oe]=te[ie+oe]}raycast(Z,_){const K=this.matrixWorld,te=this.count;if(_mesh$1.geometry=this.geometry,_mesh$1.material=this.material,_mesh$1.material!==void 0&&(this.boundingSphere===null&&this.computeBoundingSphere(),_sphere$4.copy(this.boundingSphere),_sphere$4.applyMatrix4(K),Z.ray.intersectsSphere(_sphere$4)!==!1))for(let ne=0;ne<te;ne++){this.getMatrixAt(ne,_instanceLocalMatrix),_instanceWorldMatrix.multiplyMatrices(K,_instanceLocalMatrix),_mesh$1.matrixWorld=_instanceWorldMatrix,_mesh$1.raycast(Z,_instanceIntersects);for(let ie=0,oe=_instanceIntersects.length;ie<oe;ie++){const se=_instanceIntersects[ie];se.instanceId=ne,se.object=this,_.push(se)}_instanceIntersects.length=0}}setColorAt(Z,_){this.instanceColor===null&&(this.instanceColor=new InstancedBufferAttribute(new Float32Array(this.instanceMatrix.count*3).fill(1),3)),_.toArray(this.instanceColor.array,Z*3)}setMatrixAt(Z,_){_.toArray(this.instanceMatrix.array,Z*16)}setMorphAt(Z,_){const K=_.morphTargetInfluences,te=K.length+1;this.morphTexture===null&&(this.morphTexture=new DataTexture(new Float32Array(te*this.count),te,this.count,RedFormat,FloatType));const ne=this.morphTexture.source.data.data;let ie=0;for(let ae=0;ae<K.length;ae++)ie+=K[ae];const oe=this.geometry.morphTargetsRelative?1:1-ie,se=te*Z;ne[se]=oe,ne.set(K,se+1)}updateMorphTargets(){}dispose(){return this.dispatchEvent({type:"dispose"}),this.morphTexture!==null&&(this.morphTexture.dispose(),this.morphTexture=null),this}}const _vector1=new Vector3,_vector2=new Vector3,_normalMatrix=new Matrix3;class Plane{constructor(Z=new Vector3(1,0,0),_=0){this.isPlane=!0,this.normal=Z,this.constant=_}set(Z,_){return this.normal.copy(Z),this.constant=_,this}setComponents(Z,_,K,te){return this.normal.set(Z,_,K),this.constant=te,this}setFromNormalAndCoplanarPoint(Z,_){return this.normal.copy(Z),this.constant=-_.dot(this.normal),this}setFromCoplanarPoints(Z,_,K){const te=_vector1.subVectors(K,_).cross(_vector2.subVectors(Z,_)).normalize();return this.setFromNormalAndCoplanarPoint(te,Z),this}copy(Z){return this.normal.copy(Z.normal),this.constant=Z.constant,this}normalize(){const Z=1/this.normal.length();return this.normal.multiplyScalar(Z),this.constant*=Z,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(Z){return this.normal.dot(Z)+this.constant}distanceToSphere(Z){return this.distanceToPoint(Z.center)-Z.radius}projectPoint(Z,_){return _.copy(Z).addScaledVector(this.normal,-this.distanceToPoint(Z))}intersectLine(Z,_){const K=Z.delta(_vector1),te=this.normal.dot(K);if(te===0)return this.distanceToPoint(Z.start)===0?_.copy(Z.start):null;const ne=-(Z.start.dot(this.normal)+this.constant)/te;return ne<0||ne>1?null:_.copy(Z.start).addScaledVector(K,ne)}intersectsLine(Z){const _=this.distanceToPoint(Z.start),K=this.distanceToPoint(Z.end);return _<0&&K>0||K<0&&_>0}intersectsBox(Z){return Z.intersectsPlane(this)}intersectsSphere(Z){return Z.intersectsPlane(this)}coplanarPoint(Z){return Z.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(Z,_){const K=_||_normalMatrix.getNormalMatrix(Z),te=this.coplanarPoint(_vector1).applyMatrix4(Z),ne=this.normal.applyMatrix3(K).normalize();return this.constant=-te.dot(ne),this}translate(Z){return this.constant-=Z.dot(this.normal),this}equals(Z){return Z.normal.equals(this.normal)&&Z.constant===this.constant}clone(){return new this.constructor().copy(this)}}const _sphere$3=new Sphere,_vector$6=new Vector3;class Frustum{constructor(Z=new Plane,_=new Plane,K=new Plane,te=new Plane,ne=new Plane,ie=new Plane){this.planes=[Z,_,K,te,ne,ie]}set(Z,_,K,te,ne,ie){const oe=this.planes;return oe[0].copy(Z),oe[1].copy(_),oe[2].copy(K),oe[3].copy(te),oe[4].copy(ne),oe[5].copy(ie),this}copy(Z){const _=this.planes;for(let K=0;K<6;K++)_[K].copy(Z.planes[K]);return this}setFromProjectionMatrix(Z,_=WebGLCoordinateSystem){const K=this.planes,te=Z.elements,ne=te[0],ie=te[1],oe=te[2],se=te[3],ae=te[4],ge=te[5],ce=te[6],de=te[7],Ie=te[8],fe=te[9],be=te[10],Ae=te[11],ye=te[12],ve=te[13],Be=te[14],Re=te[15];if(K[0].setComponents(se-ne,de-ae,Ae-Ie,Re-ye).normalize(),K[1].setComponents(se+ne,de+ae,Ae+Ie,Re+ye).normalize(),K[2].setComponents(se+ie,de+ge,Ae+fe,Re+ve).normalize(),K[3].setComponents(se-ie,de-ge,Ae-fe,Re-ve).normalize(),K[4].setComponents(se-oe,de-ce,Ae-be,Re-Be).normalize(),_===WebGLCoordinateSystem)K[5].setComponents(se+oe,de+ce,Ae+be,Re+Be).normalize();else if(_===WebGPUCoordinateSystem)K[5].setComponents(oe,ce,be,Be).normalize();else throw new Error("THREE.Frustum.setFromProjectionMatrix(): Invalid coordinate system: "+_);return this}intersectsObject(Z){if(Z.boundingSphere!==void 0)Z.boundingSphere===null&&Z.computeBoundingSphere(),_sphere$3.copy(Z.boundingSphere).applyMatrix4(Z.matrixWorld);else{const _=Z.geometry;_.boundingSphere===null&&_.computeBoundingSphere(),_sphere$3.copy(_.boundingSphere).applyMatrix4(Z.matrixWorld)}return this.intersectsSphere(_sphere$3)}intersectsSprite(Z){return _sphere$3.center.set(0,0,0),_sphere$3.radius=.7071067811865476,_sphere$3.applyMatrix4(Z.matrixWorld),this.intersectsSphere(_sphere$3)}intersectsSphere(Z){const _=this.planes,K=Z.center,te=-Z.radius;for(let ne=0;ne<6;ne++)if(_[ne].distanceToPoint(K)<te)return!1;return!0}intersectsBox(Z){const _=this.planes;for(let K=0;K<6;K++){const te=_[K];if(_vector$6.x=te.normal.x>0?Z.max.x:Z.min.x,_vector$6.y=te.normal.y>0?Z.max.y:Z.min.y,_vector$6.z=te.normal.z>0?Z.max.z:Z.min.z,te.distanceToPoint(_vector$6)<0)return!1}return!0}containsPoint(Z){const _=this.planes;for(let K=0;K<6;K++)if(_[K].distanceToPoint(Z)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}}function ascIdSort(X,Z){return X-Z}function sortOpaque(X,Z){return X.z-Z.z}function sortTransparent(X,Z){return Z.z-X.z}class MultiDrawRenderList{constructor(){this.index=0,this.pool=[],this.list=[]}push(Z,_,K,te){const ne=this.pool,ie=this.list;this.index>=ne.length&&ne.push({start:-1,count:-1,z:-1,index:-1});const oe=ne[this.index];ie.push(oe),this.index++,oe.start=Z,oe.count=_,oe.z=K,oe.index=te}reset(){this.list.length=0,this.index=0}}const _matrix$1=new Matrix4,_whiteColor=new Color$1(1,1,1),_frustum=new Frustum,_box$1=new Box3,_sphere$2=new Sphere,_vector$5=new Vector3,_forward=new Vector3,_temp=new Vector3,_renderList=new MultiDrawRenderList,_mesh=new Mesh,_batchIntersects=[];function copyAttributeData(X,Z,_=0){const K=Z.itemSize;if(X.isInterleavedBufferAttribute||X.array.constructor!==Z.array.constructor){const te=X.count;for(let ne=0;ne<te;ne++)for(let ie=0;ie<K;ie++)Z.setComponent(ne+_,ie,X.getComponent(ne,ie))}else Z.array.set(X.array,_*K);Z.needsUpdate=!0}function copyArrayContents(X,Z){if(X.constructor!==Z.constructor){const _=Math.min(X.length,Z.length);for(let K=0;K<_;K++)Z[K]=X[K]}else{const _=Math.min(X.length,Z.length);Z.set(new X.constructor(X.buffer,0,_))}}class BatchedMesh extends Mesh{get maxInstanceCount(){return this._maxInstanceCount}get instanceCount(){return this._instanceInfo.length-this._availableInstanceIds.length}get unusedVertexCount(){return this._maxVertexCount-this._nextVertexStart}get unusedIndexCount(){return this._maxIndexCount-this._nextIndexStart}constructor(Z,_,K=_*2,te){super(new BufferGeometry,te),this.isBatchedMesh=!0,this.perObjectFrustumCulled=!0,this.sortObjects=!0,this.boundingBox=null,this.boundingSphere=null,this.customSort=null,this._instanceInfo=[],this._geometryInfo=[],this._availableInstanceIds=[],this._availableGeometryIds=[],this._nextIndexStart=0,this._nextVertexStart=0,this._geometryCount=0,this._visibilityChanged=!0,this._geometryInitialized=!1,this._maxInstanceCount=Z,this._maxVertexCount=_,this._maxIndexCount=K,this._multiDrawCounts=new Int32Array(Z),this._multiDrawStarts=new Int32Array(Z),this._multiDrawCount=0,this._multiDrawInstances=null,this._matricesTexture=null,this._indirectTexture=null,this._colorsTexture=null,this._initMatricesTexture(),this._initIndirectTexture()}_initMatricesTexture(){let Z=Math.sqrt(this._maxInstanceCount*4);Z=Math.ceil(Z/4)*4,Z=Math.max(Z,4);const _=new Float32Array(Z*Z*4),K=new DataTexture(_,Z,Z,RGBAFormat,FloatType);this._matricesTexture=K}_initIndirectTexture(){let Z=Math.sqrt(this._maxInstanceCount);Z=Math.ceil(Z);const _=new Uint32Array(Z*Z),K=new DataTexture(_,Z,Z,RedIntegerFormat,UnsignedIntType);this._indirectTexture=K}_initColorsTexture(){let Z=Math.sqrt(this._maxInstanceCount);Z=Math.ceil(Z);const _=new Float32Array(Z*Z*4).fill(1),K=new DataTexture(_,Z,Z,RGBAFormat,FloatType);K.colorSpace=ColorManagement.workingColorSpace,this._colorsTexture=K}_initializeGeometry(Z){const _=this.geometry,K=this._maxVertexCount,te=this._maxIndexCount;if(this._geometryInitialized===!1){for(const ne in Z.attributes){const ie=Z.getAttribute(ne),{array:oe,itemSize:se,normalized:ae}=ie,ge=new oe.constructor(K*se),ce=new BufferAttribute(ge,se,ae);_.setAttribute(ne,ce)}if(Z.getIndex()!==null){const ne=K>65535?new Uint32Array(te):new Uint16Array(te);_.setIndex(new BufferAttribute(ne,1))}this._geometryInitialized=!0}}_validateGeometry(Z){const _=this.geometry;if(!!Z.getIndex()!=!!_.getIndex())throw new Error('THREE.BatchedMesh: All geometries must consistently have "index".');for(const K in _.attributes){if(!Z.hasAttribute(K))throw new Error(`THREE.BatchedMesh: Added geometry missing "${K}". All geometries must have consistent attributes.`);const te=Z.getAttribute(K),ne=_.getAttribute(K);if(te.itemSize!==ne.itemSize||te.normalized!==ne.normalized)throw new Error("THREE.BatchedMesh: All attributes must have a consistent itemSize and normalized value.")}}validateInstanceId(Z){const _=this._instanceInfo;if(Z<0||Z>=_.length||_[Z].active===!1)throw new Error(`THREE.BatchedMesh: Invalid instanceId ${Z}. Instance is either out of range or has been deleted.`)}validateGeometryId(Z){const _=this._geometryInfo;if(Z<0||Z>=_.length||_[Z].active===!1)throw new Error(`THREE.BatchedMesh: Invalid geometryId ${Z}. Geometry is either out of range or has been deleted.`)}setCustomSort(Z){return this.customSort=Z,this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new Box3);const Z=this.boundingBox,_=this._instanceInfo;Z.makeEmpty();for(let K=0,te=_.length;K<te;K++){if(_[K].active===!1)continue;const ne=_[K].geometryIndex;this.getMatrixAt(K,_matrix$1),this.getBoundingBoxAt(ne,_box$1).applyMatrix4(_matrix$1),Z.union(_box$1)}}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new Sphere);const Z=this.boundingSphere,_=this._instanceInfo;Z.makeEmpty();for(let K=0,te=_.length;K<te;K++){if(_[K].active===!1)continue;const ne=_[K].geometryIndex;this.getMatrixAt(K,_matrix$1),this.getBoundingSphereAt(ne,_sphere$2).applyMatrix4(_matrix$1),Z.union(_sphere$2)}}addInstance(Z){if(this._instanceInfo.length>=this.maxInstanceCount&&this._availableInstanceIds.length===0)throw new Error("THREE.BatchedMesh: Maximum item count reached.");const K={visible:!0,active:!0,geometryIndex:Z};let te=null;this._availableInstanceIds.length>0?(this._availableInstanceIds.sort(ascIdSort),te=this._availableInstanceIds.shift(),this._instanceInfo[te]=K):(te=this._instanceInfo.length,this._instanceInfo.push(K));const ne=this._matricesTexture;_matrix$1.identity().toArray(ne.image.data,te*16),ne.needsUpdate=!0;const ie=this._colorsTexture;return ie&&(_whiteColor.toArray(ie.image.data,te*4),ie.needsUpdate=!0),this._visibilityChanged=!0,te}addGeometry(Z,_=-1,K=-1){this._initializeGeometry(Z),this._validateGeometry(Z);const te={vertexStart:-1,vertexCount:-1,reservedVertexCount:-1,indexStart:-1,indexCount:-1,reservedIndexCount:-1,start:-1,count:-1,boundingBox:null,boundingSphere:null,active:!0},ne=this._geometryInfo;te.vertexStart=this._nextVertexStart,te.reservedVertexCount=_===-1?Z.getAttribute("position").count:_;const ie=Z.getIndex();if(ie!==null&&(te.indexStart=this._nextIndexStart,te.reservedIndexCount=K===-1?ie.count:K),te.indexStart!==-1&&te.indexStart+te.reservedIndexCount>this._maxIndexCount||te.vertexStart+te.reservedVertexCount>this._maxVertexCount)throw new Error("THREE.BatchedMesh: Reserved space request exceeds the maximum buffer size.");let se;return this._availableGeometryIds.length>0?(this._availableGeometryIds.sort(ascIdSort),se=this._availableGeometryIds.shift(),ne[se]=te):(se=this._geometryCount,this._geometryCount++,ne.push(te)),this.setGeometryAt(se,Z),this._nextIndexStart=te.indexStart+te.reservedIndexCount,this._nextVertexStart=te.vertexStart+te.reservedVertexCount,se}setGeometryAt(Z,_){if(Z>=this._geometryCount)throw new Error("THREE.BatchedMesh: Maximum geometry count reached.");this._validateGeometry(_);const K=this.geometry,te=K.getIndex()!==null,ne=K.getIndex(),ie=_.getIndex(),oe=this._geometryInfo[Z];if(te&&ie.count>oe.reservedIndexCount||_.attributes.position.count>oe.reservedVertexCount)throw new Error("THREE.BatchedMesh: Reserved space not large enough for provided geometry.");const se=oe.vertexStart,ae=oe.reservedVertexCount;oe.vertexCount=_.getAttribute("position").count;for(const ge in K.attributes){const ce=_.getAttribute(ge),de=K.getAttribute(ge);copyAttributeData(ce,de,se);const Ie=ce.itemSize;for(let fe=ce.count,be=ae;fe<be;fe++){const Ae=se+fe;for(let ye=0;ye<Ie;ye++)de.setComponent(Ae,ye,0)}de.needsUpdate=!0,de.addUpdateRange(se*Ie,ae*Ie)}if(te){const ge=oe.indexStart,ce=oe.reservedIndexCount;oe.indexCount=_.getIndex().count;for(let de=0;de<ie.count;de++)ne.setX(ge+de,se+ie.getX(de));for(let de=ie.count,Ie=ce;de<Ie;de++)ne.setX(ge+de,se);ne.needsUpdate=!0,ne.addUpdateRange(ge,oe.reservedIndexCount)}return oe.start=te?oe.indexStart:oe.vertexStart,oe.count=te?oe.indexCount:oe.vertexCount,oe.boundingBox=null,_.boundingBox!==null&&(oe.boundingBox=_.boundingBox.clone()),oe.boundingSphere=null,_.boundingSphere!==null&&(oe.boundingSphere=_.boundingSphere.clone()),this._visibilityChanged=!0,Z}deleteGeometry(Z){const _=this._geometryInfo;if(Z>=_.length||_[Z].active===!1)return this;const K=this._instanceInfo;for(let te=0,ne=K.length;te<ne;te++)K[te].geometryIndex===Z&&this.deleteInstance(te);return _[Z].active=!1,this._availableGeometryIds.push(Z),this._visibilityChanged=!0,this}deleteInstance(Z){return this.validateInstanceId(Z),this._instanceInfo[Z].active=!1,this._availableInstanceIds.push(Z),this._visibilityChanged=!0,this}optimize(){let Z=0,_=0;const K=this._geometryInfo,te=K.map((ie,oe)=>oe).sort((ie,oe)=>K[ie].vertexStart-K[oe].vertexStart),ne=this.geometry;for(let ie=0,oe=K.length;ie<oe;ie++){const se=te[ie],ae=K[se];if(ae.active!==!1){if(ne.index!==null){if(ae.indexStart!==_){const{indexStart:ge,vertexStart:ce,reservedIndexCount:de}=ae,Ie=ne.index,fe=Ie.array,be=Z-ce;for(let Ae=ge;Ae<ge+de;Ae++)fe[Ae]=fe[Ae]+be;Ie.array.copyWithin(_,ge,ge+de),Ie.addUpdateRange(_,de),ae.indexStart=_}_+=ae.reservedIndexCount}if(ae.vertexStart!==Z){const{vertexStart:ge,reservedVertexCount:ce}=ae,de=ne.attributes;for(const Ie in de){const fe=de[Ie],{array:be,itemSize:Ae}=fe;be.copyWithin(Z*Ae,ge*Ae,(ge+ce)*Ae),fe.addUpdateRange(Z*Ae,ce*Ae)}ae.vertexStart=Z}Z+=ae.reservedVertexCount,ae.start=ne.index?ae.indexStart:ae.vertexStart,this._nextIndexStart=ne.index?ae.indexStart+ae.reservedIndexCount:0,this._nextVertexStart=ae.vertexStart+ae.reservedVertexCount}}return this}getBoundingBoxAt(Z,_){if(Z>=this._geometryCount)return null;const K=this.geometry,te=this._geometryInfo[Z];if(te.boundingBox===null){const ne=new Box3,ie=K.index,oe=K.attributes.position;for(let se=te.start,ae=te.start+te.count;se<ae;se++){let ge=se;ie&&(ge=ie.getX(ge)),ne.expandByPoint(_vector$5.fromBufferAttribute(oe,ge))}te.boundingBox=ne}return _.copy(te.boundingBox),_}getBoundingSphereAt(Z,_){if(Z>=this._geometryCount)return null;const K=this.geometry,te=this._geometryInfo[Z];if(te.boundingSphere===null){const ne=new Sphere;this.getBoundingBoxAt(Z,_box$1),_box$1.getCenter(ne.center);const ie=K.index,oe=K.attributes.position;let se=0;for(let ae=te.start,ge=te.start+te.count;ae<ge;ae++){let ce=ae;ie&&(ce=ie.getX(ce)),_vector$5.fromBufferAttribute(oe,ce),se=Math.max(se,ne.center.distanceToSquared(_vector$5))}ne.radius=Math.sqrt(se),te.boundingSphere=ne}return _.copy(te.boundingSphere),_}setMatrixAt(Z,_){this.validateInstanceId(Z);const K=this._matricesTexture,te=this._matricesTexture.image.data;return _.toArray(te,Z*16),K.needsUpdate=!0,this}getMatrixAt(Z,_){return this.validateInstanceId(Z),_.fromArray(this._matricesTexture.image.data,Z*16)}setColorAt(Z,_){return this.validateInstanceId(Z),this._colorsTexture===null&&this._initColorsTexture(),_.toArray(this._colorsTexture.image.data,Z*4),this._colorsTexture.needsUpdate=!0,this}getColorAt(Z,_){return this.validateInstanceId(Z),_.fromArray(this._colorsTexture.image.data,Z*4)}setVisibleAt(Z,_){return this.validateInstanceId(Z),this._instanceInfo[Z].visible===_?this:(this._instanceInfo[Z].visible=_,this._visibilityChanged=!0,this)}getVisibleAt(Z){return this.validateInstanceId(Z),this._instanceInfo[Z].visible}setGeometryIdAt(Z,_){return this.validateInstanceId(Z),this.validateGeometryId(_),this._instanceInfo[Z].geometryIndex=_,this}getGeometryIdAt(Z){return this.validateInstanceId(Z),this._instanceInfo[Z].geometryIndex}getGeometryRangeAt(Z,_={}){this.validateGeometryId(Z);const K=this._geometryInfo[Z];return _.vertexStart=K.vertexStart,_.vertexCount=K.vertexCount,_.reservedVertexCount=K.reservedVertexCount,_.indexStart=K.indexStart,_.indexCount=K.indexCount,_.reservedIndexCount=K.reservedIndexCount,_.start=K.start,_.count=K.count,_}setInstanceCount(Z){const _=this._availableInstanceIds,K=this._instanceInfo;for(_.sort(ascIdSort);_[_.length-1]===K.length;)K.pop(),_.pop();if(Z<K.length)throw new Error(`BatchedMesh: Instance ids outside the range ${Z} are being used. Cannot shrink instance count.`);const te=new Int32Array(Z),ne=new Int32Array(Z);copyArrayContents(this._multiDrawCounts,te),copyArrayContents(this._multiDrawStarts,ne),this._multiDrawCounts=te,this._multiDrawStarts=ne,this._maxInstanceCount=Z;const ie=this._indirectTexture,oe=this._matricesTexture,se=this._colorsTexture;ie.dispose(),this._initIndirectTexture(),copyArrayContents(ie.image.data,this._indirectTexture.image.data),oe.dispose(),this._initMatricesTexture(),copyArrayContents(oe.image.data,this._matricesTexture.image.data),se&&(se.dispose(),this._initColorsTexture(),copyArrayContents(se.image.data,this._colorsTexture.image.data))}setGeometrySize(Z,_){const K=[...this._geometryInfo].filter(oe=>oe.active);if(Math.max(...K.map(oe=>oe.vertexStart+oe.reservedVertexCount))>Z)throw new Error(`BatchedMesh: Geometry vertex values are being used outside the range ${_}. Cannot shrink further.`);if(this.geometry.index&&Math.max(...K.map(se=>se.indexStart+se.reservedIndexCount))>_)throw new Error(`BatchedMesh: Geometry index values are being used outside the range ${_}. Cannot shrink further.`);const ne=this.geometry;ne.dispose(),this._maxVertexCount=Z,this._maxIndexCount=_,this._geometryInitialized&&(this._geometryInitialized=!1,this.geometry=new BufferGeometry,this._initializeGeometry(ne));const ie=this.geometry;ne.index&&copyArrayContents(ne.index.array,ie.index.array);for(const oe in ne.attributes)copyArrayContents(ne.attributes[oe].array,ie.attributes[oe].array)}raycast(Z,_){const K=this._instanceInfo,te=this._geometryInfo,ne=this.matrixWorld,ie=this.geometry;_mesh.material=this.material,_mesh.geometry.index=ie.index,_mesh.geometry.attributes=ie.attributes,_mesh.geometry.boundingBox===null&&(_mesh.geometry.boundingBox=new Box3),_mesh.geometry.boundingSphere===null&&(_mesh.geometry.boundingSphere=new Sphere);for(let oe=0,se=K.length;oe<se;oe++){if(!K[oe].visible||!K[oe].active)continue;const ae=K[oe].geometryIndex,ge=te[ae];_mesh.geometry.setDrawRange(ge.start,ge.count),this.getMatrixAt(oe,_mesh.matrixWorld).premultiply(ne),this.getBoundingBoxAt(ae,_mesh.geometry.boundingBox),this.getBoundingSphereAt(ae,_mesh.geometry.boundingSphere),_mesh.raycast(Z,_batchIntersects);for(let ce=0,de=_batchIntersects.length;ce<de;ce++){const Ie=_batchIntersects[ce];Ie.object=this,Ie.batchId=oe,_.push(Ie)}_batchIntersects.length=0}_mesh.material=null,_mesh.geometry.index=null,_mesh.geometry.attributes={},_mesh.geometry.setDrawRange(0,1/0)}copy(Z){return super.copy(Z),this.geometry=Z.geometry.clone(),this.perObjectFrustumCulled=Z.perObjectFrustumCulled,this.sortObjects=Z.sortObjects,this.boundingBox=Z.boundingBox!==null?Z.boundingBox.clone():null,this.boundingSphere=Z.boundingSphere!==null?Z.boundingSphere.clone():null,this._geometryInfo=Z._geometryInfo.map(_=>({..._,boundingBox:_.boundingBox!==null?_.boundingBox.clone():null,boundingSphere:_.boundingSphere!==null?_.boundingSphere.clone():null})),this._instanceInfo=Z._instanceInfo.map(_=>({..._})),this._maxInstanceCount=Z._maxInstanceCount,this._maxVertexCount=Z._maxVertexCount,this._maxIndexCount=Z._maxIndexCount,this._geometryInitialized=Z._geometryInitialized,this._geometryCount=Z._geometryCount,this._multiDrawCounts=Z._multiDrawCounts.slice(),this._multiDrawStarts=Z._multiDrawStarts.slice(),this._matricesTexture=Z._matricesTexture.clone(),this._matricesTexture.image.data=this._matricesTexture.image.data.slice(),this._colorsTexture!==null&&(this._colorsTexture=Z._colorsTexture.clone(),this._colorsTexture.image.data=this._colorsTexture.image.data.slice()),this}dispose(){return this.geometry.dispose(),this._matricesTexture.dispose(),this._matricesTexture=null,this._indirectTexture.dispose(),this._indirectTexture=null,this._colorsTexture!==null&&(this._colorsTexture.dispose(),this._colorsTexture=null),this}onBeforeRender(Z,_,K,te,ne){if(!this._visibilityChanged&&!this.perObjectFrustumCulled&&!this.sortObjects)return;const ie=te.getIndex(),oe=ie===null?1:ie.array.BYTES_PER_ELEMENT,se=this._instanceInfo,ae=this._multiDrawStarts,ge=this._multiDrawCounts,ce=this._geometryInfo,de=this.perObjectFrustumCulled,Ie=this._indirectTexture,fe=Ie.image.data;de&&(_matrix$1.multiplyMatrices(K.projectionMatrix,K.matrixWorldInverse).multiply(this.matrixWorld),_frustum.setFromProjectionMatrix(_matrix$1,Z.coordinateSystem));let be=0;if(this.sortObjects){_matrix$1.copy(this.matrixWorld).invert(),_vector$5.setFromMatrixPosition(K.matrixWorld).applyMatrix4(_matrix$1),_forward.set(0,0,-1).transformDirection(K.matrixWorld).transformDirection(_matrix$1);for(let ve=0,Be=se.length;ve<Be;ve++)if(se[ve].visible&&se[ve].active){const Re=se[ve].geometryIndex;this.getMatrixAt(ve,_matrix$1),this.getBoundingSphereAt(Re,_sphere$2).applyMatrix4(_matrix$1);let Ve=!1;if(de&&(Ve=!_frustum.intersectsSphere(_sphere$2)),!Ve){const Ee=ce[Re],Ze=_temp.subVectors(_sphere$2.center,_vector$5).dot(_forward);_renderList.push(Ee.start,Ee.count,Ze,ve)}}const Ae=_renderList.list,ye=this.customSort;ye===null?Ae.sort(ne.transparent?sortTransparent:sortOpaque):ye.call(this,Ae,K);for(let ve=0,Be=Ae.length;ve<Be;ve++){const Re=Ae[ve];ae[be]=Re.start*oe,ge[be]=Re.count,fe[be]=Re.index,be++}_renderList.reset()}else for(let Ae=0,ye=se.length;Ae<ye;Ae++)if(se[Ae].visible&&se[Ae].active){const ve=se[Ae].geometryIndex;let Be=!1;if(de&&(this.getMatrixAt(Ae,_matrix$1),this.getBoundingSphereAt(ve,_sphere$2).applyMatrix4(_matrix$1),Be=!_frustum.intersectsSphere(_sphere$2)),!Be){const Re=ce[ve];ae[be]=Re.start*oe,ge[be]=Re.count,fe[be]=Ae,be++}}Ie.needsUpdate=!0,this._multiDrawCount=be,this._visibilityChanged=!1}onBeforeShadow(Z,_,K,te,ne,ie){this.onBeforeRender(Z,null,te,ne,ie)}}class LineBasicMaterial extends Material{constructor(Z){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new Color$1(16777215),this.map=null,this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(Z)}copy(Z){return super.copy(Z),this.color.copy(Z.color),this.map=Z.map,this.linewidth=Z.linewidth,this.linecap=Z.linecap,this.linejoin=Z.linejoin,this.fog=Z.fog,this}}const _vStart=new Vector3,_vEnd=new Vector3,_inverseMatrix$1=new Matrix4,_ray$1=new Ray$2,_sphere$1=new Sphere,_intersectPointOnRay=new Vector3,_intersectPointOnSegment=new Vector3;class Line extends Object3D{constructor(Z=new BufferGeometry,_=new LineBasicMaterial){super(),this.isLine=!0,this.type="Line",this.geometry=Z,this.material=_,this.updateMorphTargets()}copy(Z,_){return super.copy(Z,_),this.material=Array.isArray(Z.material)?Z.material.slice():Z.material,this.geometry=Z.geometry,this}computeLineDistances(){const Z=this.geometry;if(Z.index===null){const _=Z.attributes.position,K=[0];for(let te=1,ne=_.count;te<ne;te++)_vStart.fromBufferAttribute(_,te-1),_vEnd.fromBufferAttribute(_,te),K[te]=K[te-1],K[te]+=_vStart.distanceTo(_vEnd);Z.setAttribute("lineDistance",new Float32BufferAttribute(K,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(Z,_){const K=this.geometry,te=this.matrixWorld,ne=Z.params.Line.threshold,ie=K.drawRange;if(K.boundingSphere===null&&K.computeBoundingSphere(),_sphere$1.copy(K.boundingSphere),_sphere$1.applyMatrix4(te),_sphere$1.radius+=ne,Z.ray.intersectsSphere(_sphere$1)===!1)return;_inverseMatrix$1.copy(te).invert(),_ray$1.copy(Z.ray).applyMatrix4(_inverseMatrix$1);const oe=ne/((this.scale.x+this.scale.y+this.scale.z)/3),se=oe*oe,ae=this.isLineSegments?2:1,ge=K.index,de=K.attributes.position;if(ge!==null){const Ie=Math.max(0,ie.start),fe=Math.min(ge.count,ie.start+ie.count);for(let be=Ie,Ae=fe-1;be<Ae;be+=ae){const ye=ge.getX(be),ve=ge.getX(be+1),Be=checkIntersection(this,Z,_ray$1,se,ye,ve);Be&&_.push(Be)}if(this.isLineLoop){const be=ge.getX(fe-1),Ae=ge.getX(Ie),ye=checkIntersection(this,Z,_ray$1,se,be,Ae);ye&&_.push(ye)}}else{const Ie=Math.max(0,ie.start),fe=Math.min(de.count,ie.start+ie.count);for(let be=Ie,Ae=fe-1;be<Ae;be+=ae){const ye=checkIntersection(this,Z,_ray$1,se,be,be+1);ye&&_.push(ye)}if(this.isLineLoop){const be=checkIntersection(this,Z,_ray$1,se,fe-1,Ie);be&&_.push(be)}}}updateMorphTargets(){const _=this.geometry.morphAttributes,K=Object.keys(_);if(K.length>0){const te=_[K[0]];if(te!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let ne=0,ie=te.length;ne<ie;ne++){const oe=te[ne].name||String(ne);this.morphTargetInfluences.push(0),this.morphTargetDictionary[oe]=ne}}}}}function checkIntersection(X,Z,_,K,te,ne){const ie=X.geometry.attributes.position;if(_vStart.fromBufferAttribute(ie,te),_vEnd.fromBufferAttribute(ie,ne),_.distanceSqToSegment(_vStart,_vEnd,_intersectPointOnRay,_intersectPointOnSegment)>K)return;_intersectPointOnRay.applyMatrix4(X.matrixWorld);const se=Z.ray.origin.distanceTo(_intersectPointOnRay);if(!(se<Z.near||se>Z.far))return{distance:se,point:_intersectPointOnSegment.clone().applyMatrix4(X.matrixWorld),index:te,face:null,faceIndex:null,barycoord:null,object:X}}const _start=new Vector3,_end=new Vector3;class LineSegments extends Line{constructor(Z,_){super(Z,_),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){const Z=this.geometry;if(Z.index===null){const _=Z.attributes.position,K=[];for(let te=0,ne=_.count;te<ne;te+=2)_start.fromBufferAttribute(_,te),_end.fromBufferAttribute(_,te+1),K[te]=te===0?0:K[te-1],K[te+1]=K[te]+_start.distanceTo(_end);Z.setAttribute("lineDistance",new Float32BufferAttribute(K,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}}class LineLoop extends Line{constructor(Z,_){super(Z,_),this.isLineLoop=!0,this.type="LineLoop"}}class PointsMaterial extends Material{constructor(Z){super(),this.isPointsMaterial=!0,this.type="PointsMaterial",this.color=new Color$1(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(Z)}copy(Z){return super.copy(Z),this.color.copy(Z.color),this.map=Z.map,this.alphaMap=Z.alphaMap,this.size=Z.size,this.sizeAttenuation=Z.sizeAttenuation,this.fog=Z.fog,this}}const _inverseMatrix=new Matrix4,_ray=new Ray$2,_sphere=new Sphere,_position$2=new Vector3;class Points extends Object3D{constructor(Z=new BufferGeometry,_=new PointsMaterial){super(),this.isPoints=!0,this.type="Points",this.geometry=Z,this.material=_,this.updateMorphTargets()}copy(Z,_){return super.copy(Z,_),this.material=Array.isArray(Z.material)?Z.material.slice():Z.material,this.geometry=Z.geometry,this}raycast(Z,_){const K=this.geometry,te=this.matrixWorld,ne=Z.params.Points.threshold,ie=K.drawRange;if(K.boundingSphere===null&&K.computeBoundingSphere(),_sphere.copy(K.boundingSphere),_sphere.applyMatrix4(te),_sphere.radius+=ne,Z.ray.intersectsSphere(_sphere)===!1)return;_inverseMatrix.copy(te).invert(),_ray.copy(Z.ray).applyMatrix4(_inverseMatrix);const oe=ne/((this.scale.x+this.scale.y+this.scale.z)/3),se=oe*oe,ae=K.index,ce=K.attributes.position;if(ae!==null){const de=Math.max(0,ie.start),Ie=Math.min(ae.count,ie.start+ie.count);for(let fe=de,be=Ie;fe<be;fe++){const Ae=ae.getX(fe);_position$2.fromBufferAttribute(ce,Ae),testPoint(_position$2,Ae,se,te,Z,_,this)}}else{const de=Math.max(0,ie.start),Ie=Math.min(ce.count,ie.start+ie.count);for(let fe=de,be=Ie;fe<be;fe++)_position$2.fromBufferAttribute(ce,fe),testPoint(_position$2,fe,se,te,Z,_,this)}}updateMorphTargets(){const _=this.geometry.morphAttributes,K=Object.keys(_);if(K.length>0){const te=_[K[0]];if(te!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let ne=0,ie=te.length;ne<ie;ne++){const oe=te[ne].name||String(ne);this.morphTargetInfluences.push(0),this.morphTargetDictionary[oe]=ne}}}}}function testPoint(X,Z,_,K,te,ne,ie){const oe=_ray.distanceSqToPoint(X);if(oe<_){const se=new Vector3;_ray.closestPointToPoint(X,se),se.applyMatrix4(K);const ae=te.ray.origin.distanceTo(se);if(ae<te.near||ae>te.far)return;ne.push({distance:ae,distanceToRay:Math.sqrt(oe),point:se,index:Z,face:null,faceIndex:null,barycoord:null,object:ie})}}class Group extends Object3D{constructor(){super(),this.isGroup=!0,this.type="Group"}}class VideoTexture extends Texture{constructor(Z,_,K,te,ne,ie,oe,se,ae){super(Z,_,K,te,ne,ie,oe,se,ae),this.isVideoTexture=!0,this.minFilter=ie!==void 0?ie:LinearFilter,this.magFilter=ne!==void 0?ne:LinearFilter,this.generateMipmaps=!1;const ge=this;function ce(){ge.needsUpdate=!0,Z.requestVideoFrameCallback(ce)}"requestVideoFrameCallback"in Z&&Z.requestVideoFrameCallback(ce)}clone(){return new this.constructor(this.image).copy(this)}update(){const Z=this.image;"requestVideoFrameCallback"in Z===!1&&Z.readyState>=Z.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}class FramebufferTexture extends Texture{constructor(Z,_){super({width:Z,height:_}),this.isFramebufferTexture=!0,this.magFilter=NearestFilter,this.minFilter=NearestFilter,this.generateMipmaps=!1,this.needsUpdate=!0}}class CompressedTexture extends Texture{constructor(Z,_,K,te,ne,ie,oe,se,ae,ge,ce,de){super(null,ie,oe,se,ae,ge,te,ne,ce,de),this.isCompressedTexture=!0,this.image={width:_,height:K},this.mipmaps=Z,this.flipY=!1,this.generateMipmaps=!1}}class CompressedArrayTexture extends CompressedTexture{constructor(Z,_,K,te,ne,ie){super(Z,_,K,ne,ie),this.isCompressedArrayTexture=!0,this.image.depth=te,this.wrapR=ClampToEdgeWrapping,this.layerUpdates=new Set}addLayerUpdate(Z){this.layerUpdates.add(Z)}clearLayerUpdates(){this.layerUpdates.clear()}}class CompressedCubeTexture extends CompressedTexture{constructor(Z,_,K){super(void 0,Z[0].width,Z[0].height,_,K,CubeReflectionMapping),this.isCompressedCubeTexture=!0,this.isCubeTexture=!0,this.image=Z}}class CanvasTexture extends Texture{constructor(Z,_,K,te,ne,ie,oe,se,ae){super(Z,_,K,te,ne,ie,oe,se,ae),this.isCanvasTexture=!0,this.needsUpdate=!0}}class DepthTexture extends Texture{constructor(Z,_,K,te,ne,ie,oe,se,ae,ge=DepthFormat){if(ge!==DepthFormat&&ge!==DepthStencilFormat)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");K===void 0&&ge===DepthFormat&&(K=UnsignedIntType),K===void 0&&ge===DepthStencilFormat&&(K=UnsignedInt248Type),super(null,te,ne,ie,oe,se,ge,K,ae),this.isDepthTexture=!0,this.image={width:Z,height:_},this.magFilter=oe!==void 0?oe:NearestFilter,this.minFilter=se!==void 0?se:NearestFilter,this.flipY=!1,this.generateMipmaps=!1,this.compareFunction=null}copy(Z){return super.copy(Z),this.compareFunction=Z.compareFunction,this}toJSON(Z){const _=super.toJSON(Z);return this.compareFunction!==null&&(_.compareFunction=this.compareFunction),_}}class Curve{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}getPointAt(Z,_){const K=this.getUtoTmapping(Z);return this.getPoint(K,_)}getPoints(Z=5){const _=[];for(let K=0;K<=Z;K++)_.push(this.getPoint(K/Z));return _}getSpacedPoints(Z=5){const _=[];for(let K=0;K<=Z;K++)_.push(this.getPointAt(K/Z));return _}getLength(){const Z=this.getLengths();return Z[Z.length-1]}getLengths(Z=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===Z+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const _=[];let K,te=this.getPoint(0),ne=0;_.push(0);for(let ie=1;ie<=Z;ie++)K=this.getPoint(ie/Z),ne+=K.distanceTo(te),_.push(ne),te=K;return this.cacheArcLengths=_,_}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(Z,_){const K=this.getLengths();let te=0;const ne=K.length;let ie;_?ie=_:ie=Z*K[ne-1];let oe=0,se=ne-1,ae;for(;oe<=se;)if(te=Math.floor(oe+(se-oe)/2),ae=K[te]-ie,ae<0)oe=te+1;else if(ae>0)se=te-1;else{se=te;break}if(te=se,K[te]===ie)return te/(ne-1);const ge=K[te],de=K[te+1]-ge,Ie=(ie-ge)/de;return(te+Ie)/(ne-1)}getTangent(Z,_){let te=Z-1e-4,ne=Z+1e-4;te<0&&(te=0),ne>1&&(ne=1);const ie=this.getPoint(te),oe=this.getPoint(ne),se=_||(ie.isVector2?new Vector2:new Vector3);return se.copy(oe).sub(ie).normalize(),se}getTangentAt(Z,_){const K=this.getUtoTmapping(Z);return this.getTangent(K,_)}computeFrenetFrames(Z,_){const K=new Vector3,te=[],ne=[],ie=[],oe=new Vector3,se=new Matrix4;for(let Ie=0;Ie<=Z;Ie++){const fe=Ie/Z;te[Ie]=this.getTangentAt(fe,new Vector3)}ne[0]=new Vector3,ie[0]=new Vector3;let ae=Number.MAX_VALUE;const ge=Math.abs(te[0].x),ce=Math.abs(te[0].y),de=Math.abs(te[0].z);ge<=ae&&(ae=ge,K.set(1,0,0)),ce<=ae&&(ae=ce,K.set(0,1,0)),de<=ae&&K.set(0,0,1),oe.crossVectors(te[0],K).normalize(),ne[0].crossVectors(te[0],oe),ie[0].crossVectors(te[0],ne[0]);for(let Ie=1;Ie<=Z;Ie++){if(ne[Ie]=ne[Ie-1].clone(),ie[Ie]=ie[Ie-1].clone(),oe.crossVectors(te[Ie-1],te[Ie]),oe.length()>Number.EPSILON){oe.normalize();const fe=Math.acos(clamp$3(te[Ie-1].dot(te[Ie]),-1,1));ne[Ie].applyMatrix4(se.makeRotationAxis(oe,fe))}ie[Ie].crossVectors(te[Ie],ne[Ie])}if(_===!0){let Ie=Math.acos(clamp$3(ne[0].dot(ne[Z]),-1,1));Ie/=Z,te[0].dot(oe.crossVectors(ne[0],ne[Z]))>0&&(Ie=-Ie);for(let fe=1;fe<=Z;fe++)ne[fe].applyMatrix4(se.makeRotationAxis(te[fe],Ie*fe)),ie[fe].crossVectors(te[fe],ne[fe])}return{tangents:te,normals:ne,binormals:ie}}clone(){return new this.constructor().copy(this)}copy(Z){return this.arcLengthDivisions=Z.arcLengthDivisions,this}toJSON(){const Z={metadata:{version:4.6,type:"Curve",generator:"Curve.toJSON"}};return Z.arcLengthDivisions=this.arcLengthDivisions,Z.type=this.type,Z}fromJSON(Z){return this.arcLengthDivisions=Z.arcLengthDivisions,this}}class EllipseCurve extends Curve{constructor(Z=0,_=0,K=1,te=1,ne=0,ie=Math.PI*2,oe=!1,se=0){super(),this.isEllipseCurve=!0,this.type="EllipseCurve",this.aX=Z,this.aY=_,this.xRadius=K,this.yRadius=te,this.aStartAngle=ne,this.aEndAngle=ie,this.aClockwise=oe,this.aRotation=se}getPoint(Z,_=new Vector2){const K=_,te=Math.PI*2;let ne=this.aEndAngle-this.aStartAngle;const ie=Math.abs(ne)<Number.EPSILON;for(;ne<0;)ne+=te;for(;ne>te;)ne-=te;ne<Number.EPSILON&&(ie?ne=0:ne=te),this.aClockwise===!0&&!ie&&(ne===te?ne=-te:ne=ne-te);const oe=this.aStartAngle+Z*ne;let se=this.aX+this.xRadius*Math.cos(oe),ae=this.aY+this.yRadius*Math.sin(oe);if(this.aRotation!==0){const ge=Math.cos(this.aRotation),ce=Math.sin(this.aRotation),de=se-this.aX,Ie=ae-this.aY;se=de*ge-Ie*ce+this.aX,ae=de*ce+Ie*ge+this.aY}return K.set(se,ae)}copy(Z){return super.copy(Z),this.aX=Z.aX,this.aY=Z.aY,this.xRadius=Z.xRadius,this.yRadius=Z.yRadius,this.aStartAngle=Z.aStartAngle,this.aEndAngle=Z.aEndAngle,this.aClockwise=Z.aClockwise,this.aRotation=Z.aRotation,this}toJSON(){const Z=super.toJSON();return Z.aX=this.aX,Z.aY=this.aY,Z.xRadius=this.xRadius,Z.yRadius=this.yRadius,Z.aStartAngle=this.aStartAngle,Z.aEndAngle=this.aEndAngle,Z.aClockwise=this.aClockwise,Z.aRotation=this.aRotation,Z}fromJSON(Z){return super.fromJSON(Z),this.aX=Z.aX,this.aY=Z.aY,this.xRadius=Z.xRadius,this.yRadius=Z.yRadius,this.aStartAngle=Z.aStartAngle,this.aEndAngle=Z.aEndAngle,this.aClockwise=Z.aClockwise,this.aRotation=Z.aRotation,this}}class ArcCurve extends EllipseCurve{constructor(Z,_,K,te,ne,ie){super(Z,_,K,K,te,ne,ie),this.isArcCurve=!0,this.type="ArcCurve"}}function CubicPoly(){let X=0,Z=0,_=0,K=0;function te(ne,ie,oe,se){X=ne,Z=oe,_=-3*ne+3*ie-2*oe-se,K=2*ne-2*ie+oe+se}return{initCatmullRom:function(ne,ie,oe,se,ae){te(ie,oe,ae*(oe-ne),ae*(se-ie))},initNonuniformCatmullRom:function(ne,ie,oe,se,ae,ge,ce){let de=(ie-ne)/ae-(oe-ne)/(ae+ge)+(oe-ie)/ge,Ie=(oe-ie)/ge-(se-ie)/(ge+ce)+(se-oe)/ce;de*=ge,Ie*=ge,te(ie,oe,de,Ie)},calc:function(ne){const ie=ne*ne,oe=ie*ne;return X+Z*ne+_*ie+K*oe}}}const tmp=new Vector3,px=new CubicPoly,py=new CubicPoly,pz=new CubicPoly;class CatmullRomCurve3 extends Curve{constructor(Z=[],_=!1,K="centripetal",te=.5){super(),this.isCatmullRomCurve3=!0,this.type="CatmullRomCurve3",this.points=Z,this.closed=_,this.curveType=K,this.tension=te}getPoint(Z,_=new Vector3){const K=_,te=this.points,ne=te.length,ie=(ne-(this.closed?0:1))*Z;let oe=Math.floor(ie),se=ie-oe;this.closed?oe+=oe>0?0:(Math.floor(Math.abs(oe)/ne)+1)*ne:se===0&&oe===ne-1&&(oe=ne-2,se=1);let ae,ge;this.closed||oe>0?ae=te[(oe-1)%ne]:(tmp.subVectors(te[0],te[1]).add(te[0]),ae=tmp);const ce=te[oe%ne],de=te[(oe+1)%ne];if(this.closed||oe+2<ne?ge=te[(oe+2)%ne]:(tmp.subVectors(te[ne-1],te[ne-2]).add(te[ne-1]),ge=tmp),this.curveType==="centripetal"||this.curveType==="chordal"){const Ie=this.curveType==="chordal"?.5:.25;let fe=Math.pow(ae.distanceToSquared(ce),Ie),be=Math.pow(ce.distanceToSquared(de),Ie),Ae=Math.pow(de.distanceToSquared(ge),Ie);be<1e-4&&(be=1),fe<1e-4&&(fe=be),Ae<1e-4&&(Ae=be),px.initNonuniformCatmullRom(ae.x,ce.x,de.x,ge.x,fe,be,Ae),py.initNonuniformCatmullRom(ae.y,ce.y,de.y,ge.y,fe,be,Ae),pz.initNonuniformCatmullRom(ae.z,ce.z,de.z,ge.z,fe,be,Ae)}else this.curveType==="catmullrom"&&(px.initCatmullRom(ae.x,ce.x,de.x,ge.x,this.tension),py.initCatmullRom(ae.y,ce.y,de.y,ge.y,this.tension),pz.initCatmullRom(ae.z,ce.z,de.z,ge.z,this.tension));return K.set(px.calc(se),py.calc(se),pz.calc(se)),K}copy(Z){super.copy(Z),this.points=[];for(let _=0,K=Z.points.length;_<K;_++){const te=Z.points[_];this.points.push(te.clone())}return this.closed=Z.closed,this.curveType=Z.curveType,this.tension=Z.tension,this}toJSON(){const Z=super.toJSON();Z.points=[];for(let _=0,K=this.points.length;_<K;_++){const te=this.points[_];Z.points.push(te.toArray())}return Z.closed=this.closed,Z.curveType=this.curveType,Z.tension=this.tension,Z}fromJSON(Z){super.fromJSON(Z),this.points=[];for(let _=0,K=Z.points.length;_<K;_++){const te=Z.points[_];this.points.push(new Vector3().fromArray(te))}return this.closed=Z.closed,this.curveType=Z.curveType,this.tension=Z.tension,this}}function CatmullRom(X,Z,_,K,te){const ne=(K-Z)*.5,ie=(te-_)*.5,oe=X*X,se=X*oe;return(2*_-2*K+ne+ie)*se+(-3*_+3*K-2*ne-ie)*oe+ne*X+_}function QuadraticBezierP0(X,Z){const _=1-X;return _*_*Z}function QuadraticBezierP1(X,Z){return 2*(1-X)*X*Z}function QuadraticBezierP2(X,Z){return X*X*Z}function QuadraticBezier(X,Z,_,K){return QuadraticBezierP0(X,Z)+QuadraticBezierP1(X,_)+QuadraticBezierP2(X,K)}function CubicBezierP0(X,Z){const _=1-X;return _*_*_*Z}function CubicBezierP1(X,Z){const _=1-X;return 3*_*_*X*Z}function CubicBezierP2(X,Z){return 3*(1-X)*X*X*Z}function CubicBezierP3(X,Z){return X*X*X*Z}function CubicBezier(X,Z,_,K,te){return CubicBezierP0(X,Z)+CubicBezierP1(X,_)+CubicBezierP2(X,K)+CubicBezierP3(X,te)}class CubicBezierCurve extends Curve{constructor(Z=new Vector2,_=new Vector2,K=new Vector2,te=new Vector2){super(),this.isCubicBezierCurve=!0,this.type="CubicBezierCurve",this.v0=Z,this.v1=_,this.v2=K,this.v3=te}getPoint(Z,_=new Vector2){const K=_,te=this.v0,ne=this.v1,ie=this.v2,oe=this.v3;return K.set(CubicBezier(Z,te.x,ne.x,ie.x,oe.x),CubicBezier(Z,te.y,ne.y,ie.y,oe.y)),K}copy(Z){return super.copy(Z),this.v0.copy(Z.v0),this.v1.copy(Z.v1),this.v2.copy(Z.v2),this.v3.copy(Z.v3),this}toJSON(){const Z=super.toJSON();return Z.v0=this.v0.toArray(),Z.v1=this.v1.toArray(),Z.v2=this.v2.toArray(),Z.v3=this.v3.toArray(),Z}fromJSON(Z){return super.fromJSON(Z),this.v0.fromArray(Z.v0),this.v1.fromArray(Z.v1),this.v2.fromArray(Z.v2),this.v3.fromArray(Z.v3),this}}class CubicBezierCurve3 extends Curve{constructor(Z=new Vector3,_=new Vector3,K=new Vector3,te=new Vector3){super(),this.isCubicBezierCurve3=!0,this.type="CubicBezierCurve3",this.v0=Z,this.v1=_,this.v2=K,this.v3=te}getPoint(Z,_=new Vector3){const K=_,te=this.v0,ne=this.v1,ie=this.v2,oe=this.v3;return K.set(CubicBezier(Z,te.x,ne.x,ie.x,oe.x),CubicBezier(Z,te.y,ne.y,ie.y,oe.y),CubicBezier(Z,te.z,ne.z,ie.z,oe.z)),K}copy(Z){return super.copy(Z),this.v0.copy(Z.v0),this.v1.copy(Z.v1),this.v2.copy(Z.v2),this.v3.copy(Z.v3),this}toJSON(){const Z=super.toJSON();return Z.v0=this.v0.toArray(),Z.v1=this.v1.toArray(),Z.v2=this.v2.toArray(),Z.v3=this.v3.toArray(),Z}fromJSON(Z){return super.fromJSON(Z),this.v0.fromArray(Z.v0),this.v1.fromArray(Z.v1),this.v2.fromArray(Z.v2),this.v3.fromArray(Z.v3),this}}class LineCurve extends Curve{constructor(Z=new Vector2,_=new Vector2){super(),this.isLineCurve=!0,this.type="LineCurve",this.v1=Z,this.v2=_}getPoint(Z,_=new Vector2){const K=_;return Z===1?K.copy(this.v2):(K.copy(this.v2).sub(this.v1),K.multiplyScalar(Z).add(this.v1)),K}getPointAt(Z,_){return this.getPoint(Z,_)}getTangent(Z,_=new Vector2){return _.subVectors(this.v2,this.v1).normalize()}getTangentAt(Z,_){return this.getTangent(Z,_)}copy(Z){return super.copy(Z),this.v1.copy(Z.v1),this.v2.copy(Z.v2),this}toJSON(){const Z=super.toJSON();return Z.v1=this.v1.toArray(),Z.v2=this.v2.toArray(),Z}fromJSON(Z){return super.fromJSON(Z),this.v1.fromArray(Z.v1),this.v2.fromArray(Z.v2),this}}class LineCurve3 extends Curve{constructor(Z=new Vector3,_=new Vector3){super(),this.isLineCurve3=!0,this.type="LineCurve3",this.v1=Z,this.v2=_}getPoint(Z,_=new Vector3){const K=_;return Z===1?K.copy(this.v2):(K.copy(this.v2).sub(this.v1),K.multiplyScalar(Z).add(this.v1)),K}getPointAt(Z,_){return this.getPoint(Z,_)}getTangent(Z,_=new Vector3){return _.subVectors(this.v2,this.v1).normalize()}getTangentAt(Z,_){return this.getTangent(Z,_)}copy(Z){return super.copy(Z),this.v1.copy(Z.v1),this.v2.copy(Z.v2),this}toJSON(){const Z=super.toJSON();return Z.v1=this.v1.toArray(),Z.v2=this.v2.toArray(),Z}fromJSON(Z){return super.fromJSON(Z),this.v1.fromArray(Z.v1),this.v2.fromArray(Z.v2),this}}class QuadraticBezierCurve extends Curve{constructor(Z=new Vector2,_=new Vector2,K=new Vector2){super(),this.isQuadraticBezierCurve=!0,this.type="QuadraticBezierCurve",this.v0=Z,this.v1=_,this.v2=K}getPoint(Z,_=new Vector2){const K=_,te=this.v0,ne=this.v1,ie=this.v2;return K.set(QuadraticBezier(Z,te.x,ne.x,ie.x),QuadraticBezier(Z,te.y,ne.y,ie.y)),K}copy(Z){return super.copy(Z),this.v0.copy(Z.v0),this.v1.copy(Z.v1),this.v2.copy(Z.v2),this}toJSON(){const Z=super.toJSON();return Z.v0=this.v0.toArray(),Z.v1=this.v1.toArray(),Z.v2=this.v2.toArray(),Z}fromJSON(Z){return super.fromJSON(Z),this.v0.fromArray(Z.v0),this.v1.fromArray(Z.v1),this.v2.fromArray(Z.v2),this}}class QuadraticBezierCurve3 extends Curve{constructor(Z=new Vector3,_=new Vector3,K=new Vector3){super(),this.isQuadraticBezierCurve3=!0,this.type="QuadraticBezierCurve3",this.v0=Z,this.v1=_,this.v2=K}getPoint(Z,_=new Vector3){const K=_,te=this.v0,ne=this.v1,ie=this.v2;return K.set(QuadraticBezier(Z,te.x,ne.x,ie.x),QuadraticBezier(Z,te.y,ne.y,ie.y),QuadraticBezier(Z,te.z,ne.z,ie.z)),K}copy(Z){return super.copy(Z),this.v0.copy(Z.v0),this.v1.copy(Z.v1),this.v2.copy(Z.v2),this}toJSON(){const Z=super.toJSON();return Z.v0=this.v0.toArray(),Z.v1=this.v1.toArray(),Z.v2=this.v2.toArray(),Z}fromJSON(Z){return super.fromJSON(Z),this.v0.fromArray(Z.v0),this.v1.fromArray(Z.v1),this.v2.fromArray(Z.v2),this}}class SplineCurve extends Curve{constructor(Z=[]){super(),this.isSplineCurve=!0,this.type="SplineCurve",this.points=Z}getPoint(Z,_=new Vector2){const K=_,te=this.points,ne=(te.length-1)*Z,ie=Math.floor(ne),oe=ne-ie,se=te[ie===0?ie:ie-1],ae=te[ie],ge=te[ie>te.length-2?te.length-1:ie+1],ce=te[ie>te.length-3?te.length-1:ie+2];return K.set(CatmullRom(oe,se.x,ae.x,ge.x,ce.x),CatmullRom(oe,se.y,ae.y,ge.y,ce.y)),K}copy(Z){super.copy(Z),this.points=[];for(let _=0,K=Z.points.length;_<K;_++){const te=Z.points[_];this.points.push(te.clone())}return this}toJSON(){const Z=super.toJSON();Z.points=[];for(let _=0,K=this.points.length;_<K;_++){const te=this.points[_];Z.points.push(te.toArray())}return Z}fromJSON(Z){super.fromJSON(Z),this.points=[];for(let _=0,K=Z.points.length;_<K;_++){const te=Z.points[_];this.points.push(new Vector2().fromArray(te))}return this}}var Curves=Object.freeze({__proto__:null,ArcCurve,CatmullRomCurve3,CubicBezierCurve,CubicBezierCurve3,EllipseCurve,LineCurve,LineCurve3,QuadraticBezierCurve,QuadraticBezierCurve3,SplineCurve});class CurvePath extends Curve{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(Z){this.curves.push(Z)}closePath(){const Z=this.curves[0].getPoint(0),_=this.curves[this.curves.length-1].getPoint(1);if(!Z.equals(_)){const K=Z.isVector2===!0?"LineCurve":"LineCurve3";this.curves.push(new Curves[K](_,Z))}return this}getPoint(Z,_){const K=Z*this.getLength(),te=this.getCurveLengths();let ne=0;for(;ne<te.length;){if(te[ne]>=K){const ie=te[ne]-K,oe=this.curves[ne],se=oe.getLength(),ae=se===0?0:1-ie/se;return oe.getPointAt(ae,_)}ne++}return null}getLength(){const Z=this.getCurveLengths();return Z[Z.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;const Z=[];let _=0;for(let K=0,te=this.curves.length;K<te;K++)_+=this.curves[K].getLength(),Z.push(_);return this.cacheLengths=Z,Z}getSpacedPoints(Z=40){const _=[];for(let K=0;K<=Z;K++)_.push(this.getPoint(K/Z));return this.autoClose&&_.push(_[0]),_}getPoints(Z=12){const _=[];let K;for(let te=0,ne=this.curves;te<ne.length;te++){const ie=ne[te],oe=ie.isEllipseCurve?Z*2:ie.isLineCurve||ie.isLineCurve3?1:ie.isSplineCurve?Z*ie.points.length:Z,se=ie.getPoints(oe);for(let ae=0;ae<se.length;ae++){const ge=se[ae];K&&K.equals(ge)||(_.push(ge),K=ge)}}return this.autoClose&&_.length>1&&!_[_.length-1].equals(_[0])&&_.push(_[0]),_}copy(Z){super.copy(Z),this.curves=[];for(let _=0,K=Z.curves.length;_<K;_++){const te=Z.curves[_];this.curves.push(te.clone())}return this.autoClose=Z.autoClose,this}toJSON(){const Z=super.toJSON();Z.autoClose=this.autoClose,Z.curves=[];for(let _=0,K=this.curves.length;_<K;_++){const te=this.curves[_];Z.curves.push(te.toJSON())}return Z}fromJSON(Z){super.fromJSON(Z),this.autoClose=Z.autoClose,this.curves=[];for(let _=0,K=Z.curves.length;_<K;_++){const te=Z.curves[_];this.curves.push(new Curves[te.type]().fromJSON(te))}return this}}class Path extends CurvePath{constructor(Z){super(),this.type="Path",this.currentPoint=new Vector2,Z&&this.setFromPoints(Z)}setFromPoints(Z){this.moveTo(Z[0].x,Z[0].y);for(let _=1,K=Z.length;_<K;_++)this.lineTo(Z[_].x,Z[_].y);return this}moveTo(Z,_){return this.currentPoint.set(Z,_),this}lineTo(Z,_){const K=new LineCurve(this.currentPoint.clone(),new Vector2(Z,_));return this.curves.push(K),this.currentPoint.set(Z,_),this}quadraticCurveTo(Z,_,K,te){const ne=new QuadraticBezierCurve(this.currentPoint.clone(),new Vector2(Z,_),new Vector2(K,te));return this.curves.push(ne),this.currentPoint.set(K,te),this}bezierCurveTo(Z,_,K,te,ne,ie){const oe=new CubicBezierCurve(this.currentPoint.clone(),new Vector2(Z,_),new Vector2(K,te),new Vector2(ne,ie));return this.curves.push(oe),this.currentPoint.set(ne,ie),this}splineThru(Z){const _=[this.currentPoint.clone()].concat(Z),K=new SplineCurve(_);return this.curves.push(K),this.currentPoint.copy(Z[Z.length-1]),this}arc(Z,_,K,te,ne,ie){const oe=this.currentPoint.x,se=this.currentPoint.y;return this.absarc(Z+oe,_+se,K,te,ne,ie),this}absarc(Z,_,K,te,ne,ie){return this.absellipse(Z,_,K,K,te,ne,ie),this}ellipse(Z,_,K,te,ne,ie,oe,se){const ae=this.currentPoint.x,ge=this.currentPoint.y;return this.absellipse(Z+ae,_+ge,K,te,ne,ie,oe,se),this}absellipse(Z,_,K,te,ne,ie,oe,se){const ae=new EllipseCurve(Z,_,K,te,ne,ie,oe,se);if(this.curves.length>0){const ce=ae.getPoint(0);ce.equals(this.currentPoint)||this.lineTo(ce.x,ce.y)}this.curves.push(ae);const ge=ae.getPoint(1);return this.currentPoint.copy(ge),this}copy(Z){return super.copy(Z),this.currentPoint.copy(Z.currentPoint),this}toJSON(){const Z=super.toJSON();return Z.currentPoint=this.currentPoint.toArray(),Z}fromJSON(Z){return super.fromJSON(Z),this.currentPoint.fromArray(Z.currentPoint),this}}class LatheGeometry extends BufferGeometry{constructor(Z=[new Vector2(0,-.5),new Vector2(.5,0),new Vector2(0,.5)],_=12,K=0,te=Math.PI*2){super(),this.type="LatheGeometry",this.parameters={points:Z,segments:_,phiStart:K,phiLength:te},_=Math.floor(_),te=clamp$3(te,0,Math.PI*2);const ne=[],ie=[],oe=[],se=[],ae=[],ge=1/_,ce=new Vector3,de=new Vector2,Ie=new Vector3,fe=new Vector3,be=new Vector3;let Ae=0,ye=0;for(let ve=0;ve<=Z.length-1;ve++)switch(ve){case 0:Ae=Z[ve+1].x-Z[ve].x,ye=Z[ve+1].y-Z[ve].y,Ie.x=ye*1,Ie.y=-Ae,Ie.z=ye*0,be.copy(Ie),Ie.normalize(),se.push(Ie.x,Ie.y,Ie.z);break;case Z.length-1:se.push(be.x,be.y,be.z);break;default:Ae=Z[ve+1].x-Z[ve].x,ye=Z[ve+1].y-Z[ve].y,Ie.x=ye*1,Ie.y=-Ae,Ie.z=ye*0,fe.copy(Ie),Ie.x+=be.x,Ie.y+=be.y,Ie.z+=be.z,Ie.normalize(),se.push(Ie.x,Ie.y,Ie.z),be.copy(fe)}for(let ve=0;ve<=_;ve++){const Be=K+ve*ge*te,Re=Math.sin(Be),Ve=Math.cos(Be);for(let Ee=0;Ee<=Z.length-1;Ee++){ce.x=Z[Ee].x*Re,ce.y=Z[Ee].y,ce.z=Z[Ee].x*Ve,ie.push(ce.x,ce.y,ce.z),de.x=ve/_,de.y=Ee/(Z.length-1),oe.push(de.x,de.y);const Ze=se[3*Ee+0]*Re,_e=se[3*Ee+1],Fe=se[3*Ee+0]*Ve;ae.push(Ze,_e,Fe)}}for(let ve=0;ve<_;ve++)for(let Be=0;Be<Z.length-1;Be++){const Re=Be+ve*Z.length,Ve=Re,Ee=Re+Z.length,Ze=Re+Z.length+1,_e=Re+1;ne.push(Ve,Ee,_e),ne.push(Ze,_e,Ee)}this.setIndex(ne),this.setAttribute("position",new Float32BufferAttribute(ie,3)),this.setAttribute("uv",new Float32BufferAttribute(oe,2)),this.setAttribute("normal",new Float32BufferAttribute(ae,3))}copy(Z){return super.copy(Z),this.parameters=Object.assign({},Z.parameters),this}static fromJSON(Z){return new LatheGeometry(Z.points,Z.segments,Z.phiStart,Z.phiLength)}}class CapsuleGeometry extends LatheGeometry{constructor(Z=1,_=1,K=4,te=8){const ne=new Path;ne.absarc(0,-_/2,Z,Math.PI*1.5,0),ne.absarc(0,_/2,Z,0,Math.PI*.5),super(ne.getPoints(K),te),this.type="CapsuleGeometry",this.parameters={radius:Z,length:_,capSegments:K,radialSegments:te}}static fromJSON(Z){return new CapsuleGeometry(Z.radius,Z.length,Z.capSegments,Z.radialSegments)}}class CircleGeometry extends BufferGeometry{constructor(Z=1,_=32,K=0,te=Math.PI*2){super(),this.type="CircleGeometry",this.parameters={radius:Z,segments:_,thetaStart:K,thetaLength:te},_=Math.max(3,_);const ne=[],ie=[],oe=[],se=[],ae=new Vector3,ge=new Vector2;ie.push(0,0,0),oe.push(0,0,1),se.push(.5,.5);for(let ce=0,de=3;ce<=_;ce++,de+=3){const Ie=K+ce/_*te;ae.x=Z*Math.cos(Ie),ae.y=Z*Math.sin(Ie),ie.push(ae.x,ae.y,ae.z),oe.push(0,0,1),ge.x=(ie[de]/Z+1)/2,ge.y=(ie[de+1]/Z+1)/2,se.push(ge.x,ge.y)}for(let ce=1;ce<=_;ce++)ne.push(ce,ce+1,0);this.setIndex(ne),this.setAttribute("position",new Float32BufferAttribute(ie,3)),this.setAttribute("normal",new Float32BufferAttribute(oe,3)),this.setAttribute("uv",new Float32BufferAttribute(se,2))}copy(Z){return super.copy(Z),this.parameters=Object.assign({},Z.parameters),this}static fromJSON(Z){return new CircleGeometry(Z.radius,Z.segments,Z.thetaStart,Z.thetaLength)}}class CylinderGeometry extends BufferGeometry{constructor(Z=1,_=1,K=1,te=32,ne=1,ie=!1,oe=0,se=Math.PI*2){super(),this.type="CylinderGeometry",this.parameters={radiusTop:Z,radiusBottom:_,height:K,radialSegments:te,heightSegments:ne,openEnded:ie,thetaStart:oe,thetaLength:se};const ae=this;te=Math.floor(te),ne=Math.floor(ne);const ge=[],ce=[],de=[],Ie=[];let fe=0;const be=[],Ae=K/2;let ye=0;ve(),ie===!1&&(Z>0&&Be(!0),_>0&&Be(!1)),this.setIndex(ge),this.setAttribute("position",new Float32BufferAttribute(ce,3)),this.setAttribute("normal",new Float32BufferAttribute(de,3)),this.setAttribute("uv",new Float32BufferAttribute(Ie,2));function ve(){const Re=new Vector3,Ve=new Vector3;let Ee=0;const Ze=(_-Z)/K;for(let _e=0;_e<=ne;_e++){const Fe=[],Te=_e/ne,ke=Te*(_-Z)+Z;for(let Le=0;Le<=te;Le++){const Ke=Le/te,Ue=Ke*se+oe,rt=Math.sin(Ue),tt=Math.cos(Ue);Ve.x=ke*rt,Ve.y=-Te*K+Ae,Ve.z=ke*tt,ce.push(Ve.x,Ve.y,Ve.z),Re.set(rt,Ze,tt).normalize(),de.push(Re.x,Re.y,Re.z),Ie.push(Ke,1-Te),Fe.push(fe++)}be.push(Fe)}for(let _e=0;_e<te;_e++)for(let Fe=0;Fe<ne;Fe++){const Te=be[Fe][_e],ke=be[Fe+1][_e],Le=be[Fe+1][_e+1],Ke=be[Fe][_e+1];(Z>0||Fe!==0)&&(ge.push(Te,ke,Ke),Ee+=3),(_>0||Fe!==ne-1)&&(ge.push(ke,Le,Ke),Ee+=3)}ae.addGroup(ye,Ee,0),ye+=Ee}function Be(Re){const Ve=fe,Ee=new Vector2,Ze=new Vector3;let _e=0;const Fe=Re===!0?Z:_,Te=Re===!0?1:-1;for(let Le=1;Le<=te;Le++)ce.push(0,Ae*Te,0),de.push(0,Te,0),Ie.push(.5,.5),fe++;const ke=fe;for(let Le=0;Le<=te;Le++){const Ue=Le/te*se+oe,rt=Math.cos(Ue),tt=Math.sin(Ue);Ze.x=Fe*tt,Ze.y=Ae*Te,Ze.z=Fe*rt,ce.push(Ze.x,Ze.y,Ze.z),de.push(0,Te,0),Ee.x=rt*.5+.5,Ee.y=tt*.5*Te+.5,Ie.push(Ee.x,Ee.y),fe++}for(let Le=0;Le<te;Le++){const Ke=Ve+Le,Ue=ke+Le;Re===!0?ge.push(Ue,Ue+1,Ke):ge.push(Ue+1,Ue,Ke),_e+=3}ae.addGroup(ye,_e,Re===!0?1:2),ye+=_e}}copy(Z){return super.copy(Z),this.parameters=Object.assign({},Z.parameters),this}static fromJSON(Z){return new CylinderGeometry(Z.radiusTop,Z.radiusBottom,Z.height,Z.radialSegments,Z.heightSegments,Z.openEnded,Z.thetaStart,Z.thetaLength)}}class ConeGeometry extends CylinderGeometry{constructor(Z=1,_=1,K=32,te=1,ne=!1,ie=0,oe=Math.PI*2){super(0,Z,_,K,te,ne,ie,oe),this.type="ConeGeometry",this.parameters={radius:Z,height:_,radialSegments:K,heightSegments:te,openEnded:ne,thetaStart:ie,thetaLength:oe}}static fromJSON(Z){return new ConeGeometry(Z.radius,Z.height,Z.radialSegments,Z.heightSegments,Z.openEnded,Z.thetaStart,Z.thetaLength)}}class PolyhedronGeometry extends BufferGeometry{constructor(Z=[],_=[],K=1,te=0){super(),this.type="PolyhedronGeometry",this.parameters={vertices:Z,indices:_,radius:K,detail:te};const ne=[],ie=[];oe(te),ae(K),ge(),this.setAttribute("position",new Float32BufferAttribute(ne,3)),this.setAttribute("normal",new Float32BufferAttribute(ne.slice(),3)),this.setAttribute("uv",new Float32BufferAttribute(ie,2)),te===0?this.computeVertexNormals():this.normalizeNormals();function oe(ve){const Be=new Vector3,Re=new Vector3,Ve=new Vector3;for(let Ee=0;Ee<_.length;Ee+=3)Ie(_[Ee+0],Be),Ie(_[Ee+1],Re),Ie(_[Ee+2],Ve),se(Be,Re,Ve,ve)}function se(ve,Be,Re,Ve){const Ee=Ve+1,Ze=[];for(let _e=0;_e<=Ee;_e++){Ze[_e]=[];const Fe=ve.clone().lerp(Re,_e/Ee),Te=Be.clone().lerp(Re,_e/Ee),ke=Ee-_e;for(let Le=0;Le<=ke;Le++)Le===0&&_e===Ee?Ze[_e][Le]=Fe:Ze[_e][Le]=Fe.clone().lerp(Te,Le/ke)}for(let _e=0;_e<Ee;_e++)for(let Fe=0;Fe<2*(Ee-_e)-1;Fe++){const Te=Math.floor(Fe/2);Fe%2===0?(de(Ze[_e][Te+1]),de(Ze[_e+1][Te]),de(Ze[_e][Te])):(de(Ze[_e][Te+1]),de(Ze[_e+1][Te+1]),de(Ze[_e+1][Te]))}}function ae(ve){const Be=new Vector3;for(let Re=0;Re<ne.length;Re+=3)Be.x=ne[Re+0],Be.y=ne[Re+1],Be.z=ne[Re+2],Be.normalize().multiplyScalar(ve),ne[Re+0]=Be.x,ne[Re+1]=Be.y,ne[Re+2]=Be.z}function ge(){const ve=new Vector3;for(let Be=0;Be<ne.length;Be+=3){ve.x=ne[Be+0],ve.y=ne[Be+1],ve.z=ne[Be+2];const Re=Ae(ve)/2/Math.PI+.5,Ve=ye(ve)/Math.PI+.5;ie.push(Re,1-Ve)}fe(),ce()}function ce(){for(let ve=0;ve<ie.length;ve+=6){const Be=ie[ve+0],Re=ie[ve+2],Ve=ie[ve+4],Ee=Math.max(Be,Re,Ve),Ze=Math.min(Be,Re,Ve);Ee>.9&&Ze<.1&&(Be<.2&&(ie[ve+0]+=1),Re<.2&&(ie[ve+2]+=1),Ve<.2&&(ie[ve+4]+=1))}}function de(ve){ne.push(ve.x,ve.y,ve.z)}function Ie(ve,Be){const Re=ve*3;Be.x=Z[Re+0],Be.y=Z[Re+1],Be.z=Z[Re+2]}function fe(){const ve=new Vector3,Be=new Vector3,Re=new Vector3,Ve=new Vector3,Ee=new Vector2,Ze=new Vector2,_e=new Vector2;for(let Fe=0,Te=0;Fe<ne.length;Fe+=9,Te+=6){ve.set(ne[Fe+0],ne[Fe+1],ne[Fe+2]),Be.set(ne[Fe+3],ne[Fe+4],ne[Fe+5]),Re.set(ne[Fe+6],ne[Fe+7],ne[Fe+8]),Ee.set(ie[Te+0],ie[Te+1]),Ze.set(ie[Te+2],ie[Te+3]),_e.set(ie[Te+4],ie[Te+5]),Ve.copy(ve).add(Be).add(Re).divideScalar(3);const ke=Ae(Ve);be(Ee,Te+0,ve,ke),be(Ze,Te+2,Be,ke),be(_e,Te+4,Re,ke)}}function be(ve,Be,Re,Ve){Ve<0&&ve.x===1&&(ie[Be]=ve.x-1),Re.x===0&&Re.z===0&&(ie[Be]=Ve/2/Math.PI+.5)}function Ae(ve){return Math.atan2(ve.z,-ve.x)}function ye(ve){return Math.atan2(-ve.y,Math.sqrt(ve.x*ve.x+ve.z*ve.z))}}copy(Z){return super.copy(Z),this.parameters=Object.assign({},Z.parameters),this}static fromJSON(Z){return new PolyhedronGeometry(Z.vertices,Z.indices,Z.radius,Z.details)}}class DodecahedronGeometry extends PolyhedronGeometry{constructor(Z=1,_=0){const K=(1+Math.sqrt(5))/2,te=1/K,ne=[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-te,-K,0,-te,K,0,te,-K,0,te,K,-te,-K,0,-te,K,0,te,-K,0,te,K,0,-K,0,-te,K,0,-te,-K,0,te,K,0,te],ie=[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9];super(ne,ie,Z,_),this.type="DodecahedronGeometry",this.parameters={radius:Z,detail:_}}static fromJSON(Z){return new DodecahedronGeometry(Z.radius,Z.detail)}}const _v0$3=new Vector3,_v1$1=new Vector3,_normal=new Vector3,_triangle=new Triangle;class EdgesGeometry extends BufferGeometry{constructor(Z=null,_=1){if(super(),this.type="EdgesGeometry",this.parameters={geometry:Z,thresholdAngle:_},Z!==null){const te=Math.pow(10,4),ne=Math.cos(DEG2RAD*_),ie=Z.getIndex(),oe=Z.getAttribute("position"),se=ie?ie.count:oe.count,ae=[0,0,0],ge=["a","b","c"],ce=new Array(3),de={},Ie=[];for(let fe=0;fe<se;fe+=3){ie?(ae[0]=ie.getX(fe),ae[1]=ie.getX(fe+1),ae[2]=ie.getX(fe+2)):(ae[0]=fe,ae[1]=fe+1,ae[2]=fe+2);const{a:be,b:Ae,c:ye}=_triangle;if(be.fromBufferAttribute(oe,ae[0]),Ae.fromBufferAttribute(oe,ae[1]),ye.fromBufferAttribute(oe,ae[2]),_triangle.getNormal(_normal),ce[0]=`${Math.round(be.x*te)},${Math.round(be.y*te)},${Math.round(be.z*te)}`,ce[1]=`${Math.round(Ae.x*te)},${Math.round(Ae.y*te)},${Math.round(Ae.z*te)}`,ce[2]=`${Math.round(ye.x*te)},${Math.round(ye.y*te)},${Math.round(ye.z*te)}`,!(ce[0]===ce[1]||ce[1]===ce[2]||ce[2]===ce[0]))for(let ve=0;ve<3;ve++){const Be=(ve+1)%3,Re=ce[ve],Ve=ce[Be],Ee=_triangle[ge[ve]],Ze=_triangle[ge[Be]],_e=`${Re}_${Ve}`,Fe=`${Ve}_${Re}`;Fe in de&&de[Fe]?(_normal.dot(de[Fe].normal)<=ne&&(Ie.push(Ee.x,Ee.y,Ee.z),Ie.push(Ze.x,Ze.y,Ze.z)),de[Fe]=null):_e in de||(de[_e]={index0:ae[ve],index1:ae[Be],normal:_normal.clone()})}}for(const fe in de)if(de[fe]){const{index0:be,index1:Ae}=de[fe];_v0$3.fromBufferAttribute(oe,be),_v1$1.fromBufferAttribute(oe,Ae),Ie.push(_v0$3.x,_v0$3.y,_v0$3.z),Ie.push(_v1$1.x,_v1$1.y,_v1$1.z)}this.setAttribute("position",new Float32BufferAttribute(Ie,3))}}copy(Z){return super.copy(Z),this.parameters=Object.assign({},Z.parameters),this}}let Shape$2=class extends Path{constructor(Z){super(Z),this.uuid=generateUUID$1(),this.type="Shape",this.holes=[]}getPointsHoles(Z){const _=[];for(let K=0,te=this.holes.length;K<te;K++)_[K]=this.holes[K].getPoints(Z);return _}extractPoints(Z){return{shape:this.getPoints(Z),holes:this.getPointsHoles(Z)}}copy(Z){super.copy(Z),this.holes=[];for(let _=0,K=Z.holes.length;_<K;_++){const te=Z.holes[_];this.holes.push(te.clone())}return this}toJSON(){const Z=super.toJSON();Z.uuid=this.uuid,Z.holes=[];for(let _=0,K=this.holes.length;_<K;_++){const te=this.holes[_];Z.holes.push(te.toJSON())}return Z}fromJSON(Z){super.fromJSON(Z),this.uuid=Z.uuid,this.holes=[];for(let _=0,K=Z.holes.length;_<K;_++){const te=Z.holes[_];this.holes.push(new Path().fromJSON(te))}return this}};const Earcut={triangulate:function(X,Z,_=2){const K=Z&&Z.length,te=K?Z[0]*_:X.length;let ne=linkedList(X,0,te,_,!0);const ie=[];if(!ne||ne.next===ne.prev)return ie;let oe,se,ae,ge,ce,de,Ie;if(K&&(ne=eliminateHoles(X,Z,ne,_)),X.length>80*_){oe=ae=X[0],se=ge=X[1];for(let fe=_;fe<te;fe+=_)ce=X[fe],de=X[fe+1],ce<oe&&(oe=ce),de<se&&(se=de),ce>ae&&(ae=ce),de>ge&&(ge=de);Ie=Math.max(ae-oe,ge-se),Ie=Ie!==0?32767/Ie:0}return earcutLinked(ne,ie,_,oe,se,Ie,0),ie}};function linkedList(X,Z,_,K,te){let ne,ie;if(te===signedArea(X,Z,_,K)>0)for(ne=Z;ne<_;ne+=K)ie=insertNode(ne,X[ne],X[ne+1],ie);else for(ne=_-K;ne>=Z;ne-=K)ie=insertNode(ne,X[ne],X[ne+1],ie);return ie&&equals(ie,ie.next)&&(removeNode(ie),ie=ie.next),ie}function filterPoints(X,Z){if(!X)return X;Z||(Z=X);let _=X,K;do if(K=!1,!_.steiner&&(equals(_,_.next)||area(_.prev,_,_.next)===0)){if(removeNode(_),_=Z=_.prev,_===_.next)break;K=!0}else _=_.next;while(K||_!==Z);return Z}function earcutLinked(X,Z,_,K,te,ne,ie){if(!X)return;!ie&&ne&&indexCurve(X,K,te,ne);let oe=X,se,ae;for(;X.prev!==X.next;){if(se=X.prev,ae=X.next,ne?isEarHashed(X,K,te,ne):isEar(X)){Z.push(se.i/_|0),Z.push(X.i/_|0),Z.push(ae.i/_|0),removeNode(X),X=ae.next,oe=ae.next;continue}if(X=ae,X===oe){ie?ie===1?(X=cureLocalIntersections(filterPoints(X),Z,_),earcutLinked(X,Z,_,K,te,ne,2)):ie===2&&splitEarcut(X,Z,_,K,te,ne):earcutLinked(filterPoints(X),Z,_,K,te,ne,1);break}}}function isEar(X){const Z=X.prev,_=X,K=X.next;if(area(Z,_,K)>=0)return!1;const te=Z.x,ne=_.x,ie=K.x,oe=Z.y,se=_.y,ae=K.y,ge=te<ne?te<ie?te:ie:ne<ie?ne:ie,ce=oe<se?oe<ae?oe:ae:se<ae?se:ae,de=te>ne?te>ie?te:ie:ne>ie?ne:ie,Ie=oe>se?oe>ae?oe:ae:se>ae?se:ae;let fe=K.next;for(;fe!==Z;){if(fe.x>=ge&&fe.x<=de&&fe.y>=ce&&fe.y<=Ie&&pointInTriangle(te,oe,ne,se,ie,ae,fe.x,fe.y)&&area(fe.prev,fe,fe.next)>=0)return!1;fe=fe.next}return!0}function isEarHashed(X,Z,_,K){const te=X.prev,ne=X,ie=X.next;if(area(te,ne,ie)>=0)return!1;const oe=te.x,se=ne.x,ae=ie.x,ge=te.y,ce=ne.y,de=ie.y,Ie=oe<se?oe<ae?oe:ae:se<ae?se:ae,fe=ge<ce?ge<de?ge:de:ce<de?ce:de,be=oe>se?oe>ae?oe:ae:se>ae?se:ae,Ae=ge>ce?ge>de?ge:de:ce>de?ce:de,ye=zOrder(Ie,fe,Z,_,K),ve=zOrder(be,Ae,Z,_,K);let Be=X.prevZ,Re=X.nextZ;for(;Be&&Be.z>=ye&&Re&&Re.z<=ve;){if(Be.x>=Ie&&Be.x<=be&&Be.y>=fe&&Be.y<=Ae&&Be!==te&&Be!==ie&&pointInTriangle(oe,ge,se,ce,ae,de,Be.x,Be.y)&&area(Be.prev,Be,Be.next)>=0||(Be=Be.prevZ,Re.x>=Ie&&Re.x<=be&&Re.y>=fe&&Re.y<=Ae&&Re!==te&&Re!==ie&&pointInTriangle(oe,ge,se,ce,ae,de,Re.x,Re.y)&&area(Re.prev,Re,Re.next)>=0))return!1;Re=Re.nextZ}for(;Be&&Be.z>=ye;){if(Be.x>=Ie&&Be.x<=be&&Be.y>=fe&&Be.y<=Ae&&Be!==te&&Be!==ie&&pointInTriangle(oe,ge,se,ce,ae,de,Be.x,Be.y)&&area(Be.prev,Be,Be.next)>=0)return!1;Be=Be.prevZ}for(;Re&&Re.z<=ve;){if(Re.x>=Ie&&Re.x<=be&&Re.y>=fe&&Re.y<=Ae&&Re!==te&&Re!==ie&&pointInTriangle(oe,ge,se,ce,ae,de,Re.x,Re.y)&&area(Re.prev,Re,Re.next)>=0)return!1;Re=Re.nextZ}return!0}function cureLocalIntersections(X,Z,_){let K=X;do{const te=K.prev,ne=K.next.next;!equals(te,ne)&&intersects(te,K,K.next,ne)&&locallyInside(te,ne)&&locallyInside(ne,te)&&(Z.push(te.i/_|0),Z.push(K.i/_|0),Z.push(ne.i/_|0),removeNode(K),removeNode(K.next),K=X=ne),K=K.next}while(K!==X);return filterPoints(K)}function splitEarcut(X,Z,_,K,te,ne){let ie=X;do{let oe=ie.next.next;for(;oe!==ie.prev;){if(ie.i!==oe.i&&isValidDiagonal(ie,oe)){let se=splitPolygon(ie,oe);ie=filterPoints(ie,ie.next),se=filterPoints(se,se.next),earcutLinked(ie,Z,_,K,te,ne,0),earcutLinked(se,Z,_,K,te,ne,0);return}oe=oe.next}ie=ie.next}while(ie!==X)}function eliminateHoles(X,Z,_,K){const te=[];let ne,ie,oe,se,ae;for(ne=0,ie=Z.length;ne<ie;ne++)oe=Z[ne]*K,se=ne<ie-1?Z[ne+1]*K:X.length,ae=linkedList(X,oe,se,K,!1),ae===ae.next&&(ae.steiner=!0),te.push(getLeftmost(ae));for(te.sort(compareX),ne=0;ne<te.length;ne++)_=eliminateHole(te[ne],_);return _}function compareX(X,Z){return X.x-Z.x}function eliminateHole(X,Z){const _=findHoleBridge(X,Z);if(!_)return Z;const K=splitPolygon(_,X);return filterPoints(K,K.next),filterPoints(_,_.next)}function findHoleBridge(X,Z){let _=Z,K=-1/0,te;const ne=X.x,ie=X.y;do{if(ie<=_.y&&ie>=_.next.y&&_.next.y!==_.y){const de=_.x+(ie-_.y)*(_.next.x-_.x)/(_.next.y-_.y);if(de<=ne&&de>K&&(K=de,te=_.x<_.next.x?_:_.next,de===ne))return te}_=_.next}while(_!==Z);if(!te)return null;const oe=te,se=te.x,ae=te.y;let ge=1/0,ce;_=te;do ne>=_.x&&_.x>=se&&ne!==_.x&&pointInTriangle(ie<ae?ne:K,ie,se,ae,ie<ae?K:ne,ie,_.x,_.y)&&(ce=Math.abs(ie-_.y)/(ne-_.x),locallyInside(_,X)&&(ce<ge||ce===ge&&(_.x>te.x||_.x===te.x&&sectorContainsSector(te,_)))&&(te=_,ge=ce)),_=_.next;while(_!==oe);return te}function sectorContainsSector(X,Z){return area(X.prev,X,Z.prev)<0&&area(Z.next,X,X.next)<0}function indexCurve(X,Z,_,K){let te=X;do te.z===0&&(te.z=zOrder(te.x,te.y,Z,_,K)),te.prevZ=te.prev,te.nextZ=te.next,te=te.next;while(te!==X);te.prevZ.nextZ=null,te.prevZ=null,sortLinked(te)}function sortLinked(X){let Z,_,K,te,ne,ie,oe,se,ae=1;do{for(_=X,X=null,ne=null,ie=0;_;){for(ie++,K=_,oe=0,Z=0;Z<ae&&(oe++,K=K.nextZ,!!K);Z++);for(se=ae;oe>0||se>0&&K;)oe!==0&&(se===0||!K||_.z<=K.z)?(te=_,_=_.nextZ,oe--):(te=K,K=K.nextZ,se--),ne?ne.nextZ=te:X=te,te.prevZ=ne,ne=te;_=K}ne.nextZ=null,ae*=2}while(ie>1);return X}function zOrder(X,Z,_,K,te){return X=(X-_)*te|0,Z=(Z-K)*te|0,X=(X|X<<8)&16711935,X=(X|X<<4)&252645135,X=(X|X<<2)&858993459,X=(X|X<<1)&1431655765,Z=(Z|Z<<8)&16711935,Z=(Z|Z<<4)&252645135,Z=(Z|Z<<2)&858993459,Z=(Z|Z<<1)&1431655765,X|Z<<1}function getLeftmost(X){let Z=X,_=X;do(Z.x<_.x||Z.x===_.x&&Z.y<_.y)&&(_=Z),Z=Z.next;while(Z!==X);return _}function pointInTriangle(X,Z,_,K,te,ne,ie,oe){return(te-ie)*(Z-oe)>=(X-ie)*(ne-oe)&&(X-ie)*(K-oe)>=(_-ie)*(Z-oe)&&(_-ie)*(ne-oe)>=(te-ie)*(K-oe)}function isValidDiagonal(X,Z){return X.next.i!==Z.i&&X.prev.i!==Z.i&&!intersectsPolygon(X,Z)&&(locallyInside(X,Z)&&locallyInside(Z,X)&&middleInside(X,Z)&&(area(X.prev,X,Z.prev)||area(X,Z.prev,Z))||equals(X,Z)&&area(X.prev,X,X.next)>0&&area(Z.prev,Z,Z.next)>0)}function area(X,Z,_){return(Z.y-X.y)*(_.x-Z.x)-(Z.x-X.x)*(_.y-Z.y)}function equals(X,Z){return X.x===Z.x&&X.y===Z.y}function intersects(X,Z,_,K){const te=sign(area(X,Z,_)),ne=sign(area(X,Z,K)),ie=sign(area(_,K,X)),oe=sign(area(_,K,Z));return!!(te!==ne&&ie!==oe||te===0&&onSegment(X,_,Z)||ne===0&&onSegment(X,K,Z)||ie===0&&onSegment(_,X,K)||oe===0&&onSegment(_,Z,K))}function onSegment(X,Z,_){return Z.x<=Math.max(X.x,_.x)&&Z.x>=Math.min(X.x,_.x)&&Z.y<=Math.max(X.y,_.y)&&Z.y>=Math.min(X.y,_.y)}function sign(X){return X>0?1:X<0?-1:0}function intersectsPolygon(X,Z){let _=X;do{if(_.i!==X.i&&_.next.i!==X.i&&_.i!==Z.i&&_.next.i!==Z.i&&intersects(_,_.next,X,Z))return!0;_=_.next}while(_!==X);return!1}function locallyInside(X,Z){return area(X.prev,X,X.next)<0?area(X,Z,X.next)>=0&&area(X,X.prev,Z)>=0:area(X,Z,X.prev)<0||area(X,X.next,Z)<0}function middleInside(X,Z){let _=X,K=!1;const te=(X.x+Z.x)/2,ne=(X.y+Z.y)/2;do _.y>ne!=_.next.y>ne&&_.next.y!==_.y&&te<(_.next.x-_.x)*(ne-_.y)/(_.next.y-_.y)+_.x&&(K=!K),_=_.next;while(_!==X);return K}function splitPolygon(X,Z){const _=new Node(X.i,X.x,X.y),K=new Node(Z.i,Z.x,Z.y),te=X.next,ne=Z.prev;return X.next=Z,Z.prev=X,_.next=te,te.prev=_,K.next=_,_.prev=K,ne.next=K,K.prev=ne,K}function insertNode(X,Z,_,K){const te=new Node(X,Z,_);return K?(te.next=K.next,te.prev=K,K.next.prev=te,K.next=te):(te.prev=te,te.next=te),te}function removeNode(X){X.next.prev=X.prev,X.prev.next=X.next,X.prevZ&&(X.prevZ.nextZ=X.nextZ),X.nextZ&&(X.nextZ.prevZ=X.prevZ)}function Node(X,Z,_){this.i=X,this.x=Z,this.y=_,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function signedArea(X,Z,_,K){let te=0;for(let ne=Z,ie=_-K;ne<_;ne+=K)te+=(X[ie]-X[ne])*(X[ne+1]+X[ie+1]),ie=ne;return te}class ShapeUtils{static area(Z){const _=Z.length;let K=0;for(let te=_-1,ne=0;ne<_;te=ne++)K+=Z[te].x*Z[ne].y-Z[ne].x*Z[te].y;return K*.5}static isClockWise(Z){return ShapeUtils.area(Z)<0}static triangulateShape(Z,_){const K=[],te=[],ne=[];removeDupEndPts(Z),addContour(K,Z);let ie=Z.length;_.forEach(removeDupEndPts);for(let se=0;se<_.length;se++)te.push(ie),ie+=_[se].length,addContour(K,_[se]);const oe=Earcut.triangulate(K,te);for(let se=0;se<oe.length;se+=3)ne.push(oe.slice(se,se+3));return ne}}function removeDupEndPts(X){const Z=X.length;Z>2&&X[Z-1].equals(X[0])&&X.pop()}function addContour(X,Z){for(let _=0;_<Z.length;_++)X.push(Z[_].x),X.push(Z[_].y)}class ExtrudeGeometry extends BufferGeometry{constructor(Z=new Shape$2([new Vector2(.5,.5),new Vector2(-.5,.5),new Vector2(-.5,-.5),new Vector2(.5,-.5)]),_={}){super(),this.type="ExtrudeGeometry",this.parameters={shapes:Z,options:_},Z=Array.isArray(Z)?Z:[Z];const K=this,te=[],ne=[];for(let oe=0,se=Z.length;oe<se;oe++){const ae=Z[oe];ie(ae)}this.setAttribute("position",new Float32BufferAttribute(te,3)),this.setAttribute("uv",new Float32BufferAttribute(ne,2)),this.computeVertexNormals();function ie(oe){const se=[],ae=_.curveSegments!==void 0?_.curveSegments:12,ge=_.steps!==void 0?_.steps:1,ce=_.depth!==void 0?_.depth:1;let de=_.bevelEnabled!==void 0?_.bevelEnabled:!0,Ie=_.bevelThickness!==void 0?_.bevelThickness:.2,fe=_.bevelSize!==void 0?_.bevelSize:Ie-.1,be=_.bevelOffset!==void 0?_.bevelOffset:0,Ae=_.bevelSegments!==void 0?_.bevelSegments:3;const ye=_.extrudePath,ve=_.UVGenerator!==void 0?_.UVGenerator:WorldUVGenerator;let Be,Re=!1,Ve,Ee,Ze,_e;ye&&(Be=ye.getSpacedPoints(ge),Re=!0,de=!1,Ve=ye.computeFrenetFrames(ge,!1),Ee=new Vector3,Ze=new Vector3,_e=new Vector3),de||(Ae=0,Ie=0,fe=0,be=0);const Fe=oe.extractPoints(ae);let Te=Fe.shape;const ke=Fe.holes;if(!ShapeUtils.isClockWise(Te)){Te=Te.reverse();for(let mt=0,Ft=ke.length;mt<Ft;mt++){const it=ke[mt];ShapeUtils.isClockWise(it)&&(ke[mt]=it.reverse())}}const Ke=ShapeUtils.triangulateShape(Te,ke),Ue=Te;for(let mt=0,Ft=ke.length;mt<Ft;mt++){const it=ke[mt];Te=Te.concat(it)}function rt(mt,Ft,it){return Ft||console.error("THREE.ExtrudeGeometry: vec does not exist"),mt.clone().addScaledVector(Ft,it)}const tt=Te.length,at=Ke.length;function ze(mt,Ft,it){let Lt,Et,Ut;const Zt=mt.x-Ft.x,Ot=mt.y-Ft.y,Tt=it.x-mt.x,Je=it.y-mt.y,Oe=Zt*Zt+Ot*Ot,lt=Zt*Je-Ot*Tt;if(Math.abs(lt)>Number.EPSILON){const ft=Math.sqrt(Oe),St=Math.sqrt(Tt*Tt+Je*Je),Wt=Ft.x-Ot/ft,zt=Ft.y+Zt/ft,$t=it.x-Je/St,rn=it.y+Tt/St,Gn=(($t-Wt)*Je-(rn-zt)*Tt)/(Zt*Je-Ot*Tt);Lt=Wt+Zt*Gn-mt.x,Et=zt+Ot*Gn-mt.y;const en=Lt*Lt+Et*Et;if(en<=2)return new Vector2(Lt,Et);Ut=Math.sqrt(en/2)}else{let ft=!1;Zt>Number.EPSILON?Tt>Number.EPSILON&&(ft=!0):Zt<-Number.EPSILON?Tt<-Number.EPSILON&&(ft=!0):Math.sign(Ot)===Math.sign(Je)&&(ft=!0),ft?(Lt=-Ot,Et=Zt,Ut=Math.sqrt(Oe)):(Lt=Zt,Et=Ot,Ut=Math.sqrt(Oe/2))}return new Vector2(Lt/Ut,Et/Ut)}const qe=[];for(let mt=0,Ft=Ue.length,it=Ft-1,Lt=mt+1;mt<Ft;mt++,it++,Lt++)it===Ft&&(it=0),Lt===Ft&&(Lt=0),qe[mt]=ze(Ue[mt],Ue[it],Ue[Lt]);const Pe=[];let Ye,$e=qe.concat();for(let mt=0,Ft=ke.length;mt<Ft;mt++){const it=ke[mt];Ye=[];for(let Lt=0,Et=it.length,Ut=Et-1,Zt=Lt+1;Lt<Et;Lt++,Ut++,Zt++)Ut===Et&&(Ut=0),Zt===Et&&(Zt=0),Ye[Lt]=ze(it[Lt],it[Ut],it[Zt]);Pe.push(Ye),$e=$e.concat(Ye)}for(let mt=0;mt<Ae;mt++){const Ft=mt/Ae,it=Ie*Math.cos(Ft*Math.PI/2),Lt=fe*Math.sin(Ft*Math.PI/2)+be;for(let Et=0,Ut=Ue.length;Et<Ut;Et++){const Zt=rt(Ue[Et],qe[Et],Lt);dt(Zt.x,Zt.y,-it)}for(let Et=0,Ut=ke.length;Et<Ut;Et++){const Zt=ke[Et];Ye=Pe[Et];for(let Ot=0,Tt=Zt.length;Ot<Tt;Ot++){const Je=rt(Zt[Ot],Ye[Ot],Lt);dt(Je.x,Je.y,-it)}}}const ut=fe+be;for(let mt=0;mt<tt;mt++){const Ft=de?rt(Te[mt],$e[mt],ut):Te[mt];Re?(Ze.copy(Ve.normals[0]).multiplyScalar(Ft.x),Ee.copy(Ve.binormals[0]).multiplyScalar(Ft.y),_e.copy(Be[0]).add(Ze).add(Ee),dt(_e.x,_e.y,_e.z)):dt(Ft.x,Ft.y,0)}for(let mt=1;mt<=ge;mt++)for(let Ft=0;Ft<tt;Ft++){const it=de?rt(Te[Ft],$e[Ft],ut):Te[Ft];Re?(Ze.copy(Ve.normals[mt]).multiplyScalar(it.x),Ee.copy(Ve.binormals[mt]).multiplyScalar(it.y),_e.copy(Be[mt]).add(Ze).add(Ee),dt(_e.x,_e.y,_e.z)):dt(it.x,it.y,ce/ge*mt)}for(let mt=Ae-1;mt>=0;mt--){const Ft=mt/Ae,it=Ie*Math.cos(Ft*Math.PI/2),Lt=fe*Math.sin(Ft*Math.PI/2)+be;for(let Et=0,Ut=Ue.length;Et<Ut;Et++){const Zt=rt(Ue[Et],qe[Et],Lt);dt(Zt.x,Zt.y,ce+it)}for(let Et=0,Ut=ke.length;Et<Ut;Et++){const Zt=ke[Et];Ye=Pe[Et];for(let Ot=0,Tt=Zt.length;Ot<Tt;Ot++){const Je=rt(Zt[Ot],Ye[Ot],Lt);Re?dt(Je.x,Je.y+Be[ge-1].y,Be[ge-1].x+it):dt(Je.x,Je.y,ce+it)}}}ot(),gt();function ot(){const mt=te.length/3;if(de){let Ft=0,it=tt*Ft;for(let Lt=0;Lt<at;Lt++){const Et=Ke[Lt];bt(Et[2]+it,Et[1]+it,Et[0]+it)}Ft=ge+Ae*2,it=tt*Ft;for(let Lt=0;Lt<at;Lt++){const Et=Ke[Lt];bt(Et[0]+it,Et[1]+it,Et[2]+it)}}else{for(let Ft=0;Ft<at;Ft++){const it=Ke[Ft];bt(it[2],it[1],it[0])}for(let Ft=0;Ft<at;Ft++){const it=Ke[Ft];bt(it[0]+tt*ge,it[1]+tt*ge,it[2]+tt*ge)}}K.addGroup(mt,te.length/3-mt,0)}function gt(){const mt=te.length/3;let Ft=0;ht(Ue,Ft),Ft+=Ue.length;for(let it=0,Lt=ke.length;it<Lt;it++){const Et=ke[it];ht(Et,Ft),Ft+=Et.length}K.addGroup(mt,te.length/3-mt,1)}function ht(mt,Ft){let it=mt.length;for(;--it>=0;){const Lt=it;let Et=it-1;Et<0&&(Et=mt.length-1);for(let Ut=0,Zt=ge+Ae*2;Ut<Zt;Ut++){const Ot=tt*Ut,Tt=tt*(Ut+1),Je=Ft+Lt+Ot,Oe=Ft+Et+Ot,lt=Ft+Et+Tt,ft=Ft+Lt+Tt;Ht(Je,Oe,lt,ft)}}}function dt(mt,Ft,it){se.push(mt),se.push(Ft),se.push(it)}function bt(mt,Ft,it){Dt(mt),Dt(Ft),Dt(it);const Lt=te.length/3,Et=ve.generateTopUV(K,te,Lt-3,Lt-2,Lt-1);Vt(Et[0]),Vt(Et[1]),Vt(Et[2])}function Ht(mt,Ft,it,Lt){Dt(mt),Dt(Ft),Dt(Lt),Dt(Ft),Dt(it),Dt(Lt);const Et=te.length/3,Ut=ve.generateSideWallUV(K,te,Et-6,Et-3,Et-2,Et-1);Vt(Ut[0]),Vt(Ut[1]),Vt(Ut[3]),Vt(Ut[1]),Vt(Ut[2]),Vt(Ut[3])}function Dt(mt){te.push(se[mt*3+0]),te.push(se[mt*3+1]),te.push(se[mt*3+2])}function Vt(mt){ne.push(mt.x),ne.push(mt.y)}}}copy(Z){return super.copy(Z),this.parameters=Object.assign({},Z.parameters),this}toJSON(){const Z=super.toJSON(),_=this.parameters.shapes,K=this.parameters.options;return toJSON$1(_,K,Z)}static fromJSON(Z,_){const K=[];for(let ne=0,ie=Z.shapes.length;ne<ie;ne++){const oe=_[Z.shapes[ne]];K.push(oe)}const te=Z.options.extrudePath;return te!==void 0&&(Z.options.extrudePath=new Curves[te.type]().fromJSON(te)),new ExtrudeGeometry(K,Z.options)}}const WorldUVGenerator={generateTopUV:function(X,Z,_,K,te){const ne=Z[_*3],ie=Z[_*3+1],oe=Z[K*3],se=Z[K*3+1],ae=Z[te*3],ge=Z[te*3+1];return[new Vector2(ne,ie),new Vector2(oe,se),new Vector2(ae,ge)]},generateSideWallUV:function(X,Z,_,K,te,ne){const ie=Z[_*3],oe=Z[_*3+1],se=Z[_*3+2],ae=Z[K*3],ge=Z[K*3+1],ce=Z[K*3+2],de=Z[te*3],Ie=Z[te*3+1],fe=Z[te*3+2],be=Z[ne*3],Ae=Z[ne*3+1],ye=Z[ne*3+2];return Math.abs(oe-ge)<Math.abs(ie-ae)?[new Vector2(ie,1-se),new Vector2(ae,1-ce),new Vector2(de,1-fe),new Vector2(be,1-ye)]:[new Vector2(oe,1-se),new Vector2(ge,1-ce),new Vector2(Ie,1-fe),new Vector2(Ae,1-ye)]}};function toJSON$1(X,Z,_){if(_.shapes=[],Array.isArray(X))for(let K=0,te=X.length;K<te;K++){const ne=X[K];_.shapes.push(ne.uuid)}else _.shapes.push(X.uuid);return _.options=Object.assign({},Z),Z.extrudePath!==void 0&&(_.options.extrudePath=Z.extrudePath.toJSON()),_}class IcosahedronGeometry extends PolyhedronGeometry{constructor(Z=1,_=0){const K=(1+Math.sqrt(5))/2,te=[-1,K,0,1,K,0,-1,-K,0,1,-K,0,0,-1,K,0,1,K,0,-1,-K,0,1,-K,K,0,-1,K,0,1,-K,0,-1,-K,0,1],ne=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1];super(te,ne,Z,_),this.type="IcosahedronGeometry",this.parameters={radius:Z,detail:_}}static fromJSON(Z){return new IcosahedronGeometry(Z.radius,Z.detail)}}class OctahedronGeometry extends PolyhedronGeometry{constructor(Z=1,_=0){const K=[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],te=[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2];super(K,te,Z,_),this.type="OctahedronGeometry",this.parameters={radius:Z,detail:_}}static fromJSON(Z){return new OctahedronGeometry(Z.radius,Z.detail)}}class PlaneGeometry extends BufferGeometry{constructor(Z=1,_=1,K=1,te=1){super(),this.type="PlaneGeometry",this.parameters={width:Z,height:_,widthSegments:K,heightSegments:te};const ne=Z/2,ie=_/2,oe=Math.floor(K),se=Math.floor(te),ae=oe+1,ge=se+1,ce=Z/oe,de=_/se,Ie=[],fe=[],be=[],Ae=[];for(let ye=0;ye<ge;ye++){const ve=ye*de-ie;for(let Be=0;Be<ae;Be++){const Re=Be*ce-ne;fe.push(Re,-ve,0),be.push(0,0,1),Ae.push(Be/oe),Ae.push(1-ye/se)}}for(let ye=0;ye<se;ye++)for(let ve=0;ve<oe;ve++){const Be=ve+ae*ye,Re=ve+ae*(ye+1),Ve=ve+1+ae*(ye+1),Ee=ve+1+ae*ye;Ie.push(Be,Re,Ee),Ie.push(Re,Ve,Ee)}this.setIndex(Ie),this.setAttribute("position",new Float32BufferAttribute(fe,3)),this.setAttribute("normal",new Float32BufferAttribute(be,3)),this.setAttribute("uv",new Float32BufferAttribute(Ae,2))}copy(Z){return super.copy(Z),this.parameters=Object.assign({},Z.parameters),this}static fromJSON(Z){return new PlaneGeometry(Z.width,Z.height,Z.widthSegments,Z.heightSegments)}}class RingGeometry extends BufferGeometry{constructor(Z=.5,_=1,K=32,te=1,ne=0,ie=Math.PI*2){super(),this.type="RingGeometry",this.parameters={innerRadius:Z,outerRadius:_,thetaSegments:K,phiSegments:te,thetaStart:ne,thetaLength:ie},K=Math.max(3,K),te=Math.max(1,te);const oe=[],se=[],ae=[],ge=[];let ce=Z;const de=(_-Z)/te,Ie=new Vector3,fe=new Vector2;for(let be=0;be<=te;be++){for(let Ae=0;Ae<=K;Ae++){const ye=ne+Ae/K*ie;Ie.x=ce*Math.cos(ye),Ie.y=ce*Math.sin(ye),se.push(Ie.x,Ie.y,Ie.z),ae.push(0,0,1),fe.x=(Ie.x/_+1)/2,fe.y=(Ie.y/_+1)/2,ge.push(fe.x,fe.y)}ce+=de}for(let be=0;be<te;be++){const Ae=be*(K+1);for(let ye=0;ye<K;ye++){const ve=ye+Ae,Be=ve,Re=ve+K+1,Ve=ve+K+2,Ee=ve+1;oe.push(Be,Re,Ee),oe.push(Re,Ve,Ee)}}this.setIndex(oe),this.setAttribute("position",new Float32BufferAttribute(se,3)),this.setAttribute("normal",new Float32BufferAttribute(ae,3)),this.setAttribute("uv",new Float32BufferAttribute(ge,2))}copy(Z){return super.copy(Z),this.parameters=Object.assign({},Z.parameters),this}static fromJSON(Z){return new RingGeometry(Z.innerRadius,Z.outerRadius,Z.thetaSegments,Z.phiSegments,Z.thetaStart,Z.thetaLength)}}class ShapeGeometry extends BufferGeometry{constructor(Z=new Shape$2([new Vector2(0,.5),new Vector2(-.5,-.5),new Vector2(.5,-.5)]),_=12){super(),this.type="ShapeGeometry",this.parameters={shapes:Z,curveSegments:_};const K=[],te=[],ne=[],ie=[];let oe=0,se=0;if(Array.isArray(Z)===!1)ae(Z);else for(let ge=0;ge<Z.length;ge++)ae(Z[ge]),this.addGroup(oe,se,ge),oe+=se,se=0;this.setIndex(K),this.setAttribute("position",new Float32BufferAttribute(te,3)),this.setAttribute("normal",new Float32BufferAttribute(ne,3)),this.setAttribute("uv",new Float32BufferAttribute(ie,2));function ae(ge){const ce=te.length/3,de=ge.extractPoints(_);let Ie=de.shape;const fe=de.holes;ShapeUtils.isClockWise(Ie)===!1&&(Ie=Ie.reverse());for(let Ae=0,ye=fe.length;Ae<ye;Ae++){const ve=fe[Ae];ShapeUtils.isClockWise(ve)===!0&&(fe[Ae]=ve.reverse())}const be=ShapeUtils.triangulateShape(Ie,fe);for(let Ae=0,ye=fe.length;Ae<ye;Ae++){const ve=fe[Ae];Ie=Ie.concat(ve)}for(let Ae=0,ye=Ie.length;Ae<ye;Ae++){const ve=Ie[Ae];te.push(ve.x,ve.y,0),ne.push(0,0,1),ie.push(ve.x,ve.y)}for(let Ae=0,ye=be.length;Ae<ye;Ae++){const ve=be[Ae],Be=ve[0]+ce,Re=ve[1]+ce,Ve=ve[2]+ce;K.push(Be,Re,Ve),se+=3}}}copy(Z){return super.copy(Z),this.parameters=Object.assign({},Z.parameters),this}toJSON(){const Z=super.toJSON(),_=this.parameters.shapes;return toJSON(_,Z)}static fromJSON(Z,_){const K=[];for(let te=0,ne=Z.shapes.length;te<ne;te++){const ie=_[Z.shapes[te]];K.push(ie)}return new ShapeGeometry(K,Z.curveSegments)}}function toJSON(X,Z){if(Z.shapes=[],Array.isArray(X))for(let _=0,K=X.length;_<K;_++){const te=X[_];Z.shapes.push(te.uuid)}else Z.shapes.push(X.uuid);return Z}class SphereGeometry extends BufferGeometry{constructor(Z=1,_=32,K=16,te=0,ne=Math.PI*2,ie=0,oe=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:Z,widthSegments:_,heightSegments:K,phiStart:te,phiLength:ne,thetaStart:ie,thetaLength:oe},_=Math.max(3,Math.floor(_)),K=Math.max(2,Math.floor(K));const se=Math.min(ie+oe,Math.PI);let ae=0;const ge=[],ce=new Vector3,de=new Vector3,Ie=[],fe=[],be=[],Ae=[];for(let ye=0;ye<=K;ye++){const ve=[],Be=ye/K;let Re=0;ye===0&&ie===0?Re=.5/_:ye===K&&se===Math.PI&&(Re=-.5/_);for(let Ve=0;Ve<=_;Ve++){const Ee=Ve/_;ce.x=-Z*Math.cos(te+Ee*ne)*Math.sin(ie+Be*oe),ce.y=Z*Math.cos(ie+Be*oe),ce.z=Z*Math.sin(te+Ee*ne)*Math.sin(ie+Be*oe),fe.push(ce.x,ce.y,ce.z),de.copy(ce).normalize(),be.push(de.x,de.y,de.z),Ae.push(Ee+Re,1-Be),ve.push(ae++)}ge.push(ve)}for(let ye=0;ye<K;ye++)for(let ve=0;ve<_;ve++){const Be=ge[ye][ve+1],Re=ge[ye][ve],Ve=ge[ye+1][ve],Ee=ge[ye+1][ve+1];(ye!==0||ie>0)&&Ie.push(Be,Re,Ee),(ye!==K-1||se<Math.PI)&&Ie.push(Re,Ve,Ee)}this.setIndex(Ie),this.setAttribute("position",new Float32BufferAttribute(fe,3)),this.setAttribute("normal",new Float32BufferAttribute(be,3)),this.setAttribute("uv",new Float32BufferAttribute(Ae,2))}copy(Z){return super.copy(Z),this.parameters=Object.assign({},Z.parameters),this}static fromJSON(Z){return new SphereGeometry(Z.radius,Z.widthSegments,Z.heightSegments,Z.phiStart,Z.phiLength,Z.thetaStart,Z.thetaLength)}}class TetrahedronGeometry extends PolyhedronGeometry{constructor(Z=1,_=0){const K=[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],te=[2,1,0,0,3,2,1,3,0,2,3,1];super(K,te,Z,_),this.type="TetrahedronGeometry",this.parameters={radius:Z,detail:_}}static fromJSON(Z){return new TetrahedronGeometry(Z.radius,Z.detail)}}class TorusGeometry extends BufferGeometry{constructor(Z=1,_=.4,K=12,te=48,ne=Math.PI*2){super(),this.type="TorusGeometry",this.parameters={radius:Z,tube:_,radialSegments:K,tubularSegments:te,arc:ne},K=Math.floor(K),te=Math.floor(te);const ie=[],oe=[],se=[],ae=[],ge=new Vector3,ce=new Vector3,de=new Vector3;for(let Ie=0;Ie<=K;Ie++)for(let fe=0;fe<=te;fe++){const be=fe/te*ne,Ae=Ie/K*Math.PI*2;ce.x=(Z+_*Math.cos(Ae))*Math.cos(be),ce.y=(Z+_*Math.cos(Ae))*Math.sin(be),ce.z=_*Math.sin(Ae),oe.push(ce.x,ce.y,ce.z),ge.x=Z*Math.cos(be),ge.y=Z*Math.sin(be),de.subVectors(ce,ge).normalize(),se.push(de.x,de.y,de.z),ae.push(fe/te),ae.push(Ie/K)}for(let Ie=1;Ie<=K;Ie++)for(let fe=1;fe<=te;fe++){const be=(te+1)*Ie+fe-1,Ae=(te+1)*(Ie-1)+fe-1,ye=(te+1)*(Ie-1)+fe,ve=(te+1)*Ie+fe;ie.push(be,Ae,ve),ie.push(Ae,ye,ve)}this.setIndex(ie),this.setAttribute("position",new Float32BufferAttribute(oe,3)),this.setAttribute("normal",new Float32BufferAttribute(se,3)),this.setAttribute("uv",new Float32BufferAttribute(ae,2))}copy(Z){return super.copy(Z),this.parameters=Object.assign({},Z.parameters),this}static fromJSON(Z){return new TorusGeometry(Z.radius,Z.tube,Z.radialSegments,Z.tubularSegments,Z.arc)}}class TorusKnotGeometry extends BufferGeometry{constructor(Z=1,_=.4,K=64,te=8,ne=2,ie=3){super(),this.type="TorusKnotGeometry",this.parameters={radius:Z,tube:_,tubularSegments:K,radialSegments:te,p:ne,q:ie},K=Math.floor(K),te=Math.floor(te);const oe=[],se=[],ae=[],ge=[],ce=new Vector3,de=new Vector3,Ie=new Vector3,fe=new Vector3,be=new Vector3,Ae=new Vector3,ye=new Vector3;for(let Be=0;Be<=K;++Be){const Re=Be/K*ne*Math.PI*2;ve(Re,ne,ie,Z,Ie),ve(Re+.01,ne,ie,Z,fe),Ae.subVectors(fe,Ie),ye.addVectors(fe,Ie),be.crossVectors(Ae,ye),ye.crossVectors(be,Ae),be.normalize(),ye.normalize();for(let Ve=0;Ve<=te;++Ve){const Ee=Ve/te*Math.PI*2,Ze=-_*Math.cos(Ee),_e=_*Math.sin(Ee);ce.x=Ie.x+(Ze*ye.x+_e*be.x),ce.y=Ie.y+(Ze*ye.y+_e*be.y),ce.z=Ie.z+(Ze*ye.z+_e*be.z),se.push(ce.x,ce.y,ce.z),de.subVectors(ce,Ie).normalize(),ae.push(de.x,de.y,de.z),ge.push(Be/K),ge.push(Ve/te)}}for(let Be=1;Be<=K;Be++)for(let Re=1;Re<=te;Re++){const Ve=(te+1)*(Be-1)+(Re-1),Ee=(te+1)*Be+(Re-1),Ze=(te+1)*Be+Re,_e=(te+1)*(Be-1)+Re;oe.push(Ve,Ee,_e),oe.push(Ee,Ze,_e)}this.setIndex(oe),this.setAttribute("position",new Float32BufferAttribute(se,3)),this.setAttribute("normal",new Float32BufferAttribute(ae,3)),this.setAttribute("uv",new Float32BufferAttribute(ge,2));function ve(Be,Re,Ve,Ee,Ze){const _e=Math.cos(Be),Fe=Math.sin(Be),Te=Ve/Re*Be,ke=Math.cos(Te);Ze.x=Ee*(2+ke)*.5*_e,Ze.y=Ee*(2+ke)*Fe*.5,Ze.z=Ee*Math.sin(Te)*.5}}copy(Z){return super.copy(Z),this.parameters=Object.assign({},Z.parameters),this}static fromJSON(Z){return new TorusKnotGeometry(Z.radius,Z.tube,Z.tubularSegments,Z.radialSegments,Z.p,Z.q)}}class TubeGeometry extends BufferGeometry{constructor(Z=new QuadraticBezierCurve3(new Vector3(-1,-1,0),new Vector3(-1,1,0),new Vector3(1,1,0)),_=64,K=1,te=8,ne=!1){super(),this.type="TubeGeometry",this.parameters={path:Z,tubularSegments:_,radius:K,radialSegments:te,closed:ne};const ie=Z.computeFrenetFrames(_,ne);this.tangents=ie.tangents,this.normals=ie.normals,this.binormals=ie.binormals;const oe=new Vector3,se=new Vector3,ae=new Vector2;let ge=new Vector3;const ce=[],de=[],Ie=[],fe=[];be(),this.setIndex(fe),this.setAttribute("position",new Float32BufferAttribute(ce,3)),this.setAttribute("normal",new Float32BufferAttribute(de,3)),this.setAttribute("uv",new Float32BufferAttribute(Ie,2));function be(){for(let Be=0;Be<_;Be++)Ae(Be);Ae(ne===!1?_:0),ve(),ye()}function Ae(Be){ge=Z.getPointAt(Be/_,ge);const Re=ie.normals[Be],Ve=ie.binormals[Be];for(let Ee=0;Ee<=te;Ee++){const Ze=Ee/te*Math.PI*2,_e=Math.sin(Ze),Fe=-Math.cos(Ze);se.x=Fe*Re.x+_e*Ve.x,se.y=Fe*Re.y+_e*Ve.y,se.z=Fe*Re.z+_e*Ve.z,se.normalize(),de.push(se.x,se.y,se.z),oe.x=ge.x+K*se.x,oe.y=ge.y+K*se.y,oe.z=ge.z+K*se.z,ce.push(oe.x,oe.y,oe.z)}}function ye(){for(let Be=1;Be<=_;Be++)for(let Re=1;Re<=te;Re++){const Ve=(te+1)*(Be-1)+(Re-1),Ee=(te+1)*Be+(Re-1),Ze=(te+1)*Be+Re,_e=(te+1)*(Be-1)+Re;fe.push(Ve,Ee,_e),fe.push(Ee,Ze,_e)}}function ve(){for(let Be=0;Be<=_;Be++)for(let Re=0;Re<=te;Re++)ae.x=Be/_,ae.y=Re/te,Ie.push(ae.x,ae.y)}}copy(Z){return super.copy(Z),this.parameters=Object.assign({},Z.parameters),this}toJSON(){const Z=super.toJSON();return Z.path=this.parameters.path.toJSON(),Z}static fromJSON(Z){return new TubeGeometry(new Curves[Z.path.type]().fromJSON(Z.path),Z.tubularSegments,Z.radius,Z.radialSegments,Z.closed)}}class WireframeGeometry extends BufferGeometry{constructor(Z=null){if(super(),this.type="WireframeGeometry",this.parameters={geometry:Z},Z!==null){const _=[],K=new Set,te=new Vector3,ne=new Vector3;if(Z.index!==null){const ie=Z.attributes.position,oe=Z.index;let se=Z.groups;se.length===0&&(se=[{start:0,count:oe.count,materialIndex:0}]);for(let ae=0,ge=se.length;ae<ge;++ae){const ce=se[ae],de=ce.start,Ie=ce.count;for(let fe=de,be=de+Ie;fe<be;fe+=3)for(let Ae=0;Ae<3;Ae++){const ye=oe.getX(fe+Ae),ve=oe.getX(fe+(Ae+1)%3);te.fromBufferAttribute(ie,ye),ne.fromBufferAttribute(ie,ve),isUniqueEdge(te,ne,K)===!0&&(_.push(te.x,te.y,te.z),_.push(ne.x,ne.y,ne.z))}}}else{const ie=Z.attributes.position;for(let oe=0,se=ie.count/3;oe<se;oe++)for(let ae=0;ae<3;ae++){const ge=3*oe+ae,ce=3*oe+(ae+1)%3;te.fromBufferAttribute(ie,ge),ne.fromBufferAttribute(ie,ce),isUniqueEdge(te,ne,K)===!0&&(_.push(te.x,te.y,te.z),_.push(ne.x,ne.y,ne.z))}}this.setAttribute("position",new Float32BufferAttribute(_,3))}}copy(Z){return super.copy(Z),this.parameters=Object.assign({},Z.parameters),this}}function isUniqueEdge(X,Z,_){const K=`${X.x},${X.y},${X.z}-${Z.x},${Z.y},${Z.z}`,te=`${Z.x},${Z.y},${Z.z}-${X.x},${X.y},${X.z}`;return _.has(K)===!0||_.has(te)===!0?!1:(_.add(K),_.add(te),!0)}var Geometries=Object.freeze({__proto__:null,BoxGeometry,CapsuleGeometry,CircleGeometry,ConeGeometry,CylinderGeometry,DodecahedronGeometry,EdgesGeometry,ExtrudeGeometry,IcosahedronGeometry,LatheGeometry,OctahedronGeometry,PlaneGeometry,PolyhedronGeometry,RingGeometry,ShapeGeometry,SphereGeometry,TetrahedronGeometry,TorusGeometry,TorusKnotGeometry,TubeGeometry,WireframeGeometry});class ShadowMaterial extends Material{constructor(Z){super(),this.isShadowMaterial=!0,this.type="ShadowMaterial",this.color=new Color$1(0),this.transparent=!0,this.fog=!0,this.setValues(Z)}copy(Z){return super.copy(Z),this.color.copy(Z.color),this.fog=Z.fog,this}}class RawShaderMaterial extends ShaderMaterial{constructor(Z){super(Z),this.isRawShaderMaterial=!0,this.type="RawShaderMaterial"}}class MeshStandardMaterial extends Material{constructor(Z){super(),this.isMeshStandardMaterial=!0,this.type="MeshStandardMaterial",this.defines={STANDARD:""},this.color=new Color$1(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Color$1(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=TangentSpaceNormalMap,this.normalScale=new Vector2(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Euler,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(Z)}copy(Z){return super.copy(Z),this.defines={STANDARD:""},this.color.copy(Z.color),this.roughness=Z.roughness,this.metalness=Z.metalness,this.map=Z.map,this.lightMap=Z.lightMap,this.lightMapIntensity=Z.lightMapIntensity,this.aoMap=Z.aoMap,this.aoMapIntensity=Z.aoMapIntensity,this.emissive.copy(Z.emissive),this.emissiveMap=Z.emissiveMap,this.emissiveIntensity=Z.emissiveIntensity,this.bumpMap=Z.bumpMap,this.bumpScale=Z.bumpScale,this.normalMap=Z.normalMap,this.normalMapType=Z.normalMapType,this.normalScale.copy(Z.normalScale),this.displacementMap=Z.displacementMap,this.displacementScale=Z.displacementScale,this.displacementBias=Z.displacementBias,this.roughnessMap=Z.roughnessMap,this.metalnessMap=Z.metalnessMap,this.alphaMap=Z.alphaMap,this.envMap=Z.envMap,this.envMapRotation.copy(Z.envMapRotation),this.envMapIntensity=Z.envMapIntensity,this.wireframe=Z.wireframe,this.wireframeLinewidth=Z.wireframeLinewidth,this.wireframeLinecap=Z.wireframeLinecap,this.wireframeLinejoin=Z.wireframeLinejoin,this.flatShading=Z.flatShading,this.fog=Z.fog,this}}class MeshPhysicalMaterial extends MeshStandardMaterial{constructor(Z){super(),this.isMeshPhysicalMaterial=!0,this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.anisotropyRotation=0,this.anisotropyMap=null,this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new Vector2(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return clamp$3(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(_){this.ior=(1+.4*_)/(1-.4*_)}}),this.iridescenceMap=null,this.iridescenceIOR=1.3,this.iridescenceThicknessRange=[100,400],this.iridescenceThicknessMap=null,this.sheenColor=new Color$1(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=1/0,this.attenuationColor=new Color$1(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new Color$1(1,1,1),this.specularColorMap=null,this._anisotropy=0,this._clearcoat=0,this._dispersion=0,this._iridescence=0,this._sheen=0,this._transmission=0,this.setValues(Z)}get anisotropy(){return this._anisotropy}set anisotropy(Z){this._anisotropy>0!=Z>0&&this.version++,this._anisotropy=Z}get clearcoat(){return this._clearcoat}set clearcoat(Z){this._clearcoat>0!=Z>0&&this.version++,this._clearcoat=Z}get iridescence(){return this._iridescence}set iridescence(Z){this._iridescence>0!=Z>0&&this.version++,this._iridescence=Z}get dispersion(){return this._dispersion}set dispersion(Z){this._dispersion>0!=Z>0&&this.version++,this._dispersion=Z}get sheen(){return this._sheen}set sheen(Z){this._sheen>0!=Z>0&&this.version++,this._sheen=Z}get transmission(){return this._transmission}set transmission(Z){this._transmission>0!=Z>0&&this.version++,this._transmission=Z}copy(Z){return super.copy(Z),this.defines={STANDARD:"",PHYSICAL:""},this.anisotropy=Z.anisotropy,this.anisotropyRotation=Z.anisotropyRotation,this.anisotropyMap=Z.anisotropyMap,this.clearcoat=Z.clearcoat,this.clearcoatMap=Z.clearcoatMap,this.clearcoatRoughness=Z.clearcoatRoughness,this.clearcoatRoughnessMap=Z.clearcoatRoughnessMap,this.clearcoatNormalMap=Z.clearcoatNormalMap,this.clearcoatNormalScale.copy(Z.clearcoatNormalScale),this.dispersion=Z.dispersion,this.ior=Z.ior,this.iridescence=Z.iridescence,this.iridescenceMap=Z.iridescenceMap,this.iridescenceIOR=Z.iridescenceIOR,this.iridescenceThicknessRange=[...Z.iridescenceThicknessRange],this.iridescenceThicknessMap=Z.iridescenceThicknessMap,this.sheen=Z.sheen,this.sheenColor.copy(Z.sheenColor),this.sheenColorMap=Z.sheenColorMap,this.sheenRoughness=Z.sheenRoughness,this.sheenRoughnessMap=Z.sheenRoughnessMap,this.transmission=Z.transmission,this.transmissionMap=Z.transmissionMap,this.thickness=Z.thickness,this.thicknessMap=Z.thicknessMap,this.attenuationDistance=Z.attenuationDistance,this.attenuationColor.copy(Z.attenuationColor),this.specularIntensity=Z.specularIntensity,this.specularIntensityMap=Z.specularIntensityMap,this.specularColor.copy(Z.specularColor),this.specularColorMap=Z.specularColorMap,this}}class MeshPhongMaterial extends Material{constructor(Z){super(),this.isMeshPhongMaterial=!0,this.type="MeshPhongMaterial",this.color=new Color$1(16777215),this.specular=new Color$1(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Color$1(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=TangentSpaceNormalMap,this.normalScale=new Vector2(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Euler,this.combine=MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(Z)}copy(Z){return super.copy(Z),this.color.copy(Z.color),this.specular.copy(Z.specular),this.shininess=Z.shininess,this.map=Z.map,this.lightMap=Z.lightMap,this.lightMapIntensity=Z.lightMapIntensity,this.aoMap=Z.aoMap,this.aoMapIntensity=Z.aoMapIntensity,this.emissive.copy(Z.emissive),this.emissiveMap=Z.emissiveMap,this.emissiveIntensity=Z.emissiveIntensity,this.bumpMap=Z.bumpMap,this.bumpScale=Z.bumpScale,this.normalMap=Z.normalMap,this.normalMapType=Z.normalMapType,this.normalScale.copy(Z.normalScale),this.displacementMap=Z.displacementMap,this.displacementScale=Z.displacementScale,this.displacementBias=Z.displacementBias,this.specularMap=Z.specularMap,this.alphaMap=Z.alphaMap,this.envMap=Z.envMap,this.envMapRotation.copy(Z.envMapRotation),this.combine=Z.combine,this.reflectivity=Z.reflectivity,this.refractionRatio=Z.refractionRatio,this.wireframe=Z.wireframe,this.wireframeLinewidth=Z.wireframeLinewidth,this.wireframeLinecap=Z.wireframeLinecap,this.wireframeLinejoin=Z.wireframeLinejoin,this.flatShading=Z.flatShading,this.fog=Z.fog,this}}class MeshToonMaterial extends Material{constructor(Z){super(),this.isMeshToonMaterial=!0,this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new Color$1(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Color$1(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=TangentSpaceNormalMap,this.normalScale=new Vector2(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(Z)}copy(Z){return super.copy(Z),this.color.copy(Z.color),this.map=Z.map,this.gradientMap=Z.gradientMap,this.lightMap=Z.lightMap,this.lightMapIntensity=Z.lightMapIntensity,this.aoMap=Z.aoMap,this.aoMapIntensity=Z.aoMapIntensity,this.emissive.copy(Z.emissive),this.emissiveMap=Z.emissiveMap,this.emissiveIntensity=Z.emissiveIntensity,this.bumpMap=Z.bumpMap,this.bumpScale=Z.bumpScale,this.normalMap=Z.normalMap,this.normalMapType=Z.normalMapType,this.normalScale.copy(Z.normalScale),this.displacementMap=Z.displacementMap,this.displacementScale=Z.displacementScale,this.displacementBias=Z.displacementBias,this.alphaMap=Z.alphaMap,this.wireframe=Z.wireframe,this.wireframeLinewidth=Z.wireframeLinewidth,this.wireframeLinecap=Z.wireframeLinecap,this.wireframeLinejoin=Z.wireframeLinejoin,this.fog=Z.fog,this}}class MeshNormalMaterial extends Material{constructor(Z){super(),this.isMeshNormalMaterial=!0,this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=TangentSpaceNormalMap,this.normalScale=new Vector2(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.flatShading=!1,this.setValues(Z)}copy(Z){return super.copy(Z),this.bumpMap=Z.bumpMap,this.bumpScale=Z.bumpScale,this.normalMap=Z.normalMap,this.normalMapType=Z.normalMapType,this.normalScale.copy(Z.normalScale),this.displacementMap=Z.displacementMap,this.displacementScale=Z.displacementScale,this.displacementBias=Z.displacementBias,this.wireframe=Z.wireframe,this.wireframeLinewidth=Z.wireframeLinewidth,this.flatShading=Z.flatShading,this}}class MeshLambertMaterial extends Material{constructor(Z){super(),this.isMeshLambertMaterial=!0,this.type="MeshLambertMaterial",this.color=new Color$1(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Color$1(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=TangentSpaceNormalMap,this.normalScale=new Vector2(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Euler,this.combine=MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(Z)}copy(Z){return super.copy(Z),this.color.copy(Z.color),this.map=Z.map,this.lightMap=Z.lightMap,this.lightMapIntensity=Z.lightMapIntensity,this.aoMap=Z.aoMap,this.aoMapIntensity=Z.aoMapIntensity,this.emissive.copy(Z.emissive),this.emissiveMap=Z.emissiveMap,this.emissiveIntensity=Z.emissiveIntensity,this.bumpMap=Z.bumpMap,this.bumpScale=Z.bumpScale,this.normalMap=Z.normalMap,this.normalMapType=Z.normalMapType,this.normalScale.copy(Z.normalScale),this.displacementMap=Z.displacementMap,this.displacementScale=Z.displacementScale,this.displacementBias=Z.displacementBias,this.specularMap=Z.specularMap,this.alphaMap=Z.alphaMap,this.envMap=Z.envMap,this.envMapRotation.copy(Z.envMapRotation),this.combine=Z.combine,this.reflectivity=Z.reflectivity,this.refractionRatio=Z.refractionRatio,this.wireframe=Z.wireframe,this.wireframeLinewidth=Z.wireframeLinewidth,this.wireframeLinecap=Z.wireframeLinecap,this.wireframeLinejoin=Z.wireframeLinejoin,this.flatShading=Z.flatShading,this.fog=Z.fog,this}}class MeshDepthMaterial extends Material{constructor(Z){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=BasicDepthPacking,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(Z)}copy(Z){return super.copy(Z),this.depthPacking=Z.depthPacking,this.map=Z.map,this.alphaMap=Z.alphaMap,this.displacementMap=Z.displacementMap,this.displacementScale=Z.displacementScale,this.displacementBias=Z.displacementBias,this.wireframe=Z.wireframe,this.wireframeLinewidth=Z.wireframeLinewidth,this}}class MeshDistanceMaterial extends Material{constructor(Z){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(Z)}copy(Z){return super.copy(Z),this.map=Z.map,this.alphaMap=Z.alphaMap,this.displacementMap=Z.displacementMap,this.displacementScale=Z.displacementScale,this.displacementBias=Z.displacementBias,this}}class MeshMatcapMaterial extends Material{constructor(Z){super(),this.isMeshMatcapMaterial=!0,this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new Color$1(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=TangentSpaceNormalMap,this.normalScale=new Vector2(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.flatShading=!1,this.fog=!0,this.setValues(Z)}copy(Z){return super.copy(Z),this.defines={MATCAP:""},this.color.copy(Z.color),this.matcap=Z.matcap,this.map=Z.map,this.bumpMap=Z.bumpMap,this.bumpScale=Z.bumpScale,this.normalMap=Z.normalMap,this.normalMapType=Z.normalMapType,this.normalScale.copy(Z.normalScale),this.displacementMap=Z.displacementMap,this.displacementScale=Z.displacementScale,this.displacementBias=Z.displacementBias,this.alphaMap=Z.alphaMap,this.flatShading=Z.flatShading,this.fog=Z.fog,this}}class LineDashedMaterial extends LineBasicMaterial{constructor(Z){super(),this.isLineDashedMaterial=!0,this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(Z)}copy(Z){return super.copy(Z),this.scale=Z.scale,this.dashSize=Z.dashSize,this.gapSize=Z.gapSize,this}}function convertArray(X,Z,_){return!X||!_&&X.constructor===Z?X:typeof Z.BYTES_PER_ELEMENT=="number"?new Z(X):Array.prototype.slice.call(X)}function isTypedArray(X){return ArrayBuffer.isView(X)&&!(X instanceof DataView)}function getKeyframeOrder(X){function Z(te,ne){return X[te]-X[ne]}const _=X.length,K=new Array(_);for(let te=0;te!==_;++te)K[te]=te;return K.sort(Z),K}function sortedArray(X,Z,_){const K=X.length,te=new X.constructor(K);for(let ne=0,ie=0;ie!==K;++ne){const oe=_[ne]*Z;for(let se=0;se!==Z;++se)te[ie++]=X[oe+se]}return te}function flattenJSON(X,Z,_,K){let te=1,ne=X[0];for(;ne!==void 0&&ne[K]===void 0;)ne=X[te++];if(ne===void 0)return;let ie=ne[K];if(ie!==void 0)if(Array.isArray(ie))do ie=ne[K],ie!==void 0&&(Z.push(ne.time),_.push.apply(_,ie)),ne=X[te++];while(ne!==void 0);else if(ie.toArray!==void 0)do ie=ne[K],ie!==void 0&&(Z.push(ne.time),ie.toArray(_,_.length)),ne=X[te++];while(ne!==void 0);else do ie=ne[K],ie!==void 0&&(Z.push(ne.time),_.push(ie)),ne=X[te++];while(ne!==void 0)}function subclip(X,Z,_,K,te=30){const ne=X.clone();ne.name=Z;const ie=[];for(let se=0;se<ne.tracks.length;++se){const ae=ne.tracks[se],ge=ae.getValueSize(),ce=[],de=[];for(let Ie=0;Ie<ae.times.length;++Ie){const fe=ae.times[Ie]*te;if(!(fe<_||fe>=K)){ce.push(ae.times[Ie]);for(let be=0;be<ge;++be)de.push(ae.values[Ie*ge+be])}}ce.length!==0&&(ae.times=convertArray(ce,ae.times.constructor),ae.values=convertArray(de,ae.values.constructor),ie.push(ae))}ne.tracks=ie;let oe=1/0;for(let se=0;se<ne.tracks.length;++se)oe>ne.tracks[se].times[0]&&(oe=ne.tracks[se].times[0]);for(let se=0;se<ne.tracks.length;++se)ne.tracks[se].shift(-1*oe);return ne.resetDuration(),ne}function makeClipAdditive(X,Z=0,_=X,K=30){K<=0&&(K=30);const te=_.tracks.length,ne=Z/K;for(let ie=0;ie<te;++ie){const oe=_.tracks[ie],se=oe.ValueTypeName;if(se==="bool"||se==="string")continue;const ae=X.tracks.find(function(ye){return ye.name===oe.name&&ye.ValueTypeName===se});if(ae===void 0)continue;let ge=0;const ce=oe.getValueSize();oe.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(ge=ce/3);let de=0;const Ie=ae.getValueSize();ae.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(de=Ie/3);const fe=oe.times.length-1;let be;if(ne<=oe.times[0]){const ye=ge,ve=ce-ge;be=oe.values.slice(ye,ve)}else if(ne>=oe.times[fe]){const ye=fe*ce+ge,ve=ye+ce-ge;be=oe.values.slice(ye,ve)}else{const ye=oe.createInterpolant(),ve=ge,Be=ce-ge;ye.evaluate(ne),be=ye.resultBuffer.slice(ve,Be)}se==="quaternion"&&new Quaternion$2().fromArray(be).normalize().conjugate().toArray(be);const Ae=ae.times.length;for(let ye=0;ye<Ae;++ye){const ve=ye*Ie+de;if(se==="quaternion")Quaternion$2.multiplyQuaternionsFlat(ae.values,ve,be,0,ae.values,ve);else{const Be=Ie-de*2;for(let Re=0;Re<Be;++Re)ae.values[ve+Re]-=be[Re]}}}return X.blendMode=AdditiveAnimationBlendMode,X}const AnimationUtils={convertArray,isTypedArray,getKeyframeOrder,sortedArray,flattenJSON,subclip,makeClipAdditive};class Interpolant{constructor(Z,_,K,te){this.parameterPositions=Z,this._cachedIndex=0,this.resultBuffer=te!==void 0?te:new _.constructor(K),this.sampleValues=_,this.valueSize=K,this.settings=null,this.DefaultSettings_={}}evaluate(Z){const _=this.parameterPositions;let K=this._cachedIndex,te=_[K],ne=_[K-1];e:{t:{let ie;n:{r:if(!(Z<te)){for(let oe=K+2;;){if(te===void 0){if(Z<ne)break r;return K=_.length,this._cachedIndex=K,this.copySampleValue_(K-1)}if(K===oe)break;if(ne=te,te=_[++K],Z<te)break t}ie=_.length;break n}if(!(Z>=ne)){const oe=_[1];Z<oe&&(K=2,ne=oe);for(let se=K-2;;){if(ne===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(K===se)break;if(te=ne,ne=_[--K-1],Z>=ne)break t}ie=K,K=0;break n}break e}for(;K<ie;){const oe=K+ie>>>1;Z<_[oe]?ie=oe:K=oe+1}if(te=_[K],ne=_[K-1],ne===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(te===void 0)return K=_.length,this._cachedIndex=K,this.copySampleValue_(K-1)}this._cachedIndex=K,this.intervalChanged_(K,ne,te)}return this.interpolate_(K,ne,Z,te)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(Z){const _=this.resultBuffer,K=this.sampleValues,te=this.valueSize,ne=Z*te;for(let ie=0;ie!==te;++ie)_[ie]=K[ne+ie];return _}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}class CubicInterpolant extends Interpolant{constructor(Z,_,K,te){super(Z,_,K,te),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:ZeroCurvatureEnding,endingEnd:ZeroCurvatureEnding}}intervalChanged_(Z,_,K){const te=this.parameterPositions;let ne=Z-2,ie=Z+1,oe=te[ne],se=te[ie];if(oe===void 0)switch(this.getSettings_().endingStart){case ZeroSlopeEnding:ne=Z,oe=2*_-K;break;case WrapAroundEnding:ne=te.length-2,oe=_+te[ne]-te[ne+1];break;default:ne=Z,oe=K}if(se===void 0)switch(this.getSettings_().endingEnd){case ZeroSlopeEnding:ie=Z,se=2*K-_;break;case WrapAroundEnding:ie=1,se=K+te[1]-te[0];break;default:ie=Z-1,se=_}const ae=(K-_)*.5,ge=this.valueSize;this._weightPrev=ae/(_-oe),this._weightNext=ae/(se-K),this._offsetPrev=ne*ge,this._offsetNext=ie*ge}interpolate_(Z,_,K,te){const ne=this.resultBuffer,ie=this.sampleValues,oe=this.valueSize,se=Z*oe,ae=se-oe,ge=this._offsetPrev,ce=this._offsetNext,de=this._weightPrev,Ie=this._weightNext,fe=(K-_)/(te-_),be=fe*fe,Ae=be*fe,ye=-de*Ae+2*de*be-de*fe,ve=(1+de)*Ae+(-1.5-2*de)*be+(-.5+de)*fe+1,Be=(-1-Ie)*Ae+(1.5+Ie)*be+.5*fe,Re=Ie*Ae-Ie*be;for(let Ve=0;Ve!==oe;++Ve)ne[Ve]=ye*ie[ge+Ve]+ve*ie[ae+Ve]+Be*ie[se+Ve]+Re*ie[ce+Ve];return ne}}class LinearInterpolant extends Interpolant{constructor(Z,_,K,te){super(Z,_,K,te)}interpolate_(Z,_,K,te){const ne=this.resultBuffer,ie=this.sampleValues,oe=this.valueSize,se=Z*oe,ae=se-oe,ge=(K-_)/(te-_),ce=1-ge;for(let de=0;de!==oe;++de)ne[de]=ie[ae+de]*ce+ie[se+de]*ge;return ne}}class DiscreteInterpolant extends Interpolant{constructor(Z,_,K,te){super(Z,_,K,te)}interpolate_(Z){return this.copySampleValue_(Z-1)}}class KeyframeTrack{constructor(Z,_,K,te){if(Z===void 0)throw new Error("THREE.KeyframeTrack: track name is undefined");if(_===void 0||_.length===0)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+Z);this.name=Z,this.times=convertArray(_,this.TimeBufferType),this.values=convertArray(K,this.ValueBufferType),this.setInterpolation(te||this.DefaultInterpolation)}static toJSON(Z){const _=Z.constructor;let K;if(_.toJSON!==this.toJSON)K=_.toJSON(Z);else{K={name:Z.name,times:convertArray(Z.times,Array),values:convertArray(Z.values,Array)};const te=Z.getInterpolation();te!==Z.DefaultInterpolation&&(K.interpolation=te)}return K.type=Z.ValueTypeName,K}InterpolantFactoryMethodDiscrete(Z){return new DiscreteInterpolant(this.times,this.values,this.getValueSize(),Z)}InterpolantFactoryMethodLinear(Z){return new LinearInterpolant(this.times,this.values,this.getValueSize(),Z)}InterpolantFactoryMethodSmooth(Z){return new CubicInterpolant(this.times,this.values,this.getValueSize(),Z)}setInterpolation(Z){let _;switch(Z){case InterpolateDiscrete:_=this.InterpolantFactoryMethodDiscrete;break;case InterpolateLinear:_=this.InterpolantFactoryMethodLinear;break;case InterpolateSmooth:_=this.InterpolantFactoryMethodSmooth;break}if(_===void 0){const K="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(this.createInterpolant===void 0)if(Z!==this.DefaultInterpolation)this.setInterpolation(this.DefaultInterpolation);else throw new Error(K);return console.warn("THREE.KeyframeTrack:",K),this}return this.createInterpolant=_,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return InterpolateDiscrete;case this.InterpolantFactoryMethodLinear:return InterpolateLinear;case this.InterpolantFactoryMethodSmooth:return InterpolateSmooth}}getValueSize(){return this.values.length/this.times.length}shift(Z){if(Z!==0){const _=this.times;for(let K=0,te=_.length;K!==te;++K)_[K]+=Z}return this}scale(Z){if(Z!==1){const _=this.times;for(let K=0,te=_.length;K!==te;++K)_[K]*=Z}return this}trim(Z,_){const K=this.times,te=K.length;let ne=0,ie=te-1;for(;ne!==te&&K[ne]<Z;)++ne;for(;ie!==-1&&K[ie]>_;)--ie;if(++ie,ne!==0||ie!==te){ne>=ie&&(ie=Math.max(ie,1),ne=ie-1);const oe=this.getValueSize();this.times=K.slice(ne,ie),this.values=this.values.slice(ne*oe,ie*oe)}return this}validate(){let Z=!0;const _=this.getValueSize();_-Math.floor(_)!==0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),Z=!1);const K=this.times,te=this.values,ne=K.length;ne===0&&(console.error("THREE.KeyframeTrack: Track is empty.",this),Z=!1);let ie=null;for(let oe=0;oe!==ne;oe++){const se=K[oe];if(typeof se=="number"&&isNaN(se)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,oe,se),Z=!1;break}if(ie!==null&&ie>se){console.error("THREE.KeyframeTrack: Out of order keys.",this,oe,se,ie),Z=!1;break}ie=se}if(te!==void 0&&isTypedArray(te))for(let oe=0,se=te.length;oe!==se;++oe){const ae=te[oe];if(isNaN(ae)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,oe,ae),Z=!1;break}}return Z}optimize(){const Z=this.times.slice(),_=this.values.slice(),K=this.getValueSize(),te=this.getInterpolation()===InterpolateSmooth,ne=Z.length-1;let ie=1;for(let oe=1;oe<ne;++oe){let se=!1;const ae=Z[oe],ge=Z[oe+1];if(ae!==ge&&(oe!==1||ae!==Z[0]))if(te)se=!0;else{const ce=oe*K,de=ce-K,Ie=ce+K;for(let fe=0;fe!==K;++fe){const be=_[ce+fe];if(be!==_[de+fe]||be!==_[Ie+fe]){se=!0;break}}}if(se){if(oe!==ie){Z[ie]=Z[oe];const ce=oe*K,de=ie*K;for(let Ie=0;Ie!==K;++Ie)_[de+Ie]=_[ce+Ie]}++ie}}if(ne>0){Z[ie]=Z[ne];for(let oe=ne*K,se=ie*K,ae=0;ae!==K;++ae)_[se+ae]=_[oe+ae];++ie}return ie!==Z.length?(this.times=Z.slice(0,ie),this.values=_.slice(0,ie*K)):(this.times=Z,this.values=_),this}clone(){const Z=this.times.slice(),_=this.values.slice(),K=this.constructor,te=new K(this.name,Z,_);return te.createInterpolant=this.createInterpolant,te}}KeyframeTrack.prototype.TimeBufferType=Float32Array;KeyframeTrack.prototype.ValueBufferType=Float32Array;KeyframeTrack.prototype.DefaultInterpolation=InterpolateLinear;class BooleanKeyframeTrack extends KeyframeTrack{constructor(Z,_,K){super(Z,_,K)}}BooleanKeyframeTrack.prototype.ValueTypeName="bool";BooleanKeyframeTrack.prototype.ValueBufferType=Array;BooleanKeyframeTrack.prototype.DefaultInterpolation=InterpolateDiscrete;BooleanKeyframeTrack.prototype.InterpolantFactoryMethodLinear=void 0;BooleanKeyframeTrack.prototype.InterpolantFactoryMethodSmooth=void 0;class ColorKeyframeTrack extends KeyframeTrack{}ColorKeyframeTrack.prototype.ValueTypeName="color";class NumberKeyframeTrack extends KeyframeTrack{}NumberKeyframeTrack.prototype.ValueTypeName="number";class QuaternionLinearInterpolant extends Interpolant{constructor(Z,_,K,te){super(Z,_,K,te)}interpolate_(Z,_,K,te){const ne=this.resultBuffer,ie=this.sampleValues,oe=this.valueSize,se=(K-_)/(te-_);let ae=Z*oe;for(let ge=ae+oe;ae!==ge;ae+=4)Quaternion$2.slerpFlat(ne,0,ie,ae-oe,ie,ae,se);return ne}}class QuaternionKeyframeTrack extends KeyframeTrack{InterpolantFactoryMethodLinear(Z){return new QuaternionLinearInterpolant(this.times,this.values,this.getValueSize(),Z)}}QuaternionKeyframeTrack.prototype.ValueTypeName="quaternion";QuaternionKeyframeTrack.prototype.InterpolantFactoryMethodSmooth=void 0;class StringKeyframeTrack extends KeyframeTrack{constructor(Z,_,K){super(Z,_,K)}}StringKeyframeTrack.prototype.ValueTypeName="string";StringKeyframeTrack.prototype.ValueBufferType=Array;StringKeyframeTrack.prototype.DefaultInterpolation=InterpolateDiscrete;StringKeyframeTrack.prototype.InterpolantFactoryMethodLinear=void 0;StringKeyframeTrack.prototype.InterpolantFactoryMethodSmooth=void 0;class VectorKeyframeTrack extends KeyframeTrack{}VectorKeyframeTrack.prototype.ValueTypeName="vector";class AnimationClip{constructor(Z="",_=-1,K=[],te=NormalAnimationBlendMode){this.name=Z,this.tracks=K,this.duration=_,this.blendMode=te,this.uuid=generateUUID$1(),this.duration<0&&this.resetDuration()}static parse(Z){const _=[],K=Z.tracks,te=1/(Z.fps||1);for(let ie=0,oe=K.length;ie!==oe;++ie)_.push(parseKeyframeTrack(K[ie]).scale(te));const ne=new this(Z.name,Z.duration,_,Z.blendMode);return ne.uuid=Z.uuid,ne}static toJSON(Z){const _=[],K=Z.tracks,te={name:Z.name,duration:Z.duration,tracks:_,uuid:Z.uuid,blendMode:Z.blendMode};for(let ne=0,ie=K.length;ne!==ie;++ne)_.push(KeyframeTrack.toJSON(K[ne]));return te}static CreateFromMorphTargetSequence(Z,_,K,te){const ne=_.length,ie=[];for(let oe=0;oe<ne;oe++){let se=[],ae=[];se.push((oe+ne-1)%ne,oe,(oe+1)%ne),ae.push(0,1,0);const ge=getKeyframeOrder(se);se=sortedArray(se,1,ge),ae=sortedArray(ae,1,ge),!te&&se[0]===0&&(se.push(ne),ae.push(ae[0])),ie.push(new NumberKeyframeTrack(".morphTargetInfluences["+_[oe].name+"]",se,ae).scale(1/K))}return new this(Z,-1,ie)}static findByName(Z,_){let K=Z;if(!Array.isArray(Z)){const te=Z;K=te.geometry&&te.geometry.animations||te.animations}for(let te=0;te<K.length;te++)if(K[te].name===_)return K[te];return null}static CreateClipsFromMorphTargetSequences(Z,_,K){const te={},ne=/^([\w-]*?)([\d]+)$/;for(let oe=0,se=Z.length;oe<se;oe++){const ae=Z[oe],ge=ae.name.match(ne);if(ge&&ge.length>1){const ce=ge[1];let de=te[ce];de||(te[ce]=de=[]),de.push(ae)}}const ie=[];for(const oe in te)ie.push(this.CreateFromMorphTargetSequence(oe,te[oe],_,K));return ie}static parseAnimation(Z,_){if(!Z)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;const K=function(ce,de,Ie,fe,be){if(Ie.length!==0){const Ae=[],ye=[];flattenJSON(Ie,Ae,ye,fe),Ae.length!==0&&be.push(new ce(de,Ae,ye))}},te=[],ne=Z.name||"default",ie=Z.fps||30,oe=Z.blendMode;let se=Z.length||-1;const ae=Z.hierarchy||[];for(let ce=0;ce<ae.length;ce++){const de=ae[ce].keys;if(!(!de||de.length===0))if(de[0].morphTargets){const Ie={};let fe;for(fe=0;fe<de.length;fe++)if(de[fe].morphTargets)for(let be=0;be<de[fe].morphTargets.length;be++)Ie[de[fe].morphTargets[be]]=-1;for(const be in Ie){const Ae=[],ye=[];for(let ve=0;ve!==de[fe].morphTargets.length;++ve){const Be=de[fe];Ae.push(Be.time),ye.push(Be.morphTarget===be?1:0)}te.push(new NumberKeyframeTrack(".morphTargetInfluence["+be+"]",Ae,ye))}se=Ie.length*ie}else{const Ie=".bones["+_[ce].name+"]";K(VectorKeyframeTrack,Ie+".position",de,"pos",te),K(QuaternionKeyframeTrack,Ie+".quaternion",de,"rot",te),K(VectorKeyframeTrack,Ie+".scale",de,"scl",te)}}return te.length===0?null:new this(ne,se,te,oe)}resetDuration(){const Z=this.tracks;let _=0;for(let K=0,te=Z.length;K!==te;++K){const ne=this.tracks[K];_=Math.max(_,ne.times[ne.times.length-1])}return this.duration=_,this}trim(){for(let Z=0;Z<this.tracks.length;Z++)this.tracks[Z].trim(0,this.duration);return this}validate(){let Z=!0;for(let _=0;_<this.tracks.length;_++)Z=Z&&this.tracks[_].validate();return Z}optimize(){for(let Z=0;Z<this.tracks.length;Z++)this.tracks[Z].optimize();return this}clone(){const Z=[];for(let _=0;_<this.tracks.length;_++)Z.push(this.tracks[_].clone());return new this.constructor(this.name,this.duration,Z,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}}function getTrackTypeForValueTypeName(X){switch(X.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return NumberKeyframeTrack;case"vector":case"vector2":case"vector3":case"vector4":return VectorKeyframeTrack;case"color":return ColorKeyframeTrack;case"quaternion":return QuaternionKeyframeTrack;case"bool":case"boolean":return BooleanKeyframeTrack;case"string":return StringKeyframeTrack}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+X)}function parseKeyframeTrack(X){if(X.type===void 0)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const Z=getTrackTypeForValueTypeName(X.type);if(X.times===void 0){const _=[],K=[];flattenJSON(X.keys,_,K,"value"),X.times=_,X.values=K}return Z.parse!==void 0?Z.parse(X):new Z(X.name,X.times,X.values,X.interpolation)}const Cache={enabled:!1,files:{},add:function(X,Z){this.enabled!==!1&&(this.files[X]=Z)},get:function(X){if(this.enabled!==!1)return this.files[X]},remove:function(X){delete this.files[X]},clear:function(){this.files={}}};class LoadingManager{constructor(Z,_,K){const te=this;let ne=!1,ie=0,oe=0,se;const ae=[];this.onStart=void 0,this.onLoad=Z,this.onProgress=_,this.onError=K,this.itemStart=function(ge){oe++,ne===!1&&te.onStart!==void 0&&te.onStart(ge,ie,oe),ne=!0},this.itemEnd=function(ge){ie++,te.onProgress!==void 0&&te.onProgress(ge,ie,oe),ie===oe&&(ne=!1,te.onLoad!==void 0&&te.onLoad())},this.itemError=function(ge){te.onError!==void 0&&te.onError(ge)},this.resolveURL=function(ge){return se?se(ge):ge},this.setURLModifier=function(ge){return se=ge,this},this.addHandler=function(ge,ce){return ae.push(ge,ce),this},this.removeHandler=function(ge){const ce=ae.indexOf(ge);return ce!==-1&&ae.splice(ce,2),this},this.getHandler=function(ge){for(let ce=0,de=ae.length;ce<de;ce+=2){const Ie=ae[ce],fe=ae[ce+1];if(Ie.global&&(Ie.lastIndex=0),Ie.test(ge))return fe}return null}}}const DefaultLoadingManager=new LoadingManager;class Loader{constructor(Z){this.manager=Z!==void 0?Z:DefaultLoadingManager,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(Z,_){const K=this;return new Promise(function(te,ne){K.load(Z,te,_,ne)})}parse(){}setCrossOrigin(Z){return this.crossOrigin=Z,this}setWithCredentials(Z){return this.withCredentials=Z,this}setPath(Z){return this.path=Z,this}setResourcePath(Z){return this.resourcePath=Z,this}setRequestHeader(Z){return this.requestHeader=Z,this}}Loader.DEFAULT_MATERIAL_NAME="__DEFAULT";const loading={};class HttpError extends Error{constructor(Z,_){super(Z),this.response=_}}class FileLoader extends Loader{constructor(Z){super(Z)}load(Z,_,K,te){Z===void 0&&(Z=""),this.path!==void 0&&(Z=this.path+Z),Z=this.manager.resolveURL(Z);const ne=Cache.get(Z);if(ne!==void 0)return this.manager.itemStart(Z),setTimeout(()=>{_&&_(ne),this.manager.itemEnd(Z)},0),ne;if(loading[Z]!==void 0){loading[Z].push({onLoad:_,onProgress:K,onError:te});return}loading[Z]=[],loading[Z].push({onLoad:_,onProgress:K,onError:te});const ie=new Request(Z,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),oe=this.mimeType,se=this.responseType;fetch(ie).then(ae=>{if(ae.status===200||ae.status===0){if(ae.status===0&&console.warn("THREE.FileLoader: HTTP Status 0 received."),typeof ReadableStream>"u"||ae.body===void 0||ae.body.getReader===void 0)return ae;const ge=loading[Z],ce=ae.body.getReader(),de=ae.headers.get("X-File-Size")||ae.headers.get("Content-Length"),Ie=de?parseInt(de):0,fe=Ie!==0;let be=0;const Ae=new ReadableStream({start(ye){ve();function ve(){ce.read().then(({done:Be,value:Re})=>{if(Be)ye.close();else{be+=Re.byteLength;const Ve=new ProgressEvent("progress",{lengthComputable:fe,loaded:be,total:Ie});for(let Ee=0,Ze=ge.length;Ee<Ze;Ee++){const _e=ge[Ee];_e.onProgress&&_e.onProgress(Ve)}ye.enqueue(Re),ve()}},Be=>{ye.error(Be)})}}});return new Response(Ae)}else throw new HttpError(`fetch for "${ae.url}" responded with ${ae.status}: ${ae.statusText}`,ae)}).then(ae=>{switch(se){case"arraybuffer":return ae.arrayBuffer();case"blob":return ae.blob();case"document":return ae.text().then(ge=>new DOMParser().parseFromString(ge,oe));case"json":return ae.json();default:if(oe===void 0)return ae.text();{const ce=/charset="?([^;"\s]*)"?/i.exec(oe),de=ce&&ce[1]?ce[1].toLowerCase():void 0,Ie=new TextDecoder(de);return ae.arrayBuffer().then(fe=>Ie.decode(fe))}}}).then(ae=>{Cache.add(Z,ae);const ge=loading[Z];delete loading[Z];for(let ce=0,de=ge.length;ce<de;ce++){const Ie=ge[ce];Ie.onLoad&&Ie.onLoad(ae)}}).catch(ae=>{const ge=loading[Z];if(ge===void 0)throw this.manager.itemError(Z),ae;delete loading[Z];for(let ce=0,de=ge.length;ce<de;ce++){const Ie=ge[ce];Ie.onError&&Ie.onError(ae)}this.manager.itemError(Z)}).finally(()=>{this.manager.itemEnd(Z)}),this.manager.itemStart(Z)}setResponseType(Z){return this.responseType=Z,this}setMimeType(Z){return this.mimeType=Z,this}}class AnimationLoader extends Loader{constructor(Z){super(Z)}load(Z,_,K,te){const ne=this,ie=new FileLoader(this.manager);ie.setPath(this.path),ie.setRequestHeader(this.requestHeader),ie.setWithCredentials(this.withCredentials),ie.load(Z,function(oe){try{_(ne.parse(JSON.parse(oe)))}catch(se){te?te(se):console.error(se),ne.manager.itemError(Z)}},K,te)}parse(Z){const _=[];for(let K=0;K<Z.length;K++){const te=AnimationClip.parse(Z[K]);_.push(te)}return _}}class CompressedTextureLoader extends Loader{constructor(Z){super(Z)}load(Z,_,K,te){const ne=this,ie=[],oe=new CompressedTexture,se=new FileLoader(this.manager);se.setPath(this.path),se.setResponseType("arraybuffer"),se.setRequestHeader(this.requestHeader),se.setWithCredentials(ne.withCredentials);let ae=0;function ge(ce){se.load(Z[ce],function(de){const Ie=ne.parse(de,!0);ie[ce]={width:Ie.width,height:Ie.height,format:Ie.format,mipmaps:Ie.mipmaps},ae+=1,ae===6&&(Ie.mipmapCount===1&&(oe.minFilter=LinearFilter),oe.image=ie,oe.format=Ie.format,oe.needsUpdate=!0,_&&_(oe))},K,te)}if(Array.isArray(Z))for(let ce=0,de=Z.length;ce<de;++ce)ge(ce);else se.load(Z,function(ce){const de=ne.parse(ce,!0);if(de.isCubemap){const Ie=de.mipmaps.length/de.mipmapCount;for(let fe=0;fe<Ie;fe++){ie[fe]={mipmaps:[]};for(let be=0;be<de.mipmapCount;be++)ie[fe].mipmaps.push(de.mipmaps[fe*de.mipmapCount+be]),ie[fe].format=de.format,ie[fe].width=de.width,ie[fe].height=de.height}oe.image=ie}else oe.image.width=de.width,oe.image.height=de.height,oe.mipmaps=de.mipmaps;de.mipmapCount===1&&(oe.minFilter=LinearFilter),oe.format=de.format,oe.needsUpdate=!0,_&&_(oe)},K,te);return oe}}class ImageLoader extends Loader{constructor(Z){super(Z)}load(Z,_,K,te){this.path!==void 0&&(Z=this.path+Z),Z=this.manager.resolveURL(Z);const ne=this,ie=Cache.get(Z);if(ie!==void 0)return ne.manager.itemStart(Z),setTimeout(function(){_&&_(ie),ne.manager.itemEnd(Z)},0),ie;const oe=createElementNS("img");function se(){ge(),Cache.add(Z,this),_&&_(this),ne.manager.itemEnd(Z)}function ae(ce){ge(),te&&te(ce),ne.manager.itemError(Z),ne.manager.itemEnd(Z)}function ge(){oe.removeEventListener("load",se,!1),oe.removeEventListener("error",ae,!1)}return oe.addEventListener("load",se,!1),oe.addEventListener("error",ae,!1),Z.slice(0,5)!=="data:"&&this.crossOrigin!==void 0&&(oe.crossOrigin=this.crossOrigin),ne.manager.itemStart(Z),oe.src=Z,oe}}class CubeTextureLoader extends Loader{constructor(Z){super(Z)}load(Z,_,K,te){const ne=new CubeTexture;ne.colorSpace=SRGBColorSpace$1;const ie=new ImageLoader(this.manager);ie.setCrossOrigin(this.crossOrigin),ie.setPath(this.path);let oe=0;function se(ae){ie.load(Z[ae],function(ge){ne.images[ae]=ge,oe++,oe===6&&(ne.needsUpdate=!0,_&&_(ne))},void 0,te)}for(let ae=0;ae<Z.length;++ae)se(ae);return ne}}class DataTextureLoader extends Loader{constructor(Z){super(Z)}load(Z,_,K,te){const ne=this,ie=new DataTexture,oe=new FileLoader(this.manager);return oe.setResponseType("arraybuffer"),oe.setRequestHeader(this.requestHeader),oe.setPath(this.path),oe.setWithCredentials(ne.withCredentials),oe.load(Z,function(se){let ae;try{ae=ne.parse(se)}catch(ge){if(te!==void 0)te(ge);else{console.error(ge);return}}ae.image!==void 0?ie.image=ae.image:ae.data!==void 0&&(ie.image.width=ae.width,ie.image.height=ae.height,ie.image.data=ae.data),ie.wrapS=ae.wrapS!==void 0?ae.wrapS:ClampToEdgeWrapping,ie.wrapT=ae.wrapT!==void 0?ae.wrapT:ClampToEdgeWrapping,ie.magFilter=ae.magFilter!==void 0?ae.magFilter:LinearFilter,ie.minFilter=ae.minFilter!==void 0?ae.minFilter:LinearFilter,ie.anisotropy=ae.anisotropy!==void 0?ae.anisotropy:1,ae.colorSpace!==void 0&&(ie.colorSpace=ae.colorSpace),ae.flipY!==void 0&&(ie.flipY=ae.flipY),ae.format!==void 0&&(ie.format=ae.format),ae.type!==void 0&&(ie.type=ae.type),ae.mipmaps!==void 0&&(ie.mipmaps=ae.mipmaps,ie.minFilter=LinearMipmapLinearFilter),ae.mipmapCount===1&&(ie.minFilter=LinearFilter),ae.generateMipmaps!==void 0&&(ie.generateMipmaps=ae.generateMipmaps),ie.needsUpdate=!0,_&&_(ie,ae)},K,te),ie}}class TextureLoader extends Loader{constructor(Z){super(Z)}load(Z,_,K,te){const ne=new Texture,ie=new ImageLoader(this.manager);return ie.setCrossOrigin(this.crossOrigin),ie.setPath(this.path),ie.load(Z,function(oe){ne.image=oe,ne.needsUpdate=!0,_!==void 0&&_(ne)},K,te),ne}}class Light extends Object3D{constructor(Z,_=1){super(),this.isLight=!0,this.type="Light",this.color=new Color$1(Z),this.intensity=_}dispose(){}copy(Z,_){return super.copy(Z,_),this.color.copy(Z.color),this.intensity=Z.intensity,this}toJSON(Z){const _=super.toJSON(Z);return _.object.color=this.color.getHex(),_.object.intensity=this.intensity,this.groundColor!==void 0&&(_.object.groundColor=this.groundColor.getHex()),this.distance!==void 0&&(_.object.distance=this.distance),this.angle!==void 0&&(_.object.angle=this.angle),this.decay!==void 0&&(_.object.decay=this.decay),this.penumbra!==void 0&&(_.object.penumbra=this.penumbra),this.shadow!==void 0&&(_.object.shadow=this.shadow.toJSON()),this.target!==void 0&&(_.object.target=this.target.uuid),_}}class HemisphereLight extends Light{constructor(Z,_,K){super(Z,K),this.isHemisphereLight=!0,this.type="HemisphereLight",this.position.copy(Object3D.DEFAULT_UP),this.updateMatrix(),this.groundColor=new Color$1(_)}copy(Z,_){return super.copy(Z,_),this.groundColor.copy(Z.groundColor),this}}const _projScreenMatrix$1=new Matrix4,_lightPositionWorld$1=new Vector3,_lookTarget$1=new Vector3;class LightShadow{constructor(Z){this.camera=Z,this.intensity=1,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new Vector2(512,512),this.map=null,this.mapPass=null,this.matrix=new Matrix4,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new Frustum,this._frameExtents=new Vector2(1,1),this._viewportCount=1,this._viewports=[new Vector4(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(Z){const _=this.camera,K=this.matrix;_lightPositionWorld$1.setFromMatrixPosition(Z.matrixWorld),_.position.copy(_lightPositionWorld$1),_lookTarget$1.setFromMatrixPosition(Z.target.matrixWorld),_.lookAt(_lookTarget$1),_.updateMatrixWorld(),_projScreenMatrix$1.multiplyMatrices(_.projectionMatrix,_.matrixWorldInverse),this._frustum.setFromProjectionMatrix(_projScreenMatrix$1),K.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),K.multiply(_projScreenMatrix$1)}getViewport(Z){return this._viewports[Z]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(Z){return this.camera=Z.camera.clone(),this.intensity=Z.intensity,this.bias=Z.bias,this.radius=Z.radius,this.mapSize.copy(Z.mapSize),this}clone(){return new this.constructor().copy(this)}toJSON(){const Z={};return this.intensity!==1&&(Z.intensity=this.intensity),this.bias!==0&&(Z.bias=this.bias),this.normalBias!==0&&(Z.normalBias=this.normalBias),this.radius!==1&&(Z.radius=this.radius),(this.mapSize.x!==512||this.mapSize.y!==512)&&(Z.mapSize=this.mapSize.toArray()),Z.camera=this.camera.toJSON(!1).object,delete Z.camera.matrix,Z}}class SpotLightShadow extends LightShadow{constructor(){super(new PerspectiveCamera(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1}updateMatrices(Z){const _=this.camera,K=RAD2DEG*2*Z.angle*this.focus,te=this.mapSize.width/this.mapSize.height,ne=Z.distance||_.far;(K!==_.fov||te!==_.aspect||ne!==_.far)&&(_.fov=K,_.aspect=te,_.far=ne,_.updateProjectionMatrix()),super.updateMatrices(Z)}copy(Z){return super.copy(Z),this.focus=Z.focus,this}}class SpotLight extends Light{constructor(Z,_,K=0,te=Math.PI/3,ne=0,ie=2){super(Z,_),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(Object3D.DEFAULT_UP),this.updateMatrix(),this.target=new Object3D,this.distance=K,this.angle=te,this.penumbra=ne,this.decay=ie,this.map=null,this.shadow=new SpotLightShadow}get power(){return this.intensity*Math.PI}set power(Z){this.intensity=Z/Math.PI}dispose(){this.shadow.dispose()}copy(Z,_){return super.copy(Z,_),this.distance=Z.distance,this.angle=Z.angle,this.penumbra=Z.penumbra,this.decay=Z.decay,this.target=Z.target.clone(),this.shadow=Z.shadow.clone(),this}}const _projScreenMatrix=new Matrix4,_lightPositionWorld=new Vector3,_lookTarget=new Vector3;class PointLightShadow extends LightShadow{constructor(){super(new PerspectiveCamera(90,1,.5,500)),this.isPointLightShadow=!0,this._frameExtents=new Vector2(4,2),this._viewportCount=6,this._viewports=[new Vector4(2,1,1,1),new Vector4(0,1,1,1),new Vector4(3,1,1,1),new Vector4(1,1,1,1),new Vector4(3,0,1,1),new Vector4(1,0,1,1)],this._cubeDirections=[new Vector3(1,0,0),new Vector3(-1,0,0),new Vector3(0,0,1),new Vector3(0,0,-1),new Vector3(0,1,0),new Vector3(0,-1,0)],this._cubeUps=[new Vector3(0,1,0),new Vector3(0,1,0),new Vector3(0,1,0),new Vector3(0,1,0),new Vector3(0,0,1),new Vector3(0,0,-1)]}updateMatrices(Z,_=0){const K=this.camera,te=this.matrix,ne=Z.distance||K.far;ne!==K.far&&(K.far=ne,K.updateProjectionMatrix()),_lightPositionWorld.setFromMatrixPosition(Z.matrixWorld),K.position.copy(_lightPositionWorld),_lookTarget.copy(K.position),_lookTarget.add(this._cubeDirections[_]),K.up.copy(this._cubeUps[_]),K.lookAt(_lookTarget),K.updateMatrixWorld(),te.makeTranslation(-_lightPositionWorld.x,-_lightPositionWorld.y,-_lightPositionWorld.z),_projScreenMatrix.multiplyMatrices(K.projectionMatrix,K.matrixWorldInverse),this._frustum.setFromProjectionMatrix(_projScreenMatrix)}}class PointLight extends Light{constructor(Z,_,K=0,te=2){super(Z,_),this.isPointLight=!0,this.type="PointLight",this.distance=K,this.decay=te,this.shadow=new PointLightShadow}get power(){return this.intensity*4*Math.PI}set power(Z){this.intensity=Z/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(Z,_){return super.copy(Z,_),this.distance=Z.distance,this.decay=Z.decay,this.shadow=Z.shadow.clone(),this}}class OrthographicCamera extends Camera{constructor(Z=-1,_=1,K=1,te=-1,ne=.1,ie=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=Z,this.right=_,this.top=K,this.bottom=te,this.near=ne,this.far=ie,this.updateProjectionMatrix()}copy(Z,_){return super.copy(Z,_),this.left=Z.left,this.right=Z.right,this.top=Z.top,this.bottom=Z.bottom,this.near=Z.near,this.far=Z.far,this.zoom=Z.zoom,this.view=Z.view===null?null:Object.assign({},Z.view),this}setViewOffset(Z,_,K,te,ne,ie){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=Z,this.view.fullHeight=_,this.view.offsetX=K,this.view.offsetY=te,this.view.width=ne,this.view.height=ie,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const Z=(this.right-this.left)/(2*this.zoom),_=(this.top-this.bottom)/(2*this.zoom),K=(this.right+this.left)/2,te=(this.top+this.bottom)/2;let ne=K-Z,ie=K+Z,oe=te+_,se=te-_;if(this.view!==null&&this.view.enabled){const ae=(this.right-this.left)/this.view.fullWidth/this.zoom,ge=(this.top-this.bottom)/this.view.fullHeight/this.zoom;ne+=ae*this.view.offsetX,ie=ne+ae*this.view.width,oe-=ge*this.view.offsetY,se=oe-ge*this.view.height}this.projectionMatrix.makeOrthographic(ne,ie,oe,se,this.near,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(Z){const _=super.toJSON(Z);return _.object.zoom=this.zoom,_.object.left=this.left,_.object.right=this.right,_.object.top=this.top,_.object.bottom=this.bottom,_.object.near=this.near,_.object.far=this.far,this.view!==null&&(_.object.view=Object.assign({},this.view)),_}}class DirectionalLightShadow extends LightShadow{constructor(){super(new OrthographicCamera(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}}class DirectionalLight extends Light{constructor(Z,_){super(Z,_),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(Object3D.DEFAULT_UP),this.updateMatrix(),this.target=new Object3D,this.shadow=new DirectionalLightShadow}dispose(){this.shadow.dispose()}copy(Z){return super.copy(Z),this.target=Z.target.clone(),this.shadow=Z.shadow.clone(),this}}class AmbientLight extends Light{constructor(Z,_){super(Z,_),this.isAmbientLight=!0,this.type="AmbientLight"}}class RectAreaLight extends Light{constructor(Z,_,K=10,te=10){super(Z,_),this.isRectAreaLight=!0,this.type="RectAreaLight",this.width=K,this.height=te}get power(){return this.intensity*this.width*this.height*Math.PI}set power(Z){this.intensity=Z/(this.width*this.height*Math.PI)}copy(Z){return super.copy(Z),this.width=Z.width,this.height=Z.height,this}toJSON(Z){const _=super.toJSON(Z);return _.object.width=this.width,_.object.height=this.height,_}}class SphericalHarmonics3{constructor(){this.isSphericalHarmonics3=!0,this.coefficients=[];for(let Z=0;Z<9;Z++)this.coefficients.push(new Vector3)}set(Z){for(let _=0;_<9;_++)this.coefficients[_].copy(Z[_]);return this}zero(){for(let Z=0;Z<9;Z++)this.coefficients[Z].set(0,0,0);return this}getAt(Z,_){const K=Z.x,te=Z.y,ne=Z.z,ie=this.coefficients;return _.copy(ie[0]).multiplyScalar(.282095),_.addScaledVector(ie[1],.488603*te),_.addScaledVector(ie[2],.488603*ne),_.addScaledVector(ie[3],.488603*K),_.addScaledVector(ie[4],1.092548*(K*te)),_.addScaledVector(ie[5],1.092548*(te*ne)),_.addScaledVector(ie[6],.315392*(3*ne*ne-1)),_.addScaledVector(ie[7],1.092548*(K*ne)),_.addScaledVector(ie[8],.546274*(K*K-te*te)),_}getIrradianceAt(Z,_){const K=Z.x,te=Z.y,ne=Z.z,ie=this.coefficients;return _.copy(ie[0]).multiplyScalar(.886227),_.addScaledVector(ie[1],2*.511664*te),_.addScaledVector(ie[2],2*.511664*ne),_.addScaledVector(ie[3],2*.511664*K),_.addScaledVector(ie[4],2*.429043*K*te),_.addScaledVector(ie[5],2*.429043*te*ne),_.addScaledVector(ie[6],.743125*ne*ne-.247708),_.addScaledVector(ie[7],2*.429043*K*ne),_.addScaledVector(ie[8],.429043*(K*K-te*te)),_}add(Z){for(let _=0;_<9;_++)this.coefficients[_].add(Z.coefficients[_]);return this}addScaledSH(Z,_){for(let K=0;K<9;K++)this.coefficients[K].addScaledVector(Z.coefficients[K],_);return this}scale(Z){for(let _=0;_<9;_++)this.coefficients[_].multiplyScalar(Z);return this}lerp(Z,_){for(let K=0;K<9;K++)this.coefficients[K].lerp(Z.coefficients[K],_);return this}equals(Z){for(let _=0;_<9;_++)if(!this.coefficients[_].equals(Z.coefficients[_]))return!1;return!0}copy(Z){return this.set(Z.coefficients)}clone(){return new this.constructor().copy(this)}fromArray(Z,_=0){const K=this.coefficients;for(let te=0;te<9;te++)K[te].fromArray(Z,_+te*3);return this}toArray(Z=[],_=0){const K=this.coefficients;for(let te=0;te<9;te++)K[te].toArray(Z,_+te*3);return Z}static getBasisAt(Z,_){const K=Z.x,te=Z.y,ne=Z.z;_[0]=.282095,_[1]=.488603*te,_[2]=.488603*ne,_[3]=.488603*K,_[4]=1.092548*K*te,_[5]=1.092548*te*ne,_[6]=.315392*(3*ne*ne-1),_[7]=1.092548*K*ne,_[8]=.546274*(K*K-te*te)}}class LightProbe extends Light{constructor(Z=new SphericalHarmonics3,_=1){super(void 0,_),this.isLightProbe=!0,this.sh=Z}copy(Z){return super.copy(Z),this.sh.copy(Z.sh),this}fromJSON(Z){return this.intensity=Z.intensity,this.sh.fromArray(Z.sh),this}toJSON(Z){const _=super.toJSON(Z);return _.object.sh=this.sh.toArray(),_}}class MaterialLoader extends Loader{constructor(Z){super(Z),this.textures={}}load(Z,_,K,te){const ne=this,ie=new FileLoader(ne.manager);ie.setPath(ne.path),ie.setRequestHeader(ne.requestHeader),ie.setWithCredentials(ne.withCredentials),ie.load(Z,function(oe){try{_(ne.parse(JSON.parse(oe)))}catch(se){te?te(se):console.error(se),ne.manager.itemError(Z)}},K,te)}parse(Z){const _=this.textures;function K(ne){return _[ne]===void 0&&console.warn("THREE.MaterialLoader: Undefined texture",ne),_[ne]}const te=this.createMaterialFromType(Z.type);if(Z.uuid!==void 0&&(te.uuid=Z.uuid),Z.name!==void 0&&(te.name=Z.name),Z.color!==void 0&&te.color!==void 0&&te.color.setHex(Z.color),Z.roughness!==void 0&&(te.roughness=Z.roughness),Z.metalness!==void 0&&(te.metalness=Z.metalness),Z.sheen!==void 0&&(te.sheen=Z.sheen),Z.sheenColor!==void 0&&(te.sheenColor=new Color$1().setHex(Z.sheenColor)),Z.sheenRoughness!==void 0&&(te.sheenRoughness=Z.sheenRoughness),Z.emissive!==void 0&&te.emissive!==void 0&&te.emissive.setHex(Z.emissive),Z.specular!==void 0&&te.specular!==void 0&&te.specular.setHex(Z.specular),Z.specularIntensity!==void 0&&(te.specularIntensity=Z.specularIntensity),Z.specularColor!==void 0&&te.specularColor!==void 0&&te.specularColor.setHex(Z.specularColor),Z.shininess!==void 0&&(te.shininess=Z.shininess),Z.clearcoat!==void 0&&(te.clearcoat=Z.clearcoat),Z.clearcoatRoughness!==void 0&&(te.clearcoatRoughness=Z.clearcoatRoughness),Z.dispersion!==void 0&&(te.dispersion=Z.dispersion),Z.iridescence!==void 0&&(te.iridescence=Z.iridescence),Z.iridescenceIOR!==void 0&&(te.iridescenceIOR=Z.iridescenceIOR),Z.iridescenceThicknessRange!==void 0&&(te.iridescenceThicknessRange=Z.iridescenceThicknessRange),Z.transmission!==void 0&&(te.transmission=Z.transmission),Z.thickness!==void 0&&(te.thickness=Z.thickness),Z.attenuationDistance!==void 0&&(te.attenuationDistance=Z.attenuationDistance),Z.attenuationColor!==void 0&&te.attenuationColor!==void 0&&te.attenuationColor.setHex(Z.attenuationColor),Z.anisotropy!==void 0&&(te.anisotropy=Z.anisotropy),Z.anisotropyRotation!==void 0&&(te.anisotropyRotation=Z.anisotropyRotation),Z.fog!==void 0&&(te.fog=Z.fog),Z.flatShading!==void 0&&(te.flatShading=Z.flatShading),Z.blending!==void 0&&(te.blending=Z.blending),Z.combine!==void 0&&(te.combine=Z.combine),Z.side!==void 0&&(te.side=Z.side),Z.shadowSide!==void 0&&(te.shadowSide=Z.shadowSide),Z.opacity!==void 0&&(te.opacity=Z.opacity),Z.transparent!==void 0&&(te.transparent=Z.transparent),Z.alphaTest!==void 0&&(te.alphaTest=Z.alphaTest),Z.alphaHash!==void 0&&(te.alphaHash=Z.alphaHash),Z.depthFunc!==void 0&&(te.depthFunc=Z.depthFunc),Z.depthTest!==void 0&&(te.depthTest=Z.depthTest),Z.depthWrite!==void 0&&(te.depthWrite=Z.depthWrite),Z.colorWrite!==void 0&&(te.colorWrite=Z.colorWrite),Z.blendSrc!==void 0&&(te.blendSrc=Z.blendSrc),Z.blendDst!==void 0&&(te.blendDst=Z.blendDst),Z.blendEquation!==void 0&&(te.blendEquation=Z.blendEquation),Z.blendSrcAlpha!==void 0&&(te.blendSrcAlpha=Z.blendSrcAlpha),Z.blendDstAlpha!==void 0&&(te.blendDstAlpha=Z.blendDstAlpha),Z.blendEquationAlpha!==void 0&&(te.blendEquationAlpha=Z.blendEquationAlpha),Z.blendColor!==void 0&&te.blendColor!==void 0&&te.blendColor.setHex(Z.blendColor),Z.blendAlpha!==void 0&&(te.blendAlpha=Z.blendAlpha),Z.stencilWriteMask!==void 0&&(te.stencilWriteMask=Z.stencilWriteMask),Z.stencilFunc!==void 0&&(te.stencilFunc=Z.stencilFunc),Z.stencilRef!==void 0&&(te.stencilRef=Z.stencilRef),Z.stencilFuncMask!==void 0&&(te.stencilFuncMask=Z.stencilFuncMask),Z.stencilFail!==void 0&&(te.stencilFail=Z.stencilFail),Z.stencilZFail!==void 0&&(te.stencilZFail=Z.stencilZFail),Z.stencilZPass!==void 0&&(te.stencilZPass=Z.stencilZPass),Z.stencilWrite!==void 0&&(te.stencilWrite=Z.stencilWrite),Z.wireframe!==void 0&&(te.wireframe=Z.wireframe),Z.wireframeLinewidth!==void 0&&(te.wireframeLinewidth=Z.wireframeLinewidth),Z.wireframeLinecap!==void 0&&(te.wireframeLinecap=Z.wireframeLinecap),Z.wireframeLinejoin!==void 0&&(te.wireframeLinejoin=Z.wireframeLinejoin),Z.rotation!==void 0&&(te.rotation=Z.rotation),Z.linewidth!==void 0&&(te.linewidth=Z.linewidth),Z.dashSize!==void 0&&(te.dashSize=Z.dashSize),Z.gapSize!==void 0&&(te.gapSize=Z.gapSize),Z.scale!==void 0&&(te.scale=Z.scale),Z.polygonOffset!==void 0&&(te.polygonOffset=Z.polygonOffset),Z.polygonOffsetFactor!==void 0&&(te.polygonOffsetFactor=Z.polygonOffsetFactor),Z.polygonOffsetUnits!==void 0&&(te.polygonOffsetUnits=Z.polygonOffsetUnits),Z.dithering!==void 0&&(te.dithering=Z.dithering),Z.alphaToCoverage!==void 0&&(te.alphaToCoverage=Z.alphaToCoverage),Z.premultipliedAlpha!==void 0&&(te.premultipliedAlpha=Z.premultipliedAlpha),Z.forceSinglePass!==void 0&&(te.forceSinglePass=Z.forceSinglePass),Z.visible!==void 0&&(te.visible=Z.visible),Z.toneMapped!==void 0&&(te.toneMapped=Z.toneMapped),Z.userData!==void 0&&(te.userData=Z.userData),Z.vertexColors!==void 0&&(typeof Z.vertexColors=="number"?te.vertexColors=Z.vertexColors>0:te.vertexColors=Z.vertexColors),Z.uniforms!==void 0)for(const ne in Z.uniforms){const ie=Z.uniforms[ne];switch(te.uniforms[ne]={},ie.type){case"t":te.uniforms[ne].value=K(ie.value);break;case"c":te.uniforms[ne].value=new Color$1().setHex(ie.value);break;case"v2":te.uniforms[ne].value=new Vector2().fromArray(ie.value);break;case"v3":te.uniforms[ne].value=new Vector3().fromArray(ie.value);break;case"v4":te.uniforms[ne].value=new Vector4().fromArray(ie.value);break;case"m3":te.uniforms[ne].value=new Matrix3().fromArray(ie.value);break;case"m4":te.uniforms[ne].value=new Matrix4().fromArray(ie.value);break;default:te.uniforms[ne].value=ie.value}}if(Z.defines!==void 0&&(te.defines=Z.defines),Z.vertexShader!==void 0&&(te.vertexShader=Z.vertexShader),Z.fragmentShader!==void 0&&(te.fragmentShader=Z.fragmentShader),Z.glslVersion!==void 0&&(te.glslVersion=Z.glslVersion),Z.extensions!==void 0)for(const ne in Z.extensions)te.extensions[ne]=Z.extensions[ne];if(Z.lights!==void 0&&(te.lights=Z.lights),Z.clipping!==void 0&&(te.clipping=Z.clipping),Z.size!==void 0&&(te.size=Z.size),Z.sizeAttenuation!==void 0&&(te.sizeAttenuation=Z.sizeAttenuation),Z.map!==void 0&&(te.map=K(Z.map)),Z.matcap!==void 0&&(te.matcap=K(Z.matcap)),Z.alphaMap!==void 0&&(te.alphaMap=K(Z.alphaMap)),Z.bumpMap!==void 0&&(te.bumpMap=K(Z.bumpMap)),Z.bumpScale!==void 0&&(te.bumpScale=Z.bumpScale),Z.normalMap!==void 0&&(te.normalMap=K(Z.normalMap)),Z.normalMapType!==void 0&&(te.normalMapType=Z.normalMapType),Z.normalScale!==void 0){let ne=Z.normalScale;Array.isArray(ne)===!1&&(ne=[ne,ne]),te.normalScale=new Vector2().fromArray(ne)}return Z.displacementMap!==void 0&&(te.displacementMap=K(Z.displacementMap)),Z.displacementScale!==void 0&&(te.displacementScale=Z.displacementScale),Z.displacementBias!==void 0&&(te.displacementBias=Z.displacementBias),Z.roughnessMap!==void 0&&(te.roughnessMap=K(Z.roughnessMap)),Z.metalnessMap!==void 0&&(te.metalnessMap=K(Z.metalnessMap)),Z.emissiveMap!==void 0&&(te.emissiveMap=K(Z.emissiveMap)),Z.emissiveIntensity!==void 0&&(te.emissiveIntensity=Z.emissiveIntensity),Z.specularMap!==void 0&&(te.specularMap=K(Z.specularMap)),Z.specularIntensityMap!==void 0&&(te.specularIntensityMap=K(Z.specularIntensityMap)),Z.specularColorMap!==void 0&&(te.specularColorMap=K(Z.specularColorMap)),Z.envMap!==void 0&&(te.envMap=K(Z.envMap)),Z.envMapRotation!==void 0&&te.envMapRotation.fromArray(Z.envMapRotation),Z.envMapIntensity!==void 0&&(te.envMapIntensity=Z.envMapIntensity),Z.reflectivity!==void 0&&(te.reflectivity=Z.reflectivity),Z.refractionRatio!==void 0&&(te.refractionRatio=Z.refractionRatio),Z.lightMap!==void 0&&(te.lightMap=K(Z.lightMap)),Z.lightMapIntensity!==void 0&&(te.lightMapIntensity=Z.lightMapIntensity),Z.aoMap!==void 0&&(te.aoMap=K(Z.aoMap)),Z.aoMapIntensity!==void 0&&(te.aoMapIntensity=Z.aoMapIntensity),Z.gradientMap!==void 0&&(te.gradientMap=K(Z.gradientMap)),Z.clearcoatMap!==void 0&&(te.clearcoatMap=K(Z.clearcoatMap)),Z.clearcoatRoughnessMap!==void 0&&(te.clearcoatRoughnessMap=K(Z.clearcoatRoughnessMap)),Z.clearcoatNormalMap!==void 0&&(te.clearcoatNormalMap=K(Z.clearcoatNormalMap)),Z.clearcoatNormalScale!==void 0&&(te.clearcoatNormalScale=new Vector2().fromArray(Z.clearcoatNormalScale)),Z.iridescenceMap!==void 0&&(te.iridescenceMap=K(Z.iridescenceMap)),Z.iridescenceThicknessMap!==void 0&&(te.iridescenceThicknessMap=K(Z.iridescenceThicknessMap)),Z.transmissionMap!==void 0&&(te.transmissionMap=K(Z.transmissionMap)),Z.thicknessMap!==void 0&&(te.thicknessMap=K(Z.thicknessMap)),Z.anisotropyMap!==void 0&&(te.anisotropyMap=K(Z.anisotropyMap)),Z.sheenColorMap!==void 0&&(te.sheenColorMap=K(Z.sheenColorMap)),Z.sheenRoughnessMap!==void 0&&(te.sheenRoughnessMap=K(Z.sheenRoughnessMap)),te}setTextures(Z){return this.textures=Z,this}createMaterialFromType(Z){return MaterialLoader.createMaterialFromType(Z)}static createMaterialFromType(Z){const _={ShadowMaterial,SpriteMaterial,RawShaderMaterial,ShaderMaterial,PointsMaterial,MeshPhysicalMaterial,MeshStandardMaterial,MeshPhongMaterial,MeshToonMaterial,MeshNormalMaterial,MeshLambertMaterial,MeshDepthMaterial,MeshDistanceMaterial,MeshBasicMaterial,MeshMatcapMaterial,LineDashedMaterial,LineBasicMaterial,Material};return new _[Z]}}class LoaderUtils{static decodeText(Z){if(console.warn("THREE.LoaderUtils: decodeText() has been deprecated with r165 and will be removed with r175. Use TextDecoder instead."),typeof TextDecoder<"u")return new TextDecoder().decode(Z);let _="";for(let K=0,te=Z.length;K<te;K++)_+=String.fromCharCode(Z[K]);try{return decodeURIComponent(escape(_))}catch{return _}}static extractUrlBase(Z){const _=Z.lastIndexOf("/");return _===-1?"./":Z.slice(0,_+1)}static resolveURL(Z,_){return typeof Z!="string"||Z===""?"":(/^https?:\/\//i.test(_)&&/^\//.test(Z)&&(_=_.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(Z)||/^data:.*,.*$/i.test(Z)||/^blob:.*$/i.test(Z)?Z:_+Z)}}class InstancedBufferGeometry extends BufferGeometry{constructor(){super(),this.isInstancedBufferGeometry=!0,this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy(Z){return super.copy(Z),this.instanceCount=Z.instanceCount,this}toJSON(){const Z=super.toJSON();return Z.instanceCount=this.instanceCount,Z.isInstancedBufferGeometry=!0,Z}}class BufferGeometryLoader extends Loader{constructor(Z){super(Z)}load(Z,_,K,te){const ne=this,ie=new FileLoader(ne.manager);ie.setPath(ne.path),ie.setRequestHeader(ne.requestHeader),ie.setWithCredentials(ne.withCredentials),ie.load(Z,function(oe){try{_(ne.parse(JSON.parse(oe)))}catch(se){te?te(se):console.error(se),ne.manager.itemError(Z)}},K,te)}parse(Z){const _={},K={};function te(Ie,fe){if(_[fe]!==void 0)return _[fe];const Ae=Ie.interleavedBuffers[fe],ye=ne(Ie,Ae.buffer),ve=getTypedArray(Ae.type,ye),Be=new InterleavedBuffer(ve,Ae.stride);return Be.uuid=Ae.uuid,_[fe]=Be,Be}function ne(Ie,fe){if(K[fe]!==void 0)return K[fe];const Ae=Ie.arrayBuffers[fe],ye=new Uint32Array(Ae).buffer;return K[fe]=ye,ye}const ie=Z.isInstancedBufferGeometry?new InstancedBufferGeometry:new BufferGeometry,oe=Z.data.index;if(oe!==void 0){const Ie=getTypedArray(oe.type,oe.array);ie.setIndex(new BufferAttribute(Ie,1))}const se=Z.data.attributes;for(const Ie in se){const fe=se[Ie];let be;if(fe.isInterleavedBufferAttribute){const Ae=te(Z.data,fe.data);be=new InterleavedBufferAttribute(Ae,fe.itemSize,fe.offset,fe.normalized)}else{const Ae=getTypedArray(fe.type,fe.array),ye=fe.isInstancedBufferAttribute?InstancedBufferAttribute:BufferAttribute;be=new ye(Ae,fe.itemSize,fe.normalized)}fe.name!==void 0&&(be.name=fe.name),fe.usage!==void 0&&be.setUsage(fe.usage),ie.setAttribute(Ie,be)}const ae=Z.data.morphAttributes;if(ae)for(const Ie in ae){const fe=ae[Ie],be=[];for(let Ae=0,ye=fe.length;Ae<ye;Ae++){const ve=fe[Ae];let Be;if(ve.isInterleavedBufferAttribute){const Re=te(Z.data,ve.data);Be=new InterleavedBufferAttribute(Re,ve.itemSize,ve.offset,ve.normalized)}else{const Re=getTypedArray(ve.type,ve.array);Be=new BufferAttribute(Re,ve.itemSize,ve.normalized)}ve.name!==void 0&&(Be.name=ve.name),be.push(Be)}ie.morphAttributes[Ie]=be}Z.data.morphTargetsRelative&&(ie.morphTargetsRelative=!0);const ce=Z.data.groups||Z.data.drawcalls||Z.data.offsets;if(ce!==void 0)for(let Ie=0,fe=ce.length;Ie!==fe;++Ie){const be=ce[Ie];ie.addGroup(be.start,be.count,be.materialIndex)}const de=Z.data.boundingSphere;if(de!==void 0){const Ie=new Vector3;de.center!==void 0&&Ie.fromArray(de.center),ie.boundingSphere=new Sphere(Ie,de.radius)}return Z.name&&(ie.name=Z.name),Z.userData&&(ie.userData=Z.userData),ie}}class ObjectLoader extends Loader{constructor(Z){super(Z)}load(Z,_,K,te){const ne=this,ie=this.path===""?LoaderUtils.extractUrlBase(Z):this.path;this.resourcePath=this.resourcePath||ie;const oe=new FileLoader(this.manager);oe.setPath(this.path),oe.setRequestHeader(this.requestHeader),oe.setWithCredentials(this.withCredentials),oe.load(Z,function(se){let ae=null;try{ae=JSON.parse(se)}catch(ce){te!==void 0&&te(ce),console.error("THREE:ObjectLoader: Can't parse "+Z+".",ce.message);return}const ge=ae.metadata;if(ge===void 0||ge.type===void 0||ge.type.toLowerCase()==="geometry"){te!==void 0&&te(new Error("THREE.ObjectLoader: Can't load "+Z)),console.error("THREE.ObjectLoader: Can't load "+Z);return}ne.parse(ae,_)},K,te)}async loadAsync(Z,_){const K=this,te=this.path===""?LoaderUtils.extractUrlBase(Z):this.path;this.resourcePath=this.resourcePath||te;const ne=new FileLoader(this.manager);ne.setPath(this.path),ne.setRequestHeader(this.requestHeader),ne.setWithCredentials(this.withCredentials);const ie=await ne.loadAsync(Z,_),oe=JSON.parse(ie),se=oe.metadata;if(se===void 0||se.type===void 0||se.type.toLowerCase()==="geometry")throw new Error("THREE.ObjectLoader: Can't load "+Z);return await K.parseAsync(oe)}parse(Z,_){const K=this.parseAnimations(Z.animations),te=this.parseShapes(Z.shapes),ne=this.parseGeometries(Z.geometries,te),ie=this.parseImages(Z.images,function(){_!==void 0&&_(ae)}),oe=this.parseTextures(Z.textures,ie),se=this.parseMaterials(Z.materials,oe),ae=this.parseObject(Z.object,ne,se,oe,K),ge=this.parseSkeletons(Z.skeletons,ae);if(this.bindSkeletons(ae,ge),this.bindLightTargets(ae),_!==void 0){let ce=!1;for(const de in ie)if(ie[de].data instanceof HTMLImageElement){ce=!0;break}ce===!1&&_(ae)}return ae}async parseAsync(Z){const _=this.parseAnimations(Z.animations),K=this.parseShapes(Z.shapes),te=this.parseGeometries(Z.geometries,K),ne=await this.parseImagesAsync(Z.images),ie=this.parseTextures(Z.textures,ne),oe=this.parseMaterials(Z.materials,ie),se=this.parseObject(Z.object,te,oe,ie,_),ae=this.parseSkeletons(Z.skeletons,se);return this.bindSkeletons(se,ae),this.bindLightTargets(se),se}parseShapes(Z){const _={};if(Z!==void 0)for(let K=0,te=Z.length;K<te;K++){const ne=new Shape$2().fromJSON(Z[K]);_[ne.uuid]=ne}return _}parseSkeletons(Z,_){const K={},te={};if(_.traverse(function(ne){ne.isBone&&(te[ne.uuid]=ne)}),Z!==void 0)for(let ne=0,ie=Z.length;ne<ie;ne++){const oe=new Skeleton().fromJSON(Z[ne],te);K[oe.uuid]=oe}return K}parseGeometries(Z,_){const K={};if(Z!==void 0){const te=new BufferGeometryLoader;for(let ne=0,ie=Z.length;ne<ie;ne++){let oe;const se=Z[ne];switch(se.type){case"BufferGeometry":case"InstancedBufferGeometry":oe=te.parse(se);break;default:se.type in Geometries?oe=Geometries[se.type].fromJSON(se,_):console.warn(`THREE.ObjectLoader: Unsupported geometry type "${se.type}"`)}oe.uuid=se.uuid,se.name!==void 0&&(oe.name=se.name),se.userData!==void 0&&(oe.userData=se.userData),K[se.uuid]=oe}}return K}parseMaterials(Z,_){const K={},te={};if(Z!==void 0){const ne=new MaterialLoader;ne.setTextures(_);for(let ie=0,oe=Z.length;ie<oe;ie++){const se=Z[ie];K[se.uuid]===void 0&&(K[se.uuid]=ne.parse(se)),te[se.uuid]=K[se.uuid]}}return te}parseAnimations(Z){const _={};if(Z!==void 0)for(let K=0;K<Z.length;K++){const te=Z[K],ne=AnimationClip.parse(te);_[ne.uuid]=ne}return _}parseImages(Z,_){const K=this,te={};let ne;function ie(se){return K.manager.itemStart(se),ne.load(se,function(){K.manager.itemEnd(se)},void 0,function(){K.manager.itemError(se),K.manager.itemEnd(se)})}function oe(se){if(typeof se=="string"){const ae=se,ge=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(ae)?ae:K.resourcePath+ae;return ie(ge)}else return se.data?{data:getTypedArray(se.type,se.data),width:se.width,height:se.height}:null}if(Z!==void 0&&Z.length>0){const se=new LoadingManager(_);ne=new ImageLoader(se),ne.setCrossOrigin(this.crossOrigin);for(let ae=0,ge=Z.length;ae<ge;ae++){const ce=Z[ae],de=ce.url;if(Array.isArray(de)){const Ie=[];for(let fe=0,be=de.length;fe<be;fe++){const Ae=de[fe],ye=oe(Ae);ye!==null&&(ye instanceof HTMLImageElement?Ie.push(ye):Ie.push(new DataTexture(ye.data,ye.width,ye.height)))}te[ce.uuid]=new Source(Ie)}else{const Ie=oe(ce.url);te[ce.uuid]=new Source(Ie)}}}return te}async parseImagesAsync(Z){const _=this,K={};let te;async function ne(ie){if(typeof ie=="string"){const oe=ie,se=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(oe)?oe:_.resourcePath+oe;return await te.loadAsync(se)}else return ie.data?{data:getTypedArray(ie.type,ie.data),width:ie.width,height:ie.height}:null}if(Z!==void 0&&Z.length>0){te=new ImageLoader(this.manager),te.setCrossOrigin(this.crossOrigin);for(let ie=0,oe=Z.length;ie<oe;ie++){const se=Z[ie],ae=se.url;if(Array.isArray(ae)){const ge=[];for(let ce=0,de=ae.length;ce<de;ce++){const Ie=ae[ce],fe=await ne(Ie);fe!==null&&(fe instanceof HTMLImageElement?ge.push(fe):ge.push(new DataTexture(fe.data,fe.width,fe.height)))}K[se.uuid]=new Source(ge)}else{const ge=await ne(se.url);K[se.uuid]=new Source(ge)}}}return K}parseTextures(Z,_){function K(ne,ie){return typeof ne=="number"?ne:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",ne),ie[ne])}const te={};if(Z!==void 0)for(let ne=0,ie=Z.length;ne<ie;ne++){const oe=Z[ne];oe.image===void 0&&console.warn('THREE.ObjectLoader: No "image" specified for',oe.uuid),_[oe.image]===void 0&&console.warn("THREE.ObjectLoader: Undefined image",oe.image);const se=_[oe.image],ae=se.data;let ge;Array.isArray(ae)?(ge=new CubeTexture,ae.length===6&&(ge.needsUpdate=!0)):(ae&&ae.data?ge=new DataTexture:ge=new Texture,ae&&(ge.needsUpdate=!0)),ge.source=se,ge.uuid=oe.uuid,oe.name!==void 0&&(ge.name=oe.name),oe.mapping!==void 0&&(ge.mapping=K(oe.mapping,TEXTURE_MAPPING)),oe.channel!==void 0&&(ge.channel=oe.channel),oe.offset!==void 0&&ge.offset.fromArray(oe.offset),oe.repeat!==void 0&&ge.repeat.fromArray(oe.repeat),oe.center!==void 0&&ge.center.fromArray(oe.center),oe.rotation!==void 0&&(ge.rotation=oe.rotation),oe.wrap!==void 0&&(ge.wrapS=K(oe.wrap[0],TEXTURE_WRAPPING),ge.wrapT=K(oe.wrap[1],TEXTURE_WRAPPING)),oe.format!==void 0&&(ge.format=oe.format),oe.internalFormat!==void 0&&(ge.internalFormat=oe.internalFormat),oe.type!==void 0&&(ge.type=oe.type),oe.colorSpace!==void 0&&(ge.colorSpace=oe.colorSpace),oe.minFilter!==void 0&&(ge.minFilter=K(oe.minFilter,TEXTURE_FILTER)),oe.magFilter!==void 0&&(ge.magFilter=K(oe.magFilter,TEXTURE_FILTER)),oe.anisotropy!==void 0&&(ge.anisotropy=oe.anisotropy),oe.flipY!==void 0&&(ge.flipY=oe.flipY),oe.generateMipmaps!==void 0&&(ge.generateMipmaps=oe.generateMipmaps),oe.premultiplyAlpha!==void 0&&(ge.premultiplyAlpha=oe.premultiplyAlpha),oe.unpackAlignment!==void 0&&(ge.unpackAlignment=oe.unpackAlignment),oe.compareFunction!==void 0&&(ge.compareFunction=oe.compareFunction),oe.userData!==void 0&&(ge.userData=oe.userData),te[oe.uuid]=ge}return te}parseObject(Z,_,K,te,ne){let ie;function oe(de){return _[de]===void 0&&console.warn("THREE.ObjectLoader: Undefined geometry",de),_[de]}function se(de){if(de!==void 0){if(Array.isArray(de)){const Ie=[];for(let fe=0,be=de.length;fe<be;fe++){const Ae=de[fe];K[Ae]===void 0&&console.warn("THREE.ObjectLoader: Undefined material",Ae),Ie.push(K[Ae])}return Ie}return K[de]===void 0&&console.warn("THREE.ObjectLoader: Undefined material",de),K[de]}}function ae(de){return te[de]===void 0&&console.warn("THREE.ObjectLoader: Undefined texture",de),te[de]}let ge,ce;switch(Z.type){case"Scene":ie=new Scene$1,Z.background!==void 0&&(Number.isInteger(Z.background)?ie.background=new Color$1(Z.background):ie.background=ae(Z.background)),Z.environment!==void 0&&(ie.environment=ae(Z.environment)),Z.fog!==void 0&&(Z.fog.type==="Fog"?ie.fog=new Fog(Z.fog.color,Z.fog.near,Z.fog.far):Z.fog.type==="FogExp2"&&(ie.fog=new FogExp2(Z.fog.color,Z.fog.density)),Z.fog.name!==""&&(ie.fog.name=Z.fog.name)),Z.backgroundBlurriness!==void 0&&(ie.backgroundBlurriness=Z.backgroundBlurriness),Z.backgroundIntensity!==void 0&&(ie.backgroundIntensity=Z.backgroundIntensity),Z.backgroundRotation!==void 0&&ie.backgroundRotation.fromArray(Z.backgroundRotation),Z.environmentIntensity!==void 0&&(ie.environmentIntensity=Z.environmentIntensity),Z.environmentRotation!==void 0&&ie.environmentRotation.fromArray(Z.environmentRotation);break;case"PerspectiveCamera":ie=new PerspectiveCamera(Z.fov,Z.aspect,Z.near,Z.far),Z.focus!==void 0&&(ie.focus=Z.focus),Z.zoom!==void 0&&(ie.zoom=Z.zoom),Z.filmGauge!==void 0&&(ie.filmGauge=Z.filmGauge),Z.filmOffset!==void 0&&(ie.filmOffset=Z.filmOffset),Z.view!==void 0&&(ie.view=Object.assign({},Z.view));break;case"OrthographicCamera":ie=new OrthographicCamera(Z.left,Z.right,Z.top,Z.bottom,Z.near,Z.far),Z.zoom!==void 0&&(ie.zoom=Z.zoom),Z.view!==void 0&&(ie.view=Object.assign({},Z.view));break;case"AmbientLight":ie=new AmbientLight(Z.color,Z.intensity);break;case"DirectionalLight":ie=new DirectionalLight(Z.color,Z.intensity),ie.target=Z.target||"";break;case"PointLight":ie=new PointLight(Z.color,Z.intensity,Z.distance,Z.decay);break;case"RectAreaLight":ie=new RectAreaLight(Z.color,Z.intensity,Z.width,Z.height);break;case"SpotLight":ie=new SpotLight(Z.color,Z.intensity,Z.distance,Z.angle,Z.penumbra,Z.decay),ie.target=Z.target||"";break;case"HemisphereLight":ie=new HemisphereLight(Z.color,Z.groundColor,Z.intensity);break;case"LightProbe":ie=new LightProbe().fromJSON(Z);break;case"SkinnedMesh":ge=oe(Z.geometry),ce=se(Z.material),ie=new SkinnedMesh(ge,ce),Z.bindMode!==void 0&&(ie.bindMode=Z.bindMode),Z.bindMatrix!==void 0&&ie.bindMatrix.fromArray(Z.bindMatrix),Z.skeleton!==void 0&&(ie.skeleton=Z.skeleton);break;case"Mesh":ge=oe(Z.geometry),ce=se(Z.material),ie=new Mesh(ge,ce);break;case"InstancedMesh":ge=oe(Z.geometry),ce=se(Z.material);const de=Z.count,Ie=Z.instanceMatrix,fe=Z.instanceColor;ie=new InstancedMesh(ge,ce,de),ie.instanceMatrix=new InstancedBufferAttribute(new Float32Array(Ie.array),16),fe!==void 0&&(ie.instanceColor=new InstancedBufferAttribute(new Float32Array(fe.array),fe.itemSize));break;case"BatchedMesh":ge=oe(Z.geometry),ce=se(Z.material),ie=new BatchedMesh(Z.maxInstanceCount,Z.maxVertexCount,Z.maxIndexCount,ce),ie.geometry=ge,ie.perObjectFrustumCulled=Z.perObjectFrustumCulled,ie.sortObjects=Z.sortObjects,ie._drawRanges=Z.drawRanges,ie._reservedRanges=Z.reservedRanges,ie._visibility=Z.visibility,ie._active=Z.active,ie._bounds=Z.bounds.map(be=>{const Ae=new Box3;Ae.min.fromArray(be.boxMin),Ae.max.fromArray(be.boxMax);const ye=new Sphere;return ye.radius=be.sphereRadius,ye.center.fromArray(be.sphereCenter),{boxInitialized:be.boxInitialized,box:Ae,sphereInitialized:be.sphereInitialized,sphere:ye}}),ie._maxInstanceCount=Z.maxInstanceCount,ie._maxVertexCount=Z.maxVertexCount,ie._maxIndexCount=Z.maxIndexCount,ie._geometryInitialized=Z.geometryInitialized,ie._geometryCount=Z.geometryCount,ie._matricesTexture=ae(Z.matricesTexture.uuid),Z.colorsTexture!==void 0&&(ie._colorsTexture=ae(Z.colorsTexture.uuid));break;case"LOD":ie=new LOD;break;case"Line":ie=new Line(oe(Z.geometry),se(Z.material));break;case"LineLoop":ie=new LineLoop(oe(Z.geometry),se(Z.material));break;case"LineSegments":ie=new LineSegments(oe(Z.geometry),se(Z.material));break;case"PointCloud":case"Points":ie=new Points(oe(Z.geometry),se(Z.material));break;case"Sprite":ie=new Sprite(se(Z.material));break;case"Group":ie=new Group;break;case"Bone":ie=new Bone;break;default:ie=new Object3D}if(ie.uuid=Z.uuid,Z.name!==void 0&&(ie.name=Z.name),Z.matrix!==void 0?(ie.matrix.fromArray(Z.matrix),Z.matrixAutoUpdate!==void 0&&(ie.matrixAutoUpdate=Z.matrixAutoUpdate),ie.matrixAutoUpdate&&ie.matrix.decompose(ie.position,ie.quaternion,ie.scale)):(Z.position!==void 0&&ie.position.fromArray(Z.position),Z.rotation!==void 0&&ie.rotation.fromArray(Z.rotation),Z.quaternion!==void 0&&ie.quaternion.fromArray(Z.quaternion),Z.scale!==void 0&&ie.scale.fromArray(Z.scale)),Z.up!==void 0&&ie.up.fromArray(Z.up),Z.castShadow!==void 0&&(ie.castShadow=Z.castShadow),Z.receiveShadow!==void 0&&(ie.receiveShadow=Z.receiveShadow),Z.shadow&&(Z.shadow.intensity!==void 0&&(ie.shadow.intensity=Z.shadow.intensity),Z.shadow.bias!==void 0&&(ie.shadow.bias=Z.shadow.bias),Z.shadow.normalBias!==void 0&&(ie.shadow.normalBias=Z.shadow.normalBias),Z.shadow.radius!==void 0&&(ie.shadow.radius=Z.shadow.radius),Z.shadow.mapSize!==void 0&&ie.shadow.mapSize.fromArray(Z.shadow.mapSize),Z.shadow.camera!==void 0&&(ie.shadow.camera=this.parseObject(Z.shadow.camera))),Z.visible!==void 0&&(ie.visible=Z.visible),Z.frustumCulled!==void 0&&(ie.frustumCulled=Z.frustumCulled),Z.renderOrder!==void 0&&(ie.renderOrder=Z.renderOrder),Z.userData!==void 0&&(ie.userData=Z.userData),Z.layers!==void 0&&(ie.layers.mask=Z.layers),Z.children!==void 0){const de=Z.children;for(let Ie=0;Ie<de.length;Ie++)ie.add(this.parseObject(de[Ie],_,K,te,ne))}if(Z.animations!==void 0){const de=Z.animations;for(let Ie=0;Ie<de.length;Ie++){const fe=de[Ie];ie.animations.push(ne[fe])}}if(Z.type==="LOD"){Z.autoUpdate!==void 0&&(ie.autoUpdate=Z.autoUpdate);const de=Z.levels;for(let Ie=0;Ie<de.length;Ie++){const fe=de[Ie],be=ie.getObjectByProperty("uuid",fe.object);be!==void 0&&ie.addLevel(be,fe.distance,fe.hysteresis)}}return ie}bindSkeletons(Z,_){Object.keys(_).length!==0&&Z.traverse(function(K){if(K.isSkinnedMesh===!0&&K.skeleton!==void 0){const te=_[K.skeleton];te===void 0?console.warn("THREE.ObjectLoader: No skeleton found with UUID:",K.skeleton):K.bind(te,K.bindMatrix)}})}bindLightTargets(Z){Z.traverse(function(_){if(_.isDirectionalLight||_.isSpotLight){const K=_.target,te=Z.getObjectByProperty("uuid",K);te!==void 0?_.target=te:_.target=new Object3D}})}}const TEXTURE_MAPPING={UVMapping,CubeReflectionMapping,CubeRefractionMapping,EquirectangularReflectionMapping,EquirectangularRefractionMapping,CubeUVReflectionMapping},TEXTURE_WRAPPING={RepeatWrapping,ClampToEdgeWrapping,MirroredRepeatWrapping},TEXTURE_FILTER={NearestFilter,NearestMipmapNearestFilter,NearestMipmapLinearFilter,LinearFilter,LinearMipmapNearestFilter,LinearMipmapLinearFilter};class ImageBitmapLoader extends Loader{constructor(Z){super(Z),this.isImageBitmapLoader=!0,typeof createImageBitmap>"u"&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),typeof fetch>"u"&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"}}setOptions(Z){return this.options=Z,this}load(Z,_,K,te){Z===void 0&&(Z=""),this.path!==void 0&&(Z=this.path+Z),Z=this.manager.resolveURL(Z);const ne=this,ie=Cache.get(Z);if(ie!==void 0){if(ne.manager.itemStart(Z),ie.then){ie.then(ae=>{_&&_(ae),ne.manager.itemEnd(Z)}).catch(ae=>{te&&te(ae)});return}return setTimeout(function(){_&&_(ie),ne.manager.itemEnd(Z)},0),ie}const oe={};oe.credentials=this.crossOrigin==="anonymous"?"same-origin":"include",oe.headers=this.requestHeader;const se=fetch(Z,oe).then(function(ae){return ae.blob()}).then(function(ae){return createImageBitmap(ae,Object.assign(ne.options,{colorSpaceConversion:"none"}))}).then(function(ae){return Cache.add(Z,ae),_&&_(ae),ne.manager.itemEnd(Z),ae}).catch(function(ae){te&&te(ae),Cache.remove(Z),ne.manager.itemError(Z),ne.manager.itemEnd(Z)});Cache.add(Z,se),ne.manager.itemStart(Z)}}let _context,AudioContext$1=class{static getContext(){return _context===void 0&&(_context=new(window.AudioContext||window.webkitAudioContext)),_context}static setContext(Z){_context=Z}};class AudioLoader extends Loader{constructor(Z){super(Z)}load(Z,_,K,te){const ne=this,ie=new FileLoader(this.manager);ie.setResponseType("arraybuffer"),ie.setPath(this.path),ie.setRequestHeader(this.requestHeader),ie.setWithCredentials(this.withCredentials),ie.load(Z,function(se){try{const ae=se.slice(0);AudioContext$1.getContext().decodeAudioData(ae,function(ce){_(ce)}).catch(oe)}catch(ae){oe(ae)}},K,te);function oe(se){te?te(se):console.error(se),ne.manager.itemError(Z)}}}const _eyeRight=new Matrix4,_eyeLeft=new Matrix4,_projectionMatrix=new Matrix4;class StereoCamera{constructor(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new PerspectiveCamera,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new PerspectiveCamera,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}update(Z){const _=this._cache;if(_.focus!==Z.focus||_.fov!==Z.fov||_.aspect!==Z.aspect*this.aspect||_.near!==Z.near||_.far!==Z.far||_.zoom!==Z.zoom||_.eyeSep!==this.eyeSep){_.focus=Z.focus,_.fov=Z.fov,_.aspect=Z.aspect*this.aspect,_.near=Z.near,_.far=Z.far,_.zoom=Z.zoom,_.eyeSep=this.eyeSep,_projectionMatrix.copy(Z.projectionMatrix);const te=_.eyeSep/2,ne=te*_.near/_.focus,ie=_.near*Math.tan(DEG2RAD*_.fov*.5)/_.zoom;let oe,se;_eyeLeft.elements[12]=-te,_eyeRight.elements[12]=te,oe=-ie*_.aspect+ne,se=ie*_.aspect+ne,_projectionMatrix.elements[0]=2*_.near/(se-oe),_projectionMatrix.elements[8]=(se+oe)/(se-oe),this.cameraL.projectionMatrix.copy(_projectionMatrix),oe=-ie*_.aspect-ne,se=ie*_.aspect-ne,_projectionMatrix.elements[0]=2*_.near/(se-oe),_projectionMatrix.elements[8]=(se+oe)/(se-oe),this.cameraR.projectionMatrix.copy(_projectionMatrix)}this.cameraL.matrixWorld.copy(Z.matrixWorld).multiply(_eyeLeft),this.cameraR.matrixWorld.copy(Z.matrixWorld).multiply(_eyeRight)}}class ArrayCamera extends PerspectiveCamera{constructor(Z=[]){super(),this.isArrayCamera=!0,this.cameras=Z}}class Clock{constructor(Z=!0){this.autoStart=Z,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=now$2(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let Z=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const _=now$2();Z=(_-this.oldTime)/1e3,this.oldTime=_,this.elapsedTime+=Z}return Z}}function now$2(){return performance.now()}const _position$1=new Vector3,_quaternion$1=new Quaternion$2,_scale$1=new Vector3,_orientation$1=new Vector3;class AudioListener extends Object3D{constructor(){super(),this.type="AudioListener",this.context=AudioContext$1.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null,this.timeDelta=0,this._clock=new Clock}getInput(){return this.gain}removeFilter(){return this.filter!==null&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this}getFilter(){return this.filter}setFilter(Z){return this.filter!==null?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=Z,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this}getMasterVolume(){return this.gain.gain.value}setMasterVolume(Z){return this.gain.gain.setTargetAtTime(Z,this.context.currentTime,.01),this}updateMatrixWorld(Z){super.updateMatrixWorld(Z);const _=this.context.listener,K=this.up;if(this.timeDelta=this._clock.getDelta(),this.matrixWorld.decompose(_position$1,_quaternion$1,_scale$1),_orientation$1.set(0,0,-1).applyQuaternion(_quaternion$1),_.positionX){const te=this.context.currentTime+this.timeDelta;_.positionX.linearRampToValueAtTime(_position$1.x,te),_.positionY.linearRampToValueAtTime(_position$1.y,te),_.positionZ.linearRampToValueAtTime(_position$1.z,te),_.forwardX.linearRampToValueAtTime(_orientation$1.x,te),_.forwardY.linearRampToValueAtTime(_orientation$1.y,te),_.forwardZ.linearRampToValueAtTime(_orientation$1.z,te),_.upX.linearRampToValueAtTime(K.x,te),_.upY.linearRampToValueAtTime(K.y,te),_.upZ.linearRampToValueAtTime(K.z,te)}else _.setPosition(_position$1.x,_position$1.y,_position$1.z),_.setOrientation(_orientation$1.x,_orientation$1.y,_orientation$1.z,K.x,K.y,K.z)}}class Audio extends Object3D{constructor(Z){super(),this.type="Audio",this.listener=Z,this.context=Z.context,this.gain=this.context.createGain(),this.gain.connect(Z.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.source=null,this.sourceType="empty",this._startedAt=0,this._progress=0,this._connected=!1,this.filters=[]}getOutput(){return this.gain}setNodeSource(Z){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=Z,this.connect(),this}setMediaElementSource(Z){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(Z),this.connect(),this}setMediaStreamSource(Z){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(Z),this.connect(),this}setBuffer(Z){return this.buffer=Z,this.sourceType="buffer",this.autoplay&&this.play(),this}play(Z=0){if(this.isPlaying===!0){console.warn("THREE.Audio: Audio is already playing.");return}if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}this._startedAt=this.context.currentTime+Z;const _=this.context.createBufferSource();return _.buffer=this.buffer,_.loop=this.loop,_.loopStart=this.loopStart,_.loopEnd=this.loopEnd,_.onended=this.onEnded.bind(this),_.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=_,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}pause(){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.isPlaying===!0&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,this.loop===!0&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this}stop(Z=0){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this._progress=0,this.source!==null&&(this.source.stop(this.context.currentTime+Z),this.source.onended=null),this.isPlaying=!1,this}connect(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(let Z=1,_=this.filters.length;Z<_;Z++)this.filters[Z-1].connect(this.filters[Z]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this}disconnect(){if(this._connected!==!1){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(let Z=1,_=this.filters.length;Z<_;Z++)this.filters[Z-1].disconnect(this.filters[Z]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this}}getFilters(){return this.filters}setFilters(Z){return Z||(Z=[]),this._connected===!0?(this.disconnect(),this.filters=Z.slice(),this.connect()):this.filters=Z.slice(),this}setDetune(Z){return this.detune=Z,this.isPlaying===!0&&this.source.detune!==void 0&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this}getDetune(){return this.detune}getFilter(){return this.getFilters()[0]}setFilter(Z){return this.setFilters(Z?[Z]:[])}setPlaybackRate(Z){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.playbackRate=Z,this.isPlaying===!0&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this}getPlaybackRate(){return this.playbackRate}onEnded(){this.isPlaying=!1,this._progress=0}getLoop(){return this.hasPlaybackControl===!1?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop}setLoop(Z){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.loop=Z,this.isPlaying===!0&&(this.source.loop=this.loop),this}setLoopStart(Z){return this.loopStart=Z,this}setLoopEnd(Z){return this.loopEnd=Z,this}getVolume(){return this.gain.gain.value}setVolume(Z){return this.gain.gain.setTargetAtTime(Z,this.context.currentTime,.01),this}copy(Z,_){return super.copy(Z,_),Z.sourceType!=="buffer"?(console.warn("THREE.Audio: Audio source type cannot be copied."),this):(this.autoplay=Z.autoplay,this.buffer=Z.buffer,this.detune=Z.detune,this.loop=Z.loop,this.loopStart=Z.loopStart,this.loopEnd=Z.loopEnd,this.offset=Z.offset,this.duration=Z.duration,this.playbackRate=Z.playbackRate,this.hasPlaybackControl=Z.hasPlaybackControl,this.sourceType=Z.sourceType,this.filters=Z.filters.slice(),this)}clone(Z){return new this.constructor(this.listener).copy(this,Z)}}const _position=new Vector3,_quaternion=new Quaternion$2,_scale=new Vector3,_orientation=new Vector3;class PositionalAudio extends Audio{constructor(Z){super(Z),this.panner=this.context.createPanner(),this.panner.panningModel="HRTF",this.panner.connect(this.gain)}connect(){super.connect(),this.panner.connect(this.gain)}disconnect(){super.disconnect(),this.panner.disconnect(this.gain)}getOutput(){return this.panner}getRefDistance(){return this.panner.refDistance}setRefDistance(Z){return this.panner.refDistance=Z,this}getRolloffFactor(){return this.panner.rolloffFactor}setRolloffFactor(Z){return this.panner.rolloffFactor=Z,this}getDistanceModel(){return this.panner.distanceModel}setDistanceModel(Z){return this.panner.distanceModel=Z,this}getMaxDistance(){return this.panner.maxDistance}setMaxDistance(Z){return this.panner.maxDistance=Z,this}setDirectionalCone(Z,_,K){return this.panner.coneInnerAngle=Z,this.panner.coneOuterAngle=_,this.panner.coneOuterGain=K,this}updateMatrixWorld(Z){if(super.updateMatrixWorld(Z),this.hasPlaybackControl===!0&&this.isPlaying===!1)return;this.matrixWorld.decompose(_position,_quaternion,_scale),_orientation.set(0,0,1).applyQuaternion(_quaternion);const _=this.panner;if(_.positionX){const K=this.context.currentTime+this.listener.timeDelta;_.positionX.linearRampToValueAtTime(_position.x,K),_.positionY.linearRampToValueAtTime(_position.y,K),_.positionZ.linearRampToValueAtTime(_position.z,K),_.orientationX.linearRampToValueAtTime(_orientation.x,K),_.orientationY.linearRampToValueAtTime(_orientation.y,K),_.orientationZ.linearRampToValueAtTime(_orientation.z,K)}else _.setPosition(_position.x,_position.y,_position.z),_.setOrientation(_orientation.x,_orientation.y,_orientation.z)}}class AudioAnalyser{constructor(Z,_=2048){this.analyser=Z.context.createAnalyser(),this.analyser.fftSize=_,this.data=new Uint8Array(this.analyser.frequencyBinCount),Z.getOutput().connect(this.analyser)}getFrequencyData(){return this.analyser.getByteFrequencyData(this.data),this.data}getAverageFrequency(){let Z=0;const _=this.getFrequencyData();for(let K=0;K<_.length;K++)Z+=_[K];return Z/_.length}}class PropertyMixer{constructor(Z,_,K){this.binding=Z,this.valueSize=K;let te,ne,ie;switch(_){case"quaternion":te=this._slerp,ne=this._slerpAdditive,ie=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(K*6),this._workIndex=5;break;case"string":case"bool":te=this._select,ne=this._select,ie=this._setAdditiveIdentityOther,this.buffer=new Array(K*5);break;default:te=this._lerp,ne=this._lerpAdditive,ie=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(K*5)}this._mixBufferRegion=te,this._mixBufferRegionAdditive=ne,this._setIdentity=ie,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(Z,_){const K=this.buffer,te=this.valueSize,ne=Z*te+te;let ie=this.cumulativeWeight;if(ie===0){for(let oe=0;oe!==te;++oe)K[ne+oe]=K[oe];ie=_}else{ie+=_;const oe=_/ie;this._mixBufferRegion(K,ne,0,oe,te)}this.cumulativeWeight=ie}accumulateAdditive(Z){const _=this.buffer,K=this.valueSize,te=K*this._addIndex;this.cumulativeWeightAdditive===0&&this._setIdentity(),this._mixBufferRegionAdditive(_,te,0,Z,K),this.cumulativeWeightAdditive+=Z}apply(Z){const _=this.valueSize,K=this.buffer,te=Z*_+_,ne=this.cumulativeWeight,ie=this.cumulativeWeightAdditive,oe=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,ne<1){const se=_*this._origIndex;this._mixBufferRegion(K,te,se,1-ne,_)}ie>0&&this._mixBufferRegionAdditive(K,te,this._addIndex*_,1,_);for(let se=_,ae=_+_;se!==ae;++se)if(K[se]!==K[se+_]){oe.setValue(K,te);break}}saveOriginalState(){const Z=this.binding,_=this.buffer,K=this.valueSize,te=K*this._origIndex;Z.getValue(_,te);for(let ne=K,ie=te;ne!==ie;++ne)_[ne]=_[te+ne%K];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){const Z=this.valueSize*3;this.binding.setValue(this.buffer,Z)}_setAdditiveIdentityNumeric(){const Z=this._addIndex*this.valueSize,_=Z+this.valueSize;for(let K=Z;K<_;K++)this.buffer[K]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){const Z=this._origIndex*this.valueSize,_=this._addIndex*this.valueSize;for(let K=0;K<this.valueSize;K++)this.buffer[_+K]=this.buffer[Z+K]}_select(Z,_,K,te,ne){if(te>=.5)for(let ie=0;ie!==ne;++ie)Z[_+ie]=Z[K+ie]}_slerp(Z,_,K,te){Quaternion$2.slerpFlat(Z,_,Z,_,Z,K,te)}_slerpAdditive(Z,_,K,te,ne){const ie=this._workIndex*ne;Quaternion$2.multiplyQuaternionsFlat(Z,ie,Z,_,Z,K),Quaternion$2.slerpFlat(Z,_,Z,_,Z,ie,te)}_lerp(Z,_,K,te,ne){const ie=1-te;for(let oe=0;oe!==ne;++oe){const se=_+oe;Z[se]=Z[se]*ie+Z[K+oe]*te}}_lerpAdditive(Z,_,K,te,ne){for(let ie=0;ie!==ne;++ie){const oe=_+ie;Z[oe]=Z[oe]+Z[K+ie]*te}}}const _RESERVED_CHARS_RE="\\[\\]\\.:\\/",_reservedRe=new RegExp("["+_RESERVED_CHARS_RE+"]","g"),_wordChar="[^"+_RESERVED_CHARS_RE+"]",_wordCharOrDot="[^"+_RESERVED_CHARS_RE.replace("\\.","")+"]",_directoryRe=/((?:WC+[\/:])*)/.source.replace("WC",_wordChar),_nodeRe=/(WCOD+)?/.source.replace("WCOD",_wordCharOrDot),_objectRe=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",_wordChar),_propertyRe=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",_wordChar),_trackRe=new RegExp("^"+_directoryRe+_nodeRe+_objectRe+_propertyRe+"$"),_supportedObjectNames=["material","materials","bones","map"];class Composite{constructor(Z,_,K){const te=K||PropertyBinding.parseTrackName(_);this._targetGroup=Z,this._bindings=Z.subscribe_(_,te)}getValue(Z,_){this.bind();const K=this._targetGroup.nCachedObjects_,te=this._bindings[K];te!==void 0&&te.getValue(Z,_)}setValue(Z,_){const K=this._bindings;for(let te=this._targetGroup.nCachedObjects_,ne=K.length;te!==ne;++te)K[te].setValue(Z,_)}bind(){const Z=this._bindings;for(let _=this._targetGroup.nCachedObjects_,K=Z.length;_!==K;++_)Z[_].bind()}unbind(){const Z=this._bindings;for(let _=this._targetGroup.nCachedObjects_,K=Z.length;_!==K;++_)Z[_].unbind()}}class PropertyBinding{constructor(Z,_,K){this.path=_,this.parsedPath=K||PropertyBinding.parseTrackName(_),this.node=PropertyBinding.findNode(Z,this.parsedPath.nodeName),this.rootNode=Z,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(Z,_,K){return Z&&Z.isAnimationObjectGroup?new PropertyBinding.Composite(Z,_,K):new PropertyBinding(Z,_,K)}static sanitizeNodeName(Z){return Z.replace(/\s/g,"_").replace(_reservedRe,"")}static parseTrackName(Z){const _=_trackRe.exec(Z);if(_===null)throw new Error("PropertyBinding: Cannot parse trackName: "+Z);const K={nodeName:_[2],objectName:_[3],objectIndex:_[4],propertyName:_[5],propertyIndex:_[6]},te=K.nodeName&&K.nodeName.lastIndexOf(".");if(te!==void 0&&te!==-1){const ne=K.nodeName.substring(te+1);_supportedObjectNames.indexOf(ne)!==-1&&(K.nodeName=K.nodeName.substring(0,te),K.objectName=ne)}if(K.propertyName===null||K.propertyName.length===0)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+Z);return K}static findNode(Z,_){if(_===void 0||_===""||_==="."||_===-1||_===Z.name||_===Z.uuid)return Z;if(Z.skeleton){const K=Z.skeleton.getBoneByName(_);if(K!==void 0)return K}if(Z.children){const K=function(ne){for(let ie=0;ie<ne.length;ie++){const oe=ne[ie];if(oe.name===_||oe.uuid===_)return oe;const se=K(oe.children);if(se)return se}return null},te=K(Z.children);if(te)return te}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(Z,_){Z[_]=this.targetObject[this.propertyName]}_getValue_array(Z,_){const K=this.resolvedProperty;for(let te=0,ne=K.length;te!==ne;++te)Z[_++]=K[te]}_getValue_arrayElement(Z,_){Z[_]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(Z,_){this.resolvedProperty.toArray(Z,_)}_setValue_direct(Z,_){this.targetObject[this.propertyName]=Z[_]}_setValue_direct_setNeedsUpdate(Z,_){this.targetObject[this.propertyName]=Z[_],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(Z,_){this.targetObject[this.propertyName]=Z[_],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(Z,_){const K=this.resolvedProperty;for(let te=0,ne=K.length;te!==ne;++te)K[te]=Z[_++]}_setValue_array_setNeedsUpdate(Z,_){const K=this.resolvedProperty;for(let te=0,ne=K.length;te!==ne;++te)K[te]=Z[_++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(Z,_){const K=this.resolvedProperty;for(let te=0,ne=K.length;te!==ne;++te)K[te]=Z[_++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(Z,_){this.resolvedProperty[this.propertyIndex]=Z[_]}_setValue_arrayElement_setNeedsUpdate(Z,_){this.resolvedProperty[this.propertyIndex]=Z[_],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(Z,_){this.resolvedProperty[this.propertyIndex]=Z[_],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(Z,_){this.resolvedProperty.fromArray(Z,_)}_setValue_fromArray_setNeedsUpdate(Z,_){this.resolvedProperty.fromArray(Z,_),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(Z,_){this.resolvedProperty.fromArray(Z,_),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(Z,_){this.bind(),this.getValue(Z,_)}_setValue_unbound(Z,_){this.bind(),this.setValue(Z,_)}bind(){let Z=this.node;const _=this.parsedPath,K=_.objectName,te=_.propertyName;let ne=_.propertyIndex;if(Z||(Z=PropertyBinding.findNode(this.rootNode,_.nodeName),this.node=Z),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!Z){console.warn("THREE.PropertyBinding: No target node found for track: "+this.path+".");return}if(K){let ae=_.objectIndex;switch(K){case"materials":if(!Z.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!Z.material.materials){console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);return}Z=Z.material.materials;break;case"bones":if(!Z.skeleton){console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);return}Z=Z.skeleton.bones;for(let ge=0;ge<Z.length;ge++)if(Z[ge].name===ae){ae=ge;break}break;case"map":if("map"in Z){Z=Z.map;break}if(!Z.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!Z.material.map){console.error("THREE.PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);return}Z=Z.material.map;break;default:if(Z[K]===void 0){console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);return}Z=Z[K]}if(ae!==void 0){if(Z[ae]===void 0){console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,Z);return}Z=Z[ae]}}const ie=Z[te];if(ie===void 0){const ae=_.nodeName;console.error("THREE.PropertyBinding: Trying to update property for track: "+ae+"."+te+" but it wasn't found.",Z);return}let oe=this.Versioning.None;this.targetObject=Z,Z.isMaterial===!0?oe=this.Versioning.NeedsUpdate:Z.isObject3D===!0&&(oe=this.Versioning.MatrixWorldNeedsUpdate);let se=this.BindingType.Direct;if(ne!==void 0){if(te==="morphTargetInfluences"){if(!Z.geometry){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);return}if(!Z.geometry.morphAttributes){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);return}Z.morphTargetDictionary[ne]!==void 0&&(ne=Z.morphTargetDictionary[ne])}se=this.BindingType.ArrayElement,this.resolvedProperty=ie,this.propertyIndex=ne}else ie.fromArray!==void 0&&ie.toArray!==void 0?(se=this.BindingType.HasFromToArray,this.resolvedProperty=ie):Array.isArray(ie)?(se=this.BindingType.EntireArray,this.resolvedProperty=ie):this.propertyName=te;this.getValue=this.GetterByBindingType[se],this.setValue=this.SetterByBindingTypeAndVersioning[se][oe]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}PropertyBinding.Composite=Composite;PropertyBinding.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3};PropertyBinding.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2};PropertyBinding.prototype.GetterByBindingType=[PropertyBinding.prototype._getValue_direct,PropertyBinding.prototype._getValue_array,PropertyBinding.prototype._getValue_arrayElement,PropertyBinding.prototype._getValue_toArray];PropertyBinding.prototype.SetterByBindingTypeAndVersioning=[[PropertyBinding.prototype._setValue_direct,PropertyBinding.prototype._setValue_direct_setNeedsUpdate,PropertyBinding.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[PropertyBinding.prototype._setValue_array,PropertyBinding.prototype._setValue_array_setNeedsUpdate,PropertyBinding.prototype._setValue_array_setMatrixWorldNeedsUpdate],[PropertyBinding.prototype._setValue_arrayElement,PropertyBinding.prototype._setValue_arrayElement_setNeedsUpdate,PropertyBinding.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[PropertyBinding.prototype._setValue_fromArray,PropertyBinding.prototype._setValue_fromArray_setNeedsUpdate,PropertyBinding.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];class AnimationObjectGroup{constructor(){this.isAnimationObjectGroup=!0,this.uuid=generateUUID$1(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;const Z={};this._indicesByUUID=Z;for(let K=0,te=arguments.length;K!==te;++K)Z[arguments[K].uuid]=K;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};const _=this;this.stats={objects:{get total(){return _._objects.length},get inUse(){return this.total-_.nCachedObjects_}},get bindingsPerObject(){return _._bindings.length}}}add(){const Z=this._objects,_=this._indicesByUUID,K=this._paths,te=this._parsedPaths,ne=this._bindings,ie=ne.length;let oe,se=Z.length,ae=this.nCachedObjects_;for(let ge=0,ce=arguments.length;ge!==ce;++ge){const de=arguments[ge],Ie=de.uuid;let fe=_[Ie];if(fe===void 0){fe=se++,_[Ie]=fe,Z.push(de);for(let be=0,Ae=ie;be!==Ae;++be)ne[be].push(new PropertyBinding(de,K[be],te[be]))}else if(fe<ae){oe=Z[fe];const be=--ae,Ae=Z[be];_[Ae.uuid]=fe,Z[fe]=Ae,_[Ie]=be,Z[be]=de;for(let ye=0,ve=ie;ye!==ve;++ye){const Be=ne[ye],Re=Be[be];let Ve=Be[fe];Be[fe]=Re,Ve===void 0&&(Ve=new PropertyBinding(de,K[ye],te[ye])),Be[be]=Ve}}else Z[fe]!==oe&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=ae}remove(){const Z=this._objects,_=this._indicesByUUID,K=this._bindings,te=K.length;let ne=this.nCachedObjects_;for(let ie=0,oe=arguments.length;ie!==oe;++ie){const se=arguments[ie],ae=se.uuid,ge=_[ae];if(ge!==void 0&&ge>=ne){const ce=ne++,de=Z[ce];_[de.uuid]=ge,Z[ge]=de,_[ae]=ce,Z[ce]=se;for(let Ie=0,fe=te;Ie!==fe;++Ie){const be=K[Ie],Ae=be[ce],ye=be[ge];be[ge]=Ae,be[ce]=ye}}}this.nCachedObjects_=ne}uncache(){const Z=this._objects,_=this._indicesByUUID,K=this._bindings,te=K.length;let ne=this.nCachedObjects_,ie=Z.length;for(let oe=0,se=arguments.length;oe!==se;++oe){const ae=arguments[oe],ge=ae.uuid,ce=_[ge];if(ce!==void 0)if(delete _[ge],ce<ne){const de=--ne,Ie=Z[de],fe=--ie,be=Z[fe];_[Ie.uuid]=ce,Z[ce]=Ie,_[be.uuid]=de,Z[de]=be,Z.pop();for(let Ae=0,ye=te;Ae!==ye;++Ae){const ve=K[Ae],Be=ve[de],Re=ve[fe];ve[ce]=Be,ve[de]=Re,ve.pop()}}else{const de=--ie,Ie=Z[de];de>0&&(_[Ie.uuid]=ce),Z[ce]=Ie,Z.pop();for(let fe=0,be=te;fe!==be;++fe){const Ae=K[fe];Ae[ce]=Ae[de],Ae.pop()}}}this.nCachedObjects_=ne}subscribe_(Z,_){const K=this._bindingsIndicesByPath;let te=K[Z];const ne=this._bindings;if(te!==void 0)return ne[te];const ie=this._paths,oe=this._parsedPaths,se=this._objects,ae=se.length,ge=this.nCachedObjects_,ce=new Array(ae);te=ne.length,K[Z]=te,ie.push(Z),oe.push(_),ne.push(ce);for(let de=ge,Ie=se.length;de!==Ie;++de){const fe=se[de];ce[de]=new PropertyBinding(fe,Z,_)}return ce}unsubscribe_(Z){const _=this._bindingsIndicesByPath,K=_[Z];if(K!==void 0){const te=this._paths,ne=this._parsedPaths,ie=this._bindings,oe=ie.length-1,se=ie[oe],ae=Z[oe];_[ae]=K,ie[K]=se,ie.pop(),ne[K]=ne[oe],ne.pop(),te[K]=te[oe],te.pop()}}}class AnimationAction{constructor(Z,_,K=null,te=_.blendMode){this._mixer=Z,this._clip=_,this._localRoot=K,this.blendMode=te;const ne=_.tracks,ie=ne.length,oe=new Array(ie),se={endingStart:ZeroCurvatureEnding,endingEnd:ZeroCurvatureEnding};for(let ae=0;ae!==ie;++ae){const ge=ne[ae].createInterpolant(null);oe[ae]=ge,ge.settings=se}this._interpolantSettings=se,this._interpolants=oe,this._propertyBindings=new Array(ie),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=LoopRepeat,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&this.timeScale!==0&&this._startTime===null&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(Z){return this._startTime=Z,this}setLoop(Z,_){return this.loop=Z,this.repetitions=_,this}setEffectiveWeight(Z){return this.weight=Z,this._effectiveWeight=this.enabled?Z:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(Z){return this._scheduleFading(Z,0,1)}fadeOut(Z){return this._scheduleFading(Z,1,0)}crossFadeFrom(Z,_,K){if(Z.fadeOut(_),this.fadeIn(_),K){const te=this._clip.duration,ne=Z._clip.duration,ie=ne/te,oe=te/ne;Z.warp(1,ie,_),this.warp(oe,1,_)}return this}crossFadeTo(Z,_,K){return Z.crossFadeFrom(this,_,K)}stopFading(){const Z=this._weightInterpolant;return Z!==null&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(Z)),this}setEffectiveTimeScale(Z){return this.timeScale=Z,this._effectiveTimeScale=this.paused?0:Z,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(Z){return this.timeScale=this._clip.duration/Z,this.stopWarping()}syncWith(Z){return this.time=Z.time,this.timeScale=Z.timeScale,this.stopWarping()}halt(Z){return this.warp(this._effectiveTimeScale,0,Z)}warp(Z,_,K){const te=this._mixer,ne=te.time,ie=this.timeScale;let oe=this._timeScaleInterpolant;oe===null&&(oe=te._lendControlInterpolant(),this._timeScaleInterpolant=oe);const se=oe.parameterPositions,ae=oe.sampleValues;return se[0]=ne,se[1]=ne+K,ae[0]=Z/ie,ae[1]=_/ie,this}stopWarping(){const Z=this._timeScaleInterpolant;return Z!==null&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(Z)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(Z,_,K,te){if(!this.enabled){this._updateWeight(Z);return}const ne=this._startTime;if(ne!==null){const se=(Z-ne)*K;se<0||K===0?_=0:(this._startTime=null,_=K*se)}_*=this._updateTimeScale(Z);const ie=this._updateTime(_),oe=this._updateWeight(Z);if(oe>0){const se=this._interpolants,ae=this._propertyBindings;switch(this.blendMode){case AdditiveAnimationBlendMode:for(let ge=0,ce=se.length;ge!==ce;++ge)se[ge].evaluate(ie),ae[ge].accumulateAdditive(oe);break;case NormalAnimationBlendMode:default:for(let ge=0,ce=se.length;ge!==ce;++ge)se[ge].evaluate(ie),ae[ge].accumulate(te,oe)}}}_updateWeight(Z){let _=0;if(this.enabled){_=this.weight;const K=this._weightInterpolant;if(K!==null){const te=K.evaluate(Z)[0];_*=te,Z>K.parameterPositions[1]&&(this.stopFading(),te===0&&(this.enabled=!1))}}return this._effectiveWeight=_,_}_updateTimeScale(Z){let _=0;if(!this.paused){_=this.timeScale;const K=this._timeScaleInterpolant;if(K!==null){const te=K.evaluate(Z)[0];_*=te,Z>K.parameterPositions[1]&&(this.stopWarping(),_===0?this.paused=!0:this.timeScale=_)}}return this._effectiveTimeScale=_,_}_updateTime(Z){const _=this._clip.duration,K=this.loop;let te=this.time+Z,ne=this._loopCount;const ie=K===LoopPingPong;if(Z===0)return ne===-1?te:ie&&(ne&1)===1?_-te:te;if(K===LoopOnce){ne===-1&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(te>=_)te=_;else if(te<0)te=0;else{this.time=te;break e}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=te,this._mixer.dispatchEvent({type:"finished",action:this,direction:Z<0?-1:1})}}else{if(ne===-1&&(Z>=0?(ne=0,this._setEndings(!0,this.repetitions===0,ie)):this._setEndings(this.repetitions===0,!0,ie)),te>=_||te<0){const oe=Math.floor(te/_);te-=_*oe,ne+=Math.abs(oe);const se=this.repetitions-ne;if(se<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,te=Z>0?_:0,this.time=te,this._mixer.dispatchEvent({type:"finished",action:this,direction:Z>0?1:-1});else{if(se===1){const ae=Z<0;this._setEndings(ae,!ae,ie)}else this._setEndings(!1,!1,ie);this._loopCount=ne,this.time=te,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:oe})}}else this.time=te;if(ie&&(ne&1)===1)return _-te}return te}_setEndings(Z,_,K){const te=this._interpolantSettings;K?(te.endingStart=ZeroSlopeEnding,te.endingEnd=ZeroSlopeEnding):(Z?te.endingStart=this.zeroSlopeAtStart?ZeroSlopeEnding:ZeroCurvatureEnding:te.endingStart=WrapAroundEnding,_?te.endingEnd=this.zeroSlopeAtEnd?ZeroSlopeEnding:ZeroCurvatureEnding:te.endingEnd=WrapAroundEnding)}_scheduleFading(Z,_,K){const te=this._mixer,ne=te.time;let ie=this._weightInterpolant;ie===null&&(ie=te._lendControlInterpolant(),this._weightInterpolant=ie);const oe=ie.parameterPositions,se=ie.sampleValues;return oe[0]=ne,se[0]=_,oe[1]=ne+Z,se[1]=K,this}}const _controlInterpolantsResultBuffer=new Float32Array(1);class AnimationMixer extends EventDispatcher{constructor(Z){super(),this._root=Z,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(Z,_){const K=Z._localRoot||this._root,te=Z._clip.tracks,ne=te.length,ie=Z._propertyBindings,oe=Z._interpolants,se=K.uuid,ae=this._bindingsByRootAndName;let ge=ae[se];ge===void 0&&(ge={},ae[se]=ge);for(let ce=0;ce!==ne;++ce){const de=te[ce],Ie=de.name;let fe=ge[Ie];if(fe!==void 0)++fe.referenceCount,ie[ce]=fe;else{if(fe=ie[ce],fe!==void 0){fe._cacheIndex===null&&(++fe.referenceCount,this._addInactiveBinding(fe,se,Ie));continue}const be=_&&_._propertyBindings[ce].binding.parsedPath;fe=new PropertyMixer(PropertyBinding.create(K,Ie,be),de.ValueTypeName,de.getValueSize()),++fe.referenceCount,this._addInactiveBinding(fe,se,Ie),ie[ce]=fe}oe[ce].resultBuffer=fe.buffer}}_activateAction(Z){if(!this._isActiveAction(Z)){if(Z._cacheIndex===null){const K=(Z._localRoot||this._root).uuid,te=Z._clip.uuid,ne=this._actionsByClip[te];this._bindAction(Z,ne&&ne.knownActions[0]),this._addInactiveAction(Z,te,K)}const _=Z._propertyBindings;for(let K=0,te=_.length;K!==te;++K){const ne=_[K];ne.useCount++===0&&(this._lendBinding(ne),ne.saveOriginalState())}this._lendAction(Z)}}_deactivateAction(Z){if(this._isActiveAction(Z)){const _=Z._propertyBindings;for(let K=0,te=_.length;K!==te;++K){const ne=_[K];--ne.useCount===0&&(ne.restoreOriginalState(),this._takeBackBinding(ne))}this._takeBackAction(Z)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;const Z=this;this.stats={actions:{get total(){return Z._actions.length},get inUse(){return Z._nActiveActions}},bindings:{get total(){return Z._bindings.length},get inUse(){return Z._nActiveBindings}},controlInterpolants:{get total(){return Z._controlInterpolants.length},get inUse(){return Z._nActiveControlInterpolants}}}}_isActiveAction(Z){const _=Z._cacheIndex;return _!==null&&_<this._nActiveActions}_addInactiveAction(Z,_,K){const te=this._actions,ne=this._actionsByClip;let ie=ne[_];if(ie===void 0)ie={knownActions:[Z],actionByRoot:{}},Z._byClipCacheIndex=0,ne[_]=ie;else{const oe=ie.knownActions;Z._byClipCacheIndex=oe.length,oe.push(Z)}Z._cacheIndex=te.length,te.push(Z),ie.actionByRoot[K]=Z}_removeInactiveAction(Z){const _=this._actions,K=_[_.length-1],te=Z._cacheIndex;K._cacheIndex=te,_[te]=K,_.pop(),Z._cacheIndex=null;const ne=Z._clip.uuid,ie=this._actionsByClip,oe=ie[ne],se=oe.knownActions,ae=se[se.length-1],ge=Z._byClipCacheIndex;ae._byClipCacheIndex=ge,se[ge]=ae,se.pop(),Z._byClipCacheIndex=null;const ce=oe.actionByRoot,de=(Z._localRoot||this._root).uuid;delete ce[de],se.length===0&&delete ie[ne],this._removeInactiveBindingsForAction(Z)}_removeInactiveBindingsForAction(Z){const _=Z._propertyBindings;for(let K=0,te=_.length;K!==te;++K){const ne=_[K];--ne.referenceCount===0&&this._removeInactiveBinding(ne)}}_lendAction(Z){const _=this._actions,K=Z._cacheIndex,te=this._nActiveActions++,ne=_[te];Z._cacheIndex=te,_[te]=Z,ne._cacheIndex=K,_[K]=ne}_takeBackAction(Z){const _=this._actions,K=Z._cacheIndex,te=--this._nActiveActions,ne=_[te];Z._cacheIndex=te,_[te]=Z,ne._cacheIndex=K,_[K]=ne}_addInactiveBinding(Z,_,K){const te=this._bindingsByRootAndName,ne=this._bindings;let ie=te[_];ie===void 0&&(ie={},te[_]=ie),ie[K]=Z,Z._cacheIndex=ne.length,ne.push(Z)}_removeInactiveBinding(Z){const _=this._bindings,K=Z.binding,te=K.rootNode.uuid,ne=K.path,ie=this._bindingsByRootAndName,oe=ie[te],se=_[_.length-1],ae=Z._cacheIndex;se._cacheIndex=ae,_[ae]=se,_.pop(),delete oe[ne],Object.keys(oe).length===0&&delete ie[te]}_lendBinding(Z){const _=this._bindings,K=Z._cacheIndex,te=this._nActiveBindings++,ne=_[te];Z._cacheIndex=te,_[te]=Z,ne._cacheIndex=K,_[K]=ne}_takeBackBinding(Z){const _=this._bindings,K=Z._cacheIndex,te=--this._nActiveBindings,ne=_[te];Z._cacheIndex=te,_[te]=Z,ne._cacheIndex=K,_[K]=ne}_lendControlInterpolant(){const Z=this._controlInterpolants,_=this._nActiveControlInterpolants++;let K=Z[_];return K===void 0&&(K=new LinearInterpolant(new Float32Array(2),new Float32Array(2),1,_controlInterpolantsResultBuffer),K.__cacheIndex=_,Z[_]=K),K}_takeBackControlInterpolant(Z){const _=this._controlInterpolants,K=Z.__cacheIndex,te=--this._nActiveControlInterpolants,ne=_[te];Z.__cacheIndex=te,_[te]=Z,ne.__cacheIndex=K,_[K]=ne}clipAction(Z,_,K){const te=_||this._root,ne=te.uuid;let ie=typeof Z=="string"?AnimationClip.findByName(te,Z):Z;const oe=ie!==null?ie.uuid:Z,se=this._actionsByClip[oe];let ae=null;if(K===void 0&&(ie!==null?K=ie.blendMode:K=NormalAnimationBlendMode),se!==void 0){const ce=se.actionByRoot[ne];if(ce!==void 0&&ce.blendMode===K)return ce;ae=se.knownActions[0],ie===null&&(ie=ae._clip)}if(ie===null)return null;const ge=new AnimationAction(this,ie,_,K);return this._bindAction(ge,ae),this._addInactiveAction(ge,oe,ne),ge}existingAction(Z,_){const K=_||this._root,te=K.uuid,ne=typeof Z=="string"?AnimationClip.findByName(K,Z):Z,ie=ne?ne.uuid:Z,oe=this._actionsByClip[ie];return oe!==void 0&&oe.actionByRoot[te]||null}stopAllAction(){const Z=this._actions,_=this._nActiveActions;for(let K=_-1;K>=0;--K)Z[K].stop();return this}update(Z){Z*=this.timeScale;const _=this._actions,K=this._nActiveActions,te=this.time+=Z,ne=Math.sign(Z),ie=this._accuIndex^=1;for(let ae=0;ae!==K;++ae)_[ae]._update(te,Z,ne,ie);const oe=this._bindings,se=this._nActiveBindings;for(let ae=0;ae!==se;++ae)oe[ae].apply(ie);return this}setTime(Z){this.time=0;for(let _=0;_<this._actions.length;_++)this._actions[_].time=0;return this.update(Z)}getRoot(){return this._root}uncacheClip(Z){const _=this._actions,K=Z.uuid,te=this._actionsByClip,ne=te[K];if(ne!==void 0){const ie=ne.knownActions;for(let oe=0,se=ie.length;oe!==se;++oe){const ae=ie[oe];this._deactivateAction(ae);const ge=ae._cacheIndex,ce=_[_.length-1];ae._cacheIndex=null,ae._byClipCacheIndex=null,ce._cacheIndex=ge,_[ge]=ce,_.pop(),this._removeInactiveBindingsForAction(ae)}delete te[K]}}uncacheRoot(Z){const _=Z.uuid,K=this._actionsByClip;for(const ie in K){const oe=K[ie].actionByRoot,se=oe[_];se!==void 0&&(this._deactivateAction(se),this._removeInactiveAction(se))}const te=this._bindingsByRootAndName,ne=te[_];if(ne!==void 0)for(const ie in ne){const oe=ne[ie];oe.restoreOriginalState(),this._removeInactiveBinding(oe)}}uncacheAction(Z,_){const K=this.existingAction(Z,_);K!==null&&(this._deactivateAction(K),this._removeInactiveAction(K))}}class RenderTarget3D extends RenderTarget{constructor(Z=1,_=1,K=1,te={}){super(Z,_,te),this.isRenderTarget3D=!0,this.depth=K,this.texture=new Data3DTexture(null,Z,_,K),this.texture.isRenderTargetTexture=!0}}class RenderTargetArray extends RenderTarget{constructor(Z=1,_=1,K=1,te={}){super(Z,_,te),this.isRenderTargetArray=!0,this.depth=K,this.texture=new DataArrayTexture(null,Z,_,K),this.texture.isRenderTargetTexture=!0}}class Uniform{constructor(Z){this.value=Z}clone(){return new Uniform(this.value.clone===void 0?this.value:this.value.clone())}}let _id$2=0;class UniformsGroup extends EventDispatcher{constructor(){super(),this.isUniformsGroup=!0,Object.defineProperty(this,"id",{value:_id$2++}),this.name="",this.usage=StaticDrawUsage,this.uniforms=[]}add(Z){return this.uniforms.push(Z),this}remove(Z){const _=this.uniforms.indexOf(Z);return _!==-1&&this.uniforms.splice(_,1),this}setName(Z){return this.name=Z,this}setUsage(Z){return this.usage=Z,this}dispose(){return this.dispatchEvent({type:"dispose"}),this}copy(Z){this.name=Z.name,this.usage=Z.usage;const _=Z.uniforms;this.uniforms.length=0;for(let K=0,te=_.length;K<te;K++){const ne=Array.isArray(_[K])?_[K]:[_[K]];for(let ie=0;ie<ne.length;ie++)this.uniforms.push(ne[ie].clone())}return this}clone(){return new this.constructor().copy(this)}}class InstancedInterleavedBuffer extends InterleavedBuffer{constructor(Z,_,K=1){super(Z,_),this.isInstancedInterleavedBuffer=!0,this.meshPerAttribute=K}copy(Z){return super.copy(Z),this.meshPerAttribute=Z.meshPerAttribute,this}clone(Z){const _=super.clone(Z);return _.meshPerAttribute=this.meshPerAttribute,_}toJSON(Z){const _=super.toJSON(Z);return _.isInstancedInterleavedBuffer=!0,_.meshPerAttribute=this.meshPerAttribute,_}}class GLBufferAttribute{constructor(Z,_,K,te,ne){this.isGLBufferAttribute=!0,this.name="",this.buffer=Z,this.type=_,this.itemSize=K,this.elementSize=te,this.count=ne,this.version=0}set needsUpdate(Z){Z===!0&&this.version++}setBuffer(Z){return this.buffer=Z,this}setType(Z,_){return this.type=Z,this.elementSize=_,this}setItemSize(Z){return this.itemSize=Z,this}setCount(Z){return this.count=Z,this}}const _matrix=new Matrix4;class Raycaster{constructor(Z,_,K=0,te=1/0){this.ray=new Ray$2(Z,_),this.near=K,this.far=te,this.camera=null,this.layers=new Layers,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(Z,_){this.ray.set(Z,_)}setFromCamera(Z,_){_.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(_.matrixWorld),this.ray.direction.set(Z.x,Z.y,.5).unproject(_).sub(this.ray.origin).normalize(),this.camera=_):_.isOrthographicCamera?(this.ray.origin.set(Z.x,Z.y,(_.near+_.far)/(_.near-_.far)).unproject(_),this.ray.direction.set(0,0,-1).transformDirection(_.matrixWorld),this.camera=_):console.error("THREE.Raycaster: Unsupported camera type: "+_.type)}setFromXRController(Z){return _matrix.identity().extractRotation(Z.matrixWorld),this.ray.origin.setFromMatrixPosition(Z.matrixWorld),this.ray.direction.set(0,0,-1).applyMatrix4(_matrix),this}intersectObject(Z,_=!0,K=[]){return intersect$2(Z,this,K,_),K.sort(ascSort),K}intersectObjects(Z,_=!0,K=[]){for(let te=0,ne=Z.length;te<ne;te++)intersect$2(Z[te],this,K,_);return K.sort(ascSort),K}}function ascSort(X,Z){return X.distance-Z.distance}function intersect$2(X,Z,_,K){let te=!0;if(X.layers.test(Z.layers)&&X.raycast(Z,_)===!1&&(te=!1),te===!0&&K===!0){const ne=X.children;for(let ie=0,oe=ne.length;ie<oe;ie++)intersect$2(ne[ie],Z,_,!0)}}class Spherical{constructor(Z=1,_=0,K=0){return this.radius=Z,this.phi=_,this.theta=K,this}set(Z,_,K){return this.radius=Z,this.phi=_,this.theta=K,this}copy(Z){return this.radius=Z.radius,this.phi=Z.phi,this.theta=Z.theta,this}makeSafe(){return this.phi=clamp$3(this.phi,1e-6,Math.PI-1e-6),this}setFromVector3(Z){return this.setFromCartesianCoords(Z.x,Z.y,Z.z)}setFromCartesianCoords(Z,_,K){return this.radius=Math.sqrt(Z*Z+_*_+K*K),this.radius===0?(this.theta=0,this.phi=0):(this.theta=Math.atan2(Z,K),this.phi=Math.acos(clamp$3(_/this.radius,-1,1))),this}clone(){return new this.constructor().copy(this)}}class Cylindrical{constructor(Z=1,_=0,K=0){return this.radius=Z,this.theta=_,this.y=K,this}set(Z,_,K){return this.radius=Z,this.theta=_,this.y=K,this}copy(Z){return this.radius=Z.radius,this.theta=Z.theta,this.y=Z.y,this}setFromVector3(Z){return this.setFromCartesianCoords(Z.x,Z.y,Z.z)}setFromCartesianCoords(Z,_,K){return this.radius=Math.sqrt(Z*Z+K*K),this.theta=Math.atan2(Z,K),this.y=_,this}clone(){return new this.constructor().copy(this)}}class Matrix2{constructor(Z,_,K,te){Matrix2.prototype.isMatrix2=!0,this.elements=[1,0,0,1],Z!==void 0&&this.set(Z,_,K,te)}identity(){return this.set(1,0,0,1),this}fromArray(Z,_=0){for(let K=0;K<4;K++)this.elements[K]=Z[K+_];return this}set(Z,_,K,te){const ne=this.elements;return ne[0]=Z,ne[2]=_,ne[1]=K,ne[3]=te,this}}const _vector$4=new Vector2;class Box2{constructor(Z=new Vector2(1/0,1/0),_=new Vector2(-1/0,-1/0)){this.isBox2=!0,this.min=Z,this.max=_}set(Z,_){return this.min.copy(Z),this.max.copy(_),this}setFromPoints(Z){this.makeEmpty();for(let _=0,K=Z.length;_<K;_++)this.expandByPoint(Z[_]);return this}setFromCenterAndSize(Z,_){const K=_vector$4.copy(_).multiplyScalar(.5);return this.min.copy(Z).sub(K),this.max.copy(Z).add(K),this}clone(){return new this.constructor().copy(this)}copy(Z){return this.min.copy(Z.min),this.max.copy(Z.max),this}makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(Z){return this.isEmpty()?Z.set(0,0):Z.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(Z){return this.isEmpty()?Z.set(0,0):Z.subVectors(this.max,this.min)}expandByPoint(Z){return this.min.min(Z),this.max.max(Z),this}expandByVector(Z){return this.min.sub(Z),this.max.add(Z),this}expandByScalar(Z){return this.min.addScalar(-Z),this.max.addScalar(Z),this}containsPoint(Z){return Z.x>=this.min.x&&Z.x<=this.max.x&&Z.y>=this.min.y&&Z.y<=this.max.y}containsBox(Z){return this.min.x<=Z.min.x&&Z.max.x<=this.max.x&&this.min.y<=Z.min.y&&Z.max.y<=this.max.y}getParameter(Z,_){return _.set((Z.x-this.min.x)/(this.max.x-this.min.x),(Z.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(Z){return Z.max.x>=this.min.x&&Z.min.x<=this.max.x&&Z.max.y>=this.min.y&&Z.min.y<=this.max.y}clampPoint(Z,_){return _.copy(Z).clamp(this.min,this.max)}distanceToPoint(Z){return this.clampPoint(Z,_vector$4).distanceTo(Z)}intersect(Z){return this.min.max(Z.min),this.max.min(Z.max),this.isEmpty()&&this.makeEmpty(),this}union(Z){return this.min.min(Z.min),this.max.max(Z.max),this}translate(Z){return this.min.add(Z),this.max.add(Z),this}equals(Z){return Z.min.equals(this.min)&&Z.max.equals(this.max)}}const _startP=new Vector3,_startEnd=new Vector3;class Line3{constructor(Z=new Vector3,_=new Vector3){this.start=Z,this.end=_}set(Z,_){return this.start.copy(Z),this.end.copy(_),this}copy(Z){return this.start.copy(Z.start),this.end.copy(Z.end),this}getCenter(Z){return Z.addVectors(this.start,this.end).multiplyScalar(.5)}delta(Z){return Z.subVectors(this.end,this.start)}distanceSq(){return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(Z,_){return this.delta(_).multiplyScalar(Z).add(this.start)}closestPointToPointParameter(Z,_){_startP.subVectors(Z,this.start),_startEnd.subVectors(this.end,this.start);const K=_startEnd.dot(_startEnd);let ne=_startEnd.dot(_startP)/K;return _&&(ne=clamp$3(ne,0,1)),ne}closestPointToPoint(Z,_,K){const te=this.closestPointToPointParameter(Z,_);return this.delta(K).multiplyScalar(te).add(this.start)}applyMatrix4(Z){return this.start.applyMatrix4(Z),this.end.applyMatrix4(Z),this}equals(Z){return Z.start.equals(this.start)&&Z.end.equals(this.end)}clone(){return new this.constructor().copy(this)}}const _vector$3=new Vector3;class SpotLightHelper extends Object3D{constructor(Z,_){super(),this.light=Z,this.matrixAutoUpdate=!1,this.color=_,this.type="SpotLightHelper";const K=new BufferGeometry,te=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(let ie=0,oe=1,se=32;ie<se;ie++,oe++){const ae=ie/se*Math.PI*2,ge=oe/se*Math.PI*2;te.push(Math.cos(ae),Math.sin(ae),1,Math.cos(ge),Math.sin(ge),1)}K.setAttribute("position",new Float32BufferAttribute(te,3));const ne=new LineBasicMaterial({fog:!1,toneMapped:!1});this.cone=new LineSegments(K,ne),this.add(this.cone),this.update()}dispose(){this.cone.geometry.dispose(),this.cone.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1),this.parent?(this.parent.updateWorldMatrix(!0),this.matrix.copy(this.parent.matrixWorld).invert().multiply(this.light.matrixWorld)):this.matrix.copy(this.light.matrixWorld),this.matrixWorld.copy(this.light.matrixWorld);const Z=this.light.distance?this.light.distance:1e3,_=Z*Math.tan(this.light.angle);this.cone.scale.set(_,_,Z),_vector$3.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(_vector$3),this.color!==void 0?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}}const _vector$2=new Vector3,_boneMatrix=new Matrix4,_matrixWorldInv=new Matrix4;class SkeletonHelper extends LineSegments{constructor(Z){const _=getBoneList(Z),K=new BufferGeometry,te=[],ne=[],ie=new Color$1(0,0,1),oe=new Color$1(0,1,0);for(let ae=0;ae<_.length;ae++){const ge=_[ae];ge.parent&&ge.parent.isBone&&(te.push(0,0,0),te.push(0,0,0),ne.push(ie.r,ie.g,ie.b),ne.push(oe.r,oe.g,oe.b))}K.setAttribute("position",new Float32BufferAttribute(te,3)),K.setAttribute("color",new Float32BufferAttribute(ne,3));const se=new LineBasicMaterial({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0});super(K,se),this.isSkeletonHelper=!0,this.type="SkeletonHelper",this.root=Z,this.bones=_,this.matrix=Z.matrixWorld,this.matrixAutoUpdate=!1}updateMatrixWorld(Z){const _=this.bones,K=this.geometry,te=K.getAttribute("position");_matrixWorldInv.copy(this.root.matrixWorld).invert();for(let ne=0,ie=0;ne<_.length;ne++){const oe=_[ne];oe.parent&&oe.parent.isBone&&(_boneMatrix.multiplyMatrices(_matrixWorldInv,oe.matrixWorld),_vector$2.setFromMatrixPosition(_boneMatrix),te.setXYZ(ie,_vector$2.x,_vector$2.y,_vector$2.z),_boneMatrix.multiplyMatrices(_matrixWorldInv,oe.parent.matrixWorld),_vector$2.setFromMatrixPosition(_boneMatrix),te.setXYZ(ie+1,_vector$2.x,_vector$2.y,_vector$2.z),ie+=2)}K.getAttribute("position").needsUpdate=!0,super.updateMatrixWorld(Z)}dispose(){this.geometry.dispose(),this.material.dispose()}}function getBoneList(X){const Z=[];X.isBone===!0&&Z.push(X);for(let _=0;_<X.children.length;_++)Z.push.apply(Z,getBoneList(X.children[_]));return Z}class PointLightHelper extends Mesh{constructor(Z,_,K){const te=new SphereGeometry(_,4,2),ne=new MeshBasicMaterial({wireframe:!0,fog:!1,toneMapped:!1});super(te,ne),this.light=Z,this.color=K,this.type="PointLightHelper",this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}dispose(){this.geometry.dispose(),this.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.color!==void 0?this.material.color.set(this.color):this.material.color.copy(this.light.color)}}const _vector$1=new Vector3,_color1=new Color$1,_color2=new Color$1;class HemisphereLightHelper extends Object3D{constructor(Z,_,K){super(),this.light=Z,this.matrix=Z.matrixWorld,this.matrixAutoUpdate=!1,this.color=K,this.type="HemisphereLightHelper";const te=new OctahedronGeometry(_);te.rotateY(Math.PI*.5),this.material=new MeshBasicMaterial({wireframe:!0,fog:!1,toneMapped:!1}),this.color===void 0&&(this.material.vertexColors=!0);const ne=te.getAttribute("position"),ie=new Float32Array(ne.count*3);te.setAttribute("color",new BufferAttribute(ie,3)),this.add(new Mesh(te,this.material)),this.update()}dispose(){this.children[0].geometry.dispose(),this.children[0].material.dispose()}update(){const Z=this.children[0];if(this.color!==void 0)this.material.color.set(this.color);else{const _=Z.geometry.getAttribute("color");_color1.copy(this.light.color),_color2.copy(this.light.groundColor);for(let K=0,te=_.count;K<te;K++){const ne=K<te/2?_color1:_color2;_.setXYZ(K,ne.r,ne.g,ne.b)}_.needsUpdate=!0}this.light.updateWorldMatrix(!0,!1),Z.lookAt(_vector$1.setFromMatrixPosition(this.light.matrixWorld).negate())}}class GridHelper extends LineSegments{constructor(Z=10,_=10,K=4473924,te=8947848){K=new Color$1(K),te=new Color$1(te);const ne=_/2,ie=Z/_,oe=Z/2,se=[],ae=[];for(let de=0,Ie=0,fe=-oe;de<=_;de++,fe+=ie){se.push(-oe,0,fe,oe,0,fe),se.push(fe,0,-oe,fe,0,oe);const be=de===ne?K:te;be.toArray(ae,Ie),Ie+=3,be.toArray(ae,Ie),Ie+=3,be.toArray(ae,Ie),Ie+=3,be.toArray(ae,Ie),Ie+=3}const ge=new BufferGeometry;ge.setAttribute("position",new Float32BufferAttribute(se,3)),ge.setAttribute("color",new Float32BufferAttribute(ae,3));const ce=new LineBasicMaterial({vertexColors:!0,toneMapped:!1});super(ge,ce),this.type="GridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}}class PolarGridHelper extends LineSegments{constructor(Z=10,_=16,K=8,te=64,ne=4473924,ie=8947848){ne=new Color$1(ne),ie=new Color$1(ie);const oe=[],se=[];if(_>1)for(let ce=0;ce<_;ce++){const de=ce/_*(Math.PI*2),Ie=Math.sin(de)*Z,fe=Math.cos(de)*Z;oe.push(0,0,0),oe.push(Ie,0,fe);const be=ce&1?ne:ie;se.push(be.r,be.g,be.b),se.push(be.r,be.g,be.b)}for(let ce=0;ce<K;ce++){const de=ce&1?ne:ie,Ie=Z-Z/K*ce;for(let fe=0;fe<te;fe++){let be=fe/te*(Math.PI*2),Ae=Math.sin(be)*Ie,ye=Math.cos(be)*Ie;oe.push(Ae,0,ye),se.push(de.r,de.g,de.b),be=(fe+1)/te*(Math.PI*2),Ae=Math.sin(be)*Ie,ye=Math.cos(be)*Ie,oe.push(Ae,0,ye),se.push(de.r,de.g,de.b)}}const ae=new BufferGeometry;ae.setAttribute("position",new Float32BufferAttribute(oe,3)),ae.setAttribute("color",new Float32BufferAttribute(se,3));const ge=new LineBasicMaterial({vertexColors:!0,toneMapped:!1});super(ae,ge),this.type="PolarGridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}}const _v1=new Vector3,_v2=new Vector3,_v3=new Vector3;class DirectionalLightHelper extends Object3D{constructor(Z,_,K){super(),this.light=Z,this.matrix=Z.matrixWorld,this.matrixAutoUpdate=!1,this.color=K,this.type="DirectionalLightHelper",_===void 0&&(_=1);let te=new BufferGeometry;te.setAttribute("position",new Float32BufferAttribute([-_,_,0,_,_,0,_,-_,0,-_,-_,0,-_,_,0],3));const ne=new LineBasicMaterial({fog:!1,toneMapped:!1});this.lightPlane=new Line(te,ne),this.add(this.lightPlane),te=new BufferGeometry,te.setAttribute("position",new Float32BufferAttribute([0,0,0,0,0,1],3)),this.targetLine=new Line(te,ne),this.add(this.targetLine),this.update()}dispose(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1),_v1.setFromMatrixPosition(this.light.matrixWorld),_v2.setFromMatrixPosition(this.light.target.matrixWorld),_v3.subVectors(_v2,_v1),this.lightPlane.lookAt(_v2),this.color!==void 0?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(_v2),this.targetLine.scale.z=_v3.length()}}const _vector=new Vector3,_camera=new Camera;class CameraHelper extends LineSegments{constructor(Z){const _=new BufferGeometry,K=new LineBasicMaterial({color:16777215,vertexColors:!0,toneMapped:!1}),te=[],ne=[],ie={};oe("n1","n2"),oe("n2","n4"),oe("n4","n3"),oe("n3","n1"),oe("f1","f2"),oe("f2","f4"),oe("f4","f3"),oe("f3","f1"),oe("n1","f1"),oe("n2","f2"),oe("n3","f3"),oe("n4","f4"),oe("p","n1"),oe("p","n2"),oe("p","n3"),oe("p","n4"),oe("u1","u2"),oe("u2","u3"),oe("u3","u1"),oe("c","t"),oe("p","c"),oe("cn1","cn2"),oe("cn3","cn4"),oe("cf1","cf2"),oe("cf3","cf4");function oe(fe,be){se(fe),se(be)}function se(fe){te.push(0,0,0),ne.push(0,0,0),ie[fe]===void 0&&(ie[fe]=[]),ie[fe].push(te.length/3-1)}_.setAttribute("position",new Float32BufferAttribute(te,3)),_.setAttribute("color",new Float32BufferAttribute(ne,3)),super(_,K),this.type="CameraHelper",this.camera=Z,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=Z.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=ie,this.update();const ae=new Color$1(16755200),ge=new Color$1(16711680),ce=new Color$1(43775),de=new Color$1(16777215),Ie=new Color$1(3355443);this.setColors(ae,ge,ce,de,Ie)}setColors(Z,_,K,te,ne){const oe=this.geometry.getAttribute("color");oe.setXYZ(0,Z.r,Z.g,Z.b),oe.setXYZ(1,Z.r,Z.g,Z.b),oe.setXYZ(2,Z.r,Z.g,Z.b),oe.setXYZ(3,Z.r,Z.g,Z.b),oe.setXYZ(4,Z.r,Z.g,Z.b),oe.setXYZ(5,Z.r,Z.g,Z.b),oe.setXYZ(6,Z.r,Z.g,Z.b),oe.setXYZ(7,Z.r,Z.g,Z.b),oe.setXYZ(8,Z.r,Z.g,Z.b),oe.setXYZ(9,Z.r,Z.g,Z.b),oe.setXYZ(10,Z.r,Z.g,Z.b),oe.setXYZ(11,Z.r,Z.g,Z.b),oe.setXYZ(12,Z.r,Z.g,Z.b),oe.setXYZ(13,Z.r,Z.g,Z.b),oe.setXYZ(14,Z.r,Z.g,Z.b),oe.setXYZ(15,Z.r,Z.g,Z.b),oe.setXYZ(16,Z.r,Z.g,Z.b),oe.setXYZ(17,Z.r,Z.g,Z.b),oe.setXYZ(18,Z.r,Z.g,Z.b),oe.setXYZ(19,Z.r,Z.g,Z.b),oe.setXYZ(20,Z.r,Z.g,Z.b),oe.setXYZ(21,Z.r,Z.g,Z.b),oe.setXYZ(22,Z.r,Z.g,Z.b),oe.setXYZ(23,Z.r,Z.g,Z.b),oe.setXYZ(24,_.r,_.g,_.b),oe.setXYZ(25,_.r,_.g,_.b),oe.setXYZ(26,_.r,_.g,_.b),oe.setXYZ(27,_.r,_.g,_.b),oe.setXYZ(28,_.r,_.g,_.b),oe.setXYZ(29,_.r,_.g,_.b),oe.setXYZ(30,_.r,_.g,_.b),oe.setXYZ(31,_.r,_.g,_.b),oe.setXYZ(32,K.r,K.g,K.b),oe.setXYZ(33,K.r,K.g,K.b),oe.setXYZ(34,K.r,K.g,K.b),oe.setXYZ(35,K.r,K.g,K.b),oe.setXYZ(36,K.r,K.g,K.b),oe.setXYZ(37,K.r,K.g,K.b),oe.setXYZ(38,te.r,te.g,te.b),oe.setXYZ(39,te.r,te.g,te.b),oe.setXYZ(40,ne.r,ne.g,ne.b),oe.setXYZ(41,ne.r,ne.g,ne.b),oe.setXYZ(42,ne.r,ne.g,ne.b),oe.setXYZ(43,ne.r,ne.g,ne.b),oe.setXYZ(44,ne.r,ne.g,ne.b),oe.setXYZ(45,ne.r,ne.g,ne.b),oe.setXYZ(46,ne.r,ne.g,ne.b),oe.setXYZ(47,ne.r,ne.g,ne.b),oe.setXYZ(48,ne.r,ne.g,ne.b),oe.setXYZ(49,ne.r,ne.g,ne.b),oe.needsUpdate=!0}update(){const Z=this.geometry,_=this.pointMap,K=1,te=1;_camera.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse);const ne=this.camera.coordinateSystem===WebGLCoordinateSystem?-1:0;setPoint("c",_,Z,_camera,0,0,ne),setPoint("t",_,Z,_camera,0,0,1),setPoint("n1",_,Z,_camera,-1,-1,ne),setPoint("n2",_,Z,_camera,K,-1,ne),setPoint("n3",_,Z,_camera,-1,te,ne),setPoint("n4",_,Z,_camera,K,te,ne),setPoint("f1",_,Z,_camera,-1,-1,1),setPoint("f2",_,Z,_camera,K,-1,1),setPoint("f3",_,Z,_camera,-1,te,1),setPoint("f4",_,Z,_camera,K,te,1),setPoint("u1",_,Z,_camera,K*.7,te*1.1,ne),setPoint("u2",_,Z,_camera,-1*.7,te*1.1,ne),setPoint("u3",_,Z,_camera,0,te*2,ne),setPoint("cf1",_,Z,_camera,-1,0,1),setPoint("cf2",_,Z,_camera,K,0,1),setPoint("cf3",_,Z,_camera,0,-1,1),setPoint("cf4",_,Z,_camera,0,te,1),setPoint("cn1",_,Z,_camera,-1,0,ne),setPoint("cn2",_,Z,_camera,K,0,ne),setPoint("cn3",_,Z,_camera,0,-1,ne),setPoint("cn4",_,Z,_camera,0,te,ne),Z.getAttribute("position").needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}}function setPoint(X,Z,_,K,te,ne,ie){_vector.set(te,ne,ie).unproject(K);const oe=Z[X];if(oe!==void 0){const se=_.getAttribute("position");for(let ae=0,ge=oe.length;ae<ge;ae++)se.setXYZ(oe[ae],_vector.x,_vector.y,_vector.z)}}const _box=new Box3;class BoxHelper extends LineSegments{constructor(Z,_=16776960){const K=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),te=new Float32Array(8*3),ne=new BufferGeometry;ne.setIndex(new BufferAttribute(K,1)),ne.setAttribute("position",new BufferAttribute(te,3)),super(ne,new LineBasicMaterial({color:_,toneMapped:!1})),this.object=Z,this.type="BoxHelper",this.matrixAutoUpdate=!1,this.update()}update(Z){if(Z!==void 0&&console.warn("THREE.BoxHelper: .update() has no longer arguments."),this.object!==void 0&&_box.setFromObject(this.object),_box.isEmpty())return;const _=_box.min,K=_box.max,te=this.geometry.attributes.position,ne=te.array;ne[0]=K.x,ne[1]=K.y,ne[2]=K.z,ne[3]=_.x,ne[4]=K.y,ne[5]=K.z,ne[6]=_.x,ne[7]=_.y,ne[8]=K.z,ne[9]=K.x,ne[10]=_.y,ne[11]=K.z,ne[12]=K.x,ne[13]=K.y,ne[14]=_.z,ne[15]=_.x,ne[16]=K.y,ne[17]=_.z,ne[18]=_.x,ne[19]=_.y,ne[20]=_.z,ne[21]=K.x,ne[22]=_.y,ne[23]=_.z,te.needsUpdate=!0,this.geometry.computeBoundingSphere()}setFromObject(Z){return this.object=Z,this.update(),this}copy(Z,_){return super.copy(Z,_),this.object=Z.object,this}dispose(){this.geometry.dispose(),this.material.dispose()}}class Box3Helper extends LineSegments{constructor(Z,_=16776960){const K=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),te=[1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],ne=new BufferGeometry;ne.setIndex(new BufferAttribute(K,1)),ne.setAttribute("position",new Float32BufferAttribute(te,3)),super(ne,new LineBasicMaterial({color:_,toneMapped:!1})),this.box=Z,this.type="Box3Helper",this.geometry.computeBoundingSphere()}updateMatrixWorld(Z){const _=this.box;_.isEmpty()||(_.getCenter(this.position),_.getSize(this.scale),this.scale.multiplyScalar(.5),super.updateMatrixWorld(Z))}dispose(){this.geometry.dispose(),this.material.dispose()}}class PlaneHelper extends Line{constructor(Z,_=1,K=16776960){const te=K,ne=[1,-1,0,-1,1,0,-1,-1,0,1,1,0,-1,1,0,-1,-1,0,1,-1,0,1,1,0],ie=new BufferGeometry;ie.setAttribute("position",new Float32BufferAttribute(ne,3)),ie.computeBoundingSphere(),super(ie,new LineBasicMaterial({color:te,toneMapped:!1})),this.type="PlaneHelper",this.plane=Z,this.size=_;const oe=[1,1,0,-1,1,0,-1,-1,0,1,1,0,-1,-1,0,1,-1,0],se=new BufferGeometry;se.setAttribute("position",new Float32BufferAttribute(oe,3)),se.computeBoundingSphere(),this.add(new Mesh(se,new MeshBasicMaterial({color:te,opacity:.2,transparent:!0,depthWrite:!1,toneMapped:!1})))}updateMatrixWorld(Z){this.position.set(0,0,0),this.scale.set(.5*this.size,.5*this.size,1),this.lookAt(this.plane.normal),this.translateZ(-this.plane.constant),super.updateMatrixWorld(Z)}dispose(){this.geometry.dispose(),this.material.dispose(),this.children[0].geometry.dispose(),this.children[0].material.dispose()}}const _axis=new Vector3;let _lineGeometry,_coneGeometry;class ArrowHelper extends Object3D{constructor(Z=new Vector3(0,0,1),_=new Vector3(0,0,0),K=1,te=16776960,ne=K*.2,ie=ne*.2){super(),this.type="ArrowHelper",_lineGeometry===void 0&&(_lineGeometry=new BufferGeometry,_lineGeometry.setAttribute("position",new Float32BufferAttribute([0,0,0,0,1,0],3)),_coneGeometry=new CylinderGeometry(0,.5,1,5,1),_coneGeometry.translate(0,-.5,0)),this.position.copy(_),this.line=new Line(_lineGeometry,new LineBasicMaterial({color:te,toneMapped:!1})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new Mesh(_coneGeometry,new MeshBasicMaterial({color:te,toneMapped:!1})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(Z),this.setLength(K,ne,ie)}setDirection(Z){if(Z.y>.99999)this.quaternion.set(0,0,0,1);else if(Z.y<-.99999)this.quaternion.set(1,0,0,0);else{_axis.set(Z.z,0,-Z.x).normalize();const _=Math.acos(Z.y);this.quaternion.setFromAxisAngle(_axis,_)}}setLength(Z,_=Z*.2,K=_*.2){this.line.scale.set(1,Math.max(1e-4,Z-_),1),this.line.updateMatrix(),this.cone.scale.set(K,_,K),this.cone.position.y=Z,this.cone.updateMatrix()}setColor(Z){this.line.material.color.set(Z),this.cone.material.color.set(Z)}copy(Z){return super.copy(Z,!1),this.line.copy(Z.line),this.cone.copy(Z.cone),this}dispose(){this.line.geometry.dispose(),this.line.material.dispose(),this.cone.geometry.dispose(),this.cone.material.dispose()}}class AxesHelper extends LineSegments{constructor(Z=1){const _=[0,0,0,Z,0,0,0,0,0,0,Z,0,0,0,0,0,0,Z],K=[1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],te=new BufferGeometry;te.setAttribute("position",new Float32BufferAttribute(_,3)),te.setAttribute("color",new Float32BufferAttribute(K,3));const ne=new LineBasicMaterial({vertexColors:!0,toneMapped:!1});super(te,ne),this.type="AxesHelper"}setColors(Z,_,K){const te=new Color$1,ne=this.geometry.attributes.color.array;return te.set(Z),te.toArray(ne,0),te.toArray(ne,3),te.set(_),te.toArray(ne,6),te.toArray(ne,9),te.set(K),te.toArray(ne,12),te.toArray(ne,15),this.geometry.attributes.color.needsUpdate=!0,this}dispose(){this.geometry.dispose(),this.material.dispose()}}class ShapePath{constructor(){this.type="ShapePath",this.color=new Color$1,this.subPaths=[],this.currentPath=null}moveTo(Z,_){return this.currentPath=new Path,this.subPaths.push(this.currentPath),this.currentPath.moveTo(Z,_),this}lineTo(Z,_){return this.currentPath.lineTo(Z,_),this}quadraticCurveTo(Z,_,K,te){return this.currentPath.quadraticCurveTo(Z,_,K,te),this}bezierCurveTo(Z,_,K,te,ne,ie){return this.currentPath.bezierCurveTo(Z,_,K,te,ne,ie),this}splineThru(Z){return this.currentPath.splineThru(Z),this}toShapes(Z){function _(ye){const ve=[];for(let Be=0,Re=ye.length;Be<Re;Be++){const Ve=ye[Be],Ee=new Shape$2;Ee.curves=Ve.curves,ve.push(Ee)}return ve}function K(ye,ve){const Be=ve.length;let Re=!1;for(let Ve=Be-1,Ee=0;Ee<Be;Ve=Ee++){let Ze=ve[Ve],_e=ve[Ee],Fe=_e.x-Ze.x,Te=_e.y-Ze.y;if(Math.abs(Te)>Number.EPSILON){if(Te<0&&(Ze=ve[Ee],Fe=-Fe,_e=ve[Ve],Te=-Te),ye.y<Ze.y||ye.y>_e.y)continue;if(ye.y===Ze.y){if(ye.x===Ze.x)return!0}else{const ke=Te*(ye.x-Ze.x)-Fe*(ye.y-Ze.y);if(ke===0)return!0;if(ke<0)continue;Re=!Re}}else{if(ye.y!==Ze.y)continue;if(_e.x<=ye.x&&ye.x<=Ze.x||Ze.x<=ye.x&&ye.x<=_e.x)return!0}}return Re}const te=ShapeUtils.isClockWise,ne=this.subPaths;if(ne.length===0)return[];let ie,oe,se;const ae=[];if(ne.length===1)return oe=ne[0],se=new Shape$2,se.curves=oe.curves,ae.push(se),ae;let ge=!te(ne[0].getPoints());ge=Z?!ge:ge;const ce=[],de=[];let Ie=[],fe=0,be;de[fe]=void 0,Ie[fe]=[];for(let ye=0,ve=ne.length;ye<ve;ye++)oe=ne[ye],be=oe.getPoints(),ie=te(be),ie=Z?!ie:ie,ie?(!ge&&de[fe]&&fe++,de[fe]={s:new Shape$2,p:be},de[fe].s.curves=oe.curves,ge&&fe++,Ie[fe]=[]):Ie[fe].push({h:oe,p:be[0]});if(!de[0])return _(ne);if(de.length>1){let ye=!1,ve=0;for(let Be=0,Re=de.length;Be<Re;Be++)ce[Be]=[];for(let Be=0,Re=de.length;Be<Re;Be++){const Ve=Ie[Be];for(let Ee=0;Ee<Ve.length;Ee++){const Ze=Ve[Ee];let _e=!0;for(let Fe=0;Fe<de.length;Fe++)K(Ze.p,de[Fe].p)&&(Be!==Fe&&ve++,_e?(_e=!1,ce[Fe].push(Ze)):ye=!0);_e&&ce[Be].push(Ze)}}ve>0&&ye===!1&&(Ie=ce)}let Ae;for(let ye=0,ve=de.length;ye<ve;ye++){se=de[ye].s,ae.push(se),Ae=Ie[ye];for(let Be=0,Re=Ae.length;Be<Re;Be++)se.holes.push(Ae[Be].h)}return ae}}class Controls extends EventDispatcher{constructor(Z,_=null){super(),this.object=Z,this.domElement=_,this.enabled=!0,this.state=-1,this.keys={},this.mouseButtons={LEFT:null,MIDDLE:null,RIGHT:null},this.touches={ONE:null,TWO:null}}connect(){}disconnect(){}dispose(){}update(){}}function contain(X,Z){const _=X.image&&X.image.width?X.image.width/X.image.height:1;return _>Z?(X.repeat.x=1,X.repeat.y=_/Z,X.offset.x=0,X.offset.y=(1-X.repeat.y)/2):(X.repeat.x=Z/_,X.repeat.y=1,X.offset.x=(1-X.repeat.x)/2,X.offset.y=0),X}function cover(X,Z){const _=X.image&&X.image.width?X.image.width/X.image.height:1;return _>Z?(X.repeat.x=Z/_,X.repeat.y=1,X.offset.x=(1-X.repeat.x)/2,X.offset.y=0):(X.repeat.x=1,X.repeat.y=_/Z,X.offset.x=0,X.offset.y=(1-X.repeat.y)/2),X}function fill(X){return X.repeat.x=1,X.repeat.y=1,X.offset.x=0,X.offset.y=0,X}function getByteLength(X,Z,_,K){const te=getTextureTypeByteLength(K);switch(_){case AlphaFormat:return X*Z;case LuminanceFormat:return X*Z;case LuminanceAlphaFormat:return X*Z*2;case RedFormat:return X*Z/te.components*te.byteLength;case RedIntegerFormat:return X*Z/te.components*te.byteLength;case RGFormat:return X*Z*2/te.components*te.byteLength;case RGIntegerFormat:return X*Z*2/te.components*te.byteLength;case RGBFormat:return X*Z*3/te.components*te.byteLength;case RGBAFormat:return X*Z*4/te.components*te.byteLength;case RGBAIntegerFormat:return X*Z*4/te.components*te.byteLength;case RGB_S3TC_DXT1_Format:case RGBA_S3TC_DXT1_Format:return Math.floor((X+3)/4)*Math.floor((Z+3)/4)*8;case RGBA_S3TC_DXT3_Format:case RGBA_S3TC_DXT5_Format:return Math.floor((X+3)/4)*Math.floor((Z+3)/4)*16;case RGB_PVRTC_2BPPV1_Format:case RGBA_PVRTC_2BPPV1_Format:return Math.max(X,16)*Math.max(Z,8)/4;case RGB_PVRTC_4BPPV1_Format:case RGBA_PVRTC_4BPPV1_Format:return Math.max(X,8)*Math.max(Z,8)/2;case RGB_ETC1_Format:case RGB_ETC2_Format:return Math.floor((X+3)/4)*Math.floor((Z+3)/4)*8;case RGBA_ETC2_EAC_Format:return Math.floor((X+3)/4)*Math.floor((Z+3)/4)*16;case RGBA_ASTC_4x4_Format:return Math.floor((X+3)/4)*Math.floor((Z+3)/4)*16;case RGBA_ASTC_5x4_Format:return Math.floor((X+4)/5)*Math.floor((Z+3)/4)*16;case RGBA_ASTC_5x5_Format:return Math.floor((X+4)/5)*Math.floor((Z+4)/5)*16;case RGBA_ASTC_6x5_Format:return Math.floor((X+5)/6)*Math.floor((Z+4)/5)*16;case RGBA_ASTC_6x6_Format:return Math.floor((X+5)/6)*Math.floor((Z+5)/6)*16;case RGBA_ASTC_8x5_Format:return Math.floor((X+7)/8)*Math.floor((Z+4)/5)*16;case RGBA_ASTC_8x6_Format:return Math.floor((X+7)/8)*Math.floor((Z+5)/6)*16;case RGBA_ASTC_8x8_Format:return Math.floor((X+7)/8)*Math.floor((Z+7)/8)*16;case RGBA_ASTC_10x5_Format:return Math.floor((X+9)/10)*Math.floor((Z+4)/5)*16;case RGBA_ASTC_10x6_Format:return Math.floor((X+9)/10)*Math.floor((Z+5)/6)*16;case RGBA_ASTC_10x8_Format:return Math.floor((X+9)/10)*Math.floor((Z+7)/8)*16;case RGBA_ASTC_10x10_Format:return Math.floor((X+9)/10)*Math.floor((Z+9)/10)*16;case RGBA_ASTC_12x10_Format:return Math.floor((X+11)/12)*Math.floor((Z+9)/10)*16;case RGBA_ASTC_12x12_Format:return Math.floor((X+11)/12)*Math.floor((Z+11)/12)*16;case RGBA_BPTC_Format:case RGB_BPTC_SIGNED_Format:case RGB_BPTC_UNSIGNED_Format:return Math.ceil(X/4)*Math.ceil(Z/4)*16;case RED_RGTC1_Format:case SIGNED_RED_RGTC1_Format:return Math.ceil(X/4)*Math.ceil(Z/4)*8;case RED_GREEN_RGTC2_Format:case SIGNED_RED_GREEN_RGTC2_Format:return Math.ceil(X/4)*Math.ceil(Z/4)*16}throw new Error(`Unable to determine texture byte length for ${_} format.`)}function getTextureTypeByteLength(X){switch(X){case UnsignedByteType:case ByteType:return{byteLength:1,components:1};case UnsignedShortType:case ShortType:case HalfFloatType:return{byteLength:2,components:1};case UnsignedShort4444Type:case UnsignedShort5551Type:return{byteLength:2,components:4};case UnsignedIntType:case IntType:case FloatType:return{byteLength:4,components:1};case UnsignedInt5999Type:return{byteLength:4,components:3}}throw new Error(`Unknown texture type ${X}.`)}const TextureUtils={contain,cover,fill,getByteLength};typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:REVISION}}));typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=REVISION);/**
 * @license
 * Copyright 2010-2024 Three.js Authors
 * SPDX-License-Identifier: MIT
 */function WebGLAnimation(){let X=null,Z=!1,_=null,K=null;function te(ne,ie){_(ne,ie),K=X.requestAnimationFrame(te)}return{start:function(){Z!==!0&&_!==null&&(K=X.requestAnimationFrame(te),Z=!0)},stop:function(){X.cancelAnimationFrame(K),Z=!1},setAnimationLoop:function(ne){_=ne},setContext:function(ne){X=ne}}}function WebGLAttributes(X){const Z=new WeakMap;function _(oe,se){const ae=oe.array,ge=oe.usage,ce=ae.byteLength,de=X.createBuffer();X.bindBuffer(se,de),X.bufferData(se,ae,ge),oe.onUploadCallback();let Ie;if(ae instanceof Float32Array)Ie=X.FLOAT;else if(ae instanceof Uint16Array)oe.isFloat16BufferAttribute?Ie=X.HALF_FLOAT:Ie=X.UNSIGNED_SHORT;else if(ae instanceof Int16Array)Ie=X.SHORT;else if(ae instanceof Uint32Array)Ie=X.UNSIGNED_INT;else if(ae instanceof Int32Array)Ie=X.INT;else if(ae instanceof Int8Array)Ie=X.BYTE;else if(ae instanceof Uint8Array)Ie=X.UNSIGNED_BYTE;else if(ae instanceof Uint8ClampedArray)Ie=X.UNSIGNED_BYTE;else throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+ae);return{buffer:de,type:Ie,bytesPerElement:ae.BYTES_PER_ELEMENT,version:oe.version,size:ce}}function K(oe,se,ae){const ge=se.array,ce=se.updateRanges;if(X.bindBuffer(ae,oe),ce.length===0)X.bufferSubData(ae,0,ge);else{ce.sort((Ie,fe)=>Ie.start-fe.start);let de=0;for(let Ie=1;Ie<ce.length;Ie++){const fe=ce[de],be=ce[Ie];be.start<=fe.start+fe.count+1?fe.count=Math.max(fe.count,be.start+be.count-fe.start):(++de,ce[de]=be)}ce.length=de+1;for(let Ie=0,fe=ce.length;Ie<fe;Ie++){const be=ce[Ie];X.bufferSubData(ae,be.start*ge.BYTES_PER_ELEMENT,ge,be.start,be.count)}se.clearUpdateRanges()}se.onUploadCallback()}function te(oe){return oe.isInterleavedBufferAttribute&&(oe=oe.data),Z.get(oe)}function ne(oe){oe.isInterleavedBufferAttribute&&(oe=oe.data);const se=Z.get(oe);se&&(X.deleteBuffer(se.buffer),Z.delete(oe))}function ie(oe,se){if(oe.isInterleavedBufferAttribute&&(oe=oe.data),oe.isGLBufferAttribute){const ge=Z.get(oe);(!ge||ge.version<oe.version)&&Z.set(oe,{buffer:oe.buffer,type:oe.type,bytesPerElement:oe.elementSize,version:oe.version});return}const ae=Z.get(oe);if(ae===void 0)Z.set(oe,_(oe,se));else if(ae.version<oe.version){if(ae.size!==oe.array.byteLength)throw new Error("THREE.WebGLAttributes: The size of the buffer attribute's array buffer does not match the original size. Resizing buffer attributes is not supported.");K(ae.buffer,oe,se),ae.version=oe.version}}return{get:te,remove:ne,update:ie}}var alphahash_fragment=`#ifdef USE_ALPHAHASH
	if ( diffuseColor.a < getAlphaHashThreshold( vPosition ) ) discard;
#endif`,alphahash_pars_fragment=`#ifdef USE_ALPHAHASH
	const float ALPHA_HASH_SCALE = 0.05;
	float hash2D( vec2 value ) {
		return fract( 1.0e4 * sin( 17.0 * value.x + 0.1 * value.y ) * ( 0.1 + abs( sin( 13.0 * value.y + value.x ) ) ) );
	}
	float hash3D( vec3 value ) {
		return hash2D( vec2( hash2D( value.xy ), value.z ) );
	}
	float getAlphaHashThreshold( vec3 position ) {
		float maxDeriv = max(
			length( dFdx( position.xyz ) ),
			length( dFdy( position.xyz ) )
		);
		float pixScale = 1.0 / ( ALPHA_HASH_SCALE * maxDeriv );
		vec2 pixScales = vec2(
			exp2( floor( log2( pixScale ) ) ),
			exp2( ceil( log2( pixScale ) ) )
		);
		vec2 alpha = vec2(
			hash3D( floor( pixScales.x * position.xyz ) ),
			hash3D( floor( pixScales.y * position.xyz ) )
		);
		float lerpFactor = fract( log2( pixScale ) );
		float x = ( 1.0 - lerpFactor ) * alpha.x + lerpFactor * alpha.y;
		float a = min( lerpFactor, 1.0 - lerpFactor );
		vec3 cases = vec3(
			x * x / ( 2.0 * a * ( 1.0 - a ) ),
			( x - 0.5 * a ) / ( 1.0 - a ),
			1.0 - ( ( 1.0 - x ) * ( 1.0 - x ) / ( 2.0 * a * ( 1.0 - a ) ) )
		);
		float threshold = ( x < ( 1.0 - a ) )
			? ( ( x < a ) ? cases.x : cases.y )
			: cases.z;
		return clamp( threshold , 1.0e-6, 1.0 );
	}
#endif`,alphamap_fragment=`#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, vAlphaMapUv ).g;
#endif`,alphamap_pars_fragment=`#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,alphatest_fragment=`#ifdef USE_ALPHATEST
	#ifdef ALPHA_TO_COVERAGE
	diffuseColor.a = smoothstep( alphaTest, alphaTest + fwidth( diffuseColor.a ), diffuseColor.a );
	if ( diffuseColor.a == 0.0 ) discard;
	#else
	if ( diffuseColor.a < alphaTest ) discard;
	#endif
#endif`,alphatest_pars_fragment=`#ifdef USE_ALPHATEST
	uniform float alphaTest;
#endif`,aomap_fragment=`#ifdef USE_AOMAP
	float ambientOcclusion = ( texture2D( aoMap, vAoMapUv ).r - 1.0 ) * aoMapIntensity + 1.0;
	reflectedLight.indirectDiffuse *= ambientOcclusion;
	#if defined( USE_CLEARCOAT ) 
		clearcoatSpecularIndirect *= ambientOcclusion;
	#endif
	#if defined( USE_SHEEN ) 
		sheenSpecularIndirect *= ambientOcclusion;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD )
		float dotNV = saturate( dot( geometryNormal, geometryViewDir ) );
		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );
	#endif
#endif`,aomap_pars_fragment=`#ifdef USE_AOMAP
	uniform sampler2D aoMap;
	uniform float aoMapIntensity;
#endif`,batching_pars_vertex=`#ifdef USE_BATCHING
	#if ! defined( GL_ANGLE_multi_draw )
	#define gl_DrawID _gl_DrawID
	uniform int _gl_DrawID;
	#endif
	uniform highp sampler2D batchingTexture;
	uniform highp usampler2D batchingIdTexture;
	mat4 getBatchingMatrix( const in float i ) {
		int size = textureSize( batchingTexture, 0 ).x;
		int j = int( i ) * 4;
		int x = j % size;
		int y = j / size;
		vec4 v1 = texelFetch( batchingTexture, ivec2( x, y ), 0 );
		vec4 v2 = texelFetch( batchingTexture, ivec2( x + 1, y ), 0 );
		vec4 v3 = texelFetch( batchingTexture, ivec2( x + 2, y ), 0 );
		vec4 v4 = texelFetch( batchingTexture, ivec2( x + 3, y ), 0 );
		return mat4( v1, v2, v3, v4 );
	}
	float getIndirectIndex( const in int i ) {
		int size = textureSize( batchingIdTexture, 0 ).x;
		int x = i % size;
		int y = i / size;
		return float( texelFetch( batchingIdTexture, ivec2( x, y ), 0 ).r );
	}
#endif
#ifdef USE_BATCHING_COLOR
	uniform sampler2D batchingColorTexture;
	vec3 getBatchingColor( const in float i ) {
		int size = textureSize( batchingColorTexture, 0 ).x;
		int j = int( i );
		int x = j % size;
		int y = j / size;
		return texelFetch( batchingColorTexture, ivec2( x, y ), 0 ).rgb;
	}
#endif`,batching_vertex=`#ifdef USE_BATCHING
	mat4 batchingMatrix = getBatchingMatrix( getIndirectIndex( gl_DrawID ) );
#endif`,begin_vertex=`vec3 transformed = vec3( position );
#ifdef USE_ALPHAHASH
	vPosition = vec3( position );
#endif`,beginnormal_vertex=`vec3 objectNormal = vec3( normal );
#ifdef USE_TANGENT
	vec3 objectTangent = vec3( tangent.xyz );
#endif`,bsdfs=`float G_BlinnPhong_Implicit( ) {
	return 0.25;
}
float D_BlinnPhong( const in float shininess, const in float dotNH ) {
	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );
}
vec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( specularColor, 1.0, dotVH );
	float G = G_BlinnPhong_Implicit( );
	float D = D_BlinnPhong( shininess, dotNH );
	return F * ( G * D );
} // validated`,iridescence_fragment=`#ifdef USE_IRIDESCENCE
	const mat3 XYZ_TO_REC709 = mat3(
		 3.2404542, -0.9692660,  0.0556434,
		-1.5371385,  1.8760108, -0.2040259,
		-0.4985314,  0.0415560,  1.0572252
	);
	vec3 Fresnel0ToIor( vec3 fresnel0 ) {
		vec3 sqrtF0 = sqrt( fresnel0 );
		return ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );
	}
	vec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );
	}
	float IorToFresnel0( float transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));
	}
	vec3 evalSensitivity( float OPD, vec3 shift ) {
		float phase = 2.0 * PI * OPD * 1.0e-9;
		vec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );
		vec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );
		vec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );
		vec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );
		xyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );
		xyz /= 1.0685e-7;
		vec3 rgb = XYZ_TO_REC709 * xyz;
		return rgb;
	}
	vec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {
		vec3 I;
		float iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );
		float sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );
		float cosTheta2Sq = 1.0 - sinTheta2Sq;
		if ( cosTheta2Sq < 0.0 ) {
			return vec3( 1.0 );
		}
		float cosTheta2 = sqrt( cosTheta2Sq );
		float R0 = IorToFresnel0( iridescenceIOR, outsideIOR );
		float R12 = F_Schlick( R0, 1.0, cosTheta1 );
		float T121 = 1.0 - R12;
		float phi12 = 0.0;
		if ( iridescenceIOR < outsideIOR ) phi12 = PI;
		float phi21 = PI - phi12;
		vec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );		vec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );
		vec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );
		vec3 phi23 = vec3( 0.0 );
		if ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;
		if ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;
		if ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;
		float OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;
		vec3 phi = vec3( phi21 ) + phi23;
		vec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );
		vec3 r123 = sqrt( R123 );
		vec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );
		vec3 C0 = R12 + Rs;
		I = C0;
		vec3 Cm = Rs - T121;
		for ( int m = 1; m <= 2; ++ m ) {
			Cm *= r123;
			vec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );
			I += Cm * Sm;
		}
		return max( I, vec3( 0.0 ) );
	}
#endif`,bumpmap_pars_fragment=`#ifdef USE_BUMPMAP
	uniform sampler2D bumpMap;
	uniform float bumpScale;
	vec2 dHdxy_fwd() {
		vec2 dSTdx = dFdx( vBumpMapUv );
		vec2 dSTdy = dFdy( vBumpMapUv );
		float Hll = bumpScale * texture2D( bumpMap, vBumpMapUv ).x;
		float dBx = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdx ).x - Hll;
		float dBy = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdy ).x - Hll;
		return vec2( dBx, dBy );
	}
	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {
		vec3 vSigmaX = normalize( dFdx( surf_pos.xyz ) );
		vec3 vSigmaY = normalize( dFdy( surf_pos.xyz ) );
		vec3 vN = surf_norm;
		vec3 R1 = cross( vSigmaY, vN );
		vec3 R2 = cross( vN, vSigmaX );
		float fDet = dot( vSigmaX, R1 ) * faceDirection;
		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
		return normalize( abs( fDet ) * surf_norm - vGrad );
	}
#endif`,clipping_planes_fragment=`#if NUM_CLIPPING_PLANES > 0
	vec4 plane;
	#ifdef ALPHA_TO_COVERAGE
		float distanceToPlane, distanceGradient;
		float clipOpacity = 1.0;
		#pragma unroll_loop_start
		for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			distanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;
			distanceGradient = fwidth( distanceToPlane ) / 2.0;
			clipOpacity *= smoothstep( - distanceGradient, distanceGradient, distanceToPlane );
			if ( clipOpacity == 0.0 ) discard;
		}
		#pragma unroll_loop_end
		#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
			float unionClipOpacity = 1.0;
			#pragma unroll_loop_start
			for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
				plane = clippingPlanes[ i ];
				distanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;
				distanceGradient = fwidth( distanceToPlane ) / 2.0;
				unionClipOpacity *= 1.0 - smoothstep( - distanceGradient, distanceGradient, distanceToPlane );
			}
			#pragma unroll_loop_end
			clipOpacity *= 1.0 - unionClipOpacity;
		#endif
		diffuseColor.a *= clipOpacity;
		if ( diffuseColor.a == 0.0 ) discard;
	#else
		#pragma unroll_loop_start
		for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			if ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;
		}
		#pragma unroll_loop_end
		#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
			bool clipped = true;
			#pragma unroll_loop_start
			for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
				plane = clippingPlanes[ i ];
				clipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;
			}
			#pragma unroll_loop_end
			if ( clipped ) discard;
		#endif
	#endif
#endif`,clipping_planes_pars_fragment=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];
#endif`,clipping_planes_pars_vertex=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
#endif`,clipping_planes_vertex=`#if NUM_CLIPPING_PLANES > 0
	vClipPosition = - mvPosition.xyz;
#endif`,color_fragment=`#if defined( USE_COLOR_ALPHA )
	diffuseColor *= vColor;
#elif defined( USE_COLOR )
	diffuseColor.rgb *= vColor;
#endif`,color_pars_fragment=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR )
	varying vec3 vColor;
#endif`,color_pars_vertex=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR ) || defined( USE_BATCHING_COLOR )
	varying vec3 vColor;
#endif`,color_vertex=`#if defined( USE_COLOR_ALPHA )
	vColor = vec4( 1.0 );
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR ) || defined( USE_BATCHING_COLOR )
	vColor = vec3( 1.0 );
#endif
#ifdef USE_COLOR
	vColor *= color;
#endif
#ifdef USE_INSTANCING_COLOR
	vColor.xyz *= instanceColor.xyz;
#endif
#ifdef USE_BATCHING_COLOR
	vec3 batchingColor = getBatchingColor( getIndirectIndex( gl_DrawID ) );
	vColor.xyz *= batchingColor.xyz;
#endif`,common=`#define PI 3.141592653589793
#define PI2 6.283185307179586
#define PI_HALF 1.5707963267948966
#define RECIPROCAL_PI 0.3183098861837907
#define RECIPROCAL_PI2 0.15915494309189535
#define EPSILON 1e-6
#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
#define whiteComplement( a ) ( 1.0 - saturate( a ) )
float pow2( const in float x ) { return x*x; }
vec3 pow2( const in vec3 x ) { return x*x; }
float pow3( const in float x ) { return x*x*x; }
float pow4( const in float x ) { float x2 = x*x; return x2*x2; }
float max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }
float average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }
highp float rand( const in vec2 uv ) {
	const highp float a = 12.9898, b = 78.233, c = 43758.5453;
	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );
	return fract( sin( sn ) * c );
}
#ifdef HIGH_PRECISION
	float precisionSafeLength( vec3 v ) { return length( v ); }
#else
	float precisionSafeLength( vec3 v ) {
		float maxComponent = max3( abs( v ) );
		return length( v / maxComponent ) * maxComponent;
	}
#endif
struct IncidentLight {
	vec3 color;
	vec3 direction;
	bool visible;
};
struct ReflectedLight {
	vec3 directDiffuse;
	vec3 directSpecular;
	vec3 indirectDiffuse;
	vec3 indirectSpecular;
};
#ifdef USE_ALPHAHASH
	varying vec3 vPosition;
#endif
vec3 transformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
}
vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );
}
mat3 transposeMat3( const in mat3 m ) {
	mat3 tmp;
	tmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );
	tmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );
	tmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );
	return tmp;
}
bool isPerspectiveMatrix( mat4 m ) {
	return m[ 2 ][ 3 ] == - 1.0;
}
vec2 equirectUv( in vec3 dir ) {
	float u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;
	float v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
	return vec2( u, v );
}
vec3 BRDF_Lambert( const in vec3 diffuseColor ) {
	return RECIPROCAL_PI * diffuseColor;
}
vec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
float F_Schlick( const in float f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
} // validated`,cube_uv_reflection_fragment=`#ifdef ENVMAP_TYPE_CUBE_UV
	#define cubeUV_minMipLevel 4.0
	#define cubeUV_minTileSize 16.0
	float getFace( vec3 direction ) {
		vec3 absDirection = abs( direction );
		float face = - 1.0;
		if ( absDirection.x > absDirection.z ) {
			if ( absDirection.x > absDirection.y )
				face = direction.x > 0.0 ? 0.0 : 3.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		} else {
			if ( absDirection.z > absDirection.y )
				face = direction.z > 0.0 ? 2.0 : 5.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		}
		return face;
	}
	vec2 getUV( vec3 direction, float face ) {
		vec2 uv;
		if ( face == 0.0 ) {
			uv = vec2( direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 1.0 ) {
			uv = vec2( - direction.x, - direction.z ) / abs( direction.y );
		} else if ( face == 2.0 ) {
			uv = vec2( - direction.x, direction.y ) / abs( direction.z );
		} else if ( face == 3.0 ) {
			uv = vec2( - direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 4.0 ) {
			uv = vec2( - direction.x, direction.z ) / abs( direction.y );
		} else {
			uv = vec2( direction.x, direction.y ) / abs( direction.z );
		}
		return 0.5 * ( uv + 1.0 );
	}
	vec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {
		float face = getFace( direction );
		float filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );
		mipInt = max( mipInt, cubeUV_minMipLevel );
		float faceSize = exp2( mipInt );
		highp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;
		if ( face > 2.0 ) {
			uv.y += faceSize;
			face -= 3.0;
		}
		uv.x += face * faceSize;
		uv.x += filterInt * 3.0 * cubeUV_minTileSize;
		uv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );
		uv.x *= CUBEUV_TEXEL_WIDTH;
		uv.y *= CUBEUV_TEXEL_HEIGHT;
		#ifdef texture2DGradEXT
			return texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;
		#else
			return texture2D( envMap, uv ).rgb;
		#endif
	}
	#define cubeUV_r0 1.0
	#define cubeUV_m0 - 2.0
	#define cubeUV_r1 0.8
	#define cubeUV_m1 - 1.0
	#define cubeUV_r4 0.4
	#define cubeUV_m4 2.0
	#define cubeUV_r5 0.305
	#define cubeUV_m5 3.0
	#define cubeUV_r6 0.21
	#define cubeUV_m6 4.0
	float roughnessToMip( float roughness ) {
		float mip = 0.0;
		if ( roughness >= cubeUV_r1 ) {
			mip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;
		} else if ( roughness >= cubeUV_r4 ) {
			mip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;
		} else if ( roughness >= cubeUV_r5 ) {
			mip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;
		} else if ( roughness >= cubeUV_r6 ) {
			mip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;
		} else {
			mip = - 2.0 * log2( 1.16 * roughness );		}
		return mip;
	}
	vec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {
		float mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );
		float mipF = fract( mip );
		float mipInt = floor( mip );
		vec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );
		if ( mipF == 0.0 ) {
			return vec4( color0, 1.0 );
		} else {
			vec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );
			return vec4( mix( color0, color1, mipF ), 1.0 );
		}
	}
#endif`,defaultnormal_vertex=`vec3 transformedNormal = objectNormal;
#ifdef USE_TANGENT
	vec3 transformedTangent = objectTangent;
#endif
#ifdef USE_BATCHING
	mat3 bm = mat3( batchingMatrix );
	transformedNormal /= vec3( dot( bm[ 0 ], bm[ 0 ] ), dot( bm[ 1 ], bm[ 1 ] ), dot( bm[ 2 ], bm[ 2 ] ) );
	transformedNormal = bm * transformedNormal;
	#ifdef USE_TANGENT
		transformedTangent = bm * transformedTangent;
	#endif
#endif
#ifdef USE_INSTANCING
	mat3 im = mat3( instanceMatrix );
	transformedNormal /= vec3( dot( im[ 0 ], im[ 0 ] ), dot( im[ 1 ], im[ 1 ] ), dot( im[ 2 ], im[ 2 ] ) );
	transformedNormal = im * transformedNormal;
	#ifdef USE_TANGENT
		transformedTangent = im * transformedTangent;
	#endif
#endif
transformedNormal = normalMatrix * transformedNormal;
#ifdef FLIP_SIDED
	transformedNormal = - transformedNormal;
#endif
#ifdef USE_TANGENT
	transformedTangent = ( modelViewMatrix * vec4( transformedTangent, 0.0 ) ).xyz;
	#ifdef FLIP_SIDED
		transformedTangent = - transformedTangent;
	#endif
#endif`,displacementmap_pars_vertex=`#ifdef USE_DISPLACEMENTMAP
	uniform sampler2D displacementMap;
	uniform float displacementScale;
	uniform float displacementBias;
#endif`,displacementmap_vertex=`#ifdef USE_DISPLACEMENTMAP
	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, vDisplacementMapUv ).x * displacementScale + displacementBias );
#endif`,emissivemap_fragment=`#ifdef USE_EMISSIVEMAP
	vec4 emissiveColor = texture2D( emissiveMap, vEmissiveMapUv );
	#ifdef DECODE_VIDEO_TEXTURE_EMISSIVE
		emissiveColor = sRGBTransferEOTF( emissiveColor );
	#endif
	totalEmissiveRadiance *= emissiveColor.rgb;
#endif`,emissivemap_pars_fragment=`#ifdef USE_EMISSIVEMAP
	uniform sampler2D emissiveMap;
#endif`,colorspace_fragment="gl_FragColor = linearToOutputTexel( gl_FragColor );",colorspace_pars_fragment=`vec4 LinearTransferOETF( in vec4 value ) {
	return value;
}
vec4 sRGBTransferEOTF( in vec4 value ) {
	return vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );
}
vec4 sRGBTransferOETF( in vec4 value ) {
	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );
}`,envmap_fragment=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vec3 cameraToFrag;
		if ( isOrthographic ) {
			cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToFrag = normalize( vWorldPosition - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( cameraToFrag, worldNormal );
		#else
			vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );
		#endif
	#else
		vec3 reflectVec = vReflect;
	#endif
	#ifdef ENVMAP_TYPE_CUBE
		vec4 envColor = textureCube( envMap, envMapRotation * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );
	#else
		vec4 envColor = vec4( 0.0 );
	#endif
	#ifdef ENVMAP_BLENDING_MULTIPLY
		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_MIX )
		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_ADD )
		outgoingLight += envColor.xyz * specularStrength * reflectivity;
	#endif
#endif`,envmap_common_pars_fragment=`#ifdef USE_ENVMAP
	uniform float envMapIntensity;
	uniform float flipEnvMap;
	uniform mat3 envMapRotation;
	#ifdef ENVMAP_TYPE_CUBE
		uniform samplerCube envMap;
	#else
		uniform sampler2D envMap;
	#endif
	
#endif`,envmap_pars_fragment=`#ifdef USE_ENVMAP
	uniform float reflectivity;
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		varying vec3 vWorldPosition;
		uniform float refractionRatio;
	#else
		varying vec3 vReflect;
	#endif
#endif`,envmap_pars_vertex=`#ifdef USE_ENVMAP
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		
		varying vec3 vWorldPosition;
	#else
		varying vec3 vReflect;
		uniform float refractionRatio;
	#endif
#endif`,envmap_vertex=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vWorldPosition = worldPosition.xyz;
	#else
		vec3 cameraToVertex;
		if ( isOrthographic ) {
			cameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToVertex = normalize( worldPosition.xyz - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vReflect = reflect( cameraToVertex, worldNormal );
		#else
			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );
		#endif
	#endif
#endif`,fog_vertex=`#ifdef USE_FOG
	vFogDepth = - mvPosition.z;
#endif`,fog_pars_vertex=`#ifdef USE_FOG
	varying float vFogDepth;
#endif`,fog_fragment=`#ifdef USE_FOG
	#ifdef FOG_EXP2
		float fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );
	#else
		float fogFactor = smoothstep( fogNear, fogFar, vFogDepth );
	#endif
	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );
#endif`,fog_pars_fragment=`#ifdef USE_FOG
	uniform vec3 fogColor;
	varying float vFogDepth;
	#ifdef FOG_EXP2
		uniform float fogDensity;
	#else
		uniform float fogNear;
		uniform float fogFar;
	#endif
#endif`,gradientmap_pars_fragment=`#ifdef USE_GRADIENTMAP
	uniform sampler2D gradientMap;
#endif
vec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {
	float dotNL = dot( normal, lightDirection );
	vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );
	#ifdef USE_GRADIENTMAP
		return vec3( texture2D( gradientMap, coord ).r );
	#else
		vec2 fw = fwidth( coord ) * 0.5;
		return mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );
	#endif
}`,lightmap_pars_fragment=`#ifdef USE_LIGHTMAP
	uniform sampler2D lightMap;
	uniform float lightMapIntensity;
#endif`,lights_lambert_fragment=`LambertMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularStrength = specularStrength;`,lights_lambert_pars_fragment=`varying vec3 vViewPosition;
struct LambertMaterial {
	vec3 diffuseColor;
	float specularStrength;
};
void RE_Direct_Lambert( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Lambert
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Lambert`,lights_pars_begin=`uniform bool receiveShadow;
uniform vec3 ambientLightColor;
#if defined( USE_LIGHT_PROBES )
	uniform vec3 lightProbe[ 9 ];
#endif
vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {
	float x = normal.x, y = normal.y, z = normal.z;
	vec3 result = shCoefficients[ 0 ] * 0.886227;
	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;
	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;
	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;
	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;
	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;
	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );
	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;
	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );
	return result;
}
vec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {
	vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );
	return irradiance;
}
vec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {
	vec3 irradiance = ambientLightColor;
	return irradiance;
}
float getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {
	float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );
	if ( cutoffDistance > 0.0 ) {
		distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );
	}
	return distanceFalloff;
}
float getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {
	return smoothstep( coneCosine, penumbraCosine, angleCosine );
}
#if NUM_DIR_LIGHTS > 0
	struct DirectionalLight {
		vec3 direction;
		vec3 color;
	};
	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];
	void getDirectionalLightInfo( const in DirectionalLight directionalLight, out IncidentLight light ) {
		light.color = directionalLight.color;
		light.direction = directionalLight.direction;
		light.visible = true;
	}
#endif
#if NUM_POINT_LIGHTS > 0
	struct PointLight {
		vec3 position;
		vec3 color;
		float distance;
		float decay;
	};
	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];
	void getPointLightInfo( const in PointLight pointLight, const in vec3 geometryPosition, out IncidentLight light ) {
		vec3 lVector = pointLight.position - geometryPosition;
		light.direction = normalize( lVector );
		float lightDistance = length( lVector );
		light.color = pointLight.color;
		light.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );
		light.visible = ( light.color != vec3( 0.0 ) );
	}
#endif
#if NUM_SPOT_LIGHTS > 0
	struct SpotLight {
		vec3 position;
		vec3 direction;
		vec3 color;
		float distance;
		float decay;
		float coneCos;
		float penumbraCos;
	};
	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];
	void getSpotLightInfo( const in SpotLight spotLight, const in vec3 geometryPosition, out IncidentLight light ) {
		vec3 lVector = spotLight.position - geometryPosition;
		light.direction = normalize( lVector );
		float angleCos = dot( light.direction, spotLight.direction );
		float spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );
		if ( spotAttenuation > 0.0 ) {
			float lightDistance = length( lVector );
			light.color = spotLight.color * spotAttenuation;
			light.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );
			light.visible = ( light.color != vec3( 0.0 ) );
		} else {
			light.color = vec3( 0.0 );
			light.visible = false;
		}
	}
#endif
#if NUM_RECT_AREA_LIGHTS > 0
	struct RectAreaLight {
		vec3 color;
		vec3 position;
		vec3 halfWidth;
		vec3 halfHeight;
	};
	uniform sampler2D ltc_1;	uniform sampler2D ltc_2;
	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];
#endif
#if NUM_HEMI_LIGHTS > 0
	struct HemisphereLight {
		vec3 direction;
		vec3 skyColor;
		vec3 groundColor;
	};
	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];
	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {
		float dotNL = dot( normal, hemiLight.direction );
		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;
		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );
		return irradiance;
	}
#endif`,envmap_physical_pars_fragment=`#ifdef USE_ENVMAP
	vec3 getIBLIrradiance( const in vec3 normal ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, envMapRotation * worldNormal, 1.0 );
			return PI * envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	vec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 reflectVec = reflect( - viewDir, normal );
			reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );
			reflectVec = inverseTransformDirection( reflectVec, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, envMapRotation * reflectVec, roughness );
			return envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	#ifdef USE_ANISOTROPY
		vec3 getIBLAnisotropyRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in vec3 bitangent, const in float anisotropy ) {
			#ifdef ENVMAP_TYPE_CUBE_UV
				vec3 bentNormal = cross( bitangent, viewDir );
				bentNormal = normalize( cross( bentNormal, bitangent ) );
				bentNormal = normalize( mix( bentNormal, normal, pow2( pow2( 1.0 - anisotropy * ( 1.0 - roughness ) ) ) ) );
				return getIBLRadiance( viewDir, bentNormal, roughness );
			#else
				return vec3( 0.0 );
			#endif
		}
	#endif
#endif`,lights_toon_fragment=`ToonMaterial material;
material.diffuseColor = diffuseColor.rgb;`,lights_toon_pars_fragment=`varying vec3 vViewPosition;
struct ToonMaterial {
	vec3 diffuseColor;
};
void RE_Direct_Toon( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	vec3 irradiance = getGradientIrradiance( geometryNormal, directLight.direction ) * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Toon
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon`,lights_phong_fragment=`BlinnPhongMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;`,lights_phong_pars_fragment=`varying vec3 vViewPosition;
struct BlinnPhongMaterial {
	vec3 diffuseColor;
	vec3 specularColor;
	float specularShininess;
	float specularStrength;
};
void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometryViewDir, geometryNormal, material.specularColor, material.specularShininess ) * material.specularStrength;
}
void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong`,lights_physical_fragment=`PhysicalMaterial material;
material.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );
vec3 dxy = max( abs( dFdx( nonPerturbedNormal ) ), abs( dFdy( nonPerturbedNormal ) ) );
float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );
material.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;
material.roughness = min( material.roughness, 1.0 );
#ifdef IOR
	material.ior = ior;
	#ifdef USE_SPECULAR
		float specularIntensityFactor = specularIntensity;
		vec3 specularColorFactor = specularColor;
		#ifdef USE_SPECULAR_COLORMAP
			specularColorFactor *= texture2D( specularColorMap, vSpecularColorMapUv ).rgb;
		#endif
		#ifdef USE_SPECULAR_INTENSITYMAP
			specularIntensityFactor *= texture2D( specularIntensityMap, vSpecularIntensityMapUv ).a;
		#endif
		material.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );
	#else
		float specularIntensityFactor = 1.0;
		vec3 specularColorFactor = vec3( 1.0 );
		material.specularF90 = 1.0;
	#endif
	material.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );
#else
	material.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );
	material.specularF90 = 1.0;
#endif
#ifdef USE_CLEARCOAT
	material.clearcoat = clearcoat;
	material.clearcoatRoughness = clearcoatRoughness;
	material.clearcoatF0 = vec3( 0.04 );
	material.clearcoatF90 = 1.0;
	#ifdef USE_CLEARCOATMAP
		material.clearcoat *= texture2D( clearcoatMap, vClearcoatMapUv ).x;
	#endif
	#ifdef USE_CLEARCOAT_ROUGHNESSMAP
		material.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vClearcoatRoughnessMapUv ).y;
	#endif
	material.clearcoat = saturate( material.clearcoat );	material.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );
	material.clearcoatRoughness += geometryRoughness;
	material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );
#endif
#ifdef USE_DISPERSION
	material.dispersion = dispersion;
#endif
#ifdef USE_IRIDESCENCE
	material.iridescence = iridescence;
	material.iridescenceIOR = iridescenceIOR;
	#ifdef USE_IRIDESCENCEMAP
		material.iridescence *= texture2D( iridescenceMap, vIridescenceMapUv ).r;
	#endif
	#ifdef USE_IRIDESCENCE_THICKNESSMAP
		material.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vIridescenceThicknessMapUv ).g + iridescenceThicknessMinimum;
	#else
		material.iridescenceThickness = iridescenceThicknessMaximum;
	#endif
#endif
#ifdef USE_SHEEN
	material.sheenColor = sheenColor;
	#ifdef USE_SHEEN_COLORMAP
		material.sheenColor *= texture2D( sheenColorMap, vSheenColorMapUv ).rgb;
	#endif
	material.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );
	#ifdef USE_SHEEN_ROUGHNESSMAP
		material.sheenRoughness *= texture2D( sheenRoughnessMap, vSheenRoughnessMapUv ).a;
	#endif
#endif
#ifdef USE_ANISOTROPY
	#ifdef USE_ANISOTROPYMAP
		mat2 anisotropyMat = mat2( anisotropyVector.x, anisotropyVector.y, - anisotropyVector.y, anisotropyVector.x );
		vec3 anisotropyPolar = texture2D( anisotropyMap, vAnisotropyMapUv ).rgb;
		vec2 anisotropyV = anisotropyMat * normalize( 2.0 * anisotropyPolar.rg - vec2( 1.0 ) ) * anisotropyPolar.b;
	#else
		vec2 anisotropyV = anisotropyVector;
	#endif
	material.anisotropy = length( anisotropyV );
	if( material.anisotropy == 0.0 ) {
		anisotropyV = vec2( 1.0, 0.0 );
	} else {
		anisotropyV /= material.anisotropy;
		material.anisotropy = saturate( material.anisotropy );
	}
	material.alphaT = mix( pow2( material.roughness ), 1.0, pow2( material.anisotropy ) );
	material.anisotropyT = tbn[ 0 ] * anisotropyV.x + tbn[ 1 ] * anisotropyV.y;
	material.anisotropyB = tbn[ 1 ] * anisotropyV.x - tbn[ 0 ] * anisotropyV.y;
#endif`,lights_physical_pars_fragment=`struct PhysicalMaterial {
	vec3 diffuseColor;
	float roughness;
	vec3 specularColor;
	float specularF90;
	float dispersion;
	#ifdef USE_CLEARCOAT
		float clearcoat;
		float clearcoatRoughness;
		vec3 clearcoatF0;
		float clearcoatF90;
	#endif
	#ifdef USE_IRIDESCENCE
		float iridescence;
		float iridescenceIOR;
		float iridescenceThickness;
		vec3 iridescenceFresnel;
		vec3 iridescenceF0;
	#endif
	#ifdef USE_SHEEN
		vec3 sheenColor;
		float sheenRoughness;
	#endif
	#ifdef IOR
		float ior;
	#endif
	#ifdef USE_TRANSMISSION
		float transmission;
		float transmissionAlpha;
		float thickness;
		float attenuationDistance;
		vec3 attenuationColor;
	#endif
	#ifdef USE_ANISOTROPY
		float anisotropy;
		float alphaT;
		vec3 anisotropyT;
		vec3 anisotropyB;
	#endif
};
vec3 clearcoatSpecularDirect = vec3( 0.0 );
vec3 clearcoatSpecularIndirect = vec3( 0.0 );
vec3 sheenSpecularDirect = vec3( 0.0 );
vec3 sheenSpecularIndirect = vec3(0.0 );
vec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {
    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );
    float x2 = x * x;
    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );
    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );
}
float V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	return 0.5 / max( gv + gl, EPSILON );
}
float D_GGX( const in float alpha, const in float dotNH ) {
	float a2 = pow2( alpha );
	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;
	return RECIPROCAL_PI * a2 / pow2( denom );
}
#ifdef USE_ANISOTROPY
	float V_GGX_SmithCorrelated_Anisotropic( const in float alphaT, const in float alphaB, const in float dotTV, const in float dotBV, const in float dotTL, const in float dotBL, const in float dotNV, const in float dotNL ) {
		float gv = dotNL * length( vec3( alphaT * dotTV, alphaB * dotBV, dotNV ) );
		float gl = dotNV * length( vec3( alphaT * dotTL, alphaB * dotBL, dotNL ) );
		float v = 0.5 / ( gv + gl );
		return saturate(v);
	}
	float D_GGX_Anisotropic( const in float alphaT, const in float alphaB, const in float dotNH, const in float dotTH, const in float dotBH ) {
		float a2 = alphaT * alphaB;
		highp vec3 v = vec3( alphaB * dotTH, alphaT * dotBH, a2 * dotNH );
		highp float v2 = dot( v, v );
		float w2 = a2 / v2;
		return RECIPROCAL_PI * a2 * pow2 ( w2 );
	}
#endif
#ifdef USE_CLEARCOAT
	vec3 BRDF_GGX_Clearcoat( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material) {
		vec3 f0 = material.clearcoatF0;
		float f90 = material.clearcoatF90;
		float roughness = material.clearcoatRoughness;
		float alpha = pow2( roughness );
		vec3 halfDir = normalize( lightDir + viewDir );
		float dotNL = saturate( dot( normal, lightDir ) );
		float dotNV = saturate( dot( normal, viewDir ) );
		float dotNH = saturate( dot( normal, halfDir ) );
		float dotVH = saturate( dot( viewDir, halfDir ) );
		vec3 F = F_Schlick( f0, f90, dotVH );
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
		return F * ( V * D );
	}
#endif
vec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material ) {
	vec3 f0 = material.specularColor;
	float f90 = material.specularF90;
	float roughness = material.roughness;
	float alpha = pow2( roughness );
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( f0, f90, dotVH );
	#ifdef USE_IRIDESCENCE
		F = mix( F, material.iridescenceFresnel, material.iridescence );
	#endif
	#ifdef USE_ANISOTROPY
		float dotTL = dot( material.anisotropyT, lightDir );
		float dotTV = dot( material.anisotropyT, viewDir );
		float dotTH = dot( material.anisotropyT, halfDir );
		float dotBL = dot( material.anisotropyB, lightDir );
		float dotBV = dot( material.anisotropyB, viewDir );
		float dotBH = dot( material.anisotropyB, halfDir );
		float V = V_GGX_SmithCorrelated_Anisotropic( material.alphaT, alpha, dotTV, dotBV, dotTL, dotBL, dotNV, dotNL );
		float D = D_GGX_Anisotropic( material.alphaT, alpha, dotNH, dotTH, dotBH );
	#else
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
	#endif
	return F * ( V * D );
}
vec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {
	const float LUT_SIZE = 64.0;
	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;
	const float LUT_BIAS = 0.5 / LUT_SIZE;
	float dotNV = saturate( dot( N, V ) );
	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );
	uv = uv * LUT_SCALE + LUT_BIAS;
	return uv;
}
float LTC_ClippedSphereFormFactor( const in vec3 f ) {
	float l = length( f );
	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );
}
vec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {
	float x = dot( v1, v2 );
	float y = abs( x );
	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;
	float b = 3.4175940 + ( 4.1616724 + y ) * y;
	float v = a / b;
	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;
	return cross( v1, v2 ) * theta_sintheta;
}
vec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {
	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];
	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];
	vec3 lightNormal = cross( v1, v2 );
	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );
	vec3 T1, T2;
	T1 = normalize( V - N * dot( V, N ) );
	T2 = - cross( N, T1 );
	mat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );
	vec3 coords[ 4 ];
	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );
	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );
	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );
	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );
	coords[ 0 ] = normalize( coords[ 0 ] );
	coords[ 1 ] = normalize( coords[ 1 ] );
	coords[ 2 ] = normalize( coords[ 2 ] );
	coords[ 3 ] = normalize( coords[ 3 ] );
	vec3 vectorFormFactor = vec3( 0.0 );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );
	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );
	return vec3( result );
}
#if defined( USE_SHEEN )
float D_Charlie( float roughness, float dotNH ) {
	float alpha = pow2( roughness );
	float invAlpha = 1.0 / alpha;
	float cos2h = dotNH * dotNH;
	float sin2h = max( 1.0 - cos2h, 0.0078125 );
	return ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );
}
float V_Neubelt( float dotNV, float dotNL ) {
	return saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );
}
vec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float D = D_Charlie( sheenRoughness, dotNH );
	float V = V_Neubelt( dotNV, dotNL );
	return sheenColor * ( D * V );
}
#endif
float IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	float r2 = roughness * roughness;
	float a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;
	float b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;
	float DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );
	return saturate( DG * RECIPROCAL_PI );
}
vec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	const vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );
	const vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );
	vec4 r = roughness * c0 + c1;
	float a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;
	vec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;
	return fab;
}
vec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	return specularColor * fab.x + specularF90 * fab.y;
}
#ifdef USE_IRIDESCENCE
void computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#else
void computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#endif
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	#ifdef USE_IRIDESCENCE
		vec3 Fr = mix( specularColor, iridescenceF0, iridescence );
	#else
		vec3 Fr = specularColor;
	#endif
	vec3 FssEss = Fr * fab.x + specularF90 * fab.y;
	float Ess = fab.x + fab.y;
	float Ems = 1.0 - Ess;
	vec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );
	singleScatter += FssEss;
	multiScatter += Fms * Ems;
}
#if NUM_RECT_AREA_LIGHTS > 0
	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
		vec3 normal = geometryNormal;
		vec3 viewDir = geometryViewDir;
		vec3 position = geometryPosition;
		vec3 lightPos = rectAreaLight.position;
		vec3 halfWidth = rectAreaLight.halfWidth;
		vec3 halfHeight = rectAreaLight.halfHeight;
		vec3 lightColor = rectAreaLight.color;
		float roughness = material.roughness;
		vec3 rectCoords[ 4 ];
		rectCoords[ 0 ] = lightPos + halfWidth - halfHeight;		rectCoords[ 1 ] = lightPos - halfWidth - halfHeight;
		rectCoords[ 2 ] = lightPos - halfWidth + halfHeight;
		rectCoords[ 3 ] = lightPos + halfWidth + halfHeight;
		vec2 uv = LTC_Uv( normal, viewDir, roughness );
		vec4 t1 = texture2D( ltc_1, uv );
		vec4 t2 = texture2D( ltc_2, uv );
		mat3 mInv = mat3(
			vec3( t1.x, 0, t1.y ),
			vec3(    0, 1,    0 ),
			vec3( t1.z, 0, t1.w )
		);
		vec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );
		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );
		reflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );
	}
#endif
void RE_Direct_Physical( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifdef USE_CLEARCOAT
		float dotNLcc = saturate( dot( geometryClearcoatNormal, directLight.direction ) );
		vec3 ccIrradiance = dotNLcc * directLight.color;
		clearcoatSpecularDirect += ccIrradiance * BRDF_GGX_Clearcoat( directLight.direction, geometryViewDir, geometryClearcoatNormal, material );
	#endif
	#ifdef USE_SHEEN
		sheenSpecularDirect += irradiance * BRDF_Sheen( directLight.direction, geometryViewDir, geometryNormal, material.sheenColor, material.sheenRoughness );
	#endif
	reflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometryViewDir, geometryNormal, material );
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
	#ifdef USE_CLEARCOAT
		clearcoatSpecularIndirect += clearcoatRadiance * EnvironmentBRDF( geometryClearcoatNormal, geometryViewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecularIndirect += irradiance * material.sheenColor * IBLSheenBRDF( geometryNormal, geometryViewDir, material.sheenRoughness );
	#endif
	vec3 singleScattering = vec3( 0.0 );
	vec3 multiScattering = vec3( 0.0 );
	vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;
	#ifdef USE_IRIDESCENCE
		computeMultiscatteringIridescence( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );
	#else
		computeMultiscattering( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );
	#endif
	vec3 totalScattering = singleScattering + multiScattering;
	vec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );
	reflectedLight.indirectSpecular += radiance * singleScattering;
	reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;
	reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;
}
#define RE_Direct				RE_Direct_Physical
#define RE_Direct_RectArea		RE_Direct_RectArea_Physical
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical
#define RE_IndirectSpecular		RE_IndirectSpecular_Physical
float computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {
	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );
}`,lights_fragment_begin=`
vec3 geometryPosition = - vViewPosition;
vec3 geometryNormal = normal;
vec3 geometryViewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );
vec3 geometryClearcoatNormal = vec3( 0.0 );
#ifdef USE_CLEARCOAT
	geometryClearcoatNormal = clearcoatNormal;
#endif
#ifdef USE_IRIDESCENCE
	float dotNVi = saturate( dot( normal, geometryViewDir ) );
	if ( material.iridescenceThickness == 0.0 ) {
		material.iridescence = 0.0;
	} else {
		material.iridescence = saturate( material.iridescence );
	}
	if ( material.iridescence > 0.0 ) {
		material.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );
		material.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );
	}
#endif
IncidentLight directLight;
#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )
	PointLight pointLight;
	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		pointLight = pointLights[ i ];
		getPointLightInfo( pointLight, geometryPosition, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )
		pointLightShadow = pointLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowIntensity, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )
	SpotLight spotLight;
	vec4 spotColor;
	vec3 spotLightCoord;
	bool inSpotLightMap;
	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		spotLight = spotLights[ i ];
		getSpotLightInfo( spotLight, geometryPosition, directLight );
		#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX
		#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS
		#else
		#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#endif
		#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )
			spotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;
			inSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );
			spotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );
			directLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;
		#endif
		#undef SPOT_LIGHT_MAP_INDEX
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		spotLightShadow = spotLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowIntensity, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )
	DirectionalLight directionalLight;
	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		directionalLight = directionalLights[ i ];
		getDirectionalLightInfo( directionalLight, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
		directionalLightShadow = directionalLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowIntensity, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )
	RectAreaLight rectAreaLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {
		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if defined( RE_IndirectDiffuse )
	vec3 iblIrradiance = vec3( 0.0 );
	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );
	#if defined( USE_LIGHT_PROBES )
		irradiance += getLightProbeIrradiance( lightProbe, geometryNormal );
	#endif
	#if ( NUM_HEMI_LIGHTS > 0 )
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometryNormal );
		}
		#pragma unroll_loop_end
	#endif
#endif
#if defined( RE_IndirectSpecular )
	vec3 radiance = vec3( 0.0 );
	vec3 clearcoatRadiance = vec3( 0.0 );
#endif`,lights_fragment_maps=`#if defined( RE_IndirectDiffuse )
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
		irradiance += lightMapIrradiance;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )
		iblIrradiance += getIBLIrradiance( geometryNormal );
	#endif
#endif
#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )
	#ifdef USE_ANISOTROPY
		radiance += getIBLAnisotropyRadiance( geometryViewDir, geometryNormal, material.roughness, material.anisotropyB, material.anisotropy );
	#else
		radiance += getIBLRadiance( geometryViewDir, geometryNormal, material.roughness );
	#endif
	#ifdef USE_CLEARCOAT
		clearcoatRadiance += getIBLRadiance( geometryViewDir, geometryClearcoatNormal, material.clearcoatRoughness );
	#endif
#endif`,lights_fragment_end=`#if defined( RE_IndirectDiffuse )
	RE_IndirectDiffuse( irradiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
#endif
#if defined( RE_IndirectSpecular )
	RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
#endif`,logdepthbuf_fragment=`#if defined( USE_LOGDEPTHBUF )
	gl_FragDepth = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;
#endif`,logdepthbuf_pars_fragment=`#if defined( USE_LOGDEPTHBUF )
	uniform float logDepthBufFC;
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,logdepthbuf_pars_vertex=`#ifdef USE_LOGDEPTHBUF
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,logdepthbuf_vertex=`#ifdef USE_LOGDEPTHBUF
	vFragDepth = 1.0 + gl_Position.w;
	vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );
#endif`,map_fragment=`#ifdef USE_MAP
	vec4 sampledDiffuseColor = texture2D( map, vMapUv );
	#ifdef DECODE_VIDEO_TEXTURE
		sampledDiffuseColor = sRGBTransferEOTF( sampledDiffuseColor );
	#endif
	diffuseColor *= sampledDiffuseColor;
#endif`,map_pars_fragment=`#ifdef USE_MAP
	uniform sampler2D map;
#endif`,map_particle_fragment=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	#if defined( USE_POINTS_UV )
		vec2 uv = vUv;
	#else
		vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;
	#endif
#endif
#ifdef USE_MAP
	diffuseColor *= texture2D( map, uv );
#endif
#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, uv ).g;
#endif`,map_particle_pars_fragment=`#if defined( USE_POINTS_UV )
	varying vec2 vUv;
#else
	#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
		uniform mat3 uvTransform;
	#endif
#endif
#ifdef USE_MAP
	uniform sampler2D map;
#endif
#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,metalnessmap_fragment=`float metalnessFactor = metalness;
#ifdef USE_METALNESSMAP
	vec4 texelMetalness = texture2D( metalnessMap, vMetalnessMapUv );
	metalnessFactor *= texelMetalness.b;
#endif`,metalnessmap_pars_fragment=`#ifdef USE_METALNESSMAP
	uniform sampler2D metalnessMap;
#endif`,morphinstance_vertex=`#ifdef USE_INSTANCING_MORPH
	float morphTargetInfluences[ MORPHTARGETS_COUNT ];
	float morphTargetBaseInfluence = texelFetch( morphTexture, ivec2( 0, gl_InstanceID ), 0 ).r;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		morphTargetInfluences[i] =  texelFetch( morphTexture, ivec2( i + 1, gl_InstanceID ), 0 ).r;
	}
#endif`,morphcolor_vertex=`#if defined( USE_MORPHCOLORS )
	vColor *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		#if defined( USE_COLOR_ALPHA )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];
		#elif defined( USE_COLOR )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];
		#endif
	}
#endif`,morphnormal_vertex=`#ifdef USE_MORPHNORMALS
	objectNormal *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		if ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];
	}
#endif`,morphtarget_pars_vertex=`#ifdef USE_MORPHTARGETS
	#ifndef USE_INSTANCING_MORPH
		uniform float morphTargetBaseInfluence;
		uniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];
	#endif
	uniform sampler2DArray morphTargetsTexture;
	uniform ivec2 morphTargetsTextureSize;
	vec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {
		int texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;
		int y = texelIndex / morphTargetsTextureSize.x;
		int x = texelIndex - y * morphTargetsTextureSize.x;
		ivec3 morphUV = ivec3( x, y, morphTargetIndex );
		return texelFetch( morphTargetsTexture, morphUV, 0 );
	}
#endif`,morphtarget_vertex=`#ifdef USE_MORPHTARGETS
	transformed *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		if ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];
	}
#endif`,normal_fragment_begin=`float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;
#ifdef FLAT_SHADED
	vec3 fdx = dFdx( vViewPosition );
	vec3 fdy = dFdy( vViewPosition );
	vec3 normal = normalize( cross( fdx, fdy ) );
#else
	vec3 normal = normalize( vNormal );
	#ifdef DOUBLE_SIDED
		normal *= faceDirection;
	#endif
#endif
#if defined( USE_NORMALMAP_TANGENTSPACE ) || defined( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY )
	#ifdef USE_TANGENT
		mat3 tbn = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn = getTangentFrame( - vViewPosition, normal,
		#if defined( USE_NORMALMAP )
			vNormalMapUv
		#elif defined( USE_CLEARCOAT_NORMALMAP )
			vClearcoatNormalMapUv
		#else
			vUv
		#endif
		);
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn[0] *= faceDirection;
		tbn[1] *= faceDirection;
	#endif
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	#ifdef USE_TANGENT
		mat3 tbn2 = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn2 = getTangentFrame( - vViewPosition, normal, vClearcoatNormalMapUv );
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn2[0] *= faceDirection;
		tbn2[1] *= faceDirection;
	#endif
#endif
vec3 nonPerturbedNormal = normal;`,normal_fragment_maps=`#ifdef USE_NORMALMAP_OBJECTSPACE
	normal = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	#ifdef FLIP_SIDED
		normal = - normal;
	#endif
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	normal = normalize( normalMatrix * normal );
#elif defined( USE_NORMALMAP_TANGENTSPACE )
	vec3 mapN = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	mapN.xy *= normalScale;
	normal = normalize( tbn * mapN );
#elif defined( USE_BUMPMAP )
	normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );
#endif`,normal_pars_fragment=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,normal_pars_vertex=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,normal_vertex=`#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif`,normalmap_pars_fragment=`#ifdef USE_NORMALMAP
	uniform sampler2D normalMap;
	uniform vec2 normalScale;
#endif
#ifdef USE_NORMALMAP_OBJECTSPACE
	uniform mat3 normalMatrix;
#endif
#if ! defined ( USE_TANGENT ) && ( defined ( USE_NORMALMAP_TANGENTSPACE ) || defined ( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY ) )
	mat3 getTangentFrame( vec3 eye_pos, vec3 surf_norm, vec2 uv ) {
		vec3 q0 = dFdx( eye_pos.xyz );
		vec3 q1 = dFdy( eye_pos.xyz );
		vec2 st0 = dFdx( uv.st );
		vec2 st1 = dFdy( uv.st );
		vec3 N = surf_norm;
		vec3 q1perp = cross( q1, N );
		vec3 q0perp = cross( N, q0 );
		vec3 T = q1perp * st0.x + q0perp * st1.x;
		vec3 B = q1perp * st0.y + q0perp * st1.y;
		float det = max( dot( T, T ), dot( B, B ) );
		float scale = ( det == 0.0 ) ? 0.0 : inversesqrt( det );
		return mat3( T * scale, B * scale, N );
	}
#endif`,clearcoat_normal_fragment_begin=`#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal = nonPerturbedNormal;
#endif`,clearcoat_normal_fragment_maps=`#ifdef USE_CLEARCOAT_NORMALMAP
	vec3 clearcoatMapN = texture2D( clearcoatNormalMap, vClearcoatNormalMapUv ).xyz * 2.0 - 1.0;
	clearcoatMapN.xy *= clearcoatNormalScale;
	clearcoatNormal = normalize( tbn2 * clearcoatMapN );
#endif`,clearcoat_pars_fragment=`#ifdef USE_CLEARCOATMAP
	uniform sampler2D clearcoatMap;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform sampler2D clearcoatNormalMap;
	uniform vec2 clearcoatNormalScale;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform sampler2D clearcoatRoughnessMap;
#endif`,iridescence_pars_fragment=`#ifdef USE_IRIDESCENCEMAP
	uniform sampler2D iridescenceMap;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform sampler2D iridescenceThicknessMap;
#endif`,opaque_fragment=`#ifdef OPAQUE
diffuseColor.a = 1.0;
#endif
#ifdef USE_TRANSMISSION
diffuseColor.a *= material.transmissionAlpha;
#endif
gl_FragColor = vec4( outgoingLight, diffuseColor.a );`,packing=`vec3 packNormalToRGB( const in vec3 normal ) {
	return normalize( normal ) * 0.5 + 0.5;
}
vec3 unpackRGBToNormal( const in vec3 rgb ) {
	return 2.0 * rgb.xyz - 1.0;
}
const float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;const float ShiftRight8 = 1. / 256.;
const float Inv255 = 1. / 255.;
const vec4 PackFactors = vec4( 1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0 );
const vec2 UnpackFactors2 = vec2( UnpackDownscale, 1.0 / PackFactors.g );
const vec3 UnpackFactors3 = vec3( UnpackDownscale / PackFactors.rg, 1.0 / PackFactors.b );
const vec4 UnpackFactors4 = vec4( UnpackDownscale / PackFactors.rgb, 1.0 / PackFactors.a );
vec4 packDepthToRGBA( const in float v ) {
	if( v <= 0.0 )
		return vec4( 0., 0., 0., 0. );
	if( v >= 1.0 )
		return vec4( 1., 1., 1., 1. );
	float vuf;
	float af = modf( v * PackFactors.a, vuf );
	float bf = modf( vuf * ShiftRight8, vuf );
	float gf = modf( vuf * ShiftRight8, vuf );
	return vec4( vuf * Inv255, gf * PackUpscale, bf * PackUpscale, af );
}
vec3 packDepthToRGB( const in float v ) {
	if( v <= 0.0 )
		return vec3( 0., 0., 0. );
	if( v >= 1.0 )
		return vec3( 1., 1., 1. );
	float vuf;
	float bf = modf( v * PackFactors.b, vuf );
	float gf = modf( vuf * ShiftRight8, vuf );
	return vec3( vuf * Inv255, gf * PackUpscale, bf );
}
vec2 packDepthToRG( const in float v ) {
	if( v <= 0.0 )
		return vec2( 0., 0. );
	if( v >= 1.0 )
		return vec2( 1., 1. );
	float vuf;
	float gf = modf( v * 256., vuf );
	return vec2( vuf * Inv255, gf );
}
float unpackRGBAToDepth( const in vec4 v ) {
	return dot( v, UnpackFactors4 );
}
float unpackRGBToDepth( const in vec3 v ) {
	return dot( v, UnpackFactors3 );
}
float unpackRGToDepth( const in vec2 v ) {
	return v.r * UnpackFactors2.r + v.g * UnpackFactors2.g;
}
vec4 pack2HalfToRGBA( const in vec2 v ) {
	vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );
	return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );
}
vec2 unpackRGBATo2Half( const in vec4 v ) {
	return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );
}
float viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {
	return ( viewZ + near ) / ( near - far );
}
float orthographicDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return depth * ( near - far ) - near;
}
float viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {
	return ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );
}
float perspectiveDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return ( near * far ) / ( ( far - near ) * depth - far );
}`,premultiplied_alpha_fragment=`#ifdef PREMULTIPLIED_ALPHA
	gl_FragColor.rgb *= gl_FragColor.a;
#endif`,project_vertex=`vec4 mvPosition = vec4( transformed, 1.0 );
#ifdef USE_BATCHING
	mvPosition = batchingMatrix * mvPosition;
#endif
#ifdef USE_INSTANCING
	mvPosition = instanceMatrix * mvPosition;
#endif
mvPosition = modelViewMatrix * mvPosition;
gl_Position = projectionMatrix * mvPosition;`,dithering_fragment=`#ifdef DITHERING
	gl_FragColor.rgb = dithering( gl_FragColor.rgb );
#endif`,dithering_pars_fragment=`#ifdef DITHERING
	vec3 dithering( vec3 color ) {
		float grid_position = rand( gl_FragCoord.xy );
		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );
		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );
		return color + dither_shift_RGB;
	}
#endif`,roughnessmap_fragment=`float roughnessFactor = roughness;
#ifdef USE_ROUGHNESSMAP
	vec4 texelRoughness = texture2D( roughnessMap, vRoughnessMapUv );
	roughnessFactor *= texelRoughness.g;
#endif`,roughnessmap_pars_fragment=`#ifdef USE_ROUGHNESSMAP
	uniform sampler2D roughnessMap;
#endif`,shadowmap_pars_fragment=`#if NUM_SPOT_LIGHT_COORDS > 0
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#if NUM_SPOT_LIGHT_MAPS > 0
	uniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
	float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {
		return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );
	}
	vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {
		return unpackRGBATo2Half( texture2D( shadow, uv ) );
	}
	float VSMShadow (sampler2D shadow, vec2 uv, float compare ){
		float occlusion = 1.0;
		vec2 distribution = texture2DDistribution( shadow, uv );
		float hard_shadow = step( compare , distribution.x );
		if (hard_shadow != 1.0 ) {
			float distance = compare - distribution.x ;
			float variance = max( 0.00000, distribution.y * distribution.y );
			float softness_probability = variance / (variance + distance * distance );			softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );			occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );
		}
		return occlusion;
	}
	float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
		float shadow = 1.0;
		shadowCoord.xyz /= shadowCoord.w;
		shadowCoord.z += shadowBias;
		bool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;
		bool frustumTest = inFrustum && shadowCoord.z <= 1.0;
		if ( frustumTest ) {
		#if defined( SHADOWMAP_TYPE_PCF )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx0 = - texelSize.x * shadowRadius;
			float dy0 = - texelSize.y * shadowRadius;
			float dx1 = + texelSize.x * shadowRadius;
			float dy1 = + texelSize.y * shadowRadius;
			float dx2 = dx0 / 2.0;
			float dy2 = dy0 / 2.0;
			float dx3 = dx1 / 2.0;
			float dy3 = dy1 / 2.0;
			shadow = (
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )
			) * ( 1.0 / 17.0 );
		#elif defined( SHADOWMAP_TYPE_PCF_SOFT )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx = texelSize.x;
			float dy = texelSize.y;
			vec2 uv = shadowCoord.xy;
			vec2 f = fract( uv * shadowMapSize + 0.5 );
			uv -= f * texelSize;
			shadow = (
				texture2DCompare( shadowMap, uv, shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),
						  f.x ),
					 mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),
						  f.x ),
					 f.y )
			) * ( 1.0 / 9.0 );
		#elif defined( SHADOWMAP_TYPE_VSM )
			shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );
		#else
			shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );
		#endif
		}
		return mix( 1.0, shadow, shadowIntensity );
	}
	vec2 cubeToUV( vec3 v, float texelSizeY ) {
		vec3 absV = abs( v );
		float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
		absV *= scaleToCube;
		v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );
		vec2 planar = v.xy;
		float almostATexel = 1.5 * texelSizeY;
		float almostOne = 1.0 - almostATexel;
		if ( absV.z >= almostOne ) {
			if ( v.z > 0.0 )
				planar.x = 4.0 - v.x;
		} else if ( absV.x >= almostOne ) {
			float signX = sign( v.x );
			planar.x = v.z * signX + 2.0 * signX;
		} else if ( absV.y >= almostOne ) {
			float signY = sign( v.y );
			planar.x = v.x + 2.0 * signY + 2.0;
			planar.y = v.z * signY - 2.0;
		}
		return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );
	}
	float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
		float shadow = 1.0;
		vec3 lightToPosition = shadowCoord.xyz;
		
		float lightToPositionLength = length( lightToPosition );
		if ( lightToPositionLength - shadowCameraFar <= 0.0 && lightToPositionLength - shadowCameraNear >= 0.0 ) {
			float dp = ( lightToPositionLength - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );			dp += shadowBias;
			vec3 bd3D = normalize( lightToPosition );
			vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );
			#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )
				vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;
				shadow = (
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )
				) * ( 1.0 / 9.0 );
			#else
				shadow = texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );
			#endif
		}
		return mix( 1.0, shadow, shadowIntensity );
	}
#endif`,shadowmap_pars_vertex=`#if NUM_SPOT_LIGHT_COORDS > 0
	uniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		struct SpotLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
#endif`,shadowmap_vertex=`#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )
	vec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
	vec4 shadowWorldPosition;
#endif
#if defined( USE_SHADOWMAP )
	#if NUM_DIR_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );
			vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );
			vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
#endif
#if NUM_SPOT_LIGHT_COORDS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {
		shadowWorldPosition = worldPosition;
		#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
			shadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;
		#endif
		vSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
#endif`,shadowmask_pars_fragment=`float getShadowMask() {
	float shadow = 1.0;
	#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		directionalLight = directionalLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowIntensity, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		spotLight = spotLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowIntensity, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		pointLight = pointLightShadows[ i ];
		shadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowIntensity, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#endif
	return shadow;
}`,skinbase_vertex=`#ifdef USE_SKINNING
	mat4 boneMatX = getBoneMatrix( skinIndex.x );
	mat4 boneMatY = getBoneMatrix( skinIndex.y );
	mat4 boneMatZ = getBoneMatrix( skinIndex.z );
	mat4 boneMatW = getBoneMatrix( skinIndex.w );
#endif`,skinning_pars_vertex=`#ifdef USE_SKINNING
	uniform mat4 bindMatrix;
	uniform mat4 bindMatrixInverse;
	uniform highp sampler2D boneTexture;
	mat4 getBoneMatrix( const in float i ) {
		int size = textureSize( boneTexture, 0 ).x;
		int j = int( i ) * 4;
		int x = j % size;
		int y = j / size;
		vec4 v1 = texelFetch( boneTexture, ivec2( x, y ), 0 );
		vec4 v2 = texelFetch( boneTexture, ivec2( x + 1, y ), 0 );
		vec4 v3 = texelFetch( boneTexture, ivec2( x + 2, y ), 0 );
		vec4 v4 = texelFetch( boneTexture, ivec2( x + 3, y ), 0 );
		return mat4( v1, v2, v3, v4 );
	}
#endif`,skinning_vertex=`#ifdef USE_SKINNING
	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );
	vec4 skinned = vec4( 0.0 );
	skinned += boneMatX * skinVertex * skinWeight.x;
	skinned += boneMatY * skinVertex * skinWeight.y;
	skinned += boneMatZ * skinVertex * skinWeight.z;
	skinned += boneMatW * skinVertex * skinWeight.w;
	transformed = ( bindMatrixInverse * skinned ).xyz;
#endif`,skinnormal_vertex=`#ifdef USE_SKINNING
	mat4 skinMatrix = mat4( 0.0 );
	skinMatrix += skinWeight.x * boneMatX;
	skinMatrix += skinWeight.y * boneMatY;
	skinMatrix += skinWeight.z * boneMatZ;
	skinMatrix += skinWeight.w * boneMatW;
	skinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;
	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;
	#ifdef USE_TANGENT
		objectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#endif
#endif`,specularmap_fragment=`float specularStrength;
#ifdef USE_SPECULARMAP
	vec4 texelSpecular = texture2D( specularMap, vSpecularMapUv );
	specularStrength = texelSpecular.r;
#else
	specularStrength = 1.0;
#endif`,specularmap_pars_fragment=`#ifdef USE_SPECULARMAP
	uniform sampler2D specularMap;
#endif`,tonemapping_fragment=`#if defined( TONE_MAPPING )
	gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );
#endif`,tonemapping_pars_fragment=`#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
uniform float toneMappingExposure;
vec3 LinearToneMapping( vec3 color ) {
	return saturate( toneMappingExposure * color );
}
vec3 ReinhardToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( color / ( vec3( 1.0 ) + color ) );
}
vec3 CineonToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	color = max( vec3( 0.0 ), color - 0.004 );
	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );
}
vec3 RRTAndODTFit( vec3 v ) {
	vec3 a = v * ( v + 0.0245786 ) - 0.000090537;
	vec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;
	return a / b;
}
vec3 ACESFilmicToneMapping( vec3 color ) {
	const mat3 ACESInputMat = mat3(
		vec3( 0.59719, 0.07600, 0.02840 ),		vec3( 0.35458, 0.90834, 0.13383 ),
		vec3( 0.04823, 0.01566, 0.83777 )
	);
	const mat3 ACESOutputMat = mat3(
		vec3(  1.60475, -0.10208, -0.00327 ),		vec3( -0.53108,  1.10813, -0.07276 ),
		vec3( -0.07367, -0.00605,  1.07602 )
	);
	color *= toneMappingExposure / 0.6;
	color = ACESInputMat * color;
	color = RRTAndODTFit( color );
	color = ACESOutputMat * color;
	return saturate( color );
}
const mat3 LINEAR_REC2020_TO_LINEAR_SRGB = mat3(
	vec3( 1.6605, - 0.1246, - 0.0182 ),
	vec3( - 0.5876, 1.1329, - 0.1006 ),
	vec3( - 0.0728, - 0.0083, 1.1187 )
);
const mat3 LINEAR_SRGB_TO_LINEAR_REC2020 = mat3(
	vec3( 0.6274, 0.0691, 0.0164 ),
	vec3( 0.3293, 0.9195, 0.0880 ),
	vec3( 0.0433, 0.0113, 0.8956 )
);
vec3 agxDefaultContrastApprox( vec3 x ) {
	vec3 x2 = x * x;
	vec3 x4 = x2 * x2;
	return + 15.5 * x4 * x2
		- 40.14 * x4 * x
		+ 31.96 * x4
		- 6.868 * x2 * x
		+ 0.4298 * x2
		+ 0.1191 * x
		- 0.00232;
}
vec3 AgXToneMapping( vec3 color ) {
	const mat3 AgXInsetMatrix = mat3(
		vec3( 0.856627153315983, 0.137318972929847, 0.11189821299995 ),
		vec3( 0.0951212405381588, 0.761241990602591, 0.0767994186031903 ),
		vec3( 0.0482516061458583, 0.101439036467562, 0.811302368396859 )
	);
	const mat3 AgXOutsetMatrix = mat3(
		vec3( 1.1271005818144368, - 0.1413297634984383, - 0.14132976349843826 ),
		vec3( - 0.11060664309660323, 1.157823702216272, - 0.11060664309660294 ),
		vec3( - 0.016493938717834573, - 0.016493938717834257, 1.2519364065950405 )
	);
	const float AgxMinEv = - 12.47393;	const float AgxMaxEv = 4.026069;
	color *= toneMappingExposure;
	color = LINEAR_SRGB_TO_LINEAR_REC2020 * color;
	color = AgXInsetMatrix * color;
	color = max( color, 1e-10 );	color = log2( color );
	color = ( color - AgxMinEv ) / ( AgxMaxEv - AgxMinEv );
	color = clamp( color, 0.0, 1.0 );
	color = agxDefaultContrastApprox( color );
	color = AgXOutsetMatrix * color;
	color = pow( max( vec3( 0.0 ), color ), vec3( 2.2 ) );
	color = LINEAR_REC2020_TO_LINEAR_SRGB * color;
	color = clamp( color, 0.0, 1.0 );
	return color;
}
vec3 NeutralToneMapping( vec3 color ) {
	const float StartCompression = 0.8 - 0.04;
	const float Desaturation = 0.15;
	color *= toneMappingExposure;
	float x = min( color.r, min( color.g, color.b ) );
	float offset = x < 0.08 ? x - 6.25 * x * x : 0.04;
	color -= offset;
	float peak = max( color.r, max( color.g, color.b ) );
	if ( peak < StartCompression ) return color;
	float d = 1. - StartCompression;
	float newPeak = 1. - d * d / ( peak + d - StartCompression );
	color *= newPeak / peak;
	float g = 1. - 1. / ( Desaturation * ( peak - newPeak ) + 1. );
	return mix( color, vec3( newPeak ), g );
}
vec3 CustomToneMapping( vec3 color ) { return color; }`,transmission_fragment=`#ifdef USE_TRANSMISSION
	material.transmission = transmission;
	material.transmissionAlpha = 1.0;
	material.thickness = thickness;
	material.attenuationDistance = attenuationDistance;
	material.attenuationColor = attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		material.transmission *= texture2D( transmissionMap, vTransmissionMapUv ).r;
	#endif
	#ifdef USE_THICKNESSMAP
		material.thickness *= texture2D( thicknessMap, vThicknessMapUv ).g;
	#endif
	vec3 pos = vWorldPosition;
	vec3 v = normalize( cameraPosition - pos );
	vec3 n = inverseTransformDirection( normal, viewMatrix );
	vec4 transmitted = getIBLVolumeRefraction(
		n, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,
		pos, modelMatrix, viewMatrix, projectionMatrix, material.dispersion, material.ior, material.thickness,
		material.attenuationColor, material.attenuationDistance );
	material.transmissionAlpha = mix( material.transmissionAlpha, transmitted.a, material.transmission );
	totalDiffuse = mix( totalDiffuse, transmitted.rgb, material.transmission );
#endif`,transmission_pars_fragment=`#ifdef USE_TRANSMISSION
	uniform float transmission;
	uniform float thickness;
	uniform float attenuationDistance;
	uniform vec3 attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		uniform sampler2D transmissionMap;
	#endif
	#ifdef USE_THICKNESSMAP
		uniform sampler2D thicknessMap;
	#endif
	uniform vec2 transmissionSamplerSize;
	uniform sampler2D transmissionSamplerMap;
	uniform mat4 modelMatrix;
	uniform mat4 projectionMatrix;
	varying vec3 vWorldPosition;
	float w0( float a ) {
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );
	}
	float w1( float a ) {
		return ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );
	}
	float w2( float a ){
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );
	}
	float w3( float a ) {
		return ( 1.0 / 6.0 ) * ( a * a * a );
	}
	float g0( float a ) {
		return w0( a ) + w1( a );
	}
	float g1( float a ) {
		return w2( a ) + w3( a );
	}
	float h0( float a ) {
		return - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );
	}
	float h1( float a ) {
		return 1.0 + w3( a ) / ( w2( a ) + w3( a ) );
	}
	vec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, float lod ) {
		uv = uv * texelSize.zw + 0.5;
		vec2 iuv = floor( uv );
		vec2 fuv = fract( uv );
		float g0x = g0( fuv.x );
		float g1x = g1( fuv.x );
		float h0x = h0( fuv.x );
		float h1x = h1( fuv.x );
		float h0y = h0( fuv.y );
		float h1y = h1( fuv.y );
		vec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		vec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		return g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) +
			g1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );
	}
	vec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {
		vec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );
		vec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );
		vec2 fLodSizeInv = 1.0 / fLodSize;
		vec2 cLodSizeInv = 1.0 / cLodSize;
		vec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), floor( lod ) );
		vec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), ceil( lod ) );
		return mix( fSample, cSample, fract( lod ) );
	}
	vec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {
		vec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );
		vec3 modelScale;
		modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );
		modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );
		modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );
		return normalize( refractionVector ) * thickness * modelScale;
	}
	float applyIorToRoughness( const in float roughness, const in float ior ) {
		return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );
	}
	vec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {
		float lod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );
		return textureBicubic( transmissionSamplerMap, fragCoord.xy, lod );
	}
	vec3 volumeAttenuation( const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {
		if ( isinf( attenuationDistance ) ) {
			return vec3( 1.0 );
		} else {
			vec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;
			vec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );			return transmittance;
		}
	}
	vec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,
		const in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,
		const in mat4 viewMatrix, const in mat4 projMatrix, const in float dispersion, const in float ior, const in float thickness,
		const in vec3 attenuationColor, const in float attenuationDistance ) {
		vec4 transmittedLight;
		vec3 transmittance;
		#ifdef USE_DISPERSION
			float halfSpread = ( ior - 1.0 ) * 0.025 * dispersion;
			vec3 iors = vec3( ior - halfSpread, ior, ior + halfSpread );
			for ( int i = 0; i < 3; i ++ ) {
				vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, iors[ i ], modelMatrix );
				vec3 refractedRayExit = position + transmissionRay;
				vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
				vec2 refractionCoords = ndcPos.xy / ndcPos.w;
				refractionCoords += 1.0;
				refractionCoords /= 2.0;
				vec4 transmissionSample = getTransmissionSample( refractionCoords, roughness, iors[ i ] );
				transmittedLight[ i ] = transmissionSample[ i ];
				transmittedLight.a += transmissionSample.a;
				transmittance[ i ] = diffuseColor[ i ] * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance )[ i ];
			}
			transmittedLight.a /= 3.0;
		#else
			vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );
			vec3 refractedRayExit = position + transmissionRay;
			vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
			vec2 refractionCoords = ndcPos.xy / ndcPos.w;
			refractionCoords += 1.0;
			refractionCoords /= 2.0;
			transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );
			transmittance = diffuseColor * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance );
		#endif
		vec3 attenuatedColor = transmittance * transmittedLight.rgb;
		vec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );
		float transmittanceFactor = ( transmittance.r + transmittance.g + transmittance.b ) / 3.0;
		return vec4( ( 1.0 - F ) * attenuatedColor, 1.0 - ( 1.0 - transmittedLight.a ) * transmittanceFactor );
	}
#endif`,uv_pars_fragment=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_SPECULARMAP
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,uv_pars_vertex=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	uniform mat3 mapTransform;
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	uniform mat3 alphaMapTransform;
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	uniform mat3 lightMapTransform;
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	uniform mat3 aoMapTransform;
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	uniform mat3 bumpMapTransform;
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	uniform mat3 normalMapTransform;
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_DISPLACEMENTMAP
	uniform mat3 displacementMapTransform;
	varying vec2 vDisplacementMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	uniform mat3 emissiveMapTransform;
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	uniform mat3 metalnessMapTransform;
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	uniform mat3 roughnessMapTransform;
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	uniform mat3 anisotropyMapTransform;
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	uniform mat3 clearcoatMapTransform;
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform mat3 clearcoatNormalMapTransform;
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform mat3 clearcoatRoughnessMapTransform;
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	uniform mat3 sheenColorMapTransform;
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	uniform mat3 sheenRoughnessMapTransform;
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	uniform mat3 iridescenceMapTransform;
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform mat3 iridescenceThicknessMapTransform;
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SPECULARMAP
	uniform mat3 specularMapTransform;
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	uniform mat3 specularColorMapTransform;
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	uniform mat3 specularIntensityMapTransform;
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,uv_vertex=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	vUv = vec3( uv, 1 ).xy;
#endif
#ifdef USE_MAP
	vMapUv = ( mapTransform * vec3( MAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ALPHAMAP
	vAlphaMapUv = ( alphaMapTransform * vec3( ALPHAMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_LIGHTMAP
	vLightMapUv = ( lightMapTransform * vec3( LIGHTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_AOMAP
	vAoMapUv = ( aoMapTransform * vec3( AOMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_BUMPMAP
	vBumpMapUv = ( bumpMapTransform * vec3( BUMPMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_NORMALMAP
	vNormalMapUv = ( normalMapTransform * vec3( NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_DISPLACEMENTMAP
	vDisplacementMapUv = ( displacementMapTransform * vec3( DISPLACEMENTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_EMISSIVEMAP
	vEmissiveMapUv = ( emissiveMapTransform * vec3( EMISSIVEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_METALNESSMAP
	vMetalnessMapUv = ( metalnessMapTransform * vec3( METALNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ROUGHNESSMAP
	vRoughnessMapUv = ( roughnessMapTransform * vec3( ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ANISOTROPYMAP
	vAnisotropyMapUv = ( anisotropyMapTransform * vec3( ANISOTROPYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOATMAP
	vClearcoatMapUv = ( clearcoatMapTransform * vec3( CLEARCOATMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	vClearcoatNormalMapUv = ( clearcoatNormalMapTransform * vec3( CLEARCOAT_NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	vClearcoatRoughnessMapUv = ( clearcoatRoughnessMapTransform * vec3( CLEARCOAT_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCEMAP
	vIridescenceMapUv = ( iridescenceMapTransform * vec3( IRIDESCENCEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	vIridescenceThicknessMapUv = ( iridescenceThicknessMapTransform * vec3( IRIDESCENCE_THICKNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_COLORMAP
	vSheenColorMapUv = ( sheenColorMapTransform * vec3( SHEEN_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	vSheenRoughnessMapUv = ( sheenRoughnessMapTransform * vec3( SHEEN_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULARMAP
	vSpecularMapUv = ( specularMapTransform * vec3( SPECULARMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_COLORMAP
	vSpecularColorMapUv = ( specularColorMapTransform * vec3( SPECULAR_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	vSpecularIntensityMapUv = ( specularIntensityMapTransform * vec3( SPECULAR_INTENSITYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_TRANSMISSIONMAP
	vTransmissionMapUv = ( transmissionMapTransform * vec3( TRANSMISSIONMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_THICKNESSMAP
	vThicknessMapUv = ( thicknessMapTransform * vec3( THICKNESSMAP_UV, 1 ) ).xy;
#endif`,worldpos_vertex=`#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0
	vec4 worldPosition = vec4( transformed, 1.0 );
	#ifdef USE_BATCHING
		worldPosition = batchingMatrix * worldPosition;
	#endif
	#ifdef USE_INSTANCING
		worldPosition = instanceMatrix * worldPosition;
	#endif
	worldPosition = modelMatrix * worldPosition;
#endif`;const vertex$h=`varying vec2 vUv;
uniform mat3 uvTransform;
void main() {
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	gl_Position = vec4( position.xy, 1.0, 1.0 );
}`,fragment$h=`uniform sampler2D t2D;
uniform float backgroundIntensity;
varying vec2 vUv;
void main() {
	vec4 texColor = texture2D( t2D, vUv );
	#ifdef DECODE_VIDEO_TEXTURE
		texColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,vertex$g=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,fragment$g=`#ifdef ENVMAP_TYPE_CUBE
	uniform samplerCube envMap;
#elif defined( ENVMAP_TYPE_CUBE_UV )
	uniform sampler2D envMap;
#endif
uniform float flipEnvMap;
uniform float backgroundBlurriness;
uniform float backgroundIntensity;
uniform mat3 backgroundRotation;
varying vec3 vWorldDirection;
#include <cube_uv_reflection_fragment>
void main() {
	#ifdef ENVMAP_TYPE_CUBE
		vec4 texColor = textureCube( envMap, backgroundRotation * vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );
	#elif defined( ENVMAP_TYPE_CUBE_UV )
		vec4 texColor = textureCubeUV( envMap, backgroundRotation * vWorldDirection, backgroundBlurriness );
	#else
		vec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,vertex$f=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,fragment$f=`uniform samplerCube tCube;
uniform float tFlip;
uniform float opacity;
varying vec3 vWorldDirection;
void main() {
	vec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );
	gl_FragColor = texColor;
	gl_FragColor.a *= opacity;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,vertex$e=`#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec2 vHighPrecisionZW;
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <skinbase_vertex>
	#include <morphinstance_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vHighPrecisionZW = gl_Position.zw;
}`,fragment$e=`#if DEPTH_PACKING == 3200
	uniform float opacity;
#endif
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
varying vec2 vHighPrecisionZW;
void main() {
	vec4 diffuseColor = vec4( 1.0 );
	#include <clipping_planes_fragment>
	#if DEPTH_PACKING == 3200
		diffuseColor.a = opacity;
	#endif
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <logdepthbuf_fragment>
	float fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;
	#if DEPTH_PACKING == 3200
		gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );
	#elif DEPTH_PACKING == 3201
		gl_FragColor = packDepthToRGBA( fragCoordZ );
	#elif DEPTH_PACKING == 3202
		gl_FragColor = vec4( packDepthToRGB( fragCoordZ ), 1.0 );
	#elif DEPTH_PACKING == 3203
		gl_FragColor = vec4( packDepthToRG( fragCoordZ ), 0.0, 1.0 );
	#endif
}`,vertex$d=`#define DISTANCE
varying vec3 vWorldPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <skinbase_vertex>
	#include <morphinstance_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	vWorldPosition = worldPosition.xyz;
}`,fragment$d=`#define DISTANCE
uniform vec3 referencePosition;
uniform float nearDistance;
uniform float farDistance;
varying vec3 vWorldPosition;
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <clipping_planes_pars_fragment>
void main () {
	vec4 diffuseColor = vec4( 1.0 );
	#include <clipping_planes_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	float dist = length( vWorldPosition - referencePosition );
	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );
	dist = saturate( dist );
	gl_FragColor = packDepthToRGBA( dist );
}`,vertex$c=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
}`,fragment$c=`uniform sampler2D tEquirect;
varying vec3 vWorldDirection;
#include <common>
void main() {
	vec3 direction = normalize( vWorldDirection );
	vec2 sampleUV = equirectUv( direction );
	gl_FragColor = texture2D( tEquirect, sampleUV );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,vertex$b=`uniform float scale;
attribute float lineDistance;
varying float vLineDistance;
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	vLineDistance = scale * lineDistance;
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,fragment$b=`uniform vec3 diffuse;
uniform float opacity;
uniform float dashSize;
uniform float totalSize;
varying float vLineDistance;
#include <common>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	if ( mod( vLineDistance, totalSize ) > dashSize ) {
		discard;
	}
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,vertex$a=`#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinbase_vertex>
		#include <skinnormal_vertex>
		#include <defaultnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <fog_vertex>
}`,fragment$a=`uniform vec3 diffuse;
uniform float opacity;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		reflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;
	#else
		reflectedLight.indirectDiffuse += vec3( 1.0 );
	#endif
	#include <aomap_fragment>
	reflectedLight.indirectDiffuse *= diffuseColor.rgb;
	vec3 outgoingLight = reflectedLight.indirectDiffuse;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,vertex$9=`#define LAMBERT
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,fragment$9=`#define LAMBERT
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_lambert_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_lambert_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,vertex$8=`#define MATCAP
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <displacementmap_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
	vViewPosition = - mvPosition.xyz;
}`,fragment$8=`#define MATCAP
uniform vec3 diffuse;
uniform float opacity;
uniform sampler2D matcap;
varying vec3 vViewPosition;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	vec3 viewDir = normalize( vViewPosition );
	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
	vec3 y = cross( viewDir, x );
	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;
	#ifdef USE_MATCAP
		vec4 matcapColor = texture2D( matcap, uv );
	#else
		vec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );
	#endif
	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,vertex$7=`#define NORMAL
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	vViewPosition = - mvPosition.xyz;
#endif
}`,fragment$7=`#define NORMAL
uniform float opacity;
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <packing>
#include <uv_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( 0.0, 0.0, 0.0, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	gl_FragColor = vec4( packNormalToRGB( normal ), diffuseColor.a );
	#ifdef OPAQUE
		gl_FragColor.a = 1.0;
	#endif
}`,vertex$6=`#define PHONG
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,fragment$6=`#define PHONG
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_phong_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_phong_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,vertex$5=`#define STANDARD
varying vec3 vViewPosition;
#ifdef USE_TRANSMISSION
	varying vec3 vWorldPosition;
#endif
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
#ifdef USE_TRANSMISSION
	vWorldPosition = worldPosition.xyz;
#endif
}`,fragment$5=`#define STANDARD
#ifdef PHYSICAL
	#define IOR
	#define USE_SPECULAR
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
#ifdef IOR
	uniform float ior;
#endif
#ifdef USE_SPECULAR
	uniform float specularIntensity;
	uniform vec3 specularColor;
	#ifdef USE_SPECULAR_COLORMAP
		uniform sampler2D specularColorMap;
	#endif
	#ifdef USE_SPECULAR_INTENSITYMAP
		uniform sampler2D specularIntensityMap;
	#endif
#endif
#ifdef USE_CLEARCOAT
	uniform float clearcoat;
	uniform float clearcoatRoughness;
#endif
#ifdef USE_DISPERSION
	uniform float dispersion;
#endif
#ifdef USE_IRIDESCENCE
	uniform float iridescence;
	uniform float iridescenceIOR;
	uniform float iridescenceThicknessMinimum;
	uniform float iridescenceThicknessMaximum;
#endif
#ifdef USE_SHEEN
	uniform vec3 sheenColor;
	uniform float sheenRoughness;
	#ifdef USE_SHEEN_COLORMAP
		uniform sampler2D sheenColorMap;
	#endif
	#ifdef USE_SHEEN_ROUGHNESSMAP
		uniform sampler2D sheenRoughnessMap;
	#endif
#endif
#ifdef USE_ANISOTROPY
	uniform vec2 anisotropyVector;
	#ifdef USE_ANISOTROPYMAP
		uniform sampler2D anisotropyMap;
	#endif
#endif
varying vec3 vViewPosition;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <iridescence_fragment>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_physical_pars_fragment>
#include <transmission_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <iridescence_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <roughnessmap_fragment>
	#include <metalnessmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <clearcoat_normal_fragment_begin>
	#include <clearcoat_normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_physical_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;
	vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;
	#include <transmission_fragment>
	vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;
	#ifdef USE_SHEEN
		float sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );
		outgoingLight = outgoingLight * sheenEnergyComp + sheenSpecularDirect + sheenSpecularIndirect;
	#endif
	#ifdef USE_CLEARCOAT
		float dotNVcc = saturate( dot( geometryClearcoatNormal, geometryViewDir ) );
		vec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );
		outgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + ( clearcoatSpecularDirect + clearcoatSpecularIndirect ) * material.clearcoat;
	#endif
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,vertex$4=`#define TOON
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,fragment$4=`#define TOON
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <gradientmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_toon_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_toon_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,vertex$3=`uniform float size;
uniform float scale;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
#ifdef USE_POINTS_UV
	varying vec2 vUv;
	uniform mat3 uvTransform;
#endif
void main() {
	#ifdef USE_POINTS_UV
		vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	#endif
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	gl_PointSize = size;
	#ifdef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );
	#endif
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <fog_vertex>
}`,fragment$3=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <color_pars_fragment>
#include <map_particle_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_particle_fragment>
	#include <color_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,vertex$2=`#include <common>
#include <batching_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <shadowmap_pars_vertex>
void main() {
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,fragment$2=`uniform vec3 color;
uniform float opacity;
#include <common>
#include <packing>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <logdepthbuf_pars_fragment>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
void main() {
	#include <logdepthbuf_fragment>
	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`,vertex$1=`uniform float rotation;
uniform vec2 center;
#include <common>
#include <uv_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	vec4 mvPosition = modelViewMatrix[ 3 ];
	vec2 scale = vec2( length( modelMatrix[ 0 ].xyz ), length( modelMatrix[ 1 ].xyz ) );
	#ifndef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) scale *= - mvPosition.z;
	#endif
	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;
	vec2 rotatedPosition;
	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
	mvPosition.xy += rotatedPosition;
	gl_Position = projectionMatrix * mvPosition;
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,fragment$1=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`,ShaderChunk={alphahash_fragment,alphahash_pars_fragment,alphamap_fragment,alphamap_pars_fragment,alphatest_fragment,alphatest_pars_fragment,aomap_fragment,aomap_pars_fragment,batching_pars_vertex,batching_vertex,begin_vertex,beginnormal_vertex,bsdfs,iridescence_fragment,bumpmap_pars_fragment,clipping_planes_fragment,clipping_planes_pars_fragment,clipping_planes_pars_vertex,clipping_planes_vertex,color_fragment,color_pars_fragment,color_pars_vertex,color_vertex,common,cube_uv_reflection_fragment,defaultnormal_vertex,displacementmap_pars_vertex,displacementmap_vertex,emissivemap_fragment,emissivemap_pars_fragment,colorspace_fragment,colorspace_pars_fragment,envmap_fragment,envmap_common_pars_fragment,envmap_pars_fragment,envmap_pars_vertex,envmap_physical_pars_fragment,envmap_vertex,fog_vertex,fog_pars_vertex,fog_fragment,fog_pars_fragment,gradientmap_pars_fragment,lightmap_pars_fragment,lights_lambert_fragment,lights_lambert_pars_fragment,lights_pars_begin,lights_toon_fragment,lights_toon_pars_fragment,lights_phong_fragment,lights_phong_pars_fragment,lights_physical_fragment,lights_physical_pars_fragment,lights_fragment_begin,lights_fragment_maps,lights_fragment_end,logdepthbuf_fragment,logdepthbuf_pars_fragment,logdepthbuf_pars_vertex,logdepthbuf_vertex,map_fragment,map_pars_fragment,map_particle_fragment,map_particle_pars_fragment,metalnessmap_fragment,metalnessmap_pars_fragment,morphinstance_vertex,morphcolor_vertex,morphnormal_vertex,morphtarget_pars_vertex,morphtarget_vertex,normal_fragment_begin,normal_fragment_maps,normal_pars_fragment,normal_pars_vertex,normal_vertex,normalmap_pars_fragment,clearcoat_normal_fragment_begin,clearcoat_normal_fragment_maps,clearcoat_pars_fragment,iridescence_pars_fragment,opaque_fragment,packing,premultiplied_alpha_fragment,project_vertex,dithering_fragment,dithering_pars_fragment,roughnessmap_fragment,roughnessmap_pars_fragment,shadowmap_pars_fragment,shadowmap_pars_vertex,shadowmap_vertex,shadowmask_pars_fragment,skinbase_vertex,skinning_pars_vertex,skinning_vertex,skinnormal_vertex,specularmap_fragment,specularmap_pars_fragment,tonemapping_fragment,tonemapping_pars_fragment,transmission_fragment,transmission_pars_fragment,uv_pars_fragment,uv_pars_vertex,uv_vertex,worldpos_vertex,background_vert:vertex$h,background_frag:fragment$h,backgroundCube_vert:vertex$g,backgroundCube_frag:fragment$g,cube_vert:vertex$f,cube_frag:fragment$f,depth_vert:vertex$e,depth_frag:fragment$e,distanceRGBA_vert:vertex$d,distanceRGBA_frag:fragment$d,equirect_vert:vertex$c,equirect_frag:fragment$c,linedashed_vert:vertex$b,linedashed_frag:fragment$b,meshbasic_vert:vertex$a,meshbasic_frag:fragment$a,meshlambert_vert:vertex$9,meshlambert_frag:fragment$9,meshmatcap_vert:vertex$8,meshmatcap_frag:fragment$8,meshnormal_vert:vertex$7,meshnormal_frag:fragment$7,meshphong_vert:vertex$6,meshphong_frag:fragment$6,meshphysical_vert:vertex$5,meshphysical_frag:fragment$5,meshtoon_vert:vertex$4,meshtoon_frag:fragment$4,points_vert:vertex$3,points_frag:fragment$3,shadow_vert:vertex$2,shadow_frag:fragment$2,sprite_vert:vertex$1,sprite_frag:fragment$1},UniformsLib={common:{diffuse:{value:new Color$1(16777215)},opacity:{value:1},map:{value:null},mapTransform:{value:new Matrix3},alphaMap:{value:null},alphaMapTransform:{value:new Matrix3},alphaTest:{value:0}},specularmap:{specularMap:{value:null},specularMapTransform:{value:new Matrix3}},envmap:{envMap:{value:null},envMapRotation:{value:new Matrix3},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1},aoMapTransform:{value:new Matrix3}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1},lightMapTransform:{value:new Matrix3}},bumpmap:{bumpMap:{value:null},bumpMapTransform:{value:new Matrix3},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalMapTransform:{value:new Matrix3},normalScale:{value:new Vector2(1,1)}},displacementmap:{displacementMap:{value:null},displacementMapTransform:{value:new Matrix3},displacementScale:{value:1},displacementBias:{value:0}},emissivemap:{emissiveMap:{value:null},emissiveMapTransform:{value:new Matrix3}},metalnessmap:{metalnessMap:{value:null},metalnessMapTransform:{value:new Matrix3}},roughnessmap:{roughnessMap:{value:null},roughnessMapTransform:{value:new Matrix3}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new Color$1(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new Color$1(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaMapTransform:{value:new Matrix3},alphaTest:{value:0},uvTransform:{value:new Matrix3}},sprite:{diffuse:{value:new Color$1(16777215)},opacity:{value:1},center:{value:new Vector2(.5,.5)},rotation:{value:0},map:{value:null},mapTransform:{value:new Matrix3},alphaMap:{value:null},alphaMapTransform:{value:new Matrix3},alphaTest:{value:0}}},ShaderLib={basic:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.specularmap,UniformsLib.envmap,UniformsLib.aomap,UniformsLib.lightmap,UniformsLib.fog]),vertexShader:ShaderChunk.meshbasic_vert,fragmentShader:ShaderChunk.meshbasic_frag},lambert:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.specularmap,UniformsLib.envmap,UniformsLib.aomap,UniformsLib.lightmap,UniformsLib.emissivemap,UniformsLib.bumpmap,UniformsLib.normalmap,UniformsLib.displacementmap,UniformsLib.fog,UniformsLib.lights,{emissive:{value:new Color$1(0)}}]),vertexShader:ShaderChunk.meshlambert_vert,fragmentShader:ShaderChunk.meshlambert_frag},phong:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.specularmap,UniformsLib.envmap,UniformsLib.aomap,UniformsLib.lightmap,UniformsLib.emissivemap,UniformsLib.bumpmap,UniformsLib.normalmap,UniformsLib.displacementmap,UniformsLib.fog,UniformsLib.lights,{emissive:{value:new Color$1(0)},specular:{value:new Color$1(1118481)},shininess:{value:30}}]),vertexShader:ShaderChunk.meshphong_vert,fragmentShader:ShaderChunk.meshphong_frag},standard:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.envmap,UniformsLib.aomap,UniformsLib.lightmap,UniformsLib.emissivemap,UniformsLib.bumpmap,UniformsLib.normalmap,UniformsLib.displacementmap,UniformsLib.roughnessmap,UniformsLib.metalnessmap,UniformsLib.fog,UniformsLib.lights,{emissive:{value:new Color$1(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:ShaderChunk.meshphysical_vert,fragmentShader:ShaderChunk.meshphysical_frag},toon:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.aomap,UniformsLib.lightmap,UniformsLib.emissivemap,UniformsLib.bumpmap,UniformsLib.normalmap,UniformsLib.displacementmap,UniformsLib.gradientmap,UniformsLib.fog,UniformsLib.lights,{emissive:{value:new Color$1(0)}}]),vertexShader:ShaderChunk.meshtoon_vert,fragmentShader:ShaderChunk.meshtoon_frag},matcap:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.bumpmap,UniformsLib.normalmap,UniformsLib.displacementmap,UniformsLib.fog,{matcap:{value:null}}]),vertexShader:ShaderChunk.meshmatcap_vert,fragmentShader:ShaderChunk.meshmatcap_frag},points:{uniforms:mergeUniforms([UniformsLib.points,UniformsLib.fog]),vertexShader:ShaderChunk.points_vert,fragmentShader:ShaderChunk.points_frag},dashed:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:ShaderChunk.linedashed_vert,fragmentShader:ShaderChunk.linedashed_frag},depth:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.displacementmap]),vertexShader:ShaderChunk.depth_vert,fragmentShader:ShaderChunk.depth_frag},normal:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.bumpmap,UniformsLib.normalmap,UniformsLib.displacementmap,{opacity:{value:1}}]),vertexShader:ShaderChunk.meshnormal_vert,fragmentShader:ShaderChunk.meshnormal_frag},sprite:{uniforms:mergeUniforms([UniformsLib.sprite,UniformsLib.fog]),vertexShader:ShaderChunk.sprite_vert,fragmentShader:ShaderChunk.sprite_frag},background:{uniforms:{uvTransform:{value:new Matrix3},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:ShaderChunk.background_vert,fragmentShader:ShaderChunk.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1},backgroundRotation:{value:new Matrix3}},vertexShader:ShaderChunk.backgroundCube_vert,fragmentShader:ShaderChunk.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:ShaderChunk.cube_vert,fragmentShader:ShaderChunk.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:ShaderChunk.equirect_vert,fragmentShader:ShaderChunk.equirect_frag},distanceRGBA:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.displacementmap,{referencePosition:{value:new Vector3},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:ShaderChunk.distanceRGBA_vert,fragmentShader:ShaderChunk.distanceRGBA_frag},shadow:{uniforms:mergeUniforms([UniformsLib.lights,UniformsLib.fog,{color:{value:new Color$1(0)},opacity:{value:1}}]),vertexShader:ShaderChunk.shadow_vert,fragmentShader:ShaderChunk.shadow_frag}};ShaderLib.physical={uniforms:mergeUniforms([ShaderLib.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatMapTransform:{value:new Matrix3},clearcoatNormalMap:{value:null},clearcoatNormalMapTransform:{value:new Matrix3},clearcoatNormalScale:{value:new Vector2(1,1)},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatRoughnessMapTransform:{value:new Matrix3},dispersion:{value:0},iridescence:{value:0},iridescenceMap:{value:null},iridescenceMapTransform:{value:new Matrix3},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},iridescenceThicknessMapTransform:{value:new Matrix3},sheen:{value:0},sheenColor:{value:new Color$1(0)},sheenColorMap:{value:null},sheenColorMapTransform:{value:new Matrix3},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},sheenRoughnessMapTransform:{value:new Matrix3},transmission:{value:0},transmissionMap:{value:null},transmissionMapTransform:{value:new Matrix3},transmissionSamplerSize:{value:new Vector2},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},thicknessMapTransform:{value:new Matrix3},attenuationDistance:{value:0},attenuationColor:{value:new Color$1(0)},specularColor:{value:new Color$1(1,1,1)},specularColorMap:{value:null},specularColorMapTransform:{value:new Matrix3},specularIntensity:{value:1},specularIntensityMap:{value:null},specularIntensityMapTransform:{value:new Matrix3},anisotropyVector:{value:new Vector2},anisotropyMap:{value:null},anisotropyMapTransform:{value:new Matrix3}}]),vertexShader:ShaderChunk.meshphysical_vert,fragmentShader:ShaderChunk.meshphysical_frag};const _rgb={r:0,b:0,g:0},_e1$1=new Euler,_m1$1=new Matrix4;function WebGLBackground(X,Z,_,K,te,ne,ie){const oe=new Color$1(0);let se=ne===!0?0:1,ae,ge,ce=null,de=0,Ie=null;function fe(Be){let Re=Be.isScene===!0?Be.background:null;return Re&&Re.isTexture&&(Re=(Be.backgroundBlurriness>0?_:Z).get(Re)),Re}function be(Be){let Re=!1;const Ve=fe(Be);Ve===null?ye(oe,se):Ve&&Ve.isColor&&(ye(Ve,1),Re=!0);const Ee=X.xr.getEnvironmentBlendMode();Ee==="additive"?K.buffers.color.setClear(0,0,0,1,ie):Ee==="alpha-blend"&&K.buffers.color.setClear(0,0,0,0,ie),(X.autoClear||Re)&&(K.buffers.depth.setTest(!0),K.buffers.depth.setMask(!0),K.buffers.color.setMask(!0),X.clear(X.autoClearColor,X.autoClearDepth,X.autoClearStencil))}function Ae(Be,Re){const Ve=fe(Re);Ve&&(Ve.isCubeTexture||Ve.mapping===CubeUVReflectionMapping)?(ge===void 0&&(ge=new Mesh(new BoxGeometry(1,1,1),new ShaderMaterial({name:"BackgroundCubeMaterial",uniforms:cloneUniforms(ShaderLib.backgroundCube.uniforms),vertexShader:ShaderLib.backgroundCube.vertexShader,fragmentShader:ShaderLib.backgroundCube.fragmentShader,side:BackSide,depthTest:!1,depthWrite:!1,fog:!1})),ge.geometry.deleteAttribute("normal"),ge.geometry.deleteAttribute("uv"),ge.onBeforeRender=function(Ee,Ze,_e){this.matrixWorld.copyPosition(_e.matrixWorld)},Object.defineProperty(ge.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),te.update(ge)),_e1$1.copy(Re.backgroundRotation),_e1$1.x*=-1,_e1$1.y*=-1,_e1$1.z*=-1,Ve.isCubeTexture&&Ve.isRenderTargetTexture===!1&&(_e1$1.y*=-1,_e1$1.z*=-1),ge.material.uniforms.envMap.value=Ve,ge.material.uniforms.flipEnvMap.value=Ve.isCubeTexture&&Ve.isRenderTargetTexture===!1?-1:1,ge.material.uniforms.backgroundBlurriness.value=Re.backgroundBlurriness,ge.material.uniforms.backgroundIntensity.value=Re.backgroundIntensity,ge.material.uniforms.backgroundRotation.value.setFromMatrix4(_m1$1.makeRotationFromEuler(_e1$1)),ge.material.toneMapped=ColorManagement.getTransfer(Ve.colorSpace)!==SRGBTransfer,(ce!==Ve||de!==Ve.version||Ie!==X.toneMapping)&&(ge.material.needsUpdate=!0,ce=Ve,de=Ve.version,Ie=X.toneMapping),ge.layers.enableAll(),Be.unshift(ge,ge.geometry,ge.material,0,0,null)):Ve&&Ve.isTexture&&(ae===void 0&&(ae=new Mesh(new PlaneGeometry(2,2),new ShaderMaterial({name:"BackgroundMaterial",uniforms:cloneUniforms(ShaderLib.background.uniforms),vertexShader:ShaderLib.background.vertexShader,fragmentShader:ShaderLib.background.fragmentShader,side:FrontSide,depthTest:!1,depthWrite:!1,fog:!1})),ae.geometry.deleteAttribute("normal"),Object.defineProperty(ae.material,"map",{get:function(){return this.uniforms.t2D.value}}),te.update(ae)),ae.material.uniforms.t2D.value=Ve,ae.material.uniforms.backgroundIntensity.value=Re.backgroundIntensity,ae.material.toneMapped=ColorManagement.getTransfer(Ve.colorSpace)!==SRGBTransfer,Ve.matrixAutoUpdate===!0&&Ve.updateMatrix(),ae.material.uniforms.uvTransform.value.copy(Ve.matrix),(ce!==Ve||de!==Ve.version||Ie!==X.toneMapping)&&(ae.material.needsUpdate=!0,ce=Ve,de=Ve.version,Ie=X.toneMapping),ae.layers.enableAll(),Be.unshift(ae,ae.geometry,ae.material,0,0,null))}function ye(Be,Re){Be.getRGB(_rgb,getUnlitUniformColorSpace(X)),K.buffers.color.setClear(_rgb.r,_rgb.g,_rgb.b,Re,ie)}function ve(){ge!==void 0&&(ge.geometry.dispose(),ge.material.dispose()),ae!==void 0&&(ae.geometry.dispose(),ae.material.dispose())}return{getClearColor:function(){return oe},setClearColor:function(Be,Re=1){oe.set(Be),se=Re,ye(oe,se)},getClearAlpha:function(){return se},setClearAlpha:function(Be){se=Be,ye(oe,se)},render:be,addToRenderList:Ae,dispose:ve}}function WebGLBindingStates(X,Z){const _=X.getParameter(X.MAX_VERTEX_ATTRIBS),K={},te=de(null);let ne=te,ie=!1;function oe(Te,ke,Le,Ke,Ue){let rt=!1;const tt=ce(Ke,Le,ke);ne!==tt&&(ne=tt,ae(ne.object)),rt=Ie(Te,Ke,Le,Ue),rt&&fe(Te,Ke,Le,Ue),Ue!==null&&Z.update(Ue,X.ELEMENT_ARRAY_BUFFER),(rt||ie)&&(ie=!1,Re(Te,ke,Le,Ke),Ue!==null&&X.bindBuffer(X.ELEMENT_ARRAY_BUFFER,Z.get(Ue).buffer))}function se(){return X.createVertexArray()}function ae(Te){return X.bindVertexArray(Te)}function ge(Te){return X.deleteVertexArray(Te)}function ce(Te,ke,Le){const Ke=Le.wireframe===!0;let Ue=K[Te.id];Ue===void 0&&(Ue={},K[Te.id]=Ue);let rt=Ue[ke.id];rt===void 0&&(rt={},Ue[ke.id]=rt);let tt=rt[Ke];return tt===void 0&&(tt=de(se()),rt[Ke]=tt),tt}function de(Te){const ke=[],Le=[],Ke=[];for(let Ue=0;Ue<_;Ue++)ke[Ue]=0,Le[Ue]=0,Ke[Ue]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:ke,enabledAttributes:Le,attributeDivisors:Ke,object:Te,attributes:{},index:null}}function Ie(Te,ke,Le,Ke){const Ue=ne.attributes,rt=ke.attributes;let tt=0;const at=Le.getAttributes();for(const ze in at)if(at[ze].location>=0){const Pe=Ue[ze];let Ye=rt[ze];if(Ye===void 0&&(ze==="instanceMatrix"&&Te.instanceMatrix&&(Ye=Te.instanceMatrix),ze==="instanceColor"&&Te.instanceColor&&(Ye=Te.instanceColor)),Pe===void 0||Pe.attribute!==Ye||Ye&&Pe.data!==Ye.data)return!0;tt++}return ne.attributesNum!==tt||ne.index!==Ke}function fe(Te,ke,Le,Ke){const Ue={},rt=ke.attributes;let tt=0;const at=Le.getAttributes();for(const ze in at)if(at[ze].location>=0){let Pe=rt[ze];Pe===void 0&&(ze==="instanceMatrix"&&Te.instanceMatrix&&(Pe=Te.instanceMatrix),ze==="instanceColor"&&Te.instanceColor&&(Pe=Te.instanceColor));const Ye={};Ye.attribute=Pe,Pe&&Pe.data&&(Ye.data=Pe.data),Ue[ze]=Ye,tt++}ne.attributes=Ue,ne.attributesNum=tt,ne.index=Ke}function be(){const Te=ne.newAttributes;for(let ke=0,Le=Te.length;ke<Le;ke++)Te[ke]=0}function Ae(Te){ye(Te,0)}function ye(Te,ke){const Le=ne.newAttributes,Ke=ne.enabledAttributes,Ue=ne.attributeDivisors;Le[Te]=1,Ke[Te]===0&&(X.enableVertexAttribArray(Te),Ke[Te]=1),Ue[Te]!==ke&&(X.vertexAttribDivisor(Te,ke),Ue[Te]=ke)}function ve(){const Te=ne.newAttributes,ke=ne.enabledAttributes;for(let Le=0,Ke=ke.length;Le<Ke;Le++)ke[Le]!==Te[Le]&&(X.disableVertexAttribArray(Le),ke[Le]=0)}function Be(Te,ke,Le,Ke,Ue,rt,tt){tt===!0?X.vertexAttribIPointer(Te,ke,Le,Ue,rt):X.vertexAttribPointer(Te,ke,Le,Ke,Ue,rt)}function Re(Te,ke,Le,Ke){be();const Ue=Ke.attributes,rt=Le.getAttributes(),tt=ke.defaultAttributeValues;for(const at in rt){const ze=rt[at];if(ze.location>=0){let qe=Ue[at];if(qe===void 0&&(at==="instanceMatrix"&&Te.instanceMatrix&&(qe=Te.instanceMatrix),at==="instanceColor"&&Te.instanceColor&&(qe=Te.instanceColor)),qe!==void 0){const Pe=qe.normalized,Ye=qe.itemSize,$e=Z.get(qe);if($e===void 0)continue;const ut=$e.buffer,ot=$e.type,gt=$e.bytesPerElement,ht=ot===X.INT||ot===X.UNSIGNED_INT||qe.gpuType===IntType;if(qe.isInterleavedBufferAttribute){const dt=qe.data,bt=dt.stride,Ht=qe.offset;if(dt.isInstancedInterleavedBuffer){for(let Dt=0;Dt<ze.locationSize;Dt++)ye(ze.location+Dt,dt.meshPerAttribute);Te.isInstancedMesh!==!0&&Ke._maxInstanceCount===void 0&&(Ke._maxInstanceCount=dt.meshPerAttribute*dt.count)}else for(let Dt=0;Dt<ze.locationSize;Dt++)Ae(ze.location+Dt);X.bindBuffer(X.ARRAY_BUFFER,ut);for(let Dt=0;Dt<ze.locationSize;Dt++)Be(ze.location+Dt,Ye/ze.locationSize,ot,Pe,bt*gt,(Ht+Ye/ze.locationSize*Dt)*gt,ht)}else{if(qe.isInstancedBufferAttribute){for(let dt=0;dt<ze.locationSize;dt++)ye(ze.location+dt,qe.meshPerAttribute);Te.isInstancedMesh!==!0&&Ke._maxInstanceCount===void 0&&(Ke._maxInstanceCount=qe.meshPerAttribute*qe.count)}else for(let dt=0;dt<ze.locationSize;dt++)Ae(ze.location+dt);X.bindBuffer(X.ARRAY_BUFFER,ut);for(let dt=0;dt<ze.locationSize;dt++)Be(ze.location+dt,Ye/ze.locationSize,ot,Pe,Ye*gt,Ye/ze.locationSize*dt*gt,ht)}}else if(tt!==void 0){const Pe=tt[at];if(Pe!==void 0)switch(Pe.length){case 2:X.vertexAttrib2fv(ze.location,Pe);break;case 3:X.vertexAttrib3fv(ze.location,Pe);break;case 4:X.vertexAttrib4fv(ze.location,Pe);break;default:X.vertexAttrib1fv(ze.location,Pe)}}}}ve()}function Ve(){_e();for(const Te in K){const ke=K[Te];for(const Le in ke){const Ke=ke[Le];for(const Ue in Ke)ge(Ke[Ue].object),delete Ke[Ue];delete ke[Le]}delete K[Te]}}function Ee(Te){if(K[Te.id]===void 0)return;const ke=K[Te.id];for(const Le in ke){const Ke=ke[Le];for(const Ue in Ke)ge(Ke[Ue].object),delete Ke[Ue];delete ke[Le]}delete K[Te.id]}function Ze(Te){for(const ke in K){const Le=K[ke];if(Le[Te.id]===void 0)continue;const Ke=Le[Te.id];for(const Ue in Ke)ge(Ke[Ue].object),delete Ke[Ue];delete Le[Te.id]}}function _e(){Fe(),ie=!0,ne!==te&&(ne=te,ae(ne.object))}function Fe(){te.geometry=null,te.program=null,te.wireframe=!1}return{setup:oe,reset:_e,resetDefaultState:Fe,dispose:Ve,releaseStatesOfGeometry:Ee,releaseStatesOfProgram:Ze,initAttributes:be,enableAttribute:Ae,disableUnusedAttributes:ve}}function WebGLBufferRenderer(X,Z,_){let K;function te(ae){K=ae}function ne(ae,ge){X.drawArrays(K,ae,ge),_.update(ge,K,1)}function ie(ae,ge,ce){ce!==0&&(X.drawArraysInstanced(K,ae,ge,ce),_.update(ge,K,ce))}function oe(ae,ge,ce){if(ce===0)return;Z.get("WEBGL_multi_draw").multiDrawArraysWEBGL(K,ae,0,ge,0,ce);let Ie=0;for(let fe=0;fe<ce;fe++)Ie+=ge[fe];_.update(Ie,K,1)}function se(ae,ge,ce,de){if(ce===0)return;const Ie=Z.get("WEBGL_multi_draw");if(Ie===null)for(let fe=0;fe<ae.length;fe++)ie(ae[fe],ge[fe],de[fe]);else{Ie.multiDrawArraysInstancedWEBGL(K,ae,0,ge,0,de,0,ce);let fe=0;for(let be=0;be<ce;be++)fe+=ge[be]*de[be];_.update(fe,K,1)}}this.setMode=te,this.render=ne,this.renderInstances=ie,this.renderMultiDraw=oe,this.renderMultiDrawInstances=se}function WebGLCapabilities(X,Z,_,K){let te;function ne(){if(te!==void 0)return te;if(Z.has("EXT_texture_filter_anisotropic")===!0){const Ze=Z.get("EXT_texture_filter_anisotropic");te=X.getParameter(Ze.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else te=0;return te}function ie(Ze){return!(Ze!==RGBAFormat&&K.convert(Ze)!==X.getParameter(X.IMPLEMENTATION_COLOR_READ_FORMAT))}function oe(Ze){const _e=Ze===HalfFloatType&&(Z.has("EXT_color_buffer_half_float")||Z.has("EXT_color_buffer_float"));return!(Ze!==UnsignedByteType&&K.convert(Ze)!==X.getParameter(X.IMPLEMENTATION_COLOR_READ_TYPE)&&Ze!==FloatType&&!_e)}function se(Ze){if(Ze==="highp"){if(X.getShaderPrecisionFormat(X.VERTEX_SHADER,X.HIGH_FLOAT).precision>0&&X.getShaderPrecisionFormat(X.FRAGMENT_SHADER,X.HIGH_FLOAT).precision>0)return"highp";Ze="mediump"}return Ze==="mediump"&&X.getShaderPrecisionFormat(X.VERTEX_SHADER,X.MEDIUM_FLOAT).precision>0&&X.getShaderPrecisionFormat(X.FRAGMENT_SHADER,X.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}let ae=_.precision!==void 0?_.precision:"highp";const ge=se(ae);ge!==ae&&(console.warn("THREE.WebGLRenderer:",ae,"not supported, using",ge,"instead."),ae=ge);const ce=_.logarithmicDepthBuffer===!0,de=_.reverseDepthBuffer===!0&&Z.has("EXT_clip_control"),Ie=X.getParameter(X.MAX_TEXTURE_IMAGE_UNITS),fe=X.getParameter(X.MAX_VERTEX_TEXTURE_IMAGE_UNITS),be=X.getParameter(X.MAX_TEXTURE_SIZE),Ae=X.getParameter(X.MAX_CUBE_MAP_TEXTURE_SIZE),ye=X.getParameter(X.MAX_VERTEX_ATTRIBS),ve=X.getParameter(X.MAX_VERTEX_UNIFORM_VECTORS),Be=X.getParameter(X.MAX_VARYING_VECTORS),Re=X.getParameter(X.MAX_FRAGMENT_UNIFORM_VECTORS),Ve=fe>0,Ee=X.getParameter(X.MAX_SAMPLES);return{isWebGL2:!0,getMaxAnisotropy:ne,getMaxPrecision:se,textureFormatReadable:ie,textureTypeReadable:oe,precision:ae,logarithmicDepthBuffer:ce,reverseDepthBuffer:de,maxTextures:Ie,maxVertexTextures:fe,maxTextureSize:be,maxCubemapSize:Ae,maxAttributes:ye,maxVertexUniforms:ve,maxVaryings:Be,maxFragmentUniforms:Re,vertexTextures:Ve,maxSamples:Ee}}function WebGLClipping(X){const Z=this;let _=null,K=0,te=!1,ne=!1;const ie=new Plane,oe=new Matrix3,se={value:null,needsUpdate:!1};this.uniform=se,this.numPlanes=0,this.numIntersection=0,this.init=function(ce,de){const Ie=ce.length!==0||de||K!==0||te;return te=de,K=ce.length,Ie},this.beginShadows=function(){ne=!0,ge(null)},this.endShadows=function(){ne=!1},this.setGlobalState=function(ce,de){_=ge(ce,de,0)},this.setState=function(ce,de,Ie){const fe=ce.clippingPlanes,be=ce.clipIntersection,Ae=ce.clipShadows,ye=X.get(ce);if(!te||fe===null||fe.length===0||ne&&!Ae)ne?ge(null):ae();else{const ve=ne?0:K,Be=ve*4;let Re=ye.clippingState||null;se.value=Re,Re=ge(fe,de,Be,Ie);for(let Ve=0;Ve!==Be;++Ve)Re[Ve]=_[Ve];ye.clippingState=Re,this.numIntersection=be?this.numPlanes:0,this.numPlanes+=ve}};function ae(){se.value!==_&&(se.value=_,se.needsUpdate=K>0),Z.numPlanes=K,Z.numIntersection=0}function ge(ce,de,Ie,fe){const be=ce!==null?ce.length:0;let Ae=null;if(be!==0){if(Ae=se.value,fe!==!0||Ae===null){const ye=Ie+be*4,ve=de.matrixWorldInverse;oe.getNormalMatrix(ve),(Ae===null||Ae.length<ye)&&(Ae=new Float32Array(ye));for(let Be=0,Re=Ie;Be!==be;++Be,Re+=4)ie.copy(ce[Be]).applyMatrix4(ve,oe),ie.normal.toArray(Ae,Re),Ae[Re+3]=ie.constant}se.value=Ae,se.needsUpdate=!0}return Z.numPlanes=be,Z.numIntersection=0,Ae}}function WebGLCubeMaps(X){let Z=new WeakMap;function _(ie,oe){return oe===EquirectangularReflectionMapping?ie.mapping=CubeReflectionMapping:oe===EquirectangularRefractionMapping&&(ie.mapping=CubeRefractionMapping),ie}function K(ie){if(ie&&ie.isTexture){const oe=ie.mapping;if(oe===EquirectangularReflectionMapping||oe===EquirectangularRefractionMapping)if(Z.has(ie)){const se=Z.get(ie).texture;return _(se,ie.mapping)}else{const se=ie.image;if(se&&se.height>0){const ae=new WebGLCubeRenderTarget(se.height);return ae.fromEquirectangularTexture(X,ie),Z.set(ie,ae),ie.addEventListener("dispose",te),_(ae.texture,ie.mapping)}else return null}}return ie}function te(ie){const oe=ie.target;oe.removeEventListener("dispose",te);const se=Z.get(oe);se!==void 0&&(Z.delete(oe),se.dispose())}function ne(){Z=new WeakMap}return{get:K,dispose:ne}}const LOD_MIN=4,EXTRA_LOD_SIGMA=[.125,.215,.35,.446,.526,.582],MAX_SAMPLES=20,_flatCamera=new OrthographicCamera,_clearColor=new Color$1;let _oldTarget=null,_oldActiveCubeFace=0,_oldActiveMipmapLevel=0,_oldXrEnabled=!1;const PHI=(1+Math.sqrt(5))/2,INV_PHI=1/PHI,_axisDirections=[new Vector3(-PHI,INV_PHI,0),new Vector3(PHI,INV_PHI,0),new Vector3(-INV_PHI,0,PHI),new Vector3(INV_PHI,0,PHI),new Vector3(0,PHI,-INV_PHI),new Vector3(0,PHI,INV_PHI),new Vector3(-1,1,-1),new Vector3(1,1,-1),new Vector3(-1,1,1),new Vector3(1,1,1)];class PMREMGenerator{constructor(Z){this._renderer=Z,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(Z,_=0,K=.1,te=100){_oldTarget=this._renderer.getRenderTarget(),_oldActiveCubeFace=this._renderer.getActiveCubeFace(),_oldActiveMipmapLevel=this._renderer.getActiveMipmapLevel(),_oldXrEnabled=this._renderer.xr.enabled,this._renderer.xr.enabled=!1,this._setSize(256);const ne=this._allocateTargets();return ne.depthBuffer=!0,this._sceneToCubeUV(Z,K,te,ne),_>0&&this._blur(ne,0,0,_),this._applyPMREM(ne),this._cleanup(ne),ne}fromEquirectangular(Z,_=null){return this._fromTexture(Z,_)}fromCubemap(Z,_=null){return this._fromTexture(Z,_)}compileCubemapShader(){this._cubemapMaterial===null&&(this._cubemapMaterial=_getCubemapMaterial(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){this._equirectMaterial===null&&(this._equirectMaterial=_getEquirectMaterial(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),this._cubemapMaterial!==null&&this._cubemapMaterial.dispose(),this._equirectMaterial!==null&&this._equirectMaterial.dispose()}_setSize(Z){this._lodMax=Math.floor(Math.log2(Z)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){this._blurMaterial!==null&&this._blurMaterial.dispose(),this._pingPongRenderTarget!==null&&this._pingPongRenderTarget.dispose();for(let Z=0;Z<this._lodPlanes.length;Z++)this._lodPlanes[Z].dispose()}_cleanup(Z){this._renderer.setRenderTarget(_oldTarget,_oldActiveCubeFace,_oldActiveMipmapLevel),this._renderer.xr.enabled=_oldXrEnabled,Z.scissorTest=!1,_setViewport(Z,0,0,Z.width,Z.height)}_fromTexture(Z,_){Z.mapping===CubeReflectionMapping||Z.mapping===CubeRefractionMapping?this._setSize(Z.image.length===0?16:Z.image[0].width||Z.image[0].image.width):this._setSize(Z.image.width/4),_oldTarget=this._renderer.getRenderTarget(),_oldActiveCubeFace=this._renderer.getActiveCubeFace(),_oldActiveMipmapLevel=this._renderer.getActiveMipmapLevel(),_oldXrEnabled=this._renderer.xr.enabled,this._renderer.xr.enabled=!1;const K=_||this._allocateTargets();return this._textureToCubeUV(Z,K),this._applyPMREM(K),this._cleanup(K),K}_allocateTargets(){const Z=3*Math.max(this._cubeSize,112),_=4*this._cubeSize,K={magFilter:LinearFilter,minFilter:LinearFilter,generateMipmaps:!1,type:HalfFloatType,format:RGBAFormat,colorSpace:LinearSRGBColorSpace$1,depthBuffer:!1},te=_createRenderTarget(Z,_,K);if(this._pingPongRenderTarget===null||this._pingPongRenderTarget.width!==Z||this._pingPongRenderTarget.height!==_){this._pingPongRenderTarget!==null&&this._dispose(),this._pingPongRenderTarget=_createRenderTarget(Z,_,K);const{_lodMax:ne}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=_createPlanes(ne)),this._blurMaterial=_getBlurShader(ne,Z,_)}return te}_compileMaterial(Z){const _=new Mesh(this._lodPlanes[0],Z);this._renderer.compile(_,_flatCamera)}_sceneToCubeUV(Z,_,K,te){const oe=new PerspectiveCamera(90,1,_,K),se=[1,-1,1,1,1,1],ae=[1,1,1,-1,-1,-1],ge=this._renderer,ce=ge.autoClear,de=ge.toneMapping;ge.getClearColor(_clearColor),ge.toneMapping=NoToneMapping,ge.autoClear=!1;const Ie=new MeshBasicMaterial({name:"PMREM.Background",side:BackSide,depthWrite:!1,depthTest:!1}),fe=new Mesh(new BoxGeometry,Ie);let be=!1;const Ae=Z.background;Ae?Ae.isColor&&(Ie.color.copy(Ae),Z.background=null,be=!0):(Ie.color.copy(_clearColor),be=!0);for(let ye=0;ye<6;ye++){const ve=ye%3;ve===0?(oe.up.set(0,se[ye],0),oe.lookAt(ae[ye],0,0)):ve===1?(oe.up.set(0,0,se[ye]),oe.lookAt(0,ae[ye],0)):(oe.up.set(0,se[ye],0),oe.lookAt(0,0,ae[ye]));const Be=this._cubeSize;_setViewport(te,ve*Be,ye>2?Be:0,Be,Be),ge.setRenderTarget(te),be&&ge.render(fe,oe),ge.render(Z,oe)}fe.geometry.dispose(),fe.material.dispose(),ge.toneMapping=de,ge.autoClear=ce,Z.background=Ae}_textureToCubeUV(Z,_){const K=this._renderer,te=Z.mapping===CubeReflectionMapping||Z.mapping===CubeRefractionMapping;te?(this._cubemapMaterial===null&&(this._cubemapMaterial=_getCubemapMaterial()),this._cubemapMaterial.uniforms.flipEnvMap.value=Z.isRenderTargetTexture===!1?-1:1):this._equirectMaterial===null&&(this._equirectMaterial=_getEquirectMaterial());const ne=te?this._cubemapMaterial:this._equirectMaterial,ie=new Mesh(this._lodPlanes[0],ne),oe=ne.uniforms;oe.envMap.value=Z;const se=this._cubeSize;_setViewport(_,0,0,3*se,2*se),K.setRenderTarget(_),K.render(ie,_flatCamera)}_applyPMREM(Z){const _=this._renderer,K=_.autoClear;_.autoClear=!1;const te=this._lodPlanes.length;for(let ne=1;ne<te;ne++){const ie=Math.sqrt(this._sigmas[ne]*this._sigmas[ne]-this._sigmas[ne-1]*this._sigmas[ne-1]),oe=_axisDirections[(te-ne-1)%_axisDirections.length];this._blur(Z,ne-1,ne,ie,oe)}_.autoClear=K}_blur(Z,_,K,te,ne){const ie=this._pingPongRenderTarget;this._halfBlur(Z,ie,_,K,te,"latitudinal",ne),this._halfBlur(ie,Z,K,K,te,"longitudinal",ne)}_halfBlur(Z,_,K,te,ne,ie,oe){const se=this._renderer,ae=this._blurMaterial;ie!=="latitudinal"&&ie!=="longitudinal"&&console.error("blur direction must be either latitudinal or longitudinal!");const ge=3,ce=new Mesh(this._lodPlanes[te],ae),de=ae.uniforms,Ie=this._sizeLods[K]-1,fe=isFinite(ne)?Math.PI/(2*Ie):2*Math.PI/(2*MAX_SAMPLES-1),be=ne/fe,Ae=isFinite(ne)?1+Math.floor(ge*be):MAX_SAMPLES;Ae>MAX_SAMPLES&&console.warn(`sigmaRadians, ${ne}, is too large and will clip, as it requested ${Ae} samples when the maximum is set to ${MAX_SAMPLES}`);const ye=[];let ve=0;for(let Ze=0;Ze<MAX_SAMPLES;++Ze){const _e=Ze/be,Fe=Math.exp(-_e*_e/2);ye.push(Fe),Ze===0?ve+=Fe:Ze<Ae&&(ve+=2*Fe)}for(let Ze=0;Ze<ye.length;Ze++)ye[Ze]=ye[Ze]/ve;de.envMap.value=Z.texture,de.samples.value=Ae,de.weights.value=ye,de.latitudinal.value=ie==="latitudinal",oe&&(de.poleAxis.value=oe);const{_lodMax:Be}=this;de.dTheta.value=fe,de.mipInt.value=Be-K;const Re=this._sizeLods[te],Ve=3*Re*(te>Be-LOD_MIN?te-Be+LOD_MIN:0),Ee=4*(this._cubeSize-Re);_setViewport(_,Ve,Ee,3*Re,2*Re),se.setRenderTarget(_),se.render(ce,_flatCamera)}}function _createPlanes(X){const Z=[],_=[],K=[];let te=X;const ne=X-LOD_MIN+1+EXTRA_LOD_SIGMA.length;for(let ie=0;ie<ne;ie++){const oe=Math.pow(2,te);_.push(oe);let se=1/oe;ie>X-LOD_MIN?se=EXTRA_LOD_SIGMA[ie-X+LOD_MIN-1]:ie===0&&(se=0),K.push(se);const ae=1/(oe-2),ge=-ae,ce=1+ae,de=[ge,ge,ce,ge,ce,ce,ge,ge,ce,ce,ge,ce],Ie=6,fe=6,be=3,Ae=2,ye=1,ve=new Float32Array(be*fe*Ie),Be=new Float32Array(Ae*fe*Ie),Re=new Float32Array(ye*fe*Ie);for(let Ee=0;Ee<Ie;Ee++){const Ze=Ee%3*2/3-1,_e=Ee>2?0:-1,Fe=[Ze,_e,0,Ze+2/3,_e,0,Ze+2/3,_e+1,0,Ze,_e,0,Ze+2/3,_e+1,0,Ze,_e+1,0];ve.set(Fe,be*fe*Ee),Be.set(de,Ae*fe*Ee);const Te=[Ee,Ee,Ee,Ee,Ee,Ee];Re.set(Te,ye*fe*Ee)}const Ve=new BufferGeometry;Ve.setAttribute("position",new BufferAttribute(ve,be)),Ve.setAttribute("uv",new BufferAttribute(Be,Ae)),Ve.setAttribute("faceIndex",new BufferAttribute(Re,ye)),Z.push(Ve),te>LOD_MIN&&te--}return{lodPlanes:Z,sizeLods:_,sigmas:K}}function _createRenderTarget(X,Z,_){const K=new WebGLRenderTarget(X,Z,_);return K.texture.mapping=CubeUVReflectionMapping,K.texture.name="PMREM.cubeUv",K.scissorTest=!0,K}function _setViewport(X,Z,_,K,te){X.viewport.set(Z,_,K,te),X.scissor.set(Z,_,K,te)}function _getBlurShader(X,Z,_){const K=new Float32Array(MAX_SAMPLES),te=new Vector3(0,1,0);return new ShaderMaterial({name:"SphericalGaussianBlur",defines:{n:MAX_SAMPLES,CUBEUV_TEXEL_WIDTH:1/Z,CUBEUV_TEXEL_HEIGHT:1/_,CUBEUV_MAX_MIP:`${X}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:K},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:te}},vertexShader:_getCommonVertexShader(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform int samples;
			uniform float weights[ n ];
			uniform bool latitudinal;
			uniform float dTheta;
			uniform float mipInt;
			uniform vec3 poleAxis;

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			vec3 getSample( float theta, vec3 axis ) {

				float cosTheta = cos( theta );
				// Rodrigues' axis-angle rotation
				vec3 sampleDirection = vOutputDirection * cosTheta
					+ cross( axis, vOutputDirection ) * sin( theta )
					+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );

				return bilinearCubeUV( envMap, sampleDirection, mipInt );

			}

			void main() {

				vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );

				if ( all( equal( axis, vec3( 0.0 ) ) ) ) {

					axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );

				}

				axis = normalize( axis );

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );

				for ( int i = 1; i < n; i++ ) {

					if ( i >= samples ) {

						break;

					}

					float theta = dTheta * float( i );
					gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );
					gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );

				}

			}
		`,blending:NoBlending,depthTest:!1,depthWrite:!1})}function _getEquirectMaterial(){return new ShaderMaterial({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:_getCommonVertexShader(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;

			#include <common>

			void main() {

				vec3 outputDirection = normalize( vOutputDirection );
				vec2 uv = equirectUv( outputDirection );

				gl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );

			}
		`,blending:NoBlending,depthTest:!1,depthWrite:!1})}function _getCubemapMaterial(){return new ShaderMaterial({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:_getCommonVertexShader(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			uniform float flipEnvMap;

			varying vec3 vOutputDirection;

			uniform samplerCube envMap;

			void main() {

				gl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );

			}
		`,blending:NoBlending,depthTest:!1,depthWrite:!1})}function _getCommonVertexShader(){return`

		precision mediump float;
		precision mediump int;

		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`}function WebGLCubeUVMaps(X){let Z=new WeakMap,_=null;function K(oe){if(oe&&oe.isTexture){const se=oe.mapping,ae=se===EquirectangularReflectionMapping||se===EquirectangularRefractionMapping,ge=se===CubeReflectionMapping||se===CubeRefractionMapping;if(ae||ge){let ce=Z.get(oe);const de=ce!==void 0?ce.texture.pmremVersion:0;if(oe.isRenderTargetTexture&&oe.pmremVersion!==de)return _===null&&(_=new PMREMGenerator(X)),ce=ae?_.fromEquirectangular(oe,ce):_.fromCubemap(oe,ce),ce.texture.pmremVersion=oe.pmremVersion,Z.set(oe,ce),ce.texture;if(ce!==void 0)return ce.texture;{const Ie=oe.image;return ae&&Ie&&Ie.height>0||ge&&Ie&&te(Ie)?(_===null&&(_=new PMREMGenerator(X)),ce=ae?_.fromEquirectangular(oe):_.fromCubemap(oe),ce.texture.pmremVersion=oe.pmremVersion,Z.set(oe,ce),oe.addEventListener("dispose",ne),ce.texture):null}}}return oe}function te(oe){let se=0;const ae=6;for(let ge=0;ge<ae;ge++)oe[ge]!==void 0&&se++;return se===ae}function ne(oe){const se=oe.target;se.removeEventListener("dispose",ne);const ae=Z.get(se);ae!==void 0&&(Z.delete(se),ae.dispose())}function ie(){Z=new WeakMap,_!==null&&(_.dispose(),_=null)}return{get:K,dispose:ie}}function WebGLExtensions(X){const Z={};function _(K){if(Z[K]!==void 0)return Z[K];let te;switch(K){case"WEBGL_depth_texture":te=X.getExtension("WEBGL_depth_texture")||X.getExtension("MOZ_WEBGL_depth_texture")||X.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":te=X.getExtension("EXT_texture_filter_anisotropic")||X.getExtension("MOZ_EXT_texture_filter_anisotropic")||X.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":te=X.getExtension("WEBGL_compressed_texture_s3tc")||X.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||X.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":te=X.getExtension("WEBGL_compressed_texture_pvrtc")||X.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:te=X.getExtension(K)}return Z[K]=te,te}return{has:function(K){return _(K)!==null},init:function(){_("EXT_color_buffer_float"),_("WEBGL_clip_cull_distance"),_("OES_texture_float_linear"),_("EXT_color_buffer_half_float"),_("WEBGL_multisampled_render_to_texture"),_("WEBGL_render_shared_exponent")},get:function(K){const te=_(K);return te===null&&warnOnce("THREE.WebGLRenderer: "+K+" extension not supported."),te}}}function WebGLGeometries(X,Z,_,K){const te={},ne=new WeakMap;function ie(ce){const de=ce.target;de.index!==null&&Z.remove(de.index);for(const fe in de.attributes)Z.remove(de.attributes[fe]);de.removeEventListener("dispose",ie),delete te[de.id];const Ie=ne.get(de);Ie&&(Z.remove(Ie),ne.delete(de)),K.releaseStatesOfGeometry(de),de.isInstancedBufferGeometry===!0&&delete de._maxInstanceCount,_.memory.geometries--}function oe(ce,de){return te[de.id]===!0||(de.addEventListener("dispose",ie),te[de.id]=!0,_.memory.geometries++),de}function se(ce){const de=ce.attributes;for(const Ie in de)Z.update(de[Ie],X.ARRAY_BUFFER)}function ae(ce){const de=[],Ie=ce.index,fe=ce.attributes.position;let be=0;if(Ie!==null){const ve=Ie.array;be=Ie.version;for(let Be=0,Re=ve.length;Be<Re;Be+=3){const Ve=ve[Be+0],Ee=ve[Be+1],Ze=ve[Be+2];de.push(Ve,Ee,Ee,Ze,Ze,Ve)}}else if(fe!==void 0){const ve=fe.array;be=fe.version;for(let Be=0,Re=ve.length/3-1;Be<Re;Be+=3){const Ve=Be+0,Ee=Be+1,Ze=Be+2;de.push(Ve,Ee,Ee,Ze,Ze,Ve)}}else return;const Ae=new(arrayNeedsUint32(de)?Uint32BufferAttribute:Uint16BufferAttribute)(de,1);Ae.version=be;const ye=ne.get(ce);ye&&Z.remove(ye),ne.set(ce,Ae)}function ge(ce){const de=ne.get(ce);if(de){const Ie=ce.index;Ie!==null&&de.version<Ie.version&&ae(ce)}else ae(ce);return ne.get(ce)}return{get:oe,update:se,getWireframeAttribute:ge}}function WebGLIndexedBufferRenderer(X,Z,_){let K;function te(de){K=de}let ne,ie;function oe(de){ne=de.type,ie=de.bytesPerElement}function se(de,Ie){X.drawElements(K,Ie,ne,de*ie),_.update(Ie,K,1)}function ae(de,Ie,fe){fe!==0&&(X.drawElementsInstanced(K,Ie,ne,de*ie,fe),_.update(Ie,K,fe))}function ge(de,Ie,fe){if(fe===0)return;Z.get("WEBGL_multi_draw").multiDrawElementsWEBGL(K,Ie,0,ne,de,0,fe);let Ae=0;for(let ye=0;ye<fe;ye++)Ae+=Ie[ye];_.update(Ae,K,1)}function ce(de,Ie,fe,be){if(fe===0)return;const Ae=Z.get("WEBGL_multi_draw");if(Ae===null)for(let ye=0;ye<de.length;ye++)ae(de[ye]/ie,Ie[ye],be[ye]);else{Ae.multiDrawElementsInstancedWEBGL(K,Ie,0,ne,de,0,be,0,fe);let ye=0;for(let ve=0;ve<fe;ve++)ye+=Ie[ve]*be[ve];_.update(ye,K,1)}}this.setMode=te,this.setIndex=oe,this.render=se,this.renderInstances=ae,this.renderMultiDraw=ge,this.renderMultiDrawInstances=ce}function WebGLInfo(X){const Z={geometries:0,textures:0},_={frame:0,calls:0,triangles:0,points:0,lines:0};function K(ne,ie,oe){switch(_.calls++,ie){case X.TRIANGLES:_.triangles+=oe*(ne/3);break;case X.LINES:_.lines+=oe*(ne/2);break;case X.LINE_STRIP:_.lines+=oe*(ne-1);break;case X.LINE_LOOP:_.lines+=oe*ne;break;case X.POINTS:_.points+=oe*ne;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",ie);break}}function te(){_.calls=0,_.triangles=0,_.points=0,_.lines=0}return{memory:Z,render:_,programs:null,autoReset:!0,reset:te,update:K}}function WebGLMorphtargets(X,Z,_){const K=new WeakMap,te=new Vector4;function ne(ie,oe,se){const ae=ie.morphTargetInfluences,ge=oe.morphAttributes.position||oe.morphAttributes.normal||oe.morphAttributes.color,ce=ge!==void 0?ge.length:0;let de=K.get(oe);if(de===void 0||de.count!==ce){let Te=function(){_e.dispose(),K.delete(oe),oe.removeEventListener("dispose",Te)};var Ie=Te;de!==void 0&&de.texture.dispose();const fe=oe.morphAttributes.position!==void 0,be=oe.morphAttributes.normal!==void 0,Ae=oe.morphAttributes.color!==void 0,ye=oe.morphAttributes.position||[],ve=oe.morphAttributes.normal||[],Be=oe.morphAttributes.color||[];let Re=0;fe===!0&&(Re=1),be===!0&&(Re=2),Ae===!0&&(Re=3);let Ve=oe.attributes.position.count*Re,Ee=1;Ve>Z.maxTextureSize&&(Ee=Math.ceil(Ve/Z.maxTextureSize),Ve=Z.maxTextureSize);const Ze=new Float32Array(Ve*Ee*4*ce),_e=new DataArrayTexture(Ze,Ve,Ee,ce);_e.type=FloatType,_e.needsUpdate=!0;const Fe=Re*4;for(let ke=0;ke<ce;ke++){const Le=ye[ke],Ke=ve[ke],Ue=Be[ke],rt=Ve*Ee*4*ke;for(let tt=0;tt<Le.count;tt++){const at=tt*Fe;fe===!0&&(te.fromBufferAttribute(Le,tt),Ze[rt+at+0]=te.x,Ze[rt+at+1]=te.y,Ze[rt+at+2]=te.z,Ze[rt+at+3]=0),be===!0&&(te.fromBufferAttribute(Ke,tt),Ze[rt+at+4]=te.x,Ze[rt+at+5]=te.y,Ze[rt+at+6]=te.z,Ze[rt+at+7]=0),Ae===!0&&(te.fromBufferAttribute(Ue,tt),Ze[rt+at+8]=te.x,Ze[rt+at+9]=te.y,Ze[rt+at+10]=te.z,Ze[rt+at+11]=Ue.itemSize===4?te.w:1)}}de={count:ce,texture:_e,size:new Vector2(Ve,Ee)},K.set(oe,de),oe.addEventListener("dispose",Te)}if(ie.isInstancedMesh===!0&&ie.morphTexture!==null)se.getUniforms().setValue(X,"morphTexture",ie.morphTexture,_);else{let fe=0;for(let Ae=0;Ae<ae.length;Ae++)fe+=ae[Ae];const be=oe.morphTargetsRelative?1:1-fe;se.getUniforms().setValue(X,"morphTargetBaseInfluence",be),se.getUniforms().setValue(X,"morphTargetInfluences",ae)}se.getUniforms().setValue(X,"morphTargetsTexture",de.texture,_),se.getUniforms().setValue(X,"morphTargetsTextureSize",de.size)}return{update:ne}}function WebGLObjects(X,Z,_,K){let te=new WeakMap;function ne(se){const ae=K.render.frame,ge=se.geometry,ce=Z.get(se,ge);if(te.get(ce)!==ae&&(Z.update(ce),te.set(ce,ae)),se.isInstancedMesh&&(se.hasEventListener("dispose",oe)===!1&&se.addEventListener("dispose",oe),te.get(se)!==ae&&(_.update(se.instanceMatrix,X.ARRAY_BUFFER),se.instanceColor!==null&&_.update(se.instanceColor,X.ARRAY_BUFFER),te.set(se,ae))),se.isSkinnedMesh){const de=se.skeleton;te.get(de)!==ae&&(de.update(),te.set(de,ae))}return ce}function ie(){te=new WeakMap}function oe(se){const ae=se.target;ae.removeEventListener("dispose",oe),_.remove(ae.instanceMatrix),ae.instanceColor!==null&&_.remove(ae.instanceColor)}return{update:ne,dispose:ie}}const emptyTexture=new Texture,emptyShadowTexture=new DepthTexture(1,1),emptyArrayTexture=new DataArrayTexture,empty3dTexture=new Data3DTexture,emptyCubeTexture=new CubeTexture,arrayCacheF32=[],arrayCacheI32=[],mat4array=new Float32Array(16),mat3array=new Float32Array(9),mat2array=new Float32Array(4);function flatten$1(X,Z,_){const K=X[0];if(K<=0||K>0)return X;const te=Z*_;let ne=arrayCacheF32[te];if(ne===void 0&&(ne=new Float32Array(te),arrayCacheF32[te]=ne),Z!==0){K.toArray(ne,0);for(let ie=1,oe=0;ie!==Z;++ie)oe+=_,X[ie].toArray(ne,oe)}return ne}function arraysEqual(X,Z){if(X.length!==Z.length)return!1;for(let _=0,K=X.length;_<K;_++)if(X[_]!==Z[_])return!1;return!0}function copyArray(X,Z){for(let _=0,K=Z.length;_<K;_++)X[_]=Z[_]}function allocTexUnits(X,Z){let _=arrayCacheI32[Z];_===void 0&&(_=new Int32Array(Z),arrayCacheI32[Z]=_);for(let K=0;K!==Z;++K)_[K]=X.allocateTextureUnit();return _}function setValueV1f(X,Z){const _=this.cache;_[0]!==Z&&(X.uniform1f(this.addr,Z),_[0]=Z)}function setValueV2f(X,Z){const _=this.cache;if(Z.x!==void 0)(_[0]!==Z.x||_[1]!==Z.y)&&(X.uniform2f(this.addr,Z.x,Z.y),_[0]=Z.x,_[1]=Z.y);else{if(arraysEqual(_,Z))return;X.uniform2fv(this.addr,Z),copyArray(_,Z)}}function setValueV3f(X,Z){const _=this.cache;if(Z.x!==void 0)(_[0]!==Z.x||_[1]!==Z.y||_[2]!==Z.z)&&(X.uniform3f(this.addr,Z.x,Z.y,Z.z),_[0]=Z.x,_[1]=Z.y,_[2]=Z.z);else if(Z.r!==void 0)(_[0]!==Z.r||_[1]!==Z.g||_[2]!==Z.b)&&(X.uniform3f(this.addr,Z.r,Z.g,Z.b),_[0]=Z.r,_[1]=Z.g,_[2]=Z.b);else{if(arraysEqual(_,Z))return;X.uniform3fv(this.addr,Z),copyArray(_,Z)}}function setValueV4f(X,Z){const _=this.cache;if(Z.x!==void 0)(_[0]!==Z.x||_[1]!==Z.y||_[2]!==Z.z||_[3]!==Z.w)&&(X.uniform4f(this.addr,Z.x,Z.y,Z.z,Z.w),_[0]=Z.x,_[1]=Z.y,_[2]=Z.z,_[3]=Z.w);else{if(arraysEqual(_,Z))return;X.uniform4fv(this.addr,Z),copyArray(_,Z)}}function setValueM2(X,Z){const _=this.cache,K=Z.elements;if(K===void 0){if(arraysEqual(_,Z))return;X.uniformMatrix2fv(this.addr,!1,Z),copyArray(_,Z)}else{if(arraysEqual(_,K))return;mat2array.set(K),X.uniformMatrix2fv(this.addr,!1,mat2array),copyArray(_,K)}}function setValueM3(X,Z){const _=this.cache,K=Z.elements;if(K===void 0){if(arraysEqual(_,Z))return;X.uniformMatrix3fv(this.addr,!1,Z),copyArray(_,Z)}else{if(arraysEqual(_,K))return;mat3array.set(K),X.uniformMatrix3fv(this.addr,!1,mat3array),copyArray(_,K)}}function setValueM4(X,Z){const _=this.cache,K=Z.elements;if(K===void 0){if(arraysEqual(_,Z))return;X.uniformMatrix4fv(this.addr,!1,Z),copyArray(_,Z)}else{if(arraysEqual(_,K))return;mat4array.set(K),X.uniformMatrix4fv(this.addr,!1,mat4array),copyArray(_,K)}}function setValueV1i(X,Z){const _=this.cache;_[0]!==Z&&(X.uniform1i(this.addr,Z),_[0]=Z)}function setValueV2i(X,Z){const _=this.cache;if(Z.x!==void 0)(_[0]!==Z.x||_[1]!==Z.y)&&(X.uniform2i(this.addr,Z.x,Z.y),_[0]=Z.x,_[1]=Z.y);else{if(arraysEqual(_,Z))return;X.uniform2iv(this.addr,Z),copyArray(_,Z)}}function setValueV3i(X,Z){const _=this.cache;if(Z.x!==void 0)(_[0]!==Z.x||_[1]!==Z.y||_[2]!==Z.z)&&(X.uniform3i(this.addr,Z.x,Z.y,Z.z),_[0]=Z.x,_[1]=Z.y,_[2]=Z.z);else{if(arraysEqual(_,Z))return;X.uniform3iv(this.addr,Z),copyArray(_,Z)}}function setValueV4i(X,Z){const _=this.cache;if(Z.x!==void 0)(_[0]!==Z.x||_[1]!==Z.y||_[2]!==Z.z||_[3]!==Z.w)&&(X.uniform4i(this.addr,Z.x,Z.y,Z.z,Z.w),_[0]=Z.x,_[1]=Z.y,_[2]=Z.z,_[3]=Z.w);else{if(arraysEqual(_,Z))return;X.uniform4iv(this.addr,Z),copyArray(_,Z)}}function setValueV1ui(X,Z){const _=this.cache;_[0]!==Z&&(X.uniform1ui(this.addr,Z),_[0]=Z)}function setValueV2ui(X,Z){const _=this.cache;if(Z.x!==void 0)(_[0]!==Z.x||_[1]!==Z.y)&&(X.uniform2ui(this.addr,Z.x,Z.y),_[0]=Z.x,_[1]=Z.y);else{if(arraysEqual(_,Z))return;X.uniform2uiv(this.addr,Z),copyArray(_,Z)}}function setValueV3ui(X,Z){const _=this.cache;if(Z.x!==void 0)(_[0]!==Z.x||_[1]!==Z.y||_[2]!==Z.z)&&(X.uniform3ui(this.addr,Z.x,Z.y,Z.z),_[0]=Z.x,_[1]=Z.y,_[2]=Z.z);else{if(arraysEqual(_,Z))return;X.uniform3uiv(this.addr,Z),copyArray(_,Z)}}function setValueV4ui(X,Z){const _=this.cache;if(Z.x!==void 0)(_[0]!==Z.x||_[1]!==Z.y||_[2]!==Z.z||_[3]!==Z.w)&&(X.uniform4ui(this.addr,Z.x,Z.y,Z.z,Z.w),_[0]=Z.x,_[1]=Z.y,_[2]=Z.z,_[3]=Z.w);else{if(arraysEqual(_,Z))return;X.uniform4uiv(this.addr,Z),copyArray(_,Z)}}function setValueT1(X,Z,_){const K=this.cache,te=_.allocateTextureUnit();K[0]!==te&&(X.uniform1i(this.addr,te),K[0]=te);let ne;this.type===X.SAMPLER_2D_SHADOW?(emptyShadowTexture.compareFunction=LessEqualCompare,ne=emptyShadowTexture):ne=emptyTexture,_.setTexture2D(Z||ne,te)}function setValueT3D1(X,Z,_){const K=this.cache,te=_.allocateTextureUnit();K[0]!==te&&(X.uniform1i(this.addr,te),K[0]=te),_.setTexture3D(Z||empty3dTexture,te)}function setValueT6(X,Z,_){const K=this.cache,te=_.allocateTextureUnit();K[0]!==te&&(X.uniform1i(this.addr,te),K[0]=te),_.setTextureCube(Z||emptyCubeTexture,te)}function setValueT2DArray1(X,Z,_){const K=this.cache,te=_.allocateTextureUnit();K[0]!==te&&(X.uniform1i(this.addr,te),K[0]=te),_.setTexture2DArray(Z||emptyArrayTexture,te)}function getSingularSetter(X){switch(X){case 5126:return setValueV1f;case 35664:return setValueV2f;case 35665:return setValueV3f;case 35666:return setValueV4f;case 35674:return setValueM2;case 35675:return setValueM3;case 35676:return setValueM4;case 5124:case 35670:return setValueV1i;case 35667:case 35671:return setValueV2i;case 35668:case 35672:return setValueV3i;case 35669:case 35673:return setValueV4i;case 5125:return setValueV1ui;case 36294:return setValueV2ui;case 36295:return setValueV3ui;case 36296:return setValueV4ui;case 35678:case 36198:case 36298:case 36306:case 35682:return setValueT1;case 35679:case 36299:case 36307:return setValueT3D1;case 35680:case 36300:case 36308:case 36293:return setValueT6;case 36289:case 36303:case 36311:case 36292:return setValueT2DArray1}}function setValueV1fArray(X,Z){X.uniform1fv(this.addr,Z)}function setValueV2fArray(X,Z){const _=flatten$1(Z,this.size,2);X.uniform2fv(this.addr,_)}function setValueV3fArray(X,Z){const _=flatten$1(Z,this.size,3);X.uniform3fv(this.addr,_)}function setValueV4fArray(X,Z){const _=flatten$1(Z,this.size,4);X.uniform4fv(this.addr,_)}function setValueM2Array(X,Z){const _=flatten$1(Z,this.size,4);X.uniformMatrix2fv(this.addr,!1,_)}function setValueM3Array(X,Z){const _=flatten$1(Z,this.size,9);X.uniformMatrix3fv(this.addr,!1,_)}function setValueM4Array(X,Z){const _=flatten$1(Z,this.size,16);X.uniformMatrix4fv(this.addr,!1,_)}function setValueV1iArray(X,Z){X.uniform1iv(this.addr,Z)}function setValueV2iArray(X,Z){X.uniform2iv(this.addr,Z)}function setValueV3iArray(X,Z){X.uniform3iv(this.addr,Z)}function setValueV4iArray(X,Z){X.uniform4iv(this.addr,Z)}function setValueV1uiArray(X,Z){X.uniform1uiv(this.addr,Z)}function setValueV2uiArray(X,Z){X.uniform2uiv(this.addr,Z)}function setValueV3uiArray(X,Z){X.uniform3uiv(this.addr,Z)}function setValueV4uiArray(X,Z){X.uniform4uiv(this.addr,Z)}function setValueT1Array(X,Z,_){const K=this.cache,te=Z.length,ne=allocTexUnits(_,te);arraysEqual(K,ne)||(X.uniform1iv(this.addr,ne),copyArray(K,ne));for(let ie=0;ie!==te;++ie)_.setTexture2D(Z[ie]||emptyTexture,ne[ie])}function setValueT3DArray(X,Z,_){const K=this.cache,te=Z.length,ne=allocTexUnits(_,te);arraysEqual(K,ne)||(X.uniform1iv(this.addr,ne),copyArray(K,ne));for(let ie=0;ie!==te;++ie)_.setTexture3D(Z[ie]||empty3dTexture,ne[ie])}function setValueT6Array(X,Z,_){const K=this.cache,te=Z.length,ne=allocTexUnits(_,te);arraysEqual(K,ne)||(X.uniform1iv(this.addr,ne),copyArray(K,ne));for(let ie=0;ie!==te;++ie)_.setTextureCube(Z[ie]||emptyCubeTexture,ne[ie])}function setValueT2DArrayArray(X,Z,_){const K=this.cache,te=Z.length,ne=allocTexUnits(_,te);arraysEqual(K,ne)||(X.uniform1iv(this.addr,ne),copyArray(K,ne));for(let ie=0;ie!==te;++ie)_.setTexture2DArray(Z[ie]||emptyArrayTexture,ne[ie])}function getPureArraySetter(X){switch(X){case 5126:return setValueV1fArray;case 35664:return setValueV2fArray;case 35665:return setValueV3fArray;case 35666:return setValueV4fArray;case 35674:return setValueM2Array;case 35675:return setValueM3Array;case 35676:return setValueM4Array;case 5124:case 35670:return setValueV1iArray;case 35667:case 35671:return setValueV2iArray;case 35668:case 35672:return setValueV3iArray;case 35669:case 35673:return setValueV4iArray;case 5125:return setValueV1uiArray;case 36294:return setValueV2uiArray;case 36295:return setValueV3uiArray;case 36296:return setValueV4uiArray;case 35678:case 36198:case 36298:case 36306:case 35682:return setValueT1Array;case 35679:case 36299:case 36307:return setValueT3DArray;case 35680:case 36300:case 36308:case 36293:return setValueT6Array;case 36289:case 36303:case 36311:case 36292:return setValueT2DArrayArray}}class SingleUniform{constructor(Z,_,K){this.id=Z,this.addr=K,this.cache=[],this.type=_.type,this.setValue=getSingularSetter(_.type)}}class PureArrayUniform{constructor(Z,_,K){this.id=Z,this.addr=K,this.cache=[],this.type=_.type,this.size=_.size,this.setValue=getPureArraySetter(_.type)}}class StructuredUniform{constructor(Z){this.id=Z,this.seq=[],this.map={}}setValue(Z,_,K){const te=this.seq;for(let ne=0,ie=te.length;ne!==ie;++ne){const oe=te[ne];oe.setValue(Z,_[oe.id],K)}}}const RePathPart=/(\w+)(\])?(\[|\.)?/g;function addUniform(X,Z){X.seq.push(Z),X.map[Z.id]=Z}function parseUniform(X,Z,_){const K=X.name,te=K.length;for(RePathPart.lastIndex=0;;){const ne=RePathPart.exec(K),ie=RePathPart.lastIndex;let oe=ne[1];const se=ne[2]==="]",ae=ne[3];if(se&&(oe=oe|0),ae===void 0||ae==="["&&ie+2===te){addUniform(_,ae===void 0?new SingleUniform(oe,X,Z):new PureArrayUniform(oe,X,Z));break}else{let ce=_.map[oe];ce===void 0&&(ce=new StructuredUniform(oe),addUniform(_,ce)),_=ce}}}class WebGLUniforms{constructor(Z,_){this.seq=[],this.map={};const K=Z.getProgramParameter(_,Z.ACTIVE_UNIFORMS);for(let te=0;te<K;++te){const ne=Z.getActiveUniform(_,te),ie=Z.getUniformLocation(_,ne.name);parseUniform(ne,ie,this)}}setValue(Z,_,K,te){const ne=this.map[_];ne!==void 0&&ne.setValue(Z,K,te)}setOptional(Z,_,K){const te=_[K];te!==void 0&&this.setValue(Z,K,te)}static upload(Z,_,K,te){for(let ne=0,ie=_.length;ne!==ie;++ne){const oe=_[ne],se=K[oe.id];se.needsUpdate!==!1&&oe.setValue(Z,se.value,te)}}static seqWithValue(Z,_){const K=[];for(let te=0,ne=Z.length;te!==ne;++te){const ie=Z[te];ie.id in _&&K.push(ie)}return K}}function WebGLShader(X,Z,_){const K=X.createShader(Z);return X.shaderSource(K,_),X.compileShader(K),K}const COMPLETION_STATUS_KHR=37297;let programIdCount=0;function handleSource(X,Z){const _=X.split(`
`),K=[],te=Math.max(Z-6,0),ne=Math.min(Z+6,_.length);for(let ie=te;ie<ne;ie++){const oe=ie+1;K.push(`${oe===Z?">":" "} ${oe}: ${_[ie]}`)}return K.join(`
`)}const _m0=new Matrix3;function getEncodingComponents(X){ColorManagement._getMatrix(_m0,ColorManagement.workingColorSpace,X);const Z=`mat3( ${_m0.elements.map(_=>_.toFixed(4))} )`;switch(ColorManagement.getTransfer(X)){case LinearTransfer:return[Z,"LinearTransferOETF"];case SRGBTransfer:return[Z,"sRGBTransferOETF"];default:return console.warn("THREE.WebGLProgram: Unsupported color space: ",X),[Z,"LinearTransferOETF"]}}function getShaderErrors(X,Z,_){const K=X.getShaderParameter(Z,X.COMPILE_STATUS),te=X.getShaderInfoLog(Z).trim();if(K&&te==="")return"";const ne=/ERROR: 0:(\d+)/.exec(te);if(ne){const ie=parseInt(ne[1]);return _.toUpperCase()+`

`+te+`

`+handleSource(X.getShaderSource(Z),ie)}else return te}function getTexelEncodingFunction(X,Z){const _=getEncodingComponents(Z);return[`vec4 ${X}( vec4 value ) {`,`	return ${_[1]}( vec4( value.rgb * ${_[0]}, value.a ) );`,"}"].join(`
`)}function getToneMappingFunction(X,Z){let _;switch(Z){case LinearToneMapping:_="Linear";break;case ReinhardToneMapping:_="Reinhard";break;case CineonToneMapping:_="Cineon";break;case ACESFilmicToneMapping:_="ACESFilmic";break;case AgXToneMapping:_="AgX";break;case NeutralToneMapping:_="Neutral";break;case CustomToneMapping:_="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",Z),_="Linear"}return"vec3 "+X+"( vec3 color ) { return "+_+"ToneMapping( color ); }"}const _v0=new Vector3;function getLuminanceFunction(){ColorManagement.getLuminanceCoefficients(_v0);const X=_v0.x.toFixed(4),Z=_v0.y.toFixed(4),_=_v0.z.toFixed(4);return["float luminance( const in vec3 rgb ) {",`	const vec3 weights = vec3( ${X}, ${Z}, ${_} );`,"	return dot( weights, rgb );","}"].join(`
`)}function generateVertexExtensions(X){return[X.extensionClipCullDistance?"#extension GL_ANGLE_clip_cull_distance : require":"",X.extensionMultiDraw?"#extension GL_ANGLE_multi_draw : require":""].filter(filterEmptyLine).join(`
`)}function generateDefines(X){const Z=[];for(const _ in X){const K=X[_];K!==!1&&Z.push("#define "+_+" "+K)}return Z.join(`
`)}function fetchAttributeLocations(X,Z){const _={},K=X.getProgramParameter(Z,X.ACTIVE_ATTRIBUTES);for(let te=0;te<K;te++){const ne=X.getActiveAttrib(Z,te),ie=ne.name;let oe=1;ne.type===X.FLOAT_MAT2&&(oe=2),ne.type===X.FLOAT_MAT3&&(oe=3),ne.type===X.FLOAT_MAT4&&(oe=4),_[ie]={type:ne.type,location:X.getAttribLocation(Z,ie),locationSize:oe}}return _}function filterEmptyLine(X){return X!==""}function replaceLightNums(X,Z){const _=Z.numSpotLightShadows+Z.numSpotLightMaps-Z.numSpotLightShadowsWithMaps;return X.replace(/NUM_DIR_LIGHTS/g,Z.numDirLights).replace(/NUM_SPOT_LIGHTS/g,Z.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,Z.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,_).replace(/NUM_RECT_AREA_LIGHTS/g,Z.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,Z.numPointLights).replace(/NUM_HEMI_LIGHTS/g,Z.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,Z.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,Z.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,Z.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,Z.numPointLightShadows)}function replaceClippingPlaneNums(X,Z){return X.replace(/NUM_CLIPPING_PLANES/g,Z.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,Z.numClippingPlanes-Z.numClipIntersection)}const includePattern=/^[ \t]*#include +<([\w\d./]+)>/gm;function resolveIncludes(X){return X.replace(includePattern,includeReplacer)}const shaderChunkMap=new Map;function includeReplacer(X,Z){let _=ShaderChunk[Z];if(_===void 0){const K=shaderChunkMap.get(Z);if(K!==void 0)_=ShaderChunk[K],console.warn('THREE.WebGLRenderer: Shader chunk "%s" has been deprecated. Use "%s" instead.',Z,K);else throw new Error("Can not resolve #include <"+Z+">")}return resolveIncludes(_)}const unrollLoopPattern=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function unrollLoops(X){return X.replace(unrollLoopPattern,loopReplacer)}function loopReplacer(X,Z,_,K){let te="";for(let ne=parseInt(Z);ne<parseInt(_);ne++)te+=K.replace(/\[\s*i\s*\]/g,"[ "+ne+" ]").replace(/UNROLLED_LOOP_INDEX/g,ne);return te}function generatePrecision(X){let Z=`precision ${X.precision} float;
	precision ${X.precision} int;
	precision ${X.precision} sampler2D;
	precision ${X.precision} samplerCube;
	precision ${X.precision} sampler3D;
	precision ${X.precision} sampler2DArray;
	precision ${X.precision} sampler2DShadow;
	precision ${X.precision} samplerCubeShadow;
	precision ${X.precision} sampler2DArrayShadow;
	precision ${X.precision} isampler2D;
	precision ${X.precision} isampler3D;
	precision ${X.precision} isamplerCube;
	precision ${X.precision} isampler2DArray;
	precision ${X.precision} usampler2D;
	precision ${X.precision} usampler3D;
	precision ${X.precision} usamplerCube;
	precision ${X.precision} usampler2DArray;
	`;return X.precision==="highp"?Z+=`
#define HIGH_PRECISION`:X.precision==="mediump"?Z+=`
#define MEDIUM_PRECISION`:X.precision==="lowp"&&(Z+=`
#define LOW_PRECISION`),Z}function generateShadowMapTypeDefine(X){let Z="SHADOWMAP_TYPE_BASIC";return X.shadowMapType===PCFShadowMap?Z="SHADOWMAP_TYPE_PCF":X.shadowMapType===PCFSoftShadowMap?Z="SHADOWMAP_TYPE_PCF_SOFT":X.shadowMapType===VSMShadowMap&&(Z="SHADOWMAP_TYPE_VSM"),Z}function generateEnvMapTypeDefine(X){let Z="ENVMAP_TYPE_CUBE";if(X.envMap)switch(X.envMapMode){case CubeReflectionMapping:case CubeRefractionMapping:Z="ENVMAP_TYPE_CUBE";break;case CubeUVReflectionMapping:Z="ENVMAP_TYPE_CUBE_UV";break}return Z}function generateEnvMapModeDefine(X){let Z="ENVMAP_MODE_REFLECTION";if(X.envMap)switch(X.envMapMode){case CubeRefractionMapping:Z="ENVMAP_MODE_REFRACTION";break}return Z}function generateEnvMapBlendingDefine(X){let Z="ENVMAP_BLENDING_NONE";if(X.envMap)switch(X.combine){case MultiplyOperation:Z="ENVMAP_BLENDING_MULTIPLY";break;case MixOperation:Z="ENVMAP_BLENDING_MIX";break;case AddOperation:Z="ENVMAP_BLENDING_ADD";break}return Z}function generateCubeUVSize(X){const Z=X.envMapCubeUVHeight;if(Z===null)return null;const _=Math.log2(Z)-2,K=1/Z;return{texelWidth:1/(3*Math.max(Math.pow(2,_),7*16)),texelHeight:K,maxMip:_}}function WebGLProgram(X,Z,_,K){const te=X.getContext(),ne=_.defines;let ie=_.vertexShader,oe=_.fragmentShader;const se=generateShadowMapTypeDefine(_),ae=generateEnvMapTypeDefine(_),ge=generateEnvMapModeDefine(_),ce=generateEnvMapBlendingDefine(_),de=generateCubeUVSize(_),Ie=generateVertexExtensions(_),fe=generateDefines(ne),be=te.createProgram();let Ae,ye,ve=_.glslVersion?"#version "+_.glslVersion+`
`:"";_.isRawShaderMaterial?(Ae=["#define SHADER_TYPE "+_.shaderType,"#define SHADER_NAME "+_.shaderName,fe].filter(filterEmptyLine).join(`
`),Ae.length>0&&(Ae+=`
`),ye=["#define SHADER_TYPE "+_.shaderType,"#define SHADER_NAME "+_.shaderName,fe].filter(filterEmptyLine).join(`
`),ye.length>0&&(ye+=`
`)):(Ae=[generatePrecision(_),"#define SHADER_TYPE "+_.shaderType,"#define SHADER_NAME "+_.shaderName,fe,_.extensionClipCullDistance?"#define USE_CLIP_DISTANCE":"",_.batching?"#define USE_BATCHING":"",_.batchingColor?"#define USE_BATCHING_COLOR":"",_.instancing?"#define USE_INSTANCING":"",_.instancingColor?"#define USE_INSTANCING_COLOR":"",_.instancingMorph?"#define USE_INSTANCING_MORPH":"",_.useFog&&_.fog?"#define USE_FOG":"",_.useFog&&_.fogExp2?"#define FOG_EXP2":"",_.map?"#define USE_MAP":"",_.envMap?"#define USE_ENVMAP":"",_.envMap?"#define "+ge:"",_.lightMap?"#define USE_LIGHTMAP":"",_.aoMap?"#define USE_AOMAP":"",_.bumpMap?"#define USE_BUMPMAP":"",_.normalMap?"#define USE_NORMALMAP":"",_.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",_.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",_.displacementMap?"#define USE_DISPLACEMENTMAP":"",_.emissiveMap?"#define USE_EMISSIVEMAP":"",_.anisotropy?"#define USE_ANISOTROPY":"",_.anisotropyMap?"#define USE_ANISOTROPYMAP":"",_.clearcoatMap?"#define USE_CLEARCOATMAP":"",_.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",_.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",_.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",_.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",_.specularMap?"#define USE_SPECULARMAP":"",_.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",_.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",_.roughnessMap?"#define USE_ROUGHNESSMAP":"",_.metalnessMap?"#define USE_METALNESSMAP":"",_.alphaMap?"#define USE_ALPHAMAP":"",_.alphaHash?"#define USE_ALPHAHASH":"",_.transmission?"#define USE_TRANSMISSION":"",_.transmissionMap?"#define USE_TRANSMISSIONMAP":"",_.thicknessMap?"#define USE_THICKNESSMAP":"",_.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",_.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",_.mapUv?"#define MAP_UV "+_.mapUv:"",_.alphaMapUv?"#define ALPHAMAP_UV "+_.alphaMapUv:"",_.lightMapUv?"#define LIGHTMAP_UV "+_.lightMapUv:"",_.aoMapUv?"#define AOMAP_UV "+_.aoMapUv:"",_.emissiveMapUv?"#define EMISSIVEMAP_UV "+_.emissiveMapUv:"",_.bumpMapUv?"#define BUMPMAP_UV "+_.bumpMapUv:"",_.normalMapUv?"#define NORMALMAP_UV "+_.normalMapUv:"",_.displacementMapUv?"#define DISPLACEMENTMAP_UV "+_.displacementMapUv:"",_.metalnessMapUv?"#define METALNESSMAP_UV "+_.metalnessMapUv:"",_.roughnessMapUv?"#define ROUGHNESSMAP_UV "+_.roughnessMapUv:"",_.anisotropyMapUv?"#define ANISOTROPYMAP_UV "+_.anisotropyMapUv:"",_.clearcoatMapUv?"#define CLEARCOATMAP_UV "+_.clearcoatMapUv:"",_.clearcoatNormalMapUv?"#define CLEARCOAT_NORMALMAP_UV "+_.clearcoatNormalMapUv:"",_.clearcoatRoughnessMapUv?"#define CLEARCOAT_ROUGHNESSMAP_UV "+_.clearcoatRoughnessMapUv:"",_.iridescenceMapUv?"#define IRIDESCENCEMAP_UV "+_.iridescenceMapUv:"",_.iridescenceThicknessMapUv?"#define IRIDESCENCE_THICKNESSMAP_UV "+_.iridescenceThicknessMapUv:"",_.sheenColorMapUv?"#define SHEEN_COLORMAP_UV "+_.sheenColorMapUv:"",_.sheenRoughnessMapUv?"#define SHEEN_ROUGHNESSMAP_UV "+_.sheenRoughnessMapUv:"",_.specularMapUv?"#define SPECULARMAP_UV "+_.specularMapUv:"",_.specularColorMapUv?"#define SPECULAR_COLORMAP_UV "+_.specularColorMapUv:"",_.specularIntensityMapUv?"#define SPECULAR_INTENSITYMAP_UV "+_.specularIntensityMapUv:"",_.transmissionMapUv?"#define TRANSMISSIONMAP_UV "+_.transmissionMapUv:"",_.thicknessMapUv?"#define THICKNESSMAP_UV "+_.thicknessMapUv:"",_.vertexTangents&&_.flatShading===!1?"#define USE_TANGENT":"",_.vertexColors?"#define USE_COLOR":"",_.vertexAlphas?"#define USE_COLOR_ALPHA":"",_.vertexUv1s?"#define USE_UV1":"",_.vertexUv2s?"#define USE_UV2":"",_.vertexUv3s?"#define USE_UV3":"",_.pointsUvs?"#define USE_POINTS_UV":"",_.flatShading?"#define FLAT_SHADED":"",_.skinning?"#define USE_SKINNING":"",_.morphTargets?"#define USE_MORPHTARGETS":"",_.morphNormals&&_.flatShading===!1?"#define USE_MORPHNORMALS":"",_.morphColors?"#define USE_MORPHCOLORS":"",_.morphTargetsCount>0?"#define MORPHTARGETS_TEXTURE_STRIDE "+_.morphTextureStride:"",_.morphTargetsCount>0?"#define MORPHTARGETS_COUNT "+_.morphTargetsCount:"",_.doubleSided?"#define DOUBLE_SIDED":"",_.flipSided?"#define FLIP_SIDED":"",_.shadowMapEnabled?"#define USE_SHADOWMAP":"",_.shadowMapEnabled?"#define "+se:"",_.sizeAttenuation?"#define USE_SIZEATTENUATION":"",_.numLightProbes>0?"#define USE_LIGHT_PROBES":"",_.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",_.reverseDepthBuffer?"#define USE_REVERSEDEPTHBUF":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","	attribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","	attribute vec3 instanceColor;","#endif","#ifdef USE_INSTANCING_MORPH","	uniform sampler2D morphTexture;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_UV1","	attribute vec2 uv1;","#endif","#ifdef USE_UV2","	attribute vec2 uv2;","#endif","#ifdef USE_UV3","	attribute vec2 uv3;","#endif","#ifdef USE_TANGENT","	attribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","	attribute vec4 color;","#elif defined( USE_COLOR )","	attribute vec3 color;","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif",`
`].filter(filterEmptyLine).join(`
`),ye=[generatePrecision(_),"#define SHADER_TYPE "+_.shaderType,"#define SHADER_NAME "+_.shaderName,fe,_.useFog&&_.fog?"#define USE_FOG":"",_.useFog&&_.fogExp2?"#define FOG_EXP2":"",_.alphaToCoverage?"#define ALPHA_TO_COVERAGE":"",_.map?"#define USE_MAP":"",_.matcap?"#define USE_MATCAP":"",_.envMap?"#define USE_ENVMAP":"",_.envMap?"#define "+ae:"",_.envMap?"#define "+ge:"",_.envMap?"#define "+ce:"",de?"#define CUBEUV_TEXEL_WIDTH "+de.texelWidth:"",de?"#define CUBEUV_TEXEL_HEIGHT "+de.texelHeight:"",de?"#define CUBEUV_MAX_MIP "+de.maxMip+".0":"",_.lightMap?"#define USE_LIGHTMAP":"",_.aoMap?"#define USE_AOMAP":"",_.bumpMap?"#define USE_BUMPMAP":"",_.normalMap?"#define USE_NORMALMAP":"",_.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",_.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",_.emissiveMap?"#define USE_EMISSIVEMAP":"",_.anisotropy?"#define USE_ANISOTROPY":"",_.anisotropyMap?"#define USE_ANISOTROPYMAP":"",_.clearcoat?"#define USE_CLEARCOAT":"",_.clearcoatMap?"#define USE_CLEARCOATMAP":"",_.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",_.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",_.dispersion?"#define USE_DISPERSION":"",_.iridescence?"#define USE_IRIDESCENCE":"",_.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",_.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",_.specularMap?"#define USE_SPECULARMAP":"",_.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",_.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",_.roughnessMap?"#define USE_ROUGHNESSMAP":"",_.metalnessMap?"#define USE_METALNESSMAP":"",_.alphaMap?"#define USE_ALPHAMAP":"",_.alphaTest?"#define USE_ALPHATEST":"",_.alphaHash?"#define USE_ALPHAHASH":"",_.sheen?"#define USE_SHEEN":"",_.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",_.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",_.transmission?"#define USE_TRANSMISSION":"",_.transmissionMap?"#define USE_TRANSMISSIONMAP":"",_.thicknessMap?"#define USE_THICKNESSMAP":"",_.vertexTangents&&_.flatShading===!1?"#define USE_TANGENT":"",_.vertexColors||_.instancingColor||_.batchingColor?"#define USE_COLOR":"",_.vertexAlphas?"#define USE_COLOR_ALPHA":"",_.vertexUv1s?"#define USE_UV1":"",_.vertexUv2s?"#define USE_UV2":"",_.vertexUv3s?"#define USE_UV3":"",_.pointsUvs?"#define USE_POINTS_UV":"",_.gradientMap?"#define USE_GRADIENTMAP":"",_.flatShading?"#define FLAT_SHADED":"",_.doubleSided?"#define DOUBLE_SIDED":"",_.flipSided?"#define FLIP_SIDED":"",_.shadowMapEnabled?"#define USE_SHADOWMAP":"",_.shadowMapEnabled?"#define "+se:"",_.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",_.numLightProbes>0?"#define USE_LIGHT_PROBES":"",_.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",_.decodeVideoTextureEmissive?"#define DECODE_VIDEO_TEXTURE_EMISSIVE":"",_.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",_.reverseDepthBuffer?"#define USE_REVERSEDEPTHBUF":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",_.toneMapping!==NoToneMapping?"#define TONE_MAPPING":"",_.toneMapping!==NoToneMapping?ShaderChunk.tonemapping_pars_fragment:"",_.toneMapping!==NoToneMapping?getToneMappingFunction("toneMapping",_.toneMapping):"",_.dithering?"#define DITHERING":"",_.opaque?"#define OPAQUE":"",ShaderChunk.colorspace_pars_fragment,getTexelEncodingFunction("linearToOutputTexel",_.outputColorSpace),getLuminanceFunction(),_.useDepthPacking?"#define DEPTH_PACKING "+_.depthPacking:"",`
`].filter(filterEmptyLine).join(`
`)),ie=resolveIncludes(ie),ie=replaceLightNums(ie,_),ie=replaceClippingPlaneNums(ie,_),oe=resolveIncludes(oe),oe=replaceLightNums(oe,_),oe=replaceClippingPlaneNums(oe,_),ie=unrollLoops(ie),oe=unrollLoops(oe),_.isRawShaderMaterial!==!0&&(ve=`#version 300 es
`,Ae=[Ie,"#define attribute in","#define varying out","#define texture2D texture"].join(`
`)+`
`+Ae,ye=["#define varying in",_.glslVersion===GLSL3?"":"layout(location = 0) out highp vec4 pc_fragColor;",_.glslVersion===GLSL3?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join(`
`)+`
`+ye);const Be=ve+Ae+ie,Re=ve+ye+oe,Ve=WebGLShader(te,te.VERTEX_SHADER,Be),Ee=WebGLShader(te,te.FRAGMENT_SHADER,Re);te.attachShader(be,Ve),te.attachShader(be,Ee),_.index0AttributeName!==void 0?te.bindAttribLocation(be,0,_.index0AttributeName):_.morphTargets===!0&&te.bindAttribLocation(be,0,"position"),te.linkProgram(be);function Ze(ke){if(X.debug.checkShaderErrors){const Le=te.getProgramInfoLog(be).trim(),Ke=te.getShaderInfoLog(Ve).trim(),Ue=te.getShaderInfoLog(Ee).trim();let rt=!0,tt=!0;if(te.getProgramParameter(be,te.LINK_STATUS)===!1)if(rt=!1,typeof X.debug.onShaderError=="function")X.debug.onShaderError(te,be,Ve,Ee);else{const at=getShaderErrors(te,Ve,"vertex"),ze=getShaderErrors(te,Ee,"fragment");console.error("THREE.WebGLProgram: Shader Error "+te.getError()+" - VALIDATE_STATUS "+te.getProgramParameter(be,te.VALIDATE_STATUS)+`

Material Name: `+ke.name+`
Material Type: `+ke.type+`

Program Info Log: `+Le+`
`+at+`
`+ze)}else Le!==""?console.warn("THREE.WebGLProgram: Program Info Log:",Le):(Ke===""||Ue==="")&&(tt=!1);tt&&(ke.diagnostics={runnable:rt,programLog:Le,vertexShader:{log:Ke,prefix:Ae},fragmentShader:{log:Ue,prefix:ye}})}te.deleteShader(Ve),te.deleteShader(Ee),_e=new WebGLUniforms(te,be),Fe=fetchAttributeLocations(te,be)}let _e;this.getUniforms=function(){return _e===void 0&&Ze(this),_e};let Fe;this.getAttributes=function(){return Fe===void 0&&Ze(this),Fe};let Te=_.rendererExtensionParallelShaderCompile===!1;return this.isReady=function(){return Te===!1&&(Te=te.getProgramParameter(be,COMPLETION_STATUS_KHR)),Te},this.destroy=function(){K.releaseStatesOfProgram(this),te.deleteProgram(be),this.program=void 0},this.type=_.shaderType,this.name=_.shaderName,this.id=programIdCount++,this.cacheKey=Z,this.usedTimes=1,this.program=be,this.vertexShader=Ve,this.fragmentShader=Ee,this}let _id=0;class WebGLShaderCache{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(Z){const _=Z.vertexShader,K=Z.fragmentShader,te=this._getShaderStage(_),ne=this._getShaderStage(K),ie=this._getShaderCacheForMaterial(Z);return ie.has(te)===!1&&(ie.add(te),te.usedTimes++),ie.has(ne)===!1&&(ie.add(ne),ne.usedTimes++),this}remove(Z){const _=this.materialCache.get(Z);for(const K of _)K.usedTimes--,K.usedTimes===0&&this.shaderCache.delete(K.code);return this.materialCache.delete(Z),this}getVertexShaderID(Z){return this._getShaderStage(Z.vertexShader).id}getFragmentShaderID(Z){return this._getShaderStage(Z.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(Z){const _=this.materialCache;let K=_.get(Z);return K===void 0&&(K=new Set,_.set(Z,K)),K}_getShaderStage(Z){const _=this.shaderCache;let K=_.get(Z);return K===void 0&&(K=new WebGLShaderStage(Z),_.set(Z,K)),K}}class WebGLShaderStage{constructor(Z){this.id=_id++,this.code=Z,this.usedTimes=0}}function WebGLPrograms(X,Z,_,K,te,ne,ie){const oe=new Layers,se=new WebGLShaderCache,ae=new Set,ge=[],ce=te.logarithmicDepthBuffer,de=te.vertexTextures;let Ie=te.precision;const fe={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function be(Fe){return ae.add(Fe),Fe===0?"uv":`uv${Fe}`}function Ae(Fe,Te,ke,Le,Ke){const Ue=Le.fog,rt=Ke.geometry,tt=Fe.isMeshStandardMaterial?Le.environment:null,at=(Fe.isMeshStandardMaterial?_:Z).get(Fe.envMap||tt),ze=at&&at.mapping===CubeUVReflectionMapping?at.image.height:null,qe=fe[Fe.type];Fe.precision!==null&&(Ie=te.getMaxPrecision(Fe.precision),Ie!==Fe.precision&&console.warn("THREE.WebGLProgram.getParameters:",Fe.precision,"not supported, using",Ie,"instead."));const Pe=rt.morphAttributes.position||rt.morphAttributes.normal||rt.morphAttributes.color,Ye=Pe!==void 0?Pe.length:0;let $e=0;rt.morphAttributes.position!==void 0&&($e=1),rt.morphAttributes.normal!==void 0&&($e=2),rt.morphAttributes.color!==void 0&&($e=3);let ut,ot,gt,ht;if(qe){const kn=ShaderLib[qe];ut=kn.vertexShader,ot=kn.fragmentShader}else ut=Fe.vertexShader,ot=Fe.fragmentShader,se.update(Fe),gt=se.getVertexShaderID(Fe),ht=se.getFragmentShaderID(Fe);const dt=X.getRenderTarget(),bt=X.state.buffers.depth.getReversed(),Ht=Ke.isInstancedMesh===!0,Dt=Ke.isBatchedMesh===!0,Vt=!!Fe.map,mt=!!Fe.matcap,Ft=!!at,it=!!Fe.aoMap,Lt=!!Fe.lightMap,Et=!!Fe.bumpMap,Ut=!!Fe.normalMap,Zt=!!Fe.displacementMap,Ot=!!Fe.emissiveMap,Tt=!!Fe.metalnessMap,Je=!!Fe.roughnessMap,Oe=Fe.anisotropy>0,lt=Fe.clearcoat>0,ft=Fe.dispersion>0,St=Fe.iridescence>0,Wt=Fe.sheen>0,zt=Fe.transmission>0,$t=Oe&&!!Fe.anisotropyMap,rn=lt&&!!Fe.clearcoatMap,Gn=lt&&!!Fe.clearcoatNormalMap,en=lt&&!!Fe.clearcoatRoughnessMap,In=St&&!!Fe.iridescenceMap,un=St&&!!Fe.iridescenceThicknessMap,ln=Wt&&!!Fe.sheenColorMap,tn=Wt&&!!Fe.sheenRoughnessMap,Sn=!!Fe.specularMap,yn=!!Fe.specularColorMap,Tn=!!Fe.specularIntensityMap,vt=zt&&!!Fe.transmissionMap,wt=zt&&!!Fe.thicknessMap,Mt=!!Fe.gradientMap,on=!!Fe.alphaMap,dn=Fe.alphaTest>0,an=!!Fe.alphaHash,Mn=!!Fe.extensions;let Pn=NoToneMapping;Fe.toneMapped&&(dt===null||dt.isXRRenderTarget===!0)&&(Pn=X.toneMapping);const Nn={shaderID:qe,shaderType:Fe.type,shaderName:Fe.name,vertexShader:ut,fragmentShader:ot,defines:Fe.defines,customVertexShaderID:gt,customFragmentShaderID:ht,isRawShaderMaterial:Fe.isRawShaderMaterial===!0,glslVersion:Fe.glslVersion,precision:Ie,batching:Dt,batchingColor:Dt&&Ke._colorsTexture!==null,instancing:Ht,instancingColor:Ht&&Ke.instanceColor!==null,instancingMorph:Ht&&Ke.morphTexture!==null,supportsVertexTextures:de,outputColorSpace:dt===null?X.outputColorSpace:dt.isXRRenderTarget===!0?dt.texture.colorSpace:LinearSRGBColorSpace$1,alphaToCoverage:!!Fe.alphaToCoverage,map:Vt,matcap:mt,envMap:Ft,envMapMode:Ft&&at.mapping,envMapCubeUVHeight:ze,aoMap:it,lightMap:Lt,bumpMap:Et,normalMap:Ut,displacementMap:de&&Zt,emissiveMap:Ot,normalMapObjectSpace:Ut&&Fe.normalMapType===ObjectSpaceNormalMap,normalMapTangentSpace:Ut&&Fe.normalMapType===TangentSpaceNormalMap,metalnessMap:Tt,roughnessMap:Je,anisotropy:Oe,anisotropyMap:$t,clearcoat:lt,clearcoatMap:rn,clearcoatNormalMap:Gn,clearcoatRoughnessMap:en,dispersion:ft,iridescence:St,iridescenceMap:In,iridescenceThicknessMap:un,sheen:Wt,sheenColorMap:ln,sheenRoughnessMap:tn,specularMap:Sn,specularColorMap:yn,specularIntensityMap:Tn,transmission:zt,transmissionMap:vt,thicknessMap:wt,gradientMap:Mt,opaque:Fe.transparent===!1&&Fe.blending===NormalBlending&&Fe.alphaToCoverage===!1,alphaMap:on,alphaTest:dn,alphaHash:an,combine:Fe.combine,mapUv:Vt&&be(Fe.map.channel),aoMapUv:it&&be(Fe.aoMap.channel),lightMapUv:Lt&&be(Fe.lightMap.channel),bumpMapUv:Et&&be(Fe.bumpMap.channel),normalMapUv:Ut&&be(Fe.normalMap.channel),displacementMapUv:Zt&&be(Fe.displacementMap.channel),emissiveMapUv:Ot&&be(Fe.emissiveMap.channel),metalnessMapUv:Tt&&be(Fe.metalnessMap.channel),roughnessMapUv:Je&&be(Fe.roughnessMap.channel),anisotropyMapUv:$t&&be(Fe.anisotropyMap.channel),clearcoatMapUv:rn&&be(Fe.clearcoatMap.channel),clearcoatNormalMapUv:Gn&&be(Fe.clearcoatNormalMap.channel),clearcoatRoughnessMapUv:en&&be(Fe.clearcoatRoughnessMap.channel),iridescenceMapUv:In&&be(Fe.iridescenceMap.channel),iridescenceThicknessMapUv:un&&be(Fe.iridescenceThicknessMap.channel),sheenColorMapUv:ln&&be(Fe.sheenColorMap.channel),sheenRoughnessMapUv:tn&&be(Fe.sheenRoughnessMap.channel),specularMapUv:Sn&&be(Fe.specularMap.channel),specularColorMapUv:yn&&be(Fe.specularColorMap.channel),specularIntensityMapUv:Tn&&be(Fe.specularIntensityMap.channel),transmissionMapUv:vt&&be(Fe.transmissionMap.channel),thicknessMapUv:wt&&be(Fe.thicknessMap.channel),alphaMapUv:on&&be(Fe.alphaMap.channel),vertexTangents:!!rt.attributes.tangent&&(Ut||Oe),vertexColors:Fe.vertexColors,vertexAlphas:Fe.vertexColors===!0&&!!rt.attributes.color&&rt.attributes.color.itemSize===4,pointsUvs:Ke.isPoints===!0&&!!rt.attributes.uv&&(Vt||on),fog:!!Ue,useFog:Fe.fog===!0,fogExp2:!!Ue&&Ue.isFogExp2,flatShading:Fe.flatShading===!0,sizeAttenuation:Fe.sizeAttenuation===!0,logarithmicDepthBuffer:ce,reverseDepthBuffer:bt,skinning:Ke.isSkinnedMesh===!0,morphTargets:rt.morphAttributes.position!==void 0,morphNormals:rt.morphAttributes.normal!==void 0,morphColors:rt.morphAttributes.color!==void 0,morphTargetsCount:Ye,morphTextureStride:$e,numDirLights:Te.directional.length,numPointLights:Te.point.length,numSpotLights:Te.spot.length,numSpotLightMaps:Te.spotLightMap.length,numRectAreaLights:Te.rectArea.length,numHemiLights:Te.hemi.length,numDirLightShadows:Te.directionalShadowMap.length,numPointLightShadows:Te.pointShadowMap.length,numSpotLightShadows:Te.spotShadowMap.length,numSpotLightShadowsWithMaps:Te.numSpotLightShadowsWithMaps,numLightProbes:Te.numLightProbes,numClippingPlanes:ie.numPlanes,numClipIntersection:ie.numIntersection,dithering:Fe.dithering,shadowMapEnabled:X.shadowMap.enabled&&ke.length>0,shadowMapType:X.shadowMap.type,toneMapping:Pn,decodeVideoTexture:Vt&&Fe.map.isVideoTexture===!0&&ColorManagement.getTransfer(Fe.map.colorSpace)===SRGBTransfer,decodeVideoTextureEmissive:Ot&&Fe.emissiveMap.isVideoTexture===!0&&ColorManagement.getTransfer(Fe.emissiveMap.colorSpace)===SRGBTransfer,premultipliedAlpha:Fe.premultipliedAlpha,doubleSided:Fe.side===DoubleSide,flipSided:Fe.side===BackSide,useDepthPacking:Fe.depthPacking>=0,depthPacking:Fe.depthPacking||0,index0AttributeName:Fe.index0AttributeName,extensionClipCullDistance:Mn&&Fe.extensions.clipCullDistance===!0&&K.has("WEBGL_clip_cull_distance"),extensionMultiDraw:(Mn&&Fe.extensions.multiDraw===!0||Dt)&&K.has("WEBGL_multi_draw"),rendererExtensionParallelShaderCompile:K.has("KHR_parallel_shader_compile"),customProgramCacheKey:Fe.customProgramCacheKey()};return Nn.vertexUv1s=ae.has(1),Nn.vertexUv2s=ae.has(2),Nn.vertexUv3s=ae.has(3),ae.clear(),Nn}function ye(Fe){const Te=[];if(Fe.shaderID?Te.push(Fe.shaderID):(Te.push(Fe.customVertexShaderID),Te.push(Fe.customFragmentShaderID)),Fe.defines!==void 0)for(const ke in Fe.defines)Te.push(ke),Te.push(Fe.defines[ke]);return Fe.isRawShaderMaterial===!1&&(ve(Te,Fe),Be(Te,Fe),Te.push(X.outputColorSpace)),Te.push(Fe.customProgramCacheKey),Te.join()}function ve(Fe,Te){Fe.push(Te.precision),Fe.push(Te.outputColorSpace),Fe.push(Te.envMapMode),Fe.push(Te.envMapCubeUVHeight),Fe.push(Te.mapUv),Fe.push(Te.alphaMapUv),Fe.push(Te.lightMapUv),Fe.push(Te.aoMapUv),Fe.push(Te.bumpMapUv),Fe.push(Te.normalMapUv),Fe.push(Te.displacementMapUv),Fe.push(Te.emissiveMapUv),Fe.push(Te.metalnessMapUv),Fe.push(Te.roughnessMapUv),Fe.push(Te.anisotropyMapUv),Fe.push(Te.clearcoatMapUv),Fe.push(Te.clearcoatNormalMapUv),Fe.push(Te.clearcoatRoughnessMapUv),Fe.push(Te.iridescenceMapUv),Fe.push(Te.iridescenceThicknessMapUv),Fe.push(Te.sheenColorMapUv),Fe.push(Te.sheenRoughnessMapUv),Fe.push(Te.specularMapUv),Fe.push(Te.specularColorMapUv),Fe.push(Te.specularIntensityMapUv),Fe.push(Te.transmissionMapUv),Fe.push(Te.thicknessMapUv),Fe.push(Te.combine),Fe.push(Te.fogExp2),Fe.push(Te.sizeAttenuation),Fe.push(Te.morphTargetsCount),Fe.push(Te.morphAttributeCount),Fe.push(Te.numDirLights),Fe.push(Te.numPointLights),Fe.push(Te.numSpotLights),Fe.push(Te.numSpotLightMaps),Fe.push(Te.numHemiLights),Fe.push(Te.numRectAreaLights),Fe.push(Te.numDirLightShadows),Fe.push(Te.numPointLightShadows),Fe.push(Te.numSpotLightShadows),Fe.push(Te.numSpotLightShadowsWithMaps),Fe.push(Te.numLightProbes),Fe.push(Te.shadowMapType),Fe.push(Te.toneMapping),Fe.push(Te.numClippingPlanes),Fe.push(Te.numClipIntersection),Fe.push(Te.depthPacking)}function Be(Fe,Te){oe.disableAll(),Te.supportsVertexTextures&&oe.enable(0),Te.instancing&&oe.enable(1),Te.instancingColor&&oe.enable(2),Te.instancingMorph&&oe.enable(3),Te.matcap&&oe.enable(4),Te.envMap&&oe.enable(5),Te.normalMapObjectSpace&&oe.enable(6),Te.normalMapTangentSpace&&oe.enable(7),Te.clearcoat&&oe.enable(8),Te.iridescence&&oe.enable(9),Te.alphaTest&&oe.enable(10),Te.vertexColors&&oe.enable(11),Te.vertexAlphas&&oe.enable(12),Te.vertexUv1s&&oe.enable(13),Te.vertexUv2s&&oe.enable(14),Te.vertexUv3s&&oe.enable(15),Te.vertexTangents&&oe.enable(16),Te.anisotropy&&oe.enable(17),Te.alphaHash&&oe.enable(18),Te.batching&&oe.enable(19),Te.dispersion&&oe.enable(20),Te.batchingColor&&oe.enable(21),Fe.push(oe.mask),oe.disableAll(),Te.fog&&oe.enable(0),Te.useFog&&oe.enable(1),Te.flatShading&&oe.enable(2),Te.logarithmicDepthBuffer&&oe.enable(3),Te.reverseDepthBuffer&&oe.enable(4),Te.skinning&&oe.enable(5),Te.morphTargets&&oe.enable(6),Te.morphNormals&&oe.enable(7),Te.morphColors&&oe.enable(8),Te.premultipliedAlpha&&oe.enable(9),Te.shadowMapEnabled&&oe.enable(10),Te.doubleSided&&oe.enable(11),Te.flipSided&&oe.enable(12),Te.useDepthPacking&&oe.enable(13),Te.dithering&&oe.enable(14),Te.transmission&&oe.enable(15),Te.sheen&&oe.enable(16),Te.opaque&&oe.enable(17),Te.pointsUvs&&oe.enable(18),Te.decodeVideoTexture&&oe.enable(19),Te.decodeVideoTextureEmissive&&oe.enable(20),Te.alphaToCoverage&&oe.enable(21),Fe.push(oe.mask)}function Re(Fe){const Te=fe[Fe.type];let ke;if(Te){const Le=ShaderLib[Te];ke=UniformsUtils.clone(Le.uniforms)}else ke=Fe.uniforms;return ke}function Ve(Fe,Te){let ke;for(let Le=0,Ke=ge.length;Le<Ke;Le++){const Ue=ge[Le];if(Ue.cacheKey===Te){ke=Ue,++ke.usedTimes;break}}return ke===void 0&&(ke=new WebGLProgram(X,Te,Fe,ne),ge.push(ke)),ke}function Ee(Fe){if(--Fe.usedTimes===0){const Te=ge.indexOf(Fe);ge[Te]=ge[ge.length-1],ge.pop(),Fe.destroy()}}function Ze(Fe){se.remove(Fe)}function _e(){se.dispose()}return{getParameters:Ae,getProgramCacheKey:ye,getUniforms:Re,acquireProgram:Ve,releaseProgram:Ee,releaseShaderCache:Ze,programs:ge,dispose:_e}}function WebGLProperties(){let X=new WeakMap;function Z(ie){return X.has(ie)}function _(ie){let oe=X.get(ie);return oe===void 0&&(oe={},X.set(ie,oe)),oe}function K(ie){X.delete(ie)}function te(ie,oe,se){X.get(ie)[oe]=se}function ne(){X=new WeakMap}return{has:Z,get:_,remove:K,update:te,dispose:ne}}function painterSortStable(X,Z){return X.groupOrder!==Z.groupOrder?X.groupOrder-Z.groupOrder:X.renderOrder!==Z.renderOrder?X.renderOrder-Z.renderOrder:X.material.id!==Z.material.id?X.material.id-Z.material.id:X.z!==Z.z?X.z-Z.z:X.id-Z.id}function reversePainterSortStable(X,Z){return X.groupOrder!==Z.groupOrder?X.groupOrder-Z.groupOrder:X.renderOrder!==Z.renderOrder?X.renderOrder-Z.renderOrder:X.z!==Z.z?Z.z-X.z:X.id-Z.id}function WebGLRenderList(){const X=[];let Z=0;const _=[],K=[],te=[];function ne(){Z=0,_.length=0,K.length=0,te.length=0}function ie(ce,de,Ie,fe,be,Ae){let ye=X[Z];return ye===void 0?(ye={id:ce.id,object:ce,geometry:de,material:Ie,groupOrder:fe,renderOrder:ce.renderOrder,z:be,group:Ae},X[Z]=ye):(ye.id=ce.id,ye.object=ce,ye.geometry=de,ye.material=Ie,ye.groupOrder=fe,ye.renderOrder=ce.renderOrder,ye.z=be,ye.group=Ae),Z++,ye}function oe(ce,de,Ie,fe,be,Ae){const ye=ie(ce,de,Ie,fe,be,Ae);Ie.transmission>0?K.push(ye):Ie.transparent===!0?te.push(ye):_.push(ye)}function se(ce,de,Ie,fe,be,Ae){const ye=ie(ce,de,Ie,fe,be,Ae);Ie.transmission>0?K.unshift(ye):Ie.transparent===!0?te.unshift(ye):_.unshift(ye)}function ae(ce,de){_.length>1&&_.sort(ce||painterSortStable),K.length>1&&K.sort(de||reversePainterSortStable),te.length>1&&te.sort(de||reversePainterSortStable)}function ge(){for(let ce=Z,de=X.length;ce<de;ce++){const Ie=X[ce];if(Ie.id===null)break;Ie.id=null,Ie.object=null,Ie.geometry=null,Ie.material=null,Ie.group=null}}return{opaque:_,transmissive:K,transparent:te,init:ne,push:oe,unshift:se,finish:ge,sort:ae}}function WebGLRenderLists(){let X=new WeakMap;function Z(K,te){const ne=X.get(K);let ie;return ne===void 0?(ie=new WebGLRenderList,X.set(K,[ie])):te>=ne.length?(ie=new WebGLRenderList,ne.push(ie)):ie=ne[te],ie}function _(){X=new WeakMap}return{get:Z,dispose:_}}function UniformsCache(){const X={};return{get:function(Z){if(X[Z.id]!==void 0)return X[Z.id];let _;switch(Z.type){case"DirectionalLight":_={direction:new Vector3,color:new Color$1};break;case"SpotLight":_={position:new Vector3,direction:new Vector3,color:new Color$1,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":_={position:new Vector3,color:new Color$1,distance:0,decay:0};break;case"HemisphereLight":_={direction:new Vector3,skyColor:new Color$1,groundColor:new Color$1};break;case"RectAreaLight":_={color:new Color$1,position:new Vector3,halfWidth:new Vector3,halfHeight:new Vector3};break}return X[Z.id]=_,_}}}function ShadowUniformsCache(){const X={};return{get:function(Z){if(X[Z.id]!==void 0)return X[Z.id];let _;switch(Z.type){case"DirectionalLight":_={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Vector2};break;case"SpotLight":_={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Vector2};break;case"PointLight":_={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Vector2,shadowCameraNear:1,shadowCameraFar:1e3};break}return X[Z.id]=_,_}}}let nextVersion=0;function shadowCastingAndTexturingLightsFirst(X,Z){return(Z.castShadow?2:0)-(X.castShadow?2:0)+(Z.map?1:0)-(X.map?1:0)}function WebGLLights(X){const Z=new UniformsCache,_=ShadowUniformsCache(),K={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1,numLightProbes:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0,numLightProbes:0};for(let ae=0;ae<9;ae++)K.probe.push(new Vector3);const te=new Vector3,ne=new Matrix4,ie=new Matrix4;function oe(ae){let ge=0,ce=0,de=0;for(let Fe=0;Fe<9;Fe++)K.probe[Fe].set(0,0,0);let Ie=0,fe=0,be=0,Ae=0,ye=0,ve=0,Be=0,Re=0,Ve=0,Ee=0,Ze=0;ae.sort(shadowCastingAndTexturingLightsFirst);for(let Fe=0,Te=ae.length;Fe<Te;Fe++){const ke=ae[Fe],Le=ke.color,Ke=ke.intensity,Ue=ke.distance,rt=ke.shadow&&ke.shadow.map?ke.shadow.map.texture:null;if(ke.isAmbientLight)ge+=Le.r*Ke,ce+=Le.g*Ke,de+=Le.b*Ke;else if(ke.isLightProbe){for(let tt=0;tt<9;tt++)K.probe[tt].addScaledVector(ke.sh.coefficients[tt],Ke);Ze++}else if(ke.isDirectionalLight){const tt=Z.get(ke);if(tt.color.copy(ke.color).multiplyScalar(ke.intensity),ke.castShadow){const at=ke.shadow,ze=_.get(ke);ze.shadowIntensity=at.intensity,ze.shadowBias=at.bias,ze.shadowNormalBias=at.normalBias,ze.shadowRadius=at.radius,ze.shadowMapSize=at.mapSize,K.directionalShadow[Ie]=ze,K.directionalShadowMap[Ie]=rt,K.directionalShadowMatrix[Ie]=ke.shadow.matrix,ve++}K.directional[Ie]=tt,Ie++}else if(ke.isSpotLight){const tt=Z.get(ke);tt.position.setFromMatrixPosition(ke.matrixWorld),tt.color.copy(Le).multiplyScalar(Ke),tt.distance=Ue,tt.coneCos=Math.cos(ke.angle),tt.penumbraCos=Math.cos(ke.angle*(1-ke.penumbra)),tt.decay=ke.decay,K.spot[be]=tt;const at=ke.shadow;if(ke.map&&(K.spotLightMap[Ve]=ke.map,Ve++,at.updateMatrices(ke),ke.castShadow&&Ee++),K.spotLightMatrix[be]=at.matrix,ke.castShadow){const ze=_.get(ke);ze.shadowIntensity=at.intensity,ze.shadowBias=at.bias,ze.shadowNormalBias=at.normalBias,ze.shadowRadius=at.radius,ze.shadowMapSize=at.mapSize,K.spotShadow[be]=ze,K.spotShadowMap[be]=rt,Re++}be++}else if(ke.isRectAreaLight){const tt=Z.get(ke);tt.color.copy(Le).multiplyScalar(Ke),tt.halfWidth.set(ke.width*.5,0,0),tt.halfHeight.set(0,ke.height*.5,0),K.rectArea[Ae]=tt,Ae++}else if(ke.isPointLight){const tt=Z.get(ke);if(tt.color.copy(ke.color).multiplyScalar(ke.intensity),tt.distance=ke.distance,tt.decay=ke.decay,ke.castShadow){const at=ke.shadow,ze=_.get(ke);ze.shadowIntensity=at.intensity,ze.shadowBias=at.bias,ze.shadowNormalBias=at.normalBias,ze.shadowRadius=at.radius,ze.shadowMapSize=at.mapSize,ze.shadowCameraNear=at.camera.near,ze.shadowCameraFar=at.camera.far,K.pointShadow[fe]=ze,K.pointShadowMap[fe]=rt,K.pointShadowMatrix[fe]=ke.shadow.matrix,Be++}K.point[fe]=tt,fe++}else if(ke.isHemisphereLight){const tt=Z.get(ke);tt.skyColor.copy(ke.color).multiplyScalar(Ke),tt.groundColor.copy(ke.groundColor).multiplyScalar(Ke),K.hemi[ye]=tt,ye++}}Ae>0&&(X.has("OES_texture_float_linear")===!0?(K.rectAreaLTC1=UniformsLib.LTC_FLOAT_1,K.rectAreaLTC2=UniformsLib.LTC_FLOAT_2):(K.rectAreaLTC1=UniformsLib.LTC_HALF_1,K.rectAreaLTC2=UniformsLib.LTC_HALF_2)),K.ambient[0]=ge,K.ambient[1]=ce,K.ambient[2]=de;const _e=K.hash;(_e.directionalLength!==Ie||_e.pointLength!==fe||_e.spotLength!==be||_e.rectAreaLength!==Ae||_e.hemiLength!==ye||_e.numDirectionalShadows!==ve||_e.numPointShadows!==Be||_e.numSpotShadows!==Re||_e.numSpotMaps!==Ve||_e.numLightProbes!==Ze)&&(K.directional.length=Ie,K.spot.length=be,K.rectArea.length=Ae,K.point.length=fe,K.hemi.length=ye,K.directionalShadow.length=ve,K.directionalShadowMap.length=ve,K.pointShadow.length=Be,K.pointShadowMap.length=Be,K.spotShadow.length=Re,K.spotShadowMap.length=Re,K.directionalShadowMatrix.length=ve,K.pointShadowMatrix.length=Be,K.spotLightMatrix.length=Re+Ve-Ee,K.spotLightMap.length=Ve,K.numSpotLightShadowsWithMaps=Ee,K.numLightProbes=Ze,_e.directionalLength=Ie,_e.pointLength=fe,_e.spotLength=be,_e.rectAreaLength=Ae,_e.hemiLength=ye,_e.numDirectionalShadows=ve,_e.numPointShadows=Be,_e.numSpotShadows=Re,_e.numSpotMaps=Ve,_e.numLightProbes=Ze,K.version=nextVersion++)}function se(ae,ge){let ce=0,de=0,Ie=0,fe=0,be=0;const Ae=ge.matrixWorldInverse;for(let ye=0,ve=ae.length;ye<ve;ye++){const Be=ae[ye];if(Be.isDirectionalLight){const Re=K.directional[ce];Re.direction.setFromMatrixPosition(Be.matrixWorld),te.setFromMatrixPosition(Be.target.matrixWorld),Re.direction.sub(te),Re.direction.transformDirection(Ae),ce++}else if(Be.isSpotLight){const Re=K.spot[Ie];Re.position.setFromMatrixPosition(Be.matrixWorld),Re.position.applyMatrix4(Ae),Re.direction.setFromMatrixPosition(Be.matrixWorld),te.setFromMatrixPosition(Be.target.matrixWorld),Re.direction.sub(te),Re.direction.transformDirection(Ae),Ie++}else if(Be.isRectAreaLight){const Re=K.rectArea[fe];Re.position.setFromMatrixPosition(Be.matrixWorld),Re.position.applyMatrix4(Ae),ie.identity(),ne.copy(Be.matrixWorld),ne.premultiply(Ae),ie.extractRotation(ne),Re.halfWidth.set(Be.width*.5,0,0),Re.halfHeight.set(0,Be.height*.5,0),Re.halfWidth.applyMatrix4(ie),Re.halfHeight.applyMatrix4(ie),fe++}else if(Be.isPointLight){const Re=K.point[de];Re.position.setFromMatrixPosition(Be.matrixWorld),Re.position.applyMatrix4(Ae),de++}else if(Be.isHemisphereLight){const Re=K.hemi[be];Re.direction.setFromMatrixPosition(Be.matrixWorld),Re.direction.transformDirection(Ae),be++}}}return{setup:oe,setupView:se,state:K}}function WebGLRenderState(X){const Z=new WebGLLights(X),_=[],K=[];function te(ge){ae.camera=ge,_.length=0,K.length=0}function ne(ge){_.push(ge)}function ie(ge){K.push(ge)}function oe(){Z.setup(_)}function se(ge){Z.setupView(_,ge)}const ae={lightsArray:_,shadowsArray:K,camera:null,lights:Z,transmissionRenderTarget:{}};return{init:te,state:ae,setupLights:oe,setupLightsView:se,pushLight:ne,pushShadow:ie}}function WebGLRenderStates(X){let Z=new WeakMap;function _(te,ne=0){const ie=Z.get(te);let oe;return ie===void 0?(oe=new WebGLRenderState(X),Z.set(te,[oe])):ne>=ie.length?(oe=new WebGLRenderState(X),ie.push(oe)):oe=ie[ne],oe}function K(){Z=new WeakMap}return{get:_,dispose:K}}const vertex=`void main() {
	gl_Position = vec4( position, 1.0 );
}`,fragment=`uniform sampler2D shadow_pass;
uniform vec2 resolution;
uniform float radius;
#include <packing>
void main() {
	const float samples = float( VSM_SAMPLES );
	float mean = 0.0;
	float squared_mean = 0.0;
	float uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );
	float uvStart = samples <= 1.0 ? 0.0 : - 1.0;
	for ( float i = 0.0; i < samples; i ++ ) {
		float uvOffset = uvStart + i * uvStride;
		#ifdef HORIZONTAL_PASS
			vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );
			mean += distribution.x;
			squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;
		#else
			float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );
			mean += depth;
			squared_mean += depth * depth;
		#endif
	}
	mean = mean / samples;
	squared_mean = squared_mean / samples;
	float std_dev = sqrt( squared_mean - mean * mean );
	gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );
}`;function WebGLShadowMap(X,Z,_){let K=new Frustum;const te=new Vector2,ne=new Vector2,ie=new Vector4,oe=new MeshDepthMaterial({depthPacking:RGBADepthPacking}),se=new MeshDistanceMaterial,ae={},ge=_.maxTextureSize,ce={[FrontSide]:BackSide,[BackSide]:FrontSide,[DoubleSide]:DoubleSide},de=new ShaderMaterial({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new Vector2},radius:{value:4}},vertexShader:vertex,fragmentShader:fragment}),Ie=de.clone();Ie.defines.HORIZONTAL_PASS=1;const fe=new BufferGeometry;fe.setAttribute("position",new BufferAttribute(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const be=new Mesh(fe,de),Ae=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=PCFShadowMap;let ye=this.type;this.render=function(Ee,Ze,_e){if(Ae.enabled===!1||Ae.autoUpdate===!1&&Ae.needsUpdate===!1||Ee.length===0)return;const Fe=X.getRenderTarget(),Te=X.getActiveCubeFace(),ke=X.getActiveMipmapLevel(),Le=X.state;Le.setBlending(NoBlending),Le.buffers.color.setClear(1,1,1,1),Le.buffers.depth.setTest(!0),Le.setScissorTest(!1);const Ke=ye!==VSMShadowMap&&this.type===VSMShadowMap,Ue=ye===VSMShadowMap&&this.type!==VSMShadowMap;for(let rt=0,tt=Ee.length;rt<tt;rt++){const at=Ee[rt],ze=at.shadow;if(ze===void 0){console.warn("THREE.WebGLShadowMap:",at,"has no shadow.");continue}if(ze.autoUpdate===!1&&ze.needsUpdate===!1)continue;te.copy(ze.mapSize);const qe=ze.getFrameExtents();if(te.multiply(qe),ne.copy(ze.mapSize),(te.x>ge||te.y>ge)&&(te.x>ge&&(ne.x=Math.floor(ge/qe.x),te.x=ne.x*qe.x,ze.mapSize.x=ne.x),te.y>ge&&(ne.y=Math.floor(ge/qe.y),te.y=ne.y*qe.y,ze.mapSize.y=ne.y)),ze.map===null||Ke===!0||Ue===!0){const Ye=this.type!==VSMShadowMap?{minFilter:NearestFilter,magFilter:NearestFilter}:{};ze.map!==null&&ze.map.dispose(),ze.map=new WebGLRenderTarget(te.x,te.y,Ye),ze.map.texture.name=at.name+".shadowMap",ze.camera.updateProjectionMatrix()}X.setRenderTarget(ze.map),X.clear();const Pe=ze.getViewportCount();for(let Ye=0;Ye<Pe;Ye++){const $e=ze.getViewport(Ye);ie.set(ne.x*$e.x,ne.y*$e.y,ne.x*$e.z,ne.y*$e.w),Le.viewport(ie),ze.updateMatrices(at,Ye),K=ze.getFrustum(),Re(Ze,_e,ze.camera,at,this.type)}ze.isPointLightShadow!==!0&&this.type===VSMShadowMap&&ve(ze,_e),ze.needsUpdate=!1}ye=this.type,Ae.needsUpdate=!1,X.setRenderTarget(Fe,Te,ke)};function ve(Ee,Ze){const _e=Z.update(be);de.defines.VSM_SAMPLES!==Ee.blurSamples&&(de.defines.VSM_SAMPLES=Ee.blurSamples,Ie.defines.VSM_SAMPLES=Ee.blurSamples,de.needsUpdate=!0,Ie.needsUpdate=!0),Ee.mapPass===null&&(Ee.mapPass=new WebGLRenderTarget(te.x,te.y)),de.uniforms.shadow_pass.value=Ee.map.texture,de.uniforms.resolution.value=Ee.mapSize,de.uniforms.radius.value=Ee.radius,X.setRenderTarget(Ee.mapPass),X.clear(),X.renderBufferDirect(Ze,null,_e,de,be,null),Ie.uniforms.shadow_pass.value=Ee.mapPass.texture,Ie.uniforms.resolution.value=Ee.mapSize,Ie.uniforms.radius.value=Ee.radius,X.setRenderTarget(Ee.map),X.clear(),X.renderBufferDirect(Ze,null,_e,Ie,be,null)}function Be(Ee,Ze,_e,Fe){let Te=null;const ke=_e.isPointLight===!0?Ee.customDistanceMaterial:Ee.customDepthMaterial;if(ke!==void 0)Te=ke;else if(Te=_e.isPointLight===!0?se:oe,X.localClippingEnabled&&Ze.clipShadows===!0&&Array.isArray(Ze.clippingPlanes)&&Ze.clippingPlanes.length!==0||Ze.displacementMap&&Ze.displacementScale!==0||Ze.alphaMap&&Ze.alphaTest>0||Ze.map&&Ze.alphaTest>0){const Le=Te.uuid,Ke=Ze.uuid;let Ue=ae[Le];Ue===void 0&&(Ue={},ae[Le]=Ue);let rt=Ue[Ke];rt===void 0&&(rt=Te.clone(),Ue[Ke]=rt,Ze.addEventListener("dispose",Ve)),Te=rt}if(Te.visible=Ze.visible,Te.wireframe=Ze.wireframe,Fe===VSMShadowMap?Te.side=Ze.shadowSide!==null?Ze.shadowSide:Ze.side:Te.side=Ze.shadowSide!==null?Ze.shadowSide:ce[Ze.side],Te.alphaMap=Ze.alphaMap,Te.alphaTest=Ze.alphaTest,Te.map=Ze.map,Te.clipShadows=Ze.clipShadows,Te.clippingPlanes=Ze.clippingPlanes,Te.clipIntersection=Ze.clipIntersection,Te.displacementMap=Ze.displacementMap,Te.displacementScale=Ze.displacementScale,Te.displacementBias=Ze.displacementBias,Te.wireframeLinewidth=Ze.wireframeLinewidth,Te.linewidth=Ze.linewidth,_e.isPointLight===!0&&Te.isMeshDistanceMaterial===!0){const Le=X.properties.get(Te);Le.light=_e}return Te}function Re(Ee,Ze,_e,Fe,Te){if(Ee.visible===!1)return;if(Ee.layers.test(Ze.layers)&&(Ee.isMesh||Ee.isLine||Ee.isPoints)&&(Ee.castShadow||Ee.receiveShadow&&Te===VSMShadowMap)&&(!Ee.frustumCulled||K.intersectsObject(Ee))){Ee.modelViewMatrix.multiplyMatrices(_e.matrixWorldInverse,Ee.matrixWorld);const Ke=Z.update(Ee),Ue=Ee.material;if(Array.isArray(Ue)){const rt=Ke.groups;for(let tt=0,at=rt.length;tt<at;tt++){const ze=rt[tt],qe=Ue[ze.materialIndex];if(qe&&qe.visible){const Pe=Be(Ee,qe,Fe,Te);Ee.onBeforeShadow(X,Ee,Ze,_e,Ke,Pe,ze),X.renderBufferDirect(_e,null,Ke,Pe,Ee,ze),Ee.onAfterShadow(X,Ee,Ze,_e,Ke,Pe,ze)}}}else if(Ue.visible){const rt=Be(Ee,Ue,Fe,Te);Ee.onBeforeShadow(X,Ee,Ze,_e,Ke,rt,null),X.renderBufferDirect(_e,null,Ke,rt,Ee,null),Ee.onAfterShadow(X,Ee,Ze,_e,Ke,rt,null)}}const Le=Ee.children;for(let Ke=0,Ue=Le.length;Ke<Ue;Ke++)Re(Le[Ke],Ze,_e,Fe,Te)}function Ve(Ee){Ee.target.removeEventListener("dispose",Ve);for(const _e in ae){const Fe=ae[_e],Te=Ee.target.uuid;Te in Fe&&(Fe[Te].dispose(),delete Fe[Te])}}}const reversedFuncs={[NeverDepth]:AlwaysDepth,[LessDepth]:GreaterDepth,[EqualDepth]:NotEqualDepth,[LessEqualDepth]:GreaterEqualDepth,[AlwaysDepth]:NeverDepth,[GreaterDepth]:LessDepth,[NotEqualDepth]:EqualDepth,[GreaterEqualDepth]:LessEqualDepth};function WebGLState(X,Z){function _(){let vt=!1;const wt=new Vector4;let Mt=null;const on=new Vector4(0,0,0,0);return{setMask:function(dn){Mt!==dn&&!vt&&(X.colorMask(dn,dn,dn,dn),Mt=dn)},setLocked:function(dn){vt=dn},setClear:function(dn,an,Mn,Pn,Nn){Nn===!0&&(dn*=Pn,an*=Pn,Mn*=Pn),wt.set(dn,an,Mn,Pn),on.equals(wt)===!1&&(X.clearColor(dn,an,Mn,Pn),on.copy(wt))},reset:function(){vt=!1,Mt=null,on.set(-1,0,0,0)}}}function K(){let vt=!1,wt=!1,Mt=null,on=null,dn=null;return{setReversed:function(an){if(wt!==an){const Mn=Z.get("EXT_clip_control");wt?Mn.clipControlEXT(Mn.LOWER_LEFT_EXT,Mn.ZERO_TO_ONE_EXT):Mn.clipControlEXT(Mn.LOWER_LEFT_EXT,Mn.NEGATIVE_ONE_TO_ONE_EXT);const Pn=dn;dn=null,this.setClear(Pn)}wt=an},getReversed:function(){return wt},setTest:function(an){an?dt(X.DEPTH_TEST):bt(X.DEPTH_TEST)},setMask:function(an){Mt!==an&&!vt&&(X.depthMask(an),Mt=an)},setFunc:function(an){if(wt&&(an=reversedFuncs[an]),on!==an){switch(an){case NeverDepth:X.depthFunc(X.NEVER);break;case AlwaysDepth:X.depthFunc(X.ALWAYS);break;case LessDepth:X.depthFunc(X.LESS);break;case LessEqualDepth:X.depthFunc(X.LEQUAL);break;case EqualDepth:X.depthFunc(X.EQUAL);break;case GreaterEqualDepth:X.depthFunc(X.GEQUAL);break;case GreaterDepth:X.depthFunc(X.GREATER);break;case NotEqualDepth:X.depthFunc(X.NOTEQUAL);break;default:X.depthFunc(X.LEQUAL)}on=an}},setLocked:function(an){vt=an},setClear:function(an){dn!==an&&(wt&&(an=1-an),X.clearDepth(an),dn=an)},reset:function(){vt=!1,Mt=null,on=null,dn=null,wt=!1}}}function te(){let vt=!1,wt=null,Mt=null,on=null,dn=null,an=null,Mn=null,Pn=null,Nn=null;return{setTest:function(kn){vt||(kn?dt(X.STENCIL_TEST):bt(X.STENCIL_TEST))},setMask:function(kn){wt!==kn&&!vt&&(X.stencilMask(kn),wt=kn)},setFunc:function(kn,Ir,dr){(Mt!==kn||on!==Ir||dn!==dr)&&(X.stencilFunc(kn,Ir,dr),Mt=kn,on=Ir,dn=dr)},setOp:function(kn,Ir,dr){(an!==kn||Mn!==Ir||Pn!==dr)&&(X.stencilOp(kn,Ir,dr),an=kn,Mn=Ir,Pn=dr)},setLocked:function(kn){vt=kn},setClear:function(kn){Nn!==kn&&(X.clearStencil(kn),Nn=kn)},reset:function(){vt=!1,wt=null,Mt=null,on=null,dn=null,an=null,Mn=null,Pn=null,Nn=null}}}const ne=new _,ie=new K,oe=new te,se=new WeakMap,ae=new WeakMap;let ge={},ce={},de=new WeakMap,Ie=[],fe=null,be=!1,Ae=null,ye=null,ve=null,Be=null,Re=null,Ve=null,Ee=null,Ze=new Color$1(0,0,0),_e=0,Fe=!1,Te=null,ke=null,Le=null,Ke=null,Ue=null;const rt=X.getParameter(X.MAX_COMBINED_TEXTURE_IMAGE_UNITS);let tt=!1,at=0;const ze=X.getParameter(X.VERSION);ze.indexOf("WebGL")!==-1?(at=parseFloat(/^WebGL (\d)/.exec(ze)[1]),tt=at>=1):ze.indexOf("OpenGL ES")!==-1&&(at=parseFloat(/^OpenGL ES (\d)/.exec(ze)[1]),tt=at>=2);let qe=null,Pe={};const Ye=X.getParameter(X.SCISSOR_BOX),$e=X.getParameter(X.VIEWPORT),ut=new Vector4().fromArray(Ye),ot=new Vector4().fromArray($e);function gt(vt,wt,Mt,on){const dn=new Uint8Array(4),an=X.createTexture();X.bindTexture(vt,an),X.texParameteri(vt,X.TEXTURE_MIN_FILTER,X.NEAREST),X.texParameteri(vt,X.TEXTURE_MAG_FILTER,X.NEAREST);for(let Mn=0;Mn<Mt;Mn++)vt===X.TEXTURE_3D||vt===X.TEXTURE_2D_ARRAY?X.texImage3D(wt,0,X.RGBA,1,1,on,0,X.RGBA,X.UNSIGNED_BYTE,dn):X.texImage2D(wt+Mn,0,X.RGBA,1,1,0,X.RGBA,X.UNSIGNED_BYTE,dn);return an}const ht={};ht[X.TEXTURE_2D]=gt(X.TEXTURE_2D,X.TEXTURE_2D,1),ht[X.TEXTURE_CUBE_MAP]=gt(X.TEXTURE_CUBE_MAP,X.TEXTURE_CUBE_MAP_POSITIVE_X,6),ht[X.TEXTURE_2D_ARRAY]=gt(X.TEXTURE_2D_ARRAY,X.TEXTURE_2D_ARRAY,1,1),ht[X.TEXTURE_3D]=gt(X.TEXTURE_3D,X.TEXTURE_3D,1,1),ne.setClear(0,0,0,1),ie.setClear(1),oe.setClear(0),dt(X.DEPTH_TEST),ie.setFunc(LessEqualDepth),Et(!1),Ut(CullFaceBack),dt(X.CULL_FACE),it(NoBlending);function dt(vt){ge[vt]!==!0&&(X.enable(vt),ge[vt]=!0)}function bt(vt){ge[vt]!==!1&&(X.disable(vt),ge[vt]=!1)}function Ht(vt,wt){return ce[vt]!==wt?(X.bindFramebuffer(vt,wt),ce[vt]=wt,vt===X.DRAW_FRAMEBUFFER&&(ce[X.FRAMEBUFFER]=wt),vt===X.FRAMEBUFFER&&(ce[X.DRAW_FRAMEBUFFER]=wt),!0):!1}function Dt(vt,wt){let Mt=Ie,on=!1;if(vt){Mt=de.get(wt),Mt===void 0&&(Mt=[],de.set(wt,Mt));const dn=vt.textures;if(Mt.length!==dn.length||Mt[0]!==X.COLOR_ATTACHMENT0){for(let an=0,Mn=dn.length;an<Mn;an++)Mt[an]=X.COLOR_ATTACHMENT0+an;Mt.length=dn.length,on=!0}}else Mt[0]!==X.BACK&&(Mt[0]=X.BACK,on=!0);on&&X.drawBuffers(Mt)}function Vt(vt){return fe!==vt?(X.useProgram(vt),fe=vt,!0):!1}const mt={[AddEquation]:X.FUNC_ADD,[SubtractEquation]:X.FUNC_SUBTRACT,[ReverseSubtractEquation]:X.FUNC_REVERSE_SUBTRACT};mt[MinEquation]=X.MIN,mt[MaxEquation]=X.MAX;const Ft={[ZeroFactor]:X.ZERO,[OneFactor]:X.ONE,[SrcColorFactor]:X.SRC_COLOR,[SrcAlphaFactor]:X.SRC_ALPHA,[SrcAlphaSaturateFactor]:X.SRC_ALPHA_SATURATE,[DstColorFactor]:X.DST_COLOR,[DstAlphaFactor]:X.DST_ALPHA,[OneMinusSrcColorFactor]:X.ONE_MINUS_SRC_COLOR,[OneMinusSrcAlphaFactor]:X.ONE_MINUS_SRC_ALPHA,[OneMinusDstColorFactor]:X.ONE_MINUS_DST_COLOR,[OneMinusDstAlphaFactor]:X.ONE_MINUS_DST_ALPHA,[ConstantColorFactor]:X.CONSTANT_COLOR,[OneMinusConstantColorFactor]:X.ONE_MINUS_CONSTANT_COLOR,[ConstantAlphaFactor]:X.CONSTANT_ALPHA,[OneMinusConstantAlphaFactor]:X.ONE_MINUS_CONSTANT_ALPHA};function it(vt,wt,Mt,on,dn,an,Mn,Pn,Nn,kn){if(vt===NoBlending){be===!0&&(bt(X.BLEND),be=!1);return}if(be===!1&&(dt(X.BLEND),be=!0),vt!==CustomBlending){if(vt!==Ae||kn!==Fe){if((ye!==AddEquation||Re!==AddEquation)&&(X.blendEquation(X.FUNC_ADD),ye=AddEquation,Re=AddEquation),kn)switch(vt){case NormalBlending:X.blendFuncSeparate(X.ONE,X.ONE_MINUS_SRC_ALPHA,X.ONE,X.ONE_MINUS_SRC_ALPHA);break;case AdditiveBlending:X.blendFunc(X.ONE,X.ONE);break;case SubtractiveBlending:X.blendFuncSeparate(X.ZERO,X.ONE_MINUS_SRC_COLOR,X.ZERO,X.ONE);break;case MultiplyBlending:X.blendFuncSeparate(X.ZERO,X.SRC_COLOR,X.ZERO,X.SRC_ALPHA);break;default:console.error("THREE.WebGLState: Invalid blending: ",vt);break}else switch(vt){case NormalBlending:X.blendFuncSeparate(X.SRC_ALPHA,X.ONE_MINUS_SRC_ALPHA,X.ONE,X.ONE_MINUS_SRC_ALPHA);break;case AdditiveBlending:X.blendFunc(X.SRC_ALPHA,X.ONE);break;case SubtractiveBlending:X.blendFuncSeparate(X.ZERO,X.ONE_MINUS_SRC_COLOR,X.ZERO,X.ONE);break;case MultiplyBlending:X.blendFunc(X.ZERO,X.SRC_COLOR);break;default:console.error("THREE.WebGLState: Invalid blending: ",vt);break}ve=null,Be=null,Ve=null,Ee=null,Ze.set(0,0,0),_e=0,Ae=vt,Fe=kn}return}dn=dn||wt,an=an||Mt,Mn=Mn||on,(wt!==ye||dn!==Re)&&(X.blendEquationSeparate(mt[wt],mt[dn]),ye=wt,Re=dn),(Mt!==ve||on!==Be||an!==Ve||Mn!==Ee)&&(X.blendFuncSeparate(Ft[Mt],Ft[on],Ft[an],Ft[Mn]),ve=Mt,Be=on,Ve=an,Ee=Mn),(Pn.equals(Ze)===!1||Nn!==_e)&&(X.blendColor(Pn.r,Pn.g,Pn.b,Nn),Ze.copy(Pn),_e=Nn),Ae=vt,Fe=!1}function Lt(vt,wt){vt.side===DoubleSide?bt(X.CULL_FACE):dt(X.CULL_FACE);let Mt=vt.side===BackSide;wt&&(Mt=!Mt),Et(Mt),vt.blending===NormalBlending&&vt.transparent===!1?it(NoBlending):it(vt.blending,vt.blendEquation,vt.blendSrc,vt.blendDst,vt.blendEquationAlpha,vt.blendSrcAlpha,vt.blendDstAlpha,vt.blendColor,vt.blendAlpha,vt.premultipliedAlpha),ie.setFunc(vt.depthFunc),ie.setTest(vt.depthTest),ie.setMask(vt.depthWrite),ne.setMask(vt.colorWrite);const on=vt.stencilWrite;oe.setTest(on),on&&(oe.setMask(vt.stencilWriteMask),oe.setFunc(vt.stencilFunc,vt.stencilRef,vt.stencilFuncMask),oe.setOp(vt.stencilFail,vt.stencilZFail,vt.stencilZPass)),Ot(vt.polygonOffset,vt.polygonOffsetFactor,vt.polygonOffsetUnits),vt.alphaToCoverage===!0?dt(X.SAMPLE_ALPHA_TO_COVERAGE):bt(X.SAMPLE_ALPHA_TO_COVERAGE)}function Et(vt){Te!==vt&&(vt?X.frontFace(X.CW):X.frontFace(X.CCW),Te=vt)}function Ut(vt){vt!==CullFaceNone?(dt(X.CULL_FACE),vt!==ke&&(vt===CullFaceBack?X.cullFace(X.BACK):vt===CullFaceFront?X.cullFace(X.FRONT):X.cullFace(X.FRONT_AND_BACK))):bt(X.CULL_FACE),ke=vt}function Zt(vt){vt!==Le&&(tt&&X.lineWidth(vt),Le=vt)}function Ot(vt,wt,Mt){vt?(dt(X.POLYGON_OFFSET_FILL),(Ke!==wt||Ue!==Mt)&&(X.polygonOffset(wt,Mt),Ke=wt,Ue=Mt)):bt(X.POLYGON_OFFSET_FILL)}function Tt(vt){vt?dt(X.SCISSOR_TEST):bt(X.SCISSOR_TEST)}function Je(vt){vt===void 0&&(vt=X.TEXTURE0+rt-1),qe!==vt&&(X.activeTexture(vt),qe=vt)}function Oe(vt,wt,Mt){Mt===void 0&&(qe===null?Mt=X.TEXTURE0+rt-1:Mt=qe);let on=Pe[Mt];on===void 0&&(on={type:void 0,texture:void 0},Pe[Mt]=on),(on.type!==vt||on.texture!==wt)&&(qe!==Mt&&(X.activeTexture(Mt),qe=Mt),X.bindTexture(vt,wt||ht[vt]),on.type=vt,on.texture=wt)}function lt(){const vt=Pe[qe];vt!==void 0&&vt.type!==void 0&&(X.bindTexture(vt.type,null),vt.type=void 0,vt.texture=void 0)}function ft(){try{X.compressedTexImage2D.apply(X,arguments)}catch(vt){console.error("THREE.WebGLState:",vt)}}function St(){try{X.compressedTexImage3D.apply(X,arguments)}catch(vt){console.error("THREE.WebGLState:",vt)}}function Wt(){try{X.texSubImage2D.apply(X,arguments)}catch(vt){console.error("THREE.WebGLState:",vt)}}function zt(){try{X.texSubImage3D.apply(X,arguments)}catch(vt){console.error("THREE.WebGLState:",vt)}}function $t(){try{X.compressedTexSubImage2D.apply(X,arguments)}catch(vt){console.error("THREE.WebGLState:",vt)}}function rn(){try{X.compressedTexSubImage3D.apply(X,arguments)}catch(vt){console.error("THREE.WebGLState:",vt)}}function Gn(){try{X.texStorage2D.apply(X,arguments)}catch(vt){console.error("THREE.WebGLState:",vt)}}function en(){try{X.texStorage3D.apply(X,arguments)}catch(vt){console.error("THREE.WebGLState:",vt)}}function In(){try{X.texImage2D.apply(X,arguments)}catch(vt){console.error("THREE.WebGLState:",vt)}}function un(){try{X.texImage3D.apply(X,arguments)}catch(vt){console.error("THREE.WebGLState:",vt)}}function ln(vt){ut.equals(vt)===!1&&(X.scissor(vt.x,vt.y,vt.z,vt.w),ut.copy(vt))}function tn(vt){ot.equals(vt)===!1&&(X.viewport(vt.x,vt.y,vt.z,vt.w),ot.copy(vt))}function Sn(vt,wt){let Mt=ae.get(wt);Mt===void 0&&(Mt=new WeakMap,ae.set(wt,Mt));let on=Mt.get(vt);on===void 0&&(on=X.getUniformBlockIndex(wt,vt.name),Mt.set(vt,on))}function yn(vt,wt){const on=ae.get(wt).get(vt);se.get(wt)!==on&&(X.uniformBlockBinding(wt,on,vt.__bindingPointIndex),se.set(wt,on))}function Tn(){X.disable(X.BLEND),X.disable(X.CULL_FACE),X.disable(X.DEPTH_TEST),X.disable(X.POLYGON_OFFSET_FILL),X.disable(X.SCISSOR_TEST),X.disable(X.STENCIL_TEST),X.disable(X.SAMPLE_ALPHA_TO_COVERAGE),X.blendEquation(X.FUNC_ADD),X.blendFunc(X.ONE,X.ZERO),X.blendFuncSeparate(X.ONE,X.ZERO,X.ONE,X.ZERO),X.blendColor(0,0,0,0),X.colorMask(!0,!0,!0,!0),X.clearColor(0,0,0,0),X.depthMask(!0),X.depthFunc(X.LESS),ie.setReversed(!1),X.clearDepth(1),X.stencilMask(4294967295),X.stencilFunc(X.ALWAYS,0,4294967295),X.stencilOp(X.KEEP,X.KEEP,X.KEEP),X.clearStencil(0),X.cullFace(X.BACK),X.frontFace(X.CCW),X.polygonOffset(0,0),X.activeTexture(X.TEXTURE0),X.bindFramebuffer(X.FRAMEBUFFER,null),X.bindFramebuffer(X.DRAW_FRAMEBUFFER,null),X.bindFramebuffer(X.READ_FRAMEBUFFER,null),X.useProgram(null),X.lineWidth(1),X.scissor(0,0,X.canvas.width,X.canvas.height),X.viewport(0,0,X.canvas.width,X.canvas.height),ge={},qe=null,Pe={},ce={},de=new WeakMap,Ie=[],fe=null,be=!1,Ae=null,ye=null,ve=null,Be=null,Re=null,Ve=null,Ee=null,Ze=new Color$1(0,0,0),_e=0,Fe=!1,Te=null,ke=null,Le=null,Ke=null,Ue=null,ut.set(0,0,X.canvas.width,X.canvas.height),ot.set(0,0,X.canvas.width,X.canvas.height),ne.reset(),ie.reset(),oe.reset()}return{buffers:{color:ne,depth:ie,stencil:oe},enable:dt,disable:bt,bindFramebuffer:Ht,drawBuffers:Dt,useProgram:Vt,setBlending:it,setMaterial:Lt,setFlipSided:Et,setCullFace:Ut,setLineWidth:Zt,setPolygonOffset:Ot,setScissorTest:Tt,activeTexture:Je,bindTexture:Oe,unbindTexture:lt,compressedTexImage2D:ft,compressedTexImage3D:St,texImage2D:In,texImage3D:un,updateUBOMapping:Sn,uniformBlockBinding:yn,texStorage2D:Gn,texStorage3D:en,texSubImage2D:Wt,texSubImage3D:zt,compressedTexSubImage2D:$t,compressedTexSubImage3D:rn,scissor:ln,viewport:tn,reset:Tn}}function WebGLTextures(X,Z,_,K,te,ne,ie){const oe=Z.has("WEBGL_multisampled_render_to_texture")?Z.get("WEBGL_multisampled_render_to_texture"):null,se=typeof navigator>"u"?!1:/OculusBrowser/g.test(navigator.userAgent),ae=new Vector2,ge=new WeakMap;let ce;const de=new WeakMap;let Ie=!1;try{Ie=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")!==null}catch{}function fe(Je,Oe){return Ie?new OffscreenCanvas(Je,Oe):createElementNS("canvas")}function be(Je,Oe,lt){let ft=1;const St=Tt(Je);if((St.width>lt||St.height>lt)&&(ft=lt/Math.max(St.width,St.height)),ft<1)if(typeof HTMLImageElement<"u"&&Je instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&Je instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&Je instanceof ImageBitmap||typeof VideoFrame<"u"&&Je instanceof VideoFrame){const Wt=Math.floor(ft*St.width),zt=Math.floor(ft*St.height);ce===void 0&&(ce=fe(Wt,zt));const $t=Oe?fe(Wt,zt):ce;return $t.width=Wt,$t.height=zt,$t.getContext("2d").drawImage(Je,0,0,Wt,zt),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+St.width+"x"+St.height+") to ("+Wt+"x"+zt+")."),$t}else return"data"in Je&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+St.width+"x"+St.height+")."),Je;return Je}function Ae(Je){return Je.generateMipmaps}function ye(Je){X.generateMipmap(Je)}function ve(Je){return Je.isWebGLCubeRenderTarget?X.TEXTURE_CUBE_MAP:Je.isWebGL3DRenderTarget?X.TEXTURE_3D:Je.isWebGLArrayRenderTarget||Je.isCompressedArrayTexture?X.TEXTURE_2D_ARRAY:X.TEXTURE_2D}function Be(Je,Oe,lt,ft,St=!1){if(Je!==null){if(X[Je]!==void 0)return X[Je];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+Je+"'")}let Wt=Oe;if(Oe===X.RED&&(lt===X.FLOAT&&(Wt=X.R32F),lt===X.HALF_FLOAT&&(Wt=X.R16F),lt===X.UNSIGNED_BYTE&&(Wt=X.R8)),Oe===X.RED_INTEGER&&(lt===X.UNSIGNED_BYTE&&(Wt=X.R8UI),lt===X.UNSIGNED_SHORT&&(Wt=X.R16UI),lt===X.UNSIGNED_INT&&(Wt=X.R32UI),lt===X.BYTE&&(Wt=X.R8I),lt===X.SHORT&&(Wt=X.R16I),lt===X.INT&&(Wt=X.R32I)),Oe===X.RG&&(lt===X.FLOAT&&(Wt=X.RG32F),lt===X.HALF_FLOAT&&(Wt=X.RG16F),lt===X.UNSIGNED_BYTE&&(Wt=X.RG8)),Oe===X.RG_INTEGER&&(lt===X.UNSIGNED_BYTE&&(Wt=X.RG8UI),lt===X.UNSIGNED_SHORT&&(Wt=X.RG16UI),lt===X.UNSIGNED_INT&&(Wt=X.RG32UI),lt===X.BYTE&&(Wt=X.RG8I),lt===X.SHORT&&(Wt=X.RG16I),lt===X.INT&&(Wt=X.RG32I)),Oe===X.RGB_INTEGER&&(lt===X.UNSIGNED_BYTE&&(Wt=X.RGB8UI),lt===X.UNSIGNED_SHORT&&(Wt=X.RGB16UI),lt===X.UNSIGNED_INT&&(Wt=X.RGB32UI),lt===X.BYTE&&(Wt=X.RGB8I),lt===X.SHORT&&(Wt=X.RGB16I),lt===X.INT&&(Wt=X.RGB32I)),Oe===X.RGBA_INTEGER&&(lt===X.UNSIGNED_BYTE&&(Wt=X.RGBA8UI),lt===X.UNSIGNED_SHORT&&(Wt=X.RGBA16UI),lt===X.UNSIGNED_INT&&(Wt=X.RGBA32UI),lt===X.BYTE&&(Wt=X.RGBA8I),lt===X.SHORT&&(Wt=X.RGBA16I),lt===X.INT&&(Wt=X.RGBA32I)),Oe===X.RGB&&lt===X.UNSIGNED_INT_5_9_9_9_REV&&(Wt=X.RGB9_E5),Oe===X.RGBA){const zt=St?LinearTransfer:ColorManagement.getTransfer(ft);lt===X.FLOAT&&(Wt=X.RGBA32F),lt===X.HALF_FLOAT&&(Wt=X.RGBA16F),lt===X.UNSIGNED_BYTE&&(Wt=zt===SRGBTransfer?X.SRGB8_ALPHA8:X.RGBA8),lt===X.UNSIGNED_SHORT_4_4_4_4&&(Wt=X.RGBA4),lt===X.UNSIGNED_SHORT_5_5_5_1&&(Wt=X.RGB5_A1)}return(Wt===X.R16F||Wt===X.R32F||Wt===X.RG16F||Wt===X.RG32F||Wt===X.RGBA16F||Wt===X.RGBA32F)&&Z.get("EXT_color_buffer_float"),Wt}function Re(Je,Oe){let lt;return Je?Oe===null||Oe===UnsignedIntType||Oe===UnsignedInt248Type?lt=X.DEPTH24_STENCIL8:Oe===FloatType?lt=X.DEPTH32F_STENCIL8:Oe===UnsignedShortType&&(lt=X.DEPTH24_STENCIL8,console.warn("DepthTexture: 16 bit depth attachment is not supported with stencil. Using 24-bit attachment.")):Oe===null||Oe===UnsignedIntType||Oe===UnsignedInt248Type?lt=X.DEPTH_COMPONENT24:Oe===FloatType?lt=X.DEPTH_COMPONENT32F:Oe===UnsignedShortType&&(lt=X.DEPTH_COMPONENT16),lt}function Ve(Je,Oe){return Ae(Je)===!0||Je.isFramebufferTexture&&Je.minFilter!==NearestFilter&&Je.minFilter!==LinearFilter?Math.log2(Math.max(Oe.width,Oe.height))+1:Je.mipmaps!==void 0&&Je.mipmaps.length>0?Je.mipmaps.length:Je.isCompressedTexture&&Array.isArray(Je.image)?Oe.mipmaps.length:1}function Ee(Je){const Oe=Je.target;Oe.removeEventListener("dispose",Ee),_e(Oe),Oe.isVideoTexture&&ge.delete(Oe)}function Ze(Je){const Oe=Je.target;Oe.removeEventListener("dispose",Ze),Te(Oe)}function _e(Je){const Oe=K.get(Je);if(Oe.__webglInit===void 0)return;const lt=Je.source,ft=de.get(lt);if(ft){const St=ft[Oe.__cacheKey];St.usedTimes--,St.usedTimes===0&&Fe(Je),Object.keys(ft).length===0&&de.delete(lt)}K.remove(Je)}function Fe(Je){const Oe=K.get(Je);X.deleteTexture(Oe.__webglTexture);const lt=Je.source,ft=de.get(lt);delete ft[Oe.__cacheKey],ie.memory.textures--}function Te(Je){const Oe=K.get(Je);if(Je.depthTexture&&(Je.depthTexture.dispose(),K.remove(Je.depthTexture)),Je.isWebGLCubeRenderTarget)for(let ft=0;ft<6;ft++){if(Array.isArray(Oe.__webglFramebuffer[ft]))for(let St=0;St<Oe.__webglFramebuffer[ft].length;St++)X.deleteFramebuffer(Oe.__webglFramebuffer[ft][St]);else X.deleteFramebuffer(Oe.__webglFramebuffer[ft]);Oe.__webglDepthbuffer&&X.deleteRenderbuffer(Oe.__webglDepthbuffer[ft])}else{if(Array.isArray(Oe.__webglFramebuffer))for(let ft=0;ft<Oe.__webglFramebuffer.length;ft++)X.deleteFramebuffer(Oe.__webglFramebuffer[ft]);else X.deleteFramebuffer(Oe.__webglFramebuffer);if(Oe.__webglDepthbuffer&&X.deleteRenderbuffer(Oe.__webglDepthbuffer),Oe.__webglMultisampledFramebuffer&&X.deleteFramebuffer(Oe.__webglMultisampledFramebuffer),Oe.__webglColorRenderbuffer)for(let ft=0;ft<Oe.__webglColorRenderbuffer.length;ft++)Oe.__webglColorRenderbuffer[ft]&&X.deleteRenderbuffer(Oe.__webglColorRenderbuffer[ft]);Oe.__webglDepthRenderbuffer&&X.deleteRenderbuffer(Oe.__webglDepthRenderbuffer)}const lt=Je.textures;for(let ft=0,St=lt.length;ft<St;ft++){const Wt=K.get(lt[ft]);Wt.__webglTexture&&(X.deleteTexture(Wt.__webglTexture),ie.memory.textures--),K.remove(lt[ft])}K.remove(Je)}let ke=0;function Le(){ke=0}function Ke(){const Je=ke;return Je>=te.maxTextures&&console.warn("THREE.WebGLTextures: Trying to use "+Je+" texture units while this GPU supports only "+te.maxTextures),ke+=1,Je}function Ue(Je){const Oe=[];return Oe.push(Je.wrapS),Oe.push(Je.wrapT),Oe.push(Je.wrapR||0),Oe.push(Je.magFilter),Oe.push(Je.minFilter),Oe.push(Je.anisotropy),Oe.push(Je.internalFormat),Oe.push(Je.format),Oe.push(Je.type),Oe.push(Je.generateMipmaps),Oe.push(Je.premultiplyAlpha),Oe.push(Je.flipY),Oe.push(Je.unpackAlignment),Oe.push(Je.colorSpace),Oe.join()}function rt(Je,Oe){const lt=K.get(Je);if(Je.isVideoTexture&&Zt(Je),Je.isRenderTargetTexture===!1&&Je.version>0&&lt.__version!==Je.version){const ft=Je.image;if(ft===null)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else if(ft.complete===!1)console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete");else{ot(lt,Je,Oe);return}}_.bindTexture(X.TEXTURE_2D,lt.__webglTexture,X.TEXTURE0+Oe)}function tt(Je,Oe){const lt=K.get(Je);if(Je.version>0&&lt.__version!==Je.version){ot(lt,Je,Oe);return}_.bindTexture(X.TEXTURE_2D_ARRAY,lt.__webglTexture,X.TEXTURE0+Oe)}function at(Je,Oe){const lt=K.get(Je);if(Je.version>0&&lt.__version!==Je.version){ot(lt,Je,Oe);return}_.bindTexture(X.TEXTURE_3D,lt.__webglTexture,X.TEXTURE0+Oe)}function ze(Je,Oe){const lt=K.get(Je);if(Je.version>0&&lt.__version!==Je.version){gt(lt,Je,Oe);return}_.bindTexture(X.TEXTURE_CUBE_MAP,lt.__webglTexture,X.TEXTURE0+Oe)}const qe={[RepeatWrapping]:X.REPEAT,[ClampToEdgeWrapping]:X.CLAMP_TO_EDGE,[MirroredRepeatWrapping]:X.MIRRORED_REPEAT},Pe={[NearestFilter]:X.NEAREST,[NearestMipmapNearestFilter]:X.NEAREST_MIPMAP_NEAREST,[NearestMipmapLinearFilter]:X.NEAREST_MIPMAP_LINEAR,[LinearFilter]:X.LINEAR,[LinearMipmapNearestFilter]:X.LINEAR_MIPMAP_NEAREST,[LinearMipmapLinearFilter]:X.LINEAR_MIPMAP_LINEAR},Ye={[NeverCompare]:X.NEVER,[AlwaysCompare]:X.ALWAYS,[LessCompare]:X.LESS,[LessEqualCompare]:X.LEQUAL,[EqualCompare]:X.EQUAL,[GreaterEqualCompare]:X.GEQUAL,[GreaterCompare]:X.GREATER,[NotEqualCompare]:X.NOTEQUAL};function $e(Je,Oe){if(Oe.type===FloatType&&Z.has("OES_texture_float_linear")===!1&&(Oe.magFilter===LinearFilter||Oe.magFilter===LinearMipmapNearestFilter||Oe.magFilter===NearestMipmapLinearFilter||Oe.magFilter===LinearMipmapLinearFilter||Oe.minFilter===LinearFilter||Oe.minFilter===LinearMipmapNearestFilter||Oe.minFilter===NearestMipmapLinearFilter||Oe.minFilter===LinearMipmapLinearFilter)&&console.warn("THREE.WebGLRenderer: Unable to use linear filtering with floating point textures. OES_texture_float_linear not supported on this device."),X.texParameteri(Je,X.TEXTURE_WRAP_S,qe[Oe.wrapS]),X.texParameteri(Je,X.TEXTURE_WRAP_T,qe[Oe.wrapT]),(Je===X.TEXTURE_3D||Je===X.TEXTURE_2D_ARRAY)&&X.texParameteri(Je,X.TEXTURE_WRAP_R,qe[Oe.wrapR]),X.texParameteri(Je,X.TEXTURE_MAG_FILTER,Pe[Oe.magFilter]),X.texParameteri(Je,X.TEXTURE_MIN_FILTER,Pe[Oe.minFilter]),Oe.compareFunction&&(X.texParameteri(Je,X.TEXTURE_COMPARE_MODE,X.COMPARE_REF_TO_TEXTURE),X.texParameteri(Je,X.TEXTURE_COMPARE_FUNC,Ye[Oe.compareFunction])),Z.has("EXT_texture_filter_anisotropic")===!0){if(Oe.magFilter===NearestFilter||Oe.minFilter!==NearestMipmapLinearFilter&&Oe.minFilter!==LinearMipmapLinearFilter||Oe.type===FloatType&&Z.has("OES_texture_float_linear")===!1)return;if(Oe.anisotropy>1||K.get(Oe).__currentAnisotropy){const lt=Z.get("EXT_texture_filter_anisotropic");X.texParameterf(Je,lt.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(Oe.anisotropy,te.getMaxAnisotropy())),K.get(Oe).__currentAnisotropy=Oe.anisotropy}}}function ut(Je,Oe){let lt=!1;Je.__webglInit===void 0&&(Je.__webglInit=!0,Oe.addEventListener("dispose",Ee));const ft=Oe.source;let St=de.get(ft);St===void 0&&(St={},de.set(ft,St));const Wt=Ue(Oe);if(Wt!==Je.__cacheKey){St[Wt]===void 0&&(St[Wt]={texture:X.createTexture(),usedTimes:0},ie.memory.textures++,lt=!0),St[Wt].usedTimes++;const zt=St[Je.__cacheKey];zt!==void 0&&(St[Je.__cacheKey].usedTimes--,zt.usedTimes===0&&Fe(Oe)),Je.__cacheKey=Wt,Je.__webglTexture=St[Wt].texture}return lt}function ot(Je,Oe,lt){let ft=X.TEXTURE_2D;(Oe.isDataArrayTexture||Oe.isCompressedArrayTexture)&&(ft=X.TEXTURE_2D_ARRAY),Oe.isData3DTexture&&(ft=X.TEXTURE_3D);const St=ut(Je,Oe),Wt=Oe.source;_.bindTexture(ft,Je.__webglTexture,X.TEXTURE0+lt);const zt=K.get(Wt);if(Wt.version!==zt.__version||St===!0){_.activeTexture(X.TEXTURE0+lt);const $t=ColorManagement.getPrimaries(ColorManagement.workingColorSpace),rn=Oe.colorSpace===NoColorSpace?null:ColorManagement.getPrimaries(Oe.colorSpace),Gn=Oe.colorSpace===NoColorSpace||$t===rn?X.NONE:X.BROWSER_DEFAULT_WEBGL;X.pixelStorei(X.UNPACK_FLIP_Y_WEBGL,Oe.flipY),X.pixelStorei(X.UNPACK_PREMULTIPLY_ALPHA_WEBGL,Oe.premultiplyAlpha),X.pixelStorei(X.UNPACK_ALIGNMENT,Oe.unpackAlignment),X.pixelStorei(X.UNPACK_COLORSPACE_CONVERSION_WEBGL,Gn);let en=be(Oe.image,!1,te.maxTextureSize);en=Ot(Oe,en);const In=ne.convert(Oe.format,Oe.colorSpace),un=ne.convert(Oe.type);let ln=Be(Oe.internalFormat,In,un,Oe.colorSpace,Oe.isVideoTexture);$e(ft,Oe);let tn;const Sn=Oe.mipmaps,yn=Oe.isVideoTexture!==!0,Tn=zt.__version===void 0||St===!0,vt=Wt.dataReady,wt=Ve(Oe,en);if(Oe.isDepthTexture)ln=Re(Oe.format===DepthStencilFormat,Oe.type),Tn&&(yn?_.texStorage2D(X.TEXTURE_2D,1,ln,en.width,en.height):_.texImage2D(X.TEXTURE_2D,0,ln,en.width,en.height,0,In,un,null));else if(Oe.isDataTexture)if(Sn.length>0){yn&&Tn&&_.texStorage2D(X.TEXTURE_2D,wt,ln,Sn[0].width,Sn[0].height);for(let Mt=0,on=Sn.length;Mt<on;Mt++)tn=Sn[Mt],yn?vt&&_.texSubImage2D(X.TEXTURE_2D,Mt,0,0,tn.width,tn.height,In,un,tn.data):_.texImage2D(X.TEXTURE_2D,Mt,ln,tn.width,tn.height,0,In,un,tn.data);Oe.generateMipmaps=!1}else yn?(Tn&&_.texStorage2D(X.TEXTURE_2D,wt,ln,en.width,en.height),vt&&_.texSubImage2D(X.TEXTURE_2D,0,0,0,en.width,en.height,In,un,en.data)):_.texImage2D(X.TEXTURE_2D,0,ln,en.width,en.height,0,In,un,en.data);else if(Oe.isCompressedTexture)if(Oe.isCompressedArrayTexture){yn&&Tn&&_.texStorage3D(X.TEXTURE_2D_ARRAY,wt,ln,Sn[0].width,Sn[0].height,en.depth);for(let Mt=0,on=Sn.length;Mt<on;Mt++)if(tn=Sn[Mt],Oe.format!==RGBAFormat)if(In!==null)if(yn){if(vt)if(Oe.layerUpdates.size>0){const dn=getByteLength(tn.width,tn.height,Oe.format,Oe.type);for(const an of Oe.layerUpdates){const Mn=tn.data.subarray(an*dn/tn.data.BYTES_PER_ELEMENT,(an+1)*dn/tn.data.BYTES_PER_ELEMENT);_.compressedTexSubImage3D(X.TEXTURE_2D_ARRAY,Mt,0,0,an,tn.width,tn.height,1,In,Mn)}Oe.clearLayerUpdates()}else _.compressedTexSubImage3D(X.TEXTURE_2D_ARRAY,Mt,0,0,0,tn.width,tn.height,en.depth,In,tn.data)}else _.compressedTexImage3D(X.TEXTURE_2D_ARRAY,Mt,ln,tn.width,tn.height,en.depth,0,tn.data,0,0);else console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()");else yn?vt&&_.texSubImage3D(X.TEXTURE_2D_ARRAY,Mt,0,0,0,tn.width,tn.height,en.depth,In,un,tn.data):_.texImage3D(X.TEXTURE_2D_ARRAY,Mt,ln,tn.width,tn.height,en.depth,0,In,un,tn.data)}else{yn&&Tn&&_.texStorage2D(X.TEXTURE_2D,wt,ln,Sn[0].width,Sn[0].height);for(let Mt=0,on=Sn.length;Mt<on;Mt++)tn=Sn[Mt],Oe.format!==RGBAFormat?In!==null?yn?vt&&_.compressedTexSubImage2D(X.TEXTURE_2D,Mt,0,0,tn.width,tn.height,In,tn.data):_.compressedTexImage2D(X.TEXTURE_2D,Mt,ln,tn.width,tn.height,0,tn.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):yn?vt&&_.texSubImage2D(X.TEXTURE_2D,Mt,0,0,tn.width,tn.height,In,un,tn.data):_.texImage2D(X.TEXTURE_2D,Mt,ln,tn.width,tn.height,0,In,un,tn.data)}else if(Oe.isDataArrayTexture)if(yn){if(Tn&&_.texStorage3D(X.TEXTURE_2D_ARRAY,wt,ln,en.width,en.height,en.depth),vt)if(Oe.layerUpdates.size>0){const Mt=getByteLength(en.width,en.height,Oe.format,Oe.type);for(const on of Oe.layerUpdates){const dn=en.data.subarray(on*Mt/en.data.BYTES_PER_ELEMENT,(on+1)*Mt/en.data.BYTES_PER_ELEMENT);_.texSubImage3D(X.TEXTURE_2D_ARRAY,0,0,0,on,en.width,en.height,1,In,un,dn)}Oe.clearLayerUpdates()}else _.texSubImage3D(X.TEXTURE_2D_ARRAY,0,0,0,0,en.width,en.height,en.depth,In,un,en.data)}else _.texImage3D(X.TEXTURE_2D_ARRAY,0,ln,en.width,en.height,en.depth,0,In,un,en.data);else if(Oe.isData3DTexture)yn?(Tn&&_.texStorage3D(X.TEXTURE_3D,wt,ln,en.width,en.height,en.depth),vt&&_.texSubImage3D(X.TEXTURE_3D,0,0,0,0,en.width,en.height,en.depth,In,un,en.data)):_.texImage3D(X.TEXTURE_3D,0,ln,en.width,en.height,en.depth,0,In,un,en.data);else if(Oe.isFramebufferTexture){if(Tn)if(yn)_.texStorage2D(X.TEXTURE_2D,wt,ln,en.width,en.height);else{let Mt=en.width,on=en.height;for(let dn=0;dn<wt;dn++)_.texImage2D(X.TEXTURE_2D,dn,ln,Mt,on,0,In,un,null),Mt>>=1,on>>=1}}else if(Sn.length>0){if(yn&&Tn){const Mt=Tt(Sn[0]);_.texStorage2D(X.TEXTURE_2D,wt,ln,Mt.width,Mt.height)}for(let Mt=0,on=Sn.length;Mt<on;Mt++)tn=Sn[Mt],yn?vt&&_.texSubImage2D(X.TEXTURE_2D,Mt,0,0,In,un,tn):_.texImage2D(X.TEXTURE_2D,Mt,ln,In,un,tn);Oe.generateMipmaps=!1}else if(yn){if(Tn){const Mt=Tt(en);_.texStorage2D(X.TEXTURE_2D,wt,ln,Mt.width,Mt.height)}vt&&_.texSubImage2D(X.TEXTURE_2D,0,0,0,In,un,en)}else _.texImage2D(X.TEXTURE_2D,0,ln,In,un,en);Ae(Oe)&&ye(ft),zt.__version=Wt.version,Oe.onUpdate&&Oe.onUpdate(Oe)}Je.__version=Oe.version}function gt(Je,Oe,lt){if(Oe.image.length!==6)return;const ft=ut(Je,Oe),St=Oe.source;_.bindTexture(X.TEXTURE_CUBE_MAP,Je.__webglTexture,X.TEXTURE0+lt);const Wt=K.get(St);if(St.version!==Wt.__version||ft===!0){_.activeTexture(X.TEXTURE0+lt);const zt=ColorManagement.getPrimaries(ColorManagement.workingColorSpace),$t=Oe.colorSpace===NoColorSpace?null:ColorManagement.getPrimaries(Oe.colorSpace),rn=Oe.colorSpace===NoColorSpace||zt===$t?X.NONE:X.BROWSER_DEFAULT_WEBGL;X.pixelStorei(X.UNPACK_FLIP_Y_WEBGL,Oe.flipY),X.pixelStorei(X.UNPACK_PREMULTIPLY_ALPHA_WEBGL,Oe.premultiplyAlpha),X.pixelStorei(X.UNPACK_ALIGNMENT,Oe.unpackAlignment),X.pixelStorei(X.UNPACK_COLORSPACE_CONVERSION_WEBGL,rn);const Gn=Oe.isCompressedTexture||Oe.image[0].isCompressedTexture,en=Oe.image[0]&&Oe.image[0].isDataTexture,In=[];for(let on=0;on<6;on++)!Gn&&!en?In[on]=be(Oe.image[on],!0,te.maxCubemapSize):In[on]=en?Oe.image[on].image:Oe.image[on],In[on]=Ot(Oe,In[on]);const un=In[0],ln=ne.convert(Oe.format,Oe.colorSpace),tn=ne.convert(Oe.type),Sn=Be(Oe.internalFormat,ln,tn,Oe.colorSpace),yn=Oe.isVideoTexture!==!0,Tn=Wt.__version===void 0||ft===!0,vt=St.dataReady;let wt=Ve(Oe,un);$e(X.TEXTURE_CUBE_MAP,Oe);let Mt;if(Gn){yn&&Tn&&_.texStorage2D(X.TEXTURE_CUBE_MAP,wt,Sn,un.width,un.height);for(let on=0;on<6;on++){Mt=In[on].mipmaps;for(let dn=0;dn<Mt.length;dn++){const an=Mt[dn];Oe.format!==RGBAFormat?ln!==null?yn?vt&&_.compressedTexSubImage2D(X.TEXTURE_CUBE_MAP_POSITIVE_X+on,dn,0,0,an.width,an.height,ln,an.data):_.compressedTexImage2D(X.TEXTURE_CUBE_MAP_POSITIVE_X+on,dn,Sn,an.width,an.height,0,an.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):yn?vt&&_.texSubImage2D(X.TEXTURE_CUBE_MAP_POSITIVE_X+on,dn,0,0,an.width,an.height,ln,tn,an.data):_.texImage2D(X.TEXTURE_CUBE_MAP_POSITIVE_X+on,dn,Sn,an.width,an.height,0,ln,tn,an.data)}}}else{if(Mt=Oe.mipmaps,yn&&Tn){Mt.length>0&&wt++;const on=Tt(In[0]);_.texStorage2D(X.TEXTURE_CUBE_MAP,wt,Sn,on.width,on.height)}for(let on=0;on<6;on++)if(en){yn?vt&&_.texSubImage2D(X.TEXTURE_CUBE_MAP_POSITIVE_X+on,0,0,0,In[on].width,In[on].height,ln,tn,In[on].data):_.texImage2D(X.TEXTURE_CUBE_MAP_POSITIVE_X+on,0,Sn,In[on].width,In[on].height,0,ln,tn,In[on].data);for(let dn=0;dn<Mt.length;dn++){const Mn=Mt[dn].image[on].image;yn?vt&&_.texSubImage2D(X.TEXTURE_CUBE_MAP_POSITIVE_X+on,dn+1,0,0,Mn.width,Mn.height,ln,tn,Mn.data):_.texImage2D(X.TEXTURE_CUBE_MAP_POSITIVE_X+on,dn+1,Sn,Mn.width,Mn.height,0,ln,tn,Mn.data)}}else{yn?vt&&_.texSubImage2D(X.TEXTURE_CUBE_MAP_POSITIVE_X+on,0,0,0,ln,tn,In[on]):_.texImage2D(X.TEXTURE_CUBE_MAP_POSITIVE_X+on,0,Sn,ln,tn,In[on]);for(let dn=0;dn<Mt.length;dn++){const an=Mt[dn];yn?vt&&_.texSubImage2D(X.TEXTURE_CUBE_MAP_POSITIVE_X+on,dn+1,0,0,ln,tn,an.image[on]):_.texImage2D(X.TEXTURE_CUBE_MAP_POSITIVE_X+on,dn+1,Sn,ln,tn,an.image[on])}}}Ae(Oe)&&ye(X.TEXTURE_CUBE_MAP),Wt.__version=St.version,Oe.onUpdate&&Oe.onUpdate(Oe)}Je.__version=Oe.version}function ht(Je,Oe,lt,ft,St,Wt){const zt=ne.convert(lt.format,lt.colorSpace),$t=ne.convert(lt.type),rn=Be(lt.internalFormat,zt,$t,lt.colorSpace),Gn=K.get(Oe),en=K.get(lt);if(en.__renderTarget=Oe,!Gn.__hasExternalTextures){const In=Math.max(1,Oe.width>>Wt),un=Math.max(1,Oe.height>>Wt);St===X.TEXTURE_3D||St===X.TEXTURE_2D_ARRAY?_.texImage3D(St,Wt,rn,In,un,Oe.depth,0,zt,$t,null):_.texImage2D(St,Wt,rn,In,un,0,zt,$t,null)}_.bindFramebuffer(X.FRAMEBUFFER,Je),Ut(Oe)?oe.framebufferTexture2DMultisampleEXT(X.FRAMEBUFFER,ft,St,en.__webglTexture,0,Et(Oe)):(St===X.TEXTURE_2D||St>=X.TEXTURE_CUBE_MAP_POSITIVE_X&&St<=X.TEXTURE_CUBE_MAP_NEGATIVE_Z)&&X.framebufferTexture2D(X.FRAMEBUFFER,ft,St,en.__webglTexture,Wt),_.bindFramebuffer(X.FRAMEBUFFER,null)}function dt(Je,Oe,lt){if(X.bindRenderbuffer(X.RENDERBUFFER,Je),Oe.depthBuffer){const ft=Oe.depthTexture,St=ft&&ft.isDepthTexture?ft.type:null,Wt=Re(Oe.stencilBuffer,St),zt=Oe.stencilBuffer?X.DEPTH_STENCIL_ATTACHMENT:X.DEPTH_ATTACHMENT,$t=Et(Oe);Ut(Oe)?oe.renderbufferStorageMultisampleEXT(X.RENDERBUFFER,$t,Wt,Oe.width,Oe.height):lt?X.renderbufferStorageMultisample(X.RENDERBUFFER,$t,Wt,Oe.width,Oe.height):X.renderbufferStorage(X.RENDERBUFFER,Wt,Oe.width,Oe.height),X.framebufferRenderbuffer(X.FRAMEBUFFER,zt,X.RENDERBUFFER,Je)}else{const ft=Oe.textures;for(let St=0;St<ft.length;St++){const Wt=ft[St],zt=ne.convert(Wt.format,Wt.colorSpace),$t=ne.convert(Wt.type),rn=Be(Wt.internalFormat,zt,$t,Wt.colorSpace),Gn=Et(Oe);lt&&Ut(Oe)===!1?X.renderbufferStorageMultisample(X.RENDERBUFFER,Gn,rn,Oe.width,Oe.height):Ut(Oe)?oe.renderbufferStorageMultisampleEXT(X.RENDERBUFFER,Gn,rn,Oe.width,Oe.height):X.renderbufferStorage(X.RENDERBUFFER,rn,Oe.width,Oe.height)}}X.bindRenderbuffer(X.RENDERBUFFER,null)}function bt(Je,Oe){if(Oe&&Oe.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(_.bindFramebuffer(X.FRAMEBUFFER,Je),!(Oe.depthTexture&&Oe.depthTexture.isDepthTexture))throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");const ft=K.get(Oe.depthTexture);ft.__renderTarget=Oe,(!ft.__webglTexture||Oe.depthTexture.image.width!==Oe.width||Oe.depthTexture.image.height!==Oe.height)&&(Oe.depthTexture.image.width=Oe.width,Oe.depthTexture.image.height=Oe.height,Oe.depthTexture.needsUpdate=!0),rt(Oe.depthTexture,0);const St=ft.__webglTexture,Wt=Et(Oe);if(Oe.depthTexture.format===DepthFormat)Ut(Oe)?oe.framebufferTexture2DMultisampleEXT(X.FRAMEBUFFER,X.DEPTH_ATTACHMENT,X.TEXTURE_2D,St,0,Wt):X.framebufferTexture2D(X.FRAMEBUFFER,X.DEPTH_ATTACHMENT,X.TEXTURE_2D,St,0);else if(Oe.depthTexture.format===DepthStencilFormat)Ut(Oe)?oe.framebufferTexture2DMultisampleEXT(X.FRAMEBUFFER,X.DEPTH_STENCIL_ATTACHMENT,X.TEXTURE_2D,St,0,Wt):X.framebufferTexture2D(X.FRAMEBUFFER,X.DEPTH_STENCIL_ATTACHMENT,X.TEXTURE_2D,St,0);else throw new Error("Unknown depthTexture format")}function Ht(Je){const Oe=K.get(Je),lt=Je.isWebGLCubeRenderTarget===!0;if(Oe.__boundDepthTexture!==Je.depthTexture){const ft=Je.depthTexture;if(Oe.__depthDisposeCallback&&Oe.__depthDisposeCallback(),ft){const St=()=>{delete Oe.__boundDepthTexture,delete Oe.__depthDisposeCallback,ft.removeEventListener("dispose",St)};ft.addEventListener("dispose",St),Oe.__depthDisposeCallback=St}Oe.__boundDepthTexture=ft}if(Je.depthTexture&&!Oe.__autoAllocateDepthBuffer){if(lt)throw new Error("target.depthTexture not supported in Cube render targets");bt(Oe.__webglFramebuffer,Je)}else if(lt){Oe.__webglDepthbuffer=[];for(let ft=0;ft<6;ft++)if(_.bindFramebuffer(X.FRAMEBUFFER,Oe.__webglFramebuffer[ft]),Oe.__webglDepthbuffer[ft]===void 0)Oe.__webglDepthbuffer[ft]=X.createRenderbuffer(),dt(Oe.__webglDepthbuffer[ft],Je,!1);else{const St=Je.stencilBuffer?X.DEPTH_STENCIL_ATTACHMENT:X.DEPTH_ATTACHMENT,Wt=Oe.__webglDepthbuffer[ft];X.bindRenderbuffer(X.RENDERBUFFER,Wt),X.framebufferRenderbuffer(X.FRAMEBUFFER,St,X.RENDERBUFFER,Wt)}}else if(_.bindFramebuffer(X.FRAMEBUFFER,Oe.__webglFramebuffer),Oe.__webglDepthbuffer===void 0)Oe.__webglDepthbuffer=X.createRenderbuffer(),dt(Oe.__webglDepthbuffer,Je,!1);else{const ft=Je.stencilBuffer?X.DEPTH_STENCIL_ATTACHMENT:X.DEPTH_ATTACHMENT,St=Oe.__webglDepthbuffer;X.bindRenderbuffer(X.RENDERBUFFER,St),X.framebufferRenderbuffer(X.FRAMEBUFFER,ft,X.RENDERBUFFER,St)}_.bindFramebuffer(X.FRAMEBUFFER,null)}function Dt(Je,Oe,lt){const ft=K.get(Je);Oe!==void 0&&ht(ft.__webglFramebuffer,Je,Je.texture,X.COLOR_ATTACHMENT0,X.TEXTURE_2D,0),lt!==void 0&&Ht(Je)}function Vt(Je){const Oe=Je.texture,lt=K.get(Je),ft=K.get(Oe);Je.addEventListener("dispose",Ze);const St=Je.textures,Wt=Je.isWebGLCubeRenderTarget===!0,zt=St.length>1;if(zt||(ft.__webglTexture===void 0&&(ft.__webglTexture=X.createTexture()),ft.__version=Oe.version,ie.memory.textures++),Wt){lt.__webglFramebuffer=[];for(let $t=0;$t<6;$t++)if(Oe.mipmaps&&Oe.mipmaps.length>0){lt.__webglFramebuffer[$t]=[];for(let rn=0;rn<Oe.mipmaps.length;rn++)lt.__webglFramebuffer[$t][rn]=X.createFramebuffer()}else lt.__webglFramebuffer[$t]=X.createFramebuffer()}else{if(Oe.mipmaps&&Oe.mipmaps.length>0){lt.__webglFramebuffer=[];for(let $t=0;$t<Oe.mipmaps.length;$t++)lt.__webglFramebuffer[$t]=X.createFramebuffer()}else lt.__webglFramebuffer=X.createFramebuffer();if(zt)for(let $t=0,rn=St.length;$t<rn;$t++){const Gn=K.get(St[$t]);Gn.__webglTexture===void 0&&(Gn.__webglTexture=X.createTexture(),ie.memory.textures++)}if(Je.samples>0&&Ut(Je)===!1){lt.__webglMultisampledFramebuffer=X.createFramebuffer(),lt.__webglColorRenderbuffer=[],_.bindFramebuffer(X.FRAMEBUFFER,lt.__webglMultisampledFramebuffer);for(let $t=0;$t<St.length;$t++){const rn=St[$t];lt.__webglColorRenderbuffer[$t]=X.createRenderbuffer(),X.bindRenderbuffer(X.RENDERBUFFER,lt.__webglColorRenderbuffer[$t]);const Gn=ne.convert(rn.format,rn.colorSpace),en=ne.convert(rn.type),In=Be(rn.internalFormat,Gn,en,rn.colorSpace,Je.isXRRenderTarget===!0),un=Et(Je);X.renderbufferStorageMultisample(X.RENDERBUFFER,un,In,Je.width,Je.height),X.framebufferRenderbuffer(X.FRAMEBUFFER,X.COLOR_ATTACHMENT0+$t,X.RENDERBUFFER,lt.__webglColorRenderbuffer[$t])}X.bindRenderbuffer(X.RENDERBUFFER,null),Je.depthBuffer&&(lt.__webglDepthRenderbuffer=X.createRenderbuffer(),dt(lt.__webglDepthRenderbuffer,Je,!0)),_.bindFramebuffer(X.FRAMEBUFFER,null)}}if(Wt){_.bindTexture(X.TEXTURE_CUBE_MAP,ft.__webglTexture),$e(X.TEXTURE_CUBE_MAP,Oe);for(let $t=0;$t<6;$t++)if(Oe.mipmaps&&Oe.mipmaps.length>0)for(let rn=0;rn<Oe.mipmaps.length;rn++)ht(lt.__webglFramebuffer[$t][rn],Je,Oe,X.COLOR_ATTACHMENT0,X.TEXTURE_CUBE_MAP_POSITIVE_X+$t,rn);else ht(lt.__webglFramebuffer[$t],Je,Oe,X.COLOR_ATTACHMENT0,X.TEXTURE_CUBE_MAP_POSITIVE_X+$t,0);Ae(Oe)&&ye(X.TEXTURE_CUBE_MAP),_.unbindTexture()}else if(zt){for(let $t=0,rn=St.length;$t<rn;$t++){const Gn=St[$t],en=K.get(Gn);_.bindTexture(X.TEXTURE_2D,en.__webglTexture),$e(X.TEXTURE_2D,Gn),ht(lt.__webglFramebuffer,Je,Gn,X.COLOR_ATTACHMENT0+$t,X.TEXTURE_2D,0),Ae(Gn)&&ye(X.TEXTURE_2D)}_.unbindTexture()}else{let $t=X.TEXTURE_2D;if((Je.isWebGL3DRenderTarget||Je.isWebGLArrayRenderTarget)&&($t=Je.isWebGL3DRenderTarget?X.TEXTURE_3D:X.TEXTURE_2D_ARRAY),_.bindTexture($t,ft.__webglTexture),$e($t,Oe),Oe.mipmaps&&Oe.mipmaps.length>0)for(let rn=0;rn<Oe.mipmaps.length;rn++)ht(lt.__webglFramebuffer[rn],Je,Oe,X.COLOR_ATTACHMENT0,$t,rn);else ht(lt.__webglFramebuffer,Je,Oe,X.COLOR_ATTACHMENT0,$t,0);Ae(Oe)&&ye($t),_.unbindTexture()}Je.depthBuffer&&Ht(Je)}function mt(Je){const Oe=Je.textures;for(let lt=0,ft=Oe.length;lt<ft;lt++){const St=Oe[lt];if(Ae(St)){const Wt=ve(Je),zt=K.get(St).__webglTexture;_.bindTexture(Wt,zt),ye(Wt),_.unbindTexture()}}}const Ft=[],it=[];function Lt(Je){if(Je.samples>0){if(Ut(Je)===!1){const Oe=Je.textures,lt=Je.width,ft=Je.height;let St=X.COLOR_BUFFER_BIT;const Wt=Je.stencilBuffer?X.DEPTH_STENCIL_ATTACHMENT:X.DEPTH_ATTACHMENT,zt=K.get(Je),$t=Oe.length>1;if($t)for(let rn=0;rn<Oe.length;rn++)_.bindFramebuffer(X.FRAMEBUFFER,zt.__webglMultisampledFramebuffer),X.framebufferRenderbuffer(X.FRAMEBUFFER,X.COLOR_ATTACHMENT0+rn,X.RENDERBUFFER,null),_.bindFramebuffer(X.FRAMEBUFFER,zt.__webglFramebuffer),X.framebufferTexture2D(X.DRAW_FRAMEBUFFER,X.COLOR_ATTACHMENT0+rn,X.TEXTURE_2D,null,0);_.bindFramebuffer(X.READ_FRAMEBUFFER,zt.__webglMultisampledFramebuffer),_.bindFramebuffer(X.DRAW_FRAMEBUFFER,zt.__webglFramebuffer);for(let rn=0;rn<Oe.length;rn++){if(Je.resolveDepthBuffer&&(Je.depthBuffer&&(St|=X.DEPTH_BUFFER_BIT),Je.stencilBuffer&&Je.resolveStencilBuffer&&(St|=X.STENCIL_BUFFER_BIT)),$t){X.framebufferRenderbuffer(X.READ_FRAMEBUFFER,X.COLOR_ATTACHMENT0,X.RENDERBUFFER,zt.__webglColorRenderbuffer[rn]);const Gn=K.get(Oe[rn]).__webglTexture;X.framebufferTexture2D(X.DRAW_FRAMEBUFFER,X.COLOR_ATTACHMENT0,X.TEXTURE_2D,Gn,0)}X.blitFramebuffer(0,0,lt,ft,0,0,lt,ft,St,X.NEAREST),se===!0&&(Ft.length=0,it.length=0,Ft.push(X.COLOR_ATTACHMENT0+rn),Je.depthBuffer&&Je.resolveDepthBuffer===!1&&(Ft.push(Wt),it.push(Wt),X.invalidateFramebuffer(X.DRAW_FRAMEBUFFER,it)),X.invalidateFramebuffer(X.READ_FRAMEBUFFER,Ft))}if(_.bindFramebuffer(X.READ_FRAMEBUFFER,null),_.bindFramebuffer(X.DRAW_FRAMEBUFFER,null),$t)for(let rn=0;rn<Oe.length;rn++){_.bindFramebuffer(X.FRAMEBUFFER,zt.__webglMultisampledFramebuffer),X.framebufferRenderbuffer(X.FRAMEBUFFER,X.COLOR_ATTACHMENT0+rn,X.RENDERBUFFER,zt.__webglColorRenderbuffer[rn]);const Gn=K.get(Oe[rn]).__webglTexture;_.bindFramebuffer(X.FRAMEBUFFER,zt.__webglFramebuffer),X.framebufferTexture2D(X.DRAW_FRAMEBUFFER,X.COLOR_ATTACHMENT0+rn,X.TEXTURE_2D,Gn,0)}_.bindFramebuffer(X.DRAW_FRAMEBUFFER,zt.__webglMultisampledFramebuffer)}else if(Je.depthBuffer&&Je.resolveDepthBuffer===!1&&se){const Oe=Je.stencilBuffer?X.DEPTH_STENCIL_ATTACHMENT:X.DEPTH_ATTACHMENT;X.invalidateFramebuffer(X.DRAW_FRAMEBUFFER,[Oe])}}}function Et(Je){return Math.min(te.maxSamples,Je.samples)}function Ut(Je){const Oe=K.get(Je);return Je.samples>0&&Z.has("WEBGL_multisampled_render_to_texture")===!0&&Oe.__useRenderToTexture!==!1}function Zt(Je){const Oe=ie.render.frame;ge.get(Je)!==Oe&&(ge.set(Je,Oe),Je.update())}function Ot(Je,Oe){const lt=Je.colorSpace,ft=Je.format,St=Je.type;return Je.isCompressedTexture===!0||Je.isVideoTexture===!0||lt!==LinearSRGBColorSpace$1&&lt!==NoColorSpace&&(ColorManagement.getTransfer(lt)===SRGBTransfer?(ft!==RGBAFormat||St!==UnsignedByteType)&&console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture color space:",lt)),Oe}function Tt(Je){return typeof HTMLImageElement<"u"&&Je instanceof HTMLImageElement?(ae.width=Je.naturalWidth||Je.width,ae.height=Je.naturalHeight||Je.height):typeof VideoFrame<"u"&&Je instanceof VideoFrame?(ae.width=Je.displayWidth,ae.height=Je.displayHeight):(ae.width=Je.width,ae.height=Je.height),ae}this.allocateTextureUnit=Ke,this.resetTextureUnits=Le,this.setTexture2D=rt,this.setTexture2DArray=tt,this.setTexture3D=at,this.setTextureCube=ze,this.rebindTextures=Dt,this.setupRenderTarget=Vt,this.updateRenderTargetMipmap=mt,this.updateMultisampleRenderTarget=Lt,this.setupDepthRenderbuffer=Ht,this.setupFrameBufferTexture=ht,this.useMultisampledRTT=Ut}function WebGLUtils(X,Z){function _(K,te=NoColorSpace){let ne;const ie=ColorManagement.getTransfer(te);if(K===UnsignedByteType)return X.UNSIGNED_BYTE;if(K===UnsignedShort4444Type)return X.UNSIGNED_SHORT_4_4_4_4;if(K===UnsignedShort5551Type)return X.UNSIGNED_SHORT_5_5_5_1;if(K===UnsignedInt5999Type)return X.UNSIGNED_INT_5_9_9_9_REV;if(K===ByteType)return X.BYTE;if(K===ShortType)return X.SHORT;if(K===UnsignedShortType)return X.UNSIGNED_SHORT;if(K===IntType)return X.INT;if(K===UnsignedIntType)return X.UNSIGNED_INT;if(K===FloatType)return X.FLOAT;if(K===HalfFloatType)return X.HALF_FLOAT;if(K===AlphaFormat)return X.ALPHA;if(K===RGBFormat)return X.RGB;if(K===RGBAFormat)return X.RGBA;if(K===LuminanceFormat)return X.LUMINANCE;if(K===LuminanceAlphaFormat)return X.LUMINANCE_ALPHA;if(K===DepthFormat)return X.DEPTH_COMPONENT;if(K===DepthStencilFormat)return X.DEPTH_STENCIL;if(K===RedFormat)return X.RED;if(K===RedIntegerFormat)return X.RED_INTEGER;if(K===RGFormat)return X.RG;if(K===RGIntegerFormat)return X.RG_INTEGER;if(K===RGBAIntegerFormat)return X.RGBA_INTEGER;if(K===RGB_S3TC_DXT1_Format||K===RGBA_S3TC_DXT1_Format||K===RGBA_S3TC_DXT3_Format||K===RGBA_S3TC_DXT5_Format)if(ie===SRGBTransfer)if(ne=Z.get("WEBGL_compressed_texture_s3tc_srgb"),ne!==null){if(K===RGB_S3TC_DXT1_Format)return ne.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(K===RGBA_S3TC_DXT1_Format)return ne.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(K===RGBA_S3TC_DXT3_Format)return ne.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(K===RGBA_S3TC_DXT5_Format)return ne.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else return null;else if(ne=Z.get("WEBGL_compressed_texture_s3tc"),ne!==null){if(K===RGB_S3TC_DXT1_Format)return ne.COMPRESSED_RGB_S3TC_DXT1_EXT;if(K===RGBA_S3TC_DXT1_Format)return ne.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(K===RGBA_S3TC_DXT3_Format)return ne.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(K===RGBA_S3TC_DXT5_Format)return ne.COMPRESSED_RGBA_S3TC_DXT5_EXT}else return null;if(K===RGB_PVRTC_4BPPV1_Format||K===RGB_PVRTC_2BPPV1_Format||K===RGBA_PVRTC_4BPPV1_Format||K===RGBA_PVRTC_2BPPV1_Format)if(ne=Z.get("WEBGL_compressed_texture_pvrtc"),ne!==null){if(K===RGB_PVRTC_4BPPV1_Format)return ne.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(K===RGB_PVRTC_2BPPV1_Format)return ne.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(K===RGBA_PVRTC_4BPPV1_Format)return ne.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(K===RGBA_PVRTC_2BPPV1_Format)return ne.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}else return null;if(K===RGB_ETC1_Format||K===RGB_ETC2_Format||K===RGBA_ETC2_EAC_Format)if(ne=Z.get("WEBGL_compressed_texture_etc"),ne!==null){if(K===RGB_ETC1_Format||K===RGB_ETC2_Format)return ie===SRGBTransfer?ne.COMPRESSED_SRGB8_ETC2:ne.COMPRESSED_RGB8_ETC2;if(K===RGBA_ETC2_EAC_Format)return ie===SRGBTransfer?ne.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:ne.COMPRESSED_RGBA8_ETC2_EAC}else return null;if(K===RGBA_ASTC_4x4_Format||K===RGBA_ASTC_5x4_Format||K===RGBA_ASTC_5x5_Format||K===RGBA_ASTC_6x5_Format||K===RGBA_ASTC_6x6_Format||K===RGBA_ASTC_8x5_Format||K===RGBA_ASTC_8x6_Format||K===RGBA_ASTC_8x8_Format||K===RGBA_ASTC_10x5_Format||K===RGBA_ASTC_10x6_Format||K===RGBA_ASTC_10x8_Format||K===RGBA_ASTC_10x10_Format||K===RGBA_ASTC_12x10_Format||K===RGBA_ASTC_12x12_Format)if(ne=Z.get("WEBGL_compressed_texture_astc"),ne!==null){if(K===RGBA_ASTC_4x4_Format)return ie===SRGBTransfer?ne.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:ne.COMPRESSED_RGBA_ASTC_4x4_KHR;if(K===RGBA_ASTC_5x4_Format)return ie===SRGBTransfer?ne.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:ne.COMPRESSED_RGBA_ASTC_5x4_KHR;if(K===RGBA_ASTC_5x5_Format)return ie===SRGBTransfer?ne.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:ne.COMPRESSED_RGBA_ASTC_5x5_KHR;if(K===RGBA_ASTC_6x5_Format)return ie===SRGBTransfer?ne.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:ne.COMPRESSED_RGBA_ASTC_6x5_KHR;if(K===RGBA_ASTC_6x6_Format)return ie===SRGBTransfer?ne.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:ne.COMPRESSED_RGBA_ASTC_6x6_KHR;if(K===RGBA_ASTC_8x5_Format)return ie===SRGBTransfer?ne.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:ne.COMPRESSED_RGBA_ASTC_8x5_KHR;if(K===RGBA_ASTC_8x6_Format)return ie===SRGBTransfer?ne.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:ne.COMPRESSED_RGBA_ASTC_8x6_KHR;if(K===RGBA_ASTC_8x8_Format)return ie===SRGBTransfer?ne.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:ne.COMPRESSED_RGBA_ASTC_8x8_KHR;if(K===RGBA_ASTC_10x5_Format)return ie===SRGBTransfer?ne.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:ne.COMPRESSED_RGBA_ASTC_10x5_KHR;if(K===RGBA_ASTC_10x6_Format)return ie===SRGBTransfer?ne.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:ne.COMPRESSED_RGBA_ASTC_10x6_KHR;if(K===RGBA_ASTC_10x8_Format)return ie===SRGBTransfer?ne.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:ne.COMPRESSED_RGBA_ASTC_10x8_KHR;if(K===RGBA_ASTC_10x10_Format)return ie===SRGBTransfer?ne.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:ne.COMPRESSED_RGBA_ASTC_10x10_KHR;if(K===RGBA_ASTC_12x10_Format)return ie===SRGBTransfer?ne.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:ne.COMPRESSED_RGBA_ASTC_12x10_KHR;if(K===RGBA_ASTC_12x12_Format)return ie===SRGBTransfer?ne.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:ne.COMPRESSED_RGBA_ASTC_12x12_KHR}else return null;if(K===RGBA_BPTC_Format||K===RGB_BPTC_SIGNED_Format||K===RGB_BPTC_UNSIGNED_Format)if(ne=Z.get("EXT_texture_compression_bptc"),ne!==null){if(K===RGBA_BPTC_Format)return ie===SRGBTransfer?ne.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:ne.COMPRESSED_RGBA_BPTC_UNORM_EXT;if(K===RGB_BPTC_SIGNED_Format)return ne.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT;if(K===RGB_BPTC_UNSIGNED_Format)return ne.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT}else return null;if(K===RED_RGTC1_Format||K===SIGNED_RED_RGTC1_Format||K===RED_GREEN_RGTC2_Format||K===SIGNED_RED_GREEN_RGTC2_Format)if(ne=Z.get("EXT_texture_compression_rgtc"),ne!==null){if(K===RGBA_BPTC_Format)return ne.COMPRESSED_RED_RGTC1_EXT;if(K===SIGNED_RED_RGTC1_Format)return ne.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(K===RED_GREEN_RGTC2_Format)return ne.COMPRESSED_RED_GREEN_RGTC2_EXT;if(K===SIGNED_RED_GREEN_RGTC2_Format)return ne.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}else return null;return K===UnsignedInt248Type?X.UNSIGNED_INT_24_8:X[K]!==void 0?X[K]:null}return{convert:_}}const _moveEvent={type:"move"};class WebXRController{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return this._hand===null&&(this._hand=new Group,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return this._targetRay===null&&(this._targetRay=new Group,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new Vector3,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new Vector3),this._targetRay}getGripSpace(){return this._grip===null&&(this._grip=new Group,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new Vector3,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new Vector3),this._grip}dispatchEvent(Z){return this._targetRay!==null&&this._targetRay.dispatchEvent(Z),this._grip!==null&&this._grip.dispatchEvent(Z),this._hand!==null&&this._hand.dispatchEvent(Z),this}connect(Z){if(Z&&Z.hand){const _=this._hand;if(_)for(const K of Z.hand.values())this._getHandJoint(_,K)}return this.dispatchEvent({type:"connected",data:Z}),this}disconnect(Z){return this.dispatchEvent({type:"disconnected",data:Z}),this._targetRay!==null&&(this._targetRay.visible=!1),this._grip!==null&&(this._grip.visible=!1),this._hand!==null&&(this._hand.visible=!1),this}update(Z,_,K){let te=null,ne=null,ie=null;const oe=this._targetRay,se=this._grip,ae=this._hand;if(Z&&_.session.visibilityState!=="visible-blurred"){if(ae&&Z.hand){ie=!0;for(const be of Z.hand.values()){const Ae=_.getJointPose(be,K),ye=this._getHandJoint(ae,be);Ae!==null&&(ye.matrix.fromArray(Ae.transform.matrix),ye.matrix.decompose(ye.position,ye.rotation,ye.scale),ye.matrixWorldNeedsUpdate=!0,ye.jointRadius=Ae.radius),ye.visible=Ae!==null}const ge=ae.joints["index-finger-tip"],ce=ae.joints["thumb-tip"],de=ge.position.distanceTo(ce.position),Ie=.02,fe=.005;ae.inputState.pinching&&de>Ie+fe?(ae.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:Z.handedness,target:this})):!ae.inputState.pinching&&de<=Ie-fe&&(ae.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:Z.handedness,target:this}))}else se!==null&&Z.gripSpace&&(ne=_.getPose(Z.gripSpace,K),ne!==null&&(se.matrix.fromArray(ne.transform.matrix),se.matrix.decompose(se.position,se.rotation,se.scale),se.matrixWorldNeedsUpdate=!0,ne.linearVelocity?(se.hasLinearVelocity=!0,se.linearVelocity.copy(ne.linearVelocity)):se.hasLinearVelocity=!1,ne.angularVelocity?(se.hasAngularVelocity=!0,se.angularVelocity.copy(ne.angularVelocity)):se.hasAngularVelocity=!1));oe!==null&&(te=_.getPose(Z.targetRaySpace,K),te===null&&ne!==null&&(te=ne),te!==null&&(oe.matrix.fromArray(te.transform.matrix),oe.matrix.decompose(oe.position,oe.rotation,oe.scale),oe.matrixWorldNeedsUpdate=!0,te.linearVelocity?(oe.hasLinearVelocity=!0,oe.linearVelocity.copy(te.linearVelocity)):oe.hasLinearVelocity=!1,te.angularVelocity?(oe.hasAngularVelocity=!0,oe.angularVelocity.copy(te.angularVelocity)):oe.hasAngularVelocity=!1,this.dispatchEvent(_moveEvent)))}return oe!==null&&(oe.visible=te!==null),se!==null&&(se.visible=ne!==null),ae!==null&&(ae.visible=ie!==null),this}_getHandJoint(Z,_){if(Z.joints[_.jointName]===void 0){const K=new Group;K.matrixAutoUpdate=!1,K.visible=!1,Z.joints[_.jointName]=K,Z.add(K)}return Z.joints[_.jointName]}}const _occlusion_vertex=`
void main() {

	gl_Position = vec4( position, 1.0 );

}`,_occlusion_fragment=`
uniform sampler2DArray depthColor;
uniform float depthWidth;
uniform float depthHeight;

void main() {

	vec2 coord = vec2( gl_FragCoord.x / depthWidth, gl_FragCoord.y / depthHeight );

	if ( coord.x >= 1.0 ) {

		gl_FragDepth = texture( depthColor, vec3( coord.x - 1.0, coord.y, 1 ) ).r;

	} else {

		gl_FragDepth = texture( depthColor, vec3( coord.x, coord.y, 0 ) ).r;

	}

}`;class WebXRDepthSensing{constructor(){this.texture=null,this.mesh=null,this.depthNear=0,this.depthFar=0}init(Z,_,K){if(this.texture===null){const te=new Texture,ne=Z.properties.get(te);ne.__webglTexture=_.texture,(_.depthNear!==K.depthNear||_.depthFar!==K.depthFar)&&(this.depthNear=_.depthNear,this.depthFar=_.depthFar),this.texture=te}}getMesh(Z){if(this.texture!==null&&this.mesh===null){const _=Z.cameras[0].viewport,K=new ShaderMaterial({vertexShader:_occlusion_vertex,fragmentShader:_occlusion_fragment,uniforms:{depthColor:{value:this.texture},depthWidth:{value:_.z},depthHeight:{value:_.w}}});this.mesh=new Mesh(new PlaneGeometry(20,20),K)}return this.mesh}reset(){this.texture=null,this.mesh=null}getDepthTexture(){return this.texture}}class WebXRManager extends EventDispatcher{constructor(Z,_){super();const K=this;let te=null,ne=1,ie=null,oe="local-floor",se=1,ae=null,ge=null,ce=null,de=null,Ie=null,fe=null;const be=new WebXRDepthSensing,Ae=_.getContextAttributes();let ye=null,ve=null;const Be=[],Re=[],Ve=new Vector2;let Ee=null;const Ze=new PerspectiveCamera;Ze.viewport=new Vector4;const _e=new PerspectiveCamera;_e.viewport=new Vector4;const Fe=[Ze,_e],Te=new ArrayCamera;let ke=null,Le=null;this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(ot){let gt=Be[ot];return gt===void 0&&(gt=new WebXRController,Be[ot]=gt),gt.getTargetRaySpace()},this.getControllerGrip=function(ot){let gt=Be[ot];return gt===void 0&&(gt=new WebXRController,Be[ot]=gt),gt.getGripSpace()},this.getHand=function(ot){let gt=Be[ot];return gt===void 0&&(gt=new WebXRController,Be[ot]=gt),gt.getHandSpace()};function Ke(ot){const gt=Re.indexOf(ot.inputSource);if(gt===-1)return;const ht=Be[gt];ht!==void 0&&(ht.update(ot.inputSource,ot.frame,ae||ie),ht.dispatchEvent({type:ot.type,data:ot.inputSource}))}function Ue(){te.removeEventListener("select",Ke),te.removeEventListener("selectstart",Ke),te.removeEventListener("selectend",Ke),te.removeEventListener("squeeze",Ke),te.removeEventListener("squeezestart",Ke),te.removeEventListener("squeezeend",Ke),te.removeEventListener("end",Ue),te.removeEventListener("inputsourceschange",rt);for(let ot=0;ot<Be.length;ot++){const gt=Re[ot];gt!==null&&(Re[ot]=null,Be[ot].disconnect(gt))}ke=null,Le=null,be.reset(),Z.setRenderTarget(ye),Ie=null,de=null,ce=null,te=null,ve=null,ut.stop(),K.isPresenting=!1,Z.setPixelRatio(Ee),Z.setSize(Ve.width,Ve.height,!1),K.dispatchEvent({type:"sessionend"})}this.setFramebufferScaleFactor=function(ot){ne=ot,K.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(ot){oe=ot,K.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return ae||ie},this.setReferenceSpace=function(ot){ae=ot},this.getBaseLayer=function(){return de!==null?de:Ie},this.getBinding=function(){return ce},this.getFrame=function(){return fe},this.getSession=function(){return te},this.setSession=async function(ot){if(te=ot,te!==null){if(ye=Z.getRenderTarget(),te.addEventListener("select",Ke),te.addEventListener("selectstart",Ke),te.addEventListener("selectend",Ke),te.addEventListener("squeeze",Ke),te.addEventListener("squeezestart",Ke),te.addEventListener("squeezeend",Ke),te.addEventListener("end",Ue),te.addEventListener("inputsourceschange",rt),Ae.xrCompatible!==!0&&await _.makeXRCompatible(),Ee=Z.getPixelRatio(),Z.getSize(Ve),te.enabledFeatures!==void 0&&te.enabledFeatures.includes("layers")){let ht=null,dt=null,bt=null;Ae.depth&&(bt=Ae.stencil?_.DEPTH24_STENCIL8:_.DEPTH_COMPONENT24,ht=Ae.stencil?DepthStencilFormat:DepthFormat,dt=Ae.stencil?UnsignedInt248Type:UnsignedIntType);const Ht={colorFormat:_.RGBA8,depthFormat:bt,scaleFactor:ne};ce=new XRWebGLBinding(te,_),de=ce.createProjectionLayer(Ht),te.updateRenderState({layers:[de]}),Z.setPixelRatio(1),Z.setSize(de.textureWidth,de.textureHeight,!1),ve=new WebGLRenderTarget(de.textureWidth,de.textureHeight,{format:RGBAFormat,type:UnsignedByteType,depthTexture:new DepthTexture(de.textureWidth,de.textureHeight,dt,void 0,void 0,void 0,void 0,void 0,void 0,ht),stencilBuffer:Ae.stencil,colorSpace:Z.outputColorSpace,samples:Ae.antialias?4:0,resolveDepthBuffer:de.ignoreDepthValues===!1})}else{const ht={antialias:Ae.antialias,alpha:!0,depth:Ae.depth,stencil:Ae.stencil,framebufferScaleFactor:ne};Ie=new XRWebGLLayer(te,_,ht),te.updateRenderState({baseLayer:Ie}),Z.setPixelRatio(1),Z.setSize(Ie.framebufferWidth,Ie.framebufferHeight,!1),ve=new WebGLRenderTarget(Ie.framebufferWidth,Ie.framebufferHeight,{format:RGBAFormat,type:UnsignedByteType,colorSpace:Z.outputColorSpace,stencilBuffer:Ae.stencil})}ve.isXRRenderTarget=!0,this.setFoveation(se),ae=null,ie=await te.requestReferenceSpace(oe),ut.setContext(te),ut.start(),K.isPresenting=!0,K.dispatchEvent({type:"sessionstart"})}},this.getEnvironmentBlendMode=function(){if(te!==null)return te.environmentBlendMode},this.getDepthTexture=function(){return be.getDepthTexture()};function rt(ot){for(let gt=0;gt<ot.removed.length;gt++){const ht=ot.removed[gt],dt=Re.indexOf(ht);dt>=0&&(Re[dt]=null,Be[dt].disconnect(ht))}for(let gt=0;gt<ot.added.length;gt++){const ht=ot.added[gt];let dt=Re.indexOf(ht);if(dt===-1){for(let Ht=0;Ht<Be.length;Ht++)if(Ht>=Re.length){Re.push(ht),dt=Ht;break}else if(Re[Ht]===null){Re[Ht]=ht,dt=Ht;break}if(dt===-1)break}const bt=Be[dt];bt&&bt.connect(ht)}}const tt=new Vector3,at=new Vector3;function ze(ot,gt,ht){tt.setFromMatrixPosition(gt.matrixWorld),at.setFromMatrixPosition(ht.matrixWorld);const dt=tt.distanceTo(at),bt=gt.projectionMatrix.elements,Ht=ht.projectionMatrix.elements,Dt=bt[14]/(bt[10]-1),Vt=bt[14]/(bt[10]+1),mt=(bt[9]+1)/bt[5],Ft=(bt[9]-1)/bt[5],it=(bt[8]-1)/bt[0],Lt=(Ht[8]+1)/Ht[0],Et=Dt*it,Ut=Dt*Lt,Zt=dt/(-it+Lt),Ot=Zt*-it;if(gt.matrixWorld.decompose(ot.position,ot.quaternion,ot.scale),ot.translateX(Ot),ot.translateZ(Zt),ot.matrixWorld.compose(ot.position,ot.quaternion,ot.scale),ot.matrixWorldInverse.copy(ot.matrixWorld).invert(),bt[10]===-1)ot.projectionMatrix.copy(gt.projectionMatrix),ot.projectionMatrixInverse.copy(gt.projectionMatrixInverse);else{const Tt=Dt+Zt,Je=Vt+Zt,Oe=Et-Ot,lt=Ut+(dt-Ot),ft=mt*Vt/Je*Tt,St=Ft*Vt/Je*Tt;ot.projectionMatrix.makePerspective(Oe,lt,ft,St,Tt,Je),ot.projectionMatrixInverse.copy(ot.projectionMatrix).invert()}}function qe(ot,gt){gt===null?ot.matrixWorld.copy(ot.matrix):ot.matrixWorld.multiplyMatrices(gt.matrixWorld,ot.matrix),ot.matrixWorldInverse.copy(ot.matrixWorld).invert()}this.updateCamera=function(ot){if(te===null)return;let gt=ot.near,ht=ot.far;be.texture!==null&&(be.depthNear>0&&(gt=be.depthNear),be.depthFar>0&&(ht=be.depthFar)),Te.near=_e.near=Ze.near=gt,Te.far=_e.far=Ze.far=ht,(ke!==Te.near||Le!==Te.far)&&(te.updateRenderState({depthNear:Te.near,depthFar:Te.far}),ke=Te.near,Le=Te.far),Ze.layers.mask=ot.layers.mask|2,_e.layers.mask=ot.layers.mask|4,Te.layers.mask=Ze.layers.mask|_e.layers.mask;const dt=ot.parent,bt=Te.cameras;qe(Te,dt);for(let Ht=0;Ht<bt.length;Ht++)qe(bt[Ht],dt);bt.length===2?ze(Te,Ze,_e):Te.projectionMatrix.copy(Ze.projectionMatrix),Pe(ot,Te,dt)};function Pe(ot,gt,ht){ht===null?ot.matrix.copy(gt.matrixWorld):(ot.matrix.copy(ht.matrixWorld),ot.matrix.invert(),ot.matrix.multiply(gt.matrixWorld)),ot.matrix.decompose(ot.position,ot.quaternion,ot.scale),ot.updateMatrixWorld(!0),ot.projectionMatrix.copy(gt.projectionMatrix),ot.projectionMatrixInverse.copy(gt.projectionMatrixInverse),ot.isPerspectiveCamera&&(ot.fov=RAD2DEG*2*Math.atan(1/ot.projectionMatrix.elements[5]),ot.zoom=1)}this.getCamera=function(){return Te},this.getFoveation=function(){if(!(de===null&&Ie===null))return se},this.setFoveation=function(ot){se=ot,de!==null&&(de.fixedFoveation=ot),Ie!==null&&Ie.fixedFoveation!==void 0&&(Ie.fixedFoveation=ot)},this.hasDepthSensing=function(){return be.texture!==null},this.getDepthSensingMesh=function(){return be.getMesh(Te)};let Ye=null;function $e(ot,gt){if(ge=gt.getViewerPose(ae||ie),fe=gt,ge!==null){const ht=ge.views;Ie!==null&&(Z.setRenderTargetFramebuffer(ve,Ie.framebuffer),Z.setRenderTarget(ve));let dt=!1;ht.length!==Te.cameras.length&&(Te.cameras.length=0,dt=!0);for(let Ht=0;Ht<ht.length;Ht++){const Dt=ht[Ht];let Vt=null;if(Ie!==null)Vt=Ie.getViewport(Dt);else{const Ft=ce.getViewSubImage(de,Dt);Vt=Ft.viewport,Ht===0&&(Z.setRenderTargetTextures(ve,Ft.colorTexture,de.ignoreDepthValues?void 0:Ft.depthStencilTexture),Z.setRenderTarget(ve))}let mt=Fe[Ht];mt===void 0&&(mt=new PerspectiveCamera,mt.layers.enable(Ht),mt.viewport=new Vector4,Fe[Ht]=mt),mt.matrix.fromArray(Dt.transform.matrix),mt.matrix.decompose(mt.position,mt.quaternion,mt.scale),mt.projectionMatrix.fromArray(Dt.projectionMatrix),mt.projectionMatrixInverse.copy(mt.projectionMatrix).invert(),mt.viewport.set(Vt.x,Vt.y,Vt.width,Vt.height),Ht===0&&(Te.matrix.copy(mt.matrix),Te.matrix.decompose(Te.position,Te.quaternion,Te.scale)),dt===!0&&Te.cameras.push(mt)}const bt=te.enabledFeatures;if(bt&&bt.includes("depth-sensing")){const Ht=ce.getDepthInformation(ht[0]);Ht&&Ht.isValid&&Ht.texture&&be.init(Z,Ht,te.renderState)}}for(let ht=0;ht<Be.length;ht++){const dt=Re[ht],bt=Be[ht];dt!==null&&bt!==void 0&&bt.update(dt,gt,ae||ie)}Ye&&Ye(ot,gt),gt.detectedPlanes&&K.dispatchEvent({type:"planesdetected",data:gt}),fe=null}const ut=new WebGLAnimation;ut.setAnimationLoop($e),this.setAnimationLoop=function(ot){Ye=ot},this.dispose=function(){}}}const _e1=new Euler,_m1=new Matrix4;function WebGLMaterials(X,Z){function _(Ae,ye){Ae.matrixAutoUpdate===!0&&Ae.updateMatrix(),ye.value.copy(Ae.matrix)}function K(Ae,ye){ye.color.getRGB(Ae.fogColor.value,getUnlitUniformColorSpace(X)),ye.isFog?(Ae.fogNear.value=ye.near,Ae.fogFar.value=ye.far):ye.isFogExp2&&(Ae.fogDensity.value=ye.density)}function te(Ae,ye,ve,Be,Re){ye.isMeshBasicMaterial||ye.isMeshLambertMaterial?ne(Ae,ye):ye.isMeshToonMaterial?(ne(Ae,ye),ce(Ae,ye)):ye.isMeshPhongMaterial?(ne(Ae,ye),ge(Ae,ye)):ye.isMeshStandardMaterial?(ne(Ae,ye),de(Ae,ye),ye.isMeshPhysicalMaterial&&Ie(Ae,ye,Re)):ye.isMeshMatcapMaterial?(ne(Ae,ye),fe(Ae,ye)):ye.isMeshDepthMaterial?ne(Ae,ye):ye.isMeshDistanceMaterial?(ne(Ae,ye),be(Ae,ye)):ye.isMeshNormalMaterial?ne(Ae,ye):ye.isLineBasicMaterial?(ie(Ae,ye),ye.isLineDashedMaterial&&oe(Ae,ye)):ye.isPointsMaterial?se(Ae,ye,ve,Be):ye.isSpriteMaterial?ae(Ae,ye):ye.isShadowMaterial?(Ae.color.value.copy(ye.color),Ae.opacity.value=ye.opacity):ye.isShaderMaterial&&(ye.uniformsNeedUpdate=!1)}function ne(Ae,ye){Ae.opacity.value=ye.opacity,ye.color&&Ae.diffuse.value.copy(ye.color),ye.emissive&&Ae.emissive.value.copy(ye.emissive).multiplyScalar(ye.emissiveIntensity),ye.map&&(Ae.map.value=ye.map,_(ye.map,Ae.mapTransform)),ye.alphaMap&&(Ae.alphaMap.value=ye.alphaMap,_(ye.alphaMap,Ae.alphaMapTransform)),ye.bumpMap&&(Ae.bumpMap.value=ye.bumpMap,_(ye.bumpMap,Ae.bumpMapTransform),Ae.bumpScale.value=ye.bumpScale,ye.side===BackSide&&(Ae.bumpScale.value*=-1)),ye.normalMap&&(Ae.normalMap.value=ye.normalMap,_(ye.normalMap,Ae.normalMapTransform),Ae.normalScale.value.copy(ye.normalScale),ye.side===BackSide&&Ae.normalScale.value.negate()),ye.displacementMap&&(Ae.displacementMap.value=ye.displacementMap,_(ye.displacementMap,Ae.displacementMapTransform),Ae.displacementScale.value=ye.displacementScale,Ae.displacementBias.value=ye.displacementBias),ye.emissiveMap&&(Ae.emissiveMap.value=ye.emissiveMap,_(ye.emissiveMap,Ae.emissiveMapTransform)),ye.specularMap&&(Ae.specularMap.value=ye.specularMap,_(ye.specularMap,Ae.specularMapTransform)),ye.alphaTest>0&&(Ae.alphaTest.value=ye.alphaTest);const ve=Z.get(ye),Be=ve.envMap,Re=ve.envMapRotation;Be&&(Ae.envMap.value=Be,_e1.copy(Re),_e1.x*=-1,_e1.y*=-1,_e1.z*=-1,Be.isCubeTexture&&Be.isRenderTargetTexture===!1&&(_e1.y*=-1,_e1.z*=-1),Ae.envMapRotation.value.setFromMatrix4(_m1.makeRotationFromEuler(_e1)),Ae.flipEnvMap.value=Be.isCubeTexture&&Be.isRenderTargetTexture===!1?-1:1,Ae.reflectivity.value=ye.reflectivity,Ae.ior.value=ye.ior,Ae.refractionRatio.value=ye.refractionRatio),ye.lightMap&&(Ae.lightMap.value=ye.lightMap,Ae.lightMapIntensity.value=ye.lightMapIntensity,_(ye.lightMap,Ae.lightMapTransform)),ye.aoMap&&(Ae.aoMap.value=ye.aoMap,Ae.aoMapIntensity.value=ye.aoMapIntensity,_(ye.aoMap,Ae.aoMapTransform))}function ie(Ae,ye){Ae.diffuse.value.copy(ye.color),Ae.opacity.value=ye.opacity,ye.map&&(Ae.map.value=ye.map,_(ye.map,Ae.mapTransform))}function oe(Ae,ye){Ae.dashSize.value=ye.dashSize,Ae.totalSize.value=ye.dashSize+ye.gapSize,Ae.scale.value=ye.scale}function se(Ae,ye,ve,Be){Ae.diffuse.value.copy(ye.color),Ae.opacity.value=ye.opacity,Ae.size.value=ye.size*ve,Ae.scale.value=Be*.5,ye.map&&(Ae.map.value=ye.map,_(ye.map,Ae.uvTransform)),ye.alphaMap&&(Ae.alphaMap.value=ye.alphaMap,_(ye.alphaMap,Ae.alphaMapTransform)),ye.alphaTest>0&&(Ae.alphaTest.value=ye.alphaTest)}function ae(Ae,ye){Ae.diffuse.value.copy(ye.color),Ae.opacity.value=ye.opacity,Ae.rotation.value=ye.rotation,ye.map&&(Ae.map.value=ye.map,_(ye.map,Ae.mapTransform)),ye.alphaMap&&(Ae.alphaMap.value=ye.alphaMap,_(ye.alphaMap,Ae.alphaMapTransform)),ye.alphaTest>0&&(Ae.alphaTest.value=ye.alphaTest)}function ge(Ae,ye){Ae.specular.value.copy(ye.specular),Ae.shininess.value=Math.max(ye.shininess,1e-4)}function ce(Ae,ye){ye.gradientMap&&(Ae.gradientMap.value=ye.gradientMap)}function de(Ae,ye){Ae.metalness.value=ye.metalness,ye.metalnessMap&&(Ae.metalnessMap.value=ye.metalnessMap,_(ye.metalnessMap,Ae.metalnessMapTransform)),Ae.roughness.value=ye.roughness,ye.roughnessMap&&(Ae.roughnessMap.value=ye.roughnessMap,_(ye.roughnessMap,Ae.roughnessMapTransform)),ye.envMap&&(Ae.envMapIntensity.value=ye.envMapIntensity)}function Ie(Ae,ye,ve){Ae.ior.value=ye.ior,ye.sheen>0&&(Ae.sheenColor.value.copy(ye.sheenColor).multiplyScalar(ye.sheen),Ae.sheenRoughness.value=ye.sheenRoughness,ye.sheenColorMap&&(Ae.sheenColorMap.value=ye.sheenColorMap,_(ye.sheenColorMap,Ae.sheenColorMapTransform)),ye.sheenRoughnessMap&&(Ae.sheenRoughnessMap.value=ye.sheenRoughnessMap,_(ye.sheenRoughnessMap,Ae.sheenRoughnessMapTransform))),ye.clearcoat>0&&(Ae.clearcoat.value=ye.clearcoat,Ae.clearcoatRoughness.value=ye.clearcoatRoughness,ye.clearcoatMap&&(Ae.clearcoatMap.value=ye.clearcoatMap,_(ye.clearcoatMap,Ae.clearcoatMapTransform)),ye.clearcoatRoughnessMap&&(Ae.clearcoatRoughnessMap.value=ye.clearcoatRoughnessMap,_(ye.clearcoatRoughnessMap,Ae.clearcoatRoughnessMapTransform)),ye.clearcoatNormalMap&&(Ae.clearcoatNormalMap.value=ye.clearcoatNormalMap,_(ye.clearcoatNormalMap,Ae.clearcoatNormalMapTransform),Ae.clearcoatNormalScale.value.copy(ye.clearcoatNormalScale),ye.side===BackSide&&Ae.clearcoatNormalScale.value.negate())),ye.dispersion>0&&(Ae.dispersion.value=ye.dispersion),ye.iridescence>0&&(Ae.iridescence.value=ye.iridescence,Ae.iridescenceIOR.value=ye.iridescenceIOR,Ae.iridescenceThicknessMinimum.value=ye.iridescenceThicknessRange[0],Ae.iridescenceThicknessMaximum.value=ye.iridescenceThicknessRange[1],ye.iridescenceMap&&(Ae.iridescenceMap.value=ye.iridescenceMap,_(ye.iridescenceMap,Ae.iridescenceMapTransform)),ye.iridescenceThicknessMap&&(Ae.iridescenceThicknessMap.value=ye.iridescenceThicknessMap,_(ye.iridescenceThicknessMap,Ae.iridescenceThicknessMapTransform))),ye.transmission>0&&(Ae.transmission.value=ye.transmission,Ae.transmissionSamplerMap.value=ve.texture,Ae.transmissionSamplerSize.value.set(ve.width,ve.height),ye.transmissionMap&&(Ae.transmissionMap.value=ye.transmissionMap,_(ye.transmissionMap,Ae.transmissionMapTransform)),Ae.thickness.value=ye.thickness,ye.thicknessMap&&(Ae.thicknessMap.value=ye.thicknessMap,_(ye.thicknessMap,Ae.thicknessMapTransform)),Ae.attenuationDistance.value=ye.attenuationDistance,Ae.attenuationColor.value.copy(ye.attenuationColor)),ye.anisotropy>0&&(Ae.anisotropyVector.value.set(ye.anisotropy*Math.cos(ye.anisotropyRotation),ye.anisotropy*Math.sin(ye.anisotropyRotation)),ye.anisotropyMap&&(Ae.anisotropyMap.value=ye.anisotropyMap,_(ye.anisotropyMap,Ae.anisotropyMapTransform))),Ae.specularIntensity.value=ye.specularIntensity,Ae.specularColor.value.copy(ye.specularColor),ye.specularColorMap&&(Ae.specularColorMap.value=ye.specularColorMap,_(ye.specularColorMap,Ae.specularColorMapTransform)),ye.specularIntensityMap&&(Ae.specularIntensityMap.value=ye.specularIntensityMap,_(ye.specularIntensityMap,Ae.specularIntensityMapTransform))}function fe(Ae,ye){ye.matcap&&(Ae.matcap.value=ye.matcap)}function be(Ae,ye){const ve=Z.get(ye).light;Ae.referencePosition.value.setFromMatrixPosition(ve.matrixWorld),Ae.nearDistance.value=ve.shadow.camera.near,Ae.farDistance.value=ve.shadow.camera.far}return{refreshFogUniforms:K,refreshMaterialUniforms:te}}function WebGLUniformsGroups(X,Z,_,K){let te={},ne={},ie=[];const oe=X.getParameter(X.MAX_UNIFORM_BUFFER_BINDINGS);function se(ve,Be){const Re=Be.program;K.uniformBlockBinding(ve,Re)}function ae(ve,Be){let Re=te[ve.id];Re===void 0&&(fe(ve),Re=ge(ve),te[ve.id]=Re,ve.addEventListener("dispose",Ae));const Ve=Be.program;K.updateUBOMapping(ve,Ve);const Ee=Z.render.frame;ne[ve.id]!==Ee&&(de(ve),ne[ve.id]=Ee)}function ge(ve){const Be=ce();ve.__bindingPointIndex=Be;const Re=X.createBuffer(),Ve=ve.__size,Ee=ve.usage;return X.bindBuffer(X.UNIFORM_BUFFER,Re),X.bufferData(X.UNIFORM_BUFFER,Ve,Ee),X.bindBuffer(X.UNIFORM_BUFFER,null),X.bindBufferBase(X.UNIFORM_BUFFER,Be,Re),Re}function ce(){for(let ve=0;ve<oe;ve++)if(ie.indexOf(ve)===-1)return ie.push(ve),ve;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}function de(ve){const Be=te[ve.id],Re=ve.uniforms,Ve=ve.__cache;X.bindBuffer(X.UNIFORM_BUFFER,Be);for(let Ee=0,Ze=Re.length;Ee<Ze;Ee++){const _e=Array.isArray(Re[Ee])?Re[Ee]:[Re[Ee]];for(let Fe=0,Te=_e.length;Fe<Te;Fe++){const ke=_e[Fe];if(Ie(ke,Ee,Fe,Ve)===!0){const Le=ke.__offset,Ke=Array.isArray(ke.value)?ke.value:[ke.value];let Ue=0;for(let rt=0;rt<Ke.length;rt++){const tt=Ke[rt],at=be(tt);typeof tt=="number"||typeof tt=="boolean"?(ke.__data[0]=tt,X.bufferSubData(X.UNIFORM_BUFFER,Le+Ue,ke.__data)):tt.isMatrix3?(ke.__data[0]=tt.elements[0],ke.__data[1]=tt.elements[1],ke.__data[2]=tt.elements[2],ke.__data[3]=0,ke.__data[4]=tt.elements[3],ke.__data[5]=tt.elements[4],ke.__data[6]=tt.elements[5],ke.__data[7]=0,ke.__data[8]=tt.elements[6],ke.__data[9]=tt.elements[7],ke.__data[10]=tt.elements[8],ke.__data[11]=0):(tt.toArray(ke.__data,Ue),Ue+=at.storage/Float32Array.BYTES_PER_ELEMENT)}X.bufferSubData(X.UNIFORM_BUFFER,Le,ke.__data)}}}X.bindBuffer(X.UNIFORM_BUFFER,null)}function Ie(ve,Be,Re,Ve){const Ee=ve.value,Ze=Be+"_"+Re;if(Ve[Ze]===void 0)return typeof Ee=="number"||typeof Ee=="boolean"?Ve[Ze]=Ee:Ve[Ze]=Ee.clone(),!0;{const _e=Ve[Ze];if(typeof Ee=="number"||typeof Ee=="boolean"){if(_e!==Ee)return Ve[Ze]=Ee,!0}else if(_e.equals(Ee)===!1)return _e.copy(Ee),!0}return!1}function fe(ve){const Be=ve.uniforms;let Re=0;const Ve=16;for(let Ze=0,_e=Be.length;Ze<_e;Ze++){const Fe=Array.isArray(Be[Ze])?Be[Ze]:[Be[Ze]];for(let Te=0,ke=Fe.length;Te<ke;Te++){const Le=Fe[Te],Ke=Array.isArray(Le.value)?Le.value:[Le.value];for(let Ue=0,rt=Ke.length;Ue<rt;Ue++){const tt=Ke[Ue],at=be(tt),ze=Re%Ve,qe=ze%at.boundary,Pe=ze+qe;Re+=qe,Pe!==0&&Ve-Pe<at.storage&&(Re+=Ve-Pe),Le.__data=new Float32Array(at.storage/Float32Array.BYTES_PER_ELEMENT),Le.__offset=Re,Re+=at.storage}}}const Ee=Re%Ve;return Ee>0&&(Re+=Ve-Ee),ve.__size=Re,ve.__cache={},this}function be(ve){const Be={boundary:0,storage:0};return typeof ve=="number"||typeof ve=="boolean"?(Be.boundary=4,Be.storage=4):ve.isVector2?(Be.boundary=8,Be.storage=8):ve.isVector3||ve.isColor?(Be.boundary=16,Be.storage=12):ve.isVector4?(Be.boundary=16,Be.storage=16):ve.isMatrix3?(Be.boundary=48,Be.storage=48):ve.isMatrix4?(Be.boundary=64,Be.storage=64):ve.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",ve),Be}function Ae(ve){const Be=ve.target;Be.removeEventListener("dispose",Ae);const Re=ie.indexOf(Be.__bindingPointIndex);ie.splice(Re,1),X.deleteBuffer(te[Be.id]),delete te[Be.id],delete ne[Be.id]}function ye(){for(const ve in te)X.deleteBuffer(te[ve]);ie=[],te={},ne={}}return{bind:se,update:ae,dispose:ye}}class WebGLRenderer{constructor(Z={}){const{canvas:_=createCanvasElement(),context:K=null,depth:te=!0,stencil:ne=!1,alpha:ie=!1,antialias:oe=!1,premultipliedAlpha:se=!0,preserveDrawingBuffer:ae=!1,powerPreference:ge="default",failIfMajorPerformanceCaveat:ce=!1,reverseDepthBuffer:de=!1}=Z;this.isWebGLRenderer=!0;let Ie;if(K!==null){if(typeof WebGLRenderingContext<"u"&&K instanceof WebGLRenderingContext)throw new Error("THREE.WebGLRenderer: WebGL 1 is not supported since r163.");Ie=K.getContextAttributes().alpha}else Ie=ie;const fe=new Uint32Array(4),be=new Int32Array(4);let Ae=null,ye=null;const ve=[],Be=[];this.domElement=_,this.debug={checkShaderErrors:!0,onShaderError:null},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this._outputColorSpace=SRGBColorSpace$1,this.toneMapping=NoToneMapping,this.toneMappingExposure=1;const Re=this;let Ve=!1,Ee=0,Ze=0,_e=null,Fe=-1,Te=null;const ke=new Vector4,Le=new Vector4;let Ke=null;const Ue=new Color$1(0);let rt=0,tt=_.width,at=_.height,ze=1,qe=null,Pe=null;const Ye=new Vector4(0,0,tt,at),$e=new Vector4(0,0,tt,at);let ut=!1;const ot=new Frustum;let gt=!1,ht=!1;this.transmissionResolutionScale=1;const dt=new Matrix4,bt=new Matrix4,Ht=new Vector3,Dt=new Vector4,Vt={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};let mt=!1;function Ft(){return _e===null?ze:1}let it=K;function Lt(Qe,pt){return _.getContext(Qe,pt)}try{const Qe={alpha:!0,depth:te,stencil:ne,antialias:oe,premultipliedAlpha:se,preserveDrawingBuffer:ae,powerPreference:ge,failIfMajorPerformanceCaveat:ce};if("setAttribute"in _&&_.setAttribute("data-engine",`three.js r${REVISION}`),_.addEventListener("webglcontextlost",on,!1),_.addEventListener("webglcontextrestored",dn,!1),_.addEventListener("webglcontextcreationerror",an,!1),it===null){const pt="webgl2";if(it=Lt(pt,Qe),it===null)throw Lt(pt)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}}catch(Qe){throw console.error("THREE.WebGLRenderer: "+Qe.message),Qe}let Et,Ut,Zt,Ot,Tt,Je,Oe,lt,ft,St,Wt,zt,$t,rn,Gn,en,In,un,ln,tn,Sn,yn,Tn,vt;function wt(){Et=new WebGLExtensions(it),Et.init(),yn=new WebGLUtils(it,Et),Ut=new WebGLCapabilities(it,Et,Z,yn),Zt=new WebGLState(it,Et),Ut.reverseDepthBuffer&&de&&Zt.buffers.depth.setReversed(!0),Ot=new WebGLInfo(it),Tt=new WebGLProperties,Je=new WebGLTextures(it,Et,Zt,Tt,Ut,yn,Ot),Oe=new WebGLCubeMaps(Re),lt=new WebGLCubeUVMaps(Re),ft=new WebGLAttributes(it),Tn=new WebGLBindingStates(it,ft),St=new WebGLGeometries(it,ft,Ot,Tn),Wt=new WebGLObjects(it,St,ft,Ot),ln=new WebGLMorphtargets(it,Ut,Je),en=new WebGLClipping(Tt),zt=new WebGLPrograms(Re,Oe,lt,Et,Ut,Tn,en),$t=new WebGLMaterials(Re,Tt),rn=new WebGLRenderLists,Gn=new WebGLRenderStates(Et),un=new WebGLBackground(Re,Oe,lt,Zt,Wt,Ie,se),In=new WebGLShadowMap(Re,Wt,Ut),vt=new WebGLUniformsGroups(it,Ot,Ut,Zt),tn=new WebGLBufferRenderer(it,Et,Ot),Sn=new WebGLIndexedBufferRenderer(it,Et,Ot),Ot.programs=zt.programs,Re.capabilities=Ut,Re.extensions=Et,Re.properties=Tt,Re.renderLists=rn,Re.shadowMap=In,Re.state=Zt,Re.info=Ot}wt();const Mt=new WebXRManager(Re,it);this.xr=Mt,this.getContext=function(){return it},this.getContextAttributes=function(){return it.getContextAttributes()},this.forceContextLoss=function(){const Qe=Et.get("WEBGL_lose_context");Qe&&Qe.loseContext()},this.forceContextRestore=function(){const Qe=Et.get("WEBGL_lose_context");Qe&&Qe.restoreContext()},this.getPixelRatio=function(){return ze},this.setPixelRatio=function(Qe){Qe!==void 0&&(ze=Qe,this.setSize(tt,at,!1))},this.getSize=function(Qe){return Qe.set(tt,at)},this.setSize=function(Qe,pt,At=!0){if(Mt.isPresenting){console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting.");return}tt=Qe,at=pt,_.width=Math.floor(Qe*ze),_.height=Math.floor(pt*ze),At===!0&&(_.style.width=Qe+"px",_.style.height=pt+"px"),this.setViewport(0,0,Qe,pt)},this.getDrawingBufferSize=function(Qe){return Qe.set(tt*ze,at*ze).floor()},this.setDrawingBufferSize=function(Qe,pt,At){tt=Qe,at=pt,ze=At,_.width=Math.floor(Qe*At),_.height=Math.floor(pt*At),this.setViewport(0,0,Qe,pt)},this.getCurrentViewport=function(Qe){return Qe.copy(ke)},this.getViewport=function(Qe){return Qe.copy(Ye)},this.setViewport=function(Qe,pt,At,ct){Qe.isVector4?Ye.set(Qe.x,Qe.y,Qe.z,Qe.w):Ye.set(Qe,pt,At,ct),Zt.viewport(ke.copy(Ye).multiplyScalar(ze).round())},this.getScissor=function(Qe){return Qe.copy($e)},this.setScissor=function(Qe,pt,At,ct){Qe.isVector4?$e.set(Qe.x,Qe.y,Qe.z,Qe.w):$e.set(Qe,pt,At,ct),Zt.scissor(Le.copy($e).multiplyScalar(ze).round())},this.getScissorTest=function(){return ut},this.setScissorTest=function(Qe){Zt.setScissorTest(ut=Qe)},this.setOpaqueSort=function(Qe){qe=Qe},this.setTransparentSort=function(Qe){Pe=Qe},this.getClearColor=function(Qe){return Qe.copy(un.getClearColor())},this.setClearColor=function(){un.setClearColor.apply(un,arguments)},this.getClearAlpha=function(){return un.getClearAlpha()},this.setClearAlpha=function(){un.setClearAlpha.apply(un,arguments)},this.clear=function(Qe=!0,pt=!0,At=!0){let ct=0;if(Qe){let Bt=!1;if(_e!==null){const Xt=_e.texture.format;Bt=Xt===RGBAIntegerFormat||Xt===RGIntegerFormat||Xt===RedIntegerFormat}if(Bt){const Xt=_e.texture.type,Qt=Xt===UnsignedByteType||Xt===UnsignedIntType||Xt===UnsignedShortType||Xt===UnsignedInt248Type||Xt===UnsignedShort4444Type||Xt===UnsignedShort5551Type,sn=un.getClearColor(),cn=un.getClearAlpha(),Bn=sn.r,bn=sn.g,gn=sn.b;Qt?(fe[0]=Bn,fe[1]=bn,fe[2]=gn,fe[3]=cn,it.clearBufferuiv(it.COLOR,0,fe)):(be[0]=Bn,be[1]=bn,be[2]=gn,be[3]=cn,it.clearBufferiv(it.COLOR,0,be))}else ct|=it.COLOR_BUFFER_BIT}pt&&(ct|=it.DEPTH_BUFFER_BIT),At&&(ct|=it.STENCIL_BUFFER_BIT,this.state.buffers.stencil.setMask(4294967295)),it.clear(ct)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){_.removeEventListener("webglcontextlost",on,!1),_.removeEventListener("webglcontextrestored",dn,!1),_.removeEventListener("webglcontextcreationerror",an,!1),un.dispose(),rn.dispose(),Gn.dispose(),Tt.dispose(),Oe.dispose(),lt.dispose(),Wt.dispose(),Tn.dispose(),vt.dispose(),zt.dispose(),Mt.dispose(),Mt.removeEventListener("sessionstart",vr),Mt.removeEventListener("sessionend",Yr),Fr.stop()};function on(Qe){Qe.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),Ve=!0}function dn(){console.log("THREE.WebGLRenderer: Context Restored."),Ve=!1;const Qe=Ot.autoReset,pt=In.enabled,At=In.autoUpdate,ct=In.needsUpdate,Bt=In.type;wt(),Ot.autoReset=Qe,In.enabled=pt,In.autoUpdate=At,In.needsUpdate=ct,In.type=Bt}function an(Qe){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",Qe.statusMessage)}function Mn(Qe){const pt=Qe.target;pt.removeEventListener("dispose",Mn),Pn(pt)}function Pn(Qe){Nn(Qe),Tt.remove(Qe)}function Nn(Qe){const pt=Tt.get(Qe).programs;pt!==void 0&&(pt.forEach(function(At){zt.releaseProgram(At)}),Qe.isShaderMaterial&&zt.releaseShaderCache(Qe))}this.renderBufferDirect=function(Qe,pt,At,ct,Bt,Xt){pt===null&&(pt=Vt);const Qt=Bt.isMesh&&Bt.matrixWorld.determinant()<0,sn=yt(Qe,pt,At,ct,Bt);Zt.setMaterial(ct,Qt);let cn=At.index,Bn=1;if(ct.wireframe===!0){if(cn=St.getWireframeAttribute(At),cn===void 0)return;Bn=2}const bn=At.drawRange,gn=At.attributes.position;let xn=bn.start*Bn,wn=(bn.start+bn.count)*Bn;Xt!==null&&(xn=Math.max(xn,Xt.start*Bn),wn=Math.min(wn,(Xt.start+Xt.count)*Bn)),cn!==null?(xn=Math.max(xn,0),wn=Math.min(wn,cn.count)):gn!=null&&(xn=Math.max(xn,0),wn=Math.min(wn,gn.count));const Jn=wn-xn;if(Jn<0||Jn===1/0)return;Tn.setup(Bt,ct,sn,At,cn);let Wn,Hn=tn;if(cn!==null&&(Wn=ft.get(cn),Hn=Sn,Hn.setIndex(Wn)),Bt.isMesh)ct.wireframe===!0?(Zt.setLineWidth(ct.wireframeLinewidth*Ft()),Hn.setMode(it.LINES)):Hn.setMode(it.TRIANGLES);else if(Bt.isLine){let Zn=ct.linewidth;Zn===void 0&&(Zn=1),Zt.setLineWidth(Zn*Ft()),Bt.isLineSegments?Hn.setMode(it.LINES):Bt.isLineLoop?Hn.setMode(it.LINE_LOOP):Hn.setMode(it.LINE_STRIP)}else Bt.isPoints?Hn.setMode(it.POINTS):Bt.isSprite&&Hn.setMode(it.TRIANGLES);if(Bt.isBatchedMesh)if(Bt._multiDrawInstances!==null)Hn.renderMultiDrawInstances(Bt._multiDrawStarts,Bt._multiDrawCounts,Bt._multiDrawCount,Bt._multiDrawInstances);else if(Et.get("WEBGL_multi_draw"))Hn.renderMultiDraw(Bt._multiDrawStarts,Bt._multiDrawCounts,Bt._multiDrawCount);else{const Zn=Bt._multiDrawStarts,nr=Bt._multiDrawCounts,Kn=Bt._multiDrawCount,er=cn?ft.get(cn).bytesPerElement:1,Ar=Tt.get(ct).currentProgram.getUniforms();for(let tr=0;tr<Kn;tr++)Ar.setValue(it,"_gl_DrawID",tr),Hn.render(Zn[tr]/er,nr[tr])}else if(Bt.isInstancedMesh)Hn.renderInstances(xn,Jn,Bt.count);else if(At.isInstancedBufferGeometry){const Zn=At._maxInstanceCount!==void 0?At._maxInstanceCount:1/0,nr=Math.min(At.instanceCount,Zn);Hn.renderInstances(xn,Jn,nr)}else Hn.render(xn,Jn)};function kn(Qe,pt,At){Qe.transparent===!0&&Qe.side===DoubleSide&&Qe.forceSinglePass===!1?(Qe.side=BackSide,Qe.needsUpdate=!0,Bi(Qe,pt,At),Qe.side=FrontSide,Qe.needsUpdate=!0,Bi(Qe,pt,At),Qe.side=DoubleSide):Bi(Qe,pt,At)}this.compile=function(Qe,pt,At=null){At===null&&(At=Qe),ye=Gn.get(At),ye.init(pt),Be.push(ye),At.traverseVisible(function(Bt){Bt.isLight&&Bt.layers.test(pt.layers)&&(ye.pushLight(Bt),Bt.castShadow&&ye.pushShadow(Bt))}),Qe!==At&&Qe.traverseVisible(function(Bt){Bt.isLight&&Bt.layers.test(pt.layers)&&(ye.pushLight(Bt),Bt.castShadow&&ye.pushShadow(Bt))}),ye.setupLights();const ct=new Set;return Qe.traverse(function(Bt){if(!(Bt.isMesh||Bt.isPoints||Bt.isLine||Bt.isSprite))return;const Xt=Bt.material;if(Xt)if(Array.isArray(Xt))for(let Qt=0;Qt<Xt.length;Qt++){const sn=Xt[Qt];kn(sn,At,Bt),ct.add(sn)}else kn(Xt,At,Bt),ct.add(Xt)}),Be.pop(),ye=null,ct},this.compileAsync=function(Qe,pt,At=null){const ct=this.compile(Qe,pt,At);return new Promise(Bt=>{function Xt(){if(ct.forEach(function(Qt){Tt.get(Qt).currentProgram.isReady()&&ct.delete(Qt)}),ct.size===0){Bt(Qe);return}setTimeout(Xt,10)}Et.get("KHR_parallel_shader_compile")!==null?Xt():setTimeout(Xt,10)})};let Ir=null;function dr(Qe){Ir&&Ir(Qe)}function vr(){Fr.stop()}function Yr(){Fr.start()}const Fr=new WebGLAnimation;Fr.setAnimationLoop(dr),typeof self<"u"&&Fr.setContext(self),this.setAnimationLoop=function(Qe){Ir=Qe,Mt.setAnimationLoop(Qe),Qe===null?Fr.stop():Fr.start()},Mt.addEventListener("sessionstart",vr),Mt.addEventListener("sessionend",Yr),this.render=function(Qe,pt){if(pt!==void 0&&pt.isCamera!==!0){console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");return}if(Ve===!0)return;if(Qe.matrixWorldAutoUpdate===!0&&Qe.updateMatrixWorld(),pt.parent===null&&pt.matrixWorldAutoUpdate===!0&&pt.updateMatrixWorld(),Mt.enabled===!0&&Mt.isPresenting===!0&&(Mt.cameraAutoUpdate===!0&&Mt.updateCamera(pt),pt=Mt.getCamera()),Qe.isScene===!0&&Qe.onBeforeRender(Re,Qe,pt,_e),ye=Gn.get(Qe,Be.length),ye.init(pt),Be.push(ye),bt.multiplyMatrices(pt.projectionMatrix,pt.matrixWorldInverse),ot.setFromProjectionMatrix(bt),ht=this.localClippingEnabled,gt=en.init(this.clippingPlanes,ht),Ae=rn.get(Qe,ve.length),Ae.init(),ve.push(Ae),Mt.enabled===!0&&Mt.isPresenting===!0){const Xt=Re.xr.getDepthSensingMesh();Xt!==null&&Nr(Xt,pt,-1/0,Re.sortObjects)}Nr(Qe,pt,0,Re.sortObjects),Ae.finish(),Re.sortObjects===!0&&Ae.sort(qe,Pe),mt=Mt.enabled===!1||Mt.isPresenting===!1||Mt.hasDepthSensing()===!1,mt&&un.addToRenderList(Ae,Qe),this.info.render.frame++,gt===!0&&en.beginShadows();const At=ye.state.shadowsArray;In.render(At,Qe,pt),gt===!0&&en.endShadows(),this.info.autoReset===!0&&this.info.reset();const ct=Ae.opaque,Bt=Ae.transmissive;if(ye.setupLights(),pt.isArrayCamera){const Xt=pt.cameras;if(Bt.length>0)for(let Qt=0,sn=Xt.length;Qt<sn;Qt++){const cn=Xt[Qt];_r(ct,Bt,Qe,cn)}mt&&un.render(Qe);for(let Qt=0,sn=Xt.length;Qt<sn;Qt++){const cn=Xt[Qt];Kr(Ae,Qe,cn,cn.viewport)}}else Bt.length>0&&_r(ct,Bt,Qe,pt),mt&&un.render(Qe),Kr(Ae,Qe,pt);_e!==null&&Ze===0&&(Je.updateMultisampleRenderTarget(_e),Je.updateRenderTargetMipmap(_e)),Qe.isScene===!0&&Qe.onAfterRender(Re,Qe,pt),Tn.resetDefaultState(),Fe=-1,Te=null,Be.pop(),Be.length>0?(ye=Be[Be.length-1],gt===!0&&en.setGlobalState(Re.clippingPlanes,ye.state.camera)):ye=null,ve.pop(),ve.length>0?Ae=ve[ve.length-1]:Ae=null};function Nr(Qe,pt,At,ct){if(Qe.visible===!1)return;if(Qe.layers.test(pt.layers)){if(Qe.isGroup)At=Qe.renderOrder;else if(Qe.isLOD)Qe.autoUpdate===!0&&Qe.update(pt);else if(Qe.isLight)ye.pushLight(Qe),Qe.castShadow&&ye.pushShadow(Qe);else if(Qe.isSprite){if(!Qe.frustumCulled||ot.intersectsSprite(Qe)){ct&&Dt.setFromMatrixPosition(Qe.matrixWorld).applyMatrix4(bt);const Qt=Wt.update(Qe),sn=Qe.material;sn.visible&&Ae.push(Qe,Qt,sn,At,Dt.z,null)}}else if((Qe.isMesh||Qe.isLine||Qe.isPoints)&&(!Qe.frustumCulled||ot.intersectsObject(Qe))){const Qt=Wt.update(Qe),sn=Qe.material;if(ct&&(Qe.boundingSphere!==void 0?(Qe.boundingSphere===null&&Qe.computeBoundingSphere(),Dt.copy(Qe.boundingSphere.center)):(Qt.boundingSphere===null&&Qt.computeBoundingSphere(),Dt.copy(Qt.boundingSphere.center)),Dt.applyMatrix4(Qe.matrixWorld).applyMatrix4(bt)),Array.isArray(sn)){const cn=Qt.groups;for(let Bn=0,bn=cn.length;Bn<bn;Bn++){const gn=cn[Bn],xn=sn[gn.materialIndex];xn&&xn.visible&&Ae.push(Qe,Qt,xn,At,Dt.z,gn)}}else sn.visible&&Ae.push(Qe,Qt,sn,At,Dt.z,null)}}const Xt=Qe.children;for(let Qt=0,sn=Xt.length;Qt<sn;Qt++)Nr(Xt[Qt],pt,At,ct)}function Kr(Qe,pt,At,ct){const Bt=Qe.opaque,Xt=Qe.transmissive,Qt=Qe.transparent;ye.setupLightsView(At),gt===!0&&en.setGlobalState(Re.clippingPlanes,At),ct&&Zt.viewport(ke.copy(ct)),Bt.length>0&&Un(Bt,pt,At),Xt.length>0&&Un(Xt,pt,At),Qt.length>0&&Un(Qt,pt,At),Zt.buffers.depth.setTest(!0),Zt.buffers.depth.setMask(!0),Zt.buffers.color.setMask(!0),Zt.setPolygonOffset(!1)}function _r(Qe,pt,At,ct){if((At.isScene===!0?At.overrideMaterial:null)!==null)return;ye.state.transmissionRenderTarget[ct.id]===void 0&&(ye.state.transmissionRenderTarget[ct.id]=new WebGLRenderTarget(1,1,{generateMipmaps:!0,type:Et.has("EXT_color_buffer_half_float")||Et.has("EXT_color_buffer_float")?HalfFloatType:UnsignedByteType,minFilter:LinearMipmapLinearFilter,samples:4,stencilBuffer:ne,resolveDepthBuffer:!1,resolveStencilBuffer:!1,colorSpace:ColorManagement.workingColorSpace}));const Xt=ye.state.transmissionRenderTarget[ct.id],Qt=ct.viewport||ke;Xt.setSize(Qt.z*Re.transmissionResolutionScale,Qt.w*Re.transmissionResolutionScale);const sn=Re.getRenderTarget();Re.setRenderTarget(Xt),Re.getClearColor(Ue),rt=Re.getClearAlpha(),rt<1&&Re.setClearColor(16777215,.5),Re.clear(),mt&&un.render(At);const cn=Re.toneMapping;Re.toneMapping=NoToneMapping;const Bn=ct.viewport;if(ct.viewport!==void 0&&(ct.viewport=void 0),ye.setupLightsView(ct),gt===!0&&en.setGlobalState(Re.clippingPlanes,ct),Un(Qe,At,ct),Je.updateMultisampleRenderTarget(Xt),Je.updateRenderTargetMipmap(Xt),Et.has("WEBGL_multisampled_render_to_texture")===!1){let bn=!1;for(let gn=0,xn=pt.length;gn<xn;gn++){const wn=pt[gn],Jn=wn.object,Wn=wn.geometry,Hn=wn.material,Zn=wn.group;if(Hn.side===DoubleSide&&Jn.layers.test(ct.layers)){const nr=Hn.side;Hn.side=BackSide,Hn.needsUpdate=!0,Lr(Jn,At,ct,Wn,Hn,Zn),Hn.side=nr,Hn.needsUpdate=!0,bn=!0}}bn===!0&&(Je.updateMultisampleRenderTarget(Xt),Je.updateRenderTargetMipmap(Xt))}Re.setRenderTarget(sn),Re.setClearColor(Ue,rt),Bn!==void 0&&(ct.viewport=Bn),Re.toneMapping=cn}function Un(Qe,pt,At){const ct=pt.isScene===!0?pt.overrideMaterial:null;for(let Bt=0,Xt=Qe.length;Bt<Xt;Bt++){const Qt=Qe[Bt],sn=Qt.object,cn=Qt.geometry,Bn=ct===null?Qt.material:ct,bn=Qt.group;sn.layers.test(At.layers)&&Lr(sn,pt,At,cn,Bn,bn)}}function Lr(Qe,pt,At,ct,Bt,Xt){Qe.onBeforeRender(Re,pt,At,ct,Bt,Xt),Qe.modelViewMatrix.multiplyMatrices(At.matrixWorldInverse,Qe.matrixWorld),Qe.normalMatrix.getNormalMatrix(Qe.modelViewMatrix),Bt.onBeforeRender(Re,pt,At,ct,Qe,Xt),Bt.transparent===!0&&Bt.side===DoubleSide&&Bt.forceSinglePass===!1?(Bt.side=BackSide,Bt.needsUpdate=!0,Re.renderBufferDirect(At,pt,ct,Bt,Qe,Xt),Bt.side=FrontSide,Bt.needsUpdate=!0,Re.renderBufferDirect(At,pt,ct,Bt,Qe,Xt),Bt.side=DoubleSide):Re.renderBufferDirect(At,pt,ct,Bt,Qe,Xt),Qe.onAfterRender(Re,pt,At,ct,Bt,Xt)}function Bi(Qe,pt,At){pt.isScene!==!0&&(pt=Vt);const ct=Tt.get(Qe),Bt=ye.state.lights,Xt=ye.state.shadowsArray,Qt=Bt.state.version,sn=zt.getParameters(Qe,Bt.state,Xt,pt,At),cn=zt.getProgramCacheKey(sn);let Bn=ct.programs;ct.environment=Qe.isMeshStandardMaterial?pt.environment:null,ct.fog=pt.fog,ct.envMap=(Qe.isMeshStandardMaterial?lt:Oe).get(Qe.envMap||ct.environment),ct.envMapRotation=ct.environment!==null&&Qe.envMap===null?pt.environmentRotation:Qe.envMapRotation,Bn===void 0&&(Qe.addEventListener("dispose",Mn),Bn=new Map,ct.programs=Bn);let bn=Bn.get(cn);if(bn!==void 0){if(ct.currentProgram===bn&&ct.lightsStateVersion===Qt)return st(Qe,sn),bn}else sn.uniforms=zt.getUniforms(Qe),Qe.onBeforeCompile(sn,Re),bn=zt.acquireProgram(sn,cn),Bn.set(cn,bn),ct.uniforms=sn.uniforms;const gn=ct.uniforms;return(!Qe.isShaderMaterial&&!Qe.isRawShaderMaterial||Qe.clipping===!0)&&(gn.clippingPlanes=en.uniform),st(Qe,sn),ct.needsLights=jt(Qe),ct.lightsStateVersion=Qt,ct.needsLights&&(gn.ambientLightColor.value=Bt.state.ambient,gn.lightProbe.value=Bt.state.probe,gn.directionalLights.value=Bt.state.directional,gn.directionalLightShadows.value=Bt.state.directionalShadow,gn.spotLights.value=Bt.state.spot,gn.spotLightShadows.value=Bt.state.spotShadow,gn.rectAreaLights.value=Bt.state.rectArea,gn.ltc_1.value=Bt.state.rectAreaLTC1,gn.ltc_2.value=Bt.state.rectAreaLTC2,gn.pointLights.value=Bt.state.point,gn.pointLightShadows.value=Bt.state.pointShadow,gn.hemisphereLights.value=Bt.state.hemi,gn.directionalShadowMap.value=Bt.state.directionalShadowMap,gn.directionalShadowMatrix.value=Bt.state.directionalShadowMatrix,gn.spotShadowMap.value=Bt.state.spotShadowMap,gn.spotLightMatrix.value=Bt.state.spotLightMatrix,gn.spotLightMap.value=Bt.state.spotLightMap,gn.pointShadowMap.value=Bt.state.pointShadowMap,gn.pointShadowMatrix.value=Bt.state.pointShadowMatrix),ct.currentProgram=bn,ct.uniformsList=null,bn}function je(Qe){if(Qe.uniformsList===null){const pt=Qe.currentProgram.getUniforms();Qe.uniformsList=WebGLUniforms.seqWithValue(pt.seq,Qe.uniforms)}return Qe.uniformsList}function st(Qe,pt){const At=Tt.get(Qe);At.outputColorSpace=pt.outputColorSpace,At.batching=pt.batching,At.batchingColor=pt.batchingColor,At.instancing=pt.instancing,At.instancingColor=pt.instancingColor,At.instancingMorph=pt.instancingMorph,At.skinning=pt.skinning,At.morphTargets=pt.morphTargets,At.morphNormals=pt.morphNormals,At.morphColors=pt.morphColors,At.morphTargetsCount=pt.morphTargetsCount,At.numClippingPlanes=pt.numClippingPlanes,At.numIntersection=pt.numClipIntersection,At.vertexAlphas=pt.vertexAlphas,At.vertexTangents=pt.vertexTangents,At.toneMapping=pt.toneMapping}function yt(Qe,pt,At,ct,Bt){pt.isScene!==!0&&(pt=Vt),Je.resetTextureUnits();const Xt=pt.fog,Qt=ct.isMeshStandardMaterial?pt.environment:null,sn=_e===null?Re.outputColorSpace:_e.isXRRenderTarget===!0?_e.texture.colorSpace:LinearSRGBColorSpace$1,cn=(ct.isMeshStandardMaterial?lt:Oe).get(ct.envMap||Qt),Bn=ct.vertexColors===!0&&!!At.attributes.color&&At.attributes.color.itemSize===4,bn=!!At.attributes.tangent&&(!!ct.normalMap||ct.anisotropy>0),gn=!!At.morphAttributes.position,xn=!!At.morphAttributes.normal,wn=!!At.morphAttributes.color;let Jn=NoToneMapping;ct.toneMapped&&(_e===null||_e.isXRRenderTarget===!0)&&(Jn=Re.toneMapping);const Wn=At.morphAttributes.position||At.morphAttributes.normal||At.morphAttributes.color,Hn=Wn!==void 0?Wn.length:0,Zn=Tt.get(ct),nr=ye.state.lights;if(gt===!0&&(ht===!0||Qe!==Te)){const yr=Qe===Te&&ct.id===Fe;en.setState(ct,Qe,yr)}let Kn=!1;ct.version===Zn.__version?(Zn.needsLights&&Zn.lightsStateVersion!==nr.state.version||Zn.outputColorSpace!==sn||Bt.isBatchedMesh&&Zn.batching===!1||!Bt.isBatchedMesh&&Zn.batching===!0||Bt.isBatchedMesh&&Zn.batchingColor===!0&&Bt.colorTexture===null||Bt.isBatchedMesh&&Zn.batchingColor===!1&&Bt.colorTexture!==null||Bt.isInstancedMesh&&Zn.instancing===!1||!Bt.isInstancedMesh&&Zn.instancing===!0||Bt.isSkinnedMesh&&Zn.skinning===!1||!Bt.isSkinnedMesh&&Zn.skinning===!0||Bt.isInstancedMesh&&Zn.instancingColor===!0&&Bt.instanceColor===null||Bt.isInstancedMesh&&Zn.instancingColor===!1&&Bt.instanceColor!==null||Bt.isInstancedMesh&&Zn.instancingMorph===!0&&Bt.morphTexture===null||Bt.isInstancedMesh&&Zn.instancingMorph===!1&&Bt.morphTexture!==null||Zn.envMap!==cn||ct.fog===!0&&Zn.fog!==Xt||Zn.numClippingPlanes!==void 0&&(Zn.numClippingPlanes!==en.numPlanes||Zn.numIntersection!==en.numIntersection)||Zn.vertexAlphas!==Bn||Zn.vertexTangents!==bn||Zn.morphTargets!==gn||Zn.morphNormals!==xn||Zn.morphColors!==wn||Zn.toneMapping!==Jn||Zn.morphTargetsCount!==Hn)&&(Kn=!0):(Kn=!0,Zn.__version=ct.version);let er=Zn.currentProgram;Kn===!0&&(er=Bi(ct,pt,Bt));let Ar=!1,tr=!1,Qn=!1;const On=er.getUniforms(),br=Zn.uniforms;if(Zt.useProgram(er.program)&&(Ar=!0,tr=!0,Qn=!0),ct.id!==Fe&&(Fe=ct.id,tr=!0),Ar||Te!==Qe){Zt.buffers.depth.getReversed()?(dt.copy(Qe.projectionMatrix),toNormalizedProjectionMatrix(dt),toReversedProjectionMatrix(dt),On.setValue(it,"projectionMatrix",dt)):On.setValue(it,"projectionMatrix",Qe.projectionMatrix),On.setValue(it,"viewMatrix",Qe.matrixWorldInverse);const Rr=On.map.cameraPosition;Rr!==void 0&&Rr.setValue(it,Ht.setFromMatrixPosition(Qe.matrixWorld)),Ut.logarithmicDepthBuffer&&On.setValue(it,"logDepthBufFC",2/(Math.log(Qe.far+1)/Math.LN2)),(ct.isMeshPhongMaterial||ct.isMeshToonMaterial||ct.isMeshLambertMaterial||ct.isMeshBasicMaterial||ct.isMeshStandardMaterial||ct.isShaderMaterial)&&On.setValue(it,"isOrthographic",Qe.isOrthographicCamera===!0),Te!==Qe&&(Te=Qe,tr=!0,Qn=!0)}if(Bt.isSkinnedMesh){On.setOptional(it,Bt,"bindMatrix"),On.setOptional(it,Bt,"bindMatrixInverse");const yr=Bt.skeleton;yr&&(yr.boneTexture===null&&yr.computeBoneTexture(),On.setValue(it,"boneTexture",yr.boneTexture,Je))}Bt.isBatchedMesh&&(On.setOptional(it,Bt,"batchingTexture"),On.setValue(it,"batchingTexture",Bt._matricesTexture,Je),On.setOptional(it,Bt,"batchingIdTexture"),On.setValue(it,"batchingIdTexture",Bt._indirectTexture,Je),On.setOptional(it,Bt,"batchingColorTexture"),Bt._colorsTexture!==null&&On.setValue(it,"batchingColorTexture",Bt._colorsTexture,Je));const ur=At.morphAttributes;if((ur.position!==void 0||ur.normal!==void 0||ur.color!==void 0)&&ln.update(Bt,At,er),(tr||Zn.receiveShadow!==Bt.receiveShadow)&&(Zn.receiveShadow=Bt.receiveShadow,On.setValue(it,"receiveShadow",Bt.receiveShadow)),ct.isMeshGouraudMaterial&&ct.envMap!==null&&(br.envMap.value=cn,br.flipEnvMap.value=cn.isCubeTexture&&cn.isRenderTargetTexture===!1?-1:1),ct.isMeshStandardMaterial&&ct.envMap===null&&pt.environment!==null&&(br.envMapIntensity.value=pt.environmentIntensity),tr&&(On.setValue(it,"toneMappingExposure",Re.toneMappingExposure),Zn.needsLights&&Yt(br,Qn),Xt&&ct.fog===!0&&$t.refreshFogUniforms(br,Xt),$t.refreshMaterialUniforms(br,ct,ze,at,ye.state.transmissionRenderTarget[Qe.id]),WebGLUniforms.upload(it,je(Zn),br,Je)),ct.isShaderMaterial&&ct.uniformsNeedUpdate===!0&&(WebGLUniforms.upload(it,je(Zn),br,Je),ct.uniformsNeedUpdate=!1),ct.isSpriteMaterial&&On.setValue(it,"center",Bt.center),On.setValue(it,"modelViewMatrix",Bt.modelViewMatrix),On.setValue(it,"normalMatrix",Bt.normalMatrix),On.setValue(it,"modelMatrix",Bt.matrixWorld),ct.isShaderMaterial||ct.isRawShaderMaterial){const yr=ct.uniformsGroups;for(let Rr=0,lr=yr.length;Rr<lr;Rr++){const ii=yr[Rr];vt.update(ii,er),vt.bind(ii,er)}}return er}function Yt(Qe,pt){Qe.ambientLightColor.needsUpdate=pt,Qe.lightProbe.needsUpdate=pt,Qe.directionalLights.needsUpdate=pt,Qe.directionalLightShadows.needsUpdate=pt,Qe.pointLights.needsUpdate=pt,Qe.pointLightShadows.needsUpdate=pt,Qe.spotLights.needsUpdate=pt,Qe.spotLightShadows.needsUpdate=pt,Qe.rectAreaLights.needsUpdate=pt,Qe.hemisphereLights.needsUpdate=pt}function jt(Qe){return Qe.isMeshLambertMaterial||Qe.isMeshToonMaterial||Qe.isMeshPhongMaterial||Qe.isMeshStandardMaterial||Qe.isShadowMaterial||Qe.isShaderMaterial&&Qe.lights===!0}this.getActiveCubeFace=function(){return Ee},this.getActiveMipmapLevel=function(){return Ze},this.getRenderTarget=function(){return _e},this.setRenderTargetTextures=function(Qe,pt,At){Tt.get(Qe.texture).__webglTexture=pt,Tt.get(Qe.depthTexture).__webglTexture=At;const ct=Tt.get(Qe);ct.__hasExternalTextures=!0,ct.__autoAllocateDepthBuffer=At===void 0,ct.__autoAllocateDepthBuffer||Et.has("WEBGL_multisampled_render_to_texture")===!0&&(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),ct.__useRenderToTexture=!1)},this.setRenderTargetFramebuffer=function(Qe,pt){const At=Tt.get(Qe);At.__webglFramebuffer=pt,At.__useDefaultFramebuffer=pt===void 0};const Jt=it.createFramebuffer();this.setRenderTarget=function(Qe,pt=0,At=0){_e=Qe,Ee=pt,Ze=At;let ct=!0,Bt=null,Xt=!1,Qt=!1;if(Qe){const cn=Tt.get(Qe);if(cn.__useDefaultFramebuffer!==void 0)Zt.bindFramebuffer(it.FRAMEBUFFER,null),ct=!1;else if(cn.__webglFramebuffer===void 0)Je.setupRenderTarget(Qe);else if(cn.__hasExternalTextures)Je.rebindTextures(Qe,Tt.get(Qe.texture).__webglTexture,Tt.get(Qe.depthTexture).__webglTexture);else if(Qe.depthBuffer){const gn=Qe.depthTexture;if(cn.__boundDepthTexture!==gn){if(gn!==null&&Tt.has(gn)&&(Qe.width!==gn.image.width||Qe.height!==gn.image.height))throw new Error("WebGLRenderTarget: Attached DepthTexture is initialized to the incorrect size.");Je.setupDepthRenderbuffer(Qe)}}const Bn=Qe.texture;(Bn.isData3DTexture||Bn.isDataArrayTexture||Bn.isCompressedArrayTexture)&&(Qt=!0);const bn=Tt.get(Qe).__webglFramebuffer;Qe.isWebGLCubeRenderTarget?(Array.isArray(bn[pt])?Bt=bn[pt][At]:Bt=bn[pt],Xt=!0):Qe.samples>0&&Je.useMultisampledRTT(Qe)===!1?Bt=Tt.get(Qe).__webglMultisampledFramebuffer:Array.isArray(bn)?Bt=bn[At]:Bt=bn,ke.copy(Qe.viewport),Le.copy(Qe.scissor),Ke=Qe.scissorTest}else ke.copy(Ye).multiplyScalar(ze).floor(),Le.copy($e).multiplyScalar(ze).floor(),Ke=ut;if(At!==0&&(Bt=Jt),Zt.bindFramebuffer(it.FRAMEBUFFER,Bt)&&ct&&Zt.drawBuffers(Qe,Bt),Zt.viewport(ke),Zt.scissor(Le),Zt.setScissorTest(Ke),Xt){const cn=Tt.get(Qe.texture);it.framebufferTexture2D(it.FRAMEBUFFER,it.COLOR_ATTACHMENT0,it.TEXTURE_CUBE_MAP_POSITIVE_X+pt,cn.__webglTexture,At)}else if(Qt){const cn=Tt.get(Qe.texture),Bn=pt;it.framebufferTextureLayer(it.FRAMEBUFFER,it.COLOR_ATTACHMENT0,cn.__webglTexture,At,Bn)}else if(Qe!==null&&At!==0){const cn=Tt.get(Qe.texture);it.framebufferTexture2D(it.FRAMEBUFFER,it.COLOR_ATTACHMENT0,it.TEXTURE_2D,cn.__webglTexture,At)}Fe=-1},this.readRenderTargetPixels=function(Qe,pt,At,ct,Bt,Xt,Qt){if(!(Qe&&Qe.isWebGLRenderTarget)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");return}let sn=Tt.get(Qe).__webglFramebuffer;if(Qe.isWebGLCubeRenderTarget&&Qt!==void 0&&(sn=sn[Qt]),sn){Zt.bindFramebuffer(it.FRAMEBUFFER,sn);try{const cn=Qe.texture,Bn=cn.format,bn=cn.type;if(!Ut.textureFormatReadable(Bn)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");return}if(!Ut.textureTypeReadable(bn)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");return}pt>=0&&pt<=Qe.width-ct&&At>=0&&At<=Qe.height-Bt&&it.readPixels(pt,At,ct,Bt,yn.convert(Bn),yn.convert(bn),Xt)}finally{const cn=_e!==null?Tt.get(_e).__webglFramebuffer:null;Zt.bindFramebuffer(it.FRAMEBUFFER,cn)}}},this.readRenderTargetPixelsAsync=async function(Qe,pt,At,ct,Bt,Xt,Qt){if(!(Qe&&Qe.isWebGLRenderTarget))throw new Error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let sn=Tt.get(Qe).__webglFramebuffer;if(Qe.isWebGLCubeRenderTarget&&Qt!==void 0&&(sn=sn[Qt]),sn){const cn=Qe.texture,Bn=cn.format,bn=cn.type;if(!Ut.textureFormatReadable(Bn))throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: renderTarget is not in RGBA or implementation defined format.");if(!Ut.textureTypeReadable(bn))throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: renderTarget is not in UnsignedByteType or implementation defined type.");if(pt>=0&&pt<=Qe.width-ct&&At>=0&&At<=Qe.height-Bt){Zt.bindFramebuffer(it.FRAMEBUFFER,sn);const gn=it.createBuffer();it.bindBuffer(it.PIXEL_PACK_BUFFER,gn),it.bufferData(it.PIXEL_PACK_BUFFER,Xt.byteLength,it.STREAM_READ),it.readPixels(pt,At,ct,Bt,yn.convert(Bn),yn.convert(bn),0);const xn=_e!==null?Tt.get(_e).__webglFramebuffer:null;Zt.bindFramebuffer(it.FRAMEBUFFER,xn);const wn=it.fenceSync(it.SYNC_GPU_COMMANDS_COMPLETE,0);return it.flush(),await probeAsync(it,wn,4),it.bindBuffer(it.PIXEL_PACK_BUFFER,gn),it.getBufferSubData(it.PIXEL_PACK_BUFFER,0,Xt),it.deleteBuffer(gn),it.deleteSync(wn),Xt}else throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: requested read bounds are out of range.")}},this.copyFramebufferToTexture=function(Qe,pt=null,At=0){Qe.isTexture!==!0&&(warnOnce("WebGLRenderer: copyFramebufferToTexture function signature has changed."),pt=arguments[0]||null,Qe=arguments[1]);const ct=Math.pow(2,-At),Bt=Math.floor(Qe.image.width*ct),Xt=Math.floor(Qe.image.height*ct),Qt=pt!==null?pt.x:0,sn=pt!==null?pt.y:0;Je.setTexture2D(Qe,0),it.copyTexSubImage2D(it.TEXTURE_2D,At,0,0,Qt,sn,Bt,Xt),Zt.unbindTexture()};const fn=it.createFramebuffer(),pn=it.createFramebuffer();this.copyTextureToTexture=function(Qe,pt,At=null,ct=null,Bt=0,Xt=null){Qe.isTexture!==!0&&(warnOnce("WebGLRenderer: copyTextureToTexture function signature has changed."),ct=arguments[0]||null,Qe=arguments[1],pt=arguments[2],Xt=arguments[3]||0,At=null),Xt===null&&(Bt!==0?(warnOnce("WebGLRenderer: copyTextureToTexture function signature has changed to support src and dst mipmap levels."),Xt=Bt,Bt=0):Xt=0);let Qt,sn,cn,Bn,bn,gn,xn,wn,Jn;const Wn=Qe.isCompressedTexture?Qe.mipmaps[Xt]:Qe.image;if(At!==null)Qt=At.max.x-At.min.x,sn=At.max.y-At.min.y,cn=At.isBox3?At.max.z-At.min.z:1,Bn=At.min.x,bn=At.min.y,gn=At.isBox3?At.min.z:0;else{const ur=Math.pow(2,-Bt);Qt=Math.floor(Wn.width*ur),sn=Math.floor(Wn.height*ur),Qe.isDataArrayTexture?cn=Wn.depth:Qe.isData3DTexture?cn=Math.floor(Wn.depth*ur):cn=1,Bn=0,bn=0,gn=0}ct!==null?(xn=ct.x,wn=ct.y,Jn=ct.z):(xn=0,wn=0,Jn=0);const Hn=yn.convert(pt.format),Zn=yn.convert(pt.type);let nr;pt.isData3DTexture?(Je.setTexture3D(pt,0),nr=it.TEXTURE_3D):pt.isDataArrayTexture||pt.isCompressedArrayTexture?(Je.setTexture2DArray(pt,0),nr=it.TEXTURE_2D_ARRAY):(Je.setTexture2D(pt,0),nr=it.TEXTURE_2D),it.pixelStorei(it.UNPACK_FLIP_Y_WEBGL,pt.flipY),it.pixelStorei(it.UNPACK_PREMULTIPLY_ALPHA_WEBGL,pt.premultiplyAlpha),it.pixelStorei(it.UNPACK_ALIGNMENT,pt.unpackAlignment);const Kn=it.getParameter(it.UNPACK_ROW_LENGTH),er=it.getParameter(it.UNPACK_IMAGE_HEIGHT),Ar=it.getParameter(it.UNPACK_SKIP_PIXELS),tr=it.getParameter(it.UNPACK_SKIP_ROWS),Qn=it.getParameter(it.UNPACK_SKIP_IMAGES);it.pixelStorei(it.UNPACK_ROW_LENGTH,Wn.width),it.pixelStorei(it.UNPACK_IMAGE_HEIGHT,Wn.height),it.pixelStorei(it.UNPACK_SKIP_PIXELS,Bn),it.pixelStorei(it.UNPACK_SKIP_ROWS,bn),it.pixelStorei(it.UNPACK_SKIP_IMAGES,gn);const On=Qe.isDataArrayTexture||Qe.isData3DTexture,br=pt.isDataArrayTexture||pt.isData3DTexture;if(Qe.isDepthTexture){const ur=Tt.get(Qe),yr=Tt.get(pt),Rr=Tt.get(ur.__renderTarget),lr=Tt.get(yr.__renderTarget);Zt.bindFramebuffer(it.READ_FRAMEBUFFER,Rr.__webglFramebuffer),Zt.bindFramebuffer(it.DRAW_FRAMEBUFFER,lr.__webglFramebuffer);for(let ii=0;ii<cn;ii++)On&&(it.framebufferTextureLayer(it.READ_FRAMEBUFFER,it.COLOR_ATTACHMENT0,Tt.get(Qe).__webglTexture,Bt,gn+ii),it.framebufferTextureLayer(it.DRAW_FRAMEBUFFER,it.COLOR_ATTACHMENT0,Tt.get(pt).__webglTexture,Xt,Jn+ii)),it.blitFramebuffer(Bn,bn,Qt,sn,xn,wn,Qt,sn,it.DEPTH_BUFFER_BIT,it.NEAREST);Zt.bindFramebuffer(it.READ_FRAMEBUFFER,null),Zt.bindFramebuffer(it.DRAW_FRAMEBUFFER,null)}else if(Bt!==0||Qe.isRenderTargetTexture||Tt.has(Qe)){const ur=Tt.get(Qe),yr=Tt.get(pt);Zt.bindFramebuffer(it.READ_FRAMEBUFFER,fn),Zt.bindFramebuffer(it.DRAW_FRAMEBUFFER,pn);for(let Rr=0;Rr<cn;Rr++)On?it.framebufferTextureLayer(it.READ_FRAMEBUFFER,it.COLOR_ATTACHMENT0,ur.__webglTexture,Bt,gn+Rr):it.framebufferTexture2D(it.READ_FRAMEBUFFER,it.COLOR_ATTACHMENT0,it.TEXTURE_2D,ur.__webglTexture,Bt),br?it.framebufferTextureLayer(it.DRAW_FRAMEBUFFER,it.COLOR_ATTACHMENT0,yr.__webglTexture,Xt,Jn+Rr):it.framebufferTexture2D(it.DRAW_FRAMEBUFFER,it.COLOR_ATTACHMENT0,it.TEXTURE_2D,yr.__webglTexture,Xt),Bt!==0?it.blitFramebuffer(Bn,bn,Qt,sn,xn,wn,Qt,sn,it.COLOR_BUFFER_BIT,it.NEAREST):br?it.copyTexSubImage3D(nr,Xt,xn,wn,Jn+Rr,Bn,bn,Qt,sn):it.copyTexSubImage2D(nr,Xt,xn,wn,Bn,bn,Qt,sn);Zt.bindFramebuffer(it.READ_FRAMEBUFFER,null),Zt.bindFramebuffer(it.DRAW_FRAMEBUFFER,null)}else br?Qe.isDataTexture||Qe.isData3DTexture?it.texSubImage3D(nr,Xt,xn,wn,Jn,Qt,sn,cn,Hn,Zn,Wn.data):pt.isCompressedArrayTexture?it.compressedTexSubImage3D(nr,Xt,xn,wn,Jn,Qt,sn,cn,Hn,Wn.data):it.texSubImage3D(nr,Xt,xn,wn,Jn,Qt,sn,cn,Hn,Zn,Wn):Qe.isDataTexture?it.texSubImage2D(it.TEXTURE_2D,Xt,xn,wn,Qt,sn,Hn,Zn,Wn.data):Qe.isCompressedTexture?it.compressedTexSubImage2D(it.TEXTURE_2D,Xt,xn,wn,Wn.width,Wn.height,Hn,Wn.data):it.texSubImage2D(it.TEXTURE_2D,Xt,xn,wn,Qt,sn,Hn,Zn,Wn);it.pixelStorei(it.UNPACK_ROW_LENGTH,Kn),it.pixelStorei(it.UNPACK_IMAGE_HEIGHT,er),it.pixelStorei(it.UNPACK_SKIP_PIXELS,Ar),it.pixelStorei(it.UNPACK_SKIP_ROWS,tr),it.pixelStorei(it.UNPACK_SKIP_IMAGES,Qn),Xt===0&&pt.generateMipmaps&&it.generateMipmap(nr),Zt.unbindTexture()},this.copyTextureToTexture3D=function(Qe,pt,At=null,ct=null,Bt=0){return Qe.isTexture!==!0&&(warnOnce("WebGLRenderer: copyTextureToTexture3D function signature has changed."),At=arguments[0]||null,ct=arguments[1]||null,Qe=arguments[2],pt=arguments[3],Bt=arguments[4]||0),warnOnce('WebGLRenderer: copyTextureToTexture3D function has been deprecated. Use "copyTextureToTexture" instead.'),this.copyTextureToTexture(Qe,pt,At,ct,Bt)},this.initRenderTarget=function(Qe){Tt.get(Qe).__webglFramebuffer===void 0&&Je.setupRenderTarget(Qe)},this.initTexture=function(Qe){Qe.isCubeTexture?Je.setTextureCube(Qe,0):Qe.isData3DTexture?Je.setTexture3D(Qe,0):Qe.isDataArrayTexture||Qe.isCompressedArrayTexture?Je.setTexture2DArray(Qe,0):Je.setTexture2D(Qe,0),Zt.unbindTexture()},this.resetState=function(){Ee=0,Ze=0,_e=null,Zt.reset(),Tn.reset()},typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}get coordinateSystem(){return WebGLCoordinateSystem}get outputColorSpace(){return this._outputColorSpace}set outputColorSpace(Z){this._outputColorSpace=Z;const _=this.getContext();_.drawingBufferColorspace=ColorManagement._getDrawingBufferColorSpace(Z),_.unpackColorSpace=ColorManagement._getUnpackColorSpace()}}const THREE=Object.freeze(Object.defineProperty({__proto__:null,ACESFilmicToneMapping,AddEquation,AddOperation,AdditiveAnimationBlendMode,AdditiveBlending,AgXToneMapping,AlphaFormat,AlwaysCompare,AlwaysDepth,AlwaysStencilFunc,AmbientLight,AnimationAction,AnimationClip,AnimationLoader,AnimationMixer,AnimationObjectGroup,AnimationUtils,ArcCurve,ArrayCamera,ArrowHelper,AttachedBindMode,Audio,AudioAnalyser,AudioContext:AudioContext$1,AudioListener,AudioLoader,AxesHelper,BackSide,BasicDepthPacking,BasicShadowMap,BatchedMesh,Bone,BooleanKeyframeTrack,Box2,Box3,Box3Helper,BoxGeometry,BoxHelper,BufferAttribute,BufferGeometry,BufferGeometryLoader,ByteType,Cache,Camera,CameraHelper,CanvasTexture,CapsuleGeometry,CatmullRomCurve3,CineonToneMapping,CircleGeometry,ClampToEdgeWrapping,Clock,Color:Color$1,ColorKeyframeTrack,ColorManagement,CompressedArrayTexture,CompressedCubeTexture,CompressedTexture,CompressedTextureLoader,ConeGeometry,ConstantAlphaFactor,ConstantColorFactor,Controls,CubeCamera,CubeReflectionMapping,CubeRefractionMapping,CubeTexture,CubeTextureLoader,CubeUVReflectionMapping,CubicBezierCurve,CubicBezierCurve3,CubicInterpolant,CullFaceBack,CullFaceFront,CullFaceFrontBack,CullFaceNone,Curve,CurvePath,CustomBlending,CustomToneMapping,CylinderGeometry,Cylindrical,Data3DTexture,DataArrayTexture,DataTexture,DataTextureLoader,DataUtils,DecrementStencilOp,DecrementWrapStencilOp,DefaultLoadingManager,DepthFormat,DepthStencilFormat,DepthTexture,DetachedBindMode,DirectionalLight,DirectionalLightHelper,DiscreteInterpolant,DodecahedronGeometry,DoubleSide,DstAlphaFactor,DstColorFactor,DynamicCopyUsage,DynamicDrawUsage,DynamicReadUsage,EdgesGeometry,EllipseCurve,EqualCompare,EqualDepth,EqualStencilFunc,EquirectangularReflectionMapping,EquirectangularRefractionMapping,Euler,EventDispatcher,ExtrudeGeometry,FileLoader,Float16BufferAttribute,Float32BufferAttribute,FloatType,Fog,FogExp2,FramebufferTexture,FrontSide,Frustum,GLBufferAttribute,GLSL1,GLSL3,GreaterCompare,GreaterDepth,GreaterEqualCompare,GreaterEqualDepth,GreaterEqualStencilFunc,GreaterStencilFunc,GridHelper,Group,HalfFloatType,HemisphereLight,HemisphereLightHelper,IcosahedronGeometry,ImageBitmapLoader,ImageLoader,ImageUtils,IncrementStencilOp,IncrementWrapStencilOp,InstancedBufferAttribute,InstancedBufferGeometry,InstancedInterleavedBuffer,InstancedMesh,Int16BufferAttribute,Int32BufferAttribute,Int8BufferAttribute,IntType,InterleavedBuffer,InterleavedBufferAttribute,Interpolant,InterpolateDiscrete,InterpolateLinear,InterpolateSmooth,InvertStencilOp,KeepStencilOp,KeyframeTrack,LOD,LatheGeometry,Layers,LessCompare,LessDepth,LessEqualCompare,LessEqualDepth,LessEqualStencilFunc,LessStencilFunc,Light,LightProbe,Line,Line3,LineBasicMaterial,LineCurve,LineCurve3,LineDashedMaterial,LineLoop,LineSegments,LinearFilter,LinearInterpolant,LinearMipMapLinearFilter,LinearMipMapNearestFilter,LinearMipmapLinearFilter,LinearMipmapNearestFilter,LinearSRGBColorSpace:LinearSRGBColorSpace$1,LinearToneMapping,LinearTransfer,Loader,LoaderUtils,LoadingManager,LoopOnce,LoopPingPong,LoopRepeat,LuminanceAlphaFormat,LuminanceFormat,MOUSE,Material,MaterialLoader,MathUtils,Matrix2,Matrix3,Matrix4,MaxEquation,Mesh,MeshBasicMaterial,MeshDepthMaterial,MeshDistanceMaterial,MeshLambertMaterial,MeshMatcapMaterial,MeshNormalMaterial,MeshPhongMaterial,MeshPhysicalMaterial,MeshStandardMaterial,MeshToonMaterial,MinEquation,MirroredRepeatWrapping,MixOperation,MultiplyBlending,MultiplyOperation,NearestFilter,NearestMipMapLinearFilter,NearestMipMapNearestFilter,NearestMipmapLinearFilter,NearestMipmapNearestFilter,NeutralToneMapping,NeverCompare,NeverDepth,NeverStencilFunc,NoBlending,NoColorSpace,NoToneMapping,NormalAnimationBlendMode,NormalBlending,NotEqualCompare,NotEqualDepth,NotEqualStencilFunc,NumberKeyframeTrack,Object3D,ObjectLoader,ObjectSpaceNormalMap,OctahedronGeometry,OneFactor,OneMinusConstantAlphaFactor,OneMinusConstantColorFactor,OneMinusDstAlphaFactor,OneMinusDstColorFactor,OneMinusSrcAlphaFactor,OneMinusSrcColorFactor,OrthographicCamera,PCFShadowMap,PCFSoftShadowMap,PMREMGenerator,Path,PerspectiveCamera,Plane,PlaneGeometry,PlaneHelper,PointLight,PointLightHelper,Points,PointsMaterial,PolarGridHelper,PolyhedronGeometry,PositionalAudio,PropertyBinding,PropertyMixer,QuadraticBezierCurve,QuadraticBezierCurve3,Quaternion:Quaternion$2,QuaternionKeyframeTrack,QuaternionLinearInterpolant,RED_GREEN_RGTC2_Format,RED_RGTC1_Format,REVISION,RGBADepthPacking,RGBAFormat,RGBAIntegerFormat,RGBA_ASTC_10x10_Format,RGBA_ASTC_10x5_Format,RGBA_ASTC_10x6_Format,RGBA_ASTC_10x8_Format,RGBA_ASTC_12x10_Format,RGBA_ASTC_12x12_Format,RGBA_ASTC_4x4_Format,RGBA_ASTC_5x4_Format,RGBA_ASTC_5x5_Format,RGBA_ASTC_6x5_Format,RGBA_ASTC_6x6_Format,RGBA_ASTC_8x5_Format,RGBA_ASTC_8x6_Format,RGBA_ASTC_8x8_Format,RGBA_BPTC_Format,RGBA_ETC2_EAC_Format,RGBA_PVRTC_2BPPV1_Format,RGBA_PVRTC_4BPPV1_Format,RGBA_S3TC_DXT1_Format,RGBA_S3TC_DXT3_Format,RGBA_S3TC_DXT5_Format,RGBDepthPacking,RGBFormat,RGBIntegerFormat,RGB_BPTC_SIGNED_Format,RGB_BPTC_UNSIGNED_Format,RGB_ETC1_Format,RGB_ETC2_Format,RGB_PVRTC_2BPPV1_Format,RGB_PVRTC_4BPPV1_Format,RGB_S3TC_DXT1_Format,RGDepthPacking,RGFormat,RGIntegerFormat,RawShaderMaterial,Ray:Ray$2,Raycaster,RectAreaLight,RedFormat,RedIntegerFormat,ReinhardToneMapping,RenderTarget,RenderTarget3D,RenderTargetArray,RepeatWrapping,ReplaceStencilOp,ReverseSubtractEquation,RingGeometry,SIGNED_RED_GREEN_RGTC2_Format,SIGNED_RED_RGTC1_Format,SRGBColorSpace:SRGBColorSpace$1,SRGBTransfer,Scene:Scene$1,ShaderChunk,ShaderLib,ShaderMaterial,ShadowMaterial,Shape:Shape$2,ShapeGeometry,ShapePath,ShapeUtils,ShortType,Skeleton,SkeletonHelper,SkinnedMesh,Source,Sphere,SphereGeometry,Spherical,SphericalHarmonics3,SplineCurve,SpotLight,SpotLightHelper,Sprite,SpriteMaterial,SrcAlphaFactor,SrcAlphaSaturateFactor,SrcColorFactor,StaticCopyUsage,StaticDrawUsage,StaticReadUsage,StereoCamera,StreamCopyUsage,StreamDrawUsage,StreamReadUsage,StringKeyframeTrack,SubtractEquation,SubtractiveBlending,TOUCH,TangentSpaceNormalMap,TetrahedronGeometry,Texture,TextureLoader,TextureUtils,TorusGeometry,TorusKnotGeometry,Triangle,TriangleFanDrawMode,TriangleStripDrawMode,TrianglesDrawMode,TubeGeometry,UVMapping,Uint16BufferAttribute,Uint32BufferAttribute,Uint8BufferAttribute,Uint8ClampedBufferAttribute,Uniform,UniformsGroup,UniformsLib,UniformsUtils,UnsignedByteType,UnsignedInt248Type,UnsignedInt5999Type,UnsignedIntType,UnsignedShort4444Type,UnsignedShort5551Type,UnsignedShortType,VSMShadowMap,Vector2,Vector3,Vector4,VectorKeyframeTrack,VideoTexture,WebGL3DRenderTarget,WebGLArrayRenderTarget,WebGLCoordinateSystem,WebGLCubeRenderTarget,WebGLRenderTarget,WebGLRenderer,WebGLUtils,WebGPUCoordinateSystem,WireframeGeometry,WrapAroundEnding,ZeroCurvatureEnding,ZeroFactor,ZeroSlopeEnding,ZeroStencilOp,createCanvasElement},Symbol.toStringTag,{value:"Module"}));var constants={exports:{}},reactReconcilerConstants_production_min={};/**
 * @license React
 * react-reconciler-constants.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var hasRequiredReactReconcilerConstants_production_min;function requireReactReconcilerConstants_production_min(){return hasRequiredReactReconcilerConstants_production_min||(hasRequiredReactReconcilerConstants_production_min=1,reactReconcilerConstants_production_min.ConcurrentRoot=1,reactReconcilerConstants_production_min.ContinuousEventPriority=4,reactReconcilerConstants_production_min.DefaultEventPriority=16,reactReconcilerConstants_production_min.DiscreteEventPriority=1,reactReconcilerConstants_production_min.IdleEventPriority=536870912,reactReconcilerConstants_production_min.LegacyRoot=0),reactReconcilerConstants_production_min}var hasRequiredConstants;function requireConstants(){return hasRequiredConstants||(hasRequiredConstants=1,constants.exports=requireReactReconcilerConstants_production_min()),constants.exports}var constantsExports=requireConstants();function createStore$2(X){let Z;const _=new Set,K=(ae,ge)=>{const ce=typeof ae=="function"?ae(Z):ae;if(ce!==Z){const de=Z;Z=ge?ce:Object.assign({},Z,ce),_.forEach(Ie=>Ie(Z,de))}},te=()=>Z,ne=(ae,ge=te,ce=Object.is)=>{console.warn("[DEPRECATED] Please use `subscribeWithSelector` middleware");let de=ge(Z);function Ie(){const fe=ge(Z);if(!ce(de,fe)){const be=de;ae(de=fe,be)}}return _.add(Ie),()=>_.delete(Ie)},se={setState:K,getState:te,subscribe:(ae,ge,ce)=>ge||ce?ne(ae,ge,ce):(_.add(ae),()=>_.delete(ae)),destroy:()=>_.clear()};return Z=X(K,te,se),se}const isSSR$2=typeof window>"u"||!window.navigator||/ServerSideRendering|^Deno\//.test(window.navigator.userAgent),useIsomorphicLayoutEffect$3=isSSR$2?reactExports.useEffect:reactExports.useLayoutEffect;function create$1(X){const Z=typeof X=="function"?createStore$2(X):X,_=(K=Z.getState,te=Object.is)=>{const[,ne]=reactExports.useReducer(Ae=>Ae+1,0),ie=Z.getState(),oe=reactExports.useRef(ie),se=reactExports.useRef(K),ae=reactExports.useRef(te),ge=reactExports.useRef(!1),ce=reactExports.useRef();ce.current===void 0&&(ce.current=K(ie));let de,Ie=!1;(oe.current!==ie||se.current!==K||ae.current!==te||ge.current)&&(de=K(ie),Ie=!te(ce.current,de)),useIsomorphicLayoutEffect$3(()=>{Ie&&(ce.current=de),oe.current=ie,se.current=K,ae.current=te,ge.current=!1});const fe=reactExports.useRef(ie);useIsomorphicLayoutEffect$3(()=>{const Ae=()=>{try{const ve=Z.getState(),Be=se.current(ve);ae.current(ce.current,Be)||(oe.current=ve,ce.current=Be,ne())}catch{ge.current=!0,ne()}},ye=Z.subscribe(Ae);return Z.getState()!==fe.current&&Ae(),ye},[]);const be=Ie?de:ce.current;return reactExports.useDebugValue(be),be};return Object.assign(_,Z),_[Symbol.iterator]=function(){console.warn("[useStore, api] = create() is deprecated and will be removed in v4");const K=[_,Z];return{next(){const te=K.length<=0;return{value:K.shift(),done:te}}}},_}const isPromise=X=>typeof X=="object"&&typeof X.then=="function",globalCache=[];function shallowEqualArrays(X,Z,_=(K,te)=>K===te){if(X===Z)return!0;if(!X||!Z)return!1;const K=X.length;if(Z.length!==K)return!1;for(let te=0;te<K;te++)if(!_(X[te],Z[te]))return!1;return!0}function query(X,Z=null,_=!1,K={}){Z===null&&(Z=[X]);for(const ne of globalCache)if(shallowEqualArrays(Z,ne.keys,ne.equal)){if(_)return;if(Object.prototype.hasOwnProperty.call(ne,"error"))throw ne.error;if(Object.prototype.hasOwnProperty.call(ne,"response"))return K.lifespan&&K.lifespan>0&&(ne.timeout&&clearTimeout(ne.timeout),ne.timeout=setTimeout(ne.remove,K.lifespan)),ne.response;if(!_)throw ne.promise}const te={keys:Z,equal:K.equal,remove:()=>{const ne=globalCache.indexOf(te);ne!==-1&&globalCache.splice(ne,1)},promise:(isPromise(X)?X:X(...Z)).then(ne=>{te.response=ne,K.lifespan&&K.lifespan>0&&(te.timeout=setTimeout(te.remove,K.lifespan))}).catch(ne=>te.error=ne)};if(globalCache.push(te),!_)throw te.promise}const suspend=(X,Z,_)=>query(X,Z,!1,_),preload=(X,Z,_)=>void query(X,Z,!0,_),clear=X=>{if(X===void 0||X.length===0)globalCache.splice(0,globalCache.length);else{const Z=globalCache.find(_=>shallowEqualArrays(X,_.keys,_.equal));Z&&Z.remove()}};var reactReconciler={exports:{}},scheduler$1={exports:{}},scheduler_production_min$1={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var hasRequiredScheduler_production_min$1;function requireScheduler_production_min$1(){return hasRequiredScheduler_production_min$1||(hasRequiredScheduler_production_min$1=1,function(X){function Z(ze,qe){var Pe=ze.length;ze.push(qe);e:for(;0<Pe;){var Ye=Pe-1>>>1,$e=ze[Ye];if(0<te($e,qe))ze[Ye]=qe,ze[Pe]=$e,Pe=Ye;else break e}}function _(ze){return ze.length===0?null:ze[0]}function K(ze){if(ze.length===0)return null;var qe=ze[0],Pe=ze.pop();if(Pe!==qe){ze[0]=Pe;e:for(var Ye=0,$e=ze.length,ut=$e>>>1;Ye<ut;){var ot=2*(Ye+1)-1,gt=ze[ot],ht=ot+1,dt=ze[ht];if(0>te(gt,Pe))ht<$e&&0>te(dt,gt)?(ze[Ye]=dt,ze[ht]=Pe,Ye=ht):(ze[Ye]=gt,ze[ot]=Pe,Ye=ot);else if(ht<$e&&0>te(dt,Pe))ze[Ye]=dt,ze[ht]=Pe,Ye=ht;else break e}}return qe}function te(ze,qe){var Pe=ze.sortIndex-qe.sortIndex;return Pe!==0?Pe:ze.id-qe.id}if(typeof performance=="object"&&typeof performance.now=="function"){var ne=performance;X.unstable_now=function(){return ne.now()}}else{var ie=Date,oe=ie.now();X.unstable_now=function(){return ie.now()-oe}}var se=[],ae=[],ge=1,ce=null,de=3,Ie=!1,fe=!1,be=!1,Ae=typeof setTimeout=="function"?setTimeout:null,ye=typeof clearTimeout=="function"?clearTimeout:null,ve=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function Be(ze){for(var qe=_(ae);qe!==null;){if(qe.callback===null)K(ae);else if(qe.startTime<=ze)K(ae),qe.sortIndex=qe.expirationTime,Z(se,qe);else break;qe=_(ae)}}function Re(ze){if(be=!1,Be(ze),!fe)if(_(se)!==null)fe=!0,tt(Ve);else{var qe=_(ae);qe!==null&&at(Re,qe.startTime-ze)}}function Ve(ze,qe){fe=!1,be&&(be=!1,ye(_e),_e=-1),Ie=!0;var Pe=de;try{for(Be(qe),ce=_(se);ce!==null&&(!(ce.expirationTime>qe)||ze&&!ke());){var Ye=ce.callback;if(typeof Ye=="function"){ce.callback=null,de=ce.priorityLevel;var $e=Ye(ce.expirationTime<=qe);qe=X.unstable_now(),typeof $e=="function"?ce.callback=$e:ce===_(se)&&K(se),Be(qe)}else K(se);ce=_(se)}if(ce!==null)var ut=!0;else{var ot=_(ae);ot!==null&&at(Re,ot.startTime-qe),ut=!1}return ut}finally{ce=null,de=Pe,Ie=!1}}var Ee=!1,Ze=null,_e=-1,Fe=5,Te=-1;function ke(){return!(X.unstable_now()-Te<Fe)}function Le(){if(Ze!==null){var ze=X.unstable_now();Te=ze;var qe=!0;try{qe=Ze(!0,ze)}finally{qe?Ke():(Ee=!1,Ze=null)}}else Ee=!1}var Ke;if(typeof ve=="function")Ke=function(){ve(Le)};else if(typeof MessageChannel<"u"){var Ue=new MessageChannel,rt=Ue.port2;Ue.port1.onmessage=Le,Ke=function(){rt.postMessage(null)}}else Ke=function(){Ae(Le,0)};function tt(ze){Ze=ze,Ee||(Ee=!0,Ke())}function at(ze,qe){_e=Ae(function(){ze(X.unstable_now())},qe)}X.unstable_IdlePriority=5,X.unstable_ImmediatePriority=1,X.unstable_LowPriority=4,X.unstable_NormalPriority=3,X.unstable_Profiling=null,X.unstable_UserBlockingPriority=2,X.unstable_cancelCallback=function(ze){ze.callback=null},X.unstable_continueExecution=function(){fe||Ie||(fe=!0,tt(Ve))},X.unstable_forceFrameRate=function(ze){0>ze||125<ze?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):Fe=0<ze?Math.floor(1e3/ze):5},X.unstable_getCurrentPriorityLevel=function(){return de},X.unstable_getFirstCallbackNode=function(){return _(se)},X.unstable_next=function(ze){switch(de){case 1:case 2:case 3:var qe=3;break;default:qe=de}var Pe=de;de=qe;try{return ze()}finally{de=Pe}},X.unstable_pauseExecution=function(){},X.unstable_requestPaint=function(){},X.unstable_runWithPriority=function(ze,qe){switch(ze){case 1:case 2:case 3:case 4:case 5:break;default:ze=3}var Pe=de;de=ze;try{return qe()}finally{de=Pe}},X.unstable_scheduleCallback=function(ze,qe,Pe){var Ye=X.unstable_now();switch(typeof Pe=="object"&&Pe!==null?(Pe=Pe.delay,Pe=typeof Pe=="number"&&0<Pe?Ye+Pe:Ye):Pe=Ye,ze){case 1:var $e=-1;break;case 2:$e=250;break;case 5:$e=1073741823;break;case 4:$e=1e4;break;default:$e=5e3}return $e=Pe+$e,ze={id:ge++,callback:qe,priorityLevel:ze,startTime:Pe,expirationTime:$e,sortIndex:-1},Pe>Ye?(ze.sortIndex=Pe,Z(ae,ze),_(se)===null&&ze===_(ae)&&(be?(ye(_e),_e=-1):be=!0,at(Re,Pe-Ye))):(ze.sortIndex=$e,Z(se,ze),fe||Ie||(fe=!0,tt(Ve))),ze},X.unstable_shouldYield=ke,X.unstable_wrapCallback=function(ze){var qe=de;return function(){var Pe=de;de=qe;try{return ze.apply(this,arguments)}finally{de=Pe}}}}(scheduler_production_min$1)),scheduler_production_min$1}var hasRequiredScheduler$1;function requireScheduler$1(){return hasRequiredScheduler$1||(hasRequiredScheduler$1=1,scheduler$1.exports=requireScheduler_production_min$1()),scheduler$1.exports}/**
 * @license React
 * react-reconciler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var reactReconciler_production_min,hasRequiredReactReconciler_production_min;function requireReactReconciler_production_min(){return hasRequiredReactReconciler_production_min||(hasRequiredReactReconciler_production_min=1,reactReconciler_production_min=function(Z){var _={},K=requireReact(),te=requireScheduler$1(),ne=Object.assign;function ie(pe){for(var he="https://reactjs.org/docs/error-decoder.html?invariant="+pe,Ge=1;Ge<arguments.length;Ge++)he+="&args[]="+encodeURIComponent(arguments[Ge]);return"Minified React error #"+pe+"; visit "+he+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var oe=K.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,se=Symbol.for("react.element"),ae=Symbol.for("react.portal"),ge=Symbol.for("react.fragment"),ce=Symbol.for("react.strict_mode"),de=Symbol.for("react.profiler"),Ie=Symbol.for("react.provider"),fe=Symbol.for("react.context"),be=Symbol.for("react.forward_ref"),Ae=Symbol.for("react.suspense"),ye=Symbol.for("react.suspense_list"),ve=Symbol.for("react.memo"),Be=Symbol.for("react.lazy"),Re=Symbol.for("react.offscreen"),Ve=Symbol.iterator;function Ee(pe){return pe===null||typeof pe!="object"?null:(pe=Ve&&pe[Ve]||pe["@@iterator"],typeof pe=="function"?pe:null)}function Ze(pe){if(pe==null)return null;if(typeof pe=="function")return pe.displayName||pe.name||null;if(typeof pe=="string")return pe;switch(pe){case ge:return"Fragment";case ae:return"Portal";case de:return"Profiler";case ce:return"StrictMode";case Ae:return"Suspense";case ye:return"SuspenseList"}if(typeof pe=="object")switch(pe.$$typeof){case fe:return(pe.displayName||"Context")+".Consumer";case Ie:return(pe._context.displayName||"Context")+".Provider";case be:var he=pe.render;return pe=pe.displayName,pe||(pe=he.displayName||he.name||"",pe=pe!==""?"ForwardRef("+pe+")":"ForwardRef"),pe;case ve:return he=pe.displayName||null,he!==null?he:Ze(pe.type)||"Memo";case Be:he=pe._payload,pe=pe._init;try{return Ze(pe(he))}catch{}}return null}function _e(pe){var he=pe.type;switch(pe.tag){case 24:return"Cache";case 9:return(he.displayName||"Context")+".Consumer";case 10:return(he._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return pe=he.render,pe=pe.displayName||pe.name||"",he.displayName||(pe!==""?"ForwardRef("+pe+")":"ForwardRef");case 7:return"Fragment";case 5:return he;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return Ze(he);case 8:return he===ce?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof he=="function")return he.displayName||he.name||null;if(typeof he=="string")return he}return null}function Fe(pe){var he=pe,Ge=pe;if(pe.alternate)for(;he.return;)he=he.return;else{pe=he;do he=pe,he.flags&4098&&(Ge=he.return),pe=he.return;while(pe)}return he.tag===3?Ge:null}function Te(pe){if(Fe(pe)!==pe)throw Error(ie(188))}function ke(pe){var he=pe.alternate;if(!he){if(he=Fe(pe),he===null)throw Error(ie(188));return he!==pe?null:pe}for(var Ge=pe,we=he;;){var He=Ge.return;if(He===null)break;var De=He.alternate;if(De===null){if(we=He.return,we!==null){Ge=we;continue}break}if(He.child===De.child){for(De=He.child;De;){if(De===Ge)return Te(He),pe;if(De===we)return Te(He),he;De=De.sibling}throw Error(ie(188))}if(Ge.return!==we.return)Ge=He,we=De;else{for(var It=!1,xt=He.child;xt;){if(xt===Ge){It=!0,Ge=He,we=De;break}if(xt===we){It=!0,we=He,Ge=De;break}xt=xt.sibling}if(!It){for(xt=De.child;xt;){if(xt===Ge){It=!0,Ge=De,we=He;break}if(xt===we){It=!0,we=De,Ge=He;break}xt=xt.sibling}if(!It)throw Error(ie(189))}}if(Ge.alternate!==we)throw Error(ie(190))}if(Ge.tag!==3)throw Error(ie(188));return Ge.stateNode.current===Ge?pe:he}function Le(pe){return pe=ke(pe),pe!==null?Ke(pe):null}function Ke(pe){if(pe.tag===5||pe.tag===6)return pe;for(pe=pe.child;pe!==null;){var he=Ke(pe);if(he!==null)return he;pe=pe.sibling}return null}function Ue(pe){if(pe.tag===5||pe.tag===6)return pe;for(pe=pe.child;pe!==null;){if(pe.tag!==4){var he=Ue(pe);if(he!==null)return he}pe=pe.sibling}return null}var rt=Array.isArray,tt=Z.getPublicInstance,at=Z.getRootHostContext,ze=Z.getChildHostContext,qe=Z.prepareForCommit,Pe=Z.resetAfterCommit,Ye=Z.createInstance,$e=Z.appendInitialChild,ut=Z.finalizeInitialChildren,ot=Z.prepareUpdate,gt=Z.shouldSetTextContent,ht=Z.createTextInstance,dt=Z.scheduleTimeout,bt=Z.cancelTimeout,Ht=Z.noTimeout,Dt=Z.isPrimaryRenderer,Vt=Z.supportsMutation,mt=Z.supportsPersistence,Ft=Z.supportsHydration,it=Z.getInstanceFromNode,Lt=Z.preparePortalMount,Et=Z.getCurrentEventPriority,Ut=Z.detachDeletedInstance,Zt=Z.supportsMicrotasks,Ot=Z.scheduleMicrotask,Tt=Z.supportsTestSelectors,Je=Z.findFiberRoot,Oe=Z.getBoundingRect,lt=Z.getTextContent,ft=Z.isHiddenSubtree,St=Z.matchAccessibilityRole,Wt=Z.setFocusIfFocusable,zt=Z.setupIntersectionObserver,$t=Z.appendChild,rn=Z.appendChildToContainer,Gn=Z.commitTextUpdate,en=Z.commitMount,In=Z.commitUpdate,un=Z.insertBefore,ln=Z.insertInContainerBefore,tn=Z.removeChild,Sn=Z.removeChildFromContainer,yn=Z.resetTextContent,Tn=Z.hideInstance,vt=Z.hideTextInstance,wt=Z.unhideInstance,Mt=Z.unhideTextInstance,on=Z.clearContainer,dn=Z.cloneInstance,an=Z.createContainerChildSet,Mn=Z.appendChildToContainerChildSet,Pn=Z.finalizeContainerChildren,Nn=Z.replaceContainerChildren,kn=Z.cloneHiddenInstance,Ir=Z.cloneHiddenTextInstance,dr=Z.canHydrateInstance,vr=Z.canHydrateTextInstance,Yr=Z.canHydrateSuspenseInstance,Fr=Z.isSuspenseInstancePending,Nr=Z.isSuspenseInstanceFallback,Kr=Z.registerSuspenseInstanceRetry,_r=Z.getNextHydratableSibling,Un=Z.getFirstHydratableChild,Lr=Z.getFirstHydratableChildWithinContainer,Bi=Z.getFirstHydratableChildWithinSuspenseInstance,je=Z.hydrateInstance,st=Z.hydrateTextInstance,yt=Z.hydrateSuspenseInstance,Yt=Z.getNextHydratableInstanceAfterSuspenseInstance,jt=Z.commitHydratedContainer,Jt=Z.commitHydratedSuspenseInstance,fn=Z.clearSuspenseBoundary,pn=Z.clearSuspenseBoundaryFromContainer,Qe=Z.shouldDeleteUnhydratedTailInstances,pt=Z.didNotMatchHydratedContainerTextInstance,At=Z.didNotMatchHydratedTextInstance,ct;function Bt(pe){if(ct===void 0)try{throw Error()}catch(Ge){var he=Ge.stack.trim().match(/\n( *(at )?)/);ct=he&&he[1]||""}return`
`+ct+pe}var Xt=!1;function Qt(pe,he){if(!pe||Xt)return"";Xt=!0;var Ge=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(he)if(he=function(){throw Error()},Object.defineProperty(he.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(he,[])}catch(mn){var we=mn}Reflect.construct(pe,[],he)}else{try{he.call()}catch(mn){we=mn}pe.call(he.prototype)}else{try{throw Error()}catch(mn){we=mn}pe()}}catch(mn){if(mn&&we&&typeof mn.stack=="string"){for(var He=mn.stack.split(`
`),De=we.stack.split(`
`),It=He.length-1,xt=De.length-1;1<=It&&0<=xt&&He[It]!==De[xt];)xt--;for(;1<=It&&0<=xt;It--,xt--)if(He[It]!==De[xt]){if(It!==1||xt!==1)do if(It--,xt--,0>xt||He[It]!==De[xt]){var nn=`
`+He[It].replace(" at new "," at ");return pe.displayName&&nn.includes("<anonymous>")&&(nn=nn.replace("<anonymous>",pe.displayName)),nn}while(1<=It&&0<=xt);break}}}finally{Xt=!1,Error.prepareStackTrace=Ge}return(pe=pe?pe.displayName||pe.name:"")?Bt(pe):""}var sn=Object.prototype.hasOwnProperty,cn=[],Bn=-1;function bn(pe){return{current:pe}}function gn(pe){0>Bn||(pe.current=cn[Bn],cn[Bn]=null,Bn--)}function xn(pe,he){Bn++,cn[Bn]=pe.current,pe.current=he}var wn={},Jn=bn(wn),Wn=bn(!1),Hn=wn;function Zn(pe,he){var Ge=pe.type.contextTypes;if(!Ge)return wn;var we=pe.stateNode;if(we&&we.__reactInternalMemoizedUnmaskedChildContext===he)return we.__reactInternalMemoizedMaskedChildContext;var He={},De;for(De in Ge)He[De]=he[De];return we&&(pe=pe.stateNode,pe.__reactInternalMemoizedUnmaskedChildContext=he,pe.__reactInternalMemoizedMaskedChildContext=He),He}function nr(pe){return pe=pe.childContextTypes,pe!=null}function Kn(){gn(Wn),gn(Jn)}function er(pe,he,Ge){if(Jn.current!==wn)throw Error(ie(168));xn(Jn,he),xn(Wn,Ge)}function Ar(pe,he,Ge){var we=pe.stateNode;if(he=he.childContextTypes,typeof we.getChildContext!="function")return Ge;we=we.getChildContext();for(var He in we)if(!(He in he))throw Error(ie(108,_e(pe)||"Unknown",He));return ne({},Ge,we)}function tr(pe){return pe=(pe=pe.stateNode)&&pe.__reactInternalMemoizedMergedChildContext||wn,Hn=Jn.current,xn(Jn,pe),xn(Wn,Wn.current),!0}function Qn(pe,he,Ge){var we=pe.stateNode;if(!we)throw Error(ie(169));Ge?(pe=Ar(pe,he,Hn),we.__reactInternalMemoizedMergedChildContext=pe,gn(Wn),gn(Jn),xn(Jn,pe)):gn(Wn),xn(Wn,Ge)}var On=Math.clz32?Math.clz32:yr,br=Math.log,ur=Math.LN2;function yr(pe){return pe>>>=0,pe===0?32:31-(br(pe)/ur|0)|0}var Rr=64,lr=4194304;function ii(pe){switch(pe&-pe){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return pe&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return pe&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return pe}}function hs(pe,he){var Ge=pe.pendingLanes;if(Ge===0)return 0;var we=0,He=pe.suspendedLanes,De=pe.pingedLanes,It=Ge&268435455;if(It!==0){var xt=It&~He;xt!==0?we=ii(xt):(De&=It,De!==0&&(we=ii(De)))}else It=Ge&~He,It!==0?we=ii(It):De!==0&&(we=ii(De));if(we===0)return 0;if(he!==0&&he!==we&&!(he&He)&&(He=we&-we,De=he&-he,He>=De||He===16&&(De&4194240)!==0))return he;if(we&4&&(we|=Ge&16),he=pe.entangledLanes,he!==0)for(pe=pe.entanglements,he&=we;0<he;)Ge=31-On(he),He=1<<Ge,we|=pe[Ge],he&=~He;return we}function aa(pe,he){switch(pe){case 1:case 2:case 4:return he+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return he+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function la(pe,he){for(var Ge=pe.suspendedLanes,we=pe.pingedLanes,He=pe.expirationTimes,De=pe.pendingLanes;0<De;){var It=31-On(De),xt=1<<It,nn=He[It];nn===-1?(!(xt&Ge)||xt&we)&&(He[It]=aa(xt,he)):nn<=he&&(pe.expiredLanes|=xt),De&=~xt}}function Zo(pe){return pe=pe.pendingLanes&-1073741825,pe!==0?pe:pe&1073741824?1073741824:0}function Fs(pe){for(var he=[],Ge=0;31>Ge;Ge++)he.push(pe);return he}function oo(pe,he,Ge){pe.pendingLanes|=he,he!==536870912&&(pe.suspendedLanes=0,pe.pingedLanes=0),pe=pe.eventTimes,he=31-On(he),pe[he]=Ge}function Ao(pe,he){var Ge=pe.pendingLanes&~he;pe.pendingLanes=he,pe.suspendedLanes=0,pe.pingedLanes=0,pe.expiredLanes&=he,pe.mutableReadLanes&=he,pe.entangledLanes&=he,he=pe.entanglements;var we=pe.eventTimes;for(pe=pe.expirationTimes;0<Ge;){var He=31-On(Ge),De=1<<He;he[He]=0,we[He]=-1,pe[He]=-1,Ge&=~De}}function hi(pe,he){var Ge=pe.entangledLanes|=he;for(pe=pe.entanglements;Ge;){var we=31-On(Ge),He=1<<we;He&he|pe[we]&he&&(pe[we]|=he),Ge&=~He}}var rr=0;function so(pe){return pe&=-pe,1<pe?4<pe?pe&268435455?16:536870912:4:1}var Ui=te.unstable_scheduleCallback,_o=te.unstable_cancelCallback,ao=te.unstable_shouldYield,Al=te.unstable_requestPaint,Wr=te.unstable_now,mo=te.unstable_ImmediatePriority,ml=te.unstable_UserBlockingPriority,Gi=te.unstable_NormalPriority,Cs=te.unstable_IdlePriority,fs=null,Pi=null;function Xo(pe){if(Pi&&typeof Pi.onCommitFiberRoot=="function")try{Pi.onCommitFiberRoot(fs,pe,void 0,(pe.current.flags&128)===128)}catch{}}function As(pe,he){return pe===he&&(pe!==0||1/pe===1/he)||pe!==pe&&he!==he}var oi=typeof Object.is=="function"?Object.is:As,si=null,Eo=!1,lo=!1;function Ws(pe){si===null?si=[pe]:si.push(pe)}function ms(pe){Eo=!0,Ws(pe)}function Si(){if(!lo&&si!==null){lo=!0;var pe=0,he=rr;try{var Ge=si;for(rr=1;pe<Ge.length;pe++){var we=Ge[pe];do we=we(!0);while(we!==null)}si=null,Eo=!1}catch(He){throw si!==null&&(si=si.slice(pe+1)),Ui(mo,Si),He}finally{rr=he,lo=!1}}return null}var bs=oe.ReactCurrentBatchConfig;function Hi(pe,he){if(oi(pe,he))return!0;if(typeof pe!="object"||pe===null||typeof he!="object"||he===null)return!1;var Ge=Object.keys(pe),we=Object.keys(he);if(Ge.length!==we.length)return!1;for(we=0;we<Ge.length;we++){var He=Ge[we];if(!sn.call(he,He)||!oi(pe[He],he[He]))return!1}return!0}function ko(pe){switch(pe.tag){case 5:return Bt(pe.type);case 16:return Bt("Lazy");case 13:return Bt("Suspense");case 19:return Bt("SuspenseList");case 0:case 2:case 15:return pe=Qt(pe.type,!1),pe;case 11:return pe=Qt(pe.type.render,!1),pe;case 1:return pe=Qt(pe.type,!0),pe;default:return""}}function ai(pe,he){if(pe&&pe.defaultProps){he=ne({},he),pe=pe.defaultProps;for(var Ge in pe)he[Ge]===void 0&&(he[Ge]=pe[Ge]);return he}return he}var ei=bn(null),Yo=null,Xi=null,Ko=null;function li(){Ko=Xi=Yo=null}function Do(pe,he,Ge){Dt?(xn(ei,he._currentValue),he._currentValue=Ge):(xn(ei,he._currentValue2),he._currentValue2=Ge)}function Jr(pe){var he=ei.current;gn(ei),Dt?pe._currentValue=he:pe._currentValue2=he}function ti(pe,he,Ge){for(;pe!==null;){var we=pe.alternate;if((pe.childLanes&he)!==he?(pe.childLanes|=he,we!==null&&(we.childLanes|=he)):we!==null&&(we.childLanes&he)!==he&&(we.childLanes|=he),pe===Ge)break;pe=pe.return}}function Pr(pe,he){Yo=pe,Ko=Xi=null,pe=pe.dependencies,pe!==null&&pe.firstContext!==null&&(pe.lanes&he&&(di=!0),pe.firstContext=null)}function Hr(pe){var he=Dt?pe._currentValue:pe._currentValue2;if(Ko!==pe)if(pe={context:pe,memoizedValue:he,next:null},Xi===null){if(Yo===null)throw Error(ie(308));Xi=pe,Yo.dependencies={lanes:0,firstContext:pe}}else Xi=Xi.next=pe;return he}var Ei=null,go=!1;function ga(pe){pe.updateQueue={baseState:pe.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function lg(pe,he){pe=pe.updateQueue,he.updateQueue===pe&&(he.updateQueue={baseState:pe.baseState,firstBaseUpdate:pe.firstBaseUpdate,lastBaseUpdate:pe.lastBaseUpdate,shared:pe.shared,effects:pe.effects})}function zo(pe,he){return{eventTime:pe,lane:he,tag:0,payload:null,callback:null,next:null}}function ys(pe,he){var Ge=pe.updateQueue;Ge!==null&&(Ge=Ge.shared,jr!==null&&pe.mode&1&&!(gr&2)?(pe=Ge.interleaved,pe===null?(he.next=he,Ei===null?Ei=[Ge]:Ei.push(Ge)):(he.next=pe.next,pe.next=he),Ge.interleaved=he):(pe=Ge.pending,pe===null?he.next=he:(he.next=pe.next,pe.next=he),Ge.pending=he))}function bl(pe,he,Ge){if(he=he.updateQueue,he!==null&&(he=he.shared,(Ge&4194240)!==0)){var we=he.lanes;we&=pe.pendingLanes,Ge|=we,he.lanes=Ge,hi(pe,Ge)}}function yl(pe,he){var Ge=pe.updateQueue,we=pe.alternate;if(we!==null&&(we=we.updateQueue,Ge===we)){var He=null,De=null;if(Ge=Ge.firstBaseUpdate,Ge!==null){do{var It={eventTime:Ge.eventTime,lane:Ge.lane,tag:Ge.tag,payload:Ge.payload,callback:Ge.callback,next:null};De===null?He=De=It:De=De.next=It,Ge=Ge.next}while(Ge!==null);De===null?He=De=he:De=De.next=he}else He=De=he;Ge={baseState:we.baseState,firstBaseUpdate:He,lastBaseUpdate:De,shared:we.shared,effects:we.effects},pe.updateQueue=Ge;return}pe=Ge.lastBaseUpdate,pe===null?Ge.firstBaseUpdate=he:pe.next=he,Ge.lastBaseUpdate=he}function vl(pe,he,Ge,we){var He=pe.updateQueue;go=!1;var De=He.firstBaseUpdate,It=He.lastBaseUpdate,xt=He.shared.pending;if(xt!==null){He.shared.pending=null;var nn=xt,mn=nn.next;nn.next=null,It===null?De=mn:It.next=mn,It=nn;var Vn=pe.alternate;Vn!==null&&(Vn=Vn.updateQueue,xt=Vn.lastBaseUpdate,xt!==It&&(xt===null?Vn.firstBaseUpdate=mn:xt.next=mn,Vn.lastBaseUpdate=nn))}if(De!==null){var or=He.baseState;It=0,Vn=mn=nn=null,xt=De;do{var jn=xt.lane,cr=xt.eventTime;if((we&jn)===jn){Vn!==null&&(Vn=Vn.next={eventTime:cr,lane:0,tag:xt.tag,payload:xt.payload,callback:xt.callback,next:null});e:{var En=pe,yi=xt;switch(jn=he,cr=Ge,yi.tag){case 1:if(En=yi.payload,typeof En=="function"){or=En.call(cr,or,jn);break e}or=En;break e;case 3:En.flags=En.flags&-65537|128;case 0:if(En=yi.payload,jn=typeof En=="function"?En.call(cr,or,jn):En,jn==null)break e;or=ne({},or,jn);break e;case 2:go=!0}}xt.callback!==null&&xt.lane!==0&&(pe.flags|=64,jn=He.effects,jn===null?He.effects=[xt]:jn.push(xt))}else cr={eventTime:cr,lane:jn,tag:xt.tag,payload:xt.payload,callback:xt.callback,next:null},Vn===null?(mn=Vn=cr,nn=or):Vn=Vn.next=cr,It|=jn;if(xt=xt.next,xt===null){if(xt=He.shared.pending,xt===null)break;jn=xt,xt=jn.next,jn.next=null,He.lastBaseUpdate=jn,He.shared.pending=null}}while(!0);if(Vn===null&&(nn=or),He.baseState=nn,He.firstBaseUpdate=mn,He.lastBaseUpdate=Vn,he=He.shared.interleaved,he!==null){He=he;do It|=He.lane,He=He.next;while(He!==he)}else De===null&&(He.shared.lanes=0);Vo|=It,pe.lanes=It,pe.memoizedState=or}}function qg(pe,he,Ge){if(pe=he.effects,he.effects=null,pe!==null)for(he=0;he<pe.length;he++){var we=pe[he],He=we.callback;if(He!==null){if(we.callback=null,we=Ge,typeof He!="function")throw Error(ie(191,He));He.call(we)}}}var ec=new K.Component().refs;function gg(pe,he,Ge,we){he=pe.memoizedState,Ge=Ge(we,he),Ge=Ge==null?he:ne({},he,Ge),pe.memoizedState=Ge,pe.lanes===0&&(pe.updateQueue.baseState=Ge)}var Bl={isMounted:function(pe){return(pe=pe._reactInternals)?Fe(pe)===pe:!1},enqueueSetState:function(pe,he,Ge){pe=pe._reactInternals;var we=Cr(),He=Ro(pe),De=zo(we,He);De.payload=he,Ge!=null&&(De.callback=Ge),ys(pe,De),he=xi(pe,He,we),he!==null&&bl(he,pe,He)},enqueueReplaceState:function(pe,he,Ge){pe=pe._reactInternals;var we=Cr(),He=Ro(pe),De=zo(we,He);De.tag=1,De.payload=he,Ge!=null&&(De.callback=Ge),ys(pe,De),he=xi(pe,He,we),he!==null&&bl(he,pe,He)},enqueueForceUpdate:function(pe,he){pe=pe._reactInternals;var Ge=Cr(),we=Ro(pe),He=zo(Ge,we);He.tag=2,he!=null&&(He.callback=he),ys(pe,He),he=xi(pe,we,Ge),he!==null&&bl(he,pe,we)}};function cg(pe,he,Ge,we,He,De,It){return pe=pe.stateNode,typeof pe.shouldComponentUpdate=="function"?pe.shouldComponentUpdate(we,De,It):he.prototype&&he.prototype.isPureReactComponent?!Hi(Ge,we)||!Hi(He,De):!0}function tc(pe,he,Ge){var we=!1,He=wn,De=he.contextType;return typeof De=="object"&&De!==null?De=Hr(De):(He=nr(he)?Hn:Jn.current,we=he.contextTypes,De=(we=we!=null)?Zn(pe,He):wn),he=new he(Ge,De),pe.memoizedState=he.state!==null&&he.state!==void 0?he.state:null,he.updater=Bl,pe.stateNode=he,he._reactInternals=pe,we&&(pe=pe.stateNode,pe.__reactInternalMemoizedUnmaskedChildContext=He,pe.__reactInternalMemoizedMaskedChildContext=De),he}function nc(pe,he,Ge,we){pe=he.state,typeof he.componentWillReceiveProps=="function"&&he.componentWillReceiveProps(Ge,we),typeof he.UNSAFE_componentWillReceiveProps=="function"&&he.UNSAFE_componentWillReceiveProps(Ge,we),he.state!==pe&&Bl.enqueueReplaceState(he,he.state,null)}function ug(pe,he,Ge,we){var He=pe.stateNode;He.props=Ge,He.state=pe.memoizedState,He.refs=ec,ga(pe);var De=he.contextType;typeof De=="object"&&De!==null?He.context=Hr(De):(De=nr(he)?Hn:Jn.current,He.context=Zn(pe,De)),He.state=pe.memoizedState,De=he.getDerivedStateFromProps,typeof De=="function"&&(gg(pe,he,De,Ge),He.state=pe.memoizedState),typeof he.getDerivedStateFromProps=="function"||typeof He.getSnapshotBeforeUpdate=="function"||typeof He.UNSAFE_componentWillMount!="function"&&typeof He.componentWillMount!="function"||(he=He.state,typeof He.componentWillMount=="function"&&He.componentWillMount(),typeof He.UNSAFE_componentWillMount=="function"&&He.UNSAFE_componentWillMount(),he!==He.state&&Bl.enqueueReplaceState(He,He.state,null),vl(pe,Ge,He,we),He.state=pe.memoizedState),typeof He.componentDidMount=="function"&&(pe.flags|=4194308)}var ca=[],vs=0,Gl=null,Sl=0,co=[],Oi=0,Vs=null,Uo=1,Po="";function Ts(pe,he){ca[vs++]=Sl,ca[vs++]=Gl,Gl=pe,Sl=he}function rc(pe,he,Ge){co[Oi++]=Uo,co[Oi++]=Po,co[Oi++]=Vs,Vs=pe;var we=Uo;pe=Po;var He=32-On(we)-1;we&=~(1<<He),Ge+=1;var De=32-On(he)+He;if(30<De){var It=He-He%5;De=(we&(1<<It)-1).toString(32),we>>=It,He-=It,Uo=1<<32-On(he)+He|Ge<<He|we,Po=De+pe}else Uo=1<<De|Ge<<He|we,Po=pe}function dg(pe){pe.return!==null&&(Ts(pe,1),rc(pe,1,0))}function pg(pe){for(;pe===Gl;)Gl=ca[--vs],ca[vs]=null,Sl=ca[--vs],ca[vs]=null;for(;pe===Vs;)Vs=co[--Oi],co[Oi]=null,Po=co[--Oi],co[Oi]=null,Uo=co[--Oi],co[Oi]=null}var Mi=null,Ci=null,Vr=!1,ua=!1,uo=null;function Ig(pe,he){var Ge=no(5,null,null,0);Ge.elementType="DELETED",Ge.stateNode=he,Ge.return=pe,he=pe.deletions,he===null?(pe.deletions=[Ge],pe.flags|=16):he.push(Ge)}function hg(pe,he){switch(pe.tag){case 5:return he=dr(he,pe.type,pe.pendingProps),he!==null?(pe.stateNode=he,Mi=pe,Ci=Un(he),!0):!1;case 6:return he=vr(he,pe.pendingProps),he!==null?(pe.stateNode=he,Mi=pe,Ci=null,!0):!1;case 13:if(he=Yr(he),he!==null){var Ge=Vs!==null?{id:Uo,overflow:Po}:null;return pe.memoizedState={dehydrated:he,treeContext:Ge,retryLane:1073741824},Ge=no(18,null,null,0),Ge.stateNode=he,Ge.return=pe,pe.child=Ge,Mi=pe,Ci=null,!0}return!1;default:return!1}}function Rl(pe){return(pe.mode&1)!==0&&(pe.flags&128)===0}function Bs(pe){if(Vr){var he=Ci;if(he){var Ge=he;if(!hg(pe,he)){if(Rl(pe))throw Error(ie(418));he=_r(Ge);var we=Mi;he&&hg(pe,he)?Ig(we,Ge):(pe.flags=pe.flags&-4097|2,Vr=!1,Mi=pe)}}else{if(Rl(pe))throw Error(ie(418));pe.flags=pe.flags&-4097|2,Vr=!1,Mi=pe}}}function ic(pe){for(pe=pe.return;pe!==null&&pe.tag!==5&&pe.tag!==3&&pe.tag!==13;)pe=pe.return;Mi=pe}function La(pe){if(!Ft||pe!==Mi)return!1;if(!Vr)return ic(pe),Vr=!0,!1;if(pe.tag!==3&&(pe.tag!==5||Qe(pe.type)&&!gt(pe.type,pe.memoizedProps))){var he=Ci;if(he){if(Rl(pe)){for(pe=Ci;pe;)pe=_r(pe);throw Error(ie(418))}for(;he;)Ig(pe,he),he=_r(he)}}if(ic(pe),pe.tag===13){if(!Ft)throw Error(ie(316));if(pe=pe.memoizedState,pe=pe!==null?pe.dehydrated:null,!pe)throw Error(ie(317));Ci=Yt(pe)}else Ci=Mi?_r(pe.stateNode):null;return!0}function da(){Ft&&(Ci=Mi=null,ua=Vr=!1)}function wl(pe){uo===null?uo=[pe]:uo.push(pe)}function pa(pe,he,Ge){if(pe=Ge.ref,pe!==null&&typeof pe!="function"&&typeof pe!="object"){if(Ge._owner){if(Ge=Ge._owner,Ge){if(Ge.tag!==1)throw Error(ie(309));var we=Ge.stateNode}if(!we)throw Error(ie(147,pe));var He=we,De=""+pe;return he!==null&&he.ref!==null&&typeof he.ref=="function"&&he.ref._stringRef===De?he.ref:(he=function(It){var xt=He.refs;xt===ec&&(xt=He.refs={}),It===null?delete xt[De]:xt[De]=It},he._stringRef=De,he)}if(typeof pe!="string")throw Error(ie(284));if(!Ge._owner)throw Error(ie(290,pe))}return pe}function Gs(pe,he){throw pe=Object.prototype.toString.call(he),Error(ie(31,pe==="[object Object]"?"object with keys {"+Object.keys(he).join(", ")+"}":pe))}function Ia(pe){var he=pe._init;return he(pe._payload)}function oc(pe){function he(Kt,_t){if(pe){var qt=Kt.deletions;qt===null?(Kt.deletions=[_t],Kt.flags|=16):qt.push(_t)}}function Ge(Kt,_t){if(!pe)return null;for(;_t!==null;)he(Kt,_t),_t=_t.sibling;return null}function we(Kt,_t){for(Kt=new Map;_t!==null;)_t.key!==null?Kt.set(_t.key,_t):Kt.set(_t.index,_t),_t=_t.sibling;return Kt}function He(Kt,_t){return Kt=cs(Kt,_t),Kt.index=0,Kt.sibling=null,Kt}function De(Kt,_t,qt){return Kt.index=qt,pe?(qt=Kt.alternate,qt!==null?(qt=qt.index,qt<_t?(Kt.flags|=2,_t):qt):(Kt.flags|=2,_t)):(Kt.flags|=1048576,_t)}function It(Kt){return pe&&Kt.alternate===null&&(Kt.flags|=2),Kt}function xt(Kt,_t,qt,_n){return _t===null||_t.tag!==6?(_t=eg(qt,Kt.mode,_n),_t.return=Kt,_t):(_t=He(_t,qt),_t.return=Kt,_t)}function nn(Kt,_t,qt,_n){var Dn=qt.type;return Dn===ge?Vn(Kt,_t,qt.props.children,_n,qt.key):_t!==null&&(_t.elementType===Dn||typeof Dn=="object"&&Dn!==null&&Dn.$$typeof===Be&&Ia(Dn)===_t.type)?(_n=He(_t,qt.props),_n.ref=pa(Kt,_t,qt),_n.return=Kt,_n):(_n=ql(qt.type,qt.key,qt.props,null,Kt.mode,_n),_n.ref=pa(Kt,_t,qt),_n.return=Kt,_n)}function mn(Kt,_t,qt,_n){return _t===null||_t.tag!==4||_t.stateNode.containerInfo!==qt.containerInfo||_t.stateNode.implementation!==qt.implementation?(_t=tg(qt,Kt.mode,_n),_t.return=Kt,_t):(_t=He(_t,qt.children||[]),_t.return=Kt,_t)}function Vn(Kt,_t,qt,_n,Dn){return _t===null||_t.tag!==7?(_t=ia(qt,Kt.mode,_n,Dn),_t.return=Kt,_t):(_t=He(_t,qt),_t.return=Kt,_t)}function or(Kt,_t,qt){if(typeof _t=="string"&&_t!==""||typeof _t=="number")return _t=eg(""+_t,Kt.mode,qt),_t.return=Kt,_t;if(typeof _t=="object"&&_t!==null){switch(_t.$$typeof){case se:return qt=ql(_t.type,_t.key,_t.props,null,Kt.mode,qt),qt.ref=pa(Kt,null,_t),qt.return=Kt,qt;case ae:return _t=tg(_t,Kt.mode,qt),_t.return=Kt,_t;case Be:var _n=_t._init;return or(Kt,_n(_t._payload),qt)}if(rt(_t)||Ee(_t))return _t=ia(_t,Kt.mode,qt,null),_t.return=Kt,_t;Gs(Kt,_t)}return null}function jn(Kt,_t,qt,_n){var Dn=_t!==null?_t.key:null;if(typeof qt=="string"&&qt!==""||typeof qt=="number")return Dn!==null?null:xt(Kt,_t,""+qt,_n);if(typeof qt=="object"&&qt!==null){switch(qt.$$typeof){case se:return qt.key===Dn?nn(Kt,_t,qt,_n):null;case ae:return qt.key===Dn?mn(Kt,_t,qt,_n):null;case Be:return Dn=qt._init,jn(Kt,_t,Dn(qt._payload),_n)}if(rt(qt)||Ee(qt))return Dn!==null?null:Vn(Kt,_t,qt,_n,null);Gs(Kt,qt)}return null}function cr(Kt,_t,qt,_n,Dn){if(typeof _n=="string"&&_n!==""||typeof _n=="number")return Kt=Kt.get(qt)||null,xt(_t,Kt,""+_n,Dn);if(typeof _n=="object"&&_n!==null){switch(_n.$$typeof){case se:return Kt=Kt.get(_n.key===null?qt:_n.key)||null,nn(_t,Kt,_n,Dn);case ae:return Kt=Kt.get(_n.key===null?qt:_n.key)||null,mn(_t,Kt,_n,Dn);case Be:var ar=_n._init;return cr(Kt,_t,qt,ar(_n._payload),Dn)}if(rt(_n)||Ee(_n))return Kt=Kt.get(qt)||null,Vn(_t,Kt,_n,Dn,null);Gs(_t,_n)}return null}function En(Kt,_t,qt,_n){for(var Dn=null,ar=null,sr=_t,hr=_t=0,$r=null;sr!==null&&hr<qt.length;hr++){sr.index>hr?($r=sr,sr=null):$r=sr.sibling;var pr=jn(Kt,sr,qt[hr],_n);if(pr===null){sr===null&&(sr=$r);break}pe&&sr&&pr.alternate===null&&he(Kt,sr),_t=De(pr,_t,hr),ar===null?Dn=pr:ar.sibling=pr,ar=pr,sr=$r}if(hr===qt.length)return Ge(Kt,sr),Vr&&Ts(Kt,hr),Dn;if(sr===null){for(;hr<qt.length;hr++)sr=or(Kt,qt[hr],_n),sr!==null&&(_t=De(sr,_t,hr),ar===null?Dn=sr:ar.sibling=sr,ar=sr);return Vr&&Ts(Kt,hr),Dn}for(sr=we(Kt,sr);hr<qt.length;hr++)$r=cr(sr,Kt,hr,qt[hr],_n),$r!==null&&(pe&&$r.alternate!==null&&sr.delete($r.key===null?hr:$r.key),_t=De($r,_t,hr),ar===null?Dn=$r:ar.sibling=$r,ar=$r);return pe&&sr.forEach(function(us){return he(Kt,us)}),Vr&&Ts(Kt,hr),Dn}function yi(Kt,_t,qt,_n){var Dn=Ee(qt);if(typeof Dn!="function")throw Error(ie(150));if(qt=Dn.call(qt),qt==null)throw Error(ie(151));for(var ar=Dn=null,sr=_t,hr=_t=0,$r=null,pr=qt.next();sr!==null&&!pr.done;hr++,pr=qt.next()){sr.index>hr?($r=sr,sr=null):$r=sr.sibling;var us=jn(Kt,sr,pr.value,_n);if(us===null){sr===null&&(sr=$r);break}pe&&sr&&us.alternate===null&&he(Kt,sr),_t=De(us,_t,hr),ar===null?Dn=us:ar.sibling=us,ar=us,sr=$r}if(pr.done)return Ge(Kt,sr),Vr&&Ts(Kt,hr),Dn;if(sr===null){for(;!pr.done;hr++,pr=qt.next())pr=or(Kt,pr.value,_n),pr!==null&&(_t=De(pr,_t,hr),ar===null?Dn=pr:ar.sibling=pr,ar=pr);return Vr&&Ts(Kt,hr),Dn}for(sr=we(Kt,sr);!pr.done;hr++,pr=qt.next())pr=cr(sr,Kt,hr,pr.value,_n),pr!==null&&(pe&&pr.alternate!==null&&sr.delete(pr.key===null?hr:pr.key),_t=De(pr,_t,hr),ar===null?Dn=pr:ar.sibling=pr,ar=pr);return pe&&sr.forEach(function(Ug){return he(Kt,Ug)}),Vr&&Ts(Kt,hr),Dn}function ro(Kt,_t,qt,_n){if(typeof qt=="object"&&qt!==null&&qt.type===ge&&qt.key===null&&(qt=qt.props.children),typeof qt=="object"&&qt!==null){switch(qt.$$typeof){case se:e:{for(var Dn=qt.key,ar=_t;ar!==null;){if(ar.key===Dn){if(Dn=qt.type,Dn===ge){if(ar.tag===7){Ge(Kt,ar.sibling),_t=He(ar,qt.props.children),_t.return=Kt,Kt=_t;break e}}else if(ar.elementType===Dn||typeof Dn=="object"&&Dn!==null&&Dn.$$typeof===Be&&Ia(Dn)===ar.type){Ge(Kt,ar.sibling),_t=He(ar,qt.props),_t.ref=pa(Kt,ar,qt),_t.return=Kt,Kt=_t;break e}Ge(Kt,ar);break}else he(Kt,ar);ar=ar.sibling}qt.type===ge?(_t=ia(qt.props.children,Kt.mode,_n,qt.key),_t.return=Kt,Kt=_t):(_n=ql(qt.type,qt.key,qt.props,null,Kt.mode,_n),_n.ref=pa(Kt,_t,qt),_n.return=Kt,Kt=_n)}return It(Kt);case ae:e:{for(ar=qt.key;_t!==null;){if(_t.key===ar)if(_t.tag===4&&_t.stateNode.containerInfo===qt.containerInfo&&_t.stateNode.implementation===qt.implementation){Ge(Kt,_t.sibling),_t=He(_t,qt.children||[]),_t.return=Kt,Kt=_t;break e}else{Ge(Kt,_t);break}else he(Kt,_t);_t=_t.sibling}_t=tg(qt,Kt.mode,_n),_t.return=Kt,Kt=_t}return It(Kt);case Be:return ar=qt._init,ro(Kt,_t,ar(qt._payload),_n)}if(rt(qt))return En(Kt,_t,qt,_n);if(Ee(qt))return yi(Kt,_t,qt,_n);Gs(Kt,qt)}return typeof qt=="string"&&qt!==""||typeof qt=="number"?(qt=""+qt,_t!==null&&_t.tag===6?(Ge(Kt,_t.sibling),_t=He(_t,qt),_t.return=Kt,Kt=_t):(Ge(Kt,_t),_t=eg(qt,Kt.mode,_n),_t.return=Kt,Kt=_t),It(Kt)):Ge(Kt,_t)}return ro}var Oo=oc(!0),sc=oc(!1),ha={},ki=bn(ha),Ns=bn(ha),Ls=bn(ha);function bo(pe){if(pe===ha)throw Error(ie(174));return pe}function xl(pe,he){xn(Ls,he),xn(Ns,pe),xn(ki,ha),pe=at(he),gn(ki),xn(ki,pe)}function Ca(){gn(ki),gn(Ns),gn(Ls)}function ac(pe){var he=bo(Ls.current),Ge=bo(ki.current);he=ze(Ge,pe.type,he),Ge!==he&&(xn(Ns,pe),xn(ki,he))}function Cg(pe){Ns.current===pe&&(gn(ki),gn(Ns))}var Xr=bn(0);function Zl(pe){for(var he=pe;he!==null;){if(he.tag===13){var Ge=he.memoizedState;if(Ge!==null&&(Ge=Ge.dehydrated,Ge===null||Fr(Ge)||Nr(Ge)))return he}else if(he.tag===19&&he.memoizedProps.revealOrder!==void 0){if(he.flags&128)return he}else if(he.child!==null){he.child.return=he,he=he.child;continue}if(he===pe)break;for(;he.sibling===null;){if(he.return===null||he.return===pe)return null;he=he.return}he.sibling.return=he.return,he=he.sibling}return null}var ji=[];function Hs(){for(var pe=0;pe<ji.length;pe++){var he=ji[pe];Dt?he._workInProgressVersionPrimary=null:he._workInProgressVersionSecondary=null}ji.length=0}var Ha=oe.ReactCurrentDispatcher,Ji=oe.ReactCurrentBatchConfig,Xs=0,kr=null,gi=null,ci=null,_l=!1,Mo=!1,ks=0,Xa=0;function ui(){throw Error(ie(321))}function El(pe,he){if(he===null)return!1;for(var Ge=0;Ge<he.length&&Ge<pe.length;Ge++)if(!oi(pe[Ge],he[Ge]))return!1;return!0}function fa(pe,he,Ge,we,He,De){if(Xs=De,kr=he,he.memoizedState=null,he.updateQueue=null,he.lanes=0,Ha.current=pe===null||pe.memoizedState===null?vg:Bg,pe=Ge(we,He),Mo){De=0;do{if(Mo=!1,ks=0,25<=De)throw Error(ie(301));De+=1,ci=gi=null,he.updateQueue=null,Ha.current=Gg,pe=Ge(we,He)}while(Mo)}if(Ha.current=ya,he=gi!==null&&gi.next!==null,Xs=0,ci=gi=kr=null,_l=!1,he)throw Error(ie(300));return pe}function Ss(){var pe=ks!==0;return ks=0,pe}function yo(){var pe={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return ci===null?kr.memoizedState=ci=pe:ci=ci.next=pe,ci}function vo(){if(gi===null){var pe=kr.alternate;pe=pe!==null?pe.memoizedState:null}else pe=gi.next;var he=ci===null?kr.memoizedState:ci.next;if(he!==null)ci=he,gi=pe;else{if(pe===null)throw Error(ie(310));gi=pe,pe={memoizedState:gi.memoizedState,baseState:gi.baseState,baseQueue:gi.baseQueue,queue:gi.queue,next:null},ci===null?kr.memoizedState=ci=pe:ci=ci.next=pe}return ci}function Fo(pe,he){return typeof he=="function"?he(pe):he}function ka(pe){var he=vo(),Ge=he.queue;if(Ge===null)throw Error(ie(311));Ge.lastRenderedReducer=pe;var we=gi,He=we.baseQueue,De=Ge.pending;if(De!==null){if(He!==null){var It=He.next;He.next=De.next,De.next=It}we.baseQueue=He=De,Ge.pending=null}if(He!==null){De=He.next,we=we.baseState;var xt=It=null,nn=null,mn=De;do{var Vn=mn.lane;if((Xs&Vn)===Vn)nn!==null&&(nn=nn.next={lane:0,action:mn.action,hasEagerState:mn.hasEagerState,eagerState:mn.eagerState,next:null}),we=mn.hasEagerState?mn.eagerState:pe(we,mn.action);else{var or={lane:Vn,action:mn.action,hasEagerState:mn.hasEagerState,eagerState:mn.eagerState,next:null};nn===null?(xt=nn=or,It=we):nn=nn.next=or,kr.lanes|=Vn,Vo|=Vn}mn=mn.next}while(mn!==null&&mn!==De);nn===null?It=we:nn.next=xt,oi(we,he.memoizedState)||(di=!0),he.memoizedState=we,he.baseState=It,he.baseQueue=nn,Ge.lastRenderedState=we}if(pe=Ge.interleaved,pe!==null){He=pe;do De=He.lane,kr.lanes|=De,Vo|=De,He=He.next;while(He!==pe)}else He===null&&(Ge.lanes=0);return[he.memoizedState,Ge.dispatch]}function Ya(pe){var he=vo(),Ge=he.queue;if(Ge===null)throw Error(ie(311));Ge.lastRenderedReducer=pe;var we=Ge.dispatch,He=Ge.pending,De=he.memoizedState;if(He!==null){Ge.pending=null;var It=He=He.next;do De=pe(De,It.action),It=It.next;while(It!==He);oi(De,he.memoizedState)||(di=!0),he.memoizedState=De,he.baseQueue===null&&(he.baseState=De),Ge.lastRenderedState=De}return[De,we]}function fg(){}function Ag(pe,he){var Ge=kr,we=vo(),He=he(),De=!oi(we.memoizedState,He);if(De&&(we.memoizedState=He,di=!0),we=we.queue,Aa(jo.bind(null,Ge,we,pe),[pe]),we.getSnapshot!==he||De||ci!==null&&ci.memoizedState.tag&1){if(Ge.flags|=2048,Da(9,bg.bind(null,Ge,we,He,he),void 0,null),jr===null)throw Error(ie(349));Xs&30||mg(Ge,he,He)}return He}function mg(pe,he,Ge){pe.flags|=16384,pe={getSnapshot:he,value:Ge},he=kr.updateQueue,he===null?(he={lastEffect:null,stores:null},kr.updateQueue=he,he.stores=[pe]):(Ge=he.stores,Ge===null?he.stores=[pe]:Ge.push(pe))}function bg(pe,he,Ge,we){he.value=Ge,he.getSnapshot=we,Ml(he)&&xi(pe,1,-1)}function jo(pe,he,Ge){return Ge(function(){Ml(he)&&xi(pe,1,-1)})}function Ml(pe){var he=pe.getSnapshot;pe=pe.value;try{var Ge=he();return!oi(pe,Ge)}catch{return!0}}function Ka(pe){var he=yo();return typeof pe=="function"&&(pe=pe()),he.memoizedState=he.baseState=pe,pe={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Fo,lastRenderedState:pe},he.queue=pe,pe=pe.dispatch=Kc.bind(null,kr,pe),[he.memoizedState,pe]}function Da(pe,he,Ge,we){return pe={tag:pe,create:he,destroy:Ge,deps:we,next:null},he=kr.updateQueue,he===null?(he={lastEffect:null,stores:null},kr.updateQueue=he,he.lastEffect=pe.next=pe):(Ge=he.lastEffect,Ge===null?he.lastEffect=pe.next=pe:(we=Ge.next,Ge.next=pe,pe.next=we,he.lastEffect=pe)),pe}function lc(){return vo().memoizedState}function Rs(pe,he,Ge,we){var He=yo();kr.flags|=pe,He.memoizedState=Da(1|he,Ge,void 0,we===void 0?null:we)}function Fl(pe,he,Ge,we){var He=vo();we=we===void 0?null:we;var De=void 0;if(gi!==null){var It=gi.memoizedState;if(De=It.destroy,we!==null&&El(we,It.deps)){He.memoizedState=Da(he,Ge,De,we);return}}kr.flags|=pe,He.memoizedState=Da(1|he,Ge,De,we)}function Wl(pe,he){return Rs(8390656,8,pe,he)}function Aa(pe,he){return Fl(2048,8,pe,he)}function wr(pe,he){return Fl(4,2,pe,he)}function Vl(pe,he){return Fl(4,4,pe,he)}function za(pe,he){if(typeof he=="function")return pe=pe(),he(pe),function(){he(null)};if(he!=null)return pe=pe(),he.current=pe,function(){he.current=null}}function ma(pe,he,Ge){return Ge=Ge!=null?Ge.concat([pe]):null,Fl(4,4,za.bind(null,he,pe),Ge)}function Tl(){}function Nl(pe,he){var Ge=vo();he=he===void 0?null:he;var we=Ge.memoizedState;return we!==null&&he!==null&&El(he,we[1])?we[0]:(Ge.memoizedState=[pe,he],pe)}function ba(pe,he){var Ge=vo();he=he===void 0?null:he;var we=Ge.memoizedState;return we!==null&&he!==null&&El(he,we[1])?we[0]:(pe=pe(),Ge.memoizedState=[pe,he],pe)}function Ll(pe,he){var Ge=rr;rr=Ge!==0&&4>Ge?Ge:4,pe(!0);var we=Ji.transition;Ji.transition={};try{pe(!1),he()}finally{rr=Ge,Ji.transition=we}}function Ys(){return vo().memoizedState}function gc(pe,he,Ge){var we=Ro(pe);Ge={lane:we,action:Ge,hasEagerState:!1,eagerState:null,next:null},cc(pe)?yg(he,Ge):(Ua(pe,he,Ge),Ge=Cr(),pe=xi(pe,we,Ge),pe!==null&&Pa(pe,he,we))}function Kc(pe,he,Ge){var we=Ro(pe),He={lane:we,action:Ge,hasEagerState:!1,eagerState:null,next:null};if(cc(pe))yg(he,He);else{Ua(pe,he,He);var De=pe.alternate;if(pe.lanes===0&&(De===null||De.lanes===0)&&(De=he.lastRenderedReducer,De!==null))try{var It=he.lastRenderedState,xt=De(It,Ge);if(He.hasEagerState=!0,He.eagerState=xt,oi(xt,It))return}catch{}finally{}Ge=Cr(),pe=xi(pe,we,Ge),pe!==null&&Pa(pe,he,we)}}function cc(pe){var he=pe.alternate;return pe===kr||he!==null&&he===kr}function yg(pe,he){Mo=_l=!0;var Ge=pe.pending;Ge===null?he.next=he:(he.next=Ge.next,Ge.next=he),pe.pending=he}function Ua(pe,he,Ge){jr!==null&&pe.mode&1&&!(gr&2)?(pe=he.interleaved,pe===null?(Ge.next=Ge,Ei===null?Ei=[he]:Ei.push(he)):(Ge.next=pe.next,pe.next=Ge),he.interleaved=Ge):(pe=he.pending,pe===null?Ge.next=Ge:(Ge.next=pe.next,pe.next=Ge),he.pending=Ge)}function Pa(pe,he,Ge){if(Ge&4194240){var we=he.lanes;we&=pe.pendingLanes,Ge|=we,he.lanes=Ge,hi(pe,Ge)}}var ya={readContext:Hr,useCallback:ui,useContext:ui,useEffect:ui,useImperativeHandle:ui,useInsertionEffect:ui,useLayoutEffect:ui,useMemo:ui,useReducer:ui,useRef:ui,useState:ui,useDebugValue:ui,useDeferredValue:ui,useTransition:ui,useMutableSource:ui,useSyncExternalStore:ui,useId:ui,unstable_isNewReconciler:!1},vg={readContext:Hr,useCallback:function(pe,he){return yo().memoizedState=[pe,he===void 0?null:he],pe},useContext:Hr,useEffect:Wl,useImperativeHandle:function(pe,he,Ge){return Ge=Ge!=null?Ge.concat([pe]):null,Rs(4194308,4,za.bind(null,he,pe),Ge)},useLayoutEffect:function(pe,he){return Rs(4194308,4,pe,he)},useInsertionEffect:function(pe,he){return Rs(4,2,pe,he)},useMemo:function(pe,he){var Ge=yo();return he=he===void 0?null:he,pe=pe(),Ge.memoizedState=[pe,he],pe},useReducer:function(pe,he,Ge){var we=yo();return he=Ge!==void 0?Ge(he):he,we.memoizedState=we.baseState=he,pe={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:pe,lastRenderedState:he},we.queue=pe,pe=pe.dispatch=gc.bind(null,kr,pe),[we.memoizedState,pe]},useRef:function(pe){var he=yo();return pe={current:pe},he.memoizedState=pe},useState:Ka,useDebugValue:Tl,useDeferredValue:function(pe){var he=Ka(pe),Ge=he[0],we=he[1];return Wl(function(){var He=Ji.transition;Ji.transition={};try{we(pe)}finally{Ji.transition=He}},[pe]),Ge},useTransition:function(){var pe=Ka(!1),he=pe[0];return pe=Ll.bind(null,pe[1]),yo().memoizedState=pe,[he,pe]},useMutableSource:function(){},useSyncExternalStore:function(pe,he,Ge){var we=kr,He=yo();if(Vr){if(Ge===void 0)throw Error(ie(407));Ge=Ge()}else{if(Ge=he(),jr===null)throw Error(ie(349));Xs&30||mg(we,he,Ge)}He.memoizedState=Ge;var De={value:Ge,getSnapshot:he};return He.queue=De,Wl(jo.bind(null,we,De,pe),[pe]),we.flags|=2048,Da(9,bg.bind(null,we,De,Ge,he),void 0,null),Ge},useId:function(){var pe=yo(),he=jr.identifierPrefix;if(Vr){var Ge=Po,we=Uo;Ge=(we&~(1<<32-On(we)-1)).toString(32)+Ge,he=":"+he+"R"+Ge,Ge=ks++,0<Ge&&(he+="H"+Ge.toString(32)),he+=":"}else Ge=Xa++,he=":"+he+"r"+Ge.toString(32)+":";return pe.memoizedState=he},unstable_isNewReconciler:!1},Bg={readContext:Hr,useCallback:Nl,useContext:Hr,useEffect:Aa,useImperativeHandle:ma,useInsertionEffect:wr,useLayoutEffect:Vl,useMemo:ba,useReducer:ka,useRef:lc,useState:function(){return ka(Fo)},useDebugValue:Tl,useDeferredValue:function(pe){var he=ka(Fo),Ge=he[0],we=he[1];return Aa(function(){var He=Ji.transition;Ji.transition={};try{we(pe)}finally{Ji.transition=He}},[pe]),Ge},useTransition:function(){var pe=ka(Fo)[0],he=vo().memoizedState;return[pe,he]},useMutableSource:fg,useSyncExternalStore:Ag,useId:Ys,unstable_isNewReconciler:!1},Gg={readContext:Hr,useCallback:Nl,useContext:Hr,useEffect:Aa,useImperativeHandle:ma,useInsertionEffect:wr,useLayoutEffect:Vl,useMemo:ba,useReducer:Ya,useRef:lc,useState:function(){return Ya(Fo)},useDebugValue:Tl,useDeferredValue:function(pe){var he=Ya(Fo),Ge=he[0],we=he[1];return Aa(function(){var He=Ji.transition;Ji.transition={};try{we(pe)}finally{Ji.transition=He}},[pe]),Ge},useTransition:function(){var pe=Ya(Fo)[0],he=vo().memoizedState;return[pe,he]},useMutableSource:fg,useSyncExternalStore:Ag,useId:Ys,unstable_isNewReconciler:!1};function Sg(pe,he){try{var Ge="",we=he;do Ge+=ko(we),we=we.return;while(we);var He=Ge}catch(De){He=`
Error generating stack: `+De.message+`
`+De.stack}return{value:pe,source:he,stack:He}}function Hl(pe,he){try{console.error(he.value)}catch(Ge){setTimeout(function(){throw Ge})}}var Dc=typeof WeakMap=="function"?WeakMap:Map;function uc(pe,he,Ge){Ge=zo(-1,Ge),Ge.tag=3,Ge.payload={element:null};var we=he.value;return Ge.callback=function(){wa||(wa=!0,Mr=we),Hl(pe,he)},Ge}function Xl(pe,he,Ge){Ge=zo(-1,Ge),Ge.tag=3;var we=pe.type.getDerivedStateFromError;if(typeof we=="function"){var He=he.value;Ge.payload=function(){return we(He)},Ge.callback=function(){Hl(pe,he)}}var De=pe.stateNode;return De!==null&&typeof De.componentDidCatch=="function"&&(Ge.callback=function(){Hl(pe,he),typeof we!="function"&&(So===null?So=new Set([this]):So.add(this));var It=he.stack;this.componentDidCatch(he.value,{componentStack:It!==null?It:""})}),Ge}function Jo(pe,he,Ge){var we=pe.pingCache;if(we===null){we=pe.pingCache=new Dc;var He=new Set;we.set(he,He)}else He=we.get(he),He===void 0&&(He=new Set,we.set(he,He));He.has(Ge)||(He.add(Ge),pe=Kg.bind(null,pe,he,Ge),he.then(pe,pe))}function Rg(pe){do{var he;if((he=pe.tag===13)&&(he=pe.memoizedState,he=he!==null?he.dehydrated!==null:!0),he)return pe;pe=pe.return}while(pe!==null);return null}function Ks(pe,he,Ge,we,He){return pe.mode&1?(pe.flags|=65536,pe.lanes=He,pe):(pe===he?pe.flags|=65536:(pe.flags|=128,Ge.flags|=131072,Ge.flags&=-52805,Ge.tag===1&&(Ge.alternate===null?Ge.tag=17:(he=zo(-1,1),he.tag=2,ys(Ge,he))),Ge.lanes|=1),pe)}function ni(pe){pe.flags|=4}function va(pe,he){if(pe!==null&&pe.child===he.child)return!0;if(he.flags&16)return!1;for(pe=he.child;pe!==null;){if(pe.flags&12854||pe.subtreeFlags&12854)return!1;pe=pe.sibling}return!0}var Qi,Ds,kl,Yl;if(Vt)Qi=function(pe,he){for(var Ge=he.child;Ge!==null;){if(Ge.tag===5||Ge.tag===6)$e(pe,Ge.stateNode);else if(Ge.tag!==4&&Ge.child!==null){Ge.child.return=Ge,Ge=Ge.child;continue}if(Ge===he)break;for(;Ge.sibling===null;){if(Ge.return===null||Ge.return===he)return;Ge=Ge.return}Ge.sibling.return=Ge.return,Ge=Ge.sibling}},Ds=function(){},kl=function(pe,he,Ge,we,He){if(pe=pe.memoizedProps,pe!==we){var De=he.stateNode,It=bo(ki.current);Ge=ot(De,Ge,pe,we,He,It),(he.updateQueue=Ge)&&ni(he)}},Yl=function(pe,he,Ge,we){Ge!==we&&ni(he)};else if(mt){Qi=function(pe,he,Ge,we){for(var He=he.child;He!==null;){if(He.tag===5){var De=He.stateNode;Ge&&we&&(De=kn(De,He.type,He.memoizedProps,He)),$e(pe,De)}else if(He.tag===6)De=He.stateNode,Ge&&we&&(De=Ir(De,He.memoizedProps,He)),$e(pe,De);else if(He.tag!==4){if(He.tag===22&&He.memoizedState!==null)De=He.child,De!==null&&(De.return=He),Qi(pe,He,!0,!0);else if(He.child!==null){He.child.return=He,He=He.child;continue}}if(He===he)break;for(;He.sibling===null;){if(He.return===null||He.return===he)return;He=He.return}He.sibling.return=He.return,He=He.sibling}};var ws=function(pe,he,Ge,we){for(var He=he.child;He!==null;){if(He.tag===5){var De=He.stateNode;Ge&&we&&(De=kn(De,He.type,He.memoizedProps,He)),Mn(pe,De)}else if(He.tag===6)De=He.stateNode,Ge&&we&&(De=Ir(De,He.memoizedProps,He)),Mn(pe,De);else if(He.tag!==4){if(He.tag===22&&He.memoizedState!==null)De=He.child,De!==null&&(De.return=He),ws(pe,He,!0,!0);else if(He.child!==null){He.child.return=He,He=He.child;continue}}if(He===he)break;for(;He.sibling===null;){if(He.return===null||He.return===he)return;He=He.return}He.sibling.return=He.return,He=He.sibling}};Ds=function(pe,he){var Ge=he.stateNode;if(!va(pe,he)){pe=Ge.containerInfo;var we=an(pe);ws(we,he,!1,!1),Ge.pendingChildren=we,ni(he),Pn(pe,we)}},kl=function(pe,he,Ge,we,He){var De=pe.stateNode,It=pe.memoizedProps;if((pe=va(pe,he))&&It===we)he.stateNode=De;else{var xt=he.stateNode,nn=bo(ki.current),mn=null;It!==we&&(mn=ot(xt,Ge,It,we,He,nn)),pe&&mn===null?he.stateNode=De:(De=dn(De,mn,Ge,It,we,he,pe,xt),ut(De,Ge,we,He,nn)&&ni(he),he.stateNode=De,pe?ni(he):Qi(De,he,!1,!1))}},Yl=function(pe,he,Ge,we){Ge!==we?(pe=bo(Ls.current),Ge=bo(ki.current),he.stateNode=ht(we,pe,Ge,he),ni(he)):he.stateNode=pe.stateNode}}else Ds=function(){},kl=function(){},Yl=function(){};function Qo(pe,he){if(!Vr)switch(pe.tailMode){case"hidden":he=pe.tail;for(var Ge=null;he!==null;)he.alternate!==null&&(Ge=he),he=he.sibling;Ge===null?pe.tail=null:Ge.sibling=null;break;case"collapsed":Ge=pe.tail;for(var we=null;Ge!==null;)Ge.alternate!==null&&(we=Ge),Ge=Ge.sibling;we===null?he||pe.tail===null?pe.tail=null:pe.tail.sibling=null:we.sibling=null}}function Or(pe){var he=pe.alternate!==null&&pe.alternate.child===pe.child,Ge=0,we=0;if(he)for(var He=pe.child;He!==null;)Ge|=He.lanes|He.childLanes,we|=He.subtreeFlags&14680064,we|=He.flags&14680064,He.return=pe,He=He.sibling;else for(He=pe.child;He!==null;)Ge|=He.lanes|He.childLanes,we|=He.subtreeFlags,we|=He.flags,He.return=pe,He=He.sibling;return pe.subtreeFlags|=we,pe.childLanes=Ge,he}function Kl(pe,he,Ge){var we=he.pendingProps;switch(pg(he),he.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Or(he),null;case 1:return nr(he.type)&&Kn(),Or(he),null;case 3:return we=he.stateNode,Ca(),gn(Wn),gn(Jn),Hs(),we.pendingContext&&(we.context=we.pendingContext,we.pendingContext=null),(pe===null||pe.child===null)&&(La(he)?ni(he):pe===null||pe.memoizedState.isDehydrated&&!(he.flags&256)||(he.flags|=1024,uo!==null&&(sl(uo),uo=null))),Ds(pe,he),Or(he),null;case 5:Cg(he),Ge=bo(Ls.current);var He=he.type;if(pe!==null&&he.stateNode!=null)kl(pe,he,He,we,Ge),pe.ref!==he.ref&&(he.flags|=512,he.flags|=2097152);else{if(!we){if(he.stateNode===null)throw Error(ie(166));return Or(he),null}if(pe=bo(ki.current),La(he)){if(!Ft)throw Error(ie(175));pe=je(he.stateNode,he.type,he.memoizedProps,Ge,pe,he,!ua),he.updateQueue=pe,pe!==null&&ni(he)}else{var De=Ye(He,we,Ge,pe,he);Qi(De,he,!1,!1),he.stateNode=De,ut(De,He,we,Ge,pe)&&ni(he)}he.ref!==null&&(he.flags|=512,he.flags|=2097152)}return Or(he),null;case 6:if(pe&&he.stateNode!=null)Yl(pe,he,pe.memoizedProps,we);else{if(typeof we!="string"&&he.stateNode===null)throw Error(ie(166));if(pe=bo(Ls.current),Ge=bo(ki.current),La(he)){if(!Ft)throw Error(ie(176));if(pe=he.stateNode,we=he.memoizedProps,(Ge=st(pe,we,he,!ua))&&(He=Mi,He!==null))switch(De=(He.mode&1)!==0,He.tag){case 3:pt(He.stateNode.containerInfo,pe,we,De);break;case 5:At(He.type,He.memoizedProps,He.stateNode,pe,we,De)}Ge&&ni(he)}else he.stateNode=ht(we,pe,Ge,he)}return Or(he),null;case 13:if(gn(Xr),we=he.memoizedState,Vr&&Ci!==null&&he.mode&1&&!(he.flags&128)){for(pe=Ci;pe;)pe=_r(pe);return da(),he.flags|=98560,he}if(we!==null&&we.dehydrated!==null){if(we=La(he),pe===null){if(!we)throw Error(ie(318));if(!Ft)throw Error(ie(344));if(pe=he.memoizedState,pe=pe!==null?pe.dehydrated:null,!pe)throw Error(ie(317));yt(pe,he)}else da(),!(he.flags&128)&&(he.memoizedState=null),he.flags|=4;return Or(he),null}return uo!==null&&(sl(uo),uo=null),he.flags&128?(he.lanes=Ge,he):(we=we!==null,Ge=!1,pe===null?La(he):Ge=pe.memoizedState!==null,we&&!Ge&&(he.child.flags|=8192,he.mode&1&&(pe===null||Xr.current&1?zr===0&&(zr=3):Jl())),he.updateQueue!==null&&(he.flags|=4),Or(he),null);case 4:return Ca(),Ds(pe,he),pe===null&&Lt(he.stateNode.containerInfo),Or(he),null;case 10:return Jr(he.type._context),Or(he),null;case 17:return nr(he.type)&&Kn(),Or(he),null;case 19:if(gn(Xr),He=he.memoizedState,He===null)return Or(he),null;if(we=(he.flags&128)!==0,De=He.rendering,De===null)if(we)Qo(He,!1);else{if(zr!==0||pe!==null&&pe.flags&128)for(pe=he.child;pe!==null;){if(De=Zl(pe),De!==null){for(he.flags|=128,Qo(He,!1),pe=De.updateQueue,pe!==null&&(he.updateQueue=pe,he.flags|=4),he.subtreeFlags=0,pe=Ge,we=he.child;we!==null;)Ge=we,He=pe,Ge.flags&=14680066,De=Ge.alternate,De===null?(Ge.childLanes=0,Ge.lanes=He,Ge.child=null,Ge.subtreeFlags=0,Ge.memoizedProps=null,Ge.memoizedState=null,Ge.updateQueue=null,Ge.dependencies=null,Ge.stateNode=null):(Ge.childLanes=De.childLanes,Ge.lanes=De.lanes,Ge.child=De.child,Ge.subtreeFlags=0,Ge.deletions=null,Ge.memoizedProps=De.memoizedProps,Ge.memoizedState=De.memoizedState,Ge.updateQueue=De.updateQueue,Ge.type=De.type,He=De.dependencies,Ge.dependencies=He===null?null:{lanes:He.lanes,firstContext:He.firstContext}),we=we.sibling;return xn(Xr,Xr.current&1|2),he.child}pe=pe.sibling}He.tail!==null&&Wr()>_s&&(he.flags|=128,we=!0,Qo(He,!1),he.lanes=4194304)}else{if(!we)if(pe=Zl(De),pe!==null){if(he.flags|=128,we=!0,pe=pe.updateQueue,pe!==null&&(he.updateQueue=pe,he.flags|=4),Qo(He,!0),He.tail===null&&He.tailMode==="hidden"&&!De.alternate&&!Vr)return Or(he),null}else 2*Wr()-He.renderingStartTime>_s&&Ge!==1073741824&&(he.flags|=128,we=!0,Qo(He,!1),he.lanes=4194304);He.isBackwards?(De.sibling=he.child,he.child=De):(pe=He.last,pe!==null?pe.sibling=De:he.child=De,He.last=De)}return He.tail!==null?(he=He.tail,He.rendering=he,He.tail=he.sibling,He.renderingStartTime=Wr(),he.sibling=null,pe=Xr.current,xn(Xr,we?pe&1|2:pe&1),he):(Or(he),null);case 22:case 23:return al(),we=he.memoizedState!==null,pe!==null&&pe.memoizedState!==null!==we&&(he.flags|=8192),we&&he.mode&1?wi&1073741824&&(Or(he),Vt&&he.subtreeFlags&6&&(he.flags|=8192)):Or(he),null;case 24:return null;case 25:return null}throw Error(ie(156,he.tag))}var wg=oe.ReactCurrentOwner,di=!1;function Dr(pe,he,Ge,we){he.child=pe===null?sc(he,null,Ge,we):Oo(he,pe.child,Ge,we)}function xr(pe,he,Ge,we,He){Ge=Ge.render;var De=he.ref;return Pr(he,He),we=fa(pe,he,Ge,we,De,He),Ge=Ss(),pe!==null&&!di?(he.updateQueue=pe.updateQueue,he.flags&=-2053,pe.lanes&=~He,Yi(pe,he,He)):(Vr&&Ge&&dg(he),he.flags|=1,Dr(pe,he,we,He),he.child)}function Sr(pe,he,Ge,we,He){if(pe===null){var De=Ge.type;return typeof De=="function"&&!$l(De)&&De.defaultProps===void 0&&Ge.compare===null&&Ge.defaultProps===void 0?(he.tag=15,he.type=De,$o(pe,he,De,we,He)):(pe=ql(Ge.type,null,we,he,he.mode,He),pe.ref=he.ref,pe.return=he,he.child=pe)}if(De=pe.child,!(pe.lanes&He)){var It=De.memoizedProps;if(Ge=Ge.compare,Ge=Ge!==null?Ge:Hi,Ge(It,we)&&pe.ref===he.ref)return Yi(pe,he,He)}return he.flags|=1,pe=cs(De,we),pe.ref=he.ref,pe.return=he,he.child=pe}function $o(pe,he,Ge,we,He){if(pe!==null&&Hi(pe.memoizedProps,we)&&pe.ref===he.ref)if(di=!1,(pe.lanes&He)!==0)pe.flags&131072&&(di=!0);else return he.lanes=pe.lanes,Yi(pe,he,He);return qo(pe,he,Ge,we,He)}function fi(pe,he,Ge){var we=he.pendingProps,He=we.children,De=pe!==null?pe.memoizedState:null;if(we.mode==="hidden")if(!(he.mode&1))he.memoizedState={baseLanes:0,cachePool:null},xn(qs,wi),wi|=Ge;else if(Ge&1073741824)he.memoizedState={baseLanes:0,cachePool:null},we=De!==null?De.baseLanes:Ge,xn(qs,wi),wi|=we;else return pe=De!==null?De.baseLanes|Ge:Ge,he.lanes=he.childLanes=1073741824,he.memoizedState={baseLanes:pe,cachePool:null},he.updateQueue=null,xn(qs,wi),wi|=pe,null;else De!==null?(we=De.baseLanes|Ge,he.memoizedState=null):we=Ge,xn(qs,wi),wi|=we;return Dr(pe,he,He,Ge),he.child}function Fi(pe,he){var Ge=he.ref;(pe===null&&Ge!==null||pe!==null&&pe.ref!==Ge)&&(he.flags|=512,he.flags|=2097152)}function qo(pe,he,Ge,we,He){var De=nr(Ge)?Hn:Jn.current;return De=Zn(he,De),Pr(he,He),Ge=fa(pe,he,Ge,we,De,He),we=Ss(),pe!==null&&!di?(he.updateQueue=pe.updateQueue,he.flags&=-2053,pe.lanes&=~He,Yi(pe,he,He)):(Vr&&we&&dg(he),he.flags|=1,Dr(pe,he,Ge,He),he.child)}function zs(pe,he,Ge,we,He){if(nr(Ge)){var De=!0;tr(he)}else De=!1;if(Pr(he,He),he.stateNode===null)pe!==null&&(pe.alternate=null,he.alternate=null,he.flags|=2),tc(he,Ge,we),ug(he,Ge,we,He),we=!0;else if(pe===null){var It=he.stateNode,xt=he.memoizedProps;It.props=xt;var nn=It.context,mn=Ge.contextType;typeof mn=="object"&&mn!==null?mn=Hr(mn):(mn=nr(Ge)?Hn:Jn.current,mn=Zn(he,mn));var Vn=Ge.getDerivedStateFromProps,or=typeof Vn=="function"||typeof It.getSnapshotBeforeUpdate=="function";or||typeof It.UNSAFE_componentWillReceiveProps!="function"&&typeof It.componentWillReceiveProps!="function"||(xt!==we||nn!==mn)&&nc(he,It,we,mn),go=!1;var jn=he.memoizedState;It.state=jn,vl(he,we,It,He),nn=he.memoizedState,xt!==we||jn!==nn||Wn.current||go?(typeof Vn=="function"&&(gg(he,Ge,Vn,we),nn=he.memoizedState),(xt=go||cg(he,Ge,xt,we,jn,nn,mn))?(or||typeof It.UNSAFE_componentWillMount!="function"&&typeof It.componentWillMount!="function"||(typeof It.componentWillMount=="function"&&It.componentWillMount(),typeof It.UNSAFE_componentWillMount=="function"&&It.UNSAFE_componentWillMount()),typeof It.componentDidMount=="function"&&(he.flags|=4194308)):(typeof It.componentDidMount=="function"&&(he.flags|=4194308),he.memoizedProps=we,he.memoizedState=nn),It.props=we,It.state=nn,It.context=mn,we=xt):(typeof It.componentDidMount=="function"&&(he.flags|=4194308),we=!1)}else{It=he.stateNode,lg(pe,he),xt=he.memoizedProps,mn=he.type===he.elementType?xt:ai(he.type,xt),It.props=mn,or=he.pendingProps,jn=It.context,nn=Ge.contextType,typeof nn=="object"&&nn!==null?nn=Hr(nn):(nn=nr(Ge)?Hn:Jn.current,nn=Zn(he,nn));var cr=Ge.getDerivedStateFromProps;(Vn=typeof cr=="function"||typeof It.getSnapshotBeforeUpdate=="function")||typeof It.UNSAFE_componentWillReceiveProps!="function"&&typeof It.componentWillReceiveProps!="function"||(xt!==or||jn!==nn)&&nc(he,It,we,nn),go=!1,jn=he.memoizedState,It.state=jn,vl(he,we,It,He);var En=he.memoizedState;xt!==or||jn!==En||Wn.current||go?(typeof cr=="function"&&(gg(he,Ge,cr,we),En=he.memoizedState),(mn=go||cg(he,Ge,mn,we,jn,En,nn)||!1)?(Vn||typeof It.UNSAFE_componentWillUpdate!="function"&&typeof It.componentWillUpdate!="function"||(typeof It.componentWillUpdate=="function"&&It.componentWillUpdate(we,En,nn),typeof It.UNSAFE_componentWillUpdate=="function"&&It.UNSAFE_componentWillUpdate(we,En,nn)),typeof It.componentDidUpdate=="function"&&(he.flags|=4),typeof It.getSnapshotBeforeUpdate=="function"&&(he.flags|=1024)):(typeof It.componentDidUpdate!="function"||xt===pe.memoizedProps&&jn===pe.memoizedState||(he.flags|=4),typeof It.getSnapshotBeforeUpdate!="function"||xt===pe.memoizedProps&&jn===pe.memoizedState||(he.flags|=1024),he.memoizedProps=we,he.memoizedState=En),It.props=we,It.state=En,It.context=nn,we=mn):(typeof It.componentDidUpdate!="function"||xt===pe.memoizedProps&&jn===pe.memoizedState||(he.flags|=4),typeof It.getSnapshotBeforeUpdate!="function"||xt===pe.memoizedProps&&jn===pe.memoizedState||(he.flags|=1024),we=!1)}return Ri(pe,he,Ge,we,De,He)}function Ri(pe,he,Ge,we,He,De){Fi(pe,he);var It=(he.flags&128)!==0;if(!we&&!It)return He&&Qn(he,Ge,!1),Yi(pe,he,De);we=he.stateNode,wg.current=he;var xt=It&&typeof Ge.getDerivedStateFromError!="function"?null:we.render();return he.flags|=1,pe!==null&&It?(he.child=Oo(he,pe.child,null,De),he.child=Oo(he,null,xt,De)):Dr(pe,he,xt,De),he.memoizedState=we.state,He&&Qn(he,Ge,!0),he.child}function Oa(pe){var he=pe.stateNode;he.pendingContext?er(pe,he.pendingContext,he.pendingContext!==he.context):he.context&&er(pe,he.context,!1),xl(pe,he.containerInfo)}function xg(pe,he,Ge,we,He){return da(),wl(He),he.flags|=256,Dr(pe,he,Ge,we),he.child}var ja={dehydrated:null,treeContext:null,retryLane:0};function Us(pe){return{baseLanes:pe,cachePool:null}}function Zg(pe,he,Ge){var we=he.pendingProps,He=Xr.current,De=!1,It=(he.flags&128)!==0,xt;if((xt=It)||(xt=pe!==null&&pe.memoizedState===null?!1:(He&2)!==0),xt?(De=!0,he.flags&=-129):(pe===null||pe.memoizedState!==null)&&(He|=1),xn(Xr,He&1),pe===null)return Bs(he),pe=he.memoizedState,pe!==null&&(pe=pe.dehydrated,pe!==null)?(he.mode&1?Nr(pe)?he.lanes=8:he.lanes=1073741824:he.lanes=1,null):(He=we.children,pe=we.fallback,De?(we=he.mode,De=he.child,He={mode:"hidden",children:He},!(we&1)&&De!==null?(De.childLanes=0,De.pendingProps=He):De=cl(He,we,0,null),pe=ia(pe,we,Ge,null),De.return=he,pe.return=he,De.sibling=pe,he.child=De,he.child.memoizedState=Us(Ge),he.memoizedState=ja,pe):Bo(he,He));if(He=pe.memoizedState,He!==null){if(xt=He.dehydrated,xt!==null){if(It)return he.flags&256?(he.flags&=-257,Qa(pe,he,Ge,Error(ie(422)))):he.memoizedState!==null?(he.child=pe.child,he.flags|=128,null):(De=we.fallback,He=he.mode,we=cl({mode:"visible",children:we.children},He,0,null),De=ia(De,He,Ge,null),De.flags|=2,we.return=he,De.return=he,we.sibling=De,he.child=we,he.mode&1&&Oo(he,pe.child,null,Ge),he.child.memoizedState=Us(Ge),he.memoizedState=ja,De);if(!(he.mode&1))he=Qa(pe,he,Ge,null);else if(Nr(xt))he=Qa(pe,he,Ge,Error(ie(419)));else if(we=(Ge&pe.childLanes)!==0,di||we){if(we=jr,we!==null){switch(Ge&-Ge){case 4:De=2;break;case 16:De=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:De=32;break;case 536870912:De=268435456;break;default:De=0}we=De&(we.suspendedLanes|Ge)?0:De,we!==0&&we!==He.retryLane&&(He.retryLane=we,xi(pe,we,-1))}Jl(),he=Qa(pe,he,Ge,Error(ie(421)))}else Fr(xt)?(he.flags|=128,he.child=pe.child,he=Cc.bind(null,pe),Kr(xt,he),he=null):(Ge=He.treeContext,Ft&&(Ci=Bi(xt),Mi=he,Vr=!0,uo=null,ua=!1,Ge!==null&&(co[Oi++]=Uo,co[Oi++]=Po,co[Oi++]=Vs,Uo=Ge.id,Po=Ge.overflow,Vs=he)),he=Bo(he,he.pendingProps.children),he.flags|=4096);return he}return De?(we=Dl(pe,he,we.children,we.fallback,Ge),De=he.child,He=pe.child.memoizedState,De.memoizedState=He===null?Us(Ge):{baseLanes:He.baseLanes|Ge,cachePool:null},De.childLanes=pe.childLanes&~Ge,he.memoizedState=ja,we):(Ge=Ja(pe,he,we.children,Ge),he.memoizedState=null,Ge)}return De?(we=Dl(pe,he,we.children,we.fallback,Ge),De=he.child,He=pe.child.memoizedState,De.memoizedState=He===null?Us(Ge):{baseLanes:He.baseLanes|Ge,cachePool:null},De.childLanes=pe.childLanes&~Ge,he.memoizedState=ja,we):(Ge=Ja(pe,he,we.children,Ge),he.memoizedState=null,Ge)}function Bo(pe,he){return he=cl({mode:"visible",children:he},pe.mode,0,null),he.return=pe,pe.child=he}function Ja(pe,he,Ge,we){var He=pe.child;return pe=He.sibling,Ge=cs(He,{mode:"visible",children:Ge}),!(he.mode&1)&&(Ge.lanes=we),Ge.return=he,Ge.sibling=null,pe!==null&&(we=he.deletions,we===null?(he.deletions=[pe],he.flags|=16):we.push(pe)),he.child=Ge}function Dl(pe,he,Ge,we,He){var De=he.mode;pe=pe.child;var It=pe.sibling,xt={mode:"hidden",children:Ge};return!(De&1)&&he.child!==pe?(Ge=he.child,Ge.childLanes=0,Ge.pendingProps=xt,he.deletions=null):(Ge=cs(pe,xt),Ge.subtreeFlags=pe.subtreeFlags&14680064),It!==null?we=cs(It,we):(we=ia(we,De,He,null),we.flags|=2),we.return=he,Ge.return=he,Ge.sibling=we,he.child=Ge,we}function Qa(pe,he,Ge,we){return we!==null&&wl(we),Oo(he,pe.child,null,Ge),pe=Bo(he,he.pendingProps.children),pe.flags|=2,he.memoizedState=null,pe}function dc(pe,he,Ge){pe.lanes|=he;var we=pe.alternate;we!==null&&(we.lanes|=he),ti(pe.return,he,Ge)}function Wo(pe,he,Ge,we,He){var De=pe.memoizedState;De===null?pe.memoizedState={isBackwards:he,rendering:null,renderingStartTime:0,last:we,tail:Ge,tailMode:He}:(De.isBackwards=he,De.rendering=null,De.renderingStartTime=0,De.last=we,De.tail=Ge,De.tailMode=He)}function Ps(pe,he,Ge){var we=he.pendingProps,He=we.revealOrder,De=we.tail;if(Dr(pe,he,we.children,Ge),we=Xr.current,we&2)we=we&1|2,he.flags|=128;else{if(pe!==null&&pe.flags&128)e:for(pe=he.child;pe!==null;){if(pe.tag===13)pe.memoizedState!==null&&dc(pe,Ge,he);else if(pe.tag===19)dc(pe,Ge,he);else if(pe.child!==null){pe.child.return=pe,pe=pe.child;continue}if(pe===he)break e;for(;pe.sibling===null;){if(pe.return===null||pe.return===he)break e;pe=pe.return}pe.sibling.return=pe.return,pe=pe.sibling}we&=1}if(xn(Xr,we),!(he.mode&1))he.memoizedState=null;else switch(He){case"forwards":for(Ge=he.child,He=null;Ge!==null;)pe=Ge.alternate,pe!==null&&Zl(pe)===null&&(He=Ge),Ge=Ge.sibling;Ge=He,Ge===null?(He=he.child,he.child=null):(He=Ge.sibling,Ge.sibling=null),Wo(he,!1,He,Ge,De);break;case"backwards":for(Ge=null,He=he.child,he.child=null;He!==null;){if(pe=He.alternate,pe!==null&&Zl(pe)===null){he.child=He;break}pe=He.sibling,He.sibling=Ge,Ge=He,He=pe}Wo(he,!0,Ge,null,De);break;case"together":Wo(he,!1,null,null,void 0);break;default:he.memoizedState=null}return he.child}function Yi(pe,he,Ge){if(pe!==null&&(he.dependencies=pe.dependencies),Vo|=he.lanes,!(Ge&he.childLanes))return null;if(pe!==null&&he.child!==pe.child)throw Error(ie(153));if(he.child!==null){for(pe=he.child,Ge=cs(pe,pe.pendingProps),he.child=Ge,Ge.return=he;pe.sibling!==null;)pe=pe.sibling,Ge=Ge.sibling=cs(pe,pe.pendingProps),Ge.return=he;Ge.sibling=null}return he.child}function zl(pe,he,Ge){switch(he.tag){case 3:Oa(he),da();break;case 5:ac(he);break;case 1:nr(he.type)&&tr(he);break;case 4:xl(he,he.stateNode.containerInfo);break;case 10:Do(he,he.type._context,he.memoizedProps.value);break;case 13:var we=he.memoizedState;if(we!==null)return we.dehydrated!==null?(xn(Xr,Xr.current&1),he.flags|=128,null):Ge&he.child.childLanes?Zg(pe,he,Ge):(xn(Xr,Xr.current&1),pe=Yi(pe,he,Ge),pe!==null?pe.sibling:null);xn(Xr,Xr.current&1);break;case 19:if(we=(Ge&he.childLanes)!==0,pe.flags&128){if(we)return Ps(pe,he,Ge);he.flags|=128}var He=he.memoizedState;if(He!==null&&(He.rendering=null,He.tail=null,He.lastEffect=null),xn(Xr,Xr.current),we)break;return null;case 22:case 23:return he.lanes=0,fi(pe,he,Ge)}return Yi(pe,he,Ge)}function Ul(pe,he){switch(pg(he),he.tag){case 1:return nr(he.type)&&Kn(),pe=he.flags,pe&65536?(he.flags=pe&-65537|128,he):null;case 3:return Ca(),gn(Wn),gn(Jn),Hs(),pe=he.flags,pe&65536&&!(pe&128)?(he.flags=pe&-65537|128,he):null;case 5:return Cg(he),null;case 13:if(gn(Xr),pe=he.memoizedState,pe!==null&&pe.dehydrated!==null){if(he.alternate===null)throw Error(ie(340));da()}return pe=he.flags,pe&65536?(he.flags=pe&-65537|128,he):null;case 19:return gn(Xr),null;case 4:return Ca(),null;case 10:return Jr(he.type._context),null;case 22:case 23:return al(),null;case 24:return null;default:return null}}var Wi=!1,pi=!1,Os=typeof WeakSet=="function"?WeakSet:Set,Rn=null;function po(pe,he){var Ge=pe.ref;if(Ge!==null)if(typeof Ge=="function")try{Ge(null)}catch(we){Ti(pe,he,we)}else Ge.current=null}function ns(pe,he,Ge){try{Ge()}catch(we){Ti(pe,he,we)}}var _g=!1;function Eg(pe,he){for(qe(pe.containerInfo),Rn=he;Rn!==null;)if(pe=Rn,he=pe.child,(pe.subtreeFlags&1028)!==0&&he!==null)he.return=pe,Rn=he;else for(;Rn!==null;){pe=Rn;try{var Ge=pe.alternate;if(pe.flags&1024)switch(pe.tag){case 0:case 11:case 15:break;case 1:if(Ge!==null){var we=Ge.memoizedProps,He=Ge.memoizedState,De=pe.stateNode,It=De.getSnapshotBeforeUpdate(pe.elementType===pe.type?we:ai(pe.type,we),He);De.__reactInternalSnapshotBeforeUpdate=It}break;case 3:Vt&&on(pe.stateNode.containerInfo);break;case 5:case 6:case 4:case 17:break;default:throw Error(ie(163))}}catch(xt){Ti(pe,pe.return,xt)}if(he=pe.sibling,he!==null){he.return=pe.return,Rn=he;break}Rn=pe.return}return Ge=_g,_g=!1,Ge}function rs(pe,he,Ge){var we=he.updateQueue;if(we=we!==null?we.lastEffect:null,we!==null){var He=we=we.next;do{if((He.tag&pe)===pe){var De=He.destroy;He.destroy=void 0,De!==void 0&&ns(he,Ge,De)}He=He.next}while(He!==we)}}function Ai(pe,he){if(he=he.updateQueue,he=he!==null?he.lastEffect:null,he!==null){var Ge=he=he.next;do{if((Ge.tag&pe)===pe){var we=Ge.create;Ge.destroy=we()}Ge=Ge.next}while(Ge!==he)}}function Vi(pe){var he=pe.ref;if(he!==null){var Ge=pe.stateNode;switch(pe.tag){case 5:pe=tt(Ge);break;default:pe=Ge}typeof he=="function"?he(pe):he.current=pe}}function Er(pe,he,Ge){if(Pi&&typeof Pi.onCommitFiberUnmount=="function")try{Pi.onCommitFiberUnmount(fs,he)}catch{}switch(he.tag){case 0:case 11:case 14:case 15:if(pe=he.updateQueue,pe!==null&&(pe=pe.lastEffect,pe!==null)){var we=pe=pe.next;do{var He=we,De=He.destroy;He=He.tag,De!==void 0&&(He&2||He&4)&&ns(he,Ge,De),we=we.next}while(we!==pe)}break;case 1:if(po(he,Ge),pe=he.stateNode,typeof pe.componentWillUnmount=="function")try{pe.props=he.memoizedProps,pe.state=he.memoizedState,pe.componentWillUnmount()}catch(It){Ti(he,Ge,It)}break;case 5:po(he,Ge);break;case 4:Vt?Wg(pe,he,Ge):mt&&mt&&(he=he.stateNode.containerInfo,Ge=an(he),Nn(he,Ge))}}function Io(pe,he,Ge){for(var we=he;;)if(Er(pe,we,Ge),we.child===null||Vt&&we.tag===4){if(we===he)break;for(;we.sibling===null;){if(we.return===null||we.return===he)return;we=we.return}we.sibling.return=we.return,we=we.sibling}else we.child.return=we,we=we.child}function Mg(pe){var he=pe.alternate;he!==null&&(pe.alternate=null,Mg(he)),pe.child=null,pe.deletions=null,pe.sibling=null,pe.tag===5&&(he=pe.stateNode,he!==null&&Ut(he)),pe.stateNode=null,pe.return=null,pe.dependencies=null,pe.memoizedProps=null,pe.memoizedState=null,pe.pendingProps=null,pe.stateNode=null,pe.updateQueue=null}function Fg(pe){return pe.tag===5||pe.tag===3||pe.tag===4}function Pl(pe){e:for(;;){for(;pe.sibling===null;){if(pe.return===null||Fg(pe.return))return null;pe=pe.return}for(pe.sibling.return=pe.return,pe=pe.sibling;pe.tag!==5&&pe.tag!==6&&pe.tag!==18;){if(pe.flags&2||pe.child===null||pe.tag===4)continue e;pe.child.return=pe,pe=pe.child}if(!(pe.flags&2))return pe.stateNode}}function Ol(pe){if(Vt){e:{for(var he=pe.return;he!==null;){if(Fg(he))break e;he=he.return}throw Error(ie(160))}var Ge=he;switch(Ge.tag){case 5:he=Ge.stateNode,Ge.flags&32&&(yn(he),Ge.flags&=-33),Ge=Pl(pe),Ba(pe,Ge,he);break;case 3:case 4:he=Ge.stateNode.containerInfo,Ge=Pl(pe),jl(pe,Ge,he);break;default:throw Error(ie(161))}}}function jl(pe,he,Ge){var we=pe.tag;if(we===5||we===6)pe=pe.stateNode,he?ln(Ge,pe,he):rn(Ge,pe);else if(we!==4&&(pe=pe.child,pe!==null))for(jl(pe,he,Ge),pe=pe.sibling;pe!==null;)jl(pe,he,Ge),pe=pe.sibling}function Ba(pe,he,Ge){var we=pe.tag;if(we===5||we===6)pe=pe.stateNode,he?un(Ge,pe,he):$t(Ge,pe);else if(we!==4&&(pe=pe.child,pe!==null))for(Ba(pe,he,Ge),pe=pe.sibling;pe!==null;)Ba(pe,he,Ge),pe=pe.sibling}function Wg(pe,he,Ge){for(var we=he,He=!1,De,It;;){if(!He){He=we.return;e:for(;;){if(He===null)throw Error(ie(160));switch(De=He.stateNode,He.tag){case 5:It=!1;break e;case 3:De=De.containerInfo,It=!0;break e;case 4:De=De.containerInfo,It=!0;break e}He=He.return}He=!0}if(we.tag===5||we.tag===6)Io(pe,we,Ge),It?Sn(De,we.stateNode):tn(De,we.stateNode);else if(we.tag===18)It?pn(De,we.stateNode):fn(De,we.stateNode);else if(we.tag===4){if(we.child!==null){De=we.stateNode.containerInfo,It=!0,we.child.return=we,we=we.child;continue}}else if(Er(pe,we,Ge),we.child!==null){we.child.return=we,we=we.child;continue}if(we===he)break;for(;we.sibling===null;){if(we.return===null||we.return===he)return;we=we.return,we.tag===4&&(He=!1)}we.sibling.return=we.return,we=we.sibling}}function xs(pe,he){if(Vt){switch(he.tag){case 0:case 11:case 14:case 15:rs(3,he,he.return),Ai(3,he),rs(5,he,he.return);return;case 1:return;case 5:var Ge=he.stateNode;if(Ge!=null){var we=he.memoizedProps;pe=pe!==null?pe.memoizedProps:we;var He=he.type,De=he.updateQueue;he.updateQueue=null,De!==null&&In(Ge,De,He,pe,we,he)}return;case 6:if(he.stateNode===null)throw Error(ie(162));Ge=he.memoizedProps,Gn(he.stateNode,pe!==null?pe.memoizedProps:Ge,Ge);return;case 3:Ft&&pe!==null&&pe.memoizedState.isDehydrated&&jt(he.stateNode.containerInfo);return;case 12:return;case 13:Ga(he);return;case 19:Ga(he);return;case 17:return}throw Error(ie(163))}switch(he.tag){case 0:case 11:case 14:case 15:rs(3,he,he.return),Ai(3,he),rs(5,he,he.return);return;case 12:return;case 13:Ga(he);return;case 19:Ga(he);return;case 3:Ft&&pe!==null&&pe.memoizedState.isDehydrated&&jt(he.stateNode.containerInfo);break;case 22:case 23:return}e:if(mt){switch(he.tag){case 1:case 5:case 6:break e;case 3:case 4:he=he.stateNode,Nn(he.containerInfo,he.pendingChildren);break e}throw Error(ie(163))}}function Ga(pe){var he=pe.updateQueue;if(he!==null){pe.updateQueue=null;var Ge=pe.stateNode;Ge===null&&(Ge=pe.stateNode=new Os),he.forEach(function(we){var He=fc.bind(null,pe,we);Ge.has(we)||(Ge.add(we),we.then(He,He))})}}function zc(pe,he){for(Rn=he;Rn!==null;){he=Rn;var Ge=he.deletions;if(Ge!==null)for(var we=0;we<Ge.length;we++){var He=Ge[we];try{var De=pe;Vt?Wg(De,He,he):Io(De,He,he);var It=He.alternate;It!==null&&(It.return=null),He.return=null}catch(Dn){Ti(He,he,Dn)}}if(Ge=he.child,he.subtreeFlags&12854&&Ge!==null)Ge.return=he,Rn=Ge;else for(;Rn!==null;){he=Rn;try{var xt=he.flags;if(xt&32&&Vt&&yn(he.stateNode),xt&512){var nn=he.alternate;if(nn!==null){var mn=nn.ref;mn!==null&&(typeof mn=="function"?mn(null):mn.current=null)}}if(xt&8192)switch(he.tag){case 13:if(he.memoizedState!==null){var Vn=he.alternate;(Vn===null||Vn.memoizedState===null)&&(il=Wr())}break;case 22:var or=he.memoizedState!==null,jn=he.alternate,cr=jn!==null&&jn.memoizedState!==null;if(Ge=he,Vt){e:if(we=Ge,He=or,De=null,Vt)for(var En=we;;){if(En.tag===5){if(De===null){De=En;var yi=En.stateNode;He?Tn(yi):wt(En.stateNode,En.memoizedProps)}}else if(En.tag===6){if(De===null){var ro=En.stateNode;He?vt(ro):Mt(ro,En.memoizedProps)}}else if((En.tag!==22&&En.tag!==23||En.memoizedState===null||En===we)&&En.child!==null){En.child.return=En,En=En.child;continue}if(En===we)break;for(;En.sibling===null;){if(En.return===null||En.return===we)break e;De===En&&(De=null),En=En.return}De===En&&(De=null),En.sibling.return=En.return,En=En.sibling}}if(or&&!cr&&Ge.mode&1){Rn=Ge;for(var Kt=Ge.child;Kt!==null;){for(Ge=Rn=Kt;Rn!==null;){we=Rn;var _t=we.child;switch(we.tag){case 0:case 11:case 14:case 15:rs(4,we,we.return);break;case 1:po(we,we.return);var qt=we.stateNode;if(typeof qt.componentWillUnmount=="function"){var _n=we.return;try{qt.props=we.memoizedProps,qt.state=we.memoizedState,qt.componentWillUnmount()}catch(Dn){Ti(we,_n,Dn)}}break;case 5:po(we,we.return);break;case 22:if(we.memoizedState!==null){Tg(Ge);continue}}_t!==null?(_t.return=we,Rn=_t):Tg(Ge)}Kt=Kt.sibling}}}switch(xt&4102){case 2:Ol(he),he.flags&=-3;break;case 6:Ol(he),he.flags&=-3,xs(he.alternate,he);break;case 4096:he.flags&=-4097;break;case 4100:he.flags&=-4097,xs(he.alternate,he);break;case 4:xs(he.alternate,he)}}catch(Dn){Ti(he,he.return,Dn)}if(Ge=he.sibling,Ge!==null){Ge.return=he.return,Rn=Ge;break}Rn=he.return}}}function $a(pe,he,Ge){Rn=pe,qa(pe)}function qa(pe,he,Ge){for(var we=(pe.mode&1)!==0;Rn!==null;){var He=Rn,De=He.child;if(He.tag===22&&we){var It=He.memoizedState!==null||Wi;if(!It){var xt=He.alternate,nn=xt!==null&&xt.memoizedState!==null||pi;xt=Wi;var mn=pi;if(Wi=It,(pi=nn)&&!mn)for(Rn=He;Rn!==null;)It=Rn,nn=It.child,It.tag===22&&It.memoizedState!==null?js(He):nn!==null?(nn.return=It,Rn=nn):js(He);for(;De!==null;)Rn=De,qa(De),De=De.sibling;Rn=He,Wi=xt,pi=mn}Vg(pe)}else He.subtreeFlags&8772&&De!==null?(De.return=He,Rn=De):Vg(pe)}}function Vg(pe){for(;Rn!==null;){var he=Rn;if(he.flags&8772){var Ge=he.alternate;try{if(he.flags&8772)switch(he.tag){case 0:case 11:case 15:pi||Ai(5,he);break;case 1:var we=he.stateNode;if(he.flags&4&&!pi)if(Ge===null)we.componentDidMount();else{var He=he.elementType===he.type?Ge.memoizedProps:ai(he.type,Ge.memoizedProps);we.componentDidUpdate(He,Ge.memoizedState,we.__reactInternalSnapshotBeforeUpdate)}var De=he.updateQueue;De!==null&&qg(he,De,we);break;case 3:var It=he.updateQueue;if(It!==null){if(Ge=null,he.child!==null)switch(he.child.tag){case 5:Ge=tt(he.child.stateNode);break;case 1:Ge=he.child.stateNode}qg(he,It,Ge)}break;case 5:var xt=he.stateNode;Ge===null&&he.flags&4&&en(xt,he.type,he.memoizedProps,he);break;case 6:break;case 4:break;case 12:break;case 13:if(Ft&&he.memoizedState===null){var nn=he.alternate;if(nn!==null){var mn=nn.memoizedState;if(mn!==null){var Vn=mn.dehydrated;Vn!==null&&Jt(Vn)}}}break;case 19:case 17:case 21:case 22:case 23:break;default:throw Error(ie(163))}pi||he.flags&512&&Vi(he)}catch(or){Ti(he,he.return,or)}}if(he===pe){Rn=null;break}if(Ge=he.sibling,Ge!==null){Ge.return=he.return,Rn=Ge;break}Rn=he.return}}function Tg(pe){for(;Rn!==null;){var he=Rn;if(he===pe){Rn=null;break}var Ge=he.sibling;if(Ge!==null){Ge.return=he.return,Rn=Ge;break}Rn=he.return}}function js(pe){for(;Rn!==null;){var he=Rn;try{switch(he.tag){case 0:case 11:case 15:var Ge=he.return;try{Ai(4,he)}catch(nn){Ti(he,Ge,nn)}break;case 1:var we=he.stateNode;if(typeof we.componentDidMount=="function"){var He=he.return;try{we.componentDidMount()}catch(nn){Ti(he,He,nn)}}var De=he.return;try{Vi(he)}catch(nn){Ti(he,De,nn)}break;case 5:var It=he.return;try{Vi(he)}catch(nn){Ti(he,It,nn)}}}catch(nn){Ti(he,he.return,nn)}if(he===pe){Rn=null;break}var xt=he.sibling;if(xt!==null){xt.return=he.return,Rn=xt;break}Rn=he.return}}var el=0,Js=1,Qs=2,os=3,Sa=4;if(typeof Symbol=="function"&&Symbol.for){var $s=Symbol.for;el=$s("selector.component"),Js=$s("selector.has_pseudo_class"),Qs=$s("selector.role"),os=$s("selector.test_id"),Sa=$s("selector.text")}function tl(pe){var he=it(pe);if(he!=null){if(typeof he.memoizedProps["data-testname"]!="string")throw Error(ie(364));return he}if(pe=Je(pe),pe===null)throw Error(ie(362));return pe.stateNode.current}function nl(pe,he){switch(he.$$typeof){case el:if(pe.type===he.value)return!0;break;case Js:e:{he=he.value,pe=[pe,0];for(var Ge=0;Ge<pe.length;){var we=pe[Ge++],He=pe[Ge++],De=he[He];if(we.tag!==5||!ft(we)){for(;De!=null&&nl(we,De);)He++,De=he[He];if(He===he.length){he=!0;break e}else for(we=we.child;we!==null;)pe.push(we,He),we=we.sibling}}he=!1}return he;case Qs:if(pe.tag===5&&St(pe.stateNode,he.value))return!0;break;case Sa:if((pe.tag===5||pe.tag===6)&&(pe=lt(pe),pe!==null&&0<=pe.indexOf(he.value)))return!0;break;case os:if(pe.tag===5&&(pe=pe.memoizedProps["data-testname"],typeof pe=="string"&&pe.toLowerCase()===he.value.toLowerCase()))return!0;break;default:throw Error(ie(365))}return!1}function Zs(pe){switch(pe.$$typeof){case el:return"<"+(Ze(pe.value)||"Unknown")+">";case Js:return":has("+(Zs(pe)||"")+")";case Qs:return'[role="'+pe.value+'"]';case Sa:return'"'+pe.value+'"';case os:return'[data-testname="'+pe.value+'"]';default:throw Error(ie(365))}}function $i(pe,he){var Ge=[];pe=[pe,0];for(var we=0;we<pe.length;){var He=pe[we++],De=pe[we++],It=he[De];if(He.tag!==5||!ft(He)){for(;It!=null&&nl(He,It);)De++,It=he[De];if(De===he.length)Ge.push(He);else for(He=He.child;He!==null;)pe.push(He,De),He=He.sibling}}return Ge}function ss(pe,he){if(!Tt)throw Error(ie(363));pe=tl(pe),pe=$i(pe,he),he=[],pe=Array.from(pe);for(var Ge=0;Ge<pe.length;){var we=pe[Ge++];if(we.tag===5)ft(we)||he.push(we.stateNode);else for(we=we.child;we!==null;)pe.push(we),we=we.sibling}return he}var Ng=Math.ceil,rl=oe.ReactCurrentDispatcher,Go=oe.ReactCurrentOwner,Br=oe.ReactCurrentBatchConfig,gr=0,jr=null,Gr=null,Tr=0,wi=0,qs=bn(0),zr=0,Ra=null,Vo=0,qi=0,ea=0,as=null,Qr=null,il=0,_s=1/0;function ta(){_s=Wr()+500}var wa=!1,Mr=null,So=null,xa=!1,To=null,na=0,ra=0,ls=null,Zr=-1,Ur=0;function Cr(){return gr&6?Wr():Zr!==-1?Zr:Zr=Wr()}function Ro(pe){return pe.mode&1?gr&2&&Tr!==0?Tr&-Tr:bs.transition!==null?(Ur===0&&(pe=Rr,Rr<<=1,!(Rr&4194240)&&(Rr=64),Ur=pe),Ur):(pe=rr,pe!==0?pe:Et()):1}function xi(pe,he,Ge){if(50<ra)throw ra=0,ls=null,Error(ie(185));var we=Es(pe,he);return we===null?null:(oo(we,he,Ge),(!(gr&2)||we!==jr)&&(we===jr&&(!(gr&2)&&(qi|=he),zr===4&&bi(we,Tr)),Ki(we,Ge),he===1&&gr===0&&!(pe.mode&1)&&(ta(),Eo&&Si())),we)}function Es(pe,he){pe.lanes|=he;var Ge=pe.alternate;for(Ge!==null&&(Ge.lanes|=he),Ge=pe,pe=pe.return;pe!==null;)pe.childLanes|=he,Ge=pe.alternate,Ge!==null&&(Ge.childLanes|=he),Ge=pe,pe=pe.return;return Ge.tag===3?Ge.stateNode:null}function Ki(pe,he){var Ge=pe.callbackNode;la(pe,he);var we=hs(pe,pe===jr?Tr:0);if(we===0)Ge!==null&&_o(Ge),pe.callbackNode=null,pe.callbackPriority=0;else if(he=we&-we,pe.callbackPriority!==he){if(Ge!=null&&_o(Ge),he===1)pe.tag===0?ms(eo.bind(null,pe)):Ws(eo.bind(null,pe)),Zt?Ot(function(){gr===0&&Si()}):Ui(mo,Si),Ge=null;else{switch(so(we)){case 1:Ge=mo;break;case 4:Ge=ml;break;case 16:Ge=Gi;break;case 536870912:Ge=Cs;break;default:Ge=Gi}Ge=Ql(Ge,mi.bind(null,pe))}pe.callbackPriority=he,pe.callbackNode=Ge}}function mi(pe,he){if(Zr=-1,Ur=0,gr&6)throw Error(ie(327));var Ge=pe.callbackNode;if(No()&&pe.callbackNode!==Ge)return null;var we=hs(pe,pe===jr?Tr:0);if(we===0)return null;if(we&30||we&pe.expiredLanes||he)he=ll(pe,we);else{he=we;var He=gr;gr|=2;var De=Xg();(jr!==pe||Tr!==he)&&(ta(),gs(pe,he));do try{Ic();break}catch(xt){Hg(pe,xt)}while(!0);li(),rl.current=De,gr=He,Gr!==null?he=0:(jr=null,Tr=0,he=zr)}if(he!==0){if(he===2&&(He=Zo(pe),He!==0&&(we=He,he=ol(pe,He))),he===1)throw Ge=Ra,gs(pe,0),bi(pe,we),Ki(pe,Wr()),Ge;if(he===6)bi(pe,we);else{if(He=pe.current.alternate,!(we&30)&&!Lg(He)&&(he=ll(pe,we),he===2&&(De=Zo(pe),De!==0&&(we=De,he=ol(pe,De))),he===1))throw Ge=Ra,gs(pe,0),bi(pe,we),Ki(pe,Wr()),Ge;switch(pe.finishedWork=He,pe.finishedLanes=we,he){case 0:case 1:throw Error(ie(345));case 2:wo(pe,Qr);break;case 3:if(bi(pe,we),(we&130023424)===we&&(he=il+500-Wr(),10<he)){if(hs(pe,0)!==0)break;if(He=pe.suspendedLanes,(He&we)!==we){Cr(),pe.pingedLanes|=pe.suspendedLanes&He;break}pe.timeoutHandle=dt(wo.bind(null,pe,Qr),he);break}wo(pe,Qr);break;case 4:if(bi(pe,we),(we&4194240)===we)break;for(he=pe.eventTimes,He=-1;0<we;){var It=31-On(we);De=1<<It,It=he[It],It>He&&(He=It),we&=~De}if(we=He,we=Wr()-we,we=(120>we?120:480>we?480:1080>we?1080:1920>we?1920:3e3>we?3e3:4320>we?4320:1960*Ng(we/1960))-we,10<we){pe.timeoutHandle=dt(wo.bind(null,pe,Qr),we);break}wo(pe,Qr);break;case 5:wo(pe,Qr);break;default:throw Error(ie(329))}}}return Ki(pe,Wr()),pe.callbackNode===Ge?mi.bind(null,pe):null}function ol(pe,he){var Ge=as;return pe.current.memoizedState.isDehydrated&&(gs(pe,he).flags|=256),pe=ll(pe,he),pe!==2&&(he=Qr,Qr=Ge,he!==null&&sl(he)),pe}function sl(pe){Qr===null?Qr=pe:Qr.push.apply(Qr,pe)}function Lg(pe){for(var he=pe;;){if(he.flags&16384){var Ge=he.updateQueue;if(Ge!==null&&(Ge=Ge.stores,Ge!==null))for(var we=0;we<Ge.length;we++){var He=Ge[we],De=He.getSnapshot;He=He.value;try{if(!oi(De(),He))return!1}catch{return!1}}}if(Ge=he.child,he.subtreeFlags&16384&&Ge!==null)Ge.return=he,he=Ge;else{if(he===pe)break;for(;he.sibling===null;){if(he.return===null||he.return===pe)return!0;he=he.return}he.sibling.return=he.return,he=he.sibling}}return!0}function bi(pe,he){for(he&=~ea,he&=~qi,pe.suspendedLanes|=he,pe.pingedLanes&=~he,pe=pe.expirationTimes;0<he;){var Ge=31-On(he),we=1<<Ge;pe[Ge]=-1,he&=~we}}function eo(pe){if(gr&6)throw Error(ie(327));No();var he=hs(pe,0);if(!(he&1))return Ki(pe,Wr()),null;var Ge=ll(pe,he);if(pe.tag!==0&&Ge===2){var we=Zo(pe);we!==0&&(he=we,Ge=ol(pe,we))}if(Ge===1)throw Ge=Ra,gs(pe,0),bi(pe,he),Ki(pe,Wr()),Ge;if(Ge===6)throw Error(ie(345));return pe.finishedWork=pe.current.alternate,pe.finishedLanes=he,wo(pe,Qr),Ki(pe,Wr()),null}function Za(pe){To!==null&&To.tag===0&&!(gr&6)&&No();var he=gr;gr|=1;var Ge=Br.transition,we=rr;try{if(Br.transition=null,rr=1,pe)return pe()}finally{rr=we,Br.transition=Ge,gr=he,!(gr&6)&&Si()}}function al(){wi=qs.current,gn(qs)}function gs(pe,he){pe.finishedWork=null,pe.finishedLanes=0;var Ge=pe.timeoutHandle;if(Ge!==Ht&&(pe.timeoutHandle=Ht,bt(Ge)),Gr!==null)for(Ge=Gr.return;Ge!==null;){var we=Ge;switch(pg(we),we.tag){case 1:we=we.type.childContextTypes,we!=null&&Kn();break;case 3:Ca(),gn(Wn),gn(Jn),Hs();break;case 5:Cg(we);break;case 4:Ca();break;case 13:gn(Xr);break;case 19:gn(Xr);break;case 10:Jr(we.type._context);break;case 22:case 23:al()}Ge=Ge.return}if(jr=pe,Gr=pe=cs(pe.current,null),Tr=wi=he,zr=0,Ra=null,ea=qi=Vo=0,Qr=as=null,Ei!==null){for(he=0;he<Ei.length;he++)if(Ge=Ei[he],we=Ge.interleaved,we!==null){Ge.interleaved=null;var He=we.next,De=Ge.pending;if(De!==null){var It=De.next;De.next=He,we.next=It}Ge.pending=we}Ei=null}return pe}function Hg(pe,he){do{var Ge=Gr;try{if(li(),Ha.current=ya,_l){for(var we=kr.memoizedState;we!==null;){var He=we.queue;He!==null&&(He.pending=null),we=we.next}_l=!1}if(Xs=0,ci=gi=kr=null,Mo=!1,ks=0,Go.current=null,Ge===null||Ge.return===null){zr=1,Ra=he,Gr=null;break}e:{var De=pe,It=Ge.return,xt=Ge,nn=he;if(he=Tr,xt.flags|=32768,nn!==null&&typeof nn=="object"&&typeof nn.then=="function"){var mn=nn,Vn=xt,or=Vn.tag;if(!(Vn.mode&1)&&(or===0||or===11||or===15)){var jn=Vn.alternate;jn?(Vn.updateQueue=jn.updateQueue,Vn.memoizedState=jn.memoizedState,Vn.lanes=jn.lanes):(Vn.updateQueue=null,Vn.memoizedState=null)}var cr=Rg(It);if(cr!==null){cr.flags&=-257,Ks(cr,It,xt,De,he),cr.mode&1&&Jo(De,mn,he),he=cr,nn=mn;var En=he.updateQueue;if(En===null){var yi=new Set;yi.add(nn),he.updateQueue=yi}else En.add(nn);break e}else{if(!(he&1)){Jo(De,mn,he),Jl();break e}nn=Error(ie(426))}}else if(Vr&&xt.mode&1){var ro=Rg(It);if(ro!==null){!(ro.flags&65536)&&(ro.flags|=256),Ks(ro,It,xt,De,he),wl(nn);break e}}De=nn,zr!==4&&(zr=2),as===null?as=[De]:as.push(De),nn=Sg(nn,xt),xt=It;do{switch(xt.tag){case 3:xt.flags|=65536,he&=-he,xt.lanes|=he;var Kt=uc(xt,nn,he);yl(xt,Kt);break e;case 1:De=nn;var _t=xt.type,qt=xt.stateNode;if(!(xt.flags&128)&&(typeof _t.getDerivedStateFromError=="function"||qt!==null&&typeof qt.componentDidCatch=="function"&&(So===null||!So.has(qt)))){xt.flags|=65536,he&=-he,xt.lanes|=he;var _n=Xl(xt,De,he);yl(xt,_n);break e}}xt=xt.return}while(xt!==null)}Yg(Ge)}catch(Dn){he=Dn,Gr===Ge&&Ge!==null&&(Gr=Ge=Ge.return);continue}break}while(!0)}function Xg(){var pe=rl.current;return rl.current=ya,pe===null?ya:pe}function Jl(){(zr===0||zr===3||zr===2)&&(zr=4),jr===null||!(Vo&268435455)&&!(qi&268435455)||bi(jr,Tr)}function ll(pe,he){var Ge=gr;gr|=2;var we=Xg();jr===pe&&Tr===he||gs(pe,he);do try{pc();break}catch(He){Hg(pe,He)}while(!0);if(li(),gr=Ge,rl.current=we,Gr!==null)throw Error(ie(261));return jr=null,Tr=0,zr}function pc(){for(;Gr!==null;)kg(Gr)}function Ic(){for(;Gr!==null&&!ao();)kg(Gr)}function kg(pe){var he=zg(pe.alternate,pe,wi);pe.memoizedProps=pe.pendingProps,he===null?Yg(pe):Gr=he,Go.current=null}function Yg(pe){var he=pe;do{var Ge=he.alternate;if(pe=he.return,he.flags&32768){if(Ge=Ul(Ge,he),Ge!==null){Ge.flags&=32767,Gr=Ge;return}if(pe!==null)pe.flags|=32768,pe.subtreeFlags=0,pe.deletions=null;else{zr=6,Gr=null;return}}else if(Ge=Kl(Ge,he,wi),Ge!==null){Gr=Ge;return}if(he=he.sibling,he!==null){Gr=he;return}Gr=he=pe}while(he!==null);zr===0&&(zr=5)}function wo(pe,he){var Ge=rr,we=Br.transition;try{Br.transition=null,rr=1,hc(pe,he,Ge)}finally{Br.transition=we,rr=Ge}return null}function hc(pe,he,Ge){do No();while(To!==null);if(gr&6)throw Error(ie(327));var we=pe.finishedWork,He=pe.finishedLanes;if(we===null)return null;if(pe.finishedWork=null,pe.finishedLanes=0,we===pe.current)throw Error(ie(177));pe.callbackNode=null,pe.callbackPriority=0;var De=we.lanes|we.childLanes;if(Ao(pe,De),pe===jr&&(Gr=jr=null,Tr=0),!(we.subtreeFlags&2064)&&!(we.flags&2064)||xa||(xa=!0,Ql(Gi,function(){return No(),null})),De=(we.flags&15990)!==0,we.subtreeFlags&15990||De){De=Br.transition,Br.transition=null;var It=rr;rr=1;var xt=gr;gr|=4,Go.current=null,Eg(pe,we),zc(pe,we),Pe(pe.containerInfo),pe.current=we,$a(we),Al(),gr=xt,rr=It,Br.transition=De}else pe.current=we;if(xa&&(xa=!1,To=pe,na=He),De=pe.pendingLanes,De===0&&(So=null),Xo(we.stateNode),Ki(pe,Wr()),he!==null)for(Ge=pe.onRecoverableError,we=0;we<he.length;we++)Ge(he[we]);if(wa)throw wa=!1,pe=Mr,Mr=null,pe;return na&1&&pe.tag!==0&&No(),De=pe.pendingLanes,De&1?pe===ls?ra++:(ra=0,ls=pe):ra=0,Si(),null}function No(){if(To!==null){var pe=so(na),he=Br.transition,Ge=rr;try{if(Br.transition=null,rr=16>pe?16:pe,To===null)var we=!1;else{if(pe=To,To=null,na=0,gr&6)throw Error(ie(331));var He=gr;for(gr|=4,Rn=pe.current;Rn!==null;){var De=Rn,It=De.child;if(Rn.flags&16){var xt=De.deletions;if(xt!==null){for(var nn=0;nn<xt.length;nn++){var mn=xt[nn];for(Rn=mn;Rn!==null;){var Vn=Rn;switch(Vn.tag){case 0:case 11:case 15:rs(8,Vn,De)}var or=Vn.child;if(or!==null)or.return=Vn,Rn=or;else for(;Rn!==null;){Vn=Rn;var jn=Vn.sibling,cr=Vn.return;if(Mg(Vn),Vn===mn){Rn=null;break}if(jn!==null){jn.return=cr,Rn=jn;break}Rn=cr}}}var En=De.alternate;if(En!==null){var yi=En.child;if(yi!==null){En.child=null;do{var ro=yi.sibling;yi.sibling=null,yi=ro}while(yi!==null)}}Rn=De}}if(De.subtreeFlags&2064&&It!==null)It.return=De,Rn=It;else e:for(;Rn!==null;){if(De=Rn,De.flags&2048)switch(De.tag){case 0:case 11:case 15:rs(9,De,De.return)}var Kt=De.sibling;if(Kt!==null){Kt.return=De.return,Rn=Kt;break e}Rn=De.return}}var _t=pe.current;for(Rn=_t;Rn!==null;){It=Rn;var qt=It.child;if(It.subtreeFlags&2064&&qt!==null)qt.return=It,Rn=qt;else e:for(It=_t;Rn!==null;){if(xt=Rn,xt.flags&2048)try{switch(xt.tag){case 0:case 11:case 15:Ai(9,xt)}}catch(Dn){Ti(xt,xt.return,Dn)}if(xt===It){Rn=null;break e}var _n=xt.sibling;if(_n!==null){_n.return=xt.return,Rn=_n;break e}Rn=xt.return}}if(gr=He,Si(),Pi&&typeof Pi.onPostCommitFiberRoot=="function")try{Pi.onPostCommitFiberRoot(fs,pe)}catch{}we=!0}return we}finally{rr=Ge,Br.transition=he}}return!1}function gl(pe,he,Ge){he=Sg(Ge,he),he=uc(pe,he,1),ys(pe,he),he=Cr(),pe=Es(pe,1),pe!==null&&(oo(pe,1,he),Ki(pe,he))}function Ti(pe,he,Ge){if(pe.tag===3)gl(pe,pe,Ge);else for(;he!==null;){if(he.tag===3){gl(he,pe,Ge);break}else if(he.tag===1){var we=he.stateNode;if(typeof he.type.getDerivedStateFromError=="function"||typeof we.componentDidCatch=="function"&&(So===null||!So.has(we))){pe=Sg(Ge,pe),pe=Xl(he,pe,1),ys(he,pe),pe=Cr(),he=Es(he,1),he!==null&&(oo(he,1,pe),Ki(he,pe));break}}he=he.return}}function Kg(pe,he,Ge){var we=pe.pingCache;we!==null&&we.delete(he),he=Cr(),pe.pingedLanes|=pe.suspendedLanes&Ge,jr===pe&&(Tr&Ge)===Ge&&(zr===4||zr===3&&(Tr&130023424)===Tr&&500>Wr()-il?gs(pe,0):ea|=Ge),Ki(pe,he)}function Dg(pe,he){he===0&&(pe.mode&1?(he=lr,lr<<=1,!(lr&130023424)&&(lr=4194304)):he=1);var Ge=Cr();pe=Es(pe,he),pe!==null&&(oo(pe,he,Ge),Ki(pe,Ge))}function Cc(pe){var he=pe.memoizedState,Ge=0;he!==null&&(Ge=he.retryLane),Dg(pe,Ge)}function fc(pe,he){var Ge=0;switch(pe.tag){case 13:var we=pe.stateNode,He=pe.memoizedState;He!==null&&(Ge=He.retryLane);break;case 19:we=pe.stateNode;break;default:throw Error(ie(314))}we!==null&&we.delete(he),Dg(pe,Ge)}var zg;zg=function(pe,he,Ge){if(pe!==null)if(pe.memoizedProps!==he.pendingProps||Wn.current)di=!0;else{if(!(pe.lanes&Ge)&&!(he.flags&128))return di=!1,zl(pe,he,Ge);di=!!(pe.flags&131072)}else di=!1,Vr&&he.flags&1048576&&rc(he,Sl,he.index);switch(he.lanes=0,he.tag){case 2:var we=he.type;pe!==null&&(pe.alternate=null,he.alternate=null,he.flags|=2),pe=he.pendingProps;var He=Zn(he,Jn.current);Pr(he,Ge),He=fa(null,he,we,pe,He,Ge);var De=Ss();return he.flags|=1,typeof He=="object"&&He!==null&&typeof He.render=="function"&&He.$$typeof===void 0?(he.tag=1,he.memoizedState=null,he.updateQueue=null,nr(we)?(De=!0,tr(he)):De=!1,he.memoizedState=He.state!==null&&He.state!==void 0?He.state:null,ga(he),He.updater=Bl,he.stateNode=He,He._reactInternals=he,ug(he,we,pe,Ge),he=Ri(null,he,we,!0,De,Ge)):(he.tag=0,Vr&&De&&dg(he),Dr(null,he,He,Ge),he=he.child),he;case 16:we=he.elementType;e:{switch(pe!==null&&(pe.alternate=null,he.alternate=null,he.flags|=2),pe=he.pendingProps,He=we._init,we=He(we._payload),he.type=we,He=he.tag=Uc(we),pe=ai(we,pe),He){case 0:he=qo(null,he,we,pe,Ge);break e;case 1:he=zs(null,he,we,pe,Ge);break e;case 11:he=xr(null,he,we,pe,Ge);break e;case 14:he=Sr(null,he,we,ai(we.type,pe),Ge);break e}throw Error(ie(306,we,""))}return he;case 0:return we=he.type,He=he.pendingProps,He=he.elementType===we?He:ai(we,He),qo(pe,he,we,He,Ge);case 1:return we=he.type,He=he.pendingProps,He=he.elementType===we?He:ai(we,He),zs(pe,he,we,He,Ge);case 3:e:{if(Oa(he),pe===null)throw Error(ie(387));we=he.pendingProps,De=he.memoizedState,He=De.element,lg(pe,he),vl(he,we,null,Ge);var It=he.memoizedState;if(we=It.element,Ft&&De.isDehydrated)if(De={element:we,isDehydrated:!1,cache:It.cache,transitions:It.transitions},he.updateQueue.baseState=De,he.memoizedState=De,he.flags&256){He=Error(ie(423)),he=xg(pe,he,we,Ge,He);break e}else if(we!==He){He=Error(ie(424)),he=xg(pe,he,we,Ge,He);break e}else for(Ft&&(Ci=Lr(he.stateNode.containerInfo),Mi=he,Vr=!0,uo=null,ua=!1),Ge=sc(he,null,we,Ge),he.child=Ge;Ge;)Ge.flags=Ge.flags&-3|4096,Ge=Ge.sibling;else{if(da(),we===He){he=Yi(pe,he,Ge);break e}Dr(pe,he,we,Ge)}he=he.child}return he;case 5:return ac(he),pe===null&&Bs(he),we=he.type,He=he.pendingProps,De=pe!==null?pe.memoizedProps:null,It=He.children,gt(we,He)?It=null:De!==null&&gt(we,De)&&(he.flags|=32),Fi(pe,he),Dr(pe,he,It,Ge),he.child;case 6:return pe===null&&Bs(he),null;case 13:return Zg(pe,he,Ge);case 4:return xl(he,he.stateNode.containerInfo),we=he.pendingProps,pe===null?he.child=Oo(he,null,we,Ge):Dr(pe,he,we,Ge),he.child;case 11:return we=he.type,He=he.pendingProps,He=he.elementType===we?He:ai(we,He),xr(pe,he,we,He,Ge);case 7:return Dr(pe,he,he.pendingProps,Ge),he.child;case 8:return Dr(pe,he,he.pendingProps.children,Ge),he.child;case 12:return Dr(pe,he,he.pendingProps.children,Ge),he.child;case 10:e:{if(we=he.type._context,He=he.pendingProps,De=he.memoizedProps,It=He.value,Do(he,we,It),De!==null)if(oi(De.value,It)){if(De.children===He.children&&!Wn.current){he=Yi(pe,he,Ge);break e}}else for(De=he.child,De!==null&&(De.return=he);De!==null;){var xt=De.dependencies;if(xt!==null){It=De.child;for(var nn=xt.firstContext;nn!==null;){if(nn.context===we){if(De.tag===1){nn=zo(-1,Ge&-Ge),nn.tag=2;var mn=De.updateQueue;if(mn!==null){mn=mn.shared;var Vn=mn.pending;Vn===null?nn.next=nn:(nn.next=Vn.next,Vn.next=nn),mn.pending=nn}}De.lanes|=Ge,nn=De.alternate,nn!==null&&(nn.lanes|=Ge),ti(De.return,Ge,he),xt.lanes|=Ge;break}nn=nn.next}}else if(De.tag===10)It=De.type===he.type?null:De.child;else if(De.tag===18){if(It=De.return,It===null)throw Error(ie(341));It.lanes|=Ge,xt=It.alternate,xt!==null&&(xt.lanes|=Ge),ti(It,Ge,he),It=De.sibling}else It=De.child;if(It!==null)It.return=De;else for(It=De;It!==null;){if(It===he){It=null;break}if(De=It.sibling,De!==null){De.return=It.return,It=De;break}It=It.return}De=It}Dr(pe,he,He.children,Ge),he=he.child}return he;case 9:return He=he.type,we=he.pendingProps.children,Pr(he,Ge),He=Hr(He),we=we(He),he.flags|=1,Dr(pe,he,we,Ge),he.child;case 14:return we=he.type,He=ai(we,he.pendingProps),He=ai(we.type,He),Sr(pe,he,we,He,Ge);case 15:return $o(pe,he,he.type,he.pendingProps,Ge);case 17:return we=he.type,He=he.pendingProps,He=he.elementType===we?He:ai(we,He),pe!==null&&(pe.alternate=null,he.alternate=null,he.flags|=2),he.tag=1,nr(we)?(pe=!0,tr(he)):pe=!1,Pr(he,Ge),tc(he,we,He),ug(he,we,He,Ge),Ri(null,he,we,!0,pe,Ge);case 19:return Ps(pe,he,Ge);case 22:return fi(pe,he,Ge)}throw Error(ie(156,he.tag))};function Ql(pe,he){return Ui(pe,he)}function Ac(pe,he,Ge,we){this.tag=pe,this.key=Ge,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=he,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=we,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function no(pe,he,Ge,we){return new Ac(pe,he,Ge,we)}function $l(pe){return pe=pe.prototype,!(!pe||!pe.isReactComponent)}function Uc(pe){if(typeof pe=="function")return $l(pe)?1:0;if(pe!=null){if(pe=pe.$$typeof,pe===be)return 11;if(pe===ve)return 14}return 2}function cs(pe,he){var Ge=pe.alternate;return Ge===null?(Ge=no(pe.tag,he,pe.key,pe.mode),Ge.elementType=pe.elementType,Ge.type=pe.type,Ge.stateNode=pe.stateNode,Ge.alternate=pe,pe.alternate=Ge):(Ge.pendingProps=he,Ge.type=pe.type,Ge.flags=0,Ge.subtreeFlags=0,Ge.deletions=null),Ge.flags=pe.flags&14680064,Ge.childLanes=pe.childLanes,Ge.lanes=pe.lanes,Ge.child=pe.child,Ge.memoizedProps=pe.memoizedProps,Ge.memoizedState=pe.memoizedState,Ge.updateQueue=pe.updateQueue,he=pe.dependencies,Ge.dependencies=he===null?null:{lanes:he.lanes,firstContext:he.firstContext},Ge.sibling=pe.sibling,Ge.index=pe.index,Ge.ref=pe.ref,Ge}function ql(pe,he,Ge,we,He,De){var It=2;if(we=pe,typeof pe=="function")$l(pe)&&(It=1);else if(typeof pe=="string")It=5;else e:switch(pe){case ge:return ia(Ge.children,He,De,he);case ce:It=8,He|=8;break;case de:return pe=no(12,Ge,he,He|2),pe.elementType=de,pe.lanes=De,pe;case Ae:return pe=no(13,Ge,he,He),pe.elementType=Ae,pe.lanes=De,pe;case ye:return pe=no(19,Ge,he,He),pe.elementType=ye,pe.lanes=De,pe;case Re:return cl(Ge,He,De,he);default:if(typeof pe=="object"&&pe!==null)switch(pe.$$typeof){case Ie:It=10;break e;case fe:It=9;break e;case be:It=11;break e;case ve:It=14;break e;case Be:It=16,we=null;break e}throw Error(ie(130,pe==null?pe:typeof pe,""))}return he=no(It,Ge,he,He),he.elementType=pe,he.type=we,he.lanes=De,he}function ia(pe,he,Ge,we){return pe=no(7,pe,we,he),pe.lanes=Ge,pe}function cl(pe,he,Ge,we){return pe=no(22,pe,we,he),pe.elementType=Re,pe.lanes=Ge,pe.stateNode={},pe}function eg(pe,he,Ge){return pe=no(6,pe,null,he),pe.lanes=Ge,pe}function tg(pe,he,Ge){return he=no(4,pe.children!==null?pe.children:[],pe.key,he),he.lanes=Ge,he.stateNode={containerInfo:pe.containerInfo,pendingChildren:null,implementation:pe.implementation},he}function ng(pe,he,Ge,we,He){this.tag=he,this.containerInfo=pe,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=Ht,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Fs(0),this.expirationTimes=Fs(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Fs(0),this.identifierPrefix=we,this.onRecoverableError=He,Ft&&(this.mutableSourceEagerHydrationData=null)}function mc(pe,he,Ge,we,He,De,It,xt,nn){return pe=new ng(pe,he,Ge,xt,nn),he===1?(he=1,De===!0&&(he|=8)):he=0,De=no(3,null,null,he),pe.current=De,De.stateNode=pe,De.memoizedState={element:we,isDehydrated:Ge,cache:null,transitions:null},ga(De),pe}function bc(pe){if(!pe)return wn;pe=pe._reactInternals;e:{if(Fe(pe)!==pe||pe.tag!==1)throw Error(ie(170));var he=pe;do{switch(he.tag){case 3:he=he.stateNode.context;break e;case 1:if(nr(he.type)){he=he.stateNode.__reactInternalMemoizedMergedChildContext;break e}}he=he.return}while(he!==null);throw Error(ie(171))}if(pe.tag===1){var Ge=pe.type;if(nr(Ge))return Ar(pe,Ge,he)}return he}function yc(pe){var he=pe._reactInternals;if(he===void 0)throw typeof pe.render=="function"?Error(ie(188)):(pe=Object.keys(pe).join(","),Error(ie(268,pe)));return pe=Le(he),pe===null?null:pe.stateNode}function ho(pe,he){if(pe=pe.memoizedState,pe!==null&&pe.dehydrated!==null){var Ge=pe.retryLane;pe.retryLane=Ge!==0&&Ge<he?Ge:he}}function ul(pe,he){ho(pe,he),(pe=pe.alternate)&&ho(pe,he)}function rg(pe){return pe=Le(pe),pe===null?null:pe.stateNode}function vc(){return null}return _.attemptContinuousHydration=function(pe){if(pe.tag===13){var he=Cr();xi(pe,134217728,he),ul(pe,134217728)}},_.attemptHydrationAtCurrentPriority=function(pe){if(pe.tag===13){var he=Cr(),Ge=Ro(pe);xi(pe,Ge,he),ul(pe,Ge)}},_.attemptSynchronousHydration=function(pe){switch(pe.tag){case 3:var he=pe.stateNode;if(he.current.memoizedState.isDehydrated){var Ge=ii(he.pendingLanes);Ge!==0&&(hi(he,Ge|1),Ki(he,Wr()),!(gr&6)&&(ta(),Si()))}break;case 13:var we=Cr();Za(function(){return xi(pe,1,we)}),ul(pe,1)}},_.batchedUpdates=function(pe,he){var Ge=gr;gr|=1;try{return pe(he)}finally{gr=Ge,gr===0&&(ta(),Eo&&Si())}},_.createComponentSelector=function(pe){return{$$typeof:el,value:pe}},_.createContainer=function(pe,he,Ge,we,He,De,It){return mc(pe,he,!1,null,Ge,we,He,De,It)},_.createHasPseudoClassSelector=function(pe){return{$$typeof:Js,value:pe}},_.createHydrationContainer=function(pe,he,Ge,we,He,De,It,xt,nn){return pe=mc(Ge,we,!0,pe,He,De,It,xt,nn),pe.context=bc(null),Ge=pe.current,we=Cr(),He=Ro(Ge),De=zo(we,He),De.callback=he??null,ys(Ge,De),pe.current.lanes=He,oo(pe,He,we),Ki(pe,we),pe},_.createPortal=function(pe,he,Ge){var we=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:ae,key:we==null?null:""+we,children:pe,containerInfo:he,implementation:Ge}},_.createRoleSelector=function(pe){return{$$typeof:Qs,value:pe}},_.createTestNameSelector=function(pe){return{$$typeof:os,value:pe}},_.createTextSelector=function(pe){return{$$typeof:Sa,value:pe}},_.deferredUpdates=function(pe){var he=rr,Ge=Br.transition;try{return Br.transition=null,rr=16,pe()}finally{rr=he,Br.transition=Ge}},_.discreteUpdates=function(pe,he,Ge,we,He){var De=rr,It=Br.transition;try{return Br.transition=null,rr=1,pe(he,Ge,we,He)}finally{rr=De,Br.transition=It,gr===0&&ta()}},_.findAllNodes=ss,_.findBoundingRects=function(pe,he){if(!Tt)throw Error(ie(363));he=ss(pe,he),pe=[];for(var Ge=0;Ge<he.length;Ge++)pe.push(Oe(he[Ge]));for(he=pe.length-1;0<he;he--){Ge=pe[he];for(var we=Ge.x,He=we+Ge.width,De=Ge.y,It=De+Ge.height,xt=he-1;0<=xt;xt--)if(he!==xt){var nn=pe[xt],mn=nn.x,Vn=mn+nn.width,or=nn.y,jn=or+nn.height;if(we>=mn&&De>=or&&He<=Vn&&It<=jn){pe.splice(he,1);break}else if(we!==mn||Ge.width!==nn.width||jn<De||or>It){if(!(De!==or||Ge.height!==nn.height||Vn<we||mn>He)){mn>we&&(nn.width+=mn-we,nn.x=we),Vn<He&&(nn.width=He-mn),pe.splice(he,1);break}}else{or>De&&(nn.height+=or-De,nn.y=De),jn<It&&(nn.height=It-or),pe.splice(he,1);break}}}return pe},_.findHostInstance=yc,_.findHostInstanceWithNoPortals=function(pe){return pe=ke(pe),pe=pe!==null?Ue(pe):null,pe===null?null:pe.stateNode},_.findHostInstanceWithWarning=function(pe){return yc(pe)},_.flushControlled=function(pe){var he=gr;gr|=1;var Ge=Br.transition,we=rr;try{Br.transition=null,rr=1,pe()}finally{rr=we,Br.transition=Ge,gr=he,gr===0&&(ta(),Si())}},_.flushPassiveEffects=No,_.flushSync=Za,_.focusWithin=function(pe,he){if(!Tt)throw Error(ie(363));for(pe=tl(pe),he=$i(pe,he),he=Array.from(he),pe=0;pe<he.length;){var Ge=he[pe++];if(!ft(Ge)){if(Ge.tag===5&&Wt(Ge.stateNode))return!0;for(Ge=Ge.child;Ge!==null;)he.push(Ge),Ge=Ge.sibling}}return!1},_.getCurrentUpdatePriority=function(){return rr},_.getFindAllNodesFailureDescription=function(pe,he){if(!Tt)throw Error(ie(363));var Ge=0,we=[];pe=[tl(pe),0];for(var He=0;He<pe.length;){var De=pe[He++],It=pe[He++],xt=he[It];if((De.tag!==5||!ft(De))&&(nl(De,xt)&&(we.push(Zs(xt)),It++,It>Ge&&(Ge=It)),It<he.length))for(De=De.child;De!==null;)pe.push(De,It),De=De.sibling}if(Ge<he.length){for(pe=[];Ge<he.length;Ge++)pe.push(Zs(he[Ge]));return`findAllNodes was able to match part of the selector:
  `+(we.join(" > ")+`

No matching component was found for:
  `)+pe.join(" > ")}return null},_.getPublicRootInstance=function(pe){if(pe=pe.current,!pe.child)return null;switch(pe.child.tag){case 5:return tt(pe.child.stateNode);default:return pe.child.stateNode}},_.injectIntoDevTools=function(pe){if(pe={bundleType:pe.bundleType,version:pe.version,rendererPackageName:pe.rendererPackageName,rendererConfig:pe.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:oe.ReactCurrentDispatcher,findHostInstanceByFiber:rg,findFiberByHostInstance:pe.findFiberByHostInstance||vc,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.0.0-fc46dba67-20220329"},typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u")pe=!1;else{var he=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(he.isDisabled||!he.supportsFiber)pe=!0;else{try{fs=he.inject(pe),Pi=he}catch{}pe=!!he.checkDCE}}return pe},_.isAlreadyRendering=function(){return!1},_.observeVisibleRects=function(pe,he,Ge,we){if(!Tt)throw Error(ie(363));pe=ss(pe,he);var He=zt(pe,Ge,we).disconnect;return{disconnect:function(){He()}}},_.registerMutableSourceForHydration=function(pe,he){var Ge=he._getVersion;Ge=Ge(he._source),pe.mutableSourceEagerHydrationData==null?pe.mutableSourceEagerHydrationData=[he,Ge]:pe.mutableSourceEagerHydrationData.push(he,Ge)},_.runWithPriority=function(pe,he){var Ge=rr;try{return rr=pe,he()}finally{rr=Ge}},_.shouldError=function(){return null},_.shouldSuspend=function(){return!1},_.updateContainer=function(pe,he,Ge,we){var He=he.current,De=Cr(),It=Ro(He);return Ge=bc(Ge),he.context===null?he.context=Ge:he.pendingContext=Ge,he=zo(De,It),he.payload={element:pe},we=we===void 0?null:we,we!==null&&(he.callback=we),ys(He,he),pe=xi(He,It,De),pe!==null&&bl(pe,He,It),It},_}),reactReconciler_production_min}var hasRequiredReactReconciler;function requireReactReconciler(){return hasRequiredReactReconciler||(hasRequiredReactReconciler=1,reactReconciler.exports=requireReactReconciler_production_min()),reactReconciler.exports}var reactReconcilerExports=requireReactReconciler();const Reconciler=getDefaultExportFromCjs(reactReconcilerExports);var scheduler={exports:{}},scheduler_production_min={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var hasRequiredScheduler_production_min;function requireScheduler_production_min(){return hasRequiredScheduler_production_min||(hasRequiredScheduler_production_min=1,function(X){function Z(ze,qe){var Pe=ze.length;ze.push(qe);e:for(;0<Pe;){var Ye=Pe-1>>>1,$e=ze[Ye];if(0<te($e,qe))ze[Ye]=qe,ze[Pe]=$e,Pe=Ye;else break e}}function _(ze){return ze.length===0?null:ze[0]}function K(ze){if(ze.length===0)return null;var qe=ze[0],Pe=ze.pop();if(Pe!==qe){ze[0]=Pe;e:for(var Ye=0,$e=ze.length,ut=$e>>>1;Ye<ut;){var ot=2*(Ye+1)-1,gt=ze[ot],ht=ot+1,dt=ze[ht];if(0>te(gt,Pe))ht<$e&&0>te(dt,gt)?(ze[Ye]=dt,ze[ht]=Pe,Ye=ht):(ze[Ye]=gt,ze[ot]=Pe,Ye=ot);else if(ht<$e&&0>te(dt,Pe))ze[Ye]=dt,ze[ht]=Pe,Ye=ht;else break e}}return qe}function te(ze,qe){var Pe=ze.sortIndex-qe.sortIndex;return Pe!==0?Pe:ze.id-qe.id}if(typeof performance=="object"&&typeof performance.now=="function"){var ne=performance;X.unstable_now=function(){return ne.now()}}else{var ie=Date,oe=ie.now();X.unstable_now=function(){return ie.now()-oe}}var se=[],ae=[],ge=1,ce=null,de=3,Ie=!1,fe=!1,be=!1,Ae=typeof setTimeout=="function"?setTimeout:null,ye=typeof clearTimeout=="function"?clearTimeout:null,ve=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function Be(ze){for(var qe=_(ae);qe!==null;){if(qe.callback===null)K(ae);else if(qe.startTime<=ze)K(ae),qe.sortIndex=qe.expirationTime,Z(se,qe);else break;qe=_(ae)}}function Re(ze){if(be=!1,Be(ze),!fe)if(_(se)!==null)fe=!0,tt(Ve);else{var qe=_(ae);qe!==null&&at(Re,qe.startTime-ze)}}function Ve(ze,qe){fe=!1,be&&(be=!1,ye(_e),_e=-1),Ie=!0;var Pe=de;try{for(Be(qe),ce=_(se);ce!==null&&(!(ce.expirationTime>qe)||ze&&!ke());){var Ye=ce.callback;if(typeof Ye=="function"){ce.callback=null,de=ce.priorityLevel;var $e=Ye(ce.expirationTime<=qe);qe=X.unstable_now(),typeof $e=="function"?ce.callback=$e:ce===_(se)&&K(se),Be(qe)}else K(se);ce=_(se)}if(ce!==null)var ut=!0;else{var ot=_(ae);ot!==null&&at(Re,ot.startTime-qe),ut=!1}return ut}finally{ce=null,de=Pe,Ie=!1}}var Ee=!1,Ze=null,_e=-1,Fe=5,Te=-1;function ke(){return!(X.unstable_now()-Te<Fe)}function Le(){if(Ze!==null){var ze=X.unstable_now();Te=ze;var qe=!0;try{qe=Ze(!0,ze)}finally{qe?Ke():(Ee=!1,Ze=null)}}else Ee=!1}var Ke;if(typeof ve=="function")Ke=function(){ve(Le)};else if(typeof MessageChannel<"u"){var Ue=new MessageChannel,rt=Ue.port2;Ue.port1.onmessage=Le,Ke=function(){rt.postMessage(null)}}else Ke=function(){Ae(Le,0)};function tt(ze){Ze=ze,Ee||(Ee=!0,Ke())}function at(ze,qe){_e=Ae(function(){ze(X.unstable_now())},qe)}X.unstable_IdlePriority=5,X.unstable_ImmediatePriority=1,X.unstable_LowPriority=4,X.unstable_NormalPriority=3,X.unstable_Profiling=null,X.unstable_UserBlockingPriority=2,X.unstable_cancelCallback=function(ze){ze.callback=null},X.unstable_continueExecution=function(){fe||Ie||(fe=!0,tt(Ve))},X.unstable_forceFrameRate=function(ze){0>ze||125<ze?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):Fe=0<ze?Math.floor(1e3/ze):5},X.unstable_getCurrentPriorityLevel=function(){return de},X.unstable_getFirstCallbackNode=function(){return _(se)},X.unstable_next=function(ze){switch(de){case 1:case 2:case 3:var qe=3;break;default:qe=de}var Pe=de;de=qe;try{return ze()}finally{de=Pe}},X.unstable_pauseExecution=function(){},X.unstable_requestPaint=function(){},X.unstable_runWithPriority=function(ze,qe){switch(ze){case 1:case 2:case 3:case 4:case 5:break;default:ze=3}var Pe=de;de=ze;try{return qe()}finally{de=Pe}},X.unstable_scheduleCallback=function(ze,qe,Pe){var Ye=X.unstable_now();switch(typeof Pe=="object"&&Pe!==null?(Pe=Pe.delay,Pe=typeof Pe=="number"&&0<Pe?Ye+Pe:Ye):Pe=Ye,ze){case 1:var $e=-1;break;case 2:$e=250;break;case 5:$e=1073741823;break;case 4:$e=1e4;break;default:$e=5e3}return $e=Pe+$e,ze={id:ge++,callback:qe,priorityLevel:ze,startTime:Pe,expirationTime:$e,sortIndex:-1},Pe>Ye?(ze.sortIndex=Pe,Z(ae,ze),_(se)===null&&ze===_(ae)&&(be?(ye(_e),_e=-1):be=!0,at(Re,Pe-Ye))):(ze.sortIndex=$e,Z(se,ze),fe||Ie||(fe=!0,tt(Ve))),ze},X.unstable_shouldYield=ke,X.unstable_wrapCallback=function(ze){var qe=de;return function(){var Pe=de;de=qe;try{return ze.apply(this,arguments)}finally{de=Pe}}}}(scheduler_production_min)),scheduler_production_min}var hasRequiredScheduler;function requireScheduler(){return hasRequiredScheduler||(hasRequiredScheduler=1,scheduler.exports=requireScheduler_production_min()),scheduler.exports}var schedulerExports=requireScheduler();const catalogue={},extend=X=>void Object.assign(catalogue,X);function createRenderer(X,Z){function _(ge,{args:ce=[],attach:de,...Ie},fe){let be=`${ge[0].toUpperCase()}${ge.slice(1)}`,Ae;if(ge==="primitive"){if(Ie.object===void 0)throw new Error("R3F: Primitives without 'object' are invalid!");const ye=Ie.object;Ae=prepare$1(ye,{type:ge,root:fe,attach:de,primitive:!0})}else{const ye=catalogue[be];if(!ye)throw new Error(`R3F: ${be} is not part of the THREE namespace! Did you forget to extend? See: https://docs.pmnd.rs/react-three-fiber/api/objects#using-3rd-party-objects-declaratively`);if(!Array.isArray(ce))throw new Error("R3F: The args prop must be an array!");Ae=prepare$1(new ye(...ce),{type:ge,root:fe,attach:de,memoizedProps:{args:ce}})}return Ae.__r3f.attach===void 0&&(Ae.isBufferGeometry?Ae.__r3f.attach="geometry":Ae.isMaterial&&(Ae.__r3f.attach="material")),be!=="inject"&&applyProps$1(Ae,Ie),Ae}function K(ge,ce){let de=!1;if(ce){var Ie,fe;(Ie=ce.__r3f)!=null&&Ie.attach?attach(ge,ce,ce.__r3f.attach):ce.isObject3D&&ge.isObject3D&&(ge.add(ce),de=!0),de||(fe=ge.__r3f)==null||fe.objects.push(ce),ce.__r3f||prepare$1(ce,{}),ce.__r3f.parent=ge,updateInstance(ce),invalidateInstance(ce)}}function te(ge,ce,de){let Ie=!1;if(ce){var fe,be;if((fe=ce.__r3f)!=null&&fe.attach)attach(ge,ce,ce.__r3f.attach);else if(ce.isObject3D&&ge.isObject3D){ce.parent=ge,ce.dispatchEvent({type:"added"}),ge.dispatchEvent({type:"childadded",child:ce});const Ae=ge.children.filter(ve=>ve!==ce),ye=Ae.indexOf(de);ge.children=[...Ae.slice(0,ye),ce,...Ae.slice(ye)],Ie=!0}Ie||(be=ge.__r3f)==null||be.objects.push(ce),ce.__r3f||prepare$1(ce,{}),ce.__r3f.parent=ge,updateInstance(ce),invalidateInstance(ce)}}function ne(ge,ce,de=!1){ge&&[...ge].forEach(Ie=>ie(ce,Ie,de))}function ie(ge,ce,de){if(ce){var Ie,fe,be;if(ce.__r3f&&(ce.__r3f.parent=null),(Ie=ge.__r3f)!=null&&Ie.objects&&(ge.__r3f.objects=ge.__r3f.objects.filter(Re=>Re!==ce)),(fe=ce.__r3f)!=null&&fe.attach)detach(ge,ce,ce.__r3f.attach);else if(ce.isObject3D&&ge.isObject3D){var Ae;ge.remove(ce),(Ae=ce.__r3f)!=null&&Ae.root&&removeInteractivity(findInitialRoot(ce),ce)}const ve=(be=ce.__r3f)==null?void 0:be.primitive,Be=!ve&&(de===void 0?ce.dispose!==null:de);if(!ve){var ye;ne((ye=ce.__r3f)==null?void 0:ye.objects,ce,Be),ne(ce.children,ce,Be)}if(delete ce.__r3f,Be&&ce.dispose&&ce.type!=="Scene"){const Re=()=>{try{ce.dispose()}catch{}};typeof IS_REACT_ACT_ENVIRONMENT>"u"?schedulerExports.unstable_scheduleCallback(schedulerExports.unstable_IdlePriority,Re):Re()}invalidateInstance(ge)}}function oe(ge,ce,de,Ie){var fe;const be=(fe=ge.__r3f)==null?void 0:fe.parent;if(!be)return;const Ae=_(ce,de,ge.__r3f.root);if(ge.children){for(const ye of ge.children)ye.__r3f&&K(Ae,ye);ge.children=ge.children.filter(ye=>!ye.__r3f)}ge.__r3f.objects.forEach(ye=>K(Ae,ye)),ge.__r3f.objects=[],ge.__r3f.autoRemovedBeforeAppend||ie(be,ge),Ae.parent&&(Ae.__r3f.autoRemovedBeforeAppend=!0),K(be,Ae),Ae.raycast&&Ae.__r3f.eventCount&&findInitialRoot(Ae).getState().internal.interaction.push(Ae),[Ie,Ie.alternate].forEach(ye=>{ye!==null&&(ye.stateNode=Ae,ye.ref&&(typeof ye.ref=="function"?ye.ref(Ae):ye.ref.current=Ae))})}const se=()=>{};return{reconciler:Reconciler({createInstance:_,removeChild:ie,appendChild:K,appendInitialChild:K,insertBefore:te,supportsMutation:!0,isPrimaryRenderer:!1,supportsPersistence:!1,supportsHydration:!1,noTimeout:-1,appendChildToContainer:(ge,ce)=>{if(!ce)return;const de=ge.getState().scene;de.__r3f&&(de.__r3f.root=ge,K(de,ce))},removeChildFromContainer:(ge,ce)=>{ce&&ie(ge.getState().scene,ce)},insertInContainerBefore:(ge,ce,de)=>{if(!ce||!de)return;const Ie=ge.getState().scene;Ie.__r3f&&te(Ie,ce,de)},getRootHostContext:()=>null,getChildHostContext:ge=>ge,finalizeInitialChildren(ge){var ce;return!!((ce=ge==null?void 0:ge.__r3f)!=null?ce:{}).handlers},prepareUpdate(ge,ce,de,Ie){var fe;if(((fe=ge==null?void 0:ge.__r3f)!=null?fe:{}).primitive&&Ie.object&&Ie.object!==ge)return[!0];{const{args:Ae=[],children:ye,...ve}=Ie,{args:Be=[],children:Re,...Ve}=de;if(!Array.isArray(Ae))throw new Error("R3F: the args prop must be an array!");if(Ae.some((Ze,_e)=>Ze!==Be[_e]))return[!0];const Ee=diffProps(ge,ve,Ve,!0);return Ee.changes.length?[!1,Ee]:null}},commitUpdate(ge,[ce,de],Ie,fe,be,Ae){ce?oe(ge,Ie,be,Ae):applyProps$1(ge,de)},commitMount(ge,ce,de,Ie){var fe;const be=(fe=ge.__r3f)!=null?fe:{};ge.raycast&&be.handlers&&be.eventCount&&findInitialRoot(ge).getState().internal.interaction.push(ge)},getPublicInstance:ge=>ge,prepareForCommit:()=>null,preparePortalMount:ge=>prepare$1(ge.getState().scene),resetAfterCommit:()=>{},shouldSetTextContent:()=>!1,clearContainer:()=>!1,hideInstance(ge){var ce;const{attach:de,parent:Ie}=(ce=ge.__r3f)!=null?ce:{};de&&Ie&&detach(Ie,ge,de),ge.isObject3D&&(ge.visible=!1),invalidateInstance(ge)},unhideInstance(ge,ce){var de;const{attach:Ie,parent:fe}=(de=ge.__r3f)!=null?de:{};Ie&&fe&&attach(fe,ge,Ie),(ge.isObject3D&&ce.visible==null||ce.visible)&&(ge.visible=!0),invalidateInstance(ge)},createTextInstance:se,hideTextInstance:se,unhideTextInstance:se,getCurrentEventPriority:()=>Z(),beforeActiveInstanceBlur:()=>{},afterActiveInstanceBlur:()=>{},detachDeletedInstance:()=>{},now:typeof performance<"u"&&is$1.fun(performance.now)?performance.now:is$1.fun(Date.now)?Date.now:()=>0,scheduleTimeout:is$1.fun(setTimeout)?setTimeout:void 0,cancelTimeout:is$1.fun(clearTimeout)?clearTimeout:void 0}),applyProps:applyProps$1}}var _window$document,_window$navigator;const hasColorSpace$1=X=>"colorSpace"in X||"outputColorSpace"in X,getColorManagement=()=>{var X;return(X=catalogue.ColorManagement)!=null?X:null},isOrthographicCamera=X=>X&&X.isOrthographicCamera,isRef$1=X=>X&&X.hasOwnProperty("current"),useIsomorphicLayoutEffect$2=typeof window<"u"&&((_window$document=window.document)!=null&&_window$document.createElement||((_window$navigator=window.navigator)==null?void 0:_window$navigator.product)==="ReactNative")?reactExports.useLayoutEffect:reactExports.useEffect;function useMutableCallback(X){const Z=reactExports.useRef(X);return useIsomorphicLayoutEffect$2(()=>void(Z.current=X),[X]),Z}function Block({set:X}){return useIsomorphicLayoutEffect$2(()=>(X(new Promise(()=>null)),()=>X(!1)),[X]),null}class ErrorBoundary extends reactExports.Component{constructor(...Z){super(...Z),this.state={error:!1}}componentDidCatch(Z){this.props.set(Z)}render(){return this.state.error?null:this.props.children}}ErrorBoundary.getDerivedStateFromError=()=>({error:!0});const DEFAULT="__default",DEFAULTS=new Map,isDiffSet=X=>X&&!!X.memoized&&!!X.changes;function calculateDpr(X){var Z;const _=typeof window<"u"?(Z=window.devicePixelRatio)!=null?Z:2:1;return Array.isArray(X)?Math.min(Math.max(X[0],_),X[1]):X}const getRootState=X=>{var Z;return(Z=X.__r3f)==null?void 0:Z.root.getState()};function findInitialRoot(X){let Z=X.__r3f.root;for(;Z.getState().previousRoot;)Z=Z.getState().previousRoot;return Z}const is$1={obj:X=>X===Object(X)&&!is$1.arr(X)&&typeof X!="function",fun:X=>typeof X=="function",str:X=>typeof X=="string",num:X=>typeof X=="number",boo:X=>typeof X=="boolean",und:X=>X===void 0,arr:X=>Array.isArray(X),equ(X,Z,{arrays:_="shallow",objects:K="reference",strict:te=!0}={}){if(typeof X!=typeof Z||!!X!=!!Z)return!1;if(is$1.str(X)||is$1.num(X)||is$1.boo(X))return X===Z;const ne=is$1.obj(X);if(ne&&K==="reference")return X===Z;const ie=is$1.arr(X);if(ie&&_==="reference")return X===Z;if((ie||ne)&&X===Z)return!0;let oe;for(oe in X)if(!(oe in Z))return!1;if(ne&&_==="shallow"&&K==="shallow"){for(oe in te?Z:X)if(!is$1.equ(X[oe],Z[oe],{strict:te,objects:"reference"}))return!1}else for(oe in te?Z:X)if(X[oe]!==Z[oe])return!1;if(is$1.und(oe)){if(ie&&X.length===0&&Z.length===0||ne&&Object.keys(X).length===0&&Object.keys(Z).length===0)return!0;if(X!==Z)return!1}return!0}};function buildGraph(X){const Z={nodes:{},materials:{}};return X&&X.traverse(_=>{_.name&&(Z.nodes[_.name]=_),_.material&&!Z.materials[_.material.name]&&(Z.materials[_.material.name]=_.material)}),Z}function dispose(X){X.dispose&&X.type!=="Scene"&&X.dispose();for(const Z in X)Z.dispose==null||Z.dispose(),delete X[Z]}function prepare$1(X,Z){const _=X;return _.__r3f={type:"",root:null,previousAttach:null,memoizedProps:{},eventCount:0,handlers:{},objects:[],parent:null,...Z},X}function resolve(X,Z){let _=X;if(Z.includes("-")){const K=Z.split("-"),te=K.pop();return _=K.reduce((ne,ie)=>ne[ie],X),{target:_,key:te}}else return{target:_,key:Z}}const INDEX_REGEX=/-\d+$/;function attach(X,Z,_){if(is$1.str(_)){if(INDEX_REGEX.test(_)){const ne=_.replace(INDEX_REGEX,""),{target:ie,key:oe}=resolve(X,ne);Array.isArray(ie[oe])||(ie[oe]=[])}const{target:K,key:te}=resolve(X,_);Z.__r3f.previousAttach=K[te],K[te]=Z}else Z.__r3f.previousAttach=_(X,Z)}function detach(X,Z,_){var K,te;if(is$1.str(_)){const{target:ne,key:ie}=resolve(X,_),oe=Z.__r3f.previousAttach;oe===void 0?delete ne[ie]:ne[ie]=oe}else(K=Z.__r3f)==null||K.previousAttach==null||K.previousAttach(X,Z);(te=Z.__r3f)==null||delete te.previousAttach}function diffProps(X,{children:Z,key:_,ref:K,...te},{children:ne,key:ie,ref:oe,...se}={},ae=!1){const ge=X.__r3f,ce=Object.entries(te),de=[];if(ae){const fe=Object.keys(se);for(let be=0;be<fe.length;be++)te.hasOwnProperty(fe[be])||ce.unshift([fe[be],DEFAULT+"remove"])}ce.forEach(([fe,be])=>{var Ae;if((Ae=X.__r3f)!=null&&Ae.primitive&&fe==="object"||is$1.equ(be,se[fe]))return;if(/^on(Pointer|Click|DoubleClick|ContextMenu|Wheel)/.test(fe))return de.push([fe,be,!0,[]]);let ye=[];fe.includes("-")&&(ye=fe.split("-")),de.push([fe,be,!1,ye]);for(const ve in te){const Be=te[ve];ve.startsWith(`${fe}-`)&&de.push([ve,Be,!1,ve.split("-")])}});const Ie={...te};return ge!=null&&ge.memoizedProps&&ge!=null&&ge.memoizedProps.args&&(Ie.args=ge.memoizedProps.args),ge!=null&&ge.memoizedProps&&ge!=null&&ge.memoizedProps.attach&&(Ie.attach=ge.memoizedProps.attach),{memoized:Ie,changes:de}}function applyProps$1(X,Z){var _;const K=X.__r3f,te=K==null?void 0:K.root,ne=te==null||te.getState==null?void 0:te.getState(),{memoized:ie,changes:oe}=isDiffSet(Z)?Z:diffProps(X,Z),se=K==null?void 0:K.eventCount;X.__r3f&&(X.__r3f.memoizedProps=ie);for(let de=0;de<oe.length;de++){let[Ie,fe,be,Ae]=oe[de];if(hasColorSpace$1(X)){const Re="srgb",Ve="srgb-linear";Ie==="encoding"?(Ie="colorSpace",fe=fe===3001?Re:Ve):Ie==="outputEncoding"&&(Ie="outputColorSpace",fe=fe===3001?Re:Ve)}let ye=X,ve=ye[Ie];if(Ae.length&&(ve=Ae.reduce((Be,Re)=>Be[Re],X),!(ve&&ve.set))){const[Be,...Re]=Ae.reverse();ye=Re.reverse().reduce((Ve,Ee)=>Ve[Ee],X),Ie=Be}if(fe===DEFAULT+"remove")if(ye.constructor){let Be=DEFAULTS.get(ye.constructor);Be||(Be=new ye.constructor,DEFAULTS.set(ye.constructor,Be)),fe=Be[Ie]}else fe=0;if(be&&K)fe?K.handlers[Ie]=fe:delete K.handlers[Ie],K.eventCount=Object.keys(K.handlers).length;else if(ve&&ve.set&&(ve.copy||ve instanceof Layers)){if(Array.isArray(fe))ve.fromArray?ve.fromArray(fe):ve.set(...fe);else if(ve.copy&&fe&&fe.constructor&&ve.constructor===fe.constructor)ve.copy(fe);else if(fe!==void 0){var ae;const Be=(ae=ve)==null?void 0:ae.isColor;!Be&&ve.setScalar?ve.setScalar(fe):ve instanceof Layers&&fe instanceof Layers?ve.mask=fe.mask:ve.set(fe),!getColorManagement()&&ne&&!ne.linear&&Be&&ve.convertSRGBToLinear()}}else{var ge;if(ye[Ie]=fe,(ge=ye[Ie])!=null&&ge.isTexture&&ye[Ie].format===RGBAFormat&&ye[Ie].type===UnsignedByteType&&ne){const Be=ye[Ie];hasColorSpace$1(Be)&&hasColorSpace$1(ne.gl)?Be.colorSpace=ne.gl.outputColorSpace:Be.encoding=ne.gl.outputEncoding}}invalidateInstance(X)}if(K&&K.parent&&X.raycast&&se!==K.eventCount){const de=findInitialRoot(X).getState().internal,Ie=de.interaction.indexOf(X);Ie>-1&&de.interaction.splice(Ie,1),K.eventCount&&de.interaction.push(X)}return!(oe.length===1&&oe[0][0]==="onUpdate")&&oe.length&&(_=X.__r3f)!=null&&_.parent&&updateInstance(X),X}function invalidateInstance(X){var Z,_;const K=(Z=X.__r3f)==null||(_=Z.root)==null||_.getState==null?void 0:_.getState();K&&K.internal.frames===0&&K.invalidate()}function updateInstance(X){X.onUpdate==null||X.onUpdate(X)}function updateCamera(X,Z){X.manual||(isOrthographicCamera(X)?(X.left=Z.width/-2,X.right=Z.width/2,X.top=Z.height/2,X.bottom=Z.height/-2):X.aspect=Z.width/Z.height,X.updateProjectionMatrix(),X.updateMatrixWorld())}function makeId(X){return(X.eventObject||X.object).uuid+"/"+X.index+X.instanceId}function getEventPriority(){var X;const Z=typeof self<"u"&&self||typeof window<"u"&&window;if(!Z)return constantsExports.DefaultEventPriority;switch((X=Z.event)==null?void 0:X.type){case"click":case"contextmenu":case"dblclick":case"pointercancel":case"pointerdown":case"pointerup":return constantsExports.DiscreteEventPriority;case"pointermove":case"pointerout":case"pointerover":case"pointerenter":case"pointerleave":case"wheel":return constantsExports.ContinuousEventPriority;default:return constantsExports.DefaultEventPriority}}function releaseInternalPointerCapture(X,Z,_,K){const te=_.get(Z);te&&(_.delete(Z),_.size===0&&(X.delete(K),te.target.releasePointerCapture(K)))}function removeInteractivity(X,Z){const{internal:_}=X.getState();_.interaction=_.interaction.filter(K=>K!==Z),_.initialHits=_.initialHits.filter(K=>K!==Z),_.hovered.forEach((K,te)=>{(K.eventObject===Z||K.object===Z)&&_.hovered.delete(te)}),_.capturedMap.forEach((K,te)=>{releaseInternalPointerCapture(_.capturedMap,Z,K,te)})}function createEvents(X){function Z(se){const{internal:ae}=X.getState(),ge=se.offsetX-ae.initialClick[0],ce=se.offsetY-ae.initialClick[1];return Math.round(Math.sqrt(ge*ge+ce*ce))}function _(se){return se.filter(ae=>["Move","Over","Enter","Out","Leave"].some(ge=>{var ce;return(ce=ae.__r3f)==null?void 0:ce.handlers["onPointer"+ge]}))}function K(se,ae){const ge=X.getState(),ce=new Set,de=[],Ie=ae?ae(ge.internal.interaction):ge.internal.interaction;for(let ye=0;ye<Ie.length;ye++){const ve=getRootState(Ie[ye]);ve&&(ve.raycaster.camera=void 0)}ge.previousRoot||ge.events.compute==null||ge.events.compute(se,ge);function fe(ye){const ve=getRootState(ye);if(!ve||!ve.events.enabled||ve.raycaster.camera===null)return[];if(ve.raycaster.camera===void 0){var Be;ve.events.compute==null||ve.events.compute(se,ve,(Be=ve.previousRoot)==null?void 0:Be.getState()),ve.raycaster.camera===void 0&&(ve.raycaster.camera=null)}return ve.raycaster.camera?ve.raycaster.intersectObject(ye,!0):[]}let be=Ie.flatMap(fe).sort((ye,ve)=>{const Be=getRootState(ye.object),Re=getRootState(ve.object);return!Be||!Re?ye.distance-ve.distance:Re.events.priority-Be.events.priority||ye.distance-ve.distance}).filter(ye=>{const ve=makeId(ye);return ce.has(ve)?!1:(ce.add(ve),!0)});ge.events.filter&&(be=ge.events.filter(be,ge));for(const ye of be){let ve=ye.object;for(;ve;){var Ae;(Ae=ve.__r3f)!=null&&Ae.eventCount&&de.push({...ye,eventObject:ve}),ve=ve.parent}}if("pointerId"in se&&ge.internal.capturedMap.has(se.pointerId))for(let ye of ge.internal.capturedMap.get(se.pointerId).values())ce.has(makeId(ye.intersection))||de.push(ye.intersection);return de}function te(se,ae,ge,ce){const de=X.getState();if(se.length){const Ie={stopped:!1};for(const fe of se){const be=getRootState(fe.object)||de,{raycaster:Ae,pointer:ye,camera:ve,internal:Be}=be,Re=new Vector3(ye.x,ye.y,0).unproject(ve),Ve=Te=>{var ke,Le;return(ke=(Le=Be.capturedMap.get(Te))==null?void 0:Le.has(fe.eventObject))!=null?ke:!1},Ee=Te=>{const ke={intersection:fe,target:ae.target};Be.capturedMap.has(Te)?Be.capturedMap.get(Te).set(fe.eventObject,ke):Be.capturedMap.set(Te,new Map([[fe.eventObject,ke]])),ae.target.setPointerCapture(Te)},Ze=Te=>{const ke=Be.capturedMap.get(Te);ke&&releaseInternalPointerCapture(Be.capturedMap,fe.eventObject,ke,Te)};let _e={};for(let Te in ae){let ke=ae[Te];typeof ke!="function"&&(_e[Te]=ke)}let Fe={...fe,..._e,pointer:ye,intersections:se,stopped:Ie.stopped,delta:ge,unprojectedPoint:Re,ray:Ae.ray,camera:ve,stopPropagation(){const Te="pointerId"in ae&&Be.capturedMap.get(ae.pointerId);if((!Te||Te.has(fe.eventObject))&&(Fe.stopped=Ie.stopped=!0,Be.hovered.size&&Array.from(Be.hovered.values()).find(ke=>ke.eventObject===fe.eventObject))){const ke=se.slice(0,se.indexOf(fe));ne([...ke,fe])}},target:{hasPointerCapture:Ve,setPointerCapture:Ee,releasePointerCapture:Ze},currentTarget:{hasPointerCapture:Ve,setPointerCapture:Ee,releasePointerCapture:Ze},nativeEvent:ae};if(ce(Fe),Ie.stopped===!0)break}}return se}function ne(se){const{internal:ae}=X.getState();for(const ge of ae.hovered.values())if(!se.length||!se.find(ce=>ce.object===ge.object&&ce.index===ge.index&&ce.instanceId===ge.instanceId)){const de=ge.eventObject.__r3f,Ie=de==null?void 0:de.handlers;if(ae.hovered.delete(makeId(ge)),de!=null&&de.eventCount){const fe={...ge,intersections:se};Ie.onPointerOut==null||Ie.onPointerOut(fe),Ie.onPointerLeave==null||Ie.onPointerLeave(fe)}}}function ie(se,ae){for(let ge=0;ge<ae.length;ge++){const ce=ae[ge].__r3f;ce==null||ce.handlers.onPointerMissed==null||ce.handlers.onPointerMissed(se)}}function oe(se){switch(se){case"onPointerLeave":case"onPointerCancel":return()=>ne([]);case"onLostPointerCapture":return ae=>{const{internal:ge}=X.getState();"pointerId"in ae&&ge.capturedMap.has(ae.pointerId)&&requestAnimationFrame(()=>{ge.capturedMap.has(ae.pointerId)&&(ge.capturedMap.delete(ae.pointerId),ne([]))})}}return function(ge){const{onPointerMissed:ce,internal:de}=X.getState();de.lastEvent.current=ge;const Ie=se==="onPointerMove",fe=se==="onClick"||se==="onContextMenu"||se==="onDoubleClick",Ae=K(ge,Ie?_:void 0),ye=fe?Z(ge):0;se==="onPointerDown"&&(de.initialClick=[ge.offsetX,ge.offsetY],de.initialHits=Ae.map(Be=>Be.eventObject)),fe&&!Ae.length&&ye<=2&&(ie(ge,de.interaction),ce&&ce(ge)),Ie&&ne(Ae);function ve(Be){const Re=Be.eventObject,Ve=Re.__r3f,Ee=Ve==null?void 0:Ve.handlers;if(Ve!=null&&Ve.eventCount)if(Ie){if(Ee.onPointerOver||Ee.onPointerEnter||Ee.onPointerOut||Ee.onPointerLeave){const Ze=makeId(Be),_e=de.hovered.get(Ze);_e?_e.stopped&&Be.stopPropagation():(de.hovered.set(Ze,Be),Ee.onPointerOver==null||Ee.onPointerOver(Be),Ee.onPointerEnter==null||Ee.onPointerEnter(Be))}Ee.onPointerMove==null||Ee.onPointerMove(Be)}else{const Ze=Ee[se];Ze?(!fe||de.initialHits.includes(Re))&&(ie(ge,de.interaction.filter(_e=>!de.initialHits.includes(_e))),Ze(Be)):fe&&de.initialHits.includes(Re)&&ie(ge,de.interaction.filter(_e=>!de.initialHits.includes(_e)))}}te(Ae,ge,ye,ve)}}return{handlePointer:oe}}const privateKeys=["set","get","setSize","setFrameloop","setDpr","events","invalidate","advance","size","viewport"],isRenderer=X=>!!(X!=null&&X.render),context=reactExports.createContext(null),createStore$1=(X,Z)=>{const _=create$1((oe,se)=>{const ae=new Vector3,ge=new Vector3,ce=new Vector3;function de(ye=se().camera,ve=ge,Be=se().size){const{width:Re,height:Ve,top:Ee,left:Ze}=Be,_e=Re/Ve;ve.isVector3?ce.copy(ve):ce.set(...ve);const Fe=ye.getWorldPosition(ae).distanceTo(ce);if(isOrthographicCamera(ye))return{width:Re/ye.zoom,height:Ve/ye.zoom,top:Ee,left:Ze,factor:1,distance:Fe,aspect:_e};{const Te=ye.fov*Math.PI/180,ke=2*Math.tan(Te/2)*Fe,Le=ke*(Re/Ve);return{width:Le,height:ke,top:Ee,left:Ze,factor:Re/Le,distance:Fe,aspect:_e}}}let Ie;const fe=ye=>oe(ve=>({performance:{...ve.performance,current:ye}})),be=new Vector2;return{set:oe,get:se,gl:null,camera:null,raycaster:null,events:{priority:1,enabled:!0,connected:!1},xr:null,scene:null,invalidate:(ye=1)=>X(se(),ye),advance:(ye,ve)=>Z(ye,ve,se()),legacy:!1,linear:!1,flat:!1,controls:null,clock:new Clock,pointer:be,mouse:be,frameloop:"always",onPointerMissed:void 0,performance:{current:1,min:.5,max:1,debounce:200,regress:()=>{const ye=se();Ie&&clearTimeout(Ie),ye.performance.current!==ye.performance.min&&fe(ye.performance.min),Ie=setTimeout(()=>fe(se().performance.max),ye.performance.debounce)}},size:{width:0,height:0,top:0,left:0,updateStyle:!1},viewport:{initialDpr:0,dpr:0,width:0,height:0,top:0,left:0,aspect:0,distance:0,factor:0,getCurrentViewport:de},setEvents:ye=>oe(ve=>({...ve,events:{...ve.events,...ye}})),setSize:(ye,ve,Be,Re,Ve)=>{const Ee=se().camera,Ze={width:ye,height:ve,top:Re||0,left:Ve||0,updateStyle:Be};oe(_e=>({size:Ze,viewport:{..._e.viewport,...de(Ee,ge,Ze)}}))},setDpr:ye=>oe(ve=>{const Be=calculateDpr(ye);return{viewport:{...ve.viewport,dpr:Be,initialDpr:ve.viewport.initialDpr||Be}}}),setFrameloop:(ye="always")=>{const ve=se().clock;ve.stop(),ve.elapsedTime=0,ye!=="never"&&(ve.start(),ve.elapsedTime=0),oe(()=>({frameloop:ye}))},previousRoot:void 0,internal:{active:!1,priority:0,frames:0,lastEvent:reactExports.createRef(),interaction:[],hovered:new Map,subscribers:[],initialClick:[0,0],initialHits:[],capturedMap:new Map,subscribe:(ye,ve,Be)=>{const Re=se().internal;return Re.priority=Re.priority+(ve>0?1:0),Re.subscribers.push({ref:ye,priority:ve,store:Be}),Re.subscribers=Re.subscribers.sort((Ve,Ee)=>Ve.priority-Ee.priority),()=>{const Ve=se().internal;Ve!=null&&Ve.subscribers&&(Ve.priority=Ve.priority-(ve>0?1:0),Ve.subscribers=Ve.subscribers.filter(Ee=>Ee.ref!==ye))}}}}}),K=_.getState();let te=K.size,ne=K.viewport.dpr,ie=K.camera;return _.subscribe(()=>{const{camera:oe,size:se,viewport:ae,gl:ge,set:ce}=_.getState();if(se.width!==te.width||se.height!==te.height||ae.dpr!==ne){var de;te=se,ne=ae.dpr,updateCamera(oe,se),ge.setPixelRatio(ae.dpr);const Ie=(de=se.updateStyle)!=null?de:typeof HTMLCanvasElement<"u"&&ge.domElement instanceof HTMLCanvasElement;ge.setSize(se.width,se.height,Ie)}oe!==ie&&(ie=oe,ce(Ie=>({viewport:{...Ie.viewport,...Ie.viewport.getCurrentViewport(oe)}})))}),_.subscribe(oe=>X(oe)),_};function createSubs(X,Z){const _={callback:X};return Z.add(_),()=>void Z.delete(_)}let i$6,globalEffects=new Set,globalAfterEffects=new Set,globalTailEffects=new Set;const addEffect=X=>createSubs(X,globalEffects);function run(X,Z){if(X.size)for(const{callback:_}of X.values())_(Z)}function flushGlobalEffects(X,Z){switch(X){case"before":return run(globalEffects,Z);case"after":return run(globalAfterEffects,Z);case"tail":return run(globalTailEffects,Z)}}let subscribers,subscription;function render$1(X,Z,_){let K=Z.clock.getDelta();for(Z.frameloop==="never"&&typeof X=="number"&&(K=X-Z.clock.elapsedTime,Z.clock.oldTime=Z.clock.elapsedTime,Z.clock.elapsedTime=X),subscribers=Z.internal.subscribers,i$6=0;i$6<subscribers.length;i$6++)subscription=subscribers[i$6],subscription.ref.current(subscription.store.getState(),K,_);return!Z.internal.priority&&Z.gl.render&&Z.gl.render(Z.scene,Z.camera),Z.internal.frames=Math.max(0,Z.internal.frames-1),Z.frameloop==="always"?1:Z.internal.frames}function createLoop(X){let Z=!1,_=!1,K,te,ne;function ie(ae){te=requestAnimationFrame(ie),Z=!0,K=0,flushGlobalEffects("before",ae),_=!0;for(const ce of X.values()){var ge;ne=ce.store.getState(),ne.internal.active&&(ne.frameloop==="always"||ne.internal.frames>0)&&!((ge=ne.gl.xr)!=null&&ge.isPresenting)&&(K+=render$1(ae,ne))}if(_=!1,flushGlobalEffects("after",ae),K===0)return flushGlobalEffects("tail",ae),Z=!1,cancelAnimationFrame(te)}function oe(ae,ge=1){var ce;if(!ae)return X.forEach(de=>oe(de.store.getState(),ge));(ce=ae.gl.xr)!=null&&ce.isPresenting||!ae.internal.active||ae.frameloop==="never"||(ge>1?ae.internal.frames=Math.min(60,ae.internal.frames+ge):_?ae.internal.frames=2:ae.internal.frames=1,Z||(Z=!0,requestAnimationFrame(ie)))}function se(ae,ge=!0,ce,de){if(ge&&flushGlobalEffects("before",ae),ce)render$1(ae,ce,de);else for(const Ie of X.values())render$1(ae,Ie.store.getState());ge&&flushGlobalEffects("after",ae)}return{loop:ie,invalidate:oe,advance:se}}function useStore(){const X=reactExports.useContext(context);if(!X)throw new Error("R3F: Hooks can only be used within the Canvas component!");return X}function useThree(X=_=>_,Z){return useStore()(X,Z)}function useFrame(X,Z=0){const _=useStore(),K=_.getState().internal.subscribe,te=useMutableCallback(X);return useIsomorphicLayoutEffect$2(()=>K(te,Z,_),[Z,K,_]),null}const memoizedLoaders=new WeakMap;function loadingFn(X,Z){return function(_,...K){let te=memoizedLoaders.get(_);return te||(te=new _,memoizedLoaders.set(_,te)),X&&X(te),Promise.all(K.map(ne=>new Promise((ie,oe)=>te.load(ne,se=>{se.scene&&Object.assign(se,buildGraph(se.scene)),ie(se)},Z,se=>oe(new Error(`Could not load ${ne}: ${se==null?void 0:se.message}`))))))}}function useLoader(X,Z,_,K){const te=Array.isArray(Z)?Z:[Z],ne=suspend(loadingFn(_,K),[X,...te],{equal:is$1.equ});return Array.isArray(Z)?ne:ne[0]}useLoader.preload=function(X,Z,_){const K=Array.isArray(Z)?Z:[Z];return preload(loadingFn(_),[X,...K])};useLoader.clear=function(X,Z){const _=Array.isArray(Z)?Z:[Z];return clear([X,..._])};const roots=new Map,{invalidate,advance:advance$1}=createLoop(roots),{reconciler,applyProps}=createRenderer(roots,getEventPriority),shallowLoose={objects:"shallow",strict:!1},createRendererInstance=(X,Z)=>{const _=typeof X=="function"?X(Z):X;return isRenderer(_)?_:new WebGLRenderer({powerPreference:"high-performance",canvas:Z,antialias:!0,alpha:!0,...X})};function computeInitialSize(X,Z){const _=typeof HTMLCanvasElement<"u"&&X instanceof HTMLCanvasElement;if(Z){const{width:K,height:te,top:ne,left:ie,updateStyle:oe=_}=Z;return{width:K,height:te,top:ne,left:ie,updateStyle:oe}}else if(typeof HTMLCanvasElement<"u"&&X instanceof HTMLCanvasElement&&X.parentElement){const{width:K,height:te,top:ne,left:ie}=X.parentElement.getBoundingClientRect();return{width:K,height:te,top:ne,left:ie,updateStyle:_}}else if(typeof OffscreenCanvas<"u"&&X instanceof OffscreenCanvas)return{width:X.width,height:X.height,top:0,left:0,updateStyle:_};return{width:0,height:0,top:0,left:0}}function createRoot(X){const Z=roots.get(X),_=Z==null?void 0:Z.fiber,K=Z==null?void 0:Z.store;Z&&console.warn("R3F.createRoot should only be called once!");const te=typeof reportError=="function"?reportError:console.error,ne=K||createStore$1(invalidate,advance$1),ie=_||reconciler.createContainer(ne,constantsExports.ConcurrentRoot,null,!1,null,"",te,null);Z||roots.set(X,{fiber:ie,store:ne});let oe,se=!1,ae;return{configure(ge={}){let{gl:ce,size:de,scene:Ie,events:fe,onCreated:be,shadows:Ae=!1,linear:ye=!1,flat:ve=!1,legacy:Be=!1,orthographic:Re=!1,frameloop:Ve="always",dpr:Ee=[1,2],performance:Ze,raycaster:_e,camera:Fe,onPointerMissed:Te}=ge,ke=ne.getState(),Le=ke.gl;ke.gl||ke.set({gl:Le=createRendererInstance(ce,X)});let Ke=ke.raycaster;Ke||ke.set({raycaster:Ke=new Raycaster});const{params:Ue,...rt}=_e||{};if(is$1.equ(rt,Ke,shallowLoose)||applyProps(Ke,{...rt}),is$1.equ(Ue,Ke.params,shallowLoose)||applyProps(Ke,{params:{...Ke.params,...Ue}}),!ke.camera||ke.camera===ae&&!is$1.equ(ae,Fe,shallowLoose)){ae=Fe;const Pe=Fe instanceof Camera,Ye=Pe?Fe:Re?new OrthographicCamera(0,0,0,0,.1,1e3):new PerspectiveCamera(75,0,.1,1e3);Pe||(Ye.position.z=5,Fe&&(applyProps(Ye,Fe),("aspect"in Fe||"left"in Fe||"right"in Fe||"bottom"in Fe||"top"in Fe)&&(Ye.manual=!0,Ye.updateProjectionMatrix())),!ke.camera&&!(Fe!=null&&Fe.rotation)&&Ye.lookAt(0,0,0)),ke.set({camera:Ye}),Ke.camera=Ye}if(!ke.scene){let Pe;Ie!=null&&Ie.isScene?Pe=Ie:(Pe=new Scene$1,Ie&&applyProps(Pe,Ie)),ke.set({scene:prepare$1(Pe)})}if(!ke.xr){var tt;const Pe=(ut,ot)=>{const gt=ne.getState();gt.frameloop!=="never"&&advance$1(ut,!0,gt,ot)},Ye=()=>{const ut=ne.getState();ut.gl.xr.enabled=ut.gl.xr.isPresenting,ut.gl.xr.setAnimationLoop(ut.gl.xr.isPresenting?Pe:null),ut.gl.xr.isPresenting||invalidate(ut)},$e={connect(){const ut=ne.getState().gl;ut.xr.addEventListener("sessionstart",Ye),ut.xr.addEventListener("sessionend",Ye)},disconnect(){const ut=ne.getState().gl;ut.xr.removeEventListener("sessionstart",Ye),ut.xr.removeEventListener("sessionend",Ye)}};typeof((tt=Le.xr)==null?void 0:tt.addEventListener)=="function"&&$e.connect(),ke.set({xr:$e})}if(Le.shadowMap){const Pe=Le.shadowMap.enabled,Ye=Le.shadowMap.type;if(Le.shadowMap.enabled=!!Ae,is$1.boo(Ae))Le.shadowMap.type=PCFSoftShadowMap;else if(is$1.str(Ae)){var at;const $e={basic:BasicShadowMap,percentage:PCFShadowMap,soft:PCFSoftShadowMap,variance:VSMShadowMap};Le.shadowMap.type=(at=$e[Ae])!=null?at:PCFSoftShadowMap}else is$1.obj(Ae)&&Object.assign(Le.shadowMap,Ae);(Pe!==Le.shadowMap.enabled||Ye!==Le.shadowMap.type)&&(Le.shadowMap.needsUpdate=!0)}const ze=getColorManagement();ze&&("enabled"in ze?ze.enabled=!Be:"legacyMode"in ze&&(ze.legacyMode=Be)),se||applyProps(Le,{outputEncoding:ye?3e3:3001,toneMapping:ve?NoToneMapping:ACESFilmicToneMapping}),ke.legacy!==Be&&ke.set(()=>({legacy:Be})),ke.linear!==ye&&ke.set(()=>({linear:ye})),ke.flat!==ve&&ke.set(()=>({flat:ve})),ce&&!is$1.fun(ce)&&!isRenderer(ce)&&!is$1.equ(ce,Le,shallowLoose)&&applyProps(Le,ce),fe&&!ke.events.handlers&&ke.set({events:fe(ne)});const qe=computeInitialSize(X,de);return is$1.equ(qe,ke.size,shallowLoose)||ke.setSize(qe.width,qe.height,qe.updateStyle,qe.top,qe.left),Ee&&ke.viewport.dpr!==calculateDpr(Ee)&&ke.setDpr(Ee),ke.frameloop!==Ve&&ke.setFrameloop(Ve),ke.onPointerMissed||ke.set({onPointerMissed:Te}),Ze&&!is$1.equ(Ze,ke.performance,shallowLoose)&&ke.set(Pe=>({performance:{...Pe.performance,...Ze}})),oe=be,se=!0,this},render(ge){return se||this.configure(),reconciler.updateContainer(jsxRuntimeExports.jsx(Provider,{store:ne,children:ge,onCreated:oe,rootElement:X}),ie,null,()=>{}),ne},unmount(){unmountComponentAtNode(X)}}}function Provider({store:X,children:Z,onCreated:_,rootElement:K}){return useIsomorphicLayoutEffect$2(()=>{const te=X.getState();te.set(ne=>({internal:{...ne.internal,active:!0}})),_&&_(te),X.getState().events.connected||te.events.connect==null||te.events.connect(K)},[]),jsxRuntimeExports.jsx(context.Provider,{value:X,children:Z})}function unmountComponentAtNode(X,Z){const _=roots.get(X),K=_==null?void 0:_.fiber;if(K){const te=_==null?void 0:_.store.getState();te&&(te.internal.active=!1),reconciler.updateContainer(null,K,null,()=>{te&&setTimeout(()=>{try{var ne,ie,oe,se;te.events.disconnect==null||te.events.disconnect(),(ne=te.gl)==null||(ie=ne.renderLists)==null||ie.dispose==null||ie.dispose(),(oe=te.gl)==null||oe.forceContextLoss==null||oe.forceContextLoss(),(se=te.gl)!=null&&se.xr&&te.xr.disconnect(),dispose(te),roots.delete(X)}catch{}},500)})}}function createPortal(X,Z,_){return jsxRuntimeExports.jsx(Portal$1,{children:X,container:Z,state:_},Z.uuid)}function Portal$1({state:X={},children:Z,container:_}){const{events:K,size:te,...ne}=X,ie=useStore(),[oe]=reactExports.useState(()=>new Raycaster),[se]=reactExports.useState(()=>new Vector2),ae=reactExports.useCallback((ce,de)=>{const Ie={...ce};Object.keys(ce).forEach(be=>{(privateKeys.includes(be)||ce[be]!==de[be]&&de[be])&&delete Ie[be]});let fe;if(de&&te){const be=de.camera;fe=ce.viewport.getCurrentViewport(be,new Vector3,te),be!==ce.camera&&updateCamera(be,te)}return{...Ie,scene:_,raycaster:oe,pointer:se,mouse:se,previousRoot:ie,events:{...ce.events,...de==null?void 0:de.events,...K},size:{...ce.size,...te},viewport:{...ce.viewport,...fe},...ne}},[X]),[ge]=reactExports.useState(()=>{const ce=ie.getState();return create$1((Ie,fe)=>({...ce,scene:_,raycaster:oe,pointer:se,mouse:se,previousRoot:ie,events:{...ce.events,...K},size:{...ce.size,...te},...ne,set:Ie,get:fe,setEvents:be=>Ie(Ae=>({...Ae,events:{...Ae.events,...be}}))}))});return reactExports.useEffect(()=>{const ce=ie.subscribe(de=>ge.setState(Ie=>ae(de,Ie)));return()=>{ce()}},[ae]),reactExports.useEffect(()=>{ge.setState(ce=>ae(ie.getState(),ce))},[ae]),reactExports.useEffect(()=>()=>{ge.destroy()},[]),jsxRuntimeExports.jsx(jsxRuntimeExports.Fragment,{children:reconciler.createPortal(jsxRuntimeExports.jsx(context.Provider,{value:ge,children:Z}),ge,null)})}reconciler.injectIntoDevTools({bundleType:0,rendererPackageName:"@react-three/fiber",version:reactExports.version});const DOM_EVENTS={onClick:["click",!1],onContextMenu:["contextmenu",!1],onDoubleClick:["dblclick",!1],onWheel:["wheel",!0],onPointerDown:["pointerdown",!0],onPointerUp:["pointerup",!0],onPointerLeave:["pointerleave",!0],onPointerMove:["pointermove",!0],onPointerCancel:["pointercancel",!0],onLostPointerCapture:["lostpointercapture",!0]};function createPointerEvents(X){const{handlePointer:Z}=createEvents(X);return{priority:1,enabled:!0,compute(_,K,te){K.pointer.set(_.offsetX/K.size.width*2-1,-(_.offsetY/K.size.height)*2+1),K.raycaster.setFromCamera(K.pointer,K.camera)},connected:void 0,handlers:Object.keys(DOM_EVENTS).reduce((_,K)=>({..._,[K]:Z(K)}),{}),update:()=>{var _;const{events:K,internal:te}=X.getState();(_=te.lastEvent)!=null&&_.current&&K.handlers&&K.handlers.onPointerMove(te.lastEvent.current)},connect:_=>{var K;const{set:te,events:ne}=X.getState();ne.disconnect==null||ne.disconnect(),te(ie=>({events:{...ie.events,connected:_}})),Object.entries((K=ne.handlers)!=null?K:[]).forEach(([ie,oe])=>{const[se,ae]=DOM_EVENTS[ie];_.addEventListener(se,oe,{passive:ae})})},disconnect:()=>{const{set:_,events:K}=X.getState();if(K.connected){var te;Object.entries((te=K.handlers)!=null?te:[]).forEach(([ne,ie])=>{if(K&&K.connected instanceof HTMLElement){const[oe]=DOM_EVENTS[ne];K.connected.removeEventListener(oe,ie)}}),_(ne=>({events:{...ne.events,connected:void 0}}))}}}}var debounce_1,hasRequiredDebounce;function requireDebounce(){if(hasRequiredDebounce)return debounce_1;hasRequiredDebounce=1;function X(Z,_,K){var te,ne,ie,oe,se;_==null&&(_=100);function ae(){var ce=Date.now()-oe;ce<_&&ce>=0?te=setTimeout(ae,_-ce):(te=null,K||(se=Z.apply(ie,ne),ie=ne=null))}var ge=function(){ie=this,ne=arguments,oe=Date.now();var ce=K&&!te;return te||(te=setTimeout(ae,_)),ce&&(se=Z.apply(ie,ne),ie=ne=null),se};return ge.clear=function(){te&&(clearTimeout(te),te=null)},ge.flush=function(){te&&(se=Z.apply(ie,ne),ie=ne=null,clearTimeout(te),te=null)},ge}return X.debounce=X,debounce_1=X,debounce_1}var debounceExports=requireDebounce();const createDebounce=getDefaultExportFromCjs(debounceExports);var __defProp$1=Object.defineProperty,__defProps=Object.defineProperties,__getOwnPropDescs=Object.getOwnPropertyDescriptors,__getOwnPropSymbols=Object.getOwnPropertySymbols,__hasOwnProp=Object.prototype.hasOwnProperty,__propIsEnum=Object.prototype.propertyIsEnumerable,__defNormalProp=(X,Z,_)=>Z in X?__defProp$1(X,Z,{enumerable:!0,configurable:!0,writable:!0,value:_}):X[Z]=_,__spreadValues=(X,Z)=>{for(var _ in Z||(Z={}))__hasOwnProp.call(Z,_)&&__defNormalProp(X,_,Z[_]);if(__getOwnPropSymbols)for(var _ of __getOwnPropSymbols(Z))__propIsEnum.call(Z,_)&&__defNormalProp(X,_,Z[_]);return X},__spreadProps=(X,Z)=>__defProps(X,__getOwnPropDescs(Z)),_a$1,_b$1;typeof window<"u"&&((_a$1=window.document)!=null&&_a$1.createElement||((_b$1=window.navigator)==null?void 0:_b$1.product)==="ReactNative")?reactExports.useLayoutEffect:reactExports.useEffect;function traverseFiber(X,Z,_){if(!X)return;if(_(X)===!0)return X;let K=X.child;for(;K;){const te=traverseFiber(K,Z,_);if(te)return te;K=K.sibling}}function wrapContext(X){try{return Object.defineProperties(X,{_currentRenderer:{get(){return null},set(){}},_currentRenderer2:{get(){return null},set(){}}})}catch{return X}}const error=console.error;console.error=function(){const X=[...arguments].join("");if(X!=null&&X.startsWith("Warning:")&&X.includes("useContext")){console.error=error;return}return error.apply(this,arguments)};const FiberContext=wrapContext(reactExports.createContext(null));class FiberProvider extends reactExports.Component{render(){return reactExports.createElement(FiberContext.Provider,{value:this._reactInternals},this.props.children)}}function useFiber(){const X=reactExports.useContext(FiberContext);if(X===null)throw new Error("its-fine: useFiber must be called within a <FiberProvider />!");const Z=reactExports.useId();return reactExports.useMemo(()=>{for(const K of[X,X==null?void 0:X.alternate]){if(!K)continue;const te=traverseFiber(K,!1,ne=>{let ie=ne.memoizedState;for(;ie;){if(ie.memoizedState===Z)return!0;ie=ie.next}});if(te)return te}},[X,Z])}function useContextMap(){const X=useFiber(),[Z]=reactExports.useState(()=>new Map);Z.clear();let _=X;for(;_;){if(_.type&&typeof _.type=="object"){const te=_.type._context===void 0&&_.type.Provider===_.type?_.type:_.type._context;te&&te!==FiberContext&&!Z.has(te)&&Z.set(te,reactExports.useContext(wrapContext(te)))}_=_.return}return Z}function useContextBridge(){const X=useContextMap();return reactExports.useMemo(()=>Array.from(X.keys()).reduce((Z,_)=>K=>reactExports.createElement(Z,null,reactExports.createElement(_.Provider,__spreadProps(__spreadValues({},K),{value:X.get(_)}))),Z=>reactExports.createElement(FiberProvider,__spreadValues({},Z))),[X])}function useMeasure({debounce:X,scroll:Z,polyfill:_,offsetSize:K}={debounce:0,scroll:!1,offsetSize:!1}){const te=_||typeof window<"u"&&window.ResizeObserver,[ne,ie]=reactExports.useState({left:0,top:0,width:0,height:0,bottom:0,right:0,x:0,y:0});if(!te)return ne.width=1280,ne.height=800,[()=>{},ne,()=>{}];const oe=reactExports.useRef({element:null,scrollContainers:null,resizeObserver:null,lastBounds:ne,orientationHandler:null}),se=X?typeof X=="number"?X:X.scroll:null,ae=X?typeof X=="number"?X:X.resize:null,ge=reactExports.useRef(!1);reactExports.useEffect(()=>(ge.current=!0,()=>void(ge.current=!1)));const[ce,de,Ie]=reactExports.useMemo(()=>{const ye=()=>{if(!oe.current.element)return;const{left:ve,top:Be,width:Re,height:Ve,bottom:Ee,right:Ze,x:_e,y:Fe}=oe.current.element.getBoundingClientRect(),Te={left:ve,top:Be,width:Re,height:Ve,bottom:Ee,right:Ze,x:_e,y:Fe};oe.current.element instanceof HTMLElement&&K&&(Te.height=oe.current.element.offsetHeight,Te.width=oe.current.element.offsetWidth),Object.freeze(Te),ge.current&&!areBoundsEqual(oe.current.lastBounds,Te)&&ie(oe.current.lastBounds=Te)};return[ye,ae?createDebounce(ye,ae):ye,se?createDebounce(ye,se):ye]},[ie,K,se,ae]);function fe(){oe.current.scrollContainers&&(oe.current.scrollContainers.forEach(ye=>ye.removeEventListener("scroll",Ie,!0)),oe.current.scrollContainers=null),oe.current.resizeObserver&&(oe.current.resizeObserver.disconnect(),oe.current.resizeObserver=null),oe.current.orientationHandler&&("orientation"in screen&&"removeEventListener"in screen.orientation?screen.orientation.removeEventListener("change",oe.current.orientationHandler):"onorientationchange"in window&&window.removeEventListener("orientationchange",oe.current.orientationHandler))}function be(){var ye;oe.current.element&&(oe.current.resizeObserver=new te(de),(ye=oe.current.resizeObserver)==null||ye.observe(oe.current.element),Z&&oe.current.scrollContainers&&oe.current.scrollContainers.forEach(ve=>ve.addEventListener("scroll",Ie,{capture:!0,passive:!0})),oe.current.orientationHandler=()=>{Ie()},"orientation"in screen&&"addEventListener"in screen.orientation?screen.orientation.addEventListener("change",oe.current.orientationHandler):"onorientationchange"in window&&window.addEventListener("orientationchange",oe.current.orientationHandler))}const Ae=ye=>{!ye||ye===oe.current.element||(fe(),oe.current.element=ye,oe.current.scrollContainers=findScrollContainers(ye),be())};return useOnWindowScroll(Ie,!!Z),useOnWindowResize(de),reactExports.useEffect(()=>{fe(),be()},[Z,Ie,de]),reactExports.useEffect(()=>fe,[]),[Ae,ne,ce]}function useOnWindowResize(X){reactExports.useEffect(()=>{const Z=X;return window.addEventListener("resize",Z),()=>void window.removeEventListener("resize",Z)},[X])}function useOnWindowScroll(X,Z){reactExports.useEffect(()=>{if(Z){const _=X;return window.addEventListener("scroll",_,{capture:!0,passive:!0}),()=>void window.removeEventListener("scroll",_,!0)}},[X,Z])}function findScrollContainers(X){const Z=[];if(!X||X===document.body)return Z;const{overflow:_,overflowX:K,overflowY:te}=window.getComputedStyle(X);return[_,K,te].some(ne=>ne==="auto"||ne==="scroll")&&Z.push(X),[...Z,...findScrollContainers(X.parentElement)]}const keys=["x","y","top","bottom","left","right","width","height"],areBoundsEqual=(X,Z)=>keys.every(_=>X[_]===Z[_]),CanvasImpl=reactExports.forwardRef(function({children:Z,fallback:_,resize:K,style:te,gl:ne,events:ie=createPointerEvents,eventSource:oe,eventPrefix:se,shadows:ae,linear:ge,flat:ce,legacy:de,orthographic:Ie,frameloop:fe,dpr:be,performance:Ae,raycaster:ye,camera:ve,scene:Be,onPointerMissed:Re,onCreated:Ve,...Ee},Ze){reactExports.useMemo(()=>extend(THREE),[]);const _e=useContextBridge(),[Fe,Te]=useMeasure({scroll:!0,debounce:{scroll:50,resize:0},...K}),ke=reactExports.useRef(null),Le=reactExports.useRef(null);reactExports.useImperativeHandle(Ze,()=>ke.current);const Ke=useMutableCallback(Re),[Ue,rt]=reactExports.useState(!1),[tt,at]=reactExports.useState(!1);if(Ue)throw Ue;if(tt)throw tt;const ze=reactExports.useRef(null);useIsomorphicLayoutEffect$2(()=>{const Pe=ke.current;Te.width>0&&Te.height>0&&Pe&&(ze.current||(ze.current=createRoot(Pe)),ze.current.configure({gl:ne,events:ie,shadows:ae,linear:ge,flat:ce,legacy:de,orthographic:Ie,frameloop:fe,dpr:be,performance:Ae,raycaster:ye,camera:ve,scene:Be,size:Te,onPointerMissed:(...Ye)=>Ke.current==null?void 0:Ke.current(...Ye),onCreated:Ye=>{Ye.events.connect==null||Ye.events.connect(oe?isRef$1(oe)?oe.current:oe:Le.current),se&&Ye.setEvents({compute:($e,ut)=>{const ot=$e[se+"X"],gt=$e[se+"Y"];ut.pointer.set(ot/ut.size.width*2-1,-(gt/ut.size.height)*2+1),ut.raycaster.setFromCamera(ut.pointer,ut.camera)}}),Ve==null||Ve(Ye)}}),ze.current.render(jsxRuntimeExports.jsx(_e,{children:jsxRuntimeExports.jsx(ErrorBoundary,{set:at,children:jsxRuntimeExports.jsx(reactExports.Suspense,{fallback:jsxRuntimeExports.jsx(Block,{set:rt}),children:Z})})})))}),reactExports.useEffect(()=>{const Pe=ke.current;if(Pe)return()=>unmountComponentAtNode(Pe)},[]);const qe=oe?"none":"auto";return jsxRuntimeExports.jsx("div",{ref:Le,style:{position:"relative",width:"100%",height:"100%",overflow:"hidden",pointerEvents:qe,...te},...Ee,children:jsxRuntimeExports.jsx("div",{ref:Fe,style:{width:"100%",height:"100%"},children:jsxRuntimeExports.jsx("canvas",{ref:ke,style:{display:"block"},children:_})})})}),Canvas$1=reactExports.forwardRef(function(Z,_){return jsxRuntimeExports.jsx(FiberProvider,{children:jsxRuntimeExports.jsx(CanvasImpl,{...Z,ref:_})})});function _extends$2(){return _extends$2=Object.assign?Object.assign.bind():function(X){for(var Z=1;Z<arguments.length;Z++){var _=arguments[Z];for(var K in _)({}).hasOwnProperty.call(_,K)&&(X[K]=_[K])}return X},_extends$2.apply(null,arguments)}const v1$2=new Vector3,v2$2=new Vector3,v3=new Vector3,v4=new Vector2;function defaultCalculatePosition(X,Z,_){const K=v1$2.setFromMatrixPosition(X.matrixWorld);K.project(Z);const te=_.width/2,ne=_.height/2;return[K.x*te+te,-(K.y*ne)+ne]}function isObjectBehindCamera(X,Z){const _=v1$2.setFromMatrixPosition(X.matrixWorld),K=v2$2.setFromMatrixPosition(Z.matrixWorld),te=_.sub(K),ne=Z.getWorldDirection(v3);return te.angleTo(ne)>Math.PI/2}function isObjectVisible(X,Z,_,K){const te=v1$2.setFromMatrixPosition(X.matrixWorld),ne=te.clone();ne.project(Z),v4.set(ne.x,ne.y),_.setFromCamera(v4,Z);const ie=_.intersectObjects(K,!0);if(ie.length){const oe=ie[0].distance;return te.distanceTo(_.ray.origin)<oe}return!0}function objectScale(X,Z){if(Z instanceof OrthographicCamera)return Z.zoom;if(Z instanceof PerspectiveCamera){const _=v1$2.setFromMatrixPosition(X.matrixWorld),K=v2$2.setFromMatrixPosition(Z.matrixWorld),te=Z.fov*Math.PI/180,ne=_.distanceTo(K);return 1/(2*Math.tan(te/2)*ne)}else return 1}function objectZIndex(X,Z,_){if(Z instanceof PerspectiveCamera||Z instanceof OrthographicCamera){const K=v1$2.setFromMatrixPosition(X.matrixWorld),te=v2$2.setFromMatrixPosition(Z.matrixWorld),ne=K.distanceTo(te),ie=(_[1]-_[0])/(Z.far-Z.near),oe=_[1]-ie*Z.far;return Math.round(ie*ne+oe)}}const epsilon=X=>Math.abs(X)<1e-10?0:X;function getCSSMatrix(X,Z,_=""){let K="matrix3d(";for(let te=0;te!==16;te++)K+=epsilon(Z[te]*X.elements[te])+(te!==15?",":")");return _+K}const getCameraCSSMatrix=(X=>Z=>getCSSMatrix(Z,X))([1,-1,1,1,1,-1,1,1,1,-1,1,1,1,-1,1,1]),getObjectCSSMatrix=(X=>(Z,_)=>getCSSMatrix(Z,X(_),"translate(-50%,-50%)"))(X=>[1/X,1/X,1/X,1,-1/X,-1/X,-1/X,-1,1/X,1/X,1/X,1,1,1,1,1]);function isRefObject(X){return X&&typeof X=="object"&&"current"in X}const Html=reactExports.forwardRef(({children:X,eps:Z=.001,style:_,className:K,prepend:te,center:ne,fullscreen:ie,portal:oe,distanceFactor:se,sprite:ae=!1,transform:ge=!1,occlude:ce,onOcclude:de,castShadow:Ie,receiveShadow:fe,material:be,geometry:Ae,zIndexRange:ye=[16777271,0],calculatePosition:ve=defaultCalculatePosition,as:Be="div",wrapperClass:Re,pointerEvents:Ve="auto",...Ee},Ze)=>{const{gl:_e,camera:Fe,scene:Te,size:ke,raycaster:Le,events:Ke,viewport:Ue}=useThree(),[rt]=reactExports.useState(()=>document.createElement(Be)),tt=reactExports.useRef(),at=reactExports.useRef(null),ze=reactExports.useRef(0),qe=reactExports.useRef([0,0]),Pe=reactExports.useRef(null),Ye=reactExports.useRef(null),$e=(oe==null?void 0:oe.current)||Ke.connected||_e.domElement.parentNode,ut=reactExports.useRef(null),ot=reactExports.useRef(!1),gt=reactExports.useMemo(()=>ce&&ce!=="blending"||Array.isArray(ce)&&ce.length&&isRefObject(ce[0]),[ce]);reactExports.useLayoutEffect(()=>{const Dt=_e.domElement;ce&&ce==="blending"?(Dt.style.zIndex=`${Math.floor(ye[0]/2)}`,Dt.style.position="absolute",Dt.style.pointerEvents="none"):(Dt.style.zIndex=null,Dt.style.position=null,Dt.style.pointerEvents=null)},[ce]),reactExports.useLayoutEffect(()=>{if(at.current){const Dt=tt.current=clientExports.createRoot(rt);if(Te.updateMatrixWorld(),ge)rt.style.cssText="position:absolute;top:0;left:0;pointer-events:none;overflow:hidden;";else{const Vt=ve(at.current,Fe,ke);rt.style.cssText=`position:absolute;top:0;left:0;transform:translate3d(${Vt[0]}px,${Vt[1]}px,0);transform-origin:0 0;`}return $e&&(te?$e.prepend(rt):$e.appendChild(rt)),()=>{$e&&$e.removeChild(rt),Dt.unmount()}}},[$e,ge]),reactExports.useLayoutEffect(()=>{Re&&(rt.className=Re)},[Re]);const ht=reactExports.useMemo(()=>ge?{position:"absolute",top:0,left:0,width:ke.width,height:ke.height,transformStyle:"preserve-3d",pointerEvents:"none"}:{position:"absolute",transform:ne?"translate3d(-50%,-50%,0)":"none",...ie&&{top:-ke.height/2,left:-ke.width/2,width:ke.width,height:ke.height},..._},[_,ne,ie,ke,ge]),dt=reactExports.useMemo(()=>({position:"absolute",pointerEvents:Ve}),[Ve]);reactExports.useLayoutEffect(()=>{if(ot.current=!1,ge){var Dt;(Dt=tt.current)==null||Dt.render(reactExports.createElement("div",{ref:Pe,style:ht},reactExports.createElement("div",{ref:Ye,style:dt},reactExports.createElement("div",{ref:Ze,className:K,style:_,children:X}))))}else{var Vt;(Vt=tt.current)==null||Vt.render(reactExports.createElement("div",{ref:Ze,style:ht,className:K,children:X}))}});const bt=reactExports.useRef(!0);useFrame(Dt=>{if(at.current){Fe.updateMatrixWorld(),at.current.updateWorldMatrix(!0,!1);const Vt=ge?qe.current:ve(at.current,Fe,ke);if(ge||Math.abs(ze.current-Fe.zoom)>Z||Math.abs(qe.current[0]-Vt[0])>Z||Math.abs(qe.current[1]-Vt[1])>Z){const mt=isObjectBehindCamera(at.current,Fe);let Ft=!1;gt&&(Array.isArray(ce)?Ft=ce.map(Ut=>Ut.current):ce!=="blending"&&(Ft=[Te]));const it=bt.current;if(Ft){const Ut=isObjectVisible(at.current,Fe,Le,Ft);bt.current=Ut&&!mt}else bt.current=!mt;it!==bt.current&&(de?de(!bt.current):rt.style.display=bt.current?"block":"none");const Lt=Math.floor(ye[0]/2),Et=ce?gt?[ye[0],Lt]:[Lt-1,0]:ye;if(rt.style.zIndex=`${objectZIndex(at.current,Fe,Et)}`,ge){const[Ut,Zt]=[ke.width/2,ke.height/2],Ot=Fe.projectionMatrix.elements[5]*Zt,{isOrthographicCamera:Tt,top:Je,left:Oe,bottom:lt,right:ft}=Fe,St=getCameraCSSMatrix(Fe.matrixWorldInverse),Wt=Tt?`scale(${Ot})translate(${epsilon(-(ft+Oe)/2)}px,${epsilon((Je+lt)/2)}px)`:`translateZ(${Ot}px)`;let zt=at.current.matrixWorld;ae&&(zt=Fe.matrixWorldInverse.clone().transpose().copyPosition(zt).scale(at.current.scale),zt.elements[3]=zt.elements[7]=zt.elements[11]=0,zt.elements[15]=1),rt.style.width=ke.width+"px",rt.style.height=ke.height+"px",rt.style.perspective=Tt?"":`${Ot}px`,Pe.current&&Ye.current&&(Pe.current.style.transform=`${Wt}${St}translate(${Ut}px,${Zt}px)`,Ye.current.style.transform=getObjectCSSMatrix(zt,1/((se||10)/400)))}else{const Ut=se===void 0?1:objectScale(at.current,Fe)*se;rt.style.transform=`translate3d(${Vt[0]}px,${Vt[1]}px,0) scale(${Ut})`}qe.current=Vt,ze.current=Fe.zoom}}if(!gt&&ut.current&&!ot.current)if(ge){if(Pe.current){const Vt=Pe.current.children[0];if(Vt!=null&&Vt.clientWidth&&Vt!=null&&Vt.clientHeight){const{isOrthographicCamera:mt}=Fe;if(mt||Ae)Ee.scale&&(Array.isArray(Ee.scale)?Ee.scale instanceof Vector3?ut.current.scale.copy(Ee.scale.clone().divideScalar(1)):ut.current.scale.set(1/Ee.scale[0],1/Ee.scale[1],1/Ee.scale[2]):ut.current.scale.setScalar(1/Ee.scale));else{const Ft=(se||10)/400,it=Vt.clientWidth*Ft,Lt=Vt.clientHeight*Ft;ut.current.scale.set(it,Lt,1)}ot.current=!0}}}else{const Vt=rt.children[0];if(Vt!=null&&Vt.clientWidth&&Vt!=null&&Vt.clientHeight){const mt=1/Ue.factor,Ft=Vt.clientWidth*mt,it=Vt.clientHeight*mt;ut.current.scale.set(Ft,it,1),ot.current=!0}ut.current.lookAt(Dt.camera.position)}});const Ht=reactExports.useMemo(()=>({vertexShader:ge?void 0:`
          /*
            This shader is from the THREE's SpriteMaterial.
            We need to turn the backing plane into a Sprite
            (make it always face the camera) if "transfrom"
            is false.
          */
          #include <common>

          void main() {
            vec2 center = vec2(0., 1.);
            float rotation = 0.0;

            // This is somewhat arbitrary, but it seems to work well
            // Need to figure out how to derive this dynamically if it even matters
            float size = 0.03;

            vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
            vec2 scale;
            scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
            scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );

            bool isPerspective = isPerspectiveMatrix( projectionMatrix );
            if ( isPerspective ) scale *= - mvPosition.z;

            vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale * size;
            vec2 rotatedPosition;
            rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
            rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
            mvPosition.xy += rotatedPosition;

            gl_Position = projectionMatrix * mvPosition;
          }
      `,fragmentShader:`
        void main() {
          gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);
        }
      `}),[ge]);return reactExports.createElement("group",_extends$2({},Ee,{ref:at}),ce&&!gt&&reactExports.createElement("mesh",{castShadow:Ie,receiveShadow:fe,ref:ut},Ae||reactExports.createElement("planeGeometry",null),be||reactExports.createElement("shaderMaterial",{side:DoubleSide,vertexShader:Ht.vertexShader,fragmentShader:Ht.fragmentShader})))});function clamp$2(X,Z,_){return Math.max(Z,Math.min(X,_))}const V$2={toVector(X,Z){return X===void 0&&(X=Z),Array.isArray(X)?X:[X,X]},add(X,Z){return[X[0]+Z[0],X[1]+Z[1]]},sub(X,Z){return[X[0]-Z[0],X[1]-Z[1]]},addTo(X,Z){X[0]+=Z[0],X[1]+=Z[1]},subTo(X,Z){X[0]-=Z[0],X[1]-=Z[1]}};function rubberband(X,Z,_){return Z===0||Math.abs(Z)===1/0?Math.pow(X,_*5):X*Z*_/(Z+_*X)}function rubberbandIfOutOfBounds(X,Z,_,K=.15){return K===0?clamp$2(X,Z,_):X<Z?-rubberband(Z-X,_-Z,K)+Z:X>_?+rubberband(X-_,_-Z,K)+_:X}function computeRubberband(X,[Z,_],[K,te]){const[[ne,ie],[oe,se]]=X;return[rubberbandIfOutOfBounds(Z,ne,ie,K),rubberbandIfOutOfBounds(_,oe,se,te)]}function _toPrimitive$1(X,Z){if(typeof X!="object"||X===null)return X;var _=X[Symbol.toPrimitive];if(_!==void 0){var K=_.call(X,Z||"default");if(typeof K!="object")return K;throw new TypeError("@@toPrimitive must return a primitive value.")}return(Z==="string"?String:Number)(X)}function _toPropertyKey$1(X){var Z=_toPrimitive$1(X,"string");return typeof Z=="symbol"?Z:String(Z)}function _defineProperty$4(X,Z,_){return Z=_toPropertyKey$1(Z),Z in X?Object.defineProperty(X,Z,{value:_,enumerable:!0,configurable:!0,writable:!0}):X[Z]=_,X}function ownKeys$4(X,Z){var _=Object.keys(X);if(Object.getOwnPropertySymbols){var K=Object.getOwnPropertySymbols(X);Z&&(K=K.filter(function(te){return Object.getOwnPropertyDescriptor(X,te).enumerable})),_.push.apply(_,K)}return _}function _objectSpread2$1(X){for(var Z=1;Z<arguments.length;Z++){var _=arguments[Z]!=null?arguments[Z]:{};Z%2?ownKeys$4(Object(_),!0).forEach(function(K){_defineProperty$4(X,K,_[K])}):Object.getOwnPropertyDescriptors?Object.defineProperties(X,Object.getOwnPropertyDescriptors(_)):ownKeys$4(Object(_)).forEach(function(K){Object.defineProperty(X,K,Object.getOwnPropertyDescriptor(_,K))})}return X}const EVENT_TYPE_MAP={pointer:{start:"down",change:"move",end:"up"},mouse:{start:"down",change:"move",end:"up"},touch:{start:"start",change:"move",end:"end"},gesture:{start:"start",change:"change",end:"end"}};function capitalize$1(X){return X?X[0].toUpperCase()+X.slice(1):""}const actionsWithoutCaptureSupported=["enter","leave"];function hasCapture(X=!1,Z){return X&&!actionsWithoutCaptureSupported.includes(Z)}function toHandlerProp(X,Z="",_=!1){const K=EVENT_TYPE_MAP[X],te=K&&K[Z]||Z;return"on"+capitalize$1(X)+capitalize$1(te)+(hasCapture(_,te)?"Capture":"")}const pointerCaptureEvents=["gotpointercapture","lostpointercapture"];function parseProp(X){let Z=X.substring(2).toLowerCase();const _=!!~Z.indexOf("passive");_&&(Z=Z.replace("passive",""));const K=pointerCaptureEvents.includes(Z)?"capturecapture":"capture",te=!!~Z.indexOf(K);return te&&(Z=Z.replace("capture","")),{device:Z,capture:te,passive:_}}function toDomEventType(X,Z=""){const _=EVENT_TYPE_MAP[X],K=_&&_[Z]||Z;return X+K}function isTouch(X){return"touches"in X}function getPointerType(X){return isTouch(X)?"touch":"pointerType"in X?X.pointerType:"mouse"}function getCurrentTargetTouchList(X){return Array.from(X.touches).filter(Z=>{var _,K;return Z.target===X.currentTarget||((_=X.currentTarget)===null||_===void 0||(K=_.contains)===null||K===void 0?void 0:K.call(_,Z.target))})}function getTouchList(X){return X.type==="touchend"||X.type==="touchcancel"?X.changedTouches:X.targetTouches}function getValueEvent(X){return isTouch(X)?getTouchList(X)[0]:X}function distanceAngle(X,Z){try{const _=Z.clientX-X.clientX,K=Z.clientY-X.clientY,te=(Z.clientX+X.clientX)/2,ne=(Z.clientY+X.clientY)/2,ie=Math.hypot(_,K);return{angle:-(Math.atan2(_,K)*180)/Math.PI,distance:ie,origin:[te,ne]}}catch{}return null}function touchIds(X){return getCurrentTargetTouchList(X).map(Z=>Z.identifier)}function touchDistanceAngle(X,Z){const[_,K]=Array.from(X.touches).filter(te=>Z.includes(te.identifier));return distanceAngle(_,K)}function pointerId(X){const Z=getValueEvent(X);return isTouch(X)?Z.identifier:Z.pointerId}function pointerValues(X){const Z=getValueEvent(X);return[Z.clientX,Z.clientY]}const LINE_HEIGHT=40,PAGE_HEIGHT=800;function wheelValues(X){let{deltaX:Z,deltaY:_,deltaMode:K}=X;return K===1?(Z*=LINE_HEIGHT,_*=LINE_HEIGHT):K===2&&(Z*=PAGE_HEIGHT,_*=PAGE_HEIGHT),[Z,_]}function scrollValues(X){var Z,_;const{scrollX:K,scrollY:te,scrollLeft:ne,scrollTop:ie}=X.currentTarget;return[(Z=K??ne)!==null&&Z!==void 0?Z:0,(_=te??ie)!==null&&_!==void 0?_:0]}function getEventDetails(X){const Z={};if("buttons"in X&&(Z.buttons=X.buttons),"shiftKey"in X){const{shiftKey:_,altKey:K,metaKey:te,ctrlKey:ne}=X;Object.assign(Z,{shiftKey:_,altKey:K,metaKey:te,ctrlKey:ne})}return Z}function call$1(X,...Z){return typeof X=="function"?X(...Z):X}function noop$2(){}function chain(...X){return X.length===0?noop$2:X.length===1?X[0]:function(){let Z;for(const _ of X)Z=_.apply(this,arguments)||Z;return Z}}function assignDefault(X,Z){return Object.assign({},Z,X||{})}const BEFORE_LAST_KINEMATICS_DELAY=32;class Engine{constructor(Z,_,K){this.ctrl=Z,this.args=_,this.key=K,this.state||(this.state={},this.computeValues([0,0]),this.computeInitial(),this.init&&this.init(),this.reset())}get state(){return this.ctrl.state[this.key]}set state(Z){this.ctrl.state[this.key]=Z}get shared(){return this.ctrl.state.shared}get eventStore(){return this.ctrl.gestureEventStores[this.key]}get timeoutStore(){return this.ctrl.gestureTimeoutStores[this.key]}get config(){return this.ctrl.config[this.key]}get sharedConfig(){return this.ctrl.config.shared}get handler(){return this.ctrl.handlers[this.key]}reset(){const{state:Z,shared:_,ingKey:K,args:te}=this;_[K]=Z._active=Z.active=Z._blocked=Z._force=!1,Z._step=[!1,!1],Z.intentional=!1,Z._movement=[0,0],Z._distance=[0,0],Z._direction=[0,0],Z._delta=[0,0],Z._bounds=[[-1/0,1/0],[-1/0,1/0]],Z.args=te,Z.axis=void 0,Z.memo=void 0,Z.elapsedTime=Z.timeDelta=0,Z.direction=[0,0],Z.distance=[0,0],Z.overflow=[0,0],Z._movementBound=[!1,!1],Z.velocity=[0,0],Z.movement=[0,0],Z.delta=[0,0],Z.timeStamp=0}start(Z){const _=this.state,K=this.config;_._active||(this.reset(),this.computeInitial(),_._active=!0,_.target=Z.target,_.currentTarget=Z.currentTarget,_.lastOffset=K.from?call$1(K.from,_):_.offset,_.offset=_.lastOffset,_.startTime=_.timeStamp=Z.timeStamp)}computeValues(Z){const _=this.state;_._values=Z,_.values=this.config.transform(Z)}computeInitial(){const Z=this.state;Z._initial=Z._values,Z.initial=Z.values}compute(Z){const{state:_,config:K,shared:te}=this;_.args=this.args;let ne=0;if(Z&&(_.event=Z,K.preventDefault&&Z.cancelable&&_.event.preventDefault(),_.type=Z.type,te.touches=this.ctrl.pointerIds.size||this.ctrl.touchIds.size,te.locked=!!document.pointerLockElement,Object.assign(te,getEventDetails(Z)),te.down=te.pressed=te.buttons%2===1||te.touches>0,ne=Z.timeStamp-_.timeStamp,_.timeStamp=Z.timeStamp,_.elapsedTime=_.timeStamp-_.startTime),_._active){const Ee=_._delta.map(Math.abs);V$2.addTo(_._distance,Ee)}this.axisIntent&&this.axisIntent(Z);const[ie,oe]=_._movement,[se,ae]=K.threshold,{_step:ge,values:ce}=_;if(K.hasCustomTransform?(ge[0]===!1&&(ge[0]=Math.abs(ie)>=se&&ce[0]),ge[1]===!1&&(ge[1]=Math.abs(oe)>=ae&&ce[1])):(ge[0]===!1&&(ge[0]=Math.abs(ie)>=se&&Math.sign(ie)*se),ge[1]===!1&&(ge[1]=Math.abs(oe)>=ae&&Math.sign(oe)*ae)),_.intentional=ge[0]!==!1||ge[1]!==!1,!_.intentional)return;const de=[0,0];if(K.hasCustomTransform){const[Ee,Ze]=ce;de[0]=ge[0]!==!1?Ee-ge[0]:0,de[1]=ge[1]!==!1?Ze-ge[1]:0}else de[0]=ge[0]!==!1?ie-ge[0]:0,de[1]=ge[1]!==!1?oe-ge[1]:0;this.restrictToAxis&&!_._blocked&&this.restrictToAxis(de);const Ie=_.offset,fe=_._active&&!_._blocked||_.active;fe&&(_.first=_._active&&!_.active,_.last=!_._active&&_.active,_.active=te[this.ingKey]=_._active,Z&&(_.first&&("bounds"in K&&(_._bounds=call$1(K.bounds,_)),this.setup&&this.setup()),_.movement=de,this.computeOffset()));const[be,Ae]=_.offset,[[ye,ve],[Be,Re]]=_._bounds;_.overflow=[be<ye?-1:be>ve?1:0,Ae<Be?-1:Ae>Re?1:0],_._movementBound[0]=_.overflow[0]?_._movementBound[0]===!1?_._movement[0]:_._movementBound[0]:!1,_._movementBound[1]=_.overflow[1]?_._movementBound[1]===!1?_._movement[1]:_._movementBound[1]:!1;const Ve=_._active?K.rubberband||[0,0]:[0,0];if(_.offset=computeRubberband(_._bounds,_.offset,Ve),_.delta=V$2.sub(_.offset,Ie),this.computeMovement(),fe&&(!_.last||ne>BEFORE_LAST_KINEMATICS_DELAY)){_.delta=V$2.sub(_.offset,Ie);const Ee=_.delta.map(Math.abs);V$2.addTo(_.distance,Ee),_.direction=_.delta.map(Math.sign),_._direction=_._delta.map(Math.sign),!_.first&&ne>0&&(_.velocity=[Ee[0]/ne,Ee[1]/ne],_.timeDelta=ne)}}emit(){const Z=this.state,_=this.shared,K=this.config;if(Z._active||this.clean(),(Z._blocked||!Z.intentional)&&!Z._force&&!K.triggerAllEvents)return;const te=this.handler(_objectSpread2$1(_objectSpread2$1(_objectSpread2$1({},_),Z),{},{[this.aliasKey]:Z.values}));te!==void 0&&(Z.memo=te)}clean(){this.eventStore.clean(),this.timeoutStore.clean()}}function selectAxis([X,Z],_){const K=Math.abs(X),te=Math.abs(Z);if(K>te&&K>_)return"x";if(te>K&&te>_)return"y"}class CoordinatesEngine extends Engine{constructor(...Z){super(...Z),_defineProperty$4(this,"aliasKey","xy")}reset(){super.reset(),this.state.axis=void 0}init(){this.state.offset=[0,0],this.state.lastOffset=[0,0]}computeOffset(){this.state.offset=V$2.add(this.state.lastOffset,this.state.movement)}computeMovement(){this.state.movement=V$2.sub(this.state.offset,this.state.lastOffset)}axisIntent(Z){const _=this.state,K=this.config;if(!_.axis&&Z){const te=typeof K.axisThreshold=="object"?K.axisThreshold[getPointerType(Z)]:K.axisThreshold;_.axis=selectAxis(_._movement,te)}_._blocked=(K.lockDirection||!!K.axis)&&!_.axis||!!K.axis&&K.axis!==_.axis}restrictToAxis(Z){if(this.config.axis||this.config.lockDirection)switch(this.state.axis){case"x":Z[1]=0;break;case"y":Z[0]=0;break}}}const identity=X=>X,DEFAULT_RUBBERBAND=.15,commonConfigResolver={enabled(X=!0){return X},eventOptions(X,Z,_){return _objectSpread2$1(_objectSpread2$1({},_.shared.eventOptions),X)},preventDefault(X=!1){return X},triggerAllEvents(X=!1){return X},rubberband(X=0){switch(X){case!0:return[DEFAULT_RUBBERBAND,DEFAULT_RUBBERBAND];case!1:return[0,0];default:return V$2.toVector(X)}},from(X){if(typeof X=="function")return X;if(X!=null)return V$2.toVector(X)},transform(X,Z,_){const K=X||_.shared.transform;return this.hasCustomTransform=!!K,K||identity},threshold(X){return V$2.toVector(X,0)}},DEFAULT_AXIS_THRESHOLD=0,coordinatesConfigResolver=_objectSpread2$1(_objectSpread2$1({},commonConfigResolver),{},{axis(X,Z,{axis:_}){if(this.lockDirection=_==="lock",!this.lockDirection)return _},axisThreshold(X=DEFAULT_AXIS_THRESHOLD){return X},bounds(X={}){if(typeof X=="function")return ne=>coordinatesConfigResolver.bounds(X(ne));if("current"in X)return()=>X.current;if(typeof HTMLElement=="function"&&X instanceof HTMLElement)return X;const{left:Z=-1/0,right:_=1/0,top:K=-1/0,bottom:te=1/0}=X;return[[Z,_],[K,te]]}}),KEYS_DELTA_MAP={ArrowRight:(X,Z=1)=>[X*Z,0],ArrowLeft:(X,Z=1)=>[-1*X*Z,0],ArrowUp:(X,Z=1)=>[0,-1*X*Z],ArrowDown:(X,Z=1)=>[0,X*Z]};class DragEngine extends CoordinatesEngine{constructor(...Z){super(...Z),_defineProperty$4(this,"ingKey","dragging")}reset(){super.reset();const Z=this.state;Z._pointerId=void 0,Z._pointerActive=!1,Z._keyboardActive=!1,Z._preventScroll=!1,Z._delayed=!1,Z.swipe=[0,0],Z.tap=!1,Z.canceled=!1,Z.cancel=this.cancel.bind(this)}setup(){const Z=this.state;if(Z._bounds instanceof HTMLElement){const _=Z._bounds.getBoundingClientRect(),K=Z.currentTarget.getBoundingClientRect(),te={left:_.left-K.left+Z.offset[0],right:_.right-K.right+Z.offset[0],top:_.top-K.top+Z.offset[1],bottom:_.bottom-K.bottom+Z.offset[1]};Z._bounds=coordinatesConfigResolver.bounds(te)}}cancel(){const Z=this.state;Z.canceled||(Z.canceled=!0,Z._active=!1,setTimeout(()=>{this.compute(),this.emit()},0))}setActive(){this.state._active=this.state._pointerActive||this.state._keyboardActive}clean(){this.pointerClean(),this.state._pointerActive=!1,this.state._keyboardActive=!1,super.clean()}pointerDown(Z){const _=this.config,K=this.state;if(Z.buttons!=null&&(Array.isArray(_.pointerButtons)?!_.pointerButtons.includes(Z.buttons):_.pointerButtons!==-1&&_.pointerButtons!==Z.buttons))return;const te=this.ctrl.setEventIds(Z);_.pointerCapture&&Z.target.setPointerCapture(Z.pointerId),!(te&&te.size>1&&K._pointerActive)&&(this.start(Z),this.setupPointer(Z),K._pointerId=pointerId(Z),K._pointerActive=!0,this.computeValues(pointerValues(Z)),this.computeInitial(),_.preventScrollAxis&&getPointerType(Z)!=="mouse"?(K._active=!1,this.setupScrollPrevention(Z)):_.delay>0?(this.setupDelayTrigger(Z),_.triggerAllEvents&&(this.compute(Z),this.emit())):this.startPointerDrag(Z))}startPointerDrag(Z){const _=this.state;_._active=!0,_._preventScroll=!0,_._delayed=!1,this.compute(Z),this.emit()}pointerMove(Z){const _=this.state,K=this.config;if(!_._pointerActive)return;const te=pointerId(Z);if(_._pointerId!==void 0&&te!==_._pointerId)return;const ne=pointerValues(Z);if(document.pointerLockElement===Z.target?_._delta=[Z.movementX,Z.movementY]:(_._delta=V$2.sub(ne,_._values),this.computeValues(ne)),V$2.addTo(_._movement,_._delta),this.compute(Z),_._delayed&&_.intentional){this.timeoutStore.remove("dragDelay"),_.active=!1,this.startPointerDrag(Z);return}if(K.preventScrollAxis&&!_._preventScroll)if(_.axis)if(_.axis===K.preventScrollAxis||K.preventScrollAxis==="xy"){_._active=!1,this.clean();return}else{this.timeoutStore.remove("startPointerDrag"),this.startPointerDrag(Z);return}else return;this.emit()}pointerUp(Z){this.ctrl.setEventIds(Z);try{this.config.pointerCapture&&Z.target.hasPointerCapture(Z.pointerId)&&Z.target.releasePointerCapture(Z.pointerId)}catch{}const _=this.state,K=this.config;if(!_._active||!_._pointerActive)return;const te=pointerId(Z);if(_._pointerId!==void 0&&te!==_._pointerId)return;this.state._pointerActive=!1,this.setActive(),this.compute(Z);const[ne,ie]=_._distance;if(_.tap=ne<=K.tapsThreshold&&ie<=K.tapsThreshold,_.tap&&K.filterTaps)_._force=!0;else{const[oe,se]=_._delta,[ae,ge]=_._movement,[ce,de]=K.swipe.velocity,[Ie,fe]=K.swipe.distance,be=K.swipe.duration;if(_.elapsedTime<be){const Ae=Math.abs(oe/_.timeDelta),ye=Math.abs(se/_.timeDelta);Ae>ce&&Math.abs(ae)>Ie&&(_.swipe[0]=Math.sign(oe)),ye>de&&Math.abs(ge)>fe&&(_.swipe[1]=Math.sign(se))}}this.emit()}pointerClick(Z){!this.state.tap&&Z.detail>0&&(Z.preventDefault(),Z.stopPropagation())}setupPointer(Z){const _=this.config,K=_.device;_.pointerLock&&Z.currentTarget.requestPointerLock(),_.pointerCapture||(this.eventStore.add(this.sharedConfig.window,K,"change",this.pointerMove.bind(this)),this.eventStore.add(this.sharedConfig.window,K,"end",this.pointerUp.bind(this)),this.eventStore.add(this.sharedConfig.window,K,"cancel",this.pointerUp.bind(this)))}pointerClean(){this.config.pointerLock&&document.pointerLockElement===this.state.currentTarget&&document.exitPointerLock()}preventScroll(Z){this.state._preventScroll&&Z.cancelable&&Z.preventDefault()}setupScrollPrevention(Z){this.state._preventScroll=!1,persistEvent(Z);const _=this.eventStore.add(this.sharedConfig.window,"touch","change",this.preventScroll.bind(this),{passive:!1});this.eventStore.add(this.sharedConfig.window,"touch","end",_),this.eventStore.add(this.sharedConfig.window,"touch","cancel",_),this.timeoutStore.add("startPointerDrag",this.startPointerDrag.bind(this),this.config.preventScrollDelay,Z)}setupDelayTrigger(Z){this.state._delayed=!0,this.timeoutStore.add("dragDelay",()=>{this.state._step=[0,0],this.startPointerDrag(Z)},this.config.delay)}keyDown(Z){const _=KEYS_DELTA_MAP[Z.key];if(_){const K=this.state,te=Z.shiftKey?10:Z.altKey?.1:1;this.start(Z),K._delta=_(this.config.keyboardDisplacement,te),K._keyboardActive=!0,V$2.addTo(K._movement,K._delta),this.compute(Z),this.emit()}}keyUp(Z){Z.key in KEYS_DELTA_MAP&&(this.state._keyboardActive=!1,this.setActive(),this.compute(Z),this.emit())}bind(Z){const _=this.config.device;Z(_,"start",this.pointerDown.bind(this)),this.config.pointerCapture&&(Z(_,"change",this.pointerMove.bind(this)),Z(_,"end",this.pointerUp.bind(this)),Z(_,"cancel",this.pointerUp.bind(this)),Z("lostPointerCapture","",this.pointerUp.bind(this))),this.config.keys&&(Z("key","down",this.keyDown.bind(this)),Z("key","up",this.keyUp.bind(this))),this.config.filterTaps&&Z("click","",this.pointerClick.bind(this),{capture:!0,passive:!1})}}function persistEvent(X){"persist"in X&&typeof X.persist=="function"&&X.persist()}const isBrowser=typeof window<"u"&&window.document&&window.document.createElement;function supportsTouchEvents(){return isBrowser&&"ontouchstart"in window}function isTouchScreen(){return supportsTouchEvents()||isBrowser&&window.navigator.maxTouchPoints>1}function supportsPointerEvents(){return isBrowser&&"onpointerdown"in window}function supportsPointerLock(){return isBrowser&&"exitPointerLock"in window.document}function supportsGestureEvents(){try{return"constructor"in GestureEvent}catch{return!1}}const SUPPORT={isBrowser,gesture:supportsGestureEvents(),touch:supportsTouchEvents(),touchscreen:isTouchScreen(),pointer:supportsPointerEvents(),pointerLock:supportsPointerLock()},DEFAULT_PREVENT_SCROLL_DELAY=250,DEFAULT_DRAG_DELAY=180,DEFAULT_SWIPE_VELOCITY=.5,DEFAULT_SWIPE_DISTANCE=50,DEFAULT_SWIPE_DURATION=250,DEFAULT_KEYBOARD_DISPLACEMENT=10,DEFAULT_DRAG_AXIS_THRESHOLD={mouse:0,touch:0,pen:8},dragConfigResolver=_objectSpread2$1(_objectSpread2$1({},coordinatesConfigResolver),{},{device(X,Z,{pointer:{touch:_=!1,lock:K=!1,mouse:te=!1}={}}){return this.pointerLock=K&&SUPPORT.pointerLock,SUPPORT.touch&&_?"touch":this.pointerLock?"mouse":SUPPORT.pointer&&!te?"pointer":SUPPORT.touch?"touch":"mouse"},preventScrollAxis(X,Z,{preventScroll:_}){if(this.preventScrollDelay=typeof _=="number"?_:_||_===void 0&&X?DEFAULT_PREVENT_SCROLL_DELAY:void 0,!(!SUPPORT.touchscreen||_===!1))return X||(_!==void 0?"y":void 0)},pointerCapture(X,Z,{pointer:{capture:_=!0,buttons:K=1,keys:te=!0}={}}){return this.pointerButtons=K,this.keys=te,!this.pointerLock&&this.device==="pointer"&&_},threshold(X,Z,{filterTaps:_=!1,tapsThreshold:K=3,axis:te=void 0}){const ne=V$2.toVector(X,_?K:te?1:0);return this.filterTaps=_,this.tapsThreshold=K,ne},swipe({velocity:X=DEFAULT_SWIPE_VELOCITY,distance:Z=DEFAULT_SWIPE_DISTANCE,duration:_=DEFAULT_SWIPE_DURATION}={}){return{velocity:this.transform(V$2.toVector(X)),distance:this.transform(V$2.toVector(Z)),duration:_}},delay(X=0){switch(X){case!0:return DEFAULT_DRAG_DELAY;case!1:return 0;default:return X}},axisThreshold(X){return X?_objectSpread2$1(_objectSpread2$1({},DEFAULT_DRAG_AXIS_THRESHOLD),X):DEFAULT_DRAG_AXIS_THRESHOLD},keyboardDisplacement(X=DEFAULT_KEYBOARD_DISPLACEMENT){return X}});function clampStateInternalMovementToBounds(X){const[Z,_]=X.overflow,[K,te]=X._delta,[ne,ie]=X._direction;(Z<0&&K>0&&ne<0||Z>0&&K<0&&ne>0)&&(X._movement[0]=X._movementBound[0]),(_<0&&te>0&&ie<0||_>0&&te<0&&ie>0)&&(X._movement[1]=X._movementBound[1])}const SCALE_ANGLE_RATIO_INTENT_DEG=30,PINCH_WHEEL_RATIO=100;class PinchEngine extends Engine{constructor(...Z){super(...Z),_defineProperty$4(this,"ingKey","pinching"),_defineProperty$4(this,"aliasKey","da")}init(){this.state.offset=[1,0],this.state.lastOffset=[1,0],this.state._pointerEvents=new Map}reset(){super.reset();const Z=this.state;Z._touchIds=[],Z.canceled=!1,Z.cancel=this.cancel.bind(this),Z.turns=0}computeOffset(){const{type:Z,movement:_,lastOffset:K}=this.state;Z==="wheel"?this.state.offset=V$2.add(_,K):this.state.offset=[(1+_[0])*K[0],_[1]+K[1]]}computeMovement(){const{offset:Z,lastOffset:_}=this.state;this.state.movement=[Z[0]/_[0],Z[1]-_[1]]}axisIntent(){const Z=this.state,[_,K]=Z._movement;if(!Z.axis){const te=Math.abs(_)*SCALE_ANGLE_RATIO_INTENT_DEG-Math.abs(K);te<0?Z.axis="angle":te>0&&(Z.axis="scale")}}restrictToAxis(Z){this.config.lockDirection&&(this.state.axis==="scale"?Z[1]=0:this.state.axis==="angle"&&(Z[0]=0))}cancel(){const Z=this.state;Z.canceled||setTimeout(()=>{Z.canceled=!0,Z._active=!1,this.compute(),this.emit()},0)}touchStart(Z){this.ctrl.setEventIds(Z);const _=this.state,K=this.ctrl.touchIds;if(_._active&&_._touchIds.every(ne=>K.has(ne))||K.size<2)return;this.start(Z),_._touchIds=Array.from(K).slice(0,2);const te=touchDistanceAngle(Z,_._touchIds);te&&this.pinchStart(Z,te)}pointerStart(Z){if(Z.buttons!=null&&Z.buttons%2!==1)return;this.ctrl.setEventIds(Z),Z.target.setPointerCapture(Z.pointerId);const _=this.state,K=_._pointerEvents,te=this.ctrl.pointerIds;if(_._active&&Array.from(K.keys()).every(ie=>te.has(ie))||(K.size<2&&K.set(Z.pointerId,Z),_._pointerEvents.size<2))return;this.start(Z);const ne=distanceAngle(...Array.from(K.values()));ne&&this.pinchStart(Z,ne)}pinchStart(Z,_){const K=this.state;K.origin=_.origin,this.computeValues([_.distance,_.angle]),this.computeInitial(),this.compute(Z),this.emit()}touchMove(Z){if(!this.state._active)return;const _=touchDistanceAngle(Z,this.state._touchIds);_&&this.pinchMove(Z,_)}pointerMove(Z){const _=this.state._pointerEvents;if(_.has(Z.pointerId)&&_.set(Z.pointerId,Z),!this.state._active)return;const K=distanceAngle(...Array.from(_.values()));K&&this.pinchMove(Z,K)}pinchMove(Z,_){const K=this.state,te=K._values[1],ne=_.angle-te;let ie=0;Math.abs(ne)>270&&(ie+=Math.sign(ne)),this.computeValues([_.distance,_.angle-360*ie]),K.origin=_.origin,K.turns=ie,K._movement=[K._values[0]/K._initial[0]-1,K._values[1]-K._initial[1]],this.compute(Z),this.emit()}touchEnd(Z){this.ctrl.setEventIds(Z),this.state._active&&this.state._touchIds.some(_=>!this.ctrl.touchIds.has(_))&&(this.state._active=!1,this.compute(Z),this.emit())}pointerEnd(Z){const _=this.state;this.ctrl.setEventIds(Z);try{Z.target.releasePointerCapture(Z.pointerId)}catch{}_._pointerEvents.has(Z.pointerId)&&_._pointerEvents.delete(Z.pointerId),_._active&&_._pointerEvents.size<2&&(_._active=!1,this.compute(Z),this.emit())}gestureStart(Z){Z.cancelable&&Z.preventDefault();const _=this.state;_._active||(this.start(Z),this.computeValues([Z.scale,Z.rotation]),_.origin=[Z.clientX,Z.clientY],this.compute(Z),this.emit())}gestureMove(Z){if(Z.cancelable&&Z.preventDefault(),!this.state._active)return;const _=this.state;this.computeValues([Z.scale,Z.rotation]),_.origin=[Z.clientX,Z.clientY];const K=_._movement;_._movement=[Z.scale-1,Z.rotation],_._delta=V$2.sub(_._movement,K),this.compute(Z),this.emit()}gestureEnd(Z){this.state._active&&(this.state._active=!1,this.compute(Z),this.emit())}wheel(Z){const _=this.config.modifierKey;_&&(Array.isArray(_)?!_.find(K=>Z[K]):!Z[_])||(this.state._active?this.wheelChange(Z):this.wheelStart(Z),this.timeoutStore.add("wheelEnd",this.wheelEnd.bind(this)))}wheelStart(Z){this.start(Z),this.wheelChange(Z)}wheelChange(Z){"uv"in Z||Z.cancelable&&Z.preventDefault();const K=this.state;K._delta=[-wheelValues(Z)[1]/PINCH_WHEEL_RATIO*K.offset[0],0],V$2.addTo(K._movement,K._delta),clampStateInternalMovementToBounds(K),this.state.origin=[Z.clientX,Z.clientY],this.compute(Z),this.emit()}wheelEnd(){this.state._active&&(this.state._active=!1,this.compute(),this.emit())}bind(Z){const _=this.config.device;_&&(Z(_,"start",this[_+"Start"].bind(this)),Z(_,"change",this[_+"Move"].bind(this)),Z(_,"end",this[_+"End"].bind(this)),Z(_,"cancel",this[_+"End"].bind(this)),Z("lostPointerCapture","",this[_+"End"].bind(this))),this.config.pinchOnWheel&&Z("wheel","",this.wheel.bind(this),{passive:!1})}}const pinchConfigResolver=_objectSpread2$1(_objectSpread2$1({},commonConfigResolver),{},{device(X,Z,{shared:_,pointer:{touch:K=!1}={}}){if(_.target&&!SUPPORT.touch&&SUPPORT.gesture)return"gesture";if(SUPPORT.touch&&K)return"touch";if(SUPPORT.touchscreen){if(SUPPORT.pointer)return"pointer";if(SUPPORT.touch)return"touch"}},bounds(X,Z,{scaleBounds:_={},angleBounds:K={}}){const te=ie=>{const oe=assignDefault(call$1(_,ie),{min:-1/0,max:1/0});return[oe.min,oe.max]},ne=ie=>{const oe=assignDefault(call$1(K,ie),{min:-1/0,max:1/0});return[oe.min,oe.max]};return typeof _!="function"&&typeof K!="function"?[te(),ne()]:ie=>[te(ie),ne(ie)]},threshold(X,Z,_){return this.lockDirection=_.axis==="lock",V$2.toVector(X,this.lockDirection?[.1,3]:0)},modifierKey(X){return X===void 0?"ctrlKey":X},pinchOnWheel(X=!0){return X}});class MoveEngine extends CoordinatesEngine{constructor(...Z){super(...Z),_defineProperty$4(this,"ingKey","moving")}move(Z){this.config.mouseOnly&&Z.pointerType!=="mouse"||(this.state._active?this.moveChange(Z):this.moveStart(Z),this.timeoutStore.add("moveEnd",this.moveEnd.bind(this)))}moveStart(Z){this.start(Z),this.computeValues(pointerValues(Z)),this.compute(Z),this.computeInitial(),this.emit()}moveChange(Z){if(!this.state._active)return;const _=pointerValues(Z),K=this.state;K._delta=V$2.sub(_,K._values),V$2.addTo(K._movement,K._delta),this.computeValues(_),this.compute(Z),this.emit()}moveEnd(Z){this.state._active&&(this.state._active=!1,this.compute(Z),this.emit())}bind(Z){Z("pointer","change",this.move.bind(this)),Z("pointer","leave",this.moveEnd.bind(this))}}const moveConfigResolver=_objectSpread2$1(_objectSpread2$1({},coordinatesConfigResolver),{},{mouseOnly:(X=!0)=>X});class ScrollEngine extends CoordinatesEngine{constructor(...Z){super(...Z),_defineProperty$4(this,"ingKey","scrolling")}scroll(Z){this.state._active||this.start(Z),this.scrollChange(Z),this.timeoutStore.add("scrollEnd",this.scrollEnd.bind(this))}scrollChange(Z){Z.cancelable&&Z.preventDefault();const _=this.state,K=scrollValues(Z);_._delta=V$2.sub(K,_._values),V$2.addTo(_._movement,_._delta),this.computeValues(K),this.compute(Z),this.emit()}scrollEnd(){this.state._active&&(this.state._active=!1,this.compute(),this.emit())}bind(Z){Z("scroll","",this.scroll.bind(this))}}const scrollConfigResolver=coordinatesConfigResolver;class WheelEngine extends CoordinatesEngine{constructor(...Z){super(...Z),_defineProperty$4(this,"ingKey","wheeling")}wheel(Z){this.state._active||this.start(Z),this.wheelChange(Z),this.timeoutStore.add("wheelEnd",this.wheelEnd.bind(this))}wheelChange(Z){const _=this.state;_._delta=wheelValues(Z),V$2.addTo(_._movement,_._delta),clampStateInternalMovementToBounds(_),this.compute(Z),this.emit()}wheelEnd(){this.state._active&&(this.state._active=!1,this.compute(),this.emit())}bind(Z){Z("wheel","",this.wheel.bind(this))}}const wheelConfigResolver=coordinatesConfigResolver;class HoverEngine extends CoordinatesEngine{constructor(...Z){super(...Z),_defineProperty$4(this,"ingKey","hovering")}enter(Z){this.config.mouseOnly&&Z.pointerType!=="mouse"||(this.start(Z),this.computeValues(pointerValues(Z)),this.compute(Z),this.emit())}leave(Z){if(this.config.mouseOnly&&Z.pointerType!=="mouse")return;const _=this.state;if(!_._active)return;_._active=!1;const K=pointerValues(Z);_._movement=_._delta=V$2.sub(K,_._values),this.computeValues(K),this.compute(Z),_.delta=_.movement,this.emit()}bind(Z){Z("pointer","enter",this.enter.bind(this)),Z("pointer","leave",this.leave.bind(this))}}const hoverConfigResolver=_objectSpread2$1(_objectSpread2$1({},coordinatesConfigResolver),{},{mouseOnly:(X=!0)=>X}),EngineMap=new Map,ConfigResolverMap=new Map;function registerAction(X){EngineMap.set(X.key,X.engine),ConfigResolverMap.set(X.key,X.resolver)}const dragAction={key:"drag",engine:DragEngine,resolver:dragConfigResolver},hoverAction={key:"hover",engine:HoverEngine,resolver:hoverConfigResolver},moveAction={key:"move",engine:MoveEngine,resolver:moveConfigResolver},pinchAction={key:"pinch",engine:PinchEngine,resolver:pinchConfigResolver},scrollAction={key:"scroll",engine:ScrollEngine,resolver:scrollConfigResolver},wheelAction={key:"wheel",engine:WheelEngine,resolver:wheelConfigResolver};function _objectWithoutPropertiesLoose$3(X,Z){if(X==null)return{};var _={},K=Object.keys(X),te,ne;for(ne=0;ne<K.length;ne++)te=K[ne],!(Z.indexOf(te)>=0)&&(_[te]=X[te]);return _}function _objectWithoutProperties$3(X,Z){if(X==null)return{};var _=_objectWithoutPropertiesLoose$3(X,Z),K,te;if(Object.getOwnPropertySymbols){var ne=Object.getOwnPropertySymbols(X);for(te=0;te<ne.length;te++)K=ne[te],!(Z.indexOf(K)>=0)&&Object.prototype.propertyIsEnumerable.call(X,K)&&(_[K]=X[K])}return _}const sharedConfigResolver={target(X){if(X)return()=>"current"in X?X.current:X},enabled(X=!0){return X},window(X=SUPPORT.isBrowser?window:void 0){return X},eventOptions({passive:X=!0,capture:Z=!1}={}){return{passive:X,capture:Z}},transform(X){return X}},_excluded$c=["target","eventOptions","window","enabled","transform"];function resolveWith(X={},Z){const _={};for(const[K,te]of Object.entries(Z))switch(typeof te){case"function":_[K]=te.call(_,X[K],K,X);break;case"object":_[K]=resolveWith(X[K],te);break;case"boolean":te&&(_[K]=X[K]);break}return _}function parse$1(X,Z,_={}){const K=X,{target:te,eventOptions:ne,window:ie,enabled:oe,transform:se}=K,ae=_objectWithoutProperties$3(K,_excluded$c);if(_.shared=resolveWith({target:te,eventOptions:ne,window:ie,enabled:oe,transform:se},sharedConfigResolver),Z){const ge=ConfigResolverMap.get(Z);_[Z]=resolveWith(_objectSpread2$1({shared:_.shared},ae),ge)}else for(const ge in ae){const ce=ConfigResolverMap.get(ge);ce&&(_[ge]=resolveWith(_objectSpread2$1({shared:_.shared},ae[ge]),ce))}return _}class EventStore{constructor(Z,_){_defineProperty$4(this,"_listeners",new Set),this._ctrl=Z,this._gestureKey=_}add(Z,_,K,te,ne){const ie=this._listeners,oe=toDomEventType(_,K),se=this._gestureKey?this._ctrl.config[this._gestureKey].eventOptions:{},ae=_objectSpread2$1(_objectSpread2$1({},se),ne);Z.addEventListener(oe,te,ae);const ge=()=>{Z.removeEventListener(oe,te,ae),ie.delete(ge)};return ie.add(ge),ge}clean(){this._listeners.forEach(Z=>Z()),this._listeners.clear()}}class TimeoutStore{constructor(){_defineProperty$4(this,"_timeouts",new Map)}add(Z,_,K=140,...te){this.remove(Z),this._timeouts.set(Z,window.setTimeout(_,K,...te))}remove(Z){const _=this._timeouts.get(Z);_&&window.clearTimeout(_)}clean(){this._timeouts.forEach(Z=>void window.clearTimeout(Z)),this._timeouts.clear()}}let Controller$1=class{constructor(Z){_defineProperty$4(this,"gestures",new Set),_defineProperty$4(this,"_targetEventStore",new EventStore(this)),_defineProperty$4(this,"gestureEventStores",{}),_defineProperty$4(this,"gestureTimeoutStores",{}),_defineProperty$4(this,"handlers",{}),_defineProperty$4(this,"config",{}),_defineProperty$4(this,"pointerIds",new Set),_defineProperty$4(this,"touchIds",new Set),_defineProperty$4(this,"state",{shared:{shiftKey:!1,metaKey:!1,ctrlKey:!1,altKey:!1}}),resolveGestures(this,Z)}setEventIds(Z){if(isTouch(Z))return this.touchIds=new Set(touchIds(Z)),this.touchIds;if("pointerId"in Z)return Z.type==="pointerup"||Z.type==="pointercancel"?this.pointerIds.delete(Z.pointerId):Z.type==="pointerdown"&&this.pointerIds.add(Z.pointerId),this.pointerIds}applyHandlers(Z,_){this.handlers=Z,this.nativeHandlers=_}applyConfig(Z,_){this.config=parse$1(Z,_,this.config)}clean(){this._targetEventStore.clean();for(const Z of this.gestures)this.gestureEventStores[Z].clean(),this.gestureTimeoutStores[Z].clean()}effect(){return this.config.shared.target&&this.bind(),()=>this._targetEventStore.clean()}bind(...Z){const _=this.config.shared,K={};let te;if(!(_.target&&(te=_.target(),!te))){if(_.enabled){for(const ie of this.gestures){const oe=this.config[ie],se=bindToProps(K,oe.eventOptions,!!te);if(oe.enabled){const ae=EngineMap.get(ie);new ae(this,Z,ie).bind(se)}}const ne=bindToProps(K,_.eventOptions,!!te);for(const ie in this.nativeHandlers)ne(ie,"",oe=>this.nativeHandlers[ie](_objectSpread2$1(_objectSpread2$1({},this.state.shared),{},{event:oe,args:Z})),void 0,!0)}for(const ne in K)K[ne]=chain(...K[ne]);if(!te)return K;for(const ne in K){const{device:ie,capture:oe,passive:se}=parseProp(ne);this._targetEventStore.add(te,ie,"",K[ne],{capture:oe,passive:se})}}}};function setupGesture(X,Z){X.gestures.add(Z),X.gestureEventStores[Z]=new EventStore(X,Z),X.gestureTimeoutStores[Z]=new TimeoutStore}function resolveGestures(X,Z){Z.drag&&setupGesture(X,"drag"),Z.wheel&&setupGesture(X,"wheel"),Z.scroll&&setupGesture(X,"scroll"),Z.move&&setupGesture(X,"move"),Z.pinch&&setupGesture(X,"pinch"),Z.hover&&setupGesture(X,"hover")}const bindToProps=(X,Z,_)=>(K,te,ne,ie={},oe=!1)=>{var se,ae;const ge=(se=ie.capture)!==null&&se!==void 0?se:Z.capture,ce=(ae=ie.passive)!==null&&ae!==void 0?ae:Z.passive;let de=oe?K:toHandlerProp(K,te,ge);_&&ce&&(de+="Passive"),X[de]=X[de]||[],X[de].push(ne)},RE_NOT_NATIVE=/^on(Drag|Wheel|Scroll|Move|Pinch|Hover)/;function sortHandlers(X){const Z={},_={},K=new Set;for(let te in X)RE_NOT_NATIVE.test(te)?(K.add(RegExp.lastMatch),_[te]=X[te]):Z[te]=X[te];return[_,Z,K]}function registerGesture(X,Z,_,K,te,ne){if(!X.has(_)||!EngineMap.has(K))return;const ie=_+"Start",oe=_+"End",se=ae=>{let ge;return ae.first&&ie in Z&&Z[ie](ae),_ in Z&&(ge=Z[_](ae)),ae.last&&oe in Z&&Z[oe](ae),ge};te[K]=se,ne[K]=ne[K]||{}}function parseMergedHandlers(X,Z){const[_,K,te]=sortHandlers(X),ne={};return registerGesture(te,_,"onDrag","drag",ne,Z),registerGesture(te,_,"onWheel","wheel",ne,Z),registerGesture(te,_,"onScroll","scroll",ne,Z),registerGesture(te,_,"onPinch","pinch",ne,Z),registerGesture(te,_,"onMove","move",ne,Z),registerGesture(te,_,"onHover","hover",ne,Z),{handlers:ne,config:Z,nativeHandlers:K}}function useRecognizers(X,Z={},_,K){const te=React.useMemo(()=>new Controller$1(X),[]);if(te.applyHandlers(X,K),te.applyConfig(Z,_),React.useEffect(te.effect.bind(te)),React.useEffect(()=>te.clean.bind(te),[]),Z.target===void 0)return te.bind.bind(te)}function useDrag$1(X,Z){return registerAction(dragAction),useRecognizers({drag:X},Z||{},"drag")}function createUseGesture(X){return X.forEach(registerAction),function(_,K){const{handlers:te,nativeHandlers:ne,config:ie}=parseMergedHandlers(_,K||{});return useRecognizers(te,ie,void 0,ne)}}function useGesture(X,Z){return createUseGesture([dragAction,pinchAction,scrollAction,wheelAction,moveAction,hoverAction])(X,Z)}var updateQueue=makeQueue(),raf=X=>schedule(X,updateQueue),writeQueue=makeQueue();raf.write=X=>schedule(X,writeQueue);var onStartQueue=makeQueue();raf.onStart=X=>schedule(X,onStartQueue);var onFrameQueue=makeQueue();raf.onFrame=X=>schedule(X,onFrameQueue);var onFinishQueue=makeQueue();raf.onFinish=X=>schedule(X,onFinishQueue);var timeouts=[];raf.setTimeout=(X,Z)=>{const _=raf.now()+Z,K=()=>{const ne=timeouts.findIndex(ie=>ie.cancel==K);~ne&&timeouts.splice(ne,1),pendingCount-=~ne?1:0},te={time:_,handler:X,cancel:K};return timeouts.splice(findTimeout(_),0,te),pendingCount+=1,start(),te};var findTimeout=X=>~(~timeouts.findIndex(Z=>Z.time>X)||~timeouts.length);raf.cancel=X=>{onStartQueue.delete(X),onFrameQueue.delete(X),onFinishQueue.delete(X),updateQueue.delete(X),writeQueue.delete(X)};raf.sync=X=>{sync=!0,raf.batchedUpdates(X),sync=!1};raf.throttle=X=>{let Z;function _(){try{X(...Z)}finally{Z=null}}function K(...te){Z=te,raf.onStart(_)}return K.handler=X,K.cancel=()=>{onStartQueue.delete(_),Z=null},K};var nativeRaf=typeof window<"u"?window.requestAnimationFrame:()=>{};raf.use=X=>nativeRaf=X;raf.now=typeof performance<"u"?()=>performance.now():Date.now;raf.batchedUpdates=X=>X();raf.catch=console.error;raf.frameLoop="always";raf.advance=()=>{raf.frameLoop!=="demand"?console.warn("Cannot call the manual advancement of rafz whilst frameLoop is not set as demand"):update()};var ts=-1,pendingCount=0,sync=!1;function schedule(X,Z){sync?(Z.delete(X),X(0)):(Z.add(X),start())}function start(){ts<0&&(ts=0,raf.frameLoop!=="demand"&&nativeRaf(loop))}function stop(){ts=-1}function loop(){~ts&&(nativeRaf(loop),raf.batchedUpdates(update))}function update(){const X=ts;ts=raf.now();const Z=findTimeout(ts);if(Z&&(eachSafely(timeouts.splice(0,Z),_=>_.handler()),pendingCount-=Z),!pendingCount){stop();return}onStartQueue.flush(),updateQueue.flush(X?Math.min(64,ts-X):16.667),onFrameQueue.flush(),writeQueue.flush(),onFinishQueue.flush()}function makeQueue(){let X=new Set,Z=X;return{add(_){pendingCount+=Z==X&&!X.has(_)?1:0,X.add(_)},delete(_){return pendingCount-=Z==X&&X.has(_)?1:0,X.delete(_)},flush(_){Z.size&&(X=new Set,pendingCount-=Z.size,eachSafely(Z,K=>K(_)&&X.add(K)),pendingCount+=X.size,Z=X)}}}function eachSafely(X,Z){X.forEach(_=>{try{Z(_)}catch(K){raf.catch(K)}})}var __defProp=Object.defineProperty,__export=(X,Z)=>{for(var _ in Z)__defProp(X,_,{get:Z[_],enumerable:!0})},globals_exports={};__export(globals_exports,{assign:()=>assign$2,colors:()=>colors,createStringInterpolator:()=>createStringInterpolator,skipAnimation:()=>skipAnimation,to:()=>to,willAdvance:()=>willAdvance});function noop$1(){}var defineHidden=(X,Z,_)=>Object.defineProperty(X,Z,{value:_,writable:!0,configurable:!0}),is={arr:Array.isArray,obj:X=>!!X&&X.constructor.name==="Object",fun:X=>typeof X=="function",str:X=>typeof X=="string",num:X=>typeof X=="number",und:X=>X===void 0};function isEqual(X,Z){if(is.arr(X)){if(!is.arr(Z)||X.length!==Z.length)return!1;for(let _=0;_<X.length;_++)if(X[_]!==Z[_])return!1;return!0}return X===Z}var each=(X,Z)=>X.forEach(Z);function eachProp(X,Z,_){if(is.arr(X)){for(let K=0;K<X.length;K++)Z.call(_,X[K],`${K}`);return}for(const K in X)X.hasOwnProperty(K)&&Z.call(_,X[K],K)}var toArray=X=>is.und(X)?[]:is.arr(X)?X:[X];function flush(X,Z){if(X.size){const _=Array.from(X);X.clear(),each(_,Z)}}var flushCalls=(X,...Z)=>flush(X,_=>_(...Z)),isSSR$1=()=>typeof window>"u"||!window.navigator||/ServerSideRendering|^Deno\//.test(window.navigator.userAgent),createStringInterpolator,to,colors=null,skipAnimation=!1,willAdvance=noop$1,assign$2=X=>{X.to&&(to=X.to),X.now&&(raf.now=X.now),X.colors!==void 0&&(colors=X.colors),X.skipAnimation!=null&&(skipAnimation=X.skipAnimation),X.createStringInterpolator&&(createStringInterpolator=X.createStringInterpolator),X.requestAnimationFrame&&raf.use(X.requestAnimationFrame),X.batchedUpdates&&(raf.batchedUpdates=X.batchedUpdates),X.willAdvance&&(willAdvance=X.willAdvance),X.frameLoop&&(raf.frameLoop=X.frameLoop)},startQueue=new Set,currentFrame=[],prevFrame=[],priority=0,frameLoop={get idle(){return!startQueue.size&&!currentFrame.length},start(X){priority>X.priority?(startQueue.add(X),raf.onStart(flushStartQueue)):(startSafely(X),raf(advance))},advance,sort(X){if(priority)raf.onFrame(()=>frameLoop.sort(X));else{const Z=currentFrame.indexOf(X);~Z&&(currentFrame.splice(Z,1),startUnsafely(X))}},clear(){currentFrame=[],startQueue.clear()}};function flushStartQueue(){startQueue.forEach(startSafely),startQueue.clear(),raf(advance)}function startSafely(X){currentFrame.includes(X)||startUnsafely(X)}function startUnsafely(X){currentFrame.splice(findIndex(currentFrame,Z=>Z.priority>X.priority),0,X)}function advance(X){const Z=prevFrame;for(let _=0;_<currentFrame.length;_++){const K=currentFrame[_];priority=K.priority,K.idle||(willAdvance(K),K.advance(X),K.idle||Z.push(K))}return priority=0,prevFrame=currentFrame,prevFrame.length=0,currentFrame=Z,currentFrame.length>0}function findIndex(X,Z){const _=X.findIndex(Z);return _<0?X.length:_}var clamp$1=(X,Z,_)=>Math.min(Math.max(_,X),Z),colors2={transparent:0,aliceblue:4042850303,antiquewhite:4209760255,aqua:16777215,aquamarine:2147472639,azure:4043309055,beige:4126530815,bisque:4293182719,black:255,blanchedalmond:4293643775,blue:65535,blueviolet:2318131967,brown:2771004159,burlywood:3736635391,burntsienna:3934150143,cadetblue:1604231423,chartreuse:2147418367,chocolate:3530104575,coral:4286533887,cornflowerblue:1687547391,cornsilk:4294499583,crimson:3692313855,cyan:16777215,darkblue:35839,darkcyan:9145343,darkgoldenrod:3095792639,darkgray:2846468607,darkgreen:6553855,darkgrey:2846468607,darkkhaki:3182914559,darkmagenta:2332068863,darkolivegreen:1433087999,darkorange:4287365375,darkorchid:2570243327,darkred:2332033279,darksalmon:3918953215,darkseagreen:2411499519,darkslateblue:1211993087,darkslategray:793726975,darkslategrey:793726975,darkturquoise:13554175,darkviolet:2483082239,deeppink:4279538687,deepskyblue:12582911,dimgray:1768516095,dimgrey:1768516095,dodgerblue:512819199,firebrick:2988581631,floralwhite:4294635775,forestgreen:579543807,fuchsia:4278255615,gainsboro:3705462015,ghostwhite:4177068031,gold:4292280575,goldenrod:3668254975,gray:2155905279,green:8388863,greenyellow:2919182335,grey:2155905279,honeydew:4043305215,hotpink:4285117695,indianred:3445382399,indigo:1258324735,ivory:4294963455,khaki:4041641215,lavender:3873897215,lavenderblush:4293981695,lawngreen:2096890111,lemonchiffon:4294626815,lightblue:2916673279,lightcoral:4034953471,lightcyan:3774873599,lightgoldenrodyellow:4210742015,lightgray:3553874943,lightgreen:2431553791,lightgrey:3553874943,lightpink:4290167295,lightsalmon:4288707327,lightseagreen:548580095,lightskyblue:2278488831,lightslategray:2005441023,lightslategrey:2005441023,lightsteelblue:2965692159,lightyellow:4294959359,lime:16711935,limegreen:852308735,linen:4210091775,magenta:4278255615,maroon:2147483903,mediumaquamarine:1724754687,mediumblue:52735,mediumorchid:3126187007,mediumpurple:2473647103,mediumseagreen:1018393087,mediumslateblue:2070474495,mediumspringgreen:16423679,mediumturquoise:1221709055,mediumvioletred:3340076543,midnightblue:421097727,mintcream:4127193855,mistyrose:4293190143,moccasin:4293178879,navajowhite:4292783615,navy:33023,oldlace:4260751103,olive:2155872511,olivedrab:1804477439,orange:4289003775,orangered:4282712319,orchid:3664828159,palegoldenrod:4008225535,palegreen:2566625535,paleturquoise:2951671551,palevioletred:3681588223,papayawhip:4293907967,peachpuff:4292524543,peru:3448061951,pink:4290825215,plum:3718307327,powderblue:2967529215,purple:2147516671,rebeccapurple:1714657791,red:4278190335,rosybrown:3163525119,royalblue:1097458175,saddlebrown:2336560127,salmon:4202722047,sandybrown:4104413439,seagreen:780883967,seashell:4294307583,sienna:2689740287,silver:3233857791,skyblue:2278484991,slateblue:1784335871,slategray:1887473919,slategrey:1887473919,snow:4294638335,springgreen:16744447,steelblue:1182971135,tan:3535047935,teal:8421631,thistle:3636451583,tomato:4284696575,turquoise:1088475391,violet:4001558271,wheat:4125012991,white:4294967295,whitesmoke:4126537215,yellow:4294902015,yellowgreen:2597139199},NUMBER="[-+]?\\d*\\.?\\d+",PERCENTAGE=NUMBER+"%";function call(...X){return"\\(\\s*("+X.join(")\\s*,\\s*(")+")\\s*\\)"}var rgb=new RegExp("rgb"+call(NUMBER,NUMBER,NUMBER)),rgba=new RegExp("rgba"+call(NUMBER,NUMBER,NUMBER,NUMBER)),hsl=new RegExp("hsl"+call(NUMBER,PERCENTAGE,PERCENTAGE)),hsla=new RegExp("hsla"+call(NUMBER,PERCENTAGE,PERCENTAGE,NUMBER)),hex3=/^#([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex4=/^#([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex6=/^#([0-9a-fA-F]{6})$/,hex8=/^#([0-9a-fA-F]{8})$/;function normalizeColor(X){let Z;return typeof X=="number"?X>>>0===X&&X>=0&&X<=4294967295?X:null:(Z=hex6.exec(X))?parseInt(Z[1]+"ff",16)>>>0:colors&&colors[X]!==void 0?colors[X]:(Z=rgb.exec(X))?(parse255(Z[1])<<24|parse255(Z[2])<<16|parse255(Z[3])<<8|255)>>>0:(Z=rgba.exec(X))?(parse255(Z[1])<<24|parse255(Z[2])<<16|parse255(Z[3])<<8|parse1(Z[4]))>>>0:(Z=hex3.exec(X))?parseInt(Z[1]+Z[1]+Z[2]+Z[2]+Z[3]+Z[3]+"ff",16)>>>0:(Z=hex8.exec(X))?parseInt(Z[1],16)>>>0:(Z=hex4.exec(X))?parseInt(Z[1]+Z[1]+Z[2]+Z[2]+Z[3]+Z[3]+Z[4]+Z[4],16)>>>0:(Z=hsl.exec(X))?(hslToRgb(parse360(Z[1]),parsePercentage(Z[2]),parsePercentage(Z[3]))|255)>>>0:(Z=hsla.exec(X))?(hslToRgb(parse360(Z[1]),parsePercentage(Z[2]),parsePercentage(Z[3]))|parse1(Z[4]))>>>0:null}function hue2rgb(X,Z,_){return _<0&&(_+=1),_>1&&(_-=1),_<1/6?X+(Z-X)*6*_:_<1/2?Z:_<2/3?X+(Z-X)*(2/3-_)*6:X}function hslToRgb(X,Z,_){const K=_<.5?_*(1+Z):_+Z-_*Z,te=2*_-K,ne=hue2rgb(te,K,X+1/3),ie=hue2rgb(te,K,X),oe=hue2rgb(te,K,X-1/3);return Math.round(ne*255)<<24|Math.round(ie*255)<<16|Math.round(oe*255)<<8}function parse255(X){const Z=parseInt(X,10);return Z<0?0:Z>255?255:Z}function parse360(X){return(parseFloat(X)%360+360)%360/360}function parse1(X){const Z=parseFloat(X);return Z<0?0:Z>1?255:Math.round(Z*255)}function parsePercentage(X){const Z=parseFloat(X);return Z<0?0:Z>100?1:Z/100}function colorToRgba(X){let Z=normalizeColor(X);if(Z===null)return X;Z=Z||0;const _=(Z&4278190080)>>>24,K=(Z&16711680)>>>16,te=(Z&65280)>>>8,ne=(Z&255)/255;return`rgba(${_}, ${K}, ${te}, ${ne})`}var createInterpolator=(X,Z,_)=>{if(is.fun(X))return X;if(is.arr(X))return createInterpolator({range:X,output:Z,extrapolate:_});if(is.str(X.output[0]))return createStringInterpolator(X);const K=X,te=K.output,ne=K.range||[0,1],ie=K.extrapolateLeft||K.extrapolate||"extend",oe=K.extrapolateRight||K.extrapolate||"extend",se=K.easing||(ae=>ae);return ae=>{const ge=findRange(ae,ne);return interpolate(ae,ne[ge],ne[ge+1],te[ge],te[ge+1],se,ie,oe,K.map)}};function interpolate(X,Z,_,K,te,ne,ie,oe,se){let ae=se?se(X):X;if(ae<Z){if(ie==="identity")return ae;ie==="clamp"&&(ae=Z)}if(ae>_){if(oe==="identity")return ae;oe==="clamp"&&(ae=_)}return K===te?K:Z===_?X<=Z?K:te:(Z===-1/0?ae=-ae:_===1/0?ae=ae-Z:ae=(ae-Z)/(_-Z),ae=ne(ae),K===-1/0?ae=-ae:te===1/0?ae=ae+K:ae=ae*(te-K)+K,ae)}function findRange(X,Z){for(var _=1;_<Z.length-1&&!(Z[_]>=X);++_);return _-1}var steps=(X,Z="end")=>_=>{_=Z==="end"?Math.min(_,.999):Math.max(_,.001);const K=_*X,te=Z==="end"?Math.floor(K):Math.ceil(K);return clamp$1(0,1,te/X)},c1=1.70158,c2=c1*1.525,c3=c1+1,c4=2*Math.PI/3,c5=2*Math.PI/4.5,bounceOut=X=>X<1/2.75?7.5625*X*X:X<2/2.75?7.5625*(X-=1.5/2.75)*X+.75:X<2.5/2.75?7.5625*(X-=2.25/2.75)*X+.9375:7.5625*(X-=2.625/2.75)*X+.984375,easings={linear:X=>X,easeInQuad:X=>X*X,easeOutQuad:X=>1-(1-X)*(1-X),easeInOutQuad:X=>X<.5?2*X*X:1-Math.pow(-2*X+2,2)/2,easeInCubic:X=>X*X*X,easeOutCubic:X=>1-Math.pow(1-X,3),easeInOutCubic:X=>X<.5?4*X*X*X:1-Math.pow(-2*X+2,3)/2,easeInQuart:X=>X*X*X*X,easeOutQuart:X=>1-Math.pow(1-X,4),easeInOutQuart:X=>X<.5?8*X*X*X*X:1-Math.pow(-2*X+2,4)/2,easeInQuint:X=>X*X*X*X*X,easeOutQuint:X=>1-Math.pow(1-X,5),easeInOutQuint:X=>X<.5?16*X*X*X*X*X:1-Math.pow(-2*X+2,5)/2,easeInSine:X=>1-Math.cos(X*Math.PI/2),easeOutSine:X=>Math.sin(X*Math.PI/2),easeInOutSine:X=>-(Math.cos(Math.PI*X)-1)/2,easeInExpo:X=>X===0?0:Math.pow(2,10*X-10),easeOutExpo:X=>X===1?1:1-Math.pow(2,-10*X),easeInOutExpo:X=>X===0?0:X===1?1:X<.5?Math.pow(2,20*X-10)/2:(2-Math.pow(2,-20*X+10))/2,easeInCirc:X=>1-Math.sqrt(1-Math.pow(X,2)),easeOutCirc:X=>Math.sqrt(1-Math.pow(X-1,2)),easeInOutCirc:X=>X<.5?(1-Math.sqrt(1-Math.pow(2*X,2)))/2:(Math.sqrt(1-Math.pow(-2*X+2,2))+1)/2,easeInBack:X=>c3*X*X*X-c1*X*X,easeOutBack:X=>1+c3*Math.pow(X-1,3)+c1*Math.pow(X-1,2),easeInOutBack:X=>X<.5?Math.pow(2*X,2)*((c2+1)*2*X-c2)/2:(Math.pow(2*X-2,2)*((c2+1)*(X*2-2)+c2)+2)/2,easeInElastic:X=>X===0?0:X===1?1:-Math.pow(2,10*X-10)*Math.sin((X*10-10.75)*c4),easeOutElastic:X=>X===0?0:X===1?1:Math.pow(2,-10*X)*Math.sin((X*10-.75)*c4)+1,easeInOutElastic:X=>X===0?0:X===1?1:X<.5?-(Math.pow(2,20*X-10)*Math.sin((20*X-11.125)*c5))/2:Math.pow(2,-20*X+10)*Math.sin((20*X-11.125)*c5)/2+1,easeInBounce:X=>1-bounceOut(1-X),easeOutBounce:bounceOut,easeInOutBounce:X=>X<.5?(1-bounceOut(1-2*X))/2:(1+bounceOut(2*X-1))/2,steps},$get=Symbol.for("FluidValue.get"),$observers=Symbol.for("FluidValue.observers"),hasFluidValue=X=>!!(X&&X[$get]),getFluidValue=X=>X&&X[$get]?X[$get]():X,getFluidObservers=X=>X[$observers]||null;function callFluidObserver(X,Z){X.eventObserved?X.eventObserved(Z):X(Z)}function callFluidObservers(X,Z){const _=X[$observers];_&&_.forEach(K=>{callFluidObserver(K,Z)})}var FluidValue=class{constructor(X){if(!X&&!(X=this.get))throw Error("Unknown getter");setFluidGetter(this,X)}},setFluidGetter=(X,Z)=>setHidden(X,$get,Z);function addFluidObserver(X,Z){if(X[$get]){let _=X[$observers];_||setHidden(X,$observers,_=new Set),_.has(Z)||(_.add(Z),X.observerAdded&&X.observerAdded(_.size,Z))}return Z}function removeFluidObserver(X,Z){const _=X[$observers];if(_&&_.has(Z)){const K=_.size-1;K?_.delete(Z):X[$observers]=null,X.observerRemoved&&X.observerRemoved(K,Z)}}var setHidden=(X,Z,_)=>Object.defineProperty(X,Z,{value:_,writable:!0,configurable:!0}),numberRegex=/[+\-]?(?:0|[1-9]\d*)(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,colorRegex=/(#(?:[0-9a-f]{2}){2,4}|(#[0-9a-f]{3})|(rgb|hsl)a?\((-?\d+%?[,\s]+){2,3}\s*[\d\.]+%?\))/gi,unitRegex=new RegExp(`(${numberRegex.source})(%|[a-z]+)`,"i"),rgbaRegex=/rgba\(([0-9\.-]+), ([0-9\.-]+), ([0-9\.-]+), ([0-9\.-]+)\)/gi,cssVariableRegex=/var\((--[a-zA-Z0-9-_]+),? ?([a-zA-Z0-9 ()%#.,-]+)?\)/,variableToRgba=X=>{const[Z,_]=parseCSSVariable(X);if(!Z||isSSR$1())return X;const K=window.getComputedStyle(document.documentElement).getPropertyValue(Z);if(K)return K.trim();if(_&&_.startsWith("--")){const te=window.getComputedStyle(document.documentElement).getPropertyValue(_);return te||X}else{if(_&&cssVariableRegex.test(_))return variableToRgba(_);if(_)return _}return X},parseCSSVariable=X=>{const Z=cssVariableRegex.exec(X);if(!Z)return[,];const[,_,K]=Z;return[_,K]},namedColorRegex,rgbaRound=(X,Z,_,K,te)=>`rgba(${Math.round(Z)}, ${Math.round(_)}, ${Math.round(K)}, ${te})`,createStringInterpolator2=X=>{namedColorRegex||(namedColorRegex=colors?new RegExp(`(${Object.keys(colors).join("|")})(?!\\w)`,"g"):/^\b$/);const Z=X.output.map(ne=>getFluidValue(ne).replace(cssVariableRegex,variableToRgba).replace(colorRegex,colorToRgba).replace(namedColorRegex,colorToRgba)),_=Z.map(ne=>ne.match(numberRegex).map(Number)),te=_[0].map((ne,ie)=>_.map(oe=>{if(!(ie in oe))throw Error('The arity of each "output" value must be equal');return oe[ie]})).map(ne=>createInterpolator({...X,output:ne}));return ne=>{var se;const ie=!unitRegex.test(Z[0])&&((se=Z.find(ae=>unitRegex.test(ae)))==null?void 0:se.replace(numberRegex,""));let oe=0;return Z[0].replace(numberRegex,()=>`${te[oe++](ne)}${ie||""}`).replace(rgbaRegex,rgbaRound)}},prefix="react-spring: ",once$1=X=>{const Z=X;let _=!1;if(typeof Z!="function")throw new TypeError(`${prefix}once requires a function parameter`);return(...K)=>{_||(Z(...K),_=!0)}},warnInterpolate=once$1(console.warn);function deprecateInterpolate(){warnInterpolate(`${prefix}The "interpolate" function is deprecated in v9 (use "to" instead)`)}var warnDirectCall=once$1(console.warn);function deprecateDirectCall(){warnDirectCall(`${prefix}Directly calling start instead of using the api object is deprecated in v9 (use ".start" instead), this will be removed in later 0.X.0 versions`)}function isAnimatedString(X){return is.str(X)&&(X[0]=="#"||/\d/.test(X)||!isSSR$1()&&cssVariableRegex.test(X)||X in(colors||{}))}var useIsomorphicLayoutEffect$1=isSSR$1()?reactExports.useEffect:reactExports.useLayoutEffect,useIsMounted=()=>{const X=reactExports.useRef(!1);return useIsomorphicLayoutEffect$1(()=>(X.current=!0,()=>{X.current=!1}),[]),X};function useForceUpdate(){const X=reactExports.useState()[1],Z=useIsMounted();return()=>{Z.current&&X(Math.random())}}function useMemoOne(X,Z){const[_]=reactExports.useState(()=>({inputs:Z,result:X()})),K=reactExports.useRef(),te=K.current;let ne=te;return ne?ne.inputs&&areInputsEqual(Z,ne.inputs)||(ne={inputs:Z,result:X()}):ne=_,reactExports.useEffect(()=>{K.current=ne,te==_&&(_.inputs=_.result=void 0)},[ne]),ne.result}function areInputsEqual(X,Z){if(X.length!==Z.length)return!1;for(let _=0;_<X.length;_++)if(X[_]!==Z[_])return!1;return!0}var useOnce=X=>reactExports.useEffect(X,emptyDeps),emptyDeps=[];function usePrev(X){const Z=reactExports.useRef();return reactExports.useEffect(()=>{Z.current=X}),Z.current}var $node=Symbol.for("Animated:node"),isAnimated=X=>!!X&&X[$node]===X,getAnimated=X=>X&&X[$node],setAnimated=(X,Z)=>defineHidden(X,$node,Z),getPayload=X=>X&&X[$node]&&X[$node].getPayload(),Animated=class{constructor(){setAnimated(this,this)}getPayload(){return this.payload||[]}},AnimatedValue=class extends Animated{constructor(X){super(),this._value=X,this.done=!0,this.durationProgress=0,is.num(this._value)&&(this.lastPosition=this._value)}static create(X){return new AnimatedValue(X)}getPayload(){return[this]}getValue(){return this._value}setValue(X,Z){return is.num(X)&&(this.lastPosition=X,Z&&(X=Math.round(X/Z)*Z,this.done&&(this.lastPosition=X))),this._value===X?!1:(this._value=X,!0)}reset(){const{done:X}=this;this.done=!1,is.num(this._value)&&(this.elapsedTime=0,this.durationProgress=0,this.lastPosition=this._value,X&&(this.lastVelocity=null),this.v0=null)}},AnimatedString=class extends AnimatedValue{constructor(X){super(0),this._string=null,this._toString=createInterpolator({output:[X,X]})}static create(X){return new AnimatedString(X)}getValue(){const X=this._string;return X??(this._string=this._toString(this._value))}setValue(X){if(is.str(X)){if(X==this._string)return!1;this._string=X,this._value=1}else if(super.setValue(X))this._string=null;else return!1;return!0}reset(X){X&&(this._toString=createInterpolator({output:[this.getValue(),X]})),this._value=0,super.reset()}},TreeContext={dependencies:null},AnimatedObject=class extends Animated{constructor(X){super(),this.source=X,this.setValue(X)}getValue(X){const Z={};return eachProp(this.source,(_,K)=>{isAnimated(_)?Z[K]=_.getValue(X):hasFluidValue(_)?Z[K]=getFluidValue(_):X||(Z[K]=_)}),Z}setValue(X){this.source=X,this.payload=this._makePayload(X)}reset(){this.payload&&each(this.payload,X=>X.reset())}_makePayload(X){if(X){const Z=new Set;return eachProp(X,this._addToPayload,Z),Array.from(Z)}}_addToPayload(X){TreeContext.dependencies&&hasFluidValue(X)&&TreeContext.dependencies.add(X);const Z=getPayload(X);Z&&each(Z,_=>this.add(_))}},AnimatedArray=class extends AnimatedObject{constructor(X){super(X)}static create(X){return new AnimatedArray(X)}getValue(){return this.source.map(X=>X.getValue())}setValue(X){const Z=this.getPayload();return X.length==Z.length?Z.map((_,K)=>_.setValue(X[K])).some(Boolean):(super.setValue(X.map(makeAnimated)),!0)}};function makeAnimated(X){return(isAnimatedString(X)?AnimatedString:AnimatedValue).create(X)}function getAnimatedType(X){const Z=getAnimated(X);return Z?Z.constructor:is.arr(X)?AnimatedArray:isAnimatedString(X)?AnimatedString:AnimatedValue}var withAnimated=(X,Z)=>{const _=!is.fun(X)||X.prototype&&X.prototype.isReactComponent;return reactExports.forwardRef((K,te)=>{const ne=reactExports.useRef(null),ie=_&&reactExports.useCallback(fe=>{ne.current=updateRef(te,fe)},[te]),[oe,se]=getAnimatedState(K,Z),ae=useForceUpdate(),ge=()=>{const fe=ne.current;if(_&&!fe)return;(fe?Z.applyAnimatedValues(fe,oe.getValue(!0)):!1)===!1&&ae()},ce=new PropsObserver(ge,se),de=reactExports.useRef();useIsomorphicLayoutEffect$1(()=>(de.current=ce,each(se,fe=>addFluidObserver(fe,ce)),()=>{de.current&&(each(de.current.deps,fe=>removeFluidObserver(fe,de.current)),raf.cancel(de.current.update))})),reactExports.useEffect(ge,[]),useOnce(()=>()=>{const fe=de.current;each(fe.deps,be=>removeFluidObserver(be,fe))});const Ie=Z.getComponentProps(oe.getValue());return reactExports.createElement(X,{...Ie,ref:ie})})},PropsObserver=class{constructor(X,Z){this.update=X,this.deps=Z}eventObserved(X){X.type=="change"&&raf.write(this.update)}};function getAnimatedState(X,Z){const _=new Set;return TreeContext.dependencies=_,X.style&&(X={...X,style:Z.createAnimatedStyle(X.style)}),X=new AnimatedObject(X),TreeContext.dependencies=null,[X,_]}function updateRef(X,Z){return X&&(is.fun(X)?X(Z):X.current=Z),Z}var cacheKey=Symbol.for("AnimatedComponent"),createHost=(X,{applyAnimatedValues:Z=()=>!1,createAnimatedStyle:_=te=>new AnimatedObject(te),getComponentProps:K=te=>te}={})=>{const te={applyAnimatedValues:Z,createAnimatedStyle:_,getComponentProps:K},ne=ie=>{const oe=getDisplayName(ie)||"Anonymous";return is.str(ie)?ie=ne[ie]||(ne[ie]=withAnimated(ie,te)):ie=ie[cacheKey]||(ie[cacheKey]=withAnimated(ie,te)),ie.displayName=`Animated(${oe})`,ie};return eachProp(X,(ie,oe)=>{is.arr(X)&&(oe=getDisplayName(ie)),ne[oe]=ne(ie)}),{animated:ne}},getDisplayName=X=>is.str(X)?X:X&&is.str(X.displayName)?X.displayName:is.fun(X)&&X.name||null;function callProp(X,...Z){return is.fun(X)?X(...Z):X}var matchProp=(X,Z)=>X===!0||!!(Z&&X&&(is.fun(X)?X(Z):toArray(X).includes(Z))),resolveProp=(X,Z)=>is.obj(X)?Z&&X[Z]:X,getDefaultProp=(X,Z)=>X.default===!0?X[Z]:X.default?X.default[Z]:void 0,noopTransform=X=>X,getDefaultProps=(X,Z=noopTransform)=>{let _=DEFAULT_PROPS;X.default&&X.default!==!0&&(X=X.default,_=Object.keys(X));const K={};for(const te of _){const ne=Z(X[te],te);is.und(ne)||(K[te]=ne)}return K},DEFAULT_PROPS=["config","onProps","onStart","onChange","onPause","onResume","onRest"],RESERVED_PROPS={config:1,from:1,to:1,ref:1,loop:1,reset:1,pause:1,cancel:1,reverse:1,immediate:1,default:1,delay:1,onProps:1,onStart:1,onChange:1,onPause:1,onResume:1,onRest:1,onResolve:1,items:1,trail:1,sort:1,expires:1,initial:1,enter:1,update:1,leave:1,children:1,onDestroyed:1,keys:1,callId:1,parentId:1};function getForwardProps(X){const Z={};let _=0;if(eachProp(X,(K,te)=>{RESERVED_PROPS[te]||(Z[te]=K,_++)}),_)return Z}function inferTo(X){const Z=getForwardProps(X);if(Z){const _={to:Z};return eachProp(X,(K,te)=>te in Z||(_[te]=K)),_}return{...X}}function computeGoal(X){return X=getFluidValue(X),is.arr(X)?X.map(computeGoal):isAnimatedString(X)?globals_exports.createStringInterpolator({range:[0,1],output:[X,X]})(1):X}function hasProps(X){for(const Z in X)return!0;return!1}function isAsyncTo(X){return is.fun(X)||is.arr(X)&&is.obj(X[0])}function detachRefs(X,Z){var _;(_=X.ref)==null||_.delete(X),Z==null||Z.delete(X)}function replaceRef(X,Z){var _;Z&&X.ref!==Z&&((_=X.ref)==null||_.delete(X),Z.add(X),X.ref=Z)}var config={default:{tension:170,friction:26},gentle:{tension:120,friction:14},wobbly:{tension:180,friction:12},stiff:{tension:210,friction:20},slow:{tension:280,friction:60},molasses:{tension:280,friction:120}},defaults={...config.default,mass:1,damping:1,easing:easings.linear,clamp:!1},AnimationConfig=class{constructor(){this.velocity=0,Object.assign(this,defaults)}};function mergeConfig(X,Z,_){_&&(_={..._},sanitizeConfig(_,Z),Z={..._,...Z}),sanitizeConfig(X,Z),Object.assign(X,Z);for(const ie in defaults)X[ie]==null&&(X[ie]=defaults[ie]);let{frequency:K,damping:te}=X;const{mass:ne}=X;return is.und(K)||(K<.01&&(K=.01),te<0&&(te=0),X.tension=Math.pow(2*Math.PI/K,2)*ne,X.friction=4*Math.PI*te*ne/K),X}function sanitizeConfig(X,Z){if(!is.und(Z.decay))X.duration=void 0;else{const _=!is.und(Z.tension)||!is.und(Z.friction);(_||!is.und(Z.frequency)||!is.und(Z.damping)||!is.und(Z.mass))&&(X.duration=void 0,X.decay=void 0),_&&(X.frequency=void 0)}}var emptyArray=[],Animation=class{constructor(){this.changed=!1,this.values=emptyArray,this.toValues=null,this.fromValues=emptyArray,this.config=new AnimationConfig,this.immediate=!1}};function scheduleProps(X,{key:Z,props:_,defaultProps:K,state:te,actions:ne}){return new Promise((ie,oe)=>{let se,ae,ge=matchProp(_.cancel??(K==null?void 0:K.cancel),Z);if(ge)Ie();else{is.und(_.pause)||(te.paused=matchProp(_.pause,Z));let fe=K==null?void 0:K.pause;fe!==!0&&(fe=te.paused||matchProp(fe,Z)),se=callProp(_.delay||0,Z),fe?(te.resumeQueue.add(de),ne.pause()):(ne.resume(),de())}function ce(){te.resumeQueue.add(de),te.timeouts.delete(ae),ae.cancel(),se=ae.time-raf.now()}function de(){se>0&&!globals_exports.skipAnimation?(te.delayed=!0,ae=raf.setTimeout(Ie,se),te.pauseQueue.add(ce),te.timeouts.add(ae)):Ie()}function Ie(){te.delayed&&(te.delayed=!1),te.pauseQueue.delete(ce),te.timeouts.delete(ae),X<=(te.cancelId||0)&&(ge=!0);try{ne.start({..._,callId:X,cancel:ge},ie)}catch(fe){oe(fe)}}})}var getCombinedResult=(X,Z)=>Z.length==1?Z[0]:Z.some(_=>_.cancelled)?getCancelledResult(X.get()):Z.every(_=>_.noop)?getNoopResult(X.get()):getFinishedResult(X.get(),Z.every(_=>_.finished)),getNoopResult=X=>({value:X,noop:!0,finished:!0,cancelled:!1}),getFinishedResult=(X,Z,_=!1)=>({value:X,finished:Z,cancelled:_}),getCancelledResult=X=>({value:X,cancelled:!0,finished:!1});function runAsync(X,Z,_,K){const{callId:te,parentId:ne,onRest:ie}=Z,{asyncTo:oe,promise:se}=_;return!ne&&X===oe&&!Z.reset?se:_.promise=(async()=>{_.asyncId=te,_.asyncTo=X;const ae=getDefaultProps(Z,(Ae,ye)=>ye==="onRest"?void 0:Ae);let ge,ce;const de=new Promise((Ae,ye)=>(ge=Ae,ce=ye)),Ie=Ae=>{const ye=te<=(_.cancelId||0)&&getCancelledResult(K)||te!==_.asyncId&&getFinishedResult(K,!1);if(ye)throw Ae.result=ye,ce(Ae),Ae},fe=(Ae,ye)=>{const ve=new BailSignal,Be=new SkipAnimationSignal;return(async()=>{if(globals_exports.skipAnimation)throw stopAsync(_),Be.result=getFinishedResult(K,!1),ce(Be),Be;Ie(ve);const Re=is.obj(Ae)?{...Ae}:{...ye,to:Ae};Re.parentId=te,eachProp(ae,(Ee,Ze)=>{is.und(Re[Ze])&&(Re[Ze]=Ee)});const Ve=await K.start(Re);return Ie(ve),_.paused&&await new Promise(Ee=>{_.resumeQueue.add(Ee)}),Ve})()};let be;if(globals_exports.skipAnimation)return stopAsync(_),getFinishedResult(K,!1);try{let Ae;is.arr(X)?Ae=(async ye=>{for(const ve of ye)await fe(ve)})(X):Ae=Promise.resolve(X(fe,K.stop.bind(K))),await Promise.all([Ae.then(ge),de]),be=getFinishedResult(K.get(),!0,!1)}catch(Ae){if(Ae instanceof BailSignal)be=Ae.result;else if(Ae instanceof SkipAnimationSignal)be=Ae.result;else throw Ae}finally{te==_.asyncId&&(_.asyncId=ne,_.asyncTo=ne?oe:void 0,_.promise=ne?se:void 0)}return is.fun(ie)&&raf.batchedUpdates(()=>{ie(be,K,K.item)}),be})()}function stopAsync(X,Z){flush(X.timeouts,_=>_.cancel()),X.pauseQueue.clear(),X.resumeQueue.clear(),X.asyncId=X.asyncTo=X.promise=void 0,Z&&(X.cancelId=Z)}var BailSignal=class extends Error{constructor(){super("An async animation has been interrupted. You see this error because you forgot to use `await` or `.catch(...)` on its returned promise.")}},SkipAnimationSignal=class extends Error{constructor(){super("SkipAnimationSignal")}},isFrameValue=X=>X instanceof FrameValue,nextId=1,FrameValue=class extends FluidValue{constructor(){super(...arguments),this.id=nextId++,this._priority=0}get priority(){return this._priority}set priority(X){this._priority!=X&&(this._priority=X,this._onPriorityChange(X))}get(){const X=getAnimated(this);return X&&X.getValue()}to(...X){return globals_exports.to(this,X)}interpolate(...X){return deprecateInterpolate(),globals_exports.to(this,X)}toJSON(){return this.get()}observerAdded(X){X==1&&this._attach()}observerRemoved(X){X==0&&this._detach()}_attach(){}_detach(){}_onChange(X,Z=!1){callFluidObservers(this,{type:"change",parent:this,value:X,idle:Z})}_onPriorityChange(X){this.idle||frameLoop.sort(this),callFluidObservers(this,{type:"priority",parent:this,priority:X})}},$P=Symbol.for("SpringPhase"),HAS_ANIMATED=1,IS_ANIMATING=2,IS_PAUSED=4,hasAnimated=X=>(X[$P]&HAS_ANIMATED)>0,isAnimating=X=>(X[$P]&IS_ANIMATING)>0,isPaused=X=>(X[$P]&IS_PAUSED)>0,setActiveBit=(X,Z)=>Z?X[$P]|=IS_ANIMATING|HAS_ANIMATED:X[$P]&=-3,setPausedBit=(X,Z)=>Z?X[$P]|=IS_PAUSED:X[$P]&=-5,SpringValue=class extends FrameValue{constructor(X,Z){if(super(),this.animation=new Animation,this.defaultProps={},this._state={paused:!1,delayed:!1,pauseQueue:new Set,resumeQueue:new Set,timeouts:new Set},this._pendingCalls=new Set,this._lastCallId=0,this._lastToId=0,this._memoizedDuration=0,!is.und(X)||!is.und(Z)){const _=is.obj(X)?{...X}:{...Z,from:X};is.und(_.default)&&(_.default=!0),this.start(_)}}get idle(){return!(isAnimating(this)||this._state.asyncTo)||isPaused(this)}get goal(){return getFluidValue(this.animation.to)}get velocity(){const X=getAnimated(this);return X instanceof AnimatedValue?X.lastVelocity||0:X.getPayload().map(Z=>Z.lastVelocity||0)}get hasAnimated(){return hasAnimated(this)}get isAnimating(){return isAnimating(this)}get isPaused(){return isPaused(this)}get isDelayed(){return this._state.delayed}advance(X){let Z=!0,_=!1;const K=this.animation;let{toValues:te}=K;const{config:ne}=K,ie=getPayload(K.to);!ie&&hasFluidValue(K.to)&&(te=toArray(getFluidValue(K.to))),K.values.forEach((ae,ge)=>{if(ae.done)return;const ce=ae.constructor==AnimatedString?1:ie?ie[ge].lastPosition:te[ge];let de=K.immediate,Ie=ce;if(!de){if(Ie=ae.lastPosition,ne.tension<=0){ae.done=!0;return}let fe=ae.elapsedTime+=X;const be=K.fromValues[ge],Ae=ae.v0!=null?ae.v0:ae.v0=is.arr(ne.velocity)?ne.velocity[ge]:ne.velocity;let ye;const ve=ne.precision||(be==ce?.005:Math.min(1,Math.abs(ce-be)*.001));if(is.und(ne.duration))if(ne.decay){const Be=ne.decay===!0?.998:ne.decay,Re=Math.exp(-(1-Be)*fe);Ie=be+Ae/(1-Be)*(1-Re),de=Math.abs(ae.lastPosition-Ie)<=ve,ye=Ae*Re}else{ye=ae.lastVelocity==null?Ae:ae.lastVelocity;const Be=ne.restVelocity||ve/10,Re=ne.clamp?0:ne.bounce,Ve=!is.und(Re),Ee=be==ce?ae.v0>0:be<ce;let Ze,_e=!1;const Fe=1,Te=Math.ceil(X/Fe);for(let ke=0;ke<Te&&(Ze=Math.abs(ye)>Be,!(!Ze&&(de=Math.abs(ce-Ie)<=ve,de)));++ke){Ve&&(_e=Ie==ce||Ie>ce==Ee,_e&&(ye=-ye*Re,Ie=ce));const Le=-ne.tension*1e-6*(Ie-ce),Ke=-ne.friction*.001*ye,Ue=(Le+Ke)/ne.mass;ye=ye+Ue*Fe,Ie=Ie+ye*Fe}}else{let Be=1;ne.duration>0&&(this._memoizedDuration!==ne.duration&&(this._memoizedDuration=ne.duration,ae.durationProgress>0&&(ae.elapsedTime=ne.duration*ae.durationProgress,fe=ae.elapsedTime+=X)),Be=(ne.progress||0)+fe/this._memoizedDuration,Be=Be>1?1:Be<0?0:Be,ae.durationProgress=Be),Ie=be+ne.easing(Be)*(ce-be),ye=(Ie-ae.lastPosition)/X,de=Be==1}ae.lastVelocity=ye,Number.isNaN(Ie)&&(console.warn("Got NaN while animating:",this),de=!0)}ie&&!ie[ge].done&&(de=!1),de?ae.done=!0:Z=!1,ae.setValue(Ie,ne.round)&&(_=!0)});const oe=getAnimated(this),se=oe.getValue();if(Z){const ae=getFluidValue(K.to);(se!==ae||_)&&!ne.decay?(oe.setValue(ae),this._onChange(ae)):_&&ne.decay&&this._onChange(se),this._stop()}else _&&this._onChange(se)}set(X){return raf.batchedUpdates(()=>{this._stop(),this._focus(X),this._set(X)}),this}pause(){this._update({pause:!0})}resume(){this._update({pause:!1})}finish(){if(isAnimating(this)){const{to:X,config:Z}=this.animation;raf.batchedUpdates(()=>{this._onStart(),Z.decay||this._set(X,!1),this._stop()})}return this}update(X){return(this.queue||(this.queue=[])).push(X),this}start(X,Z){let _;return is.und(X)?(_=this.queue||[],this.queue=[]):_=[is.obj(X)?X:{...Z,to:X}],Promise.all(_.map(K=>this._update(K))).then(K=>getCombinedResult(this,K))}stop(X){const{to:Z}=this.animation;return this._focus(this.get()),stopAsync(this._state,X&&this._lastCallId),raf.batchedUpdates(()=>this._stop(Z,X)),this}reset(){this._update({reset:!0})}eventObserved(X){X.type=="change"?this._start():X.type=="priority"&&(this.priority=X.priority+1)}_prepareNode(X){const Z=this.key||"";let{to:_,from:K}=X;_=is.obj(_)?_[Z]:_,(_==null||isAsyncTo(_))&&(_=void 0),K=is.obj(K)?K[Z]:K,K==null&&(K=void 0);const te={to:_,from:K};return hasAnimated(this)||(X.reverse&&([_,K]=[K,_]),K=getFluidValue(K),is.und(K)?getAnimated(this)||this._set(_):this._set(K)),te}_update({...X},Z){const{key:_,defaultProps:K}=this;X.default&&Object.assign(K,getDefaultProps(X,(ie,oe)=>/^on/.test(oe)?resolveProp(ie,_):ie)),mergeActiveFn(this,X,"onProps"),sendEvent(this,"onProps",X,this);const te=this._prepareNode(X);if(Object.isFrozen(this))throw Error("Cannot animate a `SpringValue` object that is frozen. Did you forget to pass your component to `animated(...)` before animating its props?");const ne=this._state;return scheduleProps(++this._lastCallId,{key:_,props:X,defaultProps:K,state:ne,actions:{pause:()=>{isPaused(this)||(setPausedBit(this,!0),flushCalls(ne.pauseQueue),sendEvent(this,"onPause",getFinishedResult(this,checkFinished(this,this.animation.to)),this))},resume:()=>{isPaused(this)&&(setPausedBit(this,!1),isAnimating(this)&&this._resume(),flushCalls(ne.resumeQueue),sendEvent(this,"onResume",getFinishedResult(this,checkFinished(this,this.animation.to)),this))},start:this._merge.bind(this,te)}}).then(ie=>{if(X.loop&&ie.finished&&!(Z&&ie.noop)){const oe=createLoopUpdate(X);if(oe)return this._update(oe,!0)}return ie})}_merge(X,Z,_){if(Z.cancel)return this.stop(!0),_(getCancelledResult(this));const K=!is.und(X.to),te=!is.und(X.from);if(K||te)if(Z.callId>this._lastToId)this._lastToId=Z.callId;else return _(getCancelledResult(this));const{key:ne,defaultProps:ie,animation:oe}=this,{to:se,from:ae}=oe;let{to:ge=se,from:ce=ae}=X;te&&!K&&(!Z.default||is.und(ge))&&(ge=ce),Z.reverse&&([ge,ce]=[ce,ge]);const de=!isEqual(ce,ae);de&&(oe.from=ce),ce=getFluidValue(ce);const Ie=!isEqual(ge,se);Ie&&this._focus(ge);const fe=isAsyncTo(Z.to),{config:be}=oe,{decay:Ae,velocity:ye}=be;(K||te)&&(be.velocity=0),Z.config&&!fe&&mergeConfig(be,callProp(Z.config,ne),Z.config!==ie.config?callProp(ie.config,ne):void 0);let ve=getAnimated(this);if(!ve||is.und(ge))return _(getFinishedResult(this,!0));const Be=is.und(Z.reset)?te&&!Z.default:!is.und(ce)&&matchProp(Z.reset,ne),Re=Be?ce:this.get(),Ve=computeGoal(ge),Ee=is.num(Ve)||is.arr(Ve)||isAnimatedString(Ve),Ze=!fe&&(!Ee||matchProp(ie.immediate||Z.immediate,ne));if(Ie){const ke=getAnimatedType(ge);if(ke!==ve.constructor)if(Ze)ve=this._set(Ve);else throw Error(`Cannot animate between ${ve.constructor.name} and ${ke.name}, as the "to" prop suggests`)}const _e=ve.constructor;let Fe=hasFluidValue(ge),Te=!1;if(!Fe){const ke=Be||!hasAnimated(this)&&de;(Ie||ke)&&(Te=isEqual(computeGoal(Re),Ve),Fe=!Te),(!isEqual(oe.immediate,Ze)&&!Ze||!isEqual(be.decay,Ae)||!isEqual(be.velocity,ye))&&(Fe=!0)}if(Te&&isAnimating(this)&&(oe.changed&&!Be?Fe=!0:Fe||this._stop(se)),!fe&&((Fe||hasFluidValue(se))&&(oe.values=ve.getPayload(),oe.toValues=hasFluidValue(ge)?null:_e==AnimatedString?[1]:toArray(Ve)),oe.immediate!=Ze&&(oe.immediate=Ze,!Ze&&!Be&&this._set(se)),Fe)){const{onRest:ke}=oe;each(ACTIVE_EVENTS,Ke=>mergeActiveFn(this,Z,Ke));const Le=getFinishedResult(this,checkFinished(this,se));flushCalls(this._pendingCalls,Le),this._pendingCalls.add(_),oe.changed&&raf.batchedUpdates(()=>{var Ke;oe.changed=!Be,ke==null||ke(Le,this),Be?callProp(ie.onRest,Le):(Ke=oe.onStart)==null||Ke.call(oe,Le,this)})}Be&&this._set(Re),fe?_(runAsync(Z.to,Z,this._state,this)):Fe?this._start():isAnimating(this)&&!Ie?this._pendingCalls.add(_):_(getNoopResult(Re))}_focus(X){const Z=this.animation;X!==Z.to&&(getFluidObservers(this)&&this._detach(),Z.to=X,getFluidObservers(this)&&this._attach())}_attach(){let X=0;const{to:Z}=this.animation;hasFluidValue(Z)&&(addFluidObserver(Z,this),isFrameValue(Z)&&(X=Z.priority+1)),this.priority=X}_detach(){const{to:X}=this.animation;hasFluidValue(X)&&removeFluidObserver(X,this)}_set(X,Z=!0){const _=getFluidValue(X);if(!is.und(_)){const K=getAnimated(this);if(!K||!isEqual(_,K.getValue())){const te=getAnimatedType(_);!K||K.constructor!=te?setAnimated(this,te.create(_)):K.setValue(_),K&&raf.batchedUpdates(()=>{this._onChange(_,Z)})}}return getAnimated(this)}_onStart(){const X=this.animation;X.changed||(X.changed=!0,sendEvent(this,"onStart",getFinishedResult(this,checkFinished(this,X.to)),this))}_onChange(X,Z){Z||(this._onStart(),callProp(this.animation.onChange,X,this)),callProp(this.defaultProps.onChange,X,this),super._onChange(X,Z)}_start(){const X=this.animation;getAnimated(this).reset(getFluidValue(X.to)),X.immediate||(X.fromValues=X.values.map(Z=>Z.lastPosition)),isAnimating(this)||(setActiveBit(this,!0),isPaused(this)||this._resume())}_resume(){globals_exports.skipAnimation?this.finish():frameLoop.start(this)}_stop(X,Z){if(isAnimating(this)){setActiveBit(this,!1);const _=this.animation;each(_.values,te=>{te.done=!0}),_.toValues&&(_.onChange=_.onPause=_.onResume=void 0),callFluidObservers(this,{type:"idle",parent:this});const K=Z?getCancelledResult(this.get()):getFinishedResult(this.get(),checkFinished(this,X??_.to));flushCalls(this._pendingCalls,K),_.changed&&(_.changed=!1,sendEvent(this,"onRest",K,this))}}};function checkFinished(X,Z){const _=computeGoal(Z),K=computeGoal(X.get());return isEqual(K,_)}function createLoopUpdate(X,Z=X.loop,_=X.to){const K=callProp(Z);if(K){const te=K!==!0&&inferTo(K),ne=(te||X).reverse,ie=!te||te.reset;return createUpdate({...X,loop:Z,default:!1,pause:void 0,to:!ne||isAsyncTo(_)?_:void 0,from:ie?X.from:void 0,reset:ie,...te})}}function createUpdate(X){const{to:Z,from:_}=X=inferTo(X),K=new Set;return is.obj(Z)&&findDefined(Z,K),is.obj(_)&&findDefined(_,K),X.keys=K.size?Array.from(K):null,X}function declareUpdate(X){const Z=createUpdate(X);return is.und(Z.default)&&(Z.default=getDefaultProps(Z)),Z}function findDefined(X,Z){eachProp(X,(_,K)=>_!=null&&Z.add(K))}var ACTIVE_EVENTS=["onStart","onRest","onChange","onPause","onResume"];function mergeActiveFn(X,Z,_){X.animation[_]=Z[_]!==getDefaultProp(Z,_)?resolveProp(Z[_],X.key):void 0}function sendEvent(X,Z,..._){var K,te,ne,ie;(te=(K=X.animation)[Z])==null||te.call(K,..._),(ie=(ne=X.defaultProps)[Z])==null||ie.call(ne,..._)}var BATCHED_EVENTS=["onStart","onChange","onRest"],nextId2=1,Controller=class{constructor(X,Z){this.id=nextId2++,this.springs={},this.queue=[],this._lastAsyncId=0,this._active=new Set,this._changed=new Set,this._started=!1,this._state={paused:!1,pauseQueue:new Set,resumeQueue:new Set,timeouts:new Set},this._events={onStart:new Map,onChange:new Map,onRest:new Map},this._onFrame=this._onFrame.bind(this),Z&&(this._flush=Z),X&&this.start({default:!0,...X})}get idle(){return!this._state.asyncTo&&Object.values(this.springs).every(X=>X.idle&&!X.isDelayed&&!X.isPaused)}get item(){return this._item}set item(X){this._item=X}get(){const X={};return this.each((Z,_)=>X[_]=Z.get()),X}set(X){for(const Z in X){const _=X[Z];is.und(_)||this.springs[Z].set(_)}}update(X){return X&&this.queue.push(createUpdate(X)),this}start(X){let{queue:Z}=this;return X?Z=toArray(X).map(createUpdate):this.queue=[],this._flush?this._flush(this,Z):(prepareKeys(this,Z),flushUpdateQueue(this,Z))}stop(X,Z){if(X!==!!X&&(Z=X),Z){const _=this.springs;each(toArray(Z),K=>_[K].stop(!!X))}else stopAsync(this._state,this._lastAsyncId),this.each(_=>_.stop(!!X));return this}pause(X){if(is.und(X))this.start({pause:!0});else{const Z=this.springs;each(toArray(X),_=>Z[_].pause())}return this}resume(X){if(is.und(X))this.start({pause:!1});else{const Z=this.springs;each(toArray(X),_=>Z[_].resume())}return this}each(X){eachProp(this.springs,X)}_onFrame(){const{onStart:X,onChange:Z,onRest:_}=this._events,K=this._active.size>0,te=this._changed.size>0;(K&&!this._started||te&&!this._started)&&(this._started=!0,flush(X,([oe,se])=>{se.value=this.get(),oe(se,this,this._item)}));const ne=!K&&this._started,ie=te||ne&&_.size?this.get():null;te&&Z.size&&flush(Z,([oe,se])=>{se.value=ie,oe(se,this,this._item)}),ne&&(this._started=!1,flush(_,([oe,se])=>{se.value=ie,oe(se,this,this._item)}))}eventObserved(X){if(X.type=="change")this._changed.add(X.parent),X.idle||this._active.add(X.parent);else if(X.type=="idle")this._active.delete(X.parent);else return;raf.onFrame(this._onFrame)}};function flushUpdateQueue(X,Z){return Promise.all(Z.map(_=>flushUpdate(X,_))).then(_=>getCombinedResult(X,_))}async function flushUpdate(X,Z,_){const{keys:K,to:te,from:ne,loop:ie,onRest:oe,onResolve:se}=Z,ae=is.obj(Z.default)&&Z.default;ie&&(Z.loop=!1),te===!1&&(Z.to=null),ne===!1&&(Z.from=null);const ge=is.arr(te)||is.fun(te)?te:void 0;ge?(Z.to=void 0,Z.onRest=void 0,ae&&(ae.onRest=void 0)):each(BATCHED_EVENTS,be=>{const Ae=Z[be];if(is.fun(Ae)){const ye=X._events[be];Z[be]=({finished:ve,cancelled:Be})=>{const Re=ye.get(Ae);Re?(ve||(Re.finished=!1),Be&&(Re.cancelled=!0)):ye.set(Ae,{value:null,finished:ve||!1,cancelled:Be||!1})},ae&&(ae[be]=Z[be])}});const ce=X._state;Z.pause===!ce.paused?(ce.paused=Z.pause,flushCalls(Z.pause?ce.pauseQueue:ce.resumeQueue)):ce.paused&&(Z.pause=!0);const de=(K||Object.keys(X.springs)).map(be=>X.springs[be].start(Z)),Ie=Z.cancel===!0||getDefaultProp(Z,"cancel")===!0;(ge||Ie&&ce.asyncId)&&de.push(scheduleProps(++X._lastAsyncId,{props:Z,state:ce,actions:{pause:noop$1,resume:noop$1,start(be,Ae){Ie?(stopAsync(ce,X._lastAsyncId),Ae(getCancelledResult(X))):(be.onRest=oe,Ae(runAsync(ge,be,ce,X)))}}})),ce.paused&&await new Promise(be=>{ce.resumeQueue.add(be)});const fe=getCombinedResult(X,await Promise.all(de));if(ie&&fe.finished&&!(_&&fe.noop)){const be=createLoopUpdate(Z,ie,te);if(be)return prepareKeys(X,[be]),flushUpdate(X,be,!0)}return se&&raf.batchedUpdates(()=>se(fe,X,X.item)),fe}function getSprings(X,Z){const _={...X.springs};return Z&&each(toArray(Z),K=>{is.und(K.keys)&&(K=createUpdate(K)),is.obj(K.to)||(K={...K,to:void 0}),prepareSprings(_,K,te=>createSpring(te))}),setSprings(X,_),_}function setSprings(X,Z){eachProp(Z,(_,K)=>{X.springs[K]||(X.springs[K]=_,addFluidObserver(_,X))})}function createSpring(X,Z){const _=new SpringValue;return _.key=X,Z&&addFluidObserver(_,Z),_}function prepareSprings(X,Z,_){Z.keys&&each(Z.keys,K=>{(X[K]||(X[K]=_(K)))._prepareNode(Z)})}function prepareKeys(X,Z){each(Z,_=>{prepareSprings(X.springs,_,K=>createSpring(K,X))})}var SpringContext=({children:X,...Z})=>{const _=reactExports.useContext(ctx),K=Z.pause||!!_.pause,te=Z.immediate||!!_.immediate;Z=useMemoOne(()=>({pause:K,immediate:te}),[K,te]);const{Provider:ne}=ctx;return reactExports.createElement(ne,{value:Z},X)},ctx=makeContext(SpringContext,{});SpringContext.Provider=ctx.Provider;SpringContext.Consumer=ctx.Consumer;function makeContext(X,Z){return Object.assign(X,reactExports.createContext(Z)),X.Provider._context=X,X.Consumer._context=X,X}var SpringRef=()=>{const X=[],Z=function(K){deprecateDirectCall();const te=[];return each(X,(ne,ie)=>{if(is.und(K))te.push(ne.start());else{const oe=_(K,ne,ie);oe&&te.push(ne.start(oe))}}),te};Z.current=X,Z.add=function(K){X.includes(K)||X.push(K)},Z.delete=function(K){const te=X.indexOf(K);~te&&X.splice(te,1)},Z.pause=function(){return each(X,K=>K.pause(...arguments)),this},Z.resume=function(){return each(X,K=>K.resume(...arguments)),this},Z.set=function(K){each(X,(te,ne)=>{const ie=is.fun(K)?K(ne,te):K;ie&&te.set(ie)})},Z.start=function(K){const te=[];return each(X,(ne,ie)=>{if(is.und(K))te.push(ne.start());else{const oe=this._getProps(K,ne,ie);oe&&te.push(ne.start(oe))}}),te},Z.stop=function(){return each(X,K=>K.stop(...arguments)),this},Z.update=function(K){return each(X,(te,ne)=>te.update(this._getProps(K,te,ne))),this};const _=function(K,te,ne){return is.fun(K)?K(ne,te):K};return Z._getProps=_,Z};function useSprings(X,Z,_){const K=is.fun(Z)&&Z;K&&!_&&(_=[]);const te=reactExports.useMemo(()=>K||arguments.length==3?SpringRef():void 0,[]),ne=reactExports.useRef(0),ie=useForceUpdate(),oe=reactExports.useMemo(()=>({ctrls:[],queue:[],flush(ye,ve){const Be=getSprings(ye,ve);return ne.current>0&&!oe.queue.length&&!Object.keys(Be).some(Ve=>!ye.springs[Ve])?flushUpdateQueue(ye,ve):new Promise(Ve=>{setSprings(ye,Be),oe.queue.push(()=>{Ve(flushUpdateQueue(ye,ve))}),ie()})}}),[]),se=reactExports.useRef([...oe.ctrls]),ae=[],ge=usePrev(X)||0;reactExports.useMemo(()=>{each(se.current.slice(X,ge),ye=>{detachRefs(ye,te),ye.stop(!0)}),se.current.length=X,ce(ge,X)},[X]),reactExports.useMemo(()=>{ce(0,Math.min(ge,X))},_);function ce(ye,ve){for(let Be=ye;Be<ve;Be++){const Re=se.current[Be]||(se.current[Be]=new Controller(null,oe.flush)),Ve=K?K(Be,Re):Z[Be];Ve&&(ae[Be]=declareUpdate(Ve))}}const de=se.current.map((ye,ve)=>getSprings(ye,ae[ve])),Ie=reactExports.useContext(SpringContext),fe=usePrev(Ie),be=Ie!==fe&&hasProps(Ie);useIsomorphicLayoutEffect$1(()=>{ne.current++,oe.ctrls=se.current;const{queue:ye}=oe;ye.length&&(oe.queue=[],each(ye,ve=>ve())),each(se.current,(ve,Be)=>{te==null||te.add(ve),be&&ve.start({default:Ie});const Re=ae[Be];Re&&(replaceRef(ve,Re.ref),ve.ref?ve.queue.push(Re):ve.start(Re))})}),useOnce(()=>()=>{each(oe.ctrls,ye=>ye.stop(!0))});const Ae=de.map(ye=>({...ye}));return te?[Ae,te]:Ae}function useSpring(X,Z){const _=is.fun(X),[[K],te]=useSprings(1,_?X:[X],_?[]:Z);return _||arguments.length==2?[K,te]:K}var Interpolation=class extends FrameValue{constructor(X,Z){super(),this.source=X,this.idle=!0,this._active=new Set,this.calc=createInterpolator(...Z);const _=this._get(),K=getAnimatedType(_);setAnimated(this,K.create(_))}advance(X){const Z=this._get(),_=this.get();isEqual(Z,_)||(getAnimated(this).setValue(Z),this._onChange(Z,this.idle)),!this.idle&&checkIdle(this._active)&&becomeIdle(this)}_get(){const X=is.arr(this.source)?this.source.map(getFluidValue):toArray(getFluidValue(this.source));return this.calc(...X)}_start(){this.idle&&!checkIdle(this._active)&&(this.idle=!1,each(getPayload(this),X=>{X.done=!1}),globals_exports.skipAnimation?(raf.batchedUpdates(()=>this.advance()),becomeIdle(this)):frameLoop.start(this))}_attach(){let X=1;each(toArray(this.source),Z=>{hasFluidValue(Z)&&addFluidObserver(Z,this),isFrameValue(Z)&&(Z.idle||this._active.add(Z),X=Math.max(X,Z.priority+1))}),this.priority=X,this._start()}_detach(){each(toArray(this.source),X=>{hasFluidValue(X)&&removeFluidObserver(X,this)}),this._active.clear(),becomeIdle(this)}eventObserved(X){X.type=="change"?X.idle?this.advance():(this._active.add(X.parent),this._start()):X.type=="idle"?this._active.delete(X.parent):X.type=="priority"&&(this.priority=toArray(this.source).reduce((Z,_)=>Math.max(Z,(isFrameValue(_)?_.priority:0)+1),0))}};function isIdle(X){return X.idle!==!1}function checkIdle(X){return!X.size||Array.from(X).every(isIdle)}function becomeIdle(X){X.idle||(X.idle=!0,each(getPayload(X),Z=>{Z.done=!0}),callFluidObservers(X,{type:"idle",parent:X}))}globals_exports.assign({createStringInterpolator:createStringInterpolator2,to:(X,Z)=>new Interpolation(X,Z)});var primitives=["primitive"].concat(Object.keys(THREE).filter(X=>/^[A-Z]/.test(X)).map(X=>X[0].toLowerCase()+X.slice(1)));globals_exports.assign({createStringInterpolator:createStringInterpolator2,colors:colors2,frameLoop:"demand"});addEffect(()=>{raf.advance()});var host=createHost(primitives,{applyAnimatedValues:applyProps}),animated=host.animated;function PresentationControls({enabled:X=!0,snap:Z,global:_,domElement:K,cursor:te=!0,children:ne,speed:ie=1,rotation:oe=[0,0,0],zoom:se=1,polar:ae=[0,Math.PI/2],azimuth:ge=[-1/0,1/0],config:ce={mass:1,tension:170,friction:26}}){const de=useThree(Ee=>Ee.events),Ie=useThree(Ee=>Ee.gl),fe=K||de.connected||Ie.domElement,{size:be}=useThree(),Ae=reactExports.useMemo(()=>[oe[0]+ae[0],oe[0]+ae[1]],[oe[0],ae[0],ae[1]]),ye=reactExports.useMemo(()=>[oe[1]+ge[0],oe[1]+ge[1]],[oe[1],ge[0],ge[1]]),ve=reactExports.useMemo(()=>[MathUtils.clamp(oe[0],...Ae),MathUtils.clamp(oe[1],...ye),oe[2]],[oe[0],oe[1],oe[2],Ae,ye]),[Be,Re]=useSpring(()=>({scale:1,rotation:ve,config:ce}));reactExports.useEffect(()=>void Re.start({scale:1,rotation:ve,config:ce}),[ve]),reactExports.useEffect(()=>{if(_&&te&&X)return fe.style.cursor="grab",Ie.domElement.style.cursor="",()=>{fe.style.cursor="default",Ie.domElement.style.cursor="default"}},[_,te,fe,X]);const Ve=useGesture({onHover:({last:Ee})=>{te&&!_&&X&&(fe.style.cursor=Ee?"auto":"grab")},onDrag:({down:Ee,delta:[Ze,_e],memo:[Fe,Te]=Be.rotation.animation.to||ve})=>{if(!X)return[_e,Ze];te&&(fe.style.cursor=Ee?"grabbing":"grab"),Ze=MathUtils.clamp(Te+Ze/be.width*Math.PI*ie,...ye),_e=MathUtils.clamp(Fe+_e/be.height*Math.PI*ie,...Ae);const ke=Z&&!Ee&&typeof Z!="boolean"?Z:ce;return Re.start({scale:Ee&&_e>Ae[1]/2?se:1,rotation:Z&&!Ee?ve:[_e,Ze,0],config:Le=>Le==="scale"?{...ke,friction:ke.friction*3}:ke}),[_e,Ze]}},{target:_?fe:void 0});return reactExports.createElement(animated.group,_extends$2({},Ve==null?void 0:Ve(),Be),ne)}const version=parseInt(REVISION.replace(/\D+/g,""));function toTrianglesDrawMode(X,Z){if(Z===TrianglesDrawMode)return console.warn("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles."),X;if(Z===TriangleFanDrawMode||Z===TriangleStripDrawMode){let _=X.getIndex();if(_===null){const ie=[],oe=X.getAttribute("position");if(oe!==void 0){for(let se=0;se<oe.count;se++)ie.push(se);X.setIndex(ie),_=X.getIndex()}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),X}const K=_.count-2,te=[];if(_)if(Z===TriangleFanDrawMode)for(let ie=1;ie<=K;ie++)te.push(_.getX(0)),te.push(_.getX(ie)),te.push(_.getX(ie+1));else for(let ie=0;ie<K;ie++)ie%2===0?(te.push(_.getX(ie)),te.push(_.getX(ie+1)),te.push(_.getX(ie+2))):(te.push(_.getX(ie+2)),te.push(_.getX(ie+1)),te.push(_.getX(ie)));te.length/3!==K&&console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const ne=X.clone();return ne.setIndex(te),ne.clearGroups(),ne}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:",Z),X}var u8=Uint8Array,u16=Uint16Array,u32=Uint32Array,fleb=new u8([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),fdeb=new u8([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),clim=new u8([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),freb=function(X,Z){for(var _=new u16(31),K=0;K<31;++K)_[K]=Z+=1<<X[K-1];for(var te=new u32(_[30]),K=1;K<30;++K)for(var ne=_[K];ne<_[K+1];++ne)te[ne]=ne-_[K]<<5|K;return[_,te]},_a=freb(fleb,2),fl=_a[0],revfl=_a[1];fl[28]=258,revfl[258]=28;var _b=freb(fdeb,0),fd=_b[0],rev=new u16(32768);for(var i$5=0;i$5<32768;++i$5){var x$4=(i$5&43690)>>>1|(i$5&21845)<<1;x$4=(x$4&52428)>>>2|(x$4&13107)<<2,x$4=(x$4&61680)>>>4|(x$4&3855)<<4,rev[i$5]=((x$4&65280)>>>8|(x$4&255)<<8)>>>1}var hMap=function(X,Z,_){for(var K=X.length,te=0,ne=new u16(Z);te<K;++te)++ne[X[te]-1];var ie=new u16(Z);for(te=0;te<Z;++te)ie[te]=ie[te-1]+ne[te-1]<<1;var oe;if(_){oe=new u16(1<<Z);var se=15-Z;for(te=0;te<K;++te)if(X[te])for(var ae=te<<4|X[te],ge=Z-X[te],ce=ie[X[te]-1]++<<ge,de=ce|(1<<ge)-1;ce<=de;++ce)oe[rev[ce]>>>se]=ae}else for(oe=new u16(K),te=0;te<K;++te)X[te]&&(oe[te]=rev[ie[X[te]-1]++]>>>15-X[te]);return oe},flt=new u8(288);for(var i$5=0;i$5<144;++i$5)flt[i$5]=8;for(var i$5=144;i$5<256;++i$5)flt[i$5]=9;for(var i$5=256;i$5<280;++i$5)flt[i$5]=7;for(var i$5=280;i$5<288;++i$5)flt[i$5]=8;var fdt=new u8(32);for(var i$5=0;i$5<32;++i$5)fdt[i$5]=5;var flrm=hMap(flt,9,1),fdrm=hMap(fdt,5,1),max=function(X){for(var Z=X[0],_=1;_<X.length;++_)X[_]>Z&&(Z=X[_]);return Z},bits=function(X,Z,_){var K=Z/8|0;return(X[K]|X[K+1]<<8)>>(Z&7)&_},bits16=function(X,Z){var _=Z/8|0;return(X[_]|X[_+1]<<8|X[_+2]<<16)>>(Z&7)},shft=function(X){return(X/8|0)+(X&7&&1)},slc=function(X,Z,_){(_==null||_>X.length)&&(_=X.length);var K=new(X instanceof u16?u16:X instanceof u32?u32:u8)(_-Z);return K.set(X.subarray(Z,_)),K},inflt=function(X,Z,_){var K=X.length;if(!K||_&&!_.l&&K<5)return Z||new u8(0);var te=!Z||_,ne=!_||_.i;_||(_={}),Z||(Z=new u8(K*3));var ie=function(ht){var dt=Z.length;if(ht>dt){var bt=new u8(Math.max(dt*2,ht));bt.set(Z),Z=bt}},oe=_.f||0,se=_.p||0,ae=_.b||0,ge=_.l,ce=_.d,de=_.m,Ie=_.n,fe=K*8;do{if(!ge){_.f=oe=bits(X,se,1);var be=bits(X,se+1,3);if(se+=3,be)if(be==1)ge=flrm,ce=fdrm,de=9,Ie=5;else if(be==2){var Be=bits(X,se,31)+257,Re=bits(X,se+10,15)+4,Ve=Be+bits(X,se+5,31)+1;se+=14;for(var Ee=new u8(Ve),Ze=new u8(19),_e=0;_e<Re;++_e)Ze[clim[_e]]=bits(X,se+_e*3,7);se+=Re*3;for(var Fe=max(Ze),Te=(1<<Fe)-1,ke=hMap(Ze,Fe,1),_e=0;_e<Ve;){var Le=ke[bits(X,se,Te)];se+=Le&15;var Ae=Le>>>4;if(Ae<16)Ee[_e++]=Ae;else{var Ke=0,Ue=0;for(Ae==16?(Ue=3+bits(X,se,3),se+=2,Ke=Ee[_e-1]):Ae==17?(Ue=3+bits(X,se,7),se+=3):Ae==18&&(Ue=11+bits(X,se,127),se+=7);Ue--;)Ee[_e++]=Ke}}var rt=Ee.subarray(0,Be),tt=Ee.subarray(Be);de=max(rt),Ie=max(tt),ge=hMap(rt,de,1),ce=hMap(tt,Ie,1)}else throw"invalid block type";else{var Ae=shft(se)+4,ye=X[Ae-4]|X[Ae-3]<<8,ve=Ae+ye;if(ve>K){if(ne)throw"unexpected EOF";break}te&&ie(ae+ye),Z.set(X.subarray(Ae,ve),ae),_.b=ae+=ye,_.p=se=ve*8;continue}if(se>fe){if(ne)throw"unexpected EOF";break}}te&&ie(ae+131072);for(var at=(1<<de)-1,ze=(1<<Ie)-1,qe=se;;qe=se){var Ke=ge[bits16(X,se)&at],Pe=Ke>>>4;if(se+=Ke&15,se>fe){if(ne)throw"unexpected EOF";break}if(!Ke)throw"invalid length/literal";if(Pe<256)Z[ae++]=Pe;else if(Pe==256){qe=se,ge=null;break}else{var Ye=Pe-254;if(Pe>264){var _e=Pe-257,$e=fleb[_e];Ye=bits(X,se,(1<<$e)-1)+fl[_e],se+=$e}var ut=ce[bits16(X,se)&ze],ot=ut>>>4;if(!ut)throw"invalid distance";se+=ut&15;var tt=fd[ot];if(ot>3){var $e=fdeb[ot];tt+=bits16(X,se)&(1<<$e)-1,se+=$e}if(se>fe){if(ne)throw"unexpected EOF";break}te&&ie(ae+131072);for(var gt=ae+Ye;ae<gt;ae+=4)Z[ae]=Z[ae-tt],Z[ae+1]=Z[ae+1-tt],Z[ae+2]=Z[ae+2-tt],Z[ae+3]=Z[ae+3-tt];ae=gt}}_.l=ge,_.p=qe,_.b=ae,ge&&(oe=1,_.m=de,_.d=ce,_.n=Ie)}while(!oe);return ae==Z.length?Z:slc(Z,0,ae)},et=new u8(0),zlv=function(X){if((X[0]&15)!=8||X[0]>>>4>7||(X[0]<<8|X[1])%31)throw"invalid zlib data";if(X[1]&32)throw"invalid zlib data: preset dictionaries not supported"};function unzlibSync(X,Z){return inflt((zlv(X),X.subarray(2,-4)),Z)}var td=typeof TextDecoder<"u"&&new TextDecoder,tds=0;try{td.decode(et,{stream:!0}),tds=1}catch{}const isCubeTexture=X=>X&&X.isCubeTexture;class GroundProjectedEnv extends Mesh{constructor(Z,_){var K,te;const ne=isCubeTexture(Z),oe=((te=ne?(K=Z.image[0])==null?void 0:K.width:Z.image.width)!=null?te:1024)/4,se=Math.floor(Math.log2(oe)),ae=Math.pow(2,se),ge=3*Math.max(ae,16*7),ce=4*ae,de=[ne?"#define ENVMAP_TYPE_CUBE":"",`#define CUBEUV_TEXEL_WIDTH ${1/ge}`,`#define CUBEUV_TEXEL_HEIGHT ${1/ce}`,`#define CUBEUV_MAX_MIP ${se}.0`],Ie=`
        varying vec3 vWorldPosition;
        void main() 
        {
            vec4 worldPosition = ( modelMatrix * vec4( position, 1.0 ) );
            vWorldPosition = worldPosition.xyz;
            
            gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
        }
        `,fe=de.join(`
`)+`
        #define ENVMAP_TYPE_CUBE_UV
        varying vec3 vWorldPosition;
        uniform float radius;
        uniform float height;
        uniform float angle;
        #ifdef ENVMAP_TYPE_CUBE
            uniform samplerCube map;
        #else
            uniform sampler2D map;
        #endif
        // From: https://www.shadertoy.com/view/4tsBD7
        float diskIntersectWithBackFaceCulling( vec3 ro, vec3 rd, vec3 c, vec3 n, float r ) 
        {
            float d = dot ( rd, n );
            
            if( d > 0.0 ) { return 1e6; }
            
            vec3  o = ro - c;
            float t = - dot( n, o ) / d;
            vec3  q = o + rd * t;
            
            return ( dot( q, q ) < r * r ) ? t : 1e6;
        }
        // From: https://www.iquilezles.org/www/articles/intersectors/intersectors.htm
        float sphereIntersect( vec3 ro, vec3 rd, vec3 ce, float ra ) 
        {
            vec3 oc = ro - ce;
            float b = dot( oc, rd );
            float c = dot( oc, oc ) - ra * ra;
            float h = b * b - c;
            
            if( h < 0.0 ) { return -1.0; }
            
            h = sqrt( h );
            
            return - b + h;
        }
        vec3 project() 
        {
            vec3 p = normalize( vWorldPosition );
            vec3 camPos = cameraPosition;
            camPos.y -= height;
            float intersection = sphereIntersect( camPos, p, vec3( 0.0 ), radius );
            if( intersection > 0.0 ) {
                
                vec3 h = vec3( 0.0, - height, 0.0 );
                float intersection2 = diskIntersectWithBackFaceCulling( camPos, p, h, vec3( 0.0, 1.0, 0.0 ), radius );
                p = ( camPos + min( intersection, intersection2 ) * p ) / radius;
            } else {
                p = vec3( 0.0, 1.0, 0.0 );
            }
            return p;
        }
        #include <common>
        #include <cube_uv_reflection_fragment>
        void main() 
        {
            vec3 projectedWorldPosition = project();
            
            #ifdef ENVMAP_TYPE_CUBE
                vec3 outcolor = textureCube( map, projectedWorldPosition ).rgb;
            #else
                vec3 direction = normalize( projectedWorldPosition );
                vec2 uv = equirectUv( direction );
                vec3 outcolor = texture2D( map, uv ).rgb;
            #endif
            gl_FragColor = vec4( outcolor, 1.0 );
            #include <tonemapping_fragment>
            #include <${version>=154?"colorspace_fragment":"encodings_fragment"}>
        }
        `,be={map:{value:Z},height:{value:(_==null?void 0:_.height)||15},radius:{value:(_==null?void 0:_.radius)||100}},Ae=new IcosahedronGeometry(1,16),ye=new ShaderMaterial({uniforms:be,fragmentShader:fe,vertexShader:Ie,side:DoubleSide});super(Ae,ye)}set radius(Z){this.material.uniforms.radius.value=Z}get radius(){return this.material.uniforms.radius.value}set height(Z){this.material.uniforms.height.value=Z}get height(){return this.material.uniforms.height.value}}function retarget(X,Z,_={}){const K=new Vector3,te=new Quaternion$2,ne=new Vector3,ie=new Matrix4,oe=new Matrix4,se=new Matrix4;_.preserveMatrix=_.preserveMatrix!==void 0?_.preserveMatrix:!0,_.preservePosition=_.preservePosition!==void 0?_.preservePosition:!0,_.preserveHipPosition=_.preserveHipPosition!==void 0?_.preserveHipPosition:!1,_.useTargetMatrix=_.useTargetMatrix!==void 0?_.useTargetMatrix:!1,_.hip=_.hip!==void 0?_.hip:"hip",_.names=_.names||{};const ae=Z.isObject3D?Z.skeleton.bones:getBones(Z),ge=X.isObject3D?X.skeleton.bones:getBones(X);let ce,de,Ie,fe,be;if(X.isObject3D?X.skeleton.pose():(_.useTargetMatrix=!0,_.preserveMatrix=!1),_.preservePosition){be=[];for(let Ae=0;Ae<ge.length;Ae++)be.push(ge[Ae].position.clone())}if(_.preserveMatrix){X.updateMatrixWorld(),X.matrixWorld.identity();for(let Ae=0;Ae<X.children.length;++Ae)X.children[Ae].updateMatrixWorld(!0)}if(_.offsets){ce=[];for(let Ae=0;Ae<ge.length;++Ae)de=ge[Ae],Ie=_.names[de.name]||de.name,_.offsets[Ie]&&(de.matrix.multiply(_.offsets[Ie]),de.matrix.decompose(de.position,de.quaternion,de.scale),de.updateMatrixWorld()),ce.push(de.matrixWorld.clone())}for(let Ae=0;Ae<ge.length;++Ae){if(de=ge[Ae],Ie=_.names[de.name]||de.name,fe=getBoneByName(Ie,ae),se.copy(de.matrixWorld),fe){if(fe.updateMatrixWorld(),_.useTargetMatrix?oe.copy(fe.matrixWorld):(oe.copy(X.matrixWorld).invert(),oe.multiply(fe.matrixWorld)),ne.setFromMatrixScale(oe),oe.scale(ne.set(1/ne.x,1/ne.y,1/ne.z)),se.makeRotationFromQuaternion(te.setFromRotationMatrix(oe)),X.isObject3D){const ye=ge.indexOf(de),ve=ce?ce[ye]:ie.copy(X.skeleton.boneInverses[ye]).invert();se.multiply(ve)}se.copyPosition(oe)}de.parent&&de.parent.isBone?(de.matrix.copy(de.parent.matrixWorld).invert(),de.matrix.multiply(se)):de.matrix.copy(se),_.preserveHipPosition&&Ie===_.hip&&de.matrix.setPosition(K.set(0,de.position.y,0)),de.matrix.decompose(de.position,de.quaternion,de.scale),de.updateMatrixWorld()}if(_.preservePosition)for(let Ae=0;Ae<ge.length;++Ae)de=ge[Ae],Ie=_.names[de.name]||de.name,Ie!==_.hip&&de.position.copy(be[Ae]);_.preserveMatrix&&X.updateMatrixWorld(!0)}function retargetClip(X,Z,_,K={}){K.useFirstFramePosition=K.useFirstFramePosition!==void 0?K.useFirstFramePosition:!1,K.fps=K.fps!==void 0?K.fps:30,K.names=K.names||[],Z.isObject3D||(Z=getHelperFromSkeleton(Z));const te=Math.round(_.duration*(K.fps/1e3)*1e3),ne=1/K.fps,ie=[],oe=new AnimationMixer(Z),se=getBones(X.skeleton),ae=[];let ge,ce,de,Ie,fe;oe.clipAction(_).play(),oe.update(0),Z.updateMatrixWorld();for(let be=0;be<te;++be){const Ae=be*ne;retarget(X,Z,K);for(let ye=0;ye<se.length;++ye)fe=K.names[se[ye].name]||se[ye].name,de=getBoneByName(fe,Z.skeleton),de&&(ce=se[ye],Ie=ae[ye]=ae[ye]||{bone:ce},K.hip===fe&&(Ie.pos||(Ie.pos={times:new Float32Array(te),values:new Float32Array(te*3)}),K.useFirstFramePosition&&(be===0&&(ge=ce.position.clone()),ce.position.sub(ge)),Ie.pos.times[be]=Ae,ce.position.toArray(Ie.pos.values,be*3)),Ie.quat||(Ie.quat={times:new Float32Array(te),values:new Float32Array(te*4)}),Ie.quat.times[be]=Ae,ce.quaternion.toArray(Ie.quat.values,be*4));oe.update(ne),Z.updateMatrixWorld()}for(let be=0;be<ae.length;++be)Ie=ae[be],Ie&&(Ie.pos&&ie.push(new VectorKeyframeTrack(".bones["+Ie.bone.name+"].position",Ie.pos.times,Ie.pos.values)),ie.push(new QuaternionKeyframeTrack(".bones["+Ie.bone.name+"].quaternion",Ie.quat.times,Ie.quat.values)));return oe.uncacheAction(_),new AnimationClip(_.name,-1,ie)}function clone(X){const Z=new Map,_=new Map,K=X.clone();return parallelTraverse(X,K,function(te,ne){Z.set(ne,te),_.set(te,ne)}),K.traverse(function(te){if(!te.isSkinnedMesh)return;const ne=te,ie=Z.get(te),oe=ie.skeleton.bones;ne.skeleton=ie.skeleton.clone(),ne.bindMatrix.copy(ie.bindMatrix),ne.skeleton.bones=oe.map(function(se){return _.get(se)}),ne.bind(ne.skeleton,ne.bindMatrix)}),K}function getBoneByName(X,Z){for(let _=0,K=getBones(Z);_<K.length;_++)if(X===K[_].name)return K[_]}function getBones(X){return Array.isArray(X)?X:X.bones}function getHelperFromSkeleton(X){const Z=new SkeletonHelper(X.bones[0]);return Z.skeleton=X,Z}function parallelTraverse(X,Z,_){_(X,Z);for(let K=0;K<X.children.length;K++)parallelTraverse(X.children[K],Z.children[K],_)}const SkeletonUtils={retarget,retargetClip,clone};function decodeText(X){if(typeof TextDecoder<"u")return new TextDecoder().decode(X);let Z="";for(let _=0,K=X.length;_<K;_++)Z+=String.fromCharCode(X[_]);try{return decodeURIComponent(escape(Z))}catch{return Z}}const SRGBColorSpace="srgb",LinearSRGBColorSpace="srgb-linear",sRGBEncoding$1=3001,LinearEncoding$1=3e3;class GLTFLoader extends Loader{constructor(Z){super(Z),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(_){return new GLTFMaterialsClearcoatExtension(_)}),this.register(function(_){return new GLTFMaterialsDispersionExtension(_)}),this.register(function(_){return new GLTFTextureBasisUExtension(_)}),this.register(function(_){return new GLTFTextureWebPExtension(_)}),this.register(function(_){return new GLTFTextureAVIFExtension(_)}),this.register(function(_){return new GLTFMaterialsSheenExtension(_)}),this.register(function(_){return new GLTFMaterialsTransmissionExtension(_)}),this.register(function(_){return new GLTFMaterialsVolumeExtension(_)}),this.register(function(_){return new GLTFMaterialsIorExtension(_)}),this.register(function(_){return new GLTFMaterialsEmissiveStrengthExtension(_)}),this.register(function(_){return new GLTFMaterialsSpecularExtension(_)}),this.register(function(_){return new GLTFMaterialsIridescenceExtension(_)}),this.register(function(_){return new GLTFMaterialsAnisotropyExtension(_)}),this.register(function(_){return new GLTFMaterialsBumpExtension(_)}),this.register(function(_){return new GLTFLightsExtension(_)}),this.register(function(_){return new GLTFMeshoptCompression(_)}),this.register(function(_){return new GLTFMeshGpuInstancing(_)})}load(Z,_,K,te){const ne=this;let ie;if(this.resourcePath!=="")ie=this.resourcePath;else if(this.path!==""){const ae=LoaderUtils.extractUrlBase(Z);ie=LoaderUtils.resolveURL(ae,this.path)}else ie=LoaderUtils.extractUrlBase(Z);this.manager.itemStart(Z);const oe=function(ae){te?te(ae):console.error(ae),ne.manager.itemError(Z),ne.manager.itemEnd(Z)},se=new FileLoader(this.manager);se.setPath(this.path),se.setResponseType("arraybuffer"),se.setRequestHeader(this.requestHeader),se.setWithCredentials(this.withCredentials),se.load(Z,function(ae){try{ne.parse(ae,ie,function(ge){_(ge),ne.manager.itemEnd(Z)},oe)}catch(ge){oe(ge)}},K,oe)}setDRACOLoader(Z){return this.dracoLoader=Z,this}setDDSLoader(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(Z){return this.ktx2Loader=Z,this}setMeshoptDecoder(Z){return this.meshoptDecoder=Z,this}register(Z){return this.pluginCallbacks.indexOf(Z)===-1&&this.pluginCallbacks.push(Z),this}unregister(Z){return this.pluginCallbacks.indexOf(Z)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(Z),1),this}parse(Z,_,K,te){let ne;const ie={},oe={};if(typeof Z=="string")ne=JSON.parse(Z);else if(Z instanceof ArrayBuffer)if(decodeText(new Uint8Array(Z.slice(0,4)))===BINARY_EXTENSION_HEADER_MAGIC){try{ie[EXTENSIONS.KHR_BINARY_GLTF]=new GLTFBinaryExtension(Z)}catch(ge){te&&te(ge);return}ne=JSON.parse(ie[EXTENSIONS.KHR_BINARY_GLTF].content)}else ne=JSON.parse(decodeText(new Uint8Array(Z)));else ne=Z;if(ne.asset===void 0||ne.asset.version[0]<2){te&&te(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));return}const se=new GLTFParser(ne,{path:_||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});se.fileLoader.setRequestHeader(this.requestHeader);for(let ae=0;ae<this.pluginCallbacks.length;ae++){const ge=this.pluginCallbacks[ae](se);ge.name||console.error("THREE.GLTFLoader: Invalid plugin found: missing name"),oe[ge.name]=ge,ie[ge.name]=!0}if(ne.extensionsUsed)for(let ae=0;ae<ne.extensionsUsed.length;++ae){const ge=ne.extensionsUsed[ae],ce=ne.extensionsRequired||[];switch(ge){case EXTENSIONS.KHR_MATERIALS_UNLIT:ie[ge]=new GLTFMaterialsUnlitExtension;break;case EXTENSIONS.KHR_DRACO_MESH_COMPRESSION:ie[ge]=new GLTFDracoMeshCompressionExtension(ne,this.dracoLoader);break;case EXTENSIONS.KHR_TEXTURE_TRANSFORM:ie[ge]=new GLTFTextureTransformExtension;break;case EXTENSIONS.KHR_MESH_QUANTIZATION:ie[ge]=new GLTFMeshQuantizationExtension;break;default:ce.indexOf(ge)>=0&&oe[ge]===void 0&&console.warn('THREE.GLTFLoader: Unknown extension "'+ge+'".')}}se.setExtensions(ie),se.setPlugins(oe),se.parse(K,te)}parseAsync(Z,_){const K=this;return new Promise(function(te,ne){K.parse(Z,_,te,ne)})}}function GLTFRegistry(){let X={};return{get:function(Z){return X[Z]},add:function(Z,_){X[Z]=_},remove:function(Z){delete X[Z]},removeAll:function(){X={}}}}const EXTENSIONS={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_DISPERSION:"KHR_materials_dispersion",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_ANISOTROPY:"KHR_materials_anisotropy",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_MATERIALS_BUMP:"EXT_materials_bump",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_TEXTURE_AVIF:"EXT_texture_avif",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",EXT_MESH_GPU_INSTANCING:"EXT_mesh_gpu_instancing"};class GLTFLightsExtension{constructor(Z){this.parser=Z,this.name=EXTENSIONS.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const Z=this.parser,_=this.parser.json.nodes||[];for(let K=0,te=_.length;K<te;K++){const ne=_[K];ne.extensions&&ne.extensions[this.name]&&ne.extensions[this.name].light!==void 0&&Z._addNodeRef(this.cache,ne.extensions[this.name].light)}}_loadLight(Z){const _=this.parser,K="light:"+Z;let te=_.cache.get(K);if(te)return te;const ne=_.json,se=((ne.extensions&&ne.extensions[this.name]||{}).lights||[])[Z];let ae;const ge=new Color$1(16777215);se.color!==void 0&&ge.setRGB(se.color[0],se.color[1],se.color[2],LinearSRGBColorSpace);const ce=se.range!==void 0?se.range:0;switch(se.type){case"directional":ae=new DirectionalLight(ge),ae.target.position.set(0,0,-1),ae.add(ae.target);break;case"point":ae=new PointLight(ge),ae.distance=ce;break;case"spot":ae=new SpotLight(ge),ae.distance=ce,se.spot=se.spot||{},se.spot.innerConeAngle=se.spot.innerConeAngle!==void 0?se.spot.innerConeAngle:0,se.spot.outerConeAngle=se.spot.outerConeAngle!==void 0?se.spot.outerConeAngle:Math.PI/4,ae.angle=se.spot.outerConeAngle,ae.penumbra=1-se.spot.innerConeAngle/se.spot.outerConeAngle,ae.target.position.set(0,0,-1),ae.add(ae.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+se.type)}return ae.position.set(0,0,0),ae.decay=2,assignExtrasToUserData(ae,se),se.intensity!==void 0&&(ae.intensity=se.intensity),ae.name=_.createUniqueName(se.name||"light_"+Z),te=Promise.resolve(ae),_.cache.add(K,te),te}getDependency(Z,_){if(Z==="light")return this._loadLight(_)}createNodeAttachment(Z){const _=this,K=this.parser,ne=K.json.nodes[Z],oe=(ne.extensions&&ne.extensions[this.name]||{}).light;return oe===void 0?null:this._loadLight(oe).then(function(se){return K._getNodeRef(_.cache,oe,se)})}}class GLTFMaterialsUnlitExtension{constructor(){this.name=EXTENSIONS.KHR_MATERIALS_UNLIT}getMaterialType(){return MeshBasicMaterial}extendParams(Z,_,K){const te=[];Z.color=new Color$1(1,1,1),Z.opacity=1;const ne=_.pbrMetallicRoughness;if(ne){if(Array.isArray(ne.baseColorFactor)){const ie=ne.baseColorFactor;Z.color.setRGB(ie[0],ie[1],ie[2],LinearSRGBColorSpace),Z.opacity=ie[3]}ne.baseColorTexture!==void 0&&te.push(K.assignTexture(Z,"map",ne.baseColorTexture,SRGBColorSpace))}return Promise.all(te)}}class GLTFMaterialsEmissiveStrengthExtension{constructor(Z){this.parser=Z,this.name=EXTENSIONS.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(Z,_){const te=this.parser.json.materials[Z];if(!te.extensions||!te.extensions[this.name])return Promise.resolve();const ne=te.extensions[this.name].emissiveStrength;return ne!==void 0&&(_.emissiveIntensity=ne),Promise.resolve()}}class GLTFMaterialsClearcoatExtension{constructor(Z){this.parser=Z,this.name=EXTENSIONS.KHR_MATERIALS_CLEARCOAT}getMaterialType(Z){const K=this.parser.json.materials[Z];return!K.extensions||!K.extensions[this.name]?null:MeshPhysicalMaterial}extendMaterialParams(Z,_){const K=this.parser,te=K.json.materials[Z];if(!te.extensions||!te.extensions[this.name])return Promise.resolve();const ne=[],ie=te.extensions[this.name];if(ie.clearcoatFactor!==void 0&&(_.clearcoat=ie.clearcoatFactor),ie.clearcoatTexture!==void 0&&ne.push(K.assignTexture(_,"clearcoatMap",ie.clearcoatTexture)),ie.clearcoatRoughnessFactor!==void 0&&(_.clearcoatRoughness=ie.clearcoatRoughnessFactor),ie.clearcoatRoughnessTexture!==void 0&&ne.push(K.assignTexture(_,"clearcoatRoughnessMap",ie.clearcoatRoughnessTexture)),ie.clearcoatNormalTexture!==void 0&&(ne.push(K.assignTexture(_,"clearcoatNormalMap",ie.clearcoatNormalTexture)),ie.clearcoatNormalTexture.scale!==void 0)){const oe=ie.clearcoatNormalTexture.scale;_.clearcoatNormalScale=new Vector2(oe,oe)}return Promise.all(ne)}}class GLTFMaterialsDispersionExtension{constructor(Z){this.parser=Z,this.name=EXTENSIONS.KHR_MATERIALS_DISPERSION}getMaterialType(Z){const K=this.parser.json.materials[Z];return!K.extensions||!K.extensions[this.name]?null:MeshPhysicalMaterial}extendMaterialParams(Z,_){const te=this.parser.json.materials[Z];if(!te.extensions||!te.extensions[this.name])return Promise.resolve();const ne=te.extensions[this.name];return _.dispersion=ne.dispersion!==void 0?ne.dispersion:0,Promise.resolve()}}class GLTFMaterialsIridescenceExtension{constructor(Z){this.parser=Z,this.name=EXTENSIONS.KHR_MATERIALS_IRIDESCENCE}getMaterialType(Z){const K=this.parser.json.materials[Z];return!K.extensions||!K.extensions[this.name]?null:MeshPhysicalMaterial}extendMaterialParams(Z,_){const K=this.parser,te=K.json.materials[Z];if(!te.extensions||!te.extensions[this.name])return Promise.resolve();const ne=[],ie=te.extensions[this.name];return ie.iridescenceFactor!==void 0&&(_.iridescence=ie.iridescenceFactor),ie.iridescenceTexture!==void 0&&ne.push(K.assignTexture(_,"iridescenceMap",ie.iridescenceTexture)),ie.iridescenceIor!==void 0&&(_.iridescenceIOR=ie.iridescenceIor),_.iridescenceThicknessRange===void 0&&(_.iridescenceThicknessRange=[100,400]),ie.iridescenceThicknessMinimum!==void 0&&(_.iridescenceThicknessRange[0]=ie.iridescenceThicknessMinimum),ie.iridescenceThicknessMaximum!==void 0&&(_.iridescenceThicknessRange[1]=ie.iridescenceThicknessMaximum),ie.iridescenceThicknessTexture!==void 0&&ne.push(K.assignTexture(_,"iridescenceThicknessMap",ie.iridescenceThicknessTexture)),Promise.all(ne)}}class GLTFMaterialsSheenExtension{constructor(Z){this.parser=Z,this.name=EXTENSIONS.KHR_MATERIALS_SHEEN}getMaterialType(Z){const K=this.parser.json.materials[Z];return!K.extensions||!K.extensions[this.name]?null:MeshPhysicalMaterial}extendMaterialParams(Z,_){const K=this.parser,te=K.json.materials[Z];if(!te.extensions||!te.extensions[this.name])return Promise.resolve();const ne=[];_.sheenColor=new Color$1(0,0,0),_.sheenRoughness=0,_.sheen=1;const ie=te.extensions[this.name];if(ie.sheenColorFactor!==void 0){const oe=ie.sheenColorFactor;_.sheenColor.setRGB(oe[0],oe[1],oe[2],LinearSRGBColorSpace)}return ie.sheenRoughnessFactor!==void 0&&(_.sheenRoughness=ie.sheenRoughnessFactor),ie.sheenColorTexture!==void 0&&ne.push(K.assignTexture(_,"sheenColorMap",ie.sheenColorTexture,SRGBColorSpace)),ie.sheenRoughnessTexture!==void 0&&ne.push(K.assignTexture(_,"sheenRoughnessMap",ie.sheenRoughnessTexture)),Promise.all(ne)}}class GLTFMaterialsTransmissionExtension{constructor(Z){this.parser=Z,this.name=EXTENSIONS.KHR_MATERIALS_TRANSMISSION}getMaterialType(Z){const K=this.parser.json.materials[Z];return!K.extensions||!K.extensions[this.name]?null:MeshPhysicalMaterial}extendMaterialParams(Z,_){const K=this.parser,te=K.json.materials[Z];if(!te.extensions||!te.extensions[this.name])return Promise.resolve();const ne=[],ie=te.extensions[this.name];return ie.transmissionFactor!==void 0&&(_.transmission=ie.transmissionFactor),ie.transmissionTexture!==void 0&&ne.push(K.assignTexture(_,"transmissionMap",ie.transmissionTexture)),Promise.all(ne)}}class GLTFMaterialsVolumeExtension{constructor(Z){this.parser=Z,this.name=EXTENSIONS.KHR_MATERIALS_VOLUME}getMaterialType(Z){const K=this.parser.json.materials[Z];return!K.extensions||!K.extensions[this.name]?null:MeshPhysicalMaterial}extendMaterialParams(Z,_){const K=this.parser,te=K.json.materials[Z];if(!te.extensions||!te.extensions[this.name])return Promise.resolve();const ne=[],ie=te.extensions[this.name];_.thickness=ie.thicknessFactor!==void 0?ie.thicknessFactor:0,ie.thicknessTexture!==void 0&&ne.push(K.assignTexture(_,"thicknessMap",ie.thicknessTexture)),_.attenuationDistance=ie.attenuationDistance||1/0;const oe=ie.attenuationColor||[1,1,1];return _.attenuationColor=new Color$1().setRGB(oe[0],oe[1],oe[2],LinearSRGBColorSpace),Promise.all(ne)}}class GLTFMaterialsIorExtension{constructor(Z){this.parser=Z,this.name=EXTENSIONS.KHR_MATERIALS_IOR}getMaterialType(Z){const K=this.parser.json.materials[Z];return!K.extensions||!K.extensions[this.name]?null:MeshPhysicalMaterial}extendMaterialParams(Z,_){const te=this.parser.json.materials[Z];if(!te.extensions||!te.extensions[this.name])return Promise.resolve();const ne=te.extensions[this.name];return _.ior=ne.ior!==void 0?ne.ior:1.5,Promise.resolve()}}class GLTFMaterialsSpecularExtension{constructor(Z){this.parser=Z,this.name=EXTENSIONS.KHR_MATERIALS_SPECULAR}getMaterialType(Z){const K=this.parser.json.materials[Z];return!K.extensions||!K.extensions[this.name]?null:MeshPhysicalMaterial}extendMaterialParams(Z,_){const K=this.parser,te=K.json.materials[Z];if(!te.extensions||!te.extensions[this.name])return Promise.resolve();const ne=[],ie=te.extensions[this.name];_.specularIntensity=ie.specularFactor!==void 0?ie.specularFactor:1,ie.specularTexture!==void 0&&ne.push(K.assignTexture(_,"specularIntensityMap",ie.specularTexture));const oe=ie.specularColorFactor||[1,1,1];return _.specularColor=new Color$1().setRGB(oe[0],oe[1],oe[2],LinearSRGBColorSpace),ie.specularColorTexture!==void 0&&ne.push(K.assignTexture(_,"specularColorMap",ie.specularColorTexture,SRGBColorSpace)),Promise.all(ne)}}class GLTFMaterialsBumpExtension{constructor(Z){this.parser=Z,this.name=EXTENSIONS.EXT_MATERIALS_BUMP}getMaterialType(Z){const K=this.parser.json.materials[Z];return!K.extensions||!K.extensions[this.name]?null:MeshPhysicalMaterial}extendMaterialParams(Z,_){const K=this.parser,te=K.json.materials[Z];if(!te.extensions||!te.extensions[this.name])return Promise.resolve();const ne=[],ie=te.extensions[this.name];return _.bumpScale=ie.bumpFactor!==void 0?ie.bumpFactor:1,ie.bumpTexture!==void 0&&ne.push(K.assignTexture(_,"bumpMap",ie.bumpTexture)),Promise.all(ne)}}class GLTFMaterialsAnisotropyExtension{constructor(Z){this.parser=Z,this.name=EXTENSIONS.KHR_MATERIALS_ANISOTROPY}getMaterialType(Z){const K=this.parser.json.materials[Z];return!K.extensions||!K.extensions[this.name]?null:MeshPhysicalMaterial}extendMaterialParams(Z,_){const K=this.parser,te=K.json.materials[Z];if(!te.extensions||!te.extensions[this.name])return Promise.resolve();const ne=[],ie=te.extensions[this.name];return ie.anisotropyStrength!==void 0&&(_.anisotropy=ie.anisotropyStrength),ie.anisotropyRotation!==void 0&&(_.anisotropyRotation=ie.anisotropyRotation),ie.anisotropyTexture!==void 0&&ne.push(K.assignTexture(_,"anisotropyMap",ie.anisotropyTexture)),Promise.all(ne)}}class GLTFTextureBasisUExtension{constructor(Z){this.parser=Z,this.name=EXTENSIONS.KHR_TEXTURE_BASISU}loadTexture(Z){const _=this.parser,K=_.json,te=K.textures[Z];if(!te.extensions||!te.extensions[this.name])return null;const ne=te.extensions[this.name],ie=_.options.ktx2Loader;if(!ie){if(K.extensionsRequired&&K.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return _.loadTextureImage(Z,ne.source,ie)}}class GLTFTextureWebPExtension{constructor(Z){this.parser=Z,this.name=EXTENSIONS.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(Z){const _=this.name,K=this.parser,te=K.json,ne=te.textures[Z];if(!ne.extensions||!ne.extensions[_])return null;const ie=ne.extensions[_],oe=te.images[ie.source];let se=K.textureLoader;if(oe.uri){const ae=K.options.manager.getHandler(oe.uri);ae!==null&&(se=ae)}return this.detectSupport().then(function(ae){if(ae)return K.loadTextureImage(Z,ie.source,se);if(te.extensionsRequired&&te.extensionsRequired.indexOf(_)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return K.loadTexture(Z)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(Z){const _=new Image;_.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",_.onload=_.onerror=function(){Z(_.height===1)}})),this.isSupported}}class GLTFTextureAVIFExtension{constructor(Z){this.parser=Z,this.name=EXTENSIONS.EXT_TEXTURE_AVIF,this.isSupported=null}loadTexture(Z){const _=this.name,K=this.parser,te=K.json,ne=te.textures[Z];if(!ne.extensions||!ne.extensions[_])return null;const ie=ne.extensions[_],oe=te.images[ie.source];let se=K.textureLoader;if(oe.uri){const ae=K.options.manager.getHandler(oe.uri);ae!==null&&(se=ae)}return this.detectSupport().then(function(ae){if(ae)return K.loadTextureImage(Z,ie.source,se);if(te.extensionsRequired&&te.extensionsRequired.indexOf(_)>=0)throw new Error("THREE.GLTFLoader: AVIF required by asset but unsupported.");return K.loadTexture(Z)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(Z){const _=new Image;_.src="data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAABcAAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAEAAAABAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQAMAAAAABNjb2xybmNseAACAAIABoAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAAB9tZGF0EgAKCBgABogQEDQgMgkQAAAAB8dSLfI=",_.onload=_.onerror=function(){Z(_.height===1)}})),this.isSupported}}class GLTFMeshoptCompression{constructor(Z){this.name=EXTENSIONS.EXT_MESHOPT_COMPRESSION,this.parser=Z}loadBufferView(Z){const _=this.parser.json,K=_.bufferViews[Z];if(K.extensions&&K.extensions[this.name]){const te=K.extensions[this.name],ne=this.parser.getDependency("buffer",te.buffer),ie=this.parser.options.meshoptDecoder;if(!ie||!ie.supported){if(_.extensionsRequired&&_.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return ne.then(function(oe){const se=te.byteOffset||0,ae=te.byteLength||0,ge=te.count,ce=te.byteStride,de=new Uint8Array(oe,se,ae);return ie.decodeGltfBufferAsync?ie.decodeGltfBufferAsync(ge,ce,de,te.mode,te.filter).then(function(Ie){return Ie.buffer}):ie.ready.then(function(){const Ie=new ArrayBuffer(ge*ce);return ie.decodeGltfBuffer(new Uint8Array(Ie),ge,ce,de,te.mode,te.filter),Ie})})}else return null}}class GLTFMeshGpuInstancing{constructor(Z){this.name=EXTENSIONS.EXT_MESH_GPU_INSTANCING,this.parser=Z}createNodeMesh(Z){const _=this.parser.json,K=_.nodes[Z];if(!K.extensions||!K.extensions[this.name]||K.mesh===void 0)return null;const te=_.meshes[K.mesh];for(const ae of te.primitives)if(ae.mode!==WEBGL_CONSTANTS.TRIANGLES&&ae.mode!==WEBGL_CONSTANTS.TRIANGLE_STRIP&&ae.mode!==WEBGL_CONSTANTS.TRIANGLE_FAN&&ae.mode!==void 0)return null;const ie=K.extensions[this.name].attributes,oe=[],se={};for(const ae in ie)oe.push(this.parser.getDependency("accessor",ie[ae]).then(ge=>(se[ae]=ge,se[ae])));return oe.length<1?null:(oe.push(this.parser.createNodeMesh(Z)),Promise.all(oe).then(ae=>{const ge=ae.pop(),ce=ge.isGroup?ge.children:[ge],de=ae[0].count,Ie=[];for(const fe of ce){const be=new Matrix4,Ae=new Vector3,ye=new Quaternion$2,ve=new Vector3(1,1,1),Be=new InstancedMesh(fe.geometry,fe.material,de);for(let Re=0;Re<de;Re++)se.TRANSLATION&&Ae.fromBufferAttribute(se.TRANSLATION,Re),se.ROTATION&&ye.fromBufferAttribute(se.ROTATION,Re),se.SCALE&&ve.fromBufferAttribute(se.SCALE,Re),Be.setMatrixAt(Re,be.compose(Ae,ye,ve));for(const Re in se)if(Re==="_COLOR_0"){const Ve=se[Re];Be.instanceColor=new InstancedBufferAttribute(Ve.array,Ve.itemSize,Ve.normalized)}else Re!=="TRANSLATION"&&Re!=="ROTATION"&&Re!=="SCALE"&&fe.geometry.setAttribute(Re,se[Re]);Object3D.prototype.copy.call(Be,fe),this.parser.assignFinalMaterial(Be),Ie.push(Be)}return ge.isGroup?(ge.clear(),ge.add(...Ie),ge):Ie[0]}))}}const BINARY_EXTENSION_HEADER_MAGIC="glTF",BINARY_EXTENSION_HEADER_LENGTH=12,BINARY_EXTENSION_CHUNK_TYPES={JSON:1313821514,BIN:5130562};class GLTFBinaryExtension{constructor(Z){this.name=EXTENSIONS.KHR_BINARY_GLTF,this.content=null,this.body=null;const _=new DataView(Z,0,BINARY_EXTENSION_HEADER_LENGTH);if(this.header={magic:decodeText(new Uint8Array(Z.slice(0,4))),version:_.getUint32(4,!0),length:_.getUint32(8,!0)},this.header.magic!==BINARY_EXTENSION_HEADER_MAGIC)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const K=this.header.length-BINARY_EXTENSION_HEADER_LENGTH,te=new DataView(Z,BINARY_EXTENSION_HEADER_LENGTH);let ne=0;for(;ne<K;){const ie=te.getUint32(ne,!0);ne+=4;const oe=te.getUint32(ne,!0);if(ne+=4,oe===BINARY_EXTENSION_CHUNK_TYPES.JSON){const se=new Uint8Array(Z,BINARY_EXTENSION_HEADER_LENGTH+ne,ie);this.content=decodeText(se)}else if(oe===BINARY_EXTENSION_CHUNK_TYPES.BIN){const se=BINARY_EXTENSION_HEADER_LENGTH+ne;this.body=Z.slice(se,se+ie)}ne+=ie}if(this.content===null)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class GLTFDracoMeshCompressionExtension{constructor(Z,_){if(!_)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=EXTENSIONS.KHR_DRACO_MESH_COMPRESSION,this.json=Z,this.dracoLoader=_,this.dracoLoader.preload()}decodePrimitive(Z,_){const K=this.json,te=this.dracoLoader,ne=Z.extensions[this.name].bufferView,ie=Z.extensions[this.name].attributes,oe={},se={},ae={};for(const ge in ie){const ce=ATTRIBUTES[ge]||ge.toLowerCase();oe[ce]=ie[ge]}for(const ge in Z.attributes){const ce=ATTRIBUTES[ge]||ge.toLowerCase();if(ie[ge]!==void 0){const de=K.accessors[Z.attributes[ge]],Ie=WEBGL_COMPONENT_TYPES[de.componentType];ae[ce]=Ie.name,se[ce]=de.normalized===!0}}return _.getDependency("bufferView",ne).then(function(ge){return new Promise(function(ce,de){te.decodeDracoFile(ge,function(Ie){for(const fe in Ie.attributes){const be=Ie.attributes[fe],Ae=se[fe];Ae!==void 0&&(be.normalized=Ae)}ce(Ie)},oe,ae,LinearSRGBColorSpace,de)})})}}class GLTFTextureTransformExtension{constructor(){this.name=EXTENSIONS.KHR_TEXTURE_TRANSFORM}extendTexture(Z,_){return(_.texCoord===void 0||_.texCoord===Z.channel)&&_.offset===void 0&&_.rotation===void 0&&_.scale===void 0||(Z=Z.clone(),_.texCoord!==void 0&&(Z.channel=_.texCoord),_.offset!==void 0&&Z.offset.fromArray(_.offset),_.rotation!==void 0&&(Z.rotation=_.rotation),_.scale!==void 0&&Z.repeat.fromArray(_.scale),Z.needsUpdate=!0),Z}}class GLTFMeshQuantizationExtension{constructor(){this.name=EXTENSIONS.KHR_MESH_QUANTIZATION}}class GLTFCubicSplineInterpolant extends Interpolant{constructor(Z,_,K,te){super(Z,_,K,te)}copySampleValue_(Z){const _=this.resultBuffer,K=this.sampleValues,te=this.valueSize,ne=Z*te*3+te;for(let ie=0;ie!==te;ie++)_[ie]=K[ne+ie];return _}interpolate_(Z,_,K,te){const ne=this.resultBuffer,ie=this.sampleValues,oe=this.valueSize,se=oe*2,ae=oe*3,ge=te-_,ce=(K-_)/ge,de=ce*ce,Ie=de*ce,fe=Z*ae,be=fe-ae,Ae=-2*Ie+3*de,ye=Ie-de,ve=1-Ae,Be=ye-de+ce;for(let Re=0;Re!==oe;Re++){const Ve=ie[be+Re+oe],Ee=ie[be+Re+se]*ge,Ze=ie[fe+Re+oe],_e=ie[fe+Re]*ge;ne[Re]=ve*Ve+Be*Ee+Ae*Ze+ye*_e}return ne}}const _q=new Quaternion$2;class GLTFCubicSplineQuaternionInterpolant extends GLTFCubicSplineInterpolant{interpolate_(Z,_,K,te){const ne=super.interpolate_(Z,_,K,te);return _q.fromArray(ne).normalize().toArray(ne),ne}}const WEBGL_CONSTANTS={FLOAT:5126,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,LINEAR:9729,REPEAT:10497,SAMPLER_2D:35678,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123},WEBGL_COMPONENT_TYPES={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},WEBGL_FILTERS={9728:NearestFilter,9729:LinearFilter,9984:NearestMipmapNearestFilter,9985:LinearMipmapNearestFilter,9986:NearestMipmapLinearFilter,9987:LinearMipmapLinearFilter},WEBGL_WRAPPINGS={33071:ClampToEdgeWrapping,33648:MirroredRepeatWrapping,10497:RepeatWrapping},WEBGL_TYPE_SIZES={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},ATTRIBUTES={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",...version>=152?{TEXCOORD_0:"uv",TEXCOORD_1:"uv1",TEXCOORD_2:"uv2",TEXCOORD_3:"uv3"}:{TEXCOORD_0:"uv",TEXCOORD_1:"uv2"},COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},PATH_PROPERTIES={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},INTERPOLATION={CUBICSPLINE:void 0,LINEAR:InterpolateLinear,STEP:InterpolateDiscrete},ALPHA_MODES={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};function createDefaultMaterial(X){return X.DefaultMaterial===void 0&&(X.DefaultMaterial=new MeshStandardMaterial({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:FrontSide})),X.DefaultMaterial}function addUnknownExtensionsToUserData(X,Z,_){for(const K in _.extensions)X[K]===void 0&&(Z.userData.gltfExtensions=Z.userData.gltfExtensions||{},Z.userData.gltfExtensions[K]=_.extensions[K])}function assignExtrasToUserData(X,Z){Z.extras!==void 0&&(typeof Z.extras=="object"?Object.assign(X.userData,Z.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+Z.extras))}function addMorphTargets(X,Z,_){let K=!1,te=!1,ne=!1;for(let ae=0,ge=Z.length;ae<ge;ae++){const ce=Z[ae];if(ce.POSITION!==void 0&&(K=!0),ce.NORMAL!==void 0&&(te=!0),ce.COLOR_0!==void 0&&(ne=!0),K&&te&&ne)break}if(!K&&!te&&!ne)return Promise.resolve(X);const ie=[],oe=[],se=[];for(let ae=0,ge=Z.length;ae<ge;ae++){const ce=Z[ae];if(K){const de=ce.POSITION!==void 0?_.getDependency("accessor",ce.POSITION):X.attributes.position;ie.push(de)}if(te){const de=ce.NORMAL!==void 0?_.getDependency("accessor",ce.NORMAL):X.attributes.normal;oe.push(de)}if(ne){const de=ce.COLOR_0!==void 0?_.getDependency("accessor",ce.COLOR_0):X.attributes.color;se.push(de)}}return Promise.all([Promise.all(ie),Promise.all(oe),Promise.all(se)]).then(function(ae){const ge=ae[0],ce=ae[1],de=ae[2];return K&&(X.morphAttributes.position=ge),te&&(X.morphAttributes.normal=ce),ne&&(X.morphAttributes.color=de),X.morphTargetsRelative=!0,X})}function updateMorphTargets(X,Z){if(X.updateMorphTargets(),Z.weights!==void 0)for(let _=0,K=Z.weights.length;_<K;_++)X.morphTargetInfluences[_]=Z.weights[_];if(Z.extras&&Array.isArray(Z.extras.targetNames)){const _=Z.extras.targetNames;if(X.morphTargetInfluences.length===_.length){X.morphTargetDictionary={};for(let K=0,te=_.length;K<te;K++)X.morphTargetDictionary[_[K]]=K}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function createPrimitiveKey(X){let Z;const _=X.extensions&&X.extensions[EXTENSIONS.KHR_DRACO_MESH_COMPRESSION];if(_?Z="draco:"+_.bufferView+":"+_.indices+":"+createAttributesKey(_.attributes):Z=X.indices+":"+createAttributesKey(X.attributes)+":"+X.mode,X.targets!==void 0)for(let K=0,te=X.targets.length;K<te;K++)Z+=":"+createAttributesKey(X.targets[K]);return Z}function createAttributesKey(X){let Z="";const _=Object.keys(X).sort();for(let K=0,te=_.length;K<te;K++)Z+=_[K]+":"+X[_[K]]+";";return Z}function getNormalizedComponentScale(X){switch(X){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}function getImageURIMimeType(X){return X.search(/\.jpe?g($|\?)/i)>0||X.search(/^data\:image\/jpeg/)===0?"image/jpeg":X.search(/\.webp($|\?)/i)>0||X.search(/^data\:image\/webp/)===0?"image/webp":"image/png"}const _identityMatrix=new Matrix4;class GLTFParser{constructor(Z={},_={}){this.json=Z,this.extensions={},this.plugins={},this.options=_,this.cache=new GLTFRegistry,this.associations=new Map,this.primitiveCache={},this.nodeCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};let K=!1,te=!1,ne=-1;typeof navigator<"u"&&typeof navigator.userAgent<"u"&&(K=/^((?!chrome|android).)*safari/i.test(navigator.userAgent)===!0,te=navigator.userAgent.indexOf("Firefox")>-1,ne=te?navigator.userAgent.match(/Firefox\/([0-9]+)\./)[1]:-1),typeof createImageBitmap>"u"||K||te&&ne<98?this.textureLoader=new TextureLoader(this.options.manager):this.textureLoader=new ImageBitmapLoader(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new FileLoader(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),this.options.crossOrigin==="use-credentials"&&this.fileLoader.setWithCredentials(!0)}setExtensions(Z){this.extensions=Z}setPlugins(Z){this.plugins=Z}parse(Z,_){const K=this,te=this.json,ne=this.extensions;this.cache.removeAll(),this.nodeCache={},this._invokeAll(function(ie){return ie._markDefs&&ie._markDefs()}),Promise.all(this._invokeAll(function(ie){return ie.beforeRoot&&ie.beforeRoot()})).then(function(){return Promise.all([K.getDependencies("scene"),K.getDependencies("animation"),K.getDependencies("camera")])}).then(function(ie){const oe={scene:ie[0][te.scene||0],scenes:ie[0],animations:ie[1],cameras:ie[2],asset:te.asset,parser:K,userData:{}};return addUnknownExtensionsToUserData(ne,oe,te),assignExtrasToUserData(oe,te),Promise.all(K._invokeAll(function(se){return se.afterRoot&&se.afterRoot(oe)})).then(function(){for(const se of oe.scenes)se.updateMatrixWorld();Z(oe)})}).catch(_)}_markDefs(){const Z=this.json.nodes||[],_=this.json.skins||[],K=this.json.meshes||[];for(let te=0,ne=_.length;te<ne;te++){const ie=_[te].joints;for(let oe=0,se=ie.length;oe<se;oe++)Z[ie[oe]].isBone=!0}for(let te=0,ne=Z.length;te<ne;te++){const ie=Z[te];ie.mesh!==void 0&&(this._addNodeRef(this.meshCache,ie.mesh),ie.skin!==void 0&&(K[ie.mesh].isSkinnedMesh=!0)),ie.camera!==void 0&&this._addNodeRef(this.cameraCache,ie.camera)}}_addNodeRef(Z,_){_!==void 0&&(Z.refs[_]===void 0&&(Z.refs[_]=Z.uses[_]=0),Z.refs[_]++)}_getNodeRef(Z,_,K){if(Z.refs[_]<=1)return K;const te=K.clone(),ne=(ie,oe)=>{const se=this.associations.get(ie);se!=null&&this.associations.set(oe,se);for(const[ae,ge]of ie.children.entries())ne(ge,oe.children[ae])};return ne(K,te),te.name+="_instance_"+Z.uses[_]++,te}_invokeOne(Z){const _=Object.values(this.plugins);_.push(this);for(let K=0;K<_.length;K++){const te=Z(_[K]);if(te)return te}return null}_invokeAll(Z){const _=Object.values(this.plugins);_.unshift(this);const K=[];for(let te=0;te<_.length;te++){const ne=Z(_[te]);ne&&K.push(ne)}return K}getDependency(Z,_){const K=Z+":"+_;let te=this.cache.get(K);if(!te){switch(Z){case"scene":te=this.loadScene(_);break;case"node":te=this._invokeOne(function(ne){return ne.loadNode&&ne.loadNode(_)});break;case"mesh":te=this._invokeOne(function(ne){return ne.loadMesh&&ne.loadMesh(_)});break;case"accessor":te=this.loadAccessor(_);break;case"bufferView":te=this._invokeOne(function(ne){return ne.loadBufferView&&ne.loadBufferView(_)});break;case"buffer":te=this.loadBuffer(_);break;case"material":te=this._invokeOne(function(ne){return ne.loadMaterial&&ne.loadMaterial(_)});break;case"texture":te=this._invokeOne(function(ne){return ne.loadTexture&&ne.loadTexture(_)});break;case"skin":te=this.loadSkin(_);break;case"animation":te=this._invokeOne(function(ne){return ne.loadAnimation&&ne.loadAnimation(_)});break;case"camera":te=this.loadCamera(_);break;default:if(te=this._invokeOne(function(ne){return ne!=this&&ne.getDependency&&ne.getDependency(Z,_)}),!te)throw new Error("Unknown type: "+Z);break}this.cache.add(K,te)}return te}getDependencies(Z){let _=this.cache.get(Z);if(!_){const K=this,te=this.json[Z+(Z==="mesh"?"es":"s")]||[];_=Promise.all(te.map(function(ne,ie){return K.getDependency(Z,ie)})),this.cache.add(Z,_)}return _}loadBuffer(Z){const _=this.json.buffers[Z],K=this.fileLoader;if(_.type&&_.type!=="arraybuffer")throw new Error("THREE.GLTFLoader: "+_.type+" buffer type is not supported.");if(_.uri===void 0&&Z===0)return Promise.resolve(this.extensions[EXTENSIONS.KHR_BINARY_GLTF].body);const te=this.options;return new Promise(function(ne,ie){K.load(LoaderUtils.resolveURL(_.uri,te.path),ne,void 0,function(){ie(new Error('THREE.GLTFLoader: Failed to load buffer "'+_.uri+'".'))})})}loadBufferView(Z){const _=this.json.bufferViews[Z];return this.getDependency("buffer",_.buffer).then(function(K){const te=_.byteLength||0,ne=_.byteOffset||0;return K.slice(ne,ne+te)})}loadAccessor(Z){const _=this,K=this.json,te=this.json.accessors[Z];if(te.bufferView===void 0&&te.sparse===void 0){const ie=WEBGL_TYPE_SIZES[te.type],oe=WEBGL_COMPONENT_TYPES[te.componentType],se=te.normalized===!0,ae=new oe(te.count*ie);return Promise.resolve(new BufferAttribute(ae,ie,se))}const ne=[];return te.bufferView!==void 0?ne.push(this.getDependency("bufferView",te.bufferView)):ne.push(null),te.sparse!==void 0&&(ne.push(this.getDependency("bufferView",te.sparse.indices.bufferView)),ne.push(this.getDependency("bufferView",te.sparse.values.bufferView))),Promise.all(ne).then(function(ie){const oe=ie[0],se=WEBGL_TYPE_SIZES[te.type],ae=WEBGL_COMPONENT_TYPES[te.componentType],ge=ae.BYTES_PER_ELEMENT,ce=ge*se,de=te.byteOffset||0,Ie=te.bufferView!==void 0?K.bufferViews[te.bufferView].byteStride:void 0,fe=te.normalized===!0;let be,Ae;if(Ie&&Ie!==ce){const ye=Math.floor(de/Ie),ve="InterleavedBuffer:"+te.bufferView+":"+te.componentType+":"+ye+":"+te.count;let Be=_.cache.get(ve);Be||(be=new ae(oe,ye*Ie,te.count*Ie/ge),Be=new InterleavedBuffer(be,Ie/ge),_.cache.add(ve,Be)),Ae=new InterleavedBufferAttribute(Be,se,de%Ie/ge,fe)}else oe===null?be=new ae(te.count*se):be=new ae(oe,de,te.count*se),Ae=new BufferAttribute(be,se,fe);if(te.sparse!==void 0){const ye=WEBGL_TYPE_SIZES.SCALAR,ve=WEBGL_COMPONENT_TYPES[te.sparse.indices.componentType],Be=te.sparse.indices.byteOffset||0,Re=te.sparse.values.byteOffset||0,Ve=new ve(ie[1],Be,te.sparse.count*ye),Ee=new ae(ie[2],Re,te.sparse.count*se);oe!==null&&(Ae=new BufferAttribute(Ae.array.slice(),Ae.itemSize,Ae.normalized));for(let Ze=0,_e=Ve.length;Ze<_e;Ze++){const Fe=Ve[Ze];if(Ae.setX(Fe,Ee[Ze*se]),se>=2&&Ae.setY(Fe,Ee[Ze*se+1]),se>=3&&Ae.setZ(Fe,Ee[Ze*se+2]),se>=4&&Ae.setW(Fe,Ee[Ze*se+3]),se>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return Ae})}loadTexture(Z){const _=this.json,K=this.options,ne=_.textures[Z].source,ie=_.images[ne];let oe=this.textureLoader;if(ie.uri){const se=K.manager.getHandler(ie.uri);se!==null&&(oe=se)}return this.loadTextureImage(Z,ne,oe)}loadTextureImage(Z,_,K){const te=this,ne=this.json,ie=ne.textures[Z],oe=ne.images[_],se=(oe.uri||oe.bufferView)+":"+ie.sampler;if(this.textureCache[se])return this.textureCache[se];const ae=this.loadImageSource(_,K).then(function(ge){ge.flipY=!1,ge.name=ie.name||oe.name||"",ge.name===""&&typeof oe.uri=="string"&&oe.uri.startsWith("data:image/")===!1&&(ge.name=oe.uri);const de=(ne.samplers||{})[ie.sampler]||{};return ge.magFilter=WEBGL_FILTERS[de.magFilter]||LinearFilter,ge.minFilter=WEBGL_FILTERS[de.minFilter]||LinearMipmapLinearFilter,ge.wrapS=WEBGL_WRAPPINGS[de.wrapS]||RepeatWrapping,ge.wrapT=WEBGL_WRAPPINGS[de.wrapT]||RepeatWrapping,te.associations.set(ge,{textures:Z}),ge}).catch(function(){return null});return this.textureCache[se]=ae,ae}loadImageSource(Z,_){const K=this,te=this.json,ne=this.options;if(this.sourceCache[Z]!==void 0)return this.sourceCache[Z].then(ce=>ce.clone());const ie=te.images[Z],oe=self.URL||self.webkitURL;let se=ie.uri||"",ae=!1;if(ie.bufferView!==void 0)se=K.getDependency("bufferView",ie.bufferView).then(function(ce){ae=!0;const de=new Blob([ce],{type:ie.mimeType});return se=oe.createObjectURL(de),se});else if(ie.uri===void 0)throw new Error("THREE.GLTFLoader: Image "+Z+" is missing URI and bufferView");const ge=Promise.resolve(se).then(function(ce){return new Promise(function(de,Ie){let fe=de;_.isImageBitmapLoader===!0&&(fe=function(be){const Ae=new Texture(be);Ae.needsUpdate=!0,de(Ae)}),_.load(LoaderUtils.resolveURL(ce,ne.path),fe,void 0,Ie)})}).then(function(ce){return ae===!0&&oe.revokeObjectURL(se),assignExtrasToUserData(ce,ie),ce.userData.mimeType=ie.mimeType||getImageURIMimeType(ie.uri),ce}).catch(function(ce){throw console.error("THREE.GLTFLoader: Couldn't load texture",se),ce});return this.sourceCache[Z]=ge,ge}assignTexture(Z,_,K,te){const ne=this;return this.getDependency("texture",K.index).then(function(ie){if(!ie)return null;if(K.texCoord!==void 0&&K.texCoord>0&&(ie=ie.clone(),ie.channel=K.texCoord),ne.extensions[EXTENSIONS.KHR_TEXTURE_TRANSFORM]){const oe=K.extensions!==void 0?K.extensions[EXTENSIONS.KHR_TEXTURE_TRANSFORM]:void 0;if(oe){const se=ne.associations.get(ie);ie=ne.extensions[EXTENSIONS.KHR_TEXTURE_TRANSFORM].extendTexture(ie,oe),ne.associations.set(ie,se)}}return te!==void 0&&(typeof te=="number"&&(te=te===sRGBEncoding$1?SRGBColorSpace:LinearSRGBColorSpace),"colorSpace"in ie?ie.colorSpace=te:ie.encoding=te===SRGBColorSpace?sRGBEncoding$1:LinearEncoding$1),Z[_]=ie,ie})}assignFinalMaterial(Z){const _=Z.geometry;let K=Z.material;const te=_.attributes.tangent===void 0,ne=_.attributes.color!==void 0,ie=_.attributes.normal===void 0;if(Z.isPoints){const oe="PointsMaterial:"+K.uuid;let se=this.cache.get(oe);se||(se=new PointsMaterial,Material.prototype.copy.call(se,K),se.color.copy(K.color),se.map=K.map,se.sizeAttenuation=!1,this.cache.add(oe,se)),K=se}else if(Z.isLine){const oe="LineBasicMaterial:"+K.uuid;let se=this.cache.get(oe);se||(se=new LineBasicMaterial,Material.prototype.copy.call(se,K),se.color.copy(K.color),se.map=K.map,this.cache.add(oe,se)),K=se}if(te||ne||ie){let oe="ClonedMaterial:"+K.uuid+":";te&&(oe+="derivative-tangents:"),ne&&(oe+="vertex-colors:"),ie&&(oe+="flat-shading:");let se=this.cache.get(oe);se||(se=K.clone(),ne&&(se.vertexColors=!0),ie&&(se.flatShading=!0),te&&(se.normalScale&&(se.normalScale.y*=-1),se.clearcoatNormalScale&&(se.clearcoatNormalScale.y*=-1)),this.cache.add(oe,se),this.associations.set(se,this.associations.get(K))),K=se}Z.material=K}getMaterialType(){return MeshStandardMaterial}loadMaterial(Z){const _=this,K=this.json,te=this.extensions,ne=K.materials[Z];let ie;const oe={},se=ne.extensions||{},ae=[];if(se[EXTENSIONS.KHR_MATERIALS_UNLIT]){const ce=te[EXTENSIONS.KHR_MATERIALS_UNLIT];ie=ce.getMaterialType(),ae.push(ce.extendParams(oe,ne,_))}else{const ce=ne.pbrMetallicRoughness||{};if(oe.color=new Color$1(1,1,1),oe.opacity=1,Array.isArray(ce.baseColorFactor)){const de=ce.baseColorFactor;oe.color.setRGB(de[0],de[1],de[2],LinearSRGBColorSpace),oe.opacity=de[3]}ce.baseColorTexture!==void 0&&ae.push(_.assignTexture(oe,"map",ce.baseColorTexture,SRGBColorSpace)),oe.metalness=ce.metallicFactor!==void 0?ce.metallicFactor:1,oe.roughness=ce.roughnessFactor!==void 0?ce.roughnessFactor:1,ce.metallicRoughnessTexture!==void 0&&(ae.push(_.assignTexture(oe,"metalnessMap",ce.metallicRoughnessTexture)),ae.push(_.assignTexture(oe,"roughnessMap",ce.metallicRoughnessTexture))),ie=this._invokeOne(function(de){return de.getMaterialType&&de.getMaterialType(Z)}),ae.push(Promise.all(this._invokeAll(function(de){return de.extendMaterialParams&&de.extendMaterialParams(Z,oe)})))}ne.doubleSided===!0&&(oe.side=DoubleSide);const ge=ne.alphaMode||ALPHA_MODES.OPAQUE;if(ge===ALPHA_MODES.BLEND?(oe.transparent=!0,oe.depthWrite=!1):(oe.transparent=!1,ge===ALPHA_MODES.MASK&&(oe.alphaTest=ne.alphaCutoff!==void 0?ne.alphaCutoff:.5)),ne.normalTexture!==void 0&&ie!==MeshBasicMaterial&&(ae.push(_.assignTexture(oe,"normalMap",ne.normalTexture)),oe.normalScale=new Vector2(1,1),ne.normalTexture.scale!==void 0)){const ce=ne.normalTexture.scale;oe.normalScale.set(ce,ce)}if(ne.occlusionTexture!==void 0&&ie!==MeshBasicMaterial&&(ae.push(_.assignTexture(oe,"aoMap",ne.occlusionTexture)),ne.occlusionTexture.strength!==void 0&&(oe.aoMapIntensity=ne.occlusionTexture.strength)),ne.emissiveFactor!==void 0&&ie!==MeshBasicMaterial){const ce=ne.emissiveFactor;oe.emissive=new Color$1().setRGB(ce[0],ce[1],ce[2],LinearSRGBColorSpace)}return ne.emissiveTexture!==void 0&&ie!==MeshBasicMaterial&&ae.push(_.assignTexture(oe,"emissiveMap",ne.emissiveTexture,SRGBColorSpace)),Promise.all(ae).then(function(){const ce=new ie(oe);return ne.name&&(ce.name=ne.name),assignExtrasToUserData(ce,ne),_.associations.set(ce,{materials:Z}),ne.extensions&&addUnknownExtensionsToUserData(te,ce,ne),ce})}createUniqueName(Z){const _=PropertyBinding.sanitizeNodeName(Z||"");return _ in this.nodeNamesUsed?_+"_"+ ++this.nodeNamesUsed[_]:(this.nodeNamesUsed[_]=0,_)}loadGeometries(Z){const _=this,K=this.extensions,te=this.primitiveCache;function ne(oe){return K[EXTENSIONS.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(oe,_).then(function(se){return addPrimitiveAttributes(se,oe,_)})}const ie=[];for(let oe=0,se=Z.length;oe<se;oe++){const ae=Z[oe],ge=createPrimitiveKey(ae),ce=te[ge];if(ce)ie.push(ce.promise);else{let de;ae.extensions&&ae.extensions[EXTENSIONS.KHR_DRACO_MESH_COMPRESSION]?de=ne(ae):de=addPrimitiveAttributes(new BufferGeometry,ae,_),te[ge]={primitive:ae,promise:de},ie.push(de)}}return Promise.all(ie)}loadMesh(Z){const _=this,K=this.json,te=this.extensions,ne=K.meshes[Z],ie=ne.primitives,oe=[];for(let se=0,ae=ie.length;se<ae;se++){const ge=ie[se].material===void 0?createDefaultMaterial(this.cache):this.getDependency("material",ie[se].material);oe.push(ge)}return oe.push(_.loadGeometries(ie)),Promise.all(oe).then(function(se){const ae=se.slice(0,se.length-1),ge=se[se.length-1],ce=[];for(let Ie=0,fe=ge.length;Ie<fe;Ie++){const be=ge[Ie],Ae=ie[Ie];let ye;const ve=ae[Ie];if(Ae.mode===WEBGL_CONSTANTS.TRIANGLES||Ae.mode===WEBGL_CONSTANTS.TRIANGLE_STRIP||Ae.mode===WEBGL_CONSTANTS.TRIANGLE_FAN||Ae.mode===void 0)ye=ne.isSkinnedMesh===!0?new SkinnedMesh(be,ve):new Mesh(be,ve),ye.isSkinnedMesh===!0&&ye.normalizeSkinWeights(),Ae.mode===WEBGL_CONSTANTS.TRIANGLE_STRIP?ye.geometry=toTrianglesDrawMode(ye.geometry,TriangleStripDrawMode):Ae.mode===WEBGL_CONSTANTS.TRIANGLE_FAN&&(ye.geometry=toTrianglesDrawMode(ye.geometry,TriangleFanDrawMode));else if(Ae.mode===WEBGL_CONSTANTS.LINES)ye=new LineSegments(be,ve);else if(Ae.mode===WEBGL_CONSTANTS.LINE_STRIP)ye=new Line(be,ve);else if(Ae.mode===WEBGL_CONSTANTS.LINE_LOOP)ye=new LineLoop(be,ve);else if(Ae.mode===WEBGL_CONSTANTS.POINTS)ye=new Points(be,ve);else throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+Ae.mode);Object.keys(ye.geometry.morphAttributes).length>0&&updateMorphTargets(ye,ne),ye.name=_.createUniqueName(ne.name||"mesh_"+Z),assignExtrasToUserData(ye,ne),Ae.extensions&&addUnknownExtensionsToUserData(te,ye,Ae),_.assignFinalMaterial(ye),ce.push(ye)}for(let Ie=0,fe=ce.length;Ie<fe;Ie++)_.associations.set(ce[Ie],{meshes:Z,primitives:Ie});if(ce.length===1)return ne.extensions&&addUnknownExtensionsToUserData(te,ce[0],ne),ce[0];const de=new Group;ne.extensions&&addUnknownExtensionsToUserData(te,de,ne),_.associations.set(de,{meshes:Z});for(let Ie=0,fe=ce.length;Ie<fe;Ie++)de.add(ce[Ie]);return de})}loadCamera(Z){let _;const K=this.json.cameras[Z],te=K[K.type];if(!te){console.warn("THREE.GLTFLoader: Missing camera parameters.");return}return K.type==="perspective"?_=new PerspectiveCamera(MathUtils.radToDeg(te.yfov),te.aspectRatio||1,te.znear||1,te.zfar||2e6):K.type==="orthographic"&&(_=new OrthographicCamera(-te.xmag,te.xmag,te.ymag,-te.ymag,te.znear,te.zfar)),K.name&&(_.name=this.createUniqueName(K.name)),assignExtrasToUserData(_,K),Promise.resolve(_)}loadSkin(Z){const _=this.json.skins[Z],K=[];for(let te=0,ne=_.joints.length;te<ne;te++)K.push(this._loadNodeShallow(_.joints[te]));return _.inverseBindMatrices!==void 0?K.push(this.getDependency("accessor",_.inverseBindMatrices)):K.push(null),Promise.all(K).then(function(te){const ne=te.pop(),ie=te,oe=[],se=[];for(let ae=0,ge=ie.length;ae<ge;ae++){const ce=ie[ae];if(ce){oe.push(ce);const de=new Matrix4;ne!==null&&de.fromArray(ne.array,ae*16),se.push(de)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',_.joints[ae])}return new Skeleton(oe,se)})}loadAnimation(Z){const _=this.json,K=this,te=_.animations[Z],ne=te.name?te.name:"animation_"+Z,ie=[],oe=[],se=[],ae=[],ge=[];for(let ce=0,de=te.channels.length;ce<de;ce++){const Ie=te.channels[ce],fe=te.samplers[Ie.sampler],be=Ie.target,Ae=be.node,ye=te.parameters!==void 0?te.parameters[fe.input]:fe.input,ve=te.parameters!==void 0?te.parameters[fe.output]:fe.output;be.node!==void 0&&(ie.push(this.getDependency("node",Ae)),oe.push(this.getDependency("accessor",ye)),se.push(this.getDependency("accessor",ve)),ae.push(fe),ge.push(be))}return Promise.all([Promise.all(ie),Promise.all(oe),Promise.all(se),Promise.all(ae),Promise.all(ge)]).then(function(ce){const de=ce[0],Ie=ce[1],fe=ce[2],be=ce[3],Ae=ce[4],ye=[];for(let ve=0,Be=de.length;ve<Be;ve++){const Re=de[ve],Ve=Ie[ve],Ee=fe[ve],Ze=be[ve],_e=Ae[ve];if(Re===void 0)continue;Re.updateMatrix&&Re.updateMatrix();const Fe=K._createAnimationTracks(Re,Ve,Ee,Ze,_e);if(Fe)for(let Te=0;Te<Fe.length;Te++)ye.push(Fe[Te])}return new AnimationClip(ne,void 0,ye)})}createNodeMesh(Z){const _=this.json,K=this,te=_.nodes[Z];return te.mesh===void 0?null:K.getDependency("mesh",te.mesh).then(function(ne){const ie=K._getNodeRef(K.meshCache,te.mesh,ne);return te.weights!==void 0&&ie.traverse(function(oe){if(oe.isMesh)for(let se=0,ae=te.weights.length;se<ae;se++)oe.morphTargetInfluences[se]=te.weights[se]}),ie})}loadNode(Z){const _=this.json,K=this,te=_.nodes[Z],ne=K._loadNodeShallow(Z),ie=[],oe=te.children||[];for(let ae=0,ge=oe.length;ae<ge;ae++)ie.push(K.getDependency("node",oe[ae]));const se=te.skin===void 0?Promise.resolve(null):K.getDependency("skin",te.skin);return Promise.all([ne,Promise.all(ie),se]).then(function(ae){const ge=ae[0],ce=ae[1],de=ae[2];de!==null&&ge.traverse(function(Ie){Ie.isSkinnedMesh&&Ie.bind(de,_identityMatrix)});for(let Ie=0,fe=ce.length;Ie<fe;Ie++)ge.add(ce[Ie]);return ge})}_loadNodeShallow(Z){const _=this.json,K=this.extensions,te=this;if(this.nodeCache[Z]!==void 0)return this.nodeCache[Z];const ne=_.nodes[Z],ie=ne.name?te.createUniqueName(ne.name):"",oe=[],se=te._invokeOne(function(ae){return ae.createNodeMesh&&ae.createNodeMesh(Z)});return se&&oe.push(se),ne.camera!==void 0&&oe.push(te.getDependency("camera",ne.camera).then(function(ae){return te._getNodeRef(te.cameraCache,ne.camera,ae)})),te._invokeAll(function(ae){return ae.createNodeAttachment&&ae.createNodeAttachment(Z)}).forEach(function(ae){oe.push(ae)}),this.nodeCache[Z]=Promise.all(oe).then(function(ae){let ge;if(ne.isBone===!0?ge=new Bone:ae.length>1?ge=new Group:ae.length===1?ge=ae[0]:ge=new Object3D,ge!==ae[0])for(let ce=0,de=ae.length;ce<de;ce++)ge.add(ae[ce]);if(ne.name&&(ge.userData.name=ne.name,ge.name=ie),assignExtrasToUserData(ge,ne),ne.extensions&&addUnknownExtensionsToUserData(K,ge,ne),ne.matrix!==void 0){const ce=new Matrix4;ce.fromArray(ne.matrix),ge.applyMatrix4(ce)}else ne.translation!==void 0&&ge.position.fromArray(ne.translation),ne.rotation!==void 0&&ge.quaternion.fromArray(ne.rotation),ne.scale!==void 0&&ge.scale.fromArray(ne.scale);return te.associations.has(ge)||te.associations.set(ge,{}),te.associations.get(ge).nodes=Z,ge}),this.nodeCache[Z]}loadScene(Z){const _=this.extensions,K=this.json.scenes[Z],te=this,ne=new Group;K.name&&(ne.name=te.createUniqueName(K.name)),assignExtrasToUserData(ne,K),K.extensions&&addUnknownExtensionsToUserData(_,ne,K);const ie=K.nodes||[],oe=[];for(let se=0,ae=ie.length;se<ae;se++)oe.push(te.getDependency("node",ie[se]));return Promise.all(oe).then(function(se){for(let ge=0,ce=se.length;ge<ce;ge++)ne.add(se[ge]);const ae=ge=>{const ce=new Map;for(const[de,Ie]of te.associations)(de instanceof Material||de instanceof Texture)&&ce.set(de,Ie);return ge.traverse(de=>{const Ie=te.associations.get(de);Ie!=null&&ce.set(de,Ie)}),ce};return te.associations=ae(ne),ne})}_createAnimationTracks(Z,_,K,te,ne){const ie=[],oe=Z.name?Z.name:Z.uuid,se=[];PATH_PROPERTIES[ne.path]===PATH_PROPERTIES.weights?Z.traverse(function(de){de.morphTargetInfluences&&se.push(de.name?de.name:de.uuid)}):se.push(oe);let ae;switch(PATH_PROPERTIES[ne.path]){case PATH_PROPERTIES.weights:ae=NumberKeyframeTrack;break;case PATH_PROPERTIES.rotation:ae=QuaternionKeyframeTrack;break;case PATH_PROPERTIES.position:case PATH_PROPERTIES.scale:ae=VectorKeyframeTrack;break;default:switch(K.itemSize){case 1:ae=NumberKeyframeTrack;break;case 2:case 3:default:ae=VectorKeyframeTrack;break}break}const ge=te.interpolation!==void 0?INTERPOLATION[te.interpolation]:InterpolateLinear,ce=this._getArrayFromAccessor(K);for(let de=0,Ie=se.length;de<Ie;de++){const fe=new ae(se[de]+"."+PATH_PROPERTIES[ne.path],_.array,ce,ge);te.interpolation==="CUBICSPLINE"&&this._createCubicSplineTrackInterpolant(fe),ie.push(fe)}return ie}_getArrayFromAccessor(Z){let _=Z.array;if(Z.normalized){const K=getNormalizedComponentScale(_.constructor),te=new Float32Array(_.length);for(let ne=0,ie=_.length;ne<ie;ne++)te[ne]=_[ne]*K;_=te}return _}_createCubicSplineTrackInterpolant(Z){Z.createInterpolant=function(K){const te=this instanceof QuaternionKeyframeTrack?GLTFCubicSplineQuaternionInterpolant:GLTFCubicSplineInterpolant;return new te(this.times,this.values,this.getValueSize()/3,K)},Z.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0}}function computeBounds(X,Z,_){const K=Z.attributes,te=new Box3;if(K.POSITION!==void 0){const oe=_.json.accessors[K.POSITION],se=oe.min,ae=oe.max;if(se!==void 0&&ae!==void 0){if(te.set(new Vector3(se[0],se[1],se[2]),new Vector3(ae[0],ae[1],ae[2])),oe.normalized){const ge=getNormalizedComponentScale(WEBGL_COMPONENT_TYPES[oe.componentType]);te.min.multiplyScalar(ge),te.max.multiplyScalar(ge)}}else{console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");return}}else return;const ne=Z.targets;if(ne!==void 0){const oe=new Vector3,se=new Vector3;for(let ae=0,ge=ne.length;ae<ge;ae++){const ce=ne[ae];if(ce.POSITION!==void 0){const de=_.json.accessors[ce.POSITION],Ie=de.min,fe=de.max;if(Ie!==void 0&&fe!==void 0){if(se.setX(Math.max(Math.abs(Ie[0]),Math.abs(fe[0]))),se.setY(Math.max(Math.abs(Ie[1]),Math.abs(fe[1]))),se.setZ(Math.max(Math.abs(Ie[2]),Math.abs(fe[2]))),de.normalized){const be=getNormalizedComponentScale(WEBGL_COMPONENT_TYPES[de.componentType]);se.multiplyScalar(be)}oe.max(se)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}te.expandByVector(oe)}X.boundingBox=te;const ie=new Sphere;te.getCenter(ie.center),ie.radius=te.min.distanceTo(te.max)/2,X.boundingSphere=ie}function addPrimitiveAttributes(X,Z,_){const K=Z.attributes,te=[];function ne(ie,oe){return _.getDependency("accessor",ie).then(function(se){X.setAttribute(oe,se)})}for(const ie in K){const oe=ATTRIBUTES[ie]||ie.toLowerCase();oe in X.attributes||te.push(ne(K[ie],oe))}if(Z.indices!==void 0&&!X.index){const ie=_.getDependency("accessor",Z.indices).then(function(oe){X.setIndex(oe)});te.push(ie)}return assignExtrasToUserData(X,Z),computeBounds(X,Z,_),Promise.all(te).then(function(){return Z.targets!==void 0?addMorphTargets(X,Z.targets,_):X})}class RGBELoader extends DataTextureLoader{constructor(Z){super(Z),this.type=HalfFloatType}parse(Z){const ie=function(_e,Fe){switch(_e){case 1:throw new Error("THREE.RGBELoader: Read Error: "+(Fe||""));case 2:throw new Error("THREE.RGBELoader: Write Error: "+(Fe||""));case 3:throw new Error("THREE.RGBELoader: Bad File Format: "+(Fe||""));default:case 4:throw new Error("THREE.RGBELoader: Memory Error: "+(Fe||""))}},ge=`
`,ce=function(_e,Fe,Te){Fe=Fe||1024;let Le=_e.pos,Ke=-1,Ue=0,rt="",tt=String.fromCharCode.apply(null,new Uint16Array(_e.subarray(Le,Le+128)));for(;0>(Ke=tt.indexOf(ge))&&Ue<Fe&&Le<_e.byteLength;)rt+=tt,Ue+=tt.length,Le+=128,tt+=String.fromCharCode.apply(null,new Uint16Array(_e.subarray(Le,Le+128)));return-1<Ke?(_e.pos+=Ue+Ke+1,rt+tt.slice(0,Ke)):!1},de=function(_e){const Fe=/^#\?(\S+)/,Te=/^\s*GAMMA\s*=\s*(\d+(\.\d+)?)\s*$/,ke=/^\s*EXPOSURE\s*=\s*(\d+(\.\d+)?)\s*$/,Le=/^\s*FORMAT=(\S+)\s*$/,Ke=/^\s*\-Y\s+(\d+)\s+\+X\s+(\d+)\s*$/,Ue={valid:0,string:"",comments:"",programtype:"RGBE",format:"",gamma:1,exposure:1,width:0,height:0};let rt,tt;for((_e.pos>=_e.byteLength||!(rt=ce(_e)))&&ie(1,"no header found"),(tt=rt.match(Fe))||ie(3,"bad initial token"),Ue.valid|=1,Ue.programtype=tt[1],Ue.string+=rt+`
`;rt=ce(_e),rt!==!1;){if(Ue.string+=rt+`
`,rt.charAt(0)==="#"){Ue.comments+=rt+`
`;continue}if((tt=rt.match(Te))&&(Ue.gamma=parseFloat(tt[1])),(tt=rt.match(ke))&&(Ue.exposure=parseFloat(tt[1])),(tt=rt.match(Le))&&(Ue.valid|=2,Ue.format=tt[1]),(tt=rt.match(Ke))&&(Ue.valid|=4,Ue.height=parseInt(tt[1],10),Ue.width=parseInt(tt[2],10)),Ue.valid&2&&Ue.valid&4)break}return Ue.valid&2||ie(3,"missing format specifier"),Ue.valid&4||ie(3,"missing image size specifier"),Ue},Ie=function(_e,Fe,Te){const ke=Fe;if(ke<8||ke>32767||_e[0]!==2||_e[1]!==2||_e[2]&128)return new Uint8Array(_e);ke!==(_e[2]<<8|_e[3])&&ie(3,"wrong scanline width");const Le=new Uint8Array(4*Fe*Te);Le.length||ie(4,"unable to allocate buffer space");let Ke=0,Ue=0;const rt=4*ke,tt=new Uint8Array(4),at=new Uint8Array(rt);let ze=Te;for(;ze>0&&Ue<_e.byteLength;){Ue+4>_e.byteLength&&ie(1),tt[0]=_e[Ue++],tt[1]=_e[Ue++],tt[2]=_e[Ue++],tt[3]=_e[Ue++],(tt[0]!=2||tt[1]!=2||(tt[2]<<8|tt[3])!=ke)&&ie(3,"bad rgbe scanline format");let qe=0,Pe;for(;qe<rt&&Ue<_e.byteLength;){Pe=_e[Ue++];const $e=Pe>128;if($e&&(Pe-=128),(Pe===0||qe+Pe>rt)&&ie(3,"bad scanline data"),$e){const ut=_e[Ue++];for(let ot=0;ot<Pe;ot++)at[qe++]=ut}else at.set(_e.subarray(Ue,Ue+Pe),qe),qe+=Pe,Ue+=Pe}const Ye=ke;for(let $e=0;$e<Ye;$e++){let ut=0;Le[Ke]=at[$e+ut],ut+=ke,Le[Ke+1]=at[$e+ut],ut+=ke,Le[Ke+2]=at[$e+ut],ut+=ke,Le[Ke+3]=at[$e+ut],Ke+=4}ze--}return Le},fe=function(_e,Fe,Te,ke){const Le=_e[Fe+3],Ke=Math.pow(2,Le-128)/255;Te[ke+0]=_e[Fe+0]*Ke,Te[ke+1]=_e[Fe+1]*Ke,Te[ke+2]=_e[Fe+2]*Ke,Te[ke+3]=1},be=function(_e,Fe,Te,ke){const Le=_e[Fe+3],Ke=Math.pow(2,Le-128)/255;Te[ke+0]=DataUtils.toHalfFloat(Math.min(_e[Fe+0]*Ke,65504)),Te[ke+1]=DataUtils.toHalfFloat(Math.min(_e[Fe+1]*Ke,65504)),Te[ke+2]=DataUtils.toHalfFloat(Math.min(_e[Fe+2]*Ke,65504)),Te[ke+3]=DataUtils.toHalfFloat(1)},Ae=new Uint8Array(Z);Ae.pos=0;const ye=de(Ae),ve=ye.width,Be=ye.height,Re=Ie(Ae.subarray(Ae.pos),ve,Be);let Ve,Ee,Ze;switch(this.type){case FloatType:Ze=Re.length/4;const _e=new Float32Array(Ze*4);for(let Te=0;Te<Ze;Te++)fe(Re,Te*4,_e,Te*4);Ve=_e,Ee=FloatType;break;case HalfFloatType:Ze=Re.length/4;const Fe=new Uint16Array(Ze*4);for(let Te=0;Te<Ze;Te++)be(Re,Te*4,Fe,Te*4);Ve=Fe,Ee=HalfFloatType;break;default:throw new Error("THREE.RGBELoader: Unsupported type: "+this.type)}return{width:ve,height:Be,data:Ve,header:ye.string,gamma:ye.gamma,exposure:ye.exposure,type:Ee}}setDataType(Z){return this.type=Z,this}load(Z,_,K,te){function ne(ie,oe){switch(ie.type){case FloatType:case HalfFloatType:"colorSpace"in ie?ie.colorSpace="srgb-linear":ie.encoding=3e3,ie.minFilter=LinearFilter,ie.magFilter=LinearFilter,ie.generateMipmaps=!1,ie.flipY=!0;break}_&&_(ie,oe)}return super.load(Z,ne,K,te)}}const hasColorSpace=version>=152;class EXRLoader extends DataTextureLoader{constructor(Z){super(Z),this.type=HalfFloatType}parse(Z){const Fe=Math.pow(2.7182818,2.2);function Te(je,st){for(var yt=0,Yt=0;Yt<65536;++Yt)(Yt==0||je[Yt>>3]&1<<(Yt&7))&&(st[yt++]=Yt);for(var jt=yt-1;yt<65536;)st[yt++]=0;return jt}function ke(je){for(var st=0;st<16384;st++)je[st]={},je[st].len=0,je[st].lit=0,je[st].p=null}const Le={l:0,c:0,lc:0};function Ke(je,st,yt,Yt,jt){for(;yt<je;)st=st<<8|tn(Yt,jt),yt+=8;yt-=je,Le.l=st>>yt&(1<<je)-1,Le.c=st,Le.lc=yt}const Ue=new Array(59);function rt(je){for(var st=0;st<=58;++st)Ue[st]=0;for(var st=0;st<65537;++st)Ue[je[st]]+=1;for(var yt=0,st=58;st>0;--st){var Yt=yt+Ue[st]>>1;Ue[st]=yt,yt=Yt}for(var st=0;st<65537;++st){var jt=je[st];jt>0&&(je[st]=jt|Ue[jt]++<<6)}}function tt(je,st,yt,Yt,jt,Jt,fn){for(var pn=yt,Qe=0,pt=0;jt<=Jt;jt++){if(pn.value-yt.value>Yt)return!1;Ke(6,Qe,pt,je,pn);var At=Le.l;if(Qe=Le.c,pt=Le.lc,fn[jt]=At,At==63){if(pn.value-yt.value>Yt)throw"Something wrong with hufUnpackEncTable";Ke(8,Qe,pt,je,pn);var ct=Le.l+6;if(Qe=Le.c,pt=Le.lc,jt+ct>Jt+1)throw"Something wrong with hufUnpackEncTable";for(;ct--;)fn[jt++]=0;jt--}else if(At>=59){var ct=At-59+2;if(jt+ct>Jt+1)throw"Something wrong with hufUnpackEncTable";for(;ct--;)fn[jt++]=0;jt--}}rt(fn)}function at(je){return je&63}function ze(je){return je>>6}function qe(je,st,yt,Yt){for(;st<=yt;st++){var jt=ze(je[st]),Jt=at(je[st]);if(jt>>Jt)throw"Invalid table entry";if(Jt>14){var fn=Yt[jt>>Jt-14];if(fn.len)throw"Invalid table entry";if(fn.lit++,fn.p){var pn=fn.p;fn.p=new Array(fn.lit);for(var Qe=0;Qe<fn.lit-1;++Qe)fn.p[Qe]=pn[Qe]}else fn.p=new Array(1);fn.p[fn.lit-1]=st}else if(Jt)for(var pt=0,Qe=1<<14-Jt;Qe>0;Qe--){var fn=Yt[(jt<<14-Jt)+pt];if(fn.len||fn.p)throw"Invalid table entry";fn.len=Jt,fn.lit=st,pt++}}return!0}const Pe={c:0,lc:0};function Ye(je,st,yt,Yt){je=je<<8|tn(yt,Yt),st+=8,Pe.c=je,Pe.lc=st}const $e={c:0,lc:0};function ut(je,st,yt,Yt,jt,Jt,fn,pn,Qe,pt){if(je==st){Yt<8&&(Ye(yt,Yt,jt,fn),yt=Pe.c,Yt=Pe.lc),Yt-=8;var At=yt>>Yt,At=new Uint8Array([At])[0];if(Qe.value+At>pt)return!1;for(var ct=pn[Qe.value-1];At-- >0;)pn[Qe.value++]=ct}else if(Qe.value<pt)pn[Qe.value++]=je;else return!1;$e.c=yt,$e.lc=Yt}function ot(je){return je&65535}function gt(je){var st=ot(je);return st>32767?st-65536:st}const ht={a:0,b:0};function dt(je,st){var yt=gt(je),Yt=gt(st),jt=Yt,Jt=yt+(jt&1)+(jt>>1),fn=Jt,pn=Jt-jt;ht.a=fn,ht.b=pn}function bt(je,st){var yt=ot(je),Yt=ot(st),jt=yt-(Yt>>1)&65535,Jt=Yt+jt-32768&65535;ht.a=Jt,ht.b=jt}function Ht(je,st,yt,Yt,jt,Jt,fn){for(var pn=fn<16384,Qe=yt>jt?jt:yt,pt=1,At;pt<=Qe;)pt<<=1;for(pt>>=1,At=pt,pt>>=1;pt>=1;){for(var ct=0,Bt=ct+Jt*(jt-At),Xt=Jt*pt,Qt=Jt*At,sn=Yt*pt,cn=Yt*At,Bn,bn,gn,xn;ct<=Bt;ct+=Qt){for(var wn=ct,Jn=ct+Yt*(yt-At);wn<=Jn;wn+=cn){var Wn=wn+sn,Hn=wn+Xt,Zn=Hn+sn;pn?(dt(je[wn+st],je[Hn+st]),Bn=ht.a,gn=ht.b,dt(je[Wn+st],je[Zn+st]),bn=ht.a,xn=ht.b,dt(Bn,bn),je[wn+st]=ht.a,je[Wn+st]=ht.b,dt(gn,xn),je[Hn+st]=ht.a,je[Zn+st]=ht.b):(bt(je[wn+st],je[Hn+st]),Bn=ht.a,gn=ht.b,bt(je[Wn+st],je[Zn+st]),bn=ht.a,xn=ht.b,bt(Bn,bn),je[wn+st]=ht.a,je[Wn+st]=ht.b,bt(gn,xn),je[Hn+st]=ht.a,je[Zn+st]=ht.b)}if(yt&pt){var Hn=wn+Xt;pn?dt(je[wn+st],je[Hn+st]):bt(je[wn+st],je[Hn+st]),Bn=ht.a,je[Hn+st]=ht.b,je[wn+st]=Bn}}if(jt&pt)for(var wn=ct,Jn=ct+Yt*(yt-At);wn<=Jn;wn+=cn){var Wn=wn+sn;pn?dt(je[wn+st],je[Wn+st]):bt(je[wn+st],je[Wn+st]),Bn=ht.a,je[Wn+st]=ht.b,je[wn+st]=Bn}At=pt,pt>>=1}return ct}function Dt(je,st,yt,Yt,jt,Jt,fn,pn,Qe,pt){for(var At=0,ct=0,Bt=pn,Xt=Math.trunc(jt.value+(Jt+7)/8);jt.value<Xt;)for(Ye(At,ct,yt,jt),At=Pe.c,ct=Pe.lc;ct>=14;){var Qt=At>>ct-14&16383,sn=st[Qt];if(sn.len)ct-=sn.len,ut(sn.lit,fn,At,ct,yt,Yt,jt,Qe,pt,Bt),At=$e.c,ct=$e.lc;else{if(!sn.p)throw"hufDecode issues";var cn;for(cn=0;cn<sn.lit;cn++){for(var Bn=at(je[sn.p[cn]]);ct<Bn&&jt.value<Xt;)Ye(At,ct,yt,jt),At=Pe.c,ct=Pe.lc;if(ct>=Bn&&ze(je[sn.p[cn]])==(At>>ct-Bn&(1<<Bn)-1)){ct-=Bn,ut(sn.p[cn],fn,At,ct,yt,Yt,jt,Qe,pt,Bt),At=$e.c,ct=$e.lc;break}}if(cn==sn.lit)throw"hufDecode issues"}}var bn=8-Jt&7;for(At>>=bn,ct-=bn;ct>0;){var sn=st[At<<14-ct&16383];if(sn.len)ct-=sn.len,ut(sn.lit,fn,At,ct,yt,Yt,jt,Qe,pt,Bt),At=$e.c,ct=$e.lc;else throw"hufDecode issues"}return!0}function Vt(je,st,yt,Yt,jt,Jt){var fn={value:0},pn=yt.value,Qe=ln(st,yt),pt=ln(st,yt);yt.value+=4;var At=ln(st,yt);if(yt.value+=4,Qe<0||Qe>=65537||pt<0||pt>=65537)throw"Something wrong with HUF_ENCSIZE";var ct=new Array(65537),Bt=new Array(16384);ke(Bt);var Xt=Yt-(yt.value-pn);if(tt(je,st,yt,Xt,Qe,pt,ct),At>8*(Yt-(yt.value-pn)))throw"Something wrong with hufUncompress";qe(ct,Qe,pt,Bt),Dt(ct,Bt,je,st,yt,At,pt,Jt,jt,fn)}function mt(je,st,yt){for(var Yt=0;Yt<yt;++Yt)st[Yt]=je[st[Yt]]}function Ft(je){for(var st=1;st<je.length;st++){var yt=je[st-1]+je[st]-128;je[st]=yt}}function it(je,st){for(var yt=0,Yt=Math.floor((je.length+1)/2),jt=0,Jt=je.length-1;!(jt>Jt||(st[jt++]=je[yt++],jt>Jt));)st[jt++]=je[Yt++]}function Lt(je){for(var st=je.byteLength,yt=new Array,Yt=0,jt=new DataView(je);st>0;){var Jt=jt.getInt8(Yt++);if(Jt<0){var fn=-Jt;st-=fn+1;for(var pn=0;pn<fn;pn++)yt.push(jt.getUint8(Yt++))}else{var fn=Jt;st-=2;for(var Qe=jt.getUint8(Yt++),pn=0;pn<fn+1;pn++)yt.push(Qe)}}return yt}function Et(je,st,yt,Yt,jt,Jt){var Wn=new DataView(Jt.buffer),fn=yt[je.idx[0]].width,pn=yt[je.idx[0]].height,Qe=3,pt=Math.floor(fn/8),At=Math.ceil(fn/8),ct=Math.ceil(pn/8),Bt=fn-(At-1)*8,Xt=pn-(ct-1)*8,Qt={value:0},sn=new Array(Qe),cn=new Array(Qe),Bn=new Array(Qe),bn=new Array(Qe),gn=new Array(Qe);for(let er=0;er<Qe;++er)gn[er]=st[je.idx[er]],sn[er]=er<1?0:sn[er-1]+At*ct,cn[er]=new Float32Array(64),Bn[er]=new Uint16Array(64),bn[er]=new Uint16Array(At*64);for(let er=0;er<ct;++er){var xn=8;er==ct-1&&(xn=Xt);var wn=8;for(let tr=0;tr<At;++tr){tr==At-1&&(wn=Bt);for(let Qn=0;Qn<Qe;++Qn)Bn[Qn].fill(0),Bn[Qn][0]=jt[sn[Qn]++],Ut(Qt,Yt,Bn[Qn]),Zt(Bn[Qn],cn[Qn]),Ot(cn[Qn]);Tt(cn);for(let Qn=0;Qn<Qe;++Qn)Je(cn[Qn],bn[Qn],tr*64)}let Ar=0;for(let tr=0;tr<Qe;++tr){const Qn=yt[je.idx[tr]].type;for(let On=8*er;On<8*er+xn;++On){Ar=gn[tr][On];for(let br=0;br<pt;++br){const ur=br*64+(On&7)*8;Wn.setUint16(Ar+0*2*Qn,bn[tr][ur+0],!0),Wn.setUint16(Ar+1*2*Qn,bn[tr][ur+1],!0),Wn.setUint16(Ar+2*2*Qn,bn[tr][ur+2],!0),Wn.setUint16(Ar+3*2*Qn,bn[tr][ur+3],!0),Wn.setUint16(Ar+4*2*Qn,bn[tr][ur+4],!0),Wn.setUint16(Ar+5*2*Qn,bn[tr][ur+5],!0),Wn.setUint16(Ar+6*2*Qn,bn[tr][ur+6],!0),Wn.setUint16(Ar+7*2*Qn,bn[tr][ur+7],!0),Ar+=8*2*Qn}}if(pt!=At)for(let On=8*er;On<8*er+xn;++On){const br=gn[tr][On]+8*pt*2*Qn,ur=pt*64+(On&7)*8;for(let yr=0;yr<wn;++yr)Wn.setUint16(br+yr*2*Qn,bn[tr][ur+yr],!0)}}}for(var Jn=new Uint16Array(fn),Wn=new DataView(Jt.buffer),Hn=0;Hn<Qe;++Hn){yt[je.idx[Hn]].decoded=!0;var Zn=yt[je.idx[Hn]].type;if(yt[Hn].type==2)for(var nr=0;nr<pn;++nr){const er=gn[Hn][nr];for(var Kn=0;Kn<fn;++Kn)Jn[Kn]=Wn.getUint16(er+Kn*2*Zn,!0);for(var Kn=0;Kn<fn;++Kn)Wn.setFloat32(er+Kn*2*Zn,wt(Jn[Kn]),!0)}}}function Ut(je,st,yt){for(var Yt,jt=1;jt<64;)Yt=st[je.value],Yt==65280?jt=64:Yt>>8==255?jt+=Yt&255:(yt[jt]=Yt,jt++),je.value++}function Zt(je,st){st[0]=wt(je[0]),st[1]=wt(je[1]),st[2]=wt(je[5]),st[3]=wt(je[6]),st[4]=wt(je[14]),st[5]=wt(je[15]),st[6]=wt(je[27]),st[7]=wt(je[28]),st[8]=wt(je[2]),st[9]=wt(je[4]),st[10]=wt(je[7]),st[11]=wt(je[13]),st[12]=wt(je[16]),st[13]=wt(je[26]),st[14]=wt(je[29]),st[15]=wt(je[42]),st[16]=wt(je[3]),st[17]=wt(je[8]),st[18]=wt(je[12]),st[19]=wt(je[17]),st[20]=wt(je[25]),st[21]=wt(je[30]),st[22]=wt(je[41]),st[23]=wt(je[43]),st[24]=wt(je[9]),st[25]=wt(je[11]),st[26]=wt(je[18]),st[27]=wt(je[24]),st[28]=wt(je[31]),st[29]=wt(je[40]),st[30]=wt(je[44]),st[31]=wt(je[53]),st[32]=wt(je[10]),st[33]=wt(je[19]),st[34]=wt(je[23]),st[35]=wt(je[32]),st[36]=wt(je[39]),st[37]=wt(je[45]),st[38]=wt(je[52]),st[39]=wt(je[54]),st[40]=wt(je[20]),st[41]=wt(je[22]),st[42]=wt(je[33]),st[43]=wt(je[38]),st[44]=wt(je[46]),st[45]=wt(je[51]),st[46]=wt(je[55]),st[47]=wt(je[60]),st[48]=wt(je[21]),st[49]=wt(je[34]),st[50]=wt(je[37]),st[51]=wt(je[47]),st[52]=wt(je[50]),st[53]=wt(je[56]),st[54]=wt(je[59]),st[55]=wt(je[61]),st[56]=wt(je[35]),st[57]=wt(je[36]),st[58]=wt(je[48]),st[59]=wt(je[49]),st[60]=wt(je[57]),st[61]=wt(je[58]),st[62]=wt(je[62]),st[63]=wt(je[63])}function Ot(je){const st=.5*Math.cos(.7853975),yt=.5*Math.cos(3.14159/16),Yt=.5*Math.cos(3.14159/8),jt=.5*Math.cos(3*3.14159/16),Jt=.5*Math.cos(5*3.14159/16),fn=.5*Math.cos(3*3.14159/8),pn=.5*Math.cos(7*3.14159/16);for(var Qe=new Array(4),pt=new Array(4),At=new Array(4),ct=new Array(4),Bt=0;Bt<8;++Bt){var Xt=Bt*8;Qe[0]=Yt*je[Xt+2],Qe[1]=fn*je[Xt+2],Qe[2]=Yt*je[Xt+6],Qe[3]=fn*je[Xt+6],pt[0]=yt*je[Xt+1]+jt*je[Xt+3]+Jt*je[Xt+5]+pn*je[Xt+7],pt[1]=jt*je[Xt+1]-pn*je[Xt+3]-yt*je[Xt+5]-Jt*je[Xt+7],pt[2]=Jt*je[Xt+1]-yt*je[Xt+3]+pn*je[Xt+5]+jt*je[Xt+7],pt[3]=pn*je[Xt+1]-Jt*je[Xt+3]+jt*je[Xt+5]-yt*je[Xt+7],At[0]=st*(je[Xt+0]+je[Xt+4]),At[3]=st*(je[Xt+0]-je[Xt+4]),At[1]=Qe[0]+Qe[3],At[2]=Qe[1]-Qe[2],ct[0]=At[0]+At[1],ct[1]=At[3]+At[2],ct[2]=At[3]-At[2],ct[3]=At[0]-At[1],je[Xt+0]=ct[0]+pt[0],je[Xt+1]=ct[1]+pt[1],je[Xt+2]=ct[2]+pt[2],je[Xt+3]=ct[3]+pt[3],je[Xt+4]=ct[3]-pt[3],je[Xt+5]=ct[2]-pt[2],je[Xt+6]=ct[1]-pt[1],je[Xt+7]=ct[0]-pt[0]}for(var Qt=0;Qt<8;++Qt)Qe[0]=Yt*je[16+Qt],Qe[1]=fn*je[16+Qt],Qe[2]=Yt*je[48+Qt],Qe[3]=fn*je[48+Qt],pt[0]=yt*je[8+Qt]+jt*je[24+Qt]+Jt*je[40+Qt]+pn*je[56+Qt],pt[1]=jt*je[8+Qt]-pn*je[24+Qt]-yt*je[40+Qt]-Jt*je[56+Qt],pt[2]=Jt*je[8+Qt]-yt*je[24+Qt]+pn*je[40+Qt]+jt*je[56+Qt],pt[3]=pn*je[8+Qt]-Jt*je[24+Qt]+jt*je[40+Qt]-yt*je[56+Qt],At[0]=st*(je[Qt]+je[32+Qt]),At[3]=st*(je[Qt]-je[32+Qt]),At[1]=Qe[0]+Qe[3],At[2]=Qe[1]-Qe[2],ct[0]=At[0]+At[1],ct[1]=At[3]+At[2],ct[2]=At[3]-At[2],ct[3]=At[0]-At[1],je[0+Qt]=ct[0]+pt[0],je[8+Qt]=ct[1]+pt[1],je[16+Qt]=ct[2]+pt[2],je[24+Qt]=ct[3]+pt[3],je[32+Qt]=ct[3]-pt[3],je[40+Qt]=ct[2]-pt[2],je[48+Qt]=ct[1]-pt[1],je[56+Qt]=ct[0]-pt[0]}function Tt(je){for(var st=0;st<64;++st){var yt=je[0][st],Yt=je[1][st],jt=je[2][st];je[0][st]=yt+1.5747*jt,je[1][st]=yt-.1873*Yt-.4682*jt,je[2][st]=yt+1.8556*Yt}}function Je(je,st,yt){for(var Yt=0;Yt<64;++Yt)st[yt+Yt]=DataUtils.toHalfFloat(Oe(je[Yt]))}function Oe(je){return je<=1?Math.sign(je)*Math.pow(Math.abs(je),2.2):Math.sign(je)*Math.pow(Fe,Math.abs(je)-1)}function lt(je){return new DataView(je.array.buffer,je.offset.value,je.size)}function ft(je){var st=je.viewer.buffer.slice(je.offset.value,je.offset.value+je.size),yt=new Uint8Array(Lt(st)),Yt=new Uint8Array(yt.length);return Ft(yt),it(yt,Yt),new DataView(Yt.buffer)}function St(je){var st=je.array.slice(je.offset.value,je.offset.value+je.size),yt=unzlibSync(st),Yt=new Uint8Array(yt.length);return Ft(yt),it(yt,Yt),new DataView(Yt.buffer)}function Wt(je){for(var st=je.viewer,yt={value:je.offset.value},Yt=new Uint16Array(je.width*je.scanlineBlockSize*(je.channels*je.type)),jt=new Uint8Array(8192),Jt=0,fn=new Array(je.channels),pn=0;pn<je.channels;pn++)fn[pn]={},fn[pn].start=Jt,fn[pn].end=fn[pn].start,fn[pn].nx=je.width,fn[pn].ny=je.lines,fn[pn].size=je.type,Jt+=fn[pn].nx*fn[pn].ny*fn[pn].size;var Qe=Mt(st,yt),pt=Mt(st,yt);if(pt>=8192)throw"Something is wrong with PIZ_COMPRESSION BITMAP_SIZE";if(Qe<=pt)for(var pn=0;pn<pt-Qe+1;pn++)jt[pn+Qe]=Sn(st,yt);var At=new Uint16Array(65536),ct=Te(jt,At),Bt=ln(st,yt);Vt(je.array,st,yt,Bt,Yt,Jt);for(var pn=0;pn<je.channels;++pn)for(var Xt=fn[pn],Qt=0;Qt<fn[pn].size;++Qt)Ht(Yt,Xt.start+Qt,Xt.nx,Xt.size,Xt.ny,Xt.nx*Xt.size,ct);mt(At,Yt,Jt);for(var sn=0,cn=new Uint8Array(Yt.buffer.byteLength),Bn=0;Bn<je.lines;Bn++)for(var bn=0;bn<je.channels;bn++){var Xt=fn[bn],gn=Xt.nx*Xt.size,xn=new Uint8Array(Yt.buffer,Xt.end*2,gn*2);cn.set(xn,sn),sn+=gn*2,Xt.end+=gn}return new DataView(cn.buffer)}function zt(je){var st=je.array.slice(je.offset.value,je.offset.value+je.size),yt=unzlibSync(st);const Yt=je.lines*je.channels*je.width,jt=je.type==1?new Uint16Array(Yt):new Uint32Array(Yt);let Jt=0,fn=0;const pn=new Array(4);for(let Qe=0;Qe<je.lines;Qe++)for(let pt=0;pt<je.channels;pt++){let At=0;switch(je.type){case 1:pn[0]=Jt,pn[1]=pn[0]+je.width,Jt=pn[1]+je.width;for(let ct=0;ct<je.width;++ct){const Bt=yt[pn[0]++]<<8|yt[pn[1]++];At+=Bt,jt[fn]=At,fn++}break;case 2:pn[0]=Jt,pn[1]=pn[0]+je.width,pn[2]=pn[1]+je.width,Jt=pn[2]+je.width;for(let ct=0;ct<je.width;++ct){const Bt=yt[pn[0]++]<<24|yt[pn[1]++]<<16|yt[pn[2]++]<<8;At+=Bt,jt[fn]=At,fn++}break}}return new DataView(jt.buffer)}function $t(je){var st=je.viewer,yt={value:je.offset.value},Yt=new Uint8Array(je.width*je.lines*(je.channels*je.type*2)),jt={version:yn(st,yt),unknownUncompressedSize:yn(st,yt),unknownCompressedSize:yn(st,yt),acCompressedSize:yn(st,yt),dcCompressedSize:yn(st,yt),rleCompressedSize:yn(st,yt),rleUncompressedSize:yn(st,yt),rleRawSize:yn(st,yt),totalAcUncompressedCount:yn(st,yt),totalDcUncompressedCount:yn(st,yt),acCompression:yn(st,yt)};if(jt.version<2)throw"EXRLoader.parse: "+_r.compression+" version "+jt.version+" is unsupported";for(var Jt=new Array,fn=Mt(st,yt)-2;fn>0;){var pn=rn(st.buffer,yt),Qe=Sn(st,yt),pt=Qe>>2&3,At=(Qe>>4)-1,ct=new Int8Array([At])[0],Bt=Sn(st,yt);Jt.push({name:pn,index:ct,type:Bt,compression:pt}),fn-=pn.length+3}for(var Xt=_r.channels,Qt=new Array(je.channels),sn=0;sn<je.channels;++sn){var cn=Qt[sn]={},Bn=Xt[sn];cn.name=Bn.name,cn.compression=0,cn.decoded=!1,cn.type=Bn.pixelType,cn.pLinear=Bn.pLinear,cn.width=je.width,cn.height=je.lines}for(var bn={idx:new Array(3)},gn=0;gn<je.channels;++gn)for(var cn=Qt[gn],sn=0;sn<Jt.length;++sn){var xn=Jt[sn];cn.name==xn.name&&(cn.compression=xn.compression,xn.index>=0&&(bn.idx[xn.index]=gn),cn.offset=gn)}if(jt.acCompressedSize>0)switch(jt.acCompression){case 0:var Wn=new Uint16Array(jt.totalAcUncompressedCount);Vt(je.array,st,yt,jt.acCompressedSize,Wn,jt.totalAcUncompressedCount);break;case 1:var wn=je.array.slice(yt.value,yt.value+jt.totalAcUncompressedCount),Jn=unzlibSync(wn),Wn=new Uint16Array(Jn.buffer);yt.value+=jt.totalAcUncompressedCount;break}if(jt.dcCompressedSize>0){var Hn={array:je.array,offset:yt,size:jt.dcCompressedSize},Zn=new Uint16Array(St(Hn).buffer);yt.value+=jt.dcCompressedSize}if(jt.rleRawSize>0){var wn=je.array.slice(yt.value,yt.value+jt.rleCompressedSize),Jn=unzlibSync(wn),nr=Lt(Jn.buffer);yt.value+=jt.rleCompressedSize}for(var Kn=0,er=new Array(Qt.length),sn=0;sn<er.length;++sn)er[sn]=new Array;for(var Ar=0;Ar<je.lines;++Ar)for(var tr=0;tr<Qt.length;++tr)er[tr].push(Kn),Kn+=Qt[tr].width*je.type*2;Et(bn,er,Qt,Wn,Zn,Yt);for(var sn=0;sn<Qt.length;++sn){var cn=Qt[sn];if(!cn.decoded)switch(cn.compression){case 2:for(var Qn=0,On=0,Ar=0;Ar<je.lines;++Ar){for(var br=er[sn][Qn],ur=0;ur<cn.width;++ur){for(var yr=0;yr<2*cn.type;++yr)Yt[br++]=nr[On+yr*cn.width*cn.height];On++}Qn++}break;case 1:default:throw"EXRLoader.parse: unsupported channel compression"}}return new DataView(Yt.buffer)}function rn(je,st){for(var yt=new Uint8Array(je),Yt=0;yt[st.value+Yt]!=0;)Yt+=1;var jt=new TextDecoder().decode(yt.slice(st.value,st.value+Yt));return st.value=st.value+Yt+1,jt}function Gn(je,st,yt){var Yt=new TextDecoder().decode(new Uint8Array(je).slice(st.value,st.value+yt));return st.value=st.value+yt,Yt}function en(je,st){var yt=un(je,st),Yt=ln(je,st);return[yt,Yt]}function In(je,st){var yt=ln(je,st),Yt=ln(je,st);return[yt,Yt]}function un(je,st){var yt=je.getInt32(st.value,!0);return st.value=st.value+4,yt}function ln(je,st){var yt=je.getUint32(st.value,!0);return st.value=st.value+4,yt}function tn(je,st){var yt=je[st.value];return st.value=st.value+1,yt}function Sn(je,st){var yt=je.getUint8(st.value);return st.value=st.value+1,yt}const yn=function(je,st){let yt;return"getBigInt64"in DataView.prototype?yt=Number(je.getBigInt64(st.value,!0)):yt=je.getUint32(st.value+4,!0)+Number(je.getUint32(st.value,!0)<<32),st.value+=8,yt};function Tn(je,st){var yt=je.getFloat32(st.value,!0);return st.value+=4,yt}function vt(je,st){return DataUtils.toHalfFloat(Tn(je,st))}function wt(je){var st=(je&31744)>>10,yt=je&1023;return(je>>15?-1:1)*(st?st===31?yt?NaN:1/0:Math.pow(2,st-15)*(1+yt/1024):6103515625e-14*(yt/1024))}function Mt(je,st){var yt=je.getUint16(st.value,!0);return st.value+=2,yt}function on(je,st){return wt(Mt(je,st))}function dn(je,st,yt,Yt){for(var jt=yt.value,Jt=[];yt.value<jt+Yt-1;){var fn=rn(st,yt),pn=un(je,yt),Qe=Sn(je,yt);yt.value+=3;var pt=un(je,yt),At=un(je,yt);Jt.push({name:fn,pixelType:pn,pLinear:Qe,xSampling:pt,ySampling:At})}return yt.value+=1,Jt}function an(je,st){var yt=Tn(je,st),Yt=Tn(je,st),jt=Tn(je,st),Jt=Tn(je,st),fn=Tn(je,st),pn=Tn(je,st),Qe=Tn(je,st),pt=Tn(je,st);return{redX:yt,redY:Yt,greenX:jt,greenY:Jt,blueX:fn,blueY:pn,whiteX:Qe,whiteY:pt}}function Mn(je,st){var yt=["NO_COMPRESSION","RLE_COMPRESSION","ZIPS_COMPRESSION","ZIP_COMPRESSION","PIZ_COMPRESSION","PXR24_COMPRESSION","B44_COMPRESSION","B44A_COMPRESSION","DWAA_COMPRESSION","DWAB_COMPRESSION"],Yt=Sn(je,st);return yt[Yt]}function Pn(je,st){var yt=ln(je,st),Yt=ln(je,st),jt=ln(je,st),Jt=ln(je,st);return{xMin:yt,yMin:Yt,xMax:jt,yMax:Jt}}function Nn(je,st){var yt=["INCREASING_Y"],Yt=Sn(je,st);return yt[Yt]}function kn(je,st){var yt=Tn(je,st),Yt=Tn(je,st);return[yt,Yt]}function Ir(je,st){var yt=Tn(je,st),Yt=Tn(je,st),jt=Tn(je,st);return[yt,Yt,jt]}function dr(je,st,yt,Yt,jt){if(Yt==="string"||Yt==="stringvector"||Yt==="iccProfile")return Gn(st,yt,jt);if(Yt==="chlist")return dn(je,st,yt,jt);if(Yt==="chromaticities")return an(je,yt);if(Yt==="compression")return Mn(je,yt);if(Yt==="box2i")return Pn(je,yt);if(Yt==="lineOrder")return Nn(je,yt);if(Yt==="float")return Tn(je,yt);if(Yt==="v2f")return kn(je,yt);if(Yt==="v3f")return Ir(je,yt);if(Yt==="int")return un(je,yt);if(Yt==="rational")return en(je,yt);if(Yt==="timecode")return In(je,yt);if(Yt==="preview")return yt.value+=jt,"skipped";yt.value+=jt}function vr(je,st,yt){const Yt={};if(je.getUint32(0,!0)!=20000630)throw"THREE.EXRLoader: provided file doesn't appear to be in OpenEXR format.";Yt.version=je.getUint8(4);const jt=je.getUint8(5);Yt.spec={singleTile:!!(jt&2),longName:!!(jt&4),deepFormat:!!(jt&8),multiPart:!!(jt&16)},yt.value=8;for(var Jt=!0;Jt;){var fn=rn(st,yt);if(fn==0)Jt=!1;else{var pn=rn(st,yt),Qe=ln(je,yt),pt=dr(je,st,yt,pn,Qe);pt===void 0?console.warn(`EXRLoader.parse: skipped unknown header attribute type '${pn}'.`):Yt[fn]=pt}}if(jt&-5)throw console.error("EXRHeader:",Yt),"THREE.EXRLoader: provided file is currently unsupported.";return Yt}function Yr(je,st,yt,Yt,jt){const Jt={size:0,viewer:st,array:yt,offset:Yt,width:je.dataWindow.xMax-je.dataWindow.xMin+1,height:je.dataWindow.yMax-je.dataWindow.yMin+1,channels:je.channels.length,bytesPerLine:null,lines:null,inputSize:null,type:je.channels[0].pixelType,uncompress:null,getter:null,format:null,[hasColorSpace?"colorSpace":"encoding"]:null};switch(je.compression){case"NO_COMPRESSION":Jt.lines=1,Jt.uncompress=lt;break;case"RLE_COMPRESSION":Jt.lines=1,Jt.uncompress=ft;break;case"ZIPS_COMPRESSION":Jt.lines=1,Jt.uncompress=St;break;case"ZIP_COMPRESSION":Jt.lines=16,Jt.uncompress=St;break;case"PIZ_COMPRESSION":Jt.lines=32,Jt.uncompress=Wt;break;case"PXR24_COMPRESSION":Jt.lines=16,Jt.uncompress=zt;break;case"DWAA_COMPRESSION":Jt.lines=32,Jt.uncompress=$t;break;case"DWAB_COMPRESSION":Jt.lines=256,Jt.uncompress=$t;break;default:throw"EXRLoader.parse: "+je.compression+" is unsupported"}if(Jt.scanlineBlockSize=Jt.lines,Jt.type==1)switch(jt){case FloatType:Jt.getter=on,Jt.inputSize=2;break;case HalfFloatType:Jt.getter=Mt,Jt.inputSize=2;break}else if(Jt.type==2)switch(jt){case FloatType:Jt.getter=Tn,Jt.inputSize=4;break;case HalfFloatType:Jt.getter=vt,Jt.inputSize=4}else throw"EXRLoader.parse: unsupported pixelType "+Jt.type+" for "+je.compression+".";Jt.blockCount=(je.dataWindow.yMax+1)/Jt.scanlineBlockSize;for(var fn=0;fn<Jt.blockCount;fn++)yn(st,Yt);Jt.outputChannels=Jt.channels==3?4:Jt.channels;const pn=Jt.width*Jt.height*Jt.outputChannels;switch(jt){case FloatType:Jt.byteArray=new Float32Array(pn),Jt.channels<Jt.outputChannels&&Jt.byteArray.fill(1,0,pn);break;case HalfFloatType:Jt.byteArray=new Uint16Array(pn),Jt.channels<Jt.outputChannels&&Jt.byteArray.fill(15360,0,pn);break;default:console.error("THREE.EXRLoader: unsupported type: ",jt);break}return Jt.bytesPerLine=Jt.width*Jt.inputSize*Jt.channels,Jt.outputChannels==4?Jt.format=RGBAFormat:Jt.format=RedFormat,hasColorSpace?Jt.colorSpace="srgb-linear":Jt.encoding=3e3,Jt}const Fr=new DataView(Z),Nr=new Uint8Array(Z),Kr={value:0},_r=vr(Fr,Z,Kr),Un=Yr(_r,Fr,Nr,Kr,this.type),Lr={value:0},Bi={R:0,G:1,B:2,A:3,Y:0};for(let je=0;je<Un.height/Un.scanlineBlockSize;je++){const st=ln(Fr,Kr);Un.size=ln(Fr,Kr),Un.lines=st+Un.scanlineBlockSize>Un.height?Un.height-st:Un.scanlineBlockSize;const Yt=Un.size<Un.lines*Un.bytesPerLine?Un.uncompress(Un):lt(Un);Kr.value+=Un.size;for(let jt=0;jt<Un.scanlineBlockSize;jt++){const Jt=jt+je*Un.scanlineBlockSize;if(Jt>=Un.height)break;for(let fn=0;fn<Un.channels;fn++){const pn=Bi[_r.channels[fn].name];for(let Qe=0;Qe<Un.width;Qe++){Lr.value=(jt*(Un.channels*Un.width)+fn*Un.width+Qe)*Un.inputSize;const pt=(Un.height-1-Jt)*(Un.width*Un.outputChannels)+Qe*Un.outputChannels+pn;Un.byteArray[pt]=Un.getter(Yt,Lr)}}}}return{header:_r,width:Un.width,height:Un.height,data:Un.byteArray,format:Un.format,[hasColorSpace?"colorSpace":"encoding"]:Un[hasColorSpace?"colorSpace":"encoding"],type:this.type}}setDataType(Z){return this.type=Z,this}load(Z,_,K,te){function ne(ie,oe){hasColorSpace?ie.colorSpace=oe.colorSpace:ie.encoding=oe.encoding,ie.minFilter=LinearFilter,ie.magFilter=LinearFilter,ie.generateMipmaps=!1,ie.flipY=!1,_&&_(ie,oe)}return super.load(Z,ne,K,te)}}const _taskCache=new WeakMap;class DRACOLoader extends Loader{constructor(Z){super(Z),this.decoderPath="",this.decoderConfig={},this.decoderBinary=null,this.decoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},this.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"}}setDecoderPath(Z){return this.decoderPath=Z,this}setDecoderConfig(Z){return this.decoderConfig=Z,this}setWorkerLimit(Z){return this.workerLimit=Z,this}load(Z,_,K,te){const ne=new FileLoader(this.manager);ne.setPath(this.path),ne.setResponseType("arraybuffer"),ne.setRequestHeader(this.requestHeader),ne.setWithCredentials(this.withCredentials),ne.load(Z,ie=>{const oe={attributeIDs:this.defaultAttributeIDs,attributeTypes:this.defaultAttributeTypes,useUniqueIDs:!1};this.decodeGeometry(ie,oe).then(_).catch(te)},K,te)}decodeDracoFile(Z,_,K,te){const ne={attributeIDs:K||this.defaultAttributeIDs,attributeTypes:te||this.defaultAttributeTypes,useUniqueIDs:!!K};this.decodeGeometry(Z,ne).then(_)}decodeGeometry(Z,_){for(const se in _.attributeTypes){const ae=_.attributeTypes[se];ae.BYTES_PER_ELEMENT!==void 0&&(_.attributeTypes[se]=ae.name)}const K=JSON.stringify(_);if(_taskCache.has(Z)){const se=_taskCache.get(Z);if(se.key===K)return se.promise;if(Z.byteLength===0)throw new Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}let te;const ne=this.workerNextTaskID++,ie=Z.byteLength,oe=this._getWorker(ne,ie).then(se=>(te=se,new Promise((ae,ge)=>{te._callbacks[ne]={resolve:ae,reject:ge},te.postMessage({type:"decode",id:ne,taskConfig:_,buffer:Z},[Z])}))).then(se=>this._createGeometry(se.geometry));return oe.catch(()=>!0).then(()=>{te&&ne&&this._releaseTask(te,ne)}),_taskCache.set(Z,{key:K,promise:oe}),oe}_createGeometry(Z){const _=new BufferGeometry;Z.index&&_.setIndex(new BufferAttribute(Z.index.array,1));for(let K=0;K<Z.attributes.length;K++){const te=Z.attributes[K],ne=te.name,ie=te.array,oe=te.itemSize;_.setAttribute(ne,new BufferAttribute(ie,oe))}return _}_loadLibrary(Z,_){const K=new FileLoader(this.manager);return K.setPath(this.decoderPath),K.setResponseType(_),K.setWithCredentials(this.withCredentials),new Promise((te,ne)=>{K.load(Z,te,void 0,ne)})}preload(){return this._initDecoder(),this}_initDecoder(){if(this.decoderPending)return this.decoderPending;const Z=typeof WebAssembly!="object"||this.decoderConfig.type==="js",_=[];return Z?_.push(this._loadLibrary("draco_decoder.js","text")):(_.push(this._loadLibrary("draco_wasm_wrapper.js","text")),_.push(this._loadLibrary("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(_).then(K=>{const te=K[0];Z||(this.decoderConfig.wasmBinary=K[1]);const ne=DRACOWorker.toString(),ie=["/* draco decoder */",te,"","/* worker */",ne.substring(ne.indexOf("{")+1,ne.lastIndexOf("}"))].join(`
`);this.workerSourceURL=URL.createObjectURL(new Blob([ie]))}),this.decoderPending}_getWorker(Z,_){return this._initDecoder().then(()=>{if(this.workerPool.length<this.workerLimit){const te=new Worker(this.workerSourceURL);te._callbacks={},te._taskCosts={},te._taskLoad=0,te.postMessage({type:"init",decoderConfig:this.decoderConfig}),te.onmessage=function(ne){const ie=ne.data;switch(ie.type){case"decode":te._callbacks[ie.id].resolve(ie);break;case"error":te._callbacks[ie.id].reject(ie);break;default:console.error('THREE.DRACOLoader: Unexpected message, "'+ie.type+'"')}},this.workerPool.push(te)}else this.workerPool.sort(function(te,ne){return te._taskLoad>ne._taskLoad?-1:1});const K=this.workerPool[this.workerPool.length-1];return K._taskCosts[Z]=_,K._taskLoad+=_,K})}_releaseTask(Z,_){Z._taskLoad-=Z._taskCosts[_],delete Z._callbacks[_],delete Z._taskCosts[_]}debug(){console.log("Task load: ",this.workerPool.map(Z=>Z._taskLoad))}dispose(){for(let Z=0;Z<this.workerPool.length;++Z)this.workerPool[Z].terminate();return this.workerPool.length=0,this}}function DRACOWorker(){let X,Z;onmessage=function(ie){const oe=ie.data;switch(oe.type){case"init":X=oe.decoderConfig,Z=new Promise(function(ge){X.onModuleLoaded=function(ce){ge({draco:ce})},DracoDecoderModule(X)});break;case"decode":const se=oe.buffer,ae=oe.taskConfig;Z.then(ge=>{const ce=ge.draco,de=new ce.Decoder,Ie=new ce.DecoderBuffer;Ie.Init(new Int8Array(se),se.byteLength);try{const fe=_(ce,de,Ie,ae),be=fe.attributes.map(Ae=>Ae.array.buffer);fe.index&&be.push(fe.index.array.buffer),self.postMessage({type:"decode",id:oe.id,geometry:fe},be)}catch(fe){console.error(fe),self.postMessage({type:"error",id:oe.id,error:fe.message})}finally{ce.destroy(Ie),ce.destroy(de)}});break}};function _(ie,oe,se,ae){const ge=ae.attributeIDs,ce=ae.attributeTypes;let de,Ie;const fe=oe.GetEncodedGeometryType(se);if(fe===ie.TRIANGULAR_MESH)de=new ie.Mesh,Ie=oe.DecodeBufferToMesh(se,de);else if(fe===ie.POINT_CLOUD)de=new ie.PointCloud,Ie=oe.DecodeBufferToPointCloud(se,de);else throw new Error("THREE.DRACOLoader: Unexpected geometry type.");if(!Ie.ok()||de.ptr===0)throw new Error("THREE.DRACOLoader: Decoding failed: "+Ie.error_msg());const be={index:null,attributes:[]};for(const Ae in ge){const ye=self[ce[Ae]];let ve,Be;if(ae.useUniqueIDs)Be=ge[Ae],ve=oe.GetAttributeByUniqueId(de,Be);else{if(Be=oe.GetAttributeId(de,ie[ge[Ae]]),Be===-1)continue;ve=oe.GetAttribute(de,Be)}be.attributes.push(te(ie,oe,de,Ae,ye,ve))}return fe===ie.TRIANGULAR_MESH&&(be.index=K(ie,oe,de)),ie.destroy(de),be}function K(ie,oe,se){const ge=se.num_faces()*3,ce=ge*4,de=ie._malloc(ce);oe.GetTrianglesUInt32Array(se,ce,de);const Ie=new Uint32Array(ie.HEAPF32.buffer,de,ge).slice();return ie._free(de),{array:Ie,itemSize:1}}function te(ie,oe,se,ae,ge,ce){const de=ce.num_components(),fe=se.num_points()*de,be=fe*ge.BYTES_PER_ELEMENT,Ae=ne(ie,ge),ye=ie._malloc(be);oe.GetAttributeDataArrayForAllPoints(se,ce,Ae,be,ye);const ve=new ge(ie.HEAPF32.buffer,ye,fe).slice();return ie._free(ye),{name:ae,array:ve,itemSize:de}}function ne(ie,oe){switch(oe){case Float32Array:return ie.DT_FLOAT32;case Int8Array:return ie.DT_INT8;case Int16Array:return ie.DT_INT16;case Int32Array:return ie.DT_INT32;case Uint8Array:return ie.DT_UINT8;case Uint16Array:return ie.DT_UINT16;case Uint32Array:return ie.DT_UINT32}}}let generated;const MeshoptDecoder=()=>{if(generated)return generated;const X="B9h9z9tFBBBF8fL9gBB9gLaaaaaFa9gEaaaB9gFaFa9gEaaaFaEMcBFFFGGGEIIILF9wFFFLEFBFKNFaFCx/IFMO/LFVK9tv9t9vq95GBt9f9f939h9z9t9f9j9h9s9s9f9jW9vq9zBBp9tv9z9o9v9wW9f9kv9j9v9kv9WvqWv94h919m9mvqBF8Z9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv94h919m9mvqBGy9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv949TvZ91v9u9jvBEn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9P9jWBIi9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9R919hWBLn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9F949wBKI9z9iqlBOc+x8ycGBM/qQFTa8jUUUUBCU/EBlHL8kUUUUBC9+RKGXAGCFJAI9LQBCaRKAE2BBC+gF9HQBALAEAIJHOAGlAGTkUUUBRNCUoBAG9uC/wgBZHKCUGAKCUG9JyRVAECFJRICBRcGXEXAcAF9PQFAVAFAclAcAVJAF9JyRMGXGXAG9FQBAMCbJHKC9wZRSAKCIrCEJCGrRQANCUGJRfCBRbAIRTEXGXAOATlAQ9PQBCBRISEMATAQJRIGXAS9FQBCBRtCBREEXGXAOAIlCi9PQBCBRISLMANCU/CBJAEJRKGXGXGXGXGXATAECKrJ2BBAtCKZrCEZfIBFGEBMAKhB83EBAKCNJhB83EBSEMAKAI2BIAI2BBHmCKrHYAYCE6HYy86BBAKCFJAICIJAYJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCGJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCEJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCIJAYAmJHY2BBAI2BFHmCKrHPAPCE6HPy86BBAKCLJAYAPJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCKJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCOJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCNJAYAmJHY2BBAI2BGHmCKrHPAPCE6HPy86BBAKCVJAYAPJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCcJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCMJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCSJAYAmJHm2BBAI2BEHICKrHYAYCE6HYy86BBAKCQJAmAYJHm2BBAICIrCEZHYAYCE6HYy86BBAKCfJAmAYJHm2BBAICGrCEZHYAYCE6HYy86BBAKCbJAmAYJHK2BBAICEZHIAICE6HIy86BBAKAIJRISGMAKAI2BNAI2BBHmCIrHYAYCb6HYy86BBAKCFJAICNJAYJHY2BBAmCbZHmAmCb6Hmy86BBAKCGJAYAmJHm2BBAI2BFHYCIrHPAPCb6HPy86BBAKCEJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCIJAmAYJHm2BBAI2BGHYCIrHPAPCb6HPy86BBAKCLJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCKJAmAYJHm2BBAI2BEHYCIrHPAPCb6HPy86BBAKCOJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCNJAmAYJHm2BBAI2BIHYCIrHPAPCb6HPy86BBAKCVJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCcJAmAYJHm2BBAI2BLHYCIrHPAPCb6HPy86BBAKCMJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCSJAmAYJHm2BBAI2BKHYCIrHPAPCb6HPy86BBAKCQJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCfJAmAYJHm2BBAI2BOHICIrHYAYCb6HYy86BBAKCbJAmAYJHK2BBAICbZHIAICb6HIy86BBAKAIJRISFMAKAI8pBB83BBAKCNJAICNJ8pBB83BBAICTJRIMAtCGJRtAECTJHEAS9JQBMMGXAIQBCBRISEMGXAM9FQBANAbJ2BBRtCBRKAfREEXAEANCU/CBJAKJ2BBHTCFrCBATCFZl9zAtJHt86BBAEAGJREAKCFJHKAM9HQBMMAfCFJRfAIRTAbCFJHbAG9HQBMMABAcAG9sJANCUGJAMAG9sTkUUUBpANANCUGJAMCaJAG9sJAGTkUUUBpMAMCBAIyAcJRcAIQBMC9+RKSFMCBC99AOAIlAGCAAGCA9Ly6yRKMALCU/EBJ8kUUUUBAKM+OmFTa8jUUUUBCoFlHL8kUUUUBC9+RKGXAFCE9uHOCtJAI9LQBCaRKAE2BBHNC/wFZC/gF9HQBANCbZHVCF9LQBALCoBJCgFCUFT+JUUUBpALC84Jha83EBALC8wJha83EBALC8oJha83EBALCAJha83EBALCiJha83EBALCTJha83EBALha83ENALha83EBAEAIJC9wJRcAECFJHNAOJRMGXAF9FQBCQCbAVCF6yRSABRECBRVCBRQCBRfCBRICBRKEXGXAMAcuQBC9+RKSEMGXGXAN2BBHOC/vF9LQBALCoBJAOCIrCa9zAKJCbZCEWJHb8oGIRTAb8oGBRtGXAOCbZHbAS9PQBALAOCa9zAIJCbZCGWJ8oGBAVAbyROAb9FRbGXGXAGCG9HQBABAt87FBABCIJAO87FBABCGJAT87FBSFMAEAtjGBAECNJAOjGBAECIJATjGBMAVAbJRVALCoBJAKCEWJHmAOjGBAmATjGIALAICGWJAOjGBALCoBJAKCFJCbZHKCEWJHTAtjGBATAOjGIAIAbJRIAKCFJRKSGMGXGXAbCb6QBAQAbJAbC989zJCFJRQSFMAM1BBHbCgFZROGXGXAbCa9MQBAMCFJRMSFMAM1BFHbCgBZCOWAOCgBZqROGXAbCa9MQBAMCGJRMSFMAM1BGHbCgBZCfWAOqROGXAbCa9MQBAMCEJRMSFMAM1BEHbCgBZCdWAOqROGXAbCa9MQBAMCIJRMSFMAM2BIC8cWAOqROAMCLJRMMAOCFrCBAOCFZl9zAQJRQMGXGXAGCG9HQBABAt87FBABCIJAQ87FBABCGJAT87FBSFMAEAtjGBAECNJAQjGBAECIJATjGBMALCoBJAKCEWJHOAQjGBAOATjGIALAICGWJAQjGBALCoBJAKCFJCbZHKCEWJHOAtjGBAOAQjGIAICFJRIAKCFJRKSFMGXAOCDF9LQBALAIAcAOCbZJ2BBHbCIrHTlCbZCGWJ8oGBAVCFJHtATyROALAIAblCbZCGWJ8oGBAtAT9FHmJHtAbCbZHTyRbAT9FRTGXGXAGCG9HQBABAV87FBABCIJAb87FBABCGJAO87FBSFMAEAVjGBAECNJAbjGBAECIJAOjGBMALAICGWJAVjGBALCoBJAKCEWJHYAOjGBAYAVjGIALAICFJHICbZCGWJAOjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAIAmJCbZHICGWJAbjGBALCoBJAKCGJCbZHKCEWJHOAVjGBAOAbjGIAKCFJRKAIATJRIAtATJRVSFMAVCBAM2BBHYyHTAOC/+F6HPJROAYCbZRtGXGXAYCIrHmQBAOCFJRbSFMAORbALAIAmlCbZCGWJ8oGBROMGXGXAtQBAbCFJRVSFMAbRVALAIAYlCbZCGWJ8oGBRbMGXGXAP9FQBAMCFJRYSFMAM1BFHYCgFZRTGXGXAYCa9MQBAMCGJRYSFMAM1BGHYCgBZCOWATCgBZqRTGXAYCa9MQBAMCEJRYSFMAM1BEHYCgBZCfWATqRTGXAYCa9MQBAMCIJRYSFMAM1BIHYCgBZCdWATqRTGXAYCa9MQBAMCLJRYSFMAMCKJRYAM2BLC8cWATqRTMATCFrCBATCFZl9zAQJHQRTMGXGXAmCb6QBAYRPSFMAY1BBHMCgFZROGXGXAMCa9MQBAYCFJRPSFMAY1BFHMCgBZCOWAOCgBZqROGXAMCa9MQBAYCGJRPSFMAY1BGHMCgBZCfWAOqROGXAMCa9MQBAYCEJRPSFMAY1BEHMCgBZCdWAOqROGXAMCa9MQBAYCIJRPSFMAYCLJRPAY2BIC8cWAOqROMAOCFrCBAOCFZl9zAQJHQROMGXGXAtCb6QBAPRMSFMAP1BBHMCgFZRbGXGXAMCa9MQBAPCFJRMSFMAP1BFHMCgBZCOWAbCgBZqRbGXAMCa9MQBAPCGJRMSFMAP1BGHMCgBZCfWAbqRbGXAMCa9MQBAPCEJRMSFMAP1BEHMCgBZCdWAbqRbGXAMCa9MQBAPCIJRMSFMAPCLJRMAP2BIC8cWAbqRbMAbCFrCBAbCFZl9zAQJHQRbMGXGXAGCG9HQBABAT87FBABCIJAb87FBABCGJAO87FBSFMAEATjGBAECNJAbjGBAECIJAOjGBMALCoBJAKCEWJHYAOjGBAYATjGIALAICGWJATjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAICFJHICbZCGWJAOjGBALCoBJAKCGJCbZCEWJHOATjGBAOAbjGIALAIAm9FAmCb6qJHICbZCGWJAbjGBAIAt9FAtCb6qJRIAKCEJRKMANCFJRNABCKJRBAECSJREAKCbZRKAICbZRIAfCEJHfAF9JQBMMCBC99AMAc6yRKMALCoFJ8kUUUUBAKM/tIFGa8jUUUUBCTlRLC9+RKGXAFCLJAI9LQBCaRKAE2BBC/+FZC/QF9HQBALhB83ENAECFJRKAEAIJC98JREGXAF9FQBGXAGCG6QBEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMALCNJAICFZCGWqHGAICGrCBAICFrCFZl9zAG8oGBJHIjGBABAIjGBABCIJRBAFCaJHFQBSGMMEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMABAICGrCBAICFrCFZl9zALCNJAICFZCGWqHI8oGBJHG87FBAIAGjGBABCGJRBAFCaJHFQBMMCBC99AKAE6yRKMAKM+lLKFaF99GaG99FaG99GXGXAGCI9HQBAF9FQFEXGXGX9DBBB8/9DBBB+/ABCGJHG1BB+yAB1BBHE+yHI+L+TABCFJHL1BBHK+yHO+L+THN9DBBBB9gHVyAN9DBB/+hANAN+U9DBBBBANAVyHcAc+MHMAECa3yAI+SHIAI+UAcAMAKCa3yAO+SHcAc+U+S+S+R+VHO+U+SHN+L9DBBB9P9d9FQBAN+oRESFMCUUUU94REMAGAE86BBGXGX9DBBB8/9DBBB+/Ac9DBBBB9gyAcAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMALAG86BBGXGX9DBBB8/9DBBB+/AI9DBBBB9gyAIAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMABAG86BBABCIJRBAFCaJHFQBSGMMAF9FQBEXGXGX9DBBB8/9DBBB+/ABCIJHG8uFB+yAB8uFBHE+yHI+L+TABCGJHL8uFBHK+yHO+L+THN9DBBBB9gHVyAN9DB/+g6ANAN+U9DBBBBANAVyHcAc+MHMAECa3yAI+SHIAI+UAcAMAKCa3yAO+SHcAc+U+S+S+R+VHO+U+SHN+L9DBBB9P9d9FQBAN+oRESFMCUUUU94REMAGAE87FBGXGX9DBBB8/9DBBB+/Ac9DBBBB9gyAcAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMALAG87FBGXGX9DBBB8/9DBBB+/AI9DBBBB9gyAIAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMABAG87FBABCNJRBAFCaJHFQBMMM/SEIEaE99EaF99GXAF9FQBCBREABRIEXGXGX9D/zI818/AICKJ8uFBHLCEq+y+VHKAI8uFB+y+UHO9DB/+g6+U9DBBB8/9DBBB+/AO9DBBBB9gy+SHN+L9DBBB9P9d9FQBAN+oRVSFMCUUUU94RVMAICIJ8uFBRcAICGJ8uFBRMABALCFJCEZAEqCFWJAV87FBGXGXAKAM+y+UHN9DB/+g6+U9DBBB8/9DBBB+/AN9DBBBB9gy+SHS+L9DBBB9P9d9FQBAS+oRMSFMCUUUU94RMMABALCGJCEZAEqCFWJAM87FBGXGXAKAc+y+UHK9DB/+g6+U9DBBB8/9DBBB+/AK9DBBBB9gy+SHS+L9DBBB9P9d9FQBAS+oRcSFMCUUUU94RcMABALCaJCEZAEqCFWJAc87FBGXGX9DBBU8/AOAO+U+TANAN+U+TAKAK+U+THO9DBBBBAO9DBBBB9gy+R9DB/+g6+U9DBBB8/+SHO+L9DBBB9P9d9FQBAO+oRcSFMCUUUU94RcMABALCEZAEqCFWJAc87FBAICNJRIAECIJREAFCaJHFQBMMM9JBGXAGCGrAF9sHF9FQBEXABAB8oGBHGCNWCN91+yAGCi91CnWCUUU/8EJ+++U84GBABCIJRBAFCaJHFQBMMM9TFEaCBCB8oGUkUUBHFABCEJC98ZJHBjGUkUUBGXGXAB8/BCTWHGuQBCaREABAGlCggEJCTrXBCa6QFMAFREMAEM/lFFFaGXGXAFABqCEZ9FQBABRESFMGXGXAGCT9PQBABRESFMABREEXAEAF8oGBjGBAECIJAFCIJ8oGBjGBAECNJAFCNJ8oGBjGBAECSJAFCSJ8oGBjGBAECTJREAFCTJRFAGC9wJHGCb9LQBMMAGCI9JQBEXAEAF8oGBjGBAFCIJRFAECIJREAGC98JHGCE9LQBMMGXAG9FQBEXAEAF2BB86BBAECFJREAFCFJRFAGCaJHGQBMMABMoFFGaGXGXABCEZ9FQBABRESFMAFCgFZC+BwsN9sRIGXGXAGCT9PQBABRESFMABREEXAEAIjGBAECSJAIjGBAECNJAIjGBAECIJAIjGBAECTJREAGC9wJHGCb9LQBMMAGCI9JQBEXAEAIjGBAECIJREAGC98JHGCE9LQBMMGXAG9FQBEXAEAF86BBAECFJREAGCaJHGQBMMABMMMFBCUNMIT9kBB",Z="B9h9z9tFBBBFiI9gBB9gLaaaaaFa9gEaaaB9gFaFaEMcBBFBFFGGGEILF9wFFFLEFBFKNFaFCx/aFMO/LFVK9tv9t9vq95GBt9f9f939h9z9t9f9j9h9s9s9f9jW9vq9zBBp9tv9z9o9v9wW9f9kv9j9v9kv9WvqWv94h919m9mvqBG8Z9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv94h919m9mvqBIy9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv949TvZ91v9u9jvBLn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9P9jWBKi9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9R919hWBOn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9F949wBNI9z9iqlBVc+N9IcIBTEM9+FLa8jUUUUBCTlRBCBRFEXCBRGCBREEXABCNJAGJAECUaAFAGrCFZHIy86BBAEAIJREAGCFJHGCN9HQBMAFCx+YUUBJAE86BBAFCEWCxkUUBJAB8pEN83EBAFCFJHFCUG9HQBMMk8lLbaE97F9+FaL978jUUUUBCU/KBlHL8kUUUUBC9+RKGXAGCFJAI9LQBCaRKAE2BBC+gF9HQBALAEAIJHOAGlAG/8cBBCUoBAG9uC/wgBZHKCUGAKCUG9JyRNAECFJRKCBRVGXEXAVAF9PQFANAFAVlAVANJAF9JyRcGXGXAG9FQBAcCbJHIC9wZHMCE9sRSAMCFWRQAICIrCEJCGrRfCBRbEXAKRTCBRtGXEXGXAOATlAf9PQBCBRKSLMALCU/CBJAtAM9sJRmATAfJRKCBREGXAMCoB9JQBAOAKlC/gB9JQBCBRIEXAmAIJREGXGXGXGXGXATAICKrJ2BBHYCEZfIBFGEBMAECBDtDMIBSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCIJAeDeBJAiCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCNJAeDeBJAiCx+YUUBJ2BBJRKSFMAEAKDBBBDMIBAKCTJRKMGXGXGXGXGXAYCGrCEZfIBFGEBMAECBDtDMITSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMITAKCIJAeDeBJAiCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMITAKCNJAeDeBJAiCx+YUUBJ2BBJRKSFMAEAKDBBBDMITAKCTJRKMGXGXGXGXGXAYCIrCEZfIBFGEBMAECBDtDMIASEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIAAKCIJAeDeBJAiCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIAAKCNJAeDeBJAiCx+YUUBJ2BBJRKSFMAEAKDBBBDMIAAKCTJRKMGXGXGXGXGXAYCKrfIBFGEBMAECBDtDMI8wSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHYCEWCxkUUBJDBEBAYCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHYCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMI8wAKCIJAeDeBJAYCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHYCEWCxkUUBJDBEBAYCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHYCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMI8wAKCNJAeDeBJAYCx+YUUBJ2BBJRKSFMAEAKDBBBDMI8wAKCTJRKMAICoBJREAICUFJAM9LQFAERIAOAKlC/fB9LQBMMGXAEAM9PQBAECErRIEXGXAOAKlCi9PQBCBRKSOMAmAEJRYGXGXGXGXGXATAECKrJ2BBAICKZrCEZfIBFGEBMAYCBDtDMIBSEMAYAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCIJAeDeBJAiCx+YUUBJ2BBJRKSGMAYAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCNJAeDeBJAiCx+YUUBJ2BBJRKSFMAYAKDBBBDMIBAKCTJRKMAICGJRIAECTJHEAM9JQBMMGXAK9FQBAKRTAtCFJHtCI6QGSFMMCBRKSEMGXAM9FQBALCUGJAbJREALAbJDBGBReCBRYEXAEALCU/CBJAYJHIDBIBHdCFD9tAdCFDbHPD9OD9hD9RHdAIAMJDBIBH8ZCFD9tA8ZAPD9OD9hD9RH8ZDQBTFtGmEYIPLdKeOnHpAIAQJDBIBHyCFD9tAyAPD9OD9hD9RHyAIASJDBIBH8cCFD9tA8cAPD9OD9hD9RH8cDQBTFtGmEYIPLdKeOnH8dDQBFTtGEmYILPdKOenHPAPDQBFGEBFGEBFGEBFGEAeD9uHeDyBjGBAEAGJHIAeAPAPDQILKOILKOILKOILKOD9uHeDyBjGBAIAGJHIAeAPAPDQNVcMNVcMNVcMNVcMD9uHeDyBjGBAIAGJHIAeAPAPDQSQfbSQfbSQfbSQfbD9uHeDyBjGBAIAGJHIAeApA8dDQNVi8ZcMpySQ8c8dfb8e8fHPAPDQBFGEBFGEBFGEBFGED9uHeDyBjGBAIAGJHIAeAPAPDQILKOILKOILKOILKOD9uHeDyBjGBAIAGJHIAeAPAPDQNVcMNVcMNVcMNVcMD9uHeDyBjGBAIAGJHIAeAPAPDQSQfbSQfbSQfbSQfbD9uHeDyBjGBAIAGJHIAeAdA8ZDQNiV8ZcpMyS8cQ8df8eb8fHdAyA8cDQNiV8ZcpMyS8cQ8df8eb8fH8ZDQBFTtGEmYILPdKOenHPAPDQBFGEBFGEBFGEBFGED9uHeDyBjGBAIAGJHIAeAPAPDQILKOILKOILKOILKOD9uHeDyBjGBAIAGJHIAeAPAPDQNVcMNVcMNVcMNVcMD9uHeDyBjGBAIAGJHIAeAPAPDQSQfbSQfbSQfbSQfbD9uHeDyBjGBAIAGJHIAeAdA8ZDQNVi8ZcMpySQ8c8dfb8e8fHPAPDQBFGEBFGEBFGEBFGED9uHeDyBjGBAIAGJHIAeAPAPDQILKOILKOILKOILKOD9uHeDyBjGBAIAGJHIAeAPAPDQNVcMNVcMNVcMNVcMD9uHeDyBjGBAIAGJHIAeAPAPDQSQfbSQfbSQfbSQfbD9uHeDyBjGBAIAGJREAYCTJHYAM9JQBMMAbCIJHbAG9JQBMMABAVAG9sJALCUGJAcAG9s/8cBBALALCUGJAcCaJAG9sJAG/8cBBMAcCBAKyAVJRVAKQBMC9+RKSFMCBC99AOAKlAGCAAGCA9Ly6yRKMALCU/KBJ8kUUUUBAKMNBT+BUUUBM+KmFTa8jUUUUBCoFlHL8kUUUUBC9+RKGXAFCE9uHOCtJAI9LQBCaRKAE2BBHNC/wFZC/gF9HQBANCbZHVCF9LQBALCoBJCgFCUF/8MBALC84Jha83EBALC8wJha83EBALC8oJha83EBALCAJha83EBALCiJha83EBALCTJha83EBALha83ENALha83EBAEAIJC9wJRcAECFJHNAOJRMGXAF9FQBCQCbAVCF6yRSABRECBRVCBRQCBRfCBRICBRKEXGXAMAcuQBC9+RKSEMGXGXAN2BBHOC/vF9LQBALCoBJAOCIrCa9zAKJCbZCEWJHb8oGIRTAb8oGBRtGXAOCbZHbAS9PQBALAOCa9zAIJCbZCGWJ8oGBAVAbyROAb9FRbGXGXAGCG9HQBABAt87FBABCIJAO87FBABCGJAT87FBSFMAEAtjGBAECNJAOjGBAECIJATjGBMAVAbJRVALCoBJAKCEWJHmAOjGBAmATjGIALAICGWJAOjGBALCoBJAKCFJCbZHKCEWJHTAtjGBATAOjGIAIAbJRIAKCFJRKSGMGXGXAbCb6QBAQAbJAbC989zJCFJRQSFMAM1BBHbCgFZROGXGXAbCa9MQBAMCFJRMSFMAM1BFHbCgBZCOWAOCgBZqROGXAbCa9MQBAMCGJRMSFMAM1BGHbCgBZCfWAOqROGXAbCa9MQBAMCEJRMSFMAM1BEHbCgBZCdWAOqROGXAbCa9MQBAMCIJRMSFMAM2BIC8cWAOqROAMCLJRMMAOCFrCBAOCFZl9zAQJRQMGXGXAGCG9HQBABAt87FBABCIJAQ87FBABCGJAT87FBSFMAEAtjGBAECNJAQjGBAECIJATjGBMALCoBJAKCEWJHOAQjGBAOATjGIALAICGWJAQjGBALCoBJAKCFJCbZHKCEWJHOAtjGBAOAQjGIAICFJRIAKCFJRKSFMGXAOCDF9LQBALAIAcAOCbZJ2BBHbCIrHTlCbZCGWJ8oGBAVCFJHtATyROALAIAblCbZCGWJ8oGBAtAT9FHmJHtAbCbZHTyRbAT9FRTGXGXAGCG9HQBABAV87FBABCIJAb87FBABCGJAO87FBSFMAEAVjGBAECNJAbjGBAECIJAOjGBMALAICGWJAVjGBALCoBJAKCEWJHYAOjGBAYAVjGIALAICFJHICbZCGWJAOjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAIAmJCbZHICGWJAbjGBALCoBJAKCGJCbZHKCEWJHOAVjGBAOAbjGIAKCFJRKAIATJRIAtATJRVSFMAVCBAM2BBHYyHTAOC/+F6HPJROAYCbZRtGXGXAYCIrHmQBAOCFJRbSFMAORbALAIAmlCbZCGWJ8oGBROMGXGXAtQBAbCFJRVSFMAbRVALAIAYlCbZCGWJ8oGBRbMGXGXAP9FQBAMCFJRYSFMAM1BFHYCgFZRTGXGXAYCa9MQBAMCGJRYSFMAM1BGHYCgBZCOWATCgBZqRTGXAYCa9MQBAMCEJRYSFMAM1BEHYCgBZCfWATqRTGXAYCa9MQBAMCIJRYSFMAM1BIHYCgBZCdWATqRTGXAYCa9MQBAMCLJRYSFMAMCKJRYAM2BLC8cWATqRTMATCFrCBATCFZl9zAQJHQRTMGXGXAmCb6QBAYRPSFMAY1BBHMCgFZROGXGXAMCa9MQBAYCFJRPSFMAY1BFHMCgBZCOWAOCgBZqROGXAMCa9MQBAYCGJRPSFMAY1BGHMCgBZCfWAOqROGXAMCa9MQBAYCEJRPSFMAY1BEHMCgBZCdWAOqROGXAMCa9MQBAYCIJRPSFMAYCLJRPAY2BIC8cWAOqROMAOCFrCBAOCFZl9zAQJHQROMGXGXAtCb6QBAPRMSFMAP1BBHMCgFZRbGXGXAMCa9MQBAPCFJRMSFMAP1BFHMCgBZCOWAbCgBZqRbGXAMCa9MQBAPCGJRMSFMAP1BGHMCgBZCfWAbqRbGXAMCa9MQBAPCEJRMSFMAP1BEHMCgBZCdWAbqRbGXAMCa9MQBAPCIJRMSFMAPCLJRMAP2BIC8cWAbqRbMAbCFrCBAbCFZl9zAQJHQRbMGXGXAGCG9HQBABAT87FBABCIJAb87FBABCGJAO87FBSFMAEATjGBAECNJAbjGBAECIJAOjGBMALCoBJAKCEWJHYAOjGBAYATjGIALAICGWJATjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAICFJHICbZCGWJAOjGBALCoBJAKCGJCbZCEWJHOATjGBAOAbjGIALAIAm9FAmCb6qJHICbZCGWJAbjGBAIAt9FAtCb6qJRIAKCEJRKMANCFJRNABCKJRBAECSJREAKCbZRKAICbZRIAfCEJHfAF9JQBMMCBC99AMAc6yRKMALCoFJ8kUUUUBAKM/tIFGa8jUUUUBCTlRLC9+RKGXAFCLJAI9LQBCaRKAE2BBC/+FZC/QF9HQBALhB83ENAECFJRKAEAIJC98JREGXAF9FQBGXAGCG6QBEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMALCNJAICFZCGWqHGAICGrCBAICFrCFZl9zAG8oGBJHIjGBABAIjGBABCIJRBAFCaJHFQBSGMMEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMABAICGrCBAICFrCFZl9zALCNJAICFZCGWqHI8oGBJHG87FBAIAGjGBABCGJRBAFCaJHFQBMMCBC99AKAE6yRKMAKM/dLEK97FaF97GXGXAGCI9HQBAF9FQFCBRGEXABABDBBBHECiD+rFCiD+sFD/6FHIAECND+rFCiD+sFD/6FAID/gFAECTD+rFCiD+sFD/6FHLD/gFD/kFD/lFHKCBDtD+2FHOAICUUUU94DtHND9OD9RD/kFHI9DBB/+hDYAIAID/mFAKAKD/mFALAOALAND9OD9RD/kFHIAID/mFD/kFD/kFD/jFD/nFHLD/mF9DBBX9LDYHOD/kFCgFDtD9OAECUUU94DtD9OD9QAIALD/mFAOD/kFCND+rFCU/+EDtD9OD9QAKALD/mFAOD/kFCTD+rFCUU/8ODtD9OD9QDMBBABCTJRBAGCIJHGAF9JQBSGMMAF9FQBCBRGEXABCTJHVAVDBBBHECBDtHOCUU98D8cFCUU98D8cEHND9OABDBBBHKAEDQILKOSQfbPden8c8d8e8fCggFDtD9OD/6FAKAEDQBFGENVcMTtmYi8ZpyHECTD+sFD/6FHID/gFAECTD+rFCTD+sFD/6FHLD/gFD/kFD/lFHE9DB/+g6DYALAEAOD+2FHOALCUUUU94DtHcD9OD9RD/kFHLALD/mFAEAED/mFAIAOAIAcD9OD9RD/kFHEAED/mFD/kFD/kFD/jFD/nFHID/mF9DBBX9LDYHOD/kFCTD+rFALAID/mFAOD/kFCggEDtD9OD9QHLAEAID/mFAOD/kFCaDbCBDnGCBDnECBDnKCBDnOCBDncCBDnMCBDnfCBDnbD9OHEDQNVi8ZcMpySQ8c8dfb8e8fD9QDMBBABAKAND9OALAEDQBFTtGEmYILPdKOenD9QDMBBABCAJRBAGCIJHGAF9JQBMMM/hEIGaF97FaL978jUUUUBCTlREGXAF9FQBCBRIEXAEABDBBBHLABCTJHKDBBBHODQILKOSQfbPden8c8d8e8fHNCTD+sFHVCID+rFDMIBAB9DBBU8/DY9D/zI818/DYAVCEDtD9QD/6FD/nFHVALAODQBFGENVcMTtmYi8ZpyHLCTD+rFCTD+sFD/6FD/mFHOAOD/mFAVALCTD+sFD/6FD/mFHcAcD/mFAVANCTD+rFCTD+sFD/6FD/mFHNAND/mFD/kFD/kFD/lFCBDtD+4FD/jF9DB/+g6DYHVD/mF9DBBX9LDYHLD/kFCggEDtHMD9OAcAVD/mFALD/kFCTD+rFD9QHcANAVD/mFALD/kFCTD+rFAOAVD/mFALD/kFAMD9OD9QHVDQBFTtGEmYILPdKOenHLD8dBAEDBIBDyB+t+J83EBABCNJALD8dFAEDBIBDyF+t+J83EBAKAcAVDQNVi8ZcMpySQ8c8dfb8e8fHVD8dBAEDBIBDyG+t+J83EBABCiJAVD8dFAEDBIBDyE+t+J83EBABCAJRBAICIJHIAF9JQBMMM9jFF97GXAGCGrAF9sHG9FQBCBRFEXABABDBBBHECND+rFCND+sFD/6FAECiD+sFCnD+rFCUUU/8EDtD+uFD/mFDMBBABCTJRBAFCIJHFAG9JQBMMM9TFEaCBCB8oGUkUUBHFABCEJC98ZJHBjGUkUUBGXGXAB8/BCTWHGuQBCaREABAGlCggEJCTrXBCa6QFMAFREMAEMMMFBCUNMIT9tBB",_=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]),K=new Uint8Array([32,0,65,253,3,1,2,34,4,106,6,5,11,8,7,20,13,33,12,16,128,9,116,64,19,113,127,15,10,21,22,14,255,66,24,54,136,107,18,23,192,26,114,118,132,17,77,101,130,144,27,87,131,44,45,74,156,154,70,167]);if(typeof WebAssembly!="object")return{supported:!1};let te=X;WebAssembly.validate(_)&&(te=Z);let ne;const ie=WebAssembly.instantiate(oe(te),{}).then(ce=>{ne=ce.instance,ne.exports.__wasm_call_ctors()});function oe(ce){const de=new Uint8Array(ce.length);for(let fe=0;fe<ce.length;++fe){const be=ce.charCodeAt(fe);de[fe]=be>96?be-71:be>64?be-65:be>47?be+4:be>46?63:62}let Ie=0;for(let fe=0;fe<ce.length;++fe)de[Ie++]=de[fe]<60?K[de[fe]]:(de[fe]-60)*64+de[++fe];return de.buffer.slice(0,Ie)}function se(ce,de,Ie,fe,be,Ae){const ye=ne.exports.sbrk,ve=Ie+3&-4,Be=ye(ve*fe),Re=ye(be.length),Ve=new Uint8Array(ne.exports.memory.buffer);Ve.set(be,Re);const Ee=ce(Be,Ie,fe,Re,be.length);if(Ee===0&&Ae&&Ae(Be,ve,fe),de.set(Ve.subarray(Be,Be+Ie*fe)),ye(Be-ye(0)),Ee!==0)throw new Error(`Malformed buffer data: ${Ee}`)}const ae={0:"",1:"meshopt_decodeFilterOct",2:"meshopt_decodeFilterQuat",3:"meshopt_decodeFilterExp",NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},ge={0:"meshopt_decodeVertexBuffer",1:"meshopt_decodeIndexBuffer",2:"meshopt_decodeIndexSequence",ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return generated={ready:ie,supported:!0,decodeVertexBuffer(ce,de,Ie,fe,be){se(ne.exports.meshopt_decodeVertexBuffer,ce,de,Ie,fe,ne.exports[ae[be]])},decodeIndexBuffer(ce,de,Ie,fe){se(ne.exports.meshopt_decodeIndexBuffer,ce,de,Ie,fe)},decodeIndexSequence(ce,de,Ie,fe){se(ne.exports.meshopt_decodeIndexSequence,ce,de,Ie,fe)},decodeGltfBuffer(ce,de,Ie,fe,be,Ae){se(ne.exports[ge[be]],ce,de,Ie,fe,ne.exports[ae[Ae]])}},generated};function workerBootstrap(){var X=Object.create(null);function Z(te,ne){var ie=te.id,oe=te.name,se=te.dependencies;se===void 0&&(se=[]);var ae=te.init;ae===void 0&&(ae=function(){});var ge=te.getTransferables;if(ge===void 0&&(ge=null),!X[ie])try{se=se.map(function(de){return de&&de.isWorkerModule&&(Z(de,function(Ie){if(Ie instanceof Error)throw Ie}),de=X[de.id].value),de}),ae=K("<"+oe+">.init",ae),ge&&(ge=K("<"+oe+">.getTransferables",ge));var ce=null;typeof ae=="function"?ce=ae.apply(void 0,se):console.error("worker module init function failed to rehydrate"),X[ie]={id:ie,value:ce,getTransferables:ge},ne(ce)}catch(de){de&&de.noLog||console.error(de),ne(de)}}function _(te,ne){var ie,oe=te.id,se=te.args;(!X[oe]||typeof X[oe].value!="function")&&ne(new Error("Worker module "+oe+": not found or its 'init' did not return a function"));try{var ae=(ie=X[oe]).value.apply(ie,se);ae&&typeof ae.then=="function"?ae.then(ge,function(ce){return ne(ce instanceof Error?ce:new Error(""+ce))}):ge(ae)}catch(ce){ne(ce)}function ge(ce){try{var de=X[oe].getTransferables&&X[oe].getTransferables(ce);(!de||!Array.isArray(de)||!de.length)&&(de=void 0),ne(ce,de)}catch(Ie){console.error(Ie),ne(Ie)}}}function K(te,ne){var ie=void 0;self.troikaDefine=function(se){return ie=se};var oe=URL.createObjectURL(new Blob(["/** "+te.replace(/\*/g,"")+` **/

troikaDefine(
`+ne+`
)`],{type:"application/javascript"}));try{importScripts(oe)}catch(se){console.error(se)}return URL.revokeObjectURL(oe),delete self.troikaDefine,ie}self.addEventListener("message",function(te){var ne=te.data,ie=ne.messageId,oe=ne.action,se=ne.data;try{oe==="registerModule"&&Z(se,function(ae){ae instanceof Error?postMessage({messageId:ie,success:!1,error:ae.message}):postMessage({messageId:ie,success:!0,result:{isCallable:typeof ae=="function"}})}),oe==="callModule"&&_(se,function(ae,ge){ae instanceof Error?postMessage({messageId:ie,success:!1,error:ae.message}):postMessage({messageId:ie,success:!0,result:ae},ge||void 0)})}catch(ae){postMessage({messageId:ie,success:!1,error:ae.stack})}})}function defineMainThreadModule(X){var Z=function(){for(var _=[],K=arguments.length;K--;)_[K]=arguments[K];return Z._getInitResult().then(function(te){if(typeof te=="function")return te.apply(void 0,_);throw new Error("Worker module function was called but `init` did not return a callable function")})};return Z._getInitResult=function(){var _=X.dependencies,K=X.init;_=Array.isArray(_)?_.map(function(ne){return ne&&(ne=ne.onMainThread||ne,ne._getInitResult&&(ne=ne._getInitResult())),ne}):[];var te=Promise.all(_).then(function(ne){return K.apply(null,ne)});return Z._getInitResult=function(){return te},te},Z}var supportsWorkers=function(){var X=!1;if(typeof window<"u"&&typeof window.document<"u")try{var Z=new Worker(URL.createObjectURL(new Blob([""],{type:"application/javascript"})));Z.terminate(),X=!0}catch(_){console.log("Troika createWorkerModule: web workers not allowed; falling back to main thread execution. Cause: ["+_.message+"]")}return supportsWorkers=function(){return X},X},_workerModuleId=0,_messageId=0,_allowInitAsString=!1,workers=Object.create(null),registeredModules=Object.create(null),openRequests=Object.create(null);function defineWorkerModule(X){if((!X||typeof X.init!="function")&&!_allowInitAsString)throw new Error("requires `options.init` function");var Z=X.dependencies,_=X.init,K=X.getTransferables,te=X.workerId,ne=defineMainThreadModule(X);te==null&&(te="#default");var ie="workerModule"+ ++_workerModuleId,oe=X.name||ie,se=null;Z=Z&&Z.map(function(ge){return typeof ge=="function"&&!ge.workerModuleData&&(_allowInitAsString=!0,ge=defineWorkerModule({workerId:te,name:"<"+oe+"> function dependency: "+ge.name,init:`function(){return (
`+stringifyFunction(ge)+`
)}`}),_allowInitAsString=!1),ge&&ge.workerModuleData&&(ge=ge.workerModuleData),ge});function ae(){for(var ge=[],ce=arguments.length;ce--;)ge[ce]=arguments[ce];if(!supportsWorkers())return ne.apply(void 0,ge);if(!se){se=callWorker(te,"registerModule",ae.workerModuleData);var de=function(){se=null,registeredModules[te].delete(de)};(registeredModules[te]||(registeredModules[te]=new Set)).add(de)}return se.then(function(Ie){var fe=Ie.isCallable;if(fe)return callWorker(te,"callModule",{id:ie,args:ge});throw new Error("Worker module function was called but `init` did not return a callable function")})}return ae.workerModuleData={isWorkerModule:!0,id:ie,name:oe,dependencies:Z,init:stringifyFunction(_),getTransferables:K&&stringifyFunction(K)},ae.onMainThread=ne,ae}function terminateWorker(X){registeredModules[X]&&registeredModules[X].forEach(function(Z){Z()}),workers[X]&&(workers[X].terminate(),delete workers[X])}function stringifyFunction(X){var Z=X.toString();return!/^function/.test(Z)&&/^\w+\s*\(/.test(Z)&&(Z="function "+Z),Z}function getWorker(X){var Z=workers[X];if(!Z){var _=stringifyFunction(workerBootstrap);Z=workers[X]=new Worker(URL.createObjectURL(new Blob(["/** Worker Module Bootstrap: "+X.replace(/\*/g,"")+` **/

;(`+_+")()"],{type:"application/javascript"}))),Z.onmessage=function(K){var te=K.data,ne=te.messageId,ie=openRequests[ne];if(!ie)throw new Error("WorkerModule response with empty or unknown messageId");delete openRequests[ne],ie(te)}}return Z}function callWorker(X,Z,_){return new Promise(function(K,te){var ne=++_messageId;openRequests[ne]=function(ie){ie.success?K(ie.result):te(new Error("Error in worker "+Z+" call: "+ie.error))},getWorker(X).postMessage({messageId:ne,action:Z,data:_})})}function SDFGenerator(){var X=function(Z){function _(qe,Pe,Ye,$e,ut,ot,gt,ht){var dt=1-gt;ht.x=dt*dt*qe+2*dt*gt*Ye+gt*gt*ut,ht.y=dt*dt*Pe+2*dt*gt*$e+gt*gt*ot}function K(qe,Pe,Ye,$e,ut,ot,gt,ht,dt,bt){var Ht=1-dt;bt.x=Ht*Ht*Ht*qe+3*Ht*Ht*dt*Ye+3*Ht*dt*dt*ut+dt*dt*dt*gt,bt.y=Ht*Ht*Ht*Pe+3*Ht*Ht*dt*$e+3*Ht*dt*dt*ot+dt*dt*dt*ht}function te(qe,Pe){for(var Ye=/([MLQCZ])([^MLQCZ]*)/g,$e,ut,ot,gt,ht;$e=Ye.exec(qe);){var dt=$e[2].replace(/^\s*|\s*$/g,"").split(/[,\s]+/).map(function(bt){return parseFloat(bt)});switch($e[1]){case"M":gt=ut=dt[0],ht=ot=dt[1];break;case"L":(dt[0]!==gt||dt[1]!==ht)&&Pe("L",gt,ht,gt=dt[0],ht=dt[1]);break;case"Q":{Pe("Q",gt,ht,gt=dt[2],ht=dt[3],dt[0],dt[1]);break}case"C":{Pe("C",gt,ht,gt=dt[4],ht=dt[5],dt[0],dt[1],dt[2],dt[3]);break}case"Z":(gt!==ut||ht!==ot)&&Pe("L",gt,ht,ut,ot);break}}}function ne(qe,Pe,Ye){Ye===void 0&&(Ye=16);var $e={x:0,y:0};te(qe,function(ut,ot,gt,ht,dt,bt,Ht,Dt,Vt){switch(ut){case"L":Pe(ot,gt,ht,dt);break;case"Q":{for(var mt=ot,Ft=gt,it=1;it<Ye;it++)_(ot,gt,bt,Ht,ht,dt,it/(Ye-1),$e),Pe(mt,Ft,$e.x,$e.y),mt=$e.x,Ft=$e.y;break}case"C":{for(var Lt=ot,Et=gt,Ut=1;Ut<Ye;Ut++)K(ot,gt,bt,Ht,Dt,Vt,ht,dt,Ut/(Ye-1),$e),Pe(Lt,Et,$e.x,$e.y),Lt=$e.x,Et=$e.y;break}}})}var ie="precision highp float;attribute vec2 aUV;varying vec2 vUV;void main(){vUV=aUV;gl_Position=vec4(mix(vec2(-1.0),vec2(1.0),aUV),0.0,1.0);}",oe="precision highp float;uniform sampler2D tex;varying vec2 vUV;void main(){gl_FragColor=texture2D(tex,vUV);}",se=new WeakMap,ae={premultipliedAlpha:!1,preserveDrawingBuffer:!0,antialias:!1,depth:!1};function ge(qe,Pe){var Ye=qe.getContext?qe.getContext("webgl",ae):qe,$e=se.get(Ye);if(!$e){let Lt=function(Je){var Oe=ot[Je];if(!Oe&&(Oe=ot[Je]=Ye.getExtension(Je),!Oe))throw new Error(Je+" not supported");return Oe},Et=function(Je,Oe){var lt=Ye.createShader(Oe);return Ye.shaderSource(lt,Je),Ye.compileShader(lt),lt},Ut=function(Je,Oe,lt,ft){if(!gt[Je]){var St={},Wt={},zt=Ye.createProgram();Ye.attachShader(zt,Et(Oe,Ye.VERTEX_SHADER)),Ye.attachShader(zt,Et(lt,Ye.FRAGMENT_SHADER)),Ye.linkProgram(zt),gt[Je]={program:zt,transaction:function(rn){Ye.useProgram(zt),rn({setUniform:function(en,In){for(var un=[],ln=arguments.length-2;ln-- >0;)un[ln]=arguments[ln+2];var tn=Wt[In]||(Wt[In]=Ye.getUniformLocation(zt,In));Ye["uniform"+en].apply(Ye,[tn].concat(un))},setAttribute:function(en,In,un,ln,tn){var Sn=St[en];Sn||(Sn=St[en]={buf:Ye.createBuffer(),loc:Ye.getAttribLocation(zt,en),data:null}),Ye.bindBuffer(Ye.ARRAY_BUFFER,Sn.buf),Ye.vertexAttribPointer(Sn.loc,In,Ye.FLOAT,!1,0,0),Ye.enableVertexAttribArray(Sn.loc),ut?Ye.vertexAttribDivisor(Sn.loc,ln):Lt("ANGLE_instanced_arrays").vertexAttribDivisorANGLE(Sn.loc,ln),tn!==Sn.data&&(Ye.bufferData(Ye.ARRAY_BUFFER,tn,un),Sn.data=tn)}})}}}gt[Je].transaction(ft)},Zt=function(Je,Oe){dt++;try{Ye.activeTexture(Ye.TEXTURE0+dt);var lt=ht[Je];lt||(lt=ht[Je]=Ye.createTexture(),Ye.bindTexture(Ye.TEXTURE_2D,lt),Ye.texParameteri(Ye.TEXTURE_2D,Ye.TEXTURE_MIN_FILTER,Ye.NEAREST),Ye.texParameteri(Ye.TEXTURE_2D,Ye.TEXTURE_MAG_FILTER,Ye.NEAREST)),Ye.bindTexture(Ye.TEXTURE_2D,lt),Oe(lt,dt)}finally{dt--}},Ot=function(Je,Oe,lt){var ft=Ye.createFramebuffer();bt.push(ft),Ye.bindFramebuffer(Ye.FRAMEBUFFER,ft),Ye.activeTexture(Ye.TEXTURE0+Oe),Ye.bindTexture(Ye.TEXTURE_2D,Je),Ye.framebufferTexture2D(Ye.FRAMEBUFFER,Ye.COLOR_ATTACHMENT0,Ye.TEXTURE_2D,Je,0);try{lt(ft)}finally{Ye.deleteFramebuffer(ft),Ye.bindFramebuffer(Ye.FRAMEBUFFER,bt[--bt.length-1]||null)}},Tt=function(){ot={},gt={},ht={},dt=-1,bt.length=0};var Ht=Lt,Dt=Et,Vt=Ut,mt=Zt,Ft=Ot,it=Tt,ut=typeof WebGL2RenderingContext<"u"&&Ye instanceof WebGL2RenderingContext,ot={},gt={},ht={},dt=-1,bt=[];Ye.canvas.addEventListener("webglcontextlost",function(Je){Tt(),Je.preventDefault()},!1),se.set(Ye,$e={gl:Ye,isWebGL2:ut,getExtension:Lt,withProgram:Ut,withTexture:Zt,withTextureFramebuffer:Ot,handleContextLoss:Tt})}Pe($e)}function ce(qe,Pe,Ye,$e,ut,ot,gt,ht){gt===void 0&&(gt=15),ht===void 0&&(ht=null),ge(qe,function(dt){var bt=dt.gl,Ht=dt.withProgram,Dt=dt.withTexture;Dt("copy",function(Vt,mt){bt.texImage2D(bt.TEXTURE_2D,0,bt.RGBA,ut,ot,0,bt.RGBA,bt.UNSIGNED_BYTE,Pe),Ht("copy",ie,oe,function(Ft){var it=Ft.setUniform,Lt=Ft.setAttribute;Lt("aUV",2,bt.STATIC_DRAW,0,new Float32Array([0,0,2,0,0,2])),it("1i","image",mt),bt.bindFramebuffer(bt.FRAMEBUFFER,ht||null),bt.disable(bt.BLEND),bt.colorMask(gt&8,gt&4,gt&2,gt&1),bt.viewport(Ye,$e,ut,ot),bt.scissor(Ye,$e,ut,ot),bt.drawArrays(bt.TRIANGLES,0,3)})})})}function de(qe,Pe,Ye){var $e=qe.width,ut=qe.height;ge(qe,function(ot){var gt=ot.gl,ht=new Uint8Array($e*ut*4);gt.readPixels(0,0,$e,ut,gt.RGBA,gt.UNSIGNED_BYTE,ht),qe.width=Pe,qe.height=Ye,ce(gt,ht,0,0,$e,ut)})}var Ie=Object.freeze({__proto__:null,withWebGLContext:ge,renderImageData:ce,resizeWebGLCanvasWithoutClearing:de});function fe(qe,Pe,Ye,$e,ut,ot){ot===void 0&&(ot=1);var gt=new Uint8Array(qe*Pe),ht=$e[2]-$e[0],dt=$e[3]-$e[1],bt=[];ne(Ye,function(Lt,Et,Ut,Zt){bt.push({x1:Lt,y1:Et,x2:Ut,y2:Zt,minX:Math.min(Lt,Ut),minY:Math.min(Et,Zt),maxX:Math.max(Lt,Ut),maxY:Math.max(Et,Zt)})}),bt.sort(function(Lt,Et){return Lt.maxX-Et.maxX});for(var Ht=0;Ht<qe;Ht++)for(var Dt=0;Dt<Pe;Dt++){var Vt=Ft($e[0]+ht*(Ht+.5)/qe,$e[1]+dt*(Dt+.5)/Pe),mt=Math.pow(1-Math.abs(Vt)/ut,ot)/2;Vt<0&&(mt=1-mt),mt=Math.max(0,Math.min(255,Math.round(mt*255))),gt[Dt*qe+Ht]=mt}return gt;function Ft(Lt,Et){for(var Ut=1/0,Zt=1/0,Ot=bt.length;Ot--;){var Tt=bt[Ot];if(Tt.maxX+Zt<=Lt)break;if(Lt+Zt>Tt.minX&&Et-Zt<Tt.maxY&&Et+Zt>Tt.minY){var Je=ye(Lt,Et,Tt.x1,Tt.y1,Tt.x2,Tt.y2);Je<Ut&&(Ut=Je,Zt=Math.sqrt(Ut))}}return it(Lt,Et)&&(Zt=-Zt),Zt}function it(Lt,Et){for(var Ut=0,Zt=bt.length;Zt--;){var Ot=bt[Zt];if(Ot.maxX<=Lt)break;var Tt=Ot.y1>Et!=Ot.y2>Et&&Lt<(Ot.x2-Ot.x1)*(Et-Ot.y1)/(Ot.y2-Ot.y1)+Ot.x1;Tt&&(Ut+=Ot.y1<Ot.y2?1:-1)}return Ut!==0}}function be(qe,Pe,Ye,$e,ut,ot,gt,ht,dt,bt){ot===void 0&&(ot=1),ht===void 0&&(ht=0),dt===void 0&&(dt=0),bt===void 0&&(bt=0),Ae(qe,Pe,Ye,$e,ut,ot,gt,null,ht,dt,bt)}function Ae(qe,Pe,Ye,$e,ut,ot,gt,ht,dt,bt,Ht){ot===void 0&&(ot=1),dt===void 0&&(dt=0),bt===void 0&&(bt=0),Ht===void 0&&(Ht=0);for(var Dt=fe(qe,Pe,Ye,$e,ut,ot),Vt=new Uint8Array(Dt.length*4),mt=0;mt<Dt.length;mt++)Vt[mt*4+Ht]=Dt[mt];ce(gt,Vt,dt,bt,qe,Pe,1<<3-Ht,ht)}function ye(qe,Pe,Ye,$e,ut,ot){var gt=ut-Ye,ht=ot-$e,dt=gt*gt+ht*ht,bt=dt?Math.max(0,Math.min(1,((qe-Ye)*gt+(Pe-$e)*ht)/dt)):0,Ht=qe-(Ye+bt*gt),Dt=Pe-($e+bt*ht);return Ht*Ht+Dt*Dt}var ve=Object.freeze({__proto__:null,generate:fe,generateIntoCanvas:be,generateIntoFramebuffer:Ae}),Be="precision highp float;uniform vec4 uGlyphBounds;attribute vec2 aUV;attribute vec4 aLineSegment;varying vec4 vLineSegment;varying vec2 vGlyphXY;void main(){vLineSegment=aLineSegment;vGlyphXY=mix(uGlyphBounds.xy,uGlyphBounds.zw,aUV);gl_Position=vec4(mix(vec2(-1.0),vec2(1.0),aUV),0.0,1.0);}",Re="precision highp float;uniform vec4 uGlyphBounds;uniform float uMaxDistance;uniform float uExponent;varying vec4 vLineSegment;varying vec2 vGlyphXY;float absDistToSegment(vec2 point,vec2 lineA,vec2 lineB){vec2 lineDir=lineB-lineA;float lenSq=dot(lineDir,lineDir);float t=lenSq==0.0 ? 0.0 : clamp(dot(point-lineA,lineDir)/lenSq,0.0,1.0);vec2 linePt=lineA+t*lineDir;return distance(point,linePt);}void main(){vec4 seg=vLineSegment;vec2 p=vGlyphXY;float dist=absDistToSegment(p,seg.xy,seg.zw);float val=pow(1.0-clamp(dist/uMaxDistance,0.0,1.0),uExponent)*0.5;bool crossing=(seg.y>p.y!=seg.w>p.y)&&(p.x<(seg.z-seg.x)*(p.y-seg.y)/(seg.w-seg.y)+seg.x);bool crossingUp=crossing&&vLineSegment.y<vLineSegment.w;gl_FragColor=vec4(crossingUp ? 1.0/255.0 : 0.0,crossing&&!crossingUp ? 1.0/255.0 : 0.0,0.0,val);}",Ve="precision highp float;uniform sampler2D tex;varying vec2 vUV;void main(){vec4 color=texture2D(tex,vUV);bool inside=color.r!=color.g;float val=inside ? 1.0-color.a : color.a;gl_FragColor=vec4(val);}",Ee=new Float32Array([0,0,2,0,0,2]),Ze=null,_e=!1,Fe={},Te=new WeakMap;function ke(qe){if(!_e&&!rt(qe))throw new Error("WebGL generation not supported")}function Le(qe,Pe,Ye,$e,ut,ot,gt){if(ot===void 0&&(ot=1),gt===void 0&&(gt=null),!gt&&(gt=Ze,!gt)){var ht=typeof OffscreenCanvas=="function"?new OffscreenCanvas(1,1):typeof document<"u"?document.createElement("canvas"):null;if(!ht)throw new Error("OffscreenCanvas or DOM canvas not supported");gt=Ze=ht.getContext("webgl",{depth:!1})}ke(gt);var dt=new Uint8Array(qe*Pe*4);ge(gt,function(Vt){var mt=Vt.gl,Ft=Vt.withTexture,it=Vt.withTextureFramebuffer;Ft("readable",function(Lt,Et){mt.texImage2D(mt.TEXTURE_2D,0,mt.RGBA,qe,Pe,0,mt.RGBA,mt.UNSIGNED_BYTE,null),it(Lt,Et,function(Ut){Ue(qe,Pe,Ye,$e,ut,ot,mt,Ut,0,0,0),mt.readPixels(0,0,qe,Pe,mt.RGBA,mt.UNSIGNED_BYTE,dt)})})});for(var bt=new Uint8Array(qe*Pe),Ht=0,Dt=0;Ht<dt.length;Ht+=4)bt[Dt++]=dt[Ht];return bt}function Ke(qe,Pe,Ye,$e,ut,ot,gt,ht,dt,bt){ot===void 0&&(ot=1),ht===void 0&&(ht=0),dt===void 0&&(dt=0),bt===void 0&&(bt=0),Ue(qe,Pe,Ye,$e,ut,ot,gt,null,ht,dt,bt)}function Ue(qe,Pe,Ye,$e,ut,ot,gt,ht,dt,bt,Ht){ot===void 0&&(ot=1),dt===void 0&&(dt=0),bt===void 0&&(bt=0),Ht===void 0&&(Ht=0),ke(gt);var Dt=[];ne(Ye,function(Vt,mt,Ft,it){Dt.push(Vt,mt,Ft,it)}),Dt=new Float32Array(Dt),ge(gt,function(Vt){var mt=Vt.gl,Ft=Vt.isWebGL2,it=Vt.getExtension,Lt=Vt.withProgram,Et=Vt.withTexture,Ut=Vt.withTextureFramebuffer,Zt=Vt.handleContextLoss;if(Et("rawDistances",function(Ot,Tt){(qe!==Ot._lastWidth||Pe!==Ot._lastHeight)&&mt.texImage2D(mt.TEXTURE_2D,0,mt.RGBA,Ot._lastWidth=qe,Ot._lastHeight=Pe,0,mt.RGBA,mt.UNSIGNED_BYTE,null),Lt("main",Be,Re,function(Je){var Oe=Je.setAttribute,lt=Je.setUniform,ft=!Ft&&it("ANGLE_instanced_arrays"),St=!Ft&&it("EXT_blend_minmax");Oe("aUV",2,mt.STATIC_DRAW,0,Ee),Oe("aLineSegment",4,mt.DYNAMIC_DRAW,1,Dt),lt.apply(void 0,["4f","uGlyphBounds"].concat($e)),lt("1f","uMaxDistance",ut),lt("1f","uExponent",ot),Ut(Ot,Tt,function(Wt){mt.enable(mt.BLEND),mt.colorMask(!0,!0,!0,!0),mt.viewport(0,0,qe,Pe),mt.scissor(0,0,qe,Pe),mt.blendFunc(mt.ONE,mt.ONE),mt.blendEquationSeparate(mt.FUNC_ADD,Ft?mt.MAX:St.MAX_EXT),mt.clear(mt.COLOR_BUFFER_BIT),Ft?mt.drawArraysInstanced(mt.TRIANGLES,0,3,Dt.length/4):ft.drawArraysInstancedANGLE(mt.TRIANGLES,0,3,Dt.length/4)})}),Lt("post",ie,Ve,function(Je){Je.setAttribute("aUV",2,mt.STATIC_DRAW,0,Ee),Je.setUniform("1i","tex",Tt),mt.bindFramebuffer(mt.FRAMEBUFFER,ht),mt.disable(mt.BLEND),mt.colorMask(Ht===0,Ht===1,Ht===2,Ht===3),mt.viewport(dt,bt,qe,Pe),mt.scissor(dt,bt,qe,Pe),mt.drawArrays(mt.TRIANGLES,0,3)})}),mt.isContextLost())throw Zt(),new Error("webgl context lost")})}function rt(qe){var Pe=!qe||qe===Ze?Fe:qe.canvas||qe,Ye=Te.get(Pe);if(Ye===void 0){_e=!0;var $e=null;try{var ut=[97,106,97,61,99,137,118,80,80,118,137,99,61,97,106,97],ot=Le(4,4,"M8,8L16,8L24,24L16,24Z",[0,0,32,32],24,1,qe);Ye=ot&&ut.length===ot.length&&ot.every(function(gt,ht){return gt===ut[ht]}),Ye||($e="bad trial run results",console.info(ut,ot))}catch(gt){Ye=!1,$e=gt.message}$e&&console.warn("WebGL SDF generation not supported:",$e),_e=!1,Te.set(Pe,Ye)}return Ye}var tt=Object.freeze({__proto__:null,generate:Le,generateIntoCanvas:Ke,generateIntoFramebuffer:Ue,isSupported:rt});function at(qe,Pe,Ye,$e,ut,ot){ut===void 0&&(ut=Math.max($e[2]-$e[0],$e[3]-$e[1])/2),ot===void 0&&(ot=1);try{return Le.apply(tt,arguments)}catch(gt){return console.info("WebGL SDF generation failed, falling back to JS",gt),fe.apply(ve,arguments)}}function ze(qe,Pe,Ye,$e,ut,ot,gt,ht,dt,bt){ut===void 0&&(ut=Math.max($e[2]-$e[0],$e[3]-$e[1])/2),ot===void 0&&(ot=1),ht===void 0&&(ht=0),dt===void 0&&(dt=0),bt===void 0&&(bt=0);try{return Ke.apply(tt,arguments)}catch(Ht){return console.info("WebGL SDF generation failed, falling back to JS",Ht),be.apply(ve,arguments)}}return Z.forEachPathCommand=te,Z.generate=at,Z.generateIntoCanvas=ze,Z.javascript=ve,Z.pathToLineSegments=ne,Z.webgl=tt,Z.webglUtils=Ie,Object.defineProperty(Z,"__esModule",{value:!0}),Z}({});return X}function bidiFactory(){var X=function(Z){var _={R:"13k,1a,2,3,3,2+1j,ch+16,a+1,5+2,2+n,5,a,4,6+16,4+3,h+1b,4mo,179q,2+9,2+11,2i9+7y,2+68,4,3+4,5+13,4+3,2+4k,3+29,8+cf,1t+7z,w+17,3+3m,1t+3z,16o1+5r,8+30,8+mc,29+1r,29+4v,75+73",EN:"1c+9,3d+1,6,187+9,513,4+5,7+9,sf+j,175h+9,qw+q,161f+1d,4xt+a,25i+9",ES:"17,2,6dp+1,f+1,av,16vr,mx+1,4o,2",ET:"z+2,3h+3,b+1,ym,3e+1,2o,p4+1,8,6u,7c,g6,1wc,1n9+4,30+1b,2n,6d,qhx+1,h0m,a+1,49+2,63+1,4+1,6bb+3,12jj",AN:"16o+5,2j+9,2+1,35,ed,1ff2+9,87+u",CS:"18,2+1,b,2u,12k,55v,l,17v0,2,3,53,2+1,b",B:"a,3,f+2,2v,690",S:"9,2,k",WS:"c,k,4f4,1vk+a,u,1j,335",ON:"x+1,4+4,h+5,r+5,r+3,z,5+3,2+1,2+1,5,2+2,3+4,o,w,ci+1,8+d,3+d,6+8,2+g,39+1,9,6+1,2,33,b8,3+1,3c+1,7+1,5r,b,7h+3,sa+5,2,3i+6,jg+3,ur+9,2v,ij+1,9g+9,7+a,8m,4+1,49+x,14u,2+2,c+2,e+2,e+2,e+1,i+n,e+e,2+p,u+2,e+2,36+1,2+3,2+1,b,2+2,6+5,2,2,2,h+1,5+4,6+3,3+f,16+2,5+3l,3+81,1y+p,2+40,q+a,m+13,2r+ch,2+9e,75+hf,3+v,2+2w,6e+5,f+6,75+2a,1a+p,2+2g,d+5x,r+b,6+3,4+o,g,6+1,6+2,2k+1,4,2j,5h+z,1m+1,1e+f,t+2,1f+e,d+3,4o+3,2s+1,w,535+1r,h3l+1i,93+2,2s,b+1,3l+x,2v,4g+3,21+3,kz+1,g5v+1,5a,j+9,n+v,2,3,2+8,2+1,3+2,2,3,46+1,4+4,h+5,r+5,r+a,3h+2,4+6,b+4,78,1r+24,4+c,4,1hb,ey+6,103+j,16j+c,1ux+7,5+g,fsh,jdq+1t,4,57+2e,p1,1m,1m,1m,1m,4kt+1,7j+17,5+2r,d+e,3+e,2+e,2+10,m+4,w,1n+5,1q,4z+5,4b+rb,9+c,4+c,4+37,d+2g,8+b,l+b,5+1j,9+9,7+13,9+t,3+1,27+3c,2+29,2+3q,d+d,3+4,4+2,6+6,a+o,8+6,a+2,e+6,16+42,2+1i",BN:"0+8,6+d,2s+5,2+p,e,4m9,1kt+2,2b+5,5+5,17q9+v,7k,6p+8,6+1,119d+3,440+7,96s+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+75,6p+2rz,1ben+1,1ekf+1,1ekf+1",NSM:"lc+33,7o+6,7c+18,2,2+1,2+1,2,21+a,1d+k,h,2u+6,3+5,3+1,2+3,10,v+q,2k+a,1n+8,a,p+3,2+8,2+2,2+4,18+2,3c+e,2+v,1k,2,5+7,5,4+6,b+1,u,1n,5+3,9,l+1,r,3+1,1m,5+1,5+1,3+2,4,v+1,4,c+1,1m,5+4,2+1,5,l+1,n+5,2,1n,3,2+3,9,8+1,c+1,v,1q,d,1f,4,1m+2,6+2,2+3,8+1,c+1,u,1n,g+1,l+1,t+1,1m+1,5+3,9,l+1,u,21,8+2,2,2j,3+6,d+7,2r,3+8,c+5,23+1,s,2,2,1k+d,2+4,2+1,6+a,2+z,a,2v+3,2+5,2+1,3+1,q+1,5+2,h+3,e,3+1,7,g,jk+2,qb+2,u+2,u+1,v+1,1t+1,2+6,9,3+a,a,1a+2,3c+1,z,3b+2,5+1,a,7+2,64+1,3,1n,2+6,2,2,3+7,7+9,3,1d+g,1s+3,1d,2+4,2,6,15+8,d+1,x+3,3+1,2+2,1l,2+1,4,2+2,1n+7,3+1,49+2,2+c,2+6,5,7,4+1,5j+1l,2+4,k1+w,2db+2,3y,2p+v,ff+3,30+1,n9x+3,2+9,x+1,29+1,7l,4,5,q+1,6,48+1,r+h,e,13+7,q+a,1b+2,1d,3+3,3+1,14,1w+5,3+1,3+1,d,9,1c,1g,2+2,3+1,6+1,2,17+1,9,6n,3,5,fn5,ki+f,h+f,r2,6b,46+4,1af+2,2+1,6+3,15+2,5,4m+1,fy+3,as+1,4a+a,4x,1j+e,1l+2,1e+3,3+1,1y+2,11+4,2+7,1r,d+1,1h+8,b+3,3,2o+2,3,2+1,7,4h,4+7,m+1,1m+1,4,12+6,4+4,5g+7,3+2,2,o,2d+5,2,5+1,2+1,6n+3,7+1,2+1,s+1,2e+7,3,2+1,2z,2,3+5,2,2u+2,3+3,2+4,78+8,2+1,75+1,2,5,41+3,3+1,5,x+5,3+1,15+5,3+3,9,a+5,3+2,1b+c,2+1,bb+6,2+5,2d+l,3+6,2+1,2+1,3f+5,4,2+1,2+6,2,21+1,4,2,9o+1,f0c+4,1o+6,t5,1s+3,2a,f5l+1,43t+2,i+7,3+6,v+3,45+2,1j0+1i,5+1d,9,f,n+4,2+e,11t+6,2+g,3+6,2+1,2+4,7a+6,c6+3,15t+6,32+6,gzhy+6n",AL:"16w,3,2,e+1b,z+2,2+2s,g+1,8+1,b+m,2+t,s+2i,c+e,4h+f,1d+1e,1bwe+dp,3+3z,x+c,2+1,35+3y,2rm+z,5+7,b+5,dt+l,c+u,17nl+27,1t+27,4x+6n,3+d",LRO:"6ct",RLO:"6cu",LRE:"6cq",RLE:"6cr",PDF:"6cs",LRI:"6ee",RLI:"6ef",FSI:"6eg",PDI:"6eh"},K={},te={};K.L=1,te[1]="L",Object.keys(_).forEach(function(Zt,Ot){K[Zt]=1<<Ot+1,te[K[Zt]]=Zt}),Object.freeze(K);var ne=K.LRI|K.RLI|K.FSI,ie=K.L|K.R|K.AL,oe=K.B|K.S|K.WS|K.ON|K.FSI|K.LRI|K.RLI|K.PDI,se=K.BN|K.RLE|K.LRE|K.RLO|K.LRO|K.PDF,ae=K.S|K.WS|K.B|ne|K.PDI|se,ge=null;function ce(){if(!ge){ge=new Map;var Zt=function(Tt){if(_.hasOwnProperty(Tt)){var Je=0;_[Tt].split(",").forEach(function(Oe){var lt=Oe.split("+"),ft=lt[0],St=lt[1];ft=parseInt(ft,36),St=St?parseInt(St,36):0,ge.set(Je+=ft,K[Tt]);for(var Wt=0;Wt<St;Wt++)ge.set(++Je,K[Tt])})}};for(var Ot in _)Zt(Ot)}}function de(Zt){return ce(),ge.get(Zt.codePointAt(0))||K.L}function Ie(Zt){return te[de(Zt)]}var fe={pairs:"14>1,1e>2,u>2,2wt>1,1>1,1ge>1,1wp>1,1j>1,f>1,hm>1,1>1,u>1,u6>1,1>1,+5,28>1,w>1,1>1,+3,b8>1,1>1,+3,1>3,-1>-1,3>1,1>1,+2,1s>1,1>1,x>1,th>1,1>1,+2,db>1,1>1,+3,3>1,1>1,+2,14qm>1,1>1,+1,4q>1,1e>2,u>2,2>1,+1",canonical:"6f1>-6dx,6dy>-6dx,6ec>-6ed,6ee>-6ed,6ww>2jj,-2ji>2jj,14r4>-1e7l,1e7m>-1e7l,1e7m>-1e5c,1e5d>-1e5b,1e5c>-14qx,14qy>-14qx,14vn>-1ecg,1ech>-1ecg,1edu>-1ecg,1eci>-1ecg,1eda>-1ecg,1eci>-1ecg,1eci>-168q,168r>-168q,168s>-14ye,14yf>-14ye"};function be(Zt,Ot){var Tt=36,Je=0,Oe=new Map,lt=Ot&&new Map,ft;return Zt.split(",").forEach(function St(Wt){if(Wt.indexOf("+")!==-1)for(var zt=+Wt;zt--;)St(ft);else{ft=Wt;var $t=Wt.split(">"),rn=$t[0],Gn=$t[1];rn=String.fromCodePoint(Je+=parseInt(rn,Tt)),Gn=String.fromCodePoint(Je+=parseInt(Gn,Tt)),Oe.set(rn,Gn),Ot&&lt.set(Gn,rn)}}),{map:Oe,reverseMap:lt}}var Ae,ye,ve;function Be(){if(!Ae){var Zt=be(fe.pairs,!0),Ot=Zt.map,Tt=Zt.reverseMap;Ae=Ot,ye=Tt,ve=be(fe.canonical,!1).map}}function Re(Zt){return Be(),Ae.get(Zt)||null}function Ve(Zt){return Be(),ye.get(Zt)||null}function Ee(Zt){return Be(),ve.get(Zt)||null}var Ze=K.L,_e=K.R,Fe=K.EN,Te=K.ES,ke=K.ET,Le=K.AN,Ke=K.CS,Ue=K.B,rt=K.S,tt=K.ON,at=K.BN,ze=K.NSM,qe=K.AL,Pe=K.LRO,Ye=K.RLO,$e=K.LRE,ut=K.RLE,ot=K.PDF,gt=K.LRI,ht=K.RLI,dt=K.FSI,bt=K.PDI;function Ht(Zt,Ot){for(var Tt=125,Je=new Uint32Array(Zt.length),Oe=0;Oe<Zt.length;Oe++)Je[Oe]=de(Zt[Oe]);var lt=new Map;function ft(Jr,ti){var Pr=Je[Jr];Je[Jr]=ti,lt.set(Pr,lt.get(Pr)-1),Pr&oe&&lt.set(oe,lt.get(oe)-1),lt.set(ti,(lt.get(ti)||0)+1),ti&oe&&lt.set(oe,(lt.get(oe)||0)+1)}for(var St=new Uint8Array(Zt.length),Wt=new Map,zt=[],$t=null,rn=0;rn<Zt.length;rn++)$t||zt.push($t={start:rn,end:Zt.length-1,level:Ot==="rtl"?1:Ot==="ltr"?0:li(rn,!1)}),Je[rn]&Ue&&($t.end=rn,$t=null);for(var Gn=ut|$e|Ye|Pe|ne|bt|ot|Ue,en=function(Jr){return Jr+(Jr&1?1:2)},In=function(Jr){return Jr+(Jr&1?2:1)},un=0;un<zt.length;un++){$t=zt[un];var ln=[{_level:$t.level,_override:0,_isolate:0}],tn=void 0,Sn=0,yn=0,Tn=0;lt.clear();for(var vt=$t.start;vt<=$t.end;vt++){var wt=Je[vt];if(tn=ln[ln.length-1],lt.set(wt,(lt.get(wt)||0)+1),wt&oe&&lt.set(oe,(lt.get(oe)||0)+1),wt&Gn)if(wt&(ut|$e)){St[vt]=tn._level;var Mt=(wt===ut?In:en)(tn._level);Mt<=Tt&&!Sn&&!yn?ln.push({_level:Mt,_override:0,_isolate:0}):Sn||yn++}else if(wt&(Ye|Pe)){St[vt]=tn._level;var on=(wt===Ye?In:en)(tn._level);on<=Tt&&!Sn&&!yn?ln.push({_level:on,_override:wt&Ye?_e:Ze,_isolate:0}):Sn||yn++}else if(wt&ne){wt&dt&&(wt=li(vt+1,!0)===1?ht:gt),St[vt]=tn._level,tn._override&&ft(vt,tn._override);var dn=(wt===ht?In:en)(tn._level);dn<=Tt&&Sn===0&&yn===0?(Tn++,ln.push({_level:dn,_override:0,_isolate:1,_isolInitIndex:vt})):Sn++}else if(wt&bt){if(Sn>0)Sn--;else if(Tn>0){for(yn=0;!ln[ln.length-1]._isolate;)ln.pop();var an=ln[ln.length-1]._isolInitIndex;an!=null&&(Wt.set(an,vt),Wt.set(vt,an)),ln.pop(),Tn--}tn=ln[ln.length-1],St[vt]=tn._level,tn._override&&ft(vt,tn._override)}else wt&ot?(Sn===0&&(yn>0?yn--:!tn._isolate&&ln.length>1&&(ln.pop(),tn=ln[ln.length-1])),St[vt]=tn._level):wt&Ue&&(St[vt]=$t.level);else St[vt]=tn._level,tn._override&&wt!==at&&ft(vt,tn._override)}for(var Mn=[],Pn=null,Nn=$t.start;Nn<=$t.end;Nn++){var kn=Je[Nn];if(!(kn&se)){var Ir=St[Nn],dr=kn&ne,vr=kn===bt;Pn&&Ir===Pn._level?(Pn._end=Nn,Pn._endsWithIsolInit=dr):Mn.push(Pn={_start:Nn,_end:Nn,_level:Ir,_startsWithPDI:vr,_endsWithIsolInit:dr})}}for(var Yr=[],Fr=0;Fr<Mn.length;Fr++){var Nr=Mn[Fr];if(!Nr._startsWithPDI||Nr._startsWithPDI&&!Wt.has(Nr._start)){for(var Kr=[Pn=Nr],_r=void 0;Pn&&Pn._endsWithIsolInit&&(_r=Wt.get(Pn._end))!=null;)for(var Un=Fr+1;Un<Mn.length;Un++)if(Mn[Un]._start===_r){Kr.push(Pn=Mn[Un]);break}for(var Lr=[],Bi=0;Bi<Kr.length;Bi++)for(var je=Kr[Bi],st=je._start;st<=je._end;st++)Lr.push(st);for(var yt=St[Lr[0]],Yt=$t.level,jt=Lr[0]-1;jt>=0;jt--)if(!(Je[jt]&se)){Yt=St[jt];break}var Jt=Lr[Lr.length-1],fn=St[Jt],pn=$t.level;if(!(Je[Jt]&ne)){for(var Qe=Jt+1;Qe<=$t.end;Qe++)if(!(Je[Qe]&se)){pn=St[Qe];break}}Yr.push({_seqIndices:Lr,_sosType:Math.max(Yt,yt)%2?_e:Ze,_eosType:Math.max(pn,fn)%2?_e:Ze})}}for(var pt=0;pt<Yr.length;pt++){var At=Yr[pt],ct=At._seqIndices,Bt=At._sosType,Xt=At._eosType,Qt=St[ct[0]]&1?_e:Ze;if(lt.get(ze))for(var sn=0;sn<ct.length;sn++){var cn=ct[sn];if(Je[cn]&ze){for(var Bn=Bt,bn=sn-1;bn>=0;bn--)if(!(Je[ct[bn]]&se)){Bn=Je[ct[bn]];break}ft(cn,Bn&(ne|bt)?tt:Bn)}}if(lt.get(Fe))for(var gn=0;gn<ct.length;gn++){var xn=ct[gn];if(Je[xn]&Fe)for(var wn=gn-1;wn>=-1;wn--){var Jn=wn===-1?Bt:Je[ct[wn]];if(Jn&ie){Jn===qe&&ft(xn,Le);break}}}if(lt.get(qe))for(var Wn=0;Wn<ct.length;Wn++){var Hn=ct[Wn];Je[Hn]&qe&&ft(Hn,_e)}if(lt.get(Te)||lt.get(Ke))for(var Zn=1;Zn<ct.length-1;Zn++){var nr=ct[Zn];if(Je[nr]&(Te|Ke)){for(var Kn=0,er=0,Ar=Zn-1;Ar>=0&&(Kn=Je[ct[Ar]],!!(Kn&se));Ar--);for(var tr=Zn+1;tr<ct.length&&(er=Je[ct[tr]],!!(er&se));tr++);Kn===er&&(Je[nr]===Te?Kn===Fe:Kn&(Fe|Le))&&ft(nr,Kn)}}if(lt.get(Fe))for(var Qn=0;Qn<ct.length;Qn++){var On=ct[Qn];if(Je[On]&Fe){for(var br=Qn-1;br>=0&&Je[ct[br]]&(ke|se);br--)ft(ct[br],Fe);for(Qn++;Qn<ct.length&&Je[ct[Qn]]&(ke|se|Fe);Qn++)Je[ct[Qn]]!==Fe&&ft(ct[Qn],Fe)}}if(lt.get(ke)||lt.get(Te)||lt.get(Ke))for(var ur=0;ur<ct.length;ur++){var yr=ct[ur];if(Je[yr]&(ke|Te|Ke)){ft(yr,tt);for(var Rr=ur-1;Rr>=0&&Je[ct[Rr]]&se;Rr--)ft(ct[Rr],tt);for(var lr=ur+1;lr<ct.length&&Je[ct[lr]]&se;lr++)ft(ct[lr],tt)}}if(lt.get(Fe))for(var ii=0,hs=Bt;ii<ct.length;ii++){var aa=ct[ii],la=Je[aa];la&Fe?hs===Ze&&ft(aa,Ze):la&ie&&(hs=la)}if(lt.get(oe)){var Zo=_e|Fe|Le,Fs=Zo|Ze,oo=[];{for(var Ao=[],hi=0;hi<ct.length;hi++)if(Je[ct[hi]]&oe){var rr=Zt[ct[hi]],so=void 0;if(Re(rr)!==null)if(Ao.length<63)Ao.push({char:rr,seqIndex:hi});else break;else if((so=Ve(rr))!==null)for(var Ui=Ao.length-1;Ui>=0;Ui--){var _o=Ao[Ui].char;if(_o===so||_o===Ve(Ee(rr))||Re(Ee(_o))===rr){oo.push([Ao[Ui].seqIndex,hi]),Ao.length=Ui;break}}}oo.sort(function(Jr,ti){return Jr[0]-ti[0]})}for(var ao=0;ao<oo.length;ao++){for(var Al=oo[ao],Wr=Al[0],mo=Al[1],ml=!1,Gi=0,Cs=Wr+1;Cs<mo;Cs++){var fs=ct[Cs];if(Je[fs]&Fs){ml=!0;var Pi=Je[fs]&Zo?_e:Ze;if(Pi===Qt){Gi=Pi;break}}}if(ml&&!Gi){Gi=Bt;for(var Xo=Wr-1;Xo>=0;Xo--){var As=ct[Xo];if(Je[As]&Fs){var oi=Je[As]&Zo?_e:Ze;oi!==Qt?Gi=oi:Gi=Qt;break}}}if(Gi){if(Je[ct[Wr]]=Je[ct[mo]]=Gi,Gi!==Qt){for(var si=Wr+1;si<ct.length;si++)if(!(Je[ct[si]]&se)){de(Zt[ct[si]])&ze&&(Je[ct[si]]=Gi);break}}if(Gi!==Qt){for(var Eo=mo+1;Eo<ct.length;Eo++)if(!(Je[ct[Eo]]&se)){de(Zt[ct[Eo]])&ze&&(Je[ct[Eo]]=Gi);break}}}}for(var lo=0;lo<ct.length;lo++)if(Je[ct[lo]]&oe){for(var Ws=lo,ms=lo,Si=Bt,bs=lo-1;bs>=0;bs--)if(Je[ct[bs]]&se)Ws=bs;else{Si=Je[ct[bs]]&Zo?_e:Ze;break}for(var Hi=Xt,ko=lo+1;ko<ct.length;ko++)if(Je[ct[ko]]&(oe|se))ms=ko;else{Hi=Je[ct[ko]]&Zo?_e:Ze;break}for(var ai=Ws;ai<=ms;ai++)Je[ct[ai]]=Si===Hi?Si:Qt;lo=ms}}}for(var ei=$t.start;ei<=$t.end;ei++){var Yo=St[ei],Xi=Je[ei];if(Yo&1?Xi&(Ze|Fe|Le)&&St[ei]++:Xi&_e?St[ei]++:Xi&(Le|Fe)&&(St[ei]+=2),Xi&se&&(St[ei]=ei===0?$t.level:St[ei-1]),ei===$t.end||de(Zt[ei])&(rt|Ue))for(var Ko=ei;Ko>=0&&de(Zt[Ko])&ae;Ko--)St[Ko]=$t.level}}return{levels:St,paragraphs:zt};function li(Jr,ti){for(var Pr=Jr;Pr<Zt.length;Pr++){var Hr=Je[Pr];if(Hr&(_e|qe))return 1;if(Hr&(Ue|Ze)||ti&&Hr===bt)return 0;if(Hr&ne){var Ei=Do(Pr);Pr=Ei===-1?Zt.length:Ei}}return 0}function Do(Jr){for(var ti=1,Pr=Jr+1;Pr<Zt.length;Pr++){var Hr=Je[Pr];if(Hr&Ue)break;if(Hr&bt){if(--ti===0)return Pr}else Hr&ne&&ti++}return-1}}var Dt="14>1,j>2,t>2,u>2,1a>g,2v3>1,1>1,1ge>1,1wd>1,b>1,1j>1,f>1,ai>3,-2>3,+1,8>1k0,-1jq>1y7,-1y6>1hf,-1he>1h6,-1h5>1ha,-1h8>1qi,-1pu>1,6>3u,-3s>7,6>1,1>1,f>1,1>1,+2,3>1,1>1,+13,4>1,1>1,6>1eo,-1ee>1,3>1mg,-1me>1mk,-1mj>1mi,-1mg>1mi,-1md>1,1>1,+2,1>10k,-103>1,1>1,4>1,5>1,1>1,+10,3>1,1>8,-7>8,+1,-6>7,+1,a>1,1>1,u>1,u6>1,1>1,+5,26>1,1>1,2>1,2>2,8>1,7>1,4>1,1>1,+5,b8>1,1>1,+3,1>3,-2>1,2>1,1>1,+2,c>1,3>1,1>1,+2,h>1,3>1,a>1,1>1,2>1,3>1,1>1,d>1,f>1,3>1,1a>1,1>1,6>1,7>1,13>1,k>1,1>1,+19,4>1,1>1,+2,2>1,1>1,+18,m>1,a>1,1>1,lk>1,1>1,4>1,2>1,f>1,3>1,1>1,+3,db>1,1>1,+3,3>1,1>1,+2,14qm>1,1>1,+1,6>1,4j>1,j>2,t>2,u>2,2>1,+1",Vt;function mt(){if(!Vt){var Zt=be(Dt,!0),Ot=Zt.map,Tt=Zt.reverseMap;Tt.forEach(function(Je,Oe){Ot.set(Oe,Je)}),Vt=Ot}}function Ft(Zt){return mt(),Vt.get(Zt)||null}function it(Zt,Ot,Tt,Je){var Oe=Zt.length;Tt=Math.max(0,Tt==null?0:+Tt),Je=Math.min(Oe-1,Je==null?Oe-1:+Je);for(var lt=new Map,ft=Tt;ft<=Je;ft++)if(Ot[ft]&1){var St=Ft(Zt[ft]);St!==null&&lt.set(ft,St)}return lt}function Lt(Zt,Ot,Tt,Je){var Oe=Zt.length;Tt=Math.max(0,Tt==null?0:+Tt),Je=Math.min(Oe-1,Je==null?Oe-1:+Je);var lt=[];return Ot.paragraphs.forEach(function(ft){var St=Math.max(Tt,ft.start),Wt=Math.min(Je,ft.end);if(St<Wt){for(var zt=Ot.levels.slice(St,Wt+1),$t=Wt;$t>=St&&de(Zt[$t])&ae;$t--)zt[$t]=ft.level;for(var rn=ft.level,Gn=1/0,en=0;en<zt.length;en++){var In=zt[en];In>rn&&(rn=In),In<Gn&&(Gn=In|1)}for(var un=rn;un>=Gn;un--)for(var ln=0;ln<zt.length;ln++)if(zt[ln]>=un){for(var tn=ln;ln+1<zt.length&&zt[ln+1]>=un;)ln++;ln>tn&&lt.push([tn+St,ln+St])}}}),lt}function Et(Zt,Ot,Tt,Je){var Oe=Ut(Zt,Ot,Tt,Je),lt=[].concat(Zt);return Oe.forEach(function(ft,St){lt[St]=(Ot.levels[ft]&1?Ft(Zt[ft]):null)||Zt[ft]}),lt.join("")}function Ut(Zt,Ot,Tt,Je){for(var Oe=Lt(Zt,Ot,Tt,Je),lt=[],ft=0;ft<Zt.length;ft++)lt[ft]=ft;return Oe.forEach(function(St){for(var Wt=St[0],zt=St[1],$t=lt.slice(Wt,zt+1),rn=$t.length;rn--;)lt[zt-rn]=$t[rn]}),lt}return Z.closingToOpeningBracket=Ve,Z.getBidiCharType=de,Z.getBidiCharTypeName=Ie,Z.getCanonicalBracket=Ee,Z.getEmbeddingLevels=Ht,Z.getMirroredCharacter=Ft,Z.getMirroredCharactersMap=it,Z.getReorderSegments=Lt,Z.getReorderedIndices=Ut,Z.getReorderedString=Et,Z.openingToClosingBracket=Re,Object.defineProperty(Z,"__esModule",{value:!0}),Z}({});return X}const voidMainRegExp=/\bvoid\s+main\s*\(\s*\)\s*{/g;function expandShaderIncludes(X){const Z=/^[ \t]*#include +<([\w\d./]+)>/gm;function _(K,te){let ne=ShaderChunk[te];return ne?expandShaderIncludes(ne):K}return X.replace(Z,_)}const _lut=[];for(let X=0;X<256;X++)_lut[X]=(X<16?"0":"")+X.toString(16);function generateUUID(){const X=Math.random()*4294967295|0,Z=Math.random()*4294967295|0,_=Math.random()*4294967295|0,K=Math.random()*4294967295|0;return(_lut[X&255]+_lut[X>>8&255]+_lut[X>>16&255]+_lut[X>>24&255]+"-"+_lut[Z&255]+_lut[Z>>8&255]+"-"+_lut[Z>>16&15|64]+_lut[Z>>24&255]+"-"+_lut[_&63|128]+_lut[_>>8&255]+"-"+_lut[_>>16&255]+_lut[_>>24&255]+_lut[K&255]+_lut[K>>8&255]+_lut[K>>16&255]+_lut[K>>24&255]).toUpperCase()}const assign$1=Object.assign||function(){let X=arguments[0];for(let Z=1,_=arguments.length;Z<_;Z++){let K=arguments[Z];if(K)for(let te in K)Object.prototype.hasOwnProperty.call(K,te)&&(X[te]=K[te])}return X},epoch=Date.now(),CONSTRUCTOR_CACHE=new WeakMap,SHADER_UPGRADE_CACHE=new Map;let materialInstanceId=1e10;function createDerivedMaterial(X,Z){const _=getKeyForOptions(Z);let K=CONSTRUCTOR_CACHE.get(X);if(K||CONSTRUCTOR_CACHE.set(X,K=Object.create(null)),K[_])return new K[_];const te=`_onBeforeCompile${_}`,ne=function(ae,ge){X.onBeforeCompile.call(this,ae,ge);const ce=this.customProgramCacheKey()+"|"+ae.vertexShader+"|"+ae.fragmentShader;let de=SHADER_UPGRADE_CACHE[ce];if(!de){const Ie=upgradeShaders(this,ae,Z,_);de=SHADER_UPGRADE_CACHE[ce]=Ie}ae.vertexShader=de.vertexShader,ae.fragmentShader=de.fragmentShader,assign$1(ae.uniforms,this.uniforms),Z.timeUniform&&(ae.uniforms[Z.timeUniform]={get value(){return Date.now()-epoch}}),this[te]&&this[te](ae)},ie=function(){return oe(Z.chained?X:X.clone())},oe=function(ae){const ge=Object.create(ae,se);return Object.defineProperty(ge,"baseMaterial",{value:X}),Object.defineProperty(ge,"id",{value:materialInstanceId++}),ge.uuid=generateUUID(),ge.uniforms=assign$1({},ae.uniforms,Z.uniforms),ge.defines=assign$1({},ae.defines,Z.defines),ge.defines[`TROIKA_DERIVED_MATERIAL_${_}`]="",ge.extensions=assign$1({},ae.extensions,Z.extensions),ge._listeners=void 0,ge},se={constructor:{value:ie},isDerivedMaterial:{value:!0},type:{get:()=>X.type,set:ae=>{X.type=ae}},isDerivedFrom:{writable:!0,configurable:!0,value:function(ae){const ge=this.baseMaterial;return ae===ge||ge.isDerivedMaterial&&ge.isDerivedFrom(ae)||!1}},customProgramCacheKey:{writable:!0,configurable:!0,value:function(){return X.customProgramCacheKey()+"|"+_}},onBeforeCompile:{get(){return ne},set(ae){this[te]=ae}},copy:{writable:!0,configurable:!0,value:function(ae){return X.copy.call(this,ae),!X.isShaderMaterial&&!X.isDerivedMaterial&&(assign$1(this.extensions,ae.extensions),assign$1(this.defines,ae.defines),assign$1(this.uniforms,UniformsUtils.clone(ae.uniforms))),this}},clone:{writable:!0,configurable:!0,value:function(){const ae=new X.constructor;return oe(ae).copy(this)}},getDepthMaterial:{writable:!0,configurable:!0,value:function(){let ae=this._depthMaterial;return ae||(ae=this._depthMaterial=createDerivedMaterial(X.isDerivedMaterial?X.getDepthMaterial():new MeshDepthMaterial({depthPacking:RGBADepthPacking}),Z),ae.defines.IS_DEPTH_MATERIAL="",ae.uniforms=this.uniforms),ae}},getDistanceMaterial:{writable:!0,configurable:!0,value:function(){let ae=this._distanceMaterial;return ae||(ae=this._distanceMaterial=createDerivedMaterial(X.isDerivedMaterial?X.getDistanceMaterial():new MeshDistanceMaterial,Z),ae.defines.IS_DISTANCE_MATERIAL="",ae.uniforms=this.uniforms),ae}},dispose:{writable:!0,configurable:!0,value(){const{_depthMaterial:ae,_distanceMaterial:ge}=this;ae&&ae.dispose(),ge&&ge.dispose(),X.dispose.call(this)}}};return K[_]=ie,new ie}function upgradeShaders(X,{vertexShader:Z,fragmentShader:_},K,te){let{vertexDefs:ne,vertexMainIntro:ie,vertexMainOutro:oe,vertexTransform:se,fragmentDefs:ae,fragmentMainIntro:ge,fragmentMainOutro:ce,fragmentColorTransform:de,customRewriter:Ie,timeUniform:fe}=K;if(ne=ne||"",ie=ie||"",oe=oe||"",ae=ae||"",ge=ge||"",ce=ce||"",(se||Ie)&&(Z=expandShaderIncludes(Z)),(de||Ie)&&(_=_.replace(/^[ \t]*#include <((?:tonemapping|encodings|colorspace|fog|premultiplied_alpha|dithering)_fragment)>/gm,`
//!BEGIN_POST_CHUNK $1
$&
//!END_POST_CHUNK
`),_=expandShaderIncludes(_)),Ie){let be=Ie({vertexShader:Z,fragmentShader:_});Z=be.vertexShader,_=be.fragmentShader}if(de){let be=[];_=_.replace(/^\/\/!BEGIN_POST_CHUNK[^]+?^\/\/!END_POST_CHUNK/gm,Ae=>(be.push(Ae),"")),ce=`${de}
${be.join(`
`)}
${ce}`}if(fe){const be=`
uniform float ${fe};
`;ne=be+ne,ae=be+ae}return se&&(Z=`vec3 troika_position_${te};
vec3 troika_normal_${te};
vec2 troika_uv_${te};
${Z}
`,ne=`${ne}
void troikaVertexTransform${te}(inout vec3 position, inout vec3 normal, inout vec2 uv) {
  ${se}
}
`,ie=`
troika_position_${te} = vec3(position);
troika_normal_${te} = vec3(normal);
troika_uv_${te} = vec2(uv);
troikaVertexTransform${te}(troika_position_${te}, troika_normal_${te}, troika_uv_${te});
${ie}
`,Z=Z.replace(/\b(position|normal|uv)\b/g,(be,Ae,ye,ve)=>/\battribute\s+vec[23]\s+$/.test(ve.substr(0,ye))?Ae:`troika_${Ae}_${te}`),X.map&&X.map.channel>0||(Z=Z.replace(/\bMAP_UV\b/g,`troika_uv_${te}`))),Z=injectIntoShaderCode(Z,te,ne,ie,oe),_=injectIntoShaderCode(_,te,ae,ge,ce),{vertexShader:Z,fragmentShader:_}}function injectIntoShaderCode(X,Z,_,K,te){return(K||te||_)&&(X=X.replace(voidMainRegExp,`
${_}
void troikaOrigMain${Z}() {`),X+=`
void main() {
  ${K}
  troikaOrigMain${Z}();
  ${te}
}`),X}function optionsJsonReplacer(X,Z){return X==="uniforms"?void 0:typeof Z=="function"?Z.toString():Z}let _idCtr=0;const optionsHashesToIds=new Map;function getKeyForOptions(X){const Z=JSON.stringify(X,optionsJsonReplacer);let _=optionsHashesToIds.get(Z);return _==null&&optionsHashesToIds.set(Z,_=++_idCtr),_}/*!
Custom build of Typr.ts (https://github.com/fredli74/Typr.ts) for use in Troika text rendering.
Original MIT license applies: https://github.com/fredli74/Typr.ts/blob/master/LICENSE
*/function typrFactory(){return typeof window>"u"&&(self.window=self),function(X){var Z={parse:function(te){var ne=Z._bin,ie=new Uint8Array(te);if(ne.readASCII(ie,0,4)=="ttcf"){var oe=4;ne.readUshort(ie,oe),oe+=2,ne.readUshort(ie,oe),oe+=2;var se=ne.readUint(ie,oe);oe+=4;for(var ae=[],ge=0;ge<se;ge++){var ce=ne.readUint(ie,oe);oe+=4,ae.push(Z._readFont(ie,ce))}return ae}return[Z._readFont(ie,0)]},_readFont:function(te,ne){var ie=Z._bin,oe=ne;ie.readFixed(te,ne),ne+=4;var se=ie.readUshort(te,ne);ne+=2,ie.readUshort(te,ne),ne+=2,ie.readUshort(te,ne),ne+=2,ie.readUshort(te,ne),ne+=2;for(var ae=["cmap","head","hhea","maxp","hmtx","name","OS/2","post","loca","glyf","kern","CFF ","GDEF","GPOS","GSUB","SVG "],ge={_data:te,_offset:oe},ce={},de=0;de<se;de++){var Ie=ie.readASCII(te,ne,4);ne+=4,ie.readUint(te,ne),ne+=4;var fe=ie.readUint(te,ne);ne+=4;var be=ie.readUint(te,ne);ne+=4,ce[Ie]={offset:fe,length:be}}for(de=0;de<ae.length;de++){var Ae=ae[de];ce[Ae]&&(ge[Ae.trim()]=Z[Ae.trim()].parse(te,ce[Ae].offset,ce[Ae].length,ge))}return ge},_tabOffset:function(te,ne,ie){for(var oe=Z._bin,se=oe.readUshort(te,ie+4),ae=ie+12,ge=0;ge<se;ge++){var ce=oe.readASCII(te,ae,4);ae+=4,oe.readUint(te,ae),ae+=4;var de=oe.readUint(te,ae);if(ae+=4,oe.readUint(te,ae),ae+=4,ce==ne)return de}return 0}};Z._bin={readFixed:function(te,ne){return(te[ne]<<8|te[ne+1])+(te[ne+2]<<8|te[ne+3])/65540},readF2dot14:function(te,ne){return Z._bin.readShort(te,ne)/16384},readInt:function(te,ne){return Z._bin._view(te).getInt32(ne)},readInt8:function(te,ne){return Z._bin._view(te).getInt8(ne)},readShort:function(te,ne){return Z._bin._view(te).getInt16(ne)},readUshort:function(te,ne){return Z._bin._view(te).getUint16(ne)},readUshorts:function(te,ne,ie){for(var oe=[],se=0;se<ie;se++)oe.push(Z._bin.readUshort(te,ne+2*se));return oe},readUint:function(te,ne){return Z._bin._view(te).getUint32(ne)},readUint64:function(te,ne){return 4294967296*Z._bin.readUint(te,ne)+Z._bin.readUint(te,ne+4)},readASCII:function(te,ne,ie){for(var oe="",se=0;se<ie;se++)oe+=String.fromCharCode(te[ne+se]);return oe},readUnicode:function(te,ne,ie){for(var oe="",se=0;se<ie;se++){var ae=te[ne++]<<8|te[ne++];oe+=String.fromCharCode(ae)}return oe},_tdec:typeof window<"u"&&window.TextDecoder?new window.TextDecoder:null,readUTF8:function(te,ne,ie){var oe=Z._bin._tdec;return oe&&ne==0&&ie==te.length?oe.decode(te):Z._bin.readASCII(te,ne,ie)},readBytes:function(te,ne,ie){for(var oe=[],se=0;se<ie;se++)oe.push(te[ne+se]);return oe},readASCIIArray:function(te,ne,ie){for(var oe=[],se=0;se<ie;se++)oe.push(String.fromCharCode(te[ne+se]));return oe},_view:function(te){return te._dataView||(te._dataView=te.buffer?new DataView(te.buffer,te.byteOffset,te.byteLength):new DataView(new Uint8Array(te).buffer))}},Z._lctf={},Z._lctf.parse=function(te,ne,ie,oe,se){var ae=Z._bin,ge={},ce=ne;ae.readFixed(te,ne),ne+=4;var de=ae.readUshort(te,ne);ne+=2;var Ie=ae.readUshort(te,ne);ne+=2;var fe=ae.readUshort(te,ne);return ne+=2,ge.scriptList=Z._lctf.readScriptList(te,ce+de),ge.featureList=Z._lctf.readFeatureList(te,ce+Ie),ge.lookupList=Z._lctf.readLookupList(te,ce+fe,se),ge},Z._lctf.readLookupList=function(te,ne,ie){var oe=Z._bin,se=ne,ae=[],ge=oe.readUshort(te,ne);ne+=2;for(var ce=0;ce<ge;ce++){var de=oe.readUshort(te,ne);ne+=2;var Ie=Z._lctf.readLookupTable(te,se+de,ie);ae.push(Ie)}return ae},Z._lctf.readLookupTable=function(te,ne,ie){var oe=Z._bin,se=ne,ae={tabs:[]};ae.ltype=oe.readUshort(te,ne),ne+=2,ae.flag=oe.readUshort(te,ne),ne+=2;var ge=oe.readUshort(te,ne);ne+=2;for(var ce=ae.ltype,de=0;de<ge;de++){var Ie=oe.readUshort(te,ne);ne+=2;var fe=ie(te,ce,se+Ie,ae);ae.tabs.push(fe)}return ae},Z._lctf.numOfOnes=function(te){for(var ne=0,ie=0;ie<32;ie++)te>>>ie&1&&ne++;return ne},Z._lctf.readClassDef=function(te,ne){var ie=Z._bin,oe=[],se=ie.readUshort(te,ne);if(ne+=2,se==1){var ae=ie.readUshort(te,ne);ne+=2;var ge=ie.readUshort(te,ne);ne+=2;for(var ce=0;ce<ge;ce++)oe.push(ae+ce),oe.push(ae+ce),oe.push(ie.readUshort(te,ne)),ne+=2}if(se==2){var de=ie.readUshort(te,ne);for(ne+=2,ce=0;ce<de;ce++)oe.push(ie.readUshort(te,ne)),ne+=2,oe.push(ie.readUshort(te,ne)),ne+=2,oe.push(ie.readUshort(te,ne)),ne+=2}return oe},Z._lctf.getInterval=function(te,ne){for(var ie=0;ie<te.length;ie+=3){var oe=te[ie],se=te[ie+1];if(te[ie+2],oe<=ne&&ne<=se)return ie}return-1},Z._lctf.readCoverage=function(te,ne){var ie=Z._bin,oe={};oe.fmt=ie.readUshort(te,ne),ne+=2;var se=ie.readUshort(te,ne);return ne+=2,oe.fmt==1&&(oe.tab=ie.readUshorts(te,ne,se)),oe.fmt==2&&(oe.tab=ie.readUshorts(te,ne,3*se)),oe},Z._lctf.coverageIndex=function(te,ne){var ie=te.tab;if(te.fmt==1)return ie.indexOf(ne);if(te.fmt==2){var oe=Z._lctf.getInterval(ie,ne);if(oe!=-1)return ie[oe+2]+(ne-ie[oe])}return-1},Z._lctf.readFeatureList=function(te,ne){var ie=Z._bin,oe=ne,se=[],ae=ie.readUshort(te,ne);ne+=2;for(var ge=0;ge<ae;ge++){var ce=ie.readASCII(te,ne,4);ne+=4;var de=ie.readUshort(te,ne);ne+=2;var Ie=Z._lctf.readFeatureTable(te,oe+de);Ie.tag=ce.trim(),se.push(Ie)}return se},Z._lctf.readFeatureTable=function(te,ne){var ie=Z._bin,oe=ne,se={},ae=ie.readUshort(te,ne);ne+=2,ae>0&&(se.featureParams=oe+ae);var ge=ie.readUshort(te,ne);ne+=2,se.tab=[];for(var ce=0;ce<ge;ce++)se.tab.push(ie.readUshort(te,ne+2*ce));return se},Z._lctf.readScriptList=function(te,ne){var ie=Z._bin,oe=ne,se={},ae=ie.readUshort(te,ne);ne+=2;for(var ge=0;ge<ae;ge++){var ce=ie.readASCII(te,ne,4);ne+=4;var de=ie.readUshort(te,ne);ne+=2,se[ce.trim()]=Z._lctf.readScriptTable(te,oe+de)}return se},Z._lctf.readScriptTable=function(te,ne){var ie=Z._bin,oe=ne,se={},ae=ie.readUshort(te,ne);ne+=2,ae>0&&(se.default=Z._lctf.readLangSysTable(te,oe+ae));var ge=ie.readUshort(te,ne);ne+=2;for(var ce=0;ce<ge;ce++){var de=ie.readASCII(te,ne,4);ne+=4;var Ie=ie.readUshort(te,ne);ne+=2,se[de.trim()]=Z._lctf.readLangSysTable(te,oe+Ie)}return se},Z._lctf.readLangSysTable=function(te,ne){var ie=Z._bin,oe={};ie.readUshort(te,ne),ne+=2,oe.reqFeature=ie.readUshort(te,ne),ne+=2;var se=ie.readUshort(te,ne);return ne+=2,oe.features=ie.readUshorts(te,ne,se),oe},Z.CFF={},Z.CFF.parse=function(te,ne,ie){var oe=Z._bin;(te=new Uint8Array(te.buffer,ne,ie))[ne=0],te[++ne],te[++ne],te[++ne],ne++;var se=[];ne=Z.CFF.readIndex(te,ne,se);for(var ae=[],ge=0;ge<se.length-1;ge++)ae.push(oe.readASCII(te,ne+se[ge],se[ge+1]-se[ge]));ne+=se[se.length-1];var ce=[];ne=Z.CFF.readIndex(te,ne,ce);var de=[];for(ge=0;ge<ce.length-1;ge++)de.push(Z.CFF.readDict(te,ne+ce[ge],ne+ce[ge+1]));ne+=ce[ce.length-1];var Ie=de[0],fe=[];ne=Z.CFF.readIndex(te,ne,fe);var be=[];for(ge=0;ge<fe.length-1;ge++)be.push(oe.readASCII(te,ne+fe[ge],fe[ge+1]-fe[ge]));if(ne+=fe[fe.length-1],Z.CFF.readSubrs(te,ne,Ie),Ie.CharStrings){ne=Ie.CharStrings,fe=[],ne=Z.CFF.readIndex(te,ne,fe);var Ae=[];for(ge=0;ge<fe.length-1;ge++)Ae.push(oe.readBytes(te,ne+fe[ge],fe[ge+1]-fe[ge]));Ie.CharStrings=Ae}if(Ie.ROS){ne=Ie.FDArray;var ye=[];for(ne=Z.CFF.readIndex(te,ne,ye),Ie.FDArray=[],ge=0;ge<ye.length-1;ge++){var ve=Z.CFF.readDict(te,ne+ye[ge],ne+ye[ge+1]);Z.CFF._readFDict(te,ve,be),Ie.FDArray.push(ve)}ne+=ye[ye.length-1],ne=Ie.FDSelect,Ie.FDSelect=[];var Be=te[ne];if(ne++,Be!=3)throw Be;var Re=oe.readUshort(te,ne);for(ne+=2,ge=0;ge<Re+1;ge++)Ie.FDSelect.push(oe.readUshort(te,ne),te[ne+2]),ne+=3}return Ie.Encoding&&(Ie.Encoding=Z.CFF.readEncoding(te,Ie.Encoding,Ie.CharStrings.length)),Ie.charset&&(Ie.charset=Z.CFF.readCharset(te,Ie.charset,Ie.CharStrings.length)),Z.CFF._readFDict(te,Ie,be),Ie},Z.CFF._readFDict=function(te,ne,ie){var oe;for(var se in ne.Private&&(oe=ne.Private[1],ne.Private=Z.CFF.readDict(te,oe,oe+ne.Private[0]),ne.Private.Subrs&&Z.CFF.readSubrs(te,oe+ne.Private.Subrs,ne.Private)),ne)["FamilyName","FontName","FullName","Notice","version","Copyright"].indexOf(se)!=-1&&(ne[se]=ie[ne[se]-426+35])},Z.CFF.readSubrs=function(te,ne,ie){var oe=Z._bin,se=[];ne=Z.CFF.readIndex(te,ne,se);var ae,ge=se.length;ae=ge<1240?107:ge<33900?1131:32768,ie.Bias=ae,ie.Subrs=[];for(var ce=0;ce<se.length-1;ce++)ie.Subrs.push(oe.readBytes(te,ne+se[ce],se[ce+1]-se[ce]))},Z.CFF.tableSE=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,0,111,112,113,114,0,115,116,117,118,119,120,121,122,0,123,0,124,125,126,127,128,129,130,131,0,132,133,0,134,135,136,137,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,138,0,139,0,0,0,0,140,141,142,143,0,0,0,0,0,144,0,0,0,145,0,0,146,147,148,149,0,0,0,0],Z.CFF.glyphByUnicode=function(te,ne){for(var ie=0;ie<te.charset.length;ie++)if(te.charset[ie]==ne)return ie;return-1},Z.CFF.glyphBySE=function(te,ne){return ne<0||ne>255?-1:Z.CFF.glyphByUnicode(te,Z.CFF.tableSE[ne])},Z.CFF.readEncoding=function(te,ne,ie){Z._bin;var oe=[".notdef"],se=te[ne];if(ne++,se!=0)throw"error: unknown encoding format: "+se;var ae=te[ne];ne++;for(var ge=0;ge<ae;ge++)oe.push(te[ne+ge]);return oe},Z.CFF.readCharset=function(te,ne,ie){var oe=Z._bin,se=[".notdef"],ae=te[ne];if(ne++,ae==0)for(var ge=0;ge<ie;ge++){var ce=oe.readUshort(te,ne);ne+=2,se.push(ce)}else{if(ae!=1&&ae!=2)throw"error: format: "+ae;for(;se.length<ie;){ce=oe.readUshort(te,ne),ne+=2;var de=0;for(ae==1?(de=te[ne],ne++):(de=oe.readUshort(te,ne),ne+=2),ge=0;ge<=de;ge++)se.push(ce),ce++}}return se},Z.CFF.readIndex=function(te,ne,ie){var oe=Z._bin,se=oe.readUshort(te,ne)+1,ae=te[ne+=2];if(ne++,ae==1)for(var ge=0;ge<se;ge++)ie.push(te[ne+ge]);else if(ae==2)for(ge=0;ge<se;ge++)ie.push(oe.readUshort(te,ne+2*ge));else if(ae==3)for(ge=0;ge<se;ge++)ie.push(16777215&oe.readUint(te,ne+3*ge-1));else if(se!=1)throw"unsupported offset size: "+ae+", count: "+se;return(ne+=se*ae)-1},Z.CFF.getCharString=function(te,ne,ie){var oe=Z._bin,se=te[ne],ae=te[ne+1];te[ne+2],te[ne+3],te[ne+4];var ge=1,ce=null,de=null;se<=20&&(ce=se,ge=1),se==12&&(ce=100*se+ae,ge=2),21<=se&&se<=27&&(ce=se,ge=1),se==28&&(de=oe.readShort(te,ne+1),ge=3),29<=se&&se<=31&&(ce=se,ge=1),32<=se&&se<=246&&(de=se-139,ge=1),247<=se&&se<=250&&(de=256*(se-247)+ae+108,ge=2),251<=se&&se<=254&&(de=256*-(se-251)-ae-108,ge=2),se==255&&(de=oe.readInt(te,ne+1)/65535,ge=5),ie.val=de??"o"+ce,ie.size=ge},Z.CFF.readCharString=function(te,ne,ie){for(var oe=ne+ie,se=Z._bin,ae=[];ne<oe;){var ge=te[ne],ce=te[ne+1];te[ne+2],te[ne+3],te[ne+4];var de=1,Ie=null,fe=null;ge<=20&&(Ie=ge,de=1),ge==12&&(Ie=100*ge+ce,de=2),ge!=19&&ge!=20||(Ie=ge,de=2),21<=ge&&ge<=27&&(Ie=ge,de=1),ge==28&&(fe=se.readShort(te,ne+1),de=3),29<=ge&&ge<=31&&(Ie=ge,de=1),32<=ge&&ge<=246&&(fe=ge-139,de=1),247<=ge&&ge<=250&&(fe=256*(ge-247)+ce+108,de=2),251<=ge&&ge<=254&&(fe=256*-(ge-251)-ce-108,de=2),ge==255&&(fe=se.readInt(te,ne+1)/65535,de=5),ae.push(fe??"o"+Ie),ne+=de}return ae},Z.CFF.readDict=function(te,ne,ie){for(var oe=Z._bin,se={},ae=[];ne<ie;){var ge=te[ne],ce=te[ne+1];te[ne+2],te[ne+3],te[ne+4];var de=1,Ie=null,fe=null;if(ge==28&&(fe=oe.readShort(te,ne+1),de=3),ge==29&&(fe=oe.readInt(te,ne+1),de=5),32<=ge&&ge<=246&&(fe=ge-139,de=1),247<=ge&&ge<=250&&(fe=256*(ge-247)+ce+108,de=2),251<=ge&&ge<=254&&(fe=256*-(ge-251)-ce-108,de=2),ge==255)throw fe=oe.readInt(te,ne+1)/65535,de=5,"unknown number";if(ge==30){var be=[];for(de=1;;){var Ae=te[ne+de];de++;var ye=Ae>>4,ve=15&Ae;if(ye!=15&&be.push(ye),ve!=15&&be.push(ve),ve==15)break}for(var Be="",Re=[0,1,2,3,4,5,6,7,8,9,".","e","e-","reserved","-","endOfNumber"],Ve=0;Ve<be.length;Ve++)Be+=Re[be[Ve]];fe=parseFloat(Be)}ge<=21&&(Ie=["version","Notice","FullName","FamilyName","Weight","FontBBox","BlueValues","OtherBlues","FamilyBlues","FamilyOtherBlues","StdHW","StdVW","escape","UniqueID","XUID","charset","Encoding","CharStrings","Private","Subrs","defaultWidthX","nominalWidthX"][ge],de=1,ge==12&&(Ie=["Copyright","isFixedPitch","ItalicAngle","UnderlinePosition","UnderlineThickness","PaintType","CharstringType","FontMatrix","StrokeWidth","BlueScale","BlueShift","BlueFuzz","StemSnapH","StemSnapV","ForceBold",0,0,"LanguageGroup","ExpansionFactor","initialRandomSeed","SyntheticBase","PostScript","BaseFontName","BaseFontBlend",0,0,0,0,0,0,"ROS","CIDFontVersion","CIDFontRevision","CIDFontType","CIDCount","UIDBase","FDArray","FDSelect","FontName"][ce],de=2)),Ie!=null?(se[Ie]=ae.length==1?ae[0]:ae,ae=[]):ae.push(fe),ne+=de}return se},Z.cmap={},Z.cmap.parse=function(te,ne,ie){te=new Uint8Array(te.buffer,ne,ie),ne=0;var oe=Z._bin,se={};oe.readUshort(te,ne),ne+=2;var ae=oe.readUshort(te,ne);ne+=2;var ge=[];se.tables=[];for(var ce=0;ce<ae;ce++){var de=oe.readUshort(te,ne);ne+=2;var Ie=oe.readUshort(te,ne);ne+=2;var fe=oe.readUint(te,ne);ne+=4;var be="p"+de+"e"+Ie,Ae=ge.indexOf(fe);if(Ae==-1){var ye;Ae=se.tables.length,ge.push(fe);var ve=oe.readUshort(te,fe);ve==0?ye=Z.cmap.parse0(te,fe):ve==4?ye=Z.cmap.parse4(te,fe):ve==6?ye=Z.cmap.parse6(te,fe):ve==12?ye=Z.cmap.parse12(te,fe):console.debug("unknown format: "+ve,de,Ie,fe),se.tables.push(ye)}if(se[be]!=null)throw"multiple tables for one platform+encoding";se[be]=Ae}return se},Z.cmap.parse0=function(te,ne){var ie=Z._bin,oe={};oe.format=ie.readUshort(te,ne),ne+=2;var se=ie.readUshort(te,ne);ne+=2,ie.readUshort(te,ne),ne+=2,oe.map=[];for(var ae=0;ae<se-6;ae++)oe.map.push(te[ne+ae]);return oe},Z.cmap.parse4=function(te,ne){var ie=Z._bin,oe=ne,se={};se.format=ie.readUshort(te,ne),ne+=2;var ae=ie.readUshort(te,ne);ne+=2,ie.readUshort(te,ne),ne+=2;var ge=ie.readUshort(te,ne);ne+=2;var ce=ge/2;se.searchRange=ie.readUshort(te,ne),ne+=2,se.entrySelector=ie.readUshort(te,ne),ne+=2,se.rangeShift=ie.readUshort(te,ne),ne+=2,se.endCount=ie.readUshorts(te,ne,ce),ne+=2*ce,ne+=2,se.startCount=ie.readUshorts(te,ne,ce),ne+=2*ce,se.idDelta=[];for(var de=0;de<ce;de++)se.idDelta.push(ie.readShort(te,ne)),ne+=2;for(se.idRangeOffset=ie.readUshorts(te,ne,ce),ne+=2*ce,se.glyphIdArray=[];ne<oe+ae;)se.glyphIdArray.push(ie.readUshort(te,ne)),ne+=2;return se},Z.cmap.parse6=function(te,ne){var ie=Z._bin,oe={};oe.format=ie.readUshort(te,ne),ne+=2,ie.readUshort(te,ne),ne+=2,ie.readUshort(te,ne),ne+=2,oe.firstCode=ie.readUshort(te,ne),ne+=2;var se=ie.readUshort(te,ne);ne+=2,oe.glyphIdArray=[];for(var ae=0;ae<se;ae++)oe.glyphIdArray.push(ie.readUshort(te,ne)),ne+=2;return oe},Z.cmap.parse12=function(te,ne){var ie=Z._bin,oe={};oe.format=ie.readUshort(te,ne),ne+=2,ne+=2,ie.readUint(te,ne),ne+=4,ie.readUint(te,ne),ne+=4;var se=ie.readUint(te,ne);ne+=4,oe.groups=[];for(var ae=0;ae<se;ae++){var ge=ne+12*ae,ce=ie.readUint(te,ge+0),de=ie.readUint(te,ge+4),Ie=ie.readUint(te,ge+8);oe.groups.push([ce,de,Ie])}return oe},Z.glyf={},Z.glyf.parse=function(te,ne,ie,oe){for(var se=[],ae=0;ae<oe.maxp.numGlyphs;ae++)se.push(null);return se},Z.glyf._parseGlyf=function(te,ne){var ie=Z._bin,oe=te._data,se=Z._tabOffset(oe,"glyf",te._offset)+te.loca[ne];if(te.loca[ne]==te.loca[ne+1])return null;var ae={};if(ae.noc=ie.readShort(oe,se),se+=2,ae.xMin=ie.readShort(oe,se),se+=2,ae.yMin=ie.readShort(oe,se),se+=2,ae.xMax=ie.readShort(oe,se),se+=2,ae.yMax=ie.readShort(oe,se),se+=2,ae.xMin>=ae.xMax||ae.yMin>=ae.yMax)return null;if(ae.noc>0){ae.endPts=[];for(var ge=0;ge<ae.noc;ge++)ae.endPts.push(ie.readUshort(oe,se)),se+=2;var ce=ie.readUshort(oe,se);if(se+=2,oe.length-se<ce)return null;ae.instructions=ie.readBytes(oe,se,ce),se+=ce;var de=ae.endPts[ae.noc-1]+1;for(ae.flags=[],ge=0;ge<de;ge++){var Ie=oe[se];if(se++,ae.flags.push(Ie),(8&Ie)!=0){var fe=oe[se];se++;for(var be=0;be<fe;be++)ae.flags.push(Ie),ge++}}for(ae.xs=[],ge=0;ge<de;ge++){var Ae=(2&ae.flags[ge])!=0,ye=(16&ae.flags[ge])!=0;Ae?(ae.xs.push(ye?oe[se]:-oe[se]),se++):ye?ae.xs.push(0):(ae.xs.push(ie.readShort(oe,se)),se+=2)}for(ae.ys=[],ge=0;ge<de;ge++)Ae=(4&ae.flags[ge])!=0,ye=(32&ae.flags[ge])!=0,Ae?(ae.ys.push(ye?oe[se]:-oe[se]),se++):ye?ae.ys.push(0):(ae.ys.push(ie.readShort(oe,se)),se+=2);var ve=0,Be=0;for(ge=0;ge<de;ge++)ve+=ae.xs[ge],Be+=ae.ys[ge],ae.xs[ge]=ve,ae.ys[ge]=Be}else{var Re;ae.parts=[];do{Re=ie.readUshort(oe,se),se+=2;var Ve={m:{a:1,b:0,c:0,d:1,tx:0,ty:0},p1:-1,p2:-1};if(ae.parts.push(Ve),Ve.glyphIndex=ie.readUshort(oe,se),se+=2,1&Re){var Ee=ie.readShort(oe,se);se+=2;var Ze=ie.readShort(oe,se);se+=2}else Ee=ie.readInt8(oe,se),se++,Ze=ie.readInt8(oe,se),se++;2&Re?(Ve.m.tx=Ee,Ve.m.ty=Ze):(Ve.p1=Ee,Ve.p2=Ze),8&Re?(Ve.m.a=Ve.m.d=ie.readF2dot14(oe,se),se+=2):64&Re?(Ve.m.a=ie.readF2dot14(oe,se),se+=2,Ve.m.d=ie.readF2dot14(oe,se),se+=2):128&Re&&(Ve.m.a=ie.readF2dot14(oe,se),se+=2,Ve.m.b=ie.readF2dot14(oe,se),se+=2,Ve.m.c=ie.readF2dot14(oe,se),se+=2,Ve.m.d=ie.readF2dot14(oe,se),se+=2)}while(32&Re);if(256&Re){var _e=ie.readUshort(oe,se);for(se+=2,ae.instr=[],ge=0;ge<_e;ge++)ae.instr.push(oe[se]),se++}}return ae},Z.GDEF={},Z.GDEF.parse=function(te,ne,ie,oe){var se=ne;ne+=4;var ae=Z._bin.readUshort(te,ne);return{glyphClassDef:ae===0?null:Z._lctf.readClassDef(te,se+ae)}},Z.GPOS={},Z.GPOS.parse=function(te,ne,ie,oe){return Z._lctf.parse(te,ne,ie,oe,Z.GPOS.subt)},Z.GPOS.subt=function(te,ne,ie,oe){var se=Z._bin,ae=ie,ge={};if(ge.fmt=se.readUshort(te,ie),ie+=2,ne==1||ne==2||ne==3||ne==7||ne==8&&ge.fmt<=2){var ce=se.readUshort(te,ie);ie+=2,ge.coverage=Z._lctf.readCoverage(te,ce+ae)}if(ne==1&&ge.fmt==1){var de=se.readUshort(te,ie);ie+=2,de!=0&&(ge.pos=Z.GPOS.readValueRecord(te,ie,de))}else if(ne==2&&ge.fmt>=1&&ge.fmt<=2){de=se.readUshort(te,ie),ie+=2;var Ie=se.readUshort(te,ie);ie+=2;var fe=Z._lctf.numOfOnes(de),be=Z._lctf.numOfOnes(Ie);if(ge.fmt==1){ge.pairsets=[];var Ae=se.readUshort(te,ie);ie+=2;for(var ye=0;ye<Ae;ye++){var ve=ae+se.readUshort(te,ie);ie+=2;var Be=se.readUshort(te,ve);ve+=2;for(var Re=[],Ve=0;Ve<Be;Ve++){var Ee=se.readUshort(te,ve);ve+=2,de!=0&&(Le=Z.GPOS.readValueRecord(te,ve,de),ve+=2*fe),Ie!=0&&(Ke=Z.GPOS.readValueRecord(te,ve,Ie),ve+=2*be),Re.push({gid2:Ee,val1:Le,val2:Ke})}ge.pairsets.push(Re)}}if(ge.fmt==2){var Ze=se.readUshort(te,ie);ie+=2;var _e=se.readUshort(te,ie);ie+=2;var Fe=se.readUshort(te,ie);ie+=2;var Te=se.readUshort(te,ie);for(ie+=2,ge.classDef1=Z._lctf.readClassDef(te,ae+Ze),ge.classDef2=Z._lctf.readClassDef(te,ae+_e),ge.matrix=[],ye=0;ye<Fe;ye++){var ke=[];for(Ve=0;Ve<Te;Ve++){var Le=null,Ke=null;de!=0&&(Le=Z.GPOS.readValueRecord(te,ie,de),ie+=2*fe),Ie!=0&&(Ke=Z.GPOS.readValueRecord(te,ie,Ie),ie+=2*be),ke.push({val1:Le,val2:Ke})}ge.matrix.push(ke)}}}else if(ne==4&&ge.fmt==1)ge.markCoverage=Z._lctf.readCoverage(te,se.readUshort(te,ie)+ae),ge.baseCoverage=Z._lctf.readCoverage(te,se.readUshort(te,ie+2)+ae),ge.markClassCount=se.readUshort(te,ie+4),ge.markArray=Z.GPOS.readMarkArray(te,se.readUshort(te,ie+6)+ae),ge.baseArray=Z.GPOS.readBaseArray(te,se.readUshort(te,ie+8)+ae,ge.markClassCount);else if(ne==6&&ge.fmt==1)ge.mark1Coverage=Z._lctf.readCoverage(te,se.readUshort(te,ie)+ae),ge.mark2Coverage=Z._lctf.readCoverage(te,se.readUshort(te,ie+2)+ae),ge.markClassCount=se.readUshort(te,ie+4),ge.mark1Array=Z.GPOS.readMarkArray(te,se.readUshort(te,ie+6)+ae),ge.mark2Array=Z.GPOS.readBaseArray(te,se.readUshort(te,ie+8)+ae,ge.markClassCount);else{if(ne==9&&ge.fmt==1){var Ue=se.readUshort(te,ie);ie+=2;var rt=se.readUint(te,ie);if(ie+=4,oe.ltype==9)oe.ltype=Ue;else if(oe.ltype!=Ue)throw"invalid extension substitution";return Z.GPOS.subt(te,oe.ltype,ae+rt)}console.debug("unsupported GPOS table LookupType",ne,"format",ge.fmt)}return ge},Z.GPOS.readValueRecord=function(te,ne,ie){var oe=Z._bin,se=[];return se.push(1&ie?oe.readShort(te,ne):0),ne+=1&ie?2:0,se.push(2&ie?oe.readShort(te,ne):0),ne+=2&ie?2:0,se.push(4&ie?oe.readShort(te,ne):0),ne+=4&ie?2:0,se.push(8&ie?oe.readShort(te,ne):0),ne+=8&ie?2:0,se},Z.GPOS.readBaseArray=function(te,ne,ie){var oe=Z._bin,se=[],ae=ne,ge=oe.readUshort(te,ne);ne+=2;for(var ce=0;ce<ge;ce++){for(var de=[],Ie=0;Ie<ie;Ie++)de.push(Z.GPOS.readAnchorRecord(te,ae+oe.readUshort(te,ne))),ne+=2;se.push(de)}return se},Z.GPOS.readMarkArray=function(te,ne){var ie=Z._bin,oe=[],se=ne,ae=ie.readUshort(te,ne);ne+=2;for(var ge=0;ge<ae;ge++){var ce=Z.GPOS.readAnchorRecord(te,ie.readUshort(te,ne+2)+se);ce.markClass=ie.readUshort(te,ne),oe.push(ce),ne+=4}return oe},Z.GPOS.readAnchorRecord=function(te,ne){var ie=Z._bin,oe={};return oe.fmt=ie.readUshort(te,ne),oe.x=ie.readShort(te,ne+2),oe.y=ie.readShort(te,ne+4),oe},Z.GSUB={},Z.GSUB.parse=function(te,ne,ie,oe){return Z._lctf.parse(te,ne,ie,oe,Z.GSUB.subt)},Z.GSUB.subt=function(te,ne,ie,oe){var se=Z._bin,ae=ie,ge={};if(ge.fmt=se.readUshort(te,ie),ie+=2,ne!=1&&ne!=2&&ne!=4&&ne!=5&&ne!=6)return null;if(ne==1||ne==2||ne==4||ne==5&&ge.fmt<=2||ne==6&&ge.fmt<=2){var ce=se.readUshort(te,ie);ie+=2,ge.coverage=Z._lctf.readCoverage(te,ae+ce)}if(ne==1&&ge.fmt>=1&&ge.fmt<=2){if(ge.fmt==1)ge.delta=se.readShort(te,ie),ie+=2;else if(ge.fmt==2){var de=se.readUshort(te,ie);ie+=2,ge.newg=se.readUshorts(te,ie,de),ie+=2*ge.newg.length}}else if(ne==2&&ge.fmt==1){de=se.readUshort(te,ie),ie+=2,ge.seqs=[];for(var Ie=0;Ie<de;Ie++){var fe=se.readUshort(te,ie)+ae;ie+=2;var be=se.readUshort(te,fe);ge.seqs.push(se.readUshorts(te,fe+2,be))}}else if(ne==4)for(ge.vals=[],de=se.readUshort(te,ie),ie+=2,Ie=0;Ie<de;Ie++){var Ae=se.readUshort(te,ie);ie+=2,ge.vals.push(Z.GSUB.readLigatureSet(te,ae+Ae))}else if(ne==5&&ge.fmt==2){if(ge.fmt==2){var ye=se.readUshort(te,ie);ie+=2,ge.cDef=Z._lctf.readClassDef(te,ae+ye),ge.scset=[];var ve=se.readUshort(te,ie);for(ie+=2,Ie=0;Ie<ve;Ie++){var Be=se.readUshort(te,ie);ie+=2,ge.scset.push(Be==0?null:Z.GSUB.readSubClassSet(te,ae+Be))}}}else if(ne==6&&ge.fmt==3){if(ge.fmt==3){for(Ie=0;Ie<3;Ie++){de=se.readUshort(te,ie),ie+=2;for(var Re=[],Ve=0;Ve<de;Ve++)Re.push(Z._lctf.readCoverage(te,ae+se.readUshort(te,ie+2*Ve)));ie+=2*de,Ie==0&&(ge.backCvg=Re),Ie==1&&(ge.inptCvg=Re),Ie==2&&(ge.ahedCvg=Re)}de=se.readUshort(te,ie),ie+=2,ge.lookupRec=Z.GSUB.readSubstLookupRecords(te,ie,de)}}else{if(ne==7&&ge.fmt==1){var Ee=se.readUshort(te,ie);ie+=2;var Ze=se.readUint(te,ie);if(ie+=4,oe.ltype==9)oe.ltype=Ee;else if(oe.ltype!=Ee)throw"invalid extension substitution";return Z.GSUB.subt(te,oe.ltype,ae+Ze)}console.debug("unsupported GSUB table LookupType",ne,"format",ge.fmt)}return ge},Z.GSUB.readSubClassSet=function(te,ne){var ie=Z._bin.readUshort,oe=ne,se=[],ae=ie(te,ne);ne+=2;for(var ge=0;ge<ae;ge++){var ce=ie(te,ne);ne+=2,se.push(Z.GSUB.readSubClassRule(te,oe+ce))}return se},Z.GSUB.readSubClassRule=function(te,ne){var ie=Z._bin.readUshort,oe={},se=ie(te,ne),ae=ie(te,ne+=2);ne+=2,oe.input=[];for(var ge=0;ge<se-1;ge++)oe.input.push(ie(te,ne)),ne+=2;return oe.substLookupRecords=Z.GSUB.readSubstLookupRecords(te,ne,ae),oe},Z.GSUB.readSubstLookupRecords=function(te,ne,ie){for(var oe=Z._bin.readUshort,se=[],ae=0;ae<ie;ae++)se.push(oe(te,ne),oe(te,ne+2)),ne+=4;return se},Z.GSUB.readChainSubClassSet=function(te,ne){var ie=Z._bin,oe=ne,se=[],ae=ie.readUshort(te,ne);ne+=2;for(var ge=0;ge<ae;ge++){var ce=ie.readUshort(te,ne);ne+=2,se.push(Z.GSUB.readChainSubClassRule(te,oe+ce))}return se},Z.GSUB.readChainSubClassRule=function(te,ne){for(var ie=Z._bin,oe={},se=["backtrack","input","lookahead"],ae=0;ae<se.length;ae++){var ge=ie.readUshort(te,ne);ne+=2,ae==1&&ge--,oe[se[ae]]=ie.readUshorts(te,ne,ge),ne+=2*oe[se[ae]].length}return ge=ie.readUshort(te,ne),ne+=2,oe.subst=ie.readUshorts(te,ne,2*ge),ne+=2*oe.subst.length,oe},Z.GSUB.readLigatureSet=function(te,ne){var ie=Z._bin,oe=ne,se=[],ae=ie.readUshort(te,ne);ne+=2;for(var ge=0;ge<ae;ge++){var ce=ie.readUshort(te,ne);ne+=2,se.push(Z.GSUB.readLigature(te,oe+ce))}return se},Z.GSUB.readLigature=function(te,ne){var ie=Z._bin,oe={chain:[]};oe.nglyph=ie.readUshort(te,ne),ne+=2;var se=ie.readUshort(te,ne);ne+=2;for(var ae=0;ae<se-1;ae++)oe.chain.push(ie.readUshort(te,ne)),ne+=2;return oe},Z.head={},Z.head.parse=function(te,ne,ie){var oe=Z._bin,se={};return oe.readFixed(te,ne),ne+=4,se.fontRevision=oe.readFixed(te,ne),ne+=4,oe.readUint(te,ne),ne+=4,oe.readUint(te,ne),ne+=4,se.flags=oe.readUshort(te,ne),ne+=2,se.unitsPerEm=oe.readUshort(te,ne),ne+=2,se.created=oe.readUint64(te,ne),ne+=8,se.modified=oe.readUint64(te,ne),ne+=8,se.xMin=oe.readShort(te,ne),ne+=2,se.yMin=oe.readShort(te,ne),ne+=2,se.xMax=oe.readShort(te,ne),ne+=2,se.yMax=oe.readShort(te,ne),ne+=2,se.macStyle=oe.readUshort(te,ne),ne+=2,se.lowestRecPPEM=oe.readUshort(te,ne),ne+=2,se.fontDirectionHint=oe.readShort(te,ne),ne+=2,se.indexToLocFormat=oe.readShort(te,ne),ne+=2,se.glyphDataFormat=oe.readShort(te,ne),ne+=2,se},Z.hhea={},Z.hhea.parse=function(te,ne,ie){var oe=Z._bin,se={};return oe.readFixed(te,ne),ne+=4,se.ascender=oe.readShort(te,ne),ne+=2,se.descender=oe.readShort(te,ne),ne+=2,se.lineGap=oe.readShort(te,ne),ne+=2,se.advanceWidthMax=oe.readUshort(te,ne),ne+=2,se.minLeftSideBearing=oe.readShort(te,ne),ne+=2,se.minRightSideBearing=oe.readShort(te,ne),ne+=2,se.xMaxExtent=oe.readShort(te,ne),ne+=2,se.caretSlopeRise=oe.readShort(te,ne),ne+=2,se.caretSlopeRun=oe.readShort(te,ne),ne+=2,se.caretOffset=oe.readShort(te,ne),ne+=2,ne+=8,se.metricDataFormat=oe.readShort(te,ne),ne+=2,se.numberOfHMetrics=oe.readUshort(te,ne),ne+=2,se},Z.hmtx={},Z.hmtx.parse=function(te,ne,ie,oe){for(var se=Z._bin,ae={aWidth:[],lsBearing:[]},ge=0,ce=0,de=0;de<oe.maxp.numGlyphs;de++)de<oe.hhea.numberOfHMetrics&&(ge=se.readUshort(te,ne),ne+=2,ce=se.readShort(te,ne),ne+=2),ae.aWidth.push(ge),ae.lsBearing.push(ce);return ae},Z.kern={},Z.kern.parse=function(te,ne,ie,oe){var se=Z._bin,ae=se.readUshort(te,ne);if(ne+=2,ae==1)return Z.kern.parseV1(te,ne-2,ie,oe);var ge=se.readUshort(te,ne);ne+=2;for(var ce={glyph1:[],rval:[]},de=0;de<ge;de++){ne+=2,ie=se.readUshort(te,ne),ne+=2;var Ie=se.readUshort(te,ne);ne+=2;var fe=Ie>>>8;if((fe&=15)!=0)throw"unknown kern table format: "+fe;ne=Z.kern.readFormat0(te,ne,ce)}return ce},Z.kern.parseV1=function(te,ne,ie,oe){var se=Z._bin;se.readFixed(te,ne),ne+=4;var ae=se.readUint(te,ne);ne+=4;for(var ge={glyph1:[],rval:[]},ce=0;ce<ae;ce++){se.readUint(te,ne),ne+=4;var de=se.readUshort(te,ne);ne+=2,se.readUshort(te,ne),ne+=2;var Ie=de>>>8;if((Ie&=15)!=0)throw"unknown kern table format: "+Ie;ne=Z.kern.readFormat0(te,ne,ge)}return ge},Z.kern.readFormat0=function(te,ne,ie){var oe=Z._bin,se=-1,ae=oe.readUshort(te,ne);ne+=2,oe.readUshort(te,ne),ne+=2,oe.readUshort(te,ne),ne+=2,oe.readUshort(te,ne),ne+=2;for(var ge=0;ge<ae;ge++){var ce=oe.readUshort(te,ne);ne+=2;var de=oe.readUshort(te,ne);ne+=2;var Ie=oe.readShort(te,ne);ne+=2,ce!=se&&(ie.glyph1.push(ce),ie.rval.push({glyph2:[],vals:[]}));var fe=ie.rval[ie.rval.length-1];fe.glyph2.push(de),fe.vals.push(Ie),se=ce}return ne},Z.loca={},Z.loca.parse=function(te,ne,ie,oe){var se=Z._bin,ae=[],ge=oe.head.indexToLocFormat,ce=oe.maxp.numGlyphs+1;if(ge==0)for(var de=0;de<ce;de++)ae.push(se.readUshort(te,ne+(de<<1))<<1);if(ge==1)for(de=0;de<ce;de++)ae.push(se.readUint(te,ne+(de<<2)));return ae},Z.maxp={},Z.maxp.parse=function(te,ne,ie){var oe=Z._bin,se={},ae=oe.readUint(te,ne);return ne+=4,se.numGlyphs=oe.readUshort(te,ne),ne+=2,ae==65536&&(se.maxPoints=oe.readUshort(te,ne),ne+=2,se.maxContours=oe.readUshort(te,ne),ne+=2,se.maxCompositePoints=oe.readUshort(te,ne),ne+=2,se.maxCompositeContours=oe.readUshort(te,ne),ne+=2,se.maxZones=oe.readUshort(te,ne),ne+=2,se.maxTwilightPoints=oe.readUshort(te,ne),ne+=2,se.maxStorage=oe.readUshort(te,ne),ne+=2,se.maxFunctionDefs=oe.readUshort(te,ne),ne+=2,se.maxInstructionDefs=oe.readUshort(te,ne),ne+=2,se.maxStackElements=oe.readUshort(te,ne),ne+=2,se.maxSizeOfInstructions=oe.readUshort(te,ne),ne+=2,se.maxComponentElements=oe.readUshort(te,ne),ne+=2,se.maxComponentDepth=oe.readUshort(te,ne),ne+=2),se},Z.name={},Z.name.parse=function(te,ne,ie){var oe=Z._bin,se={};oe.readUshort(te,ne),ne+=2;var ae=oe.readUshort(te,ne);ne+=2,oe.readUshort(te,ne);for(var ge,ce=["copyright","fontFamily","fontSubfamily","ID","fullName","version","postScriptName","trademark","manufacturer","designer","description","urlVendor","urlDesigner","licence","licenceURL","---","typoFamilyName","typoSubfamilyName","compatibleFull","sampleText","postScriptCID","wwsFamilyName","wwsSubfamilyName","lightPalette","darkPalette"],de=ne+=2,Ie=0;Ie<ae;Ie++){var fe=oe.readUshort(te,ne);ne+=2;var be=oe.readUshort(te,ne);ne+=2;var Ae=oe.readUshort(te,ne);ne+=2;var ye=oe.readUshort(te,ne);ne+=2;var ve=oe.readUshort(te,ne);ne+=2;var Be=oe.readUshort(te,ne);ne+=2;var Re,Ve=ce[ye],Ee=de+12*ae+Be;if(fe==0)Re=oe.readUnicode(te,Ee,ve/2);else if(fe==3&&be==0)Re=oe.readUnicode(te,Ee,ve/2);else if(be==0)Re=oe.readASCII(te,Ee,ve);else if(be==1)Re=oe.readUnicode(te,Ee,ve/2);else if(be==3)Re=oe.readUnicode(te,Ee,ve/2);else{if(fe!=1)throw"unknown encoding "+be+", platformID: "+fe;Re=oe.readASCII(te,Ee,ve),console.debug("reading unknown MAC encoding "+be+" as ASCII")}var Ze="p"+fe+","+Ae.toString(16);se[Ze]==null&&(se[Ze]={}),se[Ze][Ve!==void 0?Ve:ye]=Re,se[Ze]._lang=Ae}for(var _e in se)if(se[_e].postScriptName!=null&&se[_e]._lang==1033)return se[_e];for(var _e in se)if(se[_e].postScriptName!=null&&se[_e]._lang==0)return se[_e];for(var _e in se)if(se[_e].postScriptName!=null&&se[_e]._lang==3084)return se[_e];for(var _e in se)if(se[_e].postScriptName!=null)return se[_e];for(var _e in se){ge=_e;break}return console.debug("returning name table with languageID "+se[ge]._lang),se[ge]},Z["OS/2"]={},Z["OS/2"].parse=function(te,ne,ie){var oe=Z._bin.readUshort(te,ne);ne+=2;var se={};if(oe==0)Z["OS/2"].version0(te,ne,se);else if(oe==1)Z["OS/2"].version1(te,ne,se);else if(oe==2||oe==3||oe==4)Z["OS/2"].version2(te,ne,se);else{if(oe!=5)throw"unknown OS/2 table version: "+oe;Z["OS/2"].version5(te,ne,se)}return se},Z["OS/2"].version0=function(te,ne,ie){var oe=Z._bin;return ie.xAvgCharWidth=oe.readShort(te,ne),ne+=2,ie.usWeightClass=oe.readUshort(te,ne),ne+=2,ie.usWidthClass=oe.readUshort(te,ne),ne+=2,ie.fsType=oe.readUshort(te,ne),ne+=2,ie.ySubscriptXSize=oe.readShort(te,ne),ne+=2,ie.ySubscriptYSize=oe.readShort(te,ne),ne+=2,ie.ySubscriptXOffset=oe.readShort(te,ne),ne+=2,ie.ySubscriptYOffset=oe.readShort(te,ne),ne+=2,ie.ySuperscriptXSize=oe.readShort(te,ne),ne+=2,ie.ySuperscriptYSize=oe.readShort(te,ne),ne+=2,ie.ySuperscriptXOffset=oe.readShort(te,ne),ne+=2,ie.ySuperscriptYOffset=oe.readShort(te,ne),ne+=2,ie.yStrikeoutSize=oe.readShort(te,ne),ne+=2,ie.yStrikeoutPosition=oe.readShort(te,ne),ne+=2,ie.sFamilyClass=oe.readShort(te,ne),ne+=2,ie.panose=oe.readBytes(te,ne,10),ne+=10,ie.ulUnicodeRange1=oe.readUint(te,ne),ne+=4,ie.ulUnicodeRange2=oe.readUint(te,ne),ne+=4,ie.ulUnicodeRange3=oe.readUint(te,ne),ne+=4,ie.ulUnicodeRange4=oe.readUint(te,ne),ne+=4,ie.achVendID=[oe.readInt8(te,ne),oe.readInt8(te,ne+1),oe.readInt8(te,ne+2),oe.readInt8(te,ne+3)],ne+=4,ie.fsSelection=oe.readUshort(te,ne),ne+=2,ie.usFirstCharIndex=oe.readUshort(te,ne),ne+=2,ie.usLastCharIndex=oe.readUshort(te,ne),ne+=2,ie.sTypoAscender=oe.readShort(te,ne),ne+=2,ie.sTypoDescender=oe.readShort(te,ne),ne+=2,ie.sTypoLineGap=oe.readShort(te,ne),ne+=2,ie.usWinAscent=oe.readUshort(te,ne),ne+=2,ie.usWinDescent=oe.readUshort(te,ne),ne+=2},Z["OS/2"].version1=function(te,ne,ie){var oe=Z._bin;return ne=Z["OS/2"].version0(te,ne,ie),ie.ulCodePageRange1=oe.readUint(te,ne),ne+=4,ie.ulCodePageRange2=oe.readUint(te,ne),ne+=4},Z["OS/2"].version2=function(te,ne,ie){var oe=Z._bin;return ne=Z["OS/2"].version1(te,ne,ie),ie.sxHeight=oe.readShort(te,ne),ne+=2,ie.sCapHeight=oe.readShort(te,ne),ne+=2,ie.usDefault=oe.readUshort(te,ne),ne+=2,ie.usBreak=oe.readUshort(te,ne),ne+=2,ie.usMaxContext=oe.readUshort(te,ne),ne+=2},Z["OS/2"].version5=function(te,ne,ie){var oe=Z._bin;return ne=Z["OS/2"].version2(te,ne,ie),ie.usLowerOpticalPointSize=oe.readUshort(te,ne),ne+=2,ie.usUpperOpticalPointSize=oe.readUshort(te,ne),ne+=2},Z.post={},Z.post.parse=function(te,ne,ie){var oe=Z._bin,se={};return se.version=oe.readFixed(te,ne),ne+=4,se.italicAngle=oe.readFixed(te,ne),ne+=4,se.underlinePosition=oe.readShort(te,ne),ne+=2,se.underlineThickness=oe.readShort(te,ne),ne+=2,se},Z==null&&(Z={}),Z.U==null&&(Z.U={}),Z.U.codeToGlyph=function(te,ne){var ie=te.cmap,oe=-1;if(ie.p0e4!=null?oe=ie.p0e4:ie.p3e1!=null?oe=ie.p3e1:ie.p1e0!=null?oe=ie.p1e0:ie.p0e3!=null&&(oe=ie.p0e3),oe==-1)throw"no familiar platform and encoding!";var se=ie.tables[oe];if(se.format==0)return ne>=se.map.length?0:se.map[ne];if(se.format==4){for(var ae=-1,ge=0;ge<se.endCount.length;ge++)if(ne<=se.endCount[ge]){ae=ge;break}return ae==-1||se.startCount[ae]>ne?0:65535&(se.idRangeOffset[ae]!=0?se.glyphIdArray[ne-se.startCount[ae]+(se.idRangeOffset[ae]>>1)-(se.idRangeOffset.length-ae)]:ne+se.idDelta[ae])}if(se.format==12){if(ne>se.groups[se.groups.length-1][1])return 0;for(ge=0;ge<se.groups.length;ge++){var ce=se.groups[ge];if(ce[0]<=ne&&ne<=ce[1])return ce[2]+(ne-ce[0])}return 0}throw"unknown cmap table format "+se.format},Z.U.glyphToPath=function(te,ne){var ie={cmds:[],crds:[]};if(te.SVG&&te.SVG.entries[ne]){var oe=te.SVG.entries[ne];return oe==null?ie:(typeof oe=="string"&&(oe=Z.SVG.toPath(oe),te.SVG.entries[ne]=oe),oe)}if(te.CFF){var se={x:0,y:0,stack:[],nStems:0,haveWidth:!1,width:te.CFF.Private?te.CFF.Private.defaultWidthX:0,open:!1},ae=te.CFF,ge=te.CFF.Private;if(ae.ROS){for(var ce=0;ae.FDSelect[ce+2]<=ne;)ce+=2;ge=ae.FDArray[ae.FDSelect[ce+1]].Private}Z.U._drawCFF(te.CFF.CharStrings[ne],se,ae,ge,ie)}else te.glyf&&Z.U._drawGlyf(ne,te,ie);return ie},Z.U._drawGlyf=function(te,ne,ie){var oe=ne.glyf[te];oe==null&&(oe=ne.glyf[te]=Z.glyf._parseGlyf(ne,te)),oe!=null&&(oe.noc>-1?Z.U._simpleGlyph(oe,ie):Z.U._compoGlyph(oe,ne,ie))},Z.U._simpleGlyph=function(te,ne){for(var ie=0;ie<te.noc;ie++){for(var oe=ie==0?0:te.endPts[ie-1]+1,se=te.endPts[ie],ae=oe;ae<=se;ae++){var ge=ae==oe?se:ae-1,ce=ae==se?oe:ae+1,de=1&te.flags[ae],Ie=1&te.flags[ge],fe=1&te.flags[ce],be=te.xs[ae],Ae=te.ys[ae];if(ae==oe)if(de){if(!Ie){Z.U.P.moveTo(ne,be,Ae);continue}Z.U.P.moveTo(ne,te.xs[ge],te.ys[ge])}else Ie?Z.U.P.moveTo(ne,te.xs[ge],te.ys[ge]):Z.U.P.moveTo(ne,(te.xs[ge]+be)/2,(te.ys[ge]+Ae)/2);de?Ie&&Z.U.P.lineTo(ne,be,Ae):fe?Z.U.P.qcurveTo(ne,be,Ae,te.xs[ce],te.ys[ce]):Z.U.P.qcurveTo(ne,be,Ae,(be+te.xs[ce])/2,(Ae+te.ys[ce])/2)}Z.U.P.closePath(ne)}},Z.U._compoGlyph=function(te,ne,ie){for(var oe=0;oe<te.parts.length;oe++){var se={cmds:[],crds:[]},ae=te.parts[oe];Z.U._drawGlyf(ae.glyphIndex,ne,se);for(var ge=ae.m,ce=0;ce<se.crds.length;ce+=2){var de=se.crds[ce],Ie=se.crds[ce+1];ie.crds.push(de*ge.a+Ie*ge.b+ge.tx),ie.crds.push(de*ge.c+Ie*ge.d+ge.ty)}for(ce=0;ce<se.cmds.length;ce++)ie.cmds.push(se.cmds[ce])}},Z.U._getGlyphClass=function(te,ne){var ie=Z._lctf.getInterval(ne,te);return ie==-1?0:ne[ie+2]},Z.U._applySubs=function(te,ne,ie,oe){for(var se=te.length-ne-1,ae=0;ae<ie.tabs.length;ae++)if(ie.tabs[ae]!=null){var ge,ce=ie.tabs[ae];if(!ce.coverage||(ge=Z._lctf.coverageIndex(ce.coverage,te[ne]))!=-1){if(ie.ltype==1)te[ne],ce.fmt==1?te[ne]=te[ne]+ce.delta:te[ne]=ce.newg[ge];else if(ie.ltype==4)for(var de=ce.vals[ge],Ie=0;Ie<de.length;Ie++){var fe=de[Ie],be=fe.chain.length;if(!(be>se)){for(var Ae=!0,ye=0,ve=0;ve<be;ve++){for(;te[ne+ye+(1+ve)]==-1;)ye++;fe.chain[ve]!=te[ne+ye+(1+ve)]&&(Ae=!1)}if(Ae){for(te[ne]=fe.nglyph,ve=0;ve<be+ye;ve++)te[ne+ve+1]=-1;break}}}else if(ie.ltype==5&&ce.fmt==2)for(var Be=Z._lctf.getInterval(ce.cDef,te[ne]),Re=ce.cDef[Be+2],Ve=ce.scset[Re],Ee=0;Ee<Ve.length;Ee++){var Ze=Ve[Ee],_e=Ze.input;if(!(_e.length>se)){for(Ae=!0,ve=0;ve<_e.length;ve++){var Fe=Z._lctf.getInterval(ce.cDef,te[ne+1+ve]);if(Be==-1&&ce.cDef[Fe+2]!=_e[ve]){Ae=!1;break}}if(Ae){var Te=Ze.substLookupRecords;for(Ie=0;Ie<Te.length;Ie+=2)Te[Ie],Te[Ie+1]}}}else if(ie.ltype==6&&ce.fmt==3){if(!Z.U._glsCovered(te,ce.backCvg,ne-ce.backCvg.length)||!Z.U._glsCovered(te,ce.inptCvg,ne)||!Z.U._glsCovered(te,ce.ahedCvg,ne+ce.inptCvg.length))continue;var ke=ce.lookupRec;for(Ee=0;Ee<ke.length;Ee+=2){Be=ke[Ee];var Le=oe[ke[Ee+1]];Z.U._applySubs(te,ne+Be,Le,oe)}}}}},Z.U._glsCovered=function(te,ne,ie){for(var oe=0;oe<ne.length;oe++)if(Z._lctf.coverageIndex(ne[oe],te[ie+oe])==-1)return!1;return!0},Z.U.glyphsToPath=function(te,ne,ie){for(var oe={cmds:[],crds:[]},se=0,ae=0;ae<ne.length;ae++){var ge=ne[ae];if(ge!=-1){for(var ce=ae<ne.length-1&&ne[ae+1]!=-1?ne[ae+1]:0,de=Z.U.glyphToPath(te,ge),Ie=0;Ie<de.crds.length;Ie+=2)oe.crds.push(de.crds[Ie]+se),oe.crds.push(de.crds[Ie+1]);for(ie&&oe.cmds.push(ie),Ie=0;Ie<de.cmds.length;Ie++)oe.cmds.push(de.cmds[Ie]);ie&&oe.cmds.push("X"),se+=te.hmtx.aWidth[ge],ae<ne.length-1&&(se+=Z.U.getPairAdjustment(te,ge,ce))}}return oe},Z.U.P={},Z.U.P.moveTo=function(te,ne,ie){te.cmds.push("M"),te.crds.push(ne,ie)},Z.U.P.lineTo=function(te,ne,ie){te.cmds.push("L"),te.crds.push(ne,ie)},Z.U.P.curveTo=function(te,ne,ie,oe,se,ae,ge){te.cmds.push("C"),te.crds.push(ne,ie,oe,se,ae,ge)},Z.U.P.qcurveTo=function(te,ne,ie,oe,se){te.cmds.push("Q"),te.crds.push(ne,ie,oe,se)},Z.U.P.closePath=function(te){te.cmds.push("Z")},Z.U._drawCFF=function(te,ne,ie,oe,se){for(var ae=ne.stack,ge=ne.nStems,ce=ne.haveWidth,de=ne.width,Ie=ne.open,fe=0,be=ne.x,Ae=ne.y,ye=0,ve=0,Be=0,Re=0,Ve=0,Ee=0,Ze=0,_e=0,Fe=0,Te=0,ke={val:0,size:0};fe<te.length;){Z.CFF.getCharString(te,fe,ke);var Le=ke.val;if(fe+=ke.size,Le=="o1"||Le=="o18")ae.length%2!=0&&!ce&&(de=ae.shift()+oe.nominalWidthX),ge+=ae.length>>1,ae.length=0,ce=!0;else if(Le=="o3"||Le=="o23")ae.length%2!=0&&!ce&&(de=ae.shift()+oe.nominalWidthX),ge+=ae.length>>1,ae.length=0,ce=!0;else if(Le=="o4")ae.length>1&&!ce&&(de=ae.shift()+oe.nominalWidthX,ce=!0),Ie&&Z.U.P.closePath(se),Ae+=ae.pop(),Z.U.P.moveTo(se,be,Ae),Ie=!0;else if(Le=="o5")for(;ae.length>0;)be+=ae.shift(),Ae+=ae.shift(),Z.U.P.lineTo(se,be,Ae);else if(Le=="o6"||Le=="o7")for(var Ke=ae.length,Ue=Le=="o6",rt=0;rt<Ke;rt++){var tt=ae.shift();Ue?be+=tt:Ae+=tt,Ue=!Ue,Z.U.P.lineTo(se,be,Ae)}else if(Le=="o8"||Le=="o24"){Ke=ae.length;for(var at=0;at+6<=Ke;)ye=be+ae.shift(),ve=Ae+ae.shift(),Be=ye+ae.shift(),Re=ve+ae.shift(),be=Be+ae.shift(),Ae=Re+ae.shift(),Z.U.P.curveTo(se,ye,ve,Be,Re,be,Ae),at+=6;Le=="o24"&&(be+=ae.shift(),Ae+=ae.shift(),Z.U.P.lineTo(se,be,Ae))}else{if(Le=="o11")break;if(Le=="o1234"||Le=="o1235"||Le=="o1236"||Le=="o1237")Le=="o1234"&&(ve=Ae,Be=(ye=be+ae.shift())+ae.shift(),Te=Re=ve+ae.shift(),Ee=Re,_e=Ae,be=(Ze=(Ve=(Fe=Be+ae.shift())+ae.shift())+ae.shift())+ae.shift(),Z.U.P.curveTo(se,ye,ve,Be,Re,Fe,Te),Z.U.P.curveTo(se,Ve,Ee,Ze,_e,be,Ae)),Le=="o1235"&&(ye=be+ae.shift(),ve=Ae+ae.shift(),Be=ye+ae.shift(),Re=ve+ae.shift(),Fe=Be+ae.shift(),Te=Re+ae.shift(),Ve=Fe+ae.shift(),Ee=Te+ae.shift(),Ze=Ve+ae.shift(),_e=Ee+ae.shift(),be=Ze+ae.shift(),Ae=_e+ae.shift(),ae.shift(),Z.U.P.curveTo(se,ye,ve,Be,Re,Fe,Te),Z.U.P.curveTo(se,Ve,Ee,Ze,_e,be,Ae)),Le=="o1236"&&(ye=be+ae.shift(),ve=Ae+ae.shift(),Be=ye+ae.shift(),Te=Re=ve+ae.shift(),Ee=Re,Ze=(Ve=(Fe=Be+ae.shift())+ae.shift())+ae.shift(),_e=Ee+ae.shift(),be=Ze+ae.shift(),Z.U.P.curveTo(se,ye,ve,Be,Re,Fe,Te),Z.U.P.curveTo(se,Ve,Ee,Ze,_e,be,Ae)),Le=="o1237"&&(ye=be+ae.shift(),ve=Ae+ae.shift(),Be=ye+ae.shift(),Re=ve+ae.shift(),Fe=Be+ae.shift(),Te=Re+ae.shift(),Ve=Fe+ae.shift(),Ee=Te+ae.shift(),Ze=Ve+ae.shift(),_e=Ee+ae.shift(),Math.abs(Ze-be)>Math.abs(_e-Ae)?be=Ze+ae.shift():Ae=_e+ae.shift(),Z.U.P.curveTo(se,ye,ve,Be,Re,Fe,Te),Z.U.P.curveTo(se,Ve,Ee,Ze,_e,be,Ae));else if(Le=="o14"){if(ae.length>0&&!ce&&(de=ae.shift()+ie.nominalWidthX,ce=!0),ae.length==4){var ze=ae.shift(),qe=ae.shift(),Pe=ae.shift(),Ye=ae.shift(),$e=Z.CFF.glyphBySE(ie,Pe),ut=Z.CFF.glyphBySE(ie,Ye);Z.U._drawCFF(ie.CharStrings[$e],ne,ie,oe,se),ne.x=ze,ne.y=qe,Z.U._drawCFF(ie.CharStrings[ut],ne,ie,oe,se)}Ie&&(Z.U.P.closePath(se),Ie=!1)}else if(Le=="o19"||Le=="o20")ae.length%2!=0&&!ce&&(de=ae.shift()+oe.nominalWidthX),ge+=ae.length>>1,ae.length=0,ce=!0,fe+=ge+7>>3;else if(Le=="o21")ae.length>2&&!ce&&(de=ae.shift()+oe.nominalWidthX,ce=!0),Ae+=ae.pop(),be+=ae.pop(),Ie&&Z.U.P.closePath(se),Z.U.P.moveTo(se,be,Ae),Ie=!0;else if(Le=="o22")ae.length>1&&!ce&&(de=ae.shift()+oe.nominalWidthX,ce=!0),be+=ae.pop(),Ie&&Z.U.P.closePath(se),Z.U.P.moveTo(se,be,Ae),Ie=!0;else if(Le=="o25"){for(;ae.length>6;)be+=ae.shift(),Ae+=ae.shift(),Z.U.P.lineTo(se,be,Ae);ye=be+ae.shift(),ve=Ae+ae.shift(),Be=ye+ae.shift(),Re=ve+ae.shift(),be=Be+ae.shift(),Ae=Re+ae.shift(),Z.U.P.curveTo(se,ye,ve,Be,Re,be,Ae)}else if(Le=="o26")for(ae.length%2&&(be+=ae.shift());ae.length>0;)ye=be,ve=Ae+ae.shift(),be=Be=ye+ae.shift(),Ae=(Re=ve+ae.shift())+ae.shift(),Z.U.P.curveTo(se,ye,ve,Be,Re,be,Ae);else if(Le=="o27")for(ae.length%2&&(Ae+=ae.shift());ae.length>0;)ve=Ae,Be=(ye=be+ae.shift())+ae.shift(),Re=ve+ae.shift(),be=Be+ae.shift(),Ae=Re,Z.U.P.curveTo(se,ye,ve,Be,Re,be,Ae);else if(Le=="o10"||Le=="o29"){var ot=Le=="o10"?oe:ie;if(ae.length==0)console.debug("error: empty stack");else{var gt=ae.pop(),ht=ot.Subrs[gt+ot.Bias];ne.x=be,ne.y=Ae,ne.nStems=ge,ne.haveWidth=ce,ne.width=de,ne.open=Ie,Z.U._drawCFF(ht,ne,ie,oe,se),be=ne.x,Ae=ne.y,ge=ne.nStems,ce=ne.haveWidth,de=ne.width,Ie=ne.open}}else if(Le=="o30"||Le=="o31"){var dt=ae.length,bt=(at=0,Le=="o31");for(at+=dt-(Ke=-3&dt);at<Ke;)bt?(ve=Ae,Be=(ye=be+ae.shift())+ae.shift(),Ae=(Re=ve+ae.shift())+ae.shift(),Ke-at==5?(be=Be+ae.shift(),at++):be=Be,bt=!1):(ye=be,ve=Ae+ae.shift(),Be=ye+ae.shift(),Re=ve+ae.shift(),be=Be+ae.shift(),Ke-at==5?(Ae=Re+ae.shift(),at++):Ae=Re,bt=!0),Z.U.P.curveTo(se,ye,ve,Be,Re,be,Ae),at+=4}else{if((Le+"").charAt(0)=="o")throw console.debug("Unknown operation: "+Le,te),Le;ae.push(Le)}}}ne.x=be,ne.y=Ae,ne.nStems=ge,ne.haveWidth=ce,ne.width=de,ne.open=Ie};var _=Z,K={Typr:_};return X.Typr=_,X.default=K,Object.defineProperty(X,"__esModule",{value:!0}),X}({}).Typr}/*!
Custom bundle of woff2otf (https://github.com/arty-name/woff2otf) with fflate
(https://github.com/101arrowz/fflate) for use in Troika text rendering. 
Original licenses apply: 
- fflate: https://github.com/101arrowz/fflate/blob/master/LICENSE (MIT)
- woff2otf.js: https://github.com/arty-name/woff2otf/blob/master/woff2otf.js (Apache2)
*/function woff2otfFactory(){return function(X){var Z=Uint8Array,_=Uint16Array,K=Uint32Array,te=new Z([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),ne=new Z([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),ie=new Z([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),oe=function(Le,Ke){for(var Ue=new _(31),rt=0;rt<31;++rt)Ue[rt]=Ke+=1<<Le[rt-1];var tt=new K(Ue[30]);for(rt=1;rt<30;++rt)for(var at=Ue[rt];at<Ue[rt+1];++at)tt[at]=at-Ue[rt]<<5|rt;return[Ue,tt]},se=oe(te,2),ae=se[0],ge=se[1];ae[28]=258,ge[258]=28;for(var ce=oe(ne,0)[0],de=new _(32768),Ie=0;Ie<32768;++Ie){var fe=(43690&Ie)>>>1|(21845&Ie)<<1;fe=(61680&(fe=(52428&fe)>>>2|(13107&fe)<<2))>>>4|(3855&fe)<<4,de[Ie]=((65280&fe)>>>8|(255&fe)<<8)>>>1}var be=function(Le,Ke,Ue){for(var rt=Le.length,tt=0,at=new _(Ke);tt<rt;++tt)++at[Le[tt]-1];var ze,qe=new _(Ke);for(tt=0;tt<Ke;++tt)qe[tt]=qe[tt-1]+at[tt-1]<<1;{ze=new _(1<<Ke);var Pe=15-Ke;for(tt=0;tt<rt;++tt)if(Le[tt])for(var Ye=tt<<4|Le[tt],$e=Ke-Le[tt],ut=qe[Le[tt]-1]++<<$e,ot=ut|(1<<$e)-1;ut<=ot;++ut)ze[de[ut]>>>Pe]=Ye}return ze},Ae=new Z(288);for(Ie=0;Ie<144;++Ie)Ae[Ie]=8;for(Ie=144;Ie<256;++Ie)Ae[Ie]=9;for(Ie=256;Ie<280;++Ie)Ae[Ie]=7;for(Ie=280;Ie<288;++Ie)Ae[Ie]=8;var ye=new Z(32);for(Ie=0;Ie<32;++Ie)ye[Ie]=5;var ve=be(Ae,9),Be=be(ye,5),Re=function(Le){for(var Ke=Le[0],Ue=1;Ue<Le.length;++Ue)Le[Ue]>Ke&&(Ke=Le[Ue]);return Ke},Ve=function(Le,Ke,Ue){var rt=Ke/8|0;return(Le[rt]|Le[rt+1]<<8)>>(7&Ke)&Ue},Ee=function(Le,Ke){var Ue=Ke/8|0;return(Le[Ue]|Le[Ue+1]<<8|Le[Ue+2]<<16)>>(7&Ke)},Ze=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],_e=function(Le,Ke,Ue){var rt=new Error(Ke||Ze[Le]);if(rt.code=Le,Error.captureStackTrace&&Error.captureStackTrace(rt,_e),!Ue)throw rt;return rt},Fe=function(Le,Ke,Ue){var rt=Le.length;if(!rt||Ue&&!Ue.l&&rt<5)return Ke||new Z(0);var tt=!Ke||Ue,at=!Ue||Ue.i;Ue||(Ue={}),Ke||(Ke=new Z(3*rt));var ze,qe=function(tn){var Sn=Ke.length;if(tn>Sn){var yn=new Z(Math.max(2*Sn,tn));yn.set(Ke),Ke=yn}},Pe=Ue.f||0,Ye=Ue.p||0,$e=Ue.b||0,ut=Ue.l,ot=Ue.d,gt=Ue.m,ht=Ue.n,dt=8*rt;do{if(!ut){Ue.f=Pe=Ve(Le,Ye,1);var bt=Ve(Le,Ye+1,3);if(Ye+=3,!bt){var Ht=Le[(Tt=((ze=Ye)/8|0)+(7&ze&&1)+4)-4]|Le[Tt-3]<<8,Dt=Tt+Ht;if(Dt>rt){at&&_e(0);break}tt&&qe($e+Ht),Ke.set(Le.subarray(Tt,Dt),$e),Ue.b=$e+=Ht,Ue.p=Ye=8*Dt;continue}if(bt==1)ut=ve,ot=Be,gt=9,ht=5;else if(bt==2){var Vt=Ve(Le,Ye,31)+257,mt=Ve(Le,Ye+10,15)+4,Ft=Vt+Ve(Le,Ye+5,31)+1;Ye+=14;for(var it=new Z(Ft),Lt=new Z(19),Et=0;Et<mt;++Et)Lt[ie[Et]]=Ve(Le,Ye+3*Et,7);Ye+=3*mt;var Ut=Re(Lt),Zt=(1<<Ut)-1,Ot=be(Lt,Ut);for(Et=0;Et<Ft;){var Tt,Je=Ot[Ve(Le,Ye,Zt)];if(Ye+=15&Je,(Tt=Je>>>4)<16)it[Et++]=Tt;else{var Oe=0,lt=0;for(Tt==16?(lt=3+Ve(Le,Ye,3),Ye+=2,Oe=it[Et-1]):Tt==17?(lt=3+Ve(Le,Ye,7),Ye+=3):Tt==18&&(lt=11+Ve(Le,Ye,127),Ye+=7);lt--;)it[Et++]=Oe}}var ft=it.subarray(0,Vt),St=it.subarray(Vt);gt=Re(ft),ht=Re(St),ut=be(ft,gt),ot=be(St,ht)}else _e(1);if(Ye>dt){at&&_e(0);break}}tt&&qe($e+131072);for(var Wt=(1<<gt)-1,zt=(1<<ht)-1,$t=Ye;;$t=Ye){var rn=(Oe=ut[Ee(Le,Ye)&Wt])>>>4;if((Ye+=15&Oe)>dt){at&&_e(0);break}if(Oe||_e(2),rn<256)Ke[$e++]=rn;else{if(rn==256){$t=Ye,ut=null;break}var Gn=rn-254;if(rn>264){var en=te[Et=rn-257];Gn=Ve(Le,Ye,(1<<en)-1)+ae[Et],Ye+=en}var In=ot[Ee(Le,Ye)&zt],un=In>>>4;if(In||_e(3),Ye+=15&In,St=ce[un],un>3&&(en=ne[un],St+=Ee(Le,Ye)&(1<<en)-1,Ye+=en),Ye>dt){at&&_e(0);break}tt&&qe($e+131072);for(var ln=$e+Gn;$e<ln;$e+=4)Ke[$e]=Ke[$e-St],Ke[$e+1]=Ke[$e+1-St],Ke[$e+2]=Ke[$e+2-St],Ke[$e+3]=Ke[$e+3-St];$e=ln}}Ue.l=ut,Ue.p=$t,Ue.b=$e,ut&&(Pe=1,Ue.m=gt,Ue.d=ot,Ue.n=ht)}while(!Pe);return $e==Ke.length?Ke:function(tn,Sn,yn){(yn==null||yn>tn.length)&&(yn=tn.length);var Tn=new(tn instanceof _?_:tn instanceof K?K:Z)(yn-Sn);return Tn.set(tn.subarray(Sn,yn)),Tn}(Ke,0,$e)},Te=new Z(0),ke=typeof TextDecoder<"u"&&new TextDecoder;try{ke.decode(Te,{stream:!0})}catch{}return X.convert_streams=function(Le){var Ke=new DataView(Le),Ue=0;function rt(){var Vt=Ke.getUint16(Ue);return Ue+=2,Vt}function tt(){var Vt=Ke.getUint32(Ue);return Ue+=4,Vt}function at(Vt){Ht.setUint16(Dt,Vt),Dt+=2}function ze(Vt){Ht.setUint32(Dt,Vt),Dt+=4}for(var qe={signature:tt(),flavor:tt(),length:tt(),numTables:rt(),reserved:rt(),totalSfntSize:tt(),majorVersion:rt(),minorVersion:rt(),metaOffset:tt(),metaLength:tt(),metaOrigLength:tt(),privOffset:tt(),privLength:tt()},Pe=0;Math.pow(2,Pe)<=qe.numTables;)Pe++;Pe--;for(var Ye=16*Math.pow(2,Pe),$e=16*qe.numTables-Ye,ut=12,ot=[],gt=0;gt<qe.numTables;gt++)ot.push({tag:tt(),offset:tt(),compLength:tt(),origLength:tt(),origChecksum:tt()}),ut+=16;var ht,dt=new Uint8Array(12+16*ot.length+ot.reduce(function(Vt,mt){return Vt+mt.origLength+4},0)),bt=dt.buffer,Ht=new DataView(bt),Dt=0;return ze(qe.flavor),at(qe.numTables),at(Ye),at(Pe),at($e),ot.forEach(function(Vt){ze(Vt.tag),ze(Vt.origChecksum),ze(ut),ze(Vt.origLength),Vt.outOffset=ut,(ut+=Vt.origLength)%4!=0&&(ut+=4-ut%4)}),ot.forEach(function(Vt){var mt,Ft=Le.slice(Vt.offset,Vt.offset+Vt.compLength);if(Vt.compLength!=Vt.origLength){var it=new Uint8Array(Vt.origLength);mt=new Uint8Array(Ft,2),Fe(mt,it)}else it=new Uint8Array(Ft);dt.set(it,Vt.outOffset);var Lt=0;(ut=Vt.outOffset+Vt.origLength)%4!=0&&(Lt=4-ut%4),dt.set(new Uint8Array(Lt).buffer,Vt.outOffset+Vt.origLength),ht=ut+Lt}),bt.slice(0,ht)},Object.defineProperty(X,"__esModule",{value:!0}),X}({}).convert_streams}function parserFactory(X,Z){const _={M:2,L:2,Q:4,C:6,Z:0},K={C:"18g,ca,368,1kz",D:"17k,6,2,2+4,5+c,2+6,2+1,10+1,9+f,j+11,2+1,a,2,2+1,15+2,3,j+2,6+3,2+8,2,2,2+1,w+a,4+e,3+3,2,3+2,3+5,23+w,2f+4,3,2+9,2,b,2+3,3,1k+9,6+1,3+1,2+2,2+d,30g,p+y,1,1+1g,f+x,2,sd2+1d,jf3+4,f+3,2+4,2+2,b+3,42,2,4+2,2+1,2,3,t+1,9f+w,2,el+2,2+g,d+2,2l,2+1,5,3+1,2+1,2,3,6,16wm+1v",R:"17m+3,2,2,6+3,m,15+2,2+2,h+h,13,3+8,2,2,3+1,2,p+1,x,5+4,5,a,2,2,3,u,c+2,g+1,5,2+1,4+1,5j,6+1,2,b,2+2,f,2+1,1s+2,2,3+1,7,1ez0,2,2+1,4+4,b,4,3,b,42,2+2,4,3,2+1,2,o+3,ae,ep,x,2o+2,3+1,3,5+1,6",L:"x9u,jff,a,fd,jv",T:"4t,gj+33,7o+4,1+1,7c+18,2,2+1,2+1,2,21+a,2,1b+k,h,2u+6,3+5,3+1,2+3,y,2,v+q,2k+a,1n+8,a,p+3,2+8,2+2,2+4,18+2,3c+e,2+v,1k,2,5+7,5,4+6,b+1,u,1n,5+3,9,l+1,r,3+1,1m,5+1,5+1,3+2,4,v+1,4,c+1,1m,5+4,2+1,5,l+1,n+5,2,1n,3,2+3,9,8+1,c+1,v,1q,d,1f,4,1m+2,6+2,2+3,8+1,c+1,u,1n,3,7,6+1,l+1,t+1,1m+1,5+3,9,l+1,u,21,8+2,2,2j,3+6,d+7,2r,3+8,c+5,23+1,s,2,2,1k+d,2+4,2+1,6+a,2+z,a,2v+3,2+5,2+1,3+1,q+1,5+2,h+3,e,3+1,7,g,jk+2,qb+2,u+2,u+1,v+1,1t+1,2+6,9,3+a,a,1a+2,3c+1,z,3b+2,5+1,a,7+2,64+1,3,1n,2+6,2,2,3+7,7+9,3,1d+d,1,1+1,1s+3,1d,2+4,2,6,15+8,d+1,x+3,3+1,2+2,1l,2+1,4,2+2,1n+7,3+1,49+2,2+c,2+6,5,7,4+1,5j+1l,2+4,ek,3+1,r+4,1e+4,6+5,2p+c,1+3,1,1+2,1+b,2db+2,3y,2p+v,ff+3,30+1,n9x,1+2,2+9,x+1,29+1,7l,4,5,q+1,6,48+1,r+h,e,13+7,q+a,1b+2,1d,3+3,3+1,14,1w+5,3+1,3+1,d,9,1c,1g,2+2,3+1,6+1,2,17+1,9,6n,3,5,fn5,ki+f,h+f,5s,6y+2,ea,6b,46+4,1af+2,2+1,6+3,15+2,5,4m+1,fy+3,as+1,4a+a,4x,1j+e,1l+2,1e+3,3+1,1y+2,11+4,2+7,1r,d+1,1h+8,b+3,3,2o+2,3,2+1,7,4h,4+7,m+1,1m+1,4,12+6,4+4,5g+7,3+2,2,o,2d+5,2,5+1,2+1,6n+3,7+1,2+1,s+1,2e+7,3,2+1,2z,2,3+5,2,2u+2,3+3,2+4,78+8,2+1,75+1,2,5,41+3,3+1,5,x+9,15+5,3+3,9,a+5,3+2,1b+c,2+1,bb+6,2+5,2,2b+l,3+6,2+1,2+1,3f+5,4,2+1,2+6,2,21+1,4,2,9o+1,470+8,at4+4,1o+6,t5,1s+3,2a,f5l+1,2+3,43o+2,a+7,1+7,3+6,v+3,45+2,1j0+1i,5+1d,9,f,n+4,2+e,11t+6,2+g,3+6,2+1,2+4,7a+6,c6+3,15t+6,32+6,1,gzau,v+2n,3l+6n"},te=1,ne=2,ie=4,oe=8,se=16,ae=32;let ge;function ce(Ze){if(!ge){const _e={R:ne,L:te,D:ie,C:se,U:ae,T:oe};ge=new Map;for(let Fe in K){let Te=0;K[Fe].split(",").forEach(ke=>{let[Le,Ke]=ke.split("+");Le=parseInt(Le,36),Ke=Ke?parseInt(Ke,36):0,ge.set(Te+=Le,_e[Fe]);for(let Ue=Ke;Ue--;)ge.set(++Te,_e[Fe])})}}return ge.get(Ze)||ae}const de=1,Ie=2,fe=3,be=4,Ae=[null,"isol","init","fina","medi"];function ye(Ze){const _e=new Uint8Array(Ze.length);let Fe=ae,Te=de,ke=-1;for(let Le=0;Le<Ze.length;Le++){const Ke=Ze.codePointAt(Le);let Ue=ce(Ke)|0,rt=de;Ue&oe||(Fe&(te|ie|se)?Ue&(ne|ie|se)?(rt=fe,(Te===de||Te===fe)&&_e[ke]++):Ue&(te|ae)&&(Te===Ie||Te===be)&&_e[ke]--:Fe&(ne|ae)&&(Te===Ie||Te===be)&&_e[ke]--,Te=_e[Le]=rt,Fe=Ue,ke=Le,Ke>65535&&Le++)}return _e}function ve(Ze,_e){const Fe=[];for(let ke=0;ke<_e.length;ke++){const Le=_e.codePointAt(ke);Le>65535&&ke++,Fe.push(X.U.codeToGlyph(Ze,Le))}const Te=Ze.GSUB;if(Te){const{lookupList:ke,featureList:Le}=Te;let Ke;const Ue=/^(rlig|liga|mset|isol|init|fina|medi|half|pres|blws|ccmp)$/,rt=[];Le.forEach(tt=>{if(Ue.test(tt.tag))for(let at=0;at<tt.tab.length;at++){if(rt[tt.tab[at]])continue;rt[tt.tab[at]]=!0;const ze=ke[tt.tab[at]],qe=/^(isol|init|fina|medi)$/.test(tt.tag);qe&&!Ke&&(Ke=ye(_e));for(let Pe=0;Pe<Fe.length;Pe++)(!Ke||!qe||Ae[Ke[Pe]]===tt.tag)&&X.U._applySubs(Fe,Pe,ze,ke)}})}return Fe}function Be(Ze,_e){const Fe=new Int16Array(_e.length*3);let Te=0;for(;Te<_e.length;Te++){const Ue=_e[Te];if(Ue===-1)continue;Fe[Te*3+2]=Ze.hmtx.aWidth[Ue];const rt=Ze.GPOS;if(rt){const tt=rt.lookupList;for(let at=0;at<tt.length;at++){const ze=tt[at];for(let qe=0;qe<ze.tabs.length;qe++){const Pe=ze.tabs[qe];if(ze.ltype===1){if(X._lctf.coverageIndex(Pe.coverage,Ue)!==-1&&Pe.pos){Ke(Pe.pos,Te);break}}else if(ze.ltype===2){let Ye=null,$e=ke();if($e!==-1){const ut=X._lctf.coverageIndex(Pe.coverage,_e[$e]);if(ut!==-1){if(Pe.fmt===1){const ot=Pe.pairsets[ut];for(let gt=0;gt<ot.length;gt++)ot[gt].gid2===Ue&&(Ye=ot[gt])}else if(Pe.fmt===2){const ot=X.U._getGlyphClass(_e[$e],Pe.classDef1),gt=X.U._getGlyphClass(Ue,Pe.classDef2);Ye=Pe.matrix[ot][gt]}if(Ye){Ye.val1&&Ke(Ye.val1,$e),Ye.val2&&Ke(Ye.val2,Te);break}}}}else if(ze.ltype===4){const Ye=X._lctf.coverageIndex(Pe.markCoverage,Ue);if(Ye!==-1){const $e=ke(Le),ut=$e===-1?-1:X._lctf.coverageIndex(Pe.baseCoverage,_e[$e]);if(ut!==-1){const ot=Pe.markArray[Ye],gt=Pe.baseArray[ut][ot.markClass];Fe[Te*3]=gt.x-ot.x+Fe[$e*3]-Fe[$e*3+2],Fe[Te*3+1]=gt.y-ot.y+Fe[$e*3+1];break}}}else if(ze.ltype===6){const Ye=X._lctf.coverageIndex(Pe.mark1Coverage,Ue);if(Ye!==-1){const $e=ke();if($e!==-1){const ut=_e[$e];if(Re(Ze,ut)===3){const ot=X._lctf.coverageIndex(Pe.mark2Coverage,ut);if(ot!==-1){const gt=Pe.mark1Array[Ye],ht=Pe.mark2Array[ot][gt.markClass];Fe[Te*3]=ht.x-gt.x+Fe[$e*3]-Fe[$e*3+2],Fe[Te*3+1]=ht.y-gt.y+Fe[$e*3+1];break}}}}}}}}else if(Ze.kern&&!Ze.cff){const tt=ke();if(tt!==-1){const at=Ze.kern.glyph1.indexOf(_e[tt]);if(at!==-1){const ze=Ze.kern.rval[at].glyph2.indexOf(Ue);ze!==-1&&(Fe[tt*3+2]+=Ze.kern.rval[at].vals[ze])}}}}return Fe;function ke(Ue){for(let rt=Te-1;rt>=0;rt--)if(_e[rt]!==-1&&(!Ue||Ue(_e[rt])))return rt;return-1}function Le(Ue){return Re(Ze,Ue)===1}function Ke(Ue,rt){for(let tt=0;tt<3;tt++)Fe[rt*3+tt]+=Ue[tt]||0}}function Re(Ze,_e){const Fe=Ze.GDEF&&Ze.GDEF.glyphClassDef;return Fe?X.U._getGlyphClass(_e,Fe):0}function Ve(...Ze){for(let _e=0;_e<Ze.length;_e++)if(typeof Ze[_e]=="number")return Ze[_e]}function Ee(Ze){const _e=Object.create(null),Fe=Ze["OS/2"],Te=Ze.hhea,ke=Ze.head.unitsPerEm,Le=Ve(Fe&&Fe.sTypoAscender,Te&&Te.ascender,ke),Ke={unitsPerEm:ke,ascender:Le,descender:Ve(Fe&&Fe.sTypoDescender,Te&&Te.descender,0),capHeight:Ve(Fe&&Fe.sCapHeight,Le),xHeight:Ve(Fe&&Fe.sxHeight,Le),lineGap:Ve(Fe&&Fe.sTypoLineGap,Te&&Te.lineGap),supportsCodePoint(Ue){return X.U.codeToGlyph(Ze,Ue)>0},forEachGlyph(Ue,rt,tt,at){let ze=0;const qe=1/Ke.unitsPerEm*rt,Pe=ve(Ze,Ue);let Ye=0;const $e=Be(Ze,Pe);return Pe.forEach((ut,ot)=>{if(ut!==-1){let gt=_e[ut];if(!gt){const{cmds:ht,crds:dt}=X.U.glyphToPath(Ze,ut);let bt="",Ht=0;for(let it=0,Lt=ht.length;it<Lt;it++){const Et=_[ht[it]];bt+=ht[it];for(let Ut=1;Ut<=Et;Ut++)bt+=(Ut>1?",":"")+dt[Ht++]}let Dt,Vt,mt,Ft;if(dt.length){Dt=Vt=1/0,mt=Ft=-1/0;for(let it=0,Lt=dt.length;it<Lt;it+=2){let Et=dt[it],Ut=dt[it+1];Et<Dt&&(Dt=Et),Ut<Vt&&(Vt=Ut),Et>mt&&(mt=Et),Ut>Ft&&(Ft=Ut)}}else Dt=mt=Vt=Ft=0;gt=_e[ut]={index:ut,advanceWidth:Ze.hmtx.aWidth[ut],xMin:Dt,yMin:Vt,xMax:mt,yMax:Ft,path:bt}}at.call(null,gt,ze+$e[ot*3]*qe,$e[ot*3+1]*qe,Ye),ze+=$e[ot*3+2]*qe,tt&&(ze+=tt*rt)}Ye+=Ue.codePointAt(Ye)>65535?2:1}),ze}};return Ke}return function(_e){const Fe=new Uint8Array(_e,0,4),Te=X._bin.readASCII(Fe,0,4);if(Te==="wOFF")_e=Z(_e);else if(Te==="wOF2")throw new Error("woff2 fonts not supported");return Ee(X.parse(_e)[0])}}const workerModule=defineWorkerModule({name:"Typr Font Parser",dependencies:[typrFactory,woff2otfFactory,parserFactory],init(X,Z,_){const K=X(),te=Z();return _(K,te)}});/*!
Custom bundle of @unicode-font-resolver/client v1.0.2 (https://github.com/lojjic/unicode-font-resolver)
for use in Troika text rendering. 
Original MIT license applies
*/function unicodeFontResolverClientFactory(){return function(X){var Z=function(){this.buckets=new Map};Z.prototype.add=function(Be){var Re=Be>>5;this.buckets.set(Re,(this.buckets.get(Re)||0)|1<<(31&Be))},Z.prototype.has=function(Be){var Re=this.buckets.get(Be>>5);return Re!==void 0&&(Re&1<<(31&Be))!=0},Z.prototype.serialize=function(){var Be=[];return this.buckets.forEach(function(Re,Ve){Be.push((+Ve).toString(36)+":"+Re.toString(36))}),Be.join(",")},Z.prototype.deserialize=function(Be){var Re=this;this.buckets.clear(),Be.split(",").forEach(function(Ve){var Ee=Ve.split(":");Re.buckets.set(parseInt(Ee[0],36),parseInt(Ee[1],36))})};var _=Math.pow(2,8),K=_-1,te=~K;function ne(Be){var Re=function(Ee){return Ee&te}(Be).toString(16),Ve=function(Ee){return(Ee&te)+_-1}(Be).toString(16);return"codepoint-index/plane"+(Be>>16)+"/"+Re+"-"+Ve+".json"}function ie(Be,Re){var Ve=Be&K,Ee=Re.codePointAt(Ve/6|0);return((Ee=(Ee||48)-48)&1<<Ve%6)!=0}function oe(Be,Re){var Ve;(Ve=Be,Ve.replace(/U\+/gi,"").replace(/^,+|,+$/g,"").split(/,+/).map(function(Ee){return Ee.split("-").map(function(Ze){return parseInt(Ze.trim(),16)})})).forEach(function(Ee){var Ze=Ee[0],_e=Ee[1];_e===void 0&&(_e=Ze),Re(Ze,_e)})}function se(Be,Re){oe(Be,function(Ve,Ee){for(var Ze=Ve;Ze<=Ee;Ze++)Re(Ze)})}var ae={},ge={},ce=new WeakMap,de="https://cdn.jsdelivr.net/gh/lojjic/unicode-font-resolver@v1.0.1/packages/data";function Ie(Be){var Re=ce.get(Be);return Re||(Re=new Z,se(Be.ranges,function(Ve){return Re.add(Ve)}),ce.set(Be,Re)),Re}var fe,be=new Map;function Ae(Be,Re,Ve){return Be[Re]?Re:Be[Ve]?Ve:function(Ee){for(var Ze in Ee)return Ze}(Be)}function ye(Be,Re){var Ve=Re;if(!Be.includes(Ve)){Ve=1/0;for(var Ee=0;Ee<Be.length;Ee++)Math.abs(Be[Ee]-Re)<Math.abs(Ve-Re)&&(Ve=Be[Ee])}return Ve}function ve(Be){return fe||(fe=new Set,se("9-D,20,85,A0,1680,2000-200A,2028-202F,205F,3000",function(Re){fe.add(Re)})),fe.has(Be)}return X.CodePointSet=Z,X.clearCache=function(){ae={},ge={}},X.getFontsForString=function(Be,Re){Re===void 0&&(Re={});var Ve,Ee=Re.lang;Ee===void 0&&(Ee=new RegExp("\\p{Script=Hangul}","u").test(Ve=Be)?"ko":new RegExp("\\p{Script=Hiragana}|\\p{Script=Katakana}","u").test(Ve)?"ja":"en");var Ze=Re.category;Ze===void 0&&(Ze="sans-serif");var _e=Re.style;_e===void 0&&(_e="normal");var Fe=Re.weight;Fe===void 0&&(Fe=400);var Te=(Re.dataUrl||de).replace(/\/$/g,""),ke=new Map,Le=new Uint8Array(Be.length),Ke={},Ue={},rt=new Array(Be.length),tt=new Map,at=!1;function ze(Ye){var $e=be.get(Ye);return $e||($e=fetch(Te+"/"+Ye).then(function(ut){if(!ut.ok)throw new Error(ut.statusText);return ut.json().then(function(ot){if(!Array.isArray(ot)||ot[0]!==1)throw new Error("Incorrect schema version; need 1, got "+ot[0]);return ot[1]})}).catch(function(ut){if(Te!==de)return at||(console.error('unicode-font-resolver: Failed loading from dataUrl "'+Te+'", trying default CDN. '+ut.message),at=!0),Te=de,be.delete(Ye),ze(Ye);throw ut}),be.set(Ye,$e)),$e}for(var qe=function(Ye){var $e=Be.codePointAt(Ye),ut=ne($e);rt[Ye]=ut,ae[ut]||tt.has(ut)||tt.set(ut,ze(ut).then(function(ot){ae[ut]=ot})),$e>65535&&(Ye++,Pe=Ye)},Pe=0;Pe<Be.length;Pe++)qe(Pe);return Promise.all(tt.values()).then(function(){tt.clear();for(var Ye=function(ut){var ot=Be.codePointAt(ut),gt=null,ht=ae[rt[ut]],dt=void 0;for(var bt in ht){var Ht=Ue[bt];if(Ht===void 0&&(Ht=Ue[bt]=new RegExp(bt).test(Ee||"en")),Ht){for(var Dt in dt=bt,ht[bt])if(ie(ot,ht[bt][Dt])){gt=Dt;break}break}}if(!gt){e:for(var Vt in ht)if(Vt!==dt){for(var mt in ht[Vt])if(ie(ot,ht[Vt][mt])){gt=mt;break e}}}gt||(console.debug("No font coverage for U+"+ot.toString(16)),gt="latin"),rt[ut]=gt,ge[gt]||tt.has(gt)||tt.set(gt,ze("font-meta/"+gt+".json").then(function(Ft){ge[gt]=Ft})),ot>65535&&(ut++,$e=ut)},$e=0;$e<Be.length;$e++)Ye($e);return Promise.all(tt.values())}).then(function(){for(var Ye,$e=null,ut=0;ut<Be.length;ut++){var ot=Be.codePointAt(ut);if($e&&(ve(ot)||Ie($e).has(ot)))Le[ut]=Le[ut-1];else{$e=ge[rt[ut]];var gt=Ke[$e.id];if(!gt){var ht=$e.typeforms,dt=Ae(ht,Ze,"sans-serif"),bt=Ae(ht[dt],_e,"normal"),Ht=ye((Ye=ht[dt])===null||Ye===void 0?void 0:Ye[bt],Fe);gt=Ke[$e.id]=Te+"/font-files/"+$e.id+"/"+dt+"."+bt+"."+Ht+".woff"}var Dt=ke.get(gt);Dt==null&&(Dt=ke.size,ke.set(gt,Dt)),Le[ut]=Dt}ot>65535&&(ut++,Le[ut]=Le[ut-1])}return{fontUrls:Array.from(ke.keys()),chars:Le}})},Object.defineProperty(X,"__esModule",{value:!0}),X}({})}function createFontResolver(X,Z){const _=Object.create(null),K=Object.create(null);function te(ie,oe){const se=ae=>{console.error(`Failure loading font ${ie}`,ae)};try{const ae=new XMLHttpRequest;ae.open("get",ie,!0),ae.responseType="arraybuffer",ae.onload=function(){if(ae.status>=400)se(new Error(ae.statusText));else if(ae.status>0)try{const ge=X(ae.response);ge.src=ie,oe(ge)}catch(ge){se(ge)}},ae.onerror=se,ae.send()}catch(ae){se(ae)}}function ne(ie,oe){let se=_[ie];se?oe(se):K[ie]?K[ie].push(oe):(K[ie]=[oe],te(ie,ae=>{ae.src=ie,_[ie]=ae,K[ie].forEach(ge=>ge(ae)),delete K[ie]}))}return function(ie,oe,{lang:se,fonts:ae=[],style:ge="normal",weight:ce="normal",unicodeFontsURL:de}={}){const Ie=new Uint8Array(ie.length),fe=[];ie.length||ve();const be=new Map,Ae=[];if(ge!=="italic"&&(ge="normal"),typeof ce!="number"&&(ce=ce==="bold"?700:400),ae&&!Array.isArray(ae)&&(ae=[ae]),ae=ae.slice().filter(Re=>!Re.lang||Re.lang.test(se)).reverse(),ae.length){let Ze=0;(function _e(Fe=0){for(let Te=Fe,ke=ie.length;Te<ke;Te++){const Le=ie.codePointAt(Te);if(Ze===1&&fe[Ie[Te-1]].supportsCodePoint(Le)||Te>0&&/\s/.test(ie[Te]))Ie[Te]=Ie[Te-1],Ze===2&&(Ae[Ae.length-1][1]=Te);else for(let Ke=Ie[Te],Ue=ae.length;Ke<=Ue;Ke++)if(Ke===Ue){const rt=Ze===2?Ae[Ae.length-1]:Ae[Ae.length]=[Te,Te];rt[1]=Te,Ze=2}else{Ie[Te]=Ke;const{src:rt,unicodeRange:tt}=ae[Ke];if(!tt||Be(Le,tt)){const at=_[rt];if(!at){ne(rt,()=>{_e(Te)});return}if(at.supportsCodePoint(Le)){let ze=be.get(at);typeof ze!="number"&&(ze=fe.length,fe.push(at),be.set(at,ze)),Ie[Te]=ze,Ze=1;break}}}Le>65535&&Te+1<ke&&(Ie[Te+1]=Ie[Te],Te++,Ze===2&&(Ae[Ae.length-1][1]=Te))}ye()})()}else Ae.push([0,ie.length-1]),ye();function ye(){if(Ae.length){const Re=Ae.map(Ve=>ie.substring(Ve[0],Ve[1]+1)).join(`
`);Z.getFontsForString(Re,{lang:se||void 0,style:ge,weight:ce,dataUrl:de}).then(({fontUrls:Ve,chars:Ee})=>{const Ze=fe.length;let _e=0;Ae.forEach(Te=>{for(let ke=0,Le=Te[1]-Te[0];ke<=Le;ke++)Ie[Te[0]+ke]=Ee[_e++]+Ze;_e++});let Fe=0;Ve.forEach((Te,ke)=>{ne(Te,Le=>{fe[ke+Ze]=Le,++Fe===Ve.length&&ve()})})})}else ve()}function ve(){oe({chars:Ie,fonts:fe})}function Be(Re,Ve){for(let Ee=0;Ee<Ve.length;Ee++){const[Ze,_e=Ze]=Ve[Ee];if(Ze<=Re&&Re<=_e)return!0}return!1}}}const fontResolverWorkerModule=defineWorkerModule({name:"FontResolver",dependencies:[createFontResolver,workerModule,unicodeFontResolverClientFactory],init(X,Z,_){return X(Z,_())}});function createTypesetter(X,Z){const K=/[\u00AD\u034F\u061C\u115F-\u1160\u17B4-\u17B5\u180B-\u180E\u200B-\u200F\u202A-\u202E\u2060-\u206F\u3164\uFE00-\uFE0F\uFEFF\uFFA0\uFFF0-\uFFF8]/,te="[^\\S\\u00A0]",ne=new RegExp(`${te}|[\\-\\u007C\\u00AD\\u2010\\u2012-\\u2014\\u2027\\u2056\\u2E17\\u2E40]`);function ie({text:fe,lang:be,fonts:Ae,style:ye,weight:ve,preResolvedFonts:Be,unicodeFontsURL:Re},Ve){const Ee=({chars:Ze,fonts:_e})=>{let Fe,Te;const ke=[];for(let Le=0;Le<Ze.length;Le++)Ze[Le]!==Te?(Te=Ze[Le],ke.push(Fe={start:Le,end:Le,fontObj:_e[Ze[Le]]})):Fe.end=Le;Ve(ke)};Be?Ee(Be):X(fe,Ee,{lang:be,fonts:Ae,style:ye,weight:ve,unicodeFontsURL:Re})}function oe({text:fe="",font:be,lang:Ae,sdfGlyphSize:ye=64,fontSize:ve=400,fontWeight:Be=1,fontStyle:Re="normal",letterSpacing:Ve=0,lineHeight:Ee="normal",maxWidth:Ze=1/0,direction:_e,textAlign:Fe="left",textIndent:Te=0,whiteSpace:ke="normal",overflowWrap:Le="normal",anchorX:Ke=0,anchorY:Ue=0,metricsOnly:rt=!1,unicodeFontsURL:tt,preResolvedFonts:at=null,includeCaretPositions:ze=!1,chunkedBoundsSize:qe=8192,colorRanges:Pe=null},Ye){const $e=ce(),ut={fontLoad:0,typesetting:0};fe.indexOf("\r")>-1&&(console.info("Typesetter: got text with \\r chars; normalizing to \\n"),fe=fe.replace(/\r\n/g,`
`).replace(/\r/g,`
`)),ve=+ve,Ve=+Ve,Ze=+Ze,Ee=Ee||"normal",Te=+Te,ie({text:fe,lang:Ae,style:Re,weight:Be,fonts:typeof be=="string"?[{src:be}]:be,unicodeFontsURL:tt,preResolvedFonts:at},ot=>{ut.fontLoad=ce()-$e;const gt=isFinite(Ze);let ht=null,dt=null,bt=null,Ht=null,Dt=null,Vt=null,mt=null,Ft=null,it=0,Lt=0,Et=ke!=="nowrap";const Ut=new Map,Zt=ce();let Ot=Te,Tt=0,Je=new de;const Oe=[Je];ot.forEach(zt=>{const{fontObj:$t}=zt,{ascender:rn,descender:Gn,unitsPerEm:en,lineGap:In,capHeight:un,xHeight:ln}=$t;let tn=Ut.get($t);if(!tn){const wt=ve/en,Mt=Ee==="normal"?(rn-Gn+In)*wt:Ee*ve,on=(Mt-(rn-Gn)*wt)/2,dn=Math.min(Mt,(rn-Gn)*wt),an=(rn+Gn)/2*wt+dn/2;tn={index:Ut.size,src:$t.src,fontObj:$t,fontSizeMult:wt,unitsPerEm:en,ascender:rn*wt,descender:Gn*wt,capHeight:un*wt,xHeight:ln*wt,lineHeight:Mt,baseline:-on-rn*wt,caretTop:an,caretBottom:an-dn},Ut.set($t,tn)}const{fontSizeMult:Sn}=tn,yn=fe.slice(zt.start,zt.end+1);let Tn,vt;$t.forEachGlyph(yn,ve,Ve,(wt,Mt,on,dn)=>{Mt+=Tt,dn+=zt.start,Tn=Mt,vt=wt;const an=fe.charAt(dn),Mn=wt.advanceWidth*Sn,Pn=Je.count;let Nn;if("isEmpty"in wt||(wt.isWhitespace=!!an&&new RegExp(te).test(an),wt.canBreakAfter=!!an&&ne.test(an),wt.isEmpty=wt.xMin===wt.xMax||wt.yMin===wt.yMax||K.test(an)),!wt.isWhitespace&&!wt.isEmpty&&Lt++,Et&&gt&&!wt.isWhitespace&&Mt+Mn+Ot>Ze&&Pn){if(Je.glyphAt(Pn-1).glyphObj.canBreakAfter)Nn=new de,Ot=-Mt;else for(let Ir=Pn;Ir--;)if(Ir===0&&Le==="break-word"){Nn=new de,Ot=-Mt;break}else if(Je.glyphAt(Ir).glyphObj.canBreakAfter){Nn=Je.splitAt(Ir+1);const dr=Nn.glyphAt(0).x;Ot-=dr;for(let vr=Nn.count;vr--;)Nn.glyphAt(vr).x-=dr;break}Nn&&(Je.isSoftWrapped=!0,Je=Nn,Oe.push(Je),it=Ze)}let kn=Je.glyphAt(Je.count);kn.glyphObj=wt,kn.x=Mt+Ot,kn.y=on,kn.width=Mn,kn.charIndex=dn,kn.fontData=tn,an===`
`&&(Je=new de,Oe.push(Je),Ot=-(Mt+Mn+Ve*ve)+Te)}),Tt=Tn+vt.advanceWidth*Sn+Ve*ve});let lt=0;Oe.forEach(zt=>{let $t=!0;for(let rn=zt.count;rn--;){const Gn=zt.glyphAt(rn);$t&&!Gn.glyphObj.isWhitespace&&(zt.width=Gn.x+Gn.width,zt.width>it&&(it=zt.width),$t=!1);let{lineHeight:en,capHeight:In,xHeight:un,baseline:ln}=Gn.fontData;en>zt.lineHeight&&(zt.lineHeight=en);const tn=ln-zt.baseline;tn<0&&(zt.baseline+=tn,zt.cap+=tn,zt.ex+=tn),zt.cap=Math.max(zt.cap,zt.baseline+In),zt.ex=Math.max(zt.ex,zt.baseline+un)}zt.baseline-=lt,zt.cap-=lt,zt.ex-=lt,lt+=zt.lineHeight});let ft=0,St=0;if(Ke&&(typeof Ke=="number"?ft=-Ke:typeof Ke=="string"&&(ft=-it*(Ke==="left"?0:Ke==="center"?.5:Ke==="right"?1:ae(Ke)))),Ue&&(typeof Ue=="number"?St=-Ue:typeof Ue=="string"&&(St=Ue==="top"?0:Ue==="top-baseline"?-Oe[0].baseline:Ue==="top-cap"?-Oe[0].cap:Ue==="top-ex"?-Oe[0].ex:Ue==="middle"?lt/2:Ue==="bottom"?lt:Ue==="bottom-baseline"?-Oe[Oe.length-1].baseline:ae(Ue)*lt)),!rt){const zt=Z.getEmbeddingLevels(fe,_e);ht=new Uint16Array(Lt),dt=new Uint8Array(Lt),bt=new Float32Array(Lt*2),Ht={},mt=[1/0,1/0,-1/0,-1/0],Ft=[],ze&&(Vt=new Float32Array(fe.length*4)),Pe&&(Dt=new Uint8Array(Lt*3));let $t=0,rn=-1,Gn=-1,en,In;if(Oe.forEach((un,ln)=>{let{count:tn,width:Sn}=un;if(tn>0){let yn=0;for(let dn=tn;dn--&&un.glyphAt(dn).glyphObj.isWhitespace;)yn++;let Tn=0,vt=0;if(Fe==="center")Tn=(it-Sn)/2;else if(Fe==="right")Tn=it-Sn;else if(Fe==="justify"&&un.isSoftWrapped){let dn=0;for(let an=tn-yn;an--;)un.glyphAt(an).glyphObj.isWhitespace&&dn++;vt=(it-Sn)/dn}if(vt||Tn){let dn=0;for(let an=0;an<tn;an++){let Mn=un.glyphAt(an);const Pn=Mn.glyphObj;Mn.x+=Tn+dn,vt!==0&&Pn.isWhitespace&&an<tn-yn&&(dn+=vt,Mn.width+=vt)}}const wt=Z.getReorderSegments(fe,zt,un.glyphAt(0).charIndex,un.glyphAt(un.count-1).charIndex);for(let dn=0;dn<wt.length;dn++){const[an,Mn]=wt[dn];let Pn=1/0,Nn=-1/0;for(let kn=0;kn<tn;kn++)if(un.glyphAt(kn).charIndex>=an){let Ir=kn,dr=kn;for(;dr<tn;dr++){let vr=un.glyphAt(dr);if(vr.charIndex>Mn)break;dr<tn-yn&&(Pn=Math.min(Pn,vr.x),Nn=Math.max(Nn,vr.x+vr.width))}for(let vr=Ir;vr<dr;vr++){const Yr=un.glyphAt(vr);Yr.x=Nn-(Yr.x+Yr.width-Pn)}break}}let Mt;const on=dn=>Mt=dn;for(let dn=0;dn<tn;dn++){const an=un.glyphAt(dn);Mt=an.glyphObj;const Mn=Mt.index,Pn=zt.levels[an.charIndex]&1;if(Pn){const Nn=Z.getMirroredCharacter(fe[an.charIndex]);Nn&&an.fontData.fontObj.forEachGlyph(Nn,0,0,on)}if(ze){const{charIndex:Nn,fontData:kn}=an,Ir=an.x+ft,dr=an.x+an.width+ft;Vt[Nn*4]=Pn?dr:Ir,Vt[Nn*4+1]=Pn?Ir:dr,Vt[Nn*4+2]=un.baseline+kn.caretBottom+St,Vt[Nn*4+3]=un.baseline+kn.caretTop+St;const vr=Nn-rn;vr>1&&ge(Vt,rn,vr),rn=Nn}if(Pe){const{charIndex:Nn}=an;for(;Nn>Gn;)Gn++,Pe.hasOwnProperty(Gn)&&(In=Pe[Gn])}if(!Mt.isWhitespace&&!Mt.isEmpty){const Nn=$t++,{fontSizeMult:kn,src:Ir,index:dr}=an.fontData,vr=Ht[Ir]||(Ht[Ir]={});vr[Mn]||(vr[Mn]={path:Mt.path,pathBounds:[Mt.xMin,Mt.yMin,Mt.xMax,Mt.yMax]});const Yr=an.x+ft,Fr=an.y+un.baseline+St;bt[Nn*2]=Yr,bt[Nn*2+1]=Fr;const Nr=Yr+Mt.xMin*kn,Kr=Fr+Mt.yMin*kn,_r=Yr+Mt.xMax*kn,Un=Fr+Mt.yMax*kn;Nr<mt[0]&&(mt[0]=Nr),Kr<mt[1]&&(mt[1]=Kr),_r>mt[2]&&(mt[2]=_r),Un>mt[3]&&(mt[3]=Un),Nn%qe===0&&(en={start:Nn,end:Nn,rect:[1/0,1/0,-1/0,-1/0]},Ft.push(en)),en.end++;const Lr=en.rect;if(Nr<Lr[0]&&(Lr[0]=Nr),Kr<Lr[1]&&(Lr[1]=Kr),_r>Lr[2]&&(Lr[2]=_r),Un>Lr[3]&&(Lr[3]=Un),ht[Nn]=Mn,dt[Nn]=dr,Pe){const Bi=Nn*3;Dt[Bi]=In>>16&255,Dt[Bi+1]=In>>8&255,Dt[Bi+2]=In&255}}}}}),Vt){const un=fe.length-rn;un>1&&ge(Vt,rn,un)}}const Wt=[];Ut.forEach(({index:zt,src:$t,unitsPerEm:rn,ascender:Gn,descender:en,lineHeight:In,capHeight:un,xHeight:ln})=>{Wt[zt]={src:$t,unitsPerEm:rn,ascender:Gn,descender:en,lineHeight:In,capHeight:un,xHeight:ln}}),ut.typesetting=ce()-Zt,Ye({glyphIds:ht,glyphFontIndices:dt,glyphPositions:bt,glyphData:Ht,fontData:Wt,caretPositions:Vt,glyphColors:Dt,chunkedBounds:Ft,fontSize:ve,topBaseline:St+Oe[0].baseline,blockBounds:[ft,St-lt,ft+it,St],visibleBounds:mt,timings:ut})})}function se(fe,be){oe({...fe,metricsOnly:!0},Ae=>{const[ye,ve,Be,Re]=Ae.blockBounds;be({width:Be-ye,height:Re-ve})})}function ae(fe){let be=fe.match(/^([\d.]+)%$/),Ae=be?parseFloat(be[1]):NaN;return isNaN(Ae)?0:Ae/100}function ge(fe,be,Ae){const ye=fe[be*4],ve=fe[be*4+1],Be=fe[be*4+2],Re=fe[be*4+3],Ve=(ve-ye)/Ae;for(let Ee=0;Ee<Ae;Ee++){const Ze=(be+Ee)*4;fe[Ze]=ye+Ve*Ee,fe[Ze+1]=ye+Ve*(Ee+1),fe[Ze+2]=Be,fe[Ze+3]=Re}}function ce(){return(self.performance||Date).now()}function de(){this.data=[]}const Ie=["glyphObj","x","y","width","charIndex","fontData"];return de.prototype={width:0,lineHeight:0,baseline:0,cap:0,ex:0,isSoftWrapped:!1,get count(){return Math.ceil(this.data.length/Ie.length)},glyphAt(fe){let be=de.flyweight;return be.data=this.data,be.index=fe,be},splitAt(fe){let be=new de;return be.data=this.data.splice(fe*Ie.length),be}},de.flyweight=Ie.reduce((fe,be,Ae,ye)=>(Object.defineProperty(fe,be,{get(){return this.data[this.index*Ie.length+Ae]},set(ve){this.data[this.index*Ie.length+Ae]=ve}}),fe),{data:null,index:0}),{typeset:oe,measure:se}}const now=()=>(self.performance||Date).now(),mainThreadGenerator=SDFGenerator();let warned;function generateSDF(X,Z,_,K,te,ne,ie,oe,se,ae,ge=!0){return ge?generateSDF_GL(X,Z,_,K,te,ne,ie,oe,se,ae).then(null,ce=>(warned||(console.warn("WebGL SDF generation failed, falling back to JS",ce),warned=!0),generateSDF_JS_Worker(X,Z,_,K,te,ne,ie,oe,se,ae))):generateSDF_JS_Worker(X,Z,_,K,te,ne,ie,oe,se,ae)}const queue=[],chunkTimeBudget=5;let timer=0;function nextChunk(){const X=now();for(;queue.length&&now()-X<chunkTimeBudget;)queue.shift()();timer=queue.length?setTimeout(nextChunk,0):0}const generateSDF_GL=(...X)=>new Promise((Z,_)=>{queue.push(()=>{const K=now();try{mainThreadGenerator.webgl.generateIntoCanvas(...X),Z({timing:now()-K})}catch(te){_(te)}}),timer||(timer=setTimeout(nextChunk,0))}),threadCount=4,idleTimeout=2e3,threads={};let callNum=0;function generateSDF_JS_Worker(X,Z,_,K,te,ne,ie,oe,se,ae){const ge="TroikaTextSDFGenerator_JS_"+callNum++%threadCount;let ce=threads[ge];return ce||(ce=threads[ge]={workerModule:defineWorkerModule({name:ge,workerId:ge,dependencies:[SDFGenerator,now],init(de,Ie){const fe=de().javascript.generate;return function(...be){const Ae=Ie();return{textureData:fe(...be),timing:Ie()-Ae}}},getTransferables(de){return[de.textureData.buffer]}}),requests:0,idleTimer:null}),ce.requests++,clearTimeout(ce.idleTimer),ce.workerModule(X,Z,_,K,te,ne).then(({textureData:de,timing:Ie})=>{const fe=now(),be=new Uint8Array(de.length*4);for(let Ae=0;Ae<de.length;Ae++)be[Ae*4+ae]=de[Ae];return mainThreadGenerator.webglUtils.renderImageData(ie,be,oe,se,X,Z,1<<3-ae),Ie+=now()-fe,--ce.requests===0&&(ce.idleTimer=setTimeout(()=>{terminateWorker(ge)},idleTimeout)),{timing:Ie}})}function warmUpSDFCanvas(X){X._warm||(mainThreadGenerator.webgl.isSupported(X),X._warm=!0)}const resizeWebGLCanvasWithoutClearing=mainThreadGenerator.webglUtils.resizeWebGLCanvasWithoutClearing,CONFIG={defaultFontURL:null,unicodeFontsURL:null,sdfGlyphSize:64,sdfMargin:1/16,sdfExponent:9,textureWidth:2048,useWorker:!0},tempColor=new Color$1;function now$1(){return(self.performance||Date).now()}const atlases=Object.create(null);function getTextRenderInfo(X,Z){X=assign({},X);const _=now$1(),{defaultFontURL:K}=CONFIG,te=[];if(K&&te.push({label:"default",src:toAbsoluteURL(K)}),X.font&&te.push({label:"user",src:toAbsoluteURL(X.font)}),X.font=te,X.text=""+X.text,X.sdfGlyphSize=X.sdfGlyphSize||CONFIG.sdfGlyphSize,X.unicodeFontsURL=X.unicodeFontsURL||CONFIG.unicodeFontsURL,X.colorRanges!=null){let Ie={};for(let fe in X.colorRanges)if(X.colorRanges.hasOwnProperty(fe)){let be=X.colorRanges[fe];typeof be!="number"&&(be=tempColor.set(be).getHex()),Ie[fe]=be}X.colorRanges=Ie}Object.freeze(X);const{textureWidth:ne,sdfExponent:ie}=CONFIG,{sdfGlyphSize:oe}=X,se=ne/oe*4;let ae=atlases[oe];if(!ae){const Ie=document.createElement("canvas");Ie.width=ne,Ie.height=oe*256/se,ae=atlases[oe]={glyphCount:0,sdfGlyphSize:oe,sdfCanvas:Ie,sdfTexture:new Texture(Ie,void 0,void 0,void 0,LinearFilter,LinearFilter),contextLost:!1,glyphsByFont:new Map},ae.sdfTexture.generateMipmaps=!1,initContextLossHandling(ae)}const{sdfTexture:ge,sdfCanvas:ce}=ae;typesetInWorker(X).then(Ie=>{const{glyphIds:fe,glyphFontIndices:be,fontData:Ae,glyphPositions:ye,fontSize:ve,timings:Be}=Ie,Re=[],Ve=new Float32Array(fe.length*4);let Ee=0,Ze=0;const _e=now$1(),Fe=Ae.map(Ue=>{let rt=ae.glyphsByFont.get(Ue.src);return rt||ae.glyphsByFont.set(Ue.src,rt=new Map),rt});fe.forEach((Ue,rt)=>{const tt=be[rt],{src:at,unitsPerEm:ze}=Ae[tt];let qe=Fe[tt].get(Ue);if(!qe){const{path:ot,pathBounds:gt}=Ie.glyphData[at][Ue],ht=Math.max(gt[2]-gt[0],gt[3]-gt[1])/oe*(CONFIG.sdfMargin*oe+.5),dt=ae.glyphCount++,bt=[gt[0]-ht,gt[1]-ht,gt[2]+ht,gt[3]+ht];Fe[tt].set(Ue,qe={path:ot,atlasIndex:dt,sdfViewBox:bt}),Re.push(qe)}const{sdfViewBox:Pe}=qe,Ye=ye[Ze++],$e=ye[Ze++],ut=ve/ze;Ve[Ee++]=Ye+Pe[0]*ut,Ve[Ee++]=$e+Pe[1]*ut,Ve[Ee++]=Ye+Pe[2]*ut,Ve[Ee++]=$e+Pe[3]*ut,fe[rt]=qe.atlasIndex}),Be.quads=(Be.quads||0)+(now$1()-_e);const Te=now$1();Be.sdf={};const ke=ce.height,Le=Math.ceil(ae.glyphCount/se),Ke=Math.pow(2,Math.ceil(Math.log2(Le*oe)));Ke>ke&&(console.info(`Increasing SDF texture size ${ke}->${Ke}`),resizeWebGLCanvasWithoutClearing(ce,ne,Ke),ge.dispose()),Promise.all(Re.map(Ue=>generateGlyphSDF(Ue,ae,X.gpuAccelerateSDF).then(({timing:rt})=>{Be.sdf[Ue.atlasIndex]=rt}))).then(()=>{Re.length&&!ae.contextLost&&(safariPre15Workaround(ae),ge.needsUpdate=!0),Be.sdfTotal=now$1()-Te,Be.total=now$1()-_,Z(Object.freeze({parameters:X,sdfTexture:ge,sdfGlyphSize:oe,sdfExponent:ie,glyphBounds:Ve,glyphAtlasIndices:fe,glyphColors:Ie.glyphColors,caretPositions:Ie.caretPositions,chunkedBounds:Ie.chunkedBounds,ascender:Ie.ascender,descender:Ie.descender,lineHeight:Ie.lineHeight,capHeight:Ie.capHeight,xHeight:Ie.xHeight,topBaseline:Ie.topBaseline,blockBounds:Ie.blockBounds,visibleBounds:Ie.visibleBounds,timings:Ie.timings}))})}),Promise.resolve().then(()=>{ae.contextLost||warmUpSDFCanvas(ce)})}function generateGlyphSDF({path:X,atlasIndex:Z,sdfViewBox:_},{sdfGlyphSize:K,sdfCanvas:te,contextLost:ne},ie){if(ne)return Promise.resolve({timing:-1});const{textureWidth:oe,sdfExponent:se}=CONFIG,ae=Math.max(_[2]-_[0],_[3]-_[1]),ge=Math.floor(Z/4),ce=ge%(oe/K)*K,de=Math.floor(ge/(oe/K))*K,Ie=Z%4;return generateSDF(K,K,X,_,ae,se,te,ce,de,Ie,ie)}function initContextLossHandling(X){const Z=X.sdfCanvas;Z.addEventListener("webglcontextlost",_=>{console.log("Context Lost",_),_.preventDefault(),X.contextLost=!0}),Z.addEventListener("webglcontextrestored",_=>{console.log("Context Restored",_),X.contextLost=!1;const K=[];X.glyphsByFont.forEach(te=>{te.forEach(ne=>{K.push(generateGlyphSDF(ne,X,!0))})}),Promise.all(K).then(()=>{safariPre15Workaround(X),X.sdfTexture.needsUpdate=!0})})}function preloadFont({font:X,characters:Z,sdfGlyphSize:_},K){let te=Array.isArray(Z)?Z.join(`
`):""+Z;getTextRenderInfo({font:X,sdfGlyphSize:_,text:te},K)}function assign(X,Z){for(let _ in Z)Z.hasOwnProperty(_)&&(X[_]=Z[_]);return X}let linkEl;function toAbsoluteURL(X){return linkEl||(linkEl=typeof document>"u"?{}:document.createElement("a")),linkEl.href=X,linkEl.href}function safariPre15Workaround(X){if(typeof createImageBitmap!="function"){console.info("Safari<15: applying SDF canvas workaround");const{sdfCanvas:Z,sdfTexture:_}=X,{width:K,height:te}=Z,ne=X.sdfCanvas.getContext("webgl");let ie=_.image.data;(!ie||ie.length!==K*te*4)&&(ie=new Uint8Array(K*te*4),_.image={width:K,height:te,data:ie},_.flipY=!1,_.isDataTexture=!0),ne.readPixels(0,0,K,te,ne.RGBA,ne.UNSIGNED_BYTE,ie)}}const typesetterWorkerModule=defineWorkerModule({name:"Typesetter",dependencies:[createTypesetter,fontResolverWorkerModule,bidiFactory],init(X,Z,_){return X(Z,_())}}),typesetInWorker=defineWorkerModule({name:"Typesetter",dependencies:[typesetterWorkerModule],init(X){return function(Z){return new Promise(_=>{X.typeset(Z,_)})}},getTransferables(X){const Z=[];for(let _ in X)X[_]&&X[_].buffer&&Z.push(X[_].buffer);return Z}});typesetInWorker.onMainThread;const templateGeometries={};function getTemplateGeometry(X){let Z=templateGeometries[X];return Z||(Z=templateGeometries[X]=new PlaneGeometry(1,1,X,X).translate(.5,.5,0)),Z}const glyphBoundsAttrName="aTroikaGlyphBounds",glyphIndexAttrName="aTroikaGlyphIndex",glyphColorAttrName="aTroikaGlyphColor";class GlyphsGeometry extends InstancedBufferGeometry{constructor(){super(),this.detail=1,this.curveRadius=0,this.groups=[{start:0,count:1/0,materialIndex:0},{start:0,count:1/0,materialIndex:1}],this.boundingSphere=new Sphere,this.boundingBox=new Box3}computeBoundingSphere(){}computeBoundingBox(){}set detail(Z){if(Z!==this._detail){this._detail=Z,(typeof Z!="number"||Z<1)&&(Z=1);let _=getTemplateGeometry(Z);["position","normal","uv"].forEach(K=>{this.attributes[K]=_.attributes[K].clone()}),this.setIndex(_.getIndex().clone())}}get detail(){return this._detail}set curveRadius(Z){Z!==this._curveRadius&&(this._curveRadius=Z,this._updateBounds())}get curveRadius(){return this._curveRadius}updateGlyphs(Z,_,K,te,ne){this.updateAttributeData(glyphBoundsAttrName,Z,4),this.updateAttributeData(glyphIndexAttrName,_,1),this.updateAttributeData(glyphColorAttrName,ne,3),this._blockBounds=K,this._chunkedBounds=te,this.instanceCount=_.length,this._updateBounds()}_updateBounds(){const Z=this._blockBounds;if(Z){const{curveRadius:_,boundingBox:K}=this;if(_){const{PI:te,floor:ne,min:ie,max:oe,sin:se,cos:ae}=Math,ge=te/2,ce=te*2,de=Math.abs(_),Ie=Z[0]/de,fe=Z[2]/de,be=ne((Ie+ge)/ce)!==ne((fe+ge)/ce)?-de:ie(se(Ie)*de,se(fe)*de),Ae=ne((Ie-ge)/ce)!==ne((fe-ge)/ce)?de:oe(se(Ie)*de,se(fe)*de),ye=ne((Ie+te)/ce)!==ne((fe+te)/ce)?de*2:oe(de-ae(Ie)*de,de-ae(fe)*de);K.min.set(be,Z[1],_<0?-ye:0),K.max.set(Ae,Z[3],_<0?0:ye)}else K.min.set(Z[0],Z[1],0),K.max.set(Z[2],Z[3],0);K.getBoundingSphere(this.boundingSphere)}}applyClipRect(Z){let _=this.getAttribute(glyphIndexAttrName).count,K=this._chunkedBounds;if(K)for(let te=K.length;te--;){_=K[te].end;let ne=K[te].rect;if(ne[1]<Z.w&&ne[3]>Z.y&&ne[0]<Z.z&&ne[2]>Z.x)break}this.instanceCount=_}updateAttributeData(Z,_,K){const te=this.getAttribute(Z);_?te&&te.array.length===_.length?(te.array.set(_),te.needsUpdate=!0):(this.setAttribute(Z,new InstancedBufferAttribute(_,K)),delete this._maxInstanceCount,this.dispose()):te&&this.deleteAttribute(Z)}}const VERTEX_DEFS=`
uniform vec2 uTroikaSDFTextureSize;
uniform float uTroikaSDFGlyphSize;
uniform vec4 uTroikaTotalBounds;
uniform vec4 uTroikaClipRect;
uniform mat3 uTroikaOrient;
uniform bool uTroikaUseGlyphColors;
uniform float uTroikaEdgeOffset;
uniform float uTroikaBlurRadius;
uniform vec2 uTroikaPositionOffset;
uniform float uTroikaCurveRadius;
attribute vec4 aTroikaGlyphBounds;
attribute float aTroikaGlyphIndex;
attribute vec3 aTroikaGlyphColor;
varying vec2 vTroikaGlyphUV;
varying vec4 vTroikaTextureUVBounds;
varying float vTroikaTextureChannel;
varying vec3 vTroikaGlyphColor;
varying vec2 vTroikaGlyphDimensions;
`,VERTEX_TRANSFORM=`
vec4 bounds = aTroikaGlyphBounds;
bounds.xz += uTroikaPositionOffset.x;
bounds.yw -= uTroikaPositionOffset.y;

vec4 outlineBounds = vec4(
  bounds.xy - uTroikaEdgeOffset - uTroikaBlurRadius,
  bounds.zw + uTroikaEdgeOffset + uTroikaBlurRadius
);
vec4 clippedBounds = vec4(
  clamp(outlineBounds.xy, uTroikaClipRect.xy, uTroikaClipRect.zw),
  clamp(outlineBounds.zw, uTroikaClipRect.xy, uTroikaClipRect.zw)
);

vec2 clippedXY = (mix(clippedBounds.xy, clippedBounds.zw, position.xy) - bounds.xy) / (bounds.zw - bounds.xy);

position.xy = mix(bounds.xy, bounds.zw, clippedXY);

uv = (position.xy - uTroikaTotalBounds.xy) / (uTroikaTotalBounds.zw - uTroikaTotalBounds.xy);

float rad = uTroikaCurveRadius;
if (rad != 0.0) {
  float angle = position.x / rad;
  position.xz = vec2(sin(angle) * rad, rad - cos(angle) * rad);
  normal.xz = vec2(sin(angle), cos(angle));
}
  
position = uTroikaOrient * position;
normal = uTroikaOrient * normal;

vTroikaGlyphUV = clippedXY.xy;
vTroikaGlyphDimensions = vec2(bounds[2] - bounds[0], bounds[3] - bounds[1]);


float txCols = uTroikaSDFTextureSize.x / uTroikaSDFGlyphSize;
vec2 txUvPerSquare = uTroikaSDFGlyphSize / uTroikaSDFTextureSize;
vec2 txStartUV = txUvPerSquare * vec2(
  mod(floor(aTroikaGlyphIndex / 4.0), txCols),
  floor(floor(aTroikaGlyphIndex / 4.0) / txCols)
);
vTroikaTextureUVBounds = vec4(txStartUV, vec2(txStartUV) + txUvPerSquare);
vTroikaTextureChannel = mod(aTroikaGlyphIndex, 4.0);
`,FRAGMENT_DEFS=`
uniform sampler2D uTroikaSDFTexture;
uniform vec2 uTroikaSDFTextureSize;
uniform float uTroikaSDFGlyphSize;
uniform float uTroikaSDFExponent;
uniform float uTroikaEdgeOffset;
uniform float uTroikaFillOpacity;
uniform float uTroikaBlurRadius;
uniform vec3 uTroikaStrokeColor;
uniform float uTroikaStrokeWidth;
uniform float uTroikaStrokeOpacity;
uniform bool uTroikaSDFDebug;
varying vec2 vTroikaGlyphUV;
varying vec4 vTroikaTextureUVBounds;
varying float vTroikaTextureChannel;
varying vec2 vTroikaGlyphDimensions;

float troikaSdfValueToSignedDistance(float alpha) {
  // Inverse of exponential encoding in webgl-sdf-generator
  
  float maxDimension = max(vTroikaGlyphDimensions.x, vTroikaGlyphDimensions.y);
  float absDist = (1.0 - pow(2.0 * (alpha > 0.5 ? 1.0 - alpha : alpha), 1.0 / uTroikaSDFExponent)) * maxDimension;
  float signedDist = absDist * (alpha > 0.5 ? -1.0 : 1.0);
  return signedDist;
}

float troikaGlyphUvToSdfValue(vec2 glyphUV) {
  vec2 textureUV = mix(vTroikaTextureUVBounds.xy, vTroikaTextureUVBounds.zw, glyphUV);
  vec4 rgba = texture2D(uTroikaSDFTexture, textureUV);
  float ch = floor(vTroikaTextureChannel + 0.5); //NOTE: can't use round() in WebGL1
  return ch == 0.0 ? rgba.r : ch == 1.0 ? rgba.g : ch == 2.0 ? rgba.b : rgba.a;
}

float troikaGlyphUvToDistance(vec2 uv) {
  return troikaSdfValueToSignedDistance(troikaGlyphUvToSdfValue(uv));
}

float troikaGetAADist() {
  
  #if defined(GL_OES_standard_derivatives) || __VERSION__ >= 300
  return length(fwidth(vTroikaGlyphUV * vTroikaGlyphDimensions)) * 0.5;
  #else
  return vTroikaGlyphDimensions.x / 64.0;
  #endif
}

float troikaGetFragDistValue() {
  vec2 clampedGlyphUV = clamp(vTroikaGlyphUV, 0.5 / uTroikaSDFGlyphSize, 1.0 - 0.5 / uTroikaSDFGlyphSize);
  float distance = troikaGlyphUvToDistance(clampedGlyphUV);
 
  // Extrapolate distance when outside bounds:
  distance += clampedGlyphUV == vTroikaGlyphUV ? 0.0 : 
    length((vTroikaGlyphUV - clampedGlyphUV) * vTroikaGlyphDimensions);

  

  return distance;
}

float troikaGetEdgeAlpha(float distance, float distanceOffset, float aaDist) {
  #if defined(IS_DEPTH_MATERIAL) || defined(IS_DISTANCE_MATERIAL)
  float alpha = step(-distanceOffset, -distance);
  #else

  float alpha = smoothstep(
    distanceOffset + aaDist,
    distanceOffset - aaDist,
    distance
  );
  #endif

  return alpha;
}
`,FRAGMENT_TRANSFORM=`
float aaDist = troikaGetAADist();
float fragDistance = troikaGetFragDistValue();
float edgeAlpha = uTroikaSDFDebug ?
  troikaGlyphUvToSdfValue(vTroikaGlyphUV) :
  troikaGetEdgeAlpha(fragDistance, uTroikaEdgeOffset, max(aaDist, uTroikaBlurRadius));

#if !defined(IS_DEPTH_MATERIAL) && !defined(IS_DISTANCE_MATERIAL)
vec4 fillRGBA = gl_FragColor;
fillRGBA.a *= uTroikaFillOpacity;
vec4 strokeRGBA = uTroikaStrokeWidth == 0.0 ? fillRGBA : vec4(uTroikaStrokeColor, uTroikaStrokeOpacity);
if (fillRGBA.a == 0.0) fillRGBA.rgb = strokeRGBA.rgb;
gl_FragColor = mix(fillRGBA, strokeRGBA, smoothstep(
  -uTroikaStrokeWidth - aaDist,
  -uTroikaStrokeWidth + aaDist,
  fragDistance
));
gl_FragColor.a *= edgeAlpha;
#endif

if (edgeAlpha == 0.0) {
  discard;
}
`;function createTextDerivedMaterial(X){const Z=createDerivedMaterial(X,{chained:!0,extensions:{derivatives:!0},uniforms:{uTroikaSDFTexture:{value:null},uTroikaSDFTextureSize:{value:new Vector2},uTroikaSDFGlyphSize:{value:0},uTroikaSDFExponent:{value:0},uTroikaTotalBounds:{value:new Vector4(0,0,0,0)},uTroikaClipRect:{value:new Vector4(0,0,0,0)},uTroikaEdgeOffset:{value:0},uTroikaFillOpacity:{value:1},uTroikaPositionOffset:{value:new Vector2},uTroikaCurveRadius:{value:0},uTroikaBlurRadius:{value:0},uTroikaStrokeWidth:{value:0},uTroikaStrokeColor:{value:new Color$1},uTroikaStrokeOpacity:{value:1},uTroikaOrient:{value:new Matrix3},uTroikaUseGlyphColors:{value:!0},uTroikaSDFDebug:{value:!1}},vertexDefs:VERTEX_DEFS,vertexTransform:VERTEX_TRANSFORM,fragmentDefs:FRAGMENT_DEFS,fragmentColorTransform:FRAGMENT_TRANSFORM,customRewriter({vertexShader:_,fragmentShader:K}){let te=/\buniform\s+vec3\s+diffuse\b/;return te.test(K)&&(K=K.replace(te,"varying vec3 vTroikaGlyphColor").replace(/\bdiffuse\b/g,"vTroikaGlyphColor"),te.test(_)||(_=_.replace(voidMainRegExp,`uniform vec3 diffuse;
$&
vTroikaGlyphColor = uTroikaUseGlyphColors ? aTroikaGlyphColor / 255.0 : diffuse;
`))),{vertexShader:_,fragmentShader:K}}});return Z.transparent=!0,Z.forceSinglePass=!0,Object.defineProperties(Z,{isTroikaTextMaterial:{value:!0},shadowSide:{get(){return this.side},set(){}}}),Z}const defaultMaterial=new MeshBasicMaterial({color:16777215,side:DoubleSide,transparent:!0}),defaultStrokeColor=8421504,tempMat4=new Matrix4,tempVec3a=new Vector3,tempVec3b=new Vector3,tempArray=[],origin=new Vector3,defaultOrient="+x+y";function first(X){return Array.isArray(X)?X[0]:X}let getFlatRaycastMesh=()=>{const X=new Mesh(new PlaneGeometry(1,1),defaultMaterial);return getFlatRaycastMesh=()=>X,X},getCurvedRaycastMesh=()=>{const X=new Mesh(new PlaneGeometry(1,1,32,1),defaultMaterial);return getCurvedRaycastMesh=()=>X,X};const syncStartEvent={type:"syncstart"},syncCompleteEvent={type:"synccomplete"},SYNCABLE_PROPS=["font","fontSize","fontStyle","fontWeight","lang","letterSpacing","lineHeight","maxWidth","overflowWrap","text","direction","textAlign","textIndent","whiteSpace","anchorX","anchorY","colorRanges","sdfGlyphSize"],COPYABLE_PROPS=SYNCABLE_PROPS.concat("material","color","depthOffset","clipRect","curveRadius","orientation","glyphGeometryDetail");let Text$1=class extends Mesh{constructor(){const Z=new GlyphsGeometry;super(Z,null),this.text="",this.anchorX=0,this.anchorY=0,this.curveRadius=0,this.direction="auto",this.font=null,this.unicodeFontsURL=null,this.fontSize=.1,this.fontWeight="normal",this.fontStyle="normal",this.lang=null,this.letterSpacing=0,this.lineHeight="normal",this.maxWidth=1/0,this.overflowWrap="normal",this.textAlign="left",this.textIndent=0,this.whiteSpace="normal",this.material=null,this.color=null,this.colorRanges=null,this.outlineWidth=0,this.outlineColor=0,this.outlineOpacity=1,this.outlineBlur=0,this.outlineOffsetX=0,this.outlineOffsetY=0,this.strokeWidth=0,this.strokeColor=defaultStrokeColor,this.strokeOpacity=1,this.fillOpacity=1,this.depthOffset=0,this.clipRect=null,this.orientation=defaultOrient,this.glyphGeometryDetail=1,this.sdfGlyphSize=null,this.gpuAccelerateSDF=!0,this.debugSDF=!1}sync(Z){this._needsSync&&(this._needsSync=!1,this._isSyncing?(this._queuedSyncs||(this._queuedSyncs=[])).push(Z):(this._isSyncing=!0,this.dispatchEvent(syncStartEvent),getTextRenderInfo({text:this.text,font:this.font,lang:this.lang,fontSize:this.fontSize||.1,fontWeight:this.fontWeight||"normal",fontStyle:this.fontStyle||"normal",letterSpacing:this.letterSpacing||0,lineHeight:this.lineHeight||"normal",maxWidth:this.maxWidth,direction:this.direction||"auto",textAlign:this.textAlign,textIndent:this.textIndent,whiteSpace:this.whiteSpace,overflowWrap:this.overflowWrap,anchorX:this.anchorX,anchorY:this.anchorY,colorRanges:this.colorRanges,includeCaretPositions:!0,sdfGlyphSize:this.sdfGlyphSize,gpuAccelerateSDF:this.gpuAccelerateSDF,unicodeFontsURL:this.unicodeFontsURL},_=>{this._isSyncing=!1,this._textRenderInfo=_,this.geometry.updateGlyphs(_.glyphBounds,_.glyphAtlasIndices,_.blockBounds,_.chunkedBounds,_.glyphColors);const K=this._queuedSyncs;K&&(this._queuedSyncs=null,this._needsSync=!0,this.sync(()=>{K.forEach(te=>te&&te())})),this.dispatchEvent(syncCompleteEvent),Z&&Z()})))}onBeforeRender(Z,_,K,te,ne,ie){this.sync(),ne.isTroikaTextMaterial&&this._prepareForRender(ne)}dispose(){this.geometry.dispose()}get textRenderInfo(){return this._textRenderInfo||null}createDerivedMaterial(Z){return createTextDerivedMaterial(Z)}get material(){let Z=this._derivedMaterial;const _=this._baseMaterial||this._defaultMaterial||(this._defaultMaterial=defaultMaterial.clone());if((!Z||!Z.isDerivedFrom(_))&&(Z=this._derivedMaterial=this.createDerivedMaterial(_),_.addEventListener("dispose",function K(){_.removeEventListener("dispose",K),Z.dispose()})),this.hasOutline()){let K=Z._outlineMtl;return K||(K=Z._outlineMtl=Object.create(Z,{id:{value:Z.id+.1}}),K.isTextOutlineMaterial=!0,K.depthWrite=!1,K.map=null,Z.addEventListener("dispose",function te(){Z.removeEventListener("dispose",te),K.dispose()})),[K,Z]}else return Z}set material(Z){Z&&Z.isTroikaTextMaterial?(this._derivedMaterial=Z,this._baseMaterial=Z.baseMaterial):this._baseMaterial=Z}hasOutline(){return!!(this.outlineWidth||this.outlineBlur||this.outlineOffsetX||this.outlineOffsetY)}get glyphGeometryDetail(){return this.geometry.detail}set glyphGeometryDetail(Z){this.geometry.detail=Z}get curveRadius(){return this.geometry.curveRadius}set curveRadius(Z){this.geometry.curveRadius=Z}get customDepthMaterial(){return first(this.material).getDepthMaterial()}get customDistanceMaterial(){return first(this.material).getDistanceMaterial()}_prepareForRender(Z){const _=Z.isTextOutlineMaterial,K=Z.uniforms,te=this.textRenderInfo;if(te){const{sdfTexture:oe,blockBounds:se}=te;K.uTroikaSDFTexture.value=oe,K.uTroikaSDFTextureSize.value.set(oe.image.width,oe.image.height),K.uTroikaSDFGlyphSize.value=te.sdfGlyphSize,K.uTroikaSDFExponent.value=te.sdfExponent,K.uTroikaTotalBounds.value.fromArray(se),K.uTroikaUseGlyphColors.value=!_&&!!te.glyphColors;let ae=0,ge=0,ce=0,de,Ie,fe,be=0,Ae=0;if(_){let{outlineWidth:ve,outlineOffsetX:Be,outlineOffsetY:Re,outlineBlur:Ve,outlineOpacity:Ee}=this;ae=this._parsePercent(ve)||0,ge=Math.max(0,this._parsePercent(Ve)||0),de=Ee,be=this._parsePercent(Be)||0,Ae=this._parsePercent(Re)||0}else ce=Math.max(0,this._parsePercent(this.strokeWidth)||0),ce&&(fe=this.strokeColor,K.uTroikaStrokeColor.value.set(fe??defaultStrokeColor),Ie=this.strokeOpacity,Ie==null&&(Ie=1)),de=this.fillOpacity;K.uTroikaEdgeOffset.value=ae,K.uTroikaPositionOffset.value.set(be,Ae),K.uTroikaBlurRadius.value=ge,K.uTroikaStrokeWidth.value=ce,K.uTroikaStrokeOpacity.value=Ie,K.uTroikaFillOpacity.value=de??1,K.uTroikaCurveRadius.value=this.curveRadius||0;let ye=this.clipRect;if(ye&&Array.isArray(ye)&&ye.length===4)K.uTroikaClipRect.value.fromArray(ye);else{const ve=(this.fontSize||.1)*100;K.uTroikaClipRect.value.set(se[0]-ve,se[1]-ve,se[2]+ve,se[3]+ve)}this.geometry.applyClipRect(K.uTroikaClipRect.value)}K.uTroikaSDFDebug.value=!!this.debugSDF,Z.polygonOffset=!!this.depthOffset,Z.polygonOffsetFactor=Z.polygonOffsetUnits=this.depthOffset||0;const ne=_?this.outlineColor||0:this.color;if(ne==null)delete Z.color;else{const oe=Z.hasOwnProperty("color")?Z.color:Z.color=new Color$1;(ne!==oe._input||typeof ne=="object")&&oe.set(oe._input=ne)}let ie=this.orientation||defaultOrient;if(ie!==Z._orientation){let oe=K.uTroikaOrient.value;ie=ie.replace(/[^-+xyz]/g,"");let se=ie!==defaultOrient&&ie.match(/^([-+])([xyz])([-+])([xyz])$/);if(se){let[,ae,ge,ce,de]=se;tempVec3a.set(0,0,0)[ge]=ae==="-"?1:-1,tempVec3b.set(0,0,0)[de]=ce==="-"?-1:1,tempMat4.lookAt(origin,tempVec3a.cross(tempVec3b),tempVec3b),oe.setFromMatrix4(tempMat4)}else oe.identity();Z._orientation=ie}}_parsePercent(Z){if(typeof Z=="string"){let _=Z.match(/^(-?[\d.]+)%$/),K=_?parseFloat(_[1]):NaN;Z=(isNaN(K)?0:K/100)*this.fontSize}return Z}localPositionToTextCoords(Z,_=new Vector2){_.copy(Z);const K=this.curveRadius;return K&&(_.x=Math.atan2(Z.x,Math.abs(K)-Math.abs(Z.z))*Math.abs(K)),_}worldPositionToTextCoords(Z,_=new Vector2){return tempVec3a.copy(Z),this.localPositionToTextCoords(this.worldToLocal(tempVec3a),_)}raycast(Z,_){const{textRenderInfo:K,curveRadius:te}=this;if(K){const ne=K.blockBounds,ie=te?getCurvedRaycastMesh():getFlatRaycastMesh(),oe=ie.geometry,{position:se,uv:ae}=oe.attributes;for(let ge=0;ge<ae.count;ge++){let ce=ne[0]+ae.getX(ge)*(ne[2]-ne[0]);const de=ne[1]+ae.getY(ge)*(ne[3]-ne[1]);let Ie=0;te&&(Ie=te-Math.cos(ce/te)*te,ce=Math.sin(ce/te)*te),se.setXYZ(ge,ce,de,Ie)}oe.boundingSphere=this.geometry.boundingSphere,oe.boundingBox=this.geometry.boundingBox,ie.matrixWorld=this.matrixWorld,ie.material.side=this.material.side,tempArray.length=0,ie.raycast(Z,tempArray);for(let ge=0;ge<tempArray.length;ge++)tempArray[ge].object=this,_.push(tempArray[ge])}}copy(Z){const _=this.geometry;return super.copy(Z),this.geometry=_,COPYABLE_PROPS.forEach(K=>{this[K]=Z[K]}),this}clone(){return new this.constructor().copy(this)}};SYNCABLE_PROPS.forEach(X=>{const Z="_private_"+X;Object.defineProperty(Text$1.prototype,X,{get(){return this[Z]},set(_){_!==this[Z]&&(this[Z]=_,this._needsSync=!0)}})});new Box3;new Color$1;const Text=reactExports.forwardRef(({sdfGlyphSize:X=64,anchorX:Z="center",anchorY:_="middle",font:K,fontSize:te=1,children:ne,characters:ie,onSync:oe,...se},ae)=>{const ge=useThree(({invalidate:fe})=>fe),[ce]=reactExports.useState(()=>new Text$1),[de,Ie]=reactExports.useMemo(()=>{const fe=[];let be="";return reactExports.Children.forEach(ne,Ae=>{typeof Ae=="string"||typeof Ae=="number"?be+=Ae:fe.push(Ae)}),[fe,be]},[ne]);return suspend(()=>new Promise(fe=>preloadFont({font:K,characters:ie},fe)),["troika-text",K,ie]),reactExports.useLayoutEffect(()=>void ce.sync(()=>{ge(),oe&&oe(ce)})),reactExports.useEffect(()=>()=>ce.dispose(),[ce]),reactExports.createElement("primitive",_extends$2({object:ce,ref:ae,font:K,text:Ie,anchorX:Z,anchorY:_,fontSize:te,sdfGlyphSize:X},se),de)}),IsObject=X=>X===Object(X)&&!Array.isArray(X)&&typeof X!="function";function useTexture(X,Z){const _=useThree(ne=>ne.gl),K=useLoader(TextureLoader,IsObject(X)?Object.values(X):X);return reactExports.useLayoutEffect(()=>{Z==null||Z(K)},[Z]),reactExports.useEffect(()=>{if("initTexture"in _){let ne=[];Array.isArray(K)?ne=K:K instanceof Texture?ne=[K]:IsObject(K)&&(ne=Object.values(K)),ne.forEach(ie=>{ie instanceof Texture&&_.initTexture(ie)})}},[_,K]),reactExports.useMemo(()=>{if(IsObject(X)){const ne={};let ie=0;for(const oe in X)ne[oe]=K[ie++];return ne}else return K},[X,K])}useTexture.preload=X=>useLoader.preload(TextureLoader,X);useTexture.clear=X=>useLoader.clear(TextureLoader,X);let dracoLoader=null,decoderPath="https://www.gstatic.com/draco/versioned/decoders/1.5.5/";function extensions(X=!0,Z=!0,_){return K=>{_&&_(K),X&&(dracoLoader||(dracoLoader=new DRACOLoader),dracoLoader.setDecoderPath(typeof X=="string"?X:decoderPath),K.setDRACOLoader(dracoLoader)),Z&&K.setMeshoptDecoder(typeof MeshoptDecoder=="function"?MeshoptDecoder():MeshoptDecoder)}}const useGLTF=(X,Z,_,K)=>useLoader(GLTFLoader,X,extensions(Z,_,K));useGLTF.preload=(X,Z,_,K)=>useLoader.preload(GLTFLoader,X,extensions(Z,_,K));useGLTF.clear=X=>useLoader.clear(GLTFLoader,X);useGLTF.setDecoderPath=X=>{decoderPath=X};var propTypes={exports:{}},ReactPropTypesSecret_1,hasRequiredReactPropTypesSecret;function requireReactPropTypesSecret(){if(hasRequiredReactPropTypesSecret)return ReactPropTypesSecret_1;hasRequiredReactPropTypesSecret=1;var X="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED";return ReactPropTypesSecret_1=X,ReactPropTypesSecret_1}var factoryWithThrowingShims,hasRequiredFactoryWithThrowingShims;function requireFactoryWithThrowingShims(){if(hasRequiredFactoryWithThrowingShims)return factoryWithThrowingShims;hasRequiredFactoryWithThrowingShims=1;var X=requireReactPropTypesSecret();function Z(){}function _(){}return _.resetWarningCache=Z,factoryWithThrowingShims=function(){function K(ie,oe,se,ae,ge,ce){if(ce!==X){var de=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw de.name="Invariant Violation",de}}K.isRequired=K;function te(){return K}var ne={array:K,bigint:K,bool:K,func:K,number:K,object:K,string:K,symbol:K,any:K,arrayOf:te,element:K,elementType:K,instanceOf:te,node:K,objectOf:te,oneOf:te,oneOfType:te,shape:te,exact:te,checkPropTypes:_,resetWarningCache:Z};return ne.PropTypes=ne,ne},factoryWithThrowingShims}var hasRequiredPropTypes;function requirePropTypes(){return hasRequiredPropTypes||(hasRequiredPropTypes=1,propTypes.exports=requireFactoryWithThrowingShims()()),propTypes.exports}var propTypesExports=requirePropTypes();const PropTypes=getDefaultExportFromCjs(propTypesExports),LinearEncoding=3e3,sRGBEncoding=3001,getBufferForType=(X,Z,_)=>{let K;switch(X){case UnsignedByteType:K=new Uint8ClampedArray(Z*_*4);break;case HalfFloatType:K=new Uint16Array(Z*_*4);break;case UnsignedIntType:K=new Uint32Array(Z*_*4);break;case ByteType:K=new Int8Array(Z*_*4);break;case ShortType:K=new Int16Array(Z*_*4);break;case IntType:K=new Int32Array(Z*_*4);break;case FloatType:K=new Float32Array(Z*_*4);break;default:throw new Error("Unsupported data type")}return K};let _canReadPixelsResult;const canReadPixels=(X,Z,_,K)=>{if(_canReadPixelsResult!==void 0)return _canReadPixelsResult;const te=new WebGLRenderTarget(1,1,K);Z.setRenderTarget(te);const ne=new Mesh(new PlaneGeometry,new MeshBasicMaterial({color:16777215}));Z.render(ne,_),Z.setRenderTarget(null);const ie=getBufferForType(X,te.width,te.height);return Z.readRenderTargetPixels(te,0,0,te.width,te.height,ie),te.dispose(),ne.geometry.dispose(),ne.material.dispose(),_canReadPixelsResult=ie[0]!==0,_canReadPixelsResult};class QuadRenderer{constructor(Z){var _,K,te,ne,ie,oe,se,ae,ge,ce,de,Ie,fe,be,Ae,ye;this._rendererIsDisposable=!1,this._supportsReadPixels=!0,this.render=()=>{this._renderer.setRenderTarget(this._renderTarget);try{this._renderer.render(this._scene,this._camera)}catch(Be){throw this._renderer.setRenderTarget(null),Be}this._renderer.setRenderTarget(null)},this._width=Z.width,this._height=Z.height,this._type=Z.type,this._colorSpace=Z.colorSpace;const ve={format:RGBAFormat,depthBuffer:!1,stencilBuffer:!1,type:this._type,colorSpace:this._colorSpace,anisotropy:((_=Z.renderTargetOptions)===null||_===void 0?void 0:_.anisotropy)!==void 0?(K=Z.renderTargetOptions)===null||K===void 0?void 0:K.anisotropy:1,generateMipmaps:((te=Z.renderTargetOptions)===null||te===void 0?void 0:te.generateMipmaps)!==void 0?(ne=Z.renderTargetOptions)===null||ne===void 0?void 0:ne.generateMipmaps:!1,magFilter:((ie=Z.renderTargetOptions)===null||ie===void 0?void 0:ie.magFilter)!==void 0?(oe=Z.renderTargetOptions)===null||oe===void 0?void 0:oe.magFilter:LinearFilter,minFilter:((se=Z.renderTargetOptions)===null||se===void 0?void 0:se.minFilter)!==void 0?(ae=Z.renderTargetOptions)===null||ae===void 0?void 0:ae.minFilter:LinearFilter,samples:((ge=Z.renderTargetOptions)===null||ge===void 0?void 0:ge.samples)!==void 0?(ce=Z.renderTargetOptions)===null||ce===void 0?void 0:ce.samples:void 0,wrapS:((de=Z.renderTargetOptions)===null||de===void 0?void 0:de.wrapS)!==void 0?(Ie=Z.renderTargetOptions)===null||Ie===void 0?void 0:Ie.wrapS:ClampToEdgeWrapping,wrapT:((fe=Z.renderTargetOptions)===null||fe===void 0?void 0:fe.wrapT)!==void 0?(be=Z.renderTargetOptions)===null||be===void 0?void 0:be.wrapT:ClampToEdgeWrapping};if(this._material=Z.material,Z.renderer?this._renderer=Z.renderer:(this._renderer=QuadRenderer.instantiateRenderer(),this._rendererIsDisposable=!0),this._scene=new Scene$1,this._camera=new OrthographicCamera,this._camera.position.set(0,0,10),this._camera.left=-.5,this._camera.right=.5,this._camera.top=.5,this._camera.bottom=-.5,this._camera.updateProjectionMatrix(),!canReadPixels(this._type,this._renderer,this._camera,ve)){let Be;switch(this._type){case HalfFloatType:Be=this._renderer.extensions.has("EXT_color_buffer_float")?FloatType:void 0;break}Be!==void 0?(console.warn(`This browser does not support reading pixels from ${this._type} RenderTargets, switching to ${FloatType}`),this._type=Be):(this._supportsReadPixels=!1,console.warn("This browser dos not support toArray or toDataTexture, calls to those methods will result in an error thrown"))}this._quad=new Mesh(new PlaneGeometry,this._material),this._quad.geometry.computeBoundingBox(),this._scene.add(this._quad),this._renderTarget=new WebGLRenderTarget(this.width,this.height,ve),this._renderTarget.texture.mapping=((Ae=Z.renderTargetOptions)===null||Ae===void 0?void 0:Ae.mapping)!==void 0?(ye=Z.renderTargetOptions)===null||ye===void 0?void 0:ye.mapping:UVMapping}static instantiateRenderer(){const Z=new WebGLRenderer;return Z.setSize(128,128),Z}toArray(){if(!this._supportsReadPixels)throw new Error("Can't read pixels in this browser");const Z=getBufferForType(this._type,this._width,this._height);return this._renderer.readRenderTargetPixels(this._renderTarget,0,0,this._width,this._height,Z),Z}toDataTexture(Z){const _=new DataTexture(this.toArray(),this.width,this.height,RGBAFormat,this._type,(Z==null?void 0:Z.mapping)||UVMapping,(Z==null?void 0:Z.wrapS)||ClampToEdgeWrapping,(Z==null?void 0:Z.wrapT)||ClampToEdgeWrapping,(Z==null?void 0:Z.magFilter)||LinearFilter,(Z==null?void 0:Z.minFilter)||LinearFilter,(Z==null?void 0:Z.anisotropy)||1,LinearSRGBColorSpace$1);return _.generateMipmaps=(Z==null?void 0:Z.generateMipmaps)!==void 0?Z==null?void 0:Z.generateMipmaps:!1,_}disposeOnDemandRenderer(){this._renderer.setRenderTarget(null),this._rendererIsDisposable&&(this._renderer.dispose(),this._renderer.forceContextLoss())}dispose(Z){this.disposeOnDemandRenderer(),Z&&this.renderTarget.dispose(),this.material instanceof ShaderMaterial&&Object.values(this.material.uniforms).forEach(_=>{_.value instanceof Texture&&_.value.dispose()}),Object.values(this.material).forEach(_=>{_ instanceof Texture&&_.dispose()}),this.material.dispose(),this._quad.geometry.dispose()}get width(){return this._width}set width(Z){this._width=Z,this._renderTarget.setSize(this._width,this._height)}get height(){return this._height}set height(Z){this._height=Z,this._renderTarget.setSize(this._width,this._height)}get renderer(){return this._renderer}get renderTarget(){return this._renderTarget}set renderTarget(Z){this._renderTarget=Z,this._width=Z.width,this._height=Z.height}get material(){return this._material}get type(){return this._type}get colorSpace(){return this._colorSpace}}const vertexShader=`
varying vec2 vUv;

void main() {
  vUv = uv;
  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
}
`,fragmentShader=`
// min half float value
#define HALF_FLOAT_MIN vec3( -65504, -65504, -65504 )
// max half float value
#define HALF_FLOAT_MAX vec3( 65504, 65504, 65504 )

uniform sampler2D sdr;
uniform sampler2D gainMap;
uniform vec3 gamma;
uniform vec3 offsetHdr;
uniform vec3 offsetSdr;
uniform vec3 gainMapMin;
uniform vec3 gainMapMax;
uniform float weightFactor;

varying vec2 vUv;

void main() {
  vec3 rgb = texture2D( sdr, vUv ).rgb;
  vec3 recovery = texture2D( gainMap, vUv ).rgb;
  vec3 logRecovery = pow( recovery, gamma );
  vec3 logBoost = gainMapMin * ( 1.0 - logRecovery ) + gainMapMax * logRecovery;
  vec3 hdrColor = (rgb + offsetSdr) * exp2( logBoost * weightFactor ) - offsetHdr;
  vec3 clampedHdrColor = max( HALF_FLOAT_MIN, min( HALF_FLOAT_MAX, hdrColor ));
  gl_FragColor = vec4( clampedHdrColor , 1.0 );
}
`;class GainMapDecoderMaterial extends ShaderMaterial{constructor({gamma:Z,offsetHdr:_,offsetSdr:K,gainMapMin:te,gainMapMax:ne,maxDisplayBoost:ie,hdrCapacityMin:oe,hdrCapacityMax:se,sdr:ae,gainMap:ge}){super({name:"GainMapDecoderMaterial",vertexShader,fragmentShader,uniforms:{sdr:{value:ae},gainMap:{value:ge},gamma:{value:new Vector3(1/Z[0],1/Z[1],1/Z[2])},offsetHdr:{value:new Vector3().fromArray(_)},offsetSdr:{value:new Vector3().fromArray(K)},gainMapMin:{value:new Vector3().fromArray(te)},gainMapMax:{value:new Vector3().fromArray(ne)},weightFactor:{value:(Math.log2(ie)-oe)/(se-oe)}},blending:NoBlending,depthTest:!1,depthWrite:!1}),this._maxDisplayBoost=ie,this._hdrCapacityMin=oe,this._hdrCapacityMax=se,this.needsUpdate=!0,this.uniformsNeedUpdate=!0}get sdr(){return this.uniforms.sdr.value}set sdr(Z){this.uniforms.sdr.value=Z}get gainMap(){return this.uniforms.gainMap.value}set gainMap(Z){this.uniforms.gainMap.value=Z}get offsetHdr(){return this.uniforms.offsetHdr.value.toArray()}set offsetHdr(Z){this.uniforms.offsetHdr.value.fromArray(Z)}get offsetSdr(){return this.uniforms.offsetSdr.value.toArray()}set offsetSdr(Z){this.uniforms.offsetSdr.value.fromArray(Z)}get gainMapMin(){return this.uniforms.gainMapMin.value.toArray()}set gainMapMin(Z){this.uniforms.gainMapMin.value.fromArray(Z)}get gainMapMax(){return this.uniforms.gainMapMax.value.toArray()}set gainMapMax(Z){this.uniforms.gainMapMax.value.fromArray(Z)}get gamma(){const Z=this.uniforms.gamma.value;return[1/Z.x,1/Z.y,1/Z.z]}set gamma(Z){const _=this.uniforms.gamma.value;_.x=1/Z[0],_.y=1/Z[1],_.z=1/Z[2]}get hdrCapacityMin(){return this._hdrCapacityMin}set hdrCapacityMin(Z){this._hdrCapacityMin=Z,this.calculateWeight()}get hdrCapacityMax(){return this._hdrCapacityMax}set hdrCapacityMax(Z){this._hdrCapacityMax=Z,this.calculateWeight()}get maxDisplayBoost(){return this._maxDisplayBoost}set maxDisplayBoost(Z){this._maxDisplayBoost=Math.max(1,Math.min(65504,Z)),this.calculateWeight()}calculateWeight(){const Z=(Math.log2(this._maxDisplayBoost)-this._hdrCapacityMin)/(this._hdrCapacityMax-this._hdrCapacityMin);this.uniforms.weightFactor.value=Math.max(0,Math.min(1,Z))}}class GainMapNotFoundError extends Error{}class XMPMetadataNotFoundError extends Error{}const getXMLValue=(X,Z,_)=>{const K=new RegExp(`${Z}="([^"]*)"`,"i").exec(X);if(K)return K[1];const te=new RegExp(`<${Z}[^>]*>([\\s\\S]*?)</${Z}>`,"i").exec(X);if(te){const ne=te[1].match(/<rdf:li>([^<]*)<\/rdf:li>/g);return ne&&ne.length===3?ne.map(ie=>ie.replace(/<\/?rdf:li>/g,"")):te[1].trim()}if(_!==void 0)return _;throw new Error(`Can't find ${Z} in gainmap metadata`)},extractXMP=X=>{let Z;typeof TextDecoder<"u"?Z=new TextDecoder().decode(X):Z=X.toString();let _=Z.indexOf("<x:xmpmeta");for(;_!==-1;){const K=Z.indexOf("x:xmpmeta>",_),te=Z.slice(_,K+10);try{const ne=getXMLValue(te,"hdrgm:GainMapMin","0"),ie=getXMLValue(te,"hdrgm:GainMapMax"),oe=getXMLValue(te,"hdrgm:Gamma","1"),se=getXMLValue(te,"hdrgm:OffsetSDR","0.015625"),ae=getXMLValue(te,"hdrgm:OffsetHDR","0.015625"),ge=/hdrgm:HDRCapacityMin="([^"]*)"/.exec(te),ce=ge?ge[1]:"0",de=/hdrgm:HDRCapacityMax="([^"]*)"/.exec(te);if(!de)throw new Error("Incomplete gainmap metadata");const Ie=de[1];return{gainMapMin:Array.isArray(ne)?ne.map(fe=>parseFloat(fe)):[parseFloat(ne),parseFloat(ne),parseFloat(ne)],gainMapMax:Array.isArray(ie)?ie.map(fe=>parseFloat(fe)):[parseFloat(ie),parseFloat(ie),parseFloat(ie)],gamma:Array.isArray(oe)?oe.map(fe=>parseFloat(fe)):[parseFloat(oe),parseFloat(oe),parseFloat(oe)],offsetSdr:Array.isArray(se)?se.map(fe=>parseFloat(fe)):[parseFloat(se),parseFloat(se),parseFloat(se)],offsetHdr:Array.isArray(ae)?ae.map(fe=>parseFloat(fe)):[parseFloat(ae),parseFloat(ae),parseFloat(ae)],hdrCapacityMin:parseFloat(ce),hdrCapacityMax:parseFloat(Ie)}}catch{}_=Z.indexOf("<x:xmpmeta",K)}};class MPFExtractor{constructor(Z){this.options={debug:Z&&Z.debug!==void 0?Z.debug:!1,extractFII:Z&&Z.extractFII!==void 0?Z.extractFII:!0,extractNonFII:Z&&Z.extractNonFII!==void 0?Z.extractNonFII:!0}}extract(Z){return new Promise((_,K)=>{const te=this.options.debug,ne=new DataView(Z.buffer);if(ne.getUint16(0)!==65496){K(new Error("Not a valid jpeg"));return}const ie=ne.byteLength;let oe=2,se=0,ae;for(;oe<ie;){if(++se>250){K(new Error(`Found no marker after ${se} loops 😵`));return}if(ne.getUint8(oe)!==255){K(new Error(`Not a valid marker at offset 0x${oe.toString(16)}, found: 0x${ne.getUint8(oe).toString(16)}`));return}if(ae=ne.getUint8(oe+1),te&&console.log(`Marker: ${ae.toString(16)}`),ae===226){te&&console.log("Found APP2 marker (0xffe2)");const ge=oe+4;if(ne.getUint32(ge)===1297106432){const ce=ge+4;let de;if(ne.getUint16(ce)===18761)de=!1;else if(ne.getUint16(ce)===19789)de=!0;else{K(new Error("No valid endianness marker found in TIFF header"));return}if(ne.getUint16(ce+2,!de)!==42){K(new Error("Not valid TIFF data! (no 0x002A marker)"));return}const Ie=ne.getUint32(ce+4,!de);if(Ie<8){K(new Error("Not valid TIFF data! (First offset less than 8)"));return}const fe=ce+Ie,be=ne.getUint16(fe,!de),Ae=fe+2;let ye=0;for(let Ve=Ae;Ve<Ae+12*be;Ve+=12)ne.getUint16(Ve,!de)===45057&&(ye=ne.getUint32(Ve+8,!de));const Be=fe+2+be*12+4,Re=[];for(let Ve=Be;Ve<Be+ye*16;Ve+=16){const Ee={MPType:ne.getUint32(Ve,!de),size:ne.getUint32(Ve+4,!de),dataOffset:ne.getUint32(Ve+8,!de),dependantImages:ne.getUint32(Ve+12,!de),start:-1,end:-1,isFII:!1};Ee.dataOffset?(Ee.start=ce+Ee.dataOffset,Ee.isFII=!1):(Ee.start=0,Ee.isFII=!0),Ee.end=Ee.start+Ee.size,Re.push(Ee)}if(this.options.extractNonFII&&Re.length){const Ve=new Blob([ne]),Ee=[];for(const Ze of Re){if(Ze.isFII&&!this.options.extractFII)continue;const _e=Ve.slice(Ze.start,Ze.end+1,"image/jpeg");Ee.push(_e)}_(Ee)}}}oe+=2+ne.getUint16(oe+2)}})}}const extractGainmapFromJPEG=async X=>{const Z=extractXMP(X);if(!Z)throw new XMPMetadataNotFoundError("Gain map XMP metadata not found");const K=await new MPFExtractor({extractFII:!0,extractNonFII:!0}).extract(X);if(K.length!==2)throw new GainMapNotFoundError("Gain map recovery image not found");return{sdr:new Uint8Array(await K[0].arrayBuffer()),gainMap:new Uint8Array(await K[1].arrayBuffer()),metadata:Z}},getHTMLImageFromBlob=X=>new Promise((Z,_)=>{const K=document.createElement("img");K.onload=()=>{Z(K)},K.onerror=te=>{_(te)},K.src=URL.createObjectURL(X)});class LoaderBase extends Loader{constructor(Z,_){super(_),Z&&(this._renderer=Z),this._internalLoadingManager=new LoadingManager}setRenderer(Z){return this._renderer=Z,this}setRenderTargetOptions(Z){return this._renderTargetOptions=Z,this}prepareQuadRenderer(){this._renderer||console.warn("WARNING: An existing WebGL Renderer was not passed to this Loader constructor or in setRenderer, the result of this Loader will need to be converted to a Data Texture with toDataTexture() before you can use it in your renderer.");const Z=new GainMapDecoderMaterial({gainMapMax:[1,1,1],gainMapMin:[0,0,0],gamma:[1,1,1],offsetHdr:[1,1,1],offsetSdr:[1,1,1],hdrCapacityMax:1,hdrCapacityMin:0,maxDisplayBoost:1,gainMap:new Texture,sdr:new Texture});return new QuadRenderer({width:16,height:16,type:HalfFloatType,colorSpace:LinearSRGBColorSpace$1,material:Z,renderer:this._renderer,renderTargetOptions:this._renderTargetOptions})}async render(Z,_,K,te){const ne=te?new Blob([te],{type:"image/jpeg"}):void 0,ie=new Blob([K],{type:"image/jpeg"});let oe,se,ae=!1;if(typeof createImageBitmap>"u"){const de=await Promise.all([ne?getHTMLImageFromBlob(ne):Promise.resolve(void 0),getHTMLImageFromBlob(ie)]);se=de[0],oe=de[1],ae=!0}else{const de=await Promise.all([ne?createImageBitmap(ne,{imageOrientation:"flipY"}):Promise.resolve(void 0),createImageBitmap(ie,{imageOrientation:"flipY"})]);se=de[0],oe=de[1]}const ge=new Texture(se||new ImageData(2,2),UVMapping,ClampToEdgeWrapping,ClampToEdgeWrapping,LinearFilter,LinearMipMapLinearFilter,RGBAFormat,UnsignedByteType,1,LinearSRGBColorSpace$1);ge.flipY=ae,ge.needsUpdate=!0;const ce=new Texture(oe,UVMapping,ClampToEdgeWrapping,ClampToEdgeWrapping,LinearFilter,LinearMipMapLinearFilter,RGBAFormat,UnsignedByteType,1,SRGBColorSpace$1);ce.flipY=ae,ce.needsUpdate=!0,Z.width=oe.width,Z.height=oe.height,Z.material.gainMap=ge,Z.material.sdr=ce,Z.material.gainMapMin=_.gainMapMin,Z.material.gainMapMax=_.gainMapMax,Z.material.offsetHdr=_.offsetHdr,Z.material.offsetSdr=_.offsetSdr,Z.material.gamma=_.gamma,Z.material.hdrCapacityMin=_.hdrCapacityMin,Z.material.hdrCapacityMax=_.hdrCapacityMax,Z.material.maxDisplayBoost=Math.pow(2,_.hdrCapacityMax),Z.material.needsUpdate=!0,Z.render()}}class GainMapLoader extends LoaderBase{load([Z,_,K],te,ne,ie){const oe=this.prepareQuadRenderer();let se,ae,ge;const ce=async()=>{if(se&&ae&&ge){try{await this.render(oe,ge,se,ae)}catch(Fe){this.manager.itemError(Z),this.manager.itemError(_),this.manager.itemError(K),typeof ie=="function"&&ie(Fe),oe.disposeOnDemandRenderer();return}typeof te=="function"&&te(oe),this.manager.itemEnd(Z),this.manager.itemEnd(_),this.manager.itemEnd(K),oe.disposeOnDemandRenderer()}};let de=!0,Ie=0,fe=0,be=!0,Ae=0,ye=0,ve=!0,Be=0,Re=0;const Ve=()=>{if(typeof ne=="function"){const Fe=Ie+Ae+Be,Te=fe+ye+Re,ke=de&&be&&ve;ne(new ProgressEvent("progress",{lengthComputable:ke,loaded:Te,total:Fe}))}};this.manager.itemStart(Z),this.manager.itemStart(_),this.manager.itemStart(K);const Ee=new FileLoader(this._internalLoadingManager);Ee.setResponseType("arraybuffer"),Ee.setRequestHeader(this.requestHeader),Ee.setPath(this.path),Ee.setWithCredentials(this.withCredentials),Ee.load(Z,async Fe=>{if(typeof Fe=="string")throw new Error("Invalid sdr buffer");se=Fe,await ce()},Fe=>{de=Fe.lengthComputable,fe=Fe.loaded,Ie=Fe.total,Ve()},Fe=>{this.manager.itemError(Z),typeof ie=="function"&&ie(Fe)});const Ze=new FileLoader(this._internalLoadingManager);Ze.setResponseType("arraybuffer"),Ze.setRequestHeader(this.requestHeader),Ze.setPath(this.path),Ze.setWithCredentials(this.withCredentials),Ze.load(_,async Fe=>{if(typeof Fe=="string")throw new Error("Invalid gainmap buffer");ae=Fe,await ce()},Fe=>{be=Fe.lengthComputable,ye=Fe.loaded,Ae=Fe.total,Ve()},Fe=>{this.manager.itemError(_),typeof ie=="function"&&ie(Fe)});const _e=new FileLoader(this._internalLoadingManager);return _e.setRequestHeader(this.requestHeader),_e.setPath(this.path),_e.setWithCredentials(this.withCredentials),_e.load(K,async Fe=>{if(typeof Fe!="string")throw new Error("Invalid metadata string");ge=JSON.parse(Fe),await ce()},Fe=>{ve=Fe.lengthComputable,Re=Fe.loaded,Be=Fe.total,Ve()},Fe=>{this.manager.itemError(K),typeof ie=="function"&&ie(Fe)}),oe}}class HDRJPGLoader extends LoaderBase{load(Z,_,K,te){const ne=this.prepareQuadRenderer(),ie=new FileLoader(this._internalLoadingManager);return ie.setResponseType("arraybuffer"),ie.setRequestHeader(this.requestHeader),ie.setPath(this.path),ie.setWithCredentials(this.withCredentials),this.manager.itemStart(Z),ie.load(Z,async oe=>{if(typeof oe=="string")throw new Error("Invalid buffer, received [string], was expecting [ArrayBuffer]");const se=new Uint8Array(oe);let ae,ge,ce;try{const de=await extractGainmapFromJPEG(se);ae=de.sdr,ge=de.gainMap,ce=de.metadata}catch(de){if(de instanceof XMPMetadataNotFoundError||de instanceof GainMapNotFoundError)console.warn(`Failure to reconstruct an HDR image from ${Z}: Gain map metadata not found in the file, HDRJPGLoader will render the SDR jpeg`),ce={gainMapMin:[0,0,0],gainMapMax:[1,1,1],gamma:[1,1,1],hdrCapacityMin:0,hdrCapacityMax:1,offsetHdr:[0,0,0],offsetSdr:[0,0,0]},ae=se;else throw de}try{await this.render(ne,ce,ae,ge)}catch(de){this.manager.itemError(Z),typeof te=="function"&&te(de),ne.disposeOnDemandRenderer();return}typeof _=="function"&&_(ne),this.manager.itemEnd(Z),ne.disposeOnDemandRenderer()},K,oe=>{this.manager.itemError(Z),typeof te=="function"&&te(oe)}),ne}}const presetsObj={apartment:"lebombo_1k.hdr",city:"potsdamer_platz_1k.hdr",dawn:"kiara_1_dawn_1k.hdr",forest:"forest_slope_1k.hdr",lobby:"st_fagans_interior_1k.hdr",night:"dikhololo_night_1k.hdr",park:"rooitou_park_1k.hdr",studio:"studio_small_03_1k.hdr",sunset:"venice_sunset_1k.hdr",warehouse:"empty_warehouse_01_1k.hdr"},CUBEMAP_ROOT="https://raw.githack.com/pmndrs/drei-assets/456060a26bbeb8fdf79326f224b6d99b8bcce736/hdri/",isArray=X=>Array.isArray(X),defaultFiles=["/px.png","/nx.png","/py.png","/ny.png","/pz.png","/nz.png"];function useEnvironment({files:X=defaultFiles,path:Z="",preset:_=void 0,encoding:K=void 0,extensions:te}={}){let ne=null,ie=!1;_&&(validatePreset(_),X=presetsObj[_],Z=CUBEMAP_ROOT),ie=isArray(X);const{extension:oe,isCubemap:se}=getExtension(X);if(ne=getLoader(oe),!ne)throw new Error("useEnvironment: Unrecognized file extension: "+X);const ae=useThree(Ie=>Ie.gl);reactExports.useLayoutEffect(()=>{if(oe!=="webp"&&oe!=="jpg"&&oe!=="jpeg")return;function Ie(){useLoader.clear(ne,ie?[X]:X)}ae.domElement.addEventListener("webglcontextlost",Ie,{once:!0})},[X,ae.domElement]);const ge=useLoader(ne,ie?[X]:X,Ie=>{(oe==="webp"||oe==="jpg"||oe==="jpeg")&&Ie.setRenderer(ae),Ie.setPath==null||Ie.setPath(Z),te&&te(Ie)});let ce=ie?ge[0]:ge;if(oe==="jpg"||oe==="jpeg"||oe==="webp"){var de;ce=(de=ce.renderTarget)==null?void 0:de.texture}return ce.mapping=se?CubeReflectionMapping:EquirectangularReflectionMapping,"colorSpace"in ce?ce.colorSpace=K??se?"srgb":"srgb-linear":ce.encoding=K??se?sRGBEncoding:LinearEncoding,ce}const preloadDefaultOptions={files:defaultFiles,path:"",preset:void 0,extensions:void 0};useEnvironment.preload=X=>{const Z={...preloadDefaultOptions,...X};let{files:_,path:K=""}=Z;const{preset:te,extensions:ne}=Z;te&&(validatePreset(te),_=presetsObj[te],K=CUBEMAP_ROOT);const{extension:ie}=getExtension(_);if(ie==="webp"||ie==="jpg"||ie==="jpeg")throw new Error("useEnvironment: Preloading gainmaps is not supported");const oe=getLoader(ie);if(!oe)throw new Error("useEnvironment: Unrecognized file extension: "+_);useLoader.preload(oe,isArray(_)?[_]:_,se=>{se.setPath==null||se.setPath(K),ne&&ne(se)})};const clearDefaultOptins={files:defaultFiles,preset:void 0};useEnvironment.clear=X=>{const Z={...clearDefaultOptins,...X};let{files:_}=Z;const{preset:K}=Z;K&&(validatePreset(K),_=presetsObj[K]);const{extension:te}=getExtension(_),ne=getLoader(te);if(!ne)throw new Error("useEnvironment: Unrecognized file extension: "+_);useLoader.clear(ne,isArray(_)?[_]:_)};function validatePreset(X){if(!(X in presetsObj))throw new Error("Preset must be one of: "+Object.keys(presetsObj).join(", "))}function getExtension(X){var Z;const _=isArray(X)&&X.length===6,K=isArray(X)&&X.length===3&&X.some(ie=>ie.endsWith("json")),te=isArray(X)?X[0]:X;return{extension:_?"cube":K?"webp":te.startsWith("data:application/exr")?"exr":te.startsWith("data:application/hdr")?"hdr":te.startsWith("data:image/jpeg")?"jpg":(Z=te.split(".").pop())==null||(Z=Z.split("?"))==null||(Z=Z.shift())==null?void 0:Z.toLowerCase(),isCubemap:_,isGainmap:K}}function getLoader(X){return X==="cube"?CubeTextureLoader:X==="hdr"?RGBELoader:X==="exr"?EXRLoader:X==="jpg"||X==="jpeg"?HDRJPGLoader:X==="webp"?GainMapLoader:null}const isRef=X=>X.current&&X.current.isScene,resolveScene=X=>isRef(X)?X.current:X;function setEnvProps(X,Z,_,K,te={}){var ne,ie,oe,se;te={backgroundBlurriness:0,backgroundIntensity:1,backgroundRotation:[0,0,0],environmentIntensity:1,environmentRotation:[0,0,0],...te};const ae=resolveScene(Z||_),ge=ae.background,ce=ae.environment,de={backgroundBlurriness:ae.backgroundBlurriness,backgroundIntensity:ae.backgroundIntensity,backgroundRotation:(ne=(ie=ae.backgroundRotation)==null||ie.clone==null?void 0:ie.clone())!==null&&ne!==void 0?ne:[0,0,0],environmentIntensity:ae.environmentIntensity,environmentRotation:(oe=(se=ae.environmentRotation)==null||se.clone==null?void 0:se.clone())!==null&&oe!==void 0?oe:[0,0,0]};return X!=="only"&&(ae.environment=K),X&&(ae.background=K),applyProps(ae,te),()=>{X!=="only"&&(ae.environment=ce),X&&(ae.background=ge),applyProps(ae,de)}}function EnvironmentMap({scene:X,background:Z=!1,map:_,...K}){const te=useThree(ne=>ne.scene);return reactExports.useLayoutEffect(()=>{if(_)return setEnvProps(Z,X,te,_,K)}),null}function EnvironmentCube({background:X=!1,scene:Z,blur:_,backgroundBlurriness:K,backgroundIntensity:te,backgroundRotation:ne,environmentIntensity:ie,environmentRotation:oe,...se}){const ae=useEnvironment(se),ge=useThree(ce=>ce.scene);return reactExports.useLayoutEffect(()=>setEnvProps(X,Z,ge,ae,{backgroundBlurriness:_??K,backgroundIntensity:te,backgroundRotation:ne,environmentIntensity:ie,environmentRotation:oe})),reactExports.useEffect(()=>()=>{ae.dispose()},[ae]),null}function EnvironmentPortal({children:X,near:Z=.1,far:_=1e3,resolution:K=256,frames:te=1,map:ne,background:ie=!1,blur:oe,backgroundBlurriness:se,backgroundIntensity:ae,backgroundRotation:ge,environmentIntensity:ce,environmentRotation:de,scene:Ie,files:fe,path:be,preset:Ae=void 0,extensions:ye}){const ve=useThree(_e=>_e.gl),Be=useThree(_e=>_e.scene),Re=reactExports.useRef(null),[Ve]=reactExports.useState(()=>new Scene$1),Ee=reactExports.useMemo(()=>{const _e=new WebGLCubeRenderTarget(K);return _e.texture.type=HalfFloatType,_e},[K]);reactExports.useEffect(()=>()=>{Ee.dispose()},[Ee]),reactExports.useLayoutEffect(()=>{if(te===1){const _e=ve.autoClear;ve.autoClear=!0,Re.current.update(ve,Ve),ve.autoClear=_e}return setEnvProps(ie,Ie,Be,Ee.texture,{backgroundBlurriness:oe??se,backgroundIntensity:ae,backgroundRotation:ge,environmentIntensity:ce,environmentRotation:de})},[X,Ve,Ee.texture,Ie,Be,ie,te,ve]);let Ze=1;return useFrame(()=>{if(te===1/0||Ze<te){const _e=ve.autoClear;ve.autoClear=!0,Re.current.update(ve,Ve),ve.autoClear=_e,Ze++}}),reactExports.createElement(reactExports.Fragment,null,createPortal(reactExports.createElement(reactExports.Fragment,null,X,reactExports.createElement("cubeCamera",{ref:Re,args:[Z,_,Ee]}),fe||Ae?reactExports.createElement(EnvironmentCube,{background:!0,files:fe,preset:Ae,path:be,extensions:ye}):ne?reactExports.createElement(EnvironmentMap,{background:!0,map:ne,extensions:ye}):null),Ve))}function EnvironmentGround(X){var Z,_,K,te;const ne=useEnvironment(X),ie=X.map||ne;reactExports.useMemo(()=>extend({GroundProjectedEnvImpl:GroundProjectedEnv}),[]),reactExports.useEffect(()=>()=>{ne.dispose()},[ne]);const oe=reactExports.useMemo(()=>[ie],[ie]),se=(Z=X.ground)==null?void 0:Z.height,ae=(_=X.ground)==null?void 0:_.radius,ge=(K=(te=X.ground)==null?void 0:te.scale)!==null&&K!==void 0?K:1e3;return reactExports.createElement(reactExports.Fragment,null,reactExports.createElement(EnvironmentMap,_extends$2({},X,{map:ie})),reactExports.createElement("groundProjectedEnvImpl",{args:oe,scale:ge,height:se,radius:ae}))}function Environment(X){return X.ground?reactExports.createElement(EnvironmentGround,X):X.map?reactExports.createElement(EnvironmentMap,X):X.children?reactExports.createElement(EnvironmentPortal,X):reactExports.createElement(EnvironmentCube,X)}var reactDomExports=requireReactDom();const $7SXl2$reactdom=getDefaultExportFromCjs(reactDomExports);function $6ed0406888f73fc4$var$setRef(X,Z){typeof X=="function"?X(Z):X!=null&&(X.current=Z)}function $6ed0406888f73fc4$export$43e446d32b3d21af(...X){return Z=>X.forEach(_=>$6ed0406888f73fc4$var$setRef(_,Z))}function $6ed0406888f73fc4$export$c7b2cbe3552a0d05(...X){return reactExports.useCallback($6ed0406888f73fc4$export$43e446d32b3d21af(...X),X)}const $5e63c961fc1ce211$export$8c6ed5c666ac1360=reactExports.forwardRef((X,Z)=>{const{children:_,...K}=X,te=reactExports.Children.toArray(_),ne=te.find($5e63c961fc1ce211$var$isSlottable);if(ne){const ie=ne.props.children,oe=te.map(se=>se===ne?reactExports.Children.count(ie)>1?reactExports.Children.only(null):reactExports.isValidElement(ie)?ie.props.children:null:se);return reactExports.createElement($5e63c961fc1ce211$var$SlotClone,_extends$2({},K,{ref:Z}),reactExports.isValidElement(ie)?reactExports.cloneElement(ie,void 0,oe):null)}return reactExports.createElement($5e63c961fc1ce211$var$SlotClone,_extends$2({},K,{ref:Z}),_)});$5e63c961fc1ce211$export$8c6ed5c666ac1360.displayName="Slot";const $5e63c961fc1ce211$var$SlotClone=reactExports.forwardRef((X,Z)=>{const{children:_,...K}=X;return reactExports.isValidElement(_)?reactExports.cloneElement(_,{...$5e63c961fc1ce211$var$mergeProps(K,_.props),ref:$6ed0406888f73fc4$export$43e446d32b3d21af(Z,_.ref)}):reactExports.Children.count(_)>1?reactExports.Children.only(null):null});$5e63c961fc1ce211$var$SlotClone.displayName="SlotClone";const $5e63c961fc1ce211$export$d9f1ccf0bdb05d45=({children:X})=>reactExports.createElement(reactExports.Fragment,null,X);function $5e63c961fc1ce211$var$isSlottable(X){return reactExports.isValidElement(X)&&X.type===$5e63c961fc1ce211$export$d9f1ccf0bdb05d45}function $5e63c961fc1ce211$var$mergeProps(X,Z){const _={...Z};for(const K in Z){const te=X[K],ne=Z[K];/^on[A-Z]/.test(K)?te&&ne?_[K]=(...oe)=>{ne(...oe),te(...oe)}:te&&(_[K]=te):K==="style"?_[K]={...te,...ne}:K==="className"&&(_[K]=[te,ne].filter(Boolean).join(" "))}return{...X,..._}}const $8927f6f2acc4f386$var$NODES=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","span","svg","ul"],$8927f6f2acc4f386$export$250ffa63cdc0d034=$8927f6f2acc4f386$var$NODES.reduce((X,Z)=>{const _=reactExports.forwardRef((K,te)=>{const{asChild:ne,...ie}=K,oe=ne?$5e63c961fc1ce211$export$8c6ed5c666ac1360:Z;return reactExports.useEffect(()=>{window[Symbol.for("radix-ui")]=!0},[]),reactExports.createElement(oe,_extends$2({},ie,{ref:te}))});return _.displayName=`Primitive.${Z}`,{...X,[Z]:_}},{});function $8927f6f2acc4f386$export$6d1a0317bde7de7f(X,Z){X&&reactDomExports.flushSync(()=>X.dispatchEvent(Z))}const $f1701beae083dbae$export$602eac185826482c=reactExports.forwardRef((X,Z)=>{var _;const{container:K=globalThis==null||(_=globalThis.document)===null||_===void 0?void 0:_.body,...te}=X;return K?$7SXl2$reactdom.createPortal(reactExports.createElement($8927f6f2acc4f386$export$250ffa63cdc0d034.div,_extends$2({},te,{ref:Z})),K):null}),$f1701beae083dbae$export$be92b6f5f03c0fe9=$f1701beae083dbae$export$602eac185826482c;var has=Object.prototype.hasOwnProperty;function dequal(X,Z){var _,K;if(X===Z)return!0;if(X&&Z&&(_=X.constructor)===Z.constructor){if(_===Date)return X.getTime()===Z.getTime();if(_===RegExp)return X.toString()===Z.toString();if(_===Array){if((K=X.length)===Z.length)for(;K--&&dequal(X[K],Z[K]););return K===-1}if(!_||typeof X=="object"){K=0;for(_ in X)if(has.call(X,_)&&++K&&!has.call(Z,_)||!(_ in Z)||!dequal(X[_],Z[_]))return!1;return Object.keys(Z).length===K}}return X!==X&&Z!==Z}function shallow(X,Z){if(Object.is(X,Z))return!0;if(typeof X!="object"||X===null||typeof Z!="object"||Z===null)return!1;const _=Object.keys(X);if(_.length!==Object.keys(Z).length)return!1;for(let K=0;K<_.length;K++)if(!Object.prototype.hasOwnProperty.call(Z,_[K])||!Object.is(X[_[K]],Z[_[K]]))return!1;return!0}var Rule=function(Z,_,K,te){this.name=Z,this.fn=_,this.args=K,this.modifiers=te};Rule.prototype._test=function(Z){var _=this.fn;try{testAux(this.modifiers.slice(),_,this)(Z)}catch{_=function(){return!1}}try{return testAux(this.modifiers.slice(),_,this)(Z)}catch{return!1}};Rule.prototype._check=function(Z){try{testAux(this.modifiers.slice(),this.fn,this)(Z)}catch{if(testAux(this.modifiers.slice(),function(K){return K},this)(!1))return}if(!testAux(this.modifiers.slice(),this.fn,this)(Z))throw null};Rule.prototype._testAsync=function(Z){var _=this;return new Promise(function(K,te){testAsyncAux(_.modifiers.slice(),_.fn,_)(Z).then(function(ne){ne?K(Z):te(null)}).catch(function(ne){return te(ne)})})};function pickFn(X,Z){return Z===void 0&&(Z="simple"),typeof X=="object"?X[Z]:X}function testAux(X,Z,_){if(X.length){var K=X.shift(),te=testAux(X,Z,_);return K.perform(te,_)}else return pickFn(Z)}function testAsyncAux(X,Z,_){if(X.length){var K=X.shift(),te=testAsyncAux(X,Z,_);return K.performAsync(te,_)}else return function(ne){return Promise.resolve(pickFn(Z,"async")(ne))}}var Modifier=function(Z,_,K){this.name=Z,this.perform=_,this.performAsync=K},ValidationError=function(X){function Z(_,K,te,ne){for(var ie=[],oe=arguments.length-4;oe-- >0;)ie[oe]=arguments[oe+4];X.call(this,ie),X.captureStackTrace&&X.captureStackTrace(this,Z),this.rule=_,this.value=K,this.cause=te,this.target=ne}return X&&(Z.__proto__=X),Z.prototype=Object.create(X&&X.prototype),Z.prototype.constructor=Z,Z}(Error),Context=function(Z,_){Z===void 0&&(Z=[]),_===void 0&&(_=[]),this.chain=Z,this.nextRuleModifiers=_};Context.prototype._applyRule=function(Z,_){var K=this;return function(){for(var te=[],ne=arguments.length;ne--;)te[ne]=arguments[ne];return K.chain.push(new Rule(_,Z.apply(K,te),te,K.nextRuleModifiers)),K.nextRuleModifiers=[],K}};Context.prototype._applyModifier=function(Z,_){return this.nextRuleModifiers.push(new Modifier(_,Z.simple,Z.async)),this};Context.prototype._clone=function(){return new Context(this.chain.slice(),this.nextRuleModifiers.slice())};Context.prototype.test=function(Z){return this.chain.every(function(_){return _._test(Z)})};Context.prototype.testAll=function(Z){var _=[];return this.chain.forEach(function(K){try{K._check(Z)}catch(te){_.push(new ValidationError(K,Z,te))}}),_};Context.prototype.check=function(Z){this.chain.forEach(function(_){try{_._check(Z)}catch(K){throw new ValidationError(_,Z,K)}})};Context.prototype.testAsync=function(Z){var _=this;return new Promise(function(K,te){executeAsyncRules(Z,_.chain.slice(),K,te)})};function executeAsyncRules(X,Z,_,K){if(Z.length){var te=Z.shift();te._testAsync(X).then(function(){executeAsyncRules(X,Z,_,K)},function(ne){K(new ValidationError(te,X,ne))})}else _(X)}var consideredEmpty=function(X,Z){return Z&&typeof X=="string"&&X.trim().length===0?!0:X==null};function optional(X,Z){return Z===void 0&&(Z=!1),{simple:function(_){return consideredEmpty(_,Z)||X.check(_)===void 0},async:function(_){return consideredEmpty(_,Z)||X.testAsync(_)}}}function v8n(){return typeof Proxy<"u"?proxyContext(new Context):proxylessContext(new Context)}var customRules={};v8n.extend=function(X){Object.assign(customRules,X)};v8n.clearCustomRules=function(){customRules={}};function proxyContext(X){return new Proxy(X,{get:function(_,K){if(K in _)return _[K];var te=proxyContext(X._clone());if(K in availableModifiers)return te._applyModifier(availableModifiers[K],K);if(K in customRules)return te._applyRule(customRules[K],K);if(K in availableRules)return te._applyRule(availableRules[K],K)}})}function proxylessContext(X){var Z=function(te,ne){return Object.keys(te).forEach(function(ie){ne[ie]=function(){for(var oe=[],se=arguments.length;se--;)oe[se]=arguments[se];var ae=proxylessContext(ne._clone()),ge=ae._applyRule(te[ie],ie).apply(void 0,oe);return ge}}),ne},_=Z(availableRules,X),K=Z(customRules,_);return Object.keys(availableModifiers).forEach(function(te){Object.defineProperty(K,te,{get:function(){var ne=proxylessContext(K._clone());return ne._applyModifier(availableModifiers[te],te)}})}),K}var availableModifiers={not:{simple:function(X){return function(Z){return!X(Z)}},async:function(X){return function(Z){return Promise.resolve(X(Z)).then(function(_){return!_}).catch(function(){return!0})}}},some:{simple:function(X){return function(Z){return split(Z).some(function(_){try{return X(_)}catch{return!1}})}},async:function(X){return function(Z){return Promise.all(split(Z).map(function(_){try{return X(_).catch(function(){return!1})}catch{return!1}})).then(function(_){return _.some(Boolean)})}}},every:{simple:function(X){return function(Z){return Z!==!1&&split(Z).every(X)}},async:function(X){return function(Z){return Promise.all(split(Z).map(X)).then(function(_){return _.every(Boolean)})}}},strict:{simple:function(X,Z){return function(_){return isSchemaRule(Z)&&_&&typeof _=="object"?Object.keys(Z.args[0]).length===Object.keys(_).length&&X(_):X(_)}},async:function(X,Z){return function(_){return Promise.resolve(X(_)).then(function(K){return isSchemaRule(Z)&&_&&typeof _=="object"?Object.keys(Z.args[0]).length===Object.keys(_).length&&K:K}).catch(function(){return!1})}}}};function isSchemaRule(X){return X&&X.name==="schema"&&X.args.length>0&&typeof X.args[0]=="object"}function split(X){return typeof X=="string"?X.split(""):X}var availableRules={equal:function(X){return function(Z){return Z==X}},exact:function(X){return function(Z){return Z===X}},number:function(X){return X===void 0&&(X=!0),function(Z){return typeof Z=="number"&&(X||isFinite(Z))}},integer:function(){return function(X){var Z=Number.isInteger||isIntegerPolyfill;return Z(X)}},numeric:function(){return function(X){return!isNaN(parseFloat(X))&&isFinite(X)}},string:function(){return testType("string")},boolean:function(){return testType("boolean")},undefined:function(){return testType("undefined")},null:function(){return testType("null")},array:function(){return testType("array")},object:function(){return testType("object")},instanceOf:function(X){return function(Z){return Z instanceof X}},pattern:function(X){return function(Z){return X.test(Z)}},lowercase:function(){return function(X){return typeof X=="boolean"||X===X.toLowerCase()&&X.trim()!==""}},uppercase:function(){return function(X){return X===X.toUpperCase()&&X.trim()!==""}},vowel:function(){return function(X){return/^[aeiou]+$/i.test(X)}},consonant:function(){return function(X){return/^(?=[^aeiou])([a-z]+)$/i.test(X)}},first:function(X){return function(Z){return Z[0]==X}},last:function(X){return function(Z){return Z[Z.length-1]==X}},empty:function(){return function(X){return X.length===0}},length:function(X,Z){return function(_){return _.length>=X&&_.length<=(Z||X)}},minLength:function(X){return function(Z){return Z.length>=X}},maxLength:function(X){return function(Z){return Z.length<=X}},negative:function(){return function(X){return X<0}},positive:function(){return function(X){return X>=0}},between:function(X,Z){return function(_){return _>=X&&_<=Z}},range:function(X,Z){return function(_){return _>=X&&_<=Z}},lessThan:function(X){return function(Z){return Z<X}},lessThanOrEqual:function(X){return function(Z){return Z<=X}},greaterThan:function(X){return function(Z){return Z>X}},greaterThanOrEqual:function(X){return function(Z){return Z>=X}},even:function(){return function(X){return X%2===0}},odd:function(){return function(X){return X%2!==0}},includes:function(X){return function(Z){return~Z.indexOf(X)}},schema:function(X){return testSchema(X)},passesAnyOf:function(){for(var X=[],Z=arguments.length;Z--;)X[Z]=arguments[Z];return function(_){return X.some(function(K){return K.test(_)})}},optional};function testType(X){return function(Z){return Array.isArray(Z)&&X==="array"||Z===null&&X==="null"||typeof Z===X}}function isIntegerPolyfill(X){return typeof X=="number"&&isFinite(X)&&Math.floor(X)===X}function testSchema(X){return{simple:function(Z){var _=[];if(Object.keys(X).forEach(function(K){var te=X[K];try{te.check((Z||{})[K])}catch(ne){ne.target=K,_.push(ne)}}),_.length>0)throw _;return!0},async:function(Z){var _=[],K=Object.keys(X).map(function(te){var ne=X[te];return ne.testAsync((Z||{})[te]).catch(function(ie){ie.target=te,_.push(ie)})});return Promise.all(K).then(function(){if(_.length>0)throw _;return!0})}}}var e$3="colors",t$2="sizes",r$4="space",n$3={gap:r$4,gridGap:r$4,columnGap:r$4,gridColumnGap:r$4,rowGap:r$4,gridRowGap:r$4,inset:r$4,insetBlock:r$4,insetBlockEnd:r$4,insetBlockStart:r$4,insetInline:r$4,insetInlineEnd:r$4,insetInlineStart:r$4,margin:r$4,marginTop:r$4,marginRight:r$4,marginBottom:r$4,marginLeft:r$4,marginBlock:r$4,marginBlockEnd:r$4,marginBlockStart:r$4,marginInline:r$4,marginInlineEnd:r$4,marginInlineStart:r$4,padding:r$4,paddingTop:r$4,paddingRight:r$4,paddingBottom:r$4,paddingLeft:r$4,paddingBlock:r$4,paddingBlockEnd:r$4,paddingBlockStart:r$4,paddingInline:r$4,paddingInlineEnd:r$4,paddingInlineStart:r$4,top:r$4,right:r$4,bottom:r$4,left:r$4,scrollMargin:r$4,scrollMarginTop:r$4,scrollMarginRight:r$4,scrollMarginBottom:r$4,scrollMarginLeft:r$4,scrollMarginX:r$4,scrollMarginY:r$4,scrollMarginBlock:r$4,scrollMarginBlockEnd:r$4,scrollMarginBlockStart:r$4,scrollMarginInline:r$4,scrollMarginInlineEnd:r$4,scrollMarginInlineStart:r$4,scrollPadding:r$4,scrollPaddingTop:r$4,scrollPaddingRight:r$4,scrollPaddingBottom:r$4,scrollPaddingLeft:r$4,scrollPaddingX:r$4,scrollPaddingY:r$4,scrollPaddingBlock:r$4,scrollPaddingBlockEnd:r$4,scrollPaddingBlockStart:r$4,scrollPaddingInline:r$4,scrollPaddingInlineEnd:r$4,scrollPaddingInlineStart:r$4,fontSize:"fontSizes",background:e$3,backgroundColor:e$3,backgroundImage:e$3,borderImage:e$3,border:e$3,borderBlock:e$3,borderBlockEnd:e$3,borderBlockStart:e$3,borderBottom:e$3,borderBottomColor:e$3,borderColor:e$3,borderInline:e$3,borderInlineEnd:e$3,borderInlineStart:e$3,borderLeft:e$3,borderLeftColor:e$3,borderRight:e$3,borderRightColor:e$3,borderTop:e$3,borderTopColor:e$3,caretColor:e$3,color:e$3,columnRuleColor:e$3,fill:e$3,outline:e$3,outlineColor:e$3,stroke:e$3,textDecorationColor:e$3,fontFamily:"fonts",fontWeight:"fontWeights",lineHeight:"lineHeights",letterSpacing:"letterSpacings",blockSize:t$2,minBlockSize:t$2,maxBlockSize:t$2,inlineSize:t$2,minInlineSize:t$2,maxInlineSize:t$2,width:t$2,minWidth:t$2,maxWidth:t$2,height:t$2,minHeight:t$2,maxHeight:t$2,flexBasis:t$2,gridTemplateColumns:t$2,gridTemplateRows:t$2,borderWidth:"borderWidths",borderTopWidth:"borderWidths",borderRightWidth:"borderWidths",borderBottomWidth:"borderWidths",borderLeftWidth:"borderWidths",borderStyle:"borderStyles",borderTopStyle:"borderStyles",borderRightStyle:"borderStyles",borderBottomStyle:"borderStyles",borderLeftStyle:"borderStyles",borderRadius:"radii",borderTopLeftRadius:"radii",borderTopRightRadius:"radii",borderBottomRightRadius:"radii",borderBottomLeftRadius:"radii",boxShadow:"shadows",textShadow:"shadows",transition:"transitions",zIndex:"zIndices"},i$4=(X,Z)=>typeof Z=="function"?{"()":Function.prototype.toString.call(Z)}:Z,o$3=()=>{const X=Object.create(null);return(Z,_,...K)=>{const te=(ne=>JSON.stringify(ne,i$4))(Z);return te in X?X[te]:X[te]=_(Z,...K)}},l$3=Symbol.for("sxs.internal"),s$5=(X,Z)=>Object.defineProperties(X,Object.getOwnPropertyDescriptors(Z)),a$5=X=>{for(const Z in X)return!0;return!1},{hasOwnProperty:c$6}=Object.prototype,d$4=X=>X.includes("-")?X:X.replace(/[A-Z]/g,Z=>"-"+Z.toLowerCase()),g$4=/\s+(?![^()]*\))/,p$4=X=>Z=>X(...typeof Z=="string"?String(Z).split(g$4):[Z]),u$4={appearance:X=>({WebkitAppearance:X,appearance:X}),backfaceVisibility:X=>({WebkitBackfaceVisibility:X,backfaceVisibility:X}),backdropFilter:X=>({WebkitBackdropFilter:X,backdropFilter:X}),backgroundClip:X=>({WebkitBackgroundClip:X,backgroundClip:X}),boxDecorationBreak:X=>({WebkitBoxDecorationBreak:X,boxDecorationBreak:X}),clipPath:X=>({WebkitClipPath:X,clipPath:X}),content:X=>({content:X.includes('"')||X.includes("'")||/^([A-Za-z]+\([^]*|[^]*-quote|inherit|initial|none|normal|revert|unset)$/.test(X)?X:`"${X}"`}),hyphens:X=>({WebkitHyphens:X,hyphens:X}),maskImage:X=>({WebkitMaskImage:X,maskImage:X}),maskSize:X=>({WebkitMaskSize:X,maskSize:X}),tabSize:X=>({MozTabSize:X,tabSize:X}),textSizeAdjust:X=>({WebkitTextSizeAdjust:X,textSizeAdjust:X}),userSelect:X=>({WebkitUserSelect:X,userSelect:X}),marginBlock:p$4((X,Z)=>({marginBlockStart:X,marginBlockEnd:Z||X})),marginInline:p$4((X,Z)=>({marginInlineStart:X,marginInlineEnd:Z||X})),maxSize:p$4((X,Z)=>({maxBlockSize:X,maxInlineSize:Z||X})),minSize:p$4((X,Z)=>({minBlockSize:X,minInlineSize:Z||X})),paddingBlock:p$4((X,Z)=>({paddingBlockStart:X,paddingBlockEnd:Z||X})),paddingInline:p$4((X,Z)=>({paddingInlineStart:X,paddingInlineEnd:Z||X}))},h$4=/([\d.]+)([^]*)/,f$4=(X,Z)=>X.length?X.reduce((_,K)=>(_.push(...Z.map(te=>te.includes("&")?te.replace(/&/g,/[ +>|~]/.test(K)&&/&.*&/.test(te)?`:is(${K})`:K):K+" "+te)),_),[]):Z,m$5=(X,Z)=>X in b$6&&typeof Z=="string"?Z.replace(/^((?:[^]*[^\w-])?)(fit-content|stretch)((?:[^\w-][^]*)?)$/,(_,K,te,ne)=>K+(te==="stretch"?`-moz-available${ne};${d$4(X)}:${K}-webkit-fill-available`:`-moz-fit-content${ne};${d$4(X)}:${K}fit-content`)+ne):String(Z),b$6={blockSize:1,height:1,inlineSize:1,maxBlockSize:1,maxHeight:1,maxInlineSize:1,maxWidth:1,minBlockSize:1,minHeight:1,minInlineSize:1,minWidth:1,width:1},S$3=X=>X?X+"-":"",k$3=(X,Z,_)=>X.replace(/([+-])?((?:\d+(?:\.\d*)?|\.\d+)(?:[Ee][+-]?\d+)?)?(\$|--)([$\w-]+)/g,(K,te,ne,ie,oe)=>ie=="$"==!!ne?K:(te||ie=="--"?"calc(":"")+"var(--"+(ie==="$"?S$3(Z)+(oe.includes("$")?"":S$3(_))+oe.replace(/\$/g,"-"):oe)+")"+(te||ie=="--"?"*"+(te||"")+(ne||"1")+")":"")),y$4=/\s*,\s*(?![^()]*\))/,B=Object.prototype.toString,$$2=(X,Z,_,K,te)=>{let ne,ie,oe;const se=(ae,ge,ce)=>{let de,Ie;const fe=be=>{for(de in be){const ve=de.charCodeAt(0)===64,Be=ve&&Array.isArray(be[de])?be[de]:[be[de]];for(Ie of Be){const Re=/[A-Z]/.test(ye=de)?ye:ye.replace(/-[^]/g,Ee=>Ee[1].toUpperCase()),Ve=typeof Ie=="object"&&Ie&&Ie.toString===B&&(!K.utils[Re]||!ge.length);if(Re in K.utils&&!Ve){const Ee=K.utils[Re];if(Ee!==ie){ie=Ee,fe(Ee(Ie)),ie=null;continue}}else if(Re in u$4){const Ee=u$4[Re];if(Ee!==oe){oe=Ee,fe(Ee(Ie)),oe=null;continue}}if(ve&&(Ae=de.slice(1)in K.media?"@media "+K.media[de.slice(1)]:de,de=Ae.replace(/\(\s*([\w-]+)\s*(=|<|<=|>|>=)\s*([\w-]+)\s*(?:(<|<=|>|>=)\s*([\w-]+)\s*)?\)/g,(Ee,Ze,_e,Fe,Te,ke)=>{const Le=h$4.test(Ze),Ke=.0625*(Le?-1:1),[Ue,rt]=Le?[Fe,Ze]:[Ze,Fe];return"("+(_e[0]==="="?"":_e[0]===">"===Le?"max-":"min-")+Ue+":"+(_e[0]!=="="&&_e.length===1?rt.replace(h$4,(tt,at,ze)=>Number(at)+Ke*(_e===">"?1:-1)+ze):rt)+(Te?") and ("+(Te[0]===">"?"min-":"max-")+Ue+":"+(Te.length===1?ke.replace(h$4,(tt,at,ze)=>Number(at)+Ke*(Te===">"?-1:1)+ze):ke):"")+")"})),Ve){const Ee=ve?ce.concat(de):[...ce],Ze=ve?[...ge]:f$4(ge,de.split(y$4));ne!==void 0&&te(x$3(...ne)),ne=void 0,se(Ie,Ze,Ee)}else ne===void 0&&(ne=[[],ge,ce]),de=ve||de.charCodeAt(0)!==36?de:`--${S$3(K.prefix)}${de.slice(1).replace(/\$/g,"-")}`,Ie=Ve?Ie:typeof Ie=="number"?Ie&&Re in I$2?String(Ie)+"px":String(Ie):k$3(m$5(Re,Ie??""),K.prefix,K.themeMap[Re]),ne[0].push(`${ve?`${de} `:`${d$4(de)}:`}${Ie}`)}}var Ae,ye};fe(ae),ne!==void 0&&te(x$3(...ne)),ne=void 0};se(X,Z,_)},x$3=(X,Z,_)=>`${_.map(K=>`${K}{`).join("")}${Z.length?`${Z.join(",")}{`:""}${X.join(";")}${Z.length?"}":""}${Array(_.length?_.length+1:0).join("}")}`,I$2={animationDelay:1,animationDuration:1,backgroundSize:1,blockSize:1,border:1,borderBlock:1,borderBlockEnd:1,borderBlockEndWidth:1,borderBlockStart:1,borderBlockStartWidth:1,borderBlockWidth:1,borderBottom:1,borderBottomLeftRadius:1,borderBottomRightRadius:1,borderBottomWidth:1,borderEndEndRadius:1,borderEndStartRadius:1,borderInlineEnd:1,borderInlineEndWidth:1,borderInlineStart:1,borderInlineStartWidth:1,borderInlineWidth:1,borderLeft:1,borderLeftWidth:1,borderRadius:1,borderRight:1,borderRightWidth:1,borderSpacing:1,borderStartEndRadius:1,borderStartStartRadius:1,borderTop:1,borderTopLeftRadius:1,borderTopRightRadius:1,borderTopWidth:1,borderWidth:1,bottom:1,columnGap:1,columnRule:1,columnRuleWidth:1,columnWidth:1,containIntrinsicSize:1,flexBasis:1,fontSize:1,gap:1,gridAutoColumns:1,gridAutoRows:1,gridTemplateColumns:1,gridTemplateRows:1,height:1,inlineSize:1,inset:1,insetBlock:1,insetBlockEnd:1,insetBlockStart:1,insetInline:1,insetInlineEnd:1,insetInlineStart:1,left:1,letterSpacing:1,margin:1,marginBlock:1,marginBlockEnd:1,marginBlockStart:1,marginBottom:1,marginInline:1,marginInlineEnd:1,marginInlineStart:1,marginLeft:1,marginRight:1,marginTop:1,maxBlockSize:1,maxHeight:1,maxInlineSize:1,maxWidth:1,minBlockSize:1,minHeight:1,minInlineSize:1,minWidth:1,offsetDistance:1,offsetRotate:1,outline:1,outlineOffset:1,outlineWidth:1,overflowClipMargin:1,padding:1,paddingBlock:1,paddingBlockEnd:1,paddingBlockStart:1,paddingBottom:1,paddingInline:1,paddingInlineEnd:1,paddingInlineStart:1,paddingLeft:1,paddingRight:1,paddingTop:1,perspective:1,right:1,rowGap:1,scrollMargin:1,scrollMarginBlock:1,scrollMarginBlockEnd:1,scrollMarginBlockStart:1,scrollMarginBottom:1,scrollMarginInline:1,scrollMarginInlineEnd:1,scrollMarginInlineStart:1,scrollMarginLeft:1,scrollMarginRight:1,scrollMarginTop:1,scrollPadding:1,scrollPaddingBlock:1,scrollPaddingBlockEnd:1,scrollPaddingBlockStart:1,scrollPaddingBottom:1,scrollPaddingInline:1,scrollPaddingInlineEnd:1,scrollPaddingInlineStart:1,scrollPaddingLeft:1,scrollPaddingRight:1,scrollPaddingTop:1,shapeMargin:1,textDecoration:1,textDecorationThickness:1,textIndent:1,textUnderlineOffset:1,top:1,transitionDelay:1,transitionDuration:1,verticalAlign:1,width:1,wordSpacing:1},R$3=X=>String.fromCharCode(X+(X>25?39:97)),z$1=X=>(Z=>{let _,K="";for(_=Math.abs(Z);_>52;_=_/52|0)K=R$3(_%52)+K;return R$3(_%52)+K})(((Z,_)=>{let K=_.length;for(;K;)Z=33*Z^_.charCodeAt(--K);return Z})(5381,JSON.stringify(X))>>>0),W$1=["themed","global","styled","onevar","resonevar","allvar","inline"],j$1=X=>{if(X.href&&!X.href.startsWith(location.origin))return!1;try{return!!X.cssRules}catch{return!1}},E$1=X=>{let Z;const _=()=>{const{cssRules:te}=Z.sheet;return[].map.call(te,(ne,ie)=>{const{cssText:oe}=ne;let se="";if(oe.startsWith("--sxs"))return"";if(te[ie-1]&&(se=te[ie-1].cssText).startsWith("--sxs")){if(!ne.cssRules.length)return"";for(const ae in Z.rules)if(Z.rules[ae].group===ne)return`--sxs{--sxs:${[...Z.rules[ae].cache].join(" ")}}${oe}`;return ne.cssRules.length?`${se}${oe}`:""}return oe}).join("")},K=()=>{if(Z){const{rules:oe,sheet:se}=Z;if(!se.deleteRule){for(;Object(Object(se.cssRules)[0]).type===3;)se.cssRules.splice(0,1);se.cssRules=[]}for(const ae in oe)delete oe[ae]}const te=Object(X).styleSheets||[];for(const oe of te)if(j$1(oe)){for(let se=0,ae=oe.cssRules;ae[se];++se){const ge=Object(ae[se]);if(ge.type!==1)continue;const ce=Object(ae[se+1]);if(ce.type!==4)continue;++se;const{cssText:de}=ge;if(!de.startsWith("--sxs"))continue;const Ie=de.slice(14,-3).trim().split(/\s+/),fe=W$1[Ie[0]];fe&&(Z||(Z={sheet:oe,reset:K,rules:{},toString:_}),Z.rules[fe]={group:ce,index:se,cache:new Set(Ie)})}if(Z)break}if(!Z){const oe=(se,ae)=>({type:ae,cssRules:[],insertRule(ge,ce){this.cssRules.splice(ce,0,oe(ge,{import:3,undefined:1}[(ge.toLowerCase().match(/^@([a-z]+)/)||[])[1]]||4))},get cssText(){return se==="@media{}"?`@media{${[].map.call(this.cssRules,ge=>ge.cssText).join("")}}`:se}});Z={sheet:X?(X.head||X).appendChild(document.createElement("style")).sheet:oe("","text/css"),rules:{},reset:K,toString:_}}const{sheet:ne,rules:ie}=Z;for(let oe=W$1.length-1;oe>=0;--oe){const se=W$1[oe];if(!ie[se]){const ae=W$1[oe+1],ge=ie[ae]?ie[ae].index:ne.cssRules.length;ne.insertRule("@media{}",ge),ne.insertRule(`--sxs{--sxs:${oe}}`,ge),ie[se]={group:ne.cssRules[ge+1],index:ge,cache:new Set([oe])}}v$4(ie[se])}};return K(),Z},v$4=X=>{const Z=X.group;let _=Z.cssRules.length;X.apply=K=>{try{Z.insertRule(K,_),++_}catch{}}},T$3=Symbol(),w$2=o$3(),M$1=(X,Z)=>w$2(X,()=>(..._)=>{let K={type:null,composers:new Set};for(const te of _)if(te!=null)if(te[l$3]){K.type==null&&(K.type=te[l$3].type);for(const ne of te[l$3].composers)K.composers.add(ne)}else te.constructor!==Object||te.$$typeof?K.type==null&&(K.type=te):K.composers.add(C$1(te,X));return K.type==null&&(K.type="span"),K.composers.size||K.composers.add(["PJLV",{},[],[],{},[]]),P$1(X,K,Z)}),C$1=({variants:X,compoundVariants:Z,defaultVariants:_,...K},te)=>{const ne=`${S$3(te.prefix)}c-${z$1(K)}`,ie=[],oe=[],se=Object.create(null),ae=[];for(const de in _)se[de]=String(_[de]);if(typeof X=="object"&&X)for(const de in X){ge=se,ce=de,c$6.call(ge,ce)||(se[de]="undefined");const Ie=X[de];for(const fe in Ie){const be={[de]:String(fe)};String(fe)==="undefined"&&ae.push(de);const Ae=Ie[fe],ye=[be,Ae,!a$5(Ae)];ie.push(ye)}}var ge,ce;if(typeof Z=="object"&&Z)for(const de of Z){let{css:Ie,...fe}=de;Ie=typeof Ie=="object"&&Ie||{};for(const Ae in fe)fe[Ae]=String(fe[Ae]);const be=[fe,Ie,!a$5(Ie)];oe.push(be)}return[ne,K,ie,oe,se,ae]},P$1=(X,Z,_)=>{const[K,te,ne,ie]=L$3(Z.composers),oe=typeof Z.type=="function"||Z.type.$$typeof?(ce=>{function de(){for(let Ie=0;Ie<de[T$3].length;Ie++){const[fe,be]=de[T$3][Ie];ce.rules[fe].apply(be)}return de[T$3]=[],null}return de[T$3]=[],de.rules={},W$1.forEach(Ie=>de.rules[Ie]={apply:fe=>de[T$3].push([Ie,fe])}),de})(_):null,se=(oe||_).rules,ae=`.${K}${te.length>1?`:where(.${te.slice(1).join(".")})`:""}`,ge=ce=>{ce=typeof ce=="object"&&ce||A$1;const{css:de,...Ie}=ce,fe={};for(const ye in ne)if(delete Ie[ye],ye in ce){let ve=ce[ye];typeof ve=="object"&&ve?fe[ye]={"@initial":ne[ye],...ve}:(ve=String(ve),fe[ye]=ve!=="undefined"||ie.has(ye)?ve:ne[ye])}else fe[ye]=ne[ye];const be=new Set([...te]);for(const[ye,ve,Be,Re]of Z.composers){_.rules.styled.cache.has(ye)||(_.rules.styled.cache.add(ye),$$2(ve,[`.${ye}`],[],X,Ze=>{se.styled.apply(Ze)}));const Ve=O$1(Be,fe,X.media),Ee=O$1(Re,fe,X.media,!0);for(const Ze of Ve)if(Ze!==void 0)for(const[_e,Fe,Te]of Ze){const ke=`${ye}-${z$1(Fe)}-${_e}`;be.add(ke);const Le=(Te?_.rules.resonevar:_.rules.onevar).cache,Ke=Te?se.resonevar:se.onevar;Le.has(ke)||(Le.add(ke),$$2(Fe,[`.${ke}`],[],X,Ue=>{Ke.apply(Ue)}))}for(const Ze of Ee)if(Ze!==void 0)for(const[_e,Fe]of Ze){const Te=`${ye}-${z$1(Fe)}-${_e}`;be.add(Te),_.rules.allvar.cache.has(Te)||(_.rules.allvar.cache.add(Te),$$2(Fe,[`.${Te}`],[],X,ke=>{se.allvar.apply(ke)}))}}if(typeof de=="object"&&de){const ye=`${K}-i${z$1(de)}-css`;be.add(ye),_.rules.inline.cache.has(ye)||(_.rules.inline.cache.add(ye),$$2(de,[`.${ye}`],[],X,ve=>{se.inline.apply(ve)}))}for(const ye of String(ce.className||"").trim().split(/\s+/))ye&&be.add(ye);const Ae=Ie.className=[...be].join(" ");return{type:Z.type,className:Ae,selector:ae,props:Ie,toString:()=>Ae,deferredInjector:oe}};return s$5(ge,{className:K,selector:ae,[l$3]:Z,toString:()=>(_.rules.styled.cache.has(K)||ge(),K)})},L$3=X=>{let Z="";const _=[],K={},te=[];for(const[ne,,,,ie,oe]of X){Z===""&&(Z=ne),_.push(ne),te.push(...oe);for(const se in ie){const ae=ie[se];(K[se]===void 0||ae!=="undefined"||oe.includes(ae))&&(K[se]=ae)}}return[Z,_,K,new Set(te)]},O$1=(X,Z,_,K)=>{const te=[];e:for(let[ne,ie,oe]of X){if(oe)continue;let se,ae=0,ge=!1;for(se in ne){const ce=ne[se];let de=Z[se];if(de!==ce){if(typeof de!="object"||!de)continue e;{let Ie,fe,be=0;for(const Ae in de){if(ce===String(de[Ae])){if(Ae!=="@initial"){const ye=Ae.slice(1);(fe=fe||[]).push(ye in _?_[ye]:Ae.replace(/^@media ?/,"")),ge=!0}ae+=be,Ie=!0}++be}if(fe&&fe.length&&(ie={["@media "+fe.join(", ")]:ie}),!Ie)continue e}}}(te[ae]=te[ae]||[]).push([K?"cv":`${se}-${ne[se]}`,ie,ge])}return te},A$1={},N$2=o$3(),D$2=(X,Z)=>N$2(X,()=>(..._)=>{const K=()=>{for(let te of _){te=typeof te=="object"&&te||{};let ne=z$1(te);if(!Z.rules.global.cache.has(ne)){if(Z.rules.global.cache.add(ne),"@import"in te){let ie=[].indexOf.call(Z.sheet.cssRules,Z.rules.themed.group)-1;for(let oe of[].concat(te["@import"]))oe=oe.includes('"')||oe.includes("'")?oe:`"${oe}"`,Z.sheet.insertRule(`@import ${oe};`,ie++);delete te["@import"]}$$2(te,[],[],X,ie=>{Z.rules.global.apply(ie)})}}return""};return s$5(K,{toString:K})}),H$2=o$3(),V$1=(X,Z)=>H$2(X,()=>_=>{const K=`${S$3(X.prefix)}k-${z$1(_)}`,te=()=>{if(!Z.rules.global.cache.has(K)){Z.rules.global.cache.add(K);const ne=[];$$2(_,[],[],X,oe=>ne.push(oe));const ie=`@keyframes ${K}{${ne.join("")}}`;Z.rules.global.apply(ie)}return K};return s$5(te,{get name(){return te()},toString:te})}),G=class{constructor(X,Z,_,K){this.token=X==null?"":String(X),this.value=Z==null?"":String(Z),this.scale=_==null?"":String(_),this.prefix=K==null?"":String(K)}get computedValue(){return"var("+this.variable+")"}get variable(){return"--"+S$3(this.prefix)+S$3(this.scale)+this.token}toString(){return this.computedValue}},F$1=o$3(),J$1=(X,Z)=>F$1(X,()=>(_,K)=>{K=typeof _=="object"&&_||Object(K);const te=`.${_=(_=typeof _=="string"?_:"")||`${S$3(X.prefix)}t-${z$1(K)}`}`,ne={},ie=[];for(const se in K){ne[se]={};for(const ae in K[se]){const ge=`--${S$3(X.prefix)}${se}-${ae}`,ce=k$3(String(K[se][ae]),X.prefix,se);ne[se][ae]=new G(ae,ce,se,X.prefix),ie.push(`${ge}:${ce}`)}}const oe=()=>{if(ie.length&&!Z.rules.themed.cache.has(_)){Z.rules.themed.cache.add(_);const se=`${K===X.theme?":root,":""}.${_}{${ie.join(";")}}`;Z.rules.themed.apply(se)}return _};return{...ne,get className(){return oe()},selector:te,toString:oe}}),U$1=o$3(),Y$1=o$3(),q$3=X=>{const Z=(_=>{let K=!1;const te=U$1(_,ne=>{K=!0;const ie="prefix"in(ne=typeof ne=="object"&&ne||{})?String(ne.prefix):"",oe=typeof ne.media=="object"&&ne.media||{},se=typeof ne.root=="object"?ne.root||null:globalThis.document||null,ae=typeof ne.theme=="object"&&ne.theme||{},ge={prefix:ie,media:oe,theme:ae,themeMap:typeof ne.themeMap=="object"&&ne.themeMap||{...n$3},utils:typeof ne.utils=="object"&&ne.utils||{}},ce=E$1(se),de={css:M$1(ge,ce),globalCss:D$2(ge,ce),keyframes:V$1(ge,ce),createTheme:J$1(ge,ce),reset(){ce.reset(),de.theme.toString()},theme:{},sheet:ce,config:ge,prefix:ie,getCssText:ce.toString,toString:ce.toString};return String(de.theme=de.createTheme(ae)),de});return K||te.reset(),te})(X);return Z.styled=(({config:_,sheet:K})=>Y$1(_,()=>{const te=M$1(_,K);return(...ne)=>{const ie=te(...ne),oe=ie[l$3].type,se=React.forwardRef((ae,ge)=>{const ce=ae&&ae.as||oe,{props:de,deferredInjector:Ie}=ie(ae);return delete de.as,de.ref=ge,Ie?React.createElement(React.Fragment,null,React.createElement(ce,de),React.createElement(Ie,null)):React.createElement(ce,de)});return se.className=ie.className,se.displayName=`Styled.${oe.displayName||oe.name||oe}`,se.selector=ie.selector,se.toString=()=>ie.selector,se[l$3]=ie[l$3],se}}))(Z),Z};function $e42e1063c40fb3ef$export$b9ecd428b558ff10(X,Z,{checkForDefaultPrevented:_=!0}={}){return function(te){if(X==null||X(te),_===!1||!te.defaultPrevented)return Z==null?void 0:Z(te)}}function $c512c27ab02ef895$export$50c7b4e9d9f19c1(X,Z=[]){let _=[];function K(ne,ie){const oe=reactExports.createContext(ie),se=_.length;_=[..._,ie];function ae(ce){const{scope:de,children:Ie,...fe}=ce,be=(de==null?void 0:de[X][se])||oe,Ae=reactExports.useMemo(()=>fe,Object.values(fe));return reactExports.createElement(be.Provider,{value:Ae},Ie)}function ge(ce,de){const Ie=(de==null?void 0:de[X][se])||oe,fe=reactExports.useContext(Ie);if(fe)return fe;if(ie!==void 0)return ie;throw new Error(`\`${ce}\` must be used within \`${ne}\``)}return ae.displayName=ne+"Provider",[ae,ge]}const te=()=>{const ne=_.map(ie=>reactExports.createContext(ie));return function(oe){const se=(oe==null?void 0:oe[X])||ne;return reactExports.useMemo(()=>({[`__scope${X}`]:{...oe,[X]:se}}),[oe,se])}};return te.scopeName=X,[K,$c512c27ab02ef895$var$composeContextScopes(te,...Z)]}function $c512c27ab02ef895$var$composeContextScopes(...X){const Z=X[0];if(X.length===1)return Z;const _=()=>{const K=X.map(te=>({useScope:te(),scopeName:te.scopeName}));return function(ne){const ie=K.reduce((oe,{useScope:se,scopeName:ae})=>{const ce=se(ne)[`__scope${ae}`];return{...oe,...ce}},{});return reactExports.useMemo(()=>({[`__scope${Z.scopeName}`]:ie}),[ie])}};return _.scopeName=Z.scopeName,_}function $b1b2314f5f9a1d84$export$25bec8c6f54ee79a(X){const Z=reactExports.useRef(X);return reactExports.useEffect(()=>{Z.current=X}),reactExports.useMemo(()=>(..._)=>{var K;return(K=Z.current)===null||K===void 0?void 0:K.call(Z,..._)},[])}function $addc16e1bbe58fd0$export$3a72a57244d6e765(X,Z=globalThis==null?void 0:globalThis.document){const _=$b1b2314f5f9a1d84$export$25bec8c6f54ee79a(X);reactExports.useEffect(()=>{const K=te=>{te.key==="Escape"&&_(te)};return Z.addEventListener("keydown",K),()=>Z.removeEventListener("keydown",K)},[_,Z])}const $5cb92bef7577960e$var$CONTEXT_UPDATE="dismissableLayer.update",$5cb92bef7577960e$var$POINTER_DOWN_OUTSIDE="dismissableLayer.pointerDownOutside",$5cb92bef7577960e$var$FOCUS_OUTSIDE="dismissableLayer.focusOutside";let $5cb92bef7577960e$var$originalBodyPointerEvents;const $5cb92bef7577960e$var$DismissableLayerContext=reactExports.createContext({layers:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set}),$5cb92bef7577960e$export$177fb62ff3ec1f22=reactExports.forwardRef((X,Z)=>{var _;const{disableOutsidePointerEvents:K=!1,onEscapeKeyDown:te,onPointerDownOutside:ne,onFocusOutside:ie,onInteractOutside:oe,onDismiss:se,...ae}=X,ge=reactExports.useContext($5cb92bef7577960e$var$DismissableLayerContext),[ce,de]=reactExports.useState(null),Ie=(_=ce==null?void 0:ce.ownerDocument)!==null&&_!==void 0?_:globalThis==null?void 0:globalThis.document,[,fe]=reactExports.useState({}),be=$6ed0406888f73fc4$export$c7b2cbe3552a0d05(Z,_e=>de(_e)),Ae=Array.from(ge.layers),[ye]=[...ge.layersWithOutsidePointerEventsDisabled].slice(-1),ve=Ae.indexOf(ye),Be=ce?Ae.indexOf(ce):-1,Re=ge.layersWithOutsidePointerEventsDisabled.size>0,Ve=Be>=ve,Ee=$5cb92bef7577960e$var$usePointerDownOutside(_e=>{const Fe=_e.target,Te=[...ge.branches].some(ke=>ke.contains(Fe));!Ve||Te||(ne==null||ne(_e),oe==null||oe(_e),_e.defaultPrevented||se==null||se())},Ie),Ze=$5cb92bef7577960e$var$useFocusOutside(_e=>{const Fe=_e.target;[...ge.branches].some(ke=>ke.contains(Fe))||(ie==null||ie(_e),oe==null||oe(_e),_e.defaultPrevented||se==null||se())},Ie);return $addc16e1bbe58fd0$export$3a72a57244d6e765(_e=>{Be===ge.layers.size-1&&(te==null||te(_e),!_e.defaultPrevented&&se&&(_e.preventDefault(),se()))},Ie),reactExports.useEffect(()=>{if(ce)return K&&(ge.layersWithOutsidePointerEventsDisabled.size===0&&($5cb92bef7577960e$var$originalBodyPointerEvents=Ie.body.style.pointerEvents,Ie.body.style.pointerEvents="none"),ge.layersWithOutsidePointerEventsDisabled.add(ce)),ge.layers.add(ce),$5cb92bef7577960e$var$dispatchUpdate(),()=>{K&&ge.layersWithOutsidePointerEventsDisabled.size===1&&(Ie.body.style.pointerEvents=$5cb92bef7577960e$var$originalBodyPointerEvents)}},[ce,Ie,K,ge]),reactExports.useEffect(()=>()=>{ce&&(ge.layers.delete(ce),ge.layersWithOutsidePointerEventsDisabled.delete(ce),$5cb92bef7577960e$var$dispatchUpdate())},[ce,ge]),reactExports.useEffect(()=>{const _e=()=>fe({});return document.addEventListener($5cb92bef7577960e$var$CONTEXT_UPDATE,_e),()=>document.removeEventListener($5cb92bef7577960e$var$CONTEXT_UPDATE,_e)},[]),reactExports.createElement($8927f6f2acc4f386$export$250ffa63cdc0d034.div,_extends$2({},ae,{ref:be,style:{pointerEvents:Re?Ve?"auto":"none":void 0,...X.style},onFocusCapture:$e42e1063c40fb3ef$export$b9ecd428b558ff10(X.onFocusCapture,Ze.onFocusCapture),onBlurCapture:$e42e1063c40fb3ef$export$b9ecd428b558ff10(X.onBlurCapture,Ze.onBlurCapture),onPointerDownCapture:$e42e1063c40fb3ef$export$b9ecd428b558ff10(X.onPointerDownCapture,Ee.onPointerDownCapture)}))});function $5cb92bef7577960e$var$usePointerDownOutside(X,Z=globalThis==null?void 0:globalThis.document){const _=$b1b2314f5f9a1d84$export$25bec8c6f54ee79a(X),K=reactExports.useRef(!1),te=reactExports.useRef(()=>{});return reactExports.useEffect(()=>{const ne=oe=>{if(oe.target&&!K.current){let ge=function(){$5cb92bef7577960e$var$handleAndDispatchCustomEvent($5cb92bef7577960e$var$POINTER_DOWN_OUTSIDE,_,ae,{discrete:!0})};var se=ge;const ae={originalEvent:oe};oe.pointerType==="touch"?(Z.removeEventListener("click",te.current),te.current=ge,Z.addEventListener("click",te.current,{once:!0})):ge()}K.current=!1},ie=window.setTimeout(()=>{Z.addEventListener("pointerdown",ne)},0);return()=>{window.clearTimeout(ie),Z.removeEventListener("pointerdown",ne),Z.removeEventListener("click",te.current)}},[Z,_]),{onPointerDownCapture:()=>K.current=!0}}function $5cb92bef7577960e$var$useFocusOutside(X,Z=globalThis==null?void 0:globalThis.document){const _=$b1b2314f5f9a1d84$export$25bec8c6f54ee79a(X),K=reactExports.useRef(!1);return reactExports.useEffect(()=>{const te=ne=>{ne.target&&!K.current&&$5cb92bef7577960e$var$handleAndDispatchCustomEvent($5cb92bef7577960e$var$FOCUS_OUTSIDE,_,{originalEvent:ne},{discrete:!1})};return Z.addEventListener("focusin",te),()=>Z.removeEventListener("focusin",te)},[Z,_]),{onFocusCapture:()=>K.current=!0,onBlurCapture:()=>K.current=!1}}function $5cb92bef7577960e$var$dispatchUpdate(){const X=new CustomEvent($5cb92bef7577960e$var$CONTEXT_UPDATE);document.dispatchEvent(X)}function $5cb92bef7577960e$var$handleAndDispatchCustomEvent(X,Z,_,{discrete:K}){const te=_.originalEvent.target,ne=new CustomEvent(X,{bubbles:!1,cancelable:!0,detail:_});Z&&te.addEventListener(X,Z,{once:!0}),K?$8927f6f2acc4f386$export$6d1a0317bde7de7f(te,ne):te.dispatchEvent(ne)}const $9f79659886946c16$export$e5c5a5f917a5871c=globalThis!=null&&globalThis.document?reactExports.useLayoutEffect:()=>{},$1746a345f3d73bb7$var$useReactId=$2AODx$react.useId||(()=>{});let $1746a345f3d73bb7$var$count=0;function $1746a345f3d73bb7$export$f680877a34711e37(X){const[Z,_]=reactExports.useState($1746a345f3d73bb7$var$useReactId());return $9f79659886946c16$export$e5c5a5f917a5871c(()=>{_(K=>K??String($1746a345f3d73bb7$var$count++))},[X]),Z?`radix-${Z}`:""}function t$1(X){return X.split("-")[0]}function e$2(X){return X.split("-")[1]}function n$2(X){return["top","bottom"].includes(t$1(X))?"x":"y"}function r$3(X){return X==="y"?"height":"width"}function i$3(X,Z,_){let{reference:K,floating:te}=X;const ne=K.x+K.width/2-te.width/2,ie=K.y+K.height/2-te.height/2,oe=n$2(Z),se=r$3(oe),ae=K[se]/2-te[se]/2,ge=oe==="x";let ce;switch(t$1(Z)){case"top":ce={x:ne,y:K.y-te.height};break;case"bottom":ce={x:ne,y:K.y+K.height};break;case"right":ce={x:K.x+K.width,y:ie};break;case"left":ce={x:K.x-te.width,y:ie};break;default:ce={x:K.x,y:K.y}}switch(e$2(Z)){case"start":ce[oe]-=ae*(_&&ge?-1:1);break;case"end":ce[oe]+=ae*(_&&ge?-1:1)}return ce}const o$2=async(X,Z,_)=>{const{placement:K="bottom",strategy:te="absolute",middleware:ne=[],platform:ie}=_,oe=await(ie.isRTL==null?void 0:ie.isRTL(Z));let se=await ie.getElementRects({reference:X,floating:Z,strategy:te}),{x:ae,y:ge}=i$3(se,K,oe),ce=K,de={},Ie=0;for(let fe=0;fe<ne.length;fe++){const{name:be,fn:Ae}=ne[fe],{x:ye,y:ve,data:Be,reset:Re}=await Ae({x:ae,y:ge,initialPlacement:K,placement:ce,strategy:te,middlewareData:de,rects:se,platform:ie,elements:{reference:X,floating:Z}});ae=ye??ae,ge=ve??ge,de={...de,[be]:{...de[be],...Be}},Re&&Ie<=50&&(Ie++,typeof Re=="object"&&(Re.placement&&(ce=Re.placement),Re.rects&&(se=Re.rects===!0?await ie.getElementRects({reference:X,floating:Z,strategy:te}):Re.rects),{x:ae,y:ge}=i$3(se,ce,oe)),fe=-1)}return{x:ae,y:ge,placement:ce,strategy:te,middlewareData:de}};function a$4(X){return typeof X!="number"?function(Z){return{top:0,right:0,bottom:0,left:0,...Z}}(X):{top:X,right:X,bottom:X,left:X}}function l$2(X){return{...X,top:X.y,left:X.x,right:X.x+X.width,bottom:X.y+X.height}}async function s$4(X,Z){var _;Z===void 0&&(Z={});const{x:K,y:te,platform:ne,rects:ie,elements:oe,strategy:se}=X,{boundary:ae="clippingAncestors",rootBoundary:ge="viewport",elementContext:ce="floating",altBoundary:de=!1,padding:Ie=0}=Z,fe=a$4(Ie),be=oe[de?ce==="floating"?"reference":"floating":ce],Ae=l$2(await ne.getClippingRect({element:(_=await(ne.isElement==null?void 0:ne.isElement(be)))==null||_?be:be.contextElement||await(ne.getDocumentElement==null?void 0:ne.getDocumentElement(oe.floating)),boundary:ae,rootBoundary:ge,strategy:se})),ye=l$2(ne.convertOffsetParentRelativeRectToViewportRelativeRect?await ne.convertOffsetParentRelativeRectToViewportRelativeRect({rect:ce==="floating"?{...ie.floating,x:K,y:te}:ie.reference,offsetParent:await(ne.getOffsetParent==null?void 0:ne.getOffsetParent(oe.floating)),strategy:se}):ie[ce]);return{top:Ae.top-ye.top+fe.top,bottom:ye.bottom-Ae.bottom+fe.bottom,left:Ae.left-ye.left+fe.left,right:ye.right-Ae.right+fe.right}}const c$5=Math.min,f$3=Math.max;function u$3(X,Z,_){return f$3(X,c$5(Z,_))}const m$4=X=>({name:"arrow",options:X,async fn(Z){const{element:_,padding:K=0}=X??{},{x:te,y:ne,placement:ie,rects:oe,platform:se}=Z;if(_==null)return{};const ae=a$4(K),ge={x:te,y:ne},ce=n$2(ie),de=e$2(ie),Ie=r$3(ce),fe=await se.getDimensions(_),be=ce==="y"?"top":"left",Ae=ce==="y"?"bottom":"right",ye=oe.reference[Ie]+oe.reference[ce]-ge[ce]-oe.floating[Ie],ve=ge[ce]-oe.reference[ce],Be=await(se.getOffsetParent==null?void 0:se.getOffsetParent(_));let Re=Be?ce==="y"?Be.clientHeight||0:Be.clientWidth||0:0;Re===0&&(Re=oe.floating[Ie]);const Ve=ye/2-ve/2,Ee=ae[be],Ze=Re-fe[Ie]-ae[Ae],_e=Re/2-fe[Ie]/2+Ve,Fe=u$3(Ee,_e,Ze),Te=(de==="start"?ae[be]:ae[Ae])>0&&_e!==Fe&&oe.reference[Ie]<=oe.floating[Ie];return{[ce]:ge[ce]-(Te?_e<Ee?Ee-_e:Ze-_e:0),data:{[ce]:Fe,centerOffset:_e-Fe}}}}),g$3={left:"right",right:"left",bottom:"top",top:"bottom"};function d$3(X){return X.replace(/left|right|bottom|top/g,Z=>g$3[Z])}function p$3(X,Z,_){_===void 0&&(_=!1);const K=e$2(X),te=n$2(X),ne=r$3(te);let ie=te==="x"?K===(_?"end":"start")?"right":"left":K==="start"?"bottom":"top";return Z.reference[ne]>Z.floating[ne]&&(ie=d$3(ie)),{main:ie,cross:d$3(ie)}}const h$3={start:"end",end:"start"};function y$3(X){return X.replace(/start|end/g,Z=>h$3[Z])}const x$2=["top","right","bottom","left"];x$2.reduce((X,Z)=>X.concat(Z,Z+"-start",Z+"-end"),[]);const b$5=function(X){return X===void 0&&(X={}),{name:"flip",options:X,async fn(Z){var _;const{placement:K,middlewareData:te,rects:ne,initialPlacement:ie,platform:oe,elements:se}=Z,{mainAxis:ae=!0,crossAxis:ge=!0,fallbackPlacements:ce,fallbackStrategy:de="bestFit",flipAlignment:Ie=!0,...fe}=X,be=t$1(K),Ae=ce||(be===ie||!Ie?[d$3(ie)]:function(_e){const Fe=d$3(_e);return[y$3(_e),Fe,y$3(Fe)]}(ie)),ye=[ie,...Ae],ve=await s$4(Z,fe),Be=[];let Re=((_=te.flip)==null?void 0:_.overflows)||[];if(ae&&Be.push(ve[be]),ge){const{main:_e,cross:Fe}=p$3(K,ne,await(oe.isRTL==null?void 0:oe.isRTL(se.floating)));Be.push(ve[_e],ve[Fe])}if(Re=[...Re,{placement:K,overflows:Be}],!Be.every(_e=>_e<=0)){var Ve,Ee;const _e=((Ve=(Ee=te.flip)==null?void 0:Ee.index)!=null?Ve:0)+1,Fe=ye[_e];if(Fe)return{data:{index:_e,overflows:Re},reset:{placement:Fe}};let Te="bottom";switch(de){case"bestFit":{var Ze;const ke=(Ze=Re.map(Le=>[Le,Le.overflows.filter(Ke=>Ke>0).reduce((Ke,Ue)=>Ke+Ue,0)]).sort((Le,Ke)=>Le[1]-Ke[1])[0])==null?void 0:Ze[0].placement;ke&&(Te=ke);break}case"initialPlacement":Te=ie}if(K!==Te)return{reset:{placement:Te}}}return{}}}};function R$2(X,Z){return{top:X.top-Z.height,right:X.right-Z.width,bottom:X.bottom-Z.height,left:X.left-Z.width}}function A(X){return x$2.some(Z=>X[Z]>=0)}const P=function(X){let{strategy:Z="referenceHidden",..._}=X===void 0?{}:X;return{name:"hide",async fn(K){const{rects:te}=K;switch(Z){case"referenceHidden":{const ne=R$2(await s$4(K,{..._,elementContext:"reference"}),te.reference);return{data:{referenceHiddenOffsets:ne,referenceHidden:A(ne)}}}case"escaped":{const ne=R$2(await s$4(K,{..._,altBoundary:!0}),te.floating);return{data:{escapedOffsets:ne,escaped:A(ne)}}}default:return{}}}}},T$2=function(X){return X===void 0&&(X=0),{name:"offset",options:X,async fn(Z){const{x:_,y:K}=Z,te=await async function(ne,ie){const{placement:oe,platform:se,elements:ae}=ne,ge=await(se.isRTL==null?void 0:se.isRTL(ae.floating)),ce=t$1(oe),de=e$2(oe),Ie=n$2(oe)==="x",fe=["left","top"].includes(ce)?-1:1,be=ge&&Ie?-1:1,Ae=typeof ie=="function"?ie(ne):ie;let{mainAxis:ye,crossAxis:ve,alignmentAxis:Be}=typeof Ae=="number"?{mainAxis:Ae,crossAxis:0,alignmentAxis:null}:{mainAxis:0,crossAxis:0,alignmentAxis:null,...Ae};return de&&typeof Be=="number"&&(ve=de==="end"?-1*Be:Be),Ie?{x:ve*be,y:ye*fe}:{x:ye*fe,y:ve*be}}(Z,X);return{x:_+te.x,y:K+te.y,data:te}}}};function O(X){return X==="x"?"y":"x"}const D$1=function(X){return X===void 0&&(X={}),{name:"shift",options:X,async fn(Z){const{x:_,y:K,placement:te}=Z,{mainAxis:ne=!0,crossAxis:ie=!1,limiter:oe={fn:Ae=>{let{x:ye,y:ve}=Ae;return{x:ye,y:ve}}},...se}=X,ae={x:_,y:K},ge=await s$4(Z,se),ce=n$2(t$1(te)),de=O(ce);let Ie=ae[ce],fe=ae[de];if(ne){const Ae=ce==="y"?"bottom":"right";Ie=u$3(Ie+ge[ce==="y"?"top":"left"],Ie,Ie-ge[Ae])}if(ie){const Ae=de==="y"?"bottom":"right";fe=u$3(fe+ge[de==="y"?"top":"left"],fe,fe-ge[Ae])}const be=oe.fn({...Z,[ce]:Ie,[de]:fe});return{...be,data:{x:be.x-_,y:be.y-K}}}}},L$2=function(X){return X===void 0&&(X={}),{options:X,fn(Z){const{x:_,y:K,placement:te,rects:ne,middlewareData:ie}=Z,{offset:oe=0,mainAxis:se=!0,crossAxis:ae=!0}=X,ge={x:_,y:K},ce=n$2(te),de=O(ce);let Ie=ge[ce],fe=ge[de];const be=typeof oe=="function"?oe({...ne,placement:te}):oe,Ae=typeof be=="number"?{mainAxis:be,crossAxis:0}:{mainAxis:0,crossAxis:0,...be};if(se){const Ve=ce==="y"?"height":"width",Ee=ne.reference[ce]-ne.floating[Ve]+Ae.mainAxis,Ze=ne.reference[ce]+ne.reference[Ve]-Ae.mainAxis;Ie<Ee?Ie=Ee:Ie>Ze&&(Ie=Ze)}if(ae){var ye,ve,Be,Re;const Ve=ce==="y"?"width":"height",Ee=["top","left"].includes(t$1(te)),Ze=ne.reference[de]-ne.floating[Ve]+(Ee&&(ye=(ve=ie.offset)==null?void 0:ve[de])!=null?ye:0)+(Ee?0:Ae.crossAxis),_e=ne.reference[de]+ne.reference[Ve]+(Ee?0:(Be=(Re=ie.offset)==null?void 0:Re[de])!=null?Be:0)-(Ee?Ae.crossAxis:0);fe<Ze?fe=Ze:fe>_e&&(fe=_e)}return{[ce]:Ie,[de]:fe}}}},k$2=function(X){return X===void 0&&(X={}),{name:"size",options:X,async fn(Z){const{placement:_,rects:K,platform:te,elements:ne}=Z,{apply:ie,...oe}=X,se=await s$4(Z,oe),ae=t$1(_),ge=e$2(_);let ce,de;ae==="top"||ae==="bottom"?(ce=ae,de=ge===(await(te.isRTL==null?void 0:te.isRTL(ne.floating))?"start":"end")?"left":"right"):(de=ae,ce=ge==="end"?"top":"bottom");const Ie=f$3(se.left,0),fe=f$3(se.right,0),be=f$3(se.top,0),Ae=f$3(se.bottom,0),ye={availableHeight:K.floating.height-(["left","right"].includes(_)?2*(be!==0||Ae!==0?be+Ae:f$3(se.top,se.bottom)):se[ce]),availableWidth:K.floating.width-(["top","bottom"].includes(_)?2*(Ie!==0||fe!==0?Ie+fe:f$3(se.left,se.right)):se[de])},ve=await te.getDimensions(ne.floating);ie==null||ie({...Z,...ye});const Be=await te.getDimensions(ne.floating);return ve.width!==Be.width||ve.height!==Be.height?{reset:{rects:!0}}:{}}}};function n$1(X){return X&&X.document&&X.location&&X.alert&&X.setInterval}function o$1(X){if(X==null)return window;if(!n$1(X)){const Z=X.ownerDocument;return Z&&Z.defaultView||window}return X}function i$2(X){return o$1(X).getComputedStyle(X)}function r$2(X){return n$1(X)?"":X?(X.nodeName||"").toLowerCase():""}function l$1(){const X=navigator.userAgentData;return X!=null&&X.brands?X.brands.map(Z=>Z.brand+"/"+Z.version).join(" "):navigator.userAgent}function c$4(X){return X instanceof o$1(X).HTMLElement}function f$2(X){return X instanceof o$1(X).Element}function s$3(X){return typeof ShadowRoot>"u"?!1:X instanceof o$1(X).ShadowRoot||X instanceof ShadowRoot}function u$2(X){const{overflow:Z,overflowX:_,overflowY:K}=i$2(X);return/auto|scroll|overlay|hidden/.test(Z+K+_)}function d$2(X){return["table","td","th"].includes(r$2(X))}function h$2(X){const Z=/firefox/i.test(l$1()),_=i$2(X);return _.transform!=="none"||_.perspective!=="none"||_.contain==="paint"||["transform","perspective"].includes(_.willChange)||Z&&_.willChange==="filter"||Z&&!!_.filter&&_.filter!=="none"}function a$3(){return!/^((?!chrome|android).)*safari/i.test(l$1())}const g$2=Math.min,p$2=Math.max,m$3=Math.round;function w$1(X,Z,_){var K,te,ne,ie;Z===void 0&&(Z=!1),_===void 0&&(_=!1);const oe=X.getBoundingClientRect();let se=1,ae=1;Z&&c$4(X)&&(se=X.offsetWidth>0&&m$3(oe.width)/X.offsetWidth||1,ae=X.offsetHeight>0&&m$3(oe.height)/X.offsetHeight||1);const ge=f$2(X)?o$1(X):window,ce=!a$3()&&_,de=(oe.left+(ce&&(K=(te=ge.visualViewport)==null?void 0:te.offsetLeft)!=null?K:0))/se,Ie=(oe.top+(ce&&(ne=(ie=ge.visualViewport)==null?void 0:ie.offsetTop)!=null?ne:0))/ae,fe=oe.width/se,be=oe.height/ae;return{width:fe,height:be,top:Ie,right:de+fe,bottom:Ie+be,left:de,x:de,y:Ie}}function v$3(X){return(Z=X,(Z instanceof o$1(Z).Node?X.ownerDocument:X.document)||window.document).documentElement;var Z}function y$2(X){return f$2(X)?{scrollLeft:X.scrollLeft,scrollTop:X.scrollTop}:{scrollLeft:X.pageXOffset,scrollTop:X.pageYOffset}}function x$1(X){return w$1(v$3(X)).left+y$2(X).scrollLeft}function b$4(X,Z,_){const K=c$4(Z),te=v$3(Z),ne=w$1(X,K&&function(se){const ae=w$1(se);return m$3(ae.width)!==se.offsetWidth||m$3(ae.height)!==se.offsetHeight}(Z),_==="fixed");let ie={scrollLeft:0,scrollTop:0};const oe={x:0,y:0};if(K||!K&&_!=="fixed")if((r$2(Z)!=="body"||u$2(te))&&(ie=y$2(Z)),c$4(Z)){const se=w$1(Z,!0);oe.x=se.x+Z.clientLeft,oe.y=se.y+Z.clientTop}else te&&(oe.x=x$1(te));return{x:ne.left+ie.scrollLeft-oe.x,y:ne.top+ie.scrollTop-oe.y,width:ne.width,height:ne.height}}function L$1(X){return r$2(X)==="html"?X:X.assignedSlot||X.parentNode||(s$3(X)?X.host:null)||v$3(X)}function R$1(X){return c$4(X)&&getComputedStyle(X).position!=="fixed"?X.offsetParent:null}function T$1(X){const Z=o$1(X);let _=R$1(X);for(;_&&d$2(_)&&getComputedStyle(_).position==="static";)_=R$1(_);return _&&(r$2(_)==="html"||r$2(_)==="body"&&getComputedStyle(_).position==="static"&&!h$2(_))?Z:_||function(K){let te=L$1(K);for(s$3(te)&&(te=te.host);c$4(te)&&!["html","body"].includes(r$2(te));){if(h$2(te))return te;te=te.parentNode}return null}(X)||Z}function W(X){if(c$4(X))return{width:X.offsetWidth,height:X.offsetHeight};const Z=w$1(X);return{width:Z.width,height:Z.height}}function E(X){const Z=L$1(X);return["html","body","#document"].includes(r$2(Z))?X.ownerDocument.body:c$4(Z)&&u$2(Z)?Z:E(Z)}function H$1(X,Z){var _;Z===void 0&&(Z=[]);const K=E(X),te=K===((_=X.ownerDocument)==null?void 0:_.body),ne=o$1(K),ie=te?[ne].concat(ne.visualViewport||[],u$2(K)?K:[]):K,oe=Z.concat(ie);return te?oe:oe.concat(H$1(ie))}function C(X,Z,_){return Z==="viewport"?l$2(function(K,te){const ne=o$1(K),ie=v$3(K),oe=ne.visualViewport;let se=ie.clientWidth,ae=ie.clientHeight,ge=0,ce=0;if(oe){se=oe.width,ae=oe.height;const de=a$3();(de||!de&&te==="fixed")&&(ge=oe.offsetLeft,ce=oe.offsetTop)}return{width:se,height:ae,x:ge,y:ce}}(X,_)):f$2(Z)?function(K,te){const ne=w$1(K,!1,te==="fixed"),ie=ne.top+K.clientTop,oe=ne.left+K.clientLeft;return{top:ie,left:oe,x:oe,y:ie,right:oe+K.clientWidth,bottom:ie+K.clientHeight,width:K.clientWidth,height:K.clientHeight}}(Z,_):l$2(function(K){var te;const ne=v$3(K),ie=y$2(K),oe=(te=K.ownerDocument)==null?void 0:te.body,se=p$2(ne.scrollWidth,ne.clientWidth,oe?oe.scrollWidth:0,oe?oe.clientWidth:0),ae=p$2(ne.scrollHeight,ne.clientHeight,oe?oe.scrollHeight:0,oe?oe.clientHeight:0);let ge=-ie.scrollLeft+x$1(K);const ce=-ie.scrollTop;return i$2(oe||ne).direction==="rtl"&&(ge+=p$2(ne.clientWidth,oe?oe.clientWidth:0)-se),{width:se,height:ae,x:ge,y:ce}}(v$3(X)))}function S$2(X){const Z=H$1(X),_=["absolute","fixed"].includes(i$2(X).position)&&c$4(X)?T$1(X):X;return f$2(_)?Z.filter(K=>f$2(K)&&function(te,ne){const ie=ne.getRootNode==null?void 0:ne.getRootNode();if(te.contains(ne))return!0;if(ie&&s$3(ie)){let oe=ne;do{if(oe&&te===oe)return!0;oe=oe.parentNode||oe.host}while(oe)}return!1}(K,_)&&r$2(K)!=="body"):[]}const D={getClippingRect:function(X){let{element:Z,boundary:_,rootBoundary:K,strategy:te}=X;const ne=[..._==="clippingAncestors"?S$2(Z):[].concat(_),K],ie=ne[0],oe=ne.reduce((se,ae)=>{const ge=C(Z,ae,te);return se.top=p$2(ge.top,se.top),se.right=g$2(ge.right,se.right),se.bottom=g$2(ge.bottom,se.bottom),se.left=p$2(ge.left,se.left),se},C(Z,ie,te));return{width:oe.right-oe.left,height:oe.bottom-oe.top,x:oe.left,y:oe.top}},convertOffsetParentRelativeRectToViewportRelativeRect:function(X){let{rect:Z,offsetParent:_,strategy:K}=X;const te=c$4(_),ne=v$3(_);if(_===ne)return Z;let ie={scrollLeft:0,scrollTop:0};const oe={x:0,y:0};if((te||!te&&K!=="fixed")&&((r$2(_)!=="body"||u$2(ne))&&(ie=y$2(_)),c$4(_))){const se=w$1(_,!0);oe.x=se.x+_.clientLeft,oe.y=se.y+_.clientTop}return{...Z,x:Z.x-ie.scrollLeft+oe.x,y:Z.y-ie.scrollTop+oe.y}},isElement:f$2,getDimensions:W,getOffsetParent:T$1,getDocumentElement:v$3,getElementRects:X=>{let{reference:Z,floating:_,strategy:K}=X;return{reference:b$4(Z,T$1(_),K),floating:{...W(_),x:0,y:0}}},getClientRects:X=>Array.from(X.getClientRects()),isRTL:X=>i$2(X).direction==="rtl"};function N$1(X,Z,_,K){K===void 0&&(K={});const{ancestorScroll:te=!0,ancestorResize:ne=!0,elementResize:ie=!0,animationFrame:oe=!1}=K,se=te&&!oe,ae=ne&&!oe,ge=se||ae?[...f$2(X)?H$1(X):[],...H$1(Z)]:[];ge.forEach(fe=>{se&&fe.addEventListener("scroll",_,{passive:!0}),ae&&fe.addEventListener("resize",_)});let ce,de=null;if(ie){let fe=!0;de=new ResizeObserver(()=>{fe||_(),fe=!1}),f$2(X)&&!oe&&de.observe(X),de.observe(Z)}let Ie=oe?w$1(X):null;return oe&&function fe(){const be=w$1(X);!Ie||be.x===Ie.x&&be.y===Ie.y&&be.width===Ie.width&&be.height===Ie.height||_(),Ie=be,ce=requestAnimationFrame(fe)}(),_(),()=>{var fe;ge.forEach(be=>{se&&be.removeEventListener("scroll",_),ae&&be.removeEventListener("resize",_)}),(fe=de)==null||fe.disconnect(),de=null,oe&&cancelAnimationFrame(ce)}}const z=(X,Z,_)=>o$2(X,Z,{platform:D,..._});var index=typeof document<"u"?reactExports.useLayoutEffect:reactExports.useEffect;function deepEqual(X,Z){if(X===Z)return!0;if(typeof X!=typeof Z)return!1;if(typeof X=="function"&&X.toString()===Z.toString())return!0;let _,K,te;if(X&&Z&&typeof X=="object"){if(Array.isArray(X)){if(_=X.length,_!=Z.length)return!1;for(K=_;K--!==0;)if(!deepEqual(X[K],Z[K]))return!1;return!0}if(te=Object.keys(X),_=te.length,_!==Object.keys(Z).length)return!1;for(K=_;K--!==0;)if(!Object.prototype.hasOwnProperty.call(Z,te[K]))return!1;for(K=_;K--!==0;){const ne=te[K];if(!(ne==="_owner"&&X.$$typeof)&&!deepEqual(X[ne],Z[ne]))return!1}return!0}return X!==X&&Z!==Z}function useLatestRef(X){const Z=reactExports.useRef(X);return index(()=>{Z.current=X}),Z}function useFloating(X){let{middleware:Z,placement:_="bottom",strategy:K="absolute",whileElementsMounted:te}=X===void 0?{}:X;const ne=reactExports.useRef(null),ie=reactExports.useRef(null),oe=useLatestRef(te),se=reactExports.useRef(null),[ae,ge]=reactExports.useState({x:null,y:null,strategy:K,placement:_,middlewareData:{}}),[ce,de]=reactExports.useState(Z);deepEqual(ce==null?void 0:ce.map(Be=>{let{options:Re}=Be;return Re}),Z==null?void 0:Z.map(Be=>{let{options:Re}=Be;return Re}))||de(Z);const Ie=reactExports.useCallback(()=>{!ne.current||!ie.current||z(ne.current,ie.current,{middleware:ce,placement:_,strategy:K}).then(Be=>{fe.current&&reactDomExports.flushSync(()=>{ge(Be)})})},[ce,_,K]);index(()=>{fe.current&&Ie()},[Ie]);const fe=reactExports.useRef(!1);index(()=>(fe.current=!0,()=>{fe.current=!1}),[]);const be=reactExports.useCallback(()=>{if(typeof se.current=="function"&&(se.current(),se.current=null),ne.current&&ie.current)if(oe.current){const Be=oe.current(ne.current,ie.current,Ie);se.current=Be}else Ie()},[Ie,oe]),Ae=reactExports.useCallback(Be=>{ne.current=Be,be()},[be]),ye=reactExports.useCallback(Be=>{ie.current=Be,be()},[be]),ve=reactExports.useMemo(()=>({reference:ne,floating:ie}),[]);return reactExports.useMemo(()=>({...ae,update:Ie,refs:ve,reference:Ae,floating:ye}),[ae,Ie,ve,Ae,ye])}const arrow=X=>{const{element:Z,padding:_}=X;function K(te){return Object.prototype.hasOwnProperty.call(te,"current")}return{name:"arrow",options:X,fn(te){return K(Z)?Z.current!=null?m$4({element:Z.current,padding:_}).fn(te):{}:Z?m$4({element:Z,padding:_}).fn(te):{}}}},$7e8f5cd07187803e$export$21b07c8f274aebd5=reactExports.forwardRef((X,Z)=>{const{children:_,width:K=10,height:te=5,...ne}=X;return reactExports.createElement($8927f6f2acc4f386$export$250ffa63cdc0d034.svg,_extends$2({},ne,{ref:Z,width:K,height:te,viewBox:"0 0 30 10",preserveAspectRatio:"none"}),X.asChild?_:reactExports.createElement("polygon",{points:"0,0 30,0 15,10"}))}),$7e8f5cd07187803e$export$be92b6f5f03c0fe9=$7e8f5cd07187803e$export$21b07c8f274aebd5;function $db6c3485150b8e66$export$1ab7ae714698c4b8(X){const[Z,_]=reactExports.useState(void 0);return $9f79659886946c16$export$e5c5a5f917a5871c(()=>{if(X){_({width:X.offsetWidth,height:X.offsetHeight});const K=new ResizeObserver(te=>{if(!Array.isArray(te)||!te.length)return;const ne=te[0];let ie,oe;if("borderBoxSize"in ne){const se=ne.borderBoxSize,ae=Array.isArray(se)?se[0]:se;ie=ae.inlineSize,oe=ae.blockSize}else ie=X.offsetWidth,oe=X.offsetHeight;_({width:ie,height:oe})});return K.observe(X,{box:"border-box"}),()=>K.unobserve(X)}else _(void 0)},[X]),Z}const $cf1ac5d9fe0e8206$var$POPPER_NAME="Popper",[$cf1ac5d9fe0e8206$var$createPopperContext,$cf1ac5d9fe0e8206$export$722aac194ae923]=$c512c27ab02ef895$export$50c7b4e9d9f19c1($cf1ac5d9fe0e8206$var$POPPER_NAME),[$cf1ac5d9fe0e8206$var$PopperProvider,$cf1ac5d9fe0e8206$var$usePopperContext]=$cf1ac5d9fe0e8206$var$createPopperContext($cf1ac5d9fe0e8206$var$POPPER_NAME),$cf1ac5d9fe0e8206$export$badac9ada3a0bdf9=X=>{const{__scopePopper:Z,children:_}=X,[K,te]=reactExports.useState(null);return reactExports.createElement($cf1ac5d9fe0e8206$var$PopperProvider,{scope:Z,anchor:K,onAnchorChange:te},_)},$cf1ac5d9fe0e8206$var$ANCHOR_NAME="PopperAnchor",$cf1ac5d9fe0e8206$export$ecd4e1ccab6ed6d=reactExports.forwardRef((X,Z)=>{const{__scopePopper:_,virtualRef:K,...te}=X,ne=$cf1ac5d9fe0e8206$var$usePopperContext($cf1ac5d9fe0e8206$var$ANCHOR_NAME,_),ie=reactExports.useRef(null),oe=$6ed0406888f73fc4$export$c7b2cbe3552a0d05(Z,ie);return reactExports.useEffect(()=>{ne.onAnchorChange((K==null?void 0:K.current)||ie.current)}),K?null:reactExports.createElement($8927f6f2acc4f386$export$250ffa63cdc0d034.div,_extends$2({},te,{ref:oe}))}),$cf1ac5d9fe0e8206$var$CONTENT_NAME="PopperContent",[$cf1ac5d9fe0e8206$var$PopperContentProvider,$cf1ac5d9fe0e8206$var$useContentContext]=$cf1ac5d9fe0e8206$var$createPopperContext($cf1ac5d9fe0e8206$var$CONTENT_NAME),[$cf1ac5d9fe0e8206$var$PositionContextProvider,$cf1ac5d9fe0e8206$var$usePositionContext]=$cf1ac5d9fe0e8206$var$createPopperContext($cf1ac5d9fe0e8206$var$CONTENT_NAME,{hasParent:!1,positionUpdateFns:new Set}),$cf1ac5d9fe0e8206$export$bc4ae5855d3c4fc=reactExports.forwardRef((X,Z)=>{var _,K,te,ne,ie,oe,se,ae;const{__scopePopper:ge,side:ce="bottom",sideOffset:de=0,align:Ie="center",alignOffset:fe=0,arrowPadding:be=0,collisionBoundary:Ae=[],collisionPadding:ye=0,sticky:ve="partial",hideWhenDetached:Be=!1,avoidCollisions:Re=!0,onPlaced:Ve,...Ee}=X,Ze=$cf1ac5d9fe0e8206$var$usePopperContext($cf1ac5d9fe0e8206$var$CONTENT_NAME,ge),[_e,Fe]=reactExports.useState(null),Te=$6ed0406888f73fc4$export$c7b2cbe3552a0d05(Z,Oe=>Fe(Oe)),[ke,Le]=reactExports.useState(null),Ke=$db6c3485150b8e66$export$1ab7ae714698c4b8(ke),Ue=(_=Ke==null?void 0:Ke.width)!==null&&_!==void 0?_:0,rt=(K=Ke==null?void 0:Ke.height)!==null&&K!==void 0?K:0,tt=ce+(Ie!=="center"?"-"+Ie:""),at=typeof ye=="number"?ye:{top:0,right:0,bottom:0,left:0,...ye},ze=Array.isArray(Ae)?Ae:[Ae],qe=ze.length>0,Pe={padding:at,boundary:ze.filter($cf1ac5d9fe0e8206$var$isNotNull),altBoundary:qe},{reference:Ye,floating:$e,strategy:ut,x:ot,y:gt,placement:ht,middlewareData:dt,update:bt}=useFloating({strategy:"fixed",placement:tt,whileElementsMounted:N$1,middleware:[$cf1ac5d9fe0e8206$var$anchorCssProperties(),T$2({mainAxis:de+rt,alignmentAxis:fe}),Re?D$1({mainAxis:!0,crossAxis:!1,limiter:ve==="partial"?L$2():void 0,...Pe}):void 0,ke?arrow({element:ke,padding:be}):void 0,Re?b$5({...Pe}):void 0,k$2({...Pe,apply:({elements:Oe,availableWidth:lt,availableHeight:ft})=>{Oe.floating.style.setProperty("--radix-popper-available-width",`${lt}px`),Oe.floating.style.setProperty("--radix-popper-available-height",`${ft}px`)}}),$cf1ac5d9fe0e8206$var$transformOrigin({arrowWidth:Ue,arrowHeight:rt}),Be?P({strategy:"referenceHidden"}):void 0].filter($cf1ac5d9fe0e8206$var$isDefined)});$9f79659886946c16$export$e5c5a5f917a5871c(()=>{Ye(Ze.anchor)},[Ye,Ze.anchor]);const Ht=ot!==null&&gt!==null,[Dt,Vt]=$cf1ac5d9fe0e8206$var$getSideAndAlignFromPlacement(ht),mt=$b1b2314f5f9a1d84$export$25bec8c6f54ee79a(Ve);$9f79659886946c16$export$e5c5a5f917a5871c(()=>{Ht&&(mt==null||mt())},[Ht,mt]);const Ft=(te=dt.arrow)===null||te===void 0?void 0:te.x,it=(ne=dt.arrow)===null||ne===void 0?void 0:ne.y,Lt=((ie=dt.arrow)===null||ie===void 0?void 0:ie.centerOffset)!==0,[Et,Ut]=reactExports.useState();$9f79659886946c16$export$e5c5a5f917a5871c(()=>{_e&&Ut(window.getComputedStyle(_e).zIndex)},[_e]);const{hasParent:Zt,positionUpdateFns:Ot}=$cf1ac5d9fe0e8206$var$usePositionContext($cf1ac5d9fe0e8206$var$CONTENT_NAME,ge),Tt=!Zt;reactExports.useLayoutEffect(()=>{if(!Tt)return Ot.add(bt),()=>{Ot.delete(bt)}},[Tt,Ot,bt]),$9f79659886946c16$export$e5c5a5f917a5871c(()=>{Tt&&Ht&&Array.from(Ot).reverse().forEach(Oe=>requestAnimationFrame(Oe))},[Tt,Ht,Ot]);const Je={"data-side":Dt,"data-align":Vt,...Ee,ref:Te,style:{...Ee.style,animation:Ht?void 0:"none",opacity:(oe=dt.hide)!==null&&oe!==void 0&&oe.referenceHidden?0:void 0}};return reactExports.createElement("div",{ref:$e,"data-radix-popper-content-wrapper":"",style:{position:ut,left:0,top:0,transform:Ht?`translate3d(${Math.round(ot)}px, ${Math.round(gt)}px, 0)`:"translate3d(0, -200%, 0)",minWidth:"max-content",zIndex:Et,"--radix-popper-transform-origin":[(se=dt.transformOrigin)===null||se===void 0?void 0:se.x,(ae=dt.transformOrigin)===null||ae===void 0?void 0:ae.y].join(" ")},dir:X.dir},reactExports.createElement($cf1ac5d9fe0e8206$var$PopperContentProvider,{scope:ge,placedSide:Dt,onArrowChange:Le,arrowX:Ft,arrowY:it,shouldHideArrow:Lt},Tt?reactExports.createElement($cf1ac5d9fe0e8206$var$PositionContextProvider,{scope:ge,hasParent:!0,positionUpdateFns:Ot},reactExports.createElement($8927f6f2acc4f386$export$250ffa63cdc0d034.div,Je)):reactExports.createElement($8927f6f2acc4f386$export$250ffa63cdc0d034.div,Je)))}),$cf1ac5d9fe0e8206$var$ARROW_NAME="PopperArrow",$cf1ac5d9fe0e8206$var$OPPOSITE_SIDE={top:"bottom",right:"left",bottom:"top",left:"right"},$cf1ac5d9fe0e8206$export$79d62cd4e10a3fd0=reactExports.forwardRef(function(Z,_){const{__scopePopper:K,...te}=Z,ne=$cf1ac5d9fe0e8206$var$useContentContext($cf1ac5d9fe0e8206$var$ARROW_NAME,K),ie=$cf1ac5d9fe0e8206$var$OPPOSITE_SIDE[ne.placedSide];return reactExports.createElement("span",{ref:ne.onArrowChange,style:{position:"absolute",left:ne.arrowX,top:ne.arrowY,[ie]:0,transformOrigin:{top:"",right:"0 0",bottom:"center 0",left:"100% 0"}[ne.placedSide],transform:{top:"translateY(100%)",right:"translateY(50%) rotate(90deg) translateX(-50%)",bottom:"rotate(180deg)",left:"translateY(50%) rotate(-90deg) translateX(50%)"}[ne.placedSide],visibility:ne.shouldHideArrow?"hidden":void 0}},reactExports.createElement($7e8f5cd07187803e$export$be92b6f5f03c0fe9,_extends$2({},te,{ref:_,style:{...te.style,display:"block"}})))});function $cf1ac5d9fe0e8206$var$isDefined(X){return X!==void 0}function $cf1ac5d9fe0e8206$var$isNotNull(X){return X!==null}const $cf1ac5d9fe0e8206$var$anchorCssProperties=()=>({name:"anchorCssProperties",fn(X){const{rects:Z,elements:_}=X,{width:K,height:te}=Z.reference;return _.floating.style.setProperty("--radix-popper-anchor-width",`${K}px`),_.floating.style.setProperty("--radix-popper-anchor-height",`${te}px`),{}}}),$cf1ac5d9fe0e8206$var$transformOrigin=X=>({name:"transformOrigin",options:X,fn(Z){var _,K,te,ne,ie;const{placement:oe,rects:se,middlewareData:ae}=Z,ce=((_=ae.arrow)===null||_===void 0?void 0:_.centerOffset)!==0,de=ce?0:X.arrowWidth,Ie=ce?0:X.arrowHeight,[fe,be]=$cf1ac5d9fe0e8206$var$getSideAndAlignFromPlacement(oe),Ae={start:"0%",center:"50%",end:"100%"}[be],ye=((K=(te=ae.arrow)===null||te===void 0?void 0:te.x)!==null&&K!==void 0?K:0)+de/2,ve=((ne=(ie=ae.arrow)===null||ie===void 0?void 0:ie.y)!==null&&ne!==void 0?ne:0)+Ie/2;let Be="",Re="";return fe==="bottom"?(Be=ce?Ae:`${ye}px`,Re=`${-Ie}px`):fe==="top"?(Be=ce?Ae:`${ye}px`,Re=`${se.floating.height+Ie}px`):fe==="right"?(Be=`${-Ie}px`,Re=ce?Ae:`${ve}px`):fe==="left"&&(Be=`${se.floating.width+Ie}px`,Re=ce?Ae:`${ve}px`),{data:{x:Be,y:Re}}}});function $cf1ac5d9fe0e8206$var$getSideAndAlignFromPlacement(X){const[Z,_="center"]=X.split("-");return[Z,_]}const $cf1ac5d9fe0e8206$export$be92b6f5f03c0fe9=$cf1ac5d9fe0e8206$export$badac9ada3a0bdf9,$cf1ac5d9fe0e8206$export$b688253958b8dfe7=$cf1ac5d9fe0e8206$export$ecd4e1ccab6ed6d,$cf1ac5d9fe0e8206$export$7c6e2c02157bb7d2=$cf1ac5d9fe0e8206$export$bc4ae5855d3c4fc,$cf1ac5d9fe0e8206$export$21b07c8f274aebd5=$cf1ac5d9fe0e8206$export$79d62cd4e10a3fd0;function $fe963b355347cc68$export$3e6543de14f8614f(X,Z){return reactExports.useReducer((_,K)=>{const te=Z[_][K];return te??_},X)}const $921a889cee6df7e8$export$99c2b779aa4e8b8b=X=>{const{present:Z,children:_}=X,K=$921a889cee6df7e8$var$usePresence(Z),te=typeof _=="function"?_({present:K.isPresent}):reactExports.Children.only(_),ne=$6ed0406888f73fc4$export$c7b2cbe3552a0d05(K.ref,te.ref);return typeof _=="function"||K.isPresent?reactExports.cloneElement(te,{ref:ne}):null};$921a889cee6df7e8$export$99c2b779aa4e8b8b.displayName="Presence";function $921a889cee6df7e8$var$usePresence(X){const[Z,_]=reactExports.useState(),K=reactExports.useRef({}),te=reactExports.useRef(X),ne=reactExports.useRef("none"),ie=X?"mounted":"unmounted",[oe,se]=$fe963b355347cc68$export$3e6543de14f8614f(ie,{mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}});return reactExports.useEffect(()=>{const ae=$921a889cee6df7e8$var$getAnimationName(K.current);ne.current=oe==="mounted"?ae:"none"},[oe]),$9f79659886946c16$export$e5c5a5f917a5871c(()=>{const ae=K.current,ge=te.current;if(ge!==X){const de=ne.current,Ie=$921a889cee6df7e8$var$getAnimationName(ae);X?se("MOUNT"):Ie==="none"||(ae==null?void 0:ae.display)==="none"?se("UNMOUNT"):se(ge&&de!==Ie?"ANIMATION_OUT":"UNMOUNT"),te.current=X}},[X,se]),$9f79659886946c16$export$e5c5a5f917a5871c(()=>{if(Z){const ae=ce=>{const Ie=$921a889cee6df7e8$var$getAnimationName(K.current).includes(ce.animationName);ce.target===Z&&Ie&&reactDomExports.flushSync(()=>se("ANIMATION_END"))},ge=ce=>{ce.target===Z&&(ne.current=$921a889cee6df7e8$var$getAnimationName(K.current))};return Z.addEventListener("animationstart",ge),Z.addEventListener("animationcancel",ae),Z.addEventListener("animationend",ae),()=>{Z.removeEventListener("animationstart",ge),Z.removeEventListener("animationcancel",ae),Z.removeEventListener("animationend",ae)}}else se("ANIMATION_END")},[Z,se]),{isPresent:["mounted","unmountSuspended"].includes(oe),ref:reactExports.useCallback(ae=>{ae&&(K.current=getComputedStyle(ae)),_(ae)},[])}}function $921a889cee6df7e8$var$getAnimationName(X){return(X==null?void 0:X.animationName)||"none"}function $71cd76cc60e0454e$export$6f32135080cb4c3({prop:X,defaultProp:Z,onChange:_=()=>{}}){const[K,te]=$71cd76cc60e0454e$var$useUncontrolledState({defaultProp:Z,onChange:_}),ne=X!==void 0,ie=ne?X:K,oe=$b1b2314f5f9a1d84$export$25bec8c6f54ee79a(_),se=reactExports.useCallback(ae=>{if(ne){const ce=typeof ae=="function"?ae(X):ae;ce!==X&&oe(ce)}else te(ae)},[ne,X,te,oe]);return[ie,se]}function $71cd76cc60e0454e$var$useUncontrolledState({defaultProp:X,onChange:Z}){const _=reactExports.useState(X),[K]=_,te=reactExports.useRef(K),ne=$b1b2314f5f9a1d84$export$25bec8c6f54ee79a(Z);return reactExports.useEffect(()=>{te.current!==K&&(ne(K),te.current=K)},[K,te,ne]),_}const $ea1ef594cf570d83$export$439d29a4e110a164=reactExports.forwardRef((X,Z)=>reactExports.createElement($8927f6f2acc4f386$export$250ffa63cdc0d034.span,_extends$2({},X,{ref:Z,style:{position:"absolute",border:0,width:1,height:1,padding:0,margin:-1,overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",wordWrap:"normal",...X.style}}))),$ea1ef594cf570d83$export$be92b6f5f03c0fe9=$ea1ef594cf570d83$export$439d29a4e110a164,[$a093c7e1ec25a057$var$createTooltipContext,$a093c7e1ec25a057$export$1c540a2224f0d865]=$c512c27ab02ef895$export$50c7b4e9d9f19c1("Tooltip",[$cf1ac5d9fe0e8206$export$722aac194ae923]),$a093c7e1ec25a057$var$usePopperScope=$cf1ac5d9fe0e8206$export$722aac194ae923(),$a093c7e1ec25a057$var$PROVIDER_NAME="TooltipProvider",$a093c7e1ec25a057$var$TOOLTIP_OPEN="tooltip.open",[$a093c7e1ec25a057$var$TooltipProviderContextProvider,$a093c7e1ec25a057$var$useTooltipProviderContext]=$a093c7e1ec25a057$var$createTooltipContext($a093c7e1ec25a057$var$PROVIDER_NAME),$a093c7e1ec25a057$var$TOOLTIP_NAME="Tooltip",[$a093c7e1ec25a057$var$TooltipContextProvider,$a093c7e1ec25a057$var$useTooltipContext]=$a093c7e1ec25a057$var$createTooltipContext($a093c7e1ec25a057$var$TOOLTIP_NAME),$a093c7e1ec25a057$export$28c660c63b792dea=X=>{const{__scopeTooltip:Z,children:_,open:K,defaultOpen:te=!1,onOpenChange:ne,disableHoverableContent:ie,delayDuration:oe}=X,se=$a093c7e1ec25a057$var$useTooltipProviderContext($a093c7e1ec25a057$var$TOOLTIP_NAME,X.__scopeTooltip),ae=$a093c7e1ec25a057$var$usePopperScope(Z),[ge,ce]=reactExports.useState(null),de=$1746a345f3d73bb7$export$f680877a34711e37(),Ie=reactExports.useRef(0),fe=ie??se.disableHoverableContent,be=oe??se.delayDuration,Ae=reactExports.useRef(!1),[ye=!1,ve]=$71cd76cc60e0454e$export$6f32135080cb4c3({prop:K,defaultProp:te,onChange:Ze=>{Ze?(se.onOpen(),document.dispatchEvent(new CustomEvent($a093c7e1ec25a057$var$TOOLTIP_OPEN))):se.onClose(),ne==null||ne(Ze)}}),Be=reactExports.useMemo(()=>ye?Ae.current?"delayed-open":"instant-open":"closed",[ye]),Re=reactExports.useCallback(()=>{window.clearTimeout(Ie.current),Ae.current=!1,ve(!0)},[ve]),Ve=reactExports.useCallback(()=>{window.clearTimeout(Ie.current),ve(!1)},[ve]),Ee=reactExports.useCallback(()=>{window.clearTimeout(Ie.current),Ie.current=window.setTimeout(()=>{Ae.current=!0,ve(!0)},be)},[be,ve]);return reactExports.useEffect(()=>()=>window.clearTimeout(Ie.current),[]),reactExports.createElement($cf1ac5d9fe0e8206$export$be92b6f5f03c0fe9,ae,reactExports.createElement($a093c7e1ec25a057$var$TooltipContextProvider,{scope:Z,contentId:de,open:ye,stateAttribute:Be,trigger:ge,onTriggerChange:ce,onTriggerEnter:reactExports.useCallback(()=>{se.isOpenDelayed?Ee():Re()},[se.isOpenDelayed,Ee,Re]),onTriggerLeave:reactExports.useCallback(()=>{fe?Ve():window.clearTimeout(Ie.current)},[Ve,fe]),onOpen:Re,onClose:Ve,disableHoverableContent:fe},_))},$a093c7e1ec25a057$var$TRIGGER_NAME="TooltipTrigger",$a093c7e1ec25a057$export$8c610744efcf8a1d=reactExports.forwardRef((X,Z)=>{const{__scopeTooltip:_,...K}=X,te=$a093c7e1ec25a057$var$useTooltipContext($a093c7e1ec25a057$var$TRIGGER_NAME,_),ne=$a093c7e1ec25a057$var$useTooltipProviderContext($a093c7e1ec25a057$var$TRIGGER_NAME,_),ie=$a093c7e1ec25a057$var$usePopperScope(_),oe=reactExports.useRef(null),se=$6ed0406888f73fc4$export$c7b2cbe3552a0d05(Z,oe,te.onTriggerChange),ae=reactExports.useRef(!1),ge=reactExports.useRef(!1),ce=reactExports.useCallback(()=>ae.current=!1,[]);return reactExports.useEffect(()=>()=>document.removeEventListener("pointerup",ce),[ce]),reactExports.createElement($cf1ac5d9fe0e8206$export$b688253958b8dfe7,_extends$2({asChild:!0},ie),reactExports.createElement($8927f6f2acc4f386$export$250ffa63cdc0d034.button,_extends$2({"aria-describedby":te.open?te.contentId:void 0,"data-state":te.stateAttribute},K,{ref:se,onPointerMove:$e42e1063c40fb3ef$export$b9ecd428b558ff10(X.onPointerMove,de=>{de.pointerType!=="touch"&&!ge.current&&!ne.isPointerInTransitRef.current&&(te.onTriggerEnter(),ge.current=!0)}),onPointerLeave:$e42e1063c40fb3ef$export$b9ecd428b558ff10(X.onPointerLeave,()=>{te.onTriggerLeave(),ge.current=!1}),onPointerDown:$e42e1063c40fb3ef$export$b9ecd428b558ff10(X.onPointerDown,()=>{ae.current=!0,document.addEventListener("pointerup",ce,{once:!0})}),onFocus:$e42e1063c40fb3ef$export$b9ecd428b558ff10(X.onFocus,()=>{ae.current||te.onOpen()}),onBlur:$e42e1063c40fb3ef$export$b9ecd428b558ff10(X.onBlur,te.onClose),onClick:$e42e1063c40fb3ef$export$b9ecd428b558ff10(X.onClick,te.onClose)})))}),$a093c7e1ec25a057$var$PORTAL_NAME="TooltipPortal",[$a093c7e1ec25a057$var$PortalProvider,$a093c7e1ec25a057$var$usePortalContext]=$a093c7e1ec25a057$var$createTooltipContext($a093c7e1ec25a057$var$PORTAL_NAME,{forceMount:void 0}),$a093c7e1ec25a057$var$CONTENT_NAME="TooltipContent",$a093c7e1ec25a057$export$e9003e2be37ec060=reactExports.forwardRef((X,Z)=>{const _=$a093c7e1ec25a057$var$usePortalContext($a093c7e1ec25a057$var$CONTENT_NAME,X.__scopeTooltip),{forceMount:K=_.forceMount,side:te="top",...ne}=X,ie=$a093c7e1ec25a057$var$useTooltipContext($a093c7e1ec25a057$var$CONTENT_NAME,X.__scopeTooltip);return reactExports.createElement($921a889cee6df7e8$export$99c2b779aa4e8b8b,{present:K||ie.open},ie.disableHoverableContent?reactExports.createElement($a093c7e1ec25a057$var$TooltipContentImpl,_extends$2({side:te},ne,{ref:Z})):reactExports.createElement($a093c7e1ec25a057$var$TooltipContentHoverable,_extends$2({side:te},ne,{ref:Z})))}),$a093c7e1ec25a057$var$TooltipContentHoverable=reactExports.forwardRef((X,Z)=>{const _=$a093c7e1ec25a057$var$useTooltipContext($a093c7e1ec25a057$var$CONTENT_NAME,X.__scopeTooltip),K=$a093c7e1ec25a057$var$useTooltipProviderContext($a093c7e1ec25a057$var$CONTENT_NAME,X.__scopeTooltip),te=reactExports.useRef(null),ne=$6ed0406888f73fc4$export$c7b2cbe3552a0d05(Z,te),[ie,oe]=reactExports.useState(null),{trigger:se,onClose:ae}=_,ge=te.current,{onPointerInTransitChange:ce}=K,de=reactExports.useCallback(()=>{oe(null),ce(!1)},[ce]),Ie=reactExports.useCallback((fe,be)=>{const Ae=fe.currentTarget,ye={x:fe.clientX,y:fe.clientY},ve=$a093c7e1ec25a057$var$getExitSideFromRect(ye,Ae.getBoundingClientRect()),Be=ve==="right"||ve==="bottom"?-5:5,Ve=ve==="right"||ve==="left"?{x:fe.clientX+Be,y:fe.clientY}:{x:fe.clientX,y:fe.clientY+Be},Ee=$a093c7e1ec25a057$var$getPointsFromRect(be.getBoundingClientRect()),Ze=$a093c7e1ec25a057$var$getHull([Ve,...Ee]);oe(Ze),ce(!0)},[ce]);return reactExports.useEffect(()=>()=>de(),[de]),reactExports.useEffect(()=>{if(se&&ge){const fe=Ae=>Ie(Ae,ge),be=Ae=>Ie(Ae,se);return se.addEventListener("pointerleave",fe),ge.addEventListener("pointerleave",be),()=>{se.removeEventListener("pointerleave",fe),ge.removeEventListener("pointerleave",be)}}},[se,ge,Ie,de]),reactExports.useEffect(()=>{if(ie){const fe=be=>{const Ae=be.target,ye={x:be.clientX,y:be.clientY},ve=(se==null?void 0:se.contains(Ae))||(ge==null?void 0:ge.contains(Ae)),Be=!$a093c7e1ec25a057$var$isPointInPolygon(ye,ie);ve?de():Be&&(de(),ae())};return document.addEventListener("pointermove",fe),()=>document.removeEventListener("pointermove",fe)}},[se,ge,ie,ae,de]),reactExports.createElement($a093c7e1ec25a057$var$TooltipContentImpl,_extends$2({},X,{ref:ne}))}),[$a093c7e1ec25a057$var$VisuallyHiddenContentContextProvider,$a093c7e1ec25a057$var$useVisuallyHiddenContentContext]=$a093c7e1ec25a057$var$createTooltipContext($a093c7e1ec25a057$var$TOOLTIP_NAME,{isInside:!1}),$a093c7e1ec25a057$var$TooltipContentImpl=reactExports.forwardRef((X,Z)=>{const{__scopeTooltip:_,children:K,"aria-label":te,onEscapeKeyDown:ne,onPointerDownOutside:ie,...oe}=X,se=$a093c7e1ec25a057$var$useTooltipContext($a093c7e1ec25a057$var$CONTENT_NAME,_),ae=$a093c7e1ec25a057$var$usePopperScope(_),{onClose:ge}=se;return reactExports.useEffect(()=>(document.addEventListener($a093c7e1ec25a057$var$TOOLTIP_OPEN,ge),()=>document.removeEventListener($a093c7e1ec25a057$var$TOOLTIP_OPEN,ge)),[ge]),reactExports.useEffect(()=>{if(se.trigger){const ce=de=>{const Ie=de.target;Ie!=null&&Ie.contains(se.trigger)&&ge()};return window.addEventListener("scroll",ce,{capture:!0}),()=>window.removeEventListener("scroll",ce,{capture:!0})}},[se.trigger,ge]),reactExports.createElement($5cb92bef7577960e$export$177fb62ff3ec1f22,{asChild:!0,disableOutsidePointerEvents:!1,onEscapeKeyDown:ne,onPointerDownOutside:ie,onFocusOutside:ce=>ce.preventDefault(),onDismiss:ge},reactExports.createElement($cf1ac5d9fe0e8206$export$7c6e2c02157bb7d2,_extends$2({"data-state":se.stateAttribute},ae,oe,{ref:Z,style:{...oe.style,"--radix-tooltip-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-tooltip-content-available-width":"var(--radix-popper-available-width)","--radix-tooltip-content-available-height":"var(--radix-popper-available-height)","--radix-tooltip-trigger-width":"var(--radix-popper-anchor-width)","--radix-tooltip-trigger-height":"var(--radix-popper-anchor-height)"}}),reactExports.createElement($5e63c961fc1ce211$export$d9f1ccf0bdb05d45,null,K),reactExports.createElement($a093c7e1ec25a057$var$VisuallyHiddenContentContextProvider,{scope:_,isInside:!0},reactExports.createElement($ea1ef594cf570d83$export$be92b6f5f03c0fe9,{id:se.contentId,role:"tooltip"},te||K))))}),$a093c7e1ec25a057$var$ARROW_NAME="TooltipArrow",$a093c7e1ec25a057$export$c27ee0ad710f7559=reactExports.forwardRef((X,Z)=>{const{__scopeTooltip:_,...K}=X,te=$a093c7e1ec25a057$var$usePopperScope(_);return $a093c7e1ec25a057$var$useVisuallyHiddenContentContext($a093c7e1ec25a057$var$ARROW_NAME,_).isInside?null:reactExports.createElement($cf1ac5d9fe0e8206$export$21b07c8f274aebd5,_extends$2({},te,K,{ref:Z}))});function $a093c7e1ec25a057$var$getExitSideFromRect(X,Z){const _=Math.abs(Z.top-X.y),K=Math.abs(Z.bottom-X.y),te=Math.abs(Z.right-X.x),ne=Math.abs(Z.left-X.x);switch(Math.min(_,K,te,ne)){case ne:return"left";case te:return"right";case _:return"top";case K:return"bottom";default:return null}}function $a093c7e1ec25a057$var$getPointsFromRect(X){const{top:Z,right:_,bottom:K,left:te}=X;return[{x:te,y:Z},{x:_,y:Z},{x:_,y:K},{x:te,y:K}]}function $a093c7e1ec25a057$var$isPointInPolygon(X,Z){const{x:_,y:K}=X;let te=!1;for(let ne=0,ie=Z.length-1;ne<Z.length;ie=ne++){const oe=Z[ne].x,se=Z[ne].y,ae=Z[ie].x,ge=Z[ie].y;se>K!=ge>K&&_<(ae-oe)*(K-se)/(ge-se)+oe&&(te=!te)}return te}function $a093c7e1ec25a057$var$getHull(X){const Z=X.slice();return Z.sort((_,K)=>_.x<K.x?-1:_.x>K.x?1:_.y<K.y?-1:_.y>K.y?1:0),$a093c7e1ec25a057$var$getHullPresorted(Z)}function $a093c7e1ec25a057$var$getHullPresorted(X){if(X.length<=1)return X.slice();const Z=[];for(let K=0;K<X.length;K++){const te=X[K];for(;Z.length>=2;){const ne=Z[Z.length-1],ie=Z[Z.length-2];if((ne.x-ie.x)*(te.y-ie.y)>=(ne.y-ie.y)*(te.x-ie.x))Z.pop();else break}Z.push(te)}Z.pop();const _=[];for(let K=X.length-1;K>=0;K--){const te=X[K];for(;_.length>=2;){const ne=_[_.length-1],ie=_[_.length-2];if((ne.x-ie.x)*(te.y-ie.y)>=(ne.y-ie.y)*(te.x-ie.x))_.pop();else break}_.push(te)}return _.pop(),Z.length===1&&_.length===1&&Z[0].x===_[0].x&&Z[0].y===_[0].y?Z:Z.concat(_)}const $a093c7e1ec25a057$export$be92b6f5f03c0fe9=$a093c7e1ec25a057$export$28c660c63b792dea,$a093c7e1ec25a057$export$41fb9f06171c75f4=$a093c7e1ec25a057$export$8c610744efcf8a1d,$a093c7e1ec25a057$export$7c6e2c02157bb7d2=$a093c7e1ec25a057$export$e9003e2be37ec060,$a093c7e1ec25a057$export$21b07c8f274aebd5=$a093c7e1ec25a057$export$c27ee0ad710f7559;function _objectWithoutPropertiesLoose$2(X,Z){if(X==null)return{};var _={},K=Object.keys(X),te,ne;for(ne=0;ne<K.length;ne++)te=K[ne],!(Z.indexOf(te)>=0)&&(_[te]=X[te]);return _}function _objectWithoutProperties$2(X,Z){if(X==null)return{};var _=_objectWithoutPropertiesLoose$2(X,Z),K,te;if(Object.getOwnPropertySymbols){var ne=Object.getOwnPropertySymbols(X);for(te=0;te<ne.length;te++)K=ne[te],!(Z.indexOf(K)>=0)&&Object.prototype.propertyIsEnumerable.call(X,K)&&(_[K]=X[K])}return _}let LevaErrors;(function(X){X[X.UNSUPPORTED_INPUT=0]="UNSUPPORTED_INPUT",X[X.NO_COMPONENT_FOR_TYPE=1]="NO_COMPONENT_FOR_TYPE",X[X.UNKNOWN_INPUT=2]="UNKNOWN_INPUT",X[X.DUPLICATE_KEYS=3]="DUPLICATE_KEYS",X[X.ALREADY_REGISTERED_TYPE=4]="ALREADY_REGISTERED_TYPE",X[X.CLIPBOARD_ERROR=5]="CLIPBOARD_ERROR",X[X.THEME_ERROR=6]="THEME_ERROR",X[X.PATH_DOESNT_EXIST=7]="PATH_DOESNT_EXIST",X[X.INPUT_TYPE_OVERRIDE=8]="INPUT_TYPE_OVERRIDE",X[X.EMPTY_KEY=9]="EMPTY_KEY"})(LevaErrors||(LevaErrors={}));const ErrorList={[LevaErrors.UNSUPPORTED_INPUT]:(X,Z)=>[`An input with type \`${X}\` input was found at path \`${Z}\` but it's not supported yet.`],[LevaErrors.NO_COMPONENT_FOR_TYPE]:(X,Z)=>[`Type \`${X}\` found at path \`${Z}\` can't be displayed in panel because no component supports it yet.`],[LevaErrors.UNKNOWN_INPUT]:(X,Z)=>[`input at path \`${X}\` is not recognized.`,Z],[LevaErrors.DUPLICATE_KEYS]:(X,Z,_)=>[`Key \`${X}\` of path \`${Z}\` already exists at path \`${_}\`. Even nested keys need to be unique. Rename one of the keys.`],[LevaErrors.ALREADY_REGISTERED_TYPE]:X=>[`Type ${X} has already been registered. You can't register a component with the same type.`],[LevaErrors.CLIPBOARD_ERROR]:X=>["Error copying the value",X],[LevaErrors.THEME_ERROR]:(X,Z)=>[`Error accessing the theme \`${X}.${Z}\` value.`],[LevaErrors.PATH_DOESNT_EXIST]:X=>[`Error getting the value at path \`${X}\`. There is probably an error in your \`render\` function.`],[LevaErrors.PATH_DOESNT_EXIST]:X=>[`Error accessing the value at path \`${X}\``],[LevaErrors.INPUT_TYPE_OVERRIDE]:(X,Z,_)=>[`Input at path \`${X}\` already exists with type: \`${Z}\`. Its type cannot be overridden with type \`${_}\`.`],[LevaErrors.EMPTY_KEY]:()=>["Keys can not be empty, if you want to hide a label use whitespace."]};function _log(X,Z,..._){const[K,...te]=ErrorList[Z](..._);console[X]("LEVA: "+K,...te)}const warn=_log.bind(null,"warn"),log$1=_log.bind(null,"log"),_excluded$a=["value"],_excluded2$4=["schema"],_excluded3$1=["value"],Schemas=[],Plugins={};function getValueType(X){let{value:Z}=X,_=_objectWithoutProperties$2(X,_excluded$a);for(let K of Schemas){const te=K(Z,_);if(te)return te}}function register(X,Z){let{schema:_}=Z,K=_objectWithoutProperties$2(Z,_excluded2$4);if(X in Plugins){warn(LevaErrors.ALREADY_REGISTERED_TYPE,X);return}Schemas.push((te,ne)=>_(te,ne)&&X),Plugins[X]=K}function createInternalPlugin(X){return X}function normalize$3$1(X,Z,_,K){const{normalize:te}=Plugins[X];if(te)return te(Z,_,K);if(typeof Z!="object"||!("value"in Z))return{value:Z};const{value:ne}=Z,ie=_objectWithoutProperties$2(Z,_excluded3$1);return{value:ne,settings:ie}}function sanitize$4(X,Z,_,K,te,ne){const{sanitize:ie}=Plugins[X];return ie?ie(Z,_,K,te,ne):Z}function format$2(X,Z,_){const{format:K}=Plugins[X];return K?K(Z,_):Z}function _defineProperty$3(X,Z,_){return Z in X?Object.defineProperty(X,Z,{value:_,enumerable:!0,configurable:!0,writable:!0}):X[Z]=_,X}function ownKeys$3(X,Z){var _=Object.keys(X);if(Object.getOwnPropertySymbols){var K=Object.getOwnPropertySymbols(X);Z&&(K=K.filter(function(te){return Object.getOwnPropertyDescriptor(X,te).enumerable})),_.push.apply(_,K)}return _}function _objectSpread2(X){for(var Z=1;Z<arguments.length;Z++){var _=arguments[Z]!=null?arguments[Z]:{};Z%2?ownKeys$3(Object(_),!0).forEach(function(K){_defineProperty$3(X,K,_[K])}):Object.getOwnPropertyDescriptors?Object.defineProperties(X,Object.getOwnPropertyDescriptors(_)):ownKeys$3(Object(_)).forEach(function(K){Object.defineProperty(X,K,Object.getOwnPropertyDescriptor(_,K))})}return X}const clamp=(X,Z,_)=>X>_?_:X<Z?Z:X,parseNumber=X=>{if(X===""||typeof X=="number")return X;try{const Z=evaluate(X);if(!isNaN(Z))return Z}catch{}return parseFloat(X)},log10=Math.log(10);function getStep(X){let Z=Math.abs(+String(X).replace(".",""));if(Z===0)return .01;for(;Z!==0&&Z%10===0;)Z/=10;const _=Math.floor(Math.log(Z)/log10)+1,K=Math.floor(Math.log10(Math.abs(X))),te=Math.pow(10,K-_);return Math.max(te,.001)}const range=(X,Z,_)=>_===Z?0:(clamp(X,Z,_)-Z)/(_-Z),invertedRange=(X,Z,_)=>X*(_-Z)+Z,getUid=()=>"_"+Math.random().toString(36).substr(2,9),parens=/\(([0-9+\-*/^ .]+)\)/,exp=/(\d+(?:\.\d+)?) ?\^ ?(\d+(?:\.\d+)?)/,mul=/(\d+(?:\.\d+)?) ?\* ?(\d+(?:\.\d+)?)/,div=/(\d+(?:\.\d+)?) ?\/ ?(\d+(?:\.\d+)?)/,add=/(\d+(?:\.\d+)?) ?\+ ?(\d+(?:\.\d+)?)/,sub=/(\d+(?:\.\d+)?) ?- ?(\d+(?:\.\d+)?)/;function evaluate(X){if(isNaN(Number(X)))if(parens.test(X)){const Z=X.replace(parens,(_,K)=>String(evaluate(K)));return evaluate(Z)}else if(exp.test(X)){const Z=X.replace(exp,(_,K,te)=>String(Math.pow(Number(K),Number(te))));return evaluate(Z)}else if(mul.test(X)){const Z=X.replace(mul,(_,K,te)=>String(Number(K)*Number(te)));return evaluate(Z)}else if(div.test(X)){const Z=X.replace(div,(_,K,te)=>{if(te!=0)return String(Number(K)/Number(te));throw new Error("Division by zero")});return evaluate(Z)}else if(add.test(X)){const Z=X.replace(add,(_,K,te)=>String(Number(K)+Number(te)));return evaluate(Z)}else if(sub.test(X)){const Z=X.replace(sub,(_,K,te)=>String(Number(K)-Number(te)));return evaluate(Z)}else return Number(X);return Number(X)}function pick(X,Z){return Z.reduce((_,K)=>(X&&X.hasOwnProperty(K)&&(_[K]=X[K]),_),{})}function omit(X,Z){const _=_objectSpread2({},X);return Z.forEach(K=>K in X&&delete _[K]),_}function mapArrayToKeys(X,Z){return X.reduce((_,K,te)=>Object.assign(_,{[Z[te]]:K}),{})}function isObject$1(X){return Object.prototype.toString.call(X)==="[object Object]"}const isEmptyObject=X=>isObject$1(X)&&Object.keys(X).length===0;let SpecialInputs;(function(X){X.BUTTON="BUTTON",X.BUTTON_GROUP="BUTTON_GROUP",X.MONITOR="MONITOR",X.FOLDER="FOLDER"})(SpecialInputs||(SpecialInputs={}));let LevaInputs;(function(X){X.SELECT="SELECT",X.IMAGE="IMAGE",X.NUMBER="NUMBER",X.COLOR="COLOR",X.STRING="STRING",X.BOOLEAN="BOOLEAN",X.INTERVAL="INTERVAL",X.VECTOR3D="VECTOR3D",X.VECTOR2D="VECTOR2D"})(LevaInputs||(LevaInputs={}));const _excluded$9=["type","__customInput"],_excluded2$3=["render","label","optional","order","disabled","hint","onChange","onEditStart","onEditEnd","transient"],_excluded3$2=["type"];function parseOptions(X,Z,_={},K){var te,ne;if(typeof X!="object"||Array.isArray(X))return{type:K,input:X,options:_objectSpread2({key:Z,label:Z,optional:!1,disabled:!1,order:0},_)};if("__customInput"in X){const{type:Ve,__customInput:Ee}=X,Ze=_objectWithoutProperties$2(X,_excluded$9);return parseOptions(Ee,Z,Ze,Ve)}const{render:ie,label:oe,optional:se,order:ae=0,disabled:ge,hint:ce,onChange:de,onEditStart:Ie,onEditEnd:fe,transient:be}=X,Ae=_objectWithoutProperties$2(X,_excluded2$3),ye=_objectSpread2({render:ie,key:Z,label:oe??Z,hint:ce,transient:be??!!de,onEditStart:Ie,onEditEnd:fe,disabled:ge,optional:se,order:ae},_);let{type:ve}=Ae,Be=_objectWithoutProperties$2(Ae,_excluded3$2);if(ve=K??ve,ve in SpecialInputs)return{type:ve,input:Be,options:ye};let Re;return K&&isObject$1(Be)&&"value"in Be?Re=Be.value:Re=isEmptyObject(Be)?void 0:Be,{type:ve,input:Re,options:_objectSpread2(_objectSpread2({},ye),{},{onChange:de,optional:(te=ye.optional)!==null&&te!==void 0?te:!1,disabled:(ne=ye.disabled)!==null&&ne!==void 0?ne:!1})}}function normalizeInput(X,Z,_,K){const te=parseOptions(X,Z),{type:ne,input:ie,options:oe}=te;if(ne)return ne in SpecialInputs?te:{type:ne,input:normalize$3$1(ne,ie,_,K),options:oe};let se=getValueType(ie);return se?{type:se,input:normalize$3$1(se,ie,_,K),options:oe}:(se=getValueType({value:ie}),se?{type:se,input:normalize$3$1(se,{value:ie},_,K),options:oe}:!1)}function updateInput(X,Z,_,K,te){const{value:ne,type:ie,settings:oe}=X;X.value=sanitizeValue({type:ie,value:ne,settings:oe},Z,_,K),X.fromPanel=te}const ValueError=function(Z,_,K){this.type="LEVA_ERROR",this.message="LEVA: "+Z,this.previousValue=_,this.error=K};function sanitizeValue({type:X,value:Z,settings:_},K,te,ne){const ie=X!=="SELECT"&&typeof K=="function"?K(Z):K;let oe;try{oe=sanitize$4(X,ie,_,Z,te,ne)}catch(se){throw new ValueError(`The value \`${K}\` did not result in a correct value.`,Z,se)}return dequal(oe,Z)?Z:oe}const debounce=(X,Z,_=!1)=>{let K=0;return function(){const te=arguments,ne=_&&!K,ie=()=>X.apply(this,te);window.clearTimeout(K),K=window.setTimeout(ie,Z),ne&&ie()}},multiplyStep=X=>X.shiftKey?5:X.altKey?1/5:1,_excluded$8$1=["value"],_excluded2$2$1=["min","max"],schema$3=X=>{if(typeof X=="number")return!0;if(typeof X=="string"){const Z=parseFloat(X);return isNaN(Z)?!1:X.substring((""+Z).length).trim().length<4}return!1},sanitize$3=(X,{min:Z=-1/0,max:_=1/0,suffix:K})=>{const te=parseFloat(X);if(X===""||isNaN(te))throw Error("Invalid number");const ne=clamp(te,Z,_);return K?ne+K:ne},format$1$1=(X,{pad:Z=0,suffix:_})=>{const K=parseFloat(X).toFixed(Z);return _?K+_:K},normalize$2$1=X=>{let{value:Z}=X,_=_objectWithoutProperties$2(X,_excluded$8$1);const{min:K=-1/0,max:te=1/0}=_,ne=_objectWithoutProperties$2(_,_excluded2$2$1);let ie=parseFloat(Z);const oe=typeof Z=="string"?Z.substring((""+ie).length):void 0;ie=clamp(ie,K,te);let se=_.step;se||(Number.isFinite(K)?Number.isFinite(te)?se=+(Math.abs(te-K)/100).toPrecision(1):se=+(Math.abs(ie-K)/100).toPrecision(1):Number.isFinite(te)&&(se=+(Math.abs(te-ie)/100).toPrecision(1)));const ae=se?getStep(se)*10:getStep(ie);se=se||ae/10;const ge=Math.round(clamp(Math.log10(1/ae),0,2));return{value:oe?ie+oe:ie,settings:_objectSpread2({initialValue:ie,step:se,pad:ge,min:K,max:te,suffix:oe},ne)}},sanitizeStep$1=(X,{step:Z,initialValue:_})=>{const K=Math.round((X-_)/Z);return _+K*Z};var props$3=Object.freeze({__proto__:null,schema:schema$3,sanitize:sanitize$3,format:format$1$1,normalize:normalize$2$1,sanitizeStep:sanitizeStep$1});function _extends$1(){return _extends$1=Object.assign?Object.assign.bind():function(X){for(var Z=1;Z<arguments.length;Z++){var _=arguments[Z];for(var K in _)Object.prototype.hasOwnProperty.call(_,K)&&(X[K]=_[K])}return X},_extends$1.apply(this,arguments)}const InputContext=reactExports.createContext({});function useInputContext(){return reactExports.useContext(InputContext)}const ThemeContext=reactExports.createContext(null),StoreContext=reactExports.createContext(null),PanelSettingsContext=reactExports.createContext(null);function useStoreContext(){return reactExports.useContext(StoreContext)}function usePanelSettingsContext(){return reactExports.useContext(PanelSettingsContext)}const getDefaultTheme=()=>({colors:{elevation1:"#292d39",elevation2:"#181c20",elevation3:"#373c4b",accent1:"#0066dc",accent2:"#007bff",accent3:"#3c93ff",highlight1:"#535760",highlight2:"#8c92a4",highlight3:"#fefefe",vivid1:"#ffcc00",folderWidgetColor:"$highlight2",folderTextColor:"$highlight3",toolTipBackground:"$highlight3",toolTipText:"$elevation2"},radii:{xs:"2px",sm:"3px",lg:"10px"},space:{xs:"3px",sm:"6px",md:"10px",rowGap:"7px",colGap:"7px"},fonts:{mono:"ui-monospace, SFMono-Regular, Menlo, 'Roboto Mono', monospace",sans:"system-ui, sans-serif"},fontSizes:{root:"11px",toolTip:"$root"},sizes:{rootWidth:"280px",controlWidth:"160px",numberInputMinWidth:"38px",scrubberWidth:"8px",scrubberHeight:"16px",rowHeight:"24px",folderTitleHeight:"20px",checkboxSize:"16px",joystickWidth:"100px",joystickHeight:"100px",colorPickerWidth:"$controlWidth",colorPickerHeight:"100px",imagePreviewWidth:"$controlWidth",imagePreviewHeight:"100px",monitorHeight:"60px",titleBarHeight:"39px"},shadows:{level1:"0 0 9px 0 #00000088",level2:"0 4px 14px #00000033"},borderWidths:{root:"0px",input:"1px",focus:"1px",hover:"1px",active:"1px",folder:"1px"},fontWeights:{label:"normal",folder:"normal",button:"normal"}});function createStateClass(X,Z){const[_,K]=X.split(" "),te={};return _!=="none"&&(te.boxShadow=`${Z.inset?"inset ":""}0 0 0 $borderWidths${[Z.key]} $colors${_!=="default"&&_||Z.borderColor}`),K&&(te.backgroundColor=K),te}const utils={$inputStyle:()=>X=>createStateClass(X,{key:"$input",borderColor:"$highlight1",inset:!0}),$focusStyle:()=>X=>createStateClass(X,{key:"$focus",borderColor:"$accent2"}),$hoverStyle:()=>X=>createStateClass(X,{key:"$hover",borderColor:"$accent1",inset:!0}),$activeStyle:()=>X=>createStateClass(X,{key:"$active",borderColor:"$accent1",inset:!0})},{styled,css,createTheme,globalCss,keyframes}=q$3({prefix:"leva",theme:getDefaultTheme(),utils:_objectSpread2(_objectSpread2({},utils),{},{$flex:()=>({display:"flex",alignItems:"center"}),$flexCenter:()=>({display:"flex",alignItems:"center",justifyContent:"center"}),$reset:()=>({outline:"none",fontSize:"inherit",fontWeight:"inherit",color:"inherit",fontFamily:"inherit",border:"none",backgroundColor:"transparent",appearance:"none"}),$draggable:()=>({touchAction:"none",WebkitUserDrag:"none",userSelect:"none"}),$focus:X=>({"&:focus":utils.$focusStyle()(X)}),$focusWithin:X=>({"&:focus-within":utils.$focusStyle()(X)}),$hover:X=>({"&:hover":utils.$hoverStyle()(X)}),$active:X=>({"&:active":utils.$activeStyle()(X)})})}),globalStyles=globalCss({".leva__panel__dragged":{WebkitUserDrag:"none",userSelect:"none",input:{userSelect:"none"},"*":{cursor:"ew-resize !important"}}});function mergeTheme(X){const Z=getDefaultTheme();if(!X)return{theme:Z,className:""};Object.keys(X).forEach(K=>{Object.assign(Z[K],X[K])});const _=createTheme(Z);return{theme:Z,className:_.className}}function useTh(X,Z){const{theme:_}=reactExports.useContext(ThemeContext);if(!(X in _)||!(Z in _[X]))return warn(LevaErrors.THEME_ERROR,X,Z),"";let K=Z;for(;;){let te=_[X][K];if(typeof te=="string"&&te.charAt(0)==="$")K=te.substr(1);else return te}}const StyledInput=styled("input",{$reset:"",padding:"0 $sm",width:0,minWidth:0,flex:1,height:"100%",variants:{levaType:{number:{textAlign:"right"}},as:{textarea:{padding:"$sm"}}}}),InnerLabel=styled("div",{$draggable:"",height:"100%",$flexCenter:"",position:"relative",padding:"0 $xs",fontSize:"0.8em",opacity:.8,cursor:"default",touchAction:"none",[`& + ${StyledInput}`]:{paddingLeft:0}}),InnerNumberLabel=styled(InnerLabel,{cursor:"ew-resize",marginRight:"-$xs",textTransform:"uppercase",opacity:.3,"&:hover":{opacity:1},variants:{dragging:{true:{backgroundColor:"$accent2",opacity:1}}}}),InputContainer=styled("div",{$flex:"",position:"relative",borderRadius:"$sm",overflow:"hidden",color:"inherit",height:"$rowHeight",backgroundColor:"$elevation3",$inputStyle:"$elevation1",$hover:"",$focusWithin:"",variants:{textArea:{true:{height:"auto"}}}}),_excluded$7$1=["innerLabel","value","onUpdate","onChange","onKeyDown","type","id","inputType","rows"],_excluded2$1$1=["onUpdate"];function ValueInput(X){let{innerLabel:Z,value:_,onUpdate:K,onChange:te,onKeyDown:ne,type:ie,id:oe,inputType:se="text",rows:ae=0}=X,ge=_objectWithoutProperties$2(X,_excluded$7$1);const{id:ce,emitOnEditStart:de,emitOnEditEnd:Ie,disabled:fe}=useInputContext(),be=oe||ce,Ae=reactExports.useRef(null),ye=ae>0,ve=ye?"textarea":"input",Be=reactExports.useCallback(Ee=>Ze=>{const _e=Ze.currentTarget.value;Ee(_e)},[]);React.useEffect(()=>{const Ee=Ae.current,Ze=Be(_e=>{K(_e),Ie()});return Ee==null||Ee.addEventListener("blur",Ze),()=>Ee==null?void 0:Ee.removeEventListener("blur",Ze)},[Be,K,Ie]);const Re=reactExports.useCallback(Ee=>{Ee.key==="Enter"&&Be(K)(Ee)},[Be,K]),Ve=Object.assign({as:ve},ye?{rows:ae}:{},ge);return React.createElement(InputContainer,{textArea:ye},Z&&typeof Z=="string"?React.createElement(InnerLabel,null,Z):Z,React.createElement(StyledInput,_extends$1({levaType:ie,ref:Ae,id:be,type:se,autoComplete:"off",spellCheck:"false",value:_,onChange:Be(te),onFocus:()=>de(),onKeyPress:Re,onKeyDown:ne,disabled:fe},Ve)))}function NumberInput(X){let{onUpdate:Z}=X,_=_objectWithoutProperties$2(X,_excluded2$1$1);const K=reactExports.useCallback(ne=>Z(parseNumber(ne)),[Z]),te=reactExports.useCallback(ne=>{const ie=ne.key==="ArrowUp"?1:ne.key==="ArrowDown"?-1:0;if(ie){ne.preventDefault();const oe=ne.altKey?.1:ne.shiftKey?10:1;Z(se=>parseFloat(se)+ie*oe)}},[Z]);return React.createElement(ValueInput,_extends$1({},_,{onUpdate:K,onKeyDown:te,type:"number"}))}const StyledFolder=styled("div",{}),StyledWrapper=styled("div",{position:"relative",background:"$elevation2",transition:"height 300ms ease",variants:{fill:{true:{},false:{}},flat:{false:{},true:{}},isRoot:{true:{},false:{paddingLeft:"$md","&::after":{content:'""',position:"absolute",left:0,top:0,width:"$borderWidths$folder",height:"100%",backgroundColor:"$folderWidgetColor",opacity:.4,transform:"translateX(-50%)"}}}},compoundVariants:[{isRoot:!0,fill:!1,css:{overflowY:"auto",maxHeight:"calc(100vh - 20px - $$titleBarHeight)"}},{isRoot:!0,flat:!1,css:{borderRadius:"$lg"}}]}),StyledTitle=styled("div",{$flex:"",color:"$folderTextColor",userSelect:"none",cursor:"pointer",height:"$folderTitleHeight",fontWeight:"$folder","> svg":{marginLeft:-4,marginRight:4,cursor:"pointer",fill:"$folderWidgetColor",opacity:.6},"&:hover > svg":{fill:"$folderWidgetColor"},[`&:hover + ${StyledWrapper}::after`]:{opacity:.6},[`${StyledFolder}:hover > & + ${StyledWrapper}::after`]:{opacity:.6},[`${StyledFolder}:hover > & > svg`]:{opacity:1}}),StyledContent=styled("div",{position:"relative",display:"grid",gridTemplateColumns:"100%",rowGap:"$rowGap",transition:"opacity 250ms ease",variants:{toggled:{true:{opacity:1,transitionDelay:"250ms"},false:{opacity:0,transitionDelay:"0ms",pointerEvents:"none"}},isRoot:{true:{"& > div":{paddingLeft:"$md",paddingRight:"$md"},"& > div:first-of-type":{paddingTop:"$sm"},"& > div:last-of-type":{paddingBottom:"$sm"},[`> ${StyledFolder}:not(:first-of-type)`]:{paddingTop:"$sm",marginTop:"$md",borderTop:"$borderWidths$folder solid $colors$elevation1"}}}}}),StyledRow=styled("div",{position:"relative",zIndex:100,display:"grid",rowGap:"$rowGap",gridTemplateRows:"minmax($sizes$rowHeight, max-content)",alignItems:"center",color:"$highlight2",[`${StyledContent} > &`]:{"&:first-of-type":{marginTop:"$rowGap"},"&:last-of-type":{marginBottom:"$rowGap"}},variants:{disabled:{true:{pointerEvents:"none"},false:{"&:hover,&:focus-within":{color:"$highlight3"}}}}}),StyledInputRow=styled(StyledRow,{gridTemplateColumns:"auto $sizes$controlWidth",columnGap:"$colGap"}),CopyLabelContainer=styled("div",{$flex:"",height:"100%",position:"relative",overflow:"hidden","& > div":{marginLeft:"$colGap",padding:"0 $xs",opacity:.4},"& > div:hover":{opacity:.8},"& > div > svg":{display:"none",cursor:"pointer",width:13,minWidth:13,height:13,backgroundColor:"$elevation2"},"&:hover > div > svg":{display:"block"},variants:{align:{top:{height:"100%",alignItems:"flex-start",paddingTop:"$sm"}}}}),StyledOptionalToggle=styled("input",{$reset:"",height:0,width:0,opacity:0,margin:0,"& + label":{position:"relative",$flexCenter:"",height:"100%",userSelect:"none",cursor:"pointer",paddingLeft:2,paddingRight:"$sm",pointerEvents:"auto"},"& + label:after":{content:'""',width:6,height:6,backgroundColor:"$elevation3",borderRadius:"50%",$activeStyle:""},"&:focus + label:after":{$focusStyle:""},"& + label:active:after":{backgroundColor:"$accent1",$focusStyle:""},"&:checked + label:after":{backgroundColor:"$accent1"}}),StyledLabel=styled("label",{fontWeight:"$label",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap","& > svg":{display:"block"}}),StyledInputWrapper$1=styled("div",{opacity:1,variants:{disabled:{true:{opacity:.6,pointerEvents:"none",[`& ${StyledLabel}`]:{pointerEvents:"auto"}}}}}),Overlay=styled("div",{position:"fixed",top:0,bottom:0,right:0,left:0,zIndex:1e3,userSelect:"none"}),StyledToolTipContent=styled("div",{background:"$toolTipBackground",fontFamily:"$sans",fontSize:"$toolTip",padding:"$xs $sm",color:"$toolTipText",borderRadius:"$xs",boxShadow:"$level2",maxWidth:260}),ToolTipArrow=styled($a093c7e1ec25a057$export$21b07c8f274aebd5,{fill:"$toolTipBackground"});function Portal({children:X}){const{className:Z}=reactExports.useContext(ThemeContext);return React.createElement($f1701beae083dbae$export$be92b6f5f03c0fe9,{className:Z},X)}const _excluded$6$1=["align"];function OptionalToggle(){const{id:X,disable:Z,disabled:_}=useInputContext();return React.createElement(React.Fragment,null,React.createElement(StyledOptionalToggle,{id:X+"__disable",type:"checkbox",checked:!_,onChange:()=>Z(!_)}),React.createElement("label",{htmlFor:X+"__disable"}))}function RawLabel(X){const{id:Z,optional:_,hint:K}=useInputContext(),te=X.htmlFor||(Z?{htmlFor:Z}:null),ne=!K&&typeof X.children=="string"?{title:X.children}:null;return React.createElement(React.Fragment,null,_&&React.createElement(OptionalToggle,null),K!==void 0?React.createElement($a093c7e1ec25a057$export$be92b6f5f03c0fe9,null,React.createElement($a093c7e1ec25a057$export$41fb9f06171c75f4,{asChild:!0},React.createElement(StyledLabel,_extends$1({},te,X))),React.createElement($a093c7e1ec25a057$export$7c6e2c02157bb7d2,{side:"top",sideOffset:2},React.createElement(StyledToolTipContent,null,K,React.createElement(ToolTipArrow,null)))):React.createElement(StyledLabel,_extends$1({},te,ne,X)))}function Label(X){let{align:Z}=X,_=_objectWithoutProperties$2(X,_excluded$6$1);const{value:K,label:te,key:ne,disabled:ie}=useInputContext(),{hideCopyButton:oe}=usePanelSettingsContext(),se=!oe&&ne!==void 0,[ae,ge]=reactExports.useState(!1),ce=async()=>{try{await navigator.clipboard.writeText(JSON.stringify({[ne]:K??""})),ge(!0)}catch{warn(LevaErrors.CLIPBOARD_ERROR,{[ne]:K})}};return React.createElement(CopyLabelContainer,{align:Z,onPointerLeave:()=>ge(!1)},React.createElement(RawLabel,_),se&&!ie&&React.createElement("div",{title:`Click to copy ${typeof te=="string"?te:ne} value`},ae?React.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor"},React.createElement("path",{d:"M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"}),React.createElement("path",{fillRule:"evenodd",d:"M4 5a2 2 0 012-2 3 3 0 003 3h2a3 3 0 003-3 2 2 0 012 2v11a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm9.707 5.707a1 1 0 00-1.414-1.414L9 12.586l-1.293-1.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})):React.createElement("svg",{onClick:ce,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor"},React.createElement("path",{d:"M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z"}),React.createElement("path",{d:"M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z"}))))}const _excluded$5$1=["toggled"],Svg=styled("svg",{fill:"currentColor",transition:"transform 350ms ease, fill 250ms ease"});function Chevron(X){let{toggled:Z}=X,_=_objectWithoutProperties$2(X,_excluded$5$1);return React.createElement(Svg,_extends$1({width:"9",height:"5",viewBox:"0 0 9 5",xmlns:"http://www.w3.org/2000/svg",style:{transform:`rotate(${Z?0:-90}deg)`}},_),React.createElement("path",{d:"M3.8 4.4c.4.3 1 .3 1.4 0L8 1.7A1 1 0 007.4 0H1.6a1 1 0 00-.7 1.7l3 2.7z"}))}const _excluded$4$1=["input"];function Row(X){let{input:Z}=X,_=_objectWithoutProperties$2(X,_excluded$4$1);return Z?React.createElement(StyledInputRow,_):React.createElement(StyledRow,_)}function useInputSetters({value:X,type:Z,settings:_,setValue:K}){const[te,ne]=reactExports.useState(format$2(Z,X,_)),ie=reactExports.useRef(X),oe=reactExports.useRef(_);oe.current=_;const se=reactExports.useCallback(ge=>ne(format$2(Z,ge,oe.current)),[Z]),ae=reactExports.useCallback(ge=>{try{K(ge)}catch(ce){const{type:de,previousValue:Ie}=ce;if(de!=="LEVA_ERROR")throw ce;se(Ie)}},[se,K]);return reactExports.useEffect(()=>{dequal(X,ie.current)||se(X),ie.current=X},[X,se]),{displayValue:te,onChange:ne,onUpdate:ae}}function useDrag(X,Z){const{emitOnEditStart:_,emitOnEditEnd:K}=useInputContext();return useDrag$1(te=>{te.first&&(document.body.classList.add("leva__panel__dragged"),_==null||_());const ne=X(te);return te.last&&(document.body.classList.remove("leva__panel__dragged"),K==null||K()),ne},Z)}function useCanvas2d(X){const Z=reactExports.useRef(null),_=reactExports.useRef(null),K=reactExports.useRef(!1);return reactExports.useEffect(()=>{const te=debounce(()=>{Z.current.width=Z.current.offsetWidth*window.devicePixelRatio,Z.current.height=Z.current.offsetHeight*window.devicePixelRatio,X(Z.current,_.current)},250);return window.addEventListener("resize",te),K.current||(te(),K.current=!0),()=>window.removeEventListener("resize",te)},[X]),reactExports.useEffect(()=>{_.current=Z.current.getContext("2d")},[]),[Z,_]}function useTransform(){const X=reactExports.useRef(null),Z=reactExports.useRef({x:0,y:0}),_=reactExports.useCallback(K=>{Object.assign(Z.current,K),X.current&&(X.current.style.transform=`translate3d(${Z.current.x}px, ${Z.current.y}px, 0)`)},[]);return[X,_]}const _excluded$3$1=["__refCount"],getInputAtPath=(X,Z)=>{if(!X[Z])return null;const _=X[Z];return _objectWithoutProperties$2(_,_excluded$3$1)};function useInput(X){const Z=useStoreContext(),[_,K]=reactExports.useState(getInputAtPath(Z.getData(),X)),te=reactExports.useCallback(ae=>Z.setValueAtPath(X,ae,!0),[X,Z]),ne=reactExports.useCallback(ae=>Z.setSettingsAtPath(X,ae),[X,Z]),ie=reactExports.useCallback(ae=>Z.disableInputAtPath(X,ae),[X,Z]),oe=reactExports.useCallback(()=>Z.emitOnEditStart(X),[X,Z]),se=reactExports.useCallback(()=>Z.emitOnEditEnd(X),[X,Z]);return reactExports.useEffect(()=>{K(getInputAtPath(Z.getData(),X));const ae=Z.useStore.subscribe(ge=>getInputAtPath(ge.data,X),K,{equalityFn:shallow});return()=>ae()},[Z,X]),[_,{set:te,setSettings:ne,disable:ie,storeId:Z.storeId,emitOnEditStart:oe,emitOnEditEnd:se}]}const RangeGrid=styled("div",{variants:{hasRange:{true:{position:"relative",display:"grid",gridTemplateColumns:"auto $sizes$numberInputMinWidth",columnGap:"$colGap",alignItems:"center"}}}}),Range=styled("div",{position:"relative",width:"100%",height:2,borderRadius:"$xs",backgroundColor:"$elevation1"}),Scrubber=styled("div",{position:"absolute",width:"$scrubberWidth",height:"$scrubberHeight",borderRadius:"$xs",boxShadow:"0 0 0 2px $colors$elevation2",backgroundColor:"$accent2",cursor:"pointer",$active:"none $accent1",$hover:"none $accent3",variants:{position:{left:{borderTopRightRadius:0,borderBottomRightRadius:0,transform:"translateX(calc(-0.5 * ($sizes$scrubberWidth + 4px)))"},right:{borderTopLeftRadius:0,borderBottomLeftRadius:0,transform:"translateX(calc(0.5 * ($sizes$scrubberWidth + 4px)))"}}}}),RangeWrapper=styled("div",{position:"relative",$flex:"",height:"100%",cursor:"pointer",touchAction:"none"}),Indicator=styled("div",{position:"absolute",height:"100%",backgroundColor:"$accent2"});function RangeSlider({value:X,min:Z,max:_,onDrag:K,step:te,initialValue:ne}){const ie=reactExports.useRef(null),oe=reactExports.useRef(null),se=reactExports.useRef(0),ae=useTh("sizes","scrubberWidth"),ge=useDrag(({event:de,first:Ie,xy:[fe],movement:[be],memo:Ae})=>{if(Ie){const{width:ve,left:Be}=ie.current.getBoundingClientRect();se.current=ve-parseFloat(ae),Ae=(de==null?void 0:de.target)===oe.current?X:invertedRange((fe-Be)/ve,Z,_)}const ye=Ae+invertedRange(be/se.current,0,_-Z);return K(sanitizeStep$1(ye,{step:te,initialValue:ne})),Ae}),ce=range(X,Z,_);return React.createElement(RangeWrapper,_extends$1({ref:ie},ge()),React.createElement(Range,null,React.createElement(Indicator,{style:{left:0,right:`${(1-ce)*100}%`}})),React.createElement(Scrubber,{ref:oe,style:{left:`calc(${ce} * (100% - ${ae}))`}}))}const DraggableLabel=React.memo(({label:X,onUpdate:Z,step:_,innerLabelTrim:K})=>{const[te,ne]=reactExports.useState(!1),ie=useDrag(({active:oe,delta:[se],event:ae,memo:ge=0,first:ce,last:de,target:Ie})=>(ce&&Ie.requestPointerLock(),de&&document.exitPointerLock(),ne(oe),ge+=se/2,Math.abs(ge)>=1&&(Z(fe=>parseFloat(fe)+Math.floor(ge)*_*multiplyStep(ae)),ge=0),ge));return React.createElement(InnerNumberLabel,_extends$1({dragging:te,title:X.length>1?X:""},ie()),X.slice(0,K))});function Number$1({label:X,id:Z,displayValue:_,onUpdate:K,onChange:te,settings:ne,innerLabelTrim:ie=1}){const oe=ie>0&&React.createElement(DraggableLabel,{label:X,step:ne.step,onUpdate:K,innerLabelTrim:ie});return React.createElement(NumberInput,{id:Z,value:String(_),onUpdate:K,onChange:te,innerLabel:oe})}function NumberComponent(){const X=useInputContext(),{label:Z,value:_,onUpdate:K,settings:te,id:ne}=X,{min:ie,max:oe}=te,se=oe!==1/0&&ie!==-1/0;return React.createElement(Row,{input:!0},React.createElement(Label,null,Z),React.createElement(RangeGrid,{hasRange:se},se&&React.createElement(RangeSlider,_extends$1({value:parseFloat(_),onDrag:K},te)),React.createElement(Number$1,_extends$1({},X,{id:ne,label:"value",innerLabelTrim:se?0:1}))))}const{sanitizeStep}=props$3,rest=_objectWithoutProperties$2(props$3,["sanitizeStep"]);var number$1=_objectSpread2({component:NumberComponent},rest);const schema$2$1=(X,Z)=>v8n().schema({options:v8n().passesAnyOf(v8n().object(),v8n().array())}).test(Z),sanitize$2$1=(X,{values:Z})=>{if(Z.indexOf(X)<0)throw Error("Selected value doesn't match Select options");return X},format$3=(X,{values:Z})=>Z.indexOf(X),normalize$1$1=X=>{let{value:Z,options:_}=X,K,te;return Array.isArray(_)?(te=_,K=_.map(ne=>String(ne))):(te=Object.values(_),K=Object.keys(_)),"value"in X?te.includes(Z)||(K.unshift(String(Z)),te.unshift(Z)):Z=te[0],Object.values(_).includes(Z)||(_[String(Z)]=Z),{value:Z,settings:{keys:K,values:te}}};var props$2$1=Object.freeze({__proto__:null,schema:schema$2$1,sanitize:sanitize$2$1,format:format$3,normalize:normalize$1$1});const SelectContainer=styled("div",{$flexCenter:"",position:"relative","> svg":{pointerEvents:"none",position:"absolute",right:"$md"}}),NativeSelect=styled("select",{position:"absolute",top:0,left:0,width:"100%",height:"100%",opacity:0}),PresentationalSelect=styled("div",{display:"flex",alignItems:"center",width:"100%",height:"$rowHeight",backgroundColor:"$elevation3",borderRadius:"$sm",padding:"0 $sm",cursor:"pointer",[`${NativeSelect}:focus + &`]:{$focusStyle:""},[`${NativeSelect}:hover + &`]:{$hoverStyle:""}});function Select({displayValue:X,value:Z,onUpdate:_,id:K,settings:te,disabled:ne}){const{keys:ie,values:oe}=te,se=reactExports.useRef();return Z===oe[X]&&(se.current=ie[X]),React.createElement(SelectContainer,null,React.createElement(NativeSelect,{id:K,value:X,onChange:ae=>_(oe[Number(ae.currentTarget.value)]),disabled:ne},ie.map((ae,ge)=>React.createElement("option",{key:ae,value:ge},ae))),React.createElement(PresentationalSelect,null,se.current),React.createElement(Chevron,{toggled:!0}))}function SelectComponent(){const{label:X,value:Z,displayValue:_,onUpdate:K,id:te,disabled:ne,settings:ie}=useInputContext();return React.createElement(Row,{input:!0},React.createElement(Label,null,X),React.createElement(Select,{id:te,value:Z,displayValue:_,onUpdate:K,settings:ie,disabled:ne}))}var select=_objectSpread2({component:SelectComponent},props$2$1);const schema$1$1=X=>v8n().string().test(X),sanitize$1$1=X=>{if(typeof X!="string")throw Error("Invalid string");return X},normalize$4=({value:X,editable:Z=!0,rows:_=!1})=>({value:X,settings:{editable:Z,rows:typeof _=="number"?_:_?5:0}});var props$1$1=Object.freeze({__proto__:null,schema:schema$1$1,sanitize:sanitize$1$1,normalize:normalize$4});const _excluded$2$1=["displayValue","onUpdate","onChange","editable"],NonEditableString=styled("div",{whiteSpace:"pre-wrap"});function String$1(X){let{displayValue:Z,onUpdate:_,onChange:K,editable:te=!0}=X,ne=_objectWithoutProperties$2(X,_excluded$2$1);return te?React.createElement(ValueInput,_extends$1({value:Z,onUpdate:_,onChange:K},ne)):React.createElement(NonEditableString,null,Z)}function StringComponent(){const{label:X,settings:Z,displayValue:_,onUpdate:K,onChange:te}=useInputContext();return React.createElement(Row,{input:!0},React.createElement(Label,null,X),React.createElement(String$1,_extends$1({displayValue:_,onUpdate:K,onChange:te},Z)))}var string=_objectSpread2({component:StringComponent},props$1$1);const schema$4=X=>v8n().boolean().test(X),sanitize$5=X=>{if(typeof X!="boolean")throw Error("Invalid boolean");return X};var props$4=Object.freeze({__proto__:null,schema:schema$4,sanitize:sanitize$5});const StyledInputWrapper=styled("div",{position:"relative",$flex:"",height:"$rowHeight",input:{$reset:"",height:0,width:0,opacity:0,margin:0},label:{position:"relative",$flexCenter:"",userSelect:"none",cursor:"pointer",height:"$checkboxSize",width:"$checkboxSize",backgroundColor:"$elevation3",borderRadius:"$sm",$hover:""},"input:focus + label":{$focusStyle:""},"input:focus:checked + label, input:checked + label:hover":{$hoverStyle:"$accent3"},"input + label:active":{backgroundColor:"$accent1"},"input:checked + label:active":{backgroundColor:"$accent1"},"label > svg":{display:"none",width:"90%",height:"90%",stroke:"$highlight3"},"input:checked + label":{backgroundColor:"$accent2"},"input:checked + label > svg":{display:"block"}});function Boolean$1({value:X,onUpdate:Z,id:_,disabled:K}){return React.createElement(StyledInputWrapper,null,React.createElement("input",{id:_,type:"checkbox",checked:X,onChange:te=>Z(te.currentTarget.checked),disabled:K}),React.createElement("label",{htmlFor:_},React.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},React.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"}))))}function BooleanComponent(){const{label:X,value:Z,onUpdate:_,disabled:K,id:te}=useInputContext();return React.createElement(Row,{input:!0},React.createElement(Label,null,X),React.createElement(Boolean$1,{value:Z,onUpdate:_,id:te,disabled:K}))}var boolean=_objectSpread2({component:BooleanComponent},props$4);const _excluded$1$1=["locked"];function Coordinate({value:X,id:Z,valueKey:_,settings:K,onUpdate:te,innerLabelTrim:ne}){const ie=reactExports.useRef(X[_]);ie.current=X[_];const oe=reactExports.useCallback(ae=>te({[_]:sanitizeValue({type:"NUMBER",value:ie.current,settings:K},ae)}),[te,K,_]),se=useInputSetters({type:"NUMBER",value:X[_],settings:K,setValue:oe});return React.createElement(Number$1,{id:Z,label:_,value:X[_],displayValue:se.displayValue,onUpdate:se.onUpdate,onChange:se.onChange,settings:K,innerLabelTrim:ne})}const Container$2=styled("div",{display:"grid",columnGap:"$colGap",gridAutoFlow:"column dense",alignItems:"center",variants:{withLock:{true:{gridTemplateColumns:"10px auto","> svg":{cursor:"pointer"}}}}});function Lock(X){let{locked:Z}=X,_=_objectWithoutProperties$2(X,_excluded$1$1);return React.createElement("svg",_extends$1({width:"10",height:"10",viewBox:"0 0 15 15",fill:"none",xmlns:"http://www.w3.org/2000/svg"},_),Z?React.createElement("path",{d:"M5 4.63601C5 3.76031 5.24219 3.1054 5.64323 2.67357C6.03934 2.24705 6.64582 1.9783 7.5014 1.9783C8.35745 1.9783 8.96306 2.24652 9.35823 2.67208C9.75838 3.10299 10 3.75708 10 4.63325V5.99999H5V4.63601ZM4 5.99999V4.63601C4 3.58148 4.29339 2.65754 4.91049 1.99307C5.53252 1.32329 6.42675 0.978302 7.5014 0.978302C8.57583 0.978302 9.46952 1.32233 10.091 1.99162C10.7076 2.65557 11 3.57896 11 4.63325V5.99999H12C12.5523 5.99999 13 6.44771 13 6.99999V13C13 13.5523 12.5523 14 12 14H3C2.44772 14 2 13.5523 2 13V6.99999C2 6.44771 2.44772 5.99999 3 5.99999H4ZM3 6.99999H12V13H3V6.99999Z",fill:"currentColor",fillRule:"evenodd",clipRule:"evenodd"}):React.createElement("path",{d:"M9 3.63601C9 2.76044 9.24207 2.11211 9.64154 1.68623C10.0366 1.26502 10.6432 1 11.5014 1C12.4485 1 13.0839 1.30552 13.4722 1.80636C13.8031 2.23312 14 2.84313 14 3.63325H15C15 2.68242 14.7626 1.83856 14.2625 1.19361C13.6389 0.38943 12.6743 0 11.5014 0C10.4294 0 9.53523 0.337871 8.91218 1.0021C8.29351 1.66167 8 2.58135 8 3.63601V6H1C0.447715 6 0 6.44772 0 7V13C0 13.5523 0.447715 14 1 14H10C10.5523 14 11 13.5523 11 13V7C11 6.44772 10.5523 6 10 6H9V3.63601ZM1 7H10V13H1V7Z",fill:"currentColor",fillRule:"evenodd",clipRule:"evenodd"}))}function Vector({value:X,onUpdate:Z,settings:_,innerLabelTrim:K}){const{id:te,setSettings:ne}=useInputContext(),{lock:ie,locked:oe}=_;return React.createElement(Container$2,{withLock:ie},ie&&React.createElement(Lock,{locked:oe,onClick:()=>ne({locked:!oe})}),Object.keys(X).map((se,ae)=>React.createElement(Coordinate,{id:ae===0?te:`${te}.${se}`,key:se,valueKey:se,value:X,settings:_[se],onUpdate:Z,innerLabelTrim:K})))}const normalizeKeyedNumberSettings=(X,Z)=>{const _={};let K=0,te=1/0;Object.entries(X).forEach(([ne,ie])=>{_[ne]=normalize$2$1(_objectSpread2({value:ie},Z[ne])).settings,K=Math.max(K,_[ne].step),te=Math.min(te,_[ne].pad)});for(let ne in _){const{step:ie,min:oe,max:se}=Z[ne]||{};!isFinite(ie)&&(!isFinite(oe)||!isFinite(se))&&(_[ne].step=K,_[ne].pad=te)}return _},_excluded$b=["lock"],_excluded2$5=["value"];function getVectorSchema(X){const Z=v8n().array().length(X).every.number(),_=K=>{if(!K||typeof K!="object")return!1;const te=Object.values(K);return te.length===X&&te.every(ne=>isFinite(ne))};return K=>Z.test(K)||_(K)}function getVectorType(X){return Array.isArray(X)?"array":"object"}function convert$1(X,Z,_){return getVectorType(X)===Z?X:Z==="array"?Object.values(X):mapArrayToKeys(X,_)}const sanitizeVector=(X,Z,_)=>{const K=convert$1(X,"object",Z.keys);for(let ie in K)K[ie]=sanitize$3(K[ie],Z[ie]);const te=Object.keys(K);let ne={};if(te.length===Z.keys.length)ne=K;else{const ie=convert$1(_,"object",Z.keys);if(te.length===1&&Z.locked){const oe=te[0],se=K[oe],ae=ie[oe],ge=ae!==0?se/ae:1;for(let ce in ie)ce===oe?ne[oe]=se:ne[ce]=ie[ce]*ge}else ne=_objectSpread2(_objectSpread2({},ie),K)}return convert$1(ne,Z.format,Z.keys)},formatVector=(X,Z)=>convert$1(X,"object",Z.keys),isNumberSettings=X=>!!X&&("step"in X||"min"in X||"max"in X);function normalizeVector(X,Z,_=[]){const{lock:K=!1}=Z,te=_objectWithoutProperties$2(Z,_excluded$b),ne=Array.isArray(X)?"array":"object",ie=ne==="object"?Object.keys(X):_,oe=convert$1(X,"object",ie),se=isNumberSettings(te)?ie.reduce((ge,ce)=>Object.assign(ge,{[ce]:te}),{}):te,ae=normalizeKeyedNumberSettings(oe,se);return{value:ne==="array"?X:oe,settings:_objectSpread2(_objectSpread2({},ae),{},{format:ne,keys:ie,lock:K,locked:!1})}}function getVectorPlugin(X){return{schema:getVectorSchema(X.length),normalize:Z=>{let{value:_}=Z,K=_objectWithoutProperties$2(Z,_excluded2$5);return normalizeVector(_,K,X)},format:(Z,_)=>formatVector(Z,_),sanitize:(Z,_,K)=>sanitizeVector(Z,_,K)}}var r$1={grad:.9,turn:360,rad:360/(2*Math.PI)},t=function(X){return typeof X=="string"?X.length>0:typeof X=="number"},n=function(X,Z,_){return Z===void 0&&(Z=0),_===void 0&&(_=Math.pow(10,Z)),Math.round(_*X)/_+0},e$1=function(X,Z,_){return Z===void 0&&(Z=0),_===void 0&&(_=1),X>_?_:X>Z?X:Z},u$1=function(X){return(X=isFinite(X)?X%360:0)>0?X:X+360},a$2=function(X){return{r:e$1(X.r,0,255),g:e$1(X.g,0,255),b:e$1(X.b,0,255),a:e$1(X.a)}},o=function(X){return{r:n(X.r),g:n(X.g),b:n(X.b),a:n(X.a,3)}},i$1=/^#([0-9a-f]{3,8})$/i,s$2=function(X){var Z=X.toString(16);return Z.length<2?"0"+Z:Z},h$1=function(X){var Z=X.r,_=X.g,K=X.b,te=X.a,ne=Math.max(Z,_,K),ie=ne-Math.min(Z,_,K),oe=ie?ne===Z?(_-K)/ie:ne===_?2+(K-Z)/ie:4+(Z-_)/ie:0;return{h:60*(oe<0?oe+6:oe),s:ne?ie/ne*100:0,v:ne/255*100,a:te}},b$3=function(X){var Z=X.h,_=X.s,K=X.v,te=X.a;Z=Z/360*6,_/=100,K/=100;var ne=Math.floor(Z),ie=K*(1-_),oe=K*(1-(Z-ne)*_),se=K*(1-(1-Z+ne)*_),ae=ne%6;return{r:255*[K,oe,ie,ie,se,K][ae],g:255*[se,K,K,oe,ie,ie][ae],b:255*[ie,ie,se,K,K,oe][ae],a:te}},g$1=function(X){return{h:u$1(X.h),s:e$1(X.s,0,100),l:e$1(X.l,0,100),a:e$1(X.a)}},d$1=function(X){return{h:n(X.h),s:n(X.s),l:n(X.l),a:n(X.a,3)}},f$1=function(X){return b$3((_=(Z=X).s,{h:Z.h,s:(_*=((K=Z.l)<50?K:100-K)/100)>0?2*_/(K+_)*100:0,v:K+_,a:Z.a}));var Z,_,K},c$3=function(X){return{h:(Z=h$1(X)).h,s:(te=(200-(_=Z.s))*(K=Z.v)/100)>0&&te<200?_*K/100/(te<=100?te:200-te)*100:0,l:te/2,a:Z.a};var Z,_,K,te},l=/^hsla?\(\s*([+-]?\d*\.?\d+)(deg|rad|grad|turn)?\s*,\s*([+-]?\d*\.?\d+)%\s*,\s*([+-]?\d*\.?\d+)%\s*(?:,\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,p$1=/^hsla?\(\s*([+-]?\d*\.?\d+)(deg|rad|grad|turn)?\s+([+-]?\d*\.?\d+)%\s+([+-]?\d*\.?\d+)%\s*(?:\/\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,v$2=/^rgba?\(\s*([+-]?\d*\.?\d+)(%)?\s*,\s*([+-]?\d*\.?\d+)(%)?\s*,\s*([+-]?\d*\.?\d+)(%)?\s*(?:,\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,m$2=/^rgba?\(\s*([+-]?\d*\.?\d+)(%)?\s+([+-]?\d*\.?\d+)(%)?\s+([+-]?\d*\.?\d+)(%)?\s*(?:\/\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,y$1={string:[[function(X){var Z=i$1.exec(X);return Z?(X=Z[1]).length<=4?{r:parseInt(X[0]+X[0],16),g:parseInt(X[1]+X[1],16),b:parseInt(X[2]+X[2],16),a:X.length===4?n(parseInt(X[3]+X[3],16)/255,2):1}:X.length===6||X.length===8?{r:parseInt(X.substr(0,2),16),g:parseInt(X.substr(2,2),16),b:parseInt(X.substr(4,2),16),a:X.length===8?n(parseInt(X.substr(6,2),16)/255,2):1}:null:null},"hex"],[function(X){var Z=v$2.exec(X)||m$2.exec(X);return Z?Z[2]!==Z[4]||Z[4]!==Z[6]?null:a$2({r:Number(Z[1])/(Z[2]?100/255:1),g:Number(Z[3])/(Z[4]?100/255:1),b:Number(Z[5])/(Z[6]?100/255:1),a:Z[7]===void 0?1:Number(Z[7])/(Z[8]?100:1)}):null},"rgb"],[function(X){var Z=l.exec(X)||p$1.exec(X);if(!Z)return null;var _,K,te=g$1({h:(_=Z[1],K=Z[2],K===void 0&&(K="deg"),Number(_)*(r$1[K]||1)),s:Number(Z[3]),l:Number(Z[4]),a:Z[5]===void 0?1:Number(Z[5])/(Z[6]?100:1)});return f$1(te)},"hsl"]],object:[[function(X){var Z=X.r,_=X.g,K=X.b,te=X.a,ne=te===void 0?1:te;return t(Z)&&t(_)&&t(K)?a$2({r:Number(Z),g:Number(_),b:Number(K),a:Number(ne)}):null},"rgb"],[function(X){var Z=X.h,_=X.s,K=X.l,te=X.a,ne=te===void 0?1:te;if(!t(Z)||!t(_)||!t(K))return null;var ie=g$1({h:Number(Z),s:Number(_),l:Number(K),a:Number(ne)});return f$1(ie)},"hsl"],[function(X){var Z=X.h,_=X.s,K=X.v,te=X.a,ne=te===void 0?1:te;if(!t(Z)||!t(_)||!t(K))return null;var ie=function(oe){return{h:u$1(oe.h),s:e$1(oe.s,0,100),v:e$1(oe.v,0,100),a:e$1(oe.a)}}({h:Number(Z),s:Number(_),v:Number(K),a:Number(ne)});return b$3(ie)},"hsv"]]},N=function(X,Z){for(var _=0;_<Z.length;_++){var K=Z[_][0](X);if(K)return[K,Z[_][1]]}return[null,void 0]},x=function(X){return typeof X=="string"?N(X.trim(),y$1.string):typeof X=="object"&&X!==null?N(X,y$1.object):[null,void 0]},I$1=function(X){return x(X)[1]},M=function(X,Z){var _=c$3(X);return{h:_.h,s:e$1(_.s+100*Z,0,100),l:_.l,a:_.a}},H=function(X){return(299*X.r+587*X.g+114*X.b)/1e3/255},$$1=function(X,Z){var _=c$3(X);return{h:_.h,s:_.s,l:e$1(_.l+100*Z,0,100),a:_.a}},j=function(){function X(Z){this.parsed=x(Z)[0],this.rgba=this.parsed||{r:0,g:0,b:0,a:1}}return X.prototype.isValid=function(){return this.parsed!==null},X.prototype.brightness=function(){return n(H(this.rgba),2)},X.prototype.isDark=function(){return H(this.rgba)<.5},X.prototype.isLight=function(){return H(this.rgba)>=.5},X.prototype.toHex=function(){return Z=o(this.rgba),_=Z.r,K=Z.g,te=Z.b,ie=(ne=Z.a)<1?s$2(n(255*ne)):"","#"+s$2(_)+s$2(K)+s$2(te)+ie;var Z,_,K,te,ne,ie},X.prototype.toRgb=function(){return o(this.rgba)},X.prototype.toRgbString=function(){return Z=o(this.rgba),_=Z.r,K=Z.g,te=Z.b,(ne=Z.a)<1?"rgba("+_+", "+K+", "+te+", "+ne+")":"rgb("+_+", "+K+", "+te+")";var Z,_,K,te,ne},X.prototype.toHsl=function(){return d$1(c$3(this.rgba))},X.prototype.toHslString=function(){return Z=d$1(c$3(this.rgba)),_=Z.h,K=Z.s,te=Z.l,(ne=Z.a)<1?"hsla("+_+", "+K+"%, "+te+"%, "+ne+")":"hsl("+_+", "+K+"%, "+te+"%)";var Z,_,K,te,ne},X.prototype.toHsv=function(){return Z=h$1(this.rgba),{h:n(Z.h),s:n(Z.s),v:n(Z.v),a:n(Z.a,3)};var Z},X.prototype.invert=function(){return w({r:255-(Z=this.rgba).r,g:255-Z.g,b:255-Z.b,a:Z.a});var Z},X.prototype.saturate=function(Z){return Z===void 0&&(Z=.1),w(M(this.rgba,Z))},X.prototype.desaturate=function(Z){return Z===void 0&&(Z=.1),w(M(this.rgba,-Z))},X.prototype.grayscale=function(){return w(M(this.rgba,-1))},X.prototype.lighten=function(Z){return Z===void 0&&(Z=.1),w($$1(this.rgba,Z))},X.prototype.darken=function(Z){return Z===void 0&&(Z=.1),w($$1(this.rgba,-Z))},X.prototype.rotate=function(Z){return Z===void 0&&(Z=15),this.hue(this.hue()+Z)},X.prototype.alpha=function(Z){return typeof Z=="number"?w({r:(_=this.rgba).r,g:_.g,b:_.b,a:Z}):n(this.rgba.a,3);var _},X.prototype.hue=function(Z){var _=c$3(this.rgba);return typeof Z=="number"?w({h:Z,s:_.s,l:_.l,a:_.a}):n(_.h)},X.prototype.isEqual=function(Z){return this.toHex()===w(Z).toHex()},X}(),w=function(X){return X instanceof j?X:new j(X)},S$1=[],k$1=function(X){X.forEach(function(Z){S$1.indexOf(Z)<0&&(Z(j,y$1),S$1.push(Z))})};function namesPlugin(X,Z){var _={white:"#ffffff",bisque:"#ffe4c4",blue:"#0000ff",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",antiquewhite:"#faebd7",aqua:"#00ffff",azure:"#f0ffff",whitesmoke:"#f5f5f5",papayawhip:"#ffefd5",plum:"#dda0dd",blanchedalmond:"#ffebcd",black:"#000000",gold:"#ffd700",goldenrod:"#daa520",gainsboro:"#dcdcdc",cornsilk:"#fff8dc",cornflowerblue:"#6495ed",burlywood:"#deb887",aquamarine:"#7fffd4",beige:"#f5f5dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkkhaki:"#bdb76b",darkgray:"#a9a9a9",darkgreen:"#006400",darkgrey:"#a9a9a9",peachpuff:"#ffdab9",darkmagenta:"#8b008b",darkred:"#8b0000",darkorchid:"#9932cc",darkorange:"#ff8c00",darkslateblue:"#483d8b",gray:"#808080",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",deeppink:"#ff1493",deepskyblue:"#00bfff",wheat:"#f5deb3",firebrick:"#b22222",floralwhite:"#fffaf0",ghostwhite:"#f8f8ff",darkviolet:"#9400d3",magenta:"#ff00ff",green:"#008000",dodgerblue:"#1e90ff",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",blueviolet:"#8a2be2",forestgreen:"#228b22",lawngreen:"#7cfc00",indianred:"#cd5c5c",indigo:"#4b0082",fuchsia:"#ff00ff",brown:"#a52a2a",maroon:"#800000",mediumblue:"#0000cd",lightcoral:"#f08080",darkturquoise:"#00ced1",lightcyan:"#e0ffff",ivory:"#fffff0",lightyellow:"#ffffe0",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",linen:"#faf0e6",mediumaquamarine:"#66cdaa",lemonchiffon:"#fffacd",lime:"#00ff00",khaki:"#f0e68c",mediumseagreen:"#3cb371",limegreen:"#32cd32",mediumspringgreen:"#00fa9a",lightskyblue:"#87cefa",lightblue:"#add8e6",midnightblue:"#191970",lightpink:"#ffb6c1",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",mintcream:"#f5fffa",lightslategray:"#778899",lightslategrey:"#778899",navajowhite:"#ffdead",navy:"#000080",mediumvioletred:"#c71585",powderblue:"#b0e0e6",palegoldenrod:"#eee8aa",oldlace:"#fdf5e6",paleturquoise:"#afeeee",mediumturquoise:"#48d1cc",mediumorchid:"#ba55d3",rebeccapurple:"#663399",lightsteelblue:"#b0c4de",mediumslateblue:"#7b68ee",thistle:"#d8bfd8",tan:"#d2b48c",orchid:"#da70d6",mediumpurple:"#9370db",purple:"#800080",pink:"#ffc0cb",skyblue:"#87ceeb",springgreen:"#00ff7f",palegreen:"#98fb98",red:"#ff0000",yellow:"#ffff00",slateblue:"#6a5acd",lavenderblush:"#fff0f5",peru:"#cd853f",palevioletred:"#db7093",violet:"#ee82ee",teal:"#008080",slategray:"#708090",slategrey:"#708090",aliceblue:"#f0f8ff",darkseagreen:"#8fbc8f",darkolivegreen:"#556b2f",greenyellow:"#adff2f",seagreen:"#2e8b57",seashell:"#fff5ee",tomato:"#ff6347",silver:"#c0c0c0",sienna:"#a0522d",lavender:"#e6e6fa",lightgreen:"#90ee90",orange:"#ffa500",orangered:"#ff4500",steelblue:"#4682b4",royalblue:"#4169e1",turquoise:"#40e0d0",yellowgreen:"#9acd32",salmon:"#fa8072",saddlebrown:"#8b4513",sandybrown:"#f4a460",rosybrown:"#bc8f8f",darksalmon:"#e9967a",lightgoldenrodyellow:"#fafad2",snow:"#fffafa",lightgrey:"#d3d3d3",lightgray:"#d3d3d3",dimgray:"#696969",dimgrey:"#696969",olivedrab:"#6b8e23",olive:"#808000"},K={};for(var te in _)K[_[te]]=te;var ne={};X.prototype.toName=function(ie){if(!(this.rgba.a||this.rgba.r||this.rgba.g||this.rgba.b))return"transparent";var oe,se,ae=K[this.toHex()];if(ae)return ae;if(ie!=null&&ie.closest){var ge=this.toRgb(),ce=1/0,de="black";if(!ne.length)for(var Ie in _)ne[Ie]=new X(_[Ie]).toRgb();for(var fe in _){var be=(oe=ge,se=ne[fe],Math.pow(oe.r-se.r,2)+Math.pow(oe.g-se.g,2)+Math.pow(oe.b-se.b,2));be<ce&&(ce=be,de=fe)}return de}},Z.string.push([function(ie){var oe=ie.toLowerCase(),se=oe==="transparent"?"#0000":_[oe];return se?new X(se).toRgb():null},"name"])}function u(){return(u=Object.assign||function(X){for(var Z=1;Z<arguments.length;Z++){var _=arguments[Z];for(var K in _)Object.prototype.hasOwnProperty.call(_,K)&&(X[K]=_[K])}return X}).apply(this,arguments)}function c$2(X,Z){if(X==null)return{};var _,K,te={},ne=Object.keys(X);for(K=0;K<ne.length;K++)Z.indexOf(_=ne[K])>=0||(te[_]=X[_]);return te}function i(X){var Z=reactExports.useRef(X),_=reactExports.useRef(function(K){Z.current&&Z.current(K)});return Z.current=X,_.current}var s$1=function(X,Z,_){return Z===void 0&&(Z=0),_===void 0&&(_=1),X>_?_:X<Z?Z:X},f=function(X){return"touches"in X},v$1=function(X){return X&&X.ownerDocument.defaultView||self},d=function(X,Z,_){var K=X.getBoundingClientRect(),te=f(Z)?function(ne,ie){for(var oe=0;oe<ne.length;oe++)if(ne[oe].identifier===ie)return ne[oe];return ne[0]}(Z.touches,_):Z;return{left:s$1((te.pageX-(K.left+v$1(X).pageXOffset))/K.width),top:s$1((te.pageY-(K.top+v$1(X).pageYOffset))/K.height)}},h=function(X){!f(X)&&X.preventDefault()},m$1=React.memo(function(X){var Z=X.onMove,_=X.onKey,K=c$2(X,["onMove","onKey"]),te=reactExports.useRef(null),ne=i(Z),ie=i(_),oe=reactExports.useRef(null),se=reactExports.useRef(!1),ae=reactExports.useMemo(function(){var Ie=function(Ae){h(Ae),(f(Ae)?Ae.touches.length>0:Ae.buttons>0)&&te.current?ne(d(te.current,Ae,oe.current)):be(!1)},fe=function(){return be(!1)};function be(Ae){var ye=se.current,ve=v$1(te.current),Be=Ae?ve.addEventListener:ve.removeEventListener;Be(ye?"touchmove":"mousemove",Ie),Be(ye?"touchend":"mouseup",fe)}return[function(Ae){var ye=Ae.nativeEvent,ve=te.current;if(ve&&(h(ye),!function(Re,Ve){return Ve&&!f(Re)}(ye,se.current)&&ve)){if(f(ye)){se.current=!0;var Be=ye.changedTouches||[];Be.length&&(oe.current=Be[0].identifier)}ve.focus(),ne(d(ve,ye,oe.current)),be(!0)}},function(Ae){var ye=Ae.which||Ae.keyCode;ye<37||ye>40||(Ae.preventDefault(),ie({left:ye===39?.05:ye===37?-.05:0,top:ye===40?.05:ye===38?-.05:0}))},be]},[ie,ne]),ge=ae[0],ce=ae[1],de=ae[2];return reactExports.useEffect(function(){return de},[de]),React.createElement("div",u({},K,{onTouchStart:ge,onMouseDown:ge,className:"react-colorful__interactive",ref:te,onKeyDown:ce,tabIndex:0,role:"slider"}))}),g=function(X){return X.filter(Boolean).join(" ")},p=function(X){var Z=X.color,_=X.left,K=X.top,te=K===void 0?.5:K,ne=g(["react-colorful__pointer",X.className]);return React.createElement("div",{className:ne,style:{top:100*te+"%",left:100*_+"%"}},React.createElement("div",{className:"react-colorful__pointer-fill",style:{backgroundColor:Z}}))},b$2=function(X,Z,_){return Z===void 0&&(Z=0),_===void 0&&(_=Math.pow(10,Z)),Math.round(_*X)/_},y=function(X){var Z=X.s,_=X.v,K=X.a,te=(200-Z)*_/100;return{h:b$2(X.h),s:b$2(te>0&&te<200?Z*_/100/(te<=100?te:200-te)*100:0),l:b$2(te/2),a:b$2(K,2)}},q$2=function(X){var Z=y(X);return"hsl("+Z.h+", "+Z.s+"%, "+Z.l+"%)"},k=function(X){var Z=y(X);return"hsla("+Z.h+", "+Z.s+"%, "+Z.l+"%, "+Z.a+")"},I=function(X){var Z=X.h,_=X.s,K=X.v,te=X.a;Z=Z/360*6,_/=100,K/=100;var ne=Math.floor(Z),ie=K*(1-_),oe=K*(1-(Z-ne)*_),se=K*(1-(1-Z+ne)*_),ae=ne%6;return{r:b$2(255*[K,oe,ie,ie,se,K][ae]),g:b$2(255*[se,K,K,oe,ie,ie][ae]),b:b$2(255*[ie,ie,se,K,K,oe][ae]),a:b$2(te,2)}},L=function(X){var Z=X.r,_=X.g,K=X.b,te=X.a,ne=Math.max(Z,_,K),ie=ne-Math.min(Z,_,K),oe=ie?ne===Z?(_-K)/ie:ne===_?2+(K-Z)/ie:4+(Z-_)/ie:0;return{h:b$2(60*(oe<0?oe+6:oe)),s:b$2(ne?ie/ne*100:0),v:b$2(ne/255*100),a:te}},S=React.memo(function(X){var Z=X.hue,_=X.onChange,K=g(["react-colorful__hue",X.className]);return React.createElement("div",{className:K},React.createElement(m$1,{onMove:function(te){_({h:360*te.left})},onKey:function(te){_({h:s$1(Z+360*te.left,0,360)})},"aria-label":"Hue","aria-valuenow":b$2(Z),"aria-valuemax":"360","aria-valuemin":"0"},React.createElement(p,{className:"react-colorful__hue-pointer",left:Z/360,color:q$2({h:Z,s:100,v:100,a:1})})))}),T=React.memo(function(X){var Z=X.hsva,_=X.onChange,K={backgroundColor:q$2({h:Z.h,s:100,v:100,a:1})};return React.createElement("div",{className:"react-colorful__saturation",style:K},React.createElement(m$1,{onMove:function(te){_({s:100*te.left,v:100-100*te.top})},onKey:function(te){_({s:s$1(Z.s+100*te.left,0,100),v:s$1(Z.v-100*te.top,0,100)})},"aria-label":"Color","aria-valuetext":"Saturation "+b$2(Z.s)+"%, Brightness "+b$2(Z.v)+"%"},React.createElement(p,{className:"react-colorful__saturation-pointer",top:1-Z.v/100,left:Z.s/100,color:q$2(Z)})))}),F=function(X,Z){if(X===Z)return!0;for(var _ in X)if(X[_]!==Z[_])return!1;return!0};function Y(X,Z,_){var K=i(_),te=reactExports.useState(function(){return X.toHsva(Z)}),ne=te[0],ie=te[1],oe=reactExports.useRef({color:Z,hsva:ne});reactExports.useEffect(function(){if(!X.equal(Z,oe.current.color)){var ae=X.toHsva(Z);oe.current={hsva:ae,color:Z},ie(ae)}},[Z,X]),reactExports.useEffect(function(){var ae;F(ne,oe.current.hsva)||X.equal(ae=X.fromHsva(ne),oe.current.color)||(oe.current={hsva:ne,color:ae},K(ae))},[ne,X,K]);var se=reactExports.useCallback(function(ae){ie(function(ge){return Object.assign({},ge,ae)})},[]);return[ne,se]}var V=typeof window<"u"?reactExports.useLayoutEffect:reactExports.useEffect,$=function(){return typeof __webpack_nonce__<"u"?__webpack_nonce__:void 0},J=new Map,Q=function(X){V(function(){var Z=X.current?X.current.ownerDocument:document;if(Z!==void 0&&!J.has(Z)){var _=Z.createElement("style");_.innerHTML=`.react-colorful{position:relative;display:flex;flex-direction:column;width:200px;height:200px;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;cursor:default}.react-colorful__saturation{position:relative;flex-grow:1;border-color:transparent;border-bottom:12px solid #000;border-radius:8px 8px 0 0;background-image:linear-gradient(0deg,#000,transparent),linear-gradient(90deg,#fff,hsla(0,0%,100%,0))}.react-colorful__alpha-gradient,.react-colorful__pointer-fill{content:"";position:absolute;left:0;top:0;right:0;bottom:0;pointer-events:none;border-radius:inherit}.react-colorful__alpha-gradient,.react-colorful__saturation{box-shadow:inset 0 0 0 1px rgba(0,0,0,.05)}.react-colorful__alpha,.react-colorful__hue{position:relative;height:24px}.react-colorful__hue{background:linear-gradient(90deg,red 0,#ff0 17%,#0f0 33%,#0ff 50%,#00f 67%,#f0f 83%,red)}.react-colorful__last-control{border-radius:0 0 8px 8px}.react-colorful__interactive{position:absolute;left:0;top:0;right:0;bottom:0;border-radius:inherit;outline:none;touch-action:none}.react-colorful__pointer{position:absolute;z-index:1;box-sizing:border-box;width:28px;height:28px;transform:translate(-50%,-50%);background-color:#fff;border:2px solid #fff;border-radius:50%;box-shadow:0 2px 4px rgba(0,0,0,.2)}.react-colorful__interactive:focus .react-colorful__pointer{transform:translate(-50%,-50%) scale(1.1)}.react-colorful__alpha,.react-colorful__alpha-pointer{background-color:#fff;background-image:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill-opacity=".05"><path d="M8 0h8v8H8zM0 8h8v8H0z"/></svg>')}.react-colorful__saturation-pointer{z-index:3}.react-colorful__hue-pointer{z-index:2}`,J.set(Z,_);var K=$();K&&_.setAttribute("nonce",K),Z.head.appendChild(_)}},[])},U=function(X){var Z=X.className,_=X.colorModel,K=X.color,te=K===void 0?_.defaultColor:K,ne=X.onChange,ie=c$2(X,["className","colorModel","color","onChange"]),oe=reactExports.useRef(null);Q(oe);var se=Y(_,te,ne),ae=se[0],ge=se[1],ce=g(["react-colorful",Z]);return React.createElement("div",u({},ie,{ref:oe,className:ce}),React.createElement(T,{hsva:ae,onChange:ge}),React.createElement(S,{hue:ae.h,onChange:ge,className:"react-colorful__last-control"}))},ee=function(X){var Z=X.className,_=X.hsva,K=X.onChange,te={backgroundImage:"linear-gradient(90deg, "+k(Object.assign({},_,{a:0}))+", "+k(Object.assign({},_,{a:1}))+")"},ne=g(["react-colorful__alpha",Z]),ie=b$2(100*_.a);return React.createElement("div",{className:ne},React.createElement("div",{className:"react-colorful__alpha-gradient",style:te}),React.createElement(m$1,{onMove:function(oe){K({a:oe.left})},onKey:function(oe){K({a:s$1(_.a+oe.left)})},"aria-label":"Alpha","aria-valuetext":ie+"%","aria-valuenow":ie,"aria-valuemin":"0","aria-valuemax":"100"},React.createElement(p,{className:"react-colorful__alpha-pointer",left:_.a,color:k(_)})))},re=function(X){var Z=X.className,_=X.colorModel,K=X.color,te=K===void 0?_.defaultColor:K,ne=X.onChange,ie=c$2(X,["className","colorModel","color","onChange"]),oe=reactExports.useRef(null);Q(oe);var se=Y(_,te,ne),ae=se[0],ge=se[1],ce=g(["react-colorful",Z]);return React.createElement("div",u({},ie,{ref:oe,className:ce}),React.createElement(T,{hsva:ae,onChange:ge}),React.createElement(S,{hue:ae.h,onChange:ge}),React.createElement(ee,{hsva:ae,onChange:ge,className:"react-colorful__last-control"}))},xe={defaultColor:{r:0,g:0,b:0,a:1},toHsva:L,fromHsva:I,equal:F},Ce=function(X){return React.createElement(re,u({},X,{colorModel:xe}))},Me={defaultColor:{r:0,g:0,b:0},toHsva:function(X){return L({r:X.r,g:X.g,b:X.b,a:1})},fromHsva:function(X){return{r:(Z=I(X)).r,g:Z.g,b:Z.b};var Z},equal:F},Ne=function(X){return React.createElement(U,u({},X,{colorModel:Me}))};function __awaiter(X,Z,_,K){function te(ne){return ne instanceof _?ne:new _(function(ie){ie(ne)})}return new(_||(_=Promise))(function(ne,ie){function oe(ge){try{ae(K.next(ge))}catch(ce){ie(ce)}}function se(ge){try{ae(K.throw(ge))}catch(ce){ie(ce)}}function ae(ge){ge.done?ne(ge.value):te(ge.value).then(oe,se)}ae((K=K.apply(X,Z||[])).next())})}function __generator(X,Z){var _={label:0,sent:function(){if(ne[0]&1)throw ne[1];return ne[1]},trys:[],ops:[]},K,te,ne,ie=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return ie.next=oe(0),ie.throw=oe(1),ie.return=oe(2),typeof Symbol=="function"&&(ie[Symbol.iterator]=function(){return this}),ie;function oe(ae){return function(ge){return se([ae,ge])}}function se(ae){if(K)throw new TypeError("Generator is already executing.");for(;ie&&(ie=0,ae[0]&&(_=0)),_;)try{if(K=1,te&&(ne=ae[0]&2?te.return:ae[0]?te.throw||((ne=te.return)&&ne.call(te),0):te.next)&&!(ne=ne.call(te,ae[1])).done)return ne;switch(te=0,ne&&(ae=[ae[0]&2,ne.value]),ae[0]){case 0:case 1:ne=ae;break;case 4:return _.label++,{value:ae[1],done:!1};case 5:_.label++,te=ae[1],ae=[0];continue;case 7:ae=_.ops.pop(),_.trys.pop();continue;default:if(ne=_.trys,!(ne=ne.length>0&&ne[ne.length-1])&&(ae[0]===6||ae[0]===2)){_=0;continue}if(ae[0]===3&&(!ne||ae[1]>ne[0]&&ae[1]<ne[3])){_.label=ae[1];break}if(ae[0]===6&&_.label<ne[1]){_.label=ne[1],ne=ae;break}if(ne&&_.label<ne[2]){_.label=ne[2],_.ops.push(ae);break}ne[2]&&_.ops.pop(),_.trys.pop();continue}ae=Z.call(X,_)}catch(ge){ae=[6,ge],te=0}finally{K=ne=0}if(ae[0]&5)throw ae[1];return{value:ae[0]?ae[1]:void 0,done:!0}}}function __read(X,Z){var _=typeof Symbol=="function"&&X[Symbol.iterator];if(!_)return X;var K=_.call(X),te,ne=[],ie;try{for(;(Z===void 0||Z-- >0)&&!(te=K.next()).done;)ne.push(te.value)}catch(oe){ie={error:oe}}finally{try{te&&!te.done&&(_=K.return)&&_.call(K)}finally{if(ie)throw ie.error}}return ne}function __spread(){for(var X=[],Z=0;Z<arguments.length;Z++)X=X.concat(__read(arguments[Z]));return X}typeof SuppressedError=="function"&&SuppressedError;var COMMON_MIME_TYPES=new Map([["aac","audio/aac"],["abw","application/x-abiword"],["arc","application/x-freearc"],["avif","image/avif"],["avi","video/x-msvideo"],["azw","application/vnd.amazon.ebook"],["bin","application/octet-stream"],["bmp","image/bmp"],["bz","application/x-bzip"],["bz2","application/x-bzip2"],["cda","application/x-cdf"],["csh","application/x-csh"],["css","text/css"],["csv","text/csv"],["doc","application/msword"],["docx","application/vnd.openxmlformats-officedocument.wordprocessingml.document"],["eot","application/vnd.ms-fontobject"],["epub","application/epub+zip"],["gz","application/gzip"],["gif","image/gif"],["heic","image/heic"],["heif","image/heif"],["htm","text/html"],["html","text/html"],["ico","image/vnd.microsoft.icon"],["ics","text/calendar"],["jar","application/java-archive"],["jpeg","image/jpeg"],["jpg","image/jpeg"],["js","text/javascript"],["json","application/json"],["jsonld","application/ld+json"],["mid","audio/midi"],["midi","audio/midi"],["mjs","text/javascript"],["mp3","audio/mpeg"],["mp4","video/mp4"],["mpeg","video/mpeg"],["mpkg","application/vnd.apple.installer+xml"],["odp","application/vnd.oasis.opendocument.presentation"],["ods","application/vnd.oasis.opendocument.spreadsheet"],["odt","application/vnd.oasis.opendocument.text"],["oga","audio/ogg"],["ogv","video/ogg"],["ogx","application/ogg"],["opus","audio/opus"],["otf","font/otf"],["png","image/png"],["pdf","application/pdf"],["php","application/x-httpd-php"],["ppt","application/vnd.ms-powerpoint"],["pptx","application/vnd.openxmlformats-officedocument.presentationml.presentation"],["rar","application/vnd.rar"],["rtf","application/rtf"],["sh","application/x-sh"],["svg","image/svg+xml"],["swf","application/x-shockwave-flash"],["tar","application/x-tar"],["tif","image/tiff"],["tiff","image/tiff"],["ts","video/mp2t"],["ttf","font/ttf"],["txt","text/plain"],["vsd","application/vnd.visio"],["wav","audio/wav"],["weba","audio/webm"],["webm","video/webm"],["webp","image/webp"],["woff","font/woff"],["woff2","font/woff2"],["xhtml","application/xhtml+xml"],["xls","application/vnd.ms-excel"],["xlsx","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"],["xml","application/xml"],["xul","application/vnd.mozilla.xul+xml"],["zip","application/zip"],["7z","application/x-7z-compressed"],["mkv","video/x-matroska"],["mov","video/quicktime"],["msg","application/vnd.ms-outlook"]]);function toFileWithPath(X,Z){var _=withMimeType(X);if(typeof _.path!="string"){var K=X.webkitRelativePath;Object.defineProperty(_,"path",{value:typeof Z=="string"?Z:typeof K=="string"&&K.length>0?K:X.name,writable:!1,configurable:!1,enumerable:!0})}return _}function withMimeType(X){var Z=X.name,_=Z&&Z.lastIndexOf(".")!==-1;if(_&&!X.type){var K=Z.split(".").pop().toLowerCase(),te=COMMON_MIME_TYPES.get(K);te&&Object.defineProperty(X,"type",{value:te,writable:!1,configurable:!1,enumerable:!0})}return X}var FILES_TO_IGNORE=[".DS_Store","Thumbs.db"];function fromEvent(X){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(Z){return isObject(X)&&isDataTransfer(X)?[2,getDataTransferFiles(X.dataTransfer,X.type)]:isChangeEvt(X)?[2,getInputFiles(X)]:Array.isArray(X)&&X.every(function(_){return"getFile"in _&&typeof _.getFile=="function"})?[2,getFsHandleFiles(X)]:[2,[]]})})}function isDataTransfer(X){return isObject(X.dataTransfer)}function isChangeEvt(X){return isObject(X)&&isObject(X.target)}function isObject(X){return typeof X=="object"&&X!==null}function getInputFiles(X){return fromList(X.target.files).map(function(Z){return toFileWithPath(Z)})}function getFsHandleFiles(X){return __awaiter(this,void 0,void 0,function(){var Z;return __generator(this,function(_){switch(_.label){case 0:return[4,Promise.all(X.map(function(K){return K.getFile()}))];case 1:return Z=_.sent(),[2,Z.map(function(K){return toFileWithPath(K)})]}})})}function getDataTransferFiles(X,Z){return __awaiter(this,void 0,void 0,function(){var _,K;return __generator(this,function(te){switch(te.label){case 0:return X===null?[2,[]]:X.items?(_=fromList(X.items).filter(function(ne){return ne.kind==="file"}),Z!=="drop"?[2,_]:[4,Promise.all(_.map(toFilePromises))]):[3,2];case 1:return K=te.sent(),[2,noIgnoredFiles(flatten(K))];case 2:return[2,noIgnoredFiles(fromList(X.files).map(function(ne){return toFileWithPath(ne)}))]}})})}function noIgnoredFiles(X){return X.filter(function(Z){return FILES_TO_IGNORE.indexOf(Z.name)===-1})}function fromList(X){if(X===null)return[];for(var Z=[],_=0;_<X.length;_++){var K=X[_];Z.push(K)}return Z}function toFilePromises(X){if(typeof X.webkitGetAsEntry!="function")return fromDataTransferItem(X);var Z=X.webkitGetAsEntry();return Z&&Z.isDirectory?fromDirEntry(Z):fromDataTransferItem(X)}function flatten(X){return X.reduce(function(Z,_){return __spread(Z,Array.isArray(_)?flatten(_):[_])},[])}function fromDataTransferItem(X){var Z=X.getAsFile();if(!Z)return Promise.reject(X+" is not a File");var _=toFileWithPath(Z);return Promise.resolve(_)}function fromEntry(X){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(Z){return[2,X.isDirectory?fromDirEntry(X):fromFileEntry(X)]})})}function fromDirEntry(X){var Z=X.createReader();return new Promise(function(_,K){var te=[];function ne(){var ie=this;Z.readEntries(function(oe){return __awaiter(ie,void 0,void 0,function(){var se,ae,ge;return __generator(this,function(ce){switch(ce.label){case 0:if(oe.length)return[3,5];ce.label=1;case 1:return ce.trys.push([1,3,,4]),[4,Promise.all(te)];case 2:return se=ce.sent(),_(se),[3,4];case 3:return ae=ce.sent(),K(ae),[3,4];case 4:return[3,6];case 5:ge=Promise.all(oe.map(fromEntry)),te.push(ge),ne(),ce.label=6;case 6:return[2]}})})},function(oe){K(oe)})}ne()})}function fromFileEntry(X){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(Z){return[2,new Promise(function(_,K){X.file(function(te){var ne=toFileWithPath(te,X.fullPath);_(ne)},function(te){K(te)})})]})})}var es={},hasRequiredEs;function requireEs(){return hasRequiredEs||(hasRequiredEs=1,es.__esModule=!0,es.default=function(X,Z){if(X&&Z){var _=Array.isArray(Z)?Z:Z.split(",");if(_.length===0)return!0;var K=X.name||"",te=(X.type||"").toLowerCase(),ne=te.replace(/\/.*$/,"");return _.some(function(ie){var oe=ie.trim().toLowerCase();return oe.charAt(0)==="."?K.toLowerCase().endsWith(oe):oe.endsWith("/*")?ne===oe.replace(/\/.*$/,""):te===oe})}return!0}),es}var esExports=requireEs();const accepts=getDefaultExportFromCjs(esExports);function ownKeys$2(X,Z){var _=Object.keys(X);if(Object.getOwnPropertySymbols){var K=Object.getOwnPropertySymbols(X);Z&&(K=K.filter(function(te){return Object.getOwnPropertyDescriptor(X,te).enumerable})),_.push.apply(_,K)}return _}function _objectSpread$2(X){for(var Z=1;Z<arguments.length;Z++){var _=arguments[Z]!=null?arguments[Z]:{};Z%2?ownKeys$2(Object(_),!0).forEach(function(K){_defineProperty$2(X,K,_[K])}):Object.getOwnPropertyDescriptors?Object.defineProperties(X,Object.getOwnPropertyDescriptors(_)):ownKeys$2(Object(_)).forEach(function(K){Object.defineProperty(X,K,Object.getOwnPropertyDescriptor(_,K))})}return X}function _defineProperty$2(X,Z,_){return Z in X?Object.defineProperty(X,Z,{value:_,enumerable:!0,configurable:!0,writable:!0}):X[Z]=_,X}function _slicedToArray$1(X,Z){return _arrayWithHoles$1(X)||_iterableToArrayLimit$1(X,Z)||_unsupportedIterableToArray$1(X,Z)||_nonIterableRest$1()}function _nonIterableRest$1(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function _unsupportedIterableToArray$1(X,Z){if(X){if(typeof X=="string")return _arrayLikeToArray$1(X,Z);var _=Object.prototype.toString.call(X).slice(8,-1);if(_==="Object"&&X.constructor&&(_=X.constructor.name),_==="Map"||_==="Set")return Array.from(X);if(_==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(_))return _arrayLikeToArray$1(X,Z)}}function _arrayLikeToArray$1(X,Z){(Z==null||Z>X.length)&&(Z=X.length);for(var _=0,K=new Array(Z);_<Z;_++)K[_]=X[_];return K}function _iterableToArrayLimit$1(X,Z){var _=X==null?null:typeof Symbol<"u"&&X[Symbol.iterator]||X["@@iterator"];if(_!=null){var K=[],te=!0,ne=!1,ie,oe;try{for(_=_.call(X);!(te=(ie=_.next()).done)&&(K.push(ie.value),!(Z&&K.length===Z));te=!0);}catch(se){ne=!0,oe=se}finally{try{!te&&_.return!=null&&_.return()}finally{if(ne)throw oe}}return K}}function _arrayWithHoles$1(X){if(Array.isArray(X))return X}var FILE_INVALID_TYPE="file-invalid-type",FILE_TOO_LARGE="file-too-large",FILE_TOO_SMALL="file-too-small",TOO_MANY_FILES="too-many-files",getInvalidTypeRejectionErr=function(Z){Z=Array.isArray(Z)&&Z.length===1?Z[0]:Z;var _=Array.isArray(Z)?"one of ".concat(Z.join(", ")):Z;return{code:FILE_INVALID_TYPE,message:"File type must be ".concat(_)}},getTooLargeRejectionErr=function(Z){return{code:FILE_TOO_LARGE,message:"File is larger than ".concat(Z," ").concat(Z===1?"byte":"bytes")}},getTooSmallRejectionErr=function(Z){return{code:FILE_TOO_SMALL,message:"File is smaller than ".concat(Z," ").concat(Z===1?"byte":"bytes")}},TOO_MANY_FILES_REJECTION={code:TOO_MANY_FILES,message:"Too many files"};function fileAccepted(X,Z){var _=X.type==="application/x-moz-file"||accepts(X,Z);return[_,_?null:getInvalidTypeRejectionErr(Z)]}function fileMatchSize(X,Z,_){if(isDefined(X.size))if(isDefined(Z)&&isDefined(_)){if(X.size>_)return[!1,getTooLargeRejectionErr(_)];if(X.size<Z)return[!1,getTooSmallRejectionErr(Z)]}else{if(isDefined(Z)&&X.size<Z)return[!1,getTooSmallRejectionErr(Z)];if(isDefined(_)&&X.size>_)return[!1,getTooLargeRejectionErr(_)]}return[!0,null]}function isDefined(X){return X!=null}function allFilesAccepted(X){var Z=X.files,_=X.accept,K=X.minSize,te=X.maxSize,ne=X.multiple,ie=X.maxFiles;return!ne&&Z.length>1||ne&&ie>=1&&Z.length>ie?!1:Z.every(function(oe){var se=fileAccepted(oe,_),ae=_slicedToArray$1(se,1),ge=ae[0],ce=fileMatchSize(oe,K,te),de=_slicedToArray$1(ce,1),Ie=de[0];return ge&&Ie})}function isPropagationStopped(X){return typeof X.isPropagationStopped=="function"?X.isPropagationStopped():typeof X.cancelBubble<"u"?X.cancelBubble:!1}function isEvtWithFiles(X){return X.dataTransfer?Array.prototype.some.call(X.dataTransfer.types,function(Z){return Z==="Files"||Z==="application/x-moz-file"}):!!X.target&&!!X.target.files}function onDocumentDragOver(X){X.preventDefault()}function isIe(X){return X.indexOf("MSIE")!==-1||X.indexOf("Trident/")!==-1}function isEdge(X){return X.indexOf("Edge/")!==-1}function isIeOrEdge(){var X=arguments.length>0&&arguments[0]!==void 0?arguments[0]:window.navigator.userAgent;return isIe(X)||isEdge(X)}function composeEventHandlers(){for(var X=arguments.length,Z=new Array(X),_=0;_<X;_++)Z[_]=arguments[_];return function(K){for(var te=arguments.length,ne=new Array(te>1?te-1:0),ie=1;ie<te;ie++)ne[ie-1]=arguments[ie];return Z.some(function(oe){return!isPropagationStopped(K)&&oe&&oe.apply(void 0,[K].concat(ne)),isPropagationStopped(K)})}}function canUseFileSystemAccessAPI(){return"showOpenFilePicker"in window}function filePickerOptionsTypes(X){return X=typeof X=="string"?X.split(","):X,[{description:"everything",accept:Array.isArray(X)?X.filter(function(Z){return Z==="audio/*"||Z==="video/*"||Z==="image/*"||Z==="text/*"||/\w+\/[-+.\w]+/g.test(Z)}).reduce(function(Z,_){return _objectSpread$2(_objectSpread$2({},Z),{},_defineProperty$2({},_,[]))},{}):{}}]}function isAbort(X){return X instanceof DOMException&&(X.name==="AbortError"||X.code===X.ABORT_ERR)}function isSecurityError(X){return X instanceof DOMException&&(X.name==="SecurityError"||X.code===X.SECURITY_ERR)}var _excluded$8=["children"],_excluded2$2=["open"],_excluded3=["refKey","role","onKeyDown","onFocus","onBlur","onClick","onDragEnter","onDragOver","onDragLeave","onDrop"],_excluded4=["refKey","onChange","onClick"];function _toConsumableArray(X){return _arrayWithoutHoles(X)||_iterableToArray(X)||_unsupportedIterableToArray(X)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function _iterableToArray(X){if(typeof Symbol<"u"&&X[Symbol.iterator]!=null||X["@@iterator"]!=null)return Array.from(X)}function _arrayWithoutHoles(X){if(Array.isArray(X))return _arrayLikeToArray(X)}function _slicedToArray(X,Z){return _arrayWithHoles(X)||_iterableToArrayLimit(X,Z)||_unsupportedIterableToArray(X,Z)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function _unsupportedIterableToArray(X,Z){if(X){if(typeof X=="string")return _arrayLikeToArray(X,Z);var _=Object.prototype.toString.call(X).slice(8,-1);if(_==="Object"&&X.constructor&&(_=X.constructor.name),_==="Map"||_==="Set")return Array.from(X);if(_==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(_))return _arrayLikeToArray(X,Z)}}function _arrayLikeToArray(X,Z){(Z==null||Z>X.length)&&(Z=X.length);for(var _=0,K=new Array(Z);_<Z;_++)K[_]=X[_];return K}function _iterableToArrayLimit(X,Z){var _=X==null?null:typeof Symbol<"u"&&X[Symbol.iterator]||X["@@iterator"];if(_!=null){var K=[],te=!0,ne=!1,ie,oe;try{for(_=_.call(X);!(te=(ie=_.next()).done)&&(K.push(ie.value),!(Z&&K.length===Z));te=!0);}catch(se){ne=!0,oe=se}finally{try{!te&&_.return!=null&&_.return()}finally{if(ne)throw oe}}return K}}function _arrayWithHoles(X){if(Array.isArray(X))return X}function ownKeys$1(X,Z){var _=Object.keys(X);if(Object.getOwnPropertySymbols){var K=Object.getOwnPropertySymbols(X);Z&&(K=K.filter(function(te){return Object.getOwnPropertyDescriptor(X,te).enumerable})),_.push.apply(_,K)}return _}function _objectSpread$1(X){for(var Z=1;Z<arguments.length;Z++){var _=arguments[Z]!=null?arguments[Z]:{};Z%2?ownKeys$1(Object(_),!0).forEach(function(K){_defineProperty$1(X,K,_[K])}):Object.getOwnPropertyDescriptors?Object.defineProperties(X,Object.getOwnPropertyDescriptors(_)):ownKeys$1(Object(_)).forEach(function(K){Object.defineProperty(X,K,Object.getOwnPropertyDescriptor(_,K))})}return X}function _defineProperty$1(X,Z,_){return Z in X?Object.defineProperty(X,Z,{value:_,enumerable:!0,configurable:!0,writable:!0}):X[Z]=_,X}function _objectWithoutProperties$1(X,Z){if(X==null)return{};var _=_objectWithoutPropertiesLoose$1(X,Z),K,te;if(Object.getOwnPropertySymbols){var ne=Object.getOwnPropertySymbols(X);for(te=0;te<ne.length;te++)K=ne[te],!(Z.indexOf(K)>=0)&&Object.prototype.propertyIsEnumerable.call(X,K)&&(_[K]=X[K])}return _}function _objectWithoutPropertiesLoose$1(X,Z){if(X==null)return{};var _={},K=Object.keys(X),te,ne;for(ne=0;ne<K.length;ne++)te=K[ne],!(Z.indexOf(te)>=0)&&(_[te]=X[te]);return _}var Dropzone=reactExports.forwardRef(function(X,Z){var _=X.children,K=_objectWithoutProperties$1(X,_excluded$8),te=useDropzone(K),ne=te.open,ie=_objectWithoutProperties$1(te,_excluded2$2);return reactExports.useImperativeHandle(Z,function(){return{open:ne}},[ne]),React.createElement(reactExports.Fragment,null,_(_objectSpread$1(_objectSpread$1({},ie),{},{open:ne})))});Dropzone.displayName="Dropzone";var defaultProps={disabled:!1,getFilesFromEvent:fromEvent,maxSize:1/0,minSize:0,multiple:!0,maxFiles:0,preventDropOnDocument:!0,noClick:!1,noKeyboard:!1,noDrag:!1,noDragEventsBubbling:!1,validator:null,useFsAccessApi:!0};Dropzone.defaultProps=defaultProps;Dropzone.propTypes={children:PropTypes.func,accept:PropTypes.oneOfType([PropTypes.string,PropTypes.arrayOf(PropTypes.string)]),multiple:PropTypes.bool,preventDropOnDocument:PropTypes.bool,noClick:PropTypes.bool,noKeyboard:PropTypes.bool,noDrag:PropTypes.bool,noDragEventsBubbling:PropTypes.bool,minSize:PropTypes.number,maxSize:PropTypes.number,maxFiles:PropTypes.number,disabled:PropTypes.bool,getFilesFromEvent:PropTypes.func,onFileDialogCancel:PropTypes.func,onFileDialogOpen:PropTypes.func,useFsAccessApi:PropTypes.bool,onDragEnter:PropTypes.func,onDragLeave:PropTypes.func,onDragOver:PropTypes.func,onDrop:PropTypes.func,onDropAccepted:PropTypes.func,onDropRejected:PropTypes.func,validator:PropTypes.func};var initialState={isFocused:!1,isFileDialogActive:!1,isDragActive:!1,isDragAccept:!1,isDragReject:!1,draggedFiles:[],acceptedFiles:[],fileRejections:[]};function useDropzone(){var X=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},Z=_objectSpread$1(_objectSpread$1({},defaultProps),X),_=Z.accept,K=Z.disabled,te=Z.getFilesFromEvent,ne=Z.maxSize,ie=Z.minSize,oe=Z.multiple,se=Z.maxFiles,ae=Z.onDragEnter,ge=Z.onDragLeave,ce=Z.onDragOver,de=Z.onDrop,Ie=Z.onDropAccepted,fe=Z.onDropRejected,be=Z.onFileDialogCancel,Ae=Z.onFileDialogOpen,ye=Z.useFsAccessApi,ve=Z.preventDropOnDocument,Be=Z.noClick,Re=Z.noKeyboard,Ve=Z.noDrag,Ee=Z.noDragEventsBubbling,Ze=Z.validator,_e=reactExports.useMemo(function(){return typeof Ae=="function"?Ae:noop},[Ae]),Fe=reactExports.useMemo(function(){return typeof be=="function"?be:noop},[be]),Te=reactExports.useRef(null),ke=reactExports.useRef(null),Le=reactExports.useReducer(reducer,initialState),Ke=_slicedToArray(Le,2),Ue=Ke[0],rt=Ke[1],tt=Ue.isFocused,at=Ue.isFileDialogActive,ze=Ue.draggedFiles,qe=reactExports.useRef(typeof window<"u"&&window.isSecureContext&&ye&&canUseFileSystemAccessAPI()),Pe=function(){!qe.current&&at&&setTimeout(function(){if(ke.current){var ft=ke.current.files;ft.length||(rt({type:"closeDialog"}),Fe())}},300)};reactExports.useEffect(function(){return window.addEventListener("focus",Pe,!1),function(){window.removeEventListener("focus",Pe,!1)}},[ke,at,Fe,qe]);var Ye=reactExports.useRef([]),$e=function(ft){Te.current&&Te.current.contains(ft.target)||(ft.preventDefault(),Ye.current=[])};reactExports.useEffect(function(){return ve&&(document.addEventListener("dragover",onDocumentDragOver,!1),document.addEventListener("drop",$e,!1)),function(){ve&&(document.removeEventListener("dragover",onDocumentDragOver),document.removeEventListener("drop",$e))}},[Te,ve]);var ut=reactExports.useCallback(function(lt){lt.preventDefault(),lt.persist(),Et(lt),Ye.current=[].concat(_toConsumableArray(Ye.current),[lt.target]),isEvtWithFiles(lt)&&Promise.resolve(te(lt)).then(function(ft){isPropagationStopped(lt)&&!Ee||(rt({draggedFiles:ft,isDragActive:!0,type:"setDraggedFiles"}),ae&&ae(lt))})},[te,ae,Ee]),ot=reactExports.useCallback(function(lt){lt.preventDefault(),lt.persist(),Et(lt);var ft=isEvtWithFiles(lt);if(ft&&lt.dataTransfer)try{lt.dataTransfer.dropEffect="copy"}catch{}return ft&&ce&&ce(lt),!1},[ce,Ee]),gt=reactExports.useCallback(function(lt){lt.preventDefault(),lt.persist(),Et(lt);var ft=Ye.current.filter(function(Wt){return Te.current&&Te.current.contains(Wt)}),St=ft.indexOf(lt.target);St!==-1&&ft.splice(St,1),Ye.current=ft,!(ft.length>0)&&(rt({isDragActive:!1,type:"setDraggedFiles",draggedFiles:[]}),isEvtWithFiles(lt)&&ge&&ge(lt))},[Te,ge,Ee]),ht=reactExports.useCallback(function(lt,ft){var St=[],Wt=[];lt.forEach(function(zt){var $t=fileAccepted(zt,_),rn=_slicedToArray($t,2),Gn=rn[0],en=rn[1],In=fileMatchSize(zt,ie,ne),un=_slicedToArray(In,2),ln=un[0],tn=un[1],Sn=Ze?Ze(zt):null;if(Gn&&ln&&!Sn)St.push(zt);else{var yn=[en,tn];Sn&&(yn=yn.concat(Sn)),Wt.push({file:zt,errors:yn.filter(function(Tn){return Tn})})}}),(!oe&&St.length>1||oe&&se>=1&&St.length>se)&&(St.forEach(function(zt){Wt.push({file:zt,errors:[TOO_MANY_FILES_REJECTION]})}),St.splice(0)),rt({acceptedFiles:St,fileRejections:Wt,type:"setFiles"}),de&&de(St,Wt,ft),Wt.length>0&&fe&&fe(Wt,ft),St.length>0&&Ie&&Ie(St,ft)},[rt,oe,_,ie,ne,se,de,Ie,fe,Ze]),dt=reactExports.useCallback(function(lt){lt.preventDefault(),lt.persist(),Et(lt),Ye.current=[],isEvtWithFiles(lt)&&Promise.resolve(te(lt)).then(function(ft){isPropagationStopped(lt)&&!Ee||ht(ft,lt)}),rt({type:"reset"})},[te,ht,Ee]),bt=reactExports.useCallback(function(){if(qe.current){rt({type:"openDialog"}),_e();var lt={multiple:oe,types:filePickerOptionsTypes(_)};window.showOpenFilePicker(lt).then(function(ft){return te(ft)}).then(function(ft){ht(ft,null),rt({type:"closeDialog"})}).catch(function(ft){isAbort(ft)?(Fe(ft),rt({type:"closeDialog"})):isSecurityError(ft)&&(qe.current=!1,ke.current&&(ke.current.value=null,ke.current.click()))});return}ke.current&&(rt({type:"openDialog"}),_e(),ke.current.value=null,ke.current.click())},[rt,_e,Fe,ye,ht,_,oe]),Ht=reactExports.useCallback(function(lt){!Te.current||!Te.current.isEqualNode(lt.target)||(lt.key===" "||lt.key==="Enter"||lt.keyCode===32||lt.keyCode===13)&&(lt.preventDefault(),bt())},[Te,bt]),Dt=reactExports.useCallback(function(){rt({type:"focus"})},[]),Vt=reactExports.useCallback(function(){rt({type:"blur"})},[]),mt=reactExports.useCallback(function(){Be||(isIeOrEdge()?setTimeout(bt,0):bt())},[Be,bt]),Ft=function(ft){return K?null:ft},it=function(ft){return Re?null:Ft(ft)},Lt=function(ft){return Ve?null:Ft(ft)},Et=function(ft){Ee&&ft.stopPropagation()},Ut=reactExports.useMemo(function(){return function(){var lt=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},ft=lt.refKey,St=ft===void 0?"ref":ft,Wt=lt.role,zt=lt.onKeyDown,$t=lt.onFocus,rn=lt.onBlur,Gn=lt.onClick,en=lt.onDragEnter,In=lt.onDragOver,un=lt.onDragLeave,ln=lt.onDrop,tn=_objectWithoutProperties$1(lt,_excluded3);return _objectSpread$1(_objectSpread$1(_defineProperty$1({onKeyDown:it(composeEventHandlers(zt,Ht)),onFocus:it(composeEventHandlers($t,Dt)),onBlur:it(composeEventHandlers(rn,Vt)),onClick:Ft(composeEventHandlers(Gn,mt)),onDragEnter:Lt(composeEventHandlers(en,ut)),onDragOver:Lt(composeEventHandlers(In,ot)),onDragLeave:Lt(composeEventHandlers(un,gt)),onDrop:Lt(composeEventHandlers(ln,dt)),role:typeof Wt=="string"&&Wt!==""?Wt:"button"},St,Te),!K&&!Re?{tabIndex:0}:{}),tn)}},[Te,Ht,Dt,Vt,mt,ut,ot,gt,dt,Re,Ve,K]),Zt=reactExports.useCallback(function(lt){lt.stopPropagation()},[]),Ot=reactExports.useMemo(function(){return function(){var lt=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},ft=lt.refKey,St=ft===void 0?"ref":ft,Wt=lt.onChange,zt=lt.onClick,$t=_objectWithoutProperties$1(lt,_excluded4),rn=_defineProperty$1({accept:_,multiple:oe,type:"file",style:{display:"none"},onChange:Ft(composeEventHandlers(Wt,dt)),onClick:Ft(composeEventHandlers(zt,Zt)),tabIndex:-1},St,ke);return _objectSpread$1(_objectSpread$1({},rn),$t)}},[ke,_,oe,dt,K]),Tt=ze.length,Je=Tt>0&&allFilesAccepted({files:ze,accept:_,minSize:ie,maxSize:ne,multiple:oe,maxFiles:se}),Oe=Tt>0&&!Je;return _objectSpread$1(_objectSpread$1({},Ue),{},{isDragAccept:Je,isDragReject:Oe,isFocused:tt&&!K,getRootProps:Ut,getInputProps:Ot,rootRef:Te,inputRef:ke,open:Ft(bt)})}function reducer(X,Z){switch(Z.type){case"focus":return _objectSpread$1(_objectSpread$1({},X),{},{isFocused:!0});case"blur":return _objectSpread$1(_objectSpread$1({},X),{},{isFocused:!1});case"openDialog":return _objectSpread$1(_objectSpread$1({},initialState),{},{isFileDialogActive:!0});case"closeDialog":return _objectSpread$1(_objectSpread$1({},X),{},{isFileDialogActive:!1});case"setDraggedFiles":var _=Z.isDragActive,K=Z.draggedFiles;return _objectSpread$1(_objectSpread$1({},X),{},{draggedFiles:K,isDragActive:_});case"setFiles":return _objectSpread$1(_objectSpread$1({},X),{},{acceptedFiles:Z.acceptedFiles,fileRejections:Z.fileRejections});case"reset":return _objectSpread$1({},initialState);default:return X}}function noop(){}function createStore(X){let Z;const _=new Set,K=(ae,ge)=>{const ce=typeof ae=="function"?ae(Z):ae;if(ce!==Z){const de=Z;Z=ge?ce:Object.assign({},Z,ce),_.forEach(Ie=>Ie(Z,de))}},te=()=>Z,ne=(ae,ge=te,ce=Object.is)=>{console.warn("[DEPRECATED] Please use `subscribeWithSelector` middleware");let de=ge(Z);function Ie(){const fe=ge(Z);if(!ce(de,fe)){const be=de;ae(de=fe,be)}}return _.add(Ie),()=>_.delete(Ie)},se={setState:K,getState:te,subscribe:(ae,ge,ce)=>ge||ce?ne(ae,ge,ce):(_.add(ae),()=>_.delete(ae)),destroy:()=>_.clear()};return Z=X(K,te,se),se}const isSSR=typeof window>"u"||!window.navigator||/ServerSideRendering|^Deno\//.test(window.navigator.userAgent),useIsomorphicLayoutEffect=isSSR?reactExports.useEffect:reactExports.useLayoutEffect;function create(X){const Z=typeof X=="function"?createStore(X):X,_=(K=Z.getState,te=Object.is)=>{const[,ne]=reactExports.useReducer(Ae=>Ae+1,0),ie=Z.getState(),oe=reactExports.useRef(ie),se=reactExports.useRef(K),ae=reactExports.useRef(te),ge=reactExports.useRef(!1),ce=reactExports.useRef();ce.current===void 0&&(ce.current=K(ie));let de,Ie=!1;(oe.current!==ie||se.current!==K||ae.current!==te||ge.current)&&(de=K(ie),Ie=!te(ce.current,de)),useIsomorphicLayoutEffect(()=>{Ie&&(ce.current=de),oe.current=ie,se.current=K,ae.current=te,ge.current=!1});const fe=reactExports.useRef(ie);useIsomorphicLayoutEffect(()=>{const Ae=()=>{try{const ve=Z.getState(),Be=se.current(ve);ae.current(ce.current,Be)||(oe.current=ve,ce.current=Be,ne())}catch{ge.current=!0,ne()}},ye=Z.subscribe(Ae);return Z.getState()!==fe.current&&Ae(),ye},[]);const be=Ie?de:ce.current;return reactExports.useDebugValue(be),be};return Object.assign(_,Z),_[Symbol.iterator]=function(){console.warn("[useStore, api] = create() is deprecated and will be removed in v4");const K=[_,Z];return{next(){const te=K.length<=0;return{value:K.shift(),done:te}}}},_}const subscribeWithSelector=X=>(Z,_,K)=>{const te=K.subscribe;return K.subscribe=(ie,oe,se)=>{let ae=ie;if(oe){const ge=(se==null?void 0:se.equalityFn)||Object.is;let ce=ie(K.getState());ae=de=>{const Ie=ie(de);if(!ge(ce,Ie)){const fe=ce;oe(ce=Ie,fe)}},se!=null&&se.fireImmediately&&oe(ce,ce)}return te(ae)},X(Z,_,K)};/*!
 * isobject <https://github.com/jonschlinkert/isobject>
 *
 * Copyright (c) 2014-2017, Jon Schlinkert.
 * Released under the MIT License.
 */var isobject,hasRequiredIsobject;function requireIsobject(){return hasRequiredIsobject||(hasRequiredIsobject=1,isobject=function(Z){return Z!=null&&typeof Z=="object"&&Array.isArray(Z)===!1}),isobject}/*!
 * is-plain-object <https://github.com/jonschlinkert/is-plain-object>
 *
 * Copyright (c) 2014-2017, Jon Schlinkert.
 * Released under the MIT License.
 */var isPlainObject,hasRequiredIsPlainObject;function requireIsPlainObject(){if(hasRequiredIsPlainObject)return isPlainObject;hasRequiredIsPlainObject=1;var X=requireIsobject();function Z(_){return X(_)===!0&&Object.prototype.toString.call(_)==="[object Object]"}return isPlainObject=function(K){var te,ne;return!(Z(K)===!1||(te=K.constructor,typeof te!="function")||(ne=te.prototype,Z(ne)===!1)||ne.hasOwnProperty("isPrototypeOf")===!1)},isPlainObject}/*!
 * is-extendable <https://github.com/jonschlinkert/is-extendable>
 *
 * Copyright (c) 2015-2017, Jon Schlinkert.
 * Released under the MIT License.
 */var isExtendable$2,hasRequiredIsExtendable$2;function requireIsExtendable$2(){if(hasRequiredIsExtendable$2)return isExtendable$2;hasRequiredIsExtendable$2=1;var X=requireIsPlainObject();return isExtendable$2=function(_){return X(_)||typeof _=="function"||Array.isArray(_)},isExtendable$2}/*!
 * for-in <https://github.com/jonschlinkert/for-in>
 *
 * Copyright (c) 2014-2017, Jon Schlinkert.
 * Released under the MIT License.
 */var forIn,hasRequiredForIn;function requireForIn(){return hasRequiredForIn||(hasRequiredForIn=1,forIn=function(Z,_,K){for(var te in Z)if(_.call(K,Z[te],te,Z)===!1)break}),forIn}var mixinDeep_1,hasRequiredMixinDeep;function requireMixinDeep(){if(hasRequiredMixinDeep)return mixinDeep_1;hasRequiredMixinDeep=1;var X=requireIsExtendable$2(),Z=requireForIn();function _(ie,oe){for(var se=arguments.length,ae=0;++ae<se;){var ge=arguments[ae];te(ge)&&Z(ge,K,ie)}return ie}function K(ie,oe){if(ne(oe)){var se=this[oe];te(ie)&&te(se)?_(se,ie):this[oe]=ie}}function te(ie){return X(ie)&&!Array.isArray(ie)}function ne(ie){return ie!=="__proto__"&&ie!=="constructor"&&ie!=="prototype"}return mixinDeep_1=_,mixinDeep_1}/*!
 * get-value <https://github.com/jonschlinkert/get-value>
 *
 * Copyright (c) 2014-2015, Jon Schlinkert.
 * Licensed under the MIT License.
 */var getValue$1,hasRequiredGetValue;function requireGetValue(){if(hasRequiredGetValue)return getValue$1;hasRequiredGetValue=1,getValue$1=function(_,K,te,ne,ie){if(!X(_)||!K)return _;if(K=Z(K),te&&(K+="."+Z(te)),ne&&(K+="."+Z(ne)),ie&&(K+="."+Z(ie)),K in _)return _[K];for(var oe=K.split("."),se=oe.length,ae=-1;_&&++ae<se;){for(var ge=oe[ae];ge[ge.length-1]==="\\";)ge=ge.slice(0,-1)+"."+oe[++ae];_=_[ge]}return _};function X(_){return _!==null&&(typeof _=="object"||typeof _=="function")}function Z(_){return _?Array.isArray(_)?_.join("."):_:""}return getValue$1}/*!
 * assign-symbols <https://github.com/jonschlinkert/assign-symbols>
 *
 * Copyright (c) 2015, Jon Schlinkert.
 * Licensed under the MIT License.
 */var assignSymbols,hasRequiredAssignSymbols;function requireAssignSymbols(){return hasRequiredAssignSymbols||(hasRequiredAssignSymbols=1,assignSymbols=function(X,Z){if(X===null||typeof X>"u")throw new TypeError("expected first argument to be an object.");if(typeof Z>"u"||typeof Symbol>"u"||typeof Object.getOwnPropertySymbols!="function")return X;for(var _=Object.prototype.propertyIsEnumerable,K=Object(X),te=arguments.length,ne=0;++ne<te;)for(var ie=Object(arguments[ne]),oe=Object.getOwnPropertySymbols(ie),se=0;se<oe.length;se++){var ae=oe[se];_.call(ie,ae)&&(K[ae]=ie[ae])}return K}),assignSymbols}var extendShallow$1,hasRequiredExtendShallow$1;function requireExtendShallow$1(){if(hasRequiredExtendShallow$1)return extendShallow$1;hasRequiredExtendShallow$1=1;var X=requireIsExtendable$2(),Z=requireAssignSymbols();extendShallow$1=Object.assign||function(oe){if(oe===null||typeof oe>"u")throw new TypeError("Cannot convert undefined or null to object");ne(oe)||(oe={});for(var se=1;se<arguments.length;se++){var ae=arguments[se];K(ae)&&(ae=te(ae)),ne(ae)&&(_(oe,ae),Z(oe,ae))}return oe};function _(oe,se){for(var ae in se)ie(se,ae)&&(oe[ae]=se[ae])}function K(oe){return oe&&typeof oe=="string"}function te(oe){var se={};for(var ae in oe)se[ae]=oe[ae];return se}function ne(oe){return oe&&typeof oe=="object"||X(oe)}function ie(oe,se){return Object.prototype.hasOwnProperty.call(oe,se)}return extendShallow$1}/*!
 * split-string <https://github.com/jonschlinkert/split-string>
 *
 * Copyright (c) 2015-2017, Jon Schlinkert.
 * Released under the MIT License.
 */var splitString,hasRequiredSplitString;function requireSplitString(){if(hasRequiredSplitString)return splitString;hasRequiredSplitString=1;var X=requireExtendShallow$1();splitString=function(te,ne,ie){if(typeof te!="string")throw new TypeError("expected a string");typeof ne=="function"&&(ie=ne,ne=null),typeof ne=="string"&&(ne={sep:ne});var oe=X({sep:"."},ne),se=oe.quotes||['"',"'","`"],ae;oe.brackets===!0?ae={"<":">","(":")","[":"]","{":"}"}:oe.brackets&&(ae=oe.brackets);var ge=[],ce=[],de=[""],Ie=oe.sep,fe=te.length,be=-1,Ae;function ye(){if(ae&&ce.length)return ae[ce[ce.length-1]]}for(;++be<fe;){var ve=te[be],Be=te[be+1],Re={val:ve,idx:be,arr:de,str:te};if(ge.push(Re),ve==="\\"){Re.val=K(oe,te,be)===!0?ve+Be:Be,Re.escaped=!0,typeof ie=="function"&&ie(Re),de[de.length-1]+=Re.val,be++;continue}if(ae&&ae[ve]){ce.push(ve);var Ve=ye(),Ee=be+1;if(te.indexOf(Ve,Ee+1)!==-1)for(;ce.length&&Ee<fe;){var Ze=te[++Ee];if(Ze==="\\"){Ze++;continue}if(se.indexOf(Ze)!==-1){Ee=Z(te,Ze,Ee+1);continue}if(Ve=ye(),ce.length&&te.indexOf(Ve,Ee+1)===-1)break;if(ae[Ze]){ce.push(Ze);continue}Ve===Ze&&ce.pop()}if(Ae=Ee,Ae===-1){de[de.length-1]+=ve;continue}ve=te.slice(be,Ae+1),Re.val=ve,Re.idx=be=Ae}if(se.indexOf(ve)!==-1){if(Ae=Z(te,ve,be+1),Ae===-1){de[de.length-1]+=ve;continue}_(ve,oe)===!0?ve=te.slice(be,Ae+1):ve=te.slice(be+1,Ae),Re.val=ve,Re.idx=be=Ae}if(typeof ie=="function"&&(ie(Re,ge),ve=Re.val,be=Re.idx),Re.val===Ie&&Re.split!==!1){de.push("");continue}de[de.length-1]+=Re.val}return de};function Z(te,ne,ie,oe){var se=te.indexOf(ne,ie);return te.charAt(se-1)==="\\"?Z(te,ne,se+1):se}function _(te,ne){return ne.keepDoubleQuotes===!0&&te==='"'||ne.keepSingleQuotes===!0&&te==="'"?!0:ne.keepQuotes}function K(te,ne,ie){return typeof te.keepEscaping=="function"?te.keepEscaping(ne,ie):te.keepEscaping===!0||ne[ie+1]==="\\"}return splitString}/*!
 * is-extendable <https://github.com/jonschlinkert/is-extendable>
 *
 * Copyright (c) 2015, Jon Schlinkert.
 * Licensed under the MIT License.
 */var isExtendable$1,hasRequiredIsExtendable$1;function requireIsExtendable$1(){return hasRequiredIsExtendable$1||(hasRequiredIsExtendable$1=1,isExtendable$1=function(Z){return typeof Z<"u"&&Z!==null&&(typeof Z=="object"||typeof Z=="function")}),isExtendable$1}var extendShallow,hasRequiredExtendShallow;function requireExtendShallow(){if(hasRequiredExtendShallow)return extendShallow;hasRequiredExtendShallow=1;var X=requireIsExtendable$1();extendShallow=function(te){X(te)||(te={});for(var ne=arguments.length,ie=1;ie<ne;ie++){var oe=arguments[ie];X(oe)&&Z(te,oe)}return te};function Z(K,te){for(var ne in te)_(te,ne)&&(K[ne]=te[ne])}function _(K,te){return Object.prototype.hasOwnProperty.call(K,te)}return extendShallow}/*!
 * is-extendable <https://github.com/jonschlinkert/is-extendable>
 *
 * Copyright (c) 2015, Jon Schlinkert.
 * Licensed under the MIT License.
 */var isExtendable,hasRequiredIsExtendable;function requireIsExtendable(){return hasRequiredIsExtendable||(hasRequiredIsExtendable=1,isExtendable=function(Z){return typeof Z<"u"&&Z!==null&&(typeof Z=="object"||typeof Z=="function")}),isExtendable}/*!
 * set-value <https://github.com/jonschlinkert/set-value>
 *
 * Copyright (c) 2014-2015, 2017, Jon Schlinkert.
 * Released under the MIT License.
 */var setValue,hasRequiredSetValue;function requireSetValue(){if(hasRequiredSetValue)return setValue;hasRequiredSetValue=1;var X=requireSplitString(),Z=requireExtendShallow(),_=requireIsPlainObject(),K=requireIsExtendable();setValue=function(ne,ie,oe){if(!K(ne)||(Array.isArray(ie)&&(ie=[].concat.apply([],ie).join(".")),typeof ie!="string"))return ne;for(var se=X(ie,{sep:".",brackets:!0}).filter(te),ae=se.length,ge=-1,ce=ne;++ge<ae;){var de=se[ge];if(ge!==ae-1){K(ce[de])||(ce[de]={}),ce=ce[de];continue}_(ce[de])&&_(oe)?ce[de]=Z({},ce[de],oe):ce[de]=oe}return ne};function te(ne){return ne!=="__proto__"&&ne!=="constructor"&&ne!=="prototype"}return setValue}var mergeValue,hasRequiredMergeValue;function requireMergeValue(){if(hasRequiredMergeValue)return mergeValue;hasRequiredMergeValue=1;var X=requireIsExtendable$2(),Z=requireMixinDeep(),_=requireGetValue(),K=requireSetValue();return mergeValue=function(ne,ie,oe){if(!X(ne))throw new TypeError("expected an object");if(typeof ie!="string"||oe==null)return Z.apply(null,arguments);if(typeof oe=="string")return K(ne,ie,oe),ne;var se=_(ne,ie);return X(oe)&&X(se)&&(oe=Z({},se,oe)),K(ne,ie,oe),ne},mergeValue}var mergeValueExports=requireMergeValue();const merge=getDefaultExportFromCjs(mergeValueExports),join=(...X)=>X.filter(Boolean).join(".");function getKeyPath(X){const Z=X.split(".");return[Z.pop(),Z.join(".")||void 0]}function getValuesForPaths(X,Z){return Object.entries(pick(X,Z)).reduce((_,[,{value:K,disabled:te,key:ne}])=>(_[ne]=te?void 0:K,_),{})}function useCompareMemoize(X,Z){const _=reactExports.useRef();return dequal(X,_.current)||(_.current=X),_.current}function useDeepMemo(X,Z){return reactExports.useMemo(X,useCompareMemoize(Z))}function useToggle(X){const Z=reactExports.useRef(null),_=reactExports.useRef(null),K=reactExports.useRef(!0);return reactExports.useLayoutEffect(()=>{X||(Z.current.style.height="0px",Z.current.style.overflow="hidden")},[]),reactExports.useEffect(()=>{if(K.current){K.current=!1;return}let te;const ne=Z.current,ie=()=>{X&&(ne.style.removeProperty("height"),ne.style.removeProperty("overflow"),_.current.scrollIntoView({behavior:"smooth",block:"nearest"}))};ne.addEventListener("transitionend",ie,{once:!0});const{height:oe}=_.current.getBoundingClientRect();return ne.style.height=oe+"px",X||(ne.style.overflow="hidden",te=window.setTimeout(()=>ne.style.height="0px",50)),()=>{ne.removeEventListener("transitionend",ie),clearTimeout(te)}},[X]),{wrapperRef:Z,contentRef:_}}const useVisiblePaths=X=>{const[Z,_]=reactExports.useState(X.getVisiblePaths());return reactExports.useEffect(()=>{_(X.getVisiblePaths());const K=X.useStore.subscribe(X.getVisiblePaths,_,{equalityFn:shallow});return()=>K()},[X]),Z};function useValuesForPath(X,Z,_){return X.useStore(te=>{const ne=_objectSpread2(_objectSpread2({},_),te.data);return getValuesForPaths(ne,Z)},shallow)}function usePopin(X=3){const Z=reactExports.useRef(null),_=reactExports.useRef(null),[K,te]=reactExports.useState(!1),ne=reactExports.useCallback(()=>te(!0),[]),ie=reactExports.useCallback(()=>te(!1),[]);return reactExports.useLayoutEffect(()=>{if(K){const{bottom:oe,top:se,left:ae}=Z.current.getBoundingClientRect(),{height:ge}=_.current.getBoundingClientRect(),ce=oe+ge>window.innerHeight-40?"up":"down";_.current.style.position="fixed",_.current.style.zIndex="10000",_.current.style.left=ae+"px",ce==="down"?_.current.style.top=oe+X+"px":_.current.style.bottom=window.innerHeight-se+X+"px"}},[X,K]),{popinRef:Z,wrapperRef:_,shown:K,show:ne,hide:ie}}k$1([namesPlugin]);const convertMap={rgb:"toRgb",hsl:"toHsl",hsv:"toHsv",hex:"toHex"};v8n.extend({color:()=>X=>w(X).isValid()});const schema$2=X=>v8n().color().test(X);function convert(X,{format:Z,hasAlpha:_,isString:K}){const te=convertMap[Z]+(K&&Z!=="hex"?"String":""),ne=X[te]();return typeof ne=="object"&&!_?omit(ne,["a"]):ne}const sanitize$2=(X,Z)=>{const _=w(X);if(!_.isValid())throw Error("Invalid color");return convert(_,Z)},format$1=(X,Z)=>convert(w(X),_objectSpread2(_objectSpread2({},Z),{},{isString:!0,format:"hex"})),normalize$3=({value:X})=>{const Z=I$1(X),_=Z==="name"?"hex":Z,K=typeof X=="object"?"a"in X:Z==="hex"&&X.length===8||/^(rgba)|(hsla)|(hsva)/.test(X),te={format:_,hasAlpha:K,isString:typeof X=="string"};return{value:sanitize$2(X,te),settings:te}};var props$2=Object.freeze({__proto__:null,schema:schema$2,sanitize:sanitize$2,format:format$1,normalize:normalize$3});const ColorPreview=styled("div",{position:"relative",boxSizing:"border-box",borderRadius:"$sm",overflow:"hidden",cursor:"pointer",height:"$rowHeight",width:"$rowHeight",backgroundColor:"#fff",backgroundImage:`url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill-opacity=".05"><path d="M8 0h8v8H8zM0 8h8v8H0z"/></svg>')`,$inputStyle:"",$hover:"",zIndex:1,variants:{active:{true:{$inputStyle:"$accent1"}}},"&::before":{content:'""',position:"absolute",top:0,bottom:0,right:0,left:0,backgroundColor:"currentColor",zIndex:1}}),PickerContainer=styled("div",{position:"relative",display:"grid",gridTemplateColumns:"$sizes$rowHeight auto",columnGap:"$colGap",alignItems:"center"}),PickerWrapper=styled("div",{width:"$colorPickerWidth",height:"$colorPickerHeight",".react-colorful":{width:"100%",height:"100%",boxShadow:"$level2",cursor:"crosshair"},".react-colorful__saturation":{borderRadius:"$sm $sm 0 0"},".react-colorful__alpha, .react-colorful__hue":{height:10},".react-colorful__last-control":{borderRadius:"0 0 $sm $sm"},".react-colorful__pointer":{height:12,width:12}});function convertToRgb(X,Z){return Z!=="rgb"?w(X).toRgb():X}function Color({value:X,displayValue:Z,settings:_,onUpdate:K}){const{emitOnEditStart:te,emitOnEditEnd:ne}=useInputContext(),{format:ie,hasAlpha:oe}=_,{popinRef:se,wrapperRef:ae,shown:ge,show:ce,hide:de}=usePopin(),Ie=reactExports.useRef(0),[fe,be]=reactExports.useState(()=>convertToRgb(X,ie)),Ae=oe?Ce:Ne,ye=()=>{be(convertToRgb(X,ie)),ce(),te()},ve=()=>{de(),ne(),window.clearTimeout(Ie.current)},Be=()=>{Ie.current=window.setTimeout(ve,500)};return reactExports.useEffect(()=>()=>window.clearTimeout(Ie.current),[]),React.createElement(React.Fragment,null,React.createElement(ColorPreview,{ref:se,active:ge,onClick:()=>ye(),style:{color:Z}}),ge&&React.createElement(Portal,null,React.createElement(Overlay,{onPointerUp:ve}),React.createElement(PickerWrapper,{ref:ae,onMouseEnter:()=>window.clearTimeout(Ie.current),onMouseLeave:Re=>Re.buttons===0&&Be()},React.createElement(Ae,{color:fe,onChange:K}))))}function ColorComponent(){const{value:X,displayValue:Z,label:_,onChange:K,onUpdate:te,settings:ne}=useInputContext();return React.createElement(Row,{input:!0},React.createElement(Label,null,_),React.createElement(PickerContainer,null,React.createElement(Color,{value:X,displayValue:Z,onChange:K,onUpdate:te,settings:ne}),React.createElement(ValueInput,{value:Z,onChange:K,onUpdate:te})))}var color=_objectSpread2({component:ColorComponent},props$2);function Vector3dComponent(){const{label:X,displayValue:Z,onUpdate:_,settings:K}=useInputContext();return React.createElement(Row,{input:!0},React.createElement(Label,null,X),React.createElement(Vector,{value:Z,settings:K,onUpdate:_}))}var vector3d=_objectSpread2({component:Vector3dComponent},getVectorPlugin(["x","y","z"]));const JoystickTrigger=styled("div",{$flexCenter:"",position:"relative",backgroundColor:"$elevation3",borderRadius:"$sm",cursor:"pointer",height:"$rowHeight",width:"$rowHeight",touchAction:"none",$draggable:"",$hover:"","&:active":{cursor:"none"},"&::after":{content:'""',backgroundColor:"$accent2",height:4,width:4,borderRadius:2}}),JoystickPlayground=styled("div",{$flexCenter:"",width:"$joystickWidth",height:"$joystickHeight",borderRadius:"$sm",boxShadow:"$level2",position:"fixed",zIndex:1e4,overflow:"hidden",$draggable:"",transform:"translate(-50%, -50%)",variants:{isOutOfBounds:{true:{backgroundColor:"$elevation1"},false:{backgroundColor:"$elevation3"}}},"> div":{position:"absolute",$flexCenter:"",borderStyle:"solid",borderWidth:1,borderColor:"$highlight1",backgroundColor:"$elevation3",width:"80%",height:"80%","&::after,&::before":{content:'""',position:"absolute",zindex:10,backgroundColor:"$highlight1"},"&::before":{width:"100%",height:1},"&::after":{height:"100%",width:1}},"> span":{position:"relative",zindex:100,width:10,height:10,backgroundColor:"$accent2",borderRadius:"50%"}});function Joystick({value:X,settings:Z,onUpdate:_}){const K=reactExports.useRef(),te=reactExports.useRef(0),ne=reactExports.useRef(0),ie=reactExports.useRef(1),[oe,se]=reactExports.useState(!1),[ae,ge]=reactExports.useState(!1),[ce,de]=useTransform(),Ie=reactExports.useRef(null),fe=reactExports.useRef(null);reactExports.useLayoutEffect(()=>{if(oe){const{top:Le,left:Ke,width:Ue,height:rt}=Ie.current.getBoundingClientRect();fe.current.style.left=Ke+Ue/2+"px",fe.current.style.top=Le+rt/2+"px"}},[oe]);const{keys:[be,Ae],joystick:ye}=Z,ve=ye==="invertY"?1:-1,{[be]:{step:Be},[Ae]:{step:Re}}=Z,Ve=useTh("sizes","joystickWidth"),Ee=useTh("sizes","joystickHeight"),Ze=parseFloat(Ve)*.8/2,_e=parseFloat(Ee)*.8/2,Fe=reactExports.useCallback(()=>{K.current||(ge(!0),te.current&&de({x:te.current*Ze}),ne.current&&de({y:ne.current*-_e}),K.current=window.setInterval(()=>{_(Le=>{const Ke=Be*te.current*ie.current,Ue=ve*Re*ne.current*ie.current;return Array.isArray(Le)?{[be]:Le[0]+Ke,[Ae]:Le[1]+Ue}:{[be]:Le[be]+Ke,[Ae]:Le[Ae]+Ue}})},16))},[Ze,_e,_,de,Be,Re,be,Ae,ve]),Te=reactExports.useCallback(()=>{window.clearTimeout(K.current),K.current=void 0,ge(!1)},[]);reactExports.useEffect(()=>{function Le(Ke){ie.current=multiplyStep(Ke)}return window.addEventListener("keydown",Le),window.addEventListener("keyup",Le),()=>{window.clearTimeout(K.current),window.removeEventListener("keydown",Le),window.removeEventListener("keyup",Le)}},[]);const ke=useDrag(({first:Le,active:Ke,delta:[Ue,rt],movement:[tt,at]})=>{Le&&se(!0);const ze=clamp(tt,-Ze,Ze),qe=clamp(at,-_e,_e);te.current=Math.abs(tt)>Math.abs(ze)?Math.sign(tt-ze):0,ne.current=Math.abs(at)>Math.abs(qe)?Math.sign(qe-at):0;let Pe=X[be],Ye=X[Ae];Ke?(te.current||(Pe+=Ue*Be*ie.current,de({x:ze})),ne.current||(Ye-=ve*rt*Re*ie.current,de({y:qe})),te.current||ne.current?Fe():Te(),_({[be]:Pe,[Ae]:Ye})):(se(!1),te.current=0,ne.current=0,de({x:0,y:0}),Te())});return React.createElement(JoystickTrigger,_extends$1({ref:Ie},ke()),oe&&React.createElement(Portal,null,React.createElement(JoystickPlayground,{ref:fe,isOutOfBounds:ae},React.createElement("div",null),React.createElement("span",{ref:ce}))))}const Container$1=styled("div",{display:"grid",columnGap:"$colGap",variants:{withJoystick:{true:{gridTemplateColumns:"$sizes$rowHeight auto"},false:{gridTemplateColumns:"auto"}}}});function Vector2dComponent(){const{label:X,displayValue:Z,onUpdate:_,settings:K}=useInputContext();return React.createElement(Row,{input:!0},React.createElement(Label,null,X),React.createElement(Container$1,{withJoystick:!!K.joystick},K.joystick&&React.createElement(Joystick,{value:Z,settings:K,onUpdate:_}),React.createElement(Vector,{value:Z,settings:K,onUpdate:_})))}const _excluded$7=["joystick"],plugin=getVectorPlugin(["x","y"]),normalize$2=X=>{let{joystick:Z=!0}=X,_=_objectWithoutProperties$2(X,_excluded$7);const{value:K,settings:te}=plugin.normalize(_);return{value:K,settings:_objectSpread2(_objectSpread2({},te),{},{joystick:Z})}};var vector2d=_objectSpread2(_objectSpread2({component:Vector2dComponent},plugin),{},{normalize:normalize$2});const sanitize$1=X=>{if(X!==void 0){if(X instanceof File)try{return URL.createObjectURL(X)}catch{return}if(typeof X=="string"&&X.indexOf("blob:")===0)return X;throw Error("Invalid image format [undefined | blob | File].")}},schema$1=(X,Z)=>typeof Z=="object"&&"image"in Z,normalize$1=({image:X})=>({value:X});var props$1=Object.freeze({__proto__:null,sanitize:sanitize$1,schema:schema$1,normalize:normalize$1});const ImageContainer=styled("div",{position:"relative",display:"grid",gridTemplateColumns:"$sizes$rowHeight auto 20px",columnGap:"$colGap",alignItems:"center"}),DropZone=styled("div",{$flexCenter:"",overflow:"hidden",height:"$rowHeight",background:"$elevation3",textAlign:"center",color:"inherit",borderRadius:"$sm",outline:"none",userSelect:"none",cursor:"pointer",$inputStyle:"",$hover:"",$focusWithin:"",$active:"$accent1 $elevation1",variants:{isDragAccept:{true:{$inputStyle:"$accent1",backgroundColor:"$elevation1"}}}}),ImagePreview=styled("div",{boxSizing:"border-box",borderRadius:"$sm",height:"$rowHeight",width:"$rowHeight",$inputStyle:"",backgroundSize:"cover",backgroundPosition:"center",variants:{hasImage:{true:{cursor:"pointer",$hover:"",$active:""}}}}),ImageLargePreview=styled("div",{$flexCenter:"",width:"$imagePreviewWidth",height:"$imagePreviewHeight",borderRadius:"$sm",boxShadow:"$level2",pointerEvents:"none",$inputStyle:"",backgroundSize:"cover",backgroundPosition:"center"}),Instructions=styled("div",{fontSize:"0.8em",height:"100%",padding:"$rowGap $md"}),Remove=styled("div",{$flexCenter:"",top:"0",right:"0",marginRight:"$sm",height:"100%",cursor:"pointer",variants:{disabled:{true:{color:"$elevation3",cursor:"default"}}},"&::after,&::before":{content:'""',position:"absolute",height:2,width:10,borderRadius:1,backgroundColor:"currentColor"},"&::after":{transform:"rotate(45deg)"},"&::before":{transform:"rotate(-45deg)"}});function ImageComponent(){const{label:X,value:Z,onUpdate:_,disabled:K}=useInputContext(),{popinRef:te,wrapperRef:ne,shown:ie,show:oe,hide:se}=usePopin(),ae=reactExports.useCallback(fe=>{fe.length&&_(fe[0])},[_]),ge=reactExports.useCallback(fe=>{fe.stopPropagation(),_(void 0)},[_]),{getRootProps:ce,getInputProps:de,isDragAccept:Ie}=useDropzone({maxFiles:1,accept:"image/*",onDrop:ae,disabled:K});return React.createElement(Row,{input:!0},React.createElement(Label,null,X),React.createElement(ImageContainer,null,React.createElement(ImagePreview,{ref:te,hasImage:!!Z,onPointerDown:()=>!!Z&&oe(),onPointerUp:se,style:{backgroundImage:Z?`url(${Z})`:"none"}}),ie&&!!Z&&React.createElement(Portal,null,React.createElement(Overlay,{onPointerUp:se,style:{cursor:"pointer"}}),React.createElement(ImageLargePreview,{ref:ne,style:{backgroundImage:`url(${Z})`}})),React.createElement(DropZone,ce({isDragAccept:Ie}),React.createElement("input",de()),React.createElement(Instructions,null,Ie?"drop image":"click or drop")),React.createElement(Remove,{onClick:ge,disabled:!Z})))}var image=_objectSpread2({component:ImageComponent},props$1);const number=v8n().number(),schema=(X,Z)=>v8n().array().length(2).every.number().test(X)&&v8n().schema({min:number,max:number}).test(Z),format=X=>({min:X[0],max:X[1]}),sanitize=(X,{bounds:[Z,_]},K)=>{const te=Array.isArray(X)?format(X):X,ne={min:K[0],max:K[1]},{min:ie,max:oe}=_objectSpread2(_objectSpread2({},ne),te);return[clamp(Number(ie),Z,Math.max(Z,oe)),clamp(Number(oe),Math.min(_,ie),_)]},normalize=({value:X,min:Z,max:_})=>{const K={min:Z,max:_},te=normalizeKeyedNumberSettings(format(X),{min:K,max:K}),ne=[Z,_],ie=_objectSpread2(_objectSpread2({},te),{},{bounds:ne});return{value:sanitize(format(X),ie,X),settings:ie}};var props=Object.freeze({__proto__:null,schema,format,sanitize,normalize});const _excluded$6=["value","bounds","onDrag"],_excluded2$1=["bounds"],Container=styled("div",{display:"grid",columnGap:"$colGap",gridTemplateColumns:"auto calc($sizes$numberInputMinWidth * 2 + $space$rowGap)"});function IntervalSlider(X){let{value:Z,bounds:[_,K],onDrag:te}=X,ne=_objectWithoutProperties$2(X,_excluded$6);const ie=reactExports.useRef(null),oe=reactExports.useRef(null),se=reactExports.useRef(null),ae=reactExports.useRef(0),ge=useTh("sizes","scrubberWidth"),ce=useDrag(({event:fe,first:be,xy:[Ae],movement:[ye],memo:ve={}})=>{if(be){const{width:Re,left:Ve}=ie.current.getBoundingClientRect();ae.current=Re-parseFloat(ge);const Ee=(fe==null?void 0:fe.target)===oe.current||(fe==null?void 0:fe.target)===se.current;ve.pos=invertedRange((Ae-Ve)/Re,_,K);const Ze=Math.abs(ve.pos-Z.min)-Math.abs(ve.pos-Z.max);ve.key=Ze<0||Ze===0&&ve.pos<=Z.min?"min":"max",Ee&&(ve.pos=Z[ve.key])}const Be=ve.pos+invertedRange(ye/ae.current,0,K-_);return te({[ve.key]:sanitizeStep(Be,ne[ve.key])}),ve}),de=`calc(${range(Z.min,_,K)} * (100% - ${ge} - 8px) + 4px)`,Ie=`calc(${1-range(Z.max,_,K)} * (100% - ${ge} - 8px) + 4px)`;return React.createElement(RangeWrapper,_extends$1({ref:ie},ce()),React.createElement(Range,null,React.createElement(Indicator,{style:{left:de,right:Ie}})),React.createElement(Scrubber,{position:"left",ref:oe,style:{left:de}}),React.createElement(Scrubber,{position:"right",ref:se,style:{right:Ie}}))}function IntervalComponent(){const{label:X,displayValue:Z,onUpdate:_,settings:K}=useInputContext(),te=_objectWithoutProperties$2(K,_excluded2$1);return React.createElement(React.Fragment,null,React.createElement(Row,{input:!0},React.createElement(Label,null,X),React.createElement(Container,null,React.createElement(IntervalSlider,_extends$1({value:Z},K,{onDrag:_})),React.createElement(Vector,{value:Z,settings:te,onUpdate:_,innerLabelTrim:0}))))}var interval=_objectSpread2({component:IntervalComponent},props);const createEventEmitter=()=>{const X=new Map;return{on:(Z,_)=>{let K=X.get(Z);K===void 0&&(K=new Set,X.set(Z,K)),K.add(_)},off:(Z,_)=>{const K=X.get(Z);K!==void 0&&(K.delete(_),K.size===0&&X.delete(Z))},emit:(Z,..._)=>{const K=X.get(Z);if(K!==void 0)for(const te of K)te(..._)}}},_excluded$5=["type","value"],_excluded2=["onChange","transient","onEditStart","onEditEnd"],Store=function(){const Z=create(subscribeWithSelector(()=>({data:{}}))),_=createEventEmitter();this.storeId=getUid(),this.useStore=Z;const K={},te=new Set;this.getVisiblePaths=()=>{const ie=this.getData(),oe=Object.keys(ie),se=[];Object.entries(K).forEach(([ge,ce])=>{ce.render&&oe.some(de=>de.indexOf(ge)===0)&&!ce.render(this.get)&&se.push(ge+".")});const ae=[];return te.forEach(ge=>{ge in ie&&ie[ge].__refCount>0&&se.every(ce=>ge.indexOf(ce)===-1)&&(!ie[ge].render||ie[ge].render(this.get))&&ae.push(ge)}),ae},this.setOrderedPaths=ie=>{ie.forEach(oe=>te.add(oe))},this.orderPaths=ie=>(this.setOrderedPaths(ie),ie),this.disposePaths=ie=>{Z.setState(oe=>{const se=oe.data;return ie.forEach(ae=>{if(ae in se){const ge=se[ae];ge.__refCount--,ge.__refCount===0&&ge.type in SpecialInputs&&delete se[ae]}}),{data:se}})},this.dispose=()=>{Z.setState(()=>({data:{}}))},this.getFolderSettings=ie=>K[ie]||{},this.getData=()=>Z.getState().data,this.addData=(ie,oe)=>{Z.setState(se=>{const ae=se.data;return Object.entries(ie).forEach(([ge,ce])=>{let de=ae[ge];if(de){const{type:Ie,value:fe}=ce,be=_objectWithoutProperties$2(ce,_excluded$5);Ie!==de.type?warn(LevaErrors.INPUT_TYPE_OVERRIDE,Ie):((de.__refCount===0||oe)&&Object.assign(de,be),de.__refCount++)}else ae[ge]=_objectSpread2(_objectSpread2({},ce),{},{__refCount:1})}),{data:ae}})},this.setValueAtPath=(ie,oe,se)=>{Z.setState(ae=>{const ge=ae.data;return updateInput(ge[ie],oe,ie,this,se),{data:ge}})},this.setSettingsAtPath=(ie,oe)=>{Z.setState(se=>{const ae=se.data;return ae[ie].settings=_objectSpread2(_objectSpread2({},ae[ie].settings),oe),{data:ae}})},this.disableInputAtPath=(ie,oe)=>{Z.setState(se=>{const ae=se.data;return ae[ie].disabled=oe,{data:ae}})},this.set=(ie,oe)=>{Z.setState(se=>{const ae=se.data;return Object.entries(ie).forEach(([ge,ce])=>{try{updateInput(ae[ge],ce,void 0,void 0,oe)}catch{}}),{data:ae}})},this.getInput=ie=>{try{return this.getData()[ie]}catch{warn(LevaErrors.PATH_DOESNT_EXIST,ie)}},this.get=ie=>{var oe;return(oe=this.getInput(ie))===null||oe===void 0?void 0:oe.value},this.emitOnEditStart=ie=>{_.emit(`onEditStart:${ie}`,this.get(ie),ie,_objectSpread2(_objectSpread2({},this.getInput(ie)),{},{get:this.get}))},this.emitOnEditEnd=ie=>{_.emit(`onEditEnd:${ie}`,this.get(ie),ie,_objectSpread2(_objectSpread2({},this.getInput(ie)),{},{get:this.get}))},this.subscribeToEditStart=(ie,oe)=>{const se=`onEditStart:${ie}`;return _.on(se,oe),()=>_.off(se,oe)},this.subscribeToEditEnd=(ie,oe)=>{const se=`onEditEnd:${ie}`;return _.on(se,oe),()=>_.off(se,oe)};const ne=(ie,oe,se)=>{const ae={};return Object.entries(ie).forEach(([ge,ce])=>{if(ge==="")return warn(LevaErrors.EMPTY_KEY);let de=join(oe,ge);if(ce.type===SpecialInputs.FOLDER){const Ie=ne(ce.schema,de,se);Object.assign(ae,Ie),de in K||(K[de]=ce.settings)}else if(ge in se)warn(LevaErrors.DUPLICATE_KEYS,ge,de,se[ge].path);else{const Ie=normalizeInput(ce,ge,de,ae);if(Ie){const{type:fe,options:be,input:Ae}=Ie,{onChange:ye,transient:ve,onEditStart:Be,onEditEnd:Re}=be,Ve=_objectWithoutProperties$2(be,_excluded2);ae[de]=_objectSpread2(_objectSpread2(_objectSpread2({type:fe},Ve),Ae),{},{fromPanel:!0}),se[ge]={path:de,onChange:ye,transient:ve,onEditStart:Be,onEditEnd:Re}}else warn(LevaErrors.UNKNOWN_INPUT,de,ce)}}),ae};this.getDataFromSchema=ie=>{const oe={};return[ne(ie,"",oe),oe]}},levaStore=new Store,defaultSettings$2={collapsed:!1};function folder(X,Z){return{type:SpecialInputs.FOLDER,schema:X,settings:_objectSpread2(_objectSpread2({},defaultSettings$2),Z)}}const isInput=X=>"__levaInput"in X,buildTree=(X,Z)=>{const _={},K=Z?Z.toLowerCase():null;return X.forEach(te=>{const[ne,ie]=getKeyPath(te);(!K||ne.toLowerCase().indexOf(K)>-1)&&merge(_,ie,{[ne]:{__levaInput:!0,path:te}})}),_},_excluded$4=["type","label","path","valueKey","value","settings","setValue","disabled"];function ControlInput(X){let{type:Z,label:_,path:K,valueKey:te,value:ne,settings:ie,setValue:oe,disabled:se}=X,ae=_objectWithoutProperties$2(X,_excluded$4);const{displayValue:ge,onChange:ce,onUpdate:de}=useInputSetters({type:Z,value:ne,settings:ie,setValue:oe}),Ie=Plugins[Z].component;return Ie?React.createElement(InputContext.Provider,{value:_objectSpread2({key:te,path:K,id:""+K,label:_,displayValue:ge,value:ne,onChange:ce,onUpdate:de,settings:ie,setValue:oe,disabled:se},ae)},React.createElement(StyledInputWrapper$1,{disabled:se},React.createElement(Ie,null))):(warn(LevaErrors.NO_COMPONENT_FOR_TYPE,Z,K),null)}const StyledButton=styled("button",{display:"block",$reset:"",fontWeight:"$button",height:"$rowHeight",borderStyle:"none",borderRadius:"$sm",backgroundColor:"$elevation1",color:"$highlight1","&:not(:disabled)":{color:"$highlight3",backgroundColor:"$accent2",cursor:"pointer",$hover:"$accent3",$active:"$accent3 $accent1",$focus:""}});function Button({onClick:X,settings:Z,label:_}){const K=useStoreContext();return React.createElement(Row,null,React.createElement(StyledButton,{disabled:Z.disabled,onClick:()=>X(K.get)},_))}const StyledButtonGroup=styled("div",{$flex:"",justifyContent:"flex-end",gap:"$colGap"}),StyledButtonGroupButton=styled("button",{$reset:"",cursor:"pointer",borderRadius:"$xs","&:hover":{backgroundColor:"$elevation3"}}),getOpts=({label:X,opts:Z})=>{let _=typeof X=="string"&&X.trim()===""?null:X,K=Z;return typeof Z.opts=="object"&&(K.label!==void 0&&(_=Z.label),K=Z.opts),{label:_,opts:K}};function ButtonGroup(X){const{label:Z,opts:_}=getOpts(X),K=useStoreContext();return React.createElement(Row,{input:!!Z},Z&&React.createElement(Label,null,Z),React.createElement(StyledButtonGroup,null,Object.entries(_).map(([te,ne])=>React.createElement(StyledButtonGroupButton,{key:te,onClick:()=>ne(K.get)},te))))}const Canvas=styled("canvas",{height:"$monitorHeight",width:"100%",display:"block",borderRadius:"$sm"}),POINTS=100;function push(X,Z){X.push(Z),X.length>POINTS&&X.shift()}const MonitorCanvas=reactExports.forwardRef(function({initialValue:X},Z){const _=useTh("colors","highlight3"),K=useTh("colors","elevation2"),te=useTh("colors","highlight1"),[ne,ie]=reactExports.useMemo(()=>[w(te).alpha(.4).toRgbString(),w(te).alpha(.1).toRgbString()],[te]),oe=reactExports.useRef([X]),se=reactExports.useRef(X),ae=reactExports.useRef(X),ge=reactExports.useRef(),ce=reactExports.useCallback((fe,be)=>{if(!fe)return;const{width:Ae,height:ye}=fe,ve=new Path2D,Be=Ae/POINTS,Re=ye*.05;for(let Ze=0;Ze<oe.current.length;Ze++){const _e=range(oe.current[Ze],se.current,ae.current),Fe=Be*Ze,Te=ye-_e*(ye-Re*2)-Re;ve.lineTo(Fe,Te)}be.clearRect(0,0,Ae,ye);const Ve=new Path2D(ve);Ve.lineTo(Be*(oe.current.length+1),ye),Ve.lineTo(0,ye),Ve.lineTo(0,0);const Ee=be.createLinearGradient(0,0,0,ye);Ee.addColorStop(0,ne),Ee.addColorStop(1,ie),be.fillStyle=Ee,be.fill(Ve),be.strokeStyle=K,be.lineJoin="round",be.lineWidth=14,be.stroke(ve),be.strokeStyle=_,be.lineWidth=2,be.stroke(ve)},[_,K,ne,ie]),[de,Ie]=useCanvas2d(ce);return reactExports.useImperativeHandle(Z,()=>({frame:fe=>{(se.current===void 0||fe<se.current)&&(se.current=fe),(ae.current===void 0||fe>ae.current)&&(ae.current=fe),push(oe.current,fe),ge.current=requestAnimationFrame(()=>ce(de.current,Ie.current))}}),[de,Ie,ce]),reactExports.useEffect(()=>()=>cancelAnimationFrame(ge.current),[]),React.createElement(Canvas,{ref:de})}),parse=X=>Number.isFinite(X)?X.toPrecision(2):X.toString(),MonitorLog=reactExports.forwardRef(function({initialValue:X},Z){const[_,K]=reactExports.useState(parse(X));return reactExports.useImperativeHandle(Z,()=>({frame:te=>K(parse(te))}),[]),React.createElement("div",null,_)});function getValue(X){return typeof X=="function"?X():X.current}function Monitor({label:X,objectOrFn:Z,settings:_}){const K=reactExports.useRef(),te=reactExports.useRef(getValue(Z));return reactExports.useEffect(()=>{const ne=window.setInterval(()=>{var ie;document.hidden||(ie=K.current)===null||ie===void 0||ie.frame(getValue(Z))},_.interval);return()=>window.clearInterval(ne)},[Z,_.interval]),React.createElement(Row,{input:!0},React.createElement(Label,{align:"top"},X),_.graph?React.createElement(MonitorCanvas,{ref:K,initialValue:te.current}):React.createElement(MonitorLog,{ref:K,initialValue:te.current}))}const _excluded$3=["type","label","key"],specialComponents={[SpecialInputs.BUTTON]:Button,[SpecialInputs.BUTTON_GROUP]:ButtonGroup,[SpecialInputs.MONITOR]:Monitor},Control=React.memo(({path:X})=>{const[Z,{set:_,setSettings:K,disable:te,storeId:ne,emitOnEditStart:ie,emitOnEditEnd:oe}]=useInput(X);if(!Z)return null;const{type:se,label:ae,key:ge}=Z,ce=_objectWithoutProperties$2(Z,_excluded$3);if(se in SpecialInputs){const de=specialComponents[se];return React.createElement(de,_extends$1({label:ae,path:X},ce))}return se in Plugins?React.createElement(ControlInput,_extends$1({key:ne+X,type:se,label:ae,storeId:ne,path:X,valueKey:ge,setValue:_,setSettings:K,disable:te,emitOnEditStart:ie,emitOnEditEnd:oe},ce)):(log$1(LevaErrors.UNSUPPORTED_INPUT,se,X),null)});function FolderTitle({toggle:X,toggled:Z,name:_}){return React.createElement(StyledTitle,{onClick:()=>X()},React.createElement(Chevron,{toggled:Z}),React.createElement("div",null,_))}const Folder=({name:X,path:Z,tree:_})=>{const K=useStoreContext(),te=join(Z,X),{collapsed:ne,color:ie}=K.getFolderSettings(te),[oe,se]=reactExports.useState(!ne),ae=reactExports.useRef(null),ge=useTh("colors","folderWidgetColor"),ce=useTh("colors","folderTextColor");return reactExports.useLayoutEffect(()=>{ae.current.style.setProperty("--leva-colors-folderWidgetColor",ie||ge),ae.current.style.setProperty("--leva-colors-folderTextColor",ie||ce)},[ie,ge,ce]),React.createElement(StyledFolder,{ref:ae},React.createElement(FolderTitle,{name:X,toggled:oe,toggle:()=>se(de=>!de)}),React.createElement(TreeWrapper,{parent:te,tree:_,toggled:oe}))},TreeWrapper=React.memo(({isRoot:X=!1,fill:Z=!1,flat:_=!1,parent:K,tree:te,toggled:ne})=>{const{wrapperRef:ie,contentRef:oe}=useToggle(ne),se=useStoreContext(),ae=([ce,de])=>{var Ie;return(isInput(de)?(Ie=se.getInput(de.path))===null||Ie===void 0?void 0:Ie.order:se.getFolderSettings(join(K,ce)).order)||0},ge=Object.entries(te).sort((ce,de)=>ae(ce)-ae(de));return React.createElement(StyledWrapper,{ref:ie,isRoot:X,fill:Z,flat:_},React.createElement(StyledContent,{ref:oe,isRoot:X,toggled:ne},ge.map(([ce,de])=>isInput(de)?React.createElement(Control,{key:de.path,valueKey:de.valueKey,path:de.path}):React.createElement(Folder,{key:ce,name:ce,path:K,tree:de}))))}),StyledRoot=styled("div",{position:"relative",fontFamily:"$mono",fontSize:"$root",color:"$rootText",backgroundColor:"$elevation1",variants:{fill:{false:{position:"fixed",top:"10px",right:"10px",zIndex:1e3,width:"$rootWidth"},true:{position:"relative",width:"100%"}},flat:{false:{borderRadius:"$lg",boxShadow:"$level1"}},oneLineLabels:{true:{[`${StyledInputRow}`]:{gridTemplateColumns:"auto",gridAutoColumns:"minmax(max-content, 1fr)",gridAutoRows:"minmax($sizes$rowHeight), auto)",rowGap:0,columnGap:0,marginTop:"$rowGap"}}},hideTitleBar:{true:{$$titleBarHeight:"0px"},false:{$$titleBarHeight:"$sizes$titleBarHeight"}}},"&,*,*:after,*:before":{boxSizing:"border-box"},"*::selection":{backgroundColor:"$accent2"}}),iconWidth=40,Icon=styled("i",{$flexCenter:"",width:iconWidth,userSelect:"none",cursor:"pointer","> svg":{fill:"$highlight1",transition:"transform 350ms ease, fill 250ms ease"},"&:hover > svg":{fill:"$highlight3"},variants:{active:{true:{"> svg":{fill:"$highlight2"}}}}}),StyledTitleWithFilter=styled("div",{display:"flex",alignItems:"stretch",justifyContent:"space-between",height:"$titleBarHeight",variants:{mode:{drag:{cursor:"grab"}}}}),FilterWrapper=styled("div",{$flex:"",position:"relative",width:"100%",overflow:"hidden",transition:"height 250ms ease",color:"$highlight3",paddingLeft:"$md",[`> ${Icon}`]:{height:30},variants:{toggled:{true:{height:30},false:{height:0}}}}),StyledFilterInput=styled("input",{$reset:"",flex:1,position:"relative",height:30,width:"100%",backgroundColor:"transparent",fontSize:"10px",borderRadius:"$root","&:focus":{},"&::placeholder":{color:"$highlight2"}}),TitleContainer=styled("div",{touchAction:"none",$flexCenter:"",flex:1,"> svg":{fill:"$highlight1"},color:"$highlight1",variants:{drag:{true:{$draggable:"","> svg":{transition:"fill 250ms ease"},"&:hover":{color:"$highlight3"},"&:hover > svg":{fill:"$highlight3"}}},filterEnabled:{false:{paddingRight:iconWidth}}}}),FilterInput=React.forwardRef(({setFilter:X,toggle:Z},_)=>{const[K,te]=reactExports.useState(""),ne=reactExports.useMemo(()=>debounce(X,250),[X]),ie=()=>{X(""),te("")},oe=se=>{const ae=se.currentTarget.value;Z(!0),te(ae)};return reactExports.useEffect(()=>{ne(K)},[K,ne]),React.createElement(React.Fragment,null,React.createElement(StyledFilterInput,{ref:_,value:K,placeholder:"[Open filter with CMD+SHIFT+L]",onPointerDown:se=>se.stopPropagation(),onChange:oe}),React.createElement(Icon,{onClick:()=>ie(),style:{visibility:K?"visible":"hidden"}},React.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",height:"14",width:"14",viewBox:"0 0 20 20",fill:"currentColor"},React.createElement("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z",clipRule:"evenodd"}))))});function TitleWithFilter({setFilter:X,onDrag:Z,onDragStart:_,onDragEnd:K,toggle:te,toggled:ne,title:ie,drag:oe,filterEnabled:se,from:ae}){const[ge,ce]=reactExports.useState(!1),de=reactExports.useRef(null);reactExports.useEffect(()=>{var fe,be;ge?(fe=de.current)===null||fe===void 0||fe.focus():(be=de.current)===null||be===void 0||be.blur()},[ge]);const Ie=useDrag(({offset:[fe,be],first:Ae,last:ye})=>{Z({x:fe,y:be}),Ae&&_({x:fe,y:be}),ye&&K({x:fe,y:be})},{filterTaps:!0,from:({offset:[fe,be]})=>[(ae==null?void 0:ae.x)||fe,(ae==null?void 0:ae.y)||be]});return reactExports.useEffect(()=>{const fe=be=>{be.key==="L"&&be.shiftKey&&be.metaKey&&ce(Ae=>!Ae)};return window.addEventListener("keydown",fe),()=>window.removeEventListener("keydown",fe)},[]),React.createElement(React.Fragment,null,React.createElement(StyledTitleWithFilter,{mode:oe?"drag":void 0},React.createElement(Icon,{active:!ne,onClick:()=>te()},React.createElement(Chevron,{toggled:ne,width:12,height:8})),React.createElement(TitleContainer,_extends$1({},oe?Ie():{},{drag:oe,filterEnabled:se}),ie===void 0&&oe?React.createElement("svg",{width:"20",height:"10",viewBox:"0 0 28 14",xmlns:"http://www.w3.org/2000/svg"},React.createElement("circle",{cx:"2",cy:"2",r:"2"}),React.createElement("circle",{cx:"14",cy:"2",r:"2"}),React.createElement("circle",{cx:"26",cy:"2",r:"2"}),React.createElement("circle",{cx:"2",cy:"12",r:"2"}),React.createElement("circle",{cx:"14",cy:"12",r:"2"}),React.createElement("circle",{cx:"26",cy:"12",r:"2"})):ie),se&&React.createElement(Icon,{active:ge,onClick:()=>ce(fe=>!fe)},React.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",height:"20",viewBox:"0 0 20 20"},React.createElement("path",{d:"M9 9a2 2 0 114 0 2 2 0 01-4 0z"}),React.createElement("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm1-13a4 4 0 00-3.446 6.032l-2.261 2.26a1 1 0 101.414 1.415l2.261-2.261A4 4 0 1011 5z",clipRule:"evenodd"})))),React.createElement(FilterWrapper,{toggled:ge},React.createElement(FilterInput,{ref:de,setFilter:X,toggle:te})))}const _excluded$2=["store","hidden","theme","collapsed"];function LevaRoot(X){let{store:Z,hidden:_=!1,theme:K,collapsed:te=!1}=X,ne=_objectWithoutProperties$2(X,_excluded$2);const ie=useDeepMemo(()=>mergeTheme(K),[K]),[oe,se]=reactExports.useState(!te),ae=typeof te=="object"?!te.collapsed:oe,ge=reactExports.useMemo(()=>typeof te=="object"?ce=>{typeof ce=="function"?te.onChange(!ce(!te.collapsed)):te.onChange(!ce)}:se,[te]);return!Z||_?null:React.createElement(ThemeContext.Provider,{value:ie},React.createElement(LevaCore,_extends$1({store:Z},ne,{toggled:ae,setToggle:ge,rootClass:ie.className})))}const LevaCore=React.memo(({store:X,rootClass:Z,fill:_=!1,flat:K=!1,neverHide:te=!1,oneLineLabels:ne=!1,titleBar:ie={title:void 0,drag:!0,filter:!0,position:void 0,onDrag:void 0,onDragStart:void 0,onDragEnd:void 0},hideCopyButton:oe=!1,toggled:se,setToggle:ae})=>{var ge,ce;const de=useVisiblePaths(X),[Ie,fe]=reactExports.useState(""),be=reactExports.useMemo(()=>buildTree(de,Ie),[de,Ie]),[Ae,ye]=useTransform(),ve=te||de.length>0,Be=typeof ie=="object"&&ie.title||void 0,Re=typeof ie=="object"&&(ge=ie.drag)!==null&&ge!==void 0?ge:!0,Ve=typeof ie=="object"&&(ce=ie.filter)!==null&&ce!==void 0?ce:!0,Ee=typeof ie=="object"&&ie.position||void 0,Ze=typeof ie=="object"&&ie.onDrag||void 0,_e=typeof ie=="object"&&ie.onDragStart||void 0,Fe=typeof ie=="object"&&ie.onDragEnd||void 0;return React.useEffect(()=>{ye({x:Ee==null?void 0:Ee.x,y:Ee==null?void 0:Ee.y})},[Ee,ye]),globalStyles(),React.createElement(PanelSettingsContext.Provider,{value:{hideCopyButton:oe}},React.createElement(StyledRoot,{ref:Ae,className:Z,fill:_,flat:K,oneLineLabels:ne,hideTitleBar:!ie,style:{display:ve?"block":"none"}},ie&&React.createElement(TitleWithFilter,{onDrag:Te=>{ye(Te),Ze==null||Ze(Te)},onDragStart:Te=>_e==null?void 0:_e(Te),onDragEnd:Te=>Fe==null?void 0:Fe(Te),setFilter:fe,toggle:Te=>ae(ke=>Te??!ke),toggled:se,title:Be,drag:Re,filterEnabled:Ve,from:Ee}),ve&&React.createElement(StoreContext.Provider,{value:X},React.createElement(TreeWrapper,{isRoot:!0,fill:_,flat:K,tree:be,toggled:se}))))}),_excluded$1=["isRoot"];let rootInitialized=!1,rootEl=null;function Leva(X){let{isRoot:Z=!1}=X,_=_objectWithoutProperties$2(X,_excluded$1);return reactExports.useEffect(()=>(rootInitialized=!0,!Z&&rootEl&&(rootEl.remove(),rootEl=null),()=>{Z||(rootInitialized=!1)}),[Z]),React.createElement(LevaRoot,_extends$1({store:levaStore},_))}function useRenderRoot(X){reactExports.useEffect(()=>{X&&!rootInitialized&&(rootEl||(rootEl=document.getElementById("leva__root")||Object.assign(document.createElement("div"),{id:"leva__root"}),document.body&&(document.body.appendChild(rootEl),clientExports.createRoot(rootEl).render(React.createElement(Leva,{isRoot:!0})))),rootInitialized=!0)},[X])}function parseArgs(X,Z,_,K,te){let ne,ie,oe,se,ae;return typeof X=="string"?(ie=X,ne=Z,Array.isArray(_)&&(ae=_)):(ne=X,Array.isArray(Z)?ae=Z:(se=Z,ae=_)),{schema:ne,folderName:ie,folderSettings:oe,hookSettings:se,deps:ae||[]}}function useControls(X,Z,_,K,te){const{folderName:ne,schema:ie,folderSettings:oe,hookSettings:se,deps:ae}=parseArgs(X,Z,_),ge=typeof ie=="function",ce=reactExports.useRef(!1),de=reactExports.useRef(!0),Ie=useDeepMemo(()=>{ce.current=!0;const ke=typeof ie=="function"?ie():ie;return ne?{[ne]:folder(ke,oe)}:ke},ae),fe=!(se!=null&&se.store);useRenderRoot(fe);const[be]=reactExports.useState(()=>(se==null?void 0:se.store)||levaStore),[Ae,ye]=reactExports.useMemo(()=>be.getDataFromSchema(Ie),[be,Ie]),[ve,Be,Re,Ve,Ee]=reactExports.useMemo(()=>{const ke=[],Le=[],Ke={},Ue={},rt={};return Object.values(ye).forEach(({path:tt,onChange:at,onEditStart:ze,onEditEnd:qe,transient:Pe})=>{ke.push(tt),at?(Ke[tt]=at,Pe||Le.push(tt)):Le.push(tt),ze&&(Ue[tt]=ze),qe&&(rt[tt]=qe)}),[ke,Le,Ke,Ue,rt]},[ye]),Ze=reactExports.useMemo(()=>be.orderPaths(ve),[ve,be]),_e=useValuesForPath(be,Be,Ae),Fe=reactExports.useCallback(ke=>{const Le=Object.entries(ke).reduce((Ke,[Ue,rt])=>Object.assign(Ke,{[ye[Ue].path]:rt}),{});be.set(Le,!1)},[be,ye]),Te=reactExports.useCallback(ke=>be.get(ye[ke].path),[be,ye]);return reactExports.useEffect(()=>{const ke=!de.current&&ce.current;return be.addData(Ae,ke),de.current=!1,ce.current=!1,()=>be.disposePaths(Ze)},[be,Ze,Ae]),reactExports.useEffect(()=>{const ke=[];return Object.entries(Re).forEach(([Le,Ke])=>{Ke(be.get(Le),Le,_objectSpread2({initial:!0,get:be.get},be.getInput(Le)));const Ue=be.useStore.subscribe(rt=>{const tt=rt.data[Le];return[tt.disabled?void 0:tt.value,tt]},([rt,tt])=>Ke(rt,Le,_objectSpread2({initial:!1,get:be.get},tt)),{equalityFn:shallow});ke.push(Ue)}),()=>ke.forEach(Le=>Le())},[be,Re]),reactExports.useEffect(()=>{const ke=[];return Object.entries(Ve).forEach(([Le,Ke])=>ke.push(be.subscribeToEditStart(Le,Ke))),Object.entries(Ee).forEach(([Le,Ke])=>ke.push(be.subscribeToEditEnd(Le,Ke))),()=>ke.forEach(Le=>Le())},[Ve,Ee,be]),ge?[_e,Fe,Te]:_e}register(LevaInputs.SELECT,select);register(LevaInputs.IMAGE,image);register(LevaInputs.NUMBER,number$1);register(LevaInputs.COLOR,color);register(LevaInputs.STRING,string);register(LevaInputs.BOOLEAN,boolean);register(LevaInputs.INTERVAL,interval);register(LevaInputs.VECTOR3D,vector3d);register(LevaInputs.VECTOR2D,vector2d);const API_KEY="2d12bd421e3af7ce47223bce45944908",AVATAR_ID="fe2da934-6aa4-11ef-8fba-42010a7be011",AVATAR_ID_2="881e4aac-50d5-11ef-9461-42010a7be011",AVATAR_ID_3="9ff38f44-437d-11ef-9187-42010a7be011",AVATAR_ID_4="2734589a-ef8f-11ef-9966-42010a7be016",CONVAI_API_URL="https://api.convai.com/character/get",emitAvatarTypeChange=X=>{window.dispatchEvent(new CustomEvent("avatar-hide")),window.dispatchEvent(new CustomEvent("scene-loading-start")),setTimeout(()=>{window.dispatchEvent(new CustomEvent("avatar-type-change",{detail:X})),setTimeout(()=>{window.dispatchEvent(new CustomEvent("scene-loading-end")),window.dispatchEvent(new CustomEvent("avatar-show"))},500)},100)},LoadingDots=()=>{const[X,Z]=reactExports.useState("");return reactExports.useEffect(()=>{const _=setInterval(()=>{Z(K=>K.length>=3?"":K+".")},500);return()=>clearInterval(_)},[]),X},LoadingSpinner$1=()=>jsxRuntimeExports.jsx(Html,{center:!0,children:jsxRuntimeExports.jsxs("div",{className:"loading-spinner",children:[jsxRuntimeExports.jsx("div",{className:"spinner"}),jsxRuntimeExports.jsxs("div",{className:"loading-text",children:["Loading",LoadingDots()]})]})});function AvatarModel({modelUrl:X,onLoad:Z,visible:_,avatarType:K,onReady:te,...ne}){const{scene:ie}=useGLTF(X),oe=useControls({"Lewa Ręka":folder({leftShoulderX:{value:.45,min:-1,max:1,step:.01},leftShoulderY:{value:-.01,min:-1,max:1,step:.01},leftShoulderZ:{value:-.64,min:-1,max:1,step:.01},leftArmX:{value:.4,min:-1,max:1,step:.01},leftArmY:{value:-.01,min:-1,max:1,step:.01},leftArmZ:{value:.03,min:-1,max:1,step:.01},leftForeArmX:{value:.16,min:-1,max:1,step:.01},leftForeArmY:{value:.1,min:-1,max:1,step:.01},leftForeArmZ:{value:.1,min:-1,max:1,step:.01}}),"Prawa Ręka":folder({rightShoulderX:{value:.65,min:-1,max:1,step:.01},rightShoulderY:{value:.1,min:-1,max:1,step:.01},rightShoulderZ:{value:.61,min:-1,max:1,step:.01},rightArmX:{value:.37,min:-1,max:1,step:.01},rightArmY:{value:0,min:-1,max:1,step:.01},rightArmZ:{value:-.15,min:-1,max:1,step:.01},rightForeArmX:{value:0,min:-1,max:1,step:.01},rightForeArmY:{value:-.1,min:-1,max:1,step:.01},rightForeArmZ:{value:-.1,min:-1,max:1,step:.01}})}),se=React.useMemo(()=>{const Ee=SkeletonUtils.clone(ie),Ze=Ue=>{let rt=null;return Ee.traverse(tt=>{tt.isBone&&tt.name===Ue&&(rt=tt)}),rt},_e=Ze("LeftShoulder"),Fe=Ze("LeftArm"),Te=Ze("LeftForeArm");_e&&(_e.rotation.x=Math.PI*oe.leftShoulderX,_e.rotation.y=Math.PI*oe.leftShoulderY,_e.rotation.z=Math.PI*oe.leftShoulderZ),Fe&&(Fe.rotation.x=Math.PI*oe.leftArmX,Fe.rotation.y=Math.PI*oe.leftArmY,Fe.rotation.z=Math.PI*oe.leftArmZ),Te&&(Te.rotation.x=Math.PI*oe.leftForeArmX,Te.rotation.y=Math.PI*oe.leftForeArmY,Te.rotation.z=Math.PI*oe.leftForeArmZ);const ke=Ze("RightShoulder"),Le=Ze("RightArm"),Ke=Ze("RightForeArm");return ke&&(ke.rotation.x=Math.PI*oe.rightShoulderX,ke.rotation.y=Math.PI*oe.rightShoulderY,ke.rotation.z=Math.PI*oe.rightShoulderZ),Le&&(Le.rotation.x=Math.PI*oe.rightArmX,Le.rotation.y=Math.PI*oe.rightArmY,Le.rotation.z=Math.PI*oe.rightArmZ),Ke&&(Ke.rotation.x=Math.PI*oe.rightForeArmX,Ke.rotation.y=Math.PI*oe.rightForeArmY,Ke.rotation.z=Math.PI*oe.rightForeArmZ),Ee},[ie,oe]),ae=reactExports.useRef(),[ge,ce]=reactExports.useState(!1),[de,Ie]=reactExports.useState(!0);reactExports.useEffect(()=>{const Ee=()=>ce(!1),Ze=()=>ce(!0),_e=()=>Ie(!0),Fe=()=>Ie(!1);return window.addEventListener("avatar-hide",Ee),window.addEventListener("avatar-show",Ze),window.addEventListener("scene-loading-start",_e),window.addEventListener("scene-loading-end",Fe),()=>{window.removeEventListener("avatar-hide",Ee),window.removeEventListener("avatar-show",Ze),window.removeEventListener("scene-loading-start",_e),window.removeEventListener("scene-loading-end",Fe)}},[]),reactExports.useEffect(()=>{Ie(!0),ce(!1);const Ee=setTimeout(()=>{Ie(!1),ce(!0)},1e3);return()=>clearTimeout(Ee)},[]),reactExports.useEffect(()=>{useGLTF.preload("/models/avatar1.glb")},[]),reactExports.useEffect(()=>{const Ee=Ze=>{const _e=Ze.detail;se&&_e&&se.traverse(Fe=>{Fe.isMesh&&Fe.morphTargetInfluences&&_e.forEach((Te,ke)=>{ke<Fe.morphTargetInfluences.length&&(Fe.morphTargetInfluences[ke]=Te)})})};return window.addEventListener("viseme-update",Ee),()=>window.removeEventListener("viseme-update",Ee)},[se]),reactExports.useEffect(()=>{const Ee=()=>{se&&se.traverse(Ze=>{Ze.isMesh&&Ze.morphTargetInfluences&&Ze.morphTargetInfluences.fill(0)})};return window.addEventListener("avatar-talking-end",Ee),()=>window.removeEventListener("avatar-talking-end",Ee)},[se]);const[fe,be]=reactExports.useState([]),[Ae,ye]=reactExports.useState(0),ve=reactExports.useRef(0),Be=reactExports.useRef();reactExports.useEffect(()=>{const Ee=Ze=>{if(fe.length>0){ve.current+=.016;const _e=Math.floor(ve.current*100);ye(_e),_e>=fe.length?(Ve(),be([]),ve.current=0):Re(_e)}Be.current=requestAnimationFrame(Ee)};return Be.current=requestAnimationFrame(Ee),()=>cancelAnimationFrame(Be.current)},[fe]);const Re=Ee=>{!window.visemeData||Ee>=window.visemeData.length||se.traverse(Ze=>{if(Ze.isMesh&&Ze.morphTargetInfluences)for(let _e=0;_e<15;_e++)Ze.morphTargetInfluences[_e]=window.visemeData[Ee][_e]||0})},Ve=()=>{se.traverse(Ee=>{if(Ee.isMesh&&Ee.morphTargetInfluences)for(let Ze=0;Ze<15;Ze++)Ee.morphTargetInfluences[Ze]=0})};return reactExports.useEffect(()=>{const Ee=()=>{window.visemeData&&(be([...window.visemeData]),ve.current=0)};return window.addEventListener("viseme-data-update",Ee),()=>window.removeEventListener("viseme-data-update",Ee)},[]),reactExports.useEffect(()=>{se&&se.traverse(Ee=>{Ee.isMesh})},[se]),reactExports.useEffect(()=>{K&&_&&emitAvatarTypeChange(K)},[K,_]),reactExports.useEffect(()=>{if(te&&typeof te=="function"){te(!1);const Ee=setTimeout(()=>{se&&!de&&_&&(console.log("Avatar model ready:",K),te(!0))},2e3);return()=>clearTimeout(Ee)}},[se,de,_,K,te]),de?jsxRuntimeExports.jsx("group",{visible:_,children:jsxRuntimeExports.jsx(LoadingSpinner$1,{})}):jsxRuntimeExports.jsxs("group",{visible:_&&ge,ref:ae,children:[jsxRuntimeExports.jsx("primitive",{object:se,...ne}),se.nodes&&jsxRuntimeExports.jsx(Lipsync,{model:se})]})}function ConvaiAvatar({onLoad:X,visible:Z,onReady:_,...K}){const[te,ne]=reactExports.useState(null),[ie,oe]=reactExports.useState(null),[se,ae]=reactExports.useState(!1),[ge,ce]=reactExports.useState(1);return reactExports.useEffect(()=>{Z&&ae(!0)},[Z]),reactExports.useEffect(()=>{if(!te){async function de(){var Ie;try{const fe=await fetch(CONVAI_API_URL,{method:"POST",headers:{"CONVAI-API-KEY":API_KEY,"Content-Type":"application/json"},body:JSON.stringify({charID:AVATAR_ID})});if(!fe.ok)throw new Error("Failed to fetch character");const be=await fe.json();if((Ie=be==null?void 0:be.model_details)!=null&&Ie.modelLink)ne(be.model_details.modelLink),ce(1),Z&&emitAvatarTypeChange(1);else throw new Error("Invalid model URL")}catch(fe){oe(fe)}}de()}},[te,Z]),reactExports.useEffect(()=>{te&&!ie&&(useGLTF.preload("/reception_desk.glb"),X==null||X())},[te,ie,X]),reactExports.useEffect(()=>{useGLTF.preload("/models/avatar1.glb")},[]),ie||!te||!se?null:jsxRuntimeExports.jsx(reactExports.Suspense,{children:jsxRuntimeExports.jsx(AvatarModel,{modelUrl:te,onLoad:X,visible:Z,avatarType:ge,onReady:_,...K})})}function ConvaiAvatar2({onLoad:X,visible:Z=!1,onReady:_,...K}){const[te,ne]=reactExports.useState(null),[ie,oe]=reactExports.useState(null),[se,ae]=reactExports.useState(!1),[ge,ce]=reactExports.useState(2);return reactExports.useEffect(()=>{Z&&ae(!0)},[Z]),reactExports.useEffect(()=>{if(!te){async function de(){var Ie;try{const fe=await fetch(CONVAI_API_URL,{method:"POST",headers:{"CONVAI-API-KEY":API_KEY,"Content-Type":"application/json"},body:JSON.stringify({charID:AVATAR_ID_2})});if(!fe.ok)throw new Error("Failed to fetch character");const be=await fe.json();if((Ie=be==null?void 0:be.model_details)!=null&&Ie.modelLink)ne(be.model_details.modelLink),ce(2),Z&&emitAvatarTypeChange(2);else throw new Error("Invalid model URL")}catch(fe){oe(fe)}}de()}},[te,Z]),reactExports.useEffect(()=>{te&&!ie&&(useGLTF.preload("/reception_desk.glb"),X==null||X())},[te,ie,X]),reactExports.useEffect(()=>{useGLTF.preload("/models/avatar1.glb")},[]),ie||!te||!se?null:jsxRuntimeExports.jsx(reactExports.Suspense,{children:jsxRuntimeExports.jsx(AvatarModel,{modelUrl:te,onLoad:X,visible:Z,avatarType:ge,onReady:_,...K})})}function ConvaiAvatar3({onLoad:X,visible:Z=!1,onReady:_,...K}){const[te,ne]=reactExports.useState(null),[ie,oe]=reactExports.useState(null),[se,ae]=reactExports.useState(!1),[ge,ce]=reactExports.useState(3);return reactExports.useEffect(()=>{Z&&ae(!0)},[Z]),reactExports.useEffect(()=>{if(!te){async function de(){var Ie;try{const fe=await fetch(CONVAI_API_URL,{method:"POST",headers:{"CONVAI-API-KEY":API_KEY,"Content-Type":"application/json"},body:JSON.stringify({charID:AVATAR_ID_3})});if(!fe.ok)throw new Error("Failed to fetch character");const be=await fe.json();if((Ie=be==null?void 0:be.model_details)!=null&&Ie.modelLink)ne(be.model_details.modelLink),ce(3),Z&&emitAvatarTypeChange(3);else throw new Error("Invalid model URL")}catch(fe){oe(fe)}}de()}},[te,Z]),reactExports.useEffect(()=>{te&&!ie&&(useGLTF.preload("/reception_desk.glb"),X==null||X())},[te,ie,X]),reactExports.useEffect(()=>{useGLTF.preload("/models/avatar1.glb")},[]),ie||!te||!se?null:jsxRuntimeExports.jsx(reactExports.Suspense,{children:jsxRuntimeExports.jsx(AvatarModel,{modelUrl:te,onLoad:X,visible:Z,avatarType:ge,onReady:_,...K})})}function ConvaiAvatar4({onLoad:X,visible:Z=!1,onReady:_,...K}){const[te,ne]=reactExports.useState(null),[ie,oe]=reactExports.useState(null),[se,ae]=reactExports.useState(!1),[ge,ce]=reactExports.useState(4);return reactExports.useEffect(()=>{Z&&ae(!0)},[Z]),reactExports.useEffect(()=>{if(!te){async function de(){var Ie;try{const fe=await fetch(CONVAI_API_URL,{method:"POST",headers:{"CONVAI-API-KEY":API_KEY,"Content-Type":"application/json"},body:JSON.stringify({charID:AVATAR_ID_4})});if(!fe.ok)throw new Error("Failed to fetch character");const be=await fe.json();if((Ie=be==null?void 0:be.model_details)!=null&&Ie.modelLink)ne(be.model_details.modelLink),ce(4),Z&&emitAvatarTypeChange(4);else throw new Error("Invalid model URL")}catch(fe){oe(fe)}}de()}},[te,Z]),reactExports.useEffect(()=>{te&&!ie&&(useGLTF.preload("/reception_desk.glb"),X==null||X())},[te,ie,X]),reactExports.useEffect(()=>{useGLTF.preload("/models/avatar1.glb")},[]),ie||!te||!se?null:jsxRuntimeExports.jsx(reactExports.Suspense,{children:jsxRuntimeExports.jsx(AvatarModel,{modelUrl:te,onLoad:X,visible:Z,avatarType:ge,onReady:_,...K})})}var cjs={exports:{}},Draggable$1={};function r(X){var Z,_,K="";if(typeof X=="string"||typeof X=="number")K+=X;else if(typeof X=="object")if(Array.isArray(X))for(Z=0;Z<X.length;Z++)X[Z]&&(_=r(X[Z]))&&(K&&(K+=" "),K+=_);else for(Z in X)X[Z]&&(K&&(K+=" "),K+=Z);return K}function clsx(){for(var X,Z,_=0,K="";_<arguments.length;)(X=arguments[_++])&&(Z=r(X))&&(K&&(K+=" "),K+=Z);return K}const clsx_m=Object.freeze(Object.defineProperty({__proto__:null,clsx,default:clsx},Symbol.toStringTag,{value:"Module"})),require$$3=getAugmentedNamespace(clsx_m);var domFns={},shims={},hasRequiredShims;function requireShims(){if(hasRequiredShims)return shims;hasRequiredShims=1,Object.defineProperty(shims,"__esModule",{value:!0}),shims.dontSetMe=te,shims.findInArray=X,shims.int=K,shims.isFunction=Z,shims.isNum=_;function X(ne,ie){for(let oe=0,se=ne.length;oe<se;oe++)if(ie.apply(ie,[ne[oe],oe,ne]))return ne[oe]}function Z(ne){return typeof ne=="function"||Object.prototype.toString.call(ne)==="[object Function]"}function _(ne){return typeof ne=="number"&&!isNaN(ne)}function K(ne){return parseInt(ne,10)}function te(ne,ie,oe){if(ne[ie])return new Error("Invalid prop ".concat(ie," passed to ").concat(oe," - do not set this, set it on the child."))}return shims}var getPrefix={},hasRequiredGetPrefix;function requireGetPrefix(){if(hasRequiredGetPrefix)return getPrefix;hasRequiredGetPrefix=1,Object.defineProperty(getPrefix,"__esModule",{value:!0}),getPrefix.browserPrefixToKey=_,getPrefix.browserPrefixToStyle=K,getPrefix.default=void 0,getPrefix.getPrefix=Z;const X=["Moz","Webkit","O","ms"];function Z(){var ne;let ie=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"transform";if(typeof window>"u")return"";const oe=(ne=window.document)===null||ne===void 0||(ne=ne.documentElement)===null||ne===void 0?void 0:ne.style;if(!oe||ie in oe)return"";for(let se=0;se<X.length;se++)if(_(ie,X[se])in oe)return X[se];return""}function _(ne,ie){return ie?"".concat(ie).concat(te(ne)):ne}function K(ne,ie){return ie?"-".concat(ie.toLowerCase(),"-").concat(ne):ne}function te(ne){let ie="",oe=!0;for(let se=0;se<ne.length;se++)oe?(ie+=ne[se].toUpperCase(),oe=!1):ne[se]==="-"?oe=!0:ie+=ne[se];return ie}return getPrefix.default=Z(),getPrefix}var hasRequiredDomFns;function requireDomFns(){if(hasRequiredDomFns)return domFns;hasRequiredDomFns=1,Object.defineProperty(domFns,"__esModule",{value:!0}),domFns.addClassName=Ve,domFns.addEvent=oe,domFns.addUserSelectStyles=Be,domFns.createCSSTransform=fe,domFns.createSVGTransform=be,domFns.getTouch=ye,domFns.getTouchIdentifier=ve,domFns.getTranslation=Ae,domFns.innerHeight=ce,domFns.innerWidth=de,domFns.matchesSelector=ne,domFns.matchesSelectorAndParentsTo=ie,domFns.offsetXYFromParent=Ie,domFns.outerHeight=ae,domFns.outerWidth=ge,domFns.removeClassName=Ee,domFns.removeEvent=se,domFns.removeUserSelectStyles=Re;var X=requireShims(),Z=K(requireGetPrefix());function _(Ze){if(typeof WeakMap!="function")return null;var _e=new WeakMap,Fe=new WeakMap;return(_=function(Te){return Te?Fe:_e})(Ze)}function K(Ze,_e){if(Ze&&Ze.__esModule)return Ze;if(Ze===null||typeof Ze!="object"&&typeof Ze!="function")return{default:Ze};var Fe=_(_e);if(Fe&&Fe.has(Ze))return Fe.get(Ze);var Te={},ke=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var Le in Ze)if(Le!=="default"&&Object.prototype.hasOwnProperty.call(Ze,Le)){var Ke=ke?Object.getOwnPropertyDescriptor(Ze,Le):null;Ke&&(Ke.get||Ke.set)?Object.defineProperty(Te,Le,Ke):Te[Le]=Ze[Le]}return Te.default=Ze,Fe&&Fe.set(Ze,Te),Te}let te="";function ne(Ze,_e){return te||(te=(0,X.findInArray)(["matches","webkitMatchesSelector","mozMatchesSelector","msMatchesSelector","oMatchesSelector"],function(Fe){return(0,X.isFunction)(Ze[Fe])})),(0,X.isFunction)(Ze[te])?Ze[te](_e):!1}function ie(Ze,_e,Fe){let Te=Ze;do{if(ne(Te,_e))return!0;if(Te===Fe)return!1;Te=Te.parentNode}while(Te);return!1}function oe(Ze,_e,Fe,Te){if(!Ze)return;const ke={capture:!0,...Te};Ze.addEventListener?Ze.addEventListener(_e,Fe,ke):Ze.attachEvent?Ze.attachEvent("on"+_e,Fe):Ze["on"+_e]=Fe}function se(Ze,_e,Fe,Te){if(!Ze)return;const ke={capture:!0,...Te};Ze.removeEventListener?Ze.removeEventListener(_e,Fe,ke):Ze.detachEvent?Ze.detachEvent("on"+_e,Fe):Ze["on"+_e]=null}function ae(Ze){let _e=Ze.clientHeight;const Fe=Ze.ownerDocument.defaultView.getComputedStyle(Ze);return _e+=(0,X.int)(Fe.borderTopWidth),_e+=(0,X.int)(Fe.borderBottomWidth),_e}function ge(Ze){let _e=Ze.clientWidth;const Fe=Ze.ownerDocument.defaultView.getComputedStyle(Ze);return _e+=(0,X.int)(Fe.borderLeftWidth),_e+=(0,X.int)(Fe.borderRightWidth),_e}function ce(Ze){let _e=Ze.clientHeight;const Fe=Ze.ownerDocument.defaultView.getComputedStyle(Ze);return _e-=(0,X.int)(Fe.paddingTop),_e-=(0,X.int)(Fe.paddingBottom),_e}function de(Ze){let _e=Ze.clientWidth;const Fe=Ze.ownerDocument.defaultView.getComputedStyle(Ze);return _e-=(0,X.int)(Fe.paddingLeft),_e-=(0,X.int)(Fe.paddingRight),_e}function Ie(Ze,_e,Fe){const ke=_e===_e.ownerDocument.body?{left:0,top:0}:_e.getBoundingClientRect(),Le=(Ze.clientX+_e.scrollLeft-ke.left)/Fe,Ke=(Ze.clientY+_e.scrollTop-ke.top)/Fe;return{x:Le,y:Ke}}function fe(Ze,_e){const Fe=Ae(Ze,_e,"px");return{[(0,Z.browserPrefixToKey)("transform",Z.default)]:Fe}}function be(Ze,_e){return Ae(Ze,_e,"")}function Ae(Ze,_e,Fe){let{x:Te,y:ke}=Ze,Le="translate(".concat(Te).concat(Fe,",").concat(ke).concat(Fe,")");if(_e){const Ke="".concat(typeof _e.x=="string"?_e.x:_e.x+Fe),Ue="".concat(typeof _e.y=="string"?_e.y:_e.y+Fe);Le="translate(".concat(Ke,", ").concat(Ue,")")+Le}return Le}function ye(Ze,_e){return Ze.targetTouches&&(0,X.findInArray)(Ze.targetTouches,Fe=>_e===Fe.identifier)||Ze.changedTouches&&(0,X.findInArray)(Ze.changedTouches,Fe=>_e===Fe.identifier)}function ve(Ze){if(Ze.targetTouches&&Ze.targetTouches[0])return Ze.targetTouches[0].identifier;if(Ze.changedTouches&&Ze.changedTouches[0])return Ze.changedTouches[0].identifier}function Be(Ze){if(!Ze)return;let _e=Ze.getElementById("react-draggable-style-el");_e||(_e=Ze.createElement("style"),_e.type="text/css",_e.id="react-draggable-style-el",_e.innerHTML=`.react-draggable-transparent-selection *::-moz-selection {all: inherit;}
`,_e.innerHTML+=`.react-draggable-transparent-selection *::selection {all: inherit;}
`,Ze.getElementsByTagName("head")[0].appendChild(_e)),Ze.body&&Ve(Ze.body,"react-draggable-transparent-selection")}function Re(Ze){if(Ze)try{if(Ze.body&&Ee(Ze.body,"react-draggable-transparent-selection"),Ze.selection)Ze.selection.empty();else{const _e=(Ze.defaultView||window).getSelection();_e&&_e.type!=="Caret"&&_e.removeAllRanges()}}catch{}}function Ve(Ze,_e){Ze.classList?Ze.classList.add(_e):Ze.className.match(new RegExp("(?:^|\\s)".concat(_e,"(?!\\S)")))||(Ze.className+=" ".concat(_e))}function Ee(Ze,_e){Ze.classList?Ze.classList.remove(_e):Ze.className=Ze.className.replace(new RegExp("(?:^|\\s)".concat(_e,"(?!\\S)"),"g"),"")}return domFns}var positionFns={},hasRequiredPositionFns;function requirePositionFns(){if(hasRequiredPositionFns)return positionFns;hasRequiredPositionFns=1,Object.defineProperty(positionFns,"__esModule",{value:!0}),positionFns.canDragX=te,positionFns.canDragY=ne,positionFns.createCoreData=oe,positionFns.createDraggableData=se,positionFns.getBoundPosition=_,positionFns.getControlPosition=ie,positionFns.snapToGrid=K;var X=requireShims(),Z=requireDomFns();function _(ce,de,Ie){if(!ce.props.bounds)return[de,Ie];let{bounds:fe}=ce.props;fe=typeof fe=="string"?fe:ae(fe);const be=ge(ce);if(typeof fe=="string"){const{ownerDocument:Ae}=be,ye=Ae.defaultView;let ve;if(fe==="parent"?ve=be.parentNode:ve=Ae.querySelector(fe),!(ve instanceof ye.HTMLElement))throw new Error('Bounds selector "'+fe+'" could not find an element.');const Be=ve,Re=ye.getComputedStyle(be),Ve=ye.getComputedStyle(Be);fe={left:-be.offsetLeft+(0,X.int)(Ve.paddingLeft)+(0,X.int)(Re.marginLeft),top:-be.offsetTop+(0,X.int)(Ve.paddingTop)+(0,X.int)(Re.marginTop),right:(0,Z.innerWidth)(Be)-(0,Z.outerWidth)(be)-be.offsetLeft+(0,X.int)(Ve.paddingRight)-(0,X.int)(Re.marginRight),bottom:(0,Z.innerHeight)(Be)-(0,Z.outerHeight)(be)-be.offsetTop+(0,X.int)(Ve.paddingBottom)-(0,X.int)(Re.marginBottom)}}return(0,X.isNum)(fe.right)&&(de=Math.min(de,fe.right)),(0,X.isNum)(fe.bottom)&&(Ie=Math.min(Ie,fe.bottom)),(0,X.isNum)(fe.left)&&(de=Math.max(de,fe.left)),(0,X.isNum)(fe.top)&&(Ie=Math.max(Ie,fe.top)),[de,Ie]}function K(ce,de,Ie){const fe=Math.round(de/ce[0])*ce[0],be=Math.round(Ie/ce[1])*ce[1];return[fe,be]}function te(ce){return ce.props.axis==="both"||ce.props.axis==="x"}function ne(ce){return ce.props.axis==="both"||ce.props.axis==="y"}function ie(ce,de,Ie){const fe=typeof de=="number"?(0,Z.getTouch)(ce,de):null;if(typeof de=="number"&&!fe)return null;const be=ge(Ie),Ae=Ie.props.offsetParent||be.offsetParent||be.ownerDocument.body;return(0,Z.offsetXYFromParent)(fe||ce,Ae,Ie.props.scale)}function oe(ce,de,Ie){const fe=!(0,X.isNum)(ce.lastX),be=ge(ce);return fe?{node:be,deltaX:0,deltaY:0,lastX:de,lastY:Ie,x:de,y:Ie}:{node:be,deltaX:de-ce.lastX,deltaY:Ie-ce.lastY,lastX:ce.lastX,lastY:ce.lastY,x:de,y:Ie}}function se(ce,de){const Ie=ce.props.scale;return{node:de.node,x:ce.state.x+de.deltaX/Ie,y:ce.state.y+de.deltaY/Ie,deltaX:de.deltaX/Ie,deltaY:de.deltaY/Ie,lastX:ce.state.x,lastY:ce.state.y}}function ae(ce){return{left:ce.left,top:ce.top,right:ce.right,bottom:ce.bottom}}function ge(ce){const de=ce.findDOMNode();if(!de)throw new Error("<DraggableCore>: Unmounted during event!");return de}return positionFns}var DraggableCore={},log={},hasRequiredLog;function requireLog(){if(hasRequiredLog)return log;hasRequiredLog=1,Object.defineProperty(log,"__esModule",{value:!0}),log.default=X;function X(){}return log}var hasRequiredDraggableCore;function requireDraggableCore(){if(hasRequiredDraggableCore)return DraggableCore;hasRequiredDraggableCore=1,Object.defineProperty(DraggableCore,"__esModule",{value:!0}),DraggableCore.default=void 0;var X=ae(requireReact()),Z=oe(requirePropTypes()),_=oe(requireReactDom()),K=requireDomFns(),te=requirePositionFns(),ne=requireShims(),ie=oe(requireLog());function oe(Ae){return Ae&&Ae.__esModule?Ae:{default:Ae}}function se(Ae){if(typeof WeakMap!="function")return null;var ye=new WeakMap,ve=new WeakMap;return(se=function(Be){return Be?ve:ye})(Ae)}function ae(Ae,ye){if(Ae&&Ae.__esModule)return Ae;if(Ae===null||typeof Ae!="object"&&typeof Ae!="function")return{default:Ae};var ve=se(ye);if(ve&&ve.has(Ae))return ve.get(Ae);var Be={},Re=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var Ve in Ae)if(Ve!=="default"&&Object.prototype.hasOwnProperty.call(Ae,Ve)){var Ee=Re?Object.getOwnPropertyDescriptor(Ae,Ve):null;Ee&&(Ee.get||Ee.set)?Object.defineProperty(Be,Ve,Ee):Be[Ve]=Ae[Ve]}return Be.default=Ae,ve&&ve.set(Ae,Be),Be}function ge(Ae,ye,ve){return ye=ce(ye),ye in Ae?Object.defineProperty(Ae,ye,{value:ve,enumerable:!0,configurable:!0,writable:!0}):Ae[ye]=ve,Ae}function ce(Ae){var ye=de(Ae,"string");return typeof ye=="symbol"?ye:String(ye)}function de(Ae,ye){if(typeof Ae!="object"||Ae===null)return Ae;var ve=Ae[Symbol.toPrimitive];if(ve!==void 0){var Be=ve.call(Ae,ye||"default");if(typeof Be!="object")return Be;throw new TypeError("@@toPrimitive must return a primitive value.")}return(ye==="string"?String:Number)(Ae)}const Ie={touch:{start:"touchstart",move:"touchmove",stop:"touchend"},mouse:{start:"mousedown",move:"mousemove",stop:"mouseup"}};let fe=Ie.mouse,be=class extends X.Component{constructor(){super(...arguments),ge(this,"dragging",!1),ge(this,"lastX",NaN),ge(this,"lastY",NaN),ge(this,"touchIdentifier",null),ge(this,"mounted",!1),ge(this,"handleDragStart",ye=>{if(this.props.onMouseDown(ye),!this.props.allowAnyClick&&typeof ye.button=="number"&&ye.button!==0)return!1;const ve=this.findDOMNode();if(!ve||!ve.ownerDocument||!ve.ownerDocument.body)throw new Error("<DraggableCore> not mounted on DragStart!");const{ownerDocument:Be}=ve;if(this.props.disabled||!(ye.target instanceof Be.defaultView.Node)||this.props.handle&&!(0,K.matchesSelectorAndParentsTo)(ye.target,this.props.handle,ve)||this.props.cancel&&(0,K.matchesSelectorAndParentsTo)(ye.target,this.props.cancel,ve))return;ye.type==="touchstart"&&ye.preventDefault();const Re=(0,K.getTouchIdentifier)(ye);this.touchIdentifier=Re;const Ve=(0,te.getControlPosition)(ye,Re,this);if(Ve==null)return;const{x:Ee,y:Ze}=Ve,_e=(0,te.createCoreData)(this,Ee,Ze);(0,ie.default)("DraggableCore: handleDragStart: %j",_e),(0,ie.default)("calling",this.props.onStart),!(this.props.onStart(ye,_e)===!1||this.mounted===!1)&&(this.props.enableUserSelectHack&&(0,K.addUserSelectStyles)(Be),this.dragging=!0,this.lastX=Ee,this.lastY=Ze,(0,K.addEvent)(Be,fe.move,this.handleDrag),(0,K.addEvent)(Be,fe.stop,this.handleDragStop))}),ge(this,"handleDrag",ye=>{const ve=(0,te.getControlPosition)(ye,this.touchIdentifier,this);if(ve==null)return;let{x:Be,y:Re}=ve;if(Array.isArray(this.props.grid)){let Ze=Be-this.lastX,_e=Re-this.lastY;if([Ze,_e]=(0,te.snapToGrid)(this.props.grid,Ze,_e),!Ze&&!_e)return;Be=this.lastX+Ze,Re=this.lastY+_e}const Ve=(0,te.createCoreData)(this,Be,Re);if((0,ie.default)("DraggableCore: handleDrag: %j",Ve),this.props.onDrag(ye,Ve)===!1||this.mounted===!1){try{this.handleDragStop(new MouseEvent("mouseup"))}catch{const _e=document.createEvent("MouseEvents");_e.initMouseEvent("mouseup",!0,!0,window,0,0,0,0,0,!1,!1,!1,!1,0,null),this.handleDragStop(_e)}return}this.lastX=Be,this.lastY=Re}),ge(this,"handleDragStop",ye=>{if(!this.dragging)return;const ve=(0,te.getControlPosition)(ye,this.touchIdentifier,this);if(ve==null)return;let{x:Be,y:Re}=ve;if(Array.isArray(this.props.grid)){let _e=Be-this.lastX||0,Fe=Re-this.lastY||0;[_e,Fe]=(0,te.snapToGrid)(this.props.grid,_e,Fe),Be=this.lastX+_e,Re=this.lastY+Fe}const Ve=(0,te.createCoreData)(this,Be,Re);if(this.props.onStop(ye,Ve)===!1||this.mounted===!1)return!1;const Ze=this.findDOMNode();Ze&&this.props.enableUserSelectHack&&(0,K.removeUserSelectStyles)(Ze.ownerDocument),(0,ie.default)("DraggableCore: handleDragStop: %j",Ve),this.dragging=!1,this.lastX=NaN,this.lastY=NaN,Ze&&((0,ie.default)("DraggableCore: Removing handlers"),(0,K.removeEvent)(Ze.ownerDocument,fe.move,this.handleDrag),(0,K.removeEvent)(Ze.ownerDocument,fe.stop,this.handleDragStop))}),ge(this,"onMouseDown",ye=>(fe=Ie.mouse,this.handleDragStart(ye))),ge(this,"onMouseUp",ye=>(fe=Ie.mouse,this.handleDragStop(ye))),ge(this,"onTouchStart",ye=>(fe=Ie.touch,this.handleDragStart(ye))),ge(this,"onTouchEnd",ye=>(fe=Ie.touch,this.handleDragStop(ye)))}componentDidMount(){this.mounted=!0;const ye=this.findDOMNode();ye&&(0,K.addEvent)(ye,Ie.touch.start,this.onTouchStart,{passive:!1})}componentWillUnmount(){this.mounted=!1;const ye=this.findDOMNode();if(ye){const{ownerDocument:ve}=ye;(0,K.removeEvent)(ve,Ie.mouse.move,this.handleDrag),(0,K.removeEvent)(ve,Ie.touch.move,this.handleDrag),(0,K.removeEvent)(ve,Ie.mouse.stop,this.handleDragStop),(0,K.removeEvent)(ve,Ie.touch.stop,this.handleDragStop),(0,K.removeEvent)(ye,Ie.touch.start,this.onTouchStart,{passive:!1}),this.props.enableUserSelectHack&&(0,K.removeUserSelectStyles)(ve)}}findDOMNode(){var ye,ve;return(ye=this.props)!==null&&ye!==void 0&&ye.nodeRef?(ve=this.props)===null||ve===void 0||(ve=ve.nodeRef)===null||ve===void 0?void 0:ve.current:_.default.findDOMNode(this)}render(){return X.cloneElement(X.Children.only(this.props.children),{onMouseDown:this.onMouseDown,onMouseUp:this.onMouseUp,onTouchEnd:this.onTouchEnd})}};return DraggableCore.default=be,ge(be,"displayName","DraggableCore"),ge(be,"propTypes",{allowAnyClick:Z.default.bool,children:Z.default.node.isRequired,disabled:Z.default.bool,enableUserSelectHack:Z.default.bool,offsetParent:function(Ae,ye){if(Ae[ye]&&Ae[ye].nodeType!==1)throw new Error("Draggable's offsetParent must be a DOM Node.")},grid:Z.default.arrayOf(Z.default.number),handle:Z.default.string,cancel:Z.default.string,nodeRef:Z.default.object,onStart:Z.default.func,onDrag:Z.default.func,onStop:Z.default.func,onMouseDown:Z.default.func,scale:Z.default.number,className:ne.dontSetMe,style:ne.dontSetMe,transform:ne.dontSetMe}),ge(be,"defaultProps",{allowAnyClick:!1,disabled:!1,enableUserSelectHack:!0,onStart:function(){},onDrag:function(){},onStop:function(){},onMouseDown:function(){},scale:1}),DraggableCore}var hasRequiredDraggable;function requireDraggable(){return hasRequiredDraggable||(hasRequiredDraggable=1,function(X){Object.defineProperty(X,"__esModule",{value:!0}),Object.defineProperty(X,"DraggableCore",{enumerable:!0,get:function(){return se.default}}),X.default=void 0;var Z=de(requireReact()),_=ge(requirePropTypes()),K=ge(requireReactDom()),te=ge(require$$3),ne=requireDomFns(),ie=requirePositionFns(),oe=requireShims(),se=ge(requireDraggableCore()),ae=ge(requireLog());function ge(ve){return ve&&ve.__esModule?ve:{default:ve}}function ce(ve){if(typeof WeakMap!="function")return null;var Be=new WeakMap,Re=new WeakMap;return(ce=function(Ve){return Ve?Re:Be})(ve)}function de(ve,Be){if(ve&&ve.__esModule)return ve;if(ve===null||typeof ve!="object"&&typeof ve!="function")return{default:ve};var Re=ce(Be);if(Re&&Re.has(ve))return Re.get(ve);var Ve={},Ee=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var Ze in ve)if(Ze!=="default"&&Object.prototype.hasOwnProperty.call(ve,Ze)){var _e=Ee?Object.getOwnPropertyDescriptor(ve,Ze):null;_e&&(_e.get||_e.set)?Object.defineProperty(Ve,Ze,_e):Ve[Ze]=ve[Ze]}return Ve.default=ve,Re&&Re.set(ve,Ve),Ve}function Ie(){return Ie=Object.assign?Object.assign.bind():function(ve){for(var Be=1;Be<arguments.length;Be++){var Re=arguments[Be];for(var Ve in Re)Object.prototype.hasOwnProperty.call(Re,Ve)&&(ve[Ve]=Re[Ve])}return ve},Ie.apply(this,arguments)}function fe(ve,Be,Re){return Be=be(Be),Be in ve?Object.defineProperty(ve,Be,{value:Re,enumerable:!0,configurable:!0,writable:!0}):ve[Be]=Re,ve}function be(ve){var Be=Ae(ve,"string");return typeof Be=="symbol"?Be:String(Be)}function Ae(ve,Be){if(typeof ve!="object"||ve===null)return ve;var Re=ve[Symbol.toPrimitive];if(Re!==void 0){var Ve=Re.call(ve,Be||"default");if(typeof Ve!="object")return Ve;throw new TypeError("@@toPrimitive must return a primitive value.")}return(Be==="string"?String:Number)(ve)}class ye extends Z.Component{static getDerivedStateFromProps(Be,Re){let{position:Ve}=Be,{prevPropsPosition:Ee}=Re;return Ve&&(!Ee||Ve.x!==Ee.x||Ve.y!==Ee.y)?((0,ae.default)("Draggable: getDerivedStateFromProps %j",{position:Ve,prevPropsPosition:Ee}),{x:Ve.x,y:Ve.y,prevPropsPosition:{...Ve}}):null}constructor(Be){super(Be),fe(this,"onDragStart",(Re,Ve)=>{if((0,ae.default)("Draggable: onDragStart: %j",Ve),this.props.onStart(Re,(0,ie.createDraggableData)(this,Ve))===!1)return!1;this.setState({dragging:!0,dragged:!0})}),fe(this,"onDrag",(Re,Ve)=>{if(!this.state.dragging)return!1;(0,ae.default)("Draggable: onDrag: %j",Ve);const Ee=(0,ie.createDraggableData)(this,Ve),Ze={x:Ee.x,y:Ee.y,slackX:0,slackY:0};if(this.props.bounds){const{x:Fe,y:Te}=Ze;Ze.x+=this.state.slackX,Ze.y+=this.state.slackY;const[ke,Le]=(0,ie.getBoundPosition)(this,Ze.x,Ze.y);Ze.x=ke,Ze.y=Le,Ze.slackX=this.state.slackX+(Fe-Ze.x),Ze.slackY=this.state.slackY+(Te-Ze.y),Ee.x=Ze.x,Ee.y=Ze.y,Ee.deltaX=Ze.x-this.state.x,Ee.deltaY=Ze.y-this.state.y}if(this.props.onDrag(Re,Ee)===!1)return!1;this.setState(Ze)}),fe(this,"onDragStop",(Re,Ve)=>{if(!this.state.dragging||this.props.onStop(Re,(0,ie.createDraggableData)(this,Ve))===!1)return!1;(0,ae.default)("Draggable: onDragStop: %j",Ve);const Ze={dragging:!1,slackX:0,slackY:0};if(!!this.props.position){const{x:Fe,y:Te}=this.props.position;Ze.x=Fe,Ze.y=Te}this.setState(Ze)}),this.state={dragging:!1,dragged:!1,x:Be.position?Be.position.x:Be.defaultPosition.x,y:Be.position?Be.position.y:Be.defaultPosition.y,prevPropsPosition:{...Be.position},slackX:0,slackY:0,isElementSVG:!1},Be.position&&!(Be.onDrag||Be.onStop)&&console.warn("A `position` was applied to this <Draggable>, without drag handlers. This will make this component effectively undraggable. Please attach `onDrag` or `onStop` handlers so you can adjust the `position` of this element.")}componentDidMount(){typeof window.SVGElement<"u"&&this.findDOMNode()instanceof window.SVGElement&&this.setState({isElementSVG:!0})}componentWillUnmount(){this.setState({dragging:!1})}findDOMNode(){var Be,Re;return(Be=(Re=this.props)===null||Re===void 0||(Re=Re.nodeRef)===null||Re===void 0?void 0:Re.current)!==null&&Be!==void 0?Be:K.default.findDOMNode(this)}render(){const{axis:Be,bounds:Re,children:Ve,defaultPosition:Ee,defaultClassName:Ze,defaultClassNameDragging:_e,defaultClassNameDragged:Fe,position:Te,positionOffset:ke,scale:Le,...Ke}=this.props;let Ue={},rt=null;const at=!!!Te||this.state.dragging,ze=Te||Ee,qe={x:(0,ie.canDragX)(this)&&at?this.state.x:ze.x,y:(0,ie.canDragY)(this)&&at?this.state.y:ze.y};this.state.isElementSVG?rt=(0,ne.createSVGTransform)(qe,ke):Ue=(0,ne.createCSSTransform)(qe,ke);const Pe=(0,te.default)(Ve.props.className||"",Ze,{[_e]:this.state.dragging,[Fe]:this.state.dragged});return Z.createElement(se.default,Ie({},Ke,{onStart:this.onDragStart,onDrag:this.onDrag,onStop:this.onDragStop}),Z.cloneElement(Z.Children.only(Ve),{className:Pe,style:{...Ve.props.style,...Ue},transform:rt}))}}X.default=ye,fe(ye,"displayName","Draggable"),fe(ye,"propTypes",{...se.default.propTypes,axis:_.default.oneOf(["both","x","y","none"]),bounds:_.default.oneOfType([_.default.shape({left:_.default.number,right:_.default.number,top:_.default.number,bottom:_.default.number}),_.default.string,_.default.oneOf([!1])]),defaultClassName:_.default.string,defaultClassNameDragging:_.default.string,defaultClassNameDragged:_.default.string,defaultPosition:_.default.shape({x:_.default.number,y:_.default.number}),positionOffset:_.default.shape({x:_.default.oneOfType([_.default.number,_.default.string]),y:_.default.oneOfType([_.default.number,_.default.string])}),position:_.default.shape({x:_.default.number,y:_.default.number}),className:oe.dontSetMe,style:oe.dontSetMe,transform:oe.dontSetMe}),fe(ye,"defaultProps",{...se.default.defaultProps,axis:"both",bounds:!1,defaultClassName:"react-draggable",defaultClassNameDragging:"react-draggable-dragging",defaultClassNameDragged:"react-draggable-dragged",defaultPosition:{x:0,y:0},scale:1})}(Draggable$1)),Draggable$1}var hasRequiredCjs;function requireCjs(){if(hasRequiredCjs)return cjs.exports;hasRequiredCjs=1;const{default:X,DraggableCore:Z}=requireDraggable();return cjs.exports=X,cjs.exports.default=X,cjs.exports.DraggableCore=Z,cjs.exports}var cjsExports=requireCjs();const Draggable=getDefaultExportFromCjs(cjsExports);var DefaultContext={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},IconContext=React.createContext&&React.createContext(DefaultContext),_excluded=["attr","size","title"];function _objectWithoutProperties(X,Z){if(X==null)return{};var _=_objectWithoutPropertiesLoose(X,Z),K,te;if(Object.getOwnPropertySymbols){var ne=Object.getOwnPropertySymbols(X);for(te=0;te<ne.length;te++)K=ne[te],!(Z.indexOf(K)>=0)&&Object.prototype.propertyIsEnumerable.call(X,K)&&(_[K]=X[K])}return _}function _objectWithoutPropertiesLoose(X,Z){if(X==null)return{};var _={};for(var K in X)if(Object.prototype.hasOwnProperty.call(X,K)){if(Z.indexOf(K)>=0)continue;_[K]=X[K]}return _}function _extends(){return _extends=Object.assign?Object.assign.bind():function(X){for(var Z=1;Z<arguments.length;Z++){var _=arguments[Z];for(var K in _)Object.prototype.hasOwnProperty.call(_,K)&&(X[K]=_[K])}return X},_extends.apply(this,arguments)}function ownKeys(X,Z){var _=Object.keys(X);if(Object.getOwnPropertySymbols){var K=Object.getOwnPropertySymbols(X);Z&&(K=K.filter(function(te){return Object.getOwnPropertyDescriptor(X,te).enumerable})),_.push.apply(_,K)}return _}function _objectSpread(X){for(var Z=1;Z<arguments.length;Z++){var _=arguments[Z]!=null?arguments[Z]:{};Z%2?ownKeys(Object(_),!0).forEach(function(K){_defineProperty(X,K,_[K])}):Object.getOwnPropertyDescriptors?Object.defineProperties(X,Object.getOwnPropertyDescriptors(_)):ownKeys(Object(_)).forEach(function(K){Object.defineProperty(X,K,Object.getOwnPropertyDescriptor(_,K))})}return X}function _defineProperty(X,Z,_){return Z=_toPropertyKey(Z),Z in X?Object.defineProperty(X,Z,{value:_,enumerable:!0,configurable:!0,writable:!0}):X[Z]=_,X}function _toPropertyKey(X){var Z=_toPrimitive(X,"string");return typeof Z=="symbol"?Z:Z+""}function _toPrimitive(X,Z){if(typeof X!="object"||!X)return X;var _=X[Symbol.toPrimitive];if(_!==void 0){var K=_.call(X,Z||"default");if(typeof K!="object")return K;throw new TypeError("@@toPrimitive must return a primitive value.")}return(Z==="string"?String:Number)(X)}function Tree2Element(X){return X&&X.map((Z,_)=>React.createElement(Z.tag,_objectSpread({key:_},Z.attr),Tree2Element(Z.child)))}function GenIcon(X){return Z=>React.createElement(IconBase,_extends({attr:_objectSpread({},X.attr)},Z),Tree2Element(X.child))}function IconBase(X){var Z=_=>{var{attr:K,size:te,title:ne}=X,ie=_objectWithoutProperties(X,_excluded),oe=te||_.size||"1em",se;return _.className&&(se=_.className),X.className&&(se=(se?se+" ":"")+X.className),React.createElement("svg",_extends({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},_.attr,K,ie,{className:se,style:_objectSpread(_objectSpread({color:X.color||_.color},_.style),X.style),height:oe,width:oe,xmlns:"http://www.w3.org/2000/svg"}),ne&&React.createElement("title",null,ne),X.children)};return IconContext!==void 0?React.createElement(IconContext.Consumer,null,_=>Z(_)):Z(DefaultContext)}function MdMicOff(X){return GenIcon({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0zm0 0h24v24H0z"},child:[]},{tag:"path",attr:{d:"M19 11h-1.7c0 .74-.16 1.43-.43 2.05l1.23 1.23c.56-.98.9-2.09.9-3.28zm-4.02.17c0-.06.02-.11.02-.17V5c0-1.66-1.34-3-3-3S9 3.34 9 5v.18l5.98 5.99zM4.27 3 3 4.27l6.01 6.01V11c0 1.66 1.33 3 2.99 3 .22 0 .44-.03.65-.08l1.66 1.66c-.71.33-1.5.52-2.31.52-2.76 0-5.3-2.1-5.3-5.1H5c0 3.41 2.72 6.23 6 6.72V21h2v-3.28c.91-.13 1.77-.45 2.54-.9L19.73 21 21 19.73 4.27 3z"},child:[]}]})(X)}function MdMic(X){return GenIcon({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"},child:[]},{tag:"path",attr:{d:"M12 14c1.66 0 2.99-1.34 2.99-3L15 5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3zm5.3-3c0 3-2.54 5.1-5.3 5.1S6.7 14 6.7 11H5c0 3.41 2.72 6.23 6 6.72V21h2v-3.28c3.28-.48 6-3.3 6-6.72h-1.7z"},child:[]}]})(X)}function MdSpeed(X){return GenIcon({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"},child:[]},{tag:"path",attr:{d:"m20.38 8.57-1.23 1.85a8 8 0 0 1-.22 7.58H5.07A8 8 0 0 1 15.58 6.85l1.85-1.23A10 10 0 0 0 3.35 19a2 2 0 0 0 1.72 1h13.85a2 2 0 0 0 1.74-1 10 10 0 0 0-.27-10.44zm-9.79 6.84a2 2 0 0 0 2.83 0l5.66-8.49-8.49 5.66a2 2 0 0 0 0 2.83z"},child:[]}]})(X)}function MdSend(X){return GenIcon({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"},child:[]},{tag:"path",attr:{d:"M2.01 21 23 12 2.01 3 2 10l15 2-15 2z"},child:[]}]})(X)}function MdExpandLess(X){return GenIcon({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"},child:[]},{tag:"path",attr:{d:"m12 8-6 6 1.41 1.41L12 10.83l4.59 4.58L18 14z"},child:[]}]})(X)}function MdExpandMore(X){return GenIcon({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"},child:[]},{tag:"path",attr:{d:"M16.59 8.59 12 13.17 7.41 8.59 6 10l6 6 6-6z"},child:[]}]})(X)}function MdRefresh(X){return GenIcon({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"},child:[]},{tag:"path",attr:{d:"M17.65 6.35A7.958 7.958 0 0 0 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08A5.99 5.99 0 0 1 12 18c-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4l-2.35 2.35z"},child:[]}]})(X)}var convaiWebClient_umd$1={exports:{}},convaiWebClient_umd=convaiWebClient_umd$1.exports,hasRequiredConvaiWebClient_umd;function requireConvaiWebClient_umd(){return hasRequiredConvaiWebClient_umd||(hasRequiredConvaiWebClient_umd=1,function(module,exports){(function(X,Z){module.exports=Z()})(convaiWebClient_umd,()=>(()=>{var __webpack_modules__={720:(X,Z,_)=>{var K=_(339),te=K,ne=Function("return this")();te.exportSymbol("proto.service.ARKitBlendShapes",null,ne),te.exportSymbol("proto.service.ARKitBlendShapesData",null,ne),proto.service.ARKitBlendShapesData=function(ie){K.Message.initialize(this,ie,0,-1,null,null)},te.inherits(proto.service.ARKitBlendShapesData,K.Message),te.DEBUG&&!COMPILED&&(proto.service.ARKitBlendShapesData.displayName="proto.service.ARKitBlendShapesData"),K.Message.GENERATE_TO_OBJECT&&(proto.service.ARKitBlendShapesData.prototype.toObject=function(ie){return proto.service.ARKitBlendShapesData.toObject(ie,this)},proto.service.ARKitBlendShapesData.toObject=function(ie,oe){var se,ae={arKitBlendShapes:(se=oe.getArKitBlendShapes())&&proto.service.ARKitBlendShapes.toObject(ie,se)};return ie&&(ae.$jspbMessageInstance=oe),ae}),proto.service.ARKitBlendShapesData.deserializeBinary=function(ie){var oe=new K.BinaryReader(ie),se=new proto.service.ARKitBlendShapesData;return proto.service.ARKitBlendShapesData.deserializeBinaryFromReader(se,oe)},proto.service.ARKitBlendShapesData.deserializeBinaryFromReader=function(ie,oe){for(;oe.nextField()&&!oe.isEndGroup();)if(oe.getFieldNumber()===1){var se=new proto.service.ARKitBlendShapes;oe.readMessage(se,proto.service.ARKitBlendShapes.deserializeBinaryFromReader),ie.setArKitBlendShapes(se)}else oe.skipField();return ie},proto.service.ARKitBlendShapesData.prototype.serializeBinary=function(){var ie=new K.BinaryWriter;return proto.service.ARKitBlendShapesData.serializeBinaryToWriter(this,ie),ie.getResultBuffer()},proto.service.ARKitBlendShapesData.serializeBinaryToWriter=function(ie,oe){var se;(se=ie.getArKitBlendShapes())!=null&&oe.writeMessage(1,se,proto.service.ARKitBlendShapes.serializeBinaryToWriter)},proto.service.ARKitBlendShapesData.prototype.getArKitBlendShapes=function(){return K.Message.getWrapperField(this,proto.service.ARKitBlendShapes,1)},proto.service.ARKitBlendShapesData.prototype.setArKitBlendShapes=function(ie){K.Message.setWrapperField(this,1,ie)},proto.service.ARKitBlendShapesData.prototype.clearArKitBlendShapes=function(){this.setArKitBlendShapes(void 0)},proto.service.ARKitBlendShapesData.prototype.hasArKitBlendShapes=function(){return K.Message.getField(this,1)!=null},proto.service.ARKitBlendShapes=function(ie){K.Message.initialize(this,ie,0,-1,null,null)},te.inherits(proto.service.ARKitBlendShapes,K.Message),te.DEBUG&&!COMPILED&&(proto.service.ARKitBlendShapes.displayName="proto.service.ARKitBlendShapes"),K.Message.GENERATE_TO_OBJECT&&(proto.service.ARKitBlendShapes.prototype.toObject=function(ie){return proto.service.ARKitBlendShapes.toObject(ie,this)},proto.service.ARKitBlendShapes.toObject=function(ie,oe){var se={browDownLeft:+K.Message.getFieldWithDefault(oe,1,0),browDownRight:+K.Message.getFieldWithDefault(oe,2,0),browInnerUp:+K.Message.getFieldWithDefault(oe,3,0),browOuterUpLeft:+K.Message.getFieldWithDefault(oe,4,0),browOuterUpRight:+K.Message.getFieldWithDefault(oe,5,0),cheekPuff:+K.Message.getFieldWithDefault(oe,6,0),cheekSquintLeft:+K.Message.getFieldWithDefault(oe,7,0),cheekSquintRight:+K.Message.getFieldWithDefault(oe,8,0),eyeBlinkLeft:+K.Message.getFieldWithDefault(oe,9,0),eyeBlinkRight:+K.Message.getFieldWithDefault(oe,10,0),eyeLookDownLeft:+K.Message.getFieldWithDefault(oe,11,0),eyeLookDownRight:+K.Message.getFieldWithDefault(oe,12,0),eyeLookInLeft:+K.Message.getFieldWithDefault(oe,13,0),eyeLookInRight:+K.Message.getFieldWithDefault(oe,14,0),eyeLookOutLeft:+K.Message.getFieldWithDefault(oe,15,0),eyeLookOutRight:+K.Message.getFieldWithDefault(oe,16,0),eyeLookUpLeft:+K.Message.getFieldWithDefault(oe,17,0),eyeLookUpRight:+K.Message.getFieldWithDefault(oe,18,0),eyeSquintLeft:+K.Message.getFieldWithDefault(oe,19,0),eyeSquintRight:+K.Message.getFieldWithDefault(oe,20,0),eyeWideLeft:+K.Message.getFieldWithDefault(oe,21,0),eyeWideRight:+K.Message.getFieldWithDefault(oe,22,0),jawForward:+K.Message.getFieldWithDefault(oe,23,0),jawLeft:+K.Message.getFieldWithDefault(oe,24,0),jawOpen:+K.Message.getFieldWithDefault(oe,25,0),jawRight:+K.Message.getFieldWithDefault(oe,26,0),mouthClose:+K.Message.getFieldWithDefault(oe,27,0),mouthDimpleLeft:+K.Message.getFieldWithDefault(oe,28,0),mouthDimpleRight:+K.Message.getFieldWithDefault(oe,29,0),mouthFrownLeft:+K.Message.getFieldWithDefault(oe,30,0),mouthFrownRight:+K.Message.getFieldWithDefault(oe,31,0),mouthFunnel:+K.Message.getFieldWithDefault(oe,32,0),mouthLeft:+K.Message.getFieldWithDefault(oe,33,0),mouthLowerDownLeft:+K.Message.getFieldWithDefault(oe,34,0),mouthLowerDownRight:+K.Message.getFieldWithDefault(oe,35,0),mouthPressLeft:+K.Message.getFieldWithDefault(oe,36,0),mouthPressRight:+K.Message.getFieldWithDefault(oe,37,0),mouthPucker:+K.Message.getFieldWithDefault(oe,38,0),mouthRight:+K.Message.getFieldWithDefault(oe,39,0),mouthRollLower:+K.Message.getFieldWithDefault(oe,40,0),mouthRollUpper:+K.Message.getFieldWithDefault(oe,41,0),mouthShrugLower:+K.Message.getFieldWithDefault(oe,42,0),mouthShrugUpper:+K.Message.getFieldWithDefault(oe,43,0),mouthSmileLeft:+K.Message.getFieldWithDefault(oe,44,0),mouthSmileRight:+K.Message.getFieldWithDefault(oe,45,0),mouthStretchLeft:+K.Message.getFieldWithDefault(oe,46,0),mouthStretchRight:+K.Message.getFieldWithDefault(oe,47,0),mouthUpperUpLeft:+K.Message.getFieldWithDefault(oe,48,0),mouthUpperUpRight:+K.Message.getFieldWithDefault(oe,49,0),noseSneerLeft:+K.Message.getFieldWithDefault(oe,50,0),noseSneerRight:+K.Message.getFieldWithDefault(oe,51,0),tongueOut:+K.Message.getFieldWithDefault(oe,52,0)};return ie&&(se.$jspbMessageInstance=oe),se}),proto.service.ARKitBlendShapes.deserializeBinary=function(ie){var oe=new K.BinaryReader(ie),se=new proto.service.ARKitBlendShapes;return proto.service.ARKitBlendShapes.deserializeBinaryFromReader(se,oe)},proto.service.ARKitBlendShapes.deserializeBinaryFromReader=function(ie,oe){for(;oe.nextField()&&!oe.isEndGroup();)switch(oe.getFieldNumber()){case 1:var se=oe.readFloat();ie.setBrowDownLeft(se);break;case 2:se=oe.readFloat(),ie.setBrowDownRight(se);break;case 3:se=oe.readFloat(),ie.setBrowInnerUp(se);break;case 4:se=oe.readFloat(),ie.setBrowOuterUpLeft(se);break;case 5:se=oe.readFloat(),ie.setBrowOuterUpRight(se);break;case 6:se=oe.readFloat(),ie.setCheekPuff(se);break;case 7:se=oe.readFloat(),ie.setCheekSquintLeft(se);break;case 8:se=oe.readFloat(),ie.setCheekSquintRight(se);break;case 9:se=oe.readFloat(),ie.setEyeBlinkLeft(se);break;case 10:se=oe.readFloat(),ie.setEyeBlinkRight(se);break;case 11:se=oe.readFloat(),ie.setEyeLookDownLeft(se);break;case 12:se=oe.readFloat(),ie.setEyeLookDownRight(se);break;case 13:se=oe.readFloat(),ie.setEyeLookInLeft(se);break;case 14:se=oe.readFloat(),ie.setEyeLookInRight(se);break;case 15:se=oe.readFloat(),ie.setEyeLookOutLeft(se);break;case 16:se=oe.readFloat(),ie.setEyeLookOutRight(se);break;case 17:se=oe.readFloat(),ie.setEyeLookUpLeft(se);break;case 18:se=oe.readFloat(),ie.setEyeLookUpRight(se);break;case 19:se=oe.readFloat(),ie.setEyeSquintLeft(se);break;case 20:se=oe.readFloat(),ie.setEyeSquintRight(se);break;case 21:se=oe.readFloat(),ie.setEyeWideLeft(se);break;case 22:se=oe.readFloat(),ie.setEyeWideRight(se);break;case 23:se=oe.readFloat(),ie.setJawForward(se);break;case 24:se=oe.readFloat(),ie.setJawLeft(se);break;case 25:se=oe.readFloat(),ie.setJawOpen(se);break;case 26:se=oe.readFloat(),ie.setJawRight(se);break;case 27:se=oe.readFloat(),ie.setMouthClose(se);break;case 28:se=oe.readFloat(),ie.setMouthDimpleLeft(se);break;case 29:se=oe.readFloat(),ie.setMouthDimpleRight(se);break;case 30:se=oe.readFloat(),ie.setMouthFrownLeft(se);break;case 31:se=oe.readFloat(),ie.setMouthFrownRight(se);break;case 32:se=oe.readFloat(),ie.setMouthFunnel(se);break;case 33:se=oe.readFloat(),ie.setMouthLeft(se);break;case 34:se=oe.readFloat(),ie.setMouthLowerDownLeft(se);break;case 35:se=oe.readFloat(),ie.setMouthLowerDownRight(se);break;case 36:se=oe.readFloat(),ie.setMouthPressLeft(se);break;case 37:se=oe.readFloat(),ie.setMouthPressRight(se);break;case 38:se=oe.readFloat(),ie.setMouthPucker(se);break;case 39:se=oe.readFloat(),ie.setMouthRight(se);break;case 40:se=oe.readFloat(),ie.setMouthRollLower(se);break;case 41:se=oe.readFloat(),ie.setMouthRollUpper(se);break;case 42:se=oe.readFloat(),ie.setMouthShrugLower(se);break;case 43:se=oe.readFloat(),ie.setMouthShrugUpper(se);break;case 44:se=oe.readFloat(),ie.setMouthSmileLeft(se);break;case 45:se=oe.readFloat(),ie.setMouthSmileRight(se);break;case 46:se=oe.readFloat(),ie.setMouthStretchLeft(se);break;case 47:se=oe.readFloat(),ie.setMouthStretchRight(se);break;case 48:se=oe.readFloat(),ie.setMouthUpperUpLeft(se);break;case 49:se=oe.readFloat(),ie.setMouthUpperUpRight(se);break;case 50:se=oe.readFloat(),ie.setNoseSneerLeft(se);break;case 51:se=oe.readFloat(),ie.setNoseSneerRight(se);break;case 52:se=oe.readFloat(),ie.setTongueOut(se);break;default:oe.skipField()}return ie},proto.service.ARKitBlendShapes.prototype.serializeBinary=function(){var ie=new K.BinaryWriter;return proto.service.ARKitBlendShapes.serializeBinaryToWriter(this,ie),ie.getResultBuffer()},proto.service.ARKitBlendShapes.serializeBinaryToWriter=function(ie,oe){var se=void 0;(se=ie.getBrowDownLeft())!==0&&oe.writeFloat(1,se),(se=ie.getBrowDownRight())!==0&&oe.writeFloat(2,se),(se=ie.getBrowInnerUp())!==0&&oe.writeFloat(3,se),(se=ie.getBrowOuterUpLeft())!==0&&oe.writeFloat(4,se),(se=ie.getBrowOuterUpRight())!==0&&oe.writeFloat(5,se),(se=ie.getCheekPuff())!==0&&oe.writeFloat(6,se),(se=ie.getCheekSquintLeft())!==0&&oe.writeFloat(7,se),(se=ie.getCheekSquintRight())!==0&&oe.writeFloat(8,se),(se=ie.getEyeBlinkLeft())!==0&&oe.writeFloat(9,se),(se=ie.getEyeBlinkRight())!==0&&oe.writeFloat(10,se),(se=ie.getEyeLookDownLeft())!==0&&oe.writeFloat(11,se),(se=ie.getEyeLookDownRight())!==0&&oe.writeFloat(12,se),(se=ie.getEyeLookInLeft())!==0&&oe.writeFloat(13,se),(se=ie.getEyeLookInRight())!==0&&oe.writeFloat(14,se),(se=ie.getEyeLookOutLeft())!==0&&oe.writeFloat(15,se),(se=ie.getEyeLookOutRight())!==0&&oe.writeFloat(16,se),(se=ie.getEyeLookUpLeft())!==0&&oe.writeFloat(17,se),(se=ie.getEyeLookUpRight())!==0&&oe.writeFloat(18,se),(se=ie.getEyeSquintLeft())!==0&&oe.writeFloat(19,se),(se=ie.getEyeSquintRight())!==0&&oe.writeFloat(20,se),(se=ie.getEyeWideLeft())!==0&&oe.writeFloat(21,se),(se=ie.getEyeWideRight())!==0&&oe.writeFloat(22,se),(se=ie.getJawForward())!==0&&oe.writeFloat(23,se),(se=ie.getJawLeft())!==0&&oe.writeFloat(24,se),(se=ie.getJawOpen())!==0&&oe.writeFloat(25,se),(se=ie.getJawRight())!==0&&oe.writeFloat(26,se),(se=ie.getMouthClose())!==0&&oe.writeFloat(27,se),(se=ie.getMouthDimpleLeft())!==0&&oe.writeFloat(28,se),(se=ie.getMouthDimpleRight())!==0&&oe.writeFloat(29,se),(se=ie.getMouthFrownLeft())!==0&&oe.writeFloat(30,se),(se=ie.getMouthFrownRight())!==0&&oe.writeFloat(31,se),(se=ie.getMouthFunnel())!==0&&oe.writeFloat(32,se),(se=ie.getMouthLeft())!==0&&oe.writeFloat(33,se),(se=ie.getMouthLowerDownLeft())!==0&&oe.writeFloat(34,se),(se=ie.getMouthLowerDownRight())!==0&&oe.writeFloat(35,se),(se=ie.getMouthPressLeft())!==0&&oe.writeFloat(36,se),(se=ie.getMouthPressRight())!==0&&oe.writeFloat(37,se),(se=ie.getMouthPucker())!==0&&oe.writeFloat(38,se),(se=ie.getMouthRight())!==0&&oe.writeFloat(39,se),(se=ie.getMouthRollLower())!==0&&oe.writeFloat(40,se),(se=ie.getMouthRollUpper())!==0&&oe.writeFloat(41,se),(se=ie.getMouthShrugLower())!==0&&oe.writeFloat(42,se),(se=ie.getMouthShrugUpper())!==0&&oe.writeFloat(43,se),(se=ie.getMouthSmileLeft())!==0&&oe.writeFloat(44,se),(se=ie.getMouthSmileRight())!==0&&oe.writeFloat(45,se),(se=ie.getMouthStretchLeft())!==0&&oe.writeFloat(46,se),(se=ie.getMouthStretchRight())!==0&&oe.writeFloat(47,se),(se=ie.getMouthUpperUpLeft())!==0&&oe.writeFloat(48,se),(se=ie.getMouthUpperUpRight())!==0&&oe.writeFloat(49,se),(se=ie.getNoseSneerLeft())!==0&&oe.writeFloat(50,se),(se=ie.getNoseSneerRight())!==0&&oe.writeFloat(51,se),(se=ie.getTongueOut())!==0&&oe.writeFloat(52,se)},proto.service.ARKitBlendShapes.prototype.getBrowDownLeft=function(){return+K.Message.getFieldWithDefault(this,1,0)},proto.service.ARKitBlendShapes.prototype.setBrowDownLeft=function(ie){K.Message.setProto3FloatField(this,1,ie)},proto.service.ARKitBlendShapes.prototype.getBrowDownRight=function(){return+K.Message.getFieldWithDefault(this,2,0)},proto.service.ARKitBlendShapes.prototype.setBrowDownRight=function(ie){K.Message.setProto3FloatField(this,2,ie)},proto.service.ARKitBlendShapes.prototype.getBrowInnerUp=function(){return+K.Message.getFieldWithDefault(this,3,0)},proto.service.ARKitBlendShapes.prototype.setBrowInnerUp=function(ie){K.Message.setProto3FloatField(this,3,ie)},proto.service.ARKitBlendShapes.prototype.getBrowOuterUpLeft=function(){return+K.Message.getFieldWithDefault(this,4,0)},proto.service.ARKitBlendShapes.prototype.setBrowOuterUpLeft=function(ie){K.Message.setProto3FloatField(this,4,ie)},proto.service.ARKitBlendShapes.prototype.getBrowOuterUpRight=function(){return+K.Message.getFieldWithDefault(this,5,0)},proto.service.ARKitBlendShapes.prototype.setBrowOuterUpRight=function(ie){K.Message.setProto3FloatField(this,5,ie)},proto.service.ARKitBlendShapes.prototype.getCheekPuff=function(){return+K.Message.getFieldWithDefault(this,6,0)},proto.service.ARKitBlendShapes.prototype.setCheekPuff=function(ie){K.Message.setProto3FloatField(this,6,ie)},proto.service.ARKitBlendShapes.prototype.getCheekSquintLeft=function(){return+K.Message.getFieldWithDefault(this,7,0)},proto.service.ARKitBlendShapes.prototype.setCheekSquintLeft=function(ie){K.Message.setProto3FloatField(this,7,ie)},proto.service.ARKitBlendShapes.prototype.getCheekSquintRight=function(){return+K.Message.getFieldWithDefault(this,8,0)},proto.service.ARKitBlendShapes.prototype.setCheekSquintRight=function(ie){K.Message.setProto3FloatField(this,8,ie)},proto.service.ARKitBlendShapes.prototype.getEyeBlinkLeft=function(){return+K.Message.getFieldWithDefault(this,9,0)},proto.service.ARKitBlendShapes.prototype.setEyeBlinkLeft=function(ie){K.Message.setProto3FloatField(this,9,ie)},proto.service.ARKitBlendShapes.prototype.getEyeBlinkRight=function(){return+K.Message.getFieldWithDefault(this,10,0)},proto.service.ARKitBlendShapes.prototype.setEyeBlinkRight=function(ie){K.Message.setProto3FloatField(this,10,ie)},proto.service.ARKitBlendShapes.prototype.getEyeLookDownLeft=function(){return+K.Message.getFieldWithDefault(this,11,0)},proto.service.ARKitBlendShapes.prototype.setEyeLookDownLeft=function(ie){K.Message.setProto3FloatField(this,11,ie)},proto.service.ARKitBlendShapes.prototype.getEyeLookDownRight=function(){return+K.Message.getFieldWithDefault(this,12,0)},proto.service.ARKitBlendShapes.prototype.setEyeLookDownRight=function(ie){K.Message.setProto3FloatField(this,12,ie)},proto.service.ARKitBlendShapes.prototype.getEyeLookInLeft=function(){return+K.Message.getFieldWithDefault(this,13,0)},proto.service.ARKitBlendShapes.prototype.setEyeLookInLeft=function(ie){K.Message.setProto3FloatField(this,13,ie)},proto.service.ARKitBlendShapes.prototype.getEyeLookInRight=function(){return+K.Message.getFieldWithDefault(this,14,0)},proto.service.ARKitBlendShapes.prototype.setEyeLookInRight=function(ie){K.Message.setProto3FloatField(this,14,ie)},proto.service.ARKitBlendShapes.prototype.getEyeLookOutLeft=function(){return+K.Message.getFieldWithDefault(this,15,0)},proto.service.ARKitBlendShapes.prototype.setEyeLookOutLeft=function(ie){K.Message.setProto3FloatField(this,15,ie)},proto.service.ARKitBlendShapes.prototype.getEyeLookOutRight=function(){return+K.Message.getFieldWithDefault(this,16,0)},proto.service.ARKitBlendShapes.prototype.setEyeLookOutRight=function(ie){K.Message.setProto3FloatField(this,16,ie)},proto.service.ARKitBlendShapes.prototype.getEyeLookUpLeft=function(){return+K.Message.getFieldWithDefault(this,17,0)},proto.service.ARKitBlendShapes.prototype.setEyeLookUpLeft=function(ie){K.Message.setProto3FloatField(this,17,ie)},proto.service.ARKitBlendShapes.prototype.getEyeLookUpRight=function(){return+K.Message.getFieldWithDefault(this,18,0)},proto.service.ARKitBlendShapes.prototype.setEyeLookUpRight=function(ie){K.Message.setProto3FloatField(this,18,ie)},proto.service.ARKitBlendShapes.prototype.getEyeSquintLeft=function(){return+K.Message.getFieldWithDefault(this,19,0)},proto.service.ARKitBlendShapes.prototype.setEyeSquintLeft=function(ie){K.Message.setProto3FloatField(this,19,ie)},proto.service.ARKitBlendShapes.prototype.getEyeSquintRight=function(){return+K.Message.getFieldWithDefault(this,20,0)},proto.service.ARKitBlendShapes.prototype.setEyeSquintRight=function(ie){K.Message.setProto3FloatField(this,20,ie)},proto.service.ARKitBlendShapes.prototype.getEyeWideLeft=function(){return+K.Message.getFieldWithDefault(this,21,0)},proto.service.ARKitBlendShapes.prototype.setEyeWideLeft=function(ie){K.Message.setProto3FloatField(this,21,ie)},proto.service.ARKitBlendShapes.prototype.getEyeWideRight=function(){return+K.Message.getFieldWithDefault(this,22,0)},proto.service.ARKitBlendShapes.prototype.setEyeWideRight=function(ie){K.Message.setProto3FloatField(this,22,ie)},proto.service.ARKitBlendShapes.prototype.getJawForward=function(){return+K.Message.getFieldWithDefault(this,23,0)},proto.service.ARKitBlendShapes.prototype.setJawForward=function(ie){K.Message.setProto3FloatField(this,23,ie)},proto.service.ARKitBlendShapes.prototype.getJawLeft=function(){return+K.Message.getFieldWithDefault(this,24,0)},proto.service.ARKitBlendShapes.prototype.setJawLeft=function(ie){K.Message.setProto3FloatField(this,24,ie)},proto.service.ARKitBlendShapes.prototype.getJawOpen=function(){return+K.Message.getFieldWithDefault(this,25,0)},proto.service.ARKitBlendShapes.prototype.setJawOpen=function(ie){K.Message.setProto3FloatField(this,25,ie)},proto.service.ARKitBlendShapes.prototype.getJawRight=function(){return+K.Message.getFieldWithDefault(this,26,0)},proto.service.ARKitBlendShapes.prototype.setJawRight=function(ie){K.Message.setProto3FloatField(this,26,ie)},proto.service.ARKitBlendShapes.prototype.getMouthClose=function(){return+K.Message.getFieldWithDefault(this,27,0)},proto.service.ARKitBlendShapes.prototype.setMouthClose=function(ie){K.Message.setProto3FloatField(this,27,ie)},proto.service.ARKitBlendShapes.prototype.getMouthDimpleLeft=function(){return+K.Message.getFieldWithDefault(this,28,0)},proto.service.ARKitBlendShapes.prototype.setMouthDimpleLeft=function(ie){K.Message.setProto3FloatField(this,28,ie)},proto.service.ARKitBlendShapes.prototype.getMouthDimpleRight=function(){return+K.Message.getFieldWithDefault(this,29,0)},proto.service.ARKitBlendShapes.prototype.setMouthDimpleRight=function(ie){K.Message.setProto3FloatField(this,29,ie)},proto.service.ARKitBlendShapes.prototype.getMouthFrownLeft=function(){return+K.Message.getFieldWithDefault(this,30,0)},proto.service.ARKitBlendShapes.prototype.setMouthFrownLeft=function(ie){K.Message.setProto3FloatField(this,30,ie)},proto.service.ARKitBlendShapes.prototype.getMouthFrownRight=function(){return+K.Message.getFieldWithDefault(this,31,0)},proto.service.ARKitBlendShapes.prototype.setMouthFrownRight=function(ie){K.Message.setProto3FloatField(this,31,ie)},proto.service.ARKitBlendShapes.prototype.getMouthFunnel=function(){return+K.Message.getFieldWithDefault(this,32,0)},proto.service.ARKitBlendShapes.prototype.setMouthFunnel=function(ie){K.Message.setProto3FloatField(this,32,ie)},proto.service.ARKitBlendShapes.prototype.getMouthLeft=function(){return+K.Message.getFieldWithDefault(this,33,0)},proto.service.ARKitBlendShapes.prototype.setMouthLeft=function(ie){K.Message.setProto3FloatField(this,33,ie)},proto.service.ARKitBlendShapes.prototype.getMouthLowerDownLeft=function(){return+K.Message.getFieldWithDefault(this,34,0)},proto.service.ARKitBlendShapes.prototype.setMouthLowerDownLeft=function(ie){K.Message.setProto3FloatField(this,34,ie)},proto.service.ARKitBlendShapes.prototype.getMouthLowerDownRight=function(){return+K.Message.getFieldWithDefault(this,35,0)},proto.service.ARKitBlendShapes.prototype.setMouthLowerDownRight=function(ie){K.Message.setProto3FloatField(this,35,ie)},proto.service.ARKitBlendShapes.prototype.getMouthPressLeft=function(){return+K.Message.getFieldWithDefault(this,36,0)},proto.service.ARKitBlendShapes.prototype.setMouthPressLeft=function(ie){K.Message.setProto3FloatField(this,36,ie)},proto.service.ARKitBlendShapes.prototype.getMouthPressRight=function(){return+K.Message.getFieldWithDefault(this,37,0)},proto.service.ARKitBlendShapes.prototype.setMouthPressRight=function(ie){K.Message.setProto3FloatField(this,37,ie)},proto.service.ARKitBlendShapes.prototype.getMouthPucker=function(){return+K.Message.getFieldWithDefault(this,38,0)},proto.service.ARKitBlendShapes.prototype.setMouthPucker=function(ie){K.Message.setProto3FloatField(this,38,ie)},proto.service.ARKitBlendShapes.prototype.getMouthRight=function(){return+K.Message.getFieldWithDefault(this,39,0)},proto.service.ARKitBlendShapes.prototype.setMouthRight=function(ie){K.Message.setProto3FloatField(this,39,ie)},proto.service.ARKitBlendShapes.prototype.getMouthRollLower=function(){return+K.Message.getFieldWithDefault(this,40,0)},proto.service.ARKitBlendShapes.prototype.setMouthRollLower=function(ie){K.Message.setProto3FloatField(this,40,ie)},proto.service.ARKitBlendShapes.prototype.getMouthRollUpper=function(){return+K.Message.getFieldWithDefault(this,41,0)},proto.service.ARKitBlendShapes.prototype.setMouthRollUpper=function(ie){K.Message.setProto3FloatField(this,41,ie)},proto.service.ARKitBlendShapes.prototype.getMouthShrugLower=function(){return+K.Message.getFieldWithDefault(this,42,0)},proto.service.ARKitBlendShapes.prototype.setMouthShrugLower=function(ie){K.Message.setProto3FloatField(this,42,ie)},proto.service.ARKitBlendShapes.prototype.getMouthShrugUpper=function(){return+K.Message.getFieldWithDefault(this,43,0)},proto.service.ARKitBlendShapes.prototype.setMouthShrugUpper=function(ie){K.Message.setProto3FloatField(this,43,ie)},proto.service.ARKitBlendShapes.prototype.getMouthSmileLeft=function(){return+K.Message.getFieldWithDefault(this,44,0)},proto.service.ARKitBlendShapes.prototype.setMouthSmileLeft=function(ie){K.Message.setProto3FloatField(this,44,ie)},proto.service.ARKitBlendShapes.prototype.getMouthSmileRight=function(){return+K.Message.getFieldWithDefault(this,45,0)},proto.service.ARKitBlendShapes.prototype.setMouthSmileRight=function(ie){K.Message.setProto3FloatField(this,45,ie)},proto.service.ARKitBlendShapes.prototype.getMouthStretchLeft=function(){return+K.Message.getFieldWithDefault(this,46,0)},proto.service.ARKitBlendShapes.prototype.setMouthStretchLeft=function(ie){K.Message.setProto3FloatField(this,46,ie)},proto.service.ARKitBlendShapes.prototype.getMouthStretchRight=function(){return+K.Message.getFieldWithDefault(this,47,0)},proto.service.ARKitBlendShapes.prototype.setMouthStretchRight=function(ie){K.Message.setProto3FloatField(this,47,ie)},proto.service.ARKitBlendShapes.prototype.getMouthUpperUpLeft=function(){return+K.Message.getFieldWithDefault(this,48,0)},proto.service.ARKitBlendShapes.prototype.setMouthUpperUpLeft=function(ie){K.Message.setProto3FloatField(this,48,ie)},proto.service.ARKitBlendShapes.prototype.getMouthUpperUpRight=function(){return+K.Message.getFieldWithDefault(this,49,0)},proto.service.ARKitBlendShapes.prototype.setMouthUpperUpRight=function(ie){K.Message.setProto3FloatField(this,49,ie)},proto.service.ARKitBlendShapes.prototype.getNoseSneerLeft=function(){return+K.Message.getFieldWithDefault(this,50,0)},proto.service.ARKitBlendShapes.prototype.setNoseSneerLeft=function(ie){K.Message.setProto3FloatField(this,50,ie)},proto.service.ARKitBlendShapes.prototype.getNoseSneerRight=function(){return+K.Message.getFieldWithDefault(this,51,0)},proto.service.ARKitBlendShapes.prototype.setNoseSneerRight=function(ie){K.Message.setProto3FloatField(this,51,ie)},proto.service.ARKitBlendShapes.prototype.getTongueOut=function(){return+K.Message.getFieldWithDefault(this,52,0)},proto.service.ARKitBlendShapes.prototype.setTongueOut=function(ie){K.Message.setProto3FloatField(this,52,ie)},te.object.extend(Z,proto.service)},48:(X,Z,_)=>{var K=_(339),te=K,ne=Function("return this")(),ie=_(720);te.exportSymbol("proto.service.ActionConfig",null,ne),te.exportSymbol("proto.service.ActionConfig.Character",null,ne),te.exportSymbol("proto.service.ActionConfig.Object",null,ne),te.exportSymbol("proto.service.AudioConfig",null,ne),te.exportSymbol("proto.service.BlendShapesData",null,ne),te.exportSymbol("proto.service.EmotionResponse",null,ne),te.exportSymbol("proto.service.FaceModel",null,ne),te.exportSymbol("proto.service.FeedbackRequest",null,ne),te.exportSymbol("proto.service.FeedbackRequest.Feedback",null,ne),te.exportSymbol("proto.service.FeedbackResponse",null,ne),te.exportSymbol("proto.service.GetResponseRequest",null,ne),te.exportSymbol("proto.service.GetResponseRequest.GetResponseConfig",null,ne),te.exportSymbol("proto.service.GetResponseRequest.GetResponseData",null,ne),te.exportSymbol("proto.service.GetResponseRequestSingle",null,ne),te.exportSymbol("proto.service.GetResponseResponse",null,ne),te.exportSymbol("proto.service.GetResponseResponse.ActionResponse",null,ne),te.exportSymbol("proto.service.GetResponseResponse.AudioResponse",null,ne),te.exportSymbol("proto.service.GetResponseResponse.BehaviorTreeResponse",null,ne),te.exportSymbol("proto.service.GetResponseResponse.UserTranscript",null,ne),te.exportSymbol("proto.service.HelloRequest",null,ne),te.exportSymbol("proto.service.HelloResponse",null,ne),te.exportSymbol("proto.service.STTRequest",null,ne),te.exportSymbol("proto.service.STTResponse",null,ne),te.exportSymbol("proto.service.TriggerConfig",null,ne),te.exportSymbol("proto.service.Viseme",null,ne),te.exportSymbol("proto.service.VisemesData",null,ne),proto.service.AudioConfig=function(oe){K.Message.initialize(this,oe,0,-1,null,null)},te.inherits(proto.service.AudioConfig,K.Message),te.DEBUG&&!COMPILED&&(proto.service.AudioConfig.displayName="proto.service.AudioConfig"),K.Message.GENERATE_TO_OBJECT&&(proto.service.AudioConfig.prototype.toObject=function(oe){return proto.service.AudioConfig.toObject(oe,this)},proto.service.AudioConfig.toObject=function(oe,se){var ae={sampleRateHertz:K.Message.getFieldWithDefault(se,1,0),disableAudio:K.Message.getFieldWithDefault(se,2,!1),enableFacialData:K.Message.getFieldWithDefault(se,3,!1),faceModel:K.Message.getFieldWithDefault(se,4,0),enableFacialEmotionData:K.Message.getFieldWithDefault(se,5,!1)};return oe&&(ae.$jspbMessageInstance=se),ae}),proto.service.AudioConfig.deserializeBinary=function(oe){var se=new K.BinaryReader(oe),ae=new proto.service.AudioConfig;return proto.service.AudioConfig.deserializeBinaryFromReader(ae,se)},proto.service.AudioConfig.deserializeBinaryFromReader=function(oe,se){for(;se.nextField()&&!se.isEndGroup();)switch(se.getFieldNumber()){case 1:var ae=se.readInt32();oe.setSampleRateHertz(ae);break;case 2:ae=se.readBool(),oe.setDisableAudio(ae);break;case 3:ae=se.readBool(),oe.setEnableFacialData(ae);break;case 4:ae=se.readEnum(),oe.setFaceModel(ae);break;case 5:ae=se.readBool(),oe.setEnableFacialEmotionData(ae);break;default:se.skipField()}return oe},proto.service.AudioConfig.prototype.serializeBinary=function(){var oe=new K.BinaryWriter;return proto.service.AudioConfig.serializeBinaryToWriter(this,oe),oe.getResultBuffer()},proto.service.AudioConfig.serializeBinaryToWriter=function(oe,se){var ae=void 0;(ae=oe.getSampleRateHertz())!==0&&se.writeInt32(1,ae),(ae=oe.getDisableAudio())&&se.writeBool(2,ae),(ae=oe.getEnableFacialData())&&se.writeBool(3,ae),(ae=oe.getFaceModel())!==0&&se.writeEnum(4,ae),(ae=oe.getEnableFacialEmotionData())&&se.writeBool(5,ae)},proto.service.AudioConfig.prototype.getSampleRateHertz=function(){return K.Message.getFieldWithDefault(this,1,0)},proto.service.AudioConfig.prototype.setSampleRateHertz=function(oe){K.Message.setProto3IntField(this,1,oe)},proto.service.AudioConfig.prototype.getDisableAudio=function(){return K.Message.getFieldWithDefault(this,2,!1)},proto.service.AudioConfig.prototype.setDisableAudio=function(oe){K.Message.setProto3BooleanField(this,2,oe)},proto.service.AudioConfig.prototype.getEnableFacialData=function(){return K.Message.getFieldWithDefault(this,3,!1)},proto.service.AudioConfig.prototype.setEnableFacialData=function(oe){K.Message.setProto3BooleanField(this,3,oe)},proto.service.AudioConfig.prototype.getFaceModel=function(){return K.Message.getFieldWithDefault(this,4,0)},proto.service.AudioConfig.prototype.setFaceModel=function(oe){K.Message.setProto3EnumField(this,4,oe)},proto.service.AudioConfig.prototype.getEnableFacialEmotionData=function(){return K.Message.getFieldWithDefault(this,5,!1)},proto.service.AudioConfig.prototype.setEnableFacialEmotionData=function(oe){K.Message.setProto3BooleanField(this,5,oe)},proto.service.TriggerConfig=function(oe){K.Message.initialize(this,oe,0,-1,null,null)},te.inherits(proto.service.TriggerConfig,K.Message),te.DEBUG&&!COMPILED&&(proto.service.TriggerConfig.displayName="proto.service.TriggerConfig"),K.Message.GENERATE_TO_OBJECT&&(proto.service.TriggerConfig.prototype.toObject=function(oe){return proto.service.TriggerConfig.toObject(oe,this)},proto.service.TriggerConfig.toObject=function(oe,se){var ae={triggerName:K.Message.getFieldWithDefault(se,1,""),triggerMessage:K.Message.getFieldWithDefault(se,2,"")};return oe&&(ae.$jspbMessageInstance=se),ae}),proto.service.TriggerConfig.deserializeBinary=function(oe){var se=new K.BinaryReader(oe),ae=new proto.service.TriggerConfig;return proto.service.TriggerConfig.deserializeBinaryFromReader(ae,se)},proto.service.TriggerConfig.deserializeBinaryFromReader=function(oe,se){for(;se.nextField()&&!se.isEndGroup();)switch(se.getFieldNumber()){case 1:var ae=se.readString();oe.setTriggerName(ae);break;case 2:ae=se.readString(),oe.setTriggerMessage(ae);break;default:se.skipField()}return oe},proto.service.TriggerConfig.prototype.serializeBinary=function(){var oe=new K.BinaryWriter;return proto.service.TriggerConfig.serializeBinaryToWriter(this,oe),oe.getResultBuffer()},proto.service.TriggerConfig.serializeBinaryToWriter=function(oe,se){var ae=void 0;(ae=oe.getTriggerName()).length>0&&se.writeString(1,ae),(ae=oe.getTriggerMessage()).length>0&&se.writeString(2,ae)},proto.service.TriggerConfig.prototype.getTriggerName=function(){return K.Message.getFieldWithDefault(this,1,"")},proto.service.TriggerConfig.prototype.setTriggerName=function(oe){K.Message.setProto3StringField(this,1,oe)},proto.service.TriggerConfig.prototype.getTriggerMessage=function(){return K.Message.getFieldWithDefault(this,2,"")},proto.service.TriggerConfig.prototype.setTriggerMessage=function(oe){K.Message.setProto3StringField(this,2,oe)},proto.service.ActionConfig=function(oe){K.Message.initialize(this,oe,0,-1,proto.service.ActionConfig.repeatedFields_,null)},te.inherits(proto.service.ActionConfig,K.Message),te.DEBUG&&!COMPILED&&(proto.service.ActionConfig.displayName="proto.service.ActionConfig"),proto.service.ActionConfig.repeatedFields_=[1,2,3],K.Message.GENERATE_TO_OBJECT&&(proto.service.ActionConfig.prototype.toObject=function(oe){return proto.service.ActionConfig.toObject(oe,this)},proto.service.ActionConfig.toObject=function(oe,se){var ae={actionsList:K.Message.getRepeatedField(se,1),charactersList:K.Message.toObjectList(se.getCharactersList(),proto.service.ActionConfig.Character.toObject,oe),objectsList:K.Message.toObjectList(se.getObjectsList(),proto.service.ActionConfig.Object.toObject,oe),classification:K.Message.getFieldWithDefault(se,4,""),contextLevel:K.Message.getFieldWithDefault(se,5,0),currentAttentionObject:K.Message.getFieldWithDefault(se,6,"")};return oe&&(ae.$jspbMessageInstance=se),ae}),proto.service.ActionConfig.deserializeBinary=function(oe){var se=new K.BinaryReader(oe),ae=new proto.service.ActionConfig;return proto.service.ActionConfig.deserializeBinaryFromReader(ae,se)},proto.service.ActionConfig.deserializeBinaryFromReader=function(oe,se){for(;se.nextField()&&!se.isEndGroup();)switch(se.getFieldNumber()){case 1:var ae=se.readString();oe.addActions(ae);break;case 2:ae=new proto.service.ActionConfig.Character,se.readMessage(ae,proto.service.ActionConfig.Character.deserializeBinaryFromReader),oe.addCharacters(ae);break;case 3:ae=new proto.service.ActionConfig.Object,se.readMessage(ae,proto.service.ActionConfig.Object.deserializeBinaryFromReader),oe.addObjects(ae);break;case 4:ae=se.readString(),oe.setClassification(ae);break;case 5:ae=se.readInt32(),oe.setContextLevel(ae);break;case 6:ae=se.readString(),oe.setCurrentAttentionObject(ae);break;default:se.skipField()}return oe},proto.service.ActionConfig.prototype.serializeBinary=function(){var oe=new K.BinaryWriter;return proto.service.ActionConfig.serializeBinaryToWriter(this,oe),oe.getResultBuffer()},proto.service.ActionConfig.serializeBinaryToWriter=function(oe,se){var ae=void 0;(ae=oe.getActionsList()).length>0&&se.writeRepeatedString(1,ae),(ae=oe.getCharactersList()).length>0&&se.writeRepeatedMessage(2,ae,proto.service.ActionConfig.Character.serializeBinaryToWriter),(ae=oe.getObjectsList()).length>0&&se.writeRepeatedMessage(3,ae,proto.service.ActionConfig.Object.serializeBinaryToWriter),(ae=oe.getClassification()).length>0&&se.writeString(4,ae),(ae=oe.getContextLevel())!==0&&se.writeInt32(5,ae),(ae=oe.getCurrentAttentionObject()).length>0&&se.writeString(6,ae)},proto.service.ActionConfig.Character=function(oe){K.Message.initialize(this,oe,0,-1,null,null)},te.inherits(proto.service.ActionConfig.Character,K.Message),te.DEBUG&&!COMPILED&&(proto.service.ActionConfig.Character.displayName="proto.service.ActionConfig.Character"),K.Message.GENERATE_TO_OBJECT&&(proto.service.ActionConfig.Character.prototype.toObject=function(oe){return proto.service.ActionConfig.Character.toObject(oe,this)},proto.service.ActionConfig.Character.toObject=function(oe,se){var ae={name:K.Message.getFieldWithDefault(se,1,""),bio:K.Message.getFieldWithDefault(se,2,"")};return oe&&(ae.$jspbMessageInstance=se),ae}),proto.service.ActionConfig.Character.deserializeBinary=function(oe){var se=new K.BinaryReader(oe),ae=new proto.service.ActionConfig.Character;return proto.service.ActionConfig.Character.deserializeBinaryFromReader(ae,se)},proto.service.ActionConfig.Character.deserializeBinaryFromReader=function(oe,se){for(;se.nextField()&&!se.isEndGroup();)switch(se.getFieldNumber()){case 1:var ae=se.readString();oe.setName(ae);break;case 2:ae=se.readString(),oe.setBio(ae);break;default:se.skipField()}return oe},proto.service.ActionConfig.Character.prototype.serializeBinary=function(){var oe=new K.BinaryWriter;return proto.service.ActionConfig.Character.serializeBinaryToWriter(this,oe),oe.getResultBuffer()},proto.service.ActionConfig.Character.serializeBinaryToWriter=function(oe,se){var ae=void 0;(ae=oe.getName()).length>0&&se.writeString(1,ae),(ae=oe.getBio()).length>0&&se.writeString(2,ae)},proto.service.ActionConfig.Character.prototype.getName=function(){return K.Message.getFieldWithDefault(this,1,"")},proto.service.ActionConfig.Character.prototype.setName=function(oe){K.Message.setProto3StringField(this,1,oe)},proto.service.ActionConfig.Character.prototype.getBio=function(){return K.Message.getFieldWithDefault(this,2,"")},proto.service.ActionConfig.Character.prototype.setBio=function(oe){K.Message.setProto3StringField(this,2,oe)},proto.service.ActionConfig.Object=function(oe){K.Message.initialize(this,oe,0,-1,null,null)},te.inherits(proto.service.ActionConfig.Object,K.Message),te.DEBUG&&!COMPILED&&(proto.service.ActionConfig.Object.displayName="proto.service.ActionConfig.Object"),K.Message.GENERATE_TO_OBJECT&&(proto.service.ActionConfig.Object.prototype.toObject=function(oe){return proto.service.ActionConfig.Object.toObject(oe,this)},proto.service.ActionConfig.Object.toObject=function(oe,se){var ae={name:K.Message.getFieldWithDefault(se,1,""),description:K.Message.getFieldWithDefault(se,2,"")};return oe&&(ae.$jspbMessageInstance=se),ae}),proto.service.ActionConfig.Object.deserializeBinary=function(oe){var se=new K.BinaryReader(oe),ae=new proto.service.ActionConfig.Object;return proto.service.ActionConfig.Object.deserializeBinaryFromReader(ae,se)},proto.service.ActionConfig.Object.deserializeBinaryFromReader=function(oe,se){for(;se.nextField()&&!se.isEndGroup();)switch(se.getFieldNumber()){case 1:var ae=se.readString();oe.setName(ae);break;case 2:ae=se.readString(),oe.setDescription(ae);break;default:se.skipField()}return oe},proto.service.ActionConfig.Object.prototype.serializeBinary=function(){var oe=new K.BinaryWriter;return proto.service.ActionConfig.Object.serializeBinaryToWriter(this,oe),oe.getResultBuffer()},proto.service.ActionConfig.Object.serializeBinaryToWriter=function(oe,se){var ae=void 0;(ae=oe.getName()).length>0&&se.writeString(1,ae),(ae=oe.getDescription()).length>0&&se.writeString(2,ae)},proto.service.ActionConfig.Object.prototype.getName=function(){return K.Message.getFieldWithDefault(this,1,"")},proto.service.ActionConfig.Object.prototype.setName=function(oe){K.Message.setProto3StringField(this,1,oe)},proto.service.ActionConfig.Object.prototype.getDescription=function(){return K.Message.getFieldWithDefault(this,2,"")},proto.service.ActionConfig.Object.prototype.setDescription=function(oe){K.Message.setProto3StringField(this,2,oe)},proto.service.ActionConfig.prototype.getActionsList=function(){return K.Message.getRepeatedField(this,1)},proto.service.ActionConfig.prototype.setActionsList=function(oe){K.Message.setField(this,1,oe||[])},proto.service.ActionConfig.prototype.addActions=function(oe,se){K.Message.addToRepeatedField(this,1,oe,se)},proto.service.ActionConfig.prototype.clearActionsList=function(){this.setActionsList([])},proto.service.ActionConfig.prototype.getCharactersList=function(){return K.Message.getRepeatedWrapperField(this,proto.service.ActionConfig.Character,2)},proto.service.ActionConfig.prototype.setCharactersList=function(oe){K.Message.setRepeatedWrapperField(this,2,oe)},proto.service.ActionConfig.prototype.addCharacters=function(oe,se){return K.Message.addToRepeatedWrapperField(this,2,oe,proto.service.ActionConfig.Character,se)},proto.service.ActionConfig.prototype.clearCharactersList=function(){this.setCharactersList([])},proto.service.ActionConfig.prototype.getObjectsList=function(){return K.Message.getRepeatedWrapperField(this,proto.service.ActionConfig.Object,3)},proto.service.ActionConfig.prototype.setObjectsList=function(oe){K.Message.setRepeatedWrapperField(this,3,oe)},proto.service.ActionConfig.prototype.addObjects=function(oe,se){return K.Message.addToRepeatedWrapperField(this,3,oe,proto.service.ActionConfig.Object,se)},proto.service.ActionConfig.prototype.clearObjectsList=function(){this.setObjectsList([])},proto.service.ActionConfig.prototype.getClassification=function(){return K.Message.getFieldWithDefault(this,4,"")},proto.service.ActionConfig.prototype.setClassification=function(oe){K.Message.setProto3StringField(this,4,oe)},proto.service.ActionConfig.prototype.getContextLevel=function(){return K.Message.getFieldWithDefault(this,5,0)},proto.service.ActionConfig.prototype.setContextLevel=function(oe){K.Message.setProto3IntField(this,5,oe)},proto.service.ActionConfig.prototype.getCurrentAttentionObject=function(){return K.Message.getFieldWithDefault(this,6,"")},proto.service.ActionConfig.prototype.setCurrentAttentionObject=function(oe){K.Message.setProto3StringField(this,6,oe)},proto.service.STTRequest=function(oe){K.Message.initialize(this,oe,0,-1,null,proto.service.STTRequest.oneofGroups_)},te.inherits(proto.service.STTRequest,K.Message),te.DEBUG&&!COMPILED&&(proto.service.STTRequest.displayName="proto.service.STTRequest"),proto.service.STTRequest.oneofGroups_=[[1,2]],proto.service.STTRequest.RequestTypeCase={REQUEST_TYPE_NOT_SET:0,AUDIO_CONFIG:1,AUDIO_CHUNK:2},proto.service.STTRequest.prototype.getRequestTypeCase=function(){return K.Message.computeOneofCase(this,proto.service.STTRequest.oneofGroups_[0])},K.Message.GENERATE_TO_OBJECT&&(proto.service.STTRequest.prototype.toObject=function(oe){return proto.service.STTRequest.toObject(oe,this)},proto.service.STTRequest.toObject=function(oe,se){var ae,ge={audioConfig:(ae=se.getAudioConfig())&&proto.service.AudioConfig.toObject(oe,ae),audioChunk:se.getAudioChunk_asB64()};return oe&&(ge.$jspbMessageInstance=se),ge}),proto.service.STTRequest.deserializeBinary=function(oe){var se=new K.BinaryReader(oe),ae=new proto.service.STTRequest;return proto.service.STTRequest.deserializeBinaryFromReader(ae,se)},proto.service.STTRequest.deserializeBinaryFromReader=function(oe,se){for(;se.nextField()&&!se.isEndGroup();)switch(se.getFieldNumber()){case 1:var ae=new proto.service.AudioConfig;se.readMessage(ae,proto.service.AudioConfig.deserializeBinaryFromReader),oe.setAudioConfig(ae);break;case 2:ae=se.readBytes(),oe.setAudioChunk(ae);break;default:se.skipField()}return oe},proto.service.STTRequest.prototype.serializeBinary=function(){var oe=new K.BinaryWriter;return proto.service.STTRequest.serializeBinaryToWriter(this,oe),oe.getResultBuffer()},proto.service.STTRequest.serializeBinaryToWriter=function(oe,se){var ae=void 0;(ae=oe.getAudioConfig())!=null&&se.writeMessage(1,ae,proto.service.AudioConfig.serializeBinaryToWriter),(ae=K.Message.getField(oe,2))!=null&&se.writeBytes(2,ae)},proto.service.STTRequest.prototype.getAudioConfig=function(){return K.Message.getWrapperField(this,proto.service.AudioConfig,1)},proto.service.STTRequest.prototype.setAudioConfig=function(oe){K.Message.setOneofWrapperField(this,1,proto.service.STTRequest.oneofGroups_[0],oe)},proto.service.STTRequest.prototype.clearAudioConfig=function(){this.setAudioConfig(void 0)},proto.service.STTRequest.prototype.hasAudioConfig=function(){return K.Message.getField(this,1)!=null},proto.service.STTRequest.prototype.getAudioChunk=function(){return K.Message.getFieldWithDefault(this,2,"")},proto.service.STTRequest.prototype.getAudioChunk_asB64=function(){return K.Message.bytesAsB64(this.getAudioChunk())},proto.service.STTRequest.prototype.getAudioChunk_asU8=function(){return K.Message.bytesAsU8(this.getAudioChunk())},proto.service.STTRequest.prototype.setAudioChunk=function(oe){K.Message.setOneofField(this,2,proto.service.STTRequest.oneofGroups_[0],oe)},proto.service.STTRequest.prototype.clearAudioChunk=function(){K.Message.setOneofField(this,2,proto.service.STTRequest.oneofGroups_[0],void 0)},proto.service.STTRequest.prototype.hasAudioChunk=function(){return K.Message.getField(this,2)!=null},proto.service.STTResponse=function(oe){K.Message.initialize(this,oe,0,-1,null,null)},te.inherits(proto.service.STTResponse,K.Message),te.DEBUG&&!COMPILED&&(proto.service.STTResponse.displayName="proto.service.STTResponse"),K.Message.GENERATE_TO_OBJECT&&(proto.service.STTResponse.prototype.toObject=function(oe){return proto.service.STTResponse.toObject(oe,this)},proto.service.STTResponse.toObject=function(oe,se){var ae={text:K.Message.getFieldWithDefault(se,1,"")};return oe&&(ae.$jspbMessageInstance=se),ae}),proto.service.STTResponse.deserializeBinary=function(oe){var se=new K.BinaryReader(oe),ae=new proto.service.STTResponse;return proto.service.STTResponse.deserializeBinaryFromReader(ae,se)},proto.service.STTResponse.deserializeBinaryFromReader=function(oe,se){for(;se.nextField()&&!se.isEndGroup();)if(se.getFieldNumber()===1){var ae=se.readString();oe.setText(ae)}else se.skipField();return oe},proto.service.STTResponse.prototype.serializeBinary=function(){var oe=new K.BinaryWriter;return proto.service.STTResponse.serializeBinaryToWriter(this,oe),oe.getResultBuffer()},proto.service.STTResponse.serializeBinaryToWriter=function(oe,se){var ae;(ae=oe.getText()).length>0&&se.writeString(1,ae)},proto.service.STTResponse.prototype.getText=function(){return K.Message.getFieldWithDefault(this,1,"")},proto.service.STTResponse.prototype.setText=function(oe){K.Message.setProto3StringField(this,1,oe)},proto.service.GetResponseRequest=function(oe){K.Message.initialize(this,oe,0,-1,null,proto.service.GetResponseRequest.oneofGroups_)},te.inherits(proto.service.GetResponseRequest,K.Message),te.DEBUG&&!COMPILED&&(proto.service.GetResponseRequest.displayName="proto.service.GetResponseRequest"),proto.service.GetResponseRequest.oneofGroups_=[[1,2]],proto.service.GetResponseRequest.RequestTypeCase={REQUEST_TYPE_NOT_SET:0,GET_RESPONSE_CONFIG:1,GET_RESPONSE_DATA:2},proto.service.GetResponseRequest.prototype.getRequestTypeCase=function(){return K.Message.computeOneofCase(this,proto.service.GetResponseRequest.oneofGroups_[0])},K.Message.GENERATE_TO_OBJECT&&(proto.service.GetResponseRequest.prototype.toObject=function(oe){return proto.service.GetResponseRequest.toObject(oe,this)},proto.service.GetResponseRequest.toObject=function(oe,se){var ae,ge={getResponseConfig:(ae=se.getGetResponseConfig())&&proto.service.GetResponseRequest.GetResponseConfig.toObject(oe,ae),getResponseData:(ae=se.getGetResponseData())&&proto.service.GetResponseRequest.GetResponseData.toObject(oe,ae)};return oe&&(ge.$jspbMessageInstance=se),ge}),proto.service.GetResponseRequest.deserializeBinary=function(oe){var se=new K.BinaryReader(oe),ae=new proto.service.GetResponseRequest;return proto.service.GetResponseRequest.deserializeBinaryFromReader(ae,se)},proto.service.GetResponseRequest.deserializeBinaryFromReader=function(oe,se){for(;se.nextField()&&!se.isEndGroup();)switch(se.getFieldNumber()){case 1:var ae=new proto.service.GetResponseRequest.GetResponseConfig;se.readMessage(ae,proto.service.GetResponseRequest.GetResponseConfig.deserializeBinaryFromReader),oe.setGetResponseConfig(ae);break;case 2:ae=new proto.service.GetResponseRequest.GetResponseData,se.readMessage(ae,proto.service.GetResponseRequest.GetResponseData.deserializeBinaryFromReader),oe.setGetResponseData(ae);break;default:se.skipField()}return oe},proto.service.GetResponseRequest.prototype.serializeBinary=function(){var oe=new K.BinaryWriter;return proto.service.GetResponseRequest.serializeBinaryToWriter(this,oe),oe.getResultBuffer()},proto.service.GetResponseRequest.serializeBinaryToWriter=function(oe,se){var ae=void 0;(ae=oe.getGetResponseConfig())!=null&&se.writeMessage(1,ae,proto.service.GetResponseRequest.GetResponseConfig.serializeBinaryToWriter),(ae=oe.getGetResponseData())!=null&&se.writeMessage(2,ae,proto.service.GetResponseRequest.GetResponseData.serializeBinaryToWriter)},proto.service.GetResponseRequest.GetResponseConfig=function(oe){K.Message.initialize(this,oe,0,-1,null,null)},te.inherits(proto.service.GetResponseRequest.GetResponseConfig,K.Message),te.DEBUG&&!COMPILED&&(proto.service.GetResponseRequest.GetResponseConfig.displayName="proto.service.GetResponseRequest.GetResponseConfig"),K.Message.GENERATE_TO_OBJECT&&(proto.service.GetResponseRequest.GetResponseConfig.prototype.toObject=function(oe){return proto.service.GetResponseRequest.GetResponseConfig.toObject(oe,this)},proto.service.GetResponseRequest.GetResponseConfig.toObject=function(oe,se){var ae,ge={characterId:K.Message.getFieldWithDefault(se,2,""),apiKey:K.Message.getFieldWithDefault(se,3,""),sessionId:K.Message.getFieldWithDefault(se,4,""),audioConfig:(ae=se.getAudioConfig())&&proto.service.AudioConfig.toObject(oe,ae),actionConfig:(ae=se.getActionConfig())&&proto.service.ActionConfig.toObject(oe,ae),speaker:K.Message.getFieldWithDefault(se,7,""),languageCode:K.Message.getFieldWithDefault(se,8,""),speakerId:K.Message.getFieldWithDefault(se,9,""),apiAuthToken:K.Message.getFieldWithDefault(se,10,""),narrativeTemplateKeysMap:(ae=se.getNarrativeTemplateKeysMap())?ae.toObject(oe,void 0):[]};return oe&&(ge.$jspbMessageInstance=se),ge}),proto.service.GetResponseRequest.GetResponseConfig.deserializeBinary=function(oe){var se=new K.BinaryReader(oe),ae=new proto.service.GetResponseRequest.GetResponseConfig;return proto.service.GetResponseRequest.GetResponseConfig.deserializeBinaryFromReader(ae,se)},proto.service.GetResponseRequest.GetResponseConfig.deserializeBinaryFromReader=function(oe,se){for(;se.nextField()&&!se.isEndGroup();)switch(se.getFieldNumber()){case 2:var ae=se.readString();oe.setCharacterId(ae);break;case 3:ae=se.readString(),oe.setApiKey(ae);break;case 4:ae=se.readString(),oe.setSessionId(ae);break;case 5:ae=new proto.service.AudioConfig,se.readMessage(ae,proto.service.AudioConfig.deserializeBinaryFromReader),oe.setAudioConfig(ae);break;case 6:ae=new proto.service.ActionConfig,se.readMessage(ae,proto.service.ActionConfig.deserializeBinaryFromReader),oe.setActionConfig(ae);break;case 7:ae=se.readString(),oe.setSpeaker(ae);break;case 8:ae=se.readString(),oe.setLanguageCode(ae);break;case 9:ae=se.readString(),oe.setSpeakerId(ae);break;case 10:ae=se.readString(),oe.setApiAuthToken(ae);break;case 11:ae=oe.getNarrativeTemplateKeysMap(),se.readMessage(ae,function(ge,ce){K.Map.deserializeBinary(ge,ce,K.BinaryReader.prototype.readString,K.BinaryReader.prototype.readString,null,"")});break;default:se.skipField()}return oe},proto.service.GetResponseRequest.GetResponseConfig.prototype.serializeBinary=function(){var oe=new K.BinaryWriter;return proto.service.GetResponseRequest.GetResponseConfig.serializeBinaryToWriter(this,oe),oe.getResultBuffer()},proto.service.GetResponseRequest.GetResponseConfig.serializeBinaryToWriter=function(oe,se){var ae=void 0;(ae=oe.getCharacterId()).length>0&&se.writeString(2,ae),(ae=oe.getApiKey()).length>0&&se.writeString(3,ae),(ae=oe.getSessionId()).length>0&&se.writeString(4,ae),(ae=oe.getAudioConfig())!=null&&se.writeMessage(5,ae,proto.service.AudioConfig.serializeBinaryToWriter),(ae=oe.getActionConfig())!=null&&se.writeMessage(6,ae,proto.service.ActionConfig.serializeBinaryToWriter),(ae=oe.getSpeaker()).length>0&&se.writeString(7,ae),(ae=oe.getLanguageCode()).length>0&&se.writeString(8,ae),(ae=oe.getSpeakerId()).length>0&&se.writeString(9,ae),(ae=oe.getApiAuthToken()).length>0&&se.writeString(10,ae),(ae=oe.getNarrativeTemplateKeysMap(!0))&&ae.getLength()>0&&ae.serializeBinary(11,se,K.BinaryWriter.prototype.writeString,K.BinaryWriter.prototype.writeString)},proto.service.GetResponseRequest.GetResponseConfig.prototype.getCharacterId=function(){return K.Message.getFieldWithDefault(this,2,"")},proto.service.GetResponseRequest.GetResponseConfig.prototype.setCharacterId=function(oe){K.Message.setProto3StringField(this,2,oe)},proto.service.GetResponseRequest.GetResponseConfig.prototype.getApiKey=function(){return K.Message.getFieldWithDefault(this,3,"")},proto.service.GetResponseRequest.GetResponseConfig.prototype.setApiKey=function(oe){K.Message.setProto3StringField(this,3,oe)},proto.service.GetResponseRequest.GetResponseConfig.prototype.getSessionId=function(){return K.Message.getFieldWithDefault(this,4,"")},proto.service.GetResponseRequest.GetResponseConfig.prototype.setSessionId=function(oe){K.Message.setProto3StringField(this,4,oe)},proto.service.GetResponseRequest.GetResponseConfig.prototype.getAudioConfig=function(){return K.Message.getWrapperField(this,proto.service.AudioConfig,5)},proto.service.GetResponseRequest.GetResponseConfig.prototype.setAudioConfig=function(oe){K.Message.setWrapperField(this,5,oe)},proto.service.GetResponseRequest.GetResponseConfig.prototype.clearAudioConfig=function(){this.setAudioConfig(void 0)},proto.service.GetResponseRequest.GetResponseConfig.prototype.hasAudioConfig=function(){return K.Message.getField(this,5)!=null},proto.service.GetResponseRequest.GetResponseConfig.prototype.getActionConfig=function(){return K.Message.getWrapperField(this,proto.service.ActionConfig,6)},proto.service.GetResponseRequest.GetResponseConfig.prototype.setActionConfig=function(oe){K.Message.setWrapperField(this,6,oe)},proto.service.GetResponseRequest.GetResponseConfig.prototype.clearActionConfig=function(){this.setActionConfig(void 0)},proto.service.GetResponseRequest.GetResponseConfig.prototype.hasActionConfig=function(){return K.Message.getField(this,6)!=null},proto.service.GetResponseRequest.GetResponseConfig.prototype.getSpeaker=function(){return K.Message.getFieldWithDefault(this,7,"")},proto.service.GetResponseRequest.GetResponseConfig.prototype.setSpeaker=function(oe){K.Message.setProto3StringField(this,7,oe)},proto.service.GetResponseRequest.GetResponseConfig.prototype.getLanguageCode=function(){return K.Message.getFieldWithDefault(this,8,"")},proto.service.GetResponseRequest.GetResponseConfig.prototype.setLanguageCode=function(oe){K.Message.setProto3StringField(this,8,oe)},proto.service.GetResponseRequest.GetResponseConfig.prototype.getSpeakerId=function(){return K.Message.getFieldWithDefault(this,9,"")},proto.service.GetResponseRequest.GetResponseConfig.prototype.setSpeakerId=function(oe){K.Message.setProto3StringField(this,9,oe)},proto.service.GetResponseRequest.GetResponseConfig.prototype.getApiAuthToken=function(){return K.Message.getFieldWithDefault(this,10,"")},proto.service.GetResponseRequest.GetResponseConfig.prototype.setApiAuthToken=function(oe){K.Message.setProto3StringField(this,10,oe)},proto.service.GetResponseRequest.GetResponseConfig.prototype.getNarrativeTemplateKeysMap=function(oe){return K.Message.getMapField(this,11,oe,null)},proto.service.GetResponseRequest.GetResponseConfig.prototype.clearNarrativeTemplateKeysMap=function(){this.getNarrativeTemplateKeysMap().clear()},proto.service.GetResponseRequest.GetResponseData=function(oe){K.Message.initialize(this,oe,0,-1,null,proto.service.GetResponseRequest.GetResponseData.oneofGroups_)},te.inherits(proto.service.GetResponseRequest.GetResponseData,K.Message),te.DEBUG&&!COMPILED&&(proto.service.GetResponseRequest.GetResponseData.displayName="proto.service.GetResponseRequest.GetResponseData"),proto.service.GetResponseRequest.GetResponseData.oneofGroups_=[[1,2,3]],proto.service.GetResponseRequest.GetResponseData.InputTypeCase={INPUT_TYPE_NOT_SET:0,AUDIO_DATA:1,TEXT_DATA:2,TRIGGER_DATA:3},proto.service.GetResponseRequest.GetResponseData.prototype.getInputTypeCase=function(){return K.Message.computeOneofCase(this,proto.service.GetResponseRequest.GetResponseData.oneofGroups_[0])},K.Message.GENERATE_TO_OBJECT&&(proto.service.GetResponseRequest.GetResponseData.prototype.toObject=function(oe){return proto.service.GetResponseRequest.GetResponseData.toObject(oe,this)},proto.service.GetResponseRequest.GetResponseData.toObject=function(oe,se){var ae,ge={audioData:se.getAudioData_asB64(),textData:K.Message.getFieldWithDefault(se,2,""),triggerData:(ae=se.getTriggerData())&&proto.service.TriggerConfig.toObject(oe,ae)};return oe&&(ge.$jspbMessageInstance=se),ge}),proto.service.GetResponseRequest.GetResponseData.deserializeBinary=function(oe){var se=new K.BinaryReader(oe),ae=new proto.service.GetResponseRequest.GetResponseData;return proto.service.GetResponseRequest.GetResponseData.deserializeBinaryFromReader(ae,se)},proto.service.GetResponseRequest.GetResponseData.deserializeBinaryFromReader=function(oe,se){for(;se.nextField()&&!se.isEndGroup();)switch(se.getFieldNumber()){case 1:var ae=se.readBytes();oe.setAudioData(ae);break;case 2:ae=se.readString(),oe.setTextData(ae);break;case 3:ae=new proto.service.TriggerConfig,se.readMessage(ae,proto.service.TriggerConfig.deserializeBinaryFromReader),oe.setTriggerData(ae);break;default:se.skipField()}return oe},proto.service.GetResponseRequest.GetResponseData.prototype.serializeBinary=function(){var oe=new K.BinaryWriter;return proto.service.GetResponseRequest.GetResponseData.serializeBinaryToWriter(this,oe),oe.getResultBuffer()},proto.service.GetResponseRequest.GetResponseData.serializeBinaryToWriter=function(oe,se){var ae=void 0;(ae=K.Message.getField(oe,1))!=null&&se.writeBytes(1,ae),(ae=K.Message.getField(oe,2))!=null&&se.writeString(2,ae),(ae=oe.getTriggerData())!=null&&se.writeMessage(3,ae,proto.service.TriggerConfig.serializeBinaryToWriter)},proto.service.GetResponseRequest.GetResponseData.prototype.getAudioData=function(){return K.Message.getFieldWithDefault(this,1,"")},proto.service.GetResponseRequest.GetResponseData.prototype.getAudioData_asB64=function(){return K.Message.bytesAsB64(this.getAudioData())},proto.service.GetResponseRequest.GetResponseData.prototype.getAudioData_asU8=function(){return K.Message.bytesAsU8(this.getAudioData())},proto.service.GetResponseRequest.GetResponseData.prototype.setAudioData=function(oe){K.Message.setOneofField(this,1,proto.service.GetResponseRequest.GetResponseData.oneofGroups_[0],oe)},proto.service.GetResponseRequest.GetResponseData.prototype.clearAudioData=function(){K.Message.setOneofField(this,1,proto.service.GetResponseRequest.GetResponseData.oneofGroups_[0],void 0)},proto.service.GetResponseRequest.GetResponseData.prototype.hasAudioData=function(){return K.Message.getField(this,1)!=null},proto.service.GetResponseRequest.GetResponseData.prototype.getTextData=function(){return K.Message.getFieldWithDefault(this,2,"")},proto.service.GetResponseRequest.GetResponseData.prototype.setTextData=function(oe){K.Message.setOneofField(this,2,proto.service.GetResponseRequest.GetResponseData.oneofGroups_[0],oe)},proto.service.GetResponseRequest.GetResponseData.prototype.clearTextData=function(){K.Message.setOneofField(this,2,proto.service.GetResponseRequest.GetResponseData.oneofGroups_[0],void 0)},proto.service.GetResponseRequest.GetResponseData.prototype.hasTextData=function(){return K.Message.getField(this,2)!=null},proto.service.GetResponseRequest.GetResponseData.prototype.getTriggerData=function(){return K.Message.getWrapperField(this,proto.service.TriggerConfig,3)},proto.service.GetResponseRequest.GetResponseData.prototype.setTriggerData=function(oe){K.Message.setOneofWrapperField(this,3,proto.service.GetResponseRequest.GetResponseData.oneofGroups_[0],oe)},proto.service.GetResponseRequest.GetResponseData.prototype.clearTriggerData=function(){this.setTriggerData(void 0)},proto.service.GetResponseRequest.GetResponseData.prototype.hasTriggerData=function(){return K.Message.getField(this,3)!=null},proto.service.GetResponseRequest.prototype.getGetResponseConfig=function(){return K.Message.getWrapperField(this,proto.service.GetResponseRequest.GetResponseConfig,1)},proto.service.GetResponseRequest.prototype.setGetResponseConfig=function(oe){K.Message.setOneofWrapperField(this,1,proto.service.GetResponseRequest.oneofGroups_[0],oe)},proto.service.GetResponseRequest.prototype.clearGetResponseConfig=function(){this.setGetResponseConfig(void 0)},proto.service.GetResponseRequest.prototype.hasGetResponseConfig=function(){return K.Message.getField(this,1)!=null},proto.service.GetResponseRequest.prototype.getGetResponseData=function(){return K.Message.getWrapperField(this,proto.service.GetResponseRequest.GetResponseData,2)},proto.service.GetResponseRequest.prototype.setGetResponseData=function(oe){K.Message.setOneofWrapperField(this,2,proto.service.GetResponseRequest.oneofGroups_[0],oe)},proto.service.GetResponseRequest.prototype.clearGetResponseData=function(){this.setGetResponseData(void 0)},proto.service.GetResponseRequest.prototype.hasGetResponseData=function(){return K.Message.getField(this,2)!=null},proto.service.GetResponseRequestSingle=function(oe){K.Message.initialize(this,oe,0,-1,null,null)},te.inherits(proto.service.GetResponseRequestSingle,K.Message),te.DEBUG&&!COMPILED&&(proto.service.GetResponseRequestSingle.displayName="proto.service.GetResponseRequestSingle"),K.Message.GENERATE_TO_OBJECT&&(proto.service.GetResponseRequestSingle.prototype.toObject=function(oe){return proto.service.GetResponseRequestSingle.toObject(oe,this)},proto.service.GetResponseRequestSingle.toObject=function(oe,se){var ae,ge={responseConfig:(ae=se.getResponseConfig())&&proto.service.GetResponseRequest.toObject(oe,ae),responseData:(ae=se.getResponseData())&&proto.service.GetResponseRequest.toObject(oe,ae)};return oe&&(ge.$jspbMessageInstance=se),ge}),proto.service.GetResponseRequestSingle.deserializeBinary=function(oe){var se=new K.BinaryReader(oe),ae=new proto.service.GetResponseRequestSingle;return proto.service.GetResponseRequestSingle.deserializeBinaryFromReader(ae,se)},proto.service.GetResponseRequestSingle.deserializeBinaryFromReader=function(oe,se){for(;se.nextField()&&!se.isEndGroup();)switch(se.getFieldNumber()){case 1:var ae=new proto.service.GetResponseRequest;se.readMessage(ae,proto.service.GetResponseRequest.deserializeBinaryFromReader),oe.setResponseConfig(ae);break;case 2:ae=new proto.service.GetResponseRequest,se.readMessage(ae,proto.service.GetResponseRequest.deserializeBinaryFromReader),oe.setResponseData(ae);break;default:se.skipField()}return oe},proto.service.GetResponseRequestSingle.prototype.serializeBinary=function(){var oe=new K.BinaryWriter;return proto.service.GetResponseRequestSingle.serializeBinaryToWriter(this,oe),oe.getResultBuffer()},proto.service.GetResponseRequestSingle.serializeBinaryToWriter=function(oe,se){var ae=void 0;(ae=oe.getResponseConfig())!=null&&se.writeMessage(1,ae,proto.service.GetResponseRequest.serializeBinaryToWriter),(ae=oe.getResponseData())!=null&&se.writeMessage(2,ae,proto.service.GetResponseRequest.serializeBinaryToWriter)},proto.service.GetResponseRequestSingle.prototype.getResponseConfig=function(){return K.Message.getWrapperField(this,proto.service.GetResponseRequest,1)},proto.service.GetResponseRequestSingle.prototype.setResponseConfig=function(oe){K.Message.setWrapperField(this,1,oe)},proto.service.GetResponseRequestSingle.prototype.clearResponseConfig=function(){this.setResponseConfig(void 0)},proto.service.GetResponseRequestSingle.prototype.hasResponseConfig=function(){return K.Message.getField(this,1)!=null},proto.service.GetResponseRequestSingle.prototype.getResponseData=function(){return K.Message.getWrapperField(this,proto.service.GetResponseRequest,2)},proto.service.GetResponseRequestSingle.prototype.setResponseData=function(oe){K.Message.setWrapperField(this,2,oe)},proto.service.GetResponseRequestSingle.prototype.clearResponseData=function(){this.setResponseData(void 0)},proto.service.GetResponseRequestSingle.prototype.hasResponseData=function(){return K.Message.getField(this,2)!=null},proto.service.GetResponseResponse=function(oe){K.Message.initialize(this,oe,0,-1,null,proto.service.GetResponseResponse.oneofGroups_)},te.inherits(proto.service.GetResponseResponse,K.Message),te.DEBUG&&!COMPILED&&(proto.service.GetResponseResponse.displayName="proto.service.GetResponseResponse"),proto.service.GetResponseResponse.oneofGroups_=[[2,3,4,5,6,7,8]],proto.service.GetResponseResponse.ResponseTypeCase={RESPONSE_TYPE_NOT_SET:0,ACTION_RESPONSE:2,AUDIO_RESPONSE:3,DEBUG_LOG:4,USER_QUERY:5,BT_RESPONSE:6,EMOTION_RESPONSE:7,INTERACTION_ID:8},proto.service.GetResponseResponse.prototype.getResponseTypeCase=function(){return K.Message.computeOneofCase(this,proto.service.GetResponseResponse.oneofGroups_[0])},K.Message.GENERATE_TO_OBJECT&&(proto.service.GetResponseResponse.prototype.toObject=function(oe){return proto.service.GetResponseResponse.toObject(oe,this)},proto.service.GetResponseResponse.toObject=function(oe,se){var ae,ge={sessionId:K.Message.getFieldWithDefault(se,1,""),actionResponse:(ae=se.getActionResponse())&&proto.service.GetResponseResponse.ActionResponse.toObject(oe,ae),audioResponse:(ae=se.getAudioResponse())&&proto.service.GetResponseResponse.AudioResponse.toObject(oe,ae),debugLog:K.Message.getFieldWithDefault(se,4,""),userQuery:(ae=se.getUserQuery())&&proto.service.GetResponseResponse.UserTranscript.toObject(oe,ae),btResponse:(ae=se.getBtResponse())&&proto.service.GetResponseResponse.BehaviorTreeResponse.toObject(oe,ae),emotionResponse:K.Message.getFieldWithDefault(se,7,""),interactionId:K.Message.getFieldWithDefault(se,8,"")};return oe&&(ge.$jspbMessageInstance=se),ge}),proto.service.GetResponseResponse.deserializeBinary=function(oe){var se=new K.BinaryReader(oe),ae=new proto.service.GetResponseResponse;return proto.service.GetResponseResponse.deserializeBinaryFromReader(ae,se)},proto.service.GetResponseResponse.deserializeBinaryFromReader=function(oe,se){for(;se.nextField()&&!se.isEndGroup();)switch(se.getFieldNumber()){case 1:var ae=se.readString();oe.setSessionId(ae);break;case 2:ae=new proto.service.GetResponseResponse.ActionResponse,se.readMessage(ae,proto.service.GetResponseResponse.ActionResponse.deserializeBinaryFromReader),oe.setActionResponse(ae);break;case 3:ae=new proto.service.GetResponseResponse.AudioResponse,se.readMessage(ae,proto.service.GetResponseResponse.AudioResponse.deserializeBinaryFromReader),oe.setAudioResponse(ae);break;case 4:ae=se.readString(),oe.setDebugLog(ae);break;case 5:ae=new proto.service.GetResponseResponse.UserTranscript,se.readMessage(ae,proto.service.GetResponseResponse.UserTranscript.deserializeBinaryFromReader),oe.setUserQuery(ae);break;case 6:ae=new proto.service.GetResponseResponse.BehaviorTreeResponse,se.readMessage(ae,proto.service.GetResponseResponse.BehaviorTreeResponse.deserializeBinaryFromReader),oe.setBtResponse(ae);break;case 7:ae=se.readString(),oe.setEmotionResponse(ae);break;case 8:ae=se.readString(),oe.setInteractionId(ae);break;default:se.skipField()}return oe},proto.service.GetResponseResponse.prototype.serializeBinary=function(){var oe=new K.BinaryWriter;return proto.service.GetResponseResponse.serializeBinaryToWriter(this,oe),oe.getResultBuffer()},proto.service.GetResponseResponse.serializeBinaryToWriter=function(oe,se){var ae=void 0;(ae=oe.getSessionId()).length>0&&se.writeString(1,ae),(ae=oe.getActionResponse())!=null&&se.writeMessage(2,ae,proto.service.GetResponseResponse.ActionResponse.serializeBinaryToWriter),(ae=oe.getAudioResponse())!=null&&se.writeMessage(3,ae,proto.service.GetResponseResponse.AudioResponse.serializeBinaryToWriter),(ae=K.Message.getField(oe,4))!=null&&se.writeString(4,ae),(ae=oe.getUserQuery())!=null&&se.writeMessage(5,ae,proto.service.GetResponseResponse.UserTranscript.serializeBinaryToWriter),(ae=oe.getBtResponse())!=null&&se.writeMessage(6,ae,proto.service.GetResponseResponse.BehaviorTreeResponse.serializeBinaryToWriter),(ae=K.Message.getField(oe,7))!=null&&se.writeString(7,ae),(ae=K.Message.getField(oe,8))!=null&&se.writeString(8,ae)},proto.service.GetResponseResponse.AudioResponse=function(oe){K.Message.initialize(this,oe,0,-1,null,proto.service.GetResponseResponse.AudioResponse.oneofGroups_)},te.inherits(proto.service.GetResponseResponse.AudioResponse,K.Message),te.DEBUG&&!COMPILED&&(proto.service.GetResponseResponse.AudioResponse.displayName="proto.service.GetResponseResponse.AudioResponse"),proto.service.GetResponseResponse.AudioResponse.oneofGroups_=[[6,7]],proto.service.GetResponseResponse.AudioResponse.FaceDataTypeCase={FACE_DATA_TYPE_NOT_SET:0,VISEMES_DATA:6,BLENDSHAPES_DATA:7},proto.service.GetResponseResponse.AudioResponse.prototype.getFaceDataTypeCase=function(){return K.Message.computeOneofCase(this,proto.service.GetResponseResponse.AudioResponse.oneofGroups_[0])},K.Message.GENERATE_TO_OBJECT&&(proto.service.GetResponseResponse.AudioResponse.prototype.toObject=function(oe){return proto.service.GetResponseResponse.AudioResponse.toObject(oe,this)},proto.service.GetResponseResponse.AudioResponse.toObject=function(oe,se){var ae,ge={audioData:se.getAudioData_asB64(),audioConfig:(ae=se.getAudioConfig())&&proto.service.AudioConfig.toObject(oe,ae),textData:K.Message.getFieldWithDefault(se,3,""),endOfResponse:K.Message.getFieldWithDefault(se,4,!1),faceData:K.Message.getFieldWithDefault(se,5,""),visemesData:(ae=se.getVisemesData())&&proto.service.VisemesData.toObject(oe,ae),blendshapesData:(ae=se.getBlendshapesData())&&proto.service.BlendShapesData.toObject(oe,ae),faceEmotion:(ae=se.getFaceEmotion())&&ie.ARKitBlendShapesData.toObject(oe,ae),emotionResponse:(ae=se.getEmotionResponse())&&proto.service.EmotionResponse.toObject(oe,ae)};return oe&&(ge.$jspbMessageInstance=se),ge}),proto.service.GetResponseResponse.AudioResponse.deserializeBinary=function(oe){var se=new K.BinaryReader(oe),ae=new proto.service.GetResponseResponse.AudioResponse;return proto.service.GetResponseResponse.AudioResponse.deserializeBinaryFromReader(ae,se)},proto.service.GetResponseResponse.AudioResponse.deserializeBinaryFromReader=function(oe,se){for(;se.nextField()&&!se.isEndGroup();)switch(se.getFieldNumber()){case 1:var ae=se.readBytes();oe.setAudioData(ae);break;case 2:ae=new proto.service.AudioConfig,se.readMessage(ae,proto.service.AudioConfig.deserializeBinaryFromReader),oe.setAudioConfig(ae);break;case 3:ae=se.readString(),oe.setTextData(ae);break;case 4:ae=se.readBool(),oe.setEndOfResponse(ae);break;case 5:ae=se.readString(),oe.setFaceData(ae);break;case 6:ae=new proto.service.VisemesData,se.readMessage(ae,proto.service.VisemesData.deserializeBinaryFromReader),oe.setVisemesData(ae);break;case 7:ae=new proto.service.BlendShapesData,se.readMessage(ae,proto.service.BlendShapesData.deserializeBinaryFromReader),oe.setBlendshapesData(ae);break;case 8:ae=new ie.ARKitBlendShapesData,se.readMessage(ae,ie.ARKitBlendShapesData.deserializeBinaryFromReader),oe.setFaceEmotion(ae);break;case 9:ae=new proto.service.EmotionResponse,se.readMessage(ae,proto.service.EmotionResponse.deserializeBinaryFromReader),oe.setEmotionResponse(ae);break;default:se.skipField()}return oe},proto.service.GetResponseResponse.AudioResponse.prototype.serializeBinary=function(){var oe=new K.BinaryWriter;return proto.service.GetResponseResponse.AudioResponse.serializeBinaryToWriter(this,oe),oe.getResultBuffer()},proto.service.GetResponseResponse.AudioResponse.serializeBinaryToWriter=function(oe,se){var ae=void 0;(ae=oe.getAudioData_asU8()).length>0&&se.writeBytes(1,ae),(ae=oe.getAudioConfig())!=null&&se.writeMessage(2,ae,proto.service.AudioConfig.serializeBinaryToWriter),(ae=oe.getTextData()).length>0&&se.writeString(3,ae),(ae=oe.getEndOfResponse())&&se.writeBool(4,ae),(ae=oe.getFaceData()).length>0&&se.writeString(5,ae),(ae=oe.getVisemesData())!=null&&se.writeMessage(6,ae,proto.service.VisemesData.serializeBinaryToWriter),(ae=oe.getBlendshapesData())!=null&&se.writeMessage(7,ae,proto.service.BlendShapesData.serializeBinaryToWriter),(ae=oe.getFaceEmotion())!=null&&se.writeMessage(8,ae,ie.ARKitBlendShapesData.serializeBinaryToWriter),(ae=oe.getEmotionResponse())!=null&&se.writeMessage(9,ae,proto.service.EmotionResponse.serializeBinaryToWriter)},proto.service.GetResponseResponse.AudioResponse.prototype.getAudioData=function(){return K.Message.getFieldWithDefault(this,1,"")},proto.service.GetResponseResponse.AudioResponse.prototype.getAudioData_asB64=function(){return K.Message.bytesAsB64(this.getAudioData())},proto.service.GetResponseResponse.AudioResponse.prototype.getAudioData_asU8=function(){return K.Message.bytesAsU8(this.getAudioData())},proto.service.GetResponseResponse.AudioResponse.prototype.setAudioData=function(oe){K.Message.setProto3BytesField(this,1,oe)},proto.service.GetResponseResponse.AudioResponse.prototype.getAudioConfig=function(){return K.Message.getWrapperField(this,proto.service.AudioConfig,2)},proto.service.GetResponseResponse.AudioResponse.prototype.setAudioConfig=function(oe){K.Message.setWrapperField(this,2,oe)},proto.service.GetResponseResponse.AudioResponse.prototype.clearAudioConfig=function(){this.setAudioConfig(void 0)},proto.service.GetResponseResponse.AudioResponse.prototype.hasAudioConfig=function(){return K.Message.getField(this,2)!=null},proto.service.GetResponseResponse.AudioResponse.prototype.getTextData=function(){return K.Message.getFieldWithDefault(this,3,"")},proto.service.GetResponseResponse.AudioResponse.prototype.setTextData=function(oe){K.Message.setProto3StringField(this,3,oe)},proto.service.GetResponseResponse.AudioResponse.prototype.getEndOfResponse=function(){return K.Message.getFieldWithDefault(this,4,!1)},proto.service.GetResponseResponse.AudioResponse.prototype.setEndOfResponse=function(oe){K.Message.setProto3BooleanField(this,4,oe)},proto.service.GetResponseResponse.AudioResponse.prototype.getFaceData=function(){return K.Message.getFieldWithDefault(this,5,"")},proto.service.GetResponseResponse.AudioResponse.prototype.setFaceData=function(oe){K.Message.setProto3StringField(this,5,oe)},proto.service.GetResponseResponse.AudioResponse.prototype.getVisemesData=function(){return K.Message.getWrapperField(this,proto.service.VisemesData,6)},proto.service.GetResponseResponse.AudioResponse.prototype.setVisemesData=function(oe){K.Message.setOneofWrapperField(this,6,proto.service.GetResponseResponse.AudioResponse.oneofGroups_[0],oe)},proto.service.GetResponseResponse.AudioResponse.prototype.clearVisemesData=function(){this.setVisemesData(void 0)},proto.service.GetResponseResponse.AudioResponse.prototype.hasVisemesData=function(){return K.Message.getField(this,6)!=null},proto.service.GetResponseResponse.AudioResponse.prototype.getBlendshapesData=function(){return K.Message.getWrapperField(this,proto.service.BlendShapesData,7)},proto.service.GetResponseResponse.AudioResponse.prototype.setBlendshapesData=function(oe){K.Message.setOneofWrapperField(this,7,proto.service.GetResponseResponse.AudioResponse.oneofGroups_[0],oe)},proto.service.GetResponseResponse.AudioResponse.prototype.clearBlendshapesData=function(){this.setBlendshapesData(void 0)},proto.service.GetResponseResponse.AudioResponse.prototype.hasBlendshapesData=function(){return K.Message.getField(this,7)!=null},proto.service.GetResponseResponse.AudioResponse.prototype.getFaceEmotion=function(){return K.Message.getWrapperField(this,ie.ARKitBlendShapesData,8)},proto.service.GetResponseResponse.AudioResponse.prototype.setFaceEmotion=function(oe){K.Message.setWrapperField(this,8,oe)},proto.service.GetResponseResponse.AudioResponse.prototype.clearFaceEmotion=function(){this.setFaceEmotion(void 0)},proto.service.GetResponseResponse.AudioResponse.prototype.hasFaceEmotion=function(){return K.Message.getField(this,8)!=null},proto.service.GetResponseResponse.AudioResponse.prototype.getEmotionResponse=function(){return K.Message.getWrapperField(this,proto.service.EmotionResponse,9)},proto.service.GetResponseResponse.AudioResponse.prototype.setEmotionResponse=function(oe){K.Message.setWrapperField(this,9,oe)},proto.service.GetResponseResponse.AudioResponse.prototype.clearEmotionResponse=function(){this.setEmotionResponse(void 0)},proto.service.GetResponseResponse.AudioResponse.prototype.hasEmotionResponse=function(){return K.Message.getField(this,9)!=null},proto.service.GetResponseResponse.ActionResponse=function(oe){K.Message.initialize(this,oe,0,-1,null,null)},te.inherits(proto.service.GetResponseResponse.ActionResponse,K.Message),te.DEBUG&&!COMPILED&&(proto.service.GetResponseResponse.ActionResponse.displayName="proto.service.GetResponseResponse.ActionResponse"),K.Message.GENERATE_TO_OBJECT&&(proto.service.GetResponseResponse.ActionResponse.prototype.toObject=function(oe){return proto.service.GetResponseResponse.ActionResponse.toObject(oe,this)},proto.service.GetResponseResponse.ActionResponse.toObject=function(oe,se){var ae={action:K.Message.getFieldWithDefault(se,1,"")};return oe&&(ae.$jspbMessageInstance=se),ae}),proto.service.GetResponseResponse.ActionResponse.deserializeBinary=function(oe){var se=new K.BinaryReader(oe),ae=new proto.service.GetResponseResponse.ActionResponse;return proto.service.GetResponseResponse.ActionResponse.deserializeBinaryFromReader(ae,se)},proto.service.GetResponseResponse.ActionResponse.deserializeBinaryFromReader=function(oe,se){for(;se.nextField()&&!se.isEndGroup();)if(se.getFieldNumber()===1){var ae=se.readString();oe.setAction(ae)}else se.skipField();return oe},proto.service.GetResponseResponse.ActionResponse.prototype.serializeBinary=function(){var oe=new K.BinaryWriter;return proto.service.GetResponseResponse.ActionResponse.serializeBinaryToWriter(this,oe),oe.getResultBuffer()},proto.service.GetResponseResponse.ActionResponse.serializeBinaryToWriter=function(oe,se){var ae;(ae=oe.getAction()).length>0&&se.writeString(1,ae)},proto.service.GetResponseResponse.ActionResponse.prototype.getAction=function(){return K.Message.getFieldWithDefault(this,1,"")},proto.service.GetResponseResponse.ActionResponse.prototype.setAction=function(oe){K.Message.setProto3StringField(this,1,oe)},proto.service.GetResponseResponse.BehaviorTreeResponse=function(oe){K.Message.initialize(this,oe,0,-1,null,null)},te.inherits(proto.service.GetResponseResponse.BehaviorTreeResponse,K.Message),te.DEBUG&&!COMPILED&&(proto.service.GetResponseResponse.BehaviorTreeResponse.displayName="proto.service.GetResponseResponse.BehaviorTreeResponse"),K.Message.GENERATE_TO_OBJECT&&(proto.service.GetResponseResponse.BehaviorTreeResponse.prototype.toObject=function(oe){return proto.service.GetResponseResponse.BehaviorTreeResponse.toObject(oe,this)},proto.service.GetResponseResponse.BehaviorTreeResponse.toObject=function(oe,se){var ae={btCode:K.Message.getFieldWithDefault(se,1,""),btConstants:K.Message.getFieldWithDefault(se,2,""),narrativeSectionId:K.Message.getFieldWithDefault(se,3,"")};return oe&&(ae.$jspbMessageInstance=se),ae}),proto.service.GetResponseResponse.BehaviorTreeResponse.deserializeBinary=function(oe){var se=new K.BinaryReader(oe),ae=new proto.service.GetResponseResponse.BehaviorTreeResponse;return proto.service.GetResponseResponse.BehaviorTreeResponse.deserializeBinaryFromReader(ae,se)},proto.service.GetResponseResponse.BehaviorTreeResponse.deserializeBinaryFromReader=function(oe,se){for(;se.nextField()&&!se.isEndGroup();)switch(se.getFieldNumber()){case 1:var ae=se.readString();oe.setBtCode(ae);break;case 2:ae=se.readString(),oe.setBtConstants(ae);break;case 3:ae=se.readString(),oe.setNarrativeSectionId(ae);break;default:se.skipField()}return oe},proto.service.GetResponseResponse.BehaviorTreeResponse.prototype.serializeBinary=function(){var oe=new K.BinaryWriter;return proto.service.GetResponseResponse.BehaviorTreeResponse.serializeBinaryToWriter(this,oe),oe.getResultBuffer()},proto.service.GetResponseResponse.BehaviorTreeResponse.serializeBinaryToWriter=function(oe,se){var ae=void 0;(ae=oe.getBtCode()).length>0&&se.writeString(1,ae),(ae=oe.getBtConstants()).length>0&&se.writeString(2,ae),(ae=oe.getNarrativeSectionId()).length>0&&se.writeString(3,ae)},proto.service.GetResponseResponse.BehaviorTreeResponse.prototype.getBtCode=function(){return K.Message.getFieldWithDefault(this,1,"")},proto.service.GetResponseResponse.BehaviorTreeResponse.prototype.setBtCode=function(oe){K.Message.setProto3StringField(this,1,oe)},proto.service.GetResponseResponse.BehaviorTreeResponse.prototype.getBtConstants=function(){return K.Message.getFieldWithDefault(this,2,"")},proto.service.GetResponseResponse.BehaviorTreeResponse.prototype.setBtConstants=function(oe){K.Message.setProto3StringField(this,2,oe)},proto.service.GetResponseResponse.BehaviorTreeResponse.prototype.getNarrativeSectionId=function(){return K.Message.getFieldWithDefault(this,3,"")},proto.service.GetResponseResponse.BehaviorTreeResponse.prototype.setNarrativeSectionId=function(oe){K.Message.setProto3StringField(this,3,oe)},proto.service.GetResponseResponse.UserTranscript=function(oe){K.Message.initialize(this,oe,0,-1,null,null)},te.inherits(proto.service.GetResponseResponse.UserTranscript,K.Message),te.DEBUG&&!COMPILED&&(proto.service.GetResponseResponse.UserTranscript.displayName="proto.service.GetResponseResponse.UserTranscript"),K.Message.GENERATE_TO_OBJECT&&(proto.service.GetResponseResponse.UserTranscript.prototype.toObject=function(oe){return proto.service.GetResponseResponse.UserTranscript.toObject(oe,this)},proto.service.GetResponseResponse.UserTranscript.toObject=function(oe,se){var ae={textData:K.Message.getFieldWithDefault(se,1,""),isFinal:K.Message.getFieldWithDefault(se,2,!1),endOfResponse:K.Message.getFieldWithDefault(se,3,!1)};return oe&&(ae.$jspbMessageInstance=se),ae}),proto.service.GetResponseResponse.UserTranscript.deserializeBinary=function(oe){var se=new K.BinaryReader(oe),ae=new proto.service.GetResponseResponse.UserTranscript;return proto.service.GetResponseResponse.UserTranscript.deserializeBinaryFromReader(ae,se)},proto.service.GetResponseResponse.UserTranscript.deserializeBinaryFromReader=function(oe,se){for(;se.nextField()&&!se.isEndGroup();)switch(se.getFieldNumber()){case 1:var ae=se.readString();oe.setTextData(ae);break;case 2:ae=se.readBool(),oe.setIsFinal(ae);break;case 3:ae=se.readBool(),oe.setEndOfResponse(ae);break;default:se.skipField()}return oe},proto.service.GetResponseResponse.UserTranscript.prototype.serializeBinary=function(){var oe=new K.BinaryWriter;return proto.service.GetResponseResponse.UserTranscript.serializeBinaryToWriter(this,oe),oe.getResultBuffer()},proto.service.GetResponseResponse.UserTranscript.serializeBinaryToWriter=function(oe,se){var ae=void 0;(ae=oe.getTextData()).length>0&&se.writeString(1,ae),(ae=oe.getIsFinal())&&se.writeBool(2,ae),(ae=oe.getEndOfResponse())&&se.writeBool(3,ae)},proto.service.GetResponseResponse.UserTranscript.prototype.getTextData=function(){return K.Message.getFieldWithDefault(this,1,"")},proto.service.GetResponseResponse.UserTranscript.prototype.setTextData=function(oe){K.Message.setProto3StringField(this,1,oe)},proto.service.GetResponseResponse.UserTranscript.prototype.getIsFinal=function(){return K.Message.getFieldWithDefault(this,2,!1)},proto.service.GetResponseResponse.UserTranscript.prototype.setIsFinal=function(oe){K.Message.setProto3BooleanField(this,2,oe)},proto.service.GetResponseResponse.UserTranscript.prototype.getEndOfResponse=function(){return K.Message.getFieldWithDefault(this,3,!1)},proto.service.GetResponseResponse.UserTranscript.prototype.setEndOfResponse=function(oe){K.Message.setProto3BooleanField(this,3,oe)},proto.service.GetResponseResponse.prototype.getSessionId=function(){return K.Message.getFieldWithDefault(this,1,"")},proto.service.GetResponseResponse.prototype.setSessionId=function(oe){K.Message.setProto3StringField(this,1,oe)},proto.service.GetResponseResponse.prototype.getActionResponse=function(){return K.Message.getWrapperField(this,proto.service.GetResponseResponse.ActionResponse,2)},proto.service.GetResponseResponse.prototype.setActionResponse=function(oe){K.Message.setOneofWrapperField(this,2,proto.service.GetResponseResponse.oneofGroups_[0],oe)},proto.service.GetResponseResponse.prototype.clearActionResponse=function(){this.setActionResponse(void 0)},proto.service.GetResponseResponse.prototype.hasActionResponse=function(){return K.Message.getField(this,2)!=null},proto.service.GetResponseResponse.prototype.getAudioResponse=function(){return K.Message.getWrapperField(this,proto.service.GetResponseResponse.AudioResponse,3)},proto.service.GetResponseResponse.prototype.setAudioResponse=function(oe){K.Message.setOneofWrapperField(this,3,proto.service.GetResponseResponse.oneofGroups_[0],oe)},proto.service.GetResponseResponse.prototype.clearAudioResponse=function(){this.setAudioResponse(void 0)},proto.service.GetResponseResponse.prototype.hasAudioResponse=function(){return K.Message.getField(this,3)!=null},proto.service.GetResponseResponse.prototype.getDebugLog=function(){return K.Message.getFieldWithDefault(this,4,"")},proto.service.GetResponseResponse.prototype.setDebugLog=function(oe){K.Message.setOneofField(this,4,proto.service.GetResponseResponse.oneofGroups_[0],oe)},proto.service.GetResponseResponse.prototype.clearDebugLog=function(){K.Message.setOneofField(this,4,proto.service.GetResponseResponse.oneofGroups_[0],void 0)},proto.service.GetResponseResponse.prototype.hasDebugLog=function(){return K.Message.getField(this,4)!=null},proto.service.GetResponseResponse.prototype.getUserQuery=function(){return K.Message.getWrapperField(this,proto.service.GetResponseResponse.UserTranscript,5)},proto.service.GetResponseResponse.prototype.setUserQuery=function(oe){K.Message.setOneofWrapperField(this,5,proto.service.GetResponseResponse.oneofGroups_[0],oe)},proto.service.GetResponseResponse.prototype.clearUserQuery=function(){this.setUserQuery(void 0)},proto.service.GetResponseResponse.prototype.hasUserQuery=function(){return K.Message.getField(this,5)!=null},proto.service.GetResponseResponse.prototype.getBtResponse=function(){return K.Message.getWrapperField(this,proto.service.GetResponseResponse.BehaviorTreeResponse,6)},proto.service.GetResponseResponse.prototype.setBtResponse=function(oe){K.Message.setOneofWrapperField(this,6,proto.service.GetResponseResponse.oneofGroups_[0],oe)},proto.service.GetResponseResponse.prototype.clearBtResponse=function(){this.setBtResponse(void 0)},proto.service.GetResponseResponse.prototype.hasBtResponse=function(){return K.Message.getField(this,6)!=null},proto.service.GetResponseResponse.prototype.getEmotionResponse=function(){return K.Message.getFieldWithDefault(this,7,"")},proto.service.GetResponseResponse.prototype.setEmotionResponse=function(oe){K.Message.setOneofField(this,7,proto.service.GetResponseResponse.oneofGroups_[0],oe)},proto.service.GetResponseResponse.prototype.clearEmotionResponse=function(){K.Message.setOneofField(this,7,proto.service.GetResponseResponse.oneofGroups_[0],void 0)},proto.service.GetResponseResponse.prototype.hasEmotionResponse=function(){return K.Message.getField(this,7)!=null},proto.service.GetResponseResponse.prototype.getInteractionId=function(){return K.Message.getFieldWithDefault(this,8,"")},proto.service.GetResponseResponse.prototype.setInteractionId=function(oe){K.Message.setOneofField(this,8,proto.service.GetResponseResponse.oneofGroups_[0],oe)},proto.service.GetResponseResponse.prototype.clearInteractionId=function(){K.Message.setOneofField(this,8,proto.service.GetResponseResponse.oneofGroups_[0],void 0)},proto.service.GetResponseResponse.prototype.hasInteractionId=function(){return K.Message.getField(this,8)!=null},proto.service.VisemesData=function(oe){K.Message.initialize(this,oe,0,-1,null,null)},te.inherits(proto.service.VisemesData,K.Message),te.DEBUG&&!COMPILED&&(proto.service.VisemesData.displayName="proto.service.VisemesData"),K.Message.GENERATE_TO_OBJECT&&(proto.service.VisemesData.prototype.toObject=function(oe){return proto.service.VisemesData.toObject(oe,this)},proto.service.VisemesData.toObject=function(oe,se){var ae,ge={visemes:(ae=se.getVisemes())&&proto.service.Viseme.toObject(oe,ae)};return oe&&(ge.$jspbMessageInstance=se),ge}),proto.service.VisemesData.deserializeBinary=function(oe){var se=new K.BinaryReader(oe),ae=new proto.service.VisemesData;return proto.service.VisemesData.deserializeBinaryFromReader(ae,se)},proto.service.VisemesData.deserializeBinaryFromReader=function(oe,se){for(;se.nextField()&&!se.isEndGroup();)if(se.getFieldNumber()===1){var ae=new proto.service.Viseme;se.readMessage(ae,proto.service.Viseme.deserializeBinaryFromReader),oe.setVisemes(ae)}else se.skipField();return oe},proto.service.VisemesData.prototype.serializeBinary=function(){var oe=new K.BinaryWriter;return proto.service.VisemesData.serializeBinaryToWriter(this,oe),oe.getResultBuffer()},proto.service.VisemesData.serializeBinaryToWriter=function(oe,se){var ae;(ae=oe.getVisemes())!=null&&se.writeMessage(1,ae,proto.service.Viseme.serializeBinaryToWriter)},proto.service.VisemesData.prototype.getVisemes=function(){return K.Message.getWrapperField(this,proto.service.Viseme,1)},proto.service.VisemesData.prototype.setVisemes=function(oe){K.Message.setWrapperField(this,1,oe)},proto.service.VisemesData.prototype.clearVisemes=function(){this.setVisemes(void 0)},proto.service.VisemesData.prototype.hasVisemes=function(){return K.Message.getField(this,1)!=null},proto.service.EmotionResponse=function(oe){K.Message.initialize(this,oe,0,-1,null,null)},te.inherits(proto.service.EmotionResponse,K.Message),te.DEBUG&&!COMPILED&&(proto.service.EmotionResponse.displayName="proto.service.EmotionResponse"),K.Message.GENERATE_TO_OBJECT&&(proto.service.EmotionResponse.prototype.toObject=function(oe){return proto.service.EmotionResponse.toObject(oe,this)},proto.service.EmotionResponse.toObject=function(oe,se){var ae={emotion:K.Message.getFieldWithDefault(se,1,""),scale:K.Message.getFieldWithDefault(se,2,"")};return oe&&(ae.$jspbMessageInstance=se),ae}),proto.service.EmotionResponse.deserializeBinary=function(oe){var se=new K.BinaryReader(oe),ae=new proto.service.EmotionResponse;return proto.service.EmotionResponse.deserializeBinaryFromReader(ae,se)},proto.service.EmotionResponse.deserializeBinaryFromReader=function(oe,se){for(;se.nextField()&&!se.isEndGroup();)switch(se.getFieldNumber()){case 1:var ae=se.readString();oe.setEmotion(ae);break;case 2:ae=se.readString(),oe.setScale(ae);break;default:se.skipField()}return oe},proto.service.EmotionResponse.prototype.serializeBinary=function(){var oe=new K.BinaryWriter;return proto.service.EmotionResponse.serializeBinaryToWriter(this,oe),oe.getResultBuffer()},proto.service.EmotionResponse.serializeBinaryToWriter=function(oe,se){var ae=void 0;(ae=oe.getEmotion()).length>0&&se.writeString(1,ae),(ae=oe.getScale()).length>0&&se.writeString(2,ae)},proto.service.EmotionResponse.prototype.getEmotion=function(){return K.Message.getFieldWithDefault(this,1,"")},proto.service.EmotionResponse.prototype.setEmotion=function(oe){K.Message.setProto3StringField(this,1,oe)},proto.service.EmotionResponse.prototype.getScale=function(){return K.Message.getFieldWithDefault(this,2,"")},proto.service.EmotionResponse.prototype.setScale=function(oe){K.Message.setProto3StringField(this,2,oe)},proto.service.Viseme=function(oe){K.Message.initialize(this,oe,0,-1,null,null)},te.inherits(proto.service.Viseme,K.Message),te.DEBUG&&!COMPILED&&(proto.service.Viseme.displayName="proto.service.Viseme"),K.Message.GENERATE_TO_OBJECT&&(proto.service.Viseme.prototype.toObject=function(oe){return proto.service.Viseme.toObject(oe,this)},proto.service.Viseme.toObject=function(oe,se){var ae={sil:+K.Message.getFieldWithDefault(se,1,0),pp:+K.Message.getFieldWithDefault(se,2,0),ff:+K.Message.getFieldWithDefault(se,3,0),th:+K.Message.getFieldWithDefault(se,4,0),dd:+K.Message.getFieldWithDefault(se,5,0),kk:+K.Message.getFieldWithDefault(se,6,0),ch:+K.Message.getFieldWithDefault(se,7,0),ss:+K.Message.getFieldWithDefault(se,8,0),nn:+K.Message.getFieldWithDefault(se,9,0),rr:+K.Message.getFieldWithDefault(se,10,0),aa:+K.Message.getFieldWithDefault(se,11,0),e:+K.Message.getFieldWithDefault(se,12,0),ih:+K.Message.getFieldWithDefault(se,13,0),oh:+K.Message.getFieldWithDefault(se,14,0),ou:+K.Message.getFieldWithDefault(se,15,0)};return oe&&(ae.$jspbMessageInstance=se),ae}),proto.service.Viseme.deserializeBinary=function(oe){var se=new K.BinaryReader(oe),ae=new proto.service.Viseme;return proto.service.Viseme.deserializeBinaryFromReader(ae,se)},proto.service.Viseme.deserializeBinaryFromReader=function(oe,se){for(;se.nextField()&&!se.isEndGroup();)switch(se.getFieldNumber()){case 1:var ae=se.readFloat();oe.setSil(ae);break;case 2:ae=se.readFloat(),oe.setPp(ae);break;case 3:ae=se.readFloat(),oe.setFf(ae);break;case 4:ae=se.readFloat(),oe.setTh(ae);break;case 5:ae=se.readFloat(),oe.setDd(ae);break;case 6:ae=se.readFloat(),oe.setKk(ae);break;case 7:ae=se.readFloat(),oe.setCh(ae);break;case 8:ae=se.readFloat(),oe.setSs(ae);break;case 9:ae=se.readFloat(),oe.setNn(ae);break;case 10:ae=se.readFloat(),oe.setRr(ae);break;case 11:ae=se.readFloat(),oe.setAa(ae);break;case 12:ae=se.readFloat(),oe.setE(ae);break;case 13:ae=se.readFloat(),oe.setIh(ae);break;case 14:ae=se.readFloat(),oe.setOh(ae);break;case 15:ae=se.readFloat(),oe.setOu(ae);break;default:se.skipField()}return oe},proto.service.Viseme.prototype.serializeBinary=function(){var oe=new K.BinaryWriter;return proto.service.Viseme.serializeBinaryToWriter(this,oe),oe.getResultBuffer()},proto.service.Viseme.serializeBinaryToWriter=function(oe,se){var ae=void 0;(ae=oe.getSil())!==0&&se.writeFloat(1,ae),(ae=oe.getPp())!==0&&se.writeFloat(2,ae),(ae=oe.getFf())!==0&&se.writeFloat(3,ae),(ae=oe.getTh())!==0&&se.writeFloat(4,ae),(ae=oe.getDd())!==0&&se.writeFloat(5,ae),(ae=oe.getKk())!==0&&se.writeFloat(6,ae),(ae=oe.getCh())!==0&&se.writeFloat(7,ae),(ae=oe.getSs())!==0&&se.writeFloat(8,ae),(ae=oe.getNn())!==0&&se.writeFloat(9,ae),(ae=oe.getRr())!==0&&se.writeFloat(10,ae),(ae=oe.getAa())!==0&&se.writeFloat(11,ae),(ae=oe.getE())!==0&&se.writeFloat(12,ae),(ae=oe.getIh())!==0&&se.writeFloat(13,ae),(ae=oe.getOh())!==0&&se.writeFloat(14,ae),(ae=oe.getOu())!==0&&se.writeFloat(15,ae)},proto.service.Viseme.prototype.getSil=function(){return+K.Message.getFieldWithDefault(this,1,0)},proto.service.Viseme.prototype.setSil=function(oe){K.Message.setProto3FloatField(this,1,oe)},proto.service.Viseme.prototype.getPp=function(){return+K.Message.getFieldWithDefault(this,2,0)},proto.service.Viseme.prototype.setPp=function(oe){K.Message.setProto3FloatField(this,2,oe)},proto.service.Viseme.prototype.getFf=function(){return+K.Message.getFieldWithDefault(this,3,0)},proto.service.Viseme.prototype.setFf=function(oe){K.Message.setProto3FloatField(this,3,oe)},proto.service.Viseme.prototype.getTh=function(){return+K.Message.getFieldWithDefault(this,4,0)},proto.service.Viseme.prototype.setTh=function(oe){K.Message.setProto3FloatField(this,4,oe)},proto.service.Viseme.prototype.getDd=function(){return+K.Message.getFieldWithDefault(this,5,0)},proto.service.Viseme.prototype.setDd=function(oe){K.Message.setProto3FloatField(this,5,oe)},proto.service.Viseme.prototype.getKk=function(){return+K.Message.getFieldWithDefault(this,6,0)},proto.service.Viseme.prototype.setKk=function(oe){K.Message.setProto3FloatField(this,6,oe)},proto.service.Viseme.prototype.getCh=function(){return+K.Message.getFieldWithDefault(this,7,0)},proto.service.Viseme.prototype.setCh=function(oe){K.Message.setProto3FloatField(this,7,oe)},proto.service.Viseme.prototype.getSs=function(){return+K.Message.getFieldWithDefault(this,8,0)},proto.service.Viseme.prototype.setSs=function(oe){K.Message.setProto3FloatField(this,8,oe)},proto.service.Viseme.prototype.getNn=function(){return+K.Message.getFieldWithDefault(this,9,0)},proto.service.Viseme.prototype.setNn=function(oe){K.Message.setProto3FloatField(this,9,oe)},proto.service.Viseme.prototype.getRr=function(){return+K.Message.getFieldWithDefault(this,10,0)},proto.service.Viseme.prototype.setRr=function(oe){K.Message.setProto3FloatField(this,10,oe)},proto.service.Viseme.prototype.getAa=function(){return+K.Message.getFieldWithDefault(this,11,0)},proto.service.Viseme.prototype.setAa=function(oe){K.Message.setProto3FloatField(this,11,oe)},proto.service.Viseme.prototype.getE=function(){return+K.Message.getFieldWithDefault(this,12,0)},proto.service.Viseme.prototype.setE=function(oe){K.Message.setProto3FloatField(this,12,oe)},proto.service.Viseme.prototype.getIh=function(){return+K.Message.getFieldWithDefault(this,13,0)},proto.service.Viseme.prototype.setIh=function(oe){K.Message.setProto3FloatField(this,13,oe)},proto.service.Viseme.prototype.getOh=function(){return+K.Message.getFieldWithDefault(this,14,0)},proto.service.Viseme.prototype.setOh=function(oe){K.Message.setProto3FloatField(this,14,oe)},proto.service.Viseme.prototype.getOu=function(){return+K.Message.getFieldWithDefault(this,15,0)},proto.service.Viseme.prototype.setOu=function(oe){K.Message.setProto3FloatField(this,15,oe)},proto.service.BlendShapesData=function(oe){K.Message.initialize(this,oe,0,-1,null,null)},te.inherits(proto.service.BlendShapesData,K.Message),te.DEBUG&&!COMPILED&&(proto.service.BlendShapesData.displayName="proto.service.BlendShapesData"),K.Message.GENERATE_TO_OBJECT&&(proto.service.BlendShapesData.prototype.toObject=function(oe){return proto.service.BlendShapesData.toObject(oe,this)},proto.service.BlendShapesData.toObject=function(oe,se){var ae={blendshapeData:K.Message.getFieldWithDefault(se,1,"")};return oe&&(ae.$jspbMessageInstance=se),ae}),proto.service.BlendShapesData.deserializeBinary=function(oe){var se=new K.BinaryReader(oe),ae=new proto.service.BlendShapesData;return proto.service.BlendShapesData.deserializeBinaryFromReader(ae,se)},proto.service.BlendShapesData.deserializeBinaryFromReader=function(oe,se){for(;se.nextField()&&!se.isEndGroup();)if(se.getFieldNumber()===1){var ae=se.readString();oe.setBlendshapeData(ae)}else se.skipField();return oe},proto.service.BlendShapesData.prototype.serializeBinary=function(){var oe=new K.BinaryWriter;return proto.service.BlendShapesData.serializeBinaryToWriter(this,oe),oe.getResultBuffer()},proto.service.BlendShapesData.serializeBinaryToWriter=function(oe,se){var ae;(ae=oe.getBlendshapeData()).length>0&&se.writeString(1,ae)},proto.service.BlendShapesData.prototype.getBlendshapeData=function(){return K.Message.getFieldWithDefault(this,1,"")},proto.service.BlendShapesData.prototype.setBlendshapeData=function(oe){K.Message.setProto3StringField(this,1,oe)},proto.service.HelloRequest=function(oe){K.Message.initialize(this,oe,0,-1,null,null)},te.inherits(proto.service.HelloRequest,K.Message),te.DEBUG&&!COMPILED&&(proto.service.HelloRequest.displayName="proto.service.HelloRequest"),K.Message.GENERATE_TO_OBJECT&&(proto.service.HelloRequest.prototype.toObject=function(oe){return proto.service.HelloRequest.toObject(oe,this)},proto.service.HelloRequest.toObject=function(oe,se){var ae={name:K.Message.getFieldWithDefault(se,1,"")};return oe&&(ae.$jspbMessageInstance=se),ae}),proto.service.HelloRequest.deserializeBinary=function(oe){var se=new K.BinaryReader(oe),ae=new proto.service.HelloRequest;return proto.service.HelloRequest.deserializeBinaryFromReader(ae,se)},proto.service.HelloRequest.deserializeBinaryFromReader=function(oe,se){for(;se.nextField()&&!se.isEndGroup();)if(se.getFieldNumber()===1){var ae=se.readString();oe.setName(ae)}else se.skipField();return oe},proto.service.HelloRequest.prototype.serializeBinary=function(){var oe=new K.BinaryWriter;return proto.service.HelloRequest.serializeBinaryToWriter(this,oe),oe.getResultBuffer()},proto.service.HelloRequest.serializeBinaryToWriter=function(oe,se){var ae;(ae=oe.getName()).length>0&&se.writeString(1,ae)},proto.service.HelloRequest.prototype.getName=function(){return K.Message.getFieldWithDefault(this,1,"")},proto.service.HelloRequest.prototype.setName=function(oe){K.Message.setProto3StringField(this,1,oe)},proto.service.HelloResponse=function(oe){K.Message.initialize(this,oe,0,-1,null,null)},te.inherits(proto.service.HelloResponse,K.Message),te.DEBUG&&!COMPILED&&(proto.service.HelloResponse.displayName="proto.service.HelloResponse"),K.Message.GENERATE_TO_OBJECT&&(proto.service.HelloResponse.prototype.toObject=function(oe){return proto.service.HelloResponse.toObject(oe,this)},proto.service.HelloResponse.toObject=function(oe,se){var ae={message:K.Message.getFieldWithDefault(se,1,"")};return oe&&(ae.$jspbMessageInstance=se),ae}),proto.service.HelloResponse.deserializeBinary=function(oe){var se=new K.BinaryReader(oe),ae=new proto.service.HelloResponse;return proto.service.HelloResponse.deserializeBinaryFromReader(ae,se)},proto.service.HelloResponse.deserializeBinaryFromReader=function(oe,se){for(;se.nextField()&&!se.isEndGroup();)if(se.getFieldNumber()===1){var ae=se.readString();oe.setMessage(ae)}else se.skipField();return oe},proto.service.HelloResponse.prototype.serializeBinary=function(){var oe=new K.BinaryWriter;return proto.service.HelloResponse.serializeBinaryToWriter(this,oe),oe.getResultBuffer()},proto.service.HelloResponse.serializeBinaryToWriter=function(oe,se){var ae;(ae=oe.getMessage()).length>0&&se.writeString(1,ae)},proto.service.HelloResponse.prototype.getMessage=function(){return K.Message.getFieldWithDefault(this,1,"")},proto.service.HelloResponse.prototype.setMessage=function(oe){K.Message.setProto3StringField(this,1,oe)},proto.service.FeedbackRequest=function(oe){K.Message.initialize(this,oe,0,-1,null,null)},te.inherits(proto.service.FeedbackRequest,K.Message),te.DEBUG&&!COMPILED&&(proto.service.FeedbackRequest.displayName="proto.service.FeedbackRequest"),K.Message.GENERATE_TO_OBJECT&&(proto.service.FeedbackRequest.prototype.toObject=function(oe){return proto.service.FeedbackRequest.toObject(oe,this)},proto.service.FeedbackRequest.toObject=function(oe,se){var ae,ge={interactionId:K.Message.getFieldWithDefault(se,1,""),characterId:K.Message.getFieldWithDefault(se,2,""),sessionId:K.Message.getFieldWithDefault(se,3,""),textFeedback:(ae=se.getTextFeedback())&&proto.service.FeedbackRequest.Feedback.toObject(oe,ae),userQuery:K.Message.getFieldWithDefault(se,6,""),response:K.Message.getFieldWithDefault(se,7,"")};return oe&&(ge.$jspbMessageInstance=se),ge}),proto.service.FeedbackRequest.deserializeBinary=function(oe){var se=new K.BinaryReader(oe),ae=new proto.service.FeedbackRequest;return proto.service.FeedbackRequest.deserializeBinaryFromReader(ae,se)},proto.service.FeedbackRequest.deserializeBinaryFromReader=function(oe,se){for(;se.nextField()&&!se.isEndGroup();)switch(se.getFieldNumber()){case 1:var ae=se.readString();oe.setInteractionId(ae);break;case 2:ae=se.readString(),oe.setCharacterId(ae);break;case 3:ae=se.readString(),oe.setSessionId(ae);break;case 5:ae=new proto.service.FeedbackRequest.Feedback,se.readMessage(ae,proto.service.FeedbackRequest.Feedback.deserializeBinaryFromReader),oe.setTextFeedback(ae);break;case 6:ae=se.readString(),oe.setUserQuery(ae);break;case 7:ae=se.readString(),oe.setResponse(ae);break;default:se.skipField()}return oe},proto.service.FeedbackRequest.prototype.serializeBinary=function(){var oe=new K.BinaryWriter;return proto.service.FeedbackRequest.serializeBinaryToWriter(this,oe),oe.getResultBuffer()},proto.service.FeedbackRequest.serializeBinaryToWriter=function(oe,se){var ae=void 0;(ae=oe.getInteractionId()).length>0&&se.writeString(1,ae),(ae=oe.getCharacterId()).length>0&&se.writeString(2,ae),(ae=oe.getSessionId()).length>0&&se.writeString(3,ae),(ae=oe.getTextFeedback())!=null&&se.writeMessage(5,ae,proto.service.FeedbackRequest.Feedback.serializeBinaryToWriter),(ae=oe.getUserQuery()).length>0&&se.writeString(6,ae),(ae=oe.getResponse()).length>0&&se.writeString(7,ae)},proto.service.FeedbackRequest.Feedback=function(oe){K.Message.initialize(this,oe,0,-1,proto.service.FeedbackRequest.Feedback.repeatedFields_,null)},te.inherits(proto.service.FeedbackRequest.Feedback,K.Message),te.DEBUG&&!COMPILED&&(proto.service.FeedbackRequest.Feedback.displayName="proto.service.FeedbackRequest.Feedback"),proto.service.FeedbackRequest.Feedback.repeatedFields_=[3],K.Message.GENERATE_TO_OBJECT&&(proto.service.FeedbackRequest.Feedback.prototype.toObject=function(oe){return proto.service.FeedbackRequest.Feedback.toObject(oe,this)},proto.service.FeedbackRequest.Feedback.toObject=function(oe,se){var ae={thumbsUp:K.Message.getFieldWithDefault(se,1,!1),feedbackText:K.Message.getFieldWithDefault(se,2,""),tagsList:K.Message.getRepeatedField(se,3),isTestCase:K.Message.getFieldWithDefault(se,4,!1)};return oe&&(ae.$jspbMessageInstance=se),ae}),proto.service.FeedbackRequest.Feedback.deserializeBinary=function(oe){var se=new K.BinaryReader(oe),ae=new proto.service.FeedbackRequest.Feedback;return proto.service.FeedbackRequest.Feedback.deserializeBinaryFromReader(ae,se)},proto.service.FeedbackRequest.Feedback.deserializeBinaryFromReader=function(oe,se){for(;se.nextField()&&!se.isEndGroup();)switch(se.getFieldNumber()){case 1:var ae=se.readBool();oe.setThumbsUp(ae);break;case 2:ae=se.readString(),oe.setFeedbackText(ae);break;case 3:ae=se.readString(),oe.addTags(ae);break;case 4:ae=se.readBool(),oe.setIsTestCase(ae);break;default:se.skipField()}return oe},proto.service.FeedbackRequest.Feedback.prototype.serializeBinary=function(){var oe=new K.BinaryWriter;return proto.service.FeedbackRequest.Feedback.serializeBinaryToWriter(this,oe),oe.getResultBuffer()},proto.service.FeedbackRequest.Feedback.serializeBinaryToWriter=function(oe,se){var ae=void 0;(ae=oe.getThumbsUp())&&se.writeBool(1,ae),(ae=oe.getFeedbackText()).length>0&&se.writeString(2,ae),(ae=oe.getTagsList()).length>0&&se.writeRepeatedString(3,ae),(ae=oe.getIsTestCase())&&se.writeBool(4,ae)},proto.service.FeedbackRequest.Feedback.prototype.getThumbsUp=function(){return K.Message.getFieldWithDefault(this,1,!1)},proto.service.FeedbackRequest.Feedback.prototype.setThumbsUp=function(oe){K.Message.setProto3BooleanField(this,1,oe)},proto.service.FeedbackRequest.Feedback.prototype.getFeedbackText=function(){return K.Message.getFieldWithDefault(this,2,"")},proto.service.FeedbackRequest.Feedback.prototype.setFeedbackText=function(oe){K.Message.setProto3StringField(this,2,oe)},proto.service.FeedbackRequest.Feedback.prototype.getTagsList=function(){return K.Message.getRepeatedField(this,3)},proto.service.FeedbackRequest.Feedback.prototype.setTagsList=function(oe){K.Message.setField(this,3,oe||[])},proto.service.FeedbackRequest.Feedback.prototype.addTags=function(oe,se){K.Message.addToRepeatedField(this,3,oe,se)},proto.service.FeedbackRequest.Feedback.prototype.clearTagsList=function(){this.setTagsList([])},proto.service.FeedbackRequest.Feedback.prototype.getIsTestCase=function(){return K.Message.getFieldWithDefault(this,4,!1)},proto.service.FeedbackRequest.Feedback.prototype.setIsTestCase=function(oe){K.Message.setProto3BooleanField(this,4,oe)},proto.service.FeedbackRequest.prototype.getInteractionId=function(){return K.Message.getFieldWithDefault(this,1,"")},proto.service.FeedbackRequest.prototype.setInteractionId=function(oe){K.Message.setProto3StringField(this,1,oe)},proto.service.FeedbackRequest.prototype.getCharacterId=function(){return K.Message.getFieldWithDefault(this,2,"")},proto.service.FeedbackRequest.prototype.setCharacterId=function(oe){K.Message.setProto3StringField(this,2,oe)},proto.service.FeedbackRequest.prototype.getSessionId=function(){return K.Message.getFieldWithDefault(this,3,"")},proto.service.FeedbackRequest.prototype.setSessionId=function(oe){K.Message.setProto3StringField(this,3,oe)},proto.service.FeedbackRequest.prototype.getTextFeedback=function(){return K.Message.getWrapperField(this,proto.service.FeedbackRequest.Feedback,5)},proto.service.FeedbackRequest.prototype.setTextFeedback=function(oe){K.Message.setWrapperField(this,5,oe)},proto.service.FeedbackRequest.prototype.clearTextFeedback=function(){this.setTextFeedback(void 0)},proto.service.FeedbackRequest.prototype.hasTextFeedback=function(){return K.Message.getField(this,5)!=null},proto.service.FeedbackRequest.prototype.getUserQuery=function(){return K.Message.getFieldWithDefault(this,6,"")},proto.service.FeedbackRequest.prototype.setUserQuery=function(oe){K.Message.setProto3StringField(this,6,oe)},proto.service.FeedbackRequest.prototype.getResponse=function(){return K.Message.getFieldWithDefault(this,7,"")},proto.service.FeedbackRequest.prototype.setResponse=function(oe){K.Message.setProto3StringField(this,7,oe)},proto.service.FeedbackResponse=function(oe){K.Message.initialize(this,oe,0,-1,null,null)},te.inherits(proto.service.FeedbackResponse,K.Message),te.DEBUG&&!COMPILED&&(proto.service.FeedbackResponse.displayName="proto.service.FeedbackResponse"),K.Message.GENERATE_TO_OBJECT&&(proto.service.FeedbackResponse.prototype.toObject=function(oe){return proto.service.FeedbackResponse.toObject(oe,this)},proto.service.FeedbackResponse.toObject=function(oe,se){var ae={feedbackResponse:K.Message.getFieldWithDefault(se,1,"")};return oe&&(ae.$jspbMessageInstance=se),ae}),proto.service.FeedbackResponse.deserializeBinary=function(oe){var se=new K.BinaryReader(oe),ae=new proto.service.FeedbackResponse;return proto.service.FeedbackResponse.deserializeBinaryFromReader(ae,se)},proto.service.FeedbackResponse.deserializeBinaryFromReader=function(oe,se){for(;se.nextField()&&!se.isEndGroup();)if(se.getFieldNumber()===1){var ae=se.readString();oe.setFeedbackResponse(ae)}else se.skipField();return oe},proto.service.FeedbackResponse.prototype.serializeBinary=function(){var oe=new K.BinaryWriter;return proto.service.FeedbackResponse.serializeBinaryToWriter(this,oe),oe.getResultBuffer()},proto.service.FeedbackResponse.serializeBinaryToWriter=function(oe,se){var ae;(ae=oe.getFeedbackResponse()).length>0&&se.writeString(1,ae)},proto.service.FeedbackResponse.prototype.getFeedbackResponse=function(){return K.Message.getFieldWithDefault(this,1,"")},proto.service.FeedbackResponse.prototype.setFeedbackResponse=function(oe){K.Message.setProto3StringField(this,1,oe)},proto.service.FaceModel={FACE_MODEL_UNSPECIFIED:0,FACE_MODEL_A_2F_MODEL_NAME:1,FACE_MODEL_PHONEMES_MODEL_NAME:2,FACE_MODEL_OVR_MODEL_NAME:3},te.object.extend(Z,proto.service)},820:(X,Z,_)=>{var K=_(48);_(553).grpc;var te=function(){function ne(){}return ne.serviceName="service.ConvaiService",ne}();te.Hello={methodName:"Hello",service:te,requestStream:!1,responseStream:!1,requestType:K.HelloRequest,responseType:K.HelloResponse},te.HelloStream={methodName:"HelloStream",service:te,requestStream:!0,responseStream:!0,requestType:K.HelloRequest,responseType:K.HelloResponse},te.SpeechToText={methodName:"SpeechToText",service:te,requestStream:!0,responseStream:!0,requestType:K.STTRequest,responseType:K.STTResponse},te.GetResponse={methodName:"GetResponse",service:te,requestStream:!0,responseStream:!0,requestType:K.GetResponseRequest,responseType:K.GetResponseResponse},te.GetResponseSingle={methodName:"GetResponseSingle",service:te,requestStream:!1,responseStream:!0,requestType:K.GetResponseRequestSingle,responseType:K.GetResponseResponse},te.SubmitFeedback={methodName:"SubmitFeedback",service:te,requestStream:!1,responseStream:!1,requestType:K.FeedbackRequest,responseType:K.FeedbackResponse},Z.C=te},553:function(X){var Z,_;X.exports=(Z={418:function(K,te){(function(ne,ie){for(var oe in ie)ne[oe]=ie[oe]})(te,function(ne){var ie={};function oe(se){if(ie[se])return ie[se].exports;var ae=ie[se]={i:se,l:!1,exports:{}};return ne[se].call(ae.exports,ae,ae.exports,oe),ae.l=!0,ae.exports}return oe.m=ne,oe.c=ie,oe.i=function(se){return se},oe.d=function(se,ae,ge){oe.o(se,ae)||Object.defineProperty(se,ae,{configurable:!1,enumerable:!0,get:ge})},oe.n=function(se){var ae=se&&se.__esModule?function(){return se.default}:function(){return se};return oe.d(ae,"a",ae),ae},oe.o=function(se,ae){return Object.prototype.hasOwnProperty.call(se,ae)},oe.p="",oe(oe.s=1)}([function(ne,ie,oe){Object.defineProperty(ie,"__esModule",{value:!0});var se=oe(3),ae=function(){function ge(ce,de){ce===void 0&&(ce={}),de===void 0&&(de={splitValues:!1});var Ie,fe=this;this.headersMap={},ce&&(typeof Headers<"u"&&ce instanceof Headers?se.getHeaderKeys(ce).forEach(function(be){se.getHeaderValues(ce,be).forEach(function(Ae){de.splitValues?fe.append(be,se.splitHeaderValue(Ae)):fe.append(be,Ae)})}):typeof(Ie=ce)=="object"&&typeof Ie.headersMap=="object"&&typeof Ie.forEach=="function"?ce.forEach(function(be,Ae){fe.append(be,Ae)}):typeof Map<"u"&&ce instanceof Map?ce.forEach(function(be,Ae){fe.append(Ae,be)}):typeof ce=="string"?this.appendFromString(ce):typeof ce=="object"&&Object.getOwnPropertyNames(ce).forEach(function(be){var Ae=ce[be];Array.isArray(Ae)?Ae.forEach(function(ye){fe.append(be,ye)}):fe.append(be,Ae)}))}return ge.prototype.appendFromString=function(ce){for(var de=ce.split(`\r
`),Ie=0;Ie<de.length;Ie++){var fe=de[Ie],be=fe.indexOf(":");if(be>0){var Ae=fe.substring(0,be).trim(),ye=fe.substring(be+1).trim();this.append(Ae,ye)}}},ge.prototype.delete=function(ce,de){var Ie=se.normalizeName(ce);if(de===void 0)delete this.headersMap[Ie];else{var fe=this.headersMap[Ie];if(fe){var be=fe.indexOf(de);be>=0&&fe.splice(be,1),fe.length===0&&delete this.headersMap[Ie]}}},ge.prototype.append=function(ce,de){var Ie=this,fe=se.normalizeName(ce);Array.isArray(this.headersMap[fe])||(this.headersMap[fe]=[]),Array.isArray(de)?de.forEach(function(be){Ie.headersMap[fe].push(se.normalizeValue(be))}):this.headersMap[fe].push(se.normalizeValue(de))},ge.prototype.set=function(ce,de){var Ie=se.normalizeName(ce);if(Array.isArray(de)){var fe=[];de.forEach(function(be){fe.push(se.normalizeValue(be))}),this.headersMap[Ie]=fe}else this.headersMap[Ie]=[se.normalizeValue(de)]},ge.prototype.has=function(ce,de){var Ie=this.headersMap[se.normalizeName(ce)];if(!Array.isArray(Ie))return!1;if(de!==void 0){var fe=se.normalizeValue(de);return Ie.indexOf(fe)>=0}return!0},ge.prototype.get=function(ce){var de=this.headersMap[se.normalizeName(ce)];return de!==void 0?de.concat():[]},ge.prototype.forEach=function(ce){var de=this;Object.getOwnPropertyNames(this.headersMap).forEach(function(Ie){ce(Ie,de.headersMap[Ie])},this)},ge.prototype.toHeaders=function(){if(typeof Headers<"u"){var ce=new Headers;return this.forEach(function(de,Ie){Ie.forEach(function(fe){ce.append(de,fe)})}),ce}throw new Error("Headers class is not defined")},ge}();ie.BrowserHeaders=ae},function(ne,ie,oe){Object.defineProperty(ie,"__esModule",{value:!0});var se=oe(0);ie.BrowserHeaders=se.BrowserHeaders},function(ne,ie,oe){Object.defineProperty(ie,"__esModule",{value:!0}),ie.iterateHeaders=function(se,ae){for(var ge=se[Symbol.iterator](),ce=ge.next();!ce.done;)ae(ce.value[0]),ce=ge.next()},ie.iterateHeadersKeys=function(se,ae){for(var ge=se.keys(),ce=ge.next();!ce.done;)ae(ce.value),ce=ge.next()}},function(ne,ie,oe){Object.defineProperty(ie,"__esModule",{value:!0});var se=oe(2);ie.normalizeName=function(ae){if(typeof ae!="string"&&(ae=String(ae)),/[^a-z0-9\-#$%&'*+.\^_`|~]/i.test(ae))throw new TypeError("Invalid character in header field name");return ae.toLowerCase()},ie.normalizeValue=function(ae){return typeof ae!="string"&&(ae=String(ae)),ae},ie.getHeaderValues=function(ae,ge){var ce=ae;if(ce instanceof Headers&&ce.getAll)return ce.getAll(ge);var de=ce.get(ge);return de&&typeof de=="string"?[de]:de},ie.getHeaderKeys=function(ae){var ge=ae,ce={},de=[];return ge.keys?se.iterateHeadersKeys(ge,function(Ie){ce[Ie]||(ce[Ie]=!0,de.push(Ie))}):ge.forEach?ge.forEach(function(Ie,fe){ce[fe]||(ce[fe]=!0,de.push(fe))}):se.iterateHeaders(ge,function(Ie){var fe=Ie[0];ce[fe]||(ce[fe]=!0,de.push(fe))}),de},ie.splitHeaderValue=function(ae){var ge=[];return ae.split(", ").forEach(function(ce){ce.split(",").forEach(function(de){ge.push(de)})}),ge}}]))},617:function(K,te,ne){Object.defineProperty(te,"__esModule",{value:!0}),te.ChunkParser=te.ChunkType=te.encodeASCII=te.decodeASCII=void 0;var ie,oe=ne(65);function se(be){return(Ae=be)===9||Ae===10||Ae===13||be>=32&&be<=126;var Ae}function ae(be){for(var Ae=0;Ae!==be.length;++Ae)if(!se(be[Ae]))throw new Error("Metadata is not valid (printable) ASCII");return String.fromCharCode.apply(String,Array.prototype.slice.call(be))}function ge(be){return!(128&~be.getUint8(0))}function ce(be){return be.getUint32(1,!1)}function de(be,Ae,ye){return be.byteLength-Ae>=ye}function Ie(be,Ae,ye){if(be.slice)return be.slice(Ae,ye);var ve=be.length;ye!==void 0&&(ve=ye);for(var Be=new Uint8Array(ve-Ae),Re=0,Ve=Ae;Ve<ve;Ve++)Be[Re++]=be[Ve];return Be}te.decodeASCII=ae,te.encodeASCII=function(be){for(var Ae=new Uint8Array(be.length),ye=0;ye!==be.length;++ye){var ve=be.charCodeAt(ye);if(!se(ve))throw new Error("Metadata contains invalid ASCII");Ae[ye]=ve}return Ae},function(be){be[be.MESSAGE=1]="MESSAGE",be[be.TRAILERS=2]="TRAILERS"}(ie=te.ChunkType||(te.ChunkType={}));var fe=function(){function be(){this.buffer=null,this.position=0}return be.prototype.parse=function(Ae,ye){if(Ae.length===0&&ye)return[];var ve,Be=[];if(this.buffer==null)this.buffer=Ae,this.position=0;else if(this.position===this.buffer.byteLength)this.buffer=Ae,this.position=0;else{var Re=this.buffer.byteLength-this.position,Ve=new Uint8Array(Re+Ae.byteLength),Ee=Ie(this.buffer,this.position);Ve.set(Ee,0);var Ze=new Uint8Array(Ae);Ve.set(Ze,Re),this.buffer=Ve,this.position=0}for(;;){if(!de(this.buffer,this.position,5))return Be;var _e=Ie(this.buffer,this.position,this.position+5),Fe=new DataView(_e.buffer,_e.byteOffset,_e.byteLength),Te=ce(Fe);if(!de(this.buffer,this.position,5+Te))return Be;var ke=Ie(this.buffer,this.position+5,this.position+5+Te);if(this.position+=5+Te,ge(Fe))return Be.push({chunkType:ie.TRAILERS,trailers:(ve=ke,new oe.Metadata(ae(ve)))}),Be;Be.push({chunkType:ie.MESSAGE,data:ke})}},be}();te.ChunkParser=fe},8:function(K,te){var ne;Object.defineProperty(te,"__esModule",{value:!0}),te.httpStatusToCode=te.Code=void 0,function(ie){ie[ie.OK=0]="OK",ie[ie.Canceled=1]="Canceled",ie[ie.Unknown=2]="Unknown",ie[ie.InvalidArgument=3]="InvalidArgument",ie[ie.DeadlineExceeded=4]="DeadlineExceeded",ie[ie.NotFound=5]="NotFound",ie[ie.AlreadyExists=6]="AlreadyExists",ie[ie.PermissionDenied=7]="PermissionDenied",ie[ie.ResourceExhausted=8]="ResourceExhausted",ie[ie.FailedPrecondition=9]="FailedPrecondition",ie[ie.Aborted=10]="Aborted",ie[ie.OutOfRange=11]="OutOfRange",ie[ie.Unimplemented=12]="Unimplemented",ie[ie.Internal=13]="Internal",ie[ie.Unavailable=14]="Unavailable",ie[ie.DataLoss=15]="DataLoss",ie[ie.Unauthenticated=16]="Unauthenticated"}(ne=te.Code||(te.Code={})),te.httpStatusToCode=function(ie){switch(ie){case 0:return ne.Internal;case 200:return ne.OK;case 400:return ne.InvalidArgument;case 401:return ne.Unauthenticated;case 403:return ne.PermissionDenied;case 404:return ne.NotFound;case 409:return ne.Aborted;case 412:return ne.FailedPrecondition;case 429:return ne.ResourceExhausted;case 499:return ne.Canceled;case 500:default:return ne.Unknown;case 501:return ne.Unimplemented;case 503:return ne.Unavailable;case 504:return ne.DeadlineExceeded}}},934:function(K,te,ne){Object.defineProperty(te,"__esModule",{value:!0}),te.client=void 0;var ie=ne(65),oe=ne(617),se=ne(8),ae=ne(346),ge=ne(57),ce=ne(882);te.client=function(fe,be){return new de(fe,be)};var de=function(){function fe(be,Ae){this.started=!1,this.sentFirstMessage=!1,this.completed=!1,this.closed=!1,this.finishedSending=!1,this.onHeadersCallbacks=[],this.onMessageCallbacks=[],this.onEndCallbacks=[],this.parser=new oe.ChunkParser,this.methodDefinition=be,this.props=Ae,this.createTransport()}return fe.prototype.createTransport=function(){var be=this.props.host+"/"+this.methodDefinition.service.serviceName+"/"+this.methodDefinition.methodName,Ae={methodDefinition:this.methodDefinition,debug:this.props.debug||!1,url:be,onHeaders:this.onTransportHeaders.bind(this),onChunk:this.onTransportChunk.bind(this),onEnd:this.onTransportEnd.bind(this)};this.props.transport?this.transport=this.props.transport(Ae):this.transport=ge.makeDefaultTransport(Ae)},fe.prototype.onTransportHeaders=function(be,Ae){if(this.props.debug&&ae.debug("onHeaders",be,Ae),this.closed)this.props.debug&&ae.debug("grpc.onHeaders received after request was closed - ignoring");else if(Ae!==0){this.responseHeaders=be,this.props.debug&&ae.debug("onHeaders.responseHeaders",JSON.stringify(this.responseHeaders,null,2));var ye=Ie(be);this.props.debug&&ae.debug("onHeaders.gRPCStatus",ye);var ve=ye&&ye>=0?ye:se.httpStatusToCode(Ae);this.props.debug&&ae.debug("onHeaders.code",ve);var Be=be.get("grpc-message")||[];if(this.props.debug&&ae.debug("onHeaders.gRPCMessage",Be),this.rawOnHeaders(be),ve!==se.Code.OK){var Re=this.decodeGRPCStatus(Be[0]);this.rawOnError(ve,Re,be)}}},fe.prototype.onTransportChunk=function(be){var Ae=this;if(this.closed)this.props.debug&&ae.debug("grpc.onChunk received after request was closed - ignoring");else{var ye=[];try{ye=this.parser.parse(be)}catch(ve){return this.props.debug&&ae.debug("onChunk.parsing error",ve,ve.message),void this.rawOnError(se.Code.Internal,"parsing error: "+ve.message)}ye.forEach(function(ve){if(ve.chunkType===oe.ChunkType.MESSAGE){var Be=Ae.methodDefinition.responseType.deserializeBinary(ve.data);Ae.rawOnMessage(Be)}else ve.chunkType===oe.ChunkType.TRAILERS&&(Ae.responseHeaders?(Ae.responseTrailers=new ie.Metadata(ve.trailers),Ae.props.debug&&ae.debug("onChunk.trailers",Ae.responseTrailers)):(Ae.responseHeaders=new ie.Metadata(ve.trailers),Ae.rawOnHeaders(Ae.responseHeaders)))})}},fe.prototype.onTransportEnd=function(){if(this.props.debug&&ae.debug("grpc.onEnd"),this.closed)this.props.debug&&ae.debug("grpc.onEnd received after request was closed - ignoring");else if(this.responseTrailers!==void 0){var be=Ie(this.responseTrailers);if(be!==null){var Ae=this.responseTrailers.get("grpc-message"),ye=this.decodeGRPCStatus(Ae[0]);this.rawOnEnd(be,ye,this.responseTrailers)}else this.rawOnError(se.Code.Internal,"Response closed without grpc-status (Trailers provided)")}else{if(this.responseHeaders===void 0)return void this.rawOnError(se.Code.Unknown,"Response closed without headers");var ve=Ie(this.responseHeaders),Be=this.responseHeaders.get("grpc-message");if(this.props.debug&&ae.debug("grpc.headers only response ",ve,Be),ve===null)return void this.rawOnEnd(se.Code.Unknown,"Response closed without grpc-status (Headers only)",this.responseHeaders);var Re=this.decodeGRPCStatus(Be[0]);this.rawOnEnd(ve,Re,this.responseHeaders)}},fe.prototype.decodeGRPCStatus=function(be){if(!be)return"";try{return decodeURIComponent(be)}catch{return be}},fe.prototype.rawOnEnd=function(be,Ae,ye){var ve=this;this.props.debug&&ae.debug("rawOnEnd",be,Ae,ye),this.completed||(this.completed=!0,this.onEndCallbacks.forEach(function(Be){if(!ve.closed)try{Be(be,Ae,ye)}catch(Re){setTimeout(function(){throw Re},0)}}))},fe.prototype.rawOnHeaders=function(be){this.props.debug&&ae.debug("rawOnHeaders",be),this.completed||this.onHeadersCallbacks.forEach(function(Ae){try{Ae(be)}catch(ye){setTimeout(function(){throw ye},0)}})},fe.prototype.rawOnError=function(be,Ae,ye){var ve=this;ye===void 0&&(ye=new ie.Metadata),this.props.debug&&ae.debug("rawOnError",be,Ae),this.completed||(this.completed=!0,this.onEndCallbacks.forEach(function(Be){if(!ve.closed)try{Be(be,Ae,ye)}catch(Re){setTimeout(function(){throw Re},0)}}))},fe.prototype.rawOnMessage=function(be){var Ae=this;this.props.debug&&ae.debug("rawOnMessage",be.toObject()),this.completed||this.closed||this.onMessageCallbacks.forEach(function(ye){if(!Ae.closed)try{ye(be)}catch(ve){setTimeout(function(){throw ve},0)}})},fe.prototype.onHeaders=function(be){this.onHeadersCallbacks.push(be)},fe.prototype.onMessage=function(be){this.onMessageCallbacks.push(be)},fe.prototype.onEnd=function(be){this.onEndCallbacks.push(be)},fe.prototype.start=function(be){if(this.started)throw new Error("Client already started - cannot .start()");this.started=!0;var Ae=new ie.Metadata(be||{});Ae.set("content-type","application/grpc-web+proto"),Ae.set("x-grpc-web","1"),this.transport.start(Ae)},fe.prototype.send=function(be){if(!this.started)throw new Error("Client not started - .start() must be called before .send()");if(this.closed)throw new Error("Client already closed - cannot .send()");if(this.finishedSending)throw new Error("Client already finished sending - cannot .send()");if(!this.methodDefinition.requestStream&&this.sentFirstMessage)throw new Error("Message already sent for non-client-streaming method - cannot .send()");this.sentFirstMessage=!0;var Ae=ce.frameRequest(be);this.transport.sendMessage(Ae)},fe.prototype.finishSend=function(){if(!this.started)throw new Error("Client not started - .finishSend() must be called before .close()");if(this.closed)throw new Error("Client already closed - cannot .send()");if(this.finishedSending)throw new Error("Client already finished sending - cannot .finishSend()");this.finishedSending=!0,this.transport.finishSend()},fe.prototype.close=function(){if(!this.started)throw new Error("Client not started - .start() must be called before .close()");if(this.closed)throw new Error("Client already closed - cannot .close()");this.closed=!0,this.props.debug&&ae.debug("request.abort aborting request"),this.transport.cancel()},fe}();function Ie(fe){var be=fe.get("grpc-status")||[];if(be.length>0)try{var Ae=be[0];return parseInt(Ae,10)}catch{return null}return null}},346:function(K,te){Object.defineProperty(te,"__esModule",{value:!0}),te.debug=void 0,te.debug=function(){for(var ne=[],ie=0;ie<arguments.length;ie++)ne[ie]=arguments[ie]}},607:function(K,te,ne){Object.defineProperty(te,"__esModule",{value:!0}),te.grpc=void 0;var ie,oe=ne(418),se=ne(57),ae=ne(229),ge=ne(540),ce=ne(210),de=ne(859),Ie=ne(8),fe=ne(938),be=ne(35),Ae=ne(934);(ie=te.grpc||(te.grpc={})).setDefaultTransport=se.setDefaultTransportFactory,ie.CrossBrowserHttpTransport=de.CrossBrowserHttpTransport,ie.FetchReadableStreamTransport=ae.FetchReadableStreamTransport,ie.XhrTransport=ce.XhrTransport,ie.WebsocketTransport=ge.WebsocketTransport,ie.Code=Ie.Code,ie.Metadata=oe.BrowserHeaders,ie.client=function(ye,ve){return Ae.client(ye,ve)},ie.invoke=fe.invoke,ie.unary=be.unary},938:function(K,te,ne){Object.defineProperty(te,"__esModule",{value:!0}),te.invoke=void 0;var ie=ne(934);te.invoke=function(oe,se){if(oe.requestStream)throw new Error(".invoke cannot be used with client-streaming methods. Use .client instead.");var ae=ie.client(oe,{host:se.host,transport:se.transport,debug:se.debug});return se.onHeaders&&ae.onHeaders(se.onHeaders),se.onMessage&&ae.onMessage(se.onMessage),se.onEnd&&ae.onEnd(se.onEnd),ae.start(se.metadata),ae.send(se.request),ae.finishSend(),{close:function(){ae.close()}}}},65:function(K,te,ne){Object.defineProperty(te,"__esModule",{value:!0}),te.Metadata=void 0;var ie=ne(418);Object.defineProperty(te,"Metadata",{enumerable:!0,get:function(){return ie.BrowserHeaders}})},57:function(K,te,ne){Object.defineProperty(te,"__esModule",{value:!0}),te.makeDefaultTransport=te.setDefaultTransportFactory=void 0;var ie=ne(859),oe=function(se){return ie.CrossBrowserHttpTransport({withCredentials:!1})(se)};te.setDefaultTransportFactory=function(se){oe=se},te.makeDefaultTransport=function(se){return oe(se)}},229:function(K,te,ne){var ie=this&&this.__assign||function(){return(ie=Object.assign||function(ge){for(var ce,de=1,Ie=arguments.length;de<Ie;de++)for(var fe in ce=arguments[de])Object.prototype.hasOwnProperty.call(ce,fe)&&(ge[fe]=ce[fe]);return ge}).apply(this,arguments)};Object.defineProperty(te,"__esModule",{value:!0}),te.detectFetchSupport=te.FetchReadableStreamTransport=void 0;var oe=ne(65),se=ne(346);te.FetchReadableStreamTransport=function(ge){return function(ce){return function(de,Ie){return de.debug&&se.debug("fetchRequest",de),new ae(de,Ie)}(ce,ge)}};var ae=function(){function ge(ce,de){this.cancelled=!1,this.controller=self.AbortController&&new AbortController,this.options=ce,this.init=de}return ge.prototype.pump=function(ce,de){var Ie=this;if(this.reader=ce,this.cancelled)return this.options.debug&&se.debug("Fetch.pump.cancel at first pump"),void this.reader.cancel().catch(function(fe){Ie.options.debug&&se.debug("Fetch.pump.reader.cancel exception",fe)});this.reader.read().then(function(fe){if(fe.done)return Ie.options.onEnd(),de;Ie.options.onChunk(fe.value),Ie.pump(Ie.reader,de)}).catch(function(fe){Ie.cancelled?Ie.options.debug&&se.debug("Fetch.catch - request cancelled"):(Ie.cancelled=!0,Ie.options.debug&&se.debug("Fetch.catch",fe.message),Ie.options.onEnd(fe))})},ge.prototype.send=function(ce){var de=this;fetch(this.options.url,ie(ie({},this.init),{headers:this.metadata.toHeaders(),method:"POST",body:ce,signal:this.controller&&this.controller.signal})).then(function(Ie){if(de.options.debug&&se.debug("Fetch.response",Ie),de.options.onHeaders(new oe.Metadata(Ie.headers),Ie.status),!Ie.body)return Ie;de.pump(Ie.body.getReader(),Ie)}).catch(function(Ie){de.cancelled?de.options.debug&&se.debug("Fetch.catch - request cancelled"):(de.cancelled=!0,de.options.debug&&se.debug("Fetch.catch",Ie.message),de.options.onEnd(Ie))})},ge.prototype.sendMessage=function(ce){this.send(ce)},ge.prototype.finishSend=function(){},ge.prototype.start=function(ce){this.metadata=ce},ge.prototype.cancel=function(){var ce=this;this.cancelled?this.options.debug&&se.debug("Fetch.cancel already cancelled"):(this.cancelled=!0,this.controller?(this.options.debug&&se.debug("Fetch.cancel.controller.abort"),this.controller.abort()):this.options.debug&&se.debug("Fetch.cancel.missing abort controller"),this.reader?(this.options.debug&&se.debug("Fetch.cancel.reader.cancel"),this.reader.cancel().catch(function(de){ce.options.debug&&se.debug("Fetch.cancel.reader.cancel exception",de)})):this.options.debug&&se.debug("Fetch.cancel before reader"))},ge}();te.detectFetchSupport=function(){return typeof Response<"u"&&Response.prototype.hasOwnProperty("body")&&typeof Headers=="function"}},859:function(K,te,ne){Object.defineProperty(te,"__esModule",{value:!0}),te.CrossBrowserHttpTransport=void 0;var ie=ne(229),oe=ne(210);te.CrossBrowserHttpTransport=function(se){if(ie.detectFetchSupport()){var ae={credentials:se.withCredentials?"include":"same-origin"};return ie.FetchReadableStreamTransport(ae)}return oe.XhrTransport({withCredentials:se.withCredentials})}},210:function(K,te,ne){var ie,oe=this&&this.__extends||(ie=function(be,Ae){return(ie=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(ye,ve){ye.__proto__=ve}||function(ye,ve){for(var Be in ve)Object.prototype.hasOwnProperty.call(ve,Be)&&(ye[Be]=ve[Be])})(be,Ae)},function(be,Ae){function ye(){this.constructor=be}ie(be,Ae),be.prototype=Ae===null?Object.create(Ae):(ye.prototype=Ae.prototype,new ye)});Object.defineProperty(te,"__esModule",{value:!0}),te.stringToArrayBuffer=te.MozChunkedArrayBufferXHR=te.XHR=te.XhrTransport=void 0;var se=ne(65),ae=ne(346),ge=ne(849);te.XhrTransport=function(be){return function(Ae){if(ge.detectMozXHRSupport())return new de(Ae,be);if(ge.detectXHROverrideMimeTypeSupport())return new ce(Ae,be);throw new Error("This environment's XHR implementation cannot support binary transfer.")}};var ce=function(){function be(Ae,ye){this.options=Ae,this.init=ye}return be.prototype.onProgressEvent=function(){this.options.debug&&ae.debug("XHR.onProgressEvent.length: ",this.xhr.response.length);var Ae=this.xhr.response.substr(this.index);this.index=this.xhr.response.length;var ye=fe(Ae);this.options.onChunk(ye)},be.prototype.onLoadEvent=function(){this.options.debug&&ae.debug("XHR.onLoadEvent"),this.options.onEnd()},be.prototype.onStateChange=function(){this.options.debug&&ae.debug("XHR.onStateChange",this.xhr.readyState),this.xhr.readyState===XMLHttpRequest.HEADERS_RECEIVED&&this.options.onHeaders(new se.Metadata(this.xhr.getAllResponseHeaders()),this.xhr.status)},be.prototype.sendMessage=function(Ae){this.xhr.send(Ae)},be.prototype.finishSend=function(){},be.prototype.start=function(Ae){var ye=this;this.metadata=Ae;var ve=new XMLHttpRequest;this.xhr=ve,ve.open("POST",this.options.url),this.configureXhr(),this.metadata.forEach(function(Be,Re){ve.setRequestHeader(Be,Re.join(", "))}),ve.withCredentials=!!this.init.withCredentials,ve.addEventListener("readystatechange",this.onStateChange.bind(this)),ve.addEventListener("progress",this.onProgressEvent.bind(this)),ve.addEventListener("loadend",this.onLoadEvent.bind(this)),ve.addEventListener("error",function(Be){ye.options.debug&&ae.debug("XHR.error",Be),ye.options.onEnd(Be.error)})},be.prototype.configureXhr=function(){this.xhr.responseType="text",this.xhr.overrideMimeType("text/plain; charset=x-user-defined")},be.prototype.cancel=function(){this.options.debug&&ae.debug("XHR.abort"),this.xhr.abort()},be}();te.XHR=ce;var de=function(be){function Ae(){return be!==null&&be.apply(this,arguments)||this}return oe(Ae,be),Ae.prototype.configureXhr=function(){this.options.debug&&ae.debug("MozXHR.configureXhr: setting responseType to 'moz-chunked-arraybuffer'"),this.xhr.responseType="moz-chunked-arraybuffer"},Ae.prototype.onProgressEvent=function(){var ye=this.xhr.response;this.options.debug&&ae.debug("MozXHR.onProgressEvent: ",new Uint8Array(ye)),this.options.onChunk(new Uint8Array(ye))},Ae}(ce);function Ie(be,Ae){var ye=be.charCodeAt(Ae);if(ye>=55296&&ye<=56319){var ve=be.charCodeAt(Ae+1);ve>=56320&&ve<=57343&&(ye=65536+(ye-55296<<10)+(ve-56320))}return ye}function fe(be){for(var Ae=new Uint8Array(be.length),ye=0,ve=0;ve<be.length;ve++){var Be=String.prototype.codePointAt?be.codePointAt(ve):Ie(be,ve);Ae[ye++]=255&Be}return Ae}te.MozChunkedArrayBufferXHR=de,te.stringToArrayBuffer=fe},849:function(K,te){var ne;function ie(){if(ne!==void 0)return ne;if(XMLHttpRequest){ne=new XMLHttpRequest;try{ne.open("GET","https://localhost")}catch{}}return ne}function oe(se){var ae=ie();if(!ae)return!1;try{return ae.responseType=se,ae.responseType===se}catch{}return!1}Object.defineProperty(te,"__esModule",{value:!0}),te.detectXHROverrideMimeTypeSupport=te.detectMozXHRSupport=te.xhrSupportsResponseType=void 0,te.xhrSupportsResponseType=oe,te.detectMozXHRSupport=function(){return typeof XMLHttpRequest<"u"&&oe("moz-chunked-arraybuffer")},te.detectXHROverrideMimeTypeSupport=function(){return typeof XMLHttpRequest<"u"&&XMLHttpRequest.prototype.hasOwnProperty("overrideMimeType")}},540:function(K,te,ne){Object.defineProperty(te,"__esModule",{value:!0}),te.WebsocketTransport=void 0;var ie,oe=ne(346),se=ne(617);(function(ge){ge[ge.FINISH_SEND=1]="FINISH_SEND"})(ie||(ie={}));var ae=new Uint8Array([1]);te.WebsocketTransport=function(){return function(ge){return function(ce){ce.debug&&oe.debug("websocketRequest",ce);var de,Ie=function(Ae){if(Ae.substr(0,8)==="https://")return"wss://"+Ae.substr(8);if(Ae.substr(0,7)==="http://")return"ws://"+Ae.substr(7);throw new Error("Websocket transport constructed with non-https:// or http:// host.")}(ce.url),fe=[];function be(Ae){if(Ae===ie.FINISH_SEND)de.send(ae);else{var ye=Ae,ve=new Int8Array(ye.byteLength+1);ve.set(new Uint8Array([0])),ve.set(ye,1),de.send(ve)}}return{sendMessage:function(Ae){de&&de.readyState!==de.CONNECTING?be(Ae):fe.push(Ae)},finishSend:function(){de&&de.readyState!==de.CONNECTING?be(ie.FINISH_SEND):fe.push(ie.FINISH_SEND)},start:function(Ae){(de=new WebSocket(Ie,["grpc-websockets"])).binaryType="arraybuffer",de.onopen=function(){var ye;ce.debug&&oe.debug("websocketRequest.onopen"),de.send((ye="",Ae.forEach(function(ve,Be){ye+=ve+": "+Be.join(", ")+`\r
`}),se.encodeASCII(ye))),fe.forEach(function(ve){be(ve)})},de.onclose=function(ye){ce.debug&&oe.debug("websocketRequest.onclose",ye),ce.onEnd()},de.onerror=function(ye){ce.debug&&oe.debug("websocketRequest.onerror",ye)},de.onmessage=function(ye){ce.onChunk(new Uint8Array(ye.data))}},cancel:function(){ce.debug&&oe.debug("websocket.abort"),de.close()}}}(ge)}}},35:function(K,te,ne){Object.defineProperty(te,"__esModule",{value:!0}),te.unary=void 0;var ie=ne(65),oe=ne(934);te.unary=function(se,ae){if(se.responseStream)throw new Error(".unary cannot be used with server-streaming methods. Use .invoke or .client instead.");if(se.requestStream)throw new Error(".unary cannot be used with client-streaming methods. Use .client instead.");var ge=null,ce=null,de=oe.client(se,{host:ae.host,transport:ae.transport,debug:ae.debug});return de.onHeaders(function(Ie){ge=Ie}),de.onMessage(function(Ie){ce=Ie}),de.onEnd(function(Ie,fe,be){ae.onEnd({status:Ie,statusMessage:fe,headers:ge||new ie.Metadata,message:ce,trailers:be})}),de.start(ae.metadata),de.send(ae.request),de.finishSend(),{close:function(){de.close()}}}},882:function(K,te){Object.defineProperty(te,"__esModule",{value:!0}),te.frameRequest=void 0,te.frameRequest=function(ne){var ie=ne.serializeBinary(),oe=new ArrayBuffer(ie.byteLength+5);return new DataView(oe,1,4).setUint32(0,ie.length,!1),new Uint8Array(oe,5).set(ie),new Uint8Array(oe)}}},_={},function K(te){if(_[te])return _[te].exports;var ne=_[te]={exports:{}};return Z[te].call(ne.exports,ne,ne.exports,K),ne.exports}(607))},339:function(__unused_webpack_module,exports,__webpack_require__){var $jscomp=$jscomp||{};$jscomp.scope={},$jscomp.findInternal=function(X,Z,_){X instanceof String&&(X=String(X));for(var K=X.length,te=0;te<K;te++){var ne=X[te];if(Z.call(_,ne,te,X))return{i:te,v:ne}}return{i:-1,v:void 0}},$jscomp.ASSUME_ES5=!1,$jscomp.ASSUME_NO_NATIVE_MAP=!1,$jscomp.ASSUME_NO_NATIVE_SET=!1,$jscomp.SIMPLE_FROUND_POLYFILL=!1,$jscomp.defineProperty=$jscomp.ASSUME_ES5||typeof Object.defineProperties=="function"?Object.defineProperty:function(X,Z,_){X!=Array.prototype&&X!=Object.prototype&&(X[Z]=_.value)},$jscomp.getGlobal=function(X){return typeof window<"u"&&window===X?X:__webpack_require__.g!==void 0&&__webpack_require__.g!=null?__webpack_require__.g:X},$jscomp.global=$jscomp.getGlobal(this),$jscomp.polyfill=function(X,Z,_,K){if(Z){for(_=$jscomp.global,X=X.split("."),K=0;K<X.length-1;K++){var te=X[K];te in _||(_[te]={}),_=_[te]}(Z=Z(K=_[X=X[X.length-1]]))!=K&&Z!=null&&$jscomp.defineProperty(_,X,{configurable:!0,writable:!0,value:Z})}},$jscomp.polyfill("Array.prototype.findIndex",function(X){return X||function(Z,_){return $jscomp.findInternal(this,Z,_).i}},"es6","es3"),$jscomp.checkStringArgs=function(X,Z,_){if(X==null)throw new TypeError("The 'this' value for String.prototype."+_+" must not be null or undefined");if(Z instanceof RegExp)throw new TypeError("First argument to String.prototype."+_+" must not be a regular expression");return X+""},$jscomp.polyfill("String.prototype.endsWith",function(X){return X||function(Z,_){var K=$jscomp.checkStringArgs(this,Z,"endsWith");Z+="",_===void 0&&(_=K.length),_=Math.max(0,Math.min(0|_,K.length));for(var te=Z.length;0<te&&0<_;)if(K[--_]!=Z[--te])return!1;return 0>=te}},"es6","es3"),$jscomp.polyfill("Array.prototype.find",function(X){return X||function(Z,_){return $jscomp.findInternal(this,Z,_).v}},"es6","es3"),$jscomp.polyfill("String.prototype.startsWith",function(X){return X||function(Z,_){var K=$jscomp.checkStringArgs(this,Z,"startsWith");Z+="";var te=K.length,ne=Z.length;_=Math.max(0,Math.min(0|_,K.length));for(var ie=0;ie<ne&&_<te;)if(K[_++]!=Z[ie++])return!1;return ie>=ne}},"es6","es3"),$jscomp.polyfill("String.prototype.repeat",function(X){return X||function(Z){var _=$jscomp.checkStringArgs(this,null,"repeat");if(0>Z||1342177279<Z)throw new RangeError("Invalid count value");Z|=0;for(var K="";Z;)1&Z&&(K+=_),(Z>>>=1)&&(_+=_);return K}},"es6","es3");var goog=goog||{};goog.global=this||self,goog.exportPath_=function(X,Z,_){X=X.split("."),_=_||goog.global,X[0]in _||_.execScript===void 0||_.execScript("var "+X[0]);for(var K;X.length&&(K=X.shift());)X.length||Z===void 0?_=_[K]&&_[K]!==Object.prototype[K]?_[K]:_[K]={}:_[K]=Z},goog.define=function(X,Z){return Z},goog.FEATURESET_YEAR=2012,goog.DEBUG=!0,goog.LOCALE="en",goog.TRUSTED_SITE=!0,goog.STRICT_MODE_COMPATIBLE=!1,goog.DISALLOW_TEST_ONLY_CODE=!goog.DEBUG,goog.ENABLE_CHROME_APP_SAFE_SCRIPT_LOADING=!1,goog.provide=function(X){if(goog.isInModuleLoader_())throw Error("goog.provide cannot be used within a module.");goog.constructNamespace_(X)},goog.constructNamespace_=function(X,Z){goog.exportPath_(X,Z)},goog.getScriptNonce=function(X){return X&&X!=goog.global?goog.getScriptNonce_(X.document):(goog.cspNonce_===null&&(goog.cspNonce_=goog.getScriptNonce_(goog.global.document)),goog.cspNonce_)},goog.NONCE_PATTERN_=/^[\w+/_-]+[=]{0,2}$/,goog.cspNonce_=null,goog.getScriptNonce_=function(X){return(X=X.querySelector&&X.querySelector("script[nonce]"))&&(X=X.nonce||X.getAttribute("nonce"))&&goog.NONCE_PATTERN_.test(X)?X:""},goog.VALID_MODULE_RE_=/^[a-zA-Z_$][a-zA-Z0-9._$]*$/,goog.module=function(X){if(typeof X!="string"||!X||X.search(goog.VALID_MODULE_RE_)==-1)throw Error("Invalid module identifier");if(!goog.isInGoogModuleLoader_())throw Error("Module "+X+" has been loaded incorrectly. Note, modules cannot be loaded as normal scripts. They require some kind of pre-processing step. You're likely trying to load a module via a script tag or as a part of a concatenated bundle without rewriting the module. For more info see: https://github.com/google/closure-library/wiki/goog.module:-an-ES6-module-like-alternative-to-goog.provide.");if(goog.moduleLoaderState_.moduleName)throw Error("goog.module may only be called once per module.");goog.moduleLoaderState_.moduleName=X},goog.module.get=function(X){return goog.module.getInternal_(X)},goog.module.getInternal_=function(X){return null},goog.ModuleType={ES6:"es6",GOOG:"goog"},goog.moduleLoaderState_=null,goog.isInModuleLoader_=function(){return goog.isInGoogModuleLoader_()||goog.isInEs6ModuleLoader_()},goog.isInGoogModuleLoader_=function(){return!!goog.moduleLoaderState_&&goog.moduleLoaderState_.type==goog.ModuleType.GOOG},goog.isInEs6ModuleLoader_=function(){if(goog.moduleLoaderState_&&goog.moduleLoaderState_.type==goog.ModuleType.ES6)return!0;var X=goog.global.$jscomp;return!!X&&typeof X.getCurrentModulePath=="function"&&!!X.getCurrentModulePath()},goog.module.declareLegacyNamespace=function(){goog.moduleLoaderState_.declareLegacyNamespace=!0},goog.declareModuleId=function(X){if(goog.moduleLoaderState_)goog.moduleLoaderState_.moduleName=X;else{var Z=goog.global.$jscomp;if(!Z||typeof Z.getCurrentModulePath!="function")throw Error('Module with namespace "'+X+'" has been loaded incorrectly.');Z=Z.require(Z.getCurrentModulePath()),goog.loadedModules_[X]={exports:Z,type:goog.ModuleType.ES6,moduleId:X}}},goog.setTestOnly=function(X){if(goog.DISALLOW_TEST_ONLY_CODE)throw X=X||"",Error("Importing test-only code into non-debug environment"+(X?": "+X:"."))},goog.forwardDeclare=function(X){},goog.getObjectByName=function(X,Z){X=X.split("."),Z=Z||goog.global;for(var _=0;_<X.length;_++)if((Z=Z[X[_]])==null)return null;return Z},goog.globalize=function(X,Z){for(var _ in Z=Z||goog.global,X)Z[_]=X[_]},goog.addDependency=function(X,Z,_,K){},goog.ENABLE_DEBUG_LOADER=!0,goog.logToConsole_=function(X){goog.global.console&&goog.global.console.error(X)},goog.require=function(X){},goog.requireType=function(X){return{}},goog.basePath="",goog.nullFunction=function(){},goog.abstractMethod=function(){throw Error("unimplemented abstract method")},goog.addSingletonGetter=function(X){X.instance_=void 0,X.getInstance=function(){return X.instance_?X.instance_:(goog.DEBUG&&(goog.instantiatedSingletons_[goog.instantiatedSingletons_.length]=X),X.instance_=new X)}},goog.instantiatedSingletons_=[],goog.LOAD_MODULE_USING_EVAL=!0,goog.SEAL_MODULE_EXPORTS=goog.DEBUG,goog.loadedModules_={},goog.DEPENDENCIES_ENABLED=!1,goog.TRANSPILE="detect",goog.ASSUME_ES_MODULES_TRANSPILED=!1,goog.TRANSPILE_TO_LANGUAGE="",goog.TRANSPILER="transpile.js",goog.hasBadLetScoping=null,goog.useSafari10Workaround=function(){if(goog.hasBadLetScoping==null){try{var a=!eval('"use strict";let x = 1; function f() { return typeof x; };f() == "number";')}catch(X){a=!1}goog.hasBadLetScoping=a}return goog.hasBadLetScoping},goog.workaroundSafari10EvalBug=function(X){return"(function(){"+X+`
;})();
`},goog.loadModule=function(X){var Z=goog.moduleLoaderState_;try{if(goog.moduleLoaderState_={moduleName:"",declareLegacyNamespace:!1,type:goog.ModuleType.GOOG},goog.isFunction(X))var _=X.call(void 0,{});else{if(typeof X!="string")throw Error("Invalid module definition");goog.useSafari10Workaround()&&(X=goog.workaroundSafari10EvalBug(X)),_=goog.loadModuleFromSource_.call(void 0,X)}var K=goog.moduleLoaderState_.moduleName;if(typeof K!="string"||!K)throw Error('Invalid module name "'+K+'"');goog.moduleLoaderState_.declareLegacyNamespace?goog.constructNamespace_(K,_):goog.SEAL_MODULE_EXPORTS&&Object.seal&&typeof _=="object"&&_!=null&&Object.seal(_),goog.loadedModules_[K]={exports:_,type:goog.ModuleType.GOOG,moduleId:goog.moduleLoaderState_.moduleName}}finally{goog.moduleLoaderState_=Z}},goog.loadModuleFromSource_=function(a){return eval(a),{}},goog.normalizePath_=function(X){X=X.split("/");for(var Z=0;Z<X.length;)X[Z]=="."?X.splice(Z,1):Z&&X[Z]==".."&&X[Z-1]&&X[Z-1]!=".."?X.splice(--Z,2):Z++;return X.join("/")},goog.loadFileSync_=function(X){if(goog.global.CLOSURE_LOAD_FILE_SYNC)return goog.global.CLOSURE_LOAD_FILE_SYNC(X);try{var Z=new goog.global.XMLHttpRequest;return Z.open("get",X,!1),Z.send(),Z.status==0||Z.status==200?Z.responseText:null}catch{return null}},goog.transpile_=function(X,Z,_){var K=goog.global.$jscomp;K||(goog.global.$jscomp=K={});var te=K.transpile;if(!te){var ne=goog.basePath+goog.TRANSPILER,ie=goog.loadFileSync_(ne);if(ie){if((function(){(0,eval)(ie+`
//# sourceURL=`+ne)}).call(goog.global),goog.global.$gwtExport&&goog.global.$gwtExport.$jscomp&&!goog.global.$gwtExport.$jscomp.transpile)throw Error('The transpiler did not properly export the "transpile" method. $gwtExport: '+JSON.stringify(goog.global.$gwtExport));goog.global.$jscomp.transpile=goog.global.$gwtExport.$jscomp.transpile,te=(K=goog.global.$jscomp).transpile}}return te||(te=K.transpile=function(oe,se){return goog.logToConsole_(se+" requires transpilation but no transpiler was found."),oe}),te(X,Z,_)},goog.typeOf=function(X){var Z=typeof X;if(Z=="object"){if(!X)return"null";if(X instanceof Array)return"array";if(X instanceof Object)return Z;var _=Object.prototype.toString.call(X);if(_=="[object Window]")return"object";if(_=="[object Array]"||typeof X.length=="number"&&X.splice!==void 0&&X.propertyIsEnumerable!==void 0&&!X.propertyIsEnumerable("splice"))return"array";if(_=="[object Function]"||X.call!==void 0&&X.propertyIsEnumerable!==void 0&&!X.propertyIsEnumerable("call"))return"function"}else if(Z=="function"&&X.call===void 0)return"object";return Z},goog.isArray=function(X){return goog.typeOf(X)=="array"},goog.isArrayLike=function(X){var Z=goog.typeOf(X);return Z=="array"||Z=="object"&&typeof X.length=="number"},goog.isDateLike=function(X){return goog.isObject(X)&&typeof X.getFullYear=="function"},goog.isFunction=function(X){return goog.typeOf(X)=="function"},goog.isObject=function(X){var Z=typeof X;return Z=="object"&&X!=null||Z=="function"},goog.getUid=function(X){return Object.prototype.hasOwnProperty.call(X,goog.UID_PROPERTY_)&&X[goog.UID_PROPERTY_]||(X[goog.UID_PROPERTY_]=++goog.uidCounter_)},goog.hasUid=function(X){return!!X[goog.UID_PROPERTY_]},goog.removeUid=function(X){X!==null&&"removeAttribute"in X&&X.removeAttribute(goog.UID_PROPERTY_);try{delete X[goog.UID_PROPERTY_]}catch{}},goog.UID_PROPERTY_="closure_uid_"+(1e9*Math.random()>>>0),goog.uidCounter_=0,goog.getHashCode=goog.getUid,goog.removeHashCode=goog.removeUid,goog.cloneObject=function(X){var Z=goog.typeOf(X);if(Z=="object"||Z=="array"){if(typeof X.clone=="function")return X.clone();for(var _ in Z=Z=="array"?[]:{},X)Z[_]=goog.cloneObject(X[_]);return Z}return X},goog.bindNative_=function(X,Z,_){return X.call.apply(X.bind,arguments)},goog.bindJs_=function(X,Z,_){if(!X)throw Error();if(2<arguments.length){var K=Array.prototype.slice.call(arguments,2);return function(){var te=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(te,K),X.apply(Z,te)}}return function(){return X.apply(Z,arguments)}},goog.bind=function(X,Z,_){return Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?goog.bind=goog.bindNative_:goog.bind=goog.bindJs_,goog.bind.apply(null,arguments)},goog.partial=function(X,Z){var _=Array.prototype.slice.call(arguments,1);return function(){var K=_.slice();return K.push.apply(K,arguments),X.apply(this,K)}},goog.mixin=function(X,Z){for(var _ in Z)X[_]=Z[_]},goog.now=goog.TRUSTED_SITE&&Date.now||function(){return+new Date},goog.globalEval=function(X){if(goog.global.execScript)goog.global.execScript(X,"JavaScript");else{if(!goog.global.eval)throw Error("goog.globalEval not available");if(goog.evalWorksForGlobals_==null){try{goog.global.eval("var _evalTest_ = 1;")}catch{}if(goog.global._evalTest_!==void 0){try{delete goog.global._evalTest_}catch{}goog.evalWorksForGlobals_=!0}else goog.evalWorksForGlobals_=!1}if(goog.evalWorksForGlobals_)goog.global.eval(X);else{var Z=goog.global.document,_=Z.createElement("script");_.type="text/javascript",_.defer=!1,_.appendChild(Z.createTextNode(X)),Z.head.appendChild(_),Z.head.removeChild(_)}}},goog.evalWorksForGlobals_=null,goog.getCssName=function(X,Z){if(String(X).charAt(0)==".")throw Error('className passed in goog.getCssName must not start with ".". You passed: '+X);var _=function(te){return goog.cssNameMapping_[te]||te},K=function(te){te=te.split("-");for(var ne=[],ie=0;ie<te.length;ie++)ne.push(_(te[ie]));return ne.join("-")};return K=goog.cssNameMapping_?goog.cssNameMappingStyle_=="BY_WHOLE"?_:K:function(te){return te},X=Z?X+"-"+K(Z):K(X),goog.global.CLOSURE_CSS_NAME_MAP_FN?goog.global.CLOSURE_CSS_NAME_MAP_FN(X):X},goog.setCssNameMapping=function(X,Z){goog.cssNameMapping_=X,goog.cssNameMappingStyle_=Z},goog.getMsg=function(X,Z,_){return _&&_.html&&(X=X.replace(/</g,"&lt;")),Z&&(X=X.replace(/\{\$([^}]+)}/g,function(K,te){return Z!=null&&te in Z?Z[te]:K})),X},goog.getMsgWithFallback=function(X,Z){return X},goog.exportSymbol=function(X,Z,_){goog.exportPath_(X,Z,_)},goog.exportProperty=function(X,Z,_){X[Z]=_},goog.inherits=function(X,Z){function _(){}_.prototype=Z.prototype,X.superClass_=Z.prototype,X.prototype=new _,X.prototype.constructor=X,X.base=function(K,te,ne){for(var ie=Array(arguments.length-2),oe=2;oe<arguments.length;oe++)ie[oe-2]=arguments[oe];return Z.prototype[te].apply(K,ie)}},goog.scope=function(X){if(goog.isInModuleLoader_())throw Error("goog.scope is not supported within a module.");X.call(goog.global)},goog.defineClass=function(X,Z){var _=Z.constructor,K=Z.statics;return _&&_!=Object.prototype.constructor||(_=function(){throw Error("cannot instantiate an interface (no constructor defined).")}),_=goog.defineClass.createSealingConstructor_(_,X),X&&goog.inherits(_,X),delete Z.constructor,delete Z.statics,goog.defineClass.applyProperties_(_.prototype,Z),K!=null&&(K instanceof Function?K(_):goog.defineClass.applyProperties_(_,K)),_},goog.defineClass.SEAL_CLASS_INSTANCES=goog.DEBUG,goog.defineClass.createSealingConstructor_=function(X,Z){if(!goog.defineClass.SEAL_CLASS_INSTANCES)return X;var _=!goog.defineClass.isUnsealable_(Z),K=function(){var te=X.apply(this,arguments)||this;return te[goog.UID_PROPERTY_]=te[goog.UID_PROPERTY_],this.constructor===K&&_&&Object.seal instanceof Function&&Object.seal(te),te};return K},goog.defineClass.isUnsealable_=function(X){return X&&X.prototype&&X.prototype[goog.UNSEALABLE_CONSTRUCTOR_PROPERTY_]},goog.defineClass.OBJECT_PROTOTYPE_FIELDS_="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" "),goog.defineClass.applyProperties_=function(X,Z){for(var _ in Z)Object.prototype.hasOwnProperty.call(Z,_)&&(X[_]=Z[_]);for(var K=0;K<goog.defineClass.OBJECT_PROTOTYPE_FIELDS_.length;K++)_=goog.defineClass.OBJECT_PROTOTYPE_FIELDS_[K],Object.prototype.hasOwnProperty.call(Z,_)&&(X[_]=Z[_])},goog.tagUnsealableClass=function(X){},goog.UNSEALABLE_CONSTRUCTOR_PROPERTY_="goog_defineClass_legacy_unsealable",goog.TRUSTED_TYPES_POLICY_NAME="",goog.identity_=function(X){return X},goog.createTrustedTypesPolicy=function(X){var Z=null,_=goog.global.trustedTypes||goog.global.TrustedTypes;if(!_||!_.createPolicy)return Z;try{Z=_.createPolicy(X,{createHTML:goog.identity_,createScript:goog.identity_,createScriptURL:goog.identity_,createURL:goog.identity_})}catch(K){goog.logToConsole_(K.message)}return Z},goog.TRUSTED_TYPES_POLICY_=goog.TRUSTED_TYPES_POLICY_NAME?goog.createTrustedTypesPolicy(goog.TRUSTED_TYPES_POLICY_NAME+"#base"):null,goog.object={},goog.object.is=function(X,Z){return X===Z?X!==0||1/X==1/Z:X!=X&&Z!=Z},goog.object.forEach=function(X,Z,_){for(var K in X)Z.call(_,X[K],K,X)},goog.object.filter=function(X,Z,_){var K,te={};for(K in X)Z.call(_,X[K],K,X)&&(te[K]=X[K]);return te},goog.object.map=function(X,Z,_){var K,te={};for(K in X)te[K]=Z.call(_,X[K],K,X);return te},goog.object.some=function(X,Z,_){for(var K in X)if(Z.call(_,X[K],K,X))return!0;return!1},goog.object.every=function(X,Z,_){for(var K in X)if(!Z.call(_,X[K],K,X))return!1;return!0},goog.object.getCount=function(X){var Z,_=0;for(Z in X)_++;return _},goog.object.getAnyKey=function(X){for(var Z in X)return Z},goog.object.getAnyValue=function(X){for(var Z in X)return X[Z]},goog.object.contains=function(X,Z){return goog.object.containsValue(X,Z)},goog.object.getValues=function(X){var Z,_=[],K=0;for(Z in X)_[K++]=X[Z];return _},goog.object.getKeys=function(X){var Z,_=[],K=0;for(Z in X)_[K++]=Z;return _},goog.object.getValueByKeys=function(X,Z){var _=goog.isArrayLike(Z),K=_?Z:arguments;for(_=_?0:1;_<K.length;_++){if(X==null)return;X=X[K[_]]}return X},goog.object.containsKey=function(X,Z){return X!==null&&Z in X},goog.object.containsValue=function(X,Z){for(var _ in X)if(X[_]==Z)return!0;return!1},goog.object.findKey=function(X,Z,_){for(var K in X)if(Z.call(_,X[K],K,X))return K},goog.object.findValue=function(X,Z,_){return(Z=goog.object.findKey(X,Z,_))&&X[Z]},goog.object.isEmpty=function(X){for(var Z in X)return!1;return!0},goog.object.clear=function(X){for(var Z in X)delete X[Z]},goog.object.remove=function(X,Z){var _;return(_=Z in X)&&delete X[Z],_},goog.object.add=function(X,Z,_){if(X!==null&&Z in X)throw Error('The object already contains the key "'+Z+'"');goog.object.set(X,Z,_)},goog.object.get=function(X,Z,_){return X!==null&&Z in X?X[Z]:_},goog.object.set=function(X,Z,_){X[Z]=_},goog.object.setIfUndefined=function(X,Z,_){return Z in X?X[Z]:X[Z]=_},goog.object.setWithReturnValueIfNotSet=function(X,Z,_){return Z in X?X[Z]:(_=_(),X[Z]=_)},goog.object.equals=function(X,Z){for(var _ in X)if(!(_ in Z)||X[_]!==Z[_])return!1;for(var K in Z)if(!(K in X))return!1;return!0},goog.object.clone=function(X){var Z,_={};for(Z in X)_[Z]=X[Z];return _},goog.object.unsafeClone=function(X){var Z=goog.typeOf(X);if(Z=="object"||Z=="array"){if(goog.isFunction(X.clone))return X.clone();for(var _ in Z=Z=="array"?[]:{},X)Z[_]=goog.object.unsafeClone(X[_]);return Z}return X},goog.object.transpose=function(X){var Z,_={};for(Z in X)_[X[Z]]=Z;return _},goog.object.PROTOTYPE_FIELDS_="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" "),goog.object.extend=function(X,Z){for(var _,K,te=1;te<arguments.length;te++){for(_ in K=arguments[te])X[_]=K[_];for(var ne=0;ne<goog.object.PROTOTYPE_FIELDS_.length;ne++)_=goog.object.PROTOTYPE_FIELDS_[ne],Object.prototype.hasOwnProperty.call(K,_)&&(X[_]=K[_])}},goog.object.create=function(X){var Z=arguments.length;if(Z==1&&Array.isArray(arguments[0]))return goog.object.create.apply(null,arguments[0]);if(Z%2)throw Error("Uneven number of arguments");for(var _={},K=0;K<Z;K+=2)_[arguments[K]]=arguments[K+1];return _},goog.object.createSet=function(X){var Z=arguments.length;if(Z==1&&Array.isArray(arguments[0]))return goog.object.createSet.apply(null,arguments[0]);for(var _={},K=0;K<Z;K++)_[arguments[K]]=!0;return _},goog.object.createImmutableView=function(X){var Z=X;return Object.isFrozen&&!Object.isFrozen(X)&&(Z=Object.create(X),Object.freeze(Z)),Z},goog.object.isImmutableView=function(X){return!!Object.isFrozen&&Object.isFrozen(X)},goog.object.getAllPropertyNames=function(X,Z,_){if(!X)return[];if(!Object.getOwnPropertyNames||!Object.getPrototypeOf)return goog.object.getKeys(X);for(var K={};X&&(X!==Object.prototype||Z)&&(X!==Function.prototype||_);){for(var te=Object.getOwnPropertyNames(X),ne=0;ne<te.length;ne++)K[te[ne]]=!0;X=Object.getPrototypeOf(X)}return goog.object.getKeys(K)},goog.object.getSuperClass=function(X){return(X=Object.getPrototypeOf(X.prototype))&&X.constructor};var jspb={asserts:{}};jspb.asserts.doAssertFailure=function(X,Z,_,K){var te="Assertion failed";if(_){te+=": "+_;var ne=K}else X&&(te+=": "+X,ne=Z);throw Error(""+te,ne||[])},jspb.asserts.assert=function(X,Z,_){for(var K=[],te=2;te<arguments.length;++te)K[te-2]=arguments[te];return X||jspb.asserts.doAssertFailure("",null,Z,K),X},jspb.asserts.assertString=function(X,Z,_){for(var K=[],te=2;te<arguments.length;++te)K[te-2]=arguments[te];return typeof X!="string"&&jspb.asserts.doAssertFailure("Expected string but got %s: %s.",[goog.typeOf(X),X],Z,K),X},jspb.asserts.assertArray=function(X,Z,_){for(var K=[],te=2;te<arguments.length;++te)K[te-2]=arguments[te];return Array.isArray(X)||jspb.asserts.doAssertFailure("Expected array but got %s: %s.",[goog.typeOf(X),X],Z,K),X},jspb.asserts.fail=function(X,Z){for(var _=[],K=1;K<arguments.length;++K)_[K-1]=arguments[K];throw Error("Failure"+(X?": "+X:""),_)},jspb.asserts.assertInstanceof=function(X,Z,_,K){for(var te=[],ne=3;ne<arguments.length;++ne)te[ne-3]=arguments[ne];return X instanceof Z||jspb.asserts.doAssertFailure("Expected instanceof %s but got %s.",[jspb.asserts.getType(Z),jspb.asserts.getType(X)],_,te),X},jspb.asserts.getType=function(X){return X instanceof Function?X.displayName||X.name||"unknown type name":X instanceof Object?X.constructor.displayName||X.constructor.name||Object.prototype.toString.call(X):X===null?"null":typeof X},jspb.BinaryConstants={},jspb.ConstBinaryMessage=function(){},jspb.BinaryMessage=function(){},jspb.BinaryConstants.FieldType={INVALID:-1,DOUBLE:1,FLOAT:2,INT64:3,UINT64:4,INT32:5,FIXED64:6,FIXED32:7,BOOL:8,STRING:9,GROUP:10,MESSAGE:11,BYTES:12,UINT32:13,ENUM:14,SFIXED32:15,SFIXED64:16,SINT32:17,SINT64:18,FHASH64:30,VHASH64:31},jspb.BinaryConstants.WireType={INVALID:-1,VARINT:0,FIXED64:1,DELIMITED:2,START_GROUP:3,END_GROUP:4,FIXED32:5},jspb.BinaryConstants.FieldTypeToWireType=function(X){var Z=jspb.BinaryConstants.FieldType,_=jspb.BinaryConstants.WireType;switch(X){case Z.INT32:case Z.INT64:case Z.UINT32:case Z.UINT64:case Z.SINT32:case Z.SINT64:case Z.BOOL:case Z.ENUM:case Z.VHASH64:return _.VARINT;case Z.DOUBLE:case Z.FIXED64:case Z.SFIXED64:case Z.FHASH64:return _.FIXED64;case Z.STRING:case Z.MESSAGE:case Z.BYTES:return _.DELIMITED;case Z.FLOAT:case Z.FIXED32:case Z.SFIXED32:return _.FIXED32;default:return _.INVALID}},jspb.BinaryConstants.INVALID_FIELD_NUMBER=-1,jspb.BinaryConstants.FLOAT32_EPS=1401298464324817e-60,jspb.BinaryConstants.FLOAT32_MIN=11754943508222875e-54,jspb.BinaryConstants.FLOAT32_MAX=34028234663852886e22,jspb.BinaryConstants.FLOAT64_EPS=5e-324,jspb.BinaryConstants.FLOAT64_MIN=22250738585072014e-324,jspb.BinaryConstants.FLOAT64_MAX=17976931348623157e292,jspb.BinaryConstants.TWO_TO_20=1048576,jspb.BinaryConstants.TWO_TO_23=8388608,jspb.BinaryConstants.TWO_TO_31=2147483648,jspb.BinaryConstants.TWO_TO_32=4294967296,jspb.BinaryConstants.TWO_TO_52=4503599627370496,jspb.BinaryConstants.TWO_TO_63=9223372036854776e3,jspb.BinaryConstants.TWO_TO_64=18446744073709552e3,jspb.BinaryConstants.ZERO_HASH="\0\0\0\0\0\0\0\0",goog.debug={},goog.debug.Error=function(X){if(Error.captureStackTrace)Error.captureStackTrace(this,goog.debug.Error);else{var Z=Error().stack;Z&&(this.stack=Z)}X&&(this.message=String(X)),this.reportErrorToServer=!0},goog.inherits(goog.debug.Error,Error),goog.debug.Error.prototype.name="CustomError",goog.dom={},goog.dom.NodeType={ELEMENT:1,ATTRIBUTE:2,TEXT:3,CDATA_SECTION:4,ENTITY_REFERENCE:5,ENTITY:6,PROCESSING_INSTRUCTION:7,COMMENT:8,DOCUMENT:9,DOCUMENT_TYPE:10,DOCUMENT_FRAGMENT:11,NOTATION:12},goog.asserts={},goog.asserts.ENABLE_ASSERTS=goog.DEBUG,goog.asserts.AssertionError=function(X,Z){goog.debug.Error.call(this,goog.asserts.subs_(X,Z)),this.messagePattern=X},goog.inherits(goog.asserts.AssertionError,goog.debug.Error),goog.asserts.AssertionError.prototype.name="AssertionError",goog.asserts.DEFAULT_ERROR_HANDLER=function(X){throw X},goog.asserts.errorHandler_=goog.asserts.DEFAULT_ERROR_HANDLER,goog.asserts.subs_=function(X,Z){for(var _="",K=(X=X.split("%s")).length-1,te=0;te<K;te++)_+=X[te]+(te<Z.length?Z[te]:"%s");return _+X[K]},goog.asserts.doAssertFailure_=function(X,Z,_,K){var te="Assertion failed";if(_){te+=": "+_;var ne=K}else X&&(te+=": "+X,ne=Z);X=new goog.asserts.AssertionError(""+te,ne||[]),goog.asserts.errorHandler_(X)},goog.asserts.setErrorHandler=function(X){goog.asserts.ENABLE_ASSERTS&&(goog.asserts.errorHandler_=X)},goog.asserts.assert=function(X,Z,_){return goog.asserts.ENABLE_ASSERTS&&!X&&goog.asserts.doAssertFailure_("",null,Z,Array.prototype.slice.call(arguments,2)),X},goog.asserts.assertExists=function(X,Z,_){return goog.asserts.ENABLE_ASSERTS&&X==null&&goog.asserts.doAssertFailure_("Expected to exist: %s.",[X],Z,Array.prototype.slice.call(arguments,2)),X},goog.asserts.fail=function(X,Z){goog.asserts.ENABLE_ASSERTS&&goog.asserts.errorHandler_(new goog.asserts.AssertionError("Failure"+(X?": "+X:""),Array.prototype.slice.call(arguments,1)))},goog.asserts.assertNumber=function(X,Z,_){return goog.asserts.ENABLE_ASSERTS&&typeof X!="number"&&goog.asserts.doAssertFailure_("Expected number but got %s: %s.",[goog.typeOf(X),X],Z,Array.prototype.slice.call(arguments,2)),X},goog.asserts.assertString=function(X,Z,_){return goog.asserts.ENABLE_ASSERTS&&typeof X!="string"&&goog.asserts.doAssertFailure_("Expected string but got %s: %s.",[goog.typeOf(X),X],Z,Array.prototype.slice.call(arguments,2)),X},goog.asserts.assertFunction=function(X,Z,_){return goog.asserts.ENABLE_ASSERTS&&!goog.isFunction(X)&&goog.asserts.doAssertFailure_("Expected function but got %s: %s.",[goog.typeOf(X),X],Z,Array.prototype.slice.call(arguments,2)),X},goog.asserts.assertObject=function(X,Z,_){return goog.asserts.ENABLE_ASSERTS&&!goog.isObject(X)&&goog.asserts.doAssertFailure_("Expected object but got %s: %s.",[goog.typeOf(X),X],Z,Array.prototype.slice.call(arguments,2)),X},goog.asserts.assertArray=function(X,Z,_){return goog.asserts.ENABLE_ASSERTS&&!Array.isArray(X)&&goog.asserts.doAssertFailure_("Expected array but got %s: %s.",[goog.typeOf(X),X],Z,Array.prototype.slice.call(arguments,2)),X},goog.asserts.assertBoolean=function(X,Z,_){return goog.asserts.ENABLE_ASSERTS&&typeof X!="boolean"&&goog.asserts.doAssertFailure_("Expected boolean but got %s: %s.",[goog.typeOf(X),X],Z,Array.prototype.slice.call(arguments,2)),X},goog.asserts.assertElement=function(X,Z,_){return!goog.asserts.ENABLE_ASSERTS||goog.isObject(X)&&X.nodeType==goog.dom.NodeType.ELEMENT||goog.asserts.doAssertFailure_("Expected Element but got %s: %s.",[goog.typeOf(X),X],Z,Array.prototype.slice.call(arguments,2)),X},goog.asserts.assertInstanceof=function(X,Z,_,K){return!goog.asserts.ENABLE_ASSERTS||X instanceof Z||goog.asserts.doAssertFailure_("Expected instanceof %s but got %s.",[goog.asserts.getType_(Z),goog.asserts.getType_(X)],_,Array.prototype.slice.call(arguments,3)),X},goog.asserts.assertFinite=function(X,Z,_){return!goog.asserts.ENABLE_ASSERTS||typeof X=="number"&&isFinite(X)||goog.asserts.doAssertFailure_("Expected %s to be a finite number but it is not.",[X],Z,Array.prototype.slice.call(arguments,2)),X},goog.asserts.assertObjectPrototypeIsIntact=function(){for(var X in Object.prototype)goog.asserts.fail(X+" should not be enumerable in Object.prototype.")},goog.asserts.getType_=function(X){return X instanceof Function?X.displayName||X.name||"unknown type name":X instanceof Object?X.constructor.displayName||X.constructor.name||Object.prototype.toString.call(X):X===null?"null":typeof X},goog.array={},goog.NATIVE_ARRAY_PROTOTYPES=goog.TRUSTED_SITE,goog.array.ASSUME_NATIVE_FUNCTIONS=2012<goog.FEATURESET_YEAR,goog.array.peek=function(X){return X[X.length-1]},goog.array.last=goog.array.peek,goog.array.indexOf=goog.NATIVE_ARRAY_PROTOTYPES&&(goog.array.ASSUME_NATIVE_FUNCTIONS||Array.prototype.indexOf)?function(X,Z,_){return goog.asserts.assert(X.length!=null),Array.prototype.indexOf.call(X,Z,_)}:function(X,Z,_){if(_=_==null?0:0>_?Math.max(0,X.length+_):_,typeof X=="string")return typeof Z!="string"||Z.length!=1?-1:X.indexOf(Z,_);for(;_<X.length;_++)if(_ in X&&X[_]===Z)return _;return-1},goog.array.lastIndexOf=goog.NATIVE_ARRAY_PROTOTYPES&&(goog.array.ASSUME_NATIVE_FUNCTIONS||Array.prototype.lastIndexOf)?function(X,Z,_){return goog.asserts.assert(X.length!=null),Array.prototype.lastIndexOf.call(X,Z,_??X.length-1)}:function(X,Z,_){if(0>(_=_??X.length-1)&&(_=Math.max(0,X.length+_)),typeof X=="string")return typeof Z!="string"||Z.length!=1?-1:X.lastIndexOf(Z,_);for(;0<=_;_--)if(_ in X&&X[_]===Z)return _;return-1},goog.array.forEach=goog.NATIVE_ARRAY_PROTOTYPES&&(goog.array.ASSUME_NATIVE_FUNCTIONS||Array.prototype.forEach)?function(X,Z,_){goog.asserts.assert(X.length!=null),Array.prototype.forEach.call(X,Z,_)}:function(X,Z,_){for(var K=X.length,te=typeof X=="string"?X.split(""):X,ne=0;ne<K;ne++)ne in te&&Z.call(_,te[ne],ne,X)},goog.array.forEachRight=function(X,Z,_){var K=X.length,te=typeof X=="string"?X.split(""):X;for(--K;0<=K;--K)K in te&&Z.call(_,te[K],K,X)},goog.array.filter=goog.NATIVE_ARRAY_PROTOTYPES&&(goog.array.ASSUME_NATIVE_FUNCTIONS||Array.prototype.filter)?function(X,Z,_){return goog.asserts.assert(X.length!=null),Array.prototype.filter.call(X,Z,_)}:function(X,Z,_){for(var K=X.length,te=[],ne=0,ie=typeof X=="string"?X.split(""):X,oe=0;oe<K;oe++)if(oe in ie){var se=ie[oe];Z.call(_,se,oe,X)&&(te[ne++]=se)}return te},goog.array.map=goog.NATIVE_ARRAY_PROTOTYPES&&(goog.array.ASSUME_NATIVE_FUNCTIONS||Array.prototype.map)?function(X,Z,_){return goog.asserts.assert(X.length!=null),Array.prototype.map.call(X,Z,_)}:function(X,Z,_){for(var K=X.length,te=Array(K),ne=typeof X=="string"?X.split(""):X,ie=0;ie<K;ie++)ie in ne&&(te[ie]=Z.call(_,ne[ie],ie,X));return te},goog.array.reduce=goog.NATIVE_ARRAY_PROTOTYPES&&(goog.array.ASSUME_NATIVE_FUNCTIONS||Array.prototype.reduce)?function(X,Z,_,K){return goog.asserts.assert(X.length!=null),K&&(Z=goog.bind(Z,K)),Array.prototype.reduce.call(X,Z,_)}:function(X,Z,_,K){var te=_;return goog.array.forEach(X,function(ne,ie){te=Z.call(K,te,ne,ie,X)}),te},goog.array.reduceRight=goog.NATIVE_ARRAY_PROTOTYPES&&(goog.array.ASSUME_NATIVE_FUNCTIONS||Array.prototype.reduceRight)?function(X,Z,_,K){return goog.asserts.assert(X.length!=null),goog.asserts.assert(Z!=null),K&&(Z=goog.bind(Z,K)),Array.prototype.reduceRight.call(X,Z,_)}:function(X,Z,_,K){var te=_;return goog.array.forEachRight(X,function(ne,ie){te=Z.call(K,te,ne,ie,X)}),te},goog.array.some=goog.NATIVE_ARRAY_PROTOTYPES&&(goog.array.ASSUME_NATIVE_FUNCTIONS||Array.prototype.some)?function(X,Z,_){return goog.asserts.assert(X.length!=null),Array.prototype.some.call(X,Z,_)}:function(X,Z,_){for(var K=X.length,te=typeof X=="string"?X.split(""):X,ne=0;ne<K;ne++)if(ne in te&&Z.call(_,te[ne],ne,X))return!0;return!1},goog.array.every=goog.NATIVE_ARRAY_PROTOTYPES&&(goog.array.ASSUME_NATIVE_FUNCTIONS||Array.prototype.every)?function(X,Z,_){return goog.asserts.assert(X.length!=null),Array.prototype.every.call(X,Z,_)}:function(X,Z,_){for(var K=X.length,te=typeof X=="string"?X.split(""):X,ne=0;ne<K;ne++)if(ne in te&&!Z.call(_,te[ne],ne,X))return!1;return!0},goog.array.count=function(X,Z,_){var K=0;return goog.array.forEach(X,function(te,ne,ie){Z.call(_,te,ne,ie)&&++K},_),K},goog.array.find=function(X,Z,_){return 0>(Z=goog.array.findIndex(X,Z,_))?null:typeof X=="string"?X.charAt(Z):X[Z]},goog.array.findIndex=function(X,Z,_){for(var K=X.length,te=typeof X=="string"?X.split(""):X,ne=0;ne<K;ne++)if(ne in te&&Z.call(_,te[ne],ne,X))return ne;return-1},goog.array.findRight=function(X,Z,_){return 0>(Z=goog.array.findIndexRight(X,Z,_))?null:typeof X=="string"?X.charAt(Z):X[Z]},goog.array.findIndexRight=function(X,Z,_){var K=X.length,te=typeof X=="string"?X.split(""):X;for(--K;0<=K;K--)if(K in te&&Z.call(_,te[K],K,X))return K;return-1},goog.array.contains=function(X,Z){return 0<=goog.array.indexOf(X,Z)},goog.array.isEmpty=function(X){return X.length==0},goog.array.clear=function(X){if(!Array.isArray(X))for(var Z=X.length-1;0<=Z;Z--)delete X[Z];X.length=0},goog.array.insert=function(X,Z){goog.array.contains(X,Z)||X.push(Z)},goog.array.insertAt=function(X,Z,_){goog.array.splice(X,_,0,Z)},goog.array.insertArrayAt=function(X,Z,_){goog.partial(goog.array.splice,X,_,0).apply(null,Z)},goog.array.insertBefore=function(X,Z,_){var K;arguments.length==2||0>(K=goog.array.indexOf(X,_))?X.push(Z):goog.array.insertAt(X,Z,K)},goog.array.remove=function(X,Z){var _;return(_=0<=(Z=goog.array.indexOf(X,Z)))&&goog.array.removeAt(X,Z),_},goog.array.removeLast=function(X,Z){return 0<=(Z=goog.array.lastIndexOf(X,Z))&&(goog.array.removeAt(X,Z),!0)},goog.array.removeAt=function(X,Z){return goog.asserts.assert(X.length!=null),Array.prototype.splice.call(X,Z,1).length==1},goog.array.removeIf=function(X,Z,_){return 0<=(Z=goog.array.findIndex(X,Z,_))&&(goog.array.removeAt(X,Z),!0)},goog.array.removeAllIf=function(X,Z,_){var K=0;return goog.array.forEachRight(X,function(te,ne){Z.call(_,te,ne,X)&&goog.array.removeAt(X,ne)&&K++}),K},goog.array.concat=function(X){return Array.prototype.concat.apply([],arguments)},goog.array.join=function(X){return Array.prototype.concat.apply([],arguments)},goog.array.toArray=function(X){var Z=X.length;if(0<Z){for(var _=Array(Z),K=0;K<Z;K++)_[K]=X[K];return _}return[]},goog.array.clone=goog.array.toArray,goog.array.extend=function(X,Z){for(var _=1;_<arguments.length;_++){var K=arguments[_];if(goog.isArrayLike(K)){var te=X.length||0,ne=K.length||0;X.length=te+ne;for(var ie=0;ie<ne;ie++)X[te+ie]=K[ie]}else X.push(K)}},goog.array.splice=function(X,Z,_,K){return goog.asserts.assert(X.length!=null),Array.prototype.splice.apply(X,goog.array.slice(arguments,1))},goog.array.slice=function(X,Z,_){return goog.asserts.assert(X.length!=null),2>=arguments.length?Array.prototype.slice.call(X,Z):Array.prototype.slice.call(X,Z,_)},goog.array.removeDuplicates=function(X,Z,_){Z=Z||X;var K=function(se){return goog.isObject(se)?"o"+goog.getUid(se):(typeof se).charAt(0)+se};_=_||K,K={};for(var te=0,ne=0;ne<X.length;){var ie=X[ne++],oe=_(ie);Object.prototype.hasOwnProperty.call(K,oe)||(K[oe]=!0,Z[te++]=ie)}Z.length=te},goog.array.binarySearch=function(X,Z,_){return goog.array.binarySearch_(X,_||goog.array.defaultCompare,!1,Z)},goog.array.binarySelect=function(X,Z,_){return goog.array.binarySearch_(X,Z,!0,void 0,_)},goog.array.binarySearch_=function(X,Z,_,K,te){for(var ne,ie=0,oe=X.length;ie<oe;){var se=ie+(oe-ie>>>1),ae=_?Z.call(te,X[se],se,X):Z(K,X[se]);0<ae?ie=se+1:(oe=se,ne=!ae)}return ne?ie:-ie-1},goog.array.sort=function(X,Z){X.sort(Z||goog.array.defaultCompare)},goog.array.stableSort=function(X,Z){for(var _=Array(X.length),K=0;K<X.length;K++)_[K]={index:K,value:X[K]};var te=Z||goog.array.defaultCompare;for(goog.array.sort(_,function(ne,ie){return te(ne.value,ie.value)||ne.index-ie.index}),K=0;K<X.length;K++)X[K]=_[K].value},goog.array.sortByKey=function(X,Z,_){var K=_||goog.array.defaultCompare;goog.array.sort(X,function(te,ne){return K(Z(te),Z(ne))})},goog.array.sortObjectsByKey=function(X,Z,_){goog.array.sortByKey(X,function(K){return K[Z]},_)},goog.array.isSorted=function(X,Z,_){Z=Z||goog.array.defaultCompare;for(var K=1;K<X.length;K++){var te=Z(X[K-1],X[K]);if(0<te||te==0&&_)return!1}return!0},goog.array.equals=function(X,Z,_){if(!goog.isArrayLike(X)||!goog.isArrayLike(Z)||X.length!=Z.length)return!1;var K=X.length;_=_||goog.array.defaultCompareEquality;for(var te=0;te<K;te++)if(!_(X[te],Z[te]))return!1;return!0},goog.array.compare3=function(X,Z,_){_=_||goog.array.defaultCompare;for(var K=Math.min(X.length,Z.length),te=0;te<K;te++){var ne=_(X[te],Z[te]);if(ne!=0)return ne}return goog.array.defaultCompare(X.length,Z.length)},goog.array.defaultCompare=function(X,Z){return X>Z?1:X<Z?-1:0},goog.array.inverseDefaultCompare=function(X,Z){return-goog.array.defaultCompare(X,Z)},goog.array.defaultCompareEquality=function(X,Z){return X===Z},goog.array.binaryInsert=function(X,Z,_){return 0>(_=goog.array.binarySearch(X,Z,_))&&(goog.array.insertAt(X,Z,-(_+1)),!0)},goog.array.binaryRemove=function(X,Z,_){return 0<=(Z=goog.array.binarySearch(X,Z,_))&&goog.array.removeAt(X,Z)},goog.array.bucket=function(X,Z,_){for(var K={},te=0;te<X.length;te++){var ne=X[te],ie=Z.call(_,ne,te,X);ie!==void 0&&(K[ie]||(K[ie]=[])).push(ne)}return K},goog.array.toObject=function(X,Z,_){var K={};return goog.array.forEach(X,function(te,ne){K[Z.call(_,te,ne,X)]=te}),K},goog.array.range=function(X,Z,_){var K=[],te=0,ne=X;if(Z!==void 0&&(te=X,ne=Z),0>(_=_||1)*(ne-te))return[];if(0<_)for(X=te;X<ne;X+=_)K.push(X);else for(X=te;X>ne;X+=_)K.push(X);return K},goog.array.repeat=function(X,Z){for(var _=[],K=0;K<Z;K++)_[K]=X;return _},goog.array.flatten=function(X){for(var Z=[],_=0;_<arguments.length;_++){var K=arguments[_];if(Array.isArray(K))for(var te=0;te<K.length;te+=8192){var ne=goog.array.slice(K,te,te+8192);ne=goog.array.flatten.apply(null,ne);for(var ie=0;ie<ne.length;ie++)Z.push(ne[ie])}else Z.push(K)}return Z},goog.array.rotate=function(X,Z){return goog.asserts.assert(X.length!=null),X.length&&(0<(Z%=X.length)?Array.prototype.unshift.apply(X,X.splice(-Z,Z)):0>Z&&Array.prototype.push.apply(X,X.splice(0,-Z))),X},goog.array.moveItem=function(X,Z,_){goog.asserts.assert(0<=Z&&Z<X.length),goog.asserts.assert(0<=_&&_<X.length),Z=Array.prototype.splice.call(X,Z,1),Array.prototype.splice.call(X,_,0,Z[0])},goog.array.zip=function(X){if(!arguments.length)return[];for(var Z=[],_=arguments[0].length,K=1;K<arguments.length;K++)arguments[K].length<_&&(_=arguments[K].length);for(K=0;K<_;K++){for(var te=[],ne=0;ne<arguments.length;ne++)te.push(arguments[ne][K]);Z.push(te)}return Z},goog.array.shuffle=function(X,Z){Z=Z||Math.random;for(var _=X.length-1;0<_;_--){var K=Math.floor(Z()*(_+1)),te=X[_];X[_]=X[K],X[K]=te}},goog.array.copyByIndex=function(X,Z){var _=[];return goog.array.forEach(Z,function(K){_.push(X[K])}),_},goog.array.concatMap=function(X,Z,_){return goog.array.concat.apply([],goog.array.map(X,Z,_))},goog.crypt={},goog.crypt.stringToByteArray=function(X){for(var Z=[],_=0,K=0;K<X.length;K++){var te=X.charCodeAt(K);255<te&&(Z[_++]=255&te,te>>=8),Z[_++]=te}return Z},goog.crypt.byteArrayToString=function(X){if(8192>=X.length)return String.fromCharCode.apply(null,X);for(var Z="",_=0;_<X.length;_+=8192){var K=goog.array.slice(X,_,_+8192);Z+=String.fromCharCode.apply(null,K)}return Z},goog.crypt.byteArrayToHex=function(X,Z){return goog.array.map(X,function(_){return 1<(_=_.toString(16)).length?_:"0"+_}).join(Z||"")},goog.crypt.hexToByteArray=function(X){goog.asserts.assert(X.length%2==0,"Key string length must be multiple of 2");for(var Z=[],_=0;_<X.length;_+=2)Z.push(parseInt(X.substring(_,_+2),16));return Z},goog.crypt.stringToUtf8ByteArray=function(X){for(var Z=[],_=0,K=0;K<X.length;K++){var te=X.charCodeAt(K);128>te?Z[_++]=te:(2048>te?Z[_++]=te>>6|192:((64512&te)==55296&&K+1<X.length&&(64512&X.charCodeAt(K+1))==56320?(te=65536+((1023&te)<<10)+(1023&X.charCodeAt(++K)),Z[_++]=te>>18|240,Z[_++]=te>>12&63|128):Z[_++]=te>>12|224,Z[_++]=te>>6&63|128),Z[_++]=63&te|128)}return Z},goog.crypt.utf8ByteArrayToString=function(X){for(var Z=[],_=0,K=0;_<X.length;){var te=X[_++];if(128>te)Z[K++]=String.fromCharCode(te);else if(191<te&&224>te){var ne=X[_++];Z[K++]=String.fromCharCode((31&te)<<6|63&ne)}else if(239<te&&365>te){ne=X[_++];var ie=X[_++];te=((7&te)<<18|(63&ne)<<12|(63&ie)<<6|63&X[_++])-65536,Z[K++]=String.fromCharCode(55296+(te>>10)),Z[K++]=String.fromCharCode(56320+(1023&te))}else ne=X[_++],ie=X[_++],Z[K++]=String.fromCharCode((15&te)<<12|(63&ne)<<6|63&ie)}return Z.join("")},goog.crypt.xorByteArray=function(X,Z){goog.asserts.assert(X.length==Z.length,"XOR array lengths must match");for(var _=[],K=0;K<X.length;K++)_.push(X[K]^Z[K]);return _},goog.dom.asserts={},goog.dom.asserts.assertIsLocation=function(X){if(goog.asserts.ENABLE_ASSERTS){var Z=goog.dom.asserts.getWindow_(X);Z&&(!X||!(X instanceof Z.Location)&&X instanceof Z.Element)&&goog.asserts.fail("Argument is not a Location (or a non-Element mock); got: %s",goog.dom.asserts.debugStringForType_(X))}return X},goog.dom.asserts.assertIsElementType_=function(X,Z){if(goog.asserts.ENABLE_ASSERTS){var _=goog.dom.asserts.getWindow_(X);_&&_[Z]!==void 0&&(X&&(X instanceof _[Z]||!(X instanceof _.Location||X instanceof _.Element))||goog.asserts.fail("Argument is not a %s (or a non-Element, non-Location mock); got: %s",Z,goog.dom.asserts.debugStringForType_(X)))}return X},goog.dom.asserts.assertIsHTMLAnchorElement=function(X){return goog.dom.asserts.assertIsElementType_(X,"HTMLAnchorElement")},goog.dom.asserts.assertIsHTMLButtonElement=function(X){return goog.dom.asserts.assertIsElementType_(X,"HTMLButtonElement")},goog.dom.asserts.assertIsHTMLLinkElement=function(X){return goog.dom.asserts.assertIsElementType_(X,"HTMLLinkElement")},goog.dom.asserts.assertIsHTMLImageElement=function(X){return goog.dom.asserts.assertIsElementType_(X,"HTMLImageElement")},goog.dom.asserts.assertIsHTMLAudioElement=function(X){return goog.dom.asserts.assertIsElementType_(X,"HTMLAudioElement")},goog.dom.asserts.assertIsHTMLVideoElement=function(X){return goog.dom.asserts.assertIsElementType_(X,"HTMLVideoElement")},goog.dom.asserts.assertIsHTMLInputElement=function(X){return goog.dom.asserts.assertIsElementType_(X,"HTMLInputElement")},goog.dom.asserts.assertIsHTMLTextAreaElement=function(X){return goog.dom.asserts.assertIsElementType_(X,"HTMLTextAreaElement")},goog.dom.asserts.assertIsHTMLCanvasElement=function(X){return goog.dom.asserts.assertIsElementType_(X,"HTMLCanvasElement")},goog.dom.asserts.assertIsHTMLEmbedElement=function(X){return goog.dom.asserts.assertIsElementType_(X,"HTMLEmbedElement")},goog.dom.asserts.assertIsHTMLFormElement=function(X){return goog.dom.asserts.assertIsElementType_(X,"HTMLFormElement")},goog.dom.asserts.assertIsHTMLFrameElement=function(X){return goog.dom.asserts.assertIsElementType_(X,"HTMLFrameElement")},goog.dom.asserts.assertIsHTMLIFrameElement=function(X){return goog.dom.asserts.assertIsElementType_(X,"HTMLIFrameElement")},goog.dom.asserts.assertIsHTMLObjectElement=function(X){return goog.dom.asserts.assertIsElementType_(X,"HTMLObjectElement")},goog.dom.asserts.assertIsHTMLScriptElement=function(X){return goog.dom.asserts.assertIsElementType_(X,"HTMLScriptElement")},goog.dom.asserts.debugStringForType_=function(X){if(!goog.isObject(X))return X===void 0?"undefined":X===null?"null":typeof X;try{return X.constructor.displayName||X.constructor.name||Object.prototype.toString.call(X)}catch{return"<object could not be stringified>"}},goog.dom.asserts.getWindow_=function(X){try{var Z=X&&X.ownerDocument,_=Z&&(Z.defaultView||Z.parentWindow);if((_=_||goog.global).Element&&_.Location)return _}catch{}return null},goog.functions={},goog.functions.constant=function(X){return function(){return X}},goog.functions.FALSE=function(){return!1},goog.functions.TRUE=function(){return!0},goog.functions.NULL=function(){return null},goog.functions.identity=function(X,Z){return X},goog.functions.error=function(X){return function(){throw Error(X)}},goog.functions.fail=function(X){return function(){throw X}},goog.functions.lock=function(X,Z){return Z=Z||0,function(){return X.apply(this,Array.prototype.slice.call(arguments,0,Z))}},goog.functions.nth=function(X){return function(){return arguments[X]}},goog.functions.partialRight=function(X,Z){var _=Array.prototype.slice.call(arguments,1);return function(){var K=Array.prototype.slice.call(arguments);return K.push.apply(K,_),X.apply(this,K)}},goog.functions.withReturnValue=function(X,Z){return goog.functions.sequence(X,goog.functions.constant(Z))},goog.functions.equalTo=function(X,Z){return function(_){return Z?X==_:X===_}},goog.functions.compose=function(X,Z){var _=arguments,K=_.length;return function(){var te;K&&(te=_[K-1].apply(this,arguments));for(var ne=K-2;0<=ne;ne--)te=_[ne].call(this,te);return te}},goog.functions.sequence=function(X){var Z=arguments,_=Z.length;return function(){for(var K,te=0;te<_;te++)K=Z[te].apply(this,arguments);return K}},goog.functions.and=function(X){var Z=arguments,_=Z.length;return function(){for(var K=0;K<_;K++)if(!Z[K].apply(this,arguments))return!1;return!0}},goog.functions.or=function(X){var Z=arguments,_=Z.length;return function(){for(var K=0;K<_;K++)if(Z[K].apply(this,arguments))return!0;return!1}},goog.functions.not=function(X){return function(){return!X.apply(this,arguments)}},goog.functions.create=function(X,Z){var _=function(){};return _.prototype=X.prototype,_=new _,X.apply(_,Array.prototype.slice.call(arguments,1)),_},goog.functions.CACHE_RETURN_VALUE=!0,goog.functions.cacheReturnValue=function(X){var Z,_=!1;return function(){return goog.functions.CACHE_RETURN_VALUE?(_||(Z=X(),_=!0),Z):X()}},goog.functions.once=function(X){var Z=X;return function(){if(Z){var _=Z;Z=null,_()}}},goog.functions.debounce=function(X,Z,_){var K=0;return function(te){goog.global.clearTimeout(K);var ne=arguments;K=goog.global.setTimeout(function(){X.apply(_,ne)},Z)}},goog.functions.throttle=function(X,Z,_){var K=0,te=!1,ne=[],ie=function(){K=0,te&&(te=!1,oe())},oe=function(){K=goog.global.setTimeout(ie,Z),X.apply(_,ne)};return function(se){ne=arguments,K?te=!0:oe()}},goog.functions.rateLimit=function(X,Z,_){var K=0,te=function(){K=0};return function(ne){K||(K=goog.global.setTimeout(te,Z),X.apply(_,arguments))}},goog.dom.HtmlElement=function(){},goog.dom.TagName=function(X){this.tagName_=X},goog.dom.TagName.prototype.toString=function(){return this.tagName_},goog.dom.TagName.A=new goog.dom.TagName("A"),goog.dom.TagName.ABBR=new goog.dom.TagName("ABBR"),goog.dom.TagName.ACRONYM=new goog.dom.TagName("ACRONYM"),goog.dom.TagName.ADDRESS=new goog.dom.TagName("ADDRESS"),goog.dom.TagName.APPLET=new goog.dom.TagName("APPLET"),goog.dom.TagName.AREA=new goog.dom.TagName("AREA"),goog.dom.TagName.ARTICLE=new goog.dom.TagName("ARTICLE"),goog.dom.TagName.ASIDE=new goog.dom.TagName("ASIDE"),goog.dom.TagName.AUDIO=new goog.dom.TagName("AUDIO"),goog.dom.TagName.B=new goog.dom.TagName("B"),goog.dom.TagName.BASE=new goog.dom.TagName("BASE"),goog.dom.TagName.BASEFONT=new goog.dom.TagName("BASEFONT"),goog.dom.TagName.BDI=new goog.dom.TagName("BDI"),goog.dom.TagName.BDO=new goog.dom.TagName("BDO"),goog.dom.TagName.BIG=new goog.dom.TagName("BIG"),goog.dom.TagName.BLOCKQUOTE=new goog.dom.TagName("BLOCKQUOTE"),goog.dom.TagName.BODY=new goog.dom.TagName("BODY"),goog.dom.TagName.BR=new goog.dom.TagName("BR"),goog.dom.TagName.BUTTON=new goog.dom.TagName("BUTTON"),goog.dom.TagName.CANVAS=new goog.dom.TagName("CANVAS"),goog.dom.TagName.CAPTION=new goog.dom.TagName("CAPTION"),goog.dom.TagName.CENTER=new goog.dom.TagName("CENTER"),goog.dom.TagName.CITE=new goog.dom.TagName("CITE"),goog.dom.TagName.CODE=new goog.dom.TagName("CODE"),goog.dom.TagName.COL=new goog.dom.TagName("COL"),goog.dom.TagName.COLGROUP=new goog.dom.TagName("COLGROUP"),goog.dom.TagName.COMMAND=new goog.dom.TagName("COMMAND"),goog.dom.TagName.DATA=new goog.dom.TagName("DATA"),goog.dom.TagName.DATALIST=new goog.dom.TagName("DATALIST"),goog.dom.TagName.DD=new goog.dom.TagName("DD"),goog.dom.TagName.DEL=new goog.dom.TagName("DEL"),goog.dom.TagName.DETAILS=new goog.dom.TagName("DETAILS"),goog.dom.TagName.DFN=new goog.dom.TagName("DFN"),goog.dom.TagName.DIALOG=new goog.dom.TagName("DIALOG"),goog.dom.TagName.DIR=new goog.dom.TagName("DIR"),goog.dom.TagName.DIV=new goog.dom.TagName("DIV"),goog.dom.TagName.DL=new goog.dom.TagName("DL"),goog.dom.TagName.DT=new goog.dom.TagName("DT"),goog.dom.TagName.EM=new goog.dom.TagName("EM"),goog.dom.TagName.EMBED=new goog.dom.TagName("EMBED"),goog.dom.TagName.FIELDSET=new goog.dom.TagName("FIELDSET"),goog.dom.TagName.FIGCAPTION=new goog.dom.TagName("FIGCAPTION"),goog.dom.TagName.FIGURE=new goog.dom.TagName("FIGURE"),goog.dom.TagName.FONT=new goog.dom.TagName("FONT"),goog.dom.TagName.FOOTER=new goog.dom.TagName("FOOTER"),goog.dom.TagName.FORM=new goog.dom.TagName("FORM"),goog.dom.TagName.FRAME=new goog.dom.TagName("FRAME"),goog.dom.TagName.FRAMESET=new goog.dom.TagName("FRAMESET"),goog.dom.TagName.H1=new goog.dom.TagName("H1"),goog.dom.TagName.H2=new goog.dom.TagName("H2"),goog.dom.TagName.H3=new goog.dom.TagName("H3"),goog.dom.TagName.H4=new goog.dom.TagName("H4"),goog.dom.TagName.H5=new goog.dom.TagName("H5"),goog.dom.TagName.H6=new goog.dom.TagName("H6"),goog.dom.TagName.HEAD=new goog.dom.TagName("HEAD"),goog.dom.TagName.HEADER=new goog.dom.TagName("HEADER"),goog.dom.TagName.HGROUP=new goog.dom.TagName("HGROUP"),goog.dom.TagName.HR=new goog.dom.TagName("HR"),goog.dom.TagName.HTML=new goog.dom.TagName("HTML"),goog.dom.TagName.I=new goog.dom.TagName("I"),goog.dom.TagName.IFRAME=new goog.dom.TagName("IFRAME"),goog.dom.TagName.IMG=new goog.dom.TagName("IMG"),goog.dom.TagName.INPUT=new goog.dom.TagName("INPUT"),goog.dom.TagName.INS=new goog.dom.TagName("INS"),goog.dom.TagName.ISINDEX=new goog.dom.TagName("ISINDEX"),goog.dom.TagName.KBD=new goog.dom.TagName("KBD"),goog.dom.TagName.KEYGEN=new goog.dom.TagName("KEYGEN"),goog.dom.TagName.LABEL=new goog.dom.TagName("LABEL"),goog.dom.TagName.LEGEND=new goog.dom.TagName("LEGEND"),goog.dom.TagName.LI=new goog.dom.TagName("LI"),goog.dom.TagName.LINK=new goog.dom.TagName("LINK"),goog.dom.TagName.MAIN=new goog.dom.TagName("MAIN"),goog.dom.TagName.MAP=new goog.dom.TagName("MAP"),goog.dom.TagName.MARK=new goog.dom.TagName("MARK"),goog.dom.TagName.MATH=new goog.dom.TagName("MATH"),goog.dom.TagName.MENU=new goog.dom.TagName("MENU"),goog.dom.TagName.MENUITEM=new goog.dom.TagName("MENUITEM"),goog.dom.TagName.META=new goog.dom.TagName("META"),goog.dom.TagName.METER=new goog.dom.TagName("METER"),goog.dom.TagName.NAV=new goog.dom.TagName("NAV"),goog.dom.TagName.NOFRAMES=new goog.dom.TagName("NOFRAMES"),goog.dom.TagName.NOSCRIPT=new goog.dom.TagName("NOSCRIPT"),goog.dom.TagName.OBJECT=new goog.dom.TagName("OBJECT"),goog.dom.TagName.OL=new goog.dom.TagName("OL"),goog.dom.TagName.OPTGROUP=new goog.dom.TagName("OPTGROUP"),goog.dom.TagName.OPTION=new goog.dom.TagName("OPTION"),goog.dom.TagName.OUTPUT=new goog.dom.TagName("OUTPUT"),goog.dom.TagName.P=new goog.dom.TagName("P"),goog.dom.TagName.PARAM=new goog.dom.TagName("PARAM"),goog.dom.TagName.PICTURE=new goog.dom.TagName("PICTURE"),goog.dom.TagName.PRE=new goog.dom.TagName("PRE"),goog.dom.TagName.PROGRESS=new goog.dom.TagName("PROGRESS"),goog.dom.TagName.Q=new goog.dom.TagName("Q"),goog.dom.TagName.RP=new goog.dom.TagName("RP"),goog.dom.TagName.RT=new goog.dom.TagName("RT"),goog.dom.TagName.RTC=new goog.dom.TagName("RTC"),goog.dom.TagName.RUBY=new goog.dom.TagName("RUBY"),goog.dom.TagName.S=new goog.dom.TagName("S"),goog.dom.TagName.SAMP=new goog.dom.TagName("SAMP"),goog.dom.TagName.SCRIPT=new goog.dom.TagName("SCRIPT"),goog.dom.TagName.SECTION=new goog.dom.TagName("SECTION"),goog.dom.TagName.SELECT=new goog.dom.TagName("SELECT"),goog.dom.TagName.SMALL=new goog.dom.TagName("SMALL"),goog.dom.TagName.SOURCE=new goog.dom.TagName("SOURCE"),goog.dom.TagName.SPAN=new goog.dom.TagName("SPAN"),goog.dom.TagName.STRIKE=new goog.dom.TagName("STRIKE"),goog.dom.TagName.STRONG=new goog.dom.TagName("STRONG"),goog.dom.TagName.STYLE=new goog.dom.TagName("STYLE"),goog.dom.TagName.SUB=new goog.dom.TagName("SUB"),goog.dom.TagName.SUMMARY=new goog.dom.TagName("SUMMARY"),goog.dom.TagName.SUP=new goog.dom.TagName("SUP"),goog.dom.TagName.SVG=new goog.dom.TagName("SVG"),goog.dom.TagName.TABLE=new goog.dom.TagName("TABLE"),goog.dom.TagName.TBODY=new goog.dom.TagName("TBODY"),goog.dom.TagName.TD=new goog.dom.TagName("TD"),goog.dom.TagName.TEMPLATE=new goog.dom.TagName("TEMPLATE"),goog.dom.TagName.TEXTAREA=new goog.dom.TagName("TEXTAREA"),goog.dom.TagName.TFOOT=new goog.dom.TagName("TFOOT"),goog.dom.TagName.TH=new goog.dom.TagName("TH"),goog.dom.TagName.THEAD=new goog.dom.TagName("THEAD"),goog.dom.TagName.TIME=new goog.dom.TagName("TIME"),goog.dom.TagName.TITLE=new goog.dom.TagName("TITLE"),goog.dom.TagName.TR=new goog.dom.TagName("TR"),goog.dom.TagName.TRACK=new goog.dom.TagName("TRACK"),goog.dom.TagName.TT=new goog.dom.TagName("TT"),goog.dom.TagName.U=new goog.dom.TagName("U"),goog.dom.TagName.UL=new goog.dom.TagName("UL"),goog.dom.TagName.VAR=new goog.dom.TagName("VAR"),goog.dom.TagName.VIDEO=new goog.dom.TagName("VIDEO"),goog.dom.TagName.WBR=new goog.dom.TagName("WBR"),goog.dom.tags={},goog.dom.tags.VOID_TAGS_={area:!0,base:!0,br:!0,col:!0,command:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0},goog.dom.tags.isVoidTag=function(X){return goog.dom.tags.VOID_TAGS_[X]===!0},goog.html={},goog.html.trustedtypes={},goog.html.trustedtypes.PRIVATE_DO_NOT_ACCESS_OR_ELSE_POLICY=goog.TRUSTED_TYPES_POLICY_NAME?goog.createTrustedTypesPolicy(goog.TRUSTED_TYPES_POLICY_NAME+"#html"):null,goog.string={},goog.string.TypedString=function(){},goog.string.Const=function(X,Z){this.stringConstValueWithSecurityContract__googStringSecurityPrivate_=X===goog.string.Const.GOOG_STRING_CONSTRUCTOR_TOKEN_PRIVATE_&&Z||"",this.STRING_CONST_TYPE_MARKER__GOOG_STRING_SECURITY_PRIVATE_=goog.string.Const.TYPE_MARKER_},goog.string.Const.prototype.implementsGoogStringTypedString=!0,goog.string.Const.prototype.getTypedStringValue=function(){return this.stringConstValueWithSecurityContract__googStringSecurityPrivate_},goog.DEBUG&&(goog.string.Const.prototype.toString=function(){return"Const{"+this.stringConstValueWithSecurityContract__googStringSecurityPrivate_+"}"}),goog.string.Const.unwrap=function(X){return X instanceof goog.string.Const&&X.constructor===goog.string.Const&&X.STRING_CONST_TYPE_MARKER__GOOG_STRING_SECURITY_PRIVATE_===goog.string.Const.TYPE_MARKER_?X.stringConstValueWithSecurityContract__googStringSecurityPrivate_:(goog.asserts.fail("expected object of type Const, got '"+X+"'"),"type_error:Const")},goog.string.Const.from=function(X){return new goog.string.Const(goog.string.Const.GOOG_STRING_CONSTRUCTOR_TOKEN_PRIVATE_,X)},goog.string.Const.TYPE_MARKER_={},goog.string.Const.GOOG_STRING_CONSTRUCTOR_TOKEN_PRIVATE_={},goog.string.Const.EMPTY=goog.string.Const.from(""),goog.html.SafeScript=function(){this.privateDoNotAccessOrElseSafeScriptWrappedValue_="",this.SAFE_SCRIPT_TYPE_MARKER_GOOG_HTML_SECURITY_PRIVATE_=goog.html.SafeScript.TYPE_MARKER_GOOG_HTML_SECURITY_PRIVATE_},goog.html.SafeScript.prototype.implementsGoogStringTypedString=!0,goog.html.SafeScript.TYPE_MARKER_GOOG_HTML_SECURITY_PRIVATE_={},goog.html.SafeScript.fromConstant=function(X){return(X=goog.string.Const.unwrap(X)).length===0?goog.html.SafeScript.EMPTY:goog.html.SafeScript.createSafeScriptSecurityPrivateDoNotAccessOrElse(X)},goog.html.SafeScript.fromConstantAndArgs=function(X,Z){for(var _=[],K=1;K<arguments.length;K++)_.push(goog.html.SafeScript.stringify_(arguments[K]));return goog.html.SafeScript.createSafeScriptSecurityPrivateDoNotAccessOrElse("("+goog.string.Const.unwrap(X)+")("+_.join(", ")+");")},goog.html.SafeScript.fromJson=function(X){return goog.html.SafeScript.createSafeScriptSecurityPrivateDoNotAccessOrElse(goog.html.SafeScript.stringify_(X))},goog.html.SafeScript.prototype.getTypedStringValue=function(){return this.privateDoNotAccessOrElseSafeScriptWrappedValue_.toString()},goog.DEBUG&&(goog.html.SafeScript.prototype.toString=function(){return"SafeScript{"+this.privateDoNotAccessOrElseSafeScriptWrappedValue_+"}"}),goog.html.SafeScript.unwrap=function(X){return goog.html.SafeScript.unwrapTrustedScript(X).toString()},goog.html.SafeScript.unwrapTrustedScript=function(X){return X instanceof goog.html.SafeScript&&X.constructor===goog.html.SafeScript&&X.SAFE_SCRIPT_TYPE_MARKER_GOOG_HTML_SECURITY_PRIVATE_===goog.html.SafeScript.TYPE_MARKER_GOOG_HTML_SECURITY_PRIVATE_?X.privateDoNotAccessOrElseSafeScriptWrappedValue_:(goog.asserts.fail("expected object of type SafeScript, got '"+X+"' of type "+goog.typeOf(X)),"type_error:SafeScript")},goog.html.SafeScript.stringify_=function(X){return JSON.stringify(X).replace(/</g,"\\x3c")},goog.html.SafeScript.createSafeScriptSecurityPrivateDoNotAccessOrElse=function(X){return new goog.html.SafeScript().initSecurityPrivateDoNotAccessOrElse_(X)},goog.html.SafeScript.prototype.initSecurityPrivateDoNotAccessOrElse_=function(X){return this.privateDoNotAccessOrElseSafeScriptWrappedValue_=goog.html.trustedtypes.PRIVATE_DO_NOT_ACCESS_OR_ELSE_POLICY?goog.html.trustedtypes.PRIVATE_DO_NOT_ACCESS_OR_ELSE_POLICY.createScript(X):X,this},goog.html.SafeScript.EMPTY=goog.html.SafeScript.createSafeScriptSecurityPrivateDoNotAccessOrElse(""),goog.fs={},goog.fs.url={},goog.fs.url.createObjectUrl=function(X){return goog.fs.url.getUrlObject_().createObjectURL(X)},goog.fs.url.revokeObjectUrl=function(X){goog.fs.url.getUrlObject_().revokeObjectURL(X)},goog.fs.url.UrlObject_=function(){},goog.fs.url.UrlObject_.prototype.createObjectURL=function(X){},goog.fs.url.UrlObject_.prototype.revokeObjectURL=function(X){},goog.fs.url.getUrlObject_=function(){var X=goog.fs.url.findUrlObject_();if(X!=null)return X;throw Error("This browser doesn't seem to support blob URLs")},goog.fs.url.findUrlObject_=function(){return goog.global.URL!==void 0&&goog.global.URL.createObjectURL!==void 0?goog.global.URL:goog.global.webkitURL!==void 0&&goog.global.webkitURL.createObjectURL!==void 0?goog.global.webkitURL:goog.global.createObjectURL!==void 0?goog.global:null},goog.fs.url.browserSupportsObjectUrls=function(){return goog.fs.url.findUrlObject_()!=null},goog.fs.blob={},goog.fs.blob.getBlob=function(X){var Z=goog.global.BlobBuilder||goog.global.WebKitBlobBuilder;if(Z!==void 0){Z=new Z;for(var _=0;_<arguments.length;_++)Z.append(arguments[_]);return Z.getBlob()}return goog.fs.blob.getBlobWithProperties(goog.array.toArray(arguments))},goog.fs.blob.getBlobWithProperties=function(X,Z,_){var K=goog.global.BlobBuilder||goog.global.WebKitBlobBuilder;if(K!==void 0){K=new K;for(var te=0;te<X.length;te++)K.append(X[te],_);return K.getBlob(Z)}if(goog.global.Blob!==void 0)return K={},Z&&(K.type=Z),_&&(K.endings=_),new Blob(X,K);throw Error("This browser doesn't seem to support creating Blobs")},goog.i18n={},goog.i18n.bidi={},goog.i18n.bidi.FORCE_RTL=!1,goog.i18n.bidi.IS_RTL=goog.i18n.bidi.FORCE_RTL||(goog.LOCALE.substring(0,2).toLowerCase()=="ar"||goog.LOCALE.substring(0,2).toLowerCase()=="fa"||goog.LOCALE.substring(0,2).toLowerCase()=="he"||goog.LOCALE.substring(0,2).toLowerCase()=="iw"||goog.LOCALE.substring(0,2).toLowerCase()=="ps"||goog.LOCALE.substring(0,2).toLowerCase()=="sd"||goog.LOCALE.substring(0,2).toLowerCase()=="ug"||goog.LOCALE.substring(0,2).toLowerCase()=="ur"||goog.LOCALE.substring(0,2).toLowerCase()=="yi")&&(goog.LOCALE.length==2||goog.LOCALE.substring(2,3)=="-"||goog.LOCALE.substring(2,3)=="_")||3<=goog.LOCALE.length&&goog.LOCALE.substring(0,3).toLowerCase()=="ckb"&&(goog.LOCALE.length==3||goog.LOCALE.substring(3,4)=="-"||goog.LOCALE.substring(3,4)=="_")||7<=goog.LOCALE.length&&(goog.LOCALE.substring(2,3)=="-"||goog.LOCALE.substring(2,3)=="_")&&(goog.LOCALE.substring(3,7).toLowerCase()=="adlm"||goog.LOCALE.substring(3,7).toLowerCase()=="arab"||goog.LOCALE.substring(3,7).toLowerCase()=="hebr"||goog.LOCALE.substring(3,7).toLowerCase()=="nkoo"||goog.LOCALE.substring(3,7).toLowerCase()=="rohg"||goog.LOCALE.substring(3,7).toLowerCase()=="thaa")||8<=goog.LOCALE.length&&(goog.LOCALE.substring(3,4)=="-"||goog.LOCALE.substring(3,4)=="_")&&(goog.LOCALE.substring(4,8).toLowerCase()=="adlm"||goog.LOCALE.substring(4,8).toLowerCase()=="arab"||goog.LOCALE.substring(4,8).toLowerCase()=="hebr"||goog.LOCALE.substring(4,8).toLowerCase()=="nkoo"||goog.LOCALE.substring(4,8).toLowerCase()=="rohg"||goog.LOCALE.substring(4,8).toLowerCase()=="thaa"),goog.i18n.bidi.Format={LRE:"‪",RLE:"‫",PDF:"‬",LRM:"‎",RLM:"‏"},goog.i18n.bidi.Dir={LTR:1,RTL:-1,NEUTRAL:0},goog.i18n.bidi.RIGHT="right",goog.i18n.bidi.LEFT="left",goog.i18n.bidi.I18N_RIGHT=goog.i18n.bidi.IS_RTL?goog.i18n.bidi.LEFT:goog.i18n.bidi.RIGHT,goog.i18n.bidi.I18N_LEFT=goog.i18n.bidi.IS_RTL?goog.i18n.bidi.RIGHT:goog.i18n.bidi.LEFT,goog.i18n.bidi.toDir=function(X,Z){return typeof X=="number"?0<X?goog.i18n.bidi.Dir.LTR:0>X?goog.i18n.bidi.Dir.RTL:Z?null:goog.i18n.bidi.Dir.NEUTRAL:X==null?null:X?goog.i18n.bidi.Dir.RTL:goog.i18n.bidi.Dir.LTR},goog.i18n.bidi.ltrChars_="A-Za-zÀ-ÖØ-öø-ʸ̀-֐ऀ-῿‎Ⰰ-\uD801\uD804-\uD839\uD83C-\uDBFF豈-﬜︀-﹯﻽-￿",goog.i18n.bidi.rtlChars_="֑-ۯۺ-ࣿ‏\uD802-\uD803\uD83A-\uD83Bיִ-﷿ﹰ-ﻼ",goog.i18n.bidi.htmlSkipReg_=/<[^>]*>|&[^;]+;/g,goog.i18n.bidi.stripHtmlIfNeeded_=function(X,Z){return Z?X.replace(goog.i18n.bidi.htmlSkipReg_,""):X},goog.i18n.bidi.rtlCharReg_=new RegExp("["+goog.i18n.bidi.rtlChars_+"]"),goog.i18n.bidi.ltrCharReg_=new RegExp("["+goog.i18n.bidi.ltrChars_+"]"),goog.i18n.bidi.hasAnyRtl=function(X,Z){return goog.i18n.bidi.rtlCharReg_.test(goog.i18n.bidi.stripHtmlIfNeeded_(X,Z))},goog.i18n.bidi.hasRtlChar=goog.i18n.bidi.hasAnyRtl,goog.i18n.bidi.hasAnyLtr=function(X,Z){return goog.i18n.bidi.ltrCharReg_.test(goog.i18n.bidi.stripHtmlIfNeeded_(X,Z))},goog.i18n.bidi.ltrRe_=new RegExp("^["+goog.i18n.bidi.ltrChars_+"]"),goog.i18n.bidi.rtlRe_=new RegExp("^["+goog.i18n.bidi.rtlChars_+"]"),goog.i18n.bidi.isRtlChar=function(X){return goog.i18n.bidi.rtlRe_.test(X)},goog.i18n.bidi.isLtrChar=function(X){return goog.i18n.bidi.ltrRe_.test(X)},goog.i18n.bidi.isNeutralChar=function(X){return!goog.i18n.bidi.isLtrChar(X)&&!goog.i18n.bidi.isRtlChar(X)},goog.i18n.bidi.ltrDirCheckRe_=new RegExp("^[^"+goog.i18n.bidi.rtlChars_+"]*["+goog.i18n.bidi.ltrChars_+"]"),goog.i18n.bidi.rtlDirCheckRe_=new RegExp("^[^"+goog.i18n.bidi.ltrChars_+"]*["+goog.i18n.bidi.rtlChars_+"]"),goog.i18n.bidi.startsWithRtl=function(X,Z){return goog.i18n.bidi.rtlDirCheckRe_.test(goog.i18n.bidi.stripHtmlIfNeeded_(X,Z))},goog.i18n.bidi.isRtlText=goog.i18n.bidi.startsWithRtl,goog.i18n.bidi.startsWithLtr=function(X,Z){return goog.i18n.bidi.ltrDirCheckRe_.test(goog.i18n.bidi.stripHtmlIfNeeded_(X,Z))},goog.i18n.bidi.isLtrText=goog.i18n.bidi.startsWithLtr,goog.i18n.bidi.isRequiredLtrRe_=/^http:\/\/.*/,goog.i18n.bidi.isNeutralText=function(X,Z){return X=goog.i18n.bidi.stripHtmlIfNeeded_(X,Z),goog.i18n.bidi.isRequiredLtrRe_.test(X)||!goog.i18n.bidi.hasAnyLtr(X)&&!goog.i18n.bidi.hasAnyRtl(X)},goog.i18n.bidi.ltrExitDirCheckRe_=new RegExp("["+goog.i18n.bidi.ltrChars_+"][^"+goog.i18n.bidi.rtlChars_+"]*$"),goog.i18n.bidi.rtlExitDirCheckRe_=new RegExp("["+goog.i18n.bidi.rtlChars_+"][^"+goog.i18n.bidi.ltrChars_+"]*$"),goog.i18n.bidi.endsWithLtr=function(X,Z){return goog.i18n.bidi.ltrExitDirCheckRe_.test(goog.i18n.bidi.stripHtmlIfNeeded_(X,Z))},goog.i18n.bidi.isLtrExitText=goog.i18n.bidi.endsWithLtr,goog.i18n.bidi.endsWithRtl=function(X,Z){return goog.i18n.bidi.rtlExitDirCheckRe_.test(goog.i18n.bidi.stripHtmlIfNeeded_(X,Z))},goog.i18n.bidi.isRtlExitText=goog.i18n.bidi.endsWithRtl,goog.i18n.bidi.rtlLocalesRe_=/^(ar|ckb|dv|he|iw|fa|nqo|ps|sd|ug|ur|yi|.*[-_](Adlm|Arab|Hebr|Nkoo|Rohg|Thaa))(?!.*[-_](Latn|Cyrl)($|-|_))($|-|_)/i,goog.i18n.bidi.isRtlLanguage=function(X){return goog.i18n.bidi.rtlLocalesRe_.test(X)},goog.i18n.bidi.bracketGuardTextRe_=/(\(.*?\)+)|(\[.*?\]+)|(\{.*?\}+)|(<.*?>+)/g,goog.i18n.bidi.guardBracketInText=function(X,Z){return Z=(Z===void 0?goog.i18n.bidi.hasAnyRtl(X):Z)?goog.i18n.bidi.Format.RLM:goog.i18n.bidi.Format.LRM,X.replace(goog.i18n.bidi.bracketGuardTextRe_,Z+"$&"+Z)},goog.i18n.bidi.enforceRtlInHtml=function(X){return X.charAt(0)=="<"?X.replace(/<\w+/,"$& dir=rtl"):`
<span dir=rtl>`+X+"</span>"},goog.i18n.bidi.enforceRtlInText=function(X){return goog.i18n.bidi.Format.RLE+X+goog.i18n.bidi.Format.PDF},goog.i18n.bidi.enforceLtrInHtml=function(X){return X.charAt(0)=="<"?X.replace(/<\w+/,"$& dir=ltr"):`
<span dir=ltr>`+X+"</span>"},goog.i18n.bidi.enforceLtrInText=function(X){return goog.i18n.bidi.Format.LRE+X+goog.i18n.bidi.Format.PDF},goog.i18n.bidi.dimensionsRe_=/:\s*([.\d][.\w]*)\s+([.\d][.\w]*)\s+([.\d][.\w]*)\s+([.\d][.\w]*)/g,goog.i18n.bidi.leftRe_=/left/gi,goog.i18n.bidi.rightRe_=/right/gi,goog.i18n.bidi.tempRe_=/%%%%/g,goog.i18n.bidi.mirrorCSS=function(X){return X.replace(goog.i18n.bidi.dimensionsRe_,":$1 $4 $3 $2").replace(goog.i18n.bidi.leftRe_,"%%%%").replace(goog.i18n.bidi.rightRe_,goog.i18n.bidi.LEFT).replace(goog.i18n.bidi.tempRe_,goog.i18n.bidi.RIGHT)},goog.i18n.bidi.doubleQuoteSubstituteRe_=/([\u0591-\u05f2])"/g,goog.i18n.bidi.singleQuoteSubstituteRe_=/([\u0591-\u05f2])'/g,goog.i18n.bidi.normalizeHebrewQuote=function(X){return X.replace(goog.i18n.bidi.doubleQuoteSubstituteRe_,"$1״").replace(goog.i18n.bidi.singleQuoteSubstituteRe_,"$1׳")},goog.i18n.bidi.wordSeparatorRe_=/\s+/,goog.i18n.bidi.hasNumeralsRe_=/[\d\u06f0-\u06f9]/,goog.i18n.bidi.rtlDetectionThreshold_=.4,goog.i18n.bidi.estimateDirection=function(X,Z){var _=0,K=0,te=!1;for(X=goog.i18n.bidi.stripHtmlIfNeeded_(X,Z).split(goog.i18n.bidi.wordSeparatorRe_),Z=0;Z<X.length;Z++){var ne=X[Z];goog.i18n.bidi.startsWithRtl(ne)?(_++,K++):goog.i18n.bidi.isRequiredLtrRe_.test(ne)?te=!0:goog.i18n.bidi.hasAnyLtr(ne)?K++:goog.i18n.bidi.hasNumeralsRe_.test(ne)&&(te=!0)}return K==0?te?goog.i18n.bidi.Dir.LTR:goog.i18n.bidi.Dir.NEUTRAL:_/K>goog.i18n.bidi.rtlDetectionThreshold_?goog.i18n.bidi.Dir.RTL:goog.i18n.bidi.Dir.LTR},goog.i18n.bidi.detectRtlDirectionality=function(X,Z){return goog.i18n.bidi.estimateDirection(X,Z)==goog.i18n.bidi.Dir.RTL},goog.i18n.bidi.setElementDirAndAlign=function(X,Z){X&&(Z=goog.i18n.bidi.toDir(Z))&&(X.style.textAlign=Z==goog.i18n.bidi.Dir.RTL?goog.i18n.bidi.RIGHT:goog.i18n.bidi.LEFT,X.dir=Z==goog.i18n.bidi.Dir.RTL?"rtl":"ltr")},goog.i18n.bidi.setElementDirByTextDirectionality=function(X,Z){switch(goog.i18n.bidi.estimateDirection(Z)){case goog.i18n.bidi.Dir.LTR:X.dir="ltr";break;case goog.i18n.bidi.Dir.RTL:X.dir="rtl";break;default:X.removeAttribute("dir")}},goog.i18n.bidi.DirectionalString=function(){},goog.html.TrustedResourceUrl=function(X,Z){this.privateDoNotAccessOrElseTrustedResourceUrlWrappedValue_=X===goog.html.TrustedResourceUrl.CONSTRUCTOR_TOKEN_PRIVATE_&&Z||"",this.TRUSTED_RESOURCE_URL_TYPE_MARKER_GOOG_HTML_SECURITY_PRIVATE_=goog.html.TrustedResourceUrl.TYPE_MARKER_GOOG_HTML_SECURITY_PRIVATE_},goog.html.TrustedResourceUrl.prototype.implementsGoogStringTypedString=!0,goog.html.TrustedResourceUrl.prototype.getTypedStringValue=function(){return this.privateDoNotAccessOrElseTrustedResourceUrlWrappedValue_.toString()},goog.html.TrustedResourceUrl.prototype.implementsGoogI18nBidiDirectionalString=!0,goog.html.TrustedResourceUrl.prototype.getDirection=function(){return goog.i18n.bidi.Dir.LTR},goog.html.TrustedResourceUrl.prototype.cloneWithParams=function(X,Z){var _=goog.html.TrustedResourceUrl.unwrap(this),K=(_=goog.html.TrustedResourceUrl.URL_PARAM_PARSER_.exec(_))[3]||"";return goog.html.TrustedResourceUrl.createTrustedResourceUrlSecurityPrivateDoNotAccessOrElse(_[1]+goog.html.TrustedResourceUrl.stringifyParams_("?",_[2]||"",X)+goog.html.TrustedResourceUrl.stringifyParams_("#",K,Z))},goog.DEBUG&&(goog.html.TrustedResourceUrl.prototype.toString=function(){return"TrustedResourceUrl{"+this.privateDoNotAccessOrElseTrustedResourceUrlWrappedValue_+"}"}),goog.html.TrustedResourceUrl.unwrap=function(X){return goog.html.TrustedResourceUrl.unwrapTrustedScriptURL(X).toString()},goog.html.TrustedResourceUrl.unwrapTrustedScriptURL=function(X){return X instanceof goog.html.TrustedResourceUrl&&X.constructor===goog.html.TrustedResourceUrl&&X.TRUSTED_RESOURCE_URL_TYPE_MARKER_GOOG_HTML_SECURITY_PRIVATE_===goog.html.TrustedResourceUrl.TYPE_MARKER_GOOG_HTML_SECURITY_PRIVATE_?X.privateDoNotAccessOrElseTrustedResourceUrlWrappedValue_:(goog.asserts.fail("expected object of type TrustedResourceUrl, got '"+X+"' of type "+goog.typeOf(X)),"type_error:TrustedResourceUrl")},goog.html.TrustedResourceUrl.format=function(X,Z){var _=goog.string.Const.unwrap(X);if(!goog.html.TrustedResourceUrl.BASE_URL_.test(_))throw Error("Invalid TrustedResourceUrl format: "+_);return X=_.replace(goog.html.TrustedResourceUrl.FORMAT_MARKER_,function(K,te){if(!Object.prototype.hasOwnProperty.call(Z,te))throw Error('Found marker, "'+te+'", in format string, "'+_+'", but no valid label mapping found in args: '+JSON.stringify(Z));return(K=Z[te])instanceof goog.string.Const?goog.string.Const.unwrap(K):encodeURIComponent(String(K))}),goog.html.TrustedResourceUrl.createTrustedResourceUrlSecurityPrivateDoNotAccessOrElse(X)},goog.html.TrustedResourceUrl.FORMAT_MARKER_=/%{(\w+)}/g,goog.html.TrustedResourceUrl.BASE_URL_=/^((https:)?\/\/[0-9a-z.:[\]-]+\/|\/[^/\\]|[^:/\\%]+\/|[^:/\\%]*[?#]|about:blank#)/i,goog.html.TrustedResourceUrl.URL_PARAM_PARSER_=/^([^?#]*)(\?[^#]*)?(#[\s\S]*)?/,goog.html.TrustedResourceUrl.formatWithParams=function(X,Z,_,K){return goog.html.TrustedResourceUrl.format(X,Z).cloneWithParams(_,K)},goog.html.TrustedResourceUrl.fromConstant=function(X){return goog.html.TrustedResourceUrl.createTrustedResourceUrlSecurityPrivateDoNotAccessOrElse(goog.string.Const.unwrap(X))},goog.html.TrustedResourceUrl.fromConstants=function(X){for(var Z="",_=0;_<X.length;_++)Z+=goog.string.Const.unwrap(X[_]);return goog.html.TrustedResourceUrl.createTrustedResourceUrlSecurityPrivateDoNotAccessOrElse(Z)},goog.html.TrustedResourceUrl.fromSafeScript=function(X){return X=goog.fs.blob.getBlobWithProperties([goog.html.SafeScript.unwrap(X)],"text/javascript"),X=goog.fs.url.createObjectUrl(X),goog.html.TrustedResourceUrl.createTrustedResourceUrlSecurityPrivateDoNotAccessOrElse(X)},goog.html.TrustedResourceUrl.TYPE_MARKER_GOOG_HTML_SECURITY_PRIVATE_={},goog.html.TrustedResourceUrl.createTrustedResourceUrlSecurityPrivateDoNotAccessOrElse=function(X){return X=goog.html.trustedtypes.PRIVATE_DO_NOT_ACCESS_OR_ELSE_POLICY?goog.html.trustedtypes.PRIVATE_DO_NOT_ACCESS_OR_ELSE_POLICY.createScriptURL(X):X,new goog.html.TrustedResourceUrl(goog.html.TrustedResourceUrl.CONSTRUCTOR_TOKEN_PRIVATE_,X)},goog.html.TrustedResourceUrl.stringifyParams_=function(X,Z,_){if(_==null)return Z;if(typeof _=="string")return _?X+encodeURIComponent(_):"";for(var K in _){var te=_[K];te=Array.isArray(te)?te:[te];for(var ne=0;ne<te.length;ne++){var ie=te[ne];ie!=null&&(Z||(Z=X),Z+=(Z.length>X.length?"&":"")+encodeURIComponent(K)+"="+encodeURIComponent(String(ie)))}}return Z},goog.html.TrustedResourceUrl.CONSTRUCTOR_TOKEN_PRIVATE_={},goog.string.internal={},goog.string.internal.startsWith=function(X,Z){return X.lastIndexOf(Z,0)==0},goog.string.internal.endsWith=function(X,Z){var _=X.length-Z.length;return 0<=_&&X.indexOf(Z,_)==_},goog.string.internal.caseInsensitiveStartsWith=function(X,Z){return goog.string.internal.caseInsensitiveCompare(Z,X.substr(0,Z.length))==0},goog.string.internal.caseInsensitiveEndsWith=function(X,Z){return goog.string.internal.caseInsensitiveCompare(Z,X.substr(X.length-Z.length,Z.length))==0},goog.string.internal.caseInsensitiveEquals=function(X,Z){return X.toLowerCase()==Z.toLowerCase()},goog.string.internal.isEmptyOrWhitespace=function(X){return/^[\s\xa0]*$/.test(X)},goog.string.internal.trim=goog.TRUSTED_SITE&&String.prototype.trim?function(X){return X.trim()}:function(X){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(X)[1]},goog.string.internal.caseInsensitiveCompare=function(X,Z){return(X=String(X).toLowerCase())<(Z=String(Z).toLowerCase())?-1:X==Z?0:1},goog.string.internal.newLineToBr=function(X,Z){return X.replace(/(\r\n|\r|\n)/g,Z?"<br />":"<br>")},goog.string.internal.htmlEscape=function(X,Z){if(Z)X=X.replace(goog.string.internal.AMP_RE_,"&amp;").replace(goog.string.internal.LT_RE_,"&lt;").replace(goog.string.internal.GT_RE_,"&gt;").replace(goog.string.internal.QUOT_RE_,"&quot;").replace(goog.string.internal.SINGLE_QUOTE_RE_,"&#39;").replace(goog.string.internal.NULL_RE_,"&#0;");else{if(!goog.string.internal.ALL_RE_.test(X))return X;X.indexOf("&")!=-1&&(X=X.replace(goog.string.internal.AMP_RE_,"&amp;")),X.indexOf("<")!=-1&&(X=X.replace(goog.string.internal.LT_RE_,"&lt;")),X.indexOf(">")!=-1&&(X=X.replace(goog.string.internal.GT_RE_,"&gt;")),X.indexOf('"')!=-1&&(X=X.replace(goog.string.internal.QUOT_RE_,"&quot;")),X.indexOf("'")!=-1&&(X=X.replace(goog.string.internal.SINGLE_QUOTE_RE_,"&#39;")),X.indexOf("\0")!=-1&&(X=X.replace(goog.string.internal.NULL_RE_,"&#0;"))}return X},goog.string.internal.AMP_RE_=/&/g,goog.string.internal.LT_RE_=/</g,goog.string.internal.GT_RE_=/>/g,goog.string.internal.QUOT_RE_=/"/g,goog.string.internal.SINGLE_QUOTE_RE_=/'/g,goog.string.internal.NULL_RE_=/\x00/g,goog.string.internal.ALL_RE_=/[\x00&<>"']/,goog.string.internal.whitespaceEscape=function(X,Z){return goog.string.internal.newLineToBr(X.replace(/  /g," &#160;"),Z)},goog.string.internal.contains=function(X,Z){return X.indexOf(Z)!=-1},goog.string.internal.caseInsensitiveContains=function(X,Z){return goog.string.internal.contains(X.toLowerCase(),Z.toLowerCase())},goog.string.internal.compareVersions=function(X,Z){var _=0;X=goog.string.internal.trim(String(X)).split("."),Z=goog.string.internal.trim(String(Z)).split(".");for(var K=Math.max(X.length,Z.length),te=0;_==0&&te<K;te++){var ne=X[te]||"",ie=Z[te]||"";do{if(ne=/(\d*)(\D*)(.*)/.exec(ne)||["","","",""],ie=/(\d*)(\D*)(.*)/.exec(ie)||["","","",""],ne[0].length==0&&ie[0].length==0)break;_=ne[1].length==0?0:parseInt(ne[1],10);var oe=ie[1].length==0?0:parseInt(ie[1],10);_=goog.string.internal.compareElements_(_,oe)||goog.string.internal.compareElements_(ne[2].length==0,ie[2].length==0)||goog.string.internal.compareElements_(ne[2],ie[2]),ne=ne[3],ie=ie[3]}while(_==0)}return _},goog.string.internal.compareElements_=function(X,Z){return X<Z?-1:X>Z?1:0},goog.html.SafeUrl=function(X,Z){this.privateDoNotAccessOrElseSafeUrlWrappedValue_=X===goog.html.SafeUrl.CONSTRUCTOR_TOKEN_PRIVATE_&&Z||"",this.SAFE_URL_TYPE_MARKER_GOOG_HTML_SECURITY_PRIVATE_=goog.html.SafeUrl.TYPE_MARKER_GOOG_HTML_SECURITY_PRIVATE_},goog.html.SafeUrl.INNOCUOUS_STRING="about:invalid#zClosurez",goog.html.SafeUrl.prototype.implementsGoogStringTypedString=!0,goog.html.SafeUrl.prototype.getTypedStringValue=function(){return this.privateDoNotAccessOrElseSafeUrlWrappedValue_.toString()},goog.html.SafeUrl.prototype.implementsGoogI18nBidiDirectionalString=!0,goog.html.SafeUrl.prototype.getDirection=function(){return goog.i18n.bidi.Dir.LTR},goog.DEBUG&&(goog.html.SafeUrl.prototype.toString=function(){return"SafeUrl{"+this.privateDoNotAccessOrElseSafeUrlWrappedValue_+"}"}),goog.html.SafeUrl.unwrap=function(X){return X instanceof goog.html.SafeUrl&&X.constructor===goog.html.SafeUrl&&X.SAFE_URL_TYPE_MARKER_GOOG_HTML_SECURITY_PRIVATE_===goog.html.SafeUrl.TYPE_MARKER_GOOG_HTML_SECURITY_PRIVATE_?X.privateDoNotAccessOrElseSafeUrlWrappedValue_:(goog.asserts.fail("expected object of type SafeUrl, got '"+X+"' of type "+goog.typeOf(X)),"type_error:SafeUrl")},goog.html.SafeUrl.fromConstant=function(X){return goog.html.SafeUrl.createSafeUrlSecurityPrivateDoNotAccessOrElse(goog.string.Const.unwrap(X))},goog.html.SAFE_MIME_TYPE_PATTERN_=/^(?:audio\/(?:3gpp2|3gpp|aac|L16|midi|mp3|mp4|mpeg|oga|ogg|opus|x-m4a|x-matroska|x-wav|wav|webm)|image\/(?:bmp|gif|jpeg|jpg|png|tiff|webp|x-icon)|text\/csv|video\/(?:mpeg|mp4|ogg|webm|quicktime|x-matroska))(?:;\w+=(?:\w+|"[\w;,= ]+"))*$/i,goog.html.SafeUrl.isSafeMimeType=function(X){return goog.html.SAFE_MIME_TYPE_PATTERN_.test(X)},goog.html.SafeUrl.fromBlob=function(X){return X=goog.html.SafeUrl.isSafeMimeType(X.type)?goog.fs.url.createObjectUrl(X):goog.html.SafeUrl.INNOCUOUS_STRING,goog.html.SafeUrl.createSafeUrlSecurityPrivateDoNotAccessOrElse(X)},goog.html.SafeUrl.fromMediaSource=function(X){return goog.asserts.assert("MediaSource"in goog.global,"No support for MediaSource"),X=X instanceof MediaSource?goog.fs.url.createObjectUrl(X):goog.html.SafeUrl.INNOCUOUS_STRING,goog.html.SafeUrl.createSafeUrlSecurityPrivateDoNotAccessOrElse(X)},goog.html.DATA_URL_PATTERN_=/^data:(.*);base64,[a-z0-9+\/]+=*$/i,goog.html.SafeUrl.fromDataUrl=function(X){var Z=(X=X.replace(/(%0A|%0D)/g,"")).match(goog.html.DATA_URL_PATTERN_);return Z=Z&&goog.html.SafeUrl.isSafeMimeType(Z[1]),goog.html.SafeUrl.createSafeUrlSecurityPrivateDoNotAccessOrElse(Z?X:goog.html.SafeUrl.INNOCUOUS_STRING)},goog.html.SafeUrl.fromTelUrl=function(X){return goog.string.internal.caseInsensitiveStartsWith(X,"tel:")||(X=goog.html.SafeUrl.INNOCUOUS_STRING),goog.html.SafeUrl.createSafeUrlSecurityPrivateDoNotAccessOrElse(X)},goog.html.SIP_URL_PATTERN_=/^sip[s]?:[+a-z0-9_.!$%&'*\/=^`{|}~-]+@([a-z0-9-]+\.)+[a-z0-9]{2,63}$/i,goog.html.SafeUrl.fromSipUrl=function(X){return goog.html.SIP_URL_PATTERN_.test(decodeURIComponent(X))||(X=goog.html.SafeUrl.INNOCUOUS_STRING),goog.html.SafeUrl.createSafeUrlSecurityPrivateDoNotAccessOrElse(X)},goog.html.SafeUrl.fromFacebookMessengerUrl=function(X){return goog.string.internal.caseInsensitiveStartsWith(X,"fb-messenger://share")||(X=goog.html.SafeUrl.INNOCUOUS_STRING),goog.html.SafeUrl.createSafeUrlSecurityPrivateDoNotAccessOrElse(X)},goog.html.SafeUrl.fromWhatsAppUrl=function(X){return goog.string.internal.caseInsensitiveStartsWith(X,"whatsapp://send")||(X=goog.html.SafeUrl.INNOCUOUS_STRING),goog.html.SafeUrl.createSafeUrlSecurityPrivateDoNotAccessOrElse(X)},goog.html.SafeUrl.fromSmsUrl=function(X){return goog.string.internal.caseInsensitiveStartsWith(X,"sms:")&&goog.html.SafeUrl.isSmsUrlBodyValid_(X)||(X=goog.html.SafeUrl.INNOCUOUS_STRING),goog.html.SafeUrl.createSafeUrlSecurityPrivateDoNotAccessOrElse(X)},goog.html.SafeUrl.isSmsUrlBodyValid_=function(X){var Z=X.indexOf("#");if(0<Z&&(X=X.substring(0,Z)),!(Z=X.match(/[?&]body=/gi)))return!0;if(1<Z.length)return!1;if(!(X=X.match(/[?&]body=([^&]*)/)[1]))return!0;try{decodeURIComponent(X)}catch{return!1}return/^(?:[a-z0-9\-_.~]|%[0-9a-f]{2})+$/i.test(X)},goog.html.SafeUrl.fromSshUrl=function(X){return goog.string.internal.caseInsensitiveStartsWith(X,"ssh://")||(X=goog.html.SafeUrl.INNOCUOUS_STRING),goog.html.SafeUrl.createSafeUrlSecurityPrivateDoNotAccessOrElse(X)},goog.html.SafeUrl.sanitizeChromeExtensionUrl=function(X,Z){return goog.html.SafeUrl.sanitizeExtensionUrl_(/^chrome-extension:\/\/([^\/]+)\//,X,Z)},goog.html.SafeUrl.sanitizeFirefoxExtensionUrl=function(X,Z){return goog.html.SafeUrl.sanitizeExtensionUrl_(/^moz-extension:\/\/([^\/]+)\//,X,Z)},goog.html.SafeUrl.sanitizeEdgeExtensionUrl=function(X,Z){return goog.html.SafeUrl.sanitizeExtensionUrl_(/^ms-browser-extension:\/\/([^\/]+)\//,X,Z)},goog.html.SafeUrl.sanitizeExtensionUrl_=function(X,Z,_){return(X=X.exec(Z))?(X=X[1],(_ instanceof goog.string.Const?[goog.string.Const.unwrap(_)]:_.map(function(K){return goog.string.Const.unwrap(K)})).indexOf(X)==-1&&(Z=goog.html.SafeUrl.INNOCUOUS_STRING)):Z=goog.html.SafeUrl.INNOCUOUS_STRING,goog.html.SafeUrl.createSafeUrlSecurityPrivateDoNotAccessOrElse(Z)},goog.html.SafeUrl.fromTrustedResourceUrl=function(X){return goog.html.SafeUrl.createSafeUrlSecurityPrivateDoNotAccessOrElse(goog.html.TrustedResourceUrl.unwrap(X))},goog.html.SAFE_URL_PATTERN_=/^(?:(?:https?|mailto|ftp):|[^:/?#]*(?:[/?#]|$))/i,goog.html.SafeUrl.SAFE_URL_PATTERN=goog.html.SAFE_URL_PATTERN_,goog.html.SafeUrl.sanitize=function(X){return X instanceof goog.html.SafeUrl?X:(X=typeof X=="object"&&X.implementsGoogStringTypedString?X.getTypedStringValue():String(X),goog.html.SAFE_URL_PATTERN_.test(X)||(X=goog.html.SafeUrl.INNOCUOUS_STRING),goog.html.SafeUrl.createSafeUrlSecurityPrivateDoNotAccessOrElse(X))},goog.html.SafeUrl.sanitizeAssertUnchanged=function(X,Z){return X instanceof goog.html.SafeUrl?X:(X=typeof X=="object"&&X.implementsGoogStringTypedString?X.getTypedStringValue():String(X),Z&&/^data:/i.test(X)&&(Z=goog.html.SafeUrl.fromDataUrl(X)).getTypedStringValue()==X?Z:(goog.asserts.assert(goog.html.SAFE_URL_PATTERN_.test(X),"%s does not match the safe URL pattern",X)||(X=goog.html.SafeUrl.INNOCUOUS_STRING),goog.html.SafeUrl.createSafeUrlSecurityPrivateDoNotAccessOrElse(X)))},goog.html.SafeUrl.TYPE_MARKER_GOOG_HTML_SECURITY_PRIVATE_={},goog.html.SafeUrl.createSafeUrlSecurityPrivateDoNotAccessOrElse=function(X){return new goog.html.SafeUrl(goog.html.SafeUrl.CONSTRUCTOR_TOKEN_PRIVATE_,X)},goog.html.SafeUrl.ABOUT_BLANK=goog.html.SafeUrl.createSafeUrlSecurityPrivateDoNotAccessOrElse("about:blank"),goog.html.SafeUrl.CONSTRUCTOR_TOKEN_PRIVATE_={},goog.html.SafeStyle=function(){this.privateDoNotAccessOrElseSafeStyleWrappedValue_="",this.SAFE_STYLE_TYPE_MARKER_GOOG_HTML_SECURITY_PRIVATE_=goog.html.SafeStyle.TYPE_MARKER_GOOG_HTML_SECURITY_PRIVATE_},goog.html.SafeStyle.prototype.implementsGoogStringTypedString=!0,goog.html.SafeStyle.TYPE_MARKER_GOOG_HTML_SECURITY_PRIVATE_={},goog.html.SafeStyle.fromConstant=function(X){return(X=goog.string.Const.unwrap(X)).length===0?goog.html.SafeStyle.EMPTY:(goog.asserts.assert(goog.string.internal.endsWith(X,";"),"Last character of style string is not ';': "+X),goog.asserts.assert(goog.string.internal.contains(X,":"),`Style string must contain at least one ':', to specify a "name: value" pair: `+X),goog.html.SafeStyle.createSafeStyleSecurityPrivateDoNotAccessOrElse(X))},goog.html.SafeStyle.prototype.getTypedStringValue=function(){return this.privateDoNotAccessOrElseSafeStyleWrappedValue_},goog.DEBUG&&(goog.html.SafeStyle.prototype.toString=function(){return"SafeStyle{"+this.privateDoNotAccessOrElseSafeStyleWrappedValue_+"}"}),goog.html.SafeStyle.unwrap=function(X){return X instanceof goog.html.SafeStyle&&X.constructor===goog.html.SafeStyle&&X.SAFE_STYLE_TYPE_MARKER_GOOG_HTML_SECURITY_PRIVATE_===goog.html.SafeStyle.TYPE_MARKER_GOOG_HTML_SECURITY_PRIVATE_?X.privateDoNotAccessOrElseSafeStyleWrappedValue_:(goog.asserts.fail("expected object of type SafeStyle, got '"+X+"' of type "+goog.typeOf(X)),"type_error:SafeStyle")},goog.html.SafeStyle.createSafeStyleSecurityPrivateDoNotAccessOrElse=function(X){return new goog.html.SafeStyle().initSecurityPrivateDoNotAccessOrElse_(X)},goog.html.SafeStyle.prototype.initSecurityPrivateDoNotAccessOrElse_=function(X){return this.privateDoNotAccessOrElseSafeStyleWrappedValue_=X,this},goog.html.SafeStyle.EMPTY=goog.html.SafeStyle.createSafeStyleSecurityPrivateDoNotAccessOrElse(""),goog.html.SafeStyle.INNOCUOUS_STRING="zClosurez",goog.html.SafeStyle.create=function(X){var Z,_="";for(Z in X){if(!/^[-_a-zA-Z0-9]+$/.test(Z))throw Error("Name allows only [-_a-zA-Z0-9], got: "+Z);var K=X[Z];K!=null&&(_+=Z+":"+(K=Array.isArray(K)?goog.array.map(K,goog.html.SafeStyle.sanitizePropertyValue_).join(" "):goog.html.SafeStyle.sanitizePropertyValue_(K))+";")}return _?goog.html.SafeStyle.createSafeStyleSecurityPrivateDoNotAccessOrElse(_):goog.html.SafeStyle.EMPTY},goog.html.SafeStyle.sanitizePropertyValue_=function(X){if(X instanceof goog.html.SafeUrl)return'url("'+goog.html.SafeUrl.unwrap(X).replace(/</g,"%3c").replace(/[\\"]/g,"\\$&")+'")';if(X=X instanceof goog.string.Const?goog.string.Const.unwrap(X):goog.html.SafeStyle.sanitizePropertyValueString_(String(X)),/[{;}]/.test(X))throw new goog.asserts.AssertionError("Value does not allow [{;}], got: %s.",[X]);return X},goog.html.SafeStyle.sanitizePropertyValueString_=function(X){var Z=X.replace(goog.html.SafeStyle.FUNCTIONS_RE_,"$1").replace(goog.html.SafeStyle.FUNCTIONS_RE_,"$1").replace(goog.html.SafeStyle.URL_RE_,"url");return goog.html.SafeStyle.VALUE_RE_.test(Z)?goog.html.SafeStyle.COMMENT_RE_.test(X)?(goog.asserts.fail("String value disallows comments, got: "+X),goog.html.SafeStyle.INNOCUOUS_STRING):goog.html.SafeStyle.hasBalancedQuotes_(X)?goog.html.SafeStyle.hasBalancedSquareBrackets_(X)?goog.html.SafeStyle.sanitizeUrl_(X):(goog.asserts.fail("String value requires balanced square brackets and one identifier per pair of brackets, got: "+X),goog.html.SafeStyle.INNOCUOUS_STRING):(goog.asserts.fail("String value requires balanced quotes, got: "+X),goog.html.SafeStyle.INNOCUOUS_STRING):(goog.asserts.fail("String value allows only "+goog.html.SafeStyle.VALUE_ALLOWED_CHARS_+" and simple functions, got: "+X),goog.html.SafeStyle.INNOCUOUS_STRING)},goog.html.SafeStyle.hasBalancedQuotes_=function(X){for(var Z=!0,_=!0,K=0;K<X.length;K++){var te=X.charAt(K);te=="'"&&_?Z=!Z:te=='"'&&Z&&(_=!_)}return Z&&_},goog.html.SafeStyle.hasBalancedSquareBrackets_=function(X){for(var Z=!0,_=/^[-_a-zA-Z0-9]$/,K=0;K<X.length;K++){var te=X.charAt(K);if(te=="]"){if(Z)return!1;Z=!0}else if(te=="["){if(!Z)return!1;Z=!1}else if(!Z&&!_.test(te))return!1}return Z},goog.html.SafeStyle.VALUE_ALLOWED_CHARS_=`[-,."'%_!# a-zA-Z0-9\\[\\]]`,goog.html.SafeStyle.VALUE_RE_=new RegExp("^"+goog.html.SafeStyle.VALUE_ALLOWED_CHARS_+"+$"),goog.html.SafeStyle.URL_RE_=/\b(url\([ \t\n]*)('[ -&(-\[\]-~]*'|"[ !#-\[\]-~]*"|[!#-&*-\[\]-~]*)([ \t\n]*\))/g,goog.html.SafeStyle.ALLOWED_FUNCTIONS_="calc cubic-bezier fit-content hsl hsla linear-gradient matrix minmax repeat rgb rgba (rotate|scale|translate)(X|Y|Z|3d)?".split(" "),goog.html.SafeStyle.FUNCTIONS_RE_=new RegExp("\\b("+goog.html.SafeStyle.ALLOWED_FUNCTIONS_.join("|")+")\\([-+*/0-9a-z.%\\[\\], ]+\\)","g"),goog.html.SafeStyle.COMMENT_RE_=/\/\*/,goog.html.SafeStyle.sanitizeUrl_=function(X){return X.replace(goog.html.SafeStyle.URL_RE_,function(Z,_,K,te){var ne="";return K=K.replace(/^(['"])(.*)\1$/,function(ie,oe,se){return ne=oe,se}),Z=goog.html.SafeUrl.sanitize(K).getTypedStringValue(),_+ne+Z+ne+te})},goog.html.SafeStyle.concat=function(X){var Z="",_=function(K){Array.isArray(K)?goog.array.forEach(K,_):Z+=goog.html.SafeStyle.unwrap(K)};return goog.array.forEach(arguments,_),Z?goog.html.SafeStyle.createSafeStyleSecurityPrivateDoNotAccessOrElse(Z):goog.html.SafeStyle.EMPTY},goog.html.SafeStyleSheet=function(){this.privateDoNotAccessOrElseSafeStyleSheetWrappedValue_="",this.SAFE_STYLE_SHEET_TYPE_MARKER_GOOG_HTML_SECURITY_PRIVATE_=goog.html.SafeStyleSheet.TYPE_MARKER_GOOG_HTML_SECURITY_PRIVATE_},goog.html.SafeStyleSheet.prototype.implementsGoogStringTypedString=!0,goog.html.SafeStyleSheet.TYPE_MARKER_GOOG_HTML_SECURITY_PRIVATE_={},goog.html.SafeStyleSheet.createRule=function(X,Z){if(goog.string.internal.contains(X,"<"))throw Error("Selector does not allow '<', got: "+X);var _=X.replace(/('|")((?!\1)[^\r\n\f\\]|\\[\s\S])*\1/g,"");if(!/^[-_a-zA-Z0-9#.:* ,>+~[\]()=^$|]+$/.test(_))throw Error("Selector allows only [-_a-zA-Z0-9#.:* ,>+~[\\]()=^$|] and strings, got: "+X);if(!goog.html.SafeStyleSheet.hasBalancedBrackets_(_))throw Error("() and [] in selector must be balanced, got: "+X);return Z instanceof goog.html.SafeStyle||(Z=goog.html.SafeStyle.create(Z)),X=X+"{"+goog.html.SafeStyle.unwrap(Z).replace(/</g,"\\3C ")+"}",goog.html.SafeStyleSheet.createSafeStyleSheetSecurityPrivateDoNotAccessOrElse(X)},goog.html.SafeStyleSheet.hasBalancedBrackets_=function(X){for(var Z={"(":")","[":"]"},_=[],K=0;K<X.length;K++){var te=X[K];if(Z[te])_.push(Z[te]);else if(goog.object.contains(Z,te)&&_.pop()!=te)return!1}return _.length==0},goog.html.SafeStyleSheet.concat=function(X){var Z="",_=function(K){Array.isArray(K)?goog.array.forEach(K,_):Z+=goog.html.SafeStyleSheet.unwrap(K)};return goog.array.forEach(arguments,_),goog.html.SafeStyleSheet.createSafeStyleSheetSecurityPrivateDoNotAccessOrElse(Z)},goog.html.SafeStyleSheet.fromConstant=function(X){return(X=goog.string.Const.unwrap(X)).length===0?goog.html.SafeStyleSheet.EMPTY:(goog.asserts.assert(!goog.string.internal.contains(X,"<"),"Forbidden '<' character in style sheet string: "+X),goog.html.SafeStyleSheet.createSafeStyleSheetSecurityPrivateDoNotAccessOrElse(X))},goog.html.SafeStyleSheet.prototype.getTypedStringValue=function(){return this.privateDoNotAccessOrElseSafeStyleSheetWrappedValue_},goog.DEBUG&&(goog.html.SafeStyleSheet.prototype.toString=function(){return"SafeStyleSheet{"+this.privateDoNotAccessOrElseSafeStyleSheetWrappedValue_+"}"}),goog.html.SafeStyleSheet.unwrap=function(X){return X instanceof goog.html.SafeStyleSheet&&X.constructor===goog.html.SafeStyleSheet&&X.SAFE_STYLE_SHEET_TYPE_MARKER_GOOG_HTML_SECURITY_PRIVATE_===goog.html.SafeStyleSheet.TYPE_MARKER_GOOG_HTML_SECURITY_PRIVATE_?X.privateDoNotAccessOrElseSafeStyleSheetWrappedValue_:(goog.asserts.fail("expected object of type SafeStyleSheet, got '"+X+"' of type "+goog.typeOf(X)),"type_error:SafeStyleSheet")},goog.html.SafeStyleSheet.createSafeStyleSheetSecurityPrivateDoNotAccessOrElse=function(X){return new goog.html.SafeStyleSheet().initSecurityPrivateDoNotAccessOrElse_(X)},goog.html.SafeStyleSheet.prototype.initSecurityPrivateDoNotAccessOrElse_=function(X){return this.privateDoNotAccessOrElseSafeStyleSheetWrappedValue_=X,this},goog.html.SafeStyleSheet.EMPTY=goog.html.SafeStyleSheet.createSafeStyleSheetSecurityPrivateDoNotAccessOrElse(""),goog.labs={},goog.labs.userAgent={},goog.labs.userAgent.util={},goog.labs.userAgent.util.getNativeUserAgentString_=function(){var X=goog.labs.userAgent.util.getNavigator_();return X&&(X=X.userAgent)?X:""},goog.labs.userAgent.util.getNavigator_=function(){return goog.global.navigator},goog.labs.userAgent.util.userAgent_=goog.labs.userAgent.util.getNativeUserAgentString_(),goog.labs.userAgent.util.setUserAgent=function(X){goog.labs.userAgent.util.userAgent_=X||goog.labs.userAgent.util.getNativeUserAgentString_()},goog.labs.userAgent.util.getUserAgent=function(){return goog.labs.userAgent.util.userAgent_},goog.labs.userAgent.util.matchUserAgent=function(X){var Z=goog.labs.userAgent.util.getUserAgent();return goog.string.internal.contains(Z,X)},goog.labs.userAgent.util.matchUserAgentIgnoreCase=function(X){var Z=goog.labs.userAgent.util.getUserAgent();return goog.string.internal.caseInsensitiveContains(Z,X)},goog.labs.userAgent.util.extractVersionTuples=function(X){for(var Z,_=/(\w[\w ]+)\/([^\s]+)\s*(?:\((.*?)\))?/g,K=[];Z=_.exec(X);)K.push([Z[1],Z[2],Z[3]||void 0]);return K},goog.labs.userAgent.browser={},goog.labs.userAgent.browser.matchOpera_=function(){return goog.labs.userAgent.util.matchUserAgent("Opera")},goog.labs.userAgent.browser.matchIE_=function(){return goog.labs.userAgent.util.matchUserAgent("Trident")||goog.labs.userAgent.util.matchUserAgent("MSIE")},goog.labs.userAgent.browser.matchEdgeHtml_=function(){return goog.labs.userAgent.util.matchUserAgent("Edge")},goog.labs.userAgent.browser.matchEdgeChromium_=function(){return goog.labs.userAgent.util.matchUserAgent("Edg/")},goog.labs.userAgent.browser.matchOperaChromium_=function(){return goog.labs.userAgent.util.matchUserAgent("OPR")},goog.labs.userAgent.browser.matchFirefox_=function(){return goog.labs.userAgent.util.matchUserAgent("Firefox")||goog.labs.userAgent.util.matchUserAgent("FxiOS")},goog.labs.userAgent.browser.matchSafari_=function(){return goog.labs.userAgent.util.matchUserAgent("Safari")&&!(goog.labs.userAgent.browser.matchChrome_()||goog.labs.userAgent.browser.matchCoast_()||goog.labs.userAgent.browser.matchOpera_()||goog.labs.userAgent.browser.matchEdgeHtml_()||goog.labs.userAgent.browser.matchEdgeChromium_()||goog.labs.userAgent.browser.matchOperaChromium_()||goog.labs.userAgent.browser.matchFirefox_()||goog.labs.userAgent.browser.isSilk()||goog.labs.userAgent.util.matchUserAgent("Android"))},goog.labs.userAgent.browser.matchCoast_=function(){return goog.labs.userAgent.util.matchUserAgent("Coast")},goog.labs.userAgent.browser.matchIosWebview_=function(){return(goog.labs.userAgent.util.matchUserAgent("iPad")||goog.labs.userAgent.util.matchUserAgent("iPhone"))&&!goog.labs.userAgent.browser.matchSafari_()&&!goog.labs.userAgent.browser.matchChrome_()&&!goog.labs.userAgent.browser.matchCoast_()&&!goog.labs.userAgent.browser.matchFirefox_()&&goog.labs.userAgent.util.matchUserAgent("AppleWebKit")},goog.labs.userAgent.browser.matchChrome_=function(){return(goog.labs.userAgent.util.matchUserAgent("Chrome")||goog.labs.userAgent.util.matchUserAgent("CriOS"))&&!goog.labs.userAgent.browser.matchEdgeHtml_()},goog.labs.userAgent.browser.matchAndroidBrowser_=function(){return goog.labs.userAgent.util.matchUserAgent("Android")&&!(goog.labs.userAgent.browser.isChrome()||goog.labs.userAgent.browser.isFirefox()||goog.labs.userAgent.browser.isOpera()||goog.labs.userAgent.browser.isSilk())},goog.labs.userAgent.browser.isOpera=goog.labs.userAgent.browser.matchOpera_,goog.labs.userAgent.browser.isIE=goog.labs.userAgent.browser.matchIE_,goog.labs.userAgent.browser.isEdge=goog.labs.userAgent.browser.matchEdgeHtml_,goog.labs.userAgent.browser.isEdgeChromium=goog.labs.userAgent.browser.matchEdgeChromium_,goog.labs.userAgent.browser.isOperaChromium=goog.labs.userAgent.browser.matchOperaChromium_,goog.labs.userAgent.browser.isFirefox=goog.labs.userAgent.browser.matchFirefox_,goog.labs.userAgent.browser.isSafari=goog.labs.userAgent.browser.matchSafari_,goog.labs.userAgent.browser.isCoast=goog.labs.userAgent.browser.matchCoast_,goog.labs.userAgent.browser.isIosWebview=goog.labs.userAgent.browser.matchIosWebview_,goog.labs.userAgent.browser.isChrome=goog.labs.userAgent.browser.matchChrome_,goog.labs.userAgent.browser.isAndroidBrowser=goog.labs.userAgent.browser.matchAndroidBrowser_,goog.labs.userAgent.browser.isSilk=function(){return goog.labs.userAgent.util.matchUserAgent("Silk")},goog.labs.userAgent.browser.getVersion=function(){function X(te){return te=goog.array.find(te,K),_[te]||""}var Z=goog.labs.userAgent.util.getUserAgent();if(goog.labs.userAgent.browser.isIE())return goog.labs.userAgent.browser.getIEVersion_(Z);Z=goog.labs.userAgent.util.extractVersionTuples(Z);var _={};goog.array.forEach(Z,function(te){_[te[0]]=te[1]});var K=goog.partial(goog.object.containsKey,_);return goog.labs.userAgent.browser.isOpera()?X(["Version","Opera"]):goog.labs.userAgent.browser.isEdge()?X(["Edge"]):goog.labs.userAgent.browser.isEdgeChromium()?X(["Edg"]):goog.labs.userAgent.browser.isChrome()?X(["Chrome","CriOS","HeadlessChrome"]):(Z=Z[2])&&Z[1]||""},goog.labs.userAgent.browser.isVersionOrHigher=function(X){return 0<=goog.string.internal.compareVersions(goog.labs.userAgent.browser.getVersion(),X)},goog.labs.userAgent.browser.getIEVersion_=function(X){var Z=/rv: *([\d\.]*)/.exec(X);if(Z&&Z[1])return Z[1];Z="";var _=/MSIE +([\d\.]+)/.exec(X);if(_&&_[1])if(X=/Trident\/(\d.\d)/.exec(X),_[1]=="7.0")if(X&&X[1])switch(X[1]){case"4.0":Z="8.0";break;case"5.0":Z="9.0";break;case"6.0":Z="10.0";break;case"7.0":Z="11.0"}else Z="7.0";else Z=_[1];return Z},goog.html.SafeHtml=function(){this.privateDoNotAccessOrElseSafeHtmlWrappedValue_="",this.SAFE_HTML_TYPE_MARKER_GOOG_HTML_SECURITY_PRIVATE_=goog.html.SafeHtml.TYPE_MARKER_GOOG_HTML_SECURITY_PRIVATE_,this.dir_=null},goog.html.SafeHtml.ENABLE_ERROR_MESSAGES=goog.DEBUG,goog.html.SafeHtml.SUPPORT_STYLE_ATTRIBUTE=!0,goog.html.SafeHtml.prototype.implementsGoogI18nBidiDirectionalString=!0,goog.html.SafeHtml.prototype.getDirection=function(){return this.dir_},goog.html.SafeHtml.prototype.implementsGoogStringTypedString=!0,goog.html.SafeHtml.prototype.getTypedStringValue=function(){return this.privateDoNotAccessOrElseSafeHtmlWrappedValue_.toString()},goog.DEBUG&&(goog.html.SafeHtml.prototype.toString=function(){return"SafeHtml{"+this.privateDoNotAccessOrElseSafeHtmlWrappedValue_+"}"}),goog.html.SafeHtml.unwrap=function(X){return goog.html.SafeHtml.unwrapTrustedHTML(X).toString()},goog.html.SafeHtml.unwrapTrustedHTML=function(X){return X instanceof goog.html.SafeHtml&&X.constructor===goog.html.SafeHtml&&X.SAFE_HTML_TYPE_MARKER_GOOG_HTML_SECURITY_PRIVATE_===goog.html.SafeHtml.TYPE_MARKER_GOOG_HTML_SECURITY_PRIVATE_?X.privateDoNotAccessOrElseSafeHtmlWrappedValue_:(goog.asserts.fail("expected object of type SafeHtml, got '"+X+"' of type "+goog.typeOf(X)),"type_error:SafeHtml")},goog.html.SafeHtml.htmlEscape=function(X){if(X instanceof goog.html.SafeHtml)return X;var Z=typeof X=="object",_=null;return Z&&X.implementsGoogI18nBidiDirectionalString&&(_=X.getDirection()),X=Z&&X.implementsGoogStringTypedString?X.getTypedStringValue():String(X),goog.html.SafeHtml.createSafeHtmlSecurityPrivateDoNotAccessOrElse(goog.string.internal.htmlEscape(X),_)},goog.html.SafeHtml.htmlEscapePreservingNewlines=function(X){return X instanceof goog.html.SafeHtml?X:(X=goog.html.SafeHtml.htmlEscape(X),goog.html.SafeHtml.createSafeHtmlSecurityPrivateDoNotAccessOrElse(goog.string.internal.newLineToBr(goog.html.SafeHtml.unwrap(X)),X.getDirection()))},goog.html.SafeHtml.htmlEscapePreservingNewlinesAndSpaces=function(X){return X instanceof goog.html.SafeHtml?X:(X=goog.html.SafeHtml.htmlEscape(X),goog.html.SafeHtml.createSafeHtmlSecurityPrivateDoNotAccessOrElse(goog.string.internal.whitespaceEscape(goog.html.SafeHtml.unwrap(X)),X.getDirection()))},goog.html.SafeHtml.from=goog.html.SafeHtml.htmlEscape,goog.html.SafeHtml.comment=function(X){return goog.html.SafeHtml.createSafeHtmlSecurityPrivateDoNotAccessOrElse("<!--"+goog.string.internal.htmlEscape(X)+"-->",null)},goog.html.SafeHtml.VALID_NAMES_IN_TAG_=/^[a-zA-Z0-9-]+$/,goog.html.SafeHtml.URL_ATTRIBUTES_={action:!0,cite:!0,data:!0,formaction:!0,href:!0,manifest:!0,poster:!0,src:!0},goog.html.SafeHtml.NOT_ALLOWED_TAG_NAMES_={APPLET:!0,BASE:!0,EMBED:!0,IFRAME:!0,LINK:!0,MATH:!0,META:!0,OBJECT:!0,SCRIPT:!0,STYLE:!0,SVG:!0,TEMPLATE:!0},goog.html.SafeHtml.create=function(X,Z,_){return goog.html.SafeHtml.verifyTagName(String(X)),goog.html.SafeHtml.createSafeHtmlTagSecurityPrivateDoNotAccessOrElse(String(X),Z,_)},goog.html.SafeHtml.verifyTagName=function(X){if(!goog.html.SafeHtml.VALID_NAMES_IN_TAG_.test(X))throw Error(goog.html.SafeHtml.ENABLE_ERROR_MESSAGES?"Invalid tag name <"+X+">.":"");if(X.toUpperCase()in goog.html.SafeHtml.NOT_ALLOWED_TAG_NAMES_)throw Error(goog.html.SafeHtml.ENABLE_ERROR_MESSAGES?"Tag name <"+X+"> is not allowed for SafeHtml.":"")},goog.html.SafeHtml.createIframe=function(X,Z,_,K){X&&goog.html.TrustedResourceUrl.unwrap(X);var te={};return te.src=X||null,te.srcdoc=Z&&goog.html.SafeHtml.unwrap(Z),X=goog.html.SafeHtml.combineAttributes(te,{sandbox:""},_),goog.html.SafeHtml.createSafeHtmlTagSecurityPrivateDoNotAccessOrElse("iframe",X,K)},goog.html.SafeHtml.createSandboxIframe=function(X,Z,_,K){if(!goog.html.SafeHtml.canUseSandboxIframe())throw Error(goog.html.SafeHtml.ENABLE_ERROR_MESSAGES?"The browser does not support sandboxed iframes.":"");var te={};return te.src=X?goog.html.SafeUrl.unwrap(goog.html.SafeUrl.sanitize(X)):null,te.srcdoc=Z||null,te.sandbox="",X=goog.html.SafeHtml.combineAttributes(te,{},_),goog.html.SafeHtml.createSafeHtmlTagSecurityPrivateDoNotAccessOrElse("iframe",X,K)},goog.html.SafeHtml.canUseSandboxIframe=function(){return goog.global.HTMLIFrameElement&&"sandbox"in goog.global.HTMLIFrameElement.prototype},goog.html.SafeHtml.createScriptSrc=function(X,Z){return goog.html.TrustedResourceUrl.unwrap(X),X=goog.html.SafeHtml.combineAttributes({src:X},{},Z),goog.html.SafeHtml.createSafeHtmlTagSecurityPrivateDoNotAccessOrElse("script",X)},goog.html.SafeHtml.createScript=function(X,Z){for(var _ in Z){var K=_.toLowerCase();if(K=="language"||K=="src"||K=="text"||K=="type")throw Error(goog.html.SafeHtml.ENABLE_ERROR_MESSAGES?'Cannot set "'+K+'" attribute':"")}for(_="",X=goog.array.concat(X),K=0;K<X.length;K++)_+=goog.html.SafeScript.unwrap(X[K]);return X=goog.html.SafeHtml.createSafeHtmlSecurityPrivateDoNotAccessOrElse(_,goog.i18n.bidi.Dir.NEUTRAL),goog.html.SafeHtml.createSafeHtmlTagSecurityPrivateDoNotAccessOrElse("script",Z,X)},goog.html.SafeHtml.createStyle=function(X,Z){Z=goog.html.SafeHtml.combineAttributes({type:"text/css"},{},Z);var _="";X=goog.array.concat(X);for(var K=0;K<X.length;K++)_+=goog.html.SafeStyleSheet.unwrap(X[K]);return X=goog.html.SafeHtml.createSafeHtmlSecurityPrivateDoNotAccessOrElse(_,goog.i18n.bidi.Dir.NEUTRAL),goog.html.SafeHtml.createSafeHtmlTagSecurityPrivateDoNotAccessOrElse("style",Z,X)},goog.html.SafeHtml.createMetaRefresh=function(X,Z){return X=goog.html.SafeUrl.unwrap(goog.html.SafeUrl.sanitize(X)),(goog.labs.userAgent.browser.isIE()||goog.labs.userAgent.browser.isEdge())&&goog.string.internal.contains(X,";")&&(X="'"+X.replace(/'/g,"%27")+"'"),goog.html.SafeHtml.createSafeHtmlTagSecurityPrivateDoNotAccessOrElse("meta",{"http-equiv":"refresh",content:(Z||0)+"; url="+X})},goog.html.SafeHtml.getAttrNameAndValue_=function(X,Z,_){if(_ instanceof goog.string.Const)_=goog.string.Const.unwrap(_);else if(Z.toLowerCase()=="style"){if(!goog.html.SafeHtml.SUPPORT_STYLE_ATTRIBUTE)throw Error(goog.html.SafeHtml.ENABLE_ERROR_MESSAGES?'Attribute "style" not supported.':"");_=goog.html.SafeHtml.getStyleValue_(_)}else{if(/^on/i.test(Z))throw Error(goog.html.SafeHtml.ENABLE_ERROR_MESSAGES?'Attribute "'+Z+'" requires goog.string.Const value, "'+_+'" given.':"");if(Z.toLowerCase()in goog.html.SafeHtml.URL_ATTRIBUTES_)if(_ instanceof goog.html.TrustedResourceUrl)_=goog.html.TrustedResourceUrl.unwrap(_);else if(_ instanceof goog.html.SafeUrl)_=goog.html.SafeUrl.unwrap(_);else{if(typeof _!="string")throw Error(goog.html.SafeHtml.ENABLE_ERROR_MESSAGES?'Attribute "'+Z+'" on tag "'+X+'" requires goog.html.SafeUrl, goog.string.Const, or string, value "'+_+'" given.':"");_=goog.html.SafeUrl.sanitize(_).getTypedStringValue()}}return _.implementsGoogStringTypedString&&(_=_.getTypedStringValue()),goog.asserts.assert(typeof _=="string"||typeof _=="number","String or number value expected, got "+typeof _+" with value: "+_),Z+'="'+goog.string.internal.htmlEscape(String(_))+'"'},goog.html.SafeHtml.getStyleValue_=function(X){if(!goog.isObject(X))throw Error(goog.html.SafeHtml.ENABLE_ERROR_MESSAGES?'The "style" attribute requires goog.html.SafeStyle or map of style properties, '+typeof X+" given: "+X:"");return X instanceof goog.html.SafeStyle||(X=goog.html.SafeStyle.create(X)),goog.html.SafeStyle.unwrap(X)},goog.html.SafeHtml.createWithDir=function(X,Z,_,K){return(Z=goog.html.SafeHtml.create(Z,_,K)).dir_=X,Z},goog.html.SafeHtml.join=function(X,Z){var _=(X=goog.html.SafeHtml.htmlEscape(X)).getDirection(),K=[],te=function(ne){Array.isArray(ne)?goog.array.forEach(ne,te):(ne=goog.html.SafeHtml.htmlEscape(ne),K.push(goog.html.SafeHtml.unwrap(ne)),ne=ne.getDirection(),_==goog.i18n.bidi.Dir.NEUTRAL?_=ne:ne!=goog.i18n.bidi.Dir.NEUTRAL&&_!=ne&&(_=null))};return goog.array.forEach(Z,te),goog.html.SafeHtml.createSafeHtmlSecurityPrivateDoNotAccessOrElse(K.join(goog.html.SafeHtml.unwrap(X)),_)},goog.html.SafeHtml.concat=function(X){return goog.html.SafeHtml.join(goog.html.SafeHtml.EMPTY,Array.prototype.slice.call(arguments))},goog.html.SafeHtml.concatWithDir=function(X,Z){var _=goog.html.SafeHtml.concat(goog.array.slice(arguments,1));return _.dir_=X,_},goog.html.SafeHtml.TYPE_MARKER_GOOG_HTML_SECURITY_PRIVATE_={},goog.html.SafeHtml.createSafeHtmlSecurityPrivateDoNotAccessOrElse=function(X,Z){return new goog.html.SafeHtml().initSecurityPrivateDoNotAccessOrElse_(X,Z)},goog.html.SafeHtml.prototype.initSecurityPrivateDoNotAccessOrElse_=function(X,Z){return this.privateDoNotAccessOrElseSafeHtmlWrappedValue_=goog.html.trustedtypes.PRIVATE_DO_NOT_ACCESS_OR_ELSE_POLICY?goog.html.trustedtypes.PRIVATE_DO_NOT_ACCESS_OR_ELSE_POLICY.createHTML(X):X,this.dir_=Z,this},goog.html.SafeHtml.createSafeHtmlTagSecurityPrivateDoNotAccessOrElse=function(X,Z,_){var K=null,te="<"+X+goog.html.SafeHtml.stringifyAttributes(X,Z);return _==null?_=[]:Array.isArray(_)||(_=[_]),goog.dom.tags.isVoidTag(X.toLowerCase())?(goog.asserts.assert(!_.length,"Void tag <"+X+"> does not allow content."),te+=">"):(K=goog.html.SafeHtml.concat(_),te+=">"+goog.html.SafeHtml.unwrap(K)+"</"+X+">",K=K.getDirection()),(X=Z&&Z.dir)&&(K=/^(ltr|rtl|auto)$/i.test(X)?goog.i18n.bidi.Dir.NEUTRAL:null),goog.html.SafeHtml.createSafeHtmlSecurityPrivateDoNotAccessOrElse(te,K)},goog.html.SafeHtml.stringifyAttributes=function(X,Z){var _="";if(Z)for(var K in Z){if(!goog.html.SafeHtml.VALID_NAMES_IN_TAG_.test(K))throw Error(goog.html.SafeHtml.ENABLE_ERROR_MESSAGES?'Invalid attribute name "'+K+'".':"");var te=Z[K];te!=null&&(_+=" "+goog.html.SafeHtml.getAttrNameAndValue_(X,K,te))}return _},goog.html.SafeHtml.combineAttributes=function(X,Z,_){var K,te={};for(K in X)goog.asserts.assert(K.toLowerCase()==K,"Must be lower case"),te[K]=X[K];for(K in Z)goog.asserts.assert(K.toLowerCase()==K,"Must be lower case"),te[K]=Z[K];if(_)for(K in _){var ne=K.toLowerCase();if(ne in X)throw Error(goog.html.SafeHtml.ENABLE_ERROR_MESSAGES?'Cannot override "'+ne+'" attribute, got "'+K+'" with value "'+_[K]+'"':"");ne in Z&&delete te[ne],te[K]=_[K]}return te},goog.html.SafeHtml.DOCTYPE_HTML=goog.html.SafeHtml.createSafeHtmlSecurityPrivateDoNotAccessOrElse("<!DOCTYPE html>",goog.i18n.bidi.Dir.NEUTRAL),goog.html.SafeHtml.EMPTY=goog.html.SafeHtml.createSafeHtmlSecurityPrivateDoNotAccessOrElse("",goog.i18n.bidi.Dir.NEUTRAL),goog.html.SafeHtml.BR=goog.html.SafeHtml.createSafeHtmlSecurityPrivateDoNotAccessOrElse("<br>",goog.i18n.bidi.Dir.NEUTRAL),goog.html.uncheckedconversions={},goog.html.uncheckedconversions.safeHtmlFromStringKnownToSatisfyTypeContract=function(X,Z,_){return goog.asserts.assertString(goog.string.Const.unwrap(X),"must provide justification"),goog.asserts.assert(!goog.string.internal.isEmptyOrWhitespace(goog.string.Const.unwrap(X)),"must provide non-empty justification"),goog.html.SafeHtml.createSafeHtmlSecurityPrivateDoNotAccessOrElse(Z,_||null)},goog.html.uncheckedconversions.safeScriptFromStringKnownToSatisfyTypeContract=function(X,Z){return goog.asserts.assertString(goog.string.Const.unwrap(X),"must provide justification"),goog.asserts.assert(!goog.string.internal.isEmptyOrWhitespace(goog.string.Const.unwrap(X)),"must provide non-empty justification"),goog.html.SafeScript.createSafeScriptSecurityPrivateDoNotAccessOrElse(Z)},goog.html.uncheckedconversions.safeStyleFromStringKnownToSatisfyTypeContract=function(X,Z){return goog.asserts.assertString(goog.string.Const.unwrap(X),"must provide justification"),goog.asserts.assert(!goog.string.internal.isEmptyOrWhitespace(goog.string.Const.unwrap(X)),"must provide non-empty justification"),goog.html.SafeStyle.createSafeStyleSecurityPrivateDoNotAccessOrElse(Z)},goog.html.uncheckedconversions.safeStyleSheetFromStringKnownToSatisfyTypeContract=function(X,Z){return goog.asserts.assertString(goog.string.Const.unwrap(X),"must provide justification"),goog.asserts.assert(!goog.string.internal.isEmptyOrWhitespace(goog.string.Const.unwrap(X)),"must provide non-empty justification"),goog.html.SafeStyleSheet.createSafeStyleSheetSecurityPrivateDoNotAccessOrElse(Z)},goog.html.uncheckedconversions.safeUrlFromStringKnownToSatisfyTypeContract=function(X,Z){return goog.asserts.assertString(goog.string.Const.unwrap(X),"must provide justification"),goog.asserts.assert(!goog.string.internal.isEmptyOrWhitespace(goog.string.Const.unwrap(X)),"must provide non-empty justification"),goog.html.SafeUrl.createSafeUrlSecurityPrivateDoNotAccessOrElse(Z)},goog.html.uncheckedconversions.trustedResourceUrlFromStringKnownToSatisfyTypeContract=function(X,Z){return goog.asserts.assertString(goog.string.Const.unwrap(X),"must provide justification"),goog.asserts.assert(!goog.string.internal.isEmptyOrWhitespace(goog.string.Const.unwrap(X)),"must provide non-empty justification"),goog.html.TrustedResourceUrl.createTrustedResourceUrlSecurityPrivateDoNotAccessOrElse(Z)},goog.dom.safe={},goog.dom.safe.InsertAdjacentHtmlPosition={AFTERBEGIN:"afterbegin",AFTEREND:"afterend",BEFOREBEGIN:"beforebegin",BEFOREEND:"beforeend"},goog.dom.safe.insertAdjacentHtml=function(X,Z,_){X.insertAdjacentHTML(Z,goog.html.SafeHtml.unwrapTrustedHTML(_))},goog.dom.safe.SET_INNER_HTML_DISALLOWED_TAGS_={MATH:!0,SCRIPT:!0,STYLE:!0,SVG:!0,TEMPLATE:!0},goog.dom.safe.isInnerHtmlCleanupRecursive_=goog.functions.cacheReturnValue(function(){if(goog.DEBUG&&typeof document>"u")return!1;var X=document.createElement("div"),Z=document.createElement("div");return Z.appendChild(document.createElement("div")),X.appendChild(Z),!(goog.DEBUG&&!X.firstChild)&&(Z=X.firstChild.firstChild,X.innerHTML=goog.html.SafeHtml.unwrapTrustedHTML(goog.html.SafeHtml.EMPTY),!Z.parentElement)}),goog.dom.safe.unsafeSetInnerHtmlDoNotUseOrElse=function(X,Z){if(goog.dom.safe.isInnerHtmlCleanupRecursive_())for(;X.lastChild;)X.removeChild(X.lastChild);X.innerHTML=goog.html.SafeHtml.unwrapTrustedHTML(Z)},goog.dom.safe.setInnerHtml=function(X,Z){if(goog.asserts.ENABLE_ASSERTS){var _=X.tagName.toUpperCase();if(goog.dom.safe.SET_INNER_HTML_DISALLOWED_TAGS_[_])throw Error("goog.dom.safe.setInnerHtml cannot be used to set content of "+X.tagName+".")}goog.dom.safe.unsafeSetInnerHtmlDoNotUseOrElse(X,Z)},goog.dom.safe.setOuterHtml=function(X,Z){X.outerHTML=goog.html.SafeHtml.unwrapTrustedHTML(Z)},goog.dom.safe.setFormElementAction=function(X,Z){Z=Z instanceof goog.html.SafeUrl?Z:goog.html.SafeUrl.sanitizeAssertUnchanged(Z),goog.dom.asserts.assertIsHTMLFormElement(X).action=goog.html.SafeUrl.unwrap(Z)},goog.dom.safe.setButtonFormAction=function(X,Z){Z=Z instanceof goog.html.SafeUrl?Z:goog.html.SafeUrl.sanitizeAssertUnchanged(Z),goog.dom.asserts.assertIsHTMLButtonElement(X).formAction=goog.html.SafeUrl.unwrap(Z)},goog.dom.safe.setInputFormAction=function(X,Z){Z=Z instanceof goog.html.SafeUrl?Z:goog.html.SafeUrl.sanitizeAssertUnchanged(Z),goog.dom.asserts.assertIsHTMLInputElement(X).formAction=goog.html.SafeUrl.unwrap(Z)},goog.dom.safe.setStyle=function(X,Z){X.style.cssText=goog.html.SafeStyle.unwrap(Z)},goog.dom.safe.documentWrite=function(X,Z){X.write(goog.html.SafeHtml.unwrapTrustedHTML(Z))},goog.dom.safe.setAnchorHref=function(X,Z){goog.dom.asserts.assertIsHTMLAnchorElement(X),Z=Z instanceof goog.html.SafeUrl?Z:goog.html.SafeUrl.sanitizeAssertUnchanged(Z),X.href=goog.html.SafeUrl.unwrap(Z)},goog.dom.safe.setImageSrc=function(X,Z){if(goog.dom.asserts.assertIsHTMLImageElement(X),!(Z instanceof goog.html.SafeUrl)){var _=/^data:image\//i.test(Z);Z=goog.html.SafeUrl.sanitizeAssertUnchanged(Z,_)}X.src=goog.html.SafeUrl.unwrap(Z)},goog.dom.safe.setAudioSrc=function(X,Z){if(goog.dom.asserts.assertIsHTMLAudioElement(X),!(Z instanceof goog.html.SafeUrl)){var _=/^data:audio\//i.test(Z);Z=goog.html.SafeUrl.sanitizeAssertUnchanged(Z,_)}X.src=goog.html.SafeUrl.unwrap(Z)},goog.dom.safe.setVideoSrc=function(X,Z){if(goog.dom.asserts.assertIsHTMLVideoElement(X),!(Z instanceof goog.html.SafeUrl)){var _=/^data:video\//i.test(Z);Z=goog.html.SafeUrl.sanitizeAssertUnchanged(Z,_)}X.src=goog.html.SafeUrl.unwrap(Z)},goog.dom.safe.setEmbedSrc=function(X,Z){goog.dom.asserts.assertIsHTMLEmbedElement(X),X.src=goog.html.TrustedResourceUrl.unwrapTrustedScriptURL(Z)},goog.dom.safe.setFrameSrc=function(X,Z){goog.dom.asserts.assertIsHTMLFrameElement(X),X.src=goog.html.TrustedResourceUrl.unwrap(Z)},goog.dom.safe.setIframeSrc=function(X,Z){goog.dom.asserts.assertIsHTMLIFrameElement(X),X.src=goog.html.TrustedResourceUrl.unwrap(Z)},goog.dom.safe.setIframeSrcdoc=function(X,Z){goog.dom.asserts.assertIsHTMLIFrameElement(X),X.srcdoc=goog.html.SafeHtml.unwrapTrustedHTML(Z)},goog.dom.safe.setLinkHrefAndRel=function(X,Z,_){goog.dom.asserts.assertIsHTMLLinkElement(X),X.rel=_,goog.string.internal.caseInsensitiveContains(_,"stylesheet")?(goog.asserts.assert(Z instanceof goog.html.TrustedResourceUrl,'URL must be TrustedResourceUrl because "rel" contains "stylesheet"'),X.href=goog.html.TrustedResourceUrl.unwrap(Z)):X.href=Z instanceof goog.html.TrustedResourceUrl?goog.html.TrustedResourceUrl.unwrap(Z):Z instanceof goog.html.SafeUrl?goog.html.SafeUrl.unwrap(Z):goog.html.SafeUrl.unwrap(goog.html.SafeUrl.sanitizeAssertUnchanged(Z))},goog.dom.safe.setObjectData=function(X,Z){goog.dom.asserts.assertIsHTMLObjectElement(X),X.data=goog.html.TrustedResourceUrl.unwrapTrustedScriptURL(Z)},goog.dom.safe.setScriptSrc=function(X,Z){goog.dom.asserts.assertIsHTMLScriptElement(X),X.src=goog.html.TrustedResourceUrl.unwrapTrustedScriptURL(Z),(Z=goog.getScriptNonce())&&X.setAttribute("nonce",Z)},goog.dom.safe.setScriptContent=function(X,Z){goog.dom.asserts.assertIsHTMLScriptElement(X),X.text=goog.html.SafeScript.unwrapTrustedScript(Z),(Z=goog.getScriptNonce())&&X.setAttribute("nonce",Z)},goog.dom.safe.setLocationHref=function(X,Z){goog.dom.asserts.assertIsLocation(X),Z=Z instanceof goog.html.SafeUrl?Z:goog.html.SafeUrl.sanitizeAssertUnchanged(Z),X.href=goog.html.SafeUrl.unwrap(Z)},goog.dom.safe.assignLocation=function(X,Z){goog.dom.asserts.assertIsLocation(X),Z=Z instanceof goog.html.SafeUrl?Z:goog.html.SafeUrl.sanitizeAssertUnchanged(Z),X.assign(goog.html.SafeUrl.unwrap(Z))},goog.dom.safe.replaceLocation=function(X,Z){Z=Z instanceof goog.html.SafeUrl?Z:goog.html.SafeUrl.sanitizeAssertUnchanged(Z),X.replace(goog.html.SafeUrl.unwrap(Z))},goog.dom.safe.openInWindow=function(X,Z,_,K,te){return X=X instanceof goog.html.SafeUrl?X:goog.html.SafeUrl.sanitizeAssertUnchanged(X),Z=Z||goog.global,_=_ instanceof goog.string.Const?goog.string.Const.unwrap(_):_||"",Z.open(goog.html.SafeUrl.unwrap(X),_,K,te)},goog.dom.safe.parseFromStringHtml=function(X,Z){return goog.dom.safe.parseFromString(X,Z,"text/html")},goog.dom.safe.parseFromString=function(X,Z,_){return X.parseFromString(goog.html.SafeHtml.unwrapTrustedHTML(Z),_)},goog.dom.safe.createImageFromBlob=function(X){if(!/^image\/.*/g.test(X.type))throw Error("goog.dom.safe.createImageFromBlob only accepts MIME type image/.*.");var Z=goog.global.URL.createObjectURL(X);return(X=new goog.global.Image).onload=function(){goog.global.URL.revokeObjectURL(Z)},goog.dom.safe.setImageSrc(X,goog.html.uncheckedconversions.safeUrlFromStringKnownToSatisfyTypeContract(goog.string.Const.from("Image blob URL."),Z)),X},goog.string.DETECT_DOUBLE_ESCAPING=!1,goog.string.FORCE_NON_DOM_HTML_UNESCAPING=!1,goog.string.Unicode={NBSP:" "},goog.string.startsWith=goog.string.internal.startsWith,goog.string.endsWith=goog.string.internal.endsWith,goog.string.caseInsensitiveStartsWith=goog.string.internal.caseInsensitiveStartsWith,goog.string.caseInsensitiveEndsWith=goog.string.internal.caseInsensitiveEndsWith,goog.string.caseInsensitiveEquals=goog.string.internal.caseInsensitiveEquals,goog.string.subs=function(X,Z){for(var _=X.split("%s"),K="",te=Array.prototype.slice.call(arguments,1);te.length&&1<_.length;)K+=_.shift()+te.shift();return K+_.join("%s")},goog.string.collapseWhitespace=function(X){return X.replace(/[\s\xa0]+/g," ").replace(/^\s+|\s+$/g,"")},goog.string.isEmptyOrWhitespace=goog.string.internal.isEmptyOrWhitespace,goog.string.isEmptyString=function(X){return X.length==0},goog.string.isEmpty=goog.string.isEmptyOrWhitespace,goog.string.isEmptyOrWhitespaceSafe=function(X){return goog.string.isEmptyOrWhitespace(goog.string.makeSafe(X))},goog.string.isEmptySafe=goog.string.isEmptyOrWhitespaceSafe,goog.string.isBreakingWhitespace=function(X){return!/[^\t\n\r ]/.test(X)},goog.string.isAlpha=function(X){return!/[^a-zA-Z]/.test(X)},goog.string.isNumeric=function(X){return!/[^0-9]/.test(X)},goog.string.isAlphaNumeric=function(X){return!/[^a-zA-Z0-9]/.test(X)},goog.string.isSpace=function(X){return X==" "},goog.string.isUnicodeChar=function(X){return X.length==1&&" "<=X&&"~">=X||""<=X&&"�">=X},goog.string.stripNewlines=function(X){return X.replace(/(\r\n|\r|\n)+/g," ")},goog.string.canonicalizeNewlines=function(X){return X.replace(/(\r\n|\r|\n)/g,`
`)},goog.string.normalizeWhitespace=function(X){return X.replace(/\xa0|\s/g," ")},goog.string.normalizeSpaces=function(X){return X.replace(/\xa0|[ \t]+/g," ")},goog.string.collapseBreakingSpaces=function(X){return X.replace(/[\t\r\n ]+/g," ").replace(/^[\t\r\n ]+|[\t\r\n ]+$/g,"")},goog.string.trim=goog.string.internal.trim,goog.string.trimLeft=function(X){return X.replace(/^[\s\xa0]+/,"")},goog.string.trimRight=function(X){return X.replace(/[\s\xa0]+$/,"")},goog.string.caseInsensitiveCompare=goog.string.internal.caseInsensitiveCompare,goog.string.numberAwareCompare_=function(X,Z,_){if(X==Z)return 0;if(!X)return-1;if(!Z)return 1;for(var K=X.toLowerCase().match(_),te=Z.toLowerCase().match(_),ne=Math.min(K.length,te.length),ie=0;ie<ne;ie++){_=K[ie];var oe=te[ie];if(_!=oe)return X=parseInt(_,10),!isNaN(X)&&(Z=parseInt(oe,10),!isNaN(Z)&&X-Z)?X-Z:_<oe?-1:1}return K.length!=te.length?K.length-te.length:X<Z?-1:1},goog.string.intAwareCompare=function(X,Z){return goog.string.numberAwareCompare_(X,Z,/\d+|\D+/g)},goog.string.floatAwareCompare=function(X,Z){return goog.string.numberAwareCompare_(X,Z,/\d+|\.\d+|\D+/g)},goog.string.numerateCompare=goog.string.floatAwareCompare,goog.string.urlEncode=function(X){return encodeURIComponent(String(X))},goog.string.urlDecode=function(X){return decodeURIComponent(X.replace(/\+/g," "))},goog.string.newLineToBr=goog.string.internal.newLineToBr,goog.string.htmlEscape=function(X,Z){return X=goog.string.internal.htmlEscape(X,Z),goog.string.DETECT_DOUBLE_ESCAPING&&(X=X.replace(goog.string.E_RE_,"&#101;")),X},goog.string.E_RE_=/e/g,goog.string.unescapeEntities=function(X){return goog.string.contains(X,"&")?!goog.string.FORCE_NON_DOM_HTML_UNESCAPING&&"document"in goog.global?goog.string.unescapeEntitiesUsingDom_(X):goog.string.unescapePureXmlEntities_(X):X},goog.string.unescapeEntitiesWithDocument=function(X,Z){return goog.string.contains(X,"&")?goog.string.unescapeEntitiesUsingDom_(X,Z):X},goog.string.unescapeEntitiesUsingDom_=function(X,Z){var _={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"'},K=Z?Z.createElement("div"):goog.global.document.createElement("div");return X.replace(goog.string.HTML_ENTITY_PATTERN_,function(te,ne){var ie=_[te];return ie||(ne.charAt(0)=="#"&&(ne=+("0"+ne.substr(1)),isNaN(ne)||(ie=String.fromCharCode(ne))),ie||(goog.dom.safe.setInnerHtml(K,goog.html.uncheckedconversions.safeHtmlFromStringKnownToSatisfyTypeContract(goog.string.Const.from("Single HTML entity."),te+" ")),ie=K.firstChild.nodeValue.slice(0,-1)),_[te]=ie)})},goog.string.unescapePureXmlEntities_=function(X){return X.replace(/&([^;]+);/g,function(Z,_){switch(_){case"amp":return"&";case"lt":return"<";case"gt":return">";case"quot":return'"';default:return _.charAt(0)!="#"||(_=+("0"+_.substr(1)),isNaN(_))?Z:String.fromCharCode(_)}})},goog.string.HTML_ENTITY_PATTERN_=/&([^;\s<&]+);?/g,goog.string.whitespaceEscape=function(X,Z){return goog.string.newLineToBr(X.replace(/  /g," &#160;"),Z)},goog.string.preserveSpaces=function(X){return X.replace(/(^|[\n ]) /g,"$1"+goog.string.Unicode.NBSP)},goog.string.stripQuotes=function(X,Z){for(var _=Z.length,K=0;K<_;K++){var te=_==1?Z:Z.charAt(K);if(X.charAt(0)==te&&X.charAt(X.length-1)==te)return X.substring(1,X.length-1)}return X},goog.string.truncate=function(X,Z,_){return _&&(X=goog.string.unescapeEntities(X)),X.length>Z&&(X=X.substring(0,Z-3)+"..."),_&&(X=goog.string.htmlEscape(X)),X},goog.string.truncateMiddle=function(X,Z,_,K){if(_&&(X=goog.string.unescapeEntities(X)),K&&X.length>Z){K>Z&&(K=Z);var te=X.length-K;X=X.substring(0,Z-K)+"..."+X.substring(te)}else X.length>Z&&(K=Math.floor(Z/2),te=X.length-K,X=X.substring(0,K+Z%2)+"..."+X.substring(te));return _&&(X=goog.string.htmlEscape(X)),X},goog.string.specialEscapeChars_={"\0":"\\0","\b":"\\b","\f":"\\f","\n":"\\n","\r":"\\r","	":"\\t","\v":"\\x0B",'"':'\\"',"\\":"\\\\","<":"\\u003C"},goog.string.jsEscapeCache_={"'":"\\'"},goog.string.quote=function(X){X=String(X);for(var Z=['"'],_=0;_<X.length;_++){var K=X.charAt(_),te=K.charCodeAt(0);Z[_+1]=goog.string.specialEscapeChars_[K]||(31<te&&127>te?K:goog.string.escapeChar(K))}return Z.push('"'),Z.join("")},goog.string.escapeString=function(X){for(var Z=[],_=0;_<X.length;_++)Z[_]=goog.string.escapeChar(X.charAt(_));return Z.join("")},goog.string.escapeChar=function(X){if(X in goog.string.jsEscapeCache_)return goog.string.jsEscapeCache_[X];if(X in goog.string.specialEscapeChars_)return goog.string.jsEscapeCache_[X]=goog.string.specialEscapeChars_[X];var Z=X.charCodeAt(0);if(31<Z&&127>Z)var _=X;else 256>Z?(_="\\x",(16>Z||256<Z)&&(_+="0")):(_="\\u",4096>Z&&(_+="0")),_+=Z.toString(16).toUpperCase();return goog.string.jsEscapeCache_[X]=_},goog.string.contains=goog.string.internal.contains,goog.string.caseInsensitiveContains=goog.string.internal.caseInsensitiveContains,goog.string.countOf=function(X,Z){return X&&Z?X.split(Z).length-1:0},goog.string.removeAt=function(X,Z,_){var K=X;return 0<=Z&&Z<X.length&&0<_&&(K=X.substr(0,Z)+X.substr(Z+_,X.length-Z-_)),K},goog.string.remove=function(X,Z){return X.replace(Z,"")},goog.string.removeAll=function(X,Z){return Z=new RegExp(goog.string.regExpEscape(Z),"g"),X.replace(Z,"")},goog.string.replaceAll=function(X,Z,_){return Z=new RegExp(goog.string.regExpEscape(Z),"g"),X.replace(Z,_.replace(/\$/g,"$$$$"))},goog.string.regExpEscape=function(X){return String(X).replace(/([-()\[\]{}+?*.$\^|,:#<!\\])/g,"\\$1").replace(/\x08/g,"\\x08")},goog.string.repeat=String.prototype.repeat?function(X,Z){return X.repeat(Z)}:function(X,Z){return Array(Z+1).join(X)},goog.string.padNumber=function(X,Z,_){return(_=(X=_!==void 0?X.toFixed(_):String(X)).indexOf("."))==-1&&(_=X.length),goog.string.repeat("0",Math.max(0,Z-_))+X},goog.string.makeSafe=function(X){return X==null?"":String(X)},goog.string.buildString=function(X){return Array.prototype.join.call(arguments,"")},goog.string.getRandomString=function(){return Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^goog.now()).toString(36)},goog.string.compareVersions=goog.string.internal.compareVersions,goog.string.hashCode=function(X){for(var Z=0,_=0;_<X.length;++_)Z=31*Z+X.charCodeAt(_)>>>0;return Z},goog.string.uniqueStringCounter_=2147483648*Math.random()|0,goog.string.createUniqueString=function(){return"goog_"+goog.string.uniqueStringCounter_++},goog.string.toNumber=function(X){var Z=Number(X);return Z==0&&goog.string.isEmptyOrWhitespace(X)?NaN:Z},goog.string.isLowerCamelCase=function(X){return/^[a-z]+([A-Z][a-z]*)*$/.test(X)},goog.string.isUpperCamelCase=function(X){return/^([A-Z][a-z]*)+$/.test(X)},goog.string.toCamelCase=function(X){return String(X).replace(/\-([a-z])/g,function(Z,_){return _.toUpperCase()})},goog.string.toSelectorCase=function(X){return String(X).replace(/([A-Z])/g,"-$1").toLowerCase()},goog.string.toTitleCase=function(X,Z){return Z=typeof Z=="string"?goog.string.regExpEscape(Z):"\\s",X.replace(new RegExp("(^"+(Z?"|["+Z+"]+":"")+")([a-z])","g"),function(_,K,te){return K+te.toUpperCase()})},goog.string.capitalize=function(X){return String(X.charAt(0)).toUpperCase()+String(X.substr(1)).toLowerCase()},goog.string.parseInt=function(X){return isFinite(X)&&(X=String(X)),typeof X=="string"?/^\s*-?0x/i.test(X)?parseInt(X,16):parseInt(X,10):NaN},goog.string.splitLimit=function(X,Z,_){X=X.split(Z);for(var K=[];0<_&&X.length;)K.push(X.shift()),_--;return X.length&&K.push(X.join(Z)),K},goog.string.lastComponent=function(X,Z){if(!Z)return X;typeof Z=="string"&&(Z=[Z]);for(var _=-1,K=0;K<Z.length;K++)if(Z[K]!=""){var te=X.lastIndexOf(Z[K]);te>_&&(_=te)}return _==-1?X:X.slice(_+1)},goog.string.editDistance=function(X,Z){var _=[],K=[];if(X==Z)return 0;if(!X.length||!Z.length)return Math.max(X.length,Z.length);for(var te=0;te<Z.length+1;te++)_[te]=te;for(te=0;te<X.length;te++){K[0]=te+1;for(var ne=0;ne<Z.length;ne++)K[ne+1]=Math.min(K[ne]+1,_[ne+1]+1,_[ne]+ +(X[te]!=Z[ne]));for(ne=0;ne<_.length;ne++)_[ne]=K[ne]}return K[Z.length]},goog.labs.userAgent.engine={},goog.labs.userAgent.engine.isPresto=function(){return goog.labs.userAgent.util.matchUserAgent("Presto")},goog.labs.userAgent.engine.isTrident=function(){return goog.labs.userAgent.util.matchUserAgent("Trident")||goog.labs.userAgent.util.matchUserAgent("MSIE")},goog.labs.userAgent.engine.isEdge=function(){return goog.labs.userAgent.util.matchUserAgent("Edge")},goog.labs.userAgent.engine.isWebKit=function(){return goog.labs.userAgent.util.matchUserAgentIgnoreCase("WebKit")&&!goog.labs.userAgent.engine.isEdge()},goog.labs.userAgent.engine.isGecko=function(){return goog.labs.userAgent.util.matchUserAgent("Gecko")&&!goog.labs.userAgent.engine.isWebKit()&&!goog.labs.userAgent.engine.isTrident()&&!goog.labs.userAgent.engine.isEdge()},goog.labs.userAgent.engine.getVersion=function(){var X=goog.labs.userAgent.util.getUserAgent();if(X){X=goog.labs.userAgent.util.extractVersionTuples(X);var Z,_=goog.labs.userAgent.engine.getEngineTuple_(X);if(_)return _[0]=="Gecko"?goog.labs.userAgent.engine.getVersionForKey_(X,"Firefox"):_[1];if((X=X[0])&&(Z=X[2])&&(Z=/Trident\/([^\s;]+)/.exec(Z)))return Z[1]}return""},goog.labs.userAgent.engine.getEngineTuple_=function(X){if(!goog.labs.userAgent.engine.isEdge())return X[1];for(var Z=0;Z<X.length;Z++){var _=X[Z];if(_[0]=="Edge")return _}},goog.labs.userAgent.engine.isVersionOrHigher=function(X){return 0<=goog.string.compareVersions(goog.labs.userAgent.engine.getVersion(),X)},goog.labs.userAgent.engine.getVersionForKey_=function(X,Z){return(X=goog.array.find(X,function(_){return Z==_[0]}))&&X[1]||""},goog.labs.userAgent.platform={},goog.labs.userAgent.platform.isAndroid=function(){return goog.labs.userAgent.util.matchUserAgent("Android")},goog.labs.userAgent.platform.isIpod=function(){return goog.labs.userAgent.util.matchUserAgent("iPod")},goog.labs.userAgent.platform.isIphone=function(){return goog.labs.userAgent.util.matchUserAgent("iPhone")&&!goog.labs.userAgent.util.matchUserAgent("iPod")&&!goog.labs.userAgent.util.matchUserAgent("iPad")},goog.labs.userAgent.platform.isIpad=function(){return goog.labs.userAgent.util.matchUserAgent("iPad")},goog.labs.userAgent.platform.isIos=function(){return goog.labs.userAgent.platform.isIphone()||goog.labs.userAgent.platform.isIpad()||goog.labs.userAgent.platform.isIpod()},goog.labs.userAgent.platform.isMacintosh=function(){return goog.labs.userAgent.util.matchUserAgent("Macintosh")},goog.labs.userAgent.platform.isLinux=function(){return goog.labs.userAgent.util.matchUserAgent("Linux")},goog.labs.userAgent.platform.isWindows=function(){return goog.labs.userAgent.util.matchUserAgent("Windows")},goog.labs.userAgent.platform.isChromeOS=function(){return goog.labs.userAgent.util.matchUserAgent("CrOS")},goog.labs.userAgent.platform.isChromecast=function(){return goog.labs.userAgent.util.matchUserAgent("CrKey")},goog.labs.userAgent.platform.isKaiOS=function(){return goog.labs.userAgent.util.matchUserAgentIgnoreCase("KaiOS")},goog.labs.userAgent.platform.getVersion=function(){var X=goog.labs.userAgent.util.getUserAgent(),Z="";return goog.labs.userAgent.platform.isWindows()?Z=(X=(Z=/Windows (?:NT|Phone) ([0-9.]+)/).exec(X))?X[1]:"0.0":goog.labs.userAgent.platform.isIos()?Z=(X=(Z=/(?:iPhone|iPod|iPad|CPU)\s+OS\s+(\S+)/).exec(X))&&X[1].replace(/_/g,"."):goog.labs.userAgent.platform.isMacintosh()?Z=(X=(Z=/Mac OS X ([0-9_.]+)/).exec(X))?X[1].replace(/_/g,"."):"10":goog.labs.userAgent.platform.isKaiOS()?Z=(X=(Z=/(?:KaiOS)\/(\S+)/i).exec(X))&&X[1]:goog.labs.userAgent.platform.isAndroid()?Z=(X=(Z=/Android\s+([^\);]+)(\)|;)/).exec(X))&&X[1]:goog.labs.userAgent.platform.isChromeOS()&&(Z=(X=(Z=/(?:CrOS\s+(?:i686|x86_64)\s+([0-9.]+))/).exec(X))&&X[1]),Z||""},goog.labs.userAgent.platform.isVersionOrHigher=function(X){return 0<=goog.string.compareVersions(goog.labs.userAgent.platform.getVersion(),X)},goog.reflect={},goog.reflect.object=function(X,Z){return Z},goog.reflect.objectProperty=function(X,Z){return X},goog.reflect.sinkValue=function(X){return goog.reflect.sinkValue[" "](X),X},goog.reflect.sinkValue[" "]=goog.nullFunction,goog.reflect.canAccessProperty=function(X,Z){try{return goog.reflect.sinkValue(X[Z]),!0}catch{}return!1},goog.reflect.cache=function(X,Z,_,K){return K=K?K(Z):Z,Object.prototype.hasOwnProperty.call(X,K)?X[K]:X[K]=_(Z)},goog.userAgent={},goog.userAgent.ASSUME_IE=!1,goog.userAgent.ASSUME_EDGE=!1,goog.userAgent.ASSUME_GECKO=!1,goog.userAgent.ASSUME_WEBKIT=!1,goog.userAgent.ASSUME_MOBILE_WEBKIT=!1,goog.userAgent.ASSUME_OPERA=!1,goog.userAgent.ASSUME_ANY_VERSION=!1,goog.userAgent.BROWSER_KNOWN_=goog.userAgent.ASSUME_IE||goog.userAgent.ASSUME_EDGE||goog.userAgent.ASSUME_GECKO||goog.userAgent.ASSUME_MOBILE_WEBKIT||goog.userAgent.ASSUME_WEBKIT||goog.userAgent.ASSUME_OPERA,goog.userAgent.getUserAgentString=function(){return goog.labs.userAgent.util.getUserAgent()},goog.userAgent.getNavigatorTyped=function(){return goog.global.navigator||null},goog.userAgent.getNavigator=function(){return goog.userAgent.getNavigatorTyped()},goog.userAgent.OPERA=goog.userAgent.BROWSER_KNOWN_?goog.userAgent.ASSUME_OPERA:goog.labs.userAgent.browser.isOpera(),goog.userAgent.IE=goog.userAgent.BROWSER_KNOWN_?goog.userAgent.ASSUME_IE:goog.labs.userAgent.browser.isIE(),goog.userAgent.EDGE=goog.userAgent.BROWSER_KNOWN_?goog.userAgent.ASSUME_EDGE:goog.labs.userAgent.engine.isEdge(),goog.userAgent.EDGE_OR_IE=goog.userAgent.EDGE||goog.userAgent.IE,goog.userAgent.GECKO=goog.userAgent.BROWSER_KNOWN_?goog.userAgent.ASSUME_GECKO:goog.labs.userAgent.engine.isGecko(),goog.userAgent.WEBKIT=goog.userAgent.BROWSER_KNOWN_?goog.userAgent.ASSUME_WEBKIT||goog.userAgent.ASSUME_MOBILE_WEBKIT:goog.labs.userAgent.engine.isWebKit(),goog.userAgent.isMobile_=function(){return goog.userAgent.WEBKIT&&goog.labs.userAgent.util.matchUserAgent("Mobile")},goog.userAgent.MOBILE=goog.userAgent.ASSUME_MOBILE_WEBKIT||goog.userAgent.isMobile_(),goog.userAgent.SAFARI=goog.userAgent.WEBKIT,goog.userAgent.determinePlatform_=function(){var X=goog.userAgent.getNavigatorTyped();return X&&X.platform||""},goog.userAgent.PLATFORM=goog.userAgent.determinePlatform_(),goog.userAgent.ASSUME_MAC=!1,goog.userAgent.ASSUME_WINDOWS=!1,goog.userAgent.ASSUME_LINUX=!1,goog.userAgent.ASSUME_X11=!1,goog.userAgent.ASSUME_ANDROID=!1,goog.userAgent.ASSUME_IPHONE=!1,goog.userAgent.ASSUME_IPAD=!1,goog.userAgent.ASSUME_IPOD=!1,goog.userAgent.ASSUME_KAIOS=!1,goog.userAgent.PLATFORM_KNOWN_=goog.userAgent.ASSUME_MAC||goog.userAgent.ASSUME_WINDOWS||goog.userAgent.ASSUME_LINUX||goog.userAgent.ASSUME_X11||goog.userAgent.ASSUME_ANDROID||goog.userAgent.ASSUME_IPHONE||goog.userAgent.ASSUME_IPAD||goog.userAgent.ASSUME_IPOD,goog.userAgent.MAC=goog.userAgent.PLATFORM_KNOWN_?goog.userAgent.ASSUME_MAC:goog.labs.userAgent.platform.isMacintosh(),goog.userAgent.WINDOWS=goog.userAgent.PLATFORM_KNOWN_?goog.userAgent.ASSUME_WINDOWS:goog.labs.userAgent.platform.isWindows(),goog.userAgent.isLegacyLinux_=function(){return goog.labs.userAgent.platform.isLinux()||goog.labs.userAgent.platform.isChromeOS()},goog.userAgent.LINUX=goog.userAgent.PLATFORM_KNOWN_?goog.userAgent.ASSUME_LINUX:goog.userAgent.isLegacyLinux_(),goog.userAgent.isX11_=function(){var X=goog.userAgent.getNavigatorTyped();return!!X&&goog.string.contains(X.appVersion||"","X11")},goog.userAgent.X11=goog.userAgent.PLATFORM_KNOWN_?goog.userAgent.ASSUME_X11:goog.userAgent.isX11_(),goog.userAgent.ANDROID=goog.userAgent.PLATFORM_KNOWN_?goog.userAgent.ASSUME_ANDROID:goog.labs.userAgent.platform.isAndroid(),goog.userAgent.IPHONE=goog.userAgent.PLATFORM_KNOWN_?goog.userAgent.ASSUME_IPHONE:goog.labs.userAgent.platform.isIphone(),goog.userAgent.IPAD=goog.userAgent.PLATFORM_KNOWN_?goog.userAgent.ASSUME_IPAD:goog.labs.userAgent.platform.isIpad(),goog.userAgent.IPOD=goog.userAgent.PLATFORM_KNOWN_?goog.userAgent.ASSUME_IPOD:goog.labs.userAgent.platform.isIpod(),goog.userAgent.IOS=goog.userAgent.PLATFORM_KNOWN_?goog.userAgent.ASSUME_IPHONE||goog.userAgent.ASSUME_IPAD||goog.userAgent.ASSUME_IPOD:goog.labs.userAgent.platform.isIos(),goog.userAgent.KAIOS=goog.userAgent.PLATFORM_KNOWN_?goog.userAgent.ASSUME_KAIOS:goog.labs.userAgent.platform.isKaiOS(),goog.userAgent.determineVersion_=function(){var X="",Z=goog.userAgent.getVersionRegexResult_();return Z&&(X=Z?Z[1]:""),goog.userAgent.IE&&(Z=goog.userAgent.getDocumentMode_())!=null&&Z>parseFloat(X)?String(Z):X},goog.userAgent.getVersionRegexResult_=function(){var X=goog.userAgent.getUserAgentString();return goog.userAgent.GECKO?/rv:([^\);]+)(\)|;)/.exec(X):goog.userAgent.EDGE?/Edge\/([\d\.]+)/.exec(X):goog.userAgent.IE?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(X):goog.userAgent.WEBKIT?/WebKit\/(\S+)/.exec(X):goog.userAgent.OPERA?/(?:Version)[ \/]?(\S+)/.exec(X):void 0},goog.userAgent.getDocumentMode_=function(){var X=goog.global.document;return X?X.documentMode:void 0},goog.userAgent.VERSION=goog.userAgent.determineVersion_(),goog.userAgent.compare=function(X,Z){return goog.string.compareVersions(X,Z)},goog.userAgent.isVersionOrHigherCache_={},goog.userAgent.isVersionOrHigher=function(X){return goog.userAgent.ASSUME_ANY_VERSION||goog.reflect.cache(goog.userAgent.isVersionOrHigherCache_,X,function(){return 0<=goog.string.compareVersions(goog.userAgent.VERSION,X)})},goog.userAgent.isVersion=goog.userAgent.isVersionOrHigher,goog.userAgent.isDocumentModeOrHigher=function(X){return Number(goog.userAgent.DOCUMENT_MODE)>=X},goog.userAgent.isDocumentMode=goog.userAgent.isDocumentModeOrHigher,goog.userAgent.DOCUMENT_MODE=function(){if(goog.global.document&&goog.userAgent.IE){var X=goog.userAgent.getDocumentMode_();return X||parseInt(goog.userAgent.VERSION,10)||void 0}}(),goog.userAgent.product={},goog.userAgent.product.ASSUME_FIREFOX=!1,goog.userAgent.product.ASSUME_IPHONE=!1,goog.userAgent.product.ASSUME_IPAD=!1,goog.userAgent.product.ASSUME_ANDROID=!1,goog.userAgent.product.ASSUME_CHROME=!1,goog.userAgent.product.ASSUME_SAFARI=!1,goog.userAgent.product.PRODUCT_KNOWN_=goog.userAgent.ASSUME_IE||goog.userAgent.ASSUME_EDGE||goog.userAgent.ASSUME_OPERA||goog.userAgent.product.ASSUME_FIREFOX||goog.userAgent.product.ASSUME_IPHONE||goog.userAgent.product.ASSUME_IPAD||goog.userAgent.product.ASSUME_ANDROID||goog.userAgent.product.ASSUME_CHROME||goog.userAgent.product.ASSUME_SAFARI,goog.userAgent.product.OPERA=goog.userAgent.OPERA,goog.userAgent.product.IE=goog.userAgent.IE,goog.userAgent.product.EDGE=goog.userAgent.EDGE,goog.userAgent.product.FIREFOX=goog.userAgent.product.PRODUCT_KNOWN_?goog.userAgent.product.ASSUME_FIREFOX:goog.labs.userAgent.browser.isFirefox(),goog.userAgent.product.isIphoneOrIpod_=function(){return goog.labs.userAgent.platform.isIphone()||goog.labs.userAgent.platform.isIpod()},goog.userAgent.product.IPHONE=goog.userAgent.product.PRODUCT_KNOWN_?goog.userAgent.product.ASSUME_IPHONE:goog.userAgent.product.isIphoneOrIpod_(),goog.userAgent.product.IPAD=goog.userAgent.product.PRODUCT_KNOWN_?goog.userAgent.product.ASSUME_IPAD:goog.labs.userAgent.platform.isIpad(),goog.userAgent.product.ANDROID=goog.userAgent.product.PRODUCT_KNOWN_?goog.userAgent.product.ASSUME_ANDROID:goog.labs.userAgent.browser.isAndroidBrowser(),goog.userAgent.product.CHROME=goog.userAgent.product.PRODUCT_KNOWN_?goog.userAgent.product.ASSUME_CHROME:goog.labs.userAgent.browser.isChrome(),goog.userAgent.product.isSafariDesktop_=function(){return goog.labs.userAgent.browser.isSafari()&&!goog.labs.userAgent.platform.isIos()},goog.userAgent.product.SAFARI=goog.userAgent.product.PRODUCT_KNOWN_?goog.userAgent.product.ASSUME_SAFARI:goog.userAgent.product.isSafariDesktop_(),goog.crypt.base64={},goog.crypt.base64.DEFAULT_ALPHABET_COMMON_="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",goog.crypt.base64.ENCODED_VALS=goog.crypt.base64.DEFAULT_ALPHABET_COMMON_+"+/=",goog.crypt.base64.ENCODED_VALS_WEBSAFE=goog.crypt.base64.DEFAULT_ALPHABET_COMMON_+"-_.",goog.crypt.base64.Alphabet={DEFAULT:0,NO_PADDING:1,WEBSAFE:2,WEBSAFE_DOT_PADDING:3,WEBSAFE_NO_PADDING:4},goog.crypt.base64.paddingChars_="=.",goog.crypt.base64.isPadding_=function(X){return goog.string.contains(goog.crypt.base64.paddingChars_,X)},goog.crypt.base64.byteToCharMaps_={},goog.crypt.base64.charToByteMap_=null,goog.crypt.base64.ASSUME_NATIVE_SUPPORT_=goog.userAgent.GECKO||goog.userAgent.WEBKIT&&!goog.userAgent.product.SAFARI||goog.userAgent.OPERA,goog.crypt.base64.HAS_NATIVE_ENCODE_=goog.crypt.base64.ASSUME_NATIVE_SUPPORT_||typeof goog.global.btoa=="function",goog.crypt.base64.HAS_NATIVE_DECODE_=goog.crypt.base64.ASSUME_NATIVE_SUPPORT_||!goog.userAgent.product.SAFARI&&!goog.userAgent.IE&&typeof goog.global.atob=="function",goog.crypt.base64.encodeByteArray=function(X,Z){goog.asserts.assert(goog.isArrayLike(X),"encodeByteArray takes an array as a parameter"),Z===void 0&&(Z=goog.crypt.base64.Alphabet.DEFAULT),goog.crypt.base64.init_(),Z=goog.crypt.base64.byteToCharMaps_[Z];for(var _=[],K=0;K<X.length;K+=3){var te=X[K],ne=K+1<X.length,ie=ne?X[K+1]:0,oe=K+2<X.length,se=oe?X[K+2]:0,ae=te>>2;te=(3&te)<<4|ie>>4,ie=(15&ie)<<2|se>>6,se&=63,oe||(se=64,ne||(ie=64)),_.push(Z[ae],Z[te],Z[ie]||"",Z[se]||"")}return _.join("")},goog.crypt.base64.encodeString=function(X,Z){return goog.crypt.base64.HAS_NATIVE_ENCODE_&&!Z?goog.global.btoa(X):goog.crypt.base64.encodeByteArray(goog.crypt.stringToByteArray(X),Z)},goog.crypt.base64.decodeString=function(X,Z){if(goog.crypt.base64.HAS_NATIVE_DECODE_&&!Z)return goog.global.atob(X);var _="";return goog.crypt.base64.decodeStringInternal_(X,function(K){_+=String.fromCharCode(K)}),_},goog.crypt.base64.decodeStringToByteArray=function(X,Z){var _=[];return goog.crypt.base64.decodeStringInternal_(X,function(K){_.push(K)}),_},goog.crypt.base64.decodeStringToUint8Array=function(X){goog.asserts.assert(!goog.userAgent.IE||goog.userAgent.isVersionOrHigher("10"),"Browser does not support typed arrays");var Z=X.length,_=3*Z/4;_%3?_=Math.floor(_):goog.crypt.base64.isPadding_(X[Z-1])&&(_=goog.crypt.base64.isPadding_(X[Z-2])?_-2:_-1);var K=new Uint8Array(_),te=0;return goog.crypt.base64.decodeStringInternal_(X,function(ne){K[te++]=ne}),K.subarray(0,te)},goog.crypt.base64.decodeStringInternal_=function(X,Z){function _(se){for(;K<X.length;){var ae=X.charAt(K++),ge=goog.crypt.base64.charToByteMap_[ae];if(ge!=null)return ge;if(!goog.string.isEmptyOrWhitespace(ae))throw Error("Unknown base64 encoding at char: "+ae)}return se}goog.crypt.base64.init_();for(var K=0;;){var te=_(-1),ne=_(0),ie=_(64),oe=_(64);if(oe===64&&te===-1)break;Z(te<<2|ne>>4),ie!=64&&(Z(ne<<4&240|ie>>2),oe!=64&&Z(ie<<6&192|oe))}},goog.crypt.base64.init_=function(){if(!goog.crypt.base64.charToByteMap_){goog.crypt.base64.charToByteMap_={};for(var X=goog.crypt.base64.DEFAULT_ALPHABET_COMMON_.split(""),Z=["+/=","+/","-_=","-_.","-_"],_=0;5>_;_++){var K=X.concat(Z[_].split(""));goog.crypt.base64.byteToCharMaps_[_]=K;for(var te=0;te<K.length;te++){var ne=K[te],ie=goog.crypt.base64.charToByteMap_[ne];ie===void 0?goog.crypt.base64.charToByteMap_[ne]=te:goog.asserts.assert(ie===te)}}}},jspb.utils={},jspb.utils.split64Low=0,jspb.utils.split64High=0,jspb.utils.splitUint64=function(X){var Z=X>>>0;X=Math.floor((X-Z)/jspb.BinaryConstants.TWO_TO_32)>>>0,jspb.utils.split64Low=Z,jspb.utils.split64High=X},jspb.utils.splitInt64=function(X){var Z=0>X,_=(X=Math.abs(X))>>>0;X=Math.floor((X-_)/jspb.BinaryConstants.TWO_TO_32),X>>>=0,Z&&(X=~X>>>0,4294967295<(_=1+(~_>>>0))&&(_=0,4294967295<++X&&(X=0))),jspb.utils.split64Low=_,jspb.utils.split64High=X},jspb.utils.splitZigzag64=function(X){var Z=0>X;X=2*Math.abs(X),jspb.utils.splitUint64(X),X=jspb.utils.split64Low;var _=jspb.utils.split64High;Z&&(X==0?_==0?_=X=4294967295:(_--,X=4294967295):X--),jspb.utils.split64Low=X,jspb.utils.split64High=_},jspb.utils.splitFloat32=function(X){var Z=0>X?1:0;if((X=Z?-X:X)===0)0<1/X?(jspb.utils.split64High=0,jspb.utils.split64Low=0):(jspb.utils.split64High=0,jspb.utils.split64Low=2147483648);else if(isNaN(X))jspb.utils.split64High=0,jspb.utils.split64Low=2147483647;else if(X>jspb.BinaryConstants.FLOAT32_MAX)jspb.utils.split64High=0,jspb.utils.split64Low=(Z<<31|2139095040)>>>0;else if(X<jspb.BinaryConstants.FLOAT32_MIN)X=Math.round(X/Math.pow(2,-149)),jspb.utils.split64High=0,jspb.utils.split64Low=(Z<<31|X)>>>0;else{var _=Math.floor(Math.log(X)/Math.LN2);X*=Math.pow(2,-_),16777216<=(X=Math.round(X*jspb.BinaryConstants.TWO_TO_23))&&++_,jspb.utils.split64High=0,jspb.utils.split64Low=(Z<<31|_+127<<23|8388607&X)>>>0}},jspb.utils.splitFloat64=function(X){var Z=0>X?1:0;if((X=Z?-X:X)===0)jspb.utils.split64High=0<1/X?0:2147483648,jspb.utils.split64Low=0;else if(isNaN(X))jspb.utils.split64High=2147483647,jspb.utils.split64Low=4294967295;else if(X>jspb.BinaryConstants.FLOAT64_MAX)jspb.utils.split64High=(Z<<31|2146435072)>>>0,jspb.utils.split64Low=0;else if(X<jspb.BinaryConstants.FLOAT64_MIN){var _=X/Math.pow(2,-1074);X=_/jspb.BinaryConstants.TWO_TO_32,jspb.utils.split64High=(Z<<31|X)>>>0,jspb.utils.split64Low=_>>>0}else{var K=0;if(2<=(_=X))for(;2<=_&&1023>K;)K++,_/=2;else for(;1>_&&-1022<K;)_*=2,K--;X=(_=X*Math.pow(2,-K))*jspb.BinaryConstants.TWO_TO_20&1048575,_=_*jspb.BinaryConstants.TWO_TO_52>>>0,jspb.utils.split64High=(Z<<31|K+1023<<20|X)>>>0,jspb.utils.split64Low=_}},jspb.utils.splitHash64=function(X){var Z=X.charCodeAt(0),_=X.charCodeAt(1),K=X.charCodeAt(2),te=X.charCodeAt(3),ne=X.charCodeAt(4),ie=X.charCodeAt(5),oe=X.charCodeAt(6);X=X.charCodeAt(7),jspb.utils.split64Low=Z+(_<<8)+(K<<16)+(te<<24)>>>0,jspb.utils.split64High=ne+(ie<<8)+(oe<<16)+(X<<24)>>>0},jspb.utils.joinUint64=function(X,Z){return Z*jspb.BinaryConstants.TWO_TO_32+(X>>>0)},jspb.utils.joinInt64=function(X,Z){var _=2147483648&Z;return _&&(Z=~Z>>>0,(X=1+~X>>>0)==0&&(Z=Z+1>>>0)),X=jspb.utils.joinUint64(X,Z),_?-X:X},jspb.utils.toZigzag64=function(X,Z,_){var K=Z>>31;return _(X<<1^K,(Z<<1|X>>>31)^K)},jspb.utils.joinZigzag64=function(X,Z){return jspb.utils.fromZigzag64(X,Z,jspb.utils.joinInt64)},jspb.utils.fromZigzag64=function(X,Z,_){var K=-(1&X);return _((X>>>1|Z<<31)^K,Z>>>1^K)},jspb.utils.joinFloat32=function(X,Z){Z=2*(X>>31)+1;var _=X>>>23&255;return X&=8388607,_==255?X?NaN:1/0*Z:_==0?Z*Math.pow(2,-149)*X:Z*Math.pow(2,_-150)*(X+Math.pow(2,23))},jspb.utils.joinFloat64=function(X,Z){var _=2*(Z>>31)+1,K=Z>>>20&2047;return X=jspb.BinaryConstants.TWO_TO_32*(1048575&Z)+X,K==2047?X?NaN:1/0*_:K==0?_*Math.pow(2,-1074)*X:_*Math.pow(2,K-1075)*(X+jspb.BinaryConstants.TWO_TO_52)},jspb.utils.joinHash64=function(X,Z){return String.fromCharCode(X>>>0&255,X>>>8&255,X>>>16&255,X>>>24&255,Z>>>0&255,Z>>>8&255,Z>>>16&255,Z>>>24&255)},jspb.utils.DIGITS="0123456789abcdef".split(""),jspb.utils.ZERO_CHAR_CODE_=48,jspb.utils.A_CHAR_CODE_=97,jspb.utils.joinUnsignedDecimalString=function(X,Z){function _(te,ne){return te=te?String(te):"",ne?"0000000".slice(te.length)+te:te}if(2097151>=Z)return""+jspb.utils.joinUint64(X,Z);var K=(X>>>24|Z<<8)>>>0&16777215;return X=(16777215&X)+6777216*K+6710656*(Z=Z>>16&65535),K+=8147497*Z,Z*=2,1e7<=X&&(K+=Math.floor(X/1e7),X%=1e7),1e7<=K&&(Z+=Math.floor(K/1e7),K%=1e7),_(Z,0)+_(K,Z)+_(X,1)},jspb.utils.joinSignedDecimalString=function(X,Z){var _=2147483648&Z;return _&&(Z=~Z+((X=1+~X>>>0)==0?1:0)>>>0),X=jspb.utils.joinUnsignedDecimalString(X,Z),_?"-"+X:X},jspb.utils.hash64ToDecimalString=function(X,Z){jspb.utils.splitHash64(X),X=jspb.utils.split64Low;var _=jspb.utils.split64High;return Z?jspb.utils.joinSignedDecimalString(X,_):jspb.utils.joinUnsignedDecimalString(X,_)},jspb.utils.hash64ArrayToDecimalStrings=function(X,Z){for(var _=Array(X.length),K=0;K<X.length;K++)_[K]=jspb.utils.hash64ToDecimalString(X[K],Z);return _},jspb.utils.decimalStringToHash64=function(X){function Z(ne,ie){for(var oe=0;8>oe&&(ne!==1||0<ie);oe++)ie=ne*K[oe]+ie,K[oe]=255&ie,ie>>>=8}jspb.asserts.assert(0<X.length);var _=!1;X[0]==="-"&&(_=!0,X=X.slice(1));for(var K=[0,0,0,0,0,0,0,0],te=0;te<X.length;te++)Z(10,X.charCodeAt(te)-jspb.utils.ZERO_CHAR_CODE_);return _&&(function(){for(var ne=0;8>ne;ne++)K[ne]=255&~K[ne]}(),Z(1,1)),goog.crypt.byteArrayToString(K)},jspb.utils.splitDecimalString=function(X){jspb.utils.splitHash64(jspb.utils.decimalStringToHash64(X))},jspb.utils.toHexDigit_=function(X){return String.fromCharCode(10>X?jspb.utils.ZERO_CHAR_CODE_+X:jspb.utils.A_CHAR_CODE_-10+X)},jspb.utils.fromHexCharCode_=function(X){return X>=jspb.utils.A_CHAR_CODE_?X-jspb.utils.A_CHAR_CODE_+10:X-jspb.utils.ZERO_CHAR_CODE_},jspb.utils.hash64ToHexString=function(X){var Z=Array(18);Z[0]="0",Z[1]="x";for(var _=0;8>_;_++){var K=X.charCodeAt(7-_);Z[2*_+2]=jspb.utils.toHexDigit_(K>>4),Z[2*_+3]=jspb.utils.toHexDigit_(15&K)}return Z.join("")},jspb.utils.hexStringToHash64=function(X){X=X.toLowerCase(),jspb.asserts.assert(X.length==18),jspb.asserts.assert(X[0]=="0"),jspb.asserts.assert(X[1]=="x");for(var Z="",_=0;8>_;_++){var K=jspb.utils.fromHexCharCode_(X.charCodeAt(2*_+2)),te=jspb.utils.fromHexCharCode_(X.charCodeAt(2*_+3));Z=String.fromCharCode(16*K+te)+Z}return Z},jspb.utils.hash64ToNumber=function(X,Z){jspb.utils.splitHash64(X),X=jspb.utils.split64Low;var _=jspb.utils.split64High;return Z?jspb.utils.joinInt64(X,_):jspb.utils.joinUint64(X,_)},jspb.utils.numberToHash64=function(X){return jspb.utils.splitInt64(X),jspb.utils.joinHash64(jspb.utils.split64Low,jspb.utils.split64High)},jspb.utils.countVarints=function(X,Z,_){for(var K=0,te=Z;te<_;te++)K+=X[te]>>7;return _-Z-K},jspb.utils.countVarintFields=function(X,Z,_,K){var te=0;if(128>(K=8*K+jspb.BinaryConstants.WireType.VARINT))for(;Z<_&&X[Z++]==K;)for(te++;;){var ne=X[Z++];if(!(128&ne))break}else for(;Z<_;){for(ne=K;128<ne;){if(X[Z]!=(127&ne|128))return te;Z++,ne>>=7}if(X[Z++]!=ne)break;for(te++;128&(ne=X[Z++]););}return te},jspb.utils.countFixedFields_=function(X,Z,_,K,te){var ne=0;if(128>K)for(;Z<_&&X[Z++]==K;)ne++,Z+=te;else for(;Z<_;){for(var ie=K;128<ie;){if(X[Z++]!=(127&ie|128))return ne;ie>>=7}if(X[Z++]!=ie)break;ne++,Z+=te}return ne},jspb.utils.countFixed32Fields=function(X,Z,_,K){return jspb.utils.countFixedFields_(X,Z,_,8*K+jspb.BinaryConstants.WireType.FIXED32,4)},jspb.utils.countFixed64Fields=function(X,Z,_,K){return jspb.utils.countFixedFields_(X,Z,_,8*K+jspb.BinaryConstants.WireType.FIXED64,8)},jspb.utils.countDelimitedFields=function(X,Z,_,K){var te=0;for(K=8*K+jspb.BinaryConstants.WireType.DELIMITED;Z<_;){for(var ne=K;128<ne;){if(X[Z++]!=(127&ne|128))return te;ne>>=7}if(X[Z++]!=ne)break;te++;for(var ie=0,oe=1;ie+=(127&(ne=X[Z++]))*oe,oe*=128,128&ne;);Z+=ie}return te},jspb.utils.debugBytesToTextFormat=function(X){var Z='"';if(X){X=jspb.utils.byteSourceToUint8Array(X);for(var _=0;_<X.length;_++)Z+="\\x",16>X[_]&&(Z+="0"),Z+=X[_].toString(16)}return Z+'"'},jspb.utils.debugScalarToTextFormat=function(X){return typeof X=="string"?goog.string.quote(X):X.toString()},jspb.utils.stringToByteArray=function(X){for(var Z=new Uint8Array(X.length),_=0;_<X.length;_++){var K=X.charCodeAt(_);if(255<K)throw Error("Conversion error: string contains codepoint outside of byte range");Z[_]=K}return Z},jspb.utils.byteSourceToUint8Array=function(X){return X.constructor===Uint8Array?X:X.constructor===ArrayBuffer||X.constructor===Array?new Uint8Array(X):X.constructor===String?goog.crypt.base64.decodeStringToUint8Array(X):X instanceof Uint8Array?new Uint8Array(X.buffer,X.byteOffset,X.byteLength):(jspb.asserts.fail("Type not convertible to Uint8Array."),new Uint8Array(0))},jspb.BinaryDecoder=function(X,Z,_){this.bytes_=null,this.cursor_=this.end_=this.start_=0,this.error_=!1,X&&this.setBlock(X,Z,_)},jspb.BinaryDecoder.instanceCache_=[],jspb.BinaryDecoder.alloc=function(X,Z,_){if(jspb.BinaryDecoder.instanceCache_.length){var K=jspb.BinaryDecoder.instanceCache_.pop();return X&&K.setBlock(X,Z,_),K}return new jspb.BinaryDecoder(X,Z,_)},jspb.BinaryDecoder.prototype.free=function(){this.clear(),100>jspb.BinaryDecoder.instanceCache_.length&&jspb.BinaryDecoder.instanceCache_.push(this)},jspb.BinaryDecoder.prototype.clone=function(){return jspb.BinaryDecoder.alloc(this.bytes_,this.start_,this.end_-this.start_)},jspb.BinaryDecoder.prototype.clear=function(){this.bytes_=null,this.cursor_=this.end_=this.start_=0,this.error_=!1},jspb.BinaryDecoder.prototype.getBuffer=function(){return this.bytes_},jspb.BinaryDecoder.prototype.setBlock=function(X,Z,_){this.bytes_=jspb.utils.byteSourceToUint8Array(X),this.start_=Z!==void 0?Z:0,this.end_=_!==void 0?this.start_+_:this.bytes_.length,this.cursor_=this.start_},jspb.BinaryDecoder.prototype.getEnd=function(){return this.end_},jspb.BinaryDecoder.prototype.setEnd=function(X){this.end_=X},jspb.BinaryDecoder.prototype.reset=function(){this.cursor_=this.start_},jspb.BinaryDecoder.prototype.getCursor=function(){return this.cursor_},jspb.BinaryDecoder.prototype.setCursor=function(X){this.cursor_=X},jspb.BinaryDecoder.prototype.advance=function(X){this.cursor_+=X,jspb.asserts.assert(this.cursor_<=this.end_)},jspb.BinaryDecoder.prototype.atEnd=function(){return this.cursor_==this.end_},jspb.BinaryDecoder.prototype.pastEnd=function(){return this.cursor_>this.end_},jspb.BinaryDecoder.prototype.getError=function(){return this.error_||0>this.cursor_||this.cursor_>this.end_},jspb.BinaryDecoder.prototype.readSplitVarint64=function(X){for(var Z=128,_=0,K=0,te=0;4>te&&128<=Z;te++)_|=(127&(Z=this.bytes_[this.cursor_++]))<<7*te;if(128<=Z&&(_|=(127&(Z=this.bytes_[this.cursor_++]))<<28,K|=(127&Z)>>4),128<=Z)for(te=0;5>te&&128<=Z;te++)K|=(127&(Z=this.bytes_[this.cursor_++]))<<7*te+3;if(128>Z)return X(_>>>0,K>>>0);jspb.asserts.fail("Failed to read varint, encoding is invalid."),this.error_=!0},jspb.BinaryDecoder.prototype.readSplitZigzagVarint64=function(X){return this.readSplitVarint64(function(Z,_){return jspb.utils.fromZigzag64(Z,_,X)})},jspb.BinaryDecoder.prototype.readSplitFixed64=function(X){var Z=this.bytes_,_=this.cursor_;this.cursor_+=8;for(var K=0,te=0,ne=_+7;ne>=_;ne--)K=K<<8|Z[ne],te=te<<8|Z[ne+4];return X(K,te)},jspb.BinaryDecoder.prototype.skipVarint=function(){for(;128&this.bytes_[this.cursor_];)this.cursor_++;this.cursor_++},jspb.BinaryDecoder.prototype.unskipVarint=function(X){for(;128<X;)this.cursor_--,X>>>=7;this.cursor_--},jspb.BinaryDecoder.prototype.readUnsignedVarint32=function(){var X=this.bytes_,Z=X[this.cursor_+0],_=127&Z;return 128>Z?(this.cursor_+=1,jspb.asserts.assert(this.cursor_<=this.end_),_):(_|=(127&(Z=X[this.cursor_+1]))<<7,128>Z?(this.cursor_+=2,jspb.asserts.assert(this.cursor_<=this.end_),_):(_|=(127&(Z=X[this.cursor_+2]))<<14,128>Z?(this.cursor_+=3,jspb.asserts.assert(this.cursor_<=this.end_),_):(_|=(127&(Z=X[this.cursor_+3]))<<21,128>Z?(this.cursor_+=4,jspb.asserts.assert(this.cursor_<=this.end_),_):(_|=(15&(Z=X[this.cursor_+4]))<<28,128>Z?(this.cursor_+=5,jspb.asserts.assert(this.cursor_<=this.end_),_>>>0):(this.cursor_+=5,128<=X[this.cursor_++]&&128<=X[this.cursor_++]&&128<=X[this.cursor_++]&&128<=X[this.cursor_++]&&128<=X[this.cursor_++]&&jspb.asserts.assert(!1),jspb.asserts.assert(this.cursor_<=this.end_),_)))))},jspb.BinaryDecoder.prototype.readSignedVarint32=function(){return~~this.readUnsignedVarint32()},jspb.BinaryDecoder.prototype.readUnsignedVarint32String=function(){return this.readUnsignedVarint32().toString()},jspb.BinaryDecoder.prototype.readSignedVarint32String=function(){return this.readSignedVarint32().toString()},jspb.BinaryDecoder.prototype.readZigzagVarint32=function(){var X=this.readUnsignedVarint32();return X>>>1^-(1&X)},jspb.BinaryDecoder.prototype.readUnsignedVarint64=function(){return this.readSplitVarint64(jspb.utils.joinUint64)},jspb.BinaryDecoder.prototype.readUnsignedVarint64String=function(){return this.readSplitVarint64(jspb.utils.joinUnsignedDecimalString)},jspb.BinaryDecoder.prototype.readSignedVarint64=function(){return this.readSplitVarint64(jspb.utils.joinInt64)},jspb.BinaryDecoder.prototype.readSignedVarint64String=function(){return this.readSplitVarint64(jspb.utils.joinSignedDecimalString)},jspb.BinaryDecoder.prototype.readZigzagVarint64=function(){return this.readSplitVarint64(jspb.utils.joinZigzag64)},jspb.BinaryDecoder.prototype.readZigzagVarintHash64=function(){return this.readSplitZigzagVarint64(jspb.utils.joinHash64)},jspb.BinaryDecoder.prototype.readZigzagVarint64String=function(){return this.readSplitZigzagVarint64(jspb.utils.joinSignedDecimalString)},jspb.BinaryDecoder.prototype.readUint8=function(){var X=this.bytes_[this.cursor_+0];return this.cursor_+=1,jspb.asserts.assert(this.cursor_<=this.end_),X},jspb.BinaryDecoder.prototype.readUint16=function(){var X=this.bytes_[this.cursor_+0],Z=this.bytes_[this.cursor_+1];return this.cursor_+=2,jspb.asserts.assert(this.cursor_<=this.end_),X|Z<<8},jspb.BinaryDecoder.prototype.readUint32=function(){var X=this.bytes_[this.cursor_+0],Z=this.bytes_[this.cursor_+1],_=this.bytes_[this.cursor_+2],K=this.bytes_[this.cursor_+3];return this.cursor_+=4,jspb.asserts.assert(this.cursor_<=this.end_),(X|Z<<8|_<<16|K<<24)>>>0},jspb.BinaryDecoder.prototype.readUint64=function(){var X=this.readUint32(),Z=this.readUint32();return jspb.utils.joinUint64(X,Z)},jspb.BinaryDecoder.prototype.readUint64String=function(){var X=this.readUint32(),Z=this.readUint32();return jspb.utils.joinUnsignedDecimalString(X,Z)},jspb.BinaryDecoder.prototype.readInt8=function(){var X=this.bytes_[this.cursor_+0];return this.cursor_+=1,jspb.asserts.assert(this.cursor_<=this.end_),X<<24>>24},jspb.BinaryDecoder.prototype.readInt16=function(){var X=this.bytes_[this.cursor_+0],Z=this.bytes_[this.cursor_+1];return this.cursor_+=2,jspb.asserts.assert(this.cursor_<=this.end_),(X|Z<<8)<<16>>16},jspb.BinaryDecoder.prototype.readInt32=function(){var X=this.bytes_[this.cursor_+0],Z=this.bytes_[this.cursor_+1],_=this.bytes_[this.cursor_+2],K=this.bytes_[this.cursor_+3];return this.cursor_+=4,jspb.asserts.assert(this.cursor_<=this.end_),X|Z<<8|_<<16|K<<24},jspb.BinaryDecoder.prototype.readInt64=function(){var X=this.readUint32(),Z=this.readUint32();return jspb.utils.joinInt64(X,Z)},jspb.BinaryDecoder.prototype.readInt64String=function(){var X=this.readUint32(),Z=this.readUint32();return jspb.utils.joinSignedDecimalString(X,Z)},jspb.BinaryDecoder.prototype.readFloat=function(){var X=this.readUint32();return jspb.utils.joinFloat32(X,0)},jspb.BinaryDecoder.prototype.readDouble=function(){var X=this.readUint32(),Z=this.readUint32();return jspb.utils.joinFloat64(X,Z)},jspb.BinaryDecoder.prototype.readBool=function(){return!!this.bytes_[this.cursor_++]},jspb.BinaryDecoder.prototype.readEnum=function(){return this.readSignedVarint32()},jspb.BinaryDecoder.prototype.readString=function(X){var Z=this.bytes_,_=this.cursor_;X=_+X;for(var K=[],te="";_<X;){var ne=Z[_++];if(128>ne)K.push(ne);else{if(192>ne)continue;if(224>ne){var ie=Z[_++];K.push((31&ne)<<6|63&ie)}else if(240>ne){ie=Z[_++];var oe=Z[_++];K.push((15&ne)<<12|(63&ie)<<6|63&oe)}else 248>ne&&(ne=(7&ne)<<18|(63&(ie=Z[_++]))<<12|(63&(oe=Z[_++]))<<6|63&Z[_++],ne-=65536,K.push(55296+(ne>>10&1023),56320+(1023&ne)))}8192<=K.length&&(te+=String.fromCharCode.apply(null,K),K.length=0)}return te+=goog.crypt.byteArrayToString(K),this.cursor_=_,te},jspb.BinaryDecoder.prototype.readStringWithLength=function(){var X=this.readUnsignedVarint32();return this.readString(X)},jspb.BinaryDecoder.prototype.readBytes=function(X){if(0>X||this.cursor_+X>this.bytes_.length)return this.error_=!0,jspb.asserts.fail("Invalid byte length!"),new Uint8Array(0);var Z=this.bytes_.subarray(this.cursor_,this.cursor_+X);return this.cursor_+=X,jspb.asserts.assert(this.cursor_<=this.end_),Z},jspb.BinaryDecoder.prototype.readVarintHash64=function(){return this.readSplitVarint64(jspb.utils.joinHash64)},jspb.BinaryDecoder.prototype.readFixedHash64=function(){var X=this.bytes_,Z=this.cursor_,_=X[Z+0],K=X[Z+1],te=X[Z+2],ne=X[Z+3],ie=X[Z+4],oe=X[Z+5],se=X[Z+6];return X=X[Z+7],this.cursor_+=8,String.fromCharCode(_,K,te,ne,ie,oe,se,X)},jspb.BinaryReader=function(X,Z,_){this.decoder_=jspb.BinaryDecoder.alloc(X,Z,_),this.fieldCursor_=this.decoder_.getCursor(),this.nextField_=jspb.BinaryConstants.INVALID_FIELD_NUMBER,this.nextWireType_=jspb.BinaryConstants.WireType.INVALID,this.error_=!1,this.readCallbacks_=null},jspb.BinaryReader.instanceCache_=[],jspb.BinaryReader.alloc=function(X,Z,_){if(jspb.BinaryReader.instanceCache_.length){var K=jspb.BinaryReader.instanceCache_.pop();return X&&K.decoder_.setBlock(X,Z,_),K}return new jspb.BinaryReader(X,Z,_)},jspb.BinaryReader.prototype.alloc=jspb.BinaryReader.alloc,jspb.BinaryReader.prototype.free=function(){this.decoder_.clear(),this.nextField_=jspb.BinaryConstants.INVALID_FIELD_NUMBER,this.nextWireType_=jspb.BinaryConstants.WireType.INVALID,this.error_=!1,this.readCallbacks_=null,100>jspb.BinaryReader.instanceCache_.length&&jspb.BinaryReader.instanceCache_.push(this)},jspb.BinaryReader.prototype.getFieldCursor=function(){return this.fieldCursor_},jspb.BinaryReader.prototype.getCursor=function(){return this.decoder_.getCursor()},jspb.BinaryReader.prototype.getBuffer=function(){return this.decoder_.getBuffer()},jspb.BinaryReader.prototype.getFieldNumber=function(){return this.nextField_},goog.exportProperty(jspb.BinaryReader.prototype,"getFieldNumber",jspb.BinaryReader.prototype.getFieldNumber),jspb.BinaryReader.prototype.getWireType=function(){return this.nextWireType_},jspb.BinaryReader.prototype.isDelimited=function(){return this.nextWireType_==jspb.BinaryConstants.WireType.DELIMITED},goog.exportProperty(jspb.BinaryReader.prototype,"isDelimited",jspb.BinaryReader.prototype.isDelimited),jspb.BinaryReader.prototype.isEndGroup=function(){return this.nextWireType_==jspb.BinaryConstants.WireType.END_GROUP},goog.exportProperty(jspb.BinaryReader.prototype,"isEndGroup",jspb.BinaryReader.prototype.isEndGroup),jspb.BinaryReader.prototype.getError=function(){return this.error_||this.decoder_.getError()},jspb.BinaryReader.prototype.setBlock=function(X,Z,_){this.decoder_.setBlock(X,Z,_),this.nextField_=jspb.BinaryConstants.INVALID_FIELD_NUMBER,this.nextWireType_=jspb.BinaryConstants.WireType.INVALID},jspb.BinaryReader.prototype.reset=function(){this.decoder_.reset(),this.nextField_=jspb.BinaryConstants.INVALID_FIELD_NUMBER,this.nextWireType_=jspb.BinaryConstants.WireType.INVALID},jspb.BinaryReader.prototype.advance=function(X){this.decoder_.advance(X)},jspb.BinaryReader.prototype.nextField=function(){if(this.decoder_.atEnd())return!1;if(this.getError())return jspb.asserts.fail("Decoder hit an error"),!1;this.fieldCursor_=this.decoder_.getCursor();var X=this.decoder_.readUnsignedVarint32(),Z=X>>>3;return(X&=7)!=jspb.BinaryConstants.WireType.VARINT&&X!=jspb.BinaryConstants.WireType.FIXED32&&X!=jspb.BinaryConstants.WireType.FIXED64&&X!=jspb.BinaryConstants.WireType.DELIMITED&&X!=jspb.BinaryConstants.WireType.START_GROUP&&X!=jspb.BinaryConstants.WireType.END_GROUP?(jspb.asserts.fail("Invalid wire type: %s (at position %s)",X,this.fieldCursor_),this.error_=!0,!1):(this.nextField_=Z,this.nextWireType_=X,!0)},goog.exportProperty(jspb.BinaryReader.prototype,"nextField",jspb.BinaryReader.prototype.nextField),jspb.BinaryReader.prototype.unskipHeader=function(){this.decoder_.unskipVarint(this.nextField_<<3|this.nextWireType_)},jspb.BinaryReader.prototype.skipMatchingFields=function(){var X=this.nextField_;for(this.unskipHeader();this.nextField()&&this.getFieldNumber()==X;)this.skipField();this.decoder_.atEnd()||this.unskipHeader()},jspb.BinaryReader.prototype.skipVarintField=function(){this.nextWireType_!=jspb.BinaryConstants.WireType.VARINT?(jspb.asserts.fail("Invalid wire type for skipVarintField"),this.skipField()):this.decoder_.skipVarint()},jspb.BinaryReader.prototype.skipDelimitedField=function(){if(this.nextWireType_!=jspb.BinaryConstants.WireType.DELIMITED)jspb.asserts.fail("Invalid wire type for skipDelimitedField"),this.skipField();else{var X=this.decoder_.readUnsignedVarint32();this.decoder_.advance(X)}},jspb.BinaryReader.prototype.skipFixed32Field=function(){this.nextWireType_!=jspb.BinaryConstants.WireType.FIXED32?(jspb.asserts.fail("Invalid wire type for skipFixed32Field"),this.skipField()):this.decoder_.advance(4)},jspb.BinaryReader.prototype.skipFixed64Field=function(){this.nextWireType_!=jspb.BinaryConstants.WireType.FIXED64?(jspb.asserts.fail("Invalid wire type for skipFixed64Field"),this.skipField()):this.decoder_.advance(8)},jspb.BinaryReader.prototype.skipGroup=function(){for(var X=this.nextField_;;){if(!this.nextField()){jspb.asserts.fail("Unmatched start-group tag: stream EOF"),this.error_=!0;break}if(this.nextWireType_==jspb.BinaryConstants.WireType.END_GROUP){this.nextField_!=X&&(jspb.asserts.fail("Unmatched end-group tag"),this.error_=!0);break}this.skipField()}},jspb.BinaryReader.prototype.skipField=function(){switch(this.nextWireType_){case jspb.BinaryConstants.WireType.VARINT:this.skipVarintField();break;case jspb.BinaryConstants.WireType.FIXED64:this.skipFixed64Field();break;case jspb.BinaryConstants.WireType.DELIMITED:this.skipDelimitedField();break;case jspb.BinaryConstants.WireType.FIXED32:this.skipFixed32Field();break;case jspb.BinaryConstants.WireType.START_GROUP:this.skipGroup();break;default:jspb.asserts.fail("Invalid wire encoding for field.")}},jspb.BinaryReader.prototype.registerReadCallback=function(X,Z){this.readCallbacks_===null&&(this.readCallbacks_={}),jspb.asserts.assert(!this.readCallbacks_[X]),this.readCallbacks_[X]=Z},jspb.BinaryReader.prototype.runReadCallback=function(X){return jspb.asserts.assert(this.readCallbacks_!==null),X=this.readCallbacks_[X],jspb.asserts.assert(X),X(this)},jspb.BinaryReader.prototype.readAny=function(X){this.nextWireType_=jspb.BinaryConstants.FieldTypeToWireType(X);var Z=jspb.BinaryConstants.FieldType;switch(X){case Z.DOUBLE:return this.readDouble();case Z.FLOAT:return this.readFloat();case Z.INT64:return this.readInt64();case Z.UINT64:return this.readUint64();case Z.INT32:return this.readInt32();case Z.FIXED64:return this.readFixed64();case Z.FIXED32:return this.readFixed32();case Z.BOOL:return this.readBool();case Z.STRING:return this.readString();case Z.GROUP:jspb.asserts.fail("Group field type not supported in readAny()");case Z.MESSAGE:jspb.asserts.fail("Message field type not supported in readAny()");case Z.BYTES:return this.readBytes();case Z.UINT32:return this.readUint32();case Z.ENUM:return this.readEnum();case Z.SFIXED32:return this.readSfixed32();case Z.SFIXED64:return this.readSfixed64();case Z.SINT32:return this.readSint32();case Z.SINT64:return this.readSint64();case Z.FHASH64:return this.readFixedHash64();case Z.VHASH64:return this.readVarintHash64();default:jspb.asserts.fail("Invalid field type in readAny()")}return 0},jspb.BinaryReader.prototype.readMessage=function(X,Z){jspb.asserts.assert(this.nextWireType_==jspb.BinaryConstants.WireType.DELIMITED);var _=this.decoder_.getEnd(),K=this.decoder_.readUnsignedVarint32();K=this.decoder_.getCursor()+K,this.decoder_.setEnd(K),Z(X,this),this.decoder_.setCursor(K),this.decoder_.setEnd(_)},goog.exportProperty(jspb.BinaryReader.prototype,"readMessage",jspb.BinaryReader.prototype.readMessage),jspb.BinaryReader.prototype.readGroup=function(X,Z,_){jspb.asserts.assert(this.nextWireType_==jspb.BinaryConstants.WireType.START_GROUP),jspb.asserts.assert(this.nextField_==X),_(Z,this),this.error_||this.nextWireType_==jspb.BinaryConstants.WireType.END_GROUP||(jspb.asserts.fail("Group submessage did not end with an END_GROUP tag"),this.error_=!0)},goog.exportProperty(jspb.BinaryReader.prototype,"readGroup",jspb.BinaryReader.prototype.readGroup),jspb.BinaryReader.prototype.getFieldDecoder=function(){jspb.asserts.assert(this.nextWireType_==jspb.BinaryConstants.WireType.DELIMITED);var X=this.decoder_.readUnsignedVarint32(),Z=this.decoder_.getCursor(),_=Z+X;return X=jspb.BinaryDecoder.alloc(this.decoder_.getBuffer(),Z,X),this.decoder_.setCursor(_),X},jspb.BinaryReader.prototype.readInt32=function(){return jspb.asserts.assert(this.nextWireType_==jspb.BinaryConstants.WireType.VARINT),this.decoder_.readSignedVarint32()},goog.exportProperty(jspb.BinaryReader.prototype,"readInt32",jspb.BinaryReader.prototype.readInt32),jspb.BinaryReader.prototype.readInt32String=function(){return jspb.asserts.assert(this.nextWireType_==jspb.BinaryConstants.WireType.VARINT),this.decoder_.readSignedVarint32String()},jspb.BinaryReader.prototype.readInt64=function(){return jspb.asserts.assert(this.nextWireType_==jspb.BinaryConstants.WireType.VARINT),this.decoder_.readSignedVarint64()},goog.exportProperty(jspb.BinaryReader.prototype,"readInt64",jspb.BinaryReader.prototype.readInt64),jspb.BinaryReader.prototype.readInt64String=function(){return jspb.asserts.assert(this.nextWireType_==jspb.BinaryConstants.WireType.VARINT),this.decoder_.readSignedVarint64String()},jspb.BinaryReader.prototype.readUint32=function(){return jspb.asserts.assert(this.nextWireType_==jspb.BinaryConstants.WireType.VARINT),this.decoder_.readUnsignedVarint32()},goog.exportProperty(jspb.BinaryReader.prototype,"readUint32",jspb.BinaryReader.prototype.readUint32),jspb.BinaryReader.prototype.readUint32String=function(){return jspb.asserts.assert(this.nextWireType_==jspb.BinaryConstants.WireType.VARINT),this.decoder_.readUnsignedVarint32String()},jspb.BinaryReader.prototype.readUint64=function(){return jspb.asserts.assert(this.nextWireType_==jspb.BinaryConstants.WireType.VARINT),this.decoder_.readUnsignedVarint64()},goog.exportProperty(jspb.BinaryReader.prototype,"readUint64",jspb.BinaryReader.prototype.readUint64),jspb.BinaryReader.prototype.readUint64String=function(){return jspb.asserts.assert(this.nextWireType_==jspb.BinaryConstants.WireType.VARINT),this.decoder_.readUnsignedVarint64String()},jspb.BinaryReader.prototype.readSint32=function(){return jspb.asserts.assert(this.nextWireType_==jspb.BinaryConstants.WireType.VARINT),this.decoder_.readZigzagVarint32()},goog.exportProperty(jspb.BinaryReader.prototype,"readSint32",jspb.BinaryReader.prototype.readSint32),jspb.BinaryReader.prototype.readSint64=function(){return jspb.asserts.assert(this.nextWireType_==jspb.BinaryConstants.WireType.VARINT),this.decoder_.readZigzagVarint64()},goog.exportProperty(jspb.BinaryReader.prototype,"readSint64",jspb.BinaryReader.prototype.readSint64),jspb.BinaryReader.prototype.readSint64String=function(){return jspb.asserts.assert(this.nextWireType_==jspb.BinaryConstants.WireType.VARINT),this.decoder_.readZigzagVarint64String()},jspb.BinaryReader.prototype.readFixed32=function(){return jspb.asserts.assert(this.nextWireType_==jspb.BinaryConstants.WireType.FIXED32),this.decoder_.readUint32()},goog.exportProperty(jspb.BinaryReader.prototype,"readFixed32",jspb.BinaryReader.prototype.readFixed32),jspb.BinaryReader.prototype.readFixed64=function(){return jspb.asserts.assert(this.nextWireType_==jspb.BinaryConstants.WireType.FIXED64),this.decoder_.readUint64()},goog.exportProperty(jspb.BinaryReader.prototype,"readFixed64",jspb.BinaryReader.prototype.readFixed64),jspb.BinaryReader.prototype.readFixed64String=function(){return jspb.asserts.assert(this.nextWireType_==jspb.BinaryConstants.WireType.FIXED64),this.decoder_.readUint64String()},jspb.BinaryReader.prototype.readSfixed32=function(){return jspb.asserts.assert(this.nextWireType_==jspb.BinaryConstants.WireType.FIXED32),this.decoder_.readInt32()},goog.exportProperty(jspb.BinaryReader.prototype,"readSfixed32",jspb.BinaryReader.prototype.readSfixed32),jspb.BinaryReader.prototype.readSfixed32String=function(){return jspb.asserts.assert(this.nextWireType_==jspb.BinaryConstants.WireType.FIXED32),this.decoder_.readInt32().toString()},jspb.BinaryReader.prototype.readSfixed64=function(){return jspb.asserts.assert(this.nextWireType_==jspb.BinaryConstants.WireType.FIXED64),this.decoder_.readInt64()},goog.exportProperty(jspb.BinaryReader.prototype,"readSfixed64",jspb.BinaryReader.prototype.readSfixed64),jspb.BinaryReader.prototype.readSfixed64String=function(){return jspb.asserts.assert(this.nextWireType_==jspb.BinaryConstants.WireType.FIXED64),this.decoder_.readInt64String()},jspb.BinaryReader.prototype.readFloat=function(){return jspb.asserts.assert(this.nextWireType_==jspb.BinaryConstants.WireType.FIXED32),this.decoder_.readFloat()},goog.exportProperty(jspb.BinaryReader.prototype,"readFloat",jspb.BinaryReader.prototype.readFloat),jspb.BinaryReader.prototype.readDouble=function(){return jspb.asserts.assert(this.nextWireType_==jspb.BinaryConstants.WireType.FIXED64),this.decoder_.readDouble()},goog.exportProperty(jspb.BinaryReader.prototype,"readDouble",jspb.BinaryReader.prototype.readDouble),jspb.BinaryReader.prototype.readBool=function(){return jspb.asserts.assert(this.nextWireType_==jspb.BinaryConstants.WireType.VARINT),!!this.decoder_.readUnsignedVarint32()},goog.exportProperty(jspb.BinaryReader.prototype,"readBool",jspb.BinaryReader.prototype.readBool),jspb.BinaryReader.prototype.readEnum=function(){return jspb.asserts.assert(this.nextWireType_==jspb.BinaryConstants.WireType.VARINT),this.decoder_.readSignedVarint64()},goog.exportProperty(jspb.BinaryReader.prototype,"readEnum",jspb.BinaryReader.prototype.readEnum),jspb.BinaryReader.prototype.readString=function(){jspb.asserts.assert(this.nextWireType_==jspb.BinaryConstants.WireType.DELIMITED);var X=this.decoder_.readUnsignedVarint32();return this.decoder_.readString(X)},goog.exportProperty(jspb.BinaryReader.prototype,"readString",jspb.BinaryReader.prototype.readString),jspb.BinaryReader.prototype.readBytes=function(){jspb.asserts.assert(this.nextWireType_==jspb.BinaryConstants.WireType.DELIMITED);var X=this.decoder_.readUnsignedVarint32();return this.decoder_.readBytes(X)},goog.exportProperty(jspb.BinaryReader.prototype,"readBytes",jspb.BinaryReader.prototype.readBytes),jspb.BinaryReader.prototype.readVarintHash64=function(){return jspb.asserts.assert(this.nextWireType_==jspb.BinaryConstants.WireType.VARINT),this.decoder_.readVarintHash64()},jspb.BinaryReader.prototype.readSintHash64=function(){return jspb.asserts.assert(this.nextWireType_==jspb.BinaryConstants.WireType.VARINT),this.decoder_.readZigzagVarintHash64()},jspb.BinaryReader.prototype.readSplitVarint64=function(X){return jspb.asserts.assert(this.nextWireType_==jspb.BinaryConstants.WireType.VARINT),this.decoder_.readSplitVarint64(X)},jspb.BinaryReader.prototype.readSplitZigzagVarint64=function(X){return jspb.asserts.assert(this.nextWireType_==jspb.BinaryConstants.WireType.VARINT),this.decoder_.readSplitVarint64(function(Z,_){return jspb.utils.fromZigzag64(Z,_,X)})},jspb.BinaryReader.prototype.readFixedHash64=function(){return jspb.asserts.assert(this.nextWireType_==jspb.BinaryConstants.WireType.FIXED64),this.decoder_.readFixedHash64()},jspb.BinaryReader.prototype.readSplitFixed64=function(X){return jspb.asserts.assert(this.nextWireType_==jspb.BinaryConstants.WireType.FIXED64),this.decoder_.readSplitFixed64(X)},jspb.BinaryReader.prototype.readPackedField_=function(X){jspb.asserts.assert(this.nextWireType_==jspb.BinaryConstants.WireType.DELIMITED);var Z=this.decoder_.readUnsignedVarint32();Z=this.decoder_.getCursor()+Z;for(var _=[];this.decoder_.getCursor()<Z;)_.push(X.call(this.decoder_));return _},jspb.BinaryReader.prototype.readPackedInt32=function(){return this.readPackedField_(this.decoder_.readSignedVarint32)},goog.exportProperty(jspb.BinaryReader.prototype,"readPackedInt32",jspb.BinaryReader.prototype.readPackedInt32),jspb.BinaryReader.prototype.readPackedInt32String=function(){return this.readPackedField_(this.decoder_.readSignedVarint32String)},jspb.BinaryReader.prototype.readPackedInt64=function(){return this.readPackedField_(this.decoder_.readSignedVarint64)},goog.exportProperty(jspb.BinaryReader.prototype,"readPackedInt64",jspb.BinaryReader.prototype.readPackedInt64),jspb.BinaryReader.prototype.readPackedInt64String=function(){return this.readPackedField_(this.decoder_.readSignedVarint64String)},jspb.BinaryReader.prototype.readPackedUint32=function(){return this.readPackedField_(this.decoder_.readUnsignedVarint32)},goog.exportProperty(jspb.BinaryReader.prototype,"readPackedUint32",jspb.BinaryReader.prototype.readPackedUint32),jspb.BinaryReader.prototype.readPackedUint32String=function(){return this.readPackedField_(this.decoder_.readUnsignedVarint32String)},jspb.BinaryReader.prototype.readPackedUint64=function(){return this.readPackedField_(this.decoder_.readUnsignedVarint64)},goog.exportProperty(jspb.BinaryReader.prototype,"readPackedUint64",jspb.BinaryReader.prototype.readPackedUint64),jspb.BinaryReader.prototype.readPackedUint64String=function(){return this.readPackedField_(this.decoder_.readUnsignedVarint64String)},jspb.BinaryReader.prototype.readPackedSint32=function(){return this.readPackedField_(this.decoder_.readZigzagVarint32)},goog.exportProperty(jspb.BinaryReader.prototype,"readPackedSint32",jspb.BinaryReader.prototype.readPackedSint32),jspb.BinaryReader.prototype.readPackedSint64=function(){return this.readPackedField_(this.decoder_.readZigzagVarint64)},goog.exportProperty(jspb.BinaryReader.prototype,"readPackedSint64",jspb.BinaryReader.prototype.readPackedSint64),jspb.BinaryReader.prototype.readPackedSint64String=function(){return this.readPackedField_(this.decoder_.readZigzagVarint64String)},jspb.BinaryReader.prototype.readPackedFixed32=function(){return this.readPackedField_(this.decoder_.readUint32)},goog.exportProperty(jspb.BinaryReader.prototype,"readPackedFixed32",jspb.BinaryReader.prototype.readPackedFixed32),jspb.BinaryReader.prototype.readPackedFixed64=function(){return this.readPackedField_(this.decoder_.readUint64)},goog.exportProperty(jspb.BinaryReader.prototype,"readPackedFixed64",jspb.BinaryReader.prototype.readPackedFixed64),jspb.BinaryReader.prototype.readPackedFixed64String=function(){return this.readPackedField_(this.decoder_.readUint64String)},jspb.BinaryReader.prototype.readPackedSfixed32=function(){return this.readPackedField_(this.decoder_.readInt32)},goog.exportProperty(jspb.BinaryReader.prototype,"readPackedSfixed32",jspb.BinaryReader.prototype.readPackedSfixed32),jspb.BinaryReader.prototype.readPackedSfixed64=function(){return this.readPackedField_(this.decoder_.readInt64)},goog.exportProperty(jspb.BinaryReader.prototype,"readPackedSfixed64",jspb.BinaryReader.prototype.readPackedSfixed64),jspb.BinaryReader.prototype.readPackedSfixed64String=function(){return this.readPackedField_(this.decoder_.readInt64String)},jspb.BinaryReader.prototype.readPackedFloat=function(){return this.readPackedField_(this.decoder_.readFloat)},goog.exportProperty(jspb.BinaryReader.prototype,"readPackedFloat",jspb.BinaryReader.prototype.readPackedFloat),jspb.BinaryReader.prototype.readPackedDouble=function(){return this.readPackedField_(this.decoder_.readDouble)},goog.exportProperty(jspb.BinaryReader.prototype,"readPackedDouble",jspb.BinaryReader.prototype.readPackedDouble),jspb.BinaryReader.prototype.readPackedBool=function(){return this.readPackedField_(this.decoder_.readBool)},goog.exportProperty(jspb.BinaryReader.prototype,"readPackedBool",jspb.BinaryReader.prototype.readPackedBool),jspb.BinaryReader.prototype.readPackedEnum=function(){return this.readPackedField_(this.decoder_.readEnum)},goog.exportProperty(jspb.BinaryReader.prototype,"readPackedEnum",jspb.BinaryReader.prototype.readPackedEnum),jspb.BinaryReader.prototype.readPackedVarintHash64=function(){return this.readPackedField_(this.decoder_.readVarintHash64)},jspb.BinaryReader.prototype.readPackedFixedHash64=function(){return this.readPackedField_(this.decoder_.readFixedHash64)},jspb.BinaryEncoder=function(){this.buffer_=[]},jspb.BinaryEncoder.prototype.length=function(){return this.buffer_.length},jspb.BinaryEncoder.prototype.end=function(){var X=this.buffer_;return this.buffer_=[],X},jspb.BinaryEncoder.prototype.writeSplitVarint64=function(X,Z){for(jspb.asserts.assert(X==Math.floor(X)),jspb.asserts.assert(Z==Math.floor(Z)),jspb.asserts.assert(0<=X&&X<jspb.BinaryConstants.TWO_TO_32),jspb.asserts.assert(0<=Z&&Z<jspb.BinaryConstants.TWO_TO_32);0<Z||127<X;)this.buffer_.push(127&X|128),X=(X>>>7|Z<<25)>>>0,Z>>>=7;this.buffer_.push(X)},jspb.BinaryEncoder.prototype.writeSplitFixed64=function(X,Z){jspb.asserts.assert(X==Math.floor(X)),jspb.asserts.assert(Z==Math.floor(Z)),jspb.asserts.assert(0<=X&&X<jspb.BinaryConstants.TWO_TO_32),jspb.asserts.assert(0<=Z&&Z<jspb.BinaryConstants.TWO_TO_32),this.writeUint32(X),this.writeUint32(Z)},jspb.BinaryEncoder.prototype.writeUnsignedVarint32=function(X){for(jspb.asserts.assert(X==Math.floor(X)),jspb.asserts.assert(0<=X&&X<jspb.BinaryConstants.TWO_TO_32);127<X;)this.buffer_.push(127&X|128),X>>>=7;this.buffer_.push(X)},jspb.BinaryEncoder.prototype.writeSignedVarint32=function(X){if(jspb.asserts.assert(X==Math.floor(X)),jspb.asserts.assert(X>=-jspb.BinaryConstants.TWO_TO_31&&X<jspb.BinaryConstants.TWO_TO_31),0<=X)this.writeUnsignedVarint32(X);else{for(var Z=0;9>Z;Z++)this.buffer_.push(127&X|128),X>>=7;this.buffer_.push(1)}},jspb.BinaryEncoder.prototype.writeUnsignedVarint64=function(X){jspb.asserts.assert(X==Math.floor(X)),jspb.asserts.assert(0<=X&&X<jspb.BinaryConstants.TWO_TO_64),jspb.utils.splitInt64(X),this.writeSplitVarint64(jspb.utils.split64Low,jspb.utils.split64High)},jspb.BinaryEncoder.prototype.writeSignedVarint64=function(X){jspb.asserts.assert(X==Math.floor(X)),jspb.asserts.assert(X>=-jspb.BinaryConstants.TWO_TO_63&&X<jspb.BinaryConstants.TWO_TO_63),jspb.utils.splitInt64(X),this.writeSplitVarint64(jspb.utils.split64Low,jspb.utils.split64High)},jspb.BinaryEncoder.prototype.writeZigzagVarint32=function(X){jspb.asserts.assert(X==Math.floor(X)),jspb.asserts.assert(X>=-jspb.BinaryConstants.TWO_TO_31&&X<jspb.BinaryConstants.TWO_TO_31),this.writeUnsignedVarint32((X<<1^X>>31)>>>0)},jspb.BinaryEncoder.prototype.writeZigzagVarint64=function(X){jspb.asserts.assert(X==Math.floor(X)),jspb.asserts.assert(X>=-jspb.BinaryConstants.TWO_TO_63&&X<jspb.BinaryConstants.TWO_TO_63),jspb.utils.splitZigzag64(X),this.writeSplitVarint64(jspb.utils.split64Low,jspb.utils.split64High)},jspb.BinaryEncoder.prototype.writeZigzagVarint64String=function(X){this.writeZigzagVarintHash64(jspb.utils.decimalStringToHash64(X))},jspb.BinaryEncoder.prototype.writeZigzagVarintHash64=function(X){var Z=this;jspb.utils.splitHash64(X),jspb.utils.toZigzag64(jspb.utils.split64Low,jspb.utils.split64High,function(_,K){Z.writeSplitVarint64(_>>>0,K>>>0)})},jspb.BinaryEncoder.prototype.writeUint8=function(X){jspb.asserts.assert(X==Math.floor(X)),jspb.asserts.assert(0<=X&&256>X),this.buffer_.push(X>>>0&255)},jspb.BinaryEncoder.prototype.writeUint16=function(X){jspb.asserts.assert(X==Math.floor(X)),jspb.asserts.assert(0<=X&&65536>X),this.buffer_.push(X>>>0&255),this.buffer_.push(X>>>8&255)},jspb.BinaryEncoder.prototype.writeUint32=function(X){jspb.asserts.assert(X==Math.floor(X)),jspb.asserts.assert(0<=X&&X<jspb.BinaryConstants.TWO_TO_32),this.buffer_.push(X>>>0&255),this.buffer_.push(X>>>8&255),this.buffer_.push(X>>>16&255),this.buffer_.push(X>>>24&255)},jspb.BinaryEncoder.prototype.writeUint64=function(X){jspb.asserts.assert(X==Math.floor(X)),jspb.asserts.assert(0<=X&&X<jspb.BinaryConstants.TWO_TO_64),jspb.utils.splitUint64(X),this.writeUint32(jspb.utils.split64Low),this.writeUint32(jspb.utils.split64High)},jspb.BinaryEncoder.prototype.writeInt8=function(X){jspb.asserts.assert(X==Math.floor(X)),jspb.asserts.assert(-128<=X&&128>X),this.buffer_.push(X>>>0&255)},jspb.BinaryEncoder.prototype.writeInt16=function(X){jspb.asserts.assert(X==Math.floor(X)),jspb.asserts.assert(-32768<=X&&32768>X),this.buffer_.push(X>>>0&255),this.buffer_.push(X>>>8&255)},jspb.BinaryEncoder.prototype.writeInt32=function(X){jspb.asserts.assert(X==Math.floor(X)),jspb.asserts.assert(X>=-jspb.BinaryConstants.TWO_TO_31&&X<jspb.BinaryConstants.TWO_TO_31),this.buffer_.push(X>>>0&255),this.buffer_.push(X>>>8&255),this.buffer_.push(X>>>16&255),this.buffer_.push(X>>>24&255)},jspb.BinaryEncoder.prototype.writeInt64=function(X){jspb.asserts.assert(X==Math.floor(X)),jspb.asserts.assert(X>=-jspb.BinaryConstants.TWO_TO_63&&X<jspb.BinaryConstants.TWO_TO_63),jspb.utils.splitInt64(X),this.writeSplitFixed64(jspb.utils.split64Low,jspb.utils.split64High)},jspb.BinaryEncoder.prototype.writeInt64String=function(X){jspb.asserts.assert(X==Math.floor(X)),jspb.asserts.assert(+X>=-jspb.BinaryConstants.TWO_TO_63&&+X<jspb.BinaryConstants.TWO_TO_63),jspb.utils.splitHash64(jspb.utils.decimalStringToHash64(X)),this.writeSplitFixed64(jspb.utils.split64Low,jspb.utils.split64High)},jspb.BinaryEncoder.prototype.writeFloat=function(X){jspb.asserts.assert(X===1/0||X===-1/0||isNaN(X)||X>=-jspb.BinaryConstants.FLOAT32_MAX&&X<=jspb.BinaryConstants.FLOAT32_MAX),jspb.utils.splitFloat32(X),this.writeUint32(jspb.utils.split64Low)},jspb.BinaryEncoder.prototype.writeDouble=function(X){jspb.asserts.assert(X===1/0||X===-1/0||isNaN(X)||X>=-jspb.BinaryConstants.FLOAT64_MAX&&X<=jspb.BinaryConstants.FLOAT64_MAX),jspb.utils.splitFloat64(X),this.writeUint32(jspb.utils.split64Low),this.writeUint32(jspb.utils.split64High)},jspb.BinaryEncoder.prototype.writeBool=function(X){jspb.asserts.assert(typeof X=="boolean"||typeof X=="number"),this.buffer_.push(X?1:0)},jspb.BinaryEncoder.prototype.writeEnum=function(X){jspb.asserts.assert(X==Math.floor(X)),jspb.asserts.assert(X>=-jspb.BinaryConstants.TWO_TO_31&&X<jspb.BinaryConstants.TWO_TO_31),this.writeSignedVarint32(X)},jspb.BinaryEncoder.prototype.writeBytes=function(X){this.buffer_.push.apply(this.buffer_,X)},jspb.BinaryEncoder.prototype.writeVarintHash64=function(X){jspb.utils.splitHash64(X),this.writeSplitVarint64(jspb.utils.split64Low,jspb.utils.split64High)},jspb.BinaryEncoder.prototype.writeFixedHash64=function(X){jspb.utils.splitHash64(X),this.writeUint32(jspb.utils.split64Low),this.writeUint32(jspb.utils.split64High)},jspb.BinaryEncoder.prototype.writeString=function(X){var Z=this.buffer_.length;jspb.asserts.assertString(X);for(var _=0;_<X.length;_++){var K=X.charCodeAt(_);if(128>K)this.buffer_.push(K);else if(2048>K)this.buffer_.push(K>>6|192),this.buffer_.push(63&K|128);else if(65536>K)if(55296<=K&&56319>=K&&_+1<X.length){var te=X.charCodeAt(_+1);56320<=te&&57343>=te&&(K=1024*(K-55296)+te-56320+65536,this.buffer_.push(K>>18|240),this.buffer_.push(K>>12&63|128),this.buffer_.push(K>>6&63|128),this.buffer_.push(63&K|128),_++)}else this.buffer_.push(K>>12|224),this.buffer_.push(K>>6&63|128),this.buffer_.push(63&K|128)}return this.buffer_.length-Z},jspb.arith={},jspb.arith.UInt64=function(X,Z){this.lo=X,this.hi=Z},jspb.arith.UInt64.prototype.cmp=function(X){return this.hi<X.hi||this.hi==X.hi&&this.lo<X.lo?-1:this.hi==X.hi&&this.lo==X.lo?0:1},jspb.arith.UInt64.prototype.rightShift=function(){return new jspb.arith.UInt64((this.lo>>>1|(1&this.hi)<<31)>>>0,this.hi>>>1>>>0)},jspb.arith.UInt64.prototype.leftShift=function(){return new jspb.arith.UInt64(this.lo<<1>>>0,(this.hi<<1|this.lo>>>31)>>>0)},jspb.arith.UInt64.prototype.msb=function(){return!!(2147483648&this.hi)},jspb.arith.UInt64.prototype.lsb=function(){return!!(1&this.lo)},jspb.arith.UInt64.prototype.zero=function(){return this.lo==0&&this.hi==0},jspb.arith.UInt64.prototype.add=function(X){return new jspb.arith.UInt64((this.lo+X.lo&4294967295)>>>0>>>0,((this.hi+X.hi&4294967295)>>>0)+(4294967296<=this.lo+X.lo?1:0)>>>0)},jspb.arith.UInt64.prototype.sub=function(X){return new jspb.arith.UInt64((this.lo-X.lo&4294967295)>>>0>>>0,((this.hi-X.hi&4294967295)>>>0)-(0>this.lo-X.lo?1:0)>>>0)},jspb.arith.UInt64.mul32x32=function(X,Z){var _=65535&X,K=65535&Z,te=Z>>>16;for(Z=_*K+65536*(_*te&65535)+65536*((X>>>=16)*K&65535),_=X*te+(_*te>>>16)+(X*K>>>16);4294967296<=Z;)Z-=4294967296,_+=1;return new jspb.arith.UInt64(Z>>>0,_>>>0)},jspb.arith.UInt64.prototype.mul=function(X){var Z=jspb.arith.UInt64.mul32x32(this.lo,X);return(X=jspb.arith.UInt64.mul32x32(this.hi,X)).hi=X.lo,X.lo=0,Z.add(X)},jspb.arith.UInt64.prototype.div=function(X){if(X==0)return[];var Z=new jspb.arith.UInt64(0,0),_=new jspb.arith.UInt64(this.lo,this.hi);X=new jspb.arith.UInt64(X,0);for(var K=new jspb.arith.UInt64(1,0);!X.msb();)X=X.leftShift(),K=K.leftShift();for(;!K.zero();)0>=X.cmp(_)&&(Z=Z.add(K),_=_.sub(X)),X=X.rightShift(),K=K.rightShift();return[Z,_]},jspb.arith.UInt64.prototype.toString=function(){for(var X="",Z=this;!Z.zero();){var _=(Z=Z.div(10))[0];X=Z[1].lo+X,Z=_}return X==""&&(X="0"),X},jspb.arith.UInt64.fromString=function(X){for(var Z=new jspb.arith.UInt64(0,0),_=new jspb.arith.UInt64(0,0),K=0;K<X.length;K++){if("0">X[K]||"9"<X[K])return null;var te=parseInt(X[K],10);_.lo=te,Z=Z.mul(10).add(_)}return Z},jspb.arith.UInt64.prototype.clone=function(){return new jspb.arith.UInt64(this.lo,this.hi)},jspb.arith.Int64=function(X,Z){this.lo=X,this.hi=Z},jspb.arith.Int64.prototype.add=function(X){return new jspb.arith.Int64((this.lo+X.lo&4294967295)>>>0>>>0,((this.hi+X.hi&4294967295)>>>0)+(4294967296<=this.lo+X.lo?1:0)>>>0)},jspb.arith.Int64.prototype.sub=function(X){return new jspb.arith.Int64((this.lo-X.lo&4294967295)>>>0>>>0,((this.hi-X.hi&4294967295)>>>0)-(0>this.lo-X.lo?1:0)>>>0)},jspb.arith.Int64.prototype.clone=function(){return new jspb.arith.Int64(this.lo,this.hi)},jspb.arith.Int64.prototype.toString=function(){var X=!!(2147483648&this.hi),Z=new jspb.arith.UInt64(this.lo,this.hi);return X&&(Z=new jspb.arith.UInt64(0,0).sub(Z)),(X?"-":"")+Z.toString()},jspb.arith.Int64.fromString=function(X){var Z=0<X.length&&X[0]=="-";return Z&&(X=X.substring(1)),(X=jspb.arith.UInt64.fromString(X))===null?null:(Z&&(X=new jspb.arith.UInt64(0,0).sub(X)),new jspb.arith.Int64(X.lo,X.hi))},jspb.BinaryWriter=function(){this.blocks_=[],this.totalLength_=0,this.encoder_=new jspb.BinaryEncoder,this.bookmarks_=[]},jspb.BinaryWriter.prototype.appendUint8Array_=function(X){var Z=this.encoder_.end();this.blocks_.push(Z),this.blocks_.push(X),this.totalLength_+=Z.length+X.length},jspb.BinaryWriter.prototype.beginDelimited_=function(X){return this.writeFieldHeader_(X,jspb.BinaryConstants.WireType.DELIMITED),X=this.encoder_.end(),this.blocks_.push(X),this.totalLength_+=X.length,X.push(this.totalLength_),X},jspb.BinaryWriter.prototype.endDelimited_=function(X){var Z=X.pop();for(Z=this.totalLength_+this.encoder_.length()-Z,jspb.asserts.assert(0<=Z);127<Z;)X.push(127&Z|128),Z>>>=7,this.totalLength_++;X.push(Z),this.totalLength_++},jspb.BinaryWriter.prototype.writeSerializedMessage=function(X,Z,_){this.appendUint8Array_(X.subarray(Z,_))},jspb.BinaryWriter.prototype.maybeWriteSerializedMessage=function(X,Z,_){X!=null&&Z!=null&&_!=null&&this.writeSerializedMessage(X,Z,_)},jspb.BinaryWriter.prototype.reset=function(){this.blocks_=[],this.encoder_.end(),this.totalLength_=0,this.bookmarks_=[]},jspb.BinaryWriter.prototype.getResultBuffer=function(){jspb.asserts.assert(this.bookmarks_.length==0);for(var X=new Uint8Array(this.totalLength_+this.encoder_.length()),Z=this.blocks_,_=Z.length,K=0,te=0;te<_;te++){var ne=Z[te];X.set(ne,K),K+=ne.length}return Z=this.encoder_.end(),X.set(Z,K),K+=Z.length,jspb.asserts.assert(K==X.length),this.blocks_=[X],X},goog.exportProperty(jspb.BinaryWriter.prototype,"getResultBuffer",jspb.BinaryWriter.prototype.getResultBuffer),jspb.BinaryWriter.prototype.getResultBase64String=function(X){return goog.crypt.base64.encodeByteArray(this.getResultBuffer(),X)},jspb.BinaryWriter.prototype.beginSubMessage=function(X){this.bookmarks_.push(this.beginDelimited_(X))},jspb.BinaryWriter.prototype.endSubMessage=function(){jspb.asserts.assert(0<=this.bookmarks_.length),this.endDelimited_(this.bookmarks_.pop())},jspb.BinaryWriter.prototype.writeFieldHeader_=function(X,Z){jspb.asserts.assert(1<=X&&X==Math.floor(X)),this.encoder_.writeUnsignedVarint32(8*X+Z)},jspb.BinaryWriter.prototype.writeAny=function(X,Z,_){var K=jspb.BinaryConstants.FieldType;switch(X){case K.DOUBLE:this.writeDouble(Z,_);break;case K.FLOAT:this.writeFloat(Z,_);break;case K.INT64:this.writeInt64(Z,_);break;case K.UINT64:this.writeUint64(Z,_);break;case K.INT32:this.writeInt32(Z,_);break;case K.FIXED64:this.writeFixed64(Z,_);break;case K.FIXED32:this.writeFixed32(Z,_);break;case K.BOOL:this.writeBool(Z,_);break;case K.STRING:this.writeString(Z,_);break;case K.GROUP:jspb.asserts.fail("Group field type not supported in writeAny()");break;case K.MESSAGE:jspb.asserts.fail("Message field type not supported in writeAny()");break;case K.BYTES:this.writeBytes(Z,_);break;case K.UINT32:this.writeUint32(Z,_);break;case K.ENUM:this.writeEnum(Z,_);break;case K.SFIXED32:this.writeSfixed32(Z,_);break;case K.SFIXED64:this.writeSfixed64(Z,_);break;case K.SINT32:this.writeSint32(Z,_);break;case K.SINT64:this.writeSint64(Z,_);break;case K.FHASH64:this.writeFixedHash64(Z,_);break;case K.VHASH64:this.writeVarintHash64(Z,_);break;default:jspb.asserts.fail("Invalid field type in writeAny()")}},jspb.BinaryWriter.prototype.writeUnsignedVarint32_=function(X,Z){Z!=null&&(this.writeFieldHeader_(X,jspb.BinaryConstants.WireType.VARINT),this.encoder_.writeUnsignedVarint32(Z))},jspb.BinaryWriter.prototype.writeSignedVarint32_=function(X,Z){Z!=null&&(this.writeFieldHeader_(X,jspb.BinaryConstants.WireType.VARINT),this.encoder_.writeSignedVarint32(Z))},jspb.BinaryWriter.prototype.writeUnsignedVarint64_=function(X,Z){Z!=null&&(this.writeFieldHeader_(X,jspb.BinaryConstants.WireType.VARINT),this.encoder_.writeUnsignedVarint64(Z))},jspb.BinaryWriter.prototype.writeSignedVarint64_=function(X,Z){Z!=null&&(this.writeFieldHeader_(X,jspb.BinaryConstants.WireType.VARINT),this.encoder_.writeSignedVarint64(Z))},jspb.BinaryWriter.prototype.writeZigzagVarint32_=function(X,Z){Z!=null&&(this.writeFieldHeader_(X,jspb.BinaryConstants.WireType.VARINT),this.encoder_.writeZigzagVarint32(Z))},jspb.BinaryWriter.prototype.writeZigzagVarint64_=function(X,Z){Z!=null&&(this.writeFieldHeader_(X,jspb.BinaryConstants.WireType.VARINT),this.encoder_.writeZigzagVarint64(Z))},jspb.BinaryWriter.prototype.writeZigzagVarint64String_=function(X,Z){Z!=null&&(this.writeFieldHeader_(X,jspb.BinaryConstants.WireType.VARINT),this.encoder_.writeZigzagVarint64String(Z))},jspb.BinaryWriter.prototype.writeZigzagVarintHash64_=function(X,Z){Z!=null&&(this.writeFieldHeader_(X,jspb.BinaryConstants.WireType.VARINT),this.encoder_.writeZigzagVarintHash64(Z))},jspb.BinaryWriter.prototype.writeInt32=function(X,Z){Z!=null&&(jspb.asserts.assert(Z>=-jspb.BinaryConstants.TWO_TO_31&&Z<jspb.BinaryConstants.TWO_TO_31),this.writeSignedVarint32_(X,Z))},goog.exportProperty(jspb.BinaryWriter.prototype,"writeInt32",jspb.BinaryWriter.prototype.writeInt32),jspb.BinaryWriter.prototype.writeInt32String=function(X,Z){Z!=null&&(Z=parseInt(Z,10),jspb.asserts.assert(Z>=-jspb.BinaryConstants.TWO_TO_31&&Z<jspb.BinaryConstants.TWO_TO_31),this.writeSignedVarint32_(X,Z))},jspb.BinaryWriter.prototype.writeInt64=function(X,Z){Z!=null&&(jspb.asserts.assert(Z>=-jspb.BinaryConstants.TWO_TO_63&&Z<jspb.BinaryConstants.TWO_TO_63),this.writeSignedVarint64_(X,Z))},goog.exportProperty(jspb.BinaryWriter.prototype,"writeInt64",jspb.BinaryWriter.prototype.writeInt64),jspb.BinaryWriter.prototype.writeInt64String=function(X,Z){Z!=null&&(Z=jspb.arith.Int64.fromString(Z),this.writeFieldHeader_(X,jspb.BinaryConstants.WireType.VARINT),this.encoder_.writeSplitVarint64(Z.lo,Z.hi))},jspb.BinaryWriter.prototype.writeUint32=function(X,Z){Z!=null&&(jspb.asserts.assert(0<=Z&&Z<jspb.BinaryConstants.TWO_TO_32),this.writeUnsignedVarint32_(X,Z))},goog.exportProperty(jspb.BinaryWriter.prototype,"writeUint32",jspb.BinaryWriter.prototype.writeUint32),jspb.BinaryWriter.prototype.writeUint32String=function(X,Z){Z!=null&&(Z=parseInt(Z,10),jspb.asserts.assert(0<=Z&&Z<jspb.BinaryConstants.TWO_TO_32),this.writeUnsignedVarint32_(X,Z))},jspb.BinaryWriter.prototype.writeUint64=function(X,Z){Z!=null&&(jspb.asserts.assert(0<=Z&&Z<jspb.BinaryConstants.TWO_TO_64),this.writeUnsignedVarint64_(X,Z))},goog.exportProperty(jspb.BinaryWriter.prototype,"writeUint64",jspb.BinaryWriter.prototype.writeUint64),jspb.BinaryWriter.prototype.writeUint64String=function(X,Z){Z!=null&&(Z=jspb.arith.UInt64.fromString(Z),this.writeFieldHeader_(X,jspb.BinaryConstants.WireType.VARINT),this.encoder_.writeSplitVarint64(Z.lo,Z.hi))},jspb.BinaryWriter.prototype.writeSint32=function(X,Z){Z!=null&&(jspb.asserts.assert(Z>=-jspb.BinaryConstants.TWO_TO_31&&Z<jspb.BinaryConstants.TWO_TO_31),this.writeZigzagVarint32_(X,Z))},goog.exportProperty(jspb.BinaryWriter.prototype,"writeSint32",jspb.BinaryWriter.prototype.writeSint32),jspb.BinaryWriter.prototype.writeSint64=function(X,Z){Z!=null&&(jspb.asserts.assert(Z>=-jspb.BinaryConstants.TWO_TO_63&&Z<jspb.BinaryConstants.TWO_TO_63),this.writeZigzagVarint64_(X,Z))},goog.exportProperty(jspb.BinaryWriter.prototype,"writeSint64",jspb.BinaryWriter.prototype.writeSint64),jspb.BinaryWriter.prototype.writeSintHash64=function(X,Z){Z!=null&&this.writeZigzagVarintHash64_(X,Z)},jspb.BinaryWriter.prototype.writeSint64String=function(X,Z){Z!=null&&this.writeZigzagVarint64String_(X,Z)},jspb.BinaryWriter.prototype.writeFixed32=function(X,Z){Z!=null&&(jspb.asserts.assert(0<=Z&&Z<jspb.BinaryConstants.TWO_TO_32),this.writeFieldHeader_(X,jspb.BinaryConstants.WireType.FIXED32),this.encoder_.writeUint32(Z))},goog.exportProperty(jspb.BinaryWriter.prototype,"writeFixed32",jspb.BinaryWriter.prototype.writeFixed32),jspb.BinaryWriter.prototype.writeFixed64=function(X,Z){Z!=null&&(jspb.asserts.assert(0<=Z&&Z<jspb.BinaryConstants.TWO_TO_64),this.writeFieldHeader_(X,jspb.BinaryConstants.WireType.FIXED64),this.encoder_.writeUint64(Z))},goog.exportProperty(jspb.BinaryWriter.prototype,"writeFixed64",jspb.BinaryWriter.prototype.writeFixed64),jspb.BinaryWriter.prototype.writeFixed64String=function(X,Z){Z!=null&&(Z=jspb.arith.UInt64.fromString(Z),this.writeFieldHeader_(X,jspb.BinaryConstants.WireType.FIXED64),this.encoder_.writeSplitFixed64(Z.lo,Z.hi))},jspb.BinaryWriter.prototype.writeSfixed32=function(X,Z){Z!=null&&(jspb.asserts.assert(Z>=-jspb.BinaryConstants.TWO_TO_31&&Z<jspb.BinaryConstants.TWO_TO_31),this.writeFieldHeader_(X,jspb.BinaryConstants.WireType.FIXED32),this.encoder_.writeInt32(Z))},goog.exportProperty(jspb.BinaryWriter.prototype,"writeSfixed32",jspb.BinaryWriter.prototype.writeSfixed32),jspb.BinaryWriter.prototype.writeSfixed64=function(X,Z){Z!=null&&(jspb.asserts.assert(Z>=-jspb.BinaryConstants.TWO_TO_63&&Z<jspb.BinaryConstants.TWO_TO_63),this.writeFieldHeader_(X,jspb.BinaryConstants.WireType.FIXED64),this.encoder_.writeInt64(Z))},goog.exportProperty(jspb.BinaryWriter.prototype,"writeSfixed64",jspb.BinaryWriter.prototype.writeSfixed64),jspb.BinaryWriter.prototype.writeSfixed64String=function(X,Z){Z!=null&&(Z=jspb.arith.Int64.fromString(Z),this.writeFieldHeader_(X,jspb.BinaryConstants.WireType.FIXED64),this.encoder_.writeSplitFixed64(Z.lo,Z.hi))},jspb.BinaryWriter.prototype.writeFloat=function(X,Z){Z!=null&&(this.writeFieldHeader_(X,jspb.BinaryConstants.WireType.FIXED32),this.encoder_.writeFloat(Z))},goog.exportProperty(jspb.BinaryWriter.prototype,"writeFloat",jspb.BinaryWriter.prototype.writeFloat),jspb.BinaryWriter.prototype.writeDouble=function(X,Z){Z!=null&&(this.writeFieldHeader_(X,jspb.BinaryConstants.WireType.FIXED64),this.encoder_.writeDouble(Z))},goog.exportProperty(jspb.BinaryWriter.prototype,"writeDouble",jspb.BinaryWriter.prototype.writeDouble),jspb.BinaryWriter.prototype.writeBool=function(X,Z){Z!=null&&(jspb.asserts.assert(typeof Z=="boolean"||typeof Z=="number"),this.writeFieldHeader_(X,jspb.BinaryConstants.WireType.VARINT),this.encoder_.writeBool(Z))},goog.exportProperty(jspb.BinaryWriter.prototype,"writeBool",jspb.BinaryWriter.prototype.writeBool),jspb.BinaryWriter.prototype.writeEnum=function(X,Z){Z!=null&&(jspb.asserts.assert(Z>=-jspb.BinaryConstants.TWO_TO_31&&Z<jspb.BinaryConstants.TWO_TO_31),this.writeFieldHeader_(X,jspb.BinaryConstants.WireType.VARINT),this.encoder_.writeSignedVarint32(Z))},goog.exportProperty(jspb.BinaryWriter.prototype,"writeEnum",jspb.BinaryWriter.prototype.writeEnum),jspb.BinaryWriter.prototype.writeString=function(X,Z){Z!=null&&(X=this.beginDelimited_(X),this.encoder_.writeString(Z),this.endDelimited_(X))},goog.exportProperty(jspb.BinaryWriter.prototype,"writeString",jspb.BinaryWriter.prototype.writeString),jspb.BinaryWriter.prototype.writeBytes=function(X,Z){Z!=null&&(Z=jspb.utils.byteSourceToUint8Array(Z),this.writeFieldHeader_(X,jspb.BinaryConstants.WireType.DELIMITED),this.encoder_.writeUnsignedVarint32(Z.length),this.appendUint8Array_(Z))},goog.exportProperty(jspb.BinaryWriter.prototype,"writeBytes",jspb.BinaryWriter.prototype.writeBytes),jspb.BinaryWriter.prototype.writeMessage=function(X,Z,_){Z!=null&&(X=this.beginDelimited_(X),_(Z,this),this.endDelimited_(X))},goog.exportProperty(jspb.BinaryWriter.prototype,"writeMessage",jspb.BinaryWriter.prototype.writeMessage),jspb.BinaryWriter.prototype.writeMessageSet=function(X,Z,_){Z!=null&&(this.writeFieldHeader_(1,jspb.BinaryConstants.WireType.START_GROUP),this.writeFieldHeader_(2,jspb.BinaryConstants.WireType.VARINT),this.encoder_.writeSignedVarint32(X),X=this.beginDelimited_(3),_(Z,this),this.endDelimited_(X),this.writeFieldHeader_(1,jspb.BinaryConstants.WireType.END_GROUP))},jspb.BinaryWriter.prototype.writeGroup=function(X,Z,_){Z!=null&&(this.writeFieldHeader_(X,jspb.BinaryConstants.WireType.START_GROUP),_(Z,this),this.writeFieldHeader_(X,jspb.BinaryConstants.WireType.END_GROUP))},goog.exportProperty(jspb.BinaryWriter.prototype,"writeGroup",jspb.BinaryWriter.prototype.writeGroup),jspb.BinaryWriter.prototype.writeFixedHash64=function(X,Z){Z!=null&&(jspb.asserts.assert(Z.length==8),this.writeFieldHeader_(X,jspb.BinaryConstants.WireType.FIXED64),this.encoder_.writeFixedHash64(Z))},jspb.BinaryWriter.prototype.writeVarintHash64=function(X,Z){Z!=null&&(jspb.asserts.assert(Z.length==8),this.writeFieldHeader_(X,jspb.BinaryConstants.WireType.VARINT),this.encoder_.writeVarintHash64(Z))},jspb.BinaryWriter.prototype.writeSplitFixed64=function(X,Z,_){this.writeFieldHeader_(X,jspb.BinaryConstants.WireType.FIXED64),this.encoder_.writeSplitFixed64(Z,_)},jspb.BinaryWriter.prototype.writeSplitVarint64=function(X,Z,_){this.writeFieldHeader_(X,jspb.BinaryConstants.WireType.VARINT),this.encoder_.writeSplitVarint64(Z,_)},jspb.BinaryWriter.prototype.writeSplitZigzagVarint64=function(X,Z,_){this.writeFieldHeader_(X,jspb.BinaryConstants.WireType.VARINT);var K=this.encoder_;jspb.utils.toZigzag64(Z,_,function(te,ne){K.writeSplitVarint64(te>>>0,ne>>>0)})},jspb.BinaryWriter.prototype.writeRepeatedInt32=function(X,Z){if(Z!=null)for(var _=0;_<Z.length;_++)this.writeSignedVarint32_(X,Z[_])},goog.exportProperty(jspb.BinaryWriter.prototype,"writeRepeatedInt32",jspb.BinaryWriter.prototype.writeRepeatedInt32),jspb.BinaryWriter.prototype.writeRepeatedInt32String=function(X,Z){if(Z!=null)for(var _=0;_<Z.length;_++)this.writeInt32String(X,Z[_])},jspb.BinaryWriter.prototype.writeRepeatedInt64=function(X,Z){if(Z!=null)for(var _=0;_<Z.length;_++)this.writeSignedVarint64_(X,Z[_])},goog.exportProperty(jspb.BinaryWriter.prototype,"writeRepeatedInt64",jspb.BinaryWriter.prototype.writeRepeatedInt64),jspb.BinaryWriter.prototype.writeRepeatedSplitFixed64=function(X,Z,_,K){if(Z!=null)for(var te=0;te<Z.length;te++)this.writeSplitFixed64(X,_(Z[te]),K(Z[te]))},jspb.BinaryWriter.prototype.writeRepeatedSplitVarint64=function(X,Z,_,K){if(Z!=null)for(var te=0;te<Z.length;te++)this.writeSplitVarint64(X,_(Z[te]),K(Z[te]))},jspb.BinaryWriter.prototype.writeRepeatedSplitZigzagVarint64=function(X,Z,_,K){if(Z!=null)for(var te=0;te<Z.length;te++)this.writeSplitZigzagVarint64(X,_(Z[te]),K(Z[te]))},jspb.BinaryWriter.prototype.writeRepeatedInt64String=function(X,Z){if(Z!=null)for(var _=0;_<Z.length;_++)this.writeInt64String(X,Z[_])},jspb.BinaryWriter.prototype.writeRepeatedUint32=function(X,Z){if(Z!=null)for(var _=0;_<Z.length;_++)this.writeUnsignedVarint32_(X,Z[_])},goog.exportProperty(jspb.BinaryWriter.prototype,"writeRepeatedUint32",jspb.BinaryWriter.prototype.writeRepeatedUint32),jspb.BinaryWriter.prototype.writeRepeatedUint32String=function(X,Z){if(Z!=null)for(var _=0;_<Z.length;_++)this.writeUint32String(X,Z[_])},jspb.BinaryWriter.prototype.writeRepeatedUint64=function(X,Z){if(Z!=null)for(var _=0;_<Z.length;_++)this.writeUnsignedVarint64_(X,Z[_])},goog.exportProperty(jspb.BinaryWriter.prototype,"writeRepeatedUint64",jspb.BinaryWriter.prototype.writeRepeatedUint64),jspb.BinaryWriter.prototype.writeRepeatedUint64String=function(X,Z){if(Z!=null)for(var _=0;_<Z.length;_++)this.writeUint64String(X,Z[_])},jspb.BinaryWriter.prototype.writeRepeatedSint32=function(X,Z){if(Z!=null)for(var _=0;_<Z.length;_++)this.writeZigzagVarint32_(X,Z[_])},goog.exportProperty(jspb.BinaryWriter.prototype,"writeRepeatedSint32",jspb.BinaryWriter.prototype.writeRepeatedSint32),jspb.BinaryWriter.prototype.writeRepeatedSint64=function(X,Z){if(Z!=null)for(var _=0;_<Z.length;_++)this.writeZigzagVarint64_(X,Z[_])},goog.exportProperty(jspb.BinaryWriter.prototype,"writeRepeatedSint64",jspb.BinaryWriter.prototype.writeRepeatedSint64),jspb.BinaryWriter.prototype.writeRepeatedSint64String=function(X,Z){if(Z!=null)for(var _=0;_<Z.length;_++)this.writeZigzagVarint64String_(X,Z[_])},jspb.BinaryWriter.prototype.writeRepeatedSintHash64=function(X,Z){if(Z!=null)for(var _=0;_<Z.length;_++)this.writeZigzagVarintHash64_(X,Z[_])},jspb.BinaryWriter.prototype.writeRepeatedFixed32=function(X,Z){if(Z!=null)for(var _=0;_<Z.length;_++)this.writeFixed32(X,Z[_])},goog.exportProperty(jspb.BinaryWriter.prototype,"writeRepeatedFixed32",jspb.BinaryWriter.prototype.writeRepeatedFixed32),jspb.BinaryWriter.prototype.writeRepeatedFixed64=function(X,Z){if(Z!=null)for(var _=0;_<Z.length;_++)this.writeFixed64(X,Z[_])},goog.exportProperty(jspb.BinaryWriter.prototype,"writeRepeatedFixed64",jspb.BinaryWriter.prototype.writeRepeatedFixed64),jspb.BinaryWriter.prototype.writeRepeatedFixed64String=function(X,Z){if(Z!=null)for(var _=0;_<Z.length;_++)this.writeFixed64String(X,Z[_])},goog.exportProperty(jspb.BinaryWriter.prototype,"writeRepeatedFixed64String",jspb.BinaryWriter.prototype.writeRepeatedFixed64String),jspb.BinaryWriter.prototype.writeRepeatedSfixed32=function(X,Z){if(Z!=null)for(var _=0;_<Z.length;_++)this.writeSfixed32(X,Z[_])},goog.exportProperty(jspb.BinaryWriter.prototype,"writeRepeatedSfixed32",jspb.BinaryWriter.prototype.writeRepeatedSfixed32),jspb.BinaryWriter.prototype.writeRepeatedSfixed64=function(X,Z){if(Z!=null)for(var _=0;_<Z.length;_++)this.writeSfixed64(X,Z[_])},goog.exportProperty(jspb.BinaryWriter.prototype,"writeRepeatedSfixed64",jspb.BinaryWriter.prototype.writeRepeatedSfixed64),jspb.BinaryWriter.prototype.writeRepeatedSfixed64String=function(X,Z){if(Z!=null)for(var _=0;_<Z.length;_++)this.writeSfixed64String(X,Z[_])},jspb.BinaryWriter.prototype.writeRepeatedFloat=function(X,Z){if(Z!=null)for(var _=0;_<Z.length;_++)this.writeFloat(X,Z[_])},goog.exportProperty(jspb.BinaryWriter.prototype,"writeRepeatedFloat",jspb.BinaryWriter.prototype.writeRepeatedFloat),jspb.BinaryWriter.prototype.writeRepeatedDouble=function(X,Z){if(Z!=null)for(var _=0;_<Z.length;_++)this.writeDouble(X,Z[_])},goog.exportProperty(jspb.BinaryWriter.prototype,"writeRepeatedDouble",jspb.BinaryWriter.prototype.writeRepeatedDouble),jspb.BinaryWriter.prototype.writeRepeatedBool=function(X,Z){if(Z!=null)for(var _=0;_<Z.length;_++)this.writeBool(X,Z[_])},goog.exportProperty(jspb.BinaryWriter.prototype,"writeRepeatedBool",jspb.BinaryWriter.prototype.writeRepeatedBool),jspb.BinaryWriter.prototype.writeRepeatedEnum=function(X,Z){if(Z!=null)for(var _=0;_<Z.length;_++)this.writeEnum(X,Z[_])},goog.exportProperty(jspb.BinaryWriter.prototype,"writeRepeatedEnum",jspb.BinaryWriter.prototype.writeRepeatedEnum),jspb.BinaryWriter.prototype.writeRepeatedString=function(X,Z){if(Z!=null)for(var _=0;_<Z.length;_++)this.writeString(X,Z[_])},goog.exportProperty(jspb.BinaryWriter.prototype,"writeRepeatedString",jspb.BinaryWriter.prototype.writeRepeatedString),jspb.BinaryWriter.prototype.writeRepeatedBytes=function(X,Z){if(Z!=null)for(var _=0;_<Z.length;_++)this.writeBytes(X,Z[_])},goog.exportProperty(jspb.BinaryWriter.prototype,"writeRepeatedBytes",jspb.BinaryWriter.prototype.writeRepeatedBytes),jspb.BinaryWriter.prototype.writeRepeatedMessage=function(X,Z,_){if(Z!=null)for(var K=0;K<Z.length;K++){var te=this.beginDelimited_(X);_(Z[K],this),this.endDelimited_(te)}},goog.exportProperty(jspb.BinaryWriter.prototype,"writeRepeatedMessage",jspb.BinaryWriter.prototype.writeRepeatedMessage),jspb.BinaryWriter.prototype.writeRepeatedGroup=function(X,Z,_){if(Z!=null)for(var K=0;K<Z.length;K++)this.writeFieldHeader_(X,jspb.BinaryConstants.WireType.START_GROUP),_(Z[K],this),this.writeFieldHeader_(X,jspb.BinaryConstants.WireType.END_GROUP)},goog.exportProperty(jspb.BinaryWriter.prototype,"writeRepeatedGroup",jspb.BinaryWriter.prototype.writeRepeatedGroup),jspb.BinaryWriter.prototype.writeRepeatedFixedHash64=function(X,Z){if(Z!=null)for(var _=0;_<Z.length;_++)this.writeFixedHash64(X,Z[_])},jspb.BinaryWriter.prototype.writeRepeatedVarintHash64=function(X,Z){if(Z!=null)for(var _=0;_<Z.length;_++)this.writeVarintHash64(X,Z[_])},jspb.BinaryWriter.prototype.writePackedInt32=function(X,Z){if(Z!=null&&Z.length){X=this.beginDelimited_(X);for(var _=0;_<Z.length;_++)this.encoder_.writeSignedVarint32(Z[_]);this.endDelimited_(X)}},goog.exportProperty(jspb.BinaryWriter.prototype,"writePackedInt32",jspb.BinaryWriter.prototype.writePackedInt32),jspb.BinaryWriter.prototype.writePackedInt32String=function(X,Z){if(Z!=null&&Z.length){X=this.beginDelimited_(X);for(var _=0;_<Z.length;_++)this.encoder_.writeSignedVarint32(parseInt(Z[_],10));this.endDelimited_(X)}},jspb.BinaryWriter.prototype.writePackedInt64=function(X,Z){if(Z!=null&&Z.length){X=this.beginDelimited_(X);for(var _=0;_<Z.length;_++)this.encoder_.writeSignedVarint64(Z[_]);this.endDelimited_(X)}},goog.exportProperty(jspb.BinaryWriter.prototype,"writePackedInt64",jspb.BinaryWriter.prototype.writePackedInt64),jspb.BinaryWriter.prototype.writePackedSplitFixed64=function(X,Z,_,K){if(Z!=null){X=this.beginDelimited_(X);for(var te=0;te<Z.length;te++)this.encoder_.writeSplitFixed64(_(Z[te]),K(Z[te]));this.endDelimited_(X)}},jspb.BinaryWriter.prototype.writePackedSplitVarint64=function(X,Z,_,K){if(Z!=null){X=this.beginDelimited_(X);for(var te=0;te<Z.length;te++)this.encoder_.writeSplitVarint64(_(Z[te]),K(Z[te]));this.endDelimited_(X)}},jspb.BinaryWriter.prototype.writePackedSplitZigzagVarint64=function(X,Z,_,K){if(Z!=null){X=this.beginDelimited_(X);for(var te=this.encoder_,ne=0;ne<Z.length;ne++)jspb.utils.toZigzag64(_(Z[ne]),K(Z[ne]),function(ie,oe){te.writeSplitVarint64(ie>>>0,oe>>>0)});this.endDelimited_(X)}},jspb.BinaryWriter.prototype.writePackedInt64String=function(X,Z){if(Z!=null&&Z.length){X=this.beginDelimited_(X);for(var _=0;_<Z.length;_++){var K=jspb.arith.Int64.fromString(Z[_]);this.encoder_.writeSplitVarint64(K.lo,K.hi)}this.endDelimited_(X)}},jspb.BinaryWriter.prototype.writePackedUint32=function(X,Z){if(Z!=null&&Z.length){X=this.beginDelimited_(X);for(var _=0;_<Z.length;_++)this.encoder_.writeUnsignedVarint32(Z[_]);this.endDelimited_(X)}},goog.exportProperty(jspb.BinaryWriter.prototype,"writePackedUint32",jspb.BinaryWriter.prototype.writePackedUint32),jspb.BinaryWriter.prototype.writePackedUint32String=function(X,Z){if(Z!=null&&Z.length){X=this.beginDelimited_(X);for(var _=0;_<Z.length;_++)this.encoder_.writeUnsignedVarint32(parseInt(Z[_],10));this.endDelimited_(X)}},jspb.BinaryWriter.prototype.writePackedUint64=function(X,Z){if(Z!=null&&Z.length){X=this.beginDelimited_(X);for(var _=0;_<Z.length;_++)this.encoder_.writeUnsignedVarint64(Z[_]);this.endDelimited_(X)}},goog.exportProperty(jspb.BinaryWriter.prototype,"writePackedUint64",jspb.BinaryWriter.prototype.writePackedUint64),jspb.BinaryWriter.prototype.writePackedUint64String=function(X,Z){if(Z!=null&&Z.length){X=this.beginDelimited_(X);for(var _=0;_<Z.length;_++){var K=jspb.arith.UInt64.fromString(Z[_]);this.encoder_.writeSplitVarint64(K.lo,K.hi)}this.endDelimited_(X)}},jspb.BinaryWriter.prototype.writePackedSint32=function(X,Z){if(Z!=null&&Z.length){X=this.beginDelimited_(X);for(var _=0;_<Z.length;_++)this.encoder_.writeZigzagVarint32(Z[_]);this.endDelimited_(X)}},goog.exportProperty(jspb.BinaryWriter.prototype,"writePackedSint32",jspb.BinaryWriter.prototype.writePackedSint32),jspb.BinaryWriter.prototype.writePackedSint64=function(X,Z){if(Z!=null&&Z.length){X=this.beginDelimited_(X);for(var _=0;_<Z.length;_++)this.encoder_.writeZigzagVarint64(Z[_]);this.endDelimited_(X)}},goog.exportProperty(jspb.BinaryWriter.prototype,"writePackedSint64",jspb.BinaryWriter.prototype.writePackedSint64),jspb.BinaryWriter.prototype.writePackedSint64String=function(X,Z){if(Z!=null&&Z.length){X=this.beginDelimited_(X);for(var _=0;_<Z.length;_++)this.encoder_.writeZigzagVarintHash64(jspb.utils.decimalStringToHash64(Z[_]));this.endDelimited_(X)}},jspb.BinaryWriter.prototype.writePackedSintHash64=function(X,Z){if(Z!=null&&Z.length){X=this.beginDelimited_(X);for(var _=0;_<Z.length;_++)this.encoder_.writeZigzagVarintHash64(Z[_]);this.endDelimited_(X)}},jspb.BinaryWriter.prototype.writePackedFixed32=function(X,Z){if(Z!=null&&Z.length)for(this.writeFieldHeader_(X,jspb.BinaryConstants.WireType.DELIMITED),this.encoder_.writeUnsignedVarint32(4*Z.length),X=0;X<Z.length;X++)this.encoder_.writeUint32(Z[X])},goog.exportProperty(jspb.BinaryWriter.prototype,"writePackedFixed32",jspb.BinaryWriter.prototype.writePackedFixed32),jspb.BinaryWriter.prototype.writePackedFixed64=function(X,Z){if(Z!=null&&Z.length)for(this.writeFieldHeader_(X,jspb.BinaryConstants.WireType.DELIMITED),this.encoder_.writeUnsignedVarint32(8*Z.length),X=0;X<Z.length;X++)this.encoder_.writeUint64(Z[X])},goog.exportProperty(jspb.BinaryWriter.prototype,"writePackedFixed64",jspb.BinaryWriter.prototype.writePackedFixed64),jspb.BinaryWriter.prototype.writePackedFixed64String=function(X,Z){if(Z!=null&&Z.length)for(this.writeFieldHeader_(X,jspb.BinaryConstants.WireType.DELIMITED),this.encoder_.writeUnsignedVarint32(8*Z.length),X=0;X<Z.length;X++){var _=jspb.arith.UInt64.fromString(Z[X]);this.encoder_.writeSplitFixed64(_.lo,_.hi)}},jspb.BinaryWriter.prototype.writePackedSfixed32=function(X,Z){if(Z!=null&&Z.length)for(this.writeFieldHeader_(X,jspb.BinaryConstants.WireType.DELIMITED),this.encoder_.writeUnsignedVarint32(4*Z.length),X=0;X<Z.length;X++)this.encoder_.writeInt32(Z[X])},goog.exportProperty(jspb.BinaryWriter.prototype,"writePackedSfixed32",jspb.BinaryWriter.prototype.writePackedSfixed32),jspb.BinaryWriter.prototype.writePackedSfixed64=function(X,Z){if(Z!=null&&Z.length)for(this.writeFieldHeader_(X,jspb.BinaryConstants.WireType.DELIMITED),this.encoder_.writeUnsignedVarint32(8*Z.length),X=0;X<Z.length;X++)this.encoder_.writeInt64(Z[X])},goog.exportProperty(jspb.BinaryWriter.prototype,"writePackedSfixed64",jspb.BinaryWriter.prototype.writePackedSfixed64),jspb.BinaryWriter.prototype.writePackedSfixed64String=function(X,Z){if(Z!=null&&Z.length)for(this.writeFieldHeader_(X,jspb.BinaryConstants.WireType.DELIMITED),this.encoder_.writeUnsignedVarint32(8*Z.length),X=0;X<Z.length;X++)this.encoder_.writeInt64String(Z[X])},jspb.BinaryWriter.prototype.writePackedFloat=function(X,Z){if(Z!=null&&Z.length)for(this.writeFieldHeader_(X,jspb.BinaryConstants.WireType.DELIMITED),this.encoder_.writeUnsignedVarint32(4*Z.length),X=0;X<Z.length;X++)this.encoder_.writeFloat(Z[X])},goog.exportProperty(jspb.BinaryWriter.prototype,"writePackedFloat",jspb.BinaryWriter.prototype.writePackedFloat),jspb.BinaryWriter.prototype.writePackedDouble=function(X,Z){if(Z!=null&&Z.length)for(this.writeFieldHeader_(X,jspb.BinaryConstants.WireType.DELIMITED),this.encoder_.writeUnsignedVarint32(8*Z.length),X=0;X<Z.length;X++)this.encoder_.writeDouble(Z[X])},goog.exportProperty(jspb.BinaryWriter.prototype,"writePackedDouble",jspb.BinaryWriter.prototype.writePackedDouble),jspb.BinaryWriter.prototype.writePackedBool=function(X,Z){if(Z!=null&&Z.length)for(this.writeFieldHeader_(X,jspb.BinaryConstants.WireType.DELIMITED),this.encoder_.writeUnsignedVarint32(Z.length),X=0;X<Z.length;X++)this.encoder_.writeBool(Z[X])},goog.exportProperty(jspb.BinaryWriter.prototype,"writePackedBool",jspb.BinaryWriter.prototype.writePackedBool),jspb.BinaryWriter.prototype.writePackedEnum=function(X,Z){if(Z!=null&&Z.length){X=this.beginDelimited_(X);for(var _=0;_<Z.length;_++)this.encoder_.writeEnum(Z[_]);this.endDelimited_(X)}},goog.exportProperty(jspb.BinaryWriter.prototype,"writePackedEnum",jspb.BinaryWriter.prototype.writePackedEnum),jspb.BinaryWriter.prototype.writePackedFixedHash64=function(X,Z){if(Z!=null&&Z.length)for(this.writeFieldHeader_(X,jspb.BinaryConstants.WireType.DELIMITED),this.encoder_.writeUnsignedVarint32(8*Z.length),X=0;X<Z.length;X++)this.encoder_.writeFixedHash64(Z[X])},jspb.BinaryWriter.prototype.writePackedVarintHash64=function(X,Z){if(Z!=null&&Z.length){X=this.beginDelimited_(X);for(var _=0;_<Z.length;_++)this.encoder_.writeVarintHash64(Z[_]);this.endDelimited_(X)}},jspb.Map=function(X,Z){this.arr_=X,this.valueCtor_=Z,this.map_={},this.arrClean=!0,0<this.arr_.length&&this.loadFromArray_()},goog.exportSymbol("jspb.Map",jspb.Map),jspb.Map.prototype.loadFromArray_=function(){for(var X=0;X<this.arr_.length;X++){var Z=this.arr_[X],_=Z[0];this.map_[_.toString()]=new jspb.Map.Entry_(_,Z[1])}this.arrClean=!0},jspb.Map.prototype.toArray=function(){if(this.arrClean){if(this.valueCtor_){var X,Z=this.map_;for(X in Z)if(Object.prototype.hasOwnProperty.call(Z,X)){var _=Z[X].valueWrapper;_&&_.toArray()}}}else{for(this.arr_.length=0,(Z=this.stringKeys_()).sort(),X=0;X<Z.length;X++){var K=this.map_[Z[X]];(_=K.valueWrapper)&&_.toArray(),this.arr_.push([K.key,K.value])}this.arrClean=!0}return this.arr_},goog.exportProperty(jspb.Map.prototype,"toArray",jspb.Map.prototype.toArray),jspb.Map.prototype.toObject=function(X,Z){for(var _=this.toArray(),K=[],te=0;te<_.length;te++){var ne=this.map_[_[te][0].toString()];this.wrapEntry_(ne);var ie=ne.valueWrapper;ie?(jspb.asserts.assert(Z),K.push([ne.key,Z(X,ie)])):K.push([ne.key,ne.value])}return K},goog.exportProperty(jspb.Map.prototype,"toObject",jspb.Map.prototype.toObject),jspb.Map.fromObject=function(X,Z,_){Z=new jspb.Map([],Z);for(var K=0;K<X.length;K++){var te=X[K][0],ne=_(X[K][1]);Z.set(te,ne)}return Z},goog.exportProperty(jspb.Map,"fromObject",jspb.Map.fromObject),jspb.Map.ArrayIteratorIterable_=function(X){this.idx_=0,this.arr_=X},jspb.Map.ArrayIteratorIterable_.prototype.next=function(){return this.idx_<this.arr_.length?{done:!1,value:this.arr_[this.idx_++]}:{done:!0,value:void 0}},typeof Symbol<"u"&&(jspb.Map.ArrayIteratorIterable_.prototype[Symbol.iterator]=function(){return this}),jspb.Map.prototype.getLength=function(){return this.stringKeys_().length},goog.exportProperty(jspb.Map.prototype,"getLength",jspb.Map.prototype.getLength),jspb.Map.prototype.clear=function(){this.map_={},this.arrClean=!1},goog.exportProperty(jspb.Map.prototype,"clear",jspb.Map.prototype.clear),jspb.Map.prototype.del=function(X){X=X.toString();var Z=this.map_.hasOwnProperty(X);return delete this.map_[X],this.arrClean=!1,Z},goog.exportProperty(jspb.Map.prototype,"del",jspb.Map.prototype.del),jspb.Map.prototype.getEntryList=function(){var X=[],Z=this.stringKeys_();Z.sort();for(var _=0;_<Z.length;_++){var K=this.map_[Z[_]];X.push([K.key,K.value])}return X},goog.exportProperty(jspb.Map.prototype,"getEntryList",jspb.Map.prototype.getEntryList),jspb.Map.prototype.entries=function(){var X=[],Z=this.stringKeys_();Z.sort();for(var _=0;_<Z.length;_++){var K=this.map_[Z[_]];X.push([K.key,this.wrapEntry_(K)])}return new jspb.Map.ArrayIteratorIterable_(X)},goog.exportProperty(jspb.Map.prototype,"entries",jspb.Map.prototype.entries),jspb.Map.prototype.keys=function(){var X=[],Z=this.stringKeys_();Z.sort();for(var _=0;_<Z.length;_++)X.push(this.map_[Z[_]].key);return new jspb.Map.ArrayIteratorIterable_(X)},goog.exportProperty(jspb.Map.prototype,"keys",jspb.Map.prototype.keys),jspb.Map.prototype.values=function(){var X=[],Z=this.stringKeys_();Z.sort();for(var _=0;_<Z.length;_++)X.push(this.wrapEntry_(this.map_[Z[_]]));return new jspb.Map.ArrayIteratorIterable_(X)},goog.exportProperty(jspb.Map.prototype,"values",jspb.Map.prototype.values),jspb.Map.prototype.forEach=function(X,Z){var _=this.stringKeys_();_.sort();for(var K=0;K<_.length;K++){var te=this.map_[_[K]];X.call(Z,this.wrapEntry_(te),te.key,this)}},goog.exportProperty(jspb.Map.prototype,"forEach",jspb.Map.prototype.forEach),jspb.Map.prototype.set=function(X,Z){var _=new jspb.Map.Entry_(X);return this.valueCtor_?(_.valueWrapper=Z,_.value=Z.toArray()):_.value=Z,this.map_[X.toString()]=_,this.arrClean=!1,this},goog.exportProperty(jspb.Map.prototype,"set",jspb.Map.prototype.set),jspb.Map.prototype.wrapEntry_=function(X){return this.valueCtor_?(X.valueWrapper||(X.valueWrapper=new this.valueCtor_(X.value)),X.valueWrapper):X.value},jspb.Map.prototype.get=function(X){if(X=this.map_[X.toString()])return this.wrapEntry_(X)},goog.exportProperty(jspb.Map.prototype,"get",jspb.Map.prototype.get),jspb.Map.prototype.has=function(X){return X.toString()in this.map_},goog.exportProperty(jspb.Map.prototype,"has",jspb.Map.prototype.has),jspb.Map.prototype.serializeBinary=function(X,Z,_,K,te){var ne=this.stringKeys_();ne.sort();for(var ie=0;ie<ne.length;ie++){var oe=this.map_[ne[ie]];Z.beginSubMessage(X),_.call(Z,1,oe.key),this.valueCtor_?K.call(Z,2,this.wrapEntry_(oe),te):K.call(Z,2,oe.value),Z.endSubMessage()}},goog.exportProperty(jspb.Map.prototype,"serializeBinary",jspb.Map.prototype.serializeBinary),jspb.Map.deserializeBinary=function(X,Z,_,K,te,ne,ie){for(;Z.nextField()&&!Z.isEndGroup();){var oe=Z.getFieldNumber();oe==1?ne=_.call(Z):oe==2&&(X.valueCtor_?(jspb.asserts.assert(te),ie||(ie=new X.valueCtor_),K.call(Z,ie,te)):ie=K.call(Z))}jspb.asserts.assert(ne!=null),jspb.asserts.assert(ie!=null),X.set(ne,ie)},goog.exportProperty(jspb.Map,"deserializeBinary",jspb.Map.deserializeBinary),jspb.Map.prototype.stringKeys_=function(){var X,Z=this.map_,_=[];for(X in Z)Object.prototype.hasOwnProperty.call(Z,X)&&_.push(X);return _},jspb.Map.Entry_=function(X,Z){this.key=X,this.value=Z,this.valueWrapper=void 0},jspb.ExtensionFieldInfo=function(X,Z,_,K,te){this.fieldIndex=X,this.fieldName=Z,this.ctor=_,this.toObjectFn=K,this.isRepeated=te},goog.exportSymbol("jspb.ExtensionFieldInfo",jspb.ExtensionFieldInfo),jspb.ExtensionFieldBinaryInfo=function(X,Z,_,K,te,ne){this.fieldInfo=X,this.binaryReaderFn=Z,this.binaryWriterFn=_,this.binaryMessageSerializeFn=K,this.binaryMessageDeserializeFn=te,this.isPacked=ne},goog.exportSymbol("jspb.ExtensionFieldBinaryInfo",jspb.ExtensionFieldBinaryInfo),jspb.ExtensionFieldInfo.prototype.isMessageType=function(){return!!this.ctor},goog.exportProperty(jspb.ExtensionFieldInfo.prototype,"isMessageType",jspb.ExtensionFieldInfo.prototype.isMessageType),jspb.Message=function(){},goog.exportSymbol("jspb.Message",jspb.Message),jspb.Message.GENERATE_TO_OBJECT=!0,goog.exportProperty(jspb.Message,"GENERATE_TO_OBJECT",jspb.Message.GENERATE_TO_OBJECT),jspb.Message.GENERATE_FROM_OBJECT=!goog.DISALLOW_TEST_ONLY_CODE,goog.exportProperty(jspb.Message,"GENERATE_FROM_OBJECT",jspb.Message.GENERATE_FROM_OBJECT),jspb.Message.GENERATE_TO_STRING=!0,jspb.Message.ASSUME_LOCAL_ARRAYS=!1,jspb.Message.SERIALIZE_EMPTY_TRAILING_FIELDS=!0,jspb.Message.SUPPORTS_UINT8ARRAY_=typeof Uint8Array=="function",jspb.Message.prototype.getJsPbMessageId=function(){return this.messageId_},goog.exportProperty(jspb.Message.prototype,"getJsPbMessageId",jspb.Message.prototype.getJsPbMessageId),jspb.Message.getIndex_=function(X,Z){return Z+X.arrayIndexOffset_},jspb.Message.hiddenES6Property_=function(){},jspb.Message.getFieldNumber_=function(X,Z){return Z-X.arrayIndexOffset_},jspb.Message.initialize=function(X,Z,_,K,te,ne){if(X.wrappers_=null,Z||(Z=_?[_]:[]),X.messageId_=_?String(_):void 0,X.arrayIndexOffset_=_===0?-1:0,X.array=Z,jspb.Message.initPivotAndExtensionObject_(X,K),X.convertedPrimitiveFields_={},jspb.Message.SERIALIZE_EMPTY_TRAILING_FIELDS||(X.repeatedFields=te),te)for(Z=0;Z<te.length;Z++)(_=te[Z])<X.pivot_?(_=jspb.Message.getIndex_(X,_),X.array[_]=X.array[_]||jspb.Message.EMPTY_LIST_SENTINEL_):(jspb.Message.maybeInitEmptyExtensionObject_(X),X.extensionObject_[_]=X.extensionObject_[_]||jspb.Message.EMPTY_LIST_SENTINEL_);if(ne&&ne.length)for(Z=0;Z<ne.length;Z++)jspb.Message.computeOneofCase(X,ne[Z])},goog.exportProperty(jspb.Message,"initialize",jspb.Message.initialize),jspb.Message.EMPTY_LIST_SENTINEL_=goog.DEBUG&&Object.freeze?Object.freeze([]):[],jspb.Message.isArray_=function(X){return jspb.Message.ASSUME_LOCAL_ARRAYS?X instanceof Array:Array.isArray(X)},jspb.Message.isExtensionObject_=function(X){return!(X===null||typeof X!="object"||jspb.Message.isArray_(X)||jspb.Message.SUPPORTS_UINT8ARRAY_&&X instanceof Uint8Array)},jspb.Message.initPivotAndExtensionObject_=function(X,Z){var _=X.array.length,K=-1;if(_&&(K=_-1,_=X.array[K],jspb.Message.isExtensionObject_(_)))return X.pivot_=jspb.Message.getFieldNumber_(X,K),void(X.extensionObject_=_);-1<Z?(X.pivot_=Math.max(Z,jspb.Message.getFieldNumber_(X,K+1)),X.extensionObject_=null):X.pivot_=Number.MAX_VALUE},jspb.Message.maybeInitEmptyExtensionObject_=function(X){var Z=jspb.Message.getIndex_(X,X.pivot_);X.array[Z]||(X.extensionObject_=X.array[Z]={})},jspb.Message.toObjectList=function(X,Z,_){for(var K=[],te=0;te<X.length;te++)K[te]=Z.call(X[te],_,X[te]);return K},goog.exportProperty(jspb.Message,"toObjectList",jspb.Message.toObjectList),jspb.Message.toObjectExtension=function(X,Z,_,K,te){for(var ne in _){var ie=_[ne],oe=K.call(X,ie);if(oe!=null){for(var se in ie.fieldName)if(ie.fieldName.hasOwnProperty(se))break;Z[se]=ie.toObjectFn?ie.isRepeated?jspb.Message.toObjectList(oe,ie.toObjectFn,te):ie.toObjectFn(te,oe):oe}}},goog.exportProperty(jspb.Message,"toObjectExtension",jspb.Message.toObjectExtension),jspb.Message.serializeBinaryExtensions=function(X,Z,_,K){for(var te in _){var ne=_[te],ie=ne.fieldInfo;if(!ne.binaryWriterFn)throw Error("Message extension present that was generated without binary serialization support");var oe=K.call(X,ie);if(oe!=null)if(ie.isMessageType()){if(!ne.binaryMessageSerializeFn)throw Error("Message extension present holding submessage without binary support enabled, and message is being serialized to binary format");ne.binaryWriterFn.call(Z,ie.fieldIndex,oe,ne.binaryMessageSerializeFn)}else ne.binaryWriterFn.call(Z,ie.fieldIndex,oe)}},goog.exportProperty(jspb.Message,"serializeBinaryExtensions",jspb.Message.serializeBinaryExtensions),jspb.Message.readBinaryExtension=function(X,Z,_,K,te){var ne=_[Z.getFieldNumber()];if(ne){if(_=ne.fieldInfo,!ne.binaryReaderFn)throw Error("Deserializing extension whose generated code does not support binary format");if(_.isMessageType()){var ie=new _.ctor;ne.binaryReaderFn.call(Z,ie,ne.binaryMessageDeserializeFn)}else ie=ne.binaryReaderFn.call(Z);_.isRepeated&&!ne.isPacked?(Z=K.call(X,_))?Z.push(ie):te.call(X,_,[ie]):te.call(X,_,ie)}else Z.skipField()},goog.exportProperty(jspb.Message,"readBinaryExtension",jspb.Message.readBinaryExtension),jspb.Message.getField=function(X,Z){if(Z<X.pivot_){Z=jspb.Message.getIndex_(X,Z);var _=X.array[Z];return _===jspb.Message.EMPTY_LIST_SENTINEL_?X.array[Z]=[]:_}if(X.extensionObject_)return(_=X.extensionObject_[Z])===jspb.Message.EMPTY_LIST_SENTINEL_?X.extensionObject_[Z]=[]:_},goog.exportProperty(jspb.Message,"getField",jspb.Message.getField),jspb.Message.getRepeatedField=function(X,Z){return jspb.Message.getField(X,Z)},goog.exportProperty(jspb.Message,"getRepeatedField",jspb.Message.getRepeatedField),jspb.Message.getOptionalFloatingPointField=function(X,Z){return(X=jspb.Message.getField(X,Z))==null?X:+X},goog.exportProperty(jspb.Message,"getOptionalFloatingPointField",jspb.Message.getOptionalFloatingPointField),jspb.Message.getBooleanField=function(X,Z){return(X=jspb.Message.getField(X,Z))==null?X:!!X},goog.exportProperty(jspb.Message,"getBooleanField",jspb.Message.getBooleanField),jspb.Message.getRepeatedFloatingPointField=function(X,Z){var _=jspb.Message.getRepeatedField(X,Z);if(X.convertedPrimitiveFields_||(X.convertedPrimitiveFields_={}),!X.convertedPrimitiveFields_[Z]){for(var K=0;K<_.length;K++)_[K]=+_[K];X.convertedPrimitiveFields_[Z]=!0}return _},goog.exportProperty(jspb.Message,"getRepeatedFloatingPointField",jspb.Message.getRepeatedFloatingPointField),jspb.Message.getRepeatedBooleanField=function(X,Z){var _=jspb.Message.getRepeatedField(X,Z);if(X.convertedPrimitiveFields_||(X.convertedPrimitiveFields_={}),!X.convertedPrimitiveFields_[Z]){for(var K=0;K<_.length;K++)_[K]=!!_[K];X.convertedPrimitiveFields_[Z]=!0}return _},goog.exportProperty(jspb.Message,"getRepeatedBooleanField",jspb.Message.getRepeatedBooleanField),jspb.Message.bytesAsB64=function(X){return X==null||typeof X=="string"?X:jspb.Message.SUPPORTS_UINT8ARRAY_&&X instanceof Uint8Array?goog.crypt.base64.encodeByteArray(X):(jspb.asserts.fail("Cannot coerce to b64 string: "+goog.typeOf(X)),null)},goog.exportProperty(jspb.Message,"bytesAsB64",jspb.Message.bytesAsB64),jspb.Message.bytesAsU8=function(X){return X==null||X instanceof Uint8Array?X:typeof X=="string"?goog.crypt.base64.decodeStringToUint8Array(X):(jspb.asserts.fail("Cannot coerce to Uint8Array: "+goog.typeOf(X)),null)},goog.exportProperty(jspb.Message,"bytesAsU8",jspb.Message.bytesAsU8),jspb.Message.bytesListAsB64=function(X){return jspb.Message.assertConsistentTypes_(X),X.length&&typeof X[0]!="string"?goog.array.map(X,jspb.Message.bytesAsB64):X},goog.exportProperty(jspb.Message,"bytesListAsB64",jspb.Message.bytesListAsB64),jspb.Message.bytesListAsU8=function(X){return jspb.Message.assertConsistentTypes_(X),!X.length||X[0]instanceof Uint8Array?X:goog.array.map(X,jspb.Message.bytesAsU8)},goog.exportProperty(jspb.Message,"bytesListAsU8",jspb.Message.bytesListAsU8),jspb.Message.assertConsistentTypes_=function(X){if(goog.DEBUG&&X&&1<X.length){var Z=goog.typeOf(X[0]);goog.array.forEach(X,function(_){goog.typeOf(_)!=Z&&jspb.asserts.fail("Inconsistent type in JSPB repeated field array. Got "+goog.typeOf(_)+" expected "+Z)})}},jspb.Message.getFieldWithDefault=function(X,Z,_){return(X=jspb.Message.getField(X,Z))==null?_:X},goog.exportProperty(jspb.Message,"getFieldWithDefault",jspb.Message.getFieldWithDefault),jspb.Message.getBooleanFieldWithDefault=function(X,Z,_){return(X=jspb.Message.getBooleanField(X,Z))==null?_:X},goog.exportProperty(jspb.Message,"getBooleanFieldWithDefault",jspb.Message.getBooleanFieldWithDefault),jspb.Message.getFloatingPointFieldWithDefault=function(X,Z,_){return(X=jspb.Message.getOptionalFloatingPointField(X,Z))==null?_:X},goog.exportProperty(jspb.Message,"getFloatingPointFieldWithDefault",jspb.Message.getFloatingPointFieldWithDefault),jspb.Message.getFieldProto3=jspb.Message.getFieldWithDefault,goog.exportProperty(jspb.Message,"getFieldProto3",jspb.Message.getFieldProto3),jspb.Message.getMapField=function(X,Z,_,K){if(X.wrappers_||(X.wrappers_={}),Z in X.wrappers_)return X.wrappers_[Z];var te=jspb.Message.getField(X,Z);if(!te){if(_)return;te=[],jspb.Message.setField(X,Z,te)}return X.wrappers_[Z]=new jspb.Map(te,K)},goog.exportProperty(jspb.Message,"getMapField",jspb.Message.getMapField),jspb.Message.setField=function(X,Z,_){return jspb.asserts.assertInstanceof(X,jspb.Message),Z<X.pivot_?X.array[jspb.Message.getIndex_(X,Z)]=_:(jspb.Message.maybeInitEmptyExtensionObject_(X),X.extensionObject_[Z]=_),X},goog.exportProperty(jspb.Message,"setField",jspb.Message.setField),jspb.Message.setProto3IntField=function(X,Z,_){return jspb.Message.setFieldIgnoringDefault_(X,Z,_,0)},goog.exportProperty(jspb.Message,"setProto3IntField",jspb.Message.setProto3IntField),jspb.Message.setProto3FloatField=function(X,Z,_){return jspb.Message.setFieldIgnoringDefault_(X,Z,_,0)},goog.exportProperty(jspb.Message,"setProto3FloatField",jspb.Message.setProto3FloatField),jspb.Message.setProto3BooleanField=function(X,Z,_){return jspb.Message.setFieldIgnoringDefault_(X,Z,_,!1)},goog.exportProperty(jspb.Message,"setProto3BooleanField",jspb.Message.setProto3BooleanField),jspb.Message.setProto3StringField=function(X,Z,_){return jspb.Message.setFieldIgnoringDefault_(X,Z,_,"")},goog.exportProperty(jspb.Message,"setProto3StringField",jspb.Message.setProto3StringField),jspb.Message.setProto3BytesField=function(X,Z,_){return jspb.Message.setFieldIgnoringDefault_(X,Z,_,"")},goog.exportProperty(jspb.Message,"setProto3BytesField",jspb.Message.setProto3BytesField),jspb.Message.setProto3EnumField=function(X,Z,_){return jspb.Message.setFieldIgnoringDefault_(X,Z,_,0)},goog.exportProperty(jspb.Message,"setProto3EnumField",jspb.Message.setProto3EnumField),jspb.Message.setProto3StringIntField=function(X,Z,_){return jspb.Message.setFieldIgnoringDefault_(X,Z,_,"0")},goog.exportProperty(jspb.Message,"setProto3StringIntField",jspb.Message.setProto3StringIntField),jspb.Message.setFieldIgnoringDefault_=function(X,Z,_,K){return jspb.asserts.assertInstanceof(X,jspb.Message),_!==K?jspb.Message.setField(X,Z,_):Z<X.pivot_?X.array[jspb.Message.getIndex_(X,Z)]=null:(jspb.Message.maybeInitEmptyExtensionObject_(X),delete X.extensionObject_[Z]),X},jspb.Message.addToRepeatedField=function(X,Z,_,K){return jspb.asserts.assertInstanceof(X,jspb.Message),Z=jspb.Message.getRepeatedField(X,Z),K!=null?Z.splice(K,0,_):Z.push(_),X},goog.exportProperty(jspb.Message,"addToRepeatedField",jspb.Message.addToRepeatedField),jspb.Message.setOneofField=function(X,Z,_,K){return jspb.asserts.assertInstanceof(X,jspb.Message),(_=jspb.Message.computeOneofCase(X,_))&&_!==Z&&K!==void 0&&(X.wrappers_&&_ in X.wrappers_&&(X.wrappers_[_]=void 0),jspb.Message.setField(X,_,void 0)),jspb.Message.setField(X,Z,K)},goog.exportProperty(jspb.Message,"setOneofField",jspb.Message.setOneofField),jspb.Message.computeOneofCase=function(X,Z){for(var _,K,te=0;te<Z.length;te++){var ne=Z[te],ie=jspb.Message.getField(X,ne);ie!=null&&(_=ne,K=ie,jspb.Message.setField(X,ne,void 0))}return _?(jspb.Message.setField(X,_,K),_):0},goog.exportProperty(jspb.Message,"computeOneofCase",jspb.Message.computeOneofCase),jspb.Message.getWrapperField=function(X,Z,_,K){if(X.wrappers_||(X.wrappers_={}),!X.wrappers_[_]){var te=jspb.Message.getField(X,_);(K||te)&&(X.wrappers_[_]=new Z(te))}return X.wrappers_[_]},goog.exportProperty(jspb.Message,"getWrapperField",jspb.Message.getWrapperField),jspb.Message.getRepeatedWrapperField=function(X,Z,_){return jspb.Message.wrapRepeatedField_(X,Z,_),(Z=X.wrappers_[_])==jspb.Message.EMPTY_LIST_SENTINEL_&&(Z=X.wrappers_[_]=[]),Z},goog.exportProperty(jspb.Message,"getRepeatedWrapperField",jspb.Message.getRepeatedWrapperField),jspb.Message.wrapRepeatedField_=function(X,Z,_){if(X.wrappers_||(X.wrappers_={}),!X.wrappers_[_]){for(var K=jspb.Message.getRepeatedField(X,_),te=[],ne=0;ne<K.length;ne++)te[ne]=new Z(K[ne]);X.wrappers_[_]=te}},jspb.Message.setWrapperField=function(X,Z,_){jspb.asserts.assertInstanceof(X,jspb.Message),X.wrappers_||(X.wrappers_={});var K=_&&_.toArray();return X.wrappers_[Z]=_,jspb.Message.setField(X,Z,K)},goog.exportProperty(jspb.Message,"setWrapperField",jspb.Message.setWrapperField),jspb.Message.setOneofWrapperField=function(X,Z,_,K){jspb.asserts.assertInstanceof(X,jspb.Message),X.wrappers_||(X.wrappers_={});var te=K&&K.toArray();return X.wrappers_[Z]=K,jspb.Message.setOneofField(X,Z,_,te)},goog.exportProperty(jspb.Message,"setOneofWrapperField",jspb.Message.setOneofWrapperField),jspb.Message.setRepeatedWrapperField=function(X,Z,_){jspb.asserts.assertInstanceof(X,jspb.Message),X.wrappers_||(X.wrappers_={}),_=_||[];for(var K=[],te=0;te<_.length;te++)K[te]=_[te].toArray();return X.wrappers_[Z]=_,jspb.Message.setField(X,Z,K)},goog.exportProperty(jspb.Message,"setRepeatedWrapperField",jspb.Message.setRepeatedWrapperField),jspb.Message.addToRepeatedWrapperField=function(X,Z,_,K,te){jspb.Message.wrapRepeatedField_(X,K,Z);var ne=X.wrappers_[Z];return ne||(ne=X.wrappers_[Z]=[]),_=_||new K,X=jspb.Message.getRepeatedField(X,Z),te!=null?(ne.splice(te,0,_),X.splice(te,0,_.toArray())):(ne.push(_),X.push(_.toArray())),_},goog.exportProperty(jspb.Message,"addToRepeatedWrapperField",jspb.Message.addToRepeatedWrapperField),jspb.Message.toMap=function(X,Z,_,K){for(var te={},ne=0;ne<X.length;ne++)te[Z.call(X[ne])]=_?_.call(X[ne],K,X[ne]):X[ne];return te},goog.exportProperty(jspb.Message,"toMap",jspb.Message.toMap),jspb.Message.prototype.syncMapFields_=function(){if(this.wrappers_)for(var X in this.wrappers_){var Z=this.wrappers_[X];if(Array.isArray(Z))for(var _=0;_<Z.length;_++)Z[_]&&Z[_].toArray();else Z&&Z.toArray()}},jspb.Message.prototype.toArray=function(){return this.syncMapFields_(),this.array},goog.exportProperty(jspb.Message.prototype,"toArray",jspb.Message.prototype.toArray),jspb.Message.GENERATE_TO_STRING&&(jspb.Message.prototype.toString=function(){return this.syncMapFields_(),this.array.toString()}),jspb.Message.prototype.getExtension=function(X){if(this.extensionObject_){this.wrappers_||(this.wrappers_={});var Z=X.fieldIndex;if(X.isRepeated){if(X.isMessageType())return this.wrappers_[Z]||(this.wrappers_[Z]=goog.array.map(this.extensionObject_[Z]||[],function(_){return new X.ctor(_)})),this.wrappers_[Z]}else if(X.isMessageType())return!this.wrappers_[Z]&&this.extensionObject_[Z]&&(this.wrappers_[Z]=new X.ctor(this.extensionObject_[Z])),this.wrappers_[Z];return this.extensionObject_[Z]}},goog.exportProperty(jspb.Message.prototype,"getExtension",jspb.Message.prototype.getExtension),jspb.Message.prototype.setExtension=function(X,Z){this.wrappers_||(this.wrappers_={}),jspb.Message.maybeInitEmptyExtensionObject_(this);var _=X.fieldIndex;return X.isRepeated?(Z=Z||[],X.isMessageType()?(this.wrappers_[_]=Z,this.extensionObject_[_]=goog.array.map(Z,function(K){return K.toArray()})):this.extensionObject_[_]=Z):X.isMessageType()?(this.wrappers_[_]=Z,this.extensionObject_[_]=Z&&Z.toArray()):this.extensionObject_[_]=Z,this},goog.exportProperty(jspb.Message.prototype,"setExtension",jspb.Message.prototype.setExtension),jspb.Message.difference=function(X,Z){if(!(X instanceof Z.constructor))throw Error("Messages have different types.");var _=X.toArray();Z=Z.toArray();var K=[],te=0,ne=_.length>Z.length?_.length:Z.length;for(X.getJsPbMessageId()&&(K[0]=X.getJsPbMessageId(),te=1);te<ne;te++)jspb.Message.compareFields(_[te],Z[te])||(K[te]=Z[te]);return new X.constructor(K)},goog.exportProperty(jspb.Message,"difference",jspb.Message.difference),jspb.Message.equals=function(X,Z){return X==Z||!(!X||!Z)&&X instanceof Z.constructor&&jspb.Message.compareFields(X.toArray(),Z.toArray())},goog.exportProperty(jspb.Message,"equals",jspb.Message.equals),jspb.Message.compareExtensions=function(X,Z){X=X||{},Z=Z||{};var _,K={};for(_ in X)K[_]=0;for(_ in Z)K[_]=0;for(_ in K)if(!jspb.Message.compareFields(X[_],Z[_]))return!1;return!0},goog.exportProperty(jspb.Message,"compareExtensions",jspb.Message.compareExtensions),jspb.Message.compareFields=function(X,Z){if(X==Z)return!0;if(!goog.isObject(X)||!goog.isObject(Z))return!!(typeof X=="number"&&isNaN(X)||typeof Z=="number"&&isNaN(Z))&&String(X)==String(Z);if(X.constructor!=Z.constructor)return!1;if(jspb.Message.SUPPORTS_UINT8ARRAY_&&X.constructor===Uint8Array){if(X.length!=Z.length)return!1;for(var _=0;_<X.length;_++)if(X[_]!=Z[_])return!1;return!0}if(X.constructor===Array){var K=void 0,te=void 0,ne=Math.max(X.length,Z.length);for(_=0;_<ne;_++){var ie=X[_],oe=Z[_];if(ie&&ie.constructor==Object&&(jspb.asserts.assert(K===void 0),jspb.asserts.assert(_===X.length-1),K=ie,ie=void 0),oe&&oe.constructor==Object&&(jspb.asserts.assert(te===void 0),jspb.asserts.assert(_===Z.length-1),te=oe,oe=void 0),!jspb.Message.compareFields(ie,oe))return!1}return!K&&!te||(K=K||{},te=te||{},jspb.Message.compareExtensions(K,te))}if(X.constructor===Object)return jspb.Message.compareExtensions(X,Z);throw Error("Invalid type in JSPB array")},goog.exportProperty(jspb.Message,"compareFields",jspb.Message.compareFields),jspb.Message.prototype.cloneMessage=function(){return jspb.Message.cloneMessage(this)},goog.exportProperty(jspb.Message.prototype,"cloneMessage",jspb.Message.prototype.cloneMessage),jspb.Message.prototype.clone=function(){return jspb.Message.cloneMessage(this)},goog.exportProperty(jspb.Message.prototype,"clone",jspb.Message.prototype.clone),jspb.Message.clone=function(X){return jspb.Message.cloneMessage(X)},goog.exportProperty(jspb.Message,"clone",jspb.Message.clone),jspb.Message.cloneMessage=function(X){return new X.constructor(jspb.Message.clone_(X.toArray()))},jspb.Message.copyInto=function(X,Z){jspb.asserts.assertInstanceof(X,jspb.Message),jspb.asserts.assertInstanceof(Z,jspb.Message),jspb.asserts.assert(X.constructor==Z.constructor,"Copy source and target message should have the same type."),X=jspb.Message.clone(X);for(var _=Z.toArray(),K=X.toArray(),te=_.length=0;te<K.length;te++)_[te]=K[te];Z.wrappers_=X.wrappers_,Z.extensionObject_=X.extensionObject_},goog.exportProperty(jspb.Message,"copyInto",jspb.Message.copyInto),jspb.Message.clone_=function(X){if(Array.isArray(X)){for(var Z=Array(X.length),_=0;_<X.length;_++){var K=X[_];K!=null&&(Z[_]=typeof K=="object"?jspb.Message.clone_(jspb.asserts.assert(K)):K)}return Z}if(jspb.Message.SUPPORTS_UINT8ARRAY_&&X instanceof Uint8Array)return new Uint8Array(X);for(_ in Z={},X)(K=X[_])!=null&&(Z[_]=typeof K=="object"?jspb.Message.clone_(jspb.asserts.assert(K)):K);return Z},jspb.Message.registerMessageType=function(X,Z){Z.messageId=X},goog.exportProperty(jspb.Message,"registerMessageType",jspb.Message.registerMessageType),jspb.Message.messageSetExtensions={},jspb.Message.messageSetExtensionsBinary={},jspb.Export={},exports.Map=jspb.Map,exports.Message=jspb.Message,exports.BinaryReader=jspb.BinaryReader,exports.BinaryWriter=jspb.BinaryWriter,exports.ExtensionFieldInfo=jspb.ExtensionFieldInfo,exports.ExtensionFieldBinaryInfo=jspb.ExtensionFieldBinaryInfo,exports.exportSymbol=goog.exportSymbol,exports.inherits=goog.inherits,exports.object={extend:goog.object.extend},exports.typeOf=goog.typeOf}},__webpack_module_cache__={};function __webpack_require__(X){var Z=__webpack_module_cache__[X];if(Z!==void 0)return Z.exports;var _=__webpack_module_cache__[X]={exports:{}};return __webpack_modules__[X].call(_.exports,_,_.exports,__webpack_require__),_.exports}__webpack_require__.d=(X,Z)=>{for(var _ in Z)__webpack_require__.o(Z,_)&&!__webpack_require__.o(X,_)&&Object.defineProperty(X,_,{enumerable:!0,get:Z[_]})},__webpack_require__.g=function(){if(typeof globalThis=="object")return globalThis;try{return this||new Function("return this")()}catch{if(typeof window=="object")return window}}(),__webpack_require__.o=(X,Z)=>Object.prototype.hasOwnProperty.call(X,Z),__webpack_require__.r=X=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(X,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(X,"__esModule",{value:!0})};var __webpack_exports__={};return(()=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{ConvaiClient:()=>Te,narrativeDesign:()=>X});var X={};__webpack_require__.r(X),__webpack_require__.d(X,{createSection:()=>Ae,createTrigger:()=>Ve,deleteSection:()=>Re,deleteTrigger:()=>Ze,editSection:()=>ye,getSection:()=>ve,getTrigger:()=>_e,listSection:()=>Be,listTriggers:()=>Fe,updateTrigger:()=>Ee});class Z{constructor(Le){this.audioContext=null,this.sourceNode=null,this.audioQueue=[],this.gainNode=null,this.isMuted=!1,this.isPlaying=!1,this.isPaused=!1,this.pausedAt=0,this.startTime=0,this.currentBuffer=null,this.preloading=!1,this.channels=1,this.onPlay=null,this.onStop=null,this.onStateChangeCallback=null,this.sampleRate=Le}initializeAudioContext(){try{this.audioContext=new(window.AudioContext||window.webkitAudioContext||window.mozAudioContext||window.oAudioContext||window.msAudioContext),this.gainNode=this.audioContext.createGain()}catch{alert("Web Audio API is not supported in this browser")}}preload(){this.preloading=!0}addChunk(Le,Ke=null){if(this.audioContext?this.audioContext.state==="suspended"&&this.audioContext.resume():this.initializeAudioContext(),Le!=null){this.sampleRate=Ke||this.sampleRate;const Ue=Le.slice(44);this.audioQueue.push(Ue)}else this.audioQueue.push(null);this.preloading||this.isPlaying||this.isPaused||this.playNextChunk()}playAudio(){this.preloading&&(this.preloading=!1,this.isPlaying||this.isPaused||this.playNextChunk())}playNextChunk(){if(!this.audioContext)return;if(this.audioQueue.length===0)return this.isPlaying=!1,void this.notifyStateChange("stopped");const Le=this.audioQueue.shift();if(this.pausedAt=0,Le!==null){if(!(Le.length<=0)){this.currentBuffer=this.audioContext.createBuffer(this.channels,Le.length/(2*this.channels),this.sampleRate);for(let Ke=0;Ke<this.channels;Ke++){const Ue=this.currentBuffer.getChannelData(Ke);for(let rt=0;rt<Ue.length;rt++){const tt=Le[2*rt],at=Le[2*rt+1]<<8|tt,ze=at>=32768?(at-65536)/32768:at/32767;Ue[rt]=ze}}this.playBuffer(this.currentBuffer)}}else this.stopAudio()}playBuffer(Le){this.audioContext&&this.gainNode&&(this.sourceNode=this.audioContext.createBufferSource(),this.sourceNode.buffer=Le,this.sourceNode.connect(this.gainNode).connect(this.audioContext.destination),this.sourceNode.onended=()=>{var Ke;this.isPaused||((Ke=this.sourceNode)===null||Ke===void 0||Ke.disconnect(),this.sourceNode=null,this.playNextChunk())},this.sourceNode.start(0,this.pausedAt),this.startTime=this.audioContext.currentTime-this.pausedAt,this.isPlaying=!0,this.isPaused=!1,this.notifyStateChange("playing"),this.onPlay&&this.onPlay())}pauseAudio(){var Le;if(this.isPlaying&&!this.isPaused){const Ke=this.audioContext.currentTime;this.pausedAt+=Ke-this.startTime,(Le=this.sourceNode)===null||Le===void 0||Le.stop(),this.isPaused=!0,this.isPlaying=!1,this.notifyStateChange("paused")}}resumeAudio(){this.isPaused&&this.currentBuffer&&(this.playBuffer(this.currentBuffer),this.notifyStateChange("resumed"))}stopAudio(){var Le;(this.isPlaying||this.isPaused)&&((Le=this.sourceNode)===null||Le===void 0||Le.stop(),this.isPlaying=!1,this.isPaused=!1,this.pausedAt=0,this.startTime=0,this.notifyStateChange("stopped"),this.onStop&&this.onStop(),this.audioQueue=[])}notifyStateChange(Le){this.onStateChangeCallback&&this.onStateChangeCallback(Le)}getVolume(){return this.isMuted?0:1}setAudioVolume(Le){if(this.gainNode){if(Le<0||Le>1)throw new Error("Invalid volume value. Volume must be between 0 and 1.");this.gainNode.gain.value=Le,this.isMuted=Le===0}}onPlayStart(Le){this.onPlay=Le}onPlayStop(Le){this.onStop=Le}onStateChange(Le){this.onStateChangeCallback=Le}}class _{constructor(){var Le,Ke;this.audioContext=new AudioContext;let Ue=new Blob([`class AudioRecorderProcessor extends AudioWorkletProcessor {
  constructor() {
    super();
    this.recording = false;
    this.chunkSize = 4096;
    this.sampleAccumulator = new Float32Array(this.chunkSize);
    this.accumulatedSamples = 0;
    this.port.onmessage = (event) => {
      if (!event.data.command) {
        return;
      }
      if (event.data.command === 'start') {
        this.recording = true;
      } else if (event.data.command === 'stop') {
        this.recording = false;
      }
    };
  }

  process(inputs, outputs) {
    if (!this.recording) {
      return true;
    }
    const input = inputs[0];
    const output = outputs[0];
    // output[0].set(input[0]);
    for (let i = 0; i < input[0].length; i++) {
      this.sampleAccumulator[this.accumulatedSamples++] = input[0][i];
      if (this.accumulatedSamples >= this.chunkSize) {
        this.port.postMessage(this.sampleAccumulator.buffer);
        this.sampleAccumulator = new Float32Array(this.chunkSize);
        this.accumulatedSamples = 0;
      }
    }
    return true;
  }
}

registerProcessor('audio-recorder-processor', AudioRecorderProcessor);`],{type:"application/javascript"});this.audioWorkletModule=(Ke=(Le=this.audioContext)===null||Le===void 0?void 0:Le.audioWorklet)===null||Ke===void 0?void 0:Ke.addModule(URL.createObjectURL(Ue)),this.mediaStream=null,this.workletNode=null,navigator.mediaDevices&&navigator.mediaDevices.getUserMedia&&this.getMicrophoneAccess()}convertoFloat32ToInt16(Le){for(var Ke=Le.length,Ue=new Int16Array(Ke);Ke--;)Ue[Ke]=65535*Le[Ke];return Ue.buffer}start(Le){this.audioCallback=Le,this.mediaStream||this.getMicrophoneAccess(),this.userMedia.then(Ke=>{this.mediaStream=Ke,this.audioWorkletModule.then(()=>{const Ue=this.audioContext.createMediaStreamSource(this.mediaStream);this.workletNode=new AudioWorkletNode(this.audioContext,"audio-recorder-processor"),this.workletNode.port.onmessage=rt=>{if(rt.data.command)return;const tt=new Float32Array(rt.data),at=this.convertoFloat32ToInt16(tt);this.audioCallback(at)},Ue.connect(this.workletNode),this.audioContext.resume(),this.workletNode.port.postMessage({command:"start"})})})}stop(){this.workletNode&&(this.workletNode.port.postMessage({command:"stop"}),this.workletNode.disconnect(),this.workletNode=null)}removeMicrophoneAccess(){this.mediaStream&&(this.mediaStream.getTracks().forEach(Le=>{Le.stop()}),this.mediaStream=null)}getMicrophoneAccess(){this.userMedia=navigator.mediaDevices.getUserMedia({audio:!0})}}var K=__webpack_require__(553),te=__webpack_require__(820),ne=__webpack_require__(48);const ie="https://webstream.convai.com",oe=new K.grpc.Metadata;oe.set("source","Web3D");class se{constructor(Le,Ke,Ue,rt,tt,at,ze,qe,Pe=!1,Ye=!1,$e=3,ut,ot=null){this.apiKey=Le,this.characterId=Ke,this.speaker=Ue,this.speakerId=rt,this.sessionId=tt,this.languageCode=qe,this.disableAudioGeneration=Pe,this.enableFacialData=Ye,this.faceModel=$e,this.narrativeTemplateKeysMap=ut,this.actionConfigParams=ot,this.client=K.grpc.client(te.C.GetResponse,{host:ie,transport:K.grpc.WebsocketTransport()}),this.feedbackClient=K.grpc.client(te.C.SubmitFeedback,{host:ie,transport:K.grpc.WebsocketTransport()}),this.client.onMessage(gt=>{at(gt)}),this.client.onEnd((gt,ht,dt)=>{gt!=K.grpc.Code.OK&&ze("chatbotResponseError",ht,String(gt))}),this.feedbackClient.onMessage(gt=>{}),this.feedbackClient.onEnd((gt,ht,dt)=>{gt!=K.grpc.Code.OK&&ze("feedbackResponseError",ht,String(gt))})}close(){this.isStarted&&(this.isStarted=!1,this.client.close())}invokeTrigger(Le,Ke=""){if(!(Le.length>0&&Ke.length>0)){this.isStarted||this.start();var Ue=new ne.GetResponseRequest,rt=new ne.GetResponseRequest.GetResponseData,tt=new ne.TriggerConfig;Le||tt.setTriggerMessage(Ke),Ke||tt.setTriggerName(Le),rt.setTriggerData(tt),Ue.setGetResponseData(rt),this.client.send(Ue),this.client.finishSend()}}sendFeedback(Le,Ke,Ue,rt,tt){if(Le){this.feedbackClient.start();var at=new ne.FeedbackRequest,ze=new ne.FeedbackRequest.Feedback;ze.setThumbsUp(rt),ze.setFeedbackText(tt),at.setTextFeedback(ze),at.setCharacterId(Ke||""),at.setInteractionId(Le),at.setSessionId(Ue||""),this.feedbackClient.send(at),this.feedbackClient.finishSend()}}sendText(Le){if(this.inputMode!="audio"){this.inputMode="text",this.isStarted||this.start();var Ke=new ne.GetResponseRequest,Ue=new ne.GetResponseRequest.GetResponseData;Ue.setTextData(Le),Ke.setGetResponseData(Ue),this.client.send(Ke),this.client.finishSend()}}sendAudioChunk(Le){if(this.inputMode!="text"){this.inputMode="audio",this.isStarted||this.start();var Ke=new ne.GetResponseRequest,Ue=new ne.GetResponseRequest.GetResponseData;Ue.setAudioData(new Uint8Array(Le)),Ke.setGetResponseData(Ue),this.client.send(Ke)}}finishSend(){var Le;this.isStarted&&((Le=this.client)===null||Le===void 0||Le.finishSend())}setActionConfig(Le){this.actionConfigParams&&(this.actionConfigParams.actions&&Le.setActionsList(this.actionConfigParams.actions),this.actionConfigParams.characters&&this.actionConfigParams.characters.forEach(Ke=>{ne.ActionConfig.Character}),this.actionConfigParams.objects&&this.actionConfigParams.objects.forEach(Ke=>{ne.ActionConfig.Object}),this.actionConfigParams.classification&&Le.setClassification(this.actionConfigParams.classification),typeof this.actionConfigParams.contextLevel=="number"&&Le.setContextLevel(this.actionConfigParams.contextLevel),this.actionConfigParams.currentAttentionObject&&Le.setCurrentAttentionObject(this.actionConfigParams.currentAttentionObject))}start(){var Le;this.client.start(oe);var Ke=new ne.GetResponseRequest,Ue=new ne.GetResponseRequest.GetResponseConfig;Ue.setApiKey(this.apiKey),Ue.setCharacterId(this.characterId),Ue.setSessionId(this.sessionId),Ue.setLanguageCode(this.languageCode),Ue.setSpeaker(this.speaker),Ue.setSpeakerId(this.speakerId);var rt=Ue.getNarrativeTemplateKeysMap();rt&&((Le=this.narrativeTemplateKeysMap)===null||Le===void 0||Le.forEach((ze,qe)=>{rt.set(qe,ze)}));var tt=new ne.AudioConfig;tt.setSampleRateHertz(44100),tt.setDisableAudio(this.disableAudioGeneration),tt.setEnableFacialData(this.enableFacialData),tt.setFaceModel(this.faceModel),Ue.setAudioConfig(tt);var at=new ne.ActionConfig;this.setActionConfig(at),Ue.setActionConfig(at),Ke.setGetResponseConfig(Ue),this.client.send(Ke),this.isStarted=!0}}let ae,ge=null,ce=null;const de=ke=>{ae=ke},Ie=ke=>{let Le=new se(ae.apiKey,ae.characterId,ae.speaker,ae.speakerId,ae.sessionId,ae.responseCallback,ae.errorCallback,ae.languageCode,ae.disableAudioGeneration,ae.enableFacialData,ae.faceModel,ae.narrativeTemplateKeysMap,ae.actionConfig);ke===1?ce=Le:ge=Le},fe=ke=>(ke&&de(ke),ge===null?((Le=>{Ie(0)})(),Ie(1)):(ge=ce,Ie(1)),ge);setInterval(()=>{ce!==null&&Ie(1)},5e3);var be=function(ke,Le,Ke,Ue){return new(Ke||(Ke=Promise))(function(rt,tt){function at(Pe){try{qe(Ue.next(Pe))}catch(Ye){tt(Ye)}}function ze(Pe){try{qe(Ue.throw(Pe))}catch(Ye){tt(Ye)}}function qe(Pe){var Ye;Pe.done?rt(Pe.value):(Ye=Pe.value,Ye instanceof Ke?Ye:new Ke(function($e){$e(Ye)})).then(at,ze)}qe((Ue=Ue.apply(ke,Le||[])).next())})};const Ae=ke=>be(void 0,[ke],void 0,function*({objective:Le,sectionName:Ke,behaviorTreeCode:Ue=null,btConstants:rt=null,apiKey:tt,characterId:at}){let ze=fe().apiKey,qe=fe().characterId;tt&&(ze=tt),at&&(qe=at);try{const Pe=yield fetch("https://api.convai.com/character/narrative/create-section",{method:"POST",headers:{"CONVAI-API-KEY":ze,"Content-Type":"application/json"},body:JSON.stringify({character_id:qe,objective:Le,section_name:Ke,updated_character_data:{},behavior_tree_code:Ue,bt_constants:rt})});if(!Pe.ok)throw new Error(`HTTP error! status : ${Pe.status}`);return yield Pe.json()}catch(Pe){throw Pe}}),ye=ke=>be(void 0,[ke],void 0,function*({updatedCharacterData:Le,sectionId:Ke,apiKey:Ue,characterId:rt}){let tt=fe().apiKey,at=fe().characterId;Ue&&(tt=Ue),rt&&(at=rt);try{const ze=yield fetch("https://api.convai.com/character/narrative/edit-section",{method:"POST",headers:{"CONVAI-API-KEY":tt,"Content-Type":"application/json"},body:JSON.stringify({character_id:at,section_id:Ke,updated_data:Le})});if(!ze.ok)throw new Error(`HTTP error! status : ${ze.status}`);return yield ze.json()}catch(ze){throw ze}}),ve=ke=>be(void 0,[ke],void 0,function*({sectionId:Le,apiKey:Ke,characterId:Ue}){let rt=fe().apiKey,tt=fe().characterId;Ke&&(rt=Ke),Ue&&(tt=Ue);try{const at=yield fetch("https://api.convai.com/character/narrative/get-section",{method:"POST",headers:{"CONVAI-API-KEY":rt,"Content-Type":"application/json"},body:JSON.stringify({character_id:tt,section_id:Le})});if(!at.ok)throw new Error(`HTTP error! status : ${at.status}`);return yield at.json()}catch(at){throw at}}),Be=ke=>be(void 0,[ke],void 0,function*({apiKey:Le,characterId:Ke}){let Ue=fe().apiKey,rt=fe().characterId;Le&&(Ue=Le),Ke&&(rt=Ke);try{const tt=yield fetch("https://api.convai.com/character/narrative/list-sections",{method:"POST",headers:{"CONVAI-API-KEY":Ue,"Content-Type":"application/json"},body:JSON.stringify({character_id:rt})});if(!tt.ok)throw new Error(`HTTP error! status : ${tt.status}`);return yield tt.json()}catch(tt){throw tt}}),Re=ke=>be(void 0,[ke],void 0,function*({sectionId:Le,apiKey:Ke,characterId:Ue}){let rt=fe().apiKey,tt=fe().characterId;Ke&&(rt=Ke),Ue&&(tt=Ue);try{const at=yield fetch("https://api.convai.com/character/narrative/delete-section",{method:"POST",headers:{"CONVAI-API-KEY":rt,"Content-Type":"application/json"},body:JSON.stringify({character_id:tt,section_id:Le})});if(!at.ok)throw new Error(`HTTP error! status : ${at.status}`);return yield at.json()}catch(at){throw at}}),Ve=ke=>be(void 0,[ke],void 0,function*({triggerName:Le,triggerMessage:Ke,destinationSection:Ue,apiKey:rt,characterId:tt}){let at=fe().apiKey,ze=fe().characterId;rt&&(at=rt),tt&&(ze=tt);try{const qe=yield fetch("https://api.convai.com/character/narrative/create-trigger",{method:"POST",headers:{"CONVAI-API-KEY":at,"Content-Type":"application/json"},body:JSON.stringify({character_id:ze,trigger_name:Le,trigger_message:Ke,destination_section:Ue})});if(!qe.ok)throw new Error(`HTTP error! status : ${qe.status}`);return yield qe.json()}catch(qe){throw qe}}),Ee=ke=>be(void 0,[ke],void 0,function*({triggerId:Le,updatedTriggerData:Ke,apiKey:Ue,characterId:rt}){let tt=fe().apiKey,at=fe().characterId;Ue&&(tt=Ue),rt&&(at=rt);try{const ze=yield fetch("https://api.convai.com/character/narrative/update-trigger",{method:"POST",headers:{"CONVAI-API-KEY":tt,"Content-Type":"application/json"},body:JSON.stringify({character_id:at,trigger_id:Le,updated_data:Ke})});if(!ze.ok)throw new Error(`HTTP error! status : ${ze.status}`);return yield ze.json()}catch(ze){throw ze}}),Ze=ke=>be(void 0,[ke],void 0,function*({triggerId:Le,apiKey:Ke,characterId:Ue}){let rt=fe().apiKey,tt=fe().characterId;Ke&&(rt=Ke),Ue&&(tt=Ue);try{const at=yield fetch("https://api.convai.com/character/narrative/delete-trigger",{method:"POST",headers:{"CONVAI-API-KEY":rt,"Content-Type":"application/json"},body:JSON.stringify({character_id:tt,trigger_id:Le})});if(!at.ok)throw new Error(`HTTP error! status : ${at.status}`);return yield at.json()}catch(at){throw at}}),_e=ke=>be(void 0,[ke],void 0,function*({triggerId:Le,apiKey:Ke,characterId:Ue}){let rt=fe().apiKey,tt=fe().characterId;Ke&&(rt=Ke),Ue&&(tt=Ue);try{const at=yield fetch("https://api.convai.com/character/narrative/get-trigger",{method:"POST",headers:{"CONVAI-API-KEY":rt,"Content-Type":"application/json"},body:JSON.stringify({character_id:tt,trigger_id:Le})});if(!at.ok)throw new Error(`HTTP error! status : ${at.status}`);return yield at.json()}catch(at){throw at}}),Fe=ke=>be(void 0,[ke],void 0,function*({apiKey:Le,characterId:Ke}){let Ue=fe().apiKey,rt=fe().characterId;Le&&(Ue=Le),Ke&&(rt=Ke);try{const tt=yield fetch("https://api.convai.com/character/narrative/list-triggers",{method:"POST",headers:{"CONVAI-API-KEY":Ue,"Content-Type":"application/json"},body:JSON.stringify({character_id:rt})});if(!tt.ok)throw new Error(`HTTP error! status : ${tt.status}`);return yield tt.json()}catch(tt){throw tt}});class Te{constructor(Le){this.apiKey=Le.apiKey,this.characterId=Le.characterId,this.speaker=Le.speaker,this.speakerId=Le.speakerId,this.enableAudio=Le.enableAudio,this.languageCode=Le.languageCode||"en-US",this.sessionId=Le.sessionId,this.disableAudioGeneration=!!Le.hasOwnProperty("textOnlyResponse")&&Le.textOnlyResponse,this.micUsage=!Le.hasOwnProperty("micUsage")||Le.micUsage,this.enableFacialData=!!Le.hasOwnProperty("enableFacialData")&&Le.enableFacialData,this.faceModel=Le.faceModel||3,this.narrativeTemplateKeysMap=Le.narrativeTemplateKeysMap,this.enableAddingChunk=this.micUsage,this.finalChunkReceived=!0,this.disableAudioGeneration&&(this.enableAudio=!1),this.actionConfig=null,this.enableAudio&&!this.disableAudioGeneration&&(this.audioPlayer=new Z(44100)),this.micUsage&&(this.audioRecorder=new _),console.warn=()=>{},this.convaiConfig={apiKey:this.apiKey,characterId:this.characterId,speaker:this.speaker,speakerId:this.speakerId,sessionId:this.sessionId,responseCallback:this.responseCallback,errorCallback:this.errorCallback,languageCode:this.languageCode,disableAudioGeneration:this.disableAudioGeneration,enableFacialData:this.enableFacialData,faceModel:this.faceModel,narrativeTemplateKeysMap:this.narrativeTemplateKeysMap,actionConfig:this.actionConfig}}validateBeforeRequest(){return this.responseCallback!=null}resetSession(){this.sessionId="-1",this.stopCharacterAudio()}setResponseCallback(Le){this.responseCallback=Ke=>{var Ue,rt,tt;Ke.getSessionId()!=""&&(this.sessionId=Ke.getSessionId(),this.convaiConfig.sessionId=this.sessionId),this.enableAudio&&!this.disableAudioGeneration&&Ke.hasAudioResponse()&&(this.enableAddingChunk&&!(!((Ue=Ke.getAudioResponse())===null||Ue===void 0)&&Ue.hasVisemesData())&&Ke.getAudioResponse().getAudioData_asU8().length&&this.audioPlayer.addChunk(Ke.getAudioResponse().getAudioData_asU8(),(tt=(rt=Ke==null?void 0:Ke.getAudioResponse())===null||rt===void 0?void 0:rt.getAudioConfig())===null||tt===void 0?void 0:tt.getSampleRateHertz()),Ke.getAudioResponse().getEndOfResponse()?(this.finalChunkReceived=!0,this.audioPlayer.addChunk(null)):this.finalChunkReceived=!1),this.enableAddingChunk&&Le(Ke)},this.convaiConfig.responseCallback=this.responseCallback,de(this.convaiConfig)}setErrorCallback(Le){this.errorCallback=(Ke,Ue,rt)=>{if(rt!=="0")switch(rt){case"2":case"10":case"11":case"13":case"12":case"14":this.convaiGrpcClient=fe(this.convaiConfig);break;default:Le(Ke,Ue,rt)}else Le(Ke,Ue,rt)},this.convaiConfig.errorCallback=this.errorCallback,de(this.convaiConfig)}sendTextChunk(Le){this.validateBeforeRequest()&&(this.enableAudio&&!this.disableAudioGeneration&&this.stopCharacterAudio(),de(this.convaiConfig),this.convaiGrpcClient=fe(this.convaiConfig),this.enableAudio&&!this.disableAudioGeneration&&(this.enableAddingChunk=!0,this.finalChunkReceived=!0),this.convaiGrpcClient.sendText(Le))}startAudioChunk(){var Le;this.validateBeforeRequest()&&this.micUsage==1&&(this.stopCharacterAudio(),de(this.convaiConfig),this.convaiGrpcClient=fe(this.convaiConfig),this.enableAddingChunk=!0,this.finalChunkReceived=!0,(Le=this.audioRecorder)===null||Le===void 0||Le.start(Ke=>{var Ue;(Ue=this.convaiGrpcClient)===null||Ue===void 0||Ue.sendAudioChunk(Ke)}))}invokeTrigger(Le,Ke=null,Ue){var rt;(Le||Ke)&&this.validateBeforeRequest()&&(this.stopCharacterAudio(),de(this.convaiConfig),this.convaiGrpcClient=fe(this.convaiConfig),this.finalChunkReceived=!0,Ue&&((rt=this.audioPlayer)===null||rt===void 0||rt.preload()),this.convaiGrpcClient.invokeTrigger(Le,Ke))}sendFeedback(Le,Ke,Ue,rt,tt){this.validateBeforeRequest()&&(de(this.convaiConfig),this.convaiGrpcClient=fe(this.convaiConfig),this.convaiGrpcClient.sendFeedback(Le,Ke,Ue,rt,tt))}endAudioChunk(){this.micUsage==1&&setTimeout(()=>{var Le,Ke;(Le=this.audioRecorder)===null||Le===void 0||Le.stop(),(Ke=this.convaiGrpcClient)===null||Ke===void 0||Ke.finishSend()},100)}toggleAudioVolume(){var Le,Ke,Ue;this.enableAudio&&this.audioPlayer&&(((Le=this.audioPlayer)===null||Le===void 0?void 0:Le.getVolume())===0?(Ke=this.audioPlayer)===null||Ke===void 0||Ke.setAudioVolume(1):(Ue=this.audioPlayer)===null||Ue===void 0||Ue.setAudioVolume(0))}getAudioVolume(){var Le;if(this.audioPlayer)return(Le=this.audioPlayer)===null||Le===void 0?void 0:Le.getVolume()}stopCharacterAudio(){var Le,Ke;this.enableAudio&&((Le=this.convaiGrpcClient)===null||Le===void 0||Le.close(),this.finalChunkReceived||(this.enableAddingChunk=!1),(Ke=this.audioPlayer)===null||Ke===void 0||Ke.stopAudio())}onAudioPlay(Le){var Ke;this.enableAudio&&((Ke=this.audioPlayer)===null||Ke===void 0||Ke.onPlayStart(Le))}onAudioStop(Le){var Ke;this.enableAudio&&((Ke=this.audioPlayer)===null||Ke===void 0||Ke.onPlayStop(Le))}pauseAudio(){var Le;this.enableAudio&&((Le=this.audioPlayer)===null||Le===void 0||Le.pauseAudio())}resumeAudio(){var Le;this.enableAudio&&((Le=this.audioPlayer)===null||Le===void 0||Le.resumeAudio())}onAudioStateChange(Le){var Ke;(Ke=this.audioPlayer)===null||Ke===void 0||Ke.onStateChange(Le)}playAudio(){var Le;this.enableAudio&&this.audioPlayer&&((Le=this.audioPlayer)===null||Le===void 0||Le.playAudio())}setActionConfig(Le){this.convaiConfig.actionConfig=Le,this.convaiGrpcClient=fe(this.convaiConfig)}}})(),__webpack_exports__})())}(convaiWebClient_umd$1)),convaiWebClient_umd$1.exports}var convaiWebClient_umdExports=requireConvaiWebClient_umd();function ChatInterface({characterId:X,setActiveScene:Z,isAvatarReady:_}){const[K,te]=reactExports.useState([]),[ne,ie]=reactExports.useState(""),[oe,se]=reactExports.useState(!1),ae=reactExports.useRef(null),ge=reactExports.useRef(null),ce=reactExports.useRef(null),de=reactExports.useRef(null),Ie=reactExports.useRef(""),fe=reactExports.useRef("");reactExports.useRef(!1);const[be,Ae]=reactExports.useState(!0),[ye,ve]=reactExports.useState(!1),[Be,Re]=reactExports.useState(!1),[Ve,Ee]=reactExports.useState("");reactExports.useState("");const[Ze,_e]=reactExports.useState(!1),[Fe,Te]=reactExports.useState(!1),[ke,Le]=reactExports.useState(""),[Ke,Ue]=reactExports.useState(!1),rt=reactExports.useRef([]),tt=reactExports.useRef(!1),at=reactExports.useRef(null),ze=reactExports.useRef([]),qe=reactExports.useRef(null),[Pe,Ye]=reactExports.useState(!1),$e=reactExports.useRef(null),ut=reactExports.useRef(null),ot=(Lt,Et)=>{var Zt,Ot,Tt;console.error(`Error in ${Et}:`,Lt);let Ut="Przepraszamy, wystąpił nieoczekiwany błąd. Spróbuj ponownie.";(Zt=Lt.message)!=null&&Zt.includes("permission")?Ut="Brak dostępu do mikrofonu! Kliknij ikonę kłódki w pasku przeglądarki i zezwól na dostęp.":(Ot=Lt.message)!=null&&Ot.includes("network")?Ut="Problem z połączeniem internetowym. Sprawdź swoje połączenie i spróbuj ponownie.":(Tt=Lt.message)!=null&&Tt.includes("audio")&&(Ut="Problem z systemem audio. Sprawdź czy Twój mikrofon działa poprawnie."),Le(Ut),te(Je=>[...Je,{text:Ut,sender:"error",timestamp:new Date().toISOString()}]),setTimeout(()=>{Le("")},5e3)},gt=()=>{if(rt.current.length===0){tt.current=!1;return}if(Ke){rt.current=[],tt.current=!1;return}tt.current=!0;const Lt=rt.current.shift();try{de.current&&typeof de.current.playAudio=="function"?de.current.playAudio(Lt):gt()}catch(Et){console.error("Błąd odtwarzania audio:",Et),gt()}},ht=()=>{ze.current.length>0&&(rt.current.push(...ze.current),ze.current=[],tt.current||gt())},dt=reactExports.useCallback(()=>{$e.current&&clearTimeout($e.current),ut.current&&clearTimeout(ut.current),de.current&&(typeof de.current.destroy=="function"?de.current.destroy():typeof de.current.close=="function"&&de.current.close(),de.current=null),te([]),ie(""),se(!1),_e(!1),Te(!1),Ie.current="",fe.current="",rt.current=[],tt.current=!1,at.current&&clearTimeout(at.current)},[]);reactExports.useEffect(()=>(dt(),X&&_&&(console.log("Initializing client for character:",X),$e.current=setTimeout(()=>{bt()},1e3)),dt),[X,_,dt]);const bt=async()=>{if(!(!X||!_)){Ye(!0);try{console.log("Creating new ConvaiClient instance");const Lt=new convaiWebClient_umdExports.ConvaiClient({apiKey:"2d12bd421e3af7ce47223bce45944908",characterId:X,enableAudio:!0,faceModal:3,enableFacialData:!0});ut.current=setTimeout(()=>{Fe||(ot(new Error("Timeout podczas łączenia z awatarem"),"Connection Timeout"),dt())},15e3),Lt.setResponseCallback(Et=>{if(ut.current&&(clearTimeout(ut.current),ut.current=null),Fe||(console.log("Client connected successfully"),Te(!0)),Et.hasUserQuery()){const Ut=Et.getUserQuery();Ut&&(Ie.current+=" "+Ut.getTextData(),Ut.getIsFinal()&&(te(Zt=>[...Zt,{text:Ie.current.trim(),sender:"user"}]),Ie.current="",qe.current=Date.now()))}if(Et.hasAudioResponse()){const Ut=Et.getAudioResponse(),Zt=Ut.getTextData();if(Zt&&Zt.trim()&&(fe.current+=" "+Zt,te(Ot=>{const Tt=Ot[Ot.length-1];if((Tt==null?void 0:Tt.sender)==="bot"){const Je=[...Ot];return Je[Ot.length-1]={text:fe.current.trim(),sender:"bot"},Je}return[...Ot,{text:fe.current.trim(),sender:"bot"}]}),se(!1),qe.current)){const Ot=Date.now()-qe.current;console.log(`Czas odpowiedzi: ${Ot}ms`),qe.current=null}if(Ut.array&&Ut.array[0]&&(ze.current.push(Ut.array[0]),at.current&&clearTimeout(at.current),at.current=setTimeout(()=>{ht()},Ke?50:200)),Ut.hasVisemesData()){const Ot=Ut.getVisemesData().array[0];Ot[0]!==-2&&(window.visemeData=window.visemeData||[],window.visemeData.push(Ot),window.visemeDataActive=!0,window.dispatchEvent(new Event("viseme-data-update")))}}}),Lt.onAudioPlay(()=>{window.dispatchEvent(new Event("avatar-talking-start"))}),Lt.onAudioStop(()=>{window.dispatchEvent(new Event("avatar-talking-end")),setTimeout(()=>{gt()},50)}),de.current=Lt,te([]),fe.current="",Ie.current="",_e(!1),Ye(!1)}catch(Lt){console.error("Error initializing client:",Lt),Ye(!1),ot(Lt,"Client Initialization"),dt()}}},Ht=async Lt=>{if(Lt==null||Lt.preventDefault(),!!ne.trim()){se(!0);try{if(te(Et=>[...Et,{text:ne,sender:"user"}]),!de.current)throw new Error("Połączenie z awatarem nie zostało ustanowione. Odśwież stronę i spróbuj ponownie.");qe.current=Date.now(),await de.current.sendTextChunk(ne),ie("")}catch(Et){ot(Et,"Send Text Message"),se(!1)}}},Dt=()=>{var Lt;(Lt=ae.current)==null||Lt.scrollIntoView({behavior:"smooth"})};reactExports.useEffect(()=>{Dt()},[K]);const Vt=async()=>{te([]),ie(""),se(!1),Ie.current="",fe.current="",rt.current=[],tt.current=!1;try{de.current&&(typeof de.current.destroy=="function"?de.current.destroy():typeof de.current.close=="function"&&de.current.close(),de.current=null),await bt()}catch(Lt){ot(Lt,"Refresh")}},mt=()=>{Ae(!be)},Ft=async()=>{try{if(Be||((await navigator.mediaDevices.getUserMedia({audio:!0})).getTracks().forEach(Et=>Et.stop()),Re(!0)),ye)ve(!1),setTimeout(()=>{de.current&&de.current.endAudioChunk()},100);else{if(!de.current)throw new Error("Połączenie z awatarem nie zostało ustanowione. Odśwież stronę i spróbuj ponownie.");Ee(""),ve(!0),Ie.current="",fe.current="",qe.current=Date.now(),de.current.startAudioChunk()}}catch(Lt){ot(Lt,"Microphone Access"),ve(!1),Re(!1)}};reactExports.useEffect(()=>{if(!Fe||!X)return;const Et=setTimeout(async()=>{if(de.current&&!Ze){se(!0);try{await de.current.sendTextChunk("Przywitaj się krótko i zapytaj w czym możesz pomóc"),_e(!0)}catch(Ut){ot(Ut,"Automatic Greeting"),se(!1)}}},1e3);return()=>clearTimeout(Et)},[Fe,X,Ze]);const it=()=>{Ue(!Ke),Ke||(rt.current=[],tt.current=!1)};return jsxRuntimeExports.jsx(Draggable,{nodeRef:ce,bounds:"body",cancel:".chat-input, .chat-send-button, .refresh-button",children:jsxRuntimeExports.jsxs("div",{ref:ce,className:"chat-interface",style:{height:be?"500px":"40px"},children:[jsxRuntimeExports.jsxs("div",{className:"chat-header",children:[jsxRuntimeExports.jsx("span",{children:"Chat"}),jsxRuntimeExports.jsxs("div",{className:"header-controls",children:[jsxRuntimeExports.jsx("button",{className:`fast-response-button ${Ke?"active":""}`,onClick:it,title:Ke?"Wyłącz tryb szybkiej odpowiedzi":"Włącz tryb szybkiej odpowiedzi",children:jsxRuntimeExports.jsx(MdSpeed,{})}),jsxRuntimeExports.jsx("button",{className:"refresh-button",onClick:Vt,title:"Odśwież czat",children:jsxRuntimeExports.jsx(MdRefresh,{})}),jsxRuntimeExports.jsx("div",{className:"expand-icon-container",onClick:mt,children:be?jsxRuntimeExports.jsx(MdExpandMore,{className:"expand-icon"}):jsxRuntimeExports.jsx(MdExpandLess,{className:"expand-icon"})}),jsxRuntimeExports.jsx("div",{className:"drag-handle",children:"⋮⋮"})]})]}),be&&jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsxs("div",{ref:ge,className:"chat-messages",children:[K.map((Lt,Et)=>jsxRuntimeExports.jsx("div",{className:`message ${Lt.sender} ${Lt.sender==="error"?"error-message":""}`,children:Lt.text},Et)),oe&&jsxRuntimeExports.jsx("div",{className:"message bot typing",children:jsxRuntimeExports.jsxs("div",{className:"typing-indicator",children:[jsxRuntimeExports.jsx("span",{}),jsxRuntimeExports.jsx("span",{}),jsxRuntimeExports.jsx("span",{})]})}),ye&&jsxRuntimeExports.jsxs("div",{className:"message user speech-preview",children:["Mów teraz...",jsxRuntimeExports.jsx("div",{className:"voice-wave"})]}),ke&&jsxRuntimeExports.jsx("div",{className:"message error-message fade-out",children:ke}),jsxRuntimeExports.jsx("div",{ref:ae})]}),jsxRuntimeExports.jsx("div",{className:"chat-controls",children:jsxRuntimeExports.jsxs("form",{onSubmit:Ht,className:"chat-input-form",children:[jsxRuntimeExports.jsx("button",{type:"button",className:`mic-button ${ye?"recording":""} ${ke?"error":""}`,onClick:Ft,title:ye?"Zatrzymaj nagrywanie":"Rozpocznij nagrywanie",disabled:!!ke,children:ye?jsxRuntimeExports.jsx(MdMicOff,{}):jsxRuntimeExports.jsx(MdMic,{})}),jsxRuntimeExports.jsx("input",{type:"text",value:ne,onChange:Lt=>ie(Lt.target.value),placeholder:"Napisz wiadomość...",className:"chat-input",disabled:!!ke}),jsxRuntimeExports.jsx("button",{type:"submit",className:"chat-send-button",title:"Wyślij",disabled:!!ke,children:jsxRuntimeExports.jsx(MdSend,{})})]})}),Pe&&jsxRuntimeExports.jsx("div",{className:"chat-loading",children:"Łączenie z awatarem..."})]})]})})}var events={exports:{}},R=typeof Reflect=="object"?Reflect:null,ReflectApply=R&&typeof R.apply=="function"?R.apply:function X(Z,_,K){return Function.prototype.apply.call(Z,_,K)},ReflectOwnKeys;R&&typeof R.ownKeys=="function"?ReflectOwnKeys=R.ownKeys:Object.getOwnPropertySymbols?ReflectOwnKeys=function(Z){return Object.getOwnPropertyNames(Z).concat(Object.getOwnPropertySymbols(Z))}:ReflectOwnKeys=function(Z){return Object.getOwnPropertyNames(Z)};function ProcessEmitWarning(X){console&&console.warn&&console.warn(X)}var NumberIsNaN=Number.isNaN||function X(Z){return Z!==Z};function EventEmitter(){EventEmitter.init.call(this)}events.exports=EventEmitter;events.exports.once=once;EventEmitter.EventEmitter=EventEmitter;EventEmitter.prototype._events=void 0;EventEmitter.prototype._eventsCount=0;EventEmitter.prototype._maxListeners=void 0;var defaultMaxListeners=10;function checkListener(X){if(typeof X!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof X)}Object.defineProperty(EventEmitter,"defaultMaxListeners",{enumerable:!0,get:function(){return defaultMaxListeners},set:function(X){if(typeof X!="number"||X<0||NumberIsNaN(X))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+X+".");defaultMaxListeners=X}});EventEmitter.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};EventEmitter.prototype.setMaxListeners=function X(Z){if(typeof Z!="number"||Z<0||NumberIsNaN(Z))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+Z+".");return this._maxListeners=Z,this};function _getMaxListeners(X){return X._maxListeners===void 0?EventEmitter.defaultMaxListeners:X._maxListeners}EventEmitter.prototype.getMaxListeners=function X(){return _getMaxListeners(this)};EventEmitter.prototype.emit=function X(Z){for(var _=[],K=1;K<arguments.length;K++)_.push(arguments[K]);var te=Z==="error",ne=this._events;if(ne!==void 0)te=te&&ne.error===void 0;else if(!te)return!1;if(te){var ie;if(_.length>0&&(ie=_[0]),ie instanceof Error)throw ie;var oe=new Error("Unhandled error."+(ie?" ("+ie.message+")":""));throw oe.context=ie,oe}var se=ne[Z];if(se===void 0)return!1;if(typeof se=="function")ReflectApply(se,this,_);else for(var ae=se.length,ge=arrayClone(se,ae),K=0;K<ae;++K)ReflectApply(ge[K],this,_);return!0};function _addListener(X,Z,_,K){var te,ne,ie;if(checkListener(_),ne=X._events,ne===void 0?(ne=X._events=Object.create(null),X._eventsCount=0):(ne.newListener!==void 0&&(X.emit("newListener",Z,_.listener?_.listener:_),ne=X._events),ie=ne[Z]),ie===void 0)ie=ne[Z]=_,++X._eventsCount;else if(typeof ie=="function"?ie=ne[Z]=K?[_,ie]:[ie,_]:K?ie.unshift(_):ie.push(_),te=_getMaxListeners(X),te>0&&ie.length>te&&!ie.warned){ie.warned=!0;var oe=new Error("Possible EventEmitter memory leak detected. "+ie.length+" "+String(Z)+" listeners added. Use emitter.setMaxListeners() to increase limit");oe.name="MaxListenersExceededWarning",oe.emitter=X,oe.type=Z,oe.count=ie.length,ProcessEmitWarning(oe)}return X}EventEmitter.prototype.addListener=function X(Z,_){return _addListener(this,Z,_,!1)};EventEmitter.prototype.on=EventEmitter.prototype.addListener;EventEmitter.prototype.prependListener=function X(Z,_){return _addListener(this,Z,_,!0)};function onceWrapper(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function _onceWrap(X,Z,_){var K={fired:!1,wrapFn:void 0,target:X,type:Z,listener:_},te=onceWrapper.bind(K);return te.listener=_,K.wrapFn=te,te}EventEmitter.prototype.once=function X(Z,_){return checkListener(_),this.on(Z,_onceWrap(this,Z,_)),this};EventEmitter.prototype.prependOnceListener=function X(Z,_){return checkListener(_),this.prependListener(Z,_onceWrap(this,Z,_)),this};EventEmitter.prototype.removeListener=function X(Z,_){var K,te,ne,ie,oe;if(checkListener(_),te=this._events,te===void 0)return this;if(K=te[Z],K===void 0)return this;if(K===_||K.listener===_)--this._eventsCount===0?this._events=Object.create(null):(delete te[Z],te.removeListener&&this.emit("removeListener",Z,K.listener||_));else if(typeof K!="function"){for(ne=-1,ie=K.length-1;ie>=0;ie--)if(K[ie]===_||K[ie].listener===_){oe=K[ie].listener,ne=ie;break}if(ne<0)return this;ne===0?K.shift():spliceOne(K,ne),K.length===1&&(te[Z]=K[0]),te.removeListener!==void 0&&this.emit("removeListener",Z,oe||_)}return this};EventEmitter.prototype.off=EventEmitter.prototype.removeListener;EventEmitter.prototype.removeAllListeners=function X(Z){var _,K,te;if(K=this._events,K===void 0)return this;if(K.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):K[Z]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete K[Z]),this;if(arguments.length===0){var ne=Object.keys(K),ie;for(te=0;te<ne.length;++te)ie=ne[te],ie!=="removeListener"&&this.removeAllListeners(ie);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(_=K[Z],typeof _=="function")this.removeListener(Z,_);else if(_!==void 0)for(te=_.length-1;te>=0;te--)this.removeListener(Z,_[te]);return this};function _listeners(X,Z,_){var K=X._events;if(K===void 0)return[];var te=K[Z];return te===void 0?[]:typeof te=="function"?_?[te.listener||te]:[te]:_?unwrapListeners(te):arrayClone(te,te.length)}EventEmitter.prototype.listeners=function X(Z){return _listeners(this,Z,!0)};EventEmitter.prototype.rawListeners=function X(Z){return _listeners(this,Z,!1)};EventEmitter.listenerCount=function(X,Z){return typeof X.listenerCount=="function"?X.listenerCount(Z):listenerCount.call(X,Z)};EventEmitter.prototype.listenerCount=listenerCount;function listenerCount(X){var Z=this._events;if(Z!==void 0){var _=Z[X];if(typeof _=="function")return 1;if(_!==void 0)return _.length}return 0}EventEmitter.prototype.eventNames=function X(){return this._eventsCount>0?ReflectOwnKeys(this._events):[]};function arrayClone(X,Z){for(var _=new Array(Z),K=0;K<Z;++K)_[K]=X[K];return _}function spliceOne(X,Z){for(;Z+1<X.length;Z++)X[Z]=X[Z+1];X.pop()}function unwrapListeners(X){for(var Z=new Array(X.length),_=0;_<Z.length;++_)Z[_]=X[_].listener||X[_];return Z}function once(X,Z){return new Promise(function(_,K){function te(ie){X.removeListener(Z,ne),K(ie)}function ne(){typeof X.removeListener=="function"&&X.removeListener("error",te),_([].slice.call(arguments))}eventTargetAgnosticAddListener(X,Z,ne,{once:!0}),Z!=="error"&&addErrorHandlerIfEventEmitter(X,te,{once:!0})})}function addErrorHandlerIfEventEmitter(X,Z,_){typeof X.on=="function"&&eventTargetAgnosticAddListener(X,"error",Z,_)}function eventTargetAgnosticAddListener(X,Z,_,K){if(typeof X.on=="function")K.once?X.once(Z,_):X.on(Z,_);else if(typeof X.addEventListener=="function")X.addEventListener(Z,function te(ne){K.once&&X.removeEventListener(Z,te),_(ne)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof X)}var EventEmitter$1=events.exports;function decodeBase64(X,Z){var _=atob(X);return _}function createURL(X,Z,_){var K=decodeBase64(X),te=K.indexOf(`
`,10)+1,ne=K.substring(te)+"",ie=new Blob([ne],{type:"application/javascript"});return URL.createObjectURL(ie)}function createBase64WorkerFactory(X,Z,_){var K;return function(ne){return K=K||createURL(X),new Worker(K,ne)}}var WorkerFactory=createBase64WorkerFactory("Lyogcm9sbHVwLXBsdWdpbi13ZWItd29ya2VyLWxvYWRlciAqLwooZnVuY3Rpb24gKCkgewogICd1c2Ugc3RyaWN0JzsKCiAgLyoqCiAgICogUmVjb3JkcyB3aGF0IG9iamVjdHMgYXJlIGNvbGxpZGluZyB3aXRoIGVhY2ggb3RoZXIKICAgKi8KCiAgLyoqCiAgICogQSAzeDMgbWF0cml4LgogICAqIEF1dGhvcmVkIGJ5IHtAbGluayBodHRwOi8vZ2l0aHViLmNvbS9zY2h0ZXBwZS8gc2NodGVwcGV9CiAgICovCiAgY2xhc3MgTWF0MyB7CiAgICAvKioKICAgICAqIEEgdmVjdG9yIG9mIGxlbmd0aCA5LCBjb250YWluaW5nIGFsbCBtYXRyaXggZWxlbWVudHMuCiAgICAgKi8KCiAgICAvKioKICAgICAqIEBwYXJhbSBlbGVtZW50cyBBIHZlY3RvciBvZiBsZW5ndGggOSwgY29udGFpbmluZyBhbGwgbWF0cml4IGVsZW1lbnRzLgogICAgICovCiAgICBjb25zdHJ1Y3RvcihlbGVtZW50cykgewogICAgICBpZiAoZWxlbWVudHMgPT09IHZvaWQgMCkgewogICAgICAgIGVsZW1lbnRzID0gWzAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDBdOwogICAgICB9CgogICAgICB0aGlzLmVsZW1lbnRzID0gZWxlbWVudHM7CiAgICB9CiAgICAvKioKICAgICAqIFNldHMgdGhlIG1hdHJpeCB0byBpZGVudGl0eQogICAgICogQHRvZG8gU2hvdWxkIHBlcmhhcHMgYmUgcmVuYW1lZCB0byBgc2V0SWRlbnRpdHkoKWAgdG8gYmUgbW9yZSBjbGVhci4KICAgICAqIEB0b2RvIENyZWF0ZSBhbm90aGVyIGZ1bmN0aW9uIHRoYXQgaW1tZWRpYXRlbHkgY3JlYXRlcyBhbiBpZGVudGl0eSBtYXRyaXggZWcuIGBleWUoKWAKICAgICAqLwoKCiAgICBpZGVudGl0eSgpIHsKICAgICAgY29uc3QgZSA9IHRoaXMuZWxlbWVudHM7CiAgICAgIGVbMF0gPSAxOwogICAgICBlWzFdID0gMDsKICAgICAgZVsyXSA9IDA7CiAgICAgIGVbM10gPSAwOwogICAgICBlWzRdID0gMTsKICAgICAgZVs1XSA9IDA7CiAgICAgIGVbNl0gPSAwOwogICAgICBlWzddID0gMDsKICAgICAgZVs4XSA9IDE7CiAgICB9CiAgICAvKioKICAgICAqIFNldCBhbGwgZWxlbWVudHMgdG8gemVybwogICAgICovCgoKICAgIHNldFplcm8oKSB7CiAgICAgIGNvbnN0IGUgPSB0aGlzLmVsZW1lbnRzOwogICAgICBlWzBdID0gMDsKICAgICAgZVsxXSA9IDA7CiAgICAgIGVbMl0gPSAwOwogICAgICBlWzNdID0gMDsKICAgICAgZVs0XSA9IDA7CiAgICAgIGVbNV0gPSAwOwogICAgICBlWzZdID0gMDsKICAgICAgZVs3XSA9IDA7CiAgICAgIGVbOF0gPSAwOwogICAgfQogICAgLyoqCiAgICAgKiBTZXRzIHRoZSBtYXRyaXggZGlhZ29uYWwgZWxlbWVudHMgZnJvbSBhIFZlYzMKICAgICAqLwoKCiAgICBzZXRUcmFjZSh2ZWN0b3IpIHsKICAgICAgY29uc3QgZSA9IHRoaXMuZWxlbWVudHM7CiAgICAgIGVbMF0gPSB2ZWN0b3IueDsKICAgICAgZVs0XSA9IHZlY3Rvci55OwogICAgICBlWzhdID0gdmVjdG9yLno7CiAgICB9CiAgICAvKioKICAgICAqIEdldHMgdGhlIG1hdHJpeCBkaWFnb25hbCBlbGVtZW50cwogICAgICovCgoKICAgIGdldFRyYWNlKHRhcmdldCkgewogICAgICBpZiAodGFyZ2V0ID09PSB2b2lkIDApIHsKICAgICAgICB0YXJnZXQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICBjb25zdCBlID0gdGhpcy5lbGVtZW50czsKICAgICAgdGFyZ2V0LnggPSBlWzBdOwogICAgICB0YXJnZXQueSA9IGVbNF07CiAgICAgIHRhcmdldC56ID0gZVs4XTsKICAgICAgcmV0dXJuIHRhcmdldDsKICAgIH0KICAgIC8qKgogICAgICogTWF0cml4LVZlY3RvciBtdWx0aXBsaWNhdGlvbgogICAgICogQHBhcmFtIHYgVGhlIHZlY3RvciB0byBtdWx0aXBseSB3aXRoCiAgICAgKiBAcGFyYW0gdGFyZ2V0IE9wdGlvbmFsLCB0YXJnZXQgdG8gc2F2ZSB0aGUgcmVzdWx0IGluLgogICAgICovCgoKICAgIHZtdWx0KHYsIHRhcmdldCkgewogICAgICBpZiAodGFyZ2V0ID09PSB2b2lkIDApIHsKICAgICAgICB0YXJnZXQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICBjb25zdCBlID0gdGhpcy5lbGVtZW50czsKICAgICAgY29uc3QgeCA9IHYueDsKICAgICAgY29uc3QgeSA9IHYueTsKICAgICAgY29uc3QgeiA9IHYuejsKICAgICAgdGFyZ2V0LnggPSBlWzBdICogeCArIGVbMV0gKiB5ICsgZVsyXSAqIHo7CiAgICAgIHRhcmdldC55ID0gZVszXSAqIHggKyBlWzRdICogeSArIGVbNV0gKiB6OwogICAgICB0YXJnZXQueiA9IGVbNl0gKiB4ICsgZVs3XSAqIHkgKyBlWzhdICogejsKICAgICAgcmV0dXJuIHRhcmdldDsKICAgIH0KICAgIC8qKgogICAgICogTWF0cml4LXNjYWxhciBtdWx0aXBsaWNhdGlvbgogICAgICovCgoKICAgIHNtdWx0KHMpIHsKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLmVsZW1lbnRzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgdGhpcy5lbGVtZW50c1tpXSAqPSBzOwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIE1hdHJpeCBtdWx0aXBsaWNhdGlvbgogICAgICogQHBhcmFtIG1hdHJpeCBNYXRyaXggdG8gbXVsdGlwbHkgd2l0aCBmcm9tIGxlZnQgc2lkZS4KICAgICAqLwoKCiAgICBtbXVsdChtYXRyaXgsIHRhcmdldCkgewogICAgICBpZiAodGFyZ2V0ID09PSB2b2lkIDApIHsKICAgICAgICB0YXJnZXQgPSBuZXcgTWF0MygpOwogICAgICB9CgogICAgICBjb25zdCBBID0gdGhpcy5lbGVtZW50czsKICAgICAgY29uc3QgQiA9IG1hdHJpeC5lbGVtZW50czsKICAgICAgY29uc3QgVCA9IHRhcmdldC5lbGVtZW50czsKICAgICAgY29uc3QgYTExID0gQVswXSwKICAgICAgICAgICAgYTEyID0gQVsxXSwKICAgICAgICAgICAgYTEzID0gQVsyXSwKICAgICAgICAgICAgYTIxID0gQVszXSwKICAgICAgICAgICAgYTIyID0gQVs0XSwKICAgICAgICAgICAgYTIzID0gQVs1XSwKICAgICAgICAgICAgYTMxID0gQVs2XSwKICAgICAgICAgICAgYTMyID0gQVs3XSwKICAgICAgICAgICAgYTMzID0gQVs4XTsKICAgICAgY29uc3QgYjExID0gQlswXSwKICAgICAgICAgICAgYjEyID0gQlsxXSwKICAgICAgICAgICAgYjEzID0gQlsyXSwKICAgICAgICAgICAgYjIxID0gQlszXSwKICAgICAgICAgICAgYjIyID0gQls0XSwKICAgICAgICAgICAgYjIzID0gQls1XSwKICAgICAgICAgICAgYjMxID0gQls2XSwKICAgICAgICAgICAgYjMyID0gQls3XSwKICAgICAgICAgICAgYjMzID0gQls4XTsKICAgICAgVFswXSA9IGExMSAqIGIxMSArIGExMiAqIGIyMSArIGExMyAqIGIzMTsKICAgICAgVFsxXSA9IGExMSAqIGIxMiArIGExMiAqIGIyMiArIGExMyAqIGIzMjsKICAgICAgVFsyXSA9IGExMSAqIGIxMyArIGExMiAqIGIyMyArIGExMyAqIGIzMzsKICAgICAgVFszXSA9IGEyMSAqIGIxMSArIGEyMiAqIGIyMSArIGEyMyAqIGIzMTsKICAgICAgVFs0XSA9IGEyMSAqIGIxMiArIGEyMiAqIGIyMiArIGEyMyAqIGIzMjsKICAgICAgVFs1XSA9IGEyMSAqIGIxMyArIGEyMiAqIGIyMyArIGEyMyAqIGIzMzsKICAgICAgVFs2XSA9IGEzMSAqIGIxMSArIGEzMiAqIGIyMSArIGEzMyAqIGIzMTsKICAgICAgVFs3XSA9IGEzMSAqIGIxMiArIGEzMiAqIGIyMiArIGEzMyAqIGIzMjsKICAgICAgVFs4XSA9IGEzMSAqIGIxMyArIGEzMiAqIGIyMyArIGEzMyAqIGIzMzsKICAgICAgcmV0dXJuIHRhcmdldDsKICAgIH0KICAgIC8qKgogICAgICogU2NhbGUgZWFjaCBjb2x1bW4gb2YgdGhlIG1hdHJpeAogICAgICovCgoKICAgIHNjYWxlKHZlY3RvciwgdGFyZ2V0KSB7CiAgICAgIGlmICh0YXJnZXQgPT09IHZvaWQgMCkgewogICAgICAgIHRhcmdldCA9IG5ldyBNYXQzKCk7CiAgICAgIH0KCiAgICAgIGNvbnN0IGUgPSB0aGlzLmVsZW1lbnRzOwogICAgICBjb25zdCB0ID0gdGFyZ2V0LmVsZW1lbnRzOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IDM7IGkrKykgewogICAgICAgIHRbMyAqIGkgKyAwXSA9IHZlY3Rvci54ICogZVszICogaSArIDBdOwogICAgICAgIHRbMyAqIGkgKyAxXSA9IHZlY3Rvci55ICogZVszICogaSArIDFdOwogICAgICAgIHRbMyAqIGkgKyAyXSA9IHZlY3Rvci56ICogZVszICogaSArIDJdOwogICAgICB9CgogICAgICByZXR1cm4gdGFyZ2V0OwogICAgfQogICAgLyoqCiAgICAgKiBTb2x2ZSBBeD1iCiAgICAgKiBAcGFyYW0gYiBUaGUgcmlnaHQgaGFuZCBzaWRlCiAgICAgKiBAcGFyYW0gdGFyZ2V0IE9wdGlvbmFsLiBUYXJnZXQgdmVjdG9yIHRvIHNhdmUgaW4uCiAgICAgKiBAcmV0dXJuIFRoZSBzb2x1dGlvbiB4CiAgICAgKiBAdG9kbyBzaG91bGQgcmV1c2UgYXJyYXlzCiAgICAgKi8KCgogICAgc29sdmUoYiwgdGFyZ2V0KSB7CiAgICAgIGlmICh0YXJnZXQgPT09IHZvaWQgMCkgewogICAgICAgIHRhcmdldCA9IG5ldyBWZWMzKCk7CiAgICAgIH0KCiAgICAgIC8vIENvbnN0cnVjdCBlcXVhdGlvbnMKICAgICAgY29uc3QgbnIgPSAzOyAvLyBudW0gcm93cwoKICAgICAgY29uc3QgbmMgPSA0OyAvLyBudW0gY29scwoKICAgICAgY29uc3QgZXFucyA9IFtdOwogICAgICBsZXQgaTsKICAgICAgbGV0IGo7CgogICAgICBmb3IgKGkgPSAwOyBpIDwgbnIgKiBuYzsgaSsrKSB7CiAgICAgICAgZXFucy5wdXNoKDApOwogICAgICB9CgogICAgICBmb3IgKGkgPSAwOyBpIDwgMzsgaSsrKSB7CiAgICAgICAgZm9yIChqID0gMDsgaiA8IDM7IGorKykgewogICAgICAgICAgZXFuc1tpICsgbmMgKiBqXSA9IHRoaXMuZWxlbWVudHNbaSArIDMgKiBqXTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIGVxbnNbMyArIDQgKiAwXSA9IGIueDsKICAgICAgZXFuc1szICsgNCAqIDFdID0gYi55OwogICAgICBlcW5zWzMgKyA0ICogMl0gPSBiLno7IC8vIENvbXB1dGUgcmlnaHQgdXBwZXIgdHJpYW5ndWxhciB2ZXJzaW9uIG9mIHRoZSBtYXRyaXggLSBHYXVzcyBlbGltaW5hdGlvbgoKICAgICAgbGV0IG4gPSAzOwogICAgICBjb25zdCBrID0gbjsKICAgICAgbGV0IG5wOwogICAgICBjb25zdCBrcCA9IDQ7IC8vIG51bSByb3dzCgogICAgICBsZXQgcDsKCiAgICAgIGRvIHsKICAgICAgICBpID0gayAtIG47CgogICAgICAgIGlmIChlcW5zW2kgKyBuYyAqIGldID09PSAwKSB7CiAgICAgICAgICAvLyB0aGUgcGl2b3QgaXMgbnVsbCwgc3dhcCBsaW5lcwogICAgICAgICAgZm9yIChqID0gaSArIDE7IGogPCBrOyBqKyspIHsKICAgICAgICAgICAgaWYgKGVxbnNbaSArIG5jICogal0gIT09IDApIHsKICAgICAgICAgICAgICBucCA9IGtwOwoKICAgICAgICAgICAgICBkbyB7CiAgICAgICAgICAgICAgICAvLyBkbyBsaWduZSggaSApID0gbGlnbmUoIGkgKSArIGxpZ25lKCBrICkKICAgICAgICAgICAgICAgIHAgPSBrcCAtIG5wOwogICAgICAgICAgICAgICAgZXFuc1twICsgbmMgKiBpXSArPSBlcW5zW3AgKyBuYyAqIGpdOwogICAgICAgICAgICAgIH0gd2hpbGUgKC0tbnApOwoKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgaWYgKGVxbnNbaSArIG5jICogaV0gIT09IDApIHsKICAgICAgICAgIGZvciAoaiA9IGkgKyAxOyBqIDwgazsgaisrKSB7CiAgICAgICAgICAgIGNvbnN0IG11bHRpcGxpZXIgPSBlcW5zW2kgKyBuYyAqIGpdIC8gZXFuc1tpICsgbmMgKiBpXTsKICAgICAgICAgICAgbnAgPSBrcDsKCiAgICAgICAgICAgIGRvIHsKICAgICAgICAgICAgICAvLyBkbyBsaWduZSggayApID0gbGlnbmUoIGsgKSAtIG11bHRpcGxpZXIgKiBsaWduZSggaSApCiAgICAgICAgICAgICAgcCA9IGtwIC0gbnA7CiAgICAgICAgICAgICAgZXFuc1twICsgbmMgKiBqXSA9IHAgPD0gaSA/IDAgOiBlcW5zW3AgKyBuYyAqIGpdIC0gZXFuc1twICsgbmMgKiBpXSAqIG11bHRpcGxpZXI7CiAgICAgICAgICAgIH0gd2hpbGUgKC0tbnApOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSB3aGlsZSAoLS1uKTsgLy8gR2V0IHRoZSBzb2x1dGlvbgoKCiAgICAgIHRhcmdldC56ID0gZXFuc1syICogbmMgKyAzXSAvIGVxbnNbMiAqIG5jICsgMl07CiAgICAgIHRhcmdldC55ID0gKGVxbnNbMSAqIG5jICsgM10gLSBlcW5zWzEgKiBuYyArIDJdICogdGFyZ2V0LnopIC8gZXFuc1sxICogbmMgKyAxXTsKICAgICAgdGFyZ2V0LnggPSAoZXFuc1swICogbmMgKyAzXSAtIGVxbnNbMCAqIG5jICsgMl0gKiB0YXJnZXQueiAtIGVxbnNbMCAqIG5jICsgMV0gKiB0YXJnZXQueSkgLyBlcW5zWzAgKiBuYyArIDBdOwoKICAgICAgaWYgKGlzTmFOKHRhcmdldC54KSB8fCBpc05hTih0YXJnZXQueSkgfHwgaXNOYU4odGFyZ2V0LnopIHx8IHRhcmdldC54ID09PSBJbmZpbml0eSB8fCB0YXJnZXQueSA9PT0gSW5maW5pdHkgfHwgdGFyZ2V0LnogPT09IEluZmluaXR5KSB7CiAgICAgICAgdGhyb3cgYENvdWxkIG5vdCBzb2x2ZSBlcXVhdGlvbiEgR290IHg9WyR7dGFyZ2V0LnRvU3RyaW5nKCl9XSwgYj1bJHtiLnRvU3RyaW5nKCl9XSwgQT1bJHt0aGlzLnRvU3RyaW5nKCl9XWA7CiAgICAgIH0KCiAgICAgIHJldHVybiB0YXJnZXQ7CiAgICB9CiAgICAvKioKICAgICAqIEdldCBhbiBlbGVtZW50IGluIHRoZSBtYXRyaXggYnkgaW5kZXguIEluZGV4IHN0YXJ0cyBhdCAwLCBub3QgMSEhIQogICAgICogQHBhcmFtIHZhbHVlIElmIHByb3ZpZGVkLCB0aGUgbWF0cml4IGVsZW1lbnQgd2lsbCBiZSBzZXQgdG8gdGhpcyB2YWx1ZS4KICAgICAqLwoKCiAgICBlKHJvdywgY29sdW1uLCB2YWx1ZSkgewogICAgICBpZiAodmFsdWUgPT09IHVuZGVmaW5lZCkgewogICAgICAgIHJldHVybiB0aGlzLmVsZW1lbnRzW2NvbHVtbiArIDMgKiByb3ddOwogICAgICB9IGVsc2UgewogICAgICAgIC8vIFNldCB2YWx1ZQogICAgICAgIHRoaXMuZWxlbWVudHNbY29sdW1uICsgMyAqIHJvd10gPSB2YWx1ZTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBDb3B5IGFub3RoZXIgbWF0cml4IGludG8gdGhpcyBtYXRyaXggb2JqZWN0LgogICAgICovCgoKICAgIGNvcHkobWF0cml4KSB7CiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbWF0cml4LmVsZW1lbnRzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgdGhpcy5lbGVtZW50c1tpXSA9IG1hdHJpeC5lbGVtZW50c1tpXTsKICAgICAgfQoKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICAvKioKICAgICAqIFJldHVybnMgYSBzdHJpbmcgcmVwcmVzZW50YXRpb24gb2YgdGhlIG1hdHJpeC4KICAgICAqLwoKCiAgICB0b1N0cmluZygpIHsKICAgICAgbGV0IHIgPSAnJzsKICAgICAgY29uc3Qgc2VwID0gJywnOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCA5OyBpKyspIHsKICAgICAgICByICs9IHRoaXMuZWxlbWVudHNbaV0gKyBzZXA7CiAgICAgIH0KCiAgICAgIHJldHVybiByOwogICAgfQogICAgLyoqCiAgICAgKiByZXZlcnNlIHRoZSBtYXRyaXgKICAgICAqIEBwYXJhbSB0YXJnZXQgVGFyZ2V0IG1hdHJpeCB0byBzYXZlIGluLgogICAgICogQHJldHVybiBUaGUgc29sdXRpb24geAogICAgICovCgoKICAgIHJldmVyc2UodGFyZ2V0KSB7CiAgICAgIGlmICh0YXJnZXQgPT09IHZvaWQgMCkgewogICAgICAgIHRhcmdldCA9IG5ldyBNYXQzKCk7CiAgICAgIH0KCiAgICAgIC8vIENvbnN0cnVjdCBlcXVhdGlvbnMKICAgICAgY29uc3QgbnIgPSAzOyAvLyBudW0gcm93cwoKICAgICAgY29uc3QgbmMgPSA2OyAvLyBudW0gY29scwoKICAgICAgY29uc3QgZXFucyA9IHJldmVyc2VfZXFuczsKICAgICAgbGV0IGk7CiAgICAgIGxldCBqOwoKICAgICAgZm9yIChpID0gMDsgaSA8IDM7IGkrKykgewogICAgICAgIGZvciAoaiA9IDA7IGogPCAzOyBqKyspIHsKICAgICAgICAgIGVxbnNbaSArIG5jICogal0gPSB0aGlzLmVsZW1lbnRzW2kgKyAzICogal07CiAgICAgICAgfQogICAgICB9CgogICAgICBlcW5zWzMgKyA2ICogMF0gPSAxOwogICAgICBlcW5zWzMgKyA2ICogMV0gPSAwOwogICAgICBlcW5zWzMgKyA2ICogMl0gPSAwOwogICAgICBlcW5zWzQgKyA2ICogMF0gPSAwOwogICAgICBlcW5zWzQgKyA2ICogMV0gPSAxOwogICAgICBlcW5zWzQgKyA2ICogMl0gPSAwOwogICAgICBlcW5zWzUgKyA2ICogMF0gPSAwOwogICAgICBlcW5zWzUgKyA2ICogMV0gPSAwOwogICAgICBlcW5zWzUgKyA2ICogMl0gPSAxOyAvLyBDb21wdXRlIHJpZ2h0IHVwcGVyIHRyaWFuZ3VsYXIgdmVyc2lvbiBvZiB0aGUgbWF0cml4IC0gR2F1c3MgZWxpbWluYXRpb24KCiAgICAgIGxldCBuID0gMzsKICAgICAgY29uc3QgayA9IG47CiAgICAgIGxldCBucDsKICAgICAgY29uc3Qga3AgPSBuYzsgLy8gbnVtIHJvd3MKCiAgICAgIGxldCBwOwoKICAgICAgZG8gewogICAgICAgIGkgPSBrIC0gbjsKCiAgICAgICAgaWYgKGVxbnNbaSArIG5jICogaV0gPT09IDApIHsKICAgICAgICAgIC8vIHRoZSBwaXZvdCBpcyBudWxsLCBzd2FwIGxpbmVzCiAgICAgICAgICBmb3IgKGogPSBpICsgMTsgaiA8IGs7IGorKykgewogICAgICAgICAgICBpZiAoZXFuc1tpICsgbmMgKiBqXSAhPT0gMCkgewogICAgICAgICAgICAgIG5wID0ga3A7CgogICAgICAgICAgICAgIGRvIHsKICAgICAgICAgICAgICAgIC8vIGRvIGxpbmUoIGkgKSA9IGxpbmUoIGkgKSArIGxpbmUoIGsgKQogICAgICAgICAgICAgICAgcCA9IGtwIC0gbnA7CiAgICAgICAgICAgICAgICBlcW5zW3AgKyBuYyAqIGldICs9IGVxbnNbcCArIG5jICogal07CiAgICAgICAgICAgICAgfSB3aGlsZSAoLS1ucCk7CgogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBpZiAoZXFuc1tpICsgbmMgKiBpXSAhPT0gMCkgewogICAgICAgICAgZm9yIChqID0gaSArIDE7IGogPCBrOyBqKyspIHsKICAgICAgICAgICAgY29uc3QgbXVsdGlwbGllciA9IGVxbnNbaSArIG5jICogal0gLyBlcW5zW2kgKyBuYyAqIGldOwogICAgICAgICAgICBucCA9IGtwOwoKICAgICAgICAgICAgZG8gewogICAgICAgICAgICAgIC8vIGRvIGxpbmUoIGsgKSA9IGxpbmUoIGsgKSAtIG11bHRpcGxpZXIgKiBsaW5lKCBpICkKICAgICAgICAgICAgICBwID0ga3AgLSBucDsKICAgICAgICAgICAgICBlcW5zW3AgKyBuYyAqIGpdID0gcCA8PSBpID8gMCA6IGVxbnNbcCArIG5jICogal0gLSBlcW5zW3AgKyBuYyAqIGldICogbXVsdGlwbGllcjsKICAgICAgICAgICAgfSB3aGlsZSAoLS1ucCk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9IHdoaWxlICgtLW4pOyAvLyBlbGltaW5hdGUgdGhlIHVwcGVyIGxlZnQgdHJpYW5nbGUgb2YgdGhlIG1hdHJpeAoKCiAgICAgIGkgPSAyOwoKICAgICAgZG8gewogICAgICAgIGogPSBpIC0gMTsKCiAgICAgICAgZG8gewogICAgICAgICAgY29uc3QgbXVsdGlwbGllciA9IGVxbnNbaSArIG5jICogal0gLyBlcW5zW2kgKyBuYyAqIGldOwogICAgICAgICAgbnAgPSBuYzsKCiAgICAgICAgICBkbyB7CiAgICAgICAgICAgIHAgPSBuYyAtIG5wOwogICAgICAgICAgICBlcW5zW3AgKyBuYyAqIGpdID0gZXFuc1twICsgbmMgKiBqXSAtIGVxbnNbcCArIG5jICogaV0gKiBtdWx0aXBsaWVyOwogICAgICAgICAgfSB3aGlsZSAoLS1ucCk7CiAgICAgICAgfSB3aGlsZSAoai0tKTsKICAgICAgfSB3aGlsZSAoLS1pKTsgLy8gb3BlcmF0aW9ucyBvbiB0aGUgZGlhZ29uYWwKCgogICAgICBpID0gMjsKCiAgICAgIGRvIHsKICAgICAgICBjb25zdCBtdWx0aXBsaWVyID0gMSAvIGVxbnNbaSArIG5jICogaV07CiAgICAgICAgbnAgPSBuYzsKCiAgICAgICAgZG8gewogICAgICAgICAgcCA9IG5jIC0gbnA7CiAgICAgICAgICBlcW5zW3AgKyBuYyAqIGldID0gZXFuc1twICsgbmMgKiBpXSAqIG11bHRpcGxpZXI7CiAgICAgICAgfSB3aGlsZSAoLS1ucCk7CiAgICAgIH0gd2hpbGUgKGktLSk7CgogICAgICBpID0gMjsKCiAgICAgIGRvIHsKICAgICAgICBqID0gMjsKCiAgICAgICAgZG8gewogICAgICAgICAgcCA9IGVxbnNbbnIgKyBqICsgbmMgKiBpXTsKCiAgICAgICAgICBpZiAoaXNOYU4ocCkgfHwgcCA9PT0gSW5maW5pdHkpIHsKICAgICAgICAgICAgdGhyb3cgYENvdWxkIG5vdCByZXZlcnNlISBBPVske3RoaXMudG9TdHJpbmcoKX1dYDsKICAgICAgICAgIH0KCiAgICAgICAgICB0YXJnZXQuZShpLCBqLCBwKTsKICAgICAgICB9IHdoaWxlIChqLS0pOwogICAgICB9IHdoaWxlIChpLS0pOwoKICAgICAgcmV0dXJuIHRhcmdldDsKICAgIH0KICAgIC8qKgogICAgICogU2V0IHRoZSBtYXRyaXggZnJvbSBhIHF1YXRlcmlvbgogICAgICovCgoKICAgIHNldFJvdGF0aW9uRnJvbVF1YXRlcm5pb24ocSkgewogICAgICBjb25zdCB4ID0gcS54OwogICAgICBjb25zdCB5ID0gcS55OwogICAgICBjb25zdCB6ID0gcS56OwogICAgICBjb25zdCB3ID0gcS53OwogICAgICBjb25zdCB4MiA9IHggKyB4OwogICAgICBjb25zdCB5MiA9IHkgKyB5OwogICAgICBjb25zdCB6MiA9IHogKyB6OwogICAgICBjb25zdCB4eCA9IHggKiB4MjsKICAgICAgY29uc3QgeHkgPSB4ICogeTI7CiAgICAgIGNvbnN0IHh6ID0geCAqIHoyOwogICAgICBjb25zdCB5eSA9IHkgKiB5MjsKICAgICAgY29uc3QgeXogPSB5ICogejI7CiAgICAgIGNvbnN0IHp6ID0geiAqIHoyOwogICAgICBjb25zdCB3eCA9IHcgKiB4MjsKICAgICAgY29uc3Qgd3kgPSB3ICogeTI7CiAgICAgIGNvbnN0IHd6ID0gdyAqIHoyOwogICAgICBjb25zdCBlID0gdGhpcy5lbGVtZW50czsKICAgICAgZVszICogMCArIDBdID0gMSAtICh5eSArIHp6KTsKICAgICAgZVszICogMCArIDFdID0geHkgLSB3ejsKICAgICAgZVszICogMCArIDJdID0geHogKyB3eTsKICAgICAgZVszICogMSArIDBdID0geHkgKyB3ejsKICAgICAgZVszICogMSArIDFdID0gMSAtICh4eCArIHp6KTsKICAgICAgZVszICogMSArIDJdID0geXogLSB3eDsKICAgICAgZVszICogMiArIDBdID0geHogLSB3eTsKICAgICAgZVszICogMiArIDFdID0geXogKyB3eDsKICAgICAgZVszICogMiArIDJdID0gMSAtICh4eCArIHl5KTsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICAvKioKICAgICAqIFRyYW5zcG9zZSB0aGUgbWF0cml4CiAgICAgKiBAcGFyYW0gdGFyZ2V0IE9wdGlvbmFsLiBXaGVyZSB0byBzdG9yZSB0aGUgcmVzdWx0LgogICAgICogQHJldHVybiBUaGUgdGFyZ2V0IE1hdDMsIG9yIGEgbmV3IE1hdDMgaWYgdGFyZ2V0IHdhcyBvbWl0dGVkLgogICAgICovCgoKICAgIHRyYW5zcG9zZSh0YXJnZXQpIHsKICAgICAgaWYgKHRhcmdldCA9PT0gdm9pZCAwKSB7CiAgICAgICAgdGFyZ2V0ID0gbmV3IE1hdDMoKTsKICAgICAgfQoKICAgICAgY29uc3QgTSA9IHRoaXMuZWxlbWVudHM7CiAgICAgIGNvbnN0IFQgPSB0YXJnZXQuZWxlbWVudHM7CiAgICAgIGxldCB0bXA7IC8vU2V0IGRpYWdvbmFscwoKICAgICAgVFswXSA9IE1bMF07CiAgICAgIFRbNF0gPSBNWzRdOwogICAgICBUWzhdID0gTVs4XTsKICAgICAgdG1wID0gTVsxXTsKICAgICAgVFsxXSA9IE1bM107CiAgICAgIFRbM10gPSB0bXA7CiAgICAgIHRtcCA9IE1bMl07CiAgICAgIFRbMl0gPSBNWzZdOwogICAgICBUWzZdID0gdG1wOwogICAgICB0bXAgPSBNWzVdOwogICAgICBUWzVdID0gTVs3XTsKICAgICAgVFs3XSA9IHRtcDsKICAgICAgcmV0dXJuIHRhcmdldDsKICAgIH0KCiAgfQogIGNvbnN0IHJldmVyc2VfZXFucyA9IFswLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwXTsKCiAgLyoqCiAgICogMy1kaW1lbnNpb25hbCB2ZWN0b3IKICAgKiBAZXhhbXBsZQogICAqICAgICBjb25zdCB2ID0gbmV3IFZlYzMoMSwgMiwgMykKICAgKiAgICAgY29uc29sZS5sb2coJ3g9JyArIHYueCkgLy8geD0xCiAgICovCgogIGNsYXNzIFZlYzMgewogICAgY29uc3RydWN0b3IoeCwgeSwgeikgewogICAgICBpZiAoeCA9PT0gdm9pZCAwKSB7CiAgICAgICAgeCA9IDAuMDsKICAgICAgfQoKICAgICAgaWYgKHkgPT09IHZvaWQgMCkgewogICAgICAgIHkgPSAwLjA7CiAgICAgIH0KCiAgICAgIGlmICh6ID09PSB2b2lkIDApIHsKICAgICAgICB6ID0gMC4wOwogICAgICB9CgogICAgICB0aGlzLnggPSB4OwogICAgICB0aGlzLnkgPSB5OwogICAgICB0aGlzLnogPSB6OwogICAgfQogICAgLyoqCiAgICAgKiBWZWN0b3IgY3Jvc3MgcHJvZHVjdAogICAgICogQHBhcmFtIHRhcmdldCBPcHRpb25hbCB0YXJnZXQgdG8gc2F2ZSBpbi4KICAgICAqLwoKCiAgICBjcm9zcyh2ZWN0b3IsIHRhcmdldCkgewogICAgICBpZiAodGFyZ2V0ID09PSB2b2lkIDApIHsKICAgICAgICB0YXJnZXQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICBjb25zdCB2eCA9IHZlY3Rvci54OwogICAgICBjb25zdCB2eSA9IHZlY3Rvci55OwogICAgICBjb25zdCB2eiA9IHZlY3Rvci56OwogICAgICBjb25zdCB4ID0gdGhpcy54OwogICAgICBjb25zdCB5ID0gdGhpcy55OwogICAgICBjb25zdCB6ID0gdGhpcy56OwogICAgICB0YXJnZXQueCA9IHkgKiB2eiAtIHogKiB2eTsKICAgICAgdGFyZ2V0LnkgPSB6ICogdnggLSB4ICogdno7CiAgICAgIHRhcmdldC56ID0geCAqIHZ5IC0geSAqIHZ4OwogICAgICByZXR1cm4gdGFyZ2V0OwogICAgfQogICAgLyoqCiAgICAgKiBTZXQgdGhlIHZlY3RvcnMnIDMgZWxlbWVudHMKICAgICAqLwoKCiAgICBzZXQoeCwgeSwgeikgewogICAgICB0aGlzLnggPSB4OwogICAgICB0aGlzLnkgPSB5OwogICAgICB0aGlzLnogPSB6OwogICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIC8qKgogICAgICogU2V0IGFsbCBjb21wb25lbnRzIG9mIHRoZSB2ZWN0b3IgdG8gemVyby4KICAgICAqLwoKCiAgICBzZXRaZXJvKCkgewogICAgICB0aGlzLnggPSB0aGlzLnkgPSB0aGlzLnogPSAwOwogICAgfQogICAgLyoqCiAgICAgKiBWZWN0b3IgYWRkaXRpb24KICAgICAqLwoKCiAgICB2YWRkKHZlY3RvciwgdGFyZ2V0KSB7CiAgICAgIGlmICh0YXJnZXQpIHsKICAgICAgICB0YXJnZXQueCA9IHZlY3Rvci54ICsgdGhpcy54OwogICAgICAgIHRhcmdldC55ID0gdmVjdG9yLnkgKyB0aGlzLnk7CiAgICAgICAgdGFyZ2V0LnogPSB2ZWN0b3IueiArIHRoaXMuejsKICAgICAgfSBlbHNlIHsKICAgICAgICByZXR1cm4gbmV3IFZlYzModGhpcy54ICsgdmVjdG9yLngsIHRoaXMueSArIHZlY3Rvci55LCB0aGlzLnogKyB2ZWN0b3Iueik7CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogVmVjdG9yIHN1YnRyYWN0aW9uCiAgICAgKiBAcGFyYW0gdGFyZ2V0IE9wdGlvbmFsIHRhcmdldCB0byBzYXZlIGluLgogICAgICovCgoKICAgIHZzdWIodmVjdG9yLCB0YXJnZXQpIHsKICAgICAgaWYgKHRhcmdldCkgewogICAgICAgIHRhcmdldC54ID0gdGhpcy54IC0gdmVjdG9yLng7CiAgICAgICAgdGFyZ2V0LnkgPSB0aGlzLnkgLSB2ZWN0b3IueTsKICAgICAgICB0YXJnZXQueiA9IHRoaXMueiAtIHZlY3Rvci56OwogICAgICB9IGVsc2UgewogICAgICAgIHJldHVybiBuZXcgVmVjMyh0aGlzLnggLSB2ZWN0b3IueCwgdGhpcy55IC0gdmVjdG9yLnksIHRoaXMueiAtIHZlY3Rvci56KTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBHZXQgdGhlIGNyb3NzIHByb2R1Y3QgbWF0cml4IGFfY3Jvc3MgZnJvbSBhIHZlY3Rvciwgc3VjaCB0aGF0IGEgeCBiID0gYV9jcm9zcyAqIGIgPSBjCiAgICAgKgogICAgICogU2VlIHtAbGluayBodHRwczovL3d3dzguY3MudW11LnNlL2t1cnNlci9UREJEMjQvVlQwNi9sZWN0dXJlcy9MZWN0dXJlNi5wZGYgVW1lw6UgVW5pdmVyc2l0eSBMZWN0dXJlfQogICAgICovCgoKICAgIGNyb3NzbWF0KCkgewogICAgICByZXR1cm4gbmV3IE1hdDMoWzAsIC10aGlzLnosIHRoaXMueSwgdGhpcy56LCAwLCAtdGhpcy54LCAtdGhpcy55LCB0aGlzLngsIDBdKTsKICAgIH0KICAgIC8qKgogICAgICogTm9ybWFsaXplIHRoZSB2ZWN0b3IuIE5vdGUgdGhhdCB0aGlzIGNoYW5nZXMgdGhlIHZhbHVlcyBpbiB0aGUgdmVjdG9yLgogICAgICAqIEByZXR1cm4gUmV0dXJucyB0aGUgbm9ybSBvZiB0aGUgdmVjdG9yCiAgICAgKi8KCgogICAgbm9ybWFsaXplKCkgewogICAgICBjb25zdCB4ID0gdGhpcy54OwogICAgICBjb25zdCB5ID0gdGhpcy55OwogICAgICBjb25zdCB6ID0gdGhpcy56OwogICAgICBjb25zdCBuID0gTWF0aC5zcXJ0KHggKiB4ICsgeSAqIHkgKyB6ICogeik7CgogICAgICBpZiAobiA+IDAuMCkgewogICAgICAgIGNvbnN0IGludk4gPSAxIC8gbjsKICAgICAgICB0aGlzLnggKj0gaW52TjsKICAgICAgICB0aGlzLnkgKj0gaW52TjsKICAgICAgICB0aGlzLnogKj0gaW52TjsKICAgICAgfSBlbHNlIHsKICAgICAgICAvLyBNYWtlIHNvbWV0aGluZyB1cAogICAgICAgIHRoaXMueCA9IDA7CiAgICAgICAgdGhpcy55ID0gMDsKICAgICAgICB0aGlzLnogPSAwOwogICAgICB9CgogICAgICByZXR1cm4gbjsKICAgIH0KICAgIC8qKgogICAgICogR2V0IHRoZSB2ZXJzaW9uIG9mIHRoaXMgdmVjdG9yIHRoYXQgaXMgb2YgbGVuZ3RoIDEuCiAgICAgKiBAcGFyYW0gdGFyZ2V0IE9wdGlvbmFsIHRhcmdldCB0byBzYXZlIGluCiAgICAgKiBAcmV0dXJuIFJldHVybnMgdGhlIHVuaXQgdmVjdG9yCiAgICAgKi8KCgogICAgdW5pdCh0YXJnZXQpIHsKICAgICAgaWYgKHRhcmdldCA9PT0gdm9pZCAwKSB7CiAgICAgICAgdGFyZ2V0ID0gbmV3IFZlYzMoKTsKICAgICAgfQoKICAgICAgY29uc3QgeCA9IHRoaXMueDsKICAgICAgY29uc3QgeSA9IHRoaXMueTsKICAgICAgY29uc3QgeiA9IHRoaXMuejsKICAgICAgbGV0IG5pbnYgPSBNYXRoLnNxcnQoeCAqIHggKyB5ICogeSArIHogKiB6KTsKCiAgICAgIGlmIChuaW52ID4gMC4wKSB7CiAgICAgICAgbmludiA9IDEuMCAvIG5pbnY7CiAgICAgICAgdGFyZ2V0LnggPSB4ICogbmludjsKICAgICAgICB0YXJnZXQueSA9IHkgKiBuaW52OwogICAgICAgIHRhcmdldC56ID0geiAqIG5pbnY7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGFyZ2V0LnggPSAxOwogICAgICAgIHRhcmdldC55ID0gMDsKICAgICAgICB0YXJnZXQueiA9IDA7CiAgICAgIH0KCiAgICAgIHJldHVybiB0YXJnZXQ7CiAgICB9CiAgICAvKioKICAgICAqIEdldCB0aGUgbGVuZ3RoIG9mIHRoZSB2ZWN0b3IKICAgICAqLwoKCiAgICBsZW5ndGgoKSB7CiAgICAgIGNvbnN0IHggPSB0aGlzLng7CiAgICAgIGNvbnN0IHkgPSB0aGlzLnk7CiAgICAgIGNvbnN0IHogPSB0aGlzLno7CiAgICAgIHJldHVybiBNYXRoLnNxcnQoeCAqIHggKyB5ICogeSArIHogKiB6KTsKICAgIH0KICAgIC8qKgogICAgICogR2V0IHRoZSBzcXVhcmVkIGxlbmd0aCBvZiB0aGUgdmVjdG9yLgogICAgICovCgoKICAgIGxlbmd0aFNxdWFyZWQoKSB7CiAgICAgIHJldHVybiB0aGlzLmRvdCh0aGlzKTsKICAgIH0KICAgIC8qKgogICAgICogR2V0IGRpc3RhbmNlIGZyb20gdGhpcyBwb2ludCB0byBhbm90aGVyIHBvaW50CiAgICAgKi8KCgogICAgZGlzdGFuY2VUbyhwKSB7CiAgICAgIGNvbnN0IHggPSB0aGlzLng7CiAgICAgIGNvbnN0IHkgPSB0aGlzLnk7CiAgICAgIGNvbnN0IHogPSB0aGlzLno7CiAgICAgIGNvbnN0IHB4ID0gcC54OwogICAgICBjb25zdCBweSA9IHAueTsKICAgICAgY29uc3QgcHogPSBwLno7CiAgICAgIHJldHVybiBNYXRoLnNxcnQoKHB4IC0geCkgKiAocHggLSB4KSArIChweSAtIHkpICogKHB5IC0geSkgKyAocHogLSB6KSAqIChweiAtIHopKTsKICAgIH0KICAgIC8qKgogICAgICogR2V0IHNxdWFyZWQgZGlzdGFuY2UgZnJvbSB0aGlzIHBvaW50IHRvIGFub3RoZXIgcG9pbnQKICAgICAqLwoKCiAgICBkaXN0YW5jZVNxdWFyZWQocCkgewogICAgICBjb25zdCB4ID0gdGhpcy54OwogICAgICBjb25zdCB5ID0gdGhpcy55OwogICAgICBjb25zdCB6ID0gdGhpcy56OwogICAgICBjb25zdCBweCA9IHAueDsKICAgICAgY29uc3QgcHkgPSBwLnk7CiAgICAgIGNvbnN0IHB6ID0gcC56OwogICAgICByZXR1cm4gKHB4IC0geCkgKiAocHggLSB4KSArIChweSAtIHkpICogKHB5IC0geSkgKyAocHogLSB6KSAqIChweiAtIHopOwogICAgfQogICAgLyoqCiAgICAgKiBNdWx0aXBseSBhbGwgdGhlIGNvbXBvbmVudHMgb2YgdGhlIHZlY3RvciB3aXRoIGEgc2NhbGFyLgogICAgICogQHBhcmFtIHRhcmdldCBUaGUgdmVjdG9yIHRvIHNhdmUgdGhlIHJlc3VsdCBpbi4KICAgICAqLwoKCiAgICBzY2FsZShzY2FsYXIsIHRhcmdldCkgewogICAgICBpZiAodGFyZ2V0ID09PSB2b2lkIDApIHsKICAgICAgICB0YXJnZXQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICBjb25zdCB4ID0gdGhpcy54OwogICAgICBjb25zdCB5ID0gdGhpcy55OwogICAgICBjb25zdCB6ID0gdGhpcy56OwogICAgICB0YXJnZXQueCA9IHNjYWxhciAqIHg7CiAgICAgIHRhcmdldC55ID0gc2NhbGFyICogeTsKICAgICAgdGFyZ2V0LnogPSBzY2FsYXIgKiB6OwogICAgICByZXR1cm4gdGFyZ2V0OwogICAgfQogICAgLyoqCiAgICAgKiBNdWx0aXBseSB0aGUgdmVjdG9yIHdpdGggYW4gb3RoZXIgdmVjdG9yLCBjb21wb25lbnQtd2lzZS4KICAgICAqIEBwYXJhbSB0YXJnZXQgVGhlIHZlY3RvciB0byBzYXZlIHRoZSByZXN1bHQgaW4uCiAgICAgKi8KCgogICAgdm11bCh2ZWN0b3IsIHRhcmdldCkgewogICAgICBpZiAodGFyZ2V0ID09PSB2b2lkIDApIHsKICAgICAgICB0YXJnZXQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICB0YXJnZXQueCA9IHZlY3Rvci54ICogdGhpcy54OwogICAgICB0YXJnZXQueSA9IHZlY3Rvci55ICogdGhpcy55OwogICAgICB0YXJnZXQueiA9IHZlY3Rvci56ICogdGhpcy56OwogICAgICByZXR1cm4gdGFyZ2V0OwogICAgfQogICAgLyoqCiAgICAgKiBTY2FsZSBhIHZlY3RvciBhbmQgYWRkIGl0IHRvIHRoaXMgdmVjdG9yLiBTYXZlIHRoZSByZXN1bHQgaW4gInRhcmdldCIuICh0YXJnZXQgPSB0aGlzICsgdmVjdG9yICogc2NhbGFyKQogICAgICogQHBhcmFtIHRhcmdldCBUaGUgdmVjdG9yIHRvIHNhdmUgdGhlIHJlc3VsdCBpbi4KICAgICAqLwoKCiAgICBhZGRTY2FsZWRWZWN0b3Ioc2NhbGFyLCB2ZWN0b3IsIHRhcmdldCkgewogICAgICBpZiAodGFyZ2V0ID09PSB2b2lkIDApIHsKICAgICAgICB0YXJnZXQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICB0YXJnZXQueCA9IHRoaXMueCArIHNjYWxhciAqIHZlY3Rvci54OwogICAgICB0YXJnZXQueSA9IHRoaXMueSArIHNjYWxhciAqIHZlY3Rvci55OwogICAgICB0YXJnZXQueiA9IHRoaXMueiArIHNjYWxhciAqIHZlY3Rvci56OwogICAgICByZXR1cm4gdGFyZ2V0OwogICAgfQogICAgLyoqCiAgICAgKiBDYWxjdWxhdGUgZG90IHByb2R1Y3QKICAgICAqIEBwYXJhbSB2ZWN0b3IKICAgICAqLwoKCiAgICBkb3QodmVjdG9yKSB7CiAgICAgIHJldHVybiB0aGlzLnggKiB2ZWN0b3IueCArIHRoaXMueSAqIHZlY3Rvci55ICsgdGhpcy56ICogdmVjdG9yLno7CiAgICB9CgogICAgaXNaZXJvKCkgewogICAgICByZXR1cm4gdGhpcy54ID09PSAwICYmIHRoaXMueSA9PT0gMCAmJiB0aGlzLnogPT09IDA7CiAgICB9CiAgICAvKioKICAgICAqIE1ha2UgdGhlIHZlY3RvciBwb2ludCBpbiB0aGUgb3Bwb3NpdGUgZGlyZWN0aW9uLgogICAgICogQHBhcmFtIHRhcmdldCBPcHRpb25hbCB0YXJnZXQgdG8gc2F2ZSBpbgogICAgICovCgoKICAgIG5lZ2F0ZSh0YXJnZXQpIHsKICAgICAgaWYgKHRhcmdldCA9PT0gdm9pZCAwKSB7CiAgICAgICAgdGFyZ2V0ID0gbmV3IFZlYzMoKTsKICAgICAgfQoKICAgICAgdGFyZ2V0LnggPSAtdGhpcy54OwogICAgICB0YXJnZXQueSA9IC10aGlzLnk7CiAgICAgIHRhcmdldC56ID0gLXRoaXMuejsKICAgICAgcmV0dXJuIHRhcmdldDsKICAgIH0KICAgIC8qKgogICAgICogQ29tcHV0ZSB0d28gYXJ0aWZpY2lhbCB0YW5nZW50cyB0byB0aGUgdmVjdG9yCiAgICAgKiBAcGFyYW0gdDEgVmVjdG9yIG9iamVjdCB0byBzYXZlIHRoZSBmaXJzdCB0YW5nZW50IGluCiAgICAgKiBAcGFyYW0gdDIgVmVjdG9yIG9iamVjdCB0byBzYXZlIHRoZSBzZWNvbmQgdGFuZ2VudCBpbgogICAgICovCgoKICAgIHRhbmdlbnRzKHQxLCB0MikgewogICAgICBjb25zdCBub3JtID0gdGhpcy5sZW5ndGgoKTsKCiAgICAgIGlmIChub3JtID4gMC4wKSB7CiAgICAgICAgY29uc3QgbiA9IFZlYzNfdGFuZ2VudHNfbjsKICAgICAgICBjb25zdCBpbm9ybSA9IDEgLyBub3JtOwogICAgICAgIG4uc2V0KHRoaXMueCAqIGlub3JtLCB0aGlzLnkgKiBpbm9ybSwgdGhpcy56ICogaW5vcm0pOwogICAgICAgIGNvbnN0IHJhbmRWZWMgPSBWZWMzX3RhbmdlbnRzX3JhbmRWZWM7CgogICAgICAgIGlmIChNYXRoLmFicyhuLngpIDwgMC45KSB7CiAgICAgICAgICByYW5kVmVjLnNldCgxLCAwLCAwKTsKICAgICAgICAgIG4uY3Jvc3MocmFuZFZlYywgdDEpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICByYW5kVmVjLnNldCgwLCAxLCAwKTsKICAgICAgICAgIG4uY3Jvc3MocmFuZFZlYywgdDEpOwogICAgICAgIH0KCiAgICAgICAgbi5jcm9zcyh0MSwgdDIpOwogICAgICB9IGVsc2UgewogICAgICAgIC8vIFRoZSBub3JtYWwgbGVuZ3RoIGlzIHplcm8sIG1ha2Ugc29tZXRoaW5nIHVwCiAgICAgICAgdDEuc2V0KDEsIDAsIDApOwogICAgICAgIHQyLnNldCgwLCAxLCAwKTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBDb252ZXJ0cyB0byBhIG1vcmUgcmVhZGFibGUgZm9ybWF0CiAgICAgKi8KCgogICAgdG9TdHJpbmcoKSB7CiAgICAgIHJldHVybiBgJHt0aGlzLnh9LCR7dGhpcy55fSwke3RoaXMuen1gOwogICAgfQogICAgLyoqCiAgICAgKiBDb252ZXJ0cyB0byBhbiBhcnJheQogICAgICovCgoKICAgIHRvQXJyYXkoKSB7CiAgICAgIHJldHVybiBbdGhpcy54LCB0aGlzLnksIHRoaXMuel07CiAgICB9CiAgICAvKioKICAgICAqIENvcGllcyB2YWx1ZSBvZiBzb3VyY2UgdG8gdGhpcyB2ZWN0b3IuCiAgICAgKi8KCgogICAgY29weSh2ZWN0b3IpIHsKICAgICAgdGhpcy54ID0gdmVjdG9yLng7CiAgICAgIHRoaXMueSA9IHZlY3Rvci55OwogICAgICB0aGlzLnogPSB2ZWN0b3IuejsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICAvKioKICAgICAqIERvIGEgbGluZWFyIGludGVycG9sYXRpb24gYmV0d2VlbiB0d28gdmVjdG9ycwogICAgICogQHBhcmFtIHQgQSBudW1iZXIgYmV0d2VlbiAwIGFuZCAxLiAwIHdpbGwgbWFrZSB0aGlzIGZ1bmN0aW9uIHJldHVybiB1LCBhbmQgMSB3aWxsIG1ha2UgaXQgcmV0dXJuIHYuIE51bWJlcnMgaW4gYmV0d2VlbiB3aWxsIGdlbmVyYXRlIGEgdmVjdG9yIGluIGJldHdlZW4gdGhlbS4KICAgICAqLwoKCiAgICBsZXJwKHZlY3RvciwgdCwgdGFyZ2V0KSB7CiAgICAgIGNvbnN0IHggPSB0aGlzLng7CiAgICAgIGNvbnN0IHkgPSB0aGlzLnk7CiAgICAgIGNvbnN0IHogPSB0aGlzLno7CiAgICAgIHRhcmdldC54ID0geCArICh2ZWN0b3IueCAtIHgpICogdDsKICAgICAgdGFyZ2V0LnkgPSB5ICsgKHZlY3Rvci55IC0geSkgKiB0OwogICAgICB0YXJnZXQueiA9IHogKyAodmVjdG9yLnogLSB6KSAqIHQ7CiAgICB9CiAgICAvKioKICAgICAqIENoZWNrIGlmIGEgdmVjdG9yIGVxdWFscyBpcyBhbG1vc3QgZXF1YWwgdG8gYW5vdGhlciBvbmUuCiAgICAgKi8KCgogICAgYWxtb3N0RXF1YWxzKHZlY3RvciwgcHJlY2lzaW9uKSB7CiAgICAgIGlmIChwcmVjaXNpb24gPT09IHZvaWQgMCkgewogICAgICAgIHByZWNpc2lvbiA9IDFlLTY7CiAgICAgIH0KCiAgICAgIGlmIChNYXRoLmFicyh0aGlzLnggLSB2ZWN0b3IueCkgPiBwcmVjaXNpb24gfHwgTWF0aC5hYnModGhpcy55IC0gdmVjdG9yLnkpID4gcHJlY2lzaW9uIHx8IE1hdGguYWJzKHRoaXMueiAtIHZlY3Rvci56KSA+IHByZWNpc2lvbikgewogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQoKICAgICAgcmV0dXJuIHRydWU7CiAgICB9CiAgICAvKioKICAgICAqIENoZWNrIGlmIGEgdmVjdG9yIGlzIGFsbW9zdCB6ZXJvCiAgICAgKi8KCgogICAgYWxtb3N0WmVybyhwcmVjaXNpb24pIHsKICAgICAgaWYgKHByZWNpc2lvbiA9PT0gdm9pZCAwKSB7CiAgICAgICAgcHJlY2lzaW9uID0gMWUtNjsKICAgICAgfQoKICAgICAgaWYgKE1hdGguYWJzKHRoaXMueCkgPiBwcmVjaXNpb24gfHwgTWF0aC5hYnModGhpcy55KSA+IHByZWNpc2lvbiB8fCBNYXRoLmFicyh0aGlzLnopID4gcHJlY2lzaW9uKSB7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9CgogICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KICAgIC8qKgogICAgICogQ2hlY2sgaWYgdGhlIHZlY3RvciBpcyBhbnRpLXBhcmFsbGVsIHRvIGFub3RoZXIgdmVjdG9yLgogICAgICogQHBhcmFtIHByZWNpc2lvbiBTZXQgdG8gemVybyBmb3IgZXhhY3QgY29tcGFyaXNvbnMKICAgICAqLwoKCiAgICBpc0FudGlwYXJhbGxlbFRvKHZlY3RvciwgcHJlY2lzaW9uKSB7CiAgICAgIHRoaXMubmVnYXRlKGFudGlwX25lZyk7CiAgICAgIHJldHVybiBhbnRpcF9uZWcuYWxtb3N0RXF1YWxzKHZlY3RvciwgcHJlY2lzaW9uKTsKICAgIH0KICAgIC8qKgogICAgICogQ2xvbmUgdGhlIHZlY3RvcgogICAgICovCgoKICAgIGNsb25lKCkgewogICAgICByZXR1cm4gbmV3IFZlYzModGhpcy54LCB0aGlzLnksIHRoaXMueik7CiAgICB9CgogIH0KICBWZWMzLlpFUk8gPSBuZXcgVmVjMygwLCAwLCAwKTsKICBWZWMzLlVOSVRfWCA9IG5ldyBWZWMzKDEsIDAsIDApOwogIFZlYzMuVU5JVF9ZID0gbmV3IFZlYzMoMCwgMSwgMCk7CiAgVmVjMy5VTklUX1ogPSBuZXcgVmVjMygwLCAwLCAxKTsKICBjb25zdCBWZWMzX3RhbmdlbnRzX24gPSBuZXcgVmVjMygpOwogIGNvbnN0IFZlYzNfdGFuZ2VudHNfcmFuZFZlYyA9IG5ldyBWZWMzKCk7CiAgY29uc3QgYW50aXBfbmVnID0gbmV3IFZlYzMoKTsKCiAgLyoqCiAgICogQXhpcyBhbGlnbmVkIGJvdW5kaW5nIGJveCBjbGFzcy4KICAgKi8KICBjbGFzcyBBQUJCIHsKICAgIC8qKgogICAgICogVGhlIGxvd2VyIGJvdW5kIG9mIHRoZSBib3VuZGluZyBib3gKICAgICAqLwoKICAgIC8qKgogICAgICogVGhlIHVwcGVyIGJvdW5kIG9mIHRoZSBib3VuZGluZyBib3gKICAgICAqLwogICAgY29uc3RydWN0b3Iob3B0aW9ucykgewogICAgICBpZiAob3B0aW9ucyA9PT0gdm9pZCAwKSB7CiAgICAgICAgb3B0aW9ucyA9IHt9OwogICAgICB9CgogICAgICB0aGlzLmxvd2VyQm91bmQgPSBuZXcgVmVjMygpOwogICAgICB0aGlzLnVwcGVyQm91bmQgPSBuZXcgVmVjMygpOwoKICAgICAgaWYgKG9wdGlvbnMubG93ZXJCb3VuZCkgewogICAgICAgIHRoaXMubG93ZXJCb3VuZC5jb3B5KG9wdGlvbnMubG93ZXJCb3VuZCk7CiAgICAgIH0KCiAgICAgIGlmIChvcHRpb25zLnVwcGVyQm91bmQpIHsKICAgICAgICB0aGlzLnVwcGVyQm91bmQuY29weShvcHRpb25zLnVwcGVyQm91bmQpOwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIFNldCB0aGUgQUFCQiBib3VuZHMgZnJvbSBhIHNldCBvZiBwb2ludHMuCiAgICAgKiBAcGFyYW0gcG9pbnRzIEFuIGFycmF5IG9mIFZlYzMncy4KICAgICAqIEByZXR1cm4gVGhlIHNlbGYgb2JqZWN0CiAgICAgKi8KCgogICAgc2V0RnJvbVBvaW50cyhwb2ludHMsIHBvc2l0aW9uLCBxdWF0ZXJuaW9uLCBza2luU2l6ZSkgewogICAgICBjb25zdCBsID0gdGhpcy5sb3dlckJvdW5kOwogICAgICBjb25zdCB1ID0gdGhpcy51cHBlckJvdW5kOwogICAgICBjb25zdCBxID0gcXVhdGVybmlvbjsgLy8gU2V0IHRvIHRoZSBmaXJzdCBwb2ludAoKICAgICAgbC5jb3B5KHBvaW50c1swXSk7CgogICAgICBpZiAocSkgewogICAgICAgIHEudm11bHQobCwgbCk7CiAgICAgIH0KCiAgICAgIHUuY29weShsKTsKCiAgICAgIGZvciAobGV0IGkgPSAxOyBpIDwgcG9pbnRzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgbGV0IHAgPSBwb2ludHNbaV07CgogICAgICAgIGlmIChxKSB7CiAgICAgICAgICBxLnZtdWx0KHAsIHRtcCQxKTsKICAgICAgICAgIHAgPSB0bXAkMTsKICAgICAgICB9CgogICAgICAgIGlmIChwLnggPiB1LngpIHsKICAgICAgICAgIHUueCA9IHAueDsKICAgICAgICB9CgogICAgICAgIGlmIChwLnggPCBsLngpIHsKICAgICAgICAgIGwueCA9IHAueDsKICAgICAgICB9CgogICAgICAgIGlmIChwLnkgPiB1LnkpIHsKICAgICAgICAgIHUueSA9IHAueTsKICAgICAgICB9CgogICAgICAgIGlmIChwLnkgPCBsLnkpIHsKICAgICAgICAgIGwueSA9IHAueTsKICAgICAgICB9CgogICAgICAgIGlmIChwLnogPiB1LnopIHsKICAgICAgICAgIHUueiA9IHAuejsKICAgICAgICB9CgogICAgICAgIGlmIChwLnogPCBsLnopIHsKICAgICAgICAgIGwueiA9IHAuejsKICAgICAgICB9CiAgICAgIH0gLy8gQWRkIG9mZnNldAoKCiAgICAgIGlmIChwb3NpdGlvbikgewogICAgICAgIHBvc2l0aW9uLnZhZGQobCwgbCk7CiAgICAgICAgcG9zaXRpb24udmFkZCh1LCB1KTsKICAgICAgfQoKICAgICAgaWYgKHNraW5TaXplKSB7CiAgICAgICAgbC54IC09IHNraW5TaXplOwogICAgICAgIGwueSAtPSBza2luU2l6ZTsKICAgICAgICBsLnogLT0gc2tpblNpemU7CiAgICAgICAgdS54ICs9IHNraW5TaXplOwogICAgICAgIHUueSArPSBza2luU2l6ZTsKICAgICAgICB1LnogKz0gc2tpblNpemU7CiAgICAgIH0KCiAgICAgIHJldHVybiB0aGlzOwogICAgfQogICAgLyoqCiAgICAgKiBDb3B5IGJvdW5kcyBmcm9tIGFuIEFBQkIgdG8gdGhpcyBBQUJCCiAgICAgKiBAcGFyYW0gYWFiYiBTb3VyY2UgdG8gY29weSBmcm9tCiAgICAgKiBAcmV0dXJuIFRoZSB0aGlzIG9iamVjdCwgZm9yIGNoYWluYWJpbGl0eQogICAgICovCgoKICAgIGNvcHkoYWFiYikgewogICAgICB0aGlzLmxvd2VyQm91bmQuY29weShhYWJiLmxvd2VyQm91bmQpOwogICAgICB0aGlzLnVwcGVyQm91bmQuY29weShhYWJiLnVwcGVyQm91bmQpOwogICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIC8qKgogICAgICogQ2xvbmUgYW4gQUFCQgogICAgICovCgoKICAgIGNsb25lKCkgewogICAgICByZXR1cm4gbmV3IEFBQkIoKS5jb3B5KHRoaXMpOwogICAgfQogICAgLyoqCiAgICAgKiBFeHRlbmQgdGhpcyBBQUJCIHNvIHRoYXQgaXQgY292ZXJzIHRoZSBnaXZlbiBBQUJCIHRvby4KICAgICAqLwoKCiAgICBleHRlbmQoYWFiYikgewogICAgICB0aGlzLmxvd2VyQm91bmQueCA9IE1hdGgubWluKHRoaXMubG93ZXJCb3VuZC54LCBhYWJiLmxvd2VyQm91bmQueCk7CiAgICAgIHRoaXMudXBwZXJCb3VuZC54ID0gTWF0aC5tYXgodGhpcy51cHBlckJvdW5kLngsIGFhYmIudXBwZXJCb3VuZC54KTsKICAgICAgdGhpcy5sb3dlckJvdW5kLnkgPSBNYXRoLm1pbih0aGlzLmxvd2VyQm91bmQueSwgYWFiYi5sb3dlckJvdW5kLnkpOwogICAgICB0aGlzLnVwcGVyQm91bmQueSA9IE1hdGgubWF4KHRoaXMudXBwZXJCb3VuZC55LCBhYWJiLnVwcGVyQm91bmQueSk7CiAgICAgIHRoaXMubG93ZXJCb3VuZC56ID0gTWF0aC5taW4odGhpcy5sb3dlckJvdW5kLnosIGFhYmIubG93ZXJCb3VuZC56KTsKICAgICAgdGhpcy51cHBlckJvdW5kLnogPSBNYXRoLm1heCh0aGlzLnVwcGVyQm91bmQueiwgYWFiYi51cHBlckJvdW5kLnopOwogICAgfQogICAgLyoqCiAgICAgKiBSZXR1cm5zIHRydWUgaWYgdGhlIGdpdmVuIEFBQkIgb3ZlcmxhcHMgdGhpcyBBQUJCLgogICAgICovCgoKICAgIG92ZXJsYXBzKGFhYmIpIHsKICAgICAgY29uc3QgbDEgPSB0aGlzLmxvd2VyQm91bmQ7CiAgICAgIGNvbnN0IHUxID0gdGhpcy51cHBlckJvdW5kOwogICAgICBjb25zdCBsMiA9IGFhYmIubG93ZXJCb3VuZDsKICAgICAgY29uc3QgdTIgPSBhYWJiLnVwcGVyQm91bmQ7IC8vICAgICAgbDIgICAgICAgIHUyCiAgICAgIC8vICAgICAgfC0tLS0tLS0tLXwKICAgICAgLy8gfC0tLS0tLS0tfAogICAgICAvLyBsMSAgICAgICB1MQoKICAgICAgY29uc3Qgb3ZlcmxhcHNYID0gbDIueCA8PSB1MS54ICYmIHUxLnggPD0gdTIueCB8fCBsMS54IDw9IHUyLnggJiYgdTIueCA8PSB1MS54OwogICAgICBjb25zdCBvdmVybGFwc1kgPSBsMi55IDw9IHUxLnkgJiYgdTEueSA8PSB1Mi55IHx8IGwxLnkgPD0gdTIueSAmJiB1Mi55IDw9IHUxLnk7CiAgICAgIGNvbnN0IG92ZXJsYXBzWiA9IGwyLnogPD0gdTEueiAmJiB1MS56IDw9IHUyLnogfHwgbDEueiA8PSB1Mi56ICYmIHUyLnogPD0gdTEuejsKICAgICAgcmV0dXJuIG92ZXJsYXBzWCAmJiBvdmVybGFwc1kgJiYgb3ZlcmxhcHNaOwogICAgfSAvLyBNb3N0bHkgZm9yIGRlYnVnZ2luZwoKCiAgICB2b2x1bWUoKSB7CiAgICAgIGNvbnN0IGwgPSB0aGlzLmxvd2VyQm91bmQ7CiAgICAgIGNvbnN0IHUgPSB0aGlzLnVwcGVyQm91bmQ7CiAgICAgIHJldHVybiAodS54IC0gbC54KSAqICh1LnkgLSBsLnkpICogKHUueiAtIGwueik7CiAgICB9CiAgICAvKioKICAgICAqIFJldHVybnMgdHJ1ZSBpZiB0aGUgZ2l2ZW4gQUFCQiBpcyBmdWxseSBjb250YWluZWQgaW4gdGhpcyBBQUJCLgogICAgICovCgoKICAgIGNvbnRhaW5zKGFhYmIpIHsKICAgICAgY29uc3QgbDEgPSB0aGlzLmxvd2VyQm91bmQ7CiAgICAgIGNvbnN0IHUxID0gdGhpcy51cHBlckJvdW5kOwogICAgICBjb25zdCBsMiA9IGFhYmIubG93ZXJCb3VuZDsKICAgICAgY29uc3QgdTIgPSBhYWJiLnVwcGVyQm91bmQ7IC8vICAgICAgbDIgICAgICAgIHUyCiAgICAgIC8vICAgICAgfC0tLS0tLS0tLXwKICAgICAgLy8gfC0tLS0tLS0tLS0tLS0tLXwKICAgICAgLy8gbDEgICAgICAgICAgICAgIHUxCgogICAgICByZXR1cm4gbDEueCA8PSBsMi54ICYmIHUxLnggPj0gdTIueCAmJiBsMS55IDw9IGwyLnkgJiYgdTEueSA+PSB1Mi55ICYmIGwxLnogPD0gbDIueiAmJiB1MS56ID49IHUyLno7CiAgICB9CgogICAgZ2V0Q29ybmVycyhhLCBiLCBjLCBkLCBlLCBmLCBnLCBoKSB7CiAgICAgIGNvbnN0IGwgPSB0aGlzLmxvd2VyQm91bmQ7CiAgICAgIGNvbnN0IHUgPSB0aGlzLnVwcGVyQm91bmQ7CiAgICAgIGEuY29weShsKTsKICAgICAgYi5zZXQodS54LCBsLnksIGwueik7CiAgICAgIGMuc2V0KHUueCwgdS55LCBsLnopOwogICAgICBkLnNldChsLngsIHUueSwgdS56KTsKICAgICAgZS5zZXQodS54LCBsLnksIHUueik7CiAgICAgIGYuc2V0KGwueCwgdS55LCBsLnopOwogICAgICBnLnNldChsLngsIGwueSwgdS56KTsKICAgICAgaC5jb3B5KHUpOwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgdGhlIHJlcHJlc2VudGF0aW9uIG9mIGFuIEFBQkIgaW4gYW5vdGhlciBmcmFtZS4KICAgICAqIEByZXR1cm4gVGhlICJ0YXJnZXQiIEFBQkIgb2JqZWN0LgogICAgICovCgoKICAgIHRvTG9jYWxGcmFtZShmcmFtZSwgdGFyZ2V0KSB7CiAgICAgIGNvbnN0IGNvcm5lcnMgPSB0cmFuc2Zvcm1JbnRvRnJhbWVfY29ybmVyczsKICAgICAgY29uc3QgYSA9IGNvcm5lcnNbMF07CiAgICAgIGNvbnN0IGIgPSBjb3JuZXJzWzFdOwogICAgICBjb25zdCBjID0gY29ybmVyc1syXTsKICAgICAgY29uc3QgZCA9IGNvcm5lcnNbM107CiAgICAgIGNvbnN0IGUgPSBjb3JuZXJzWzRdOwogICAgICBjb25zdCBmID0gY29ybmVyc1s1XTsKICAgICAgY29uc3QgZyA9IGNvcm5lcnNbNl07CiAgICAgIGNvbnN0IGggPSBjb3JuZXJzWzddOyAvLyBHZXQgY29ybmVycyBpbiBjdXJyZW50IGZyYW1lCgogICAgICB0aGlzLmdldENvcm5lcnMoYSwgYiwgYywgZCwgZSwgZiwgZywgaCk7IC8vIFRyYW5zZm9ybSB0aGVtIHRvIG5ldyBsb2NhbCBmcmFtZQoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IDg7IGkrKykgewogICAgICAgIGNvbnN0IGNvcm5lciA9IGNvcm5lcnNbaV07CiAgICAgICAgZnJhbWUucG9pbnRUb0xvY2FsKGNvcm5lciwgY29ybmVyKTsKICAgICAgfQoKICAgICAgcmV0dXJuIHRhcmdldC5zZXRGcm9tUG9pbnRzKGNvcm5lcnMpOwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgdGhlIHJlcHJlc2VudGF0aW9uIG9mIGFuIEFBQkIgaW4gdGhlIGdsb2JhbCBmcmFtZS4KICAgICAqIEByZXR1cm4gVGhlICJ0YXJnZXQiIEFBQkIgb2JqZWN0LgogICAgICovCgoKICAgIHRvV29ybGRGcmFtZShmcmFtZSwgdGFyZ2V0KSB7CiAgICAgIGNvbnN0IGNvcm5lcnMgPSB0cmFuc2Zvcm1JbnRvRnJhbWVfY29ybmVyczsKICAgICAgY29uc3QgYSA9IGNvcm5lcnNbMF07CiAgICAgIGNvbnN0IGIgPSBjb3JuZXJzWzFdOwogICAgICBjb25zdCBjID0gY29ybmVyc1syXTsKICAgICAgY29uc3QgZCA9IGNvcm5lcnNbM107CiAgICAgIGNvbnN0IGUgPSBjb3JuZXJzWzRdOwogICAgICBjb25zdCBmID0gY29ybmVyc1s1XTsKICAgICAgY29uc3QgZyA9IGNvcm5lcnNbNl07CiAgICAgIGNvbnN0IGggPSBjb3JuZXJzWzddOyAvLyBHZXQgY29ybmVycyBpbiBjdXJyZW50IGZyYW1lCgogICAgICB0aGlzLmdldENvcm5lcnMoYSwgYiwgYywgZCwgZSwgZiwgZywgaCk7IC8vIFRyYW5zZm9ybSB0aGVtIHRvIG5ldyBsb2NhbCBmcmFtZQoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IDg7IGkrKykgewogICAgICAgIGNvbnN0IGNvcm5lciA9IGNvcm5lcnNbaV07CiAgICAgICAgZnJhbWUucG9pbnRUb1dvcmxkKGNvcm5lciwgY29ybmVyKTsKICAgICAgfQoKICAgICAgcmV0dXJuIHRhcmdldC5zZXRGcm9tUG9pbnRzKGNvcm5lcnMpOwogICAgfQogICAgLyoqCiAgICAgKiBDaGVjayBpZiB0aGUgQUFCQiBpcyBoaXQgYnkgYSByYXkuCiAgICAgKi8KCgogICAgb3ZlcmxhcHNSYXkocmF5KSB7CiAgICAgIGNvbnN0IHsKICAgICAgICBkaXJlY3Rpb24sCiAgICAgICAgZnJvbQogICAgICB9ID0gcmF5OyAvLyBjb25zdCB0ID0gMAogICAgICAvLyByYXkuZGlyZWN0aW9uIGlzIHVuaXQgZGlyZWN0aW9uIHZlY3RvciBvZiByYXkKCiAgICAgIGNvbnN0IGRpckZyYWNYID0gMSAvIGRpcmVjdGlvbi54OwogICAgICBjb25zdCBkaXJGcmFjWSA9IDEgLyBkaXJlY3Rpb24ueTsKICAgICAgY29uc3QgZGlyRnJhY1ogPSAxIC8gZGlyZWN0aW9uLno7IC8vIHRoaXMubG93ZXJCb3VuZCBpcyB0aGUgY29ybmVyIG9mIEFBQkIgd2l0aCBtaW5pbWFsIGNvb3JkaW5hdGVzIC0gbGVmdCBib3R0b20sIHJ0IGlzIG1heGltYWwgY29ybmVyCgogICAgICBjb25zdCB0MSA9ICh0aGlzLmxvd2VyQm91bmQueCAtIGZyb20ueCkgKiBkaXJGcmFjWDsKICAgICAgY29uc3QgdDIgPSAodGhpcy51cHBlckJvdW5kLnggLSBmcm9tLngpICogZGlyRnJhY1g7CiAgICAgIGNvbnN0IHQzID0gKHRoaXMubG93ZXJCb3VuZC55IC0gZnJvbS55KSAqIGRpckZyYWNZOwogICAgICBjb25zdCB0NCA9ICh0aGlzLnVwcGVyQm91bmQueSAtIGZyb20ueSkgKiBkaXJGcmFjWTsKICAgICAgY29uc3QgdDUgPSAodGhpcy5sb3dlckJvdW5kLnogLSBmcm9tLnopICogZGlyRnJhY1o7CiAgICAgIGNvbnN0IHQ2ID0gKHRoaXMudXBwZXJCb3VuZC56IC0gZnJvbS56KSAqIGRpckZyYWNaOyAvLyBjb25zdCB0bWluID0gTWF0aC5tYXgoTWF0aC5tYXgoTWF0aC5taW4odDEsIHQyKSwgTWF0aC5taW4odDMsIHQ0KSkpOwogICAgICAvLyBjb25zdCB0bWF4ID0gTWF0aC5taW4oTWF0aC5taW4oTWF0aC5tYXgodDEsIHQyKSwgTWF0aC5tYXgodDMsIHQ0KSkpOwoKICAgICAgY29uc3QgdG1pbiA9IE1hdGgubWF4KE1hdGgubWF4KE1hdGgubWluKHQxLCB0MiksIE1hdGgubWluKHQzLCB0NCkpLCBNYXRoLm1pbih0NSwgdDYpKTsKICAgICAgY29uc3QgdG1heCA9IE1hdGgubWluKE1hdGgubWluKE1hdGgubWF4KHQxLCB0MiksIE1hdGgubWF4KHQzLCB0NCkpLCBNYXRoLm1heCh0NSwgdDYpKTsgLy8gaWYgdG1heCA8IDAsIHJheSAobGluZSkgaXMgaW50ZXJzZWN0aW5nIEFBQkIsIGJ1dCB3aG9sZSBBQUJCIGlzIGJlaGluZyB1cwoKICAgICAgaWYgKHRtYXggPCAwKSB7CiAgICAgICAgLy90ID0gdG1heDsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0gLy8gaWYgdG1pbiA+IHRtYXgsIHJheSBkb2Vzbid0IGludGVyc2VjdCBBQUJCCgoKICAgICAgaWYgKHRtaW4gPiB0bWF4KSB7CiAgICAgICAgLy90ID0gdG1heDsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0KCiAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICB9CiAgY29uc3QgdG1wJDEgPSBuZXcgVmVjMygpOwogIGNvbnN0IHRyYW5zZm9ybUludG9GcmFtZV9jb3JuZXJzID0gW25ldyBWZWMzKCksIG5ldyBWZWMzKCksIG5ldyBWZWMzKCksIG5ldyBWZWMzKCksIG5ldyBWZWMzKCksIG5ldyBWZWMzKCksIG5ldyBWZWMzKCksIG5ldyBWZWMzKCldOwoKICAvKioKICAgKiBDb2xsaXNpb24gIm1hdHJpeCIuCiAgICogSXQncyBhY3R1YWxseSBhIHRyaWFuZ3VsYXItc2hhcGVkIGFycmF5IG9mIHdoZXRoZXIgdHdvIGJvZGllcyBhcmUgdG91Y2hpbmcgdGhpcyBzdGVwLCBmb3IgcmVmZXJlbmNlIG5leHQgc3RlcAogICAqLwogIGNsYXNzIEFycmF5Q29sbGlzaW9uTWF0cml4IHsKICAgIC8qKgogICAgICogVGhlIG1hdHJpeCBzdG9yYWdlLgogICAgICovCiAgICBjb25zdHJ1Y3RvcigpIHsKICAgICAgdGhpcy5tYXRyaXggPSBbXTsKICAgIH0KICAgIC8qKgogICAgICogR2V0IGFuIGVsZW1lbnQKICAgICAqLwoKCiAgICBnZXQoYmksIGJqKSB7CiAgICAgIGxldCB7CiAgICAgICAgaW5kZXg6IGkKICAgICAgfSA9IGJpOwogICAgICBsZXQgewogICAgICAgIGluZGV4OiBqCiAgICAgIH0gPSBiajsKCiAgICAgIGlmIChqID4gaSkgewogICAgICAgIGNvbnN0IHRlbXAgPSBqOwogICAgICAgIGogPSBpOwogICAgICAgIGkgPSB0ZW1wOwogICAgICB9CgogICAgICByZXR1cm4gdGhpcy5tYXRyaXhbKGkgKiAoaSArIDEpID4+IDEpICsgaiAtIDFdOwogICAgfQogICAgLyoqCiAgICAgKiBTZXQgYW4gZWxlbWVudAogICAgICovCgoKICAgIHNldChiaSwgYmosIHZhbHVlKSB7CiAgICAgIGxldCB7CiAgICAgICAgaW5kZXg6IGkKICAgICAgfSA9IGJpOwogICAgICBsZXQgewogICAgICAgIGluZGV4OiBqCiAgICAgIH0gPSBiajsKCiAgICAgIGlmIChqID4gaSkgewogICAgICAgIGNvbnN0IHRlbXAgPSBqOwogICAgICAgIGogPSBpOwogICAgICAgIGkgPSB0ZW1wOwogICAgICB9CgogICAgICB0aGlzLm1hdHJpeFsoaSAqIChpICsgMSkgPj4gMSkgKyBqIC0gMV0gPSB2YWx1ZSA/IDEgOiAwOwogICAgfQogICAgLyoqCiAgICAgKiBTZXRzIGFsbCBlbGVtZW50cyB0byB6ZXJvCiAgICAgKi8KCgogICAgcmVzZXQoKSB7CiAgICAgIGZvciAobGV0IGkgPSAwLCBsID0gdGhpcy5tYXRyaXgubGVuZ3RoOyBpICE9PSBsOyBpKyspIHsKICAgICAgICB0aGlzLm1hdHJpeFtpXSA9IDA7CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogU2V0cyB0aGUgbWF4IG51bWJlciBvZiBvYmplY3RzCiAgICAgKi8KCgogICAgc2V0TnVtT2JqZWN0cyhuKSB7CiAgICAgIHRoaXMubWF0cml4Lmxlbmd0aCA9IG4gKiAobiAtIDEpID4+IDE7CiAgICB9CgogIH0KCiAgLyoqCiAgICogQmFzZSBjbGFzcyBmb3Igb2JqZWN0cyB0aGF0IGRpc3BhdGNoZXMgZXZlbnRzLgogICAqLwogIGNsYXNzIEV2ZW50VGFyZ2V0IHsKICAgIC8qKgogICAgICogQWRkIGFuIGV2ZW50IGxpc3RlbmVyCiAgICAgKiBAcmV0dXJuIFRoZSBzZWxmIG9iamVjdCwgZm9yIGNoYWluYWJpbGl0eS4KICAgICAqLwogICAgYWRkRXZlbnRMaXN0ZW5lcih0eXBlLCBsaXN0ZW5lcikgewogICAgICBpZiAodGhpcy5fbGlzdGVuZXJzID09PSB1bmRlZmluZWQpIHsKICAgICAgICB0aGlzLl9saXN0ZW5lcnMgPSB7fTsKICAgICAgfQoKICAgICAgY29uc3QgbGlzdGVuZXJzID0gdGhpcy5fbGlzdGVuZXJzOwoKICAgICAgaWYgKGxpc3RlbmVyc1t0eXBlXSA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgbGlzdGVuZXJzW3R5cGVdID0gW107CiAgICAgIH0KCiAgICAgIGlmICghbGlzdGVuZXJzW3R5cGVdLmluY2x1ZGVzKGxpc3RlbmVyKSkgewogICAgICAgIGxpc3RlbmVyc1t0eXBlXS5wdXNoKGxpc3RlbmVyKTsKICAgICAgfQoKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICAvKioKICAgICAqIENoZWNrIGlmIGFuIGV2ZW50IGxpc3RlbmVyIGlzIGFkZGVkCiAgICAgKi8KCgogICAgaGFzRXZlbnRMaXN0ZW5lcih0eXBlLCBsaXN0ZW5lcikgewogICAgICBpZiAodGhpcy5fbGlzdGVuZXJzID09PSB1bmRlZmluZWQpIHsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0KCiAgICAgIGNvbnN0IGxpc3RlbmVycyA9IHRoaXMuX2xpc3RlbmVyczsKCiAgICAgIGlmIChsaXN0ZW5lcnNbdHlwZV0gIT09IHVuZGVmaW5lZCAmJiBsaXN0ZW5lcnNbdHlwZV0uaW5jbHVkZXMobGlzdGVuZXIpKSB7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgIH0KCiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KICAgIC8qKgogICAgICogQ2hlY2sgaWYgYW55IGV2ZW50IGxpc3RlbmVyIG9mIHRoZSBnaXZlbiB0eXBlIGlzIGFkZGVkCiAgICAgKi8KCgogICAgaGFzQW55RXZlbnRMaXN0ZW5lcih0eXBlKSB7CiAgICAgIGlmICh0aGlzLl9saXN0ZW5lcnMgPT09IHVuZGVmaW5lZCkgewogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQoKICAgICAgY29uc3QgbGlzdGVuZXJzID0gdGhpcy5fbGlzdGVuZXJzOwogICAgICByZXR1cm4gbGlzdGVuZXJzW3R5cGVdICE9PSB1bmRlZmluZWQ7CiAgICB9CiAgICAvKioKICAgICAqIFJlbW92ZSBhbiBldmVudCBsaXN0ZW5lcgogICAgICogQHJldHVybiBUaGUgc2VsZiBvYmplY3QsIGZvciBjaGFpbmFiaWxpdHkuCiAgICAgKi8KCgogICAgcmVtb3ZlRXZlbnRMaXN0ZW5lcih0eXBlLCBsaXN0ZW5lcikgewogICAgICBpZiAodGhpcy5fbGlzdGVuZXJzID09PSB1bmRlZmluZWQpIHsKICAgICAgICByZXR1cm4gdGhpczsKICAgICAgfQoKICAgICAgY29uc3QgbGlzdGVuZXJzID0gdGhpcy5fbGlzdGVuZXJzOwoKICAgICAgaWYgKGxpc3RlbmVyc1t0eXBlXSA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgIH0KCiAgICAgIGNvbnN0IGluZGV4ID0gbGlzdGVuZXJzW3R5cGVdLmluZGV4T2YobGlzdGVuZXIpOwoKICAgICAgaWYgKGluZGV4ICE9PSAtMSkgewogICAgICAgIGxpc3RlbmVyc1t0eXBlXS5zcGxpY2UoaW5kZXgsIDEpOwogICAgICB9CgogICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIC8qKgogICAgICogRW1pdCBhbiBldmVudC4KICAgICAqIEByZXR1cm4gVGhlIHNlbGYgb2JqZWN0LCBmb3IgY2hhaW5hYmlsaXR5LgogICAgICovCgoKICAgIGRpc3BhdGNoRXZlbnQoZXZlbnQpIHsKICAgICAgaWYgKHRoaXMuX2xpc3RlbmVycyA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgIH0KCiAgICAgIGNvbnN0IGxpc3RlbmVycyA9IHRoaXMuX2xpc3RlbmVyczsKICAgICAgY29uc3QgbGlzdGVuZXJBcnJheSA9IGxpc3RlbmVyc1tldmVudC50eXBlXTsKCiAgICAgIGlmIChsaXN0ZW5lckFycmF5ICE9PSB1bmRlZmluZWQpIHsKICAgICAgICBldmVudC50YXJnZXQgPSB0aGlzOwoKICAgICAgICBmb3IgKGxldCBpID0gMCwgbCA9IGxpc3RlbmVyQXJyYXkubGVuZ3RoOyBpIDwgbDsgaSsrKSB7CiAgICAgICAgICBsaXN0ZW5lckFycmF5W2ldLmNhbGwodGhpcywgZXZlbnQpOwogICAgICAgIH0KICAgICAgfQoKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CgogIH0KCiAgLyoqCiAgICogQSBRdWF0ZXJuaW9uIGRlc2NyaWJlcyBhIHJvdGF0aW9uIGluIDNEIHNwYWNlLiBUaGUgUXVhdGVybmlvbiBpcyBtYXRoZW1hdGljYWxseSBkZWZpbmVkIGFzIFEgPSB4KmkgKyB5KmogKyB6KmsgKyB3LCB3aGVyZSAoaSxqLGspIGFyZSBpbWFnaW5hcnkgYmFzaXMgdmVjdG9ycy4gKHgseSx6KSBjYW4gYmUgc2VlbiBhcyBhIHZlY3RvciByZWxhdGVkIHRvIHRoZSBheGlzIG9mIHJvdGF0aW9uLCB3aGlsZSB0aGUgcmVhbCBtdWx0aXBsaWVyLCB3LCBpcyByZWxhdGVkIHRvIHRoZSBhbW91bnQgb2Ygcm90YXRpb24uCiAgICogQHBhcmFtIHggTXVsdGlwbGllciBvZiB0aGUgaW1hZ2luYXJ5IGJhc2lzIHZlY3RvciBpLgogICAqIEBwYXJhbSB5IE11bHRpcGxpZXIgb2YgdGhlIGltYWdpbmFyeSBiYXNpcyB2ZWN0b3Igai4KICAgKiBAcGFyYW0geiBNdWx0aXBsaWVyIG9mIHRoZSBpbWFnaW5hcnkgYmFzaXMgdmVjdG9yIGsuCiAgICogQHBhcmFtIHcgTXVsdGlwbGllciBvZiB0aGUgcmVhbCBwYXJ0LgogICAqIEBzZWUgaHR0cDovL2VuLndpa2lwZWRpYS5vcmcvd2lraS9RdWF0ZXJuaW9uCiAgICovCgogIGNsYXNzIFF1YXRlcm5pb24gewogICAgY29uc3RydWN0b3IoeCwgeSwgeiwgdykgewogICAgICBpZiAoeCA9PT0gdm9pZCAwKSB7CiAgICAgICAgeCA9IDA7CiAgICAgIH0KCiAgICAgIGlmICh5ID09PSB2b2lkIDApIHsKICAgICAgICB5ID0gMDsKICAgICAgfQoKICAgICAgaWYgKHogPT09IHZvaWQgMCkgewogICAgICAgIHogPSAwOwogICAgICB9CgogICAgICBpZiAodyA9PT0gdm9pZCAwKSB7CiAgICAgICAgdyA9IDE7CiAgICAgIH0KCiAgICAgIHRoaXMueCA9IHg7CiAgICAgIHRoaXMueSA9IHk7CiAgICAgIHRoaXMueiA9IHo7CiAgICAgIHRoaXMudyA9IHc7CiAgICB9CiAgICAvKioKICAgICAqIFNldCB0aGUgdmFsdWUgb2YgdGhlIHF1YXRlcm5pb24uCiAgICAgKi8KCgogICAgc2V0KHgsIHksIHosIHcpIHsKICAgICAgdGhpcy54ID0geDsKICAgICAgdGhpcy55ID0geTsKICAgICAgdGhpcy56ID0gejsKICAgICAgdGhpcy53ID0gdzsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICAvKioKICAgICAqIENvbnZlcnQgdG8gYSByZWFkYWJsZSBmb3JtYXQKICAgICAqIEByZXR1cm4gIngseSx6LHciCiAgICAgKi8KCgogICAgdG9TdHJpbmcoKSB7CiAgICAgIHJldHVybiBgJHt0aGlzLnh9LCR7dGhpcy55fSwke3RoaXMuen0sJHt0aGlzLnd9YDsKICAgIH0KICAgIC8qKgogICAgICogQ29udmVydCB0byBhbiBBcnJheQogICAgICogQHJldHVybiBbeCwgeSwgeiwgd10KICAgICAqLwoKCiAgICB0b0FycmF5KCkgewogICAgICByZXR1cm4gW3RoaXMueCwgdGhpcy55LCB0aGlzLnosIHRoaXMud107CiAgICB9CiAgICAvKioKICAgICAqIFNldCB0aGUgcXVhdGVybmlvbiBjb21wb25lbnRzIGdpdmVuIGFuIGF4aXMgYW5kIGFuIGFuZ2xlIGluIHJhZGlhbnMuCiAgICAgKi8KCgogICAgc2V0RnJvbUF4aXNBbmdsZSh2ZWN0b3IsIGFuZ2xlKSB7CiAgICAgIGNvbnN0IHMgPSBNYXRoLnNpbihhbmdsZSAqIDAuNSk7CiAgICAgIHRoaXMueCA9IHZlY3Rvci54ICogczsKICAgICAgdGhpcy55ID0gdmVjdG9yLnkgKiBzOwogICAgICB0aGlzLnogPSB2ZWN0b3IueiAqIHM7CiAgICAgIHRoaXMudyA9IE1hdGguY29zKGFuZ2xlICogMC41KTsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICAvKioKICAgICAqIENvbnZlcnRzIHRoZSBxdWF0ZXJuaW9uIHRvIFsgYXhpcywgYW5nbGUgXSByZXByZXNlbnRhdGlvbi4KICAgICAqIEBwYXJhbSB0YXJnZXRBeGlzIEEgdmVjdG9yIG9iamVjdCB0byByZXVzZSBmb3Igc3RvcmluZyB0aGUgYXhpcy4KICAgICAqIEByZXR1cm4gQW4gYXJyYXksIGZpcnN0IGVsZW1lbnQgaXMgdGhlIGF4aXMgYW5kIHRoZSBzZWNvbmQgaXMgdGhlIGFuZ2xlIGluIHJhZGlhbnMuCiAgICAgKi8KCgogICAgdG9BeGlzQW5nbGUodGFyZ2V0QXhpcykgewogICAgICBpZiAodGFyZ2V0QXhpcyA9PT0gdm9pZCAwKSB7CiAgICAgICAgdGFyZ2V0QXhpcyA9IG5ldyBWZWMzKCk7CiAgICAgIH0KCiAgICAgIHRoaXMubm9ybWFsaXplKCk7IC8vIGlmIHc+MSBhY29zIGFuZCBzcXJ0IHdpbGwgcHJvZHVjZSBlcnJvcnMsIHRoaXMgY2FudCBoYXBwZW4gaWYgcXVhdGVybmlvbiBpcyBub3JtYWxpc2VkCgogICAgICBjb25zdCBhbmdsZSA9IDIgKiBNYXRoLmFjb3ModGhpcy53KTsKICAgICAgY29uc3QgcyA9IE1hdGguc3FydCgxIC0gdGhpcy53ICogdGhpcy53KTsgLy8gYXNzdW1pbmcgcXVhdGVybmlvbiBub3JtYWxpc2VkIHRoZW4gdyBpcyBsZXNzIHRoYW4gMSwgc28gdGVybSBhbHdheXMgcG9zaXRpdmUuCgogICAgICBpZiAocyA8IDAuMDAxKSB7CiAgICAgICAgLy8gdGVzdCB0byBhdm9pZCBkaXZpZGUgYnkgemVybywgcyBpcyBhbHdheXMgcG9zaXRpdmUgZHVlIHRvIHNxcnQKICAgICAgICAvLyBpZiBzIGNsb3NlIHRvIHplcm8gdGhlbiBkaXJlY3Rpb24gb2YgYXhpcyBub3QgaW1wb3J0YW50CiAgICAgICAgdGFyZ2V0QXhpcy54ID0gdGhpcy54OyAvLyBpZiBpdCBpcyBpbXBvcnRhbnQgdGhhdCBheGlzIGlzIG5vcm1hbGlzZWQgdGhlbiByZXBsYWNlIHdpdGggeD0xOyB5PXo9MDsKCiAgICAgICAgdGFyZ2V0QXhpcy55ID0gdGhpcy55OwogICAgICAgIHRhcmdldEF4aXMueiA9IHRoaXMuejsKICAgICAgfSBlbHNlIHsKICAgICAgICB0YXJnZXRBeGlzLnggPSB0aGlzLnggLyBzOyAvLyBub3JtYWxpc2UgYXhpcwoKICAgICAgICB0YXJnZXRBeGlzLnkgPSB0aGlzLnkgLyBzOwogICAgICAgIHRhcmdldEF4aXMueiA9IHRoaXMueiAvIHM7CiAgICAgIH0KCiAgICAgIHJldHVybiBbdGFyZ2V0QXhpcywgYW5nbGVdOwogICAgfQogICAgLyoqCiAgICAgKiBTZXQgdGhlIHF1YXRlcm5pb24gdmFsdWUgZ2l2ZW4gdHdvIHZlY3RvcnMuIFRoZSByZXN1bHRpbmcgcm90YXRpb24gd2lsbCBiZSB0aGUgbmVlZGVkIHJvdGF0aW9uIHRvIHJvdGF0ZSB1IHRvIHYuCiAgICAgKi8KCgogICAgc2V0RnJvbVZlY3RvcnModSwgdikgewogICAgICBpZiAodS5pc0FudGlwYXJhbGxlbFRvKHYpKSB7CiAgICAgICAgY29uc3QgdDEgPSBzZnZfdDE7CiAgICAgICAgY29uc3QgdDIgPSBzZnZfdDI7CiAgICAgICAgdS50YW5nZW50cyh0MSwgdDIpOwogICAgICAgIHRoaXMuc2V0RnJvbUF4aXNBbmdsZSh0MSwgTWF0aC5QSSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgY29uc3QgYSA9IHUuY3Jvc3Modik7CiAgICAgICAgdGhpcy54ID0gYS54OwogICAgICAgIHRoaXMueSA9IGEueTsKICAgICAgICB0aGlzLnogPSBhLno7CiAgICAgICAgdGhpcy53ID0gTWF0aC5zcXJ0KHUubGVuZ3RoKCkgKiogMiAqIHYubGVuZ3RoKCkgKiogMikgKyB1LmRvdCh2KTsKICAgICAgICB0aGlzLm5vcm1hbGl6ZSgpOwogICAgICB9CgogICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIC8qKgogICAgICogTXVsdGlwbHkgdGhlIHF1YXRlcm5pb24gd2l0aCBhbiBvdGhlciBxdWF0ZXJuaW9uLgogICAgICovCgoKICAgIG11bHQocXVhdCwgdGFyZ2V0KSB7CiAgICAgIGlmICh0YXJnZXQgPT09IHZvaWQgMCkgewogICAgICAgIHRhcmdldCA9IG5ldyBRdWF0ZXJuaW9uKCk7CiAgICAgIH0KCiAgICAgIGNvbnN0IGF4ID0gdGhpcy54OwogICAgICBjb25zdCBheSA9IHRoaXMueTsKICAgICAgY29uc3QgYXogPSB0aGlzLno7CiAgICAgIGNvbnN0IGF3ID0gdGhpcy53OwogICAgICBjb25zdCBieCA9IHF1YXQueDsKICAgICAgY29uc3QgYnkgPSBxdWF0Lnk7CiAgICAgIGNvbnN0IGJ6ID0gcXVhdC56OwogICAgICBjb25zdCBidyA9IHF1YXQudzsKICAgICAgdGFyZ2V0LnggPSBheCAqIGJ3ICsgYXcgKiBieCArIGF5ICogYnogLSBheiAqIGJ5OwogICAgICB0YXJnZXQueSA9IGF5ICogYncgKyBhdyAqIGJ5ICsgYXogKiBieCAtIGF4ICogYno7CiAgICAgIHRhcmdldC56ID0gYXogKiBidyArIGF3ICogYnogKyBheCAqIGJ5IC0gYXkgKiBieDsKICAgICAgdGFyZ2V0LncgPSBhdyAqIGJ3IC0gYXggKiBieCAtIGF5ICogYnkgLSBheiAqIGJ6OwogICAgICByZXR1cm4gdGFyZ2V0OwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgdGhlIGludmVyc2UgcXVhdGVybmlvbiByb3RhdGlvbi4KICAgICAqLwoKCiAgICBpbnZlcnNlKHRhcmdldCkgewogICAgICBpZiAodGFyZ2V0ID09PSB2b2lkIDApIHsKICAgICAgICB0YXJnZXQgPSBuZXcgUXVhdGVybmlvbigpOwogICAgICB9CgogICAgICBjb25zdCB4ID0gdGhpcy54OwogICAgICBjb25zdCB5ID0gdGhpcy55OwogICAgICBjb25zdCB6ID0gdGhpcy56OwogICAgICBjb25zdCB3ID0gdGhpcy53OwogICAgICB0aGlzLmNvbmp1Z2F0ZSh0YXJnZXQpOwogICAgICBjb25zdCBpbm9ybTIgPSAxIC8gKHggKiB4ICsgeSAqIHkgKyB6ICogeiArIHcgKiB3KTsKICAgICAgdGFyZ2V0LnggKj0gaW5vcm0yOwogICAgICB0YXJnZXQueSAqPSBpbm9ybTI7CiAgICAgIHRhcmdldC56ICo9IGlub3JtMjsKICAgICAgdGFyZ2V0LncgKj0gaW5vcm0yOwogICAgICByZXR1cm4gdGFyZ2V0OwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgdGhlIHF1YXRlcm5pb24gY29uanVnYXRlCiAgICAgKi8KCgogICAgY29uanVnYXRlKHRhcmdldCkgewogICAgICBpZiAodGFyZ2V0ID09PSB2b2lkIDApIHsKICAgICAgICB0YXJnZXQgPSBuZXcgUXVhdGVybmlvbigpOwogICAgICB9CgogICAgICB0YXJnZXQueCA9IC10aGlzLng7CiAgICAgIHRhcmdldC55ID0gLXRoaXMueTsKICAgICAgdGFyZ2V0LnogPSAtdGhpcy56OwogICAgICB0YXJnZXQudyA9IHRoaXMudzsKICAgICAgcmV0dXJuIHRhcmdldDsKICAgIH0KICAgIC8qKgogICAgICogTm9ybWFsaXplIHRoZSBxdWF0ZXJuaW9uLiBOb3RlIHRoYXQgdGhpcyBjaGFuZ2VzIHRoZSB2YWx1ZXMgb2YgdGhlIHF1YXRlcm5pb24uCiAgICAgKi8KCgogICAgbm9ybWFsaXplKCkgewogICAgICBsZXQgbCA9IE1hdGguc3FydCh0aGlzLnggKiB0aGlzLnggKyB0aGlzLnkgKiB0aGlzLnkgKyB0aGlzLnogKiB0aGlzLnogKyB0aGlzLncgKiB0aGlzLncpOwoKICAgICAgaWYgKGwgPT09IDApIHsKICAgICAgICB0aGlzLnggPSAwOwogICAgICAgIHRoaXMueSA9IDA7CiAgICAgICAgdGhpcy56ID0gMDsKICAgICAgICB0aGlzLncgPSAwOwogICAgICB9IGVsc2UgewogICAgICAgIGwgPSAxIC8gbDsKICAgICAgICB0aGlzLnggKj0gbDsKICAgICAgICB0aGlzLnkgKj0gbDsKICAgICAgICB0aGlzLnogKj0gbDsKICAgICAgICB0aGlzLncgKj0gbDsKICAgICAgfQoKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICAvKioKICAgICAqIEFwcHJveGltYXRpb24gb2YgcXVhdGVybmlvbiBub3JtYWxpemF0aW9uLiBXb3JrcyBiZXN0IHdoZW4gcXVhdCBpcyBhbHJlYWR5IGFsbW9zdC1ub3JtYWxpemVkLgogICAgICogQGF1dGhvciB1bnBoYXNlZCwgaHR0cHM6Ly9naXRodWIuY29tL3VucGhhc2VkCiAgICAgKi8KCgogICAgbm9ybWFsaXplRmFzdCgpIHsKICAgICAgY29uc3QgZiA9ICgzLjAgLSAodGhpcy54ICogdGhpcy54ICsgdGhpcy55ICogdGhpcy55ICsgdGhpcy56ICogdGhpcy56ICsgdGhpcy53ICogdGhpcy53KSkgLyAyLjA7CgogICAgICBpZiAoZiA9PT0gMCkgewogICAgICAgIHRoaXMueCA9IDA7CiAgICAgICAgdGhpcy55ID0gMDsKICAgICAgICB0aGlzLnogPSAwOwogICAgICAgIHRoaXMudyA9IDA7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy54ICo9IGY7CiAgICAgICAgdGhpcy55ICo9IGY7CiAgICAgICAgdGhpcy56ICo9IGY7CiAgICAgICAgdGhpcy53ICo9IGY7CiAgICAgIH0KCiAgICAgIHJldHVybiB0aGlzOwogICAgfQogICAgLyoqCiAgICAgKiBNdWx0aXBseSB0aGUgcXVhdGVybmlvbiBieSBhIHZlY3RvcgogICAgICovCgoKICAgIHZtdWx0KHYsIHRhcmdldCkgewogICAgICBpZiAodGFyZ2V0ID09PSB2b2lkIDApIHsKICAgICAgICB0YXJnZXQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICBjb25zdCB4ID0gdi54OwogICAgICBjb25zdCB5ID0gdi55OwogICAgICBjb25zdCB6ID0gdi56OwogICAgICBjb25zdCBxeCA9IHRoaXMueDsKICAgICAgY29uc3QgcXkgPSB0aGlzLnk7CiAgICAgIGNvbnN0IHF6ID0gdGhpcy56OwogICAgICBjb25zdCBxdyA9IHRoaXMudzsgLy8gcSp2CgogICAgICBjb25zdCBpeCA9IHF3ICogeCArIHF5ICogeiAtIHF6ICogeTsKICAgICAgY29uc3QgaXkgPSBxdyAqIHkgKyBxeiAqIHggLSBxeCAqIHo7CiAgICAgIGNvbnN0IGl6ID0gcXcgKiB6ICsgcXggKiB5IC0gcXkgKiB4OwogICAgICBjb25zdCBpdyA9IC1xeCAqIHggLSBxeSAqIHkgLSBxeiAqIHo7CiAgICAgIHRhcmdldC54ID0gaXggKiBxdyArIGl3ICogLXF4ICsgaXkgKiAtcXogLSBpeiAqIC1xeTsKICAgICAgdGFyZ2V0LnkgPSBpeSAqIHF3ICsgaXcgKiAtcXkgKyBpeiAqIC1xeCAtIGl4ICogLXF6OwogICAgICB0YXJnZXQueiA9IGl6ICogcXcgKyBpdyAqIC1xeiArIGl4ICogLXF5IC0gaXkgKiAtcXg7CiAgICAgIHJldHVybiB0YXJnZXQ7CiAgICB9CiAgICAvKioKICAgICAqIENvcGllcyB2YWx1ZSBvZiBzb3VyY2UgdG8gdGhpcyBxdWF0ZXJuaW9uLgogICAgICogQHJldHVybiB0aGlzCiAgICAgKi8KCgogICAgY29weShxdWF0KSB7CiAgICAgIHRoaXMueCA9IHF1YXQueDsKICAgICAgdGhpcy55ID0gcXVhdC55OwogICAgICB0aGlzLnogPSBxdWF0Lno7CiAgICAgIHRoaXMudyA9IHF1YXQudzsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICAvKioKICAgICAqIENvbnZlcnQgdGhlIHF1YXRlcm5pb24gdG8gZXVsZXIgYW5nbGUgcmVwcmVzZW50YXRpb24uIE9yZGVyOiBZWlgsIGFzIHRoaXMgcGFnZSBkZXNjcmliZXM6IGh0dHBzOi8vd3d3LmV1Y2xpZGVhbnNwYWNlLmNvbS9tYXRocy9zdGFuZGFyZHMvaW5kZXguaHRtCiAgICAgKiBAcGFyYW0gb3JkZXIgVGhyZWUtY2hhcmFjdGVyIHN0cmluZywgZGVmYXVsdHMgdG8gIllaWCIKICAgICAqLwoKCiAgICB0b0V1bGVyKHRhcmdldCwgb3JkZXIpIHsKICAgICAgaWYgKG9yZGVyID09PSB2b2lkIDApIHsKICAgICAgICBvcmRlciA9ICdZWlgnOwogICAgICB9CgogICAgICBsZXQgaGVhZGluZzsKICAgICAgbGV0IGF0dGl0dWRlOwogICAgICBsZXQgYmFuazsKICAgICAgY29uc3QgeCA9IHRoaXMueDsKICAgICAgY29uc3QgeSA9IHRoaXMueTsKICAgICAgY29uc3QgeiA9IHRoaXMuejsKICAgICAgY29uc3QgdyA9IHRoaXMudzsKCiAgICAgIHN3aXRjaCAob3JkZXIpIHsKICAgICAgICBjYXNlICdZWlgnOgogICAgICAgICAgY29uc3QgdGVzdCA9IHggKiB5ICsgeiAqIHc7CgogICAgICAgICAgaWYgKHRlc3QgPiAwLjQ5OSkgewogICAgICAgICAgICAvLyBzaW5ndWxhcml0eSBhdCBub3J0aCBwb2xlCiAgICAgICAgICAgIGhlYWRpbmcgPSAyICogTWF0aC5hdGFuMih4LCB3KTsKICAgICAgICAgICAgYXR0aXR1ZGUgPSBNYXRoLlBJIC8gMjsKICAgICAgICAgICAgYmFuayA9IDA7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKHRlc3QgPCAtMC40OTkpIHsKICAgICAgICAgICAgLy8gc2luZ3VsYXJpdHkgYXQgc291dGggcG9sZQogICAgICAgICAgICBoZWFkaW5nID0gLTIgKiBNYXRoLmF0YW4yKHgsIHcpOwogICAgICAgICAgICBhdHRpdHVkZSA9IC1NYXRoLlBJIC8gMjsKICAgICAgICAgICAgYmFuayA9IDA7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKGhlYWRpbmcgPT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICBjb25zdCBzcXggPSB4ICogeDsKICAgICAgICAgICAgY29uc3Qgc3F5ID0geSAqIHk7CiAgICAgICAgICAgIGNvbnN0IHNxeiA9IHogKiB6OwogICAgICAgICAgICBoZWFkaW5nID0gTWF0aC5hdGFuMigyICogeSAqIHcgLSAyICogeCAqIHosIDEgLSAyICogc3F5IC0gMiAqIHNxeik7IC8vIEhlYWRpbmcKCiAgICAgICAgICAgIGF0dGl0dWRlID0gTWF0aC5hc2luKDIgKiB0ZXN0KTsgLy8gYXR0aXR1ZGUKCiAgICAgICAgICAgIGJhbmsgPSBNYXRoLmF0YW4yKDIgKiB4ICogdyAtIDIgKiB5ICogeiwgMSAtIDIgKiBzcXggLSAyICogc3F6KTsgLy8gYmFuawogICAgICAgICAgfQoKICAgICAgICAgIGJyZWFrOwoKICAgICAgICBkZWZhdWx0OgogICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBFdWxlciBvcmRlciAke29yZGVyfSBub3Qgc3VwcG9ydGVkIHlldC5gKTsKICAgICAgfQoKICAgICAgdGFyZ2V0LnkgPSBoZWFkaW5nOwogICAgICB0YXJnZXQueiA9IGF0dGl0dWRlOwogICAgICB0YXJnZXQueCA9IGJhbms7CiAgICB9CiAgICAvKioKICAgICAqIFNldCB0aGUgcXVhdGVybmlvbiBjb21wb25lbnRzIGdpdmVuIEV1bGVyIGFuZ2xlIHJlcHJlc2VudGF0aW9uLgogICAgICoKICAgICAqIEBwYXJhbSBvcmRlciBUaGUgb3JkZXIgdG8gYXBwbHkgYW5nbGVzOiAnWFlaJyBvciAnWVhaJyBvciBhbnkgb3RoZXIgY29tYmluYXRpb24uCiAgICAgKgogICAgICogU2VlIHtAbGluayBodHRwczovL3d3dy5tYXRod29ya3MuY29tL21hdGxhYmNlbnRyYWwvZmlsZWV4Y2hhbmdlLzIwNjk2LWZ1bmN0aW9uLXRvLWNvbnZlcnQtYmV0d2Vlbi1kY20tZXVsZXItYW5nbGVzLXF1YXRlcm5pb25zLWFuZC1ldWxlci12ZWN0b3JzIE1hdGhXb3Jrc30gcmVmZXJlbmNlCiAgICAgKi8KCgogICAgc2V0RnJvbUV1bGVyKHgsIHksIHosIG9yZGVyKSB7CiAgICAgIGlmIChvcmRlciA9PT0gdm9pZCAwKSB7CiAgICAgICAgb3JkZXIgPSAnWFlaJzsKICAgICAgfQoKICAgICAgY29uc3QgYzEgPSBNYXRoLmNvcyh4IC8gMik7CiAgICAgIGNvbnN0IGMyID0gTWF0aC5jb3MoeSAvIDIpOwogICAgICBjb25zdCBjMyA9IE1hdGguY29zKHogLyAyKTsKICAgICAgY29uc3QgczEgPSBNYXRoLnNpbih4IC8gMik7CiAgICAgIGNvbnN0IHMyID0gTWF0aC5zaW4oeSAvIDIpOwogICAgICBjb25zdCBzMyA9IE1hdGguc2luKHogLyAyKTsKCiAgICAgIGlmIChvcmRlciA9PT0gJ1hZWicpIHsKICAgICAgICB0aGlzLnggPSBzMSAqIGMyICogYzMgKyBjMSAqIHMyICogczM7CiAgICAgICAgdGhpcy55ID0gYzEgKiBzMiAqIGMzIC0gczEgKiBjMiAqIHMzOwogICAgICAgIHRoaXMueiA9IGMxICogYzIgKiBzMyArIHMxICogczIgKiBjMzsKICAgICAgICB0aGlzLncgPSBjMSAqIGMyICogYzMgLSBzMSAqIHMyICogczM7CiAgICAgIH0gZWxzZSBpZiAob3JkZXIgPT09ICdZWFonKSB7CiAgICAgICAgdGhpcy54ID0gczEgKiBjMiAqIGMzICsgYzEgKiBzMiAqIHMzOwogICAgICAgIHRoaXMueSA9IGMxICogczIgKiBjMyAtIHMxICogYzIgKiBzMzsKICAgICAgICB0aGlzLnogPSBjMSAqIGMyICogczMgLSBzMSAqIHMyICogYzM7CiAgICAgICAgdGhpcy53ID0gYzEgKiBjMiAqIGMzICsgczEgKiBzMiAqIHMzOwogICAgICB9IGVsc2UgaWYgKG9yZGVyID09PSAnWlhZJykgewogICAgICAgIHRoaXMueCA9IHMxICogYzIgKiBjMyAtIGMxICogczIgKiBzMzsKICAgICAgICB0aGlzLnkgPSBjMSAqIHMyICogYzMgKyBzMSAqIGMyICogczM7CiAgICAgICAgdGhpcy56ID0gYzEgKiBjMiAqIHMzICsgczEgKiBzMiAqIGMzOwogICAgICAgIHRoaXMudyA9IGMxICogYzIgKiBjMyAtIHMxICogczIgKiBzMzsKICAgICAgfSBlbHNlIGlmIChvcmRlciA9PT0gJ1pZWCcpIHsKICAgICAgICB0aGlzLnggPSBzMSAqIGMyICogYzMgLSBjMSAqIHMyICogczM7CiAgICAgICAgdGhpcy55ID0gYzEgKiBzMiAqIGMzICsgczEgKiBjMiAqIHMzOwogICAgICAgIHRoaXMueiA9IGMxICogYzIgKiBzMyAtIHMxICogczIgKiBjMzsKICAgICAgICB0aGlzLncgPSBjMSAqIGMyICogYzMgKyBzMSAqIHMyICogczM7CiAgICAgIH0gZWxzZSBpZiAob3JkZXIgPT09ICdZWlgnKSB7CiAgICAgICAgdGhpcy54ID0gczEgKiBjMiAqIGMzICsgYzEgKiBzMiAqIHMzOwogICAgICAgIHRoaXMueSA9IGMxICogczIgKiBjMyArIHMxICogYzIgKiBzMzsKICAgICAgICB0aGlzLnogPSBjMSAqIGMyICogczMgLSBzMSAqIHMyICogYzM7CiAgICAgICAgdGhpcy53ID0gYzEgKiBjMiAqIGMzIC0gczEgKiBzMiAqIHMzOwogICAgICB9IGVsc2UgaWYgKG9yZGVyID09PSAnWFpZJykgewogICAgICAgIHRoaXMueCA9IHMxICogYzIgKiBjMyAtIGMxICogczIgKiBzMzsKICAgICAgICB0aGlzLnkgPSBjMSAqIHMyICogYzMgLSBzMSAqIGMyICogczM7CiAgICAgICAgdGhpcy56ID0gYzEgKiBjMiAqIHMzICsgczEgKiBzMiAqIGMzOwogICAgICAgIHRoaXMudyA9IGMxICogYzIgKiBjMyArIHMxICogczIgKiBzMzsKICAgICAgfQoKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CgogICAgY2xvbmUoKSB7CiAgICAgIHJldHVybiBuZXcgUXVhdGVybmlvbih0aGlzLngsIHRoaXMueSwgdGhpcy56LCB0aGlzLncpOwogICAgfQogICAgLyoqCiAgICAgKiBQZXJmb3JtcyBhIHNwaGVyaWNhbCBsaW5lYXIgaW50ZXJwb2xhdGlvbiBiZXR3ZWVuIHR3byBxdWF0CiAgICAgKgogICAgICogQHBhcmFtIHRvUXVhdCBzZWNvbmQgb3BlcmFuZAogICAgICogQHBhcmFtIHQgaW50ZXJwb2xhdGlvbiBhbW91bnQgYmV0d2VlbiB0aGUgc2VsZiBxdWF0ZXJuaW9uIGFuZCB0b1F1YXQKICAgICAqIEBwYXJhbSB0YXJnZXQgQSBxdWF0ZXJuaW9uIHRvIHN0b3JlIHRoZSByZXN1bHQgaW4uIElmIG5vdCBwcm92aWRlZCwgYSBuZXcgb25lIHdpbGwgYmUgY3JlYXRlZC4KICAgICAqIEByZXR1cm5zIHtRdWF0ZXJuaW9ufSBUaGUgInRhcmdldCIgb2JqZWN0CiAgICAgKi8KCgogICAgc2xlcnAodG9RdWF0LCB0LCB0YXJnZXQpIHsKICAgICAgaWYgKHRhcmdldCA9PT0gdm9pZCAwKSB7CiAgICAgICAgdGFyZ2V0ID0gbmV3IFF1YXRlcm5pb24oKTsKICAgICAgfQoKICAgICAgY29uc3QgYXggPSB0aGlzLng7CiAgICAgIGNvbnN0IGF5ID0gdGhpcy55OwogICAgICBjb25zdCBheiA9IHRoaXMuejsKICAgICAgY29uc3QgYXcgPSB0aGlzLnc7CiAgICAgIGxldCBieCA9IHRvUXVhdC54OwogICAgICBsZXQgYnkgPSB0b1F1YXQueTsKICAgICAgbGV0IGJ6ID0gdG9RdWF0Lno7CiAgICAgIGxldCBidyA9IHRvUXVhdC53OwogICAgICBsZXQgb21lZ2E7CiAgICAgIGxldCBjb3NvbTsKICAgICAgbGV0IHNpbm9tOwogICAgICBsZXQgc2NhbGUwOwogICAgICBsZXQgc2NhbGUxOyAvLyBjYWxjIGNvc2luZQoKICAgICAgY29zb20gPSBheCAqIGJ4ICsgYXkgKiBieSArIGF6ICogYnogKyBhdyAqIGJ3OyAvLyBhZGp1c3Qgc2lnbnMgKGlmIG5lY2Vzc2FyeSkKCiAgICAgIGlmIChjb3NvbSA8IDAuMCkgewogICAgICAgIGNvc29tID0gLWNvc29tOwogICAgICAgIGJ4ID0gLWJ4OwogICAgICAgIGJ5ID0gLWJ5OwogICAgICAgIGJ6ID0gLWJ6OwogICAgICAgIGJ3ID0gLWJ3OwogICAgICB9IC8vIGNhbGN1bGF0ZSBjb2VmZmljaWVudHMKCgogICAgICBpZiAoMS4wIC0gY29zb20gPiAwLjAwMDAwMSkgewogICAgICAgIC8vIHN0YW5kYXJkIGNhc2UgKHNsZXJwKQogICAgICAgIG9tZWdhID0gTWF0aC5hY29zKGNvc29tKTsKICAgICAgICBzaW5vbSA9IE1hdGguc2luKG9tZWdhKTsKICAgICAgICBzY2FsZTAgPSBNYXRoLnNpbigoMS4wIC0gdCkgKiBvbWVnYSkgLyBzaW5vbTsKICAgICAgICBzY2FsZTEgPSBNYXRoLnNpbih0ICogb21lZ2EpIC8gc2lub207CiAgICAgIH0gZWxzZSB7CiAgICAgICAgLy8gImZyb20iIGFuZCAidG8iIHF1YXRlcm5pb25zIGFyZSB2ZXJ5IGNsb3NlCiAgICAgICAgLy8gIC4uLiBzbyB3ZSBjYW4gZG8gYSBsaW5lYXIgaW50ZXJwb2xhdGlvbgogICAgICAgIHNjYWxlMCA9IDEuMCAtIHQ7CiAgICAgICAgc2NhbGUxID0gdDsKICAgICAgfSAvLyBjYWxjdWxhdGUgZmluYWwgdmFsdWVzCgoKICAgICAgdGFyZ2V0LnggPSBzY2FsZTAgKiBheCArIHNjYWxlMSAqIGJ4OwogICAgICB0YXJnZXQueSA9IHNjYWxlMCAqIGF5ICsgc2NhbGUxICogYnk7CiAgICAgIHRhcmdldC56ID0gc2NhbGUwICogYXogKyBzY2FsZTEgKiBiejsKICAgICAgdGFyZ2V0LncgPSBzY2FsZTAgKiBhdyArIHNjYWxlMSAqIGJ3OwogICAgICByZXR1cm4gdGFyZ2V0OwogICAgfQogICAgLyoqCiAgICAgKiBSb3RhdGUgYW4gYWJzb2x1dGUgb3JpZW50YXRpb24gcXVhdGVybmlvbiBnaXZlbiBhbiBhbmd1bGFyIHZlbG9jaXR5IGFuZCBhIHRpbWUgc3RlcC4KICAgICAqLwoKCiAgICBpbnRlZ3JhdGUoYW5ndWxhclZlbG9jaXR5LCBkdCwgYW5ndWxhckZhY3RvciwgdGFyZ2V0KSB7CiAgICAgIGlmICh0YXJnZXQgPT09IHZvaWQgMCkgewogICAgICAgIHRhcmdldCA9IG5ldyBRdWF0ZXJuaW9uKCk7CiAgICAgIH0KCiAgICAgIGNvbnN0IGF4ID0gYW5ndWxhclZlbG9jaXR5LnggKiBhbmd1bGFyRmFjdG9yLngsCiAgICAgICAgICAgIGF5ID0gYW5ndWxhclZlbG9jaXR5LnkgKiBhbmd1bGFyRmFjdG9yLnksCiAgICAgICAgICAgIGF6ID0gYW5ndWxhclZlbG9jaXR5LnogKiBhbmd1bGFyRmFjdG9yLnosCiAgICAgICAgICAgIGJ4ID0gdGhpcy54LAogICAgICAgICAgICBieSA9IHRoaXMueSwKICAgICAgICAgICAgYnogPSB0aGlzLnosCiAgICAgICAgICAgIGJ3ID0gdGhpcy53OwogICAgICBjb25zdCBoYWxmX2R0ID0gZHQgKiAwLjU7CiAgICAgIHRhcmdldC54ICs9IGhhbGZfZHQgKiAoYXggKiBidyArIGF5ICogYnogLSBheiAqIGJ5KTsKICAgICAgdGFyZ2V0LnkgKz0gaGFsZl9kdCAqIChheSAqIGJ3ICsgYXogKiBieCAtIGF4ICogYnopOwogICAgICB0YXJnZXQueiArPSBoYWxmX2R0ICogKGF6ICogYncgKyBheCAqIGJ5IC0gYXkgKiBieCk7CiAgICAgIHRhcmdldC53ICs9IGhhbGZfZHQgKiAoLWF4ICogYnggLSBheSAqIGJ5IC0gYXogKiBieik7CiAgICAgIHJldHVybiB0YXJnZXQ7CiAgICB9CgogIH0KICBjb25zdCBzZnZfdDEgPSBuZXcgVmVjMygpOwogIGNvbnN0IHNmdl90MiA9IG5ldyBWZWMzKCk7CgogIC8qKgogICAqIFRoZSBhdmFpbGFibGUgc2hhcGUgdHlwZXMuCiAgICovCiAgY29uc3QgU0hBUEVfVFlQRVMgPSB7CiAgICAvKiogU1BIRVJFICovCiAgICBTUEhFUkU6IDEsCgogICAgLyoqIFBMQU5FICovCiAgICBQTEFORTogMiwKCiAgICAvKiogQk9YICovCiAgICBCT1g6IDQsCgogICAgLyoqIENPTVBPVU5EICovCiAgICBDT01QT1VORDogOCwKCiAgICAvKiogQ09OVkVYUE9MWUhFRFJPTiAqLwogICAgQ09OVkVYUE9MWUhFRFJPTjogMTYsCgogICAgLyoqIEhFSUdIVEZJRUxEICovCiAgICBIRUlHSFRGSUVMRDogMzIsCgogICAgLyoqIFBBUlRJQ0xFICovCiAgICBQQVJUSUNMRTogNjQsCgogICAgLyoqIENZTElOREVSICovCiAgICBDWUxJTkRFUjogMTI4LAoKICAgIC8qKiBUUklNRVNIICovCiAgICBUUklNRVNIOiAyNTYKICB9OwogIC8qKgogICAqIFNoYXBlVHlwZQogICAqLwoKICAvKioKICAgKiBCYXNlIGNsYXNzIGZvciBzaGFwZXMKICAgKi8KICBjbGFzcyBTaGFwZSB7CiAgICAvKioKICAgICAqIElkZW50aWZpZXIgb2YgdGhlIFNoYXBlLgogICAgICovCgogICAgLyoqCiAgICAgKiBUaGUgdHlwZSBvZiB0aGlzIHNoYXBlLiBNdXN0IGJlIHNldCB0byBhbiBpbnQgPiAwIGJ5IHN1YmNsYXNzZXMuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFRoZSBsb2NhbCBib3VuZGluZyBzcGhlcmUgcmFkaXVzIG9mIHRoaXMgc2hhcGUuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFdoZXRoZXIgdG8gcHJvZHVjZSBjb250YWN0IGZvcmNlcyB3aGVuIGluIGNvbnRhY3Qgd2l0aCBvdGhlciBib2RpZXMuIE5vdGUgdGhhdCBjb250YWN0cyB3aWxsIGJlIGdlbmVyYXRlZCwgYnV0IHRoZXkgd2lsbCBiZSBkaXNhYmxlZC4KICAgICAqIEBkZWZhdWx0IHRydWUKICAgICAqLwoKICAgIC8qKgogICAgICogQGRlZmF1bHQgMQogICAgICovCgogICAgLyoqCiAgICAgKiBAZGVmYXVsdCAtMQogICAgICovCgogICAgLyoqCiAgICAgKiBPcHRpb25hbCBtYXRlcmlhbCBvZiB0aGUgc2hhcGUgdGhhdCByZWd1bGF0ZXMgY29udGFjdCBwcm9wZXJ0aWVzLgogICAgICovCgogICAgLyoqCiAgICAgKiBUaGUgYm9keSB0byB3aGljaCB0aGUgc2hhcGUgaXMgYWRkZWQgdG8uCiAgICAgKi8KCiAgICAvKioKICAgICAqIEFsbCB0aGUgU2hhcGUgdHlwZXMuCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKG9wdGlvbnMpIHsKICAgICAgaWYgKG9wdGlvbnMgPT09IHZvaWQgMCkgewogICAgICAgIG9wdGlvbnMgPSB7fTsKICAgICAgfQoKICAgICAgdGhpcy5pZCA9IFNoYXBlLmlkQ291bnRlcisrOwogICAgICB0aGlzLnR5cGUgPSBvcHRpb25zLnR5cGUgfHwgMDsKICAgICAgdGhpcy5ib3VuZGluZ1NwaGVyZVJhZGl1cyA9IDA7CiAgICAgIHRoaXMuY29sbGlzaW9uUmVzcG9uc2UgPSBvcHRpb25zLmNvbGxpc2lvblJlc3BvbnNlID8gb3B0aW9ucy5jb2xsaXNpb25SZXNwb25zZSA6IHRydWU7CiAgICAgIHRoaXMuY29sbGlzaW9uRmlsdGVyR3JvdXAgPSBvcHRpb25zLmNvbGxpc2lvbkZpbHRlckdyb3VwICE9PSB1bmRlZmluZWQgPyBvcHRpb25zLmNvbGxpc2lvbkZpbHRlckdyb3VwIDogMTsKICAgICAgdGhpcy5jb2xsaXNpb25GaWx0ZXJNYXNrID0gb3B0aW9ucy5jb2xsaXNpb25GaWx0ZXJNYXNrICE9PSB1bmRlZmluZWQgPyBvcHRpb25zLmNvbGxpc2lvbkZpbHRlck1hc2sgOiAtMTsKICAgICAgdGhpcy5tYXRlcmlhbCA9IG9wdGlvbnMubWF0ZXJpYWwgPyBvcHRpb25zLm1hdGVyaWFsIDogbnVsbDsKICAgICAgdGhpcy5ib2R5ID0gbnVsbDsKICAgIH0KICAgIC8qKgogICAgICogQ29tcHV0ZXMgdGhlIGJvdW5kaW5nIHNwaGVyZSByYWRpdXMuCiAgICAgKiBUaGUgcmVzdWx0IGlzIHN0b3JlZCBpbiB0aGUgcHJvcGVydHkgYC5ib3VuZGluZ1NwaGVyZVJhZGl1c2AKICAgICAqLwoKCiAgICB1cGRhdGVCb3VuZGluZ1NwaGVyZVJhZGl1cygpIHsKICAgICAgdGhyb3cgYGNvbXB1dGVCb3VuZGluZ1NwaGVyZVJhZGl1cygpIG5vdCBpbXBsZW1lbnRlZCBmb3Igc2hhcGUgdHlwZSAke3RoaXMudHlwZX1gOwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgdGhlIHZvbHVtZSBvZiB0aGlzIHNoYXBlCiAgICAgKi8KCgogICAgdm9sdW1lKCkgewogICAgICB0aHJvdyBgdm9sdW1lKCkgbm90IGltcGxlbWVudGVkIGZvciBzaGFwZSB0eXBlICR7dGhpcy50eXBlfWA7CiAgICB9CiAgICAvKioKICAgICAqIENhbGN1bGF0ZXMgdGhlIGluZXJ0aWEgaW4gdGhlIGxvY2FsIGZyYW1lIGZvciB0aGlzIHNoYXBlLgogICAgICogQHNlZSBodHRwOi8vZW4ud2lraXBlZGlhLm9yZy93aWtpL0xpc3Rfb2ZfbW9tZW50c19vZl9pbmVydGlhCiAgICAgKi8KCgogICAgY2FsY3VsYXRlTG9jYWxJbmVydGlhKG1hc3MsIHRhcmdldCkgewogICAgICB0aHJvdyBgY2FsY3VsYXRlTG9jYWxJbmVydGlhKCkgbm90IGltcGxlbWVudGVkIGZvciBzaGFwZSB0eXBlICR7dGhpcy50eXBlfWA7CiAgICB9CiAgICAvKioKICAgICAqIEB0b2RvIHVzZSBhYnN0cmFjdCBmb3IgdGhlc2Uga2luZCBvZiBtZXRob2RzCiAgICAgKi8KCgogICAgY2FsY3VsYXRlV29ybGRBQUJCKHBvcywgcXVhdCwgbWluLCBtYXgpIHsKICAgICAgdGhyb3cgYGNhbGN1bGF0ZVdvcmxkQUFCQigpIG5vdCBpbXBsZW1lbnRlZCBmb3Igc2hhcGUgdHlwZSAke3RoaXMudHlwZX1gOwogICAgfQoKICB9CiAgU2hhcGUuaWRDb3VudGVyID0gMDsKICBTaGFwZS50eXBlcyA9IFNIQVBFX1RZUEVTOwoKICAvKioKICAgKiBUcmFuc2Zvcm1hdGlvbiB1dGlsaXRpZXMuCiAgICovCiAgY2xhc3MgVHJhbnNmb3JtIHsKICAgIC8qKgogICAgICogcG9zaXRpb24KICAgICAqLwoKICAgIC8qKgogICAgICogcXVhdGVybmlvbgogICAgICovCiAgICBjb25zdHJ1Y3RvcihvcHRpb25zKSB7CiAgICAgIGlmIChvcHRpb25zID09PSB2b2lkIDApIHsKICAgICAgICBvcHRpb25zID0ge307CiAgICAgIH0KCiAgICAgIHRoaXMucG9zaXRpb24gPSBuZXcgVmVjMygpOwogICAgICB0aGlzLnF1YXRlcm5pb24gPSBuZXcgUXVhdGVybmlvbigpOwoKICAgICAgaWYgKG9wdGlvbnMucG9zaXRpb24pIHsKICAgICAgICB0aGlzLnBvc2l0aW9uLmNvcHkob3B0aW9ucy5wb3NpdGlvbik7CiAgICAgIH0KCiAgICAgIGlmIChvcHRpb25zLnF1YXRlcm5pb24pIHsKICAgICAgICB0aGlzLnF1YXRlcm5pb24uY29weShvcHRpb25zLnF1YXRlcm5pb24pOwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIEdldCBhIGdsb2JhbCBwb2ludCBpbiBsb2NhbCB0cmFuc2Zvcm0gY29vcmRpbmF0ZXMuCiAgICAgKi8KCgogICAgcG9pbnRUb0xvY2FsKHdvcmxkUG9pbnQsIHJlc3VsdCkgewogICAgICByZXR1cm4gVHJhbnNmb3JtLnBvaW50VG9Mb2NhbEZyYW1lKHRoaXMucG9zaXRpb24sIHRoaXMucXVhdGVybmlvbiwgd29ybGRQb2ludCwgcmVzdWx0KTsKICAgIH0KICAgIC8qKgogICAgICogR2V0IGEgbG9jYWwgcG9pbnQgaW4gZ2xvYmFsIHRyYW5zZm9ybSBjb29yZGluYXRlcy4KICAgICAqLwoKCiAgICBwb2ludFRvV29ybGQobG9jYWxQb2ludCwgcmVzdWx0KSB7CiAgICAgIHJldHVybiBUcmFuc2Zvcm0ucG9pbnRUb1dvcmxkRnJhbWUodGhpcy5wb3NpdGlvbiwgdGhpcy5xdWF0ZXJuaW9uLCBsb2NhbFBvaW50LCByZXN1bHQpOwogICAgfQogICAgLyoqCiAgICAgKiB2ZWN0b3JUb1dvcmxkRnJhbWUKICAgICAqLwoKCiAgICB2ZWN0b3JUb1dvcmxkRnJhbWUobG9jYWxWZWN0b3IsIHJlc3VsdCkgewogICAgICBpZiAocmVzdWx0ID09PSB2b2lkIDApIHsKICAgICAgICByZXN1bHQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICB0aGlzLnF1YXRlcm5pb24udm11bHQobG9jYWxWZWN0b3IsIHJlc3VsdCk7CiAgICAgIHJldHVybiByZXN1bHQ7CiAgICB9CiAgICAvKioKICAgICAqIHBvaW50VG9Mb2NhbEZyYW1lCiAgICAgKi8KCgogICAgc3RhdGljIHBvaW50VG9Mb2NhbEZyYW1lKHBvc2l0aW9uLCBxdWF0ZXJuaW9uLCB3b3JsZFBvaW50LCByZXN1bHQpIHsKICAgICAgaWYgKHJlc3VsdCA9PT0gdm9pZCAwKSB7CiAgICAgICAgcmVzdWx0ID0gbmV3IFZlYzMoKTsKICAgICAgfQoKICAgICAgd29ybGRQb2ludC52c3ViKHBvc2l0aW9uLCByZXN1bHQpOwogICAgICBxdWF0ZXJuaW9uLmNvbmp1Z2F0ZSh0bXBRdWF0JDEpOwogICAgICB0bXBRdWF0JDEudm11bHQocmVzdWx0LCByZXN1bHQpOwogICAgICByZXR1cm4gcmVzdWx0OwogICAgfQogICAgLyoqCiAgICAgKiBwb2ludFRvV29ybGRGcmFtZQogICAgICovCgoKICAgIHN0YXRpYyBwb2ludFRvV29ybGRGcmFtZShwb3NpdGlvbiwgcXVhdGVybmlvbiwgbG9jYWxQb2ludCwgcmVzdWx0KSB7CiAgICAgIGlmIChyZXN1bHQgPT09IHZvaWQgMCkgewogICAgICAgIHJlc3VsdCA9IG5ldyBWZWMzKCk7CiAgICAgIH0KCiAgICAgIHF1YXRlcm5pb24udm11bHQobG9jYWxQb2ludCwgcmVzdWx0KTsKICAgICAgcmVzdWx0LnZhZGQocG9zaXRpb24sIHJlc3VsdCk7CiAgICAgIHJldHVybiByZXN1bHQ7CiAgICB9CiAgICAvKioKICAgICAqIHZlY3RvclRvV29ybGRGcmFtZQogICAgICovCgoKICAgIHN0YXRpYyB2ZWN0b3JUb1dvcmxkRnJhbWUocXVhdGVybmlvbiwgbG9jYWxWZWN0b3IsIHJlc3VsdCkgewogICAgICBpZiAocmVzdWx0ID09PSB2b2lkIDApIHsKICAgICAgICByZXN1bHQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICBxdWF0ZXJuaW9uLnZtdWx0KGxvY2FsVmVjdG9yLCByZXN1bHQpOwogICAgICByZXR1cm4gcmVzdWx0OwogICAgfQogICAgLyoqCiAgICAgKiB2ZWN0b3JUb0xvY2FsRnJhbWUKICAgICAqLwoKCiAgICBzdGF0aWMgdmVjdG9yVG9Mb2NhbEZyYW1lKHBvc2l0aW9uLCBxdWF0ZXJuaW9uLCB3b3JsZFZlY3RvciwgcmVzdWx0KSB7CiAgICAgIGlmIChyZXN1bHQgPT09IHZvaWQgMCkgewogICAgICAgIHJlc3VsdCA9IG5ldyBWZWMzKCk7CiAgICAgIH0KCiAgICAgIHF1YXRlcm5pb24udyAqPSAtMTsKICAgICAgcXVhdGVybmlvbi52bXVsdCh3b3JsZFZlY3RvciwgcmVzdWx0KTsKICAgICAgcXVhdGVybmlvbi53ICo9IC0xOwogICAgICByZXR1cm4gcmVzdWx0OwogICAgfQoKICB9CiAgY29uc3QgdG1wUXVhdCQxID0gbmV3IFF1YXRlcm5pb24oKTsKCiAgLyoqCiAgICogQSBzZXQgb2YgcG9seWdvbnMgZGVzY3JpYmluZyBhIGNvbnZleCBzaGFwZS4KICAgKgogICAqIFRoZSBzaGFwZSBNVVNUIGJlIGNvbnZleCBmb3IgdGhlIGNvZGUgdG8gd29yayBwcm9wZXJseS4gTm8gcG9seWdvbnMgbWF5IGJlIGNvcGxhbmFyIChjb250YWluZWQKICAgKiBpbiB0aGUgc2FtZSAzRCBwbGFuZSksIGluc3RlYWQgdGhlc2Ugc2hvdWxkIGJlIG1lcmdlZCBpbnRvIG9uZSBwb2x5Z29uLgogICAqCiAgICogQGF1dGhvciBxaWFvIC8gaHR0cHM6Ly9naXRodWIuY29tL3FpYW8gKG9yaWdpbmFsIGF1dGhvciwgc2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9xaWFvL3RocmVlLmpzL2NvbW1pdC84NTAyNmYwYzc2OWU0MDAwMTQ4YTY3ZDQ1YTllOWI5YzUxMDg4MzZmKQogICAqIEBhdXRob3Igc2NodGVwcGUgLyBodHRwczovL2dpdGh1Yi5jb20vc2NodGVwcGUKICAgKiBAc2VlIGh0dHBzOi8vd3d3LmFsdGRldmJsb2dhZGF5LmNvbS8yMDExLzA1LzEzL2NvbnRhY3QtZ2VuZXJhdGlvbi1iZXR3ZWVuLTNkLWNvbnZleC1tZXNoZXMvCiAgICoKICAgKiBAdG9kbyBNb3ZlIHRoZSBjbGlwcGluZyBmdW5jdGlvbnMgdG8gQ29udGFjdEdlbmVyYXRvcj8KICAgKiBAdG9kbyBBdXRvbWF0aWNhbGx5IG1lcmdlIGNvcGxhbmFyIHBvbHlnb25zIGluIGNvbnN0cnVjdG9yLgogICAqIEBleGFtcGxlCiAgICogICAgIGNvbnN0IGNvbnZleFNoYXBlID0gbmV3IENBTk5PTi5Db252ZXhQb2x5aGVkcm9uKHsgdmVydGljZXMsIGZhY2VzIH0pCiAgICogICAgIGNvbnN0IGNvbnZleEJvZHkgPSBuZXcgQ0FOTk9OLkJvZHkoeyBtYXNzOiAxLCBzaGFwZTogY29udmV4U2hhcGUgfSkKICAgKiAgICAgd29ybGQuYWRkQm9keShjb252ZXhCb2R5KQogICAqLwogIGNsYXNzIENvbnZleFBvbHloZWRyb24gZXh0ZW5kcyBTaGFwZSB7CiAgICAvKiogdmVydGljZXMgKi8KCiAgICAvKioKICAgICAqIEFycmF5IG9mIGludGVnZXIgYXJyYXlzLCBpbmRpY2F0aW5nIHdoaWNoIHZlcnRpY2VzIGVhY2ggZmFjZSBjb25zaXN0cyBvZgogICAgICovCgogICAgLyoqIGZhY2VOb3JtYWxzICovCgogICAgLyoqIHdvcmxkVmVydGljZXMgKi8KCiAgICAvKiogd29ybGRWZXJ0aWNlc05lZWRzVXBkYXRlICovCgogICAgLyoqIHdvcmxkRmFjZU5vcm1hbHMgKi8KCiAgICAvKiogd29ybGRGYWNlTm9ybWFsc05lZWRzVXBkYXRlICovCgogICAgLyoqCiAgICAgKiBJZiBnaXZlbiwgdGhlc2UgbG9jYWxseSBkZWZpbmVkLCBub3JtYWxpemVkIGF4ZXMgYXJlIHRoZSBvbmx5IG9uZXMgYmVpbmcgY2hlY2tlZCB3aGVuIGRvaW5nIHNlcGFyYXRpbmcgYXhpcyBjaGVjay4KICAgICAqLwoKICAgIC8qKiB1bmlxdWVFZGdlcyAqLwoKICAgIC8qKgogICAgICogQHBhcmFtIHZlcnRpY2VzIEFuIGFycmF5IG9mIFZlYzMncwogICAgICogQHBhcmFtIGZhY2VzIEFycmF5IG9mIGludGVnZXIgYXJyYXlzLCBkZXNjcmliaW5nIHdoaWNoIHZlcnRpY2VzIHRoYXQgaXMgaW5jbHVkZWQgaW4gZWFjaCBmYWNlLgogICAgICovCiAgICBjb25zdHJ1Y3Rvcihwcm9wcykgewogICAgICBpZiAocHJvcHMgPT09IHZvaWQgMCkgewogICAgICAgIHByb3BzID0ge307CiAgICAgIH0KCiAgICAgIGNvbnN0IHsKICAgICAgICB2ZXJ0aWNlcyA9IFtdLAogICAgICAgIGZhY2VzID0gW10sCiAgICAgICAgbm9ybWFscyA9IFtdLAogICAgICAgIGF4ZXMsCiAgICAgICAgYm91bmRpbmdTcGhlcmVSYWRpdXMKICAgICAgfSA9IHByb3BzOwogICAgICBzdXBlcih7CiAgICAgICAgdHlwZTogU2hhcGUudHlwZXMuQ09OVkVYUE9MWUhFRFJPTgogICAgICB9KTsKICAgICAgdGhpcy52ZXJ0aWNlcyA9IHZlcnRpY2VzOwogICAgICB0aGlzLmZhY2VzID0gZmFjZXM7CiAgICAgIHRoaXMuZmFjZU5vcm1hbHMgPSBub3JtYWxzOwoKICAgICAgaWYgKHRoaXMuZmFjZU5vcm1hbHMubGVuZ3RoID09PSAwKSB7CiAgICAgICAgdGhpcy5jb21wdXRlTm9ybWFscygpOwogICAgICB9CgogICAgICBpZiAoIWJvdW5kaW5nU3BoZXJlUmFkaXVzKSB7CiAgICAgICAgdGhpcy51cGRhdGVCb3VuZGluZ1NwaGVyZVJhZGl1cygpOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuYm91bmRpbmdTcGhlcmVSYWRpdXMgPSBib3VuZGluZ1NwaGVyZVJhZGl1czsKICAgICAgfQoKICAgICAgdGhpcy53b3JsZFZlcnRpY2VzID0gW107IC8vIFdvcmxkIHRyYW5zZm9ybWVkIHZlcnNpb24gb2YgLnZlcnRpY2VzCgogICAgICB0aGlzLndvcmxkVmVydGljZXNOZWVkc1VwZGF0ZSA9IHRydWU7CiAgICAgIHRoaXMud29ybGRGYWNlTm9ybWFscyA9IFtdOyAvLyBXb3JsZCB0cmFuc2Zvcm1lZCB2ZXJzaW9uIG9mIC5mYWNlTm9ybWFscwoKICAgICAgdGhpcy53b3JsZEZhY2VOb3JtYWxzTmVlZHNVcGRhdGUgPSB0cnVlOwogICAgICB0aGlzLnVuaXF1ZUF4ZXMgPSBheGVzID8gYXhlcy5zbGljZSgpIDogbnVsbDsKICAgICAgdGhpcy51bmlxdWVFZGdlcyA9IFtdOwogICAgICB0aGlzLmNvbXB1dGVFZGdlcygpOwogICAgfQogICAgLyoqCiAgICAgKiBDb21wdXRlcyB1bmlxdWVFZGdlcwogICAgICovCgoKICAgIGNvbXB1dGVFZGdlcygpIHsKICAgICAgY29uc3QgZmFjZXMgPSB0aGlzLmZhY2VzOwogICAgICBjb25zdCB2ZXJ0aWNlcyA9IHRoaXMudmVydGljZXM7CiAgICAgIGNvbnN0IGVkZ2VzID0gdGhpcy51bmlxdWVFZGdlczsKICAgICAgZWRnZXMubGVuZ3RoID0gMDsKICAgICAgY29uc3QgZWRnZSA9IG5ldyBWZWMzKCk7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gZmFjZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICBjb25zdCBmYWNlID0gZmFjZXNbaV07CiAgICAgICAgY29uc3QgbnVtVmVydGljZXMgPSBmYWNlLmxlbmd0aDsKCiAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogIT09IG51bVZlcnRpY2VzOyBqKyspIHsKICAgICAgICAgIGNvbnN0IGsgPSAoaiArIDEpICUgbnVtVmVydGljZXM7CiAgICAgICAgICB2ZXJ0aWNlc1tmYWNlW2pdXS52c3ViKHZlcnRpY2VzW2ZhY2Vba11dLCBlZGdlKTsKICAgICAgICAgIGVkZ2Uubm9ybWFsaXplKCk7CiAgICAgICAgICBsZXQgZm91bmQgPSBmYWxzZTsKCiAgICAgICAgICBmb3IgKGxldCBwID0gMDsgcCAhPT0gZWRnZXMubGVuZ3RoOyBwKyspIHsKICAgICAgICAgICAgaWYgKGVkZ2VzW3BdLmFsbW9zdEVxdWFscyhlZGdlKSB8fCBlZGdlc1twXS5hbG1vc3RFcXVhbHMoZWRnZSkpIHsKICAgICAgICAgICAgICBmb3VuZCA9IHRydWU7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoIWZvdW5kKSB7CiAgICAgICAgICAgIGVkZ2VzLnB1c2goZWRnZS5jbG9uZSgpKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogQ29tcHV0ZSB0aGUgbm9ybWFscyBvZiB0aGUgZmFjZXMuCiAgICAgKiBXaWxsIHJldXNlIGV4aXN0aW5nIFZlYzMgb2JqZWN0cyBpbiB0aGUgYGZhY2VOb3JtYWxzYCBhcnJheSBpZiB0aGV5IGV4aXN0LgogICAgICovCgoKICAgIGNvbXB1dGVOb3JtYWxzKCkgewogICAgICB0aGlzLmZhY2VOb3JtYWxzLmxlbmd0aCA9IHRoaXMuZmFjZXMubGVuZ3RoOyAvLyBHZW5lcmF0ZSBub3JtYWxzCgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMuZmFjZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAvLyBDaGVjayBzbyBhbGwgdmVydGljZXMgZXhpc3RzIGZvciB0aGlzIGZhY2UKICAgICAgICBmb3IgKGxldCBqID0gMDsgaiA8IHRoaXMuZmFjZXNbaV0ubGVuZ3RoOyBqKyspIHsKICAgICAgICAgIGlmICghdGhpcy52ZXJ0aWNlc1t0aGlzLmZhY2VzW2ldW2pdXSkgewogICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYFZlcnRleCAke3RoaXMuZmFjZXNbaV1bal19IG5vdCBmb3VuZCFgKTsKICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGNvbnN0IG4gPSB0aGlzLmZhY2VOb3JtYWxzW2ldIHx8IG5ldyBWZWMzKCk7CiAgICAgICAgdGhpcy5nZXRGYWNlTm9ybWFsKGksIG4pOwogICAgICAgIG4ubmVnYXRlKG4pOwogICAgICAgIHRoaXMuZmFjZU5vcm1hbHNbaV0gPSBuOwogICAgICAgIGNvbnN0IHZlcnRleCA9IHRoaXMudmVydGljZXNbdGhpcy5mYWNlc1tpXVswXV07CgogICAgICAgIGlmIChuLmRvdCh2ZXJ0ZXgpIDwgMCkgewogICAgICAgICAgY29uc29sZS5lcnJvcihgLmZhY2VOb3JtYWxzWyR7aX1dID0gVmVjMygke24udG9TdHJpbmcoKX0pIGxvb2tzIGxpa2UgaXQgcG9pbnRzIGludG8gdGhlIHNoYXBlPyBUaGUgdmVydGljZXMgZm9sbG93LiBNYWtlIHN1cmUgdGhleSBhcmUgb3JkZXJlZCBDQ1cgYXJvdW5kIHRoZSBub3JtYWwsIHVzaW5nIHRoZSByaWdodCBoYW5kIHJ1bGUuYCk7CgogICAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCB0aGlzLmZhY2VzW2ldLmxlbmd0aDsgaisrKSB7CiAgICAgICAgICAgIGNvbnNvbGUud2FybihgLnZlcnRpY2VzWyR7dGhpcy5mYWNlc1tpXVtqXX1dID0gVmVjMygke3RoaXMudmVydGljZXNbdGhpcy5mYWNlc1tpXVtqXV0udG9TdHJpbmcoKX0pYCk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIENvbXB1dGUgdGhlIG5vcm1hbCBvZiBhIGZhY2UgZnJvbSBpdHMgdmVydGljZXMKICAgICAqLwoKCiAgICBnZXRGYWNlTm9ybWFsKGksIHRhcmdldCkgewogICAgICBjb25zdCBmID0gdGhpcy5mYWNlc1tpXTsKICAgICAgY29uc3QgdmEgPSB0aGlzLnZlcnRpY2VzW2ZbMF1dOwogICAgICBjb25zdCB2YiA9IHRoaXMudmVydGljZXNbZlsxXV07CiAgICAgIGNvbnN0IHZjID0gdGhpcy52ZXJ0aWNlc1tmWzJdXTsKICAgICAgQ29udmV4UG9seWhlZHJvbi5jb21wdXRlTm9ybWFsKHZhLCB2YiwgdmMsIHRhcmdldCk7CiAgICB9CiAgICAvKioKICAgICAqIEdldCBmYWNlIG5vcm1hbCBnaXZlbiAzIHZlcnRpY2VzCiAgICAgKi8KCgogICAgc3RhdGljIGNvbXB1dGVOb3JtYWwodmEsIHZiLCB2YywgdGFyZ2V0KSB7CiAgICAgIGNvbnN0IGNiID0gbmV3IFZlYzMoKTsKICAgICAgY29uc3QgYWIgPSBuZXcgVmVjMygpOwogICAgICB2Yi52c3ViKHZhLCBhYik7CiAgICAgIHZjLnZzdWIodmIsIGNiKTsKICAgICAgY2IuY3Jvc3MoYWIsIHRhcmdldCk7CgogICAgICBpZiAoIXRhcmdldC5pc1plcm8oKSkgewogICAgICAgIHRhcmdldC5ub3JtYWxpemUoKTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBAcGFyYW0gbWluRGlzdCBDbGFtcCBkaXN0YW5jZQogICAgICogQHBhcmFtIHJlc3VsdCBUaGUgYW4gYXJyYXkgb2YgY29udGFjdCBwb2ludCBvYmplY3RzLCBzZWUgY2xpcEZhY2VBZ2FpbnN0SHVsbAogICAgICovCgoKICAgIGNsaXBBZ2FpbnN0SHVsbChwb3NBLCBxdWF0QSwgaHVsbEIsIHBvc0IsIHF1YXRCLCBzZXBhcmF0aW5nTm9ybWFsLCBtaW5EaXN0LCBtYXhEaXN0LCByZXN1bHQpIHsKICAgICAgY29uc3QgV29ybGROb3JtYWwgPSBuZXcgVmVjMygpOwogICAgICBsZXQgY2xvc2VzdEZhY2VCID0gLTE7CiAgICAgIGxldCBkbWF4ID0gLU51bWJlci5NQVhfVkFMVUU7CgogICAgICBmb3IgKGxldCBmYWNlID0gMDsgZmFjZSA8IGh1bGxCLmZhY2VzLmxlbmd0aDsgZmFjZSsrKSB7CiAgICAgICAgV29ybGROb3JtYWwuY29weShodWxsQi5mYWNlTm9ybWFsc1tmYWNlXSk7CiAgICAgICAgcXVhdEIudm11bHQoV29ybGROb3JtYWwsIFdvcmxkTm9ybWFsKTsKICAgICAgICBjb25zdCBkID0gV29ybGROb3JtYWwuZG90KHNlcGFyYXRpbmdOb3JtYWwpOwoKICAgICAgICBpZiAoZCA+IGRtYXgpIHsKICAgICAgICAgIGRtYXggPSBkOwogICAgICAgICAgY2xvc2VzdEZhY2VCID0gZmFjZTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIGNvbnN0IHdvcmxkVmVydHNCMSA9IFtdOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBodWxsQi5mYWNlc1tjbG9zZXN0RmFjZUJdLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgY29uc3QgYiA9IGh1bGxCLnZlcnRpY2VzW2h1bGxCLmZhY2VzW2Nsb3Nlc3RGYWNlQl1baV1dOwogICAgICAgIGNvbnN0IHdvcmxkYiA9IG5ldyBWZWMzKCk7CiAgICAgICAgd29ybGRiLmNvcHkoYik7CiAgICAgICAgcXVhdEIudm11bHQod29ybGRiLCB3b3JsZGIpOwogICAgICAgIHBvc0IudmFkZCh3b3JsZGIsIHdvcmxkYik7CiAgICAgICAgd29ybGRWZXJ0c0IxLnB1c2god29ybGRiKTsKICAgICAgfQoKICAgICAgaWYgKGNsb3Nlc3RGYWNlQiA+PSAwKSB7CiAgICAgICAgdGhpcy5jbGlwRmFjZUFnYWluc3RIdWxsKHNlcGFyYXRpbmdOb3JtYWwsIHBvc0EsIHF1YXRBLCB3b3JsZFZlcnRzQjEsIG1pbkRpc3QsIG1heERpc3QsIHJlc3VsdCk7CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogRmluZCB0aGUgc2VwYXJhdGluZyBheGlzIGJldHdlZW4gdGhpcyBodWxsIGFuZCBhbm90aGVyCiAgICAgKiBAcGFyYW0gdGFyZ2V0IFRoZSB0YXJnZXQgdmVjdG9yIHRvIHNhdmUgdGhlIGF4aXMgaW4KICAgICAqIEByZXR1cm4gUmV0dXJucyBmYWxzZSBpZiBhIHNlcGFyYXRpb24gaXMgZm91bmQsIGVsc2UgdHJ1ZQogICAgICovCgoKICAgIGZpbmRTZXBhcmF0aW5nQXhpcyhodWxsQiwgcG9zQSwgcXVhdEEsIHBvc0IsIHF1YXRCLCB0YXJnZXQsIGZhY2VMaXN0QSwgZmFjZUxpc3RCKSB7CiAgICAgIGNvbnN0IGZhY2VBTm9ybWFsV1MzID0gbmV3IFZlYzMoKTsKICAgICAgY29uc3QgV29ybGRub3JtYWwxID0gbmV3IFZlYzMoKTsKICAgICAgY29uc3QgZGVsdGFDID0gbmV3IFZlYzMoKTsKICAgICAgY29uc3Qgd29ybGRFZGdlMCA9IG5ldyBWZWMzKCk7CiAgICAgIGNvbnN0IHdvcmxkRWRnZTEgPSBuZXcgVmVjMygpOwogICAgICBjb25zdCBDcm9zcyA9IG5ldyBWZWMzKCk7CiAgICAgIGxldCBkbWluID0gTnVtYmVyLk1BWF9WQUxVRTsKICAgICAgY29uc3QgaHVsbEEgPSB0aGlzOwoKICAgICAgaWYgKCFodWxsQS51bmlxdWVBeGVzKSB7CiAgICAgICAgY29uc3QgbnVtRmFjZXNBID0gZmFjZUxpc3RBID8gZmFjZUxpc3RBLmxlbmd0aCA6IGh1bGxBLmZhY2VzLmxlbmd0aDsgLy8gVGVzdCBmYWNlIG5vcm1hbHMgZnJvbSBodWxsQQoKICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IG51bUZhY2VzQTsgaSsrKSB7CiAgICAgICAgICBjb25zdCBmaSA9IGZhY2VMaXN0QSA/IGZhY2VMaXN0QVtpXSA6IGk7IC8vIEdldCB3b3JsZCBmYWNlIG5vcm1hbAoKICAgICAgICAgIGZhY2VBTm9ybWFsV1MzLmNvcHkoaHVsbEEuZmFjZU5vcm1hbHNbZmldKTsKICAgICAgICAgIHF1YXRBLnZtdWx0KGZhY2VBTm9ybWFsV1MzLCBmYWNlQU5vcm1hbFdTMyk7CiAgICAgICAgICBjb25zdCBkID0gaHVsbEEudGVzdFNlcEF4aXMoZmFjZUFOb3JtYWxXUzMsIGh1bGxCLCBwb3NBLCBxdWF0QSwgcG9zQiwgcXVhdEIpOwoKICAgICAgICAgIGlmIChkID09PSBmYWxzZSkgewogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKGQgPCBkbWluKSB7CiAgICAgICAgICAgIGRtaW4gPSBkOwogICAgICAgICAgICB0YXJnZXQuY29weShmYWNlQU5vcm1hbFdTMyk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIC8vIFRlc3QgdW5pcXVlIGF4ZXMKICAgICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gaHVsbEEudW5pcXVlQXhlcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgLy8gR2V0IHdvcmxkIGF4aXMKICAgICAgICAgIHF1YXRBLnZtdWx0KGh1bGxBLnVuaXF1ZUF4ZXNbaV0sIGZhY2VBTm9ybWFsV1MzKTsKICAgICAgICAgIGNvbnN0IGQgPSBodWxsQS50ZXN0U2VwQXhpcyhmYWNlQU5vcm1hbFdTMywgaHVsbEIsIHBvc0EsIHF1YXRBLCBwb3NCLCBxdWF0Qik7CgogICAgICAgICAgaWYgKGQgPT09IGZhbHNlKSB7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoZCA8IGRtaW4pIHsKICAgICAgICAgICAgZG1pbiA9IGQ7CiAgICAgICAgICAgIHRhcmdldC5jb3B5KGZhY2VBTm9ybWFsV1MzKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KCiAgICAgIGlmICghaHVsbEIudW5pcXVlQXhlcykgewogICAgICAgIC8vIFRlc3QgZmFjZSBub3JtYWxzIGZyb20gaHVsbEIKICAgICAgICBjb25zdCBudW1GYWNlc0IgPSBmYWNlTGlzdEIgPyBmYWNlTGlzdEIubGVuZ3RoIDogaHVsbEIuZmFjZXMubGVuZ3RoOwoKICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IG51bUZhY2VzQjsgaSsrKSB7CiAgICAgICAgICBjb25zdCBmaSA9IGZhY2VMaXN0QiA/IGZhY2VMaXN0QltpXSA6IGk7CiAgICAgICAgICBXb3JsZG5vcm1hbDEuY29weShodWxsQi5mYWNlTm9ybWFsc1tmaV0pOwogICAgICAgICAgcXVhdEIudm11bHQoV29ybGRub3JtYWwxLCBXb3JsZG5vcm1hbDEpOwogICAgICAgICAgY29uc3QgZCA9IGh1bGxBLnRlc3RTZXBBeGlzKFdvcmxkbm9ybWFsMSwgaHVsbEIsIHBvc0EsIHF1YXRBLCBwb3NCLCBxdWF0Qik7CgogICAgICAgICAgaWYgKGQgPT09IGZhbHNlKSB7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoZCA8IGRtaW4pIHsKICAgICAgICAgICAgZG1pbiA9IGQ7CiAgICAgICAgICAgIHRhcmdldC5jb3B5KFdvcmxkbm9ybWFsMSk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIC8vIFRlc3QgdW5pcXVlIGF4ZXMgaW4gQgogICAgICAgIGZvciAobGV0IGkgPSAwOyBpICE9PSBodWxsQi51bmlxdWVBeGVzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICBxdWF0Qi52bXVsdChodWxsQi51bmlxdWVBeGVzW2ldLCBXb3JsZG5vcm1hbDEpOwogICAgICAgICAgY29uc3QgZCA9IGh1bGxBLnRlc3RTZXBBeGlzKFdvcmxkbm9ybWFsMSwgaHVsbEIsIHBvc0EsIHF1YXRBLCBwb3NCLCBxdWF0Qik7CgogICAgICAgICAgaWYgKGQgPT09IGZhbHNlKSB7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoZCA8IGRtaW4pIHsKICAgICAgICAgICAgZG1pbiA9IGQ7CiAgICAgICAgICAgIHRhcmdldC5jb3B5KFdvcmxkbm9ybWFsMSk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9IC8vIFRlc3QgZWRnZXMKCgogICAgICBmb3IgKGxldCBlMCA9IDA7IGUwICE9PSBodWxsQS51bmlxdWVFZGdlcy5sZW5ndGg7IGUwKyspIHsKICAgICAgICAvLyBHZXQgd29ybGQgZWRnZQogICAgICAgIHF1YXRBLnZtdWx0KGh1bGxBLnVuaXF1ZUVkZ2VzW2UwXSwgd29ybGRFZGdlMCk7CgogICAgICAgIGZvciAobGV0IGUxID0gMDsgZTEgIT09IGh1bGxCLnVuaXF1ZUVkZ2VzLmxlbmd0aDsgZTErKykgewogICAgICAgICAgLy8gR2V0IHdvcmxkIGVkZ2UgMgogICAgICAgICAgcXVhdEIudm11bHQoaHVsbEIudW5pcXVlRWRnZXNbZTFdLCB3b3JsZEVkZ2UxKTsKICAgICAgICAgIHdvcmxkRWRnZTAuY3Jvc3Mod29ybGRFZGdlMSwgQ3Jvc3MpOwoKICAgICAgICAgIGlmICghQ3Jvc3MuYWxtb3N0WmVybygpKSB7CiAgICAgICAgICAgIENyb3NzLm5vcm1hbGl6ZSgpOwogICAgICAgICAgICBjb25zdCBkaXN0ID0gaHVsbEEudGVzdFNlcEF4aXMoQ3Jvc3MsIGh1bGxCLCBwb3NBLCBxdWF0QSwgcG9zQiwgcXVhdEIpOwoKICAgICAgICAgICAgaWYgKGRpc3QgPT09IGZhbHNlKSB7CiAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoZGlzdCA8IGRtaW4pIHsKICAgICAgICAgICAgICBkbWluID0gZGlzdDsKICAgICAgICAgICAgICB0YXJnZXQuY29weShDcm9zcyk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KCiAgICAgIHBvc0IudnN1Yihwb3NBLCBkZWx0YUMpOwoKICAgICAgaWYgKGRlbHRhQy5kb3QodGFyZ2V0KSA+IDAuMCkgewogICAgICAgIHRhcmdldC5uZWdhdGUodGFyZ2V0KTsKICAgICAgfQoKICAgICAgcmV0dXJuIHRydWU7CiAgICB9CiAgICAvKioKICAgICAqIFRlc3Qgc2VwYXJhdGluZyBheGlzIGFnYWluc3QgdHdvIGh1bGxzLiBCb3RoIGh1bGxzIGFyZSBwcm9qZWN0ZWQgb250byB0aGUgYXhpcyBhbmQgdGhlIG92ZXJsYXAgc2l6ZSBpcyByZXR1cm5lZCBpZiB0aGVyZSBpcyBvbmUuCiAgICAgKiBAcmV0dXJuIFRoZSBvdmVybGFwIGRlcHRoLCBvciBGQUxTRSBpZiBubyBwZW5ldHJhdGlvbi4KICAgICAqLwoKCiAgICB0ZXN0U2VwQXhpcyhheGlzLCBodWxsQiwgcG9zQSwgcXVhdEEsIHBvc0IsIHF1YXRCKSB7CiAgICAgIGNvbnN0IGh1bGxBID0gdGhpczsKICAgICAgQ29udmV4UG9seWhlZHJvbi5wcm9qZWN0KGh1bGxBLCBheGlzLCBwb3NBLCBxdWF0QSwgbWF4bWluQSk7CiAgICAgIENvbnZleFBvbHloZWRyb24ucHJvamVjdChodWxsQiwgYXhpcywgcG9zQiwgcXVhdEIsIG1heG1pbkIpOwogICAgICBjb25zdCBtYXhBID0gbWF4bWluQVswXTsKICAgICAgY29uc3QgbWluQSA9IG1heG1pbkFbMV07CiAgICAgIGNvbnN0IG1heEIgPSBtYXhtaW5CWzBdOwogICAgICBjb25zdCBtaW5CID0gbWF4bWluQlsxXTsKCiAgICAgIGlmIChtYXhBIDwgbWluQiB8fCBtYXhCIDwgbWluQSkgewogICAgICAgIHJldHVybiBmYWxzZTsgLy8gU2VwYXJhdGVkCiAgICAgIH0KCiAgICAgIGNvbnN0IGQwID0gbWF4QSAtIG1pbkI7CiAgICAgIGNvbnN0IGQxID0gbWF4QiAtIG1pbkE7CiAgICAgIGNvbnN0IGRlcHRoID0gZDAgPCBkMSA/IGQwIDogZDE7CiAgICAgIHJldHVybiBkZXB0aDsKICAgIH0KICAgIC8qKgogICAgICogY2FsY3VsYXRlTG9jYWxJbmVydGlhCiAgICAgKi8KCgogICAgY2FsY3VsYXRlTG9jYWxJbmVydGlhKG1hc3MsIHRhcmdldCkgewogICAgICAvLyBBcHByb3hpbWF0ZSB3aXRoIGJveCBpbmVydGlhCiAgICAgIC8vIEV4YWN0IGluZXJ0aWEgY2FsY3VsYXRpb24gaXMgb3ZlcmtpbGwsIGJ1dCBzZWUgaHR0cDovL2dlb21ldHJpY3Rvb2xzLmNvbS9Eb2N1bWVudGF0aW9uL1BvbHloZWRyYWxNYXNzUHJvcGVydGllcy5wZGYgZm9yIHRoZSBjb3JyZWN0IHdheSB0byBkbyBpdAogICAgICBjb25zdCBhYWJibWF4ID0gbmV3IFZlYzMoKTsKICAgICAgY29uc3QgYWFiYm1pbiA9IG5ldyBWZWMzKCk7CiAgICAgIHRoaXMuY29tcHV0ZUxvY2FsQUFCQihhYWJibWluLCBhYWJibWF4KTsKICAgICAgY29uc3QgeCA9IGFhYmJtYXgueCAtIGFhYmJtaW4ueDsKICAgICAgY29uc3QgeSA9IGFhYmJtYXgueSAtIGFhYmJtaW4ueTsKICAgICAgY29uc3QgeiA9IGFhYmJtYXgueiAtIGFhYmJtaW4uejsKICAgICAgdGFyZ2V0LnggPSAxLjAgLyAxMi4wICogbWFzcyAqICgyICogeSAqIDIgKiB5ICsgMiAqIHogKiAyICogeik7CiAgICAgIHRhcmdldC55ID0gMS4wIC8gMTIuMCAqIG1hc3MgKiAoMiAqIHggKiAyICogeCArIDIgKiB6ICogMiAqIHopOwogICAgICB0YXJnZXQueiA9IDEuMCAvIDEyLjAgKiBtYXNzICogKDIgKiB5ICogMiAqIHkgKyAyICogeCAqIDIgKiB4KTsKICAgIH0KICAgIC8qKgogICAgICogQHBhcmFtIGZhY2VfaSBJbmRleCBvZiB0aGUgZmFjZQogICAgICovCgoKICAgIGdldFBsYW5lQ29uc3RhbnRPZkZhY2UoZmFjZV9pKSB7CiAgICAgIGNvbnN0IGYgPSB0aGlzLmZhY2VzW2ZhY2VfaV07CiAgICAgIGNvbnN0IG4gPSB0aGlzLmZhY2VOb3JtYWxzW2ZhY2VfaV07CiAgICAgIGNvbnN0IHYgPSB0aGlzLnZlcnRpY2VzW2ZbMF1dOwogICAgICBjb25zdCBjID0gLW4uZG90KHYpOwogICAgICByZXR1cm4gYzsKICAgIH0KICAgIC8qKgogICAgICogQ2xpcCBhIGZhY2UgYWdhaW5zdCBhIGh1bGwuCiAgICAgKiBAcGFyYW0gd29ybGRWZXJ0c0IxIEFuIGFycmF5IG9mIFZlYzMgd2l0aCB2ZXJ0aWNlcyBpbiB0aGUgd29ybGQgZnJhbWUuCiAgICAgKiBAcGFyYW0gbWluRGlzdCBEaXN0YW5jZSBjbGFtcGluZwogICAgICogQHBhcmFtIEFycmF5IHJlc3VsdCBBcnJheSB0byBzdG9yZSByZXN1bHRpbmcgY29udGFjdCBwb2ludHMgaW4uIFdpbGwgYmUgb2JqZWN0cyB3aXRoIHByb3BlcnRpZXM6IHBvaW50LCBkZXB0aCwgbm9ybWFsLiBUaGVzZSBhcmUgcmVwcmVzZW50ZWQgaW4gd29ybGQgY29vcmRpbmF0ZXMuCiAgICAgKi8KCgogICAgY2xpcEZhY2VBZ2FpbnN0SHVsbChzZXBhcmF0aW5nTm9ybWFsLCBwb3NBLCBxdWF0QSwgd29ybGRWZXJ0c0IxLCBtaW5EaXN0LCBtYXhEaXN0LCByZXN1bHQpIHsKICAgICAgY29uc3QgZmFjZUFOb3JtYWxXUyA9IG5ldyBWZWMzKCk7CiAgICAgIGNvbnN0IGVkZ2UwID0gbmV3IFZlYzMoKTsKICAgICAgY29uc3QgV29ybGRFZGdlMCA9IG5ldyBWZWMzKCk7CiAgICAgIGNvbnN0IHdvcmxkUGxhbmVBbm9ybWFsMSA9IG5ldyBWZWMzKCk7CiAgICAgIGNvbnN0IHBsYW5lTm9ybWFsV1MxID0gbmV3IFZlYzMoKTsKICAgICAgY29uc3Qgd29ybGRBMSA9IG5ldyBWZWMzKCk7CiAgICAgIGNvbnN0IGxvY2FsUGxhbmVOb3JtYWwgPSBuZXcgVmVjMygpOwogICAgICBjb25zdCBwbGFuZU5vcm1hbFdTID0gbmV3IFZlYzMoKTsKICAgICAgY29uc3QgaHVsbEEgPSB0aGlzOwogICAgICBjb25zdCB3b3JsZFZlcnRzQjIgPSBbXTsKICAgICAgY29uc3QgcFZ0eEluID0gd29ybGRWZXJ0c0IxOwogICAgICBjb25zdCBwVnR4T3V0ID0gd29ybGRWZXJ0c0IyOwogICAgICBsZXQgY2xvc2VzdEZhY2VBID0gLTE7CiAgICAgIGxldCBkbWluID0gTnVtYmVyLk1BWF9WQUxVRTsgLy8gRmluZCB0aGUgZmFjZSB3aXRoIG5vcm1hbCBjbG9zZXN0IHRvIHRoZSBzZXBhcmF0aW5nIGF4aXMKCiAgICAgIGZvciAobGV0IGZhY2UgPSAwOyBmYWNlIDwgaHVsbEEuZmFjZXMubGVuZ3RoOyBmYWNlKyspIHsKICAgICAgICBmYWNlQU5vcm1hbFdTLmNvcHkoaHVsbEEuZmFjZU5vcm1hbHNbZmFjZV0pOwogICAgICAgIHF1YXRBLnZtdWx0KGZhY2VBTm9ybWFsV1MsIGZhY2VBTm9ybWFsV1MpOwogICAgICAgIGNvbnN0IGQgPSBmYWNlQU5vcm1hbFdTLmRvdChzZXBhcmF0aW5nTm9ybWFsKTsKCiAgICAgICAgaWYgKGQgPCBkbWluKSB7CiAgICAgICAgICBkbWluID0gZDsKICAgICAgICAgIGNsb3Nlc3RGYWNlQSA9IGZhY2U7CiAgICAgICAgfQogICAgICB9CgogICAgICBpZiAoY2xvc2VzdEZhY2VBIDwgMCkgewogICAgICAgIHJldHVybjsKICAgICAgfSAvLyBHZXQgdGhlIGZhY2UgYW5kIGNvbnN0cnVjdCBjb25uZWN0ZWQgZmFjZXMKCgogICAgICBjb25zdCBwb2x5QSA9IGh1bGxBLmZhY2VzW2Nsb3Nlc3RGYWNlQV07CiAgICAgIHBvbHlBLmNvbm5lY3RlZEZhY2VzID0gW107CgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGh1bGxBLmZhY2VzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCBodWxsQS5mYWNlc1tpXS5sZW5ndGg7IGorKykgewogICAgICAgICAgaWYgKAogICAgICAgICAgLyogU2hhcmluZyBhIHZlcnRleCovCiAgICAgICAgICBwb2x5QS5pbmRleE9mKGh1bGxBLmZhY2VzW2ldW2pdKSAhPT0gLTEgJiYKICAgICAgICAgIC8qIE5vdCB0aGUgb25lIHdlIGFyZSBsb29raW5nIGZvciBjb25uZWN0aW9ucyBmcm9tICovCiAgICAgICAgICBpICE9PSBjbG9zZXN0RmFjZUEgJiYKICAgICAgICAgIC8qIE5vdCBhbHJlYWR5IGFkZGVkICovCiAgICAgICAgICBwb2x5QS5jb25uZWN0ZWRGYWNlcy5pbmRleE9mKGkpID09PSAtMSkgewogICAgICAgICAgICBwb2x5QS5jb25uZWN0ZWRGYWNlcy5wdXNoKGkpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSAvLyBDbGlwIHRoZSBwb2x5Z29uIHRvIHRoZSBiYWNrIG9mIHRoZSBwbGFuZXMgb2YgYWxsIGZhY2VzIG9mIGh1bGwgQSwKICAgICAgLy8gdGhhdCBhcmUgYWRqYWNlbnQgdG8gdGhlIHdpdG5lc3MgZmFjZQoKCiAgICAgIGNvbnN0IG51bVZlcnRpY2VzQSA9IHBvbHlBLmxlbmd0aDsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbnVtVmVydGljZXNBOyBpKyspIHsKICAgICAgICBjb25zdCBhID0gaHVsbEEudmVydGljZXNbcG9seUFbaV1dOwogICAgICAgIGNvbnN0IGIgPSBodWxsQS52ZXJ0aWNlc1twb2x5QVsoaSArIDEpICUgbnVtVmVydGljZXNBXV07CiAgICAgICAgYS52c3ViKGIsIGVkZ2UwKTsKICAgICAgICBXb3JsZEVkZ2UwLmNvcHkoZWRnZTApOwogICAgICAgIHF1YXRBLnZtdWx0KFdvcmxkRWRnZTAsIFdvcmxkRWRnZTApOwogICAgICAgIHBvc0EudmFkZChXb3JsZEVkZ2UwLCBXb3JsZEVkZ2UwKTsKICAgICAgICB3b3JsZFBsYW5lQW5vcm1hbDEuY29weSh0aGlzLmZhY2VOb3JtYWxzW2Nsb3Nlc3RGYWNlQV0pOwogICAgICAgIHF1YXRBLnZtdWx0KHdvcmxkUGxhbmVBbm9ybWFsMSwgd29ybGRQbGFuZUFub3JtYWwxKTsKICAgICAgICBwb3NBLnZhZGQod29ybGRQbGFuZUFub3JtYWwxLCB3b3JsZFBsYW5lQW5vcm1hbDEpOwogICAgICAgIFdvcmxkRWRnZTAuY3Jvc3Mod29ybGRQbGFuZUFub3JtYWwxLCBwbGFuZU5vcm1hbFdTMSk7CiAgICAgICAgcGxhbmVOb3JtYWxXUzEubmVnYXRlKHBsYW5lTm9ybWFsV1MxKTsKICAgICAgICB3b3JsZEExLmNvcHkoYSk7CiAgICAgICAgcXVhdEEudm11bHQod29ybGRBMSwgd29ybGRBMSk7CiAgICAgICAgcG9zQS52YWRkKHdvcmxkQTEsIHdvcmxkQTEpOwogICAgICAgIGNvbnN0IG90aGVyRmFjZSA9IHBvbHlBLmNvbm5lY3RlZEZhY2VzW2ldOwogICAgICAgIGxvY2FsUGxhbmVOb3JtYWwuY29weSh0aGlzLmZhY2VOb3JtYWxzW290aGVyRmFjZV0pOwogICAgICAgIGNvbnN0IGxvY2FsUGxhbmVFcSA9IHRoaXMuZ2V0UGxhbmVDb25zdGFudE9mRmFjZShvdGhlckZhY2UpOwogICAgICAgIHBsYW5lTm9ybWFsV1MuY29weShsb2NhbFBsYW5lTm9ybWFsKTsKICAgICAgICBxdWF0QS52bXVsdChwbGFuZU5vcm1hbFdTLCBwbGFuZU5vcm1hbFdTKTsKICAgICAgICBjb25zdCBwbGFuZUVxV1MgPSBsb2NhbFBsYW5lRXEgLSBwbGFuZU5vcm1hbFdTLmRvdChwb3NBKTsgLy8gQ2xpcCBmYWNlIGFnYWluc3Qgb3VyIGNvbnN0cnVjdGVkIHBsYW5lCgogICAgICAgIHRoaXMuY2xpcEZhY2VBZ2FpbnN0UGxhbmUocFZ0eEluLCBwVnR4T3V0LCBwbGFuZU5vcm1hbFdTLCBwbGFuZUVxV1MpOyAvLyBUaHJvdyBhd2F5IGFsbCBjbGlwcGVkIHBvaW50cywgYnV0IHNhdmUgdGhlIHJlbWFpbmluZyB1bnRpbCBuZXh0IGNsaXAKCiAgICAgICAgd2hpbGUgKHBWdHhJbi5sZW5ndGgpIHsKICAgICAgICAgIHBWdHhJbi5zaGlmdCgpOwogICAgICAgIH0KCiAgICAgICAgd2hpbGUgKHBWdHhPdXQubGVuZ3RoKSB7CiAgICAgICAgICBwVnR4SW4ucHVzaChwVnR4T3V0LnNoaWZ0KCkpOwogICAgICAgIH0KICAgICAgfSAvLyBvbmx5IGtlZXAgY29udGFjdCBwb2ludHMgdGhhdCBhcmUgYmVoaW5kIHRoZSB3aXRuZXNzIGZhY2UKCgogICAgICBsb2NhbFBsYW5lTm9ybWFsLmNvcHkodGhpcy5mYWNlTm9ybWFsc1tjbG9zZXN0RmFjZUFdKTsKICAgICAgY29uc3QgbG9jYWxQbGFuZUVxID0gdGhpcy5nZXRQbGFuZUNvbnN0YW50T2ZGYWNlKGNsb3Nlc3RGYWNlQSk7CiAgICAgIHBsYW5lTm9ybWFsV1MuY29weShsb2NhbFBsYW5lTm9ybWFsKTsKICAgICAgcXVhdEEudm11bHQocGxhbmVOb3JtYWxXUywgcGxhbmVOb3JtYWxXUyk7CiAgICAgIGNvbnN0IHBsYW5lRXFXUyA9IGxvY2FsUGxhbmVFcSAtIHBsYW5lTm9ybWFsV1MuZG90KHBvc0EpOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBwVnR4SW4ubGVuZ3RoOyBpKyspIHsKICAgICAgICBsZXQgZGVwdGggPSBwbGFuZU5vcm1hbFdTLmRvdChwVnR4SW5baV0pICsgcGxhbmVFcVdTOyAvLyA/Pz8KCiAgICAgICAgaWYgKGRlcHRoIDw9IG1pbkRpc3QpIHsKICAgICAgICAgIGNvbnNvbGUubG9nKGBjbGFtcGVkOiBkZXB0aD0ke2RlcHRofSB0byBtaW5EaXN0PSR7bWluRGlzdH1gKTsKICAgICAgICAgIGRlcHRoID0gbWluRGlzdDsKICAgICAgICB9CgogICAgICAgIGlmIChkZXB0aCA8PSBtYXhEaXN0KSB7CiAgICAgICAgICBjb25zdCBwb2ludCA9IHBWdHhJbltpXTsKCiAgICAgICAgICBpZiAoZGVwdGggPD0gMWUtNikgewogICAgICAgICAgICBjb25zdCBwID0gewogICAgICAgICAgICAgIHBvaW50LAogICAgICAgICAgICAgIG5vcm1hbDogcGxhbmVOb3JtYWxXUywKICAgICAgICAgICAgICBkZXB0aAogICAgICAgICAgICB9OwogICAgICAgICAgICByZXN1bHQucHVzaChwKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogQ2xpcCBhIGZhY2UgaW4gYSBodWxsIGFnYWluc3QgdGhlIGJhY2sgb2YgYSBwbGFuZS4KICAgICAqIEBwYXJhbSBwbGFuZUNvbnN0YW50IFRoZSBjb25zdGFudCBpbiB0aGUgbWF0aGVtYXRpY2FsIHBsYW5lIGVxdWF0aW9uCiAgICAgKi8KCgogICAgY2xpcEZhY2VBZ2FpbnN0UGxhbmUoaW5WZXJ0aWNlcywgb3V0VmVydGljZXMsIHBsYW5lTm9ybWFsLCBwbGFuZUNvbnN0YW50KSB7CiAgICAgIGxldCBuX2RvdF9maXJzdDsKICAgICAgbGV0IG5fZG90X2xhc3Q7CiAgICAgIGNvbnN0IG51bVZlcnRzID0gaW5WZXJ0aWNlcy5sZW5ndGg7CgogICAgICBpZiAobnVtVmVydHMgPCAyKSB7CiAgICAgICAgcmV0dXJuIG91dFZlcnRpY2VzOwogICAgICB9CgogICAgICBsZXQgZmlyc3RWZXJ0ZXggPSBpblZlcnRpY2VzW2luVmVydGljZXMubGVuZ3RoIC0gMV07CiAgICAgIGxldCBsYXN0VmVydGV4ID0gaW5WZXJ0aWNlc1swXTsKICAgICAgbl9kb3RfZmlyc3QgPSBwbGFuZU5vcm1hbC5kb3QoZmlyc3RWZXJ0ZXgpICsgcGxhbmVDb25zdGFudDsKCiAgICAgIGZvciAobGV0IHZpID0gMDsgdmkgPCBudW1WZXJ0czsgdmkrKykgewogICAgICAgIGxhc3RWZXJ0ZXggPSBpblZlcnRpY2VzW3ZpXTsKICAgICAgICBuX2RvdF9sYXN0ID0gcGxhbmVOb3JtYWwuZG90KGxhc3RWZXJ0ZXgpICsgcGxhbmVDb25zdGFudDsKCiAgICAgICAgaWYgKG5fZG90X2ZpcnN0IDwgMCkgewogICAgICAgICAgaWYgKG5fZG90X2xhc3QgPCAwKSB7CiAgICAgICAgICAgIC8vIFN0YXJ0IDwgMCwgZW5kIDwgMCwgc28gb3V0cHV0IGxhc3RWZXJ0ZXgKICAgICAgICAgICAgY29uc3QgbmV3diA9IG5ldyBWZWMzKCk7CiAgICAgICAgICAgIG5ld3YuY29weShsYXN0VmVydGV4KTsKICAgICAgICAgICAgb3V0VmVydGljZXMucHVzaChuZXd2KTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIC8vIFN0YXJ0IDwgMCwgZW5kID49IDAsIHNvIG91dHB1dCBpbnRlcnNlY3Rpb24KICAgICAgICAgICAgY29uc3QgbmV3diA9IG5ldyBWZWMzKCk7CiAgICAgICAgICAgIGZpcnN0VmVydGV4LmxlcnAobGFzdFZlcnRleCwgbl9kb3RfZmlyc3QgLyAobl9kb3RfZmlyc3QgLSBuX2RvdF9sYXN0KSwgbmV3dik7CiAgICAgICAgICAgIG91dFZlcnRpY2VzLnB1c2gobmV3dik7CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGlmIChuX2RvdF9sYXN0IDwgMCkgewogICAgICAgICAgICAvLyBTdGFydCA+PSAwLCBlbmQgPCAwIHNvIG91dHB1dCBpbnRlcnNlY3Rpb24gYW5kIGVuZAogICAgICAgICAgICBjb25zdCBuZXd2ID0gbmV3IFZlYzMoKTsKICAgICAgICAgICAgZmlyc3RWZXJ0ZXgubGVycChsYXN0VmVydGV4LCBuX2RvdF9maXJzdCAvIChuX2RvdF9maXJzdCAtIG5fZG90X2xhc3QpLCBuZXd2KTsKICAgICAgICAgICAgb3V0VmVydGljZXMucHVzaChuZXd2KTsKICAgICAgICAgICAgb3V0VmVydGljZXMucHVzaChsYXN0VmVydGV4KTsKICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGZpcnN0VmVydGV4ID0gbGFzdFZlcnRleDsKICAgICAgICBuX2RvdF9maXJzdCA9IG5fZG90X2xhc3Q7CiAgICAgIH0KCiAgICAgIHJldHVybiBvdXRWZXJ0aWNlczsKICAgIH0KICAgIC8qKgogICAgICogVXBkYXRlcyBgLndvcmxkVmVydGljZXNgIGFuZCBzZXRzIGAud29ybGRWZXJ0aWNlc05lZWRzVXBkYXRlYCB0byBmYWxzZS4KICAgICAqLwoKCiAgICBjb21wdXRlV29ybGRWZXJ0aWNlcyhwb3NpdGlvbiwgcXVhdCkgewogICAgICB3aGlsZSAodGhpcy53b3JsZFZlcnRpY2VzLmxlbmd0aCA8IHRoaXMudmVydGljZXMubGVuZ3RoKSB7CiAgICAgICAgdGhpcy53b3JsZFZlcnRpY2VzLnB1c2gobmV3IFZlYzMoKSk7CiAgICAgIH0KCiAgICAgIGNvbnN0IHZlcnRzID0gdGhpcy52ZXJ0aWNlczsKICAgICAgY29uc3Qgd29ybGRWZXJ0cyA9IHRoaXMud29ybGRWZXJ0aWNlczsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpICE9PSB0aGlzLnZlcnRpY2VzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgcXVhdC52bXVsdCh2ZXJ0c1tpXSwgd29ybGRWZXJ0c1tpXSk7CiAgICAgICAgcG9zaXRpb24udmFkZCh3b3JsZFZlcnRzW2ldLCB3b3JsZFZlcnRzW2ldKTsKICAgICAgfQoKICAgICAgdGhpcy53b3JsZFZlcnRpY2VzTmVlZHNVcGRhdGUgPSBmYWxzZTsKICAgIH0KCiAgICBjb21wdXRlTG9jYWxBQUJCKGFhYmJtaW4sIGFhYmJtYXgpIHsKICAgICAgY29uc3QgdmVydGljZXMgPSB0aGlzLnZlcnRpY2VzOwogICAgICBhYWJibWluLnNldChOdW1iZXIuTUFYX1ZBTFVFLCBOdW1iZXIuTUFYX1ZBTFVFLCBOdW1iZXIuTUFYX1ZBTFVFKTsKICAgICAgYWFiYm1heC5zZXQoLU51bWJlci5NQVhfVkFMVUUsIC1OdW1iZXIuTUFYX1ZBTFVFLCAtTnVtYmVyLk1BWF9WQUxVRSk7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMudmVydGljZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICBjb25zdCB2ID0gdmVydGljZXNbaV07CgogICAgICAgIGlmICh2LnggPCBhYWJibWluLngpIHsKICAgICAgICAgIGFhYmJtaW4ueCA9IHYueDsKICAgICAgICB9IGVsc2UgaWYgKHYueCA+IGFhYmJtYXgueCkgewogICAgICAgICAgYWFiYm1heC54ID0gdi54OwogICAgICAgIH0KCiAgICAgICAgaWYgKHYueSA8IGFhYmJtaW4ueSkgewogICAgICAgICAgYWFiYm1pbi55ID0gdi55OwogICAgICAgIH0gZWxzZSBpZiAodi55ID4gYWFiYm1heC55KSB7CiAgICAgICAgICBhYWJibWF4LnkgPSB2Lnk7CiAgICAgICAgfQoKICAgICAgICBpZiAodi56IDwgYWFiYm1pbi56KSB7CiAgICAgICAgICBhYWJibWluLnogPSB2Lno7CiAgICAgICAgfSBlbHNlIGlmICh2LnogPiBhYWJibWF4LnopIHsKICAgICAgICAgIGFhYmJtYXgueiA9IHYuejsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogVXBkYXRlcyBgd29ybGRWZXJ0aWNlc2AgYW5kIHNldHMgYHdvcmxkVmVydGljZXNOZWVkc1VwZGF0ZWAgdG8gZmFsc2UuCiAgICAgKi8KCgogICAgY29tcHV0ZVdvcmxkRmFjZU5vcm1hbHMocXVhdCkgewogICAgICBjb25zdCBOID0gdGhpcy5mYWNlTm9ybWFscy5sZW5ndGg7CgogICAgICB3aGlsZSAodGhpcy53b3JsZEZhY2VOb3JtYWxzLmxlbmd0aCA8IE4pIHsKICAgICAgICB0aGlzLndvcmxkRmFjZU5vcm1hbHMucHVzaChuZXcgVmVjMygpKTsKICAgICAgfQoKICAgICAgY29uc3Qgbm9ybWFscyA9IHRoaXMuZmFjZU5vcm1hbHM7CiAgICAgIGNvbnN0IHdvcmxkTm9ybWFscyA9IHRoaXMud29ybGRGYWNlTm9ybWFsczsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpICE9PSBOOyBpKyspIHsKICAgICAgICBxdWF0LnZtdWx0KG5vcm1hbHNbaV0sIHdvcmxkTm9ybWFsc1tpXSk7CiAgICAgIH0KCiAgICAgIHRoaXMud29ybGRGYWNlTm9ybWFsc05lZWRzVXBkYXRlID0gZmFsc2U7CiAgICB9CiAgICAvKioKICAgICAqIHVwZGF0ZUJvdW5kaW5nU3BoZXJlUmFkaXVzCiAgICAgKi8KCgogICAgdXBkYXRlQm91bmRpbmdTcGhlcmVSYWRpdXMoKSB7CiAgICAgIC8vIEFzc3VtZSBwb2ludHMgYXJlIGRpc3RyaWJ1dGVkIHdpdGggbG9jYWwgKDAsMCwwKSBhcyBjZW50ZXIKICAgICAgbGV0IG1heDIgPSAwOwogICAgICBjb25zdCB2ZXJ0cyA9IHRoaXMudmVydGljZXM7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gdmVydHMubGVuZ3RoOyBpKyspIHsKICAgICAgICBjb25zdCBub3JtMiA9IHZlcnRzW2ldLmxlbmd0aFNxdWFyZWQoKTsKCiAgICAgICAgaWYgKG5vcm0yID4gbWF4MikgewogICAgICAgICAgbWF4MiA9IG5vcm0yOwogICAgICAgIH0KICAgICAgfQoKICAgICAgdGhpcy5ib3VuZGluZ1NwaGVyZVJhZGl1cyA9IE1hdGguc3FydChtYXgyKTsKICAgIH0KICAgIC8qKgogICAgICogY2FsY3VsYXRlV29ybGRBQUJCCiAgICAgKi8KCgogICAgY2FsY3VsYXRlV29ybGRBQUJCKHBvcywgcXVhdCwgbWluLCBtYXgpIHsKICAgICAgY29uc3QgdmVydHMgPSB0aGlzLnZlcnRpY2VzOwogICAgICBsZXQgbWlueDsKICAgICAgbGV0IG1pbnk7CiAgICAgIGxldCBtaW56OwogICAgICBsZXQgbWF4eDsKICAgICAgbGV0IG1heHk7CiAgICAgIGxldCBtYXh6OwogICAgICBsZXQgdGVtcFdvcmxkVmVydGV4ID0gbmV3IFZlYzMoKTsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdmVydHMubGVuZ3RoOyBpKyspIHsKICAgICAgICB0ZW1wV29ybGRWZXJ0ZXguY29weSh2ZXJ0c1tpXSk7CiAgICAgICAgcXVhdC52bXVsdCh0ZW1wV29ybGRWZXJ0ZXgsIHRlbXBXb3JsZFZlcnRleCk7CiAgICAgICAgcG9zLnZhZGQodGVtcFdvcmxkVmVydGV4LCB0ZW1wV29ybGRWZXJ0ZXgpOwogICAgICAgIGNvbnN0IHYgPSB0ZW1wV29ybGRWZXJ0ZXg7CgogICAgICAgIGlmIChtaW54ID09PSB1bmRlZmluZWQgfHwgdi54IDwgbWlueCkgewogICAgICAgICAgbWlueCA9IHYueDsKICAgICAgICB9CgogICAgICAgIGlmIChtYXh4ID09PSB1bmRlZmluZWQgfHwgdi54ID4gbWF4eCkgewogICAgICAgICAgbWF4eCA9IHYueDsKICAgICAgICB9CgogICAgICAgIGlmIChtaW55ID09PSB1bmRlZmluZWQgfHwgdi55IDwgbWlueSkgewogICAgICAgICAgbWlueSA9IHYueTsKICAgICAgICB9CgogICAgICAgIGlmIChtYXh5ID09PSB1bmRlZmluZWQgfHwgdi55ID4gbWF4eSkgewogICAgICAgICAgbWF4eSA9IHYueTsKICAgICAgICB9CgogICAgICAgIGlmIChtaW56ID09PSB1bmRlZmluZWQgfHwgdi56IDwgbWlueikgewogICAgICAgICAgbWlueiA9IHYuejsKICAgICAgICB9CgogICAgICAgIGlmIChtYXh6ID09PSB1bmRlZmluZWQgfHwgdi56ID4gbWF4eikgewogICAgICAgICAgbWF4eiA9IHYuejsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIG1pbi5zZXQobWlueCwgbWlueSwgbWlueik7CiAgICAgIG1heC5zZXQobWF4eCwgbWF4eSwgbWF4eik7CiAgICB9CiAgICAvKioKICAgICAqIEdldCBhcHByb3hpbWF0ZSBjb252ZXggdm9sdW1lCiAgICAgKi8KCgogICAgdm9sdW1lKCkgewogICAgICByZXR1cm4gNC4wICogTWF0aC5QSSAqIHRoaXMuYm91bmRpbmdTcGhlcmVSYWRpdXMgLyAzLjA7CiAgICB9CiAgICAvKioKICAgICAqIEdldCBhbiBhdmVyYWdlIG9mIGFsbCB0aGUgdmVydGljZXMgcG9zaXRpb25zCiAgICAgKi8KCgogICAgZ2V0QXZlcmFnZVBvaW50TG9jYWwodGFyZ2V0KSB7CiAgICAgIGlmICh0YXJnZXQgPT09IHZvaWQgMCkgewogICAgICAgIHRhcmdldCA9IG5ldyBWZWMzKCk7CiAgICAgIH0KCiAgICAgIGNvbnN0IHZlcnRzID0gdGhpcy52ZXJ0aWNlczsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdmVydHMubGVuZ3RoOyBpKyspIHsKICAgICAgICB0YXJnZXQudmFkZCh2ZXJ0c1tpXSwgdGFyZ2V0KTsKICAgICAgfQoKICAgICAgdGFyZ2V0LnNjYWxlKDEgLyB2ZXJ0cy5sZW5ndGgsIHRhcmdldCk7CiAgICAgIHJldHVybiB0YXJnZXQ7CiAgICB9CiAgICAvKioKICAgICAqIFRyYW5zZm9ybSBhbGwgbG9jYWwgcG9pbnRzLiBXaWxsIGNoYW5nZSB0aGUgLnZlcnRpY2VzCiAgICAgKi8KCgogICAgdHJhbnNmb3JtQWxsUG9pbnRzKG9mZnNldCwgcXVhdCkgewogICAgICBjb25zdCBuID0gdGhpcy52ZXJ0aWNlcy5sZW5ndGg7CiAgICAgIGNvbnN0IHZlcnRzID0gdGhpcy52ZXJ0aWNlczsgLy8gQXBwbHkgcm90YXRpb24KCiAgICAgIGlmIChxdWF0KSB7CiAgICAgICAgLy8gUm90YXRlIHZlcnRpY2VzCiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBuOyBpKyspIHsKICAgICAgICAgIGNvbnN0IHYgPSB2ZXJ0c1tpXTsKICAgICAgICAgIHF1YXQudm11bHQodiwgdik7CiAgICAgICAgfSAvLyBSb3RhdGUgZmFjZSBub3JtYWxzCgoKICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMuZmFjZU5vcm1hbHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgIGNvbnN0IHYgPSB0aGlzLmZhY2VOb3JtYWxzW2ldOwogICAgICAgICAgcXVhdC52bXVsdCh2LCB2KTsKICAgICAgICB9CiAgICAgICAgLyoKICAgICAgICAgICAgICAvLyBSb3RhdGUgZWRnZXMKICAgICAgICAgICAgICBmb3IobGV0IGk9MDsgaTx0aGlzLnVuaXF1ZUVkZ2VzLmxlbmd0aDsgaSsrKXsKICAgICAgICAgICAgICAgICAgY29uc3QgdiA9IHRoaXMudW5pcXVlRWRnZXNbaV07CiAgICAgICAgICAgICAgICAgIHF1YXQudm11bHQodix2KTsKICAgICAgICAgICAgICB9Ki8KCiAgICAgIH0gLy8gQXBwbHkgb2Zmc2V0CgoKICAgICAgaWYgKG9mZnNldCkgewogICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbjsgaSsrKSB7CiAgICAgICAgICBjb25zdCB2ID0gdmVydHNbaV07CiAgICAgICAgICB2LnZhZGQob2Zmc2V0LCB2KTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogQ2hlY2tzIHdoZXRoZXIgcCBpcyBpbnNpZGUgdGhlIHBvbHloZWRyYS4gTXVzdCBiZSBpbiBsb2NhbCBjb29yZHMuCiAgICAgKiBUaGUgcG9pbnQgbGllcyBvdXRzaWRlIG9mIHRoZSBjb252ZXggaHVsbCBvZiB0aGUgb3RoZXIgcG9pbnRzIGlmIGFuZCBvbmx5IGlmIHRoZSBkaXJlY3Rpb24KICAgICAqIG9mIGFsbCB0aGUgdmVjdG9ycyBmcm9tIGl0IHRvIHRob3NlIG90aGVyIHBvaW50cyBhcmUgb24gbGVzcyB0aGFuIG9uZSBoYWxmIG9mIGEgc3BoZXJlIGFyb3VuZCBpdC4KICAgICAqIEBwYXJhbSBwIEEgcG9pbnQgZ2l2ZW4gaW4gbG9jYWwgY29vcmRpbmF0ZXMKICAgICAqLwoKCiAgICBwb2ludElzSW5zaWRlKHApIHsKICAgICAgY29uc3QgdmVydHMgPSB0aGlzLnZlcnRpY2VzOwogICAgICBjb25zdCBmYWNlcyA9IHRoaXMuZmFjZXM7CiAgICAgIGNvbnN0IG5vcm1hbHMgPSB0aGlzLmZhY2VOb3JtYWxzOwogICAgICBjb25zdCBwb3NpdGl2ZVJlc3VsdCA9IG51bGw7CiAgICAgIGNvbnN0IHBvaW50SW5zaWRlID0gbmV3IFZlYzMoKTsKICAgICAgdGhpcy5nZXRBdmVyYWdlUG9pbnRMb2NhbChwb2ludEluc2lkZSk7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMuZmFjZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICBsZXQgbiA9IG5vcm1hbHNbaV07CiAgICAgICAgY29uc3QgdiA9IHZlcnRzW2ZhY2VzW2ldWzBdXTsgLy8gV2Ugb25seSBuZWVkIG9uZSBwb2ludCBpbiB0aGUgZmFjZQogICAgICAgIC8vIFRoaXMgZG90IHByb2R1Y3QgZGV0ZXJtaW5lcyB3aGljaCBzaWRlIG9mIHRoZSBlZGdlIHRoZSBwb2ludCBpcwoKICAgICAgICBjb25zdCB2VG9QID0gbmV3IFZlYzMoKTsKICAgICAgICBwLnZzdWIodiwgdlRvUCk7CiAgICAgICAgY29uc3QgcjEgPSBuLmRvdCh2VG9QKTsKICAgICAgICBjb25zdCB2VG9Qb2ludEluc2lkZSA9IG5ldyBWZWMzKCk7CiAgICAgICAgcG9pbnRJbnNpZGUudnN1Yih2LCB2VG9Qb2ludEluc2lkZSk7CiAgICAgICAgY29uc3QgcjIgPSBuLmRvdCh2VG9Qb2ludEluc2lkZSk7CgogICAgICAgIGlmIChyMSA8IDAgJiYgcjIgPiAwIHx8IHIxID4gMCAmJiByMiA8IDApIHsKICAgICAgICAgIHJldHVybiBmYWxzZTsgLy8gRW5jb3VudGVyZWQgc29tZSBvdGhlciBzaWduLiBFeGl0LgogICAgICAgIH0KICAgICAgfSAvLyBJZiB3ZSBnb3QgaGVyZSwgYWxsIGRvdCBwcm9kdWN0cyB3ZXJlIG9mIHRoZSBzYW1lIHNpZ24uCgoKICAgICAgcmV0dXJuIHBvc2l0aXZlUmVzdWx0ID8gMSA6IC0xOwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgbWF4IGFuZCBtaW4gZG90IHByb2R1Y3Qgb2YgYSBjb252ZXggaHVsbCBhdCBwb3NpdGlvbiAocG9zLHF1YXQpIHByb2plY3RlZCBvbnRvIGFuIGF4aXMuCiAgICAgKiBSZXN1bHRzIGFyZSBzYXZlZCBpbiB0aGUgYXJyYXkgbWF4bWluLgogICAgICogQHBhcmFtIHJlc3VsdCByZXN1bHRbMF0gYW5kIHJlc3VsdFsxXSB3aWxsIGJlIHNldCB0byBtYXhpbXVtIGFuZCBtaW5pbXVtLCByZXNwZWN0aXZlbHkuCiAgICAgKi8KCgogICAgc3RhdGljIHByb2plY3Qoc2hhcGUsIGF4aXMsIHBvcywgcXVhdCwgcmVzdWx0KSB7CiAgICAgIGNvbnN0IG4gPSBzaGFwZS52ZXJ0aWNlcy5sZW5ndGg7CiAgICAgIGNvbnN0IGxvY2FsQXhpcyA9IHByb2plY3RfbG9jYWxBeGlzOwogICAgICBsZXQgbWF4ID0gMDsKICAgICAgbGV0IG1pbiA9IDA7CiAgICAgIGNvbnN0IGxvY2FsT3JpZ2luID0gcHJvamVjdF9sb2NhbE9yaWdpbjsKICAgICAgY29uc3QgdnMgPSBzaGFwZS52ZXJ0aWNlczsKICAgICAgbG9jYWxPcmlnaW4uc2V0WmVybygpOyAvLyBUcmFuc2Zvcm0gdGhlIGF4aXMgdG8gbG9jYWwKCiAgICAgIFRyYW5zZm9ybS52ZWN0b3JUb0xvY2FsRnJhbWUocG9zLCBxdWF0LCBheGlzLCBsb2NhbEF4aXMpOwogICAgICBUcmFuc2Zvcm0ucG9pbnRUb0xvY2FsRnJhbWUocG9zLCBxdWF0LCBsb2NhbE9yaWdpbiwgbG9jYWxPcmlnaW4pOwogICAgICBjb25zdCBhZGQgPSBsb2NhbE9yaWdpbi5kb3QobG9jYWxBeGlzKTsKICAgICAgbWluID0gbWF4ID0gdnNbMF0uZG90KGxvY2FsQXhpcyk7CgogICAgICBmb3IgKGxldCBpID0gMTsgaSA8IG47IGkrKykgewogICAgICAgIGNvbnN0IHZhbCA9IHZzW2ldLmRvdChsb2NhbEF4aXMpOwoKICAgICAgICBpZiAodmFsID4gbWF4KSB7CiAgICAgICAgICBtYXggPSB2YWw7CiAgICAgICAgfQoKICAgICAgICBpZiAodmFsIDwgbWluKSB7CiAgICAgICAgICBtaW4gPSB2YWw7CiAgICAgICAgfQogICAgICB9CgogICAgICBtaW4gLT0gYWRkOwogICAgICBtYXggLT0gYWRkOwoKICAgICAgaWYgKG1pbiA+IG1heCkgewogICAgICAgIC8vIEluY29uc2lzdGVudCAtIHN3YXAKICAgICAgICBjb25zdCB0ZW1wID0gbWluOwogICAgICAgIG1pbiA9IG1heDsKICAgICAgICBtYXggPSB0ZW1wOwogICAgICB9IC8vIE91dHB1dAoKCiAgICAgIHJlc3VsdFswXSA9IG1heDsKICAgICAgcmVzdWx0WzFdID0gbWluOwogICAgfQoKICB9CiAgY29uc3QgbWF4bWluQSA9IFtdOwogIGNvbnN0IG1heG1pbkIgPSBbXTsKICBuZXcgVmVjMygpOwogIGNvbnN0IHByb2plY3RfbG9jYWxBeGlzID0gbmV3IFZlYzMoKTsKICBjb25zdCBwcm9qZWN0X2xvY2FsT3JpZ2luID0gbmV3IFZlYzMoKTsKCiAgLyoqCiAgICogQSAzZCBib3ggc2hhcGUuCiAgICogQGV4YW1wbGUKICAgKiAgICAgY29uc3Qgc2l6ZSA9IDEKICAgKiAgICAgY29uc3QgaGFsZkV4dGVudHMgPSBuZXcgQ0FOTk9OLlZlYzMoc2l6ZSwgc2l6ZSwgc2l6ZSkKICAgKiAgICAgY29uc3QgYm94U2hhcGUgPSBuZXcgQ0FOTk9OLkJveChoYWxmRXh0ZW50cykKICAgKiAgICAgY29uc3QgYm94Qm9keSA9IG5ldyBDQU5OT04uQm9keSh7IG1hc3M6IDEsIHNoYXBlOiBib3hTaGFwZSB9KQogICAqICAgICB3b3JsZC5hZGRCb2R5KGJveEJvZHkpCiAgICovCiAgY2xhc3MgQm94IGV4dGVuZHMgU2hhcGUgewogICAgLyoqCiAgICAgKiBUaGUgaGFsZiBleHRlbnRzIG9mIHRoZSBib3guCiAgICAgKi8KCiAgICAvKioKICAgICAqIFVzZWQgYnkgdGhlIGNvbnRhY3QgZ2VuZXJhdG9yIHRvIG1ha2UgY29udGFjdHMgd2l0aCBvdGhlciBjb252ZXggcG9seWhlZHJhIGZvciBleGFtcGxlLgogICAgICovCiAgICBjb25zdHJ1Y3RvcihoYWxmRXh0ZW50cykgewogICAgICBzdXBlcih7CiAgICAgICAgdHlwZTogU2hhcGUudHlwZXMuQk9YCiAgICAgIH0pOwogICAgICB0aGlzLmhhbGZFeHRlbnRzID0gaGFsZkV4dGVudHM7CiAgICAgIHRoaXMuY29udmV4UG9seWhlZHJvblJlcHJlc2VudGF0aW9uID0gbnVsbDsKICAgICAgdGhpcy51cGRhdGVDb252ZXhQb2x5aGVkcm9uUmVwcmVzZW50YXRpb24oKTsKICAgICAgdGhpcy51cGRhdGVCb3VuZGluZ1NwaGVyZVJhZGl1cygpOwogICAgfQogICAgLyoqCiAgICAgKiBVcGRhdGVzIHRoZSBsb2NhbCBjb252ZXggcG9seWhlZHJvbiByZXByZXNlbnRhdGlvbiB1c2VkIGZvciBzb21lIGNvbGxpc2lvbnMuCiAgICAgKi8KCgogICAgdXBkYXRlQ29udmV4UG9seWhlZHJvblJlcHJlc2VudGF0aW9uKCkgewogICAgICBjb25zdCBzeCA9IHRoaXMuaGFsZkV4dGVudHMueDsKICAgICAgY29uc3Qgc3kgPSB0aGlzLmhhbGZFeHRlbnRzLnk7CiAgICAgIGNvbnN0IHN6ID0gdGhpcy5oYWxmRXh0ZW50cy56OwogICAgICBjb25zdCBWID0gVmVjMzsKICAgICAgY29uc3QgdmVydGljZXMgPSBbbmV3IFYoLXN4LCAtc3ksIC1zeiksIG5ldyBWKHN4LCAtc3ksIC1zeiksIG5ldyBWKHN4LCBzeSwgLXN6KSwgbmV3IFYoLXN4LCBzeSwgLXN6KSwgbmV3IFYoLXN4LCAtc3ksIHN6KSwgbmV3IFYoc3gsIC1zeSwgc3opLCBuZXcgVihzeCwgc3ksIHN6KSwgbmV3IFYoLXN4LCBzeSwgc3opXTsKICAgICAgY29uc3QgZmFjZXMgPSBbWzMsIDIsIDEsIDBdLCAvLyAtegogICAgICBbNCwgNSwgNiwgN10sIC8vICt6CiAgICAgIFs1LCA0LCAwLCAxXSwgLy8gLXkKICAgICAgWzIsIDMsIDcsIDZdLCAvLyAreQogICAgICBbMCwgNCwgNywgM10sIC8vIC14CiAgICAgIFsxLCAyLCA2LCA1XSAvLyAreAogICAgICBdOwogICAgICBjb25zdCBheGVzID0gW25ldyBWKDAsIDAsIDEpLCBuZXcgVigwLCAxLCAwKSwgbmV3IFYoMSwgMCwgMCldOwogICAgICBjb25zdCBoID0gbmV3IENvbnZleFBvbHloZWRyb24oewogICAgICAgIHZlcnRpY2VzLAogICAgICAgIGZhY2VzLAogICAgICAgIGF4ZXMKICAgICAgfSk7CiAgICAgIHRoaXMuY29udmV4UG9seWhlZHJvblJlcHJlc2VudGF0aW9uID0gaDsKICAgICAgaC5tYXRlcmlhbCA9IHRoaXMubWF0ZXJpYWw7CiAgICB9CiAgICAvKioKICAgICAqIENhbGN1bGF0ZSB0aGUgaW5lcnRpYSBvZiB0aGUgYm94LgogICAgICovCgoKICAgIGNhbGN1bGF0ZUxvY2FsSW5lcnRpYShtYXNzLCB0YXJnZXQpIHsKICAgICAgaWYgKHRhcmdldCA9PT0gdm9pZCAwKSB7CiAgICAgICAgdGFyZ2V0ID0gbmV3IFZlYzMoKTsKICAgICAgfQoKICAgICAgQm94LmNhbGN1bGF0ZUluZXJ0aWEodGhpcy5oYWxmRXh0ZW50cywgbWFzcywgdGFyZ2V0KTsKICAgICAgcmV0dXJuIHRhcmdldDsKICAgIH0KCiAgICBzdGF0aWMgY2FsY3VsYXRlSW5lcnRpYShoYWxmRXh0ZW50cywgbWFzcywgdGFyZ2V0KSB7CiAgICAgIGNvbnN0IGUgPSBoYWxmRXh0ZW50czsKICAgICAgdGFyZ2V0LnggPSAxLjAgLyAxMi4wICogbWFzcyAqICgyICogZS55ICogMiAqIGUueSArIDIgKiBlLnogKiAyICogZS56KTsKICAgICAgdGFyZ2V0LnkgPSAxLjAgLyAxMi4wICogbWFzcyAqICgyICogZS54ICogMiAqIGUueCArIDIgKiBlLnogKiAyICogZS56KTsKICAgICAgdGFyZ2V0LnogPSAxLjAgLyAxMi4wICogbWFzcyAqICgyICogZS55ICogMiAqIGUueSArIDIgKiBlLnggKiAyICogZS54KTsKICAgIH0KICAgIC8qKgogICAgICogR2V0IHRoZSBib3ggNiBzaWRlIG5vcm1hbHMKICAgICAqIEBwYXJhbSBzaXhUYXJnZXRWZWN0b3JzIEFuIGFycmF5IG9mIDYgdmVjdG9ycywgdG8gc3RvcmUgdGhlIHJlc3VsdGluZyBzaWRlIG5vcm1hbHMgaW4uCiAgICAgKiBAcGFyYW0gcXVhdCBPcmllbnRhdGlvbiB0byBhcHBseSB0byB0aGUgbm9ybWFsIHZlY3RvcnMuIElmIG5vdCBwcm92aWRlZCwgdGhlIHZlY3RvcnMgd2lsbCBiZSBpbiByZXNwZWN0IHRvIHRoZSBsb2NhbCBmcmFtZS4KICAgICAqLwoKCiAgICBnZXRTaWRlTm9ybWFscyhzaXhUYXJnZXRWZWN0b3JzLCBxdWF0KSB7CiAgICAgIGNvbnN0IHNpZGVzID0gc2l4VGFyZ2V0VmVjdG9yczsKICAgICAgY29uc3QgZXggPSB0aGlzLmhhbGZFeHRlbnRzOwogICAgICBzaWRlc1swXS5zZXQoZXgueCwgMCwgMCk7CiAgICAgIHNpZGVzWzFdLnNldCgwLCBleC55LCAwKTsKICAgICAgc2lkZXNbMl0uc2V0KDAsIDAsIGV4LnopOwogICAgICBzaWRlc1szXS5zZXQoLWV4LngsIDAsIDApOwogICAgICBzaWRlc1s0XS5zZXQoMCwgLWV4LnksIDApOwogICAgICBzaWRlc1s1XS5zZXQoMCwgMCwgLWV4LnopOwoKICAgICAgaWYgKHF1YXQgIT09IHVuZGVmaW5lZCkgewogICAgICAgIGZvciAobGV0IGkgPSAwOyBpICE9PSBzaWRlcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgcXVhdC52bXVsdChzaWRlc1tpXSwgc2lkZXNbaV0pOwogICAgICAgIH0KICAgICAgfQoKICAgICAgcmV0dXJuIHNpZGVzOwogICAgfQogICAgLyoqCiAgICAgKiBSZXR1cm5zIHRoZSB2b2x1bWUgb2YgdGhlIGJveC4KICAgICAqLwoKCiAgICB2b2x1bWUoKSB7CiAgICAgIHJldHVybiA4LjAgKiB0aGlzLmhhbGZFeHRlbnRzLnggKiB0aGlzLmhhbGZFeHRlbnRzLnkgKiB0aGlzLmhhbGZFeHRlbnRzLno7CiAgICB9CiAgICAvKioKICAgICAqIHVwZGF0ZUJvdW5kaW5nU3BoZXJlUmFkaXVzCiAgICAgKi8KCgogICAgdXBkYXRlQm91bmRpbmdTcGhlcmVSYWRpdXMoKSB7CiAgICAgIHRoaXMuYm91bmRpbmdTcGhlcmVSYWRpdXMgPSB0aGlzLmhhbGZFeHRlbnRzLmxlbmd0aCgpOwogICAgfQogICAgLyoqCiAgICAgKiBmb3JFYWNoV29ybGRDb3JuZXIKICAgICAqLwoKCiAgICBmb3JFYWNoV29ybGRDb3JuZXIocG9zLCBxdWF0LCBjYWxsYmFjaykgewogICAgICBjb25zdCBlID0gdGhpcy5oYWxmRXh0ZW50czsKICAgICAgY29uc3QgY29ybmVycyA9IFtbZS54LCBlLnksIGUuel0sIFstZS54LCBlLnksIGUuel0sIFstZS54LCAtZS55LCBlLnpdLCBbLWUueCwgLWUueSwgLWUuel0sIFtlLngsIC1lLnksIC1lLnpdLCBbZS54LCBlLnksIC1lLnpdLCBbLWUueCwgZS55LCAtZS56XSwgW2UueCwgLWUueSwgZS56XV07CgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGNvcm5lcnMubGVuZ3RoOyBpKyspIHsKICAgICAgICB3b3JsZENvcm5lclRlbXBQb3Muc2V0KGNvcm5lcnNbaV1bMF0sIGNvcm5lcnNbaV1bMV0sIGNvcm5lcnNbaV1bMl0pOwogICAgICAgIHF1YXQudm11bHQod29ybGRDb3JuZXJUZW1wUG9zLCB3b3JsZENvcm5lclRlbXBQb3MpOwogICAgICAgIHBvcy52YWRkKHdvcmxkQ29ybmVyVGVtcFBvcywgd29ybGRDb3JuZXJUZW1wUG9zKTsKICAgICAgICBjYWxsYmFjayh3b3JsZENvcm5lclRlbXBQb3MueCwgd29ybGRDb3JuZXJUZW1wUG9zLnksIHdvcmxkQ29ybmVyVGVtcFBvcy56KTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBjYWxjdWxhdGVXb3JsZEFBQkIKICAgICAqLwoKCiAgICBjYWxjdWxhdGVXb3JsZEFBQkIocG9zLCBxdWF0LCBtaW4sIG1heCkgewogICAgICBjb25zdCBlID0gdGhpcy5oYWxmRXh0ZW50czsKICAgICAgd29ybGRDb3JuZXJzVGVtcFswXS5zZXQoZS54LCBlLnksIGUueik7CiAgICAgIHdvcmxkQ29ybmVyc1RlbXBbMV0uc2V0KC1lLngsIGUueSwgZS56KTsKICAgICAgd29ybGRDb3JuZXJzVGVtcFsyXS5zZXQoLWUueCwgLWUueSwgZS56KTsKICAgICAgd29ybGRDb3JuZXJzVGVtcFszXS5zZXQoLWUueCwgLWUueSwgLWUueik7CiAgICAgIHdvcmxkQ29ybmVyc1RlbXBbNF0uc2V0KGUueCwgLWUueSwgLWUueik7CiAgICAgIHdvcmxkQ29ybmVyc1RlbXBbNV0uc2V0KGUueCwgZS55LCAtZS56KTsKICAgICAgd29ybGRDb3JuZXJzVGVtcFs2XS5zZXQoLWUueCwgZS55LCAtZS56KTsKICAgICAgd29ybGRDb3JuZXJzVGVtcFs3XS5zZXQoZS54LCAtZS55LCBlLnopOwogICAgICBjb25zdCB3YyA9IHdvcmxkQ29ybmVyc1RlbXBbMF07CiAgICAgIHF1YXQudm11bHQod2MsIHdjKTsKICAgICAgcG9zLnZhZGQod2MsIHdjKTsKICAgICAgbWF4LmNvcHkod2MpOwogICAgICBtaW4uY29weSh3Yyk7CgogICAgICBmb3IgKGxldCBpID0gMTsgaSA8IDg7IGkrKykgewogICAgICAgIGNvbnN0IHdjID0gd29ybGRDb3JuZXJzVGVtcFtpXTsKICAgICAgICBxdWF0LnZtdWx0KHdjLCB3Yyk7CiAgICAgICAgcG9zLnZhZGQod2MsIHdjKTsKICAgICAgICBjb25zdCB4ID0gd2MueDsKICAgICAgICBjb25zdCB5ID0gd2MueTsKICAgICAgICBjb25zdCB6ID0gd2MuejsKCiAgICAgICAgaWYgKHggPiBtYXgueCkgewogICAgICAgICAgbWF4LnggPSB4OwogICAgICAgIH0KCiAgICAgICAgaWYgKHkgPiBtYXgueSkgewogICAgICAgICAgbWF4LnkgPSB5OwogICAgICAgIH0KCiAgICAgICAgaWYgKHogPiBtYXgueikgewogICAgICAgICAgbWF4LnogPSB6OwogICAgICAgIH0KCiAgICAgICAgaWYgKHggPCBtaW4ueCkgewogICAgICAgICAgbWluLnggPSB4OwogICAgICAgIH0KCiAgICAgICAgaWYgKHkgPCBtaW4ueSkgewogICAgICAgICAgbWluLnkgPSB5OwogICAgICAgIH0KCiAgICAgICAgaWYgKHogPCBtaW4ueikgewogICAgICAgICAgbWluLnogPSB6OwogICAgICAgIH0KICAgICAgfSAvLyBHZXQgZWFjaCBheGlzIG1heAogICAgICAvLyBtaW4uc2V0KEluZmluaXR5LEluZmluaXR5LEluZmluaXR5KTsKICAgICAgLy8gbWF4LnNldCgtSW5maW5pdHksLUluZmluaXR5LC1JbmZpbml0eSk7CiAgICAgIC8vIHRoaXMuZm9yRWFjaFdvcmxkQ29ybmVyKHBvcyxxdWF0LGZ1bmN0aW9uKHgseSx6KXsKICAgICAgLy8gICAgIGlmKHggPiBtYXgueCl7CiAgICAgIC8vICAgICAgICAgbWF4LnggPSB4OwogICAgICAvLyAgICAgfQogICAgICAvLyAgICAgaWYoeSA+IG1heC55KXsKICAgICAgLy8gICAgICAgICBtYXgueSA9IHk7CiAgICAgIC8vICAgICB9CiAgICAgIC8vICAgICBpZih6ID4gbWF4LnopewogICAgICAvLyAgICAgICAgIG1heC56ID0gejsKICAgICAgLy8gICAgIH0KICAgICAgLy8gICAgIGlmKHggPCBtaW4ueCl7CiAgICAgIC8vICAgICAgICAgbWluLnggPSB4OwogICAgICAvLyAgICAgfQogICAgICAvLyAgICAgaWYoeSA8IG1pbi55KXsKICAgICAgLy8gICAgICAgICBtaW4ueSA9IHk7CiAgICAgIC8vICAgICB9CiAgICAgIC8vICAgICBpZih6IDwgbWluLnopewogICAgICAvLyAgICAgICAgIG1pbi56ID0gejsKICAgICAgLy8gICAgIH0KICAgICAgLy8gfSk7CgogICAgfQoKICB9CiAgY29uc3Qgd29ybGRDb3JuZXJUZW1wUG9zID0gbmV3IFZlYzMoKTsKICBjb25zdCB3b3JsZENvcm5lcnNUZW1wID0gW25ldyBWZWMzKCksIG5ldyBWZWMzKCksIG5ldyBWZWMzKCksIG5ldyBWZWMzKCksIG5ldyBWZWMzKCksIG5ldyBWZWMzKCksIG5ldyBWZWMzKCksIG5ldyBWZWMzKCldOwoKICAvKioKICAgKiBCT0RZX1RZUEVTCiAgICovCiAgY29uc3QgQk9EWV9UWVBFUyA9IHsKICAgIC8qKiBEWU5BTUlDICovCiAgICBEWU5BTUlDOiAxLAoKICAgIC8qKiBTVEFUSUMgKi8KICAgIFNUQVRJQzogMiwKCiAgICAvKiogS0lORU1BVElDICovCiAgICBLSU5FTUFUSUM6IDQKICB9OwogIC8qKgogICAqIEJvZHlUeXBlCiAgICovCgogIC8qKgogICAqIEJPRFlfU0xFRVBfU1RBVEVTCiAgICovCiAgY29uc3QgQk9EWV9TTEVFUF9TVEFURVMgPSB7CiAgICAvKiogQVdBS0UgKi8KICAgIEFXQUtFOiAwLAoKICAgIC8qKiBTTEVFUFkgKi8KICAgIFNMRUVQWTogMSwKCiAgICAvKiogU0xFRVBJTkcgKi8KICAgIFNMRUVQSU5HOiAyCiAgfTsKICAvKioKICAgKiBCb2R5U2xlZXBTdGF0ZQogICAqLwoKICAvKioKICAgKiBCYXNlIGNsYXNzIGZvciBhbGwgYm9keSB0eXBlcy4KICAgKiBAZXhhbXBsZQogICAqICAgICBjb25zdCBzaGFwZSA9IG5ldyBDQU5OT04uU3BoZXJlKDEpCiAgICogICAgIGNvbnN0IGJvZHkgPSBuZXcgQ0FOTk9OLkJvZHkoewogICAqICAgICAgIG1hc3M6IDEsCiAgICogICAgICAgc2hhcGUsCiAgICogICAgIH0pCiAgICogICAgIHdvcmxkLmFkZEJvZHkoYm9keSkKICAgKi8KICBjbGFzcyBCb2R5IGV4dGVuZHMgRXZlbnRUYXJnZXQgewogICAgLyoqCiAgICAgKiBEaXNwYXRjaGVkIGFmdGVyIHR3byBib2RpZXMgY29sbGlkZS4gVGhpcyBldmVudCBpcyBkaXNwYXRjaGVkIG9uIGVhY2gKICAgICAqIG9mIHRoZSB0d28gYm9kaWVzIGludm9sdmVkIGluIHRoZSBjb2xsaXNpb24uCiAgICAgKiBAZXZlbnQgY29sbGlkZQogICAgICogQHBhcmFtIGJvZHkgVGhlIGJvZHkgdGhhdCB3YXMgaW52b2x2ZWQgaW4gdGhlIGNvbGxpc2lvbi4KICAgICAqIEBwYXJhbSBjb250YWN0IFRoZSBkZXRhaWxzIG9mIHRoZSBjb2xsaXNpb24uCiAgICAgKi8KCiAgICAvKioKICAgICAqIEEgZHluYW1pYyBib2R5IGlzIGZ1bGx5IHNpbXVsYXRlZC4gQ2FuIGJlIG1vdmVkIG1hbnVhbGx5IGJ5IHRoZSB1c2VyLCBidXQgbm9ybWFsbHkgdGhleSBtb3ZlIGFjY29yZGluZyB0byBmb3JjZXMuIEEgZHluYW1pYyBib2R5IGNhbiBjb2xsaWRlIHdpdGggYWxsIGJvZHkgdHlwZXMuIEEgZHluYW1pYyBib2R5IGFsd2F5cyBoYXMgZmluaXRlLCBub24temVybyBtYXNzLgogICAgICovCgogICAgLyoqCiAgICAgKiBBIHN0YXRpYyBib2R5IGRvZXMgbm90IG1vdmUgZHVyaW5nIHNpbXVsYXRpb24gYW5kIGJlaGF2ZXMgYXMgaWYgaXQgaGFzIGluZmluaXRlIG1hc3MuIFN0YXRpYyBib2RpZXMgY2FuIGJlIG1vdmVkIG1hbnVhbGx5IGJ5IHNldHRpbmcgdGhlIHBvc2l0aW9uIG9mIHRoZSBib2R5LiBUaGUgdmVsb2NpdHkgb2YgYSBzdGF0aWMgYm9keSBpcyBhbHdheXMgemVyby4gU3RhdGljIGJvZGllcyBkbyBub3QgY29sbGlkZSB3aXRoIG90aGVyIHN0YXRpYyBvciBraW5lbWF0aWMgYm9kaWVzLgogICAgICovCgogICAgLyoqCiAgICAgKiBBIGtpbmVtYXRpYyBib2R5IG1vdmVzIHVuZGVyIHNpbXVsYXRpb24gYWNjb3JkaW5nIHRvIGl0cyB2ZWxvY2l0eS4gVGhleSBkbyBub3QgcmVzcG9uZCB0byBmb3JjZXMuIFRoZXkgY2FuIGJlIG1vdmVkIG1hbnVhbGx5LCBidXQgbm9ybWFsbHkgYSBraW5lbWF0aWMgYm9keSBpcyBtb3ZlZCBieSBzZXR0aW5nIGl0cyB2ZWxvY2l0eS4gQSBraW5lbWF0aWMgYm9keSBiZWhhdmVzIGFzIGlmIGl0IGhhcyBpbmZpbml0ZSBtYXNzLiBLaW5lbWF0aWMgYm9kaWVzIGRvIG5vdCBjb2xsaWRlIHdpdGggb3RoZXIgc3RhdGljIG9yIGtpbmVtYXRpYyBib2RpZXMuCiAgICAgKi8KCiAgICAvKioKICAgICAqIEFXQUtFCiAgICAgKi8KCiAgICAvKioKICAgICAqIFNMRUVQWQogICAgICovCgogICAgLyoqCiAgICAgKiBTTEVFUElORwogICAgICovCgogICAgLyoqCiAgICAgKiBEaXNwYXRjaGVkIGFmdGVyIGEgc2xlZXBpbmcgYm9keSBoYXMgd29rZW4gdXAuCiAgICAgKiBAZXZlbnQgd2FrZXVwCiAgICAgKi8KCiAgICAvKioKICAgICAqIERpc3BhdGNoZWQgYWZ0ZXIgYSBib2R5IGhhcyBnb25lIGluIHRvIHRoZSBzbGVlcHkgc3RhdGUuCiAgICAgKiBAZXZlbnQgc2xlZXB5CiAgICAgKi8KCiAgICAvKioKICAgICAqIERpc3BhdGNoZWQgYWZ0ZXIgYSBib2R5IGhhcyBmYWxsZW4gYXNsZWVwLgogICAgICogQGV2ZW50IHNsZWVwCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKG9wdGlvbnMpIHsKICAgICAgaWYgKG9wdGlvbnMgPT09IHZvaWQgMCkgewogICAgICAgIG9wdGlvbnMgPSB7fTsKICAgICAgfQoKICAgICAgc3VwZXIoKTsKICAgICAgdGhpcy5pZCA9IEJvZHkuaWRDb3VudGVyKys7CiAgICAgIHRoaXMuaW5kZXggPSAtMTsKICAgICAgdGhpcy53b3JsZCA9IG51bGw7CiAgICAgIHRoaXMudmxhbWJkYSA9IG5ldyBWZWMzKCk7CiAgICAgIHRoaXMuY29sbGlzaW9uRmlsdGVyR3JvdXAgPSB0eXBlb2Ygb3B0aW9ucy5jb2xsaXNpb25GaWx0ZXJHcm91cCA9PT0gJ251bWJlcicgPyBvcHRpb25zLmNvbGxpc2lvbkZpbHRlckdyb3VwIDogMTsKICAgICAgdGhpcy5jb2xsaXNpb25GaWx0ZXJNYXNrID0gdHlwZW9mIG9wdGlvbnMuY29sbGlzaW9uRmlsdGVyTWFzayA9PT0gJ251bWJlcicgPyBvcHRpb25zLmNvbGxpc2lvbkZpbHRlck1hc2sgOiAtMTsKICAgICAgdGhpcy5jb2xsaXNpb25SZXNwb25zZSA9IHR5cGVvZiBvcHRpb25zLmNvbGxpc2lvblJlc3BvbnNlID09PSAnYm9vbGVhbicgPyBvcHRpb25zLmNvbGxpc2lvblJlc3BvbnNlIDogdHJ1ZTsKICAgICAgdGhpcy5wb3NpdGlvbiA9IG5ldyBWZWMzKCk7CiAgICAgIHRoaXMucHJldmlvdXNQb3NpdGlvbiA9IG5ldyBWZWMzKCk7CiAgICAgIHRoaXMuaW50ZXJwb2xhdGVkUG9zaXRpb24gPSBuZXcgVmVjMygpOwogICAgICB0aGlzLmluaXRQb3NpdGlvbiA9IG5ldyBWZWMzKCk7CgogICAgICBpZiAob3B0aW9ucy5wb3NpdGlvbikgewogICAgICAgIHRoaXMucG9zaXRpb24uY29weShvcHRpb25zLnBvc2l0aW9uKTsKICAgICAgICB0aGlzLnByZXZpb3VzUG9zaXRpb24uY29weShvcHRpb25zLnBvc2l0aW9uKTsKICAgICAgICB0aGlzLmludGVycG9sYXRlZFBvc2l0aW9uLmNvcHkob3B0aW9ucy5wb3NpdGlvbik7CiAgICAgICAgdGhpcy5pbml0UG9zaXRpb24uY29weShvcHRpb25zLnBvc2l0aW9uKTsKICAgICAgfQoKICAgICAgdGhpcy52ZWxvY2l0eSA9IG5ldyBWZWMzKCk7CgogICAgICBpZiAob3B0aW9ucy52ZWxvY2l0eSkgewogICAgICAgIHRoaXMudmVsb2NpdHkuY29weShvcHRpb25zLnZlbG9jaXR5KTsKICAgICAgfQoKICAgICAgdGhpcy5pbml0VmVsb2NpdHkgPSBuZXcgVmVjMygpOwogICAgICB0aGlzLmZvcmNlID0gbmV3IFZlYzMoKTsKICAgICAgY29uc3QgbWFzcyA9IHR5cGVvZiBvcHRpb25zLm1hc3MgPT09ICdudW1iZXInID8gb3B0aW9ucy5tYXNzIDogMDsKICAgICAgdGhpcy5tYXNzID0gbWFzczsKICAgICAgdGhpcy5pbnZNYXNzID0gbWFzcyA+IDAgPyAxLjAgLyBtYXNzIDogMDsKICAgICAgdGhpcy5tYXRlcmlhbCA9IG9wdGlvbnMubWF0ZXJpYWwgfHwgbnVsbDsKICAgICAgdGhpcy5saW5lYXJEYW1waW5nID0gdHlwZW9mIG9wdGlvbnMubGluZWFyRGFtcGluZyA9PT0gJ251bWJlcicgPyBvcHRpb25zLmxpbmVhckRhbXBpbmcgOiAwLjAxOwogICAgICB0aGlzLnR5cGUgPSBtYXNzIDw9IDAuMCA/IEJvZHkuU1RBVElDIDogQm9keS5EWU5BTUlDOwoKICAgICAgaWYgKHR5cGVvZiBvcHRpb25zLnR5cGUgPT09IHR5cGVvZiBCb2R5LlNUQVRJQykgewogICAgICAgIHRoaXMudHlwZSA9IG9wdGlvbnMudHlwZTsKICAgICAgfQoKICAgICAgdGhpcy5hbGxvd1NsZWVwID0gdHlwZW9mIG9wdGlvbnMuYWxsb3dTbGVlcCAhPT0gJ3VuZGVmaW5lZCcgPyBvcHRpb25zLmFsbG93U2xlZXAgOiB0cnVlOwogICAgICB0aGlzLnNsZWVwU3RhdGUgPSBCb2R5LkFXQUtFOwogICAgICB0aGlzLnNsZWVwU3BlZWRMaW1pdCA9IHR5cGVvZiBvcHRpb25zLnNsZWVwU3BlZWRMaW1pdCAhPT0gJ3VuZGVmaW5lZCcgPyBvcHRpb25zLnNsZWVwU3BlZWRMaW1pdCA6IDAuMTsKICAgICAgdGhpcy5zbGVlcFRpbWVMaW1pdCA9IHR5cGVvZiBvcHRpb25zLnNsZWVwVGltZUxpbWl0ICE9PSAndW5kZWZpbmVkJyA/IG9wdGlvbnMuc2xlZXBUaW1lTGltaXQgOiAxOwogICAgICB0aGlzLnRpbWVMYXN0U2xlZXB5ID0gMDsKICAgICAgdGhpcy53YWtlVXBBZnRlck5hcnJvd3BoYXNlID0gZmFsc2U7CiAgICAgIHRoaXMudG9ycXVlID0gbmV3IFZlYzMoKTsKICAgICAgdGhpcy5xdWF0ZXJuaW9uID0gbmV3IFF1YXRlcm5pb24oKTsKICAgICAgdGhpcy5pbml0UXVhdGVybmlvbiA9IG5ldyBRdWF0ZXJuaW9uKCk7CiAgICAgIHRoaXMucHJldmlvdXNRdWF0ZXJuaW9uID0gbmV3IFF1YXRlcm5pb24oKTsKICAgICAgdGhpcy5pbnRlcnBvbGF0ZWRRdWF0ZXJuaW9uID0gbmV3IFF1YXRlcm5pb24oKTsKCiAgICAgIGlmIChvcHRpb25zLnF1YXRlcm5pb24pIHsKICAgICAgICB0aGlzLnF1YXRlcm5pb24uY29weShvcHRpb25zLnF1YXRlcm5pb24pOwogICAgICAgIHRoaXMuaW5pdFF1YXRlcm5pb24uY29weShvcHRpb25zLnF1YXRlcm5pb24pOwogICAgICAgIHRoaXMucHJldmlvdXNRdWF0ZXJuaW9uLmNvcHkob3B0aW9ucy5xdWF0ZXJuaW9uKTsKICAgICAgICB0aGlzLmludGVycG9sYXRlZFF1YXRlcm5pb24uY29weShvcHRpb25zLnF1YXRlcm5pb24pOwogICAgICB9CgogICAgICB0aGlzLmFuZ3VsYXJWZWxvY2l0eSA9IG5ldyBWZWMzKCk7CgogICAgICBpZiAob3B0aW9ucy5hbmd1bGFyVmVsb2NpdHkpIHsKICAgICAgICB0aGlzLmFuZ3VsYXJWZWxvY2l0eS5jb3B5KG9wdGlvbnMuYW5ndWxhclZlbG9jaXR5KTsKICAgICAgfQoKICAgICAgdGhpcy5pbml0QW5ndWxhclZlbG9jaXR5ID0gbmV3IFZlYzMoKTsKICAgICAgdGhpcy5zaGFwZXMgPSBbXTsKICAgICAgdGhpcy5zaGFwZU9mZnNldHMgPSBbXTsKICAgICAgdGhpcy5zaGFwZU9yaWVudGF0aW9ucyA9IFtdOwogICAgICB0aGlzLmluZXJ0aWEgPSBuZXcgVmVjMygpOwogICAgICB0aGlzLmludkluZXJ0aWEgPSBuZXcgVmVjMygpOwogICAgICB0aGlzLmludkluZXJ0aWFXb3JsZCA9IG5ldyBNYXQzKCk7CiAgICAgIHRoaXMuaW52TWFzc1NvbHZlID0gMDsKICAgICAgdGhpcy5pbnZJbmVydGlhU29sdmUgPSBuZXcgVmVjMygpOwogICAgICB0aGlzLmludkluZXJ0aWFXb3JsZFNvbHZlID0gbmV3IE1hdDMoKTsKICAgICAgdGhpcy5maXhlZFJvdGF0aW9uID0gdHlwZW9mIG9wdGlvbnMuZml4ZWRSb3RhdGlvbiAhPT0gJ3VuZGVmaW5lZCcgPyBvcHRpb25zLmZpeGVkUm90YXRpb24gOiBmYWxzZTsKICAgICAgdGhpcy5hbmd1bGFyRGFtcGluZyA9IHR5cGVvZiBvcHRpb25zLmFuZ3VsYXJEYW1waW5nICE9PSAndW5kZWZpbmVkJyA/IG9wdGlvbnMuYW5ndWxhckRhbXBpbmcgOiAwLjAxOwogICAgICB0aGlzLmxpbmVhckZhY3RvciA9IG5ldyBWZWMzKDEsIDEsIDEpOwoKICAgICAgaWYgKG9wdGlvbnMubGluZWFyRmFjdG9yKSB7CiAgICAgICAgdGhpcy5saW5lYXJGYWN0b3IuY29weShvcHRpb25zLmxpbmVhckZhY3Rvcik7CiAgICAgIH0KCiAgICAgIHRoaXMuYW5ndWxhckZhY3RvciA9IG5ldyBWZWMzKDEsIDEsIDEpOwoKICAgICAgaWYgKG9wdGlvbnMuYW5ndWxhckZhY3RvcikgewogICAgICAgIHRoaXMuYW5ndWxhckZhY3Rvci5jb3B5KG9wdGlvbnMuYW5ndWxhckZhY3Rvcik7CiAgICAgIH0KCiAgICAgIHRoaXMuYWFiYiA9IG5ldyBBQUJCKCk7CiAgICAgIHRoaXMuYWFiYk5lZWRzVXBkYXRlID0gdHJ1ZTsKICAgICAgdGhpcy5ib3VuZGluZ1JhZGl1cyA9IDA7CiAgICAgIHRoaXMud2xhbWJkYSA9IG5ldyBWZWMzKCk7CiAgICAgIHRoaXMuaXNUcmlnZ2VyID0gQm9vbGVhbihvcHRpb25zLmlzVHJpZ2dlcik7CgogICAgICBpZiAob3B0aW9ucy5zaGFwZSkgewogICAgICAgIHRoaXMuYWRkU2hhcGUob3B0aW9ucy5zaGFwZSk7CiAgICAgIH0KCiAgICAgIHRoaXMudXBkYXRlTWFzc1Byb3BlcnRpZXMoKTsKICAgIH0KICAgIC8qKgogICAgICogV2FrZSB0aGUgYm9keSB1cC4KICAgICAqLwoKCiAgICB3YWtlVXAoKSB7CiAgICAgIGNvbnN0IHByZXZTdGF0ZSA9IHRoaXMuc2xlZXBTdGF0ZTsKICAgICAgdGhpcy5zbGVlcFN0YXRlID0gQm9keS5BV0FLRTsKICAgICAgdGhpcy53YWtlVXBBZnRlck5hcnJvd3BoYXNlID0gZmFsc2U7CgogICAgICBpZiAocHJldlN0YXRlID09PSBCb2R5LlNMRUVQSU5HKSB7CiAgICAgICAgdGhpcy5kaXNwYXRjaEV2ZW50KEJvZHkud2FrZXVwRXZlbnQpOwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIEZvcmNlIGJvZHkgc2xlZXAKICAgICAqLwoKCiAgICBzbGVlcCgpIHsKICAgICAgdGhpcy5zbGVlcFN0YXRlID0gQm9keS5TTEVFUElORzsKICAgICAgdGhpcy52ZWxvY2l0eS5zZXQoMCwgMCwgMCk7CiAgICAgIHRoaXMuYW5ndWxhclZlbG9jaXR5LnNldCgwLCAwLCAwKTsKICAgICAgdGhpcy53YWtlVXBBZnRlck5hcnJvd3BoYXNlID0gZmFsc2U7CiAgICB9CiAgICAvKioKICAgICAqIENhbGxlZCBldmVyeSB0aW1lc3RlcCB0byB1cGRhdGUgaW50ZXJuYWwgc2xlZXAgdGltZXIgYW5kIGNoYW5nZSBzbGVlcCBzdGF0ZSBpZiBuZWVkZWQuCiAgICAgKiBAcGFyYW0gdGltZSBUaGUgd29ybGQgdGltZSBpbiBzZWNvbmRzCiAgICAgKi8KCgogICAgc2xlZXBUaWNrKHRpbWUpIHsKICAgICAgaWYgKHRoaXMuYWxsb3dTbGVlcCkgewogICAgICAgIGNvbnN0IHNsZWVwU3RhdGUgPSB0aGlzLnNsZWVwU3RhdGU7CiAgICAgICAgY29uc3Qgc3BlZWRTcXVhcmVkID0gdGhpcy52ZWxvY2l0eS5sZW5ndGhTcXVhcmVkKCkgKyB0aGlzLmFuZ3VsYXJWZWxvY2l0eS5sZW5ndGhTcXVhcmVkKCk7CiAgICAgICAgY29uc3Qgc3BlZWRMaW1pdFNxdWFyZWQgPSB0aGlzLnNsZWVwU3BlZWRMaW1pdCAqKiAyOwoKICAgICAgICBpZiAoc2xlZXBTdGF0ZSA9PT0gQm9keS5BV0FLRSAmJiBzcGVlZFNxdWFyZWQgPCBzcGVlZExpbWl0U3F1YXJlZCkgewogICAgICAgICAgdGhpcy5zbGVlcFN0YXRlID0gQm9keS5TTEVFUFk7IC8vIFNsZWVweQoKICAgICAgICAgIHRoaXMudGltZUxhc3RTbGVlcHkgPSB0aW1lOwogICAgICAgICAgdGhpcy5kaXNwYXRjaEV2ZW50KEJvZHkuc2xlZXB5RXZlbnQpOwogICAgICAgIH0gZWxzZSBpZiAoc2xlZXBTdGF0ZSA9PT0gQm9keS5TTEVFUFkgJiYgc3BlZWRTcXVhcmVkID4gc3BlZWRMaW1pdFNxdWFyZWQpIHsKICAgICAgICAgIHRoaXMud2FrZVVwKCk7IC8vIFdha2UgdXAKICAgICAgICB9IGVsc2UgaWYgKHNsZWVwU3RhdGUgPT09IEJvZHkuU0xFRVBZICYmIHRpbWUgLSB0aGlzLnRpbWVMYXN0U2xlZXB5ID4gdGhpcy5zbGVlcFRpbWVMaW1pdCkgewogICAgICAgICAgdGhpcy5zbGVlcCgpOyAvLyBTbGVlcGluZwoKICAgICAgICAgIHRoaXMuZGlzcGF0Y2hFdmVudChCb2R5LnNsZWVwRXZlbnQpOwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBJZiB0aGUgYm9keSBpcyBzbGVlcGluZywgaXQgc2hvdWxkIGJlIGltbW92YWJsZSAvIGhhdmUgaW5maW5pdGUgbWFzcyBkdXJpbmcgc29sdmUuIFdlIHNvbHZlIGl0IGJ5IGhhdmluZyBhIHNlcGFyYXRlICJzb2x2ZSBtYXNzIi4KICAgICAqLwoKCiAgICB1cGRhdGVTb2x2ZU1hc3NQcm9wZXJ0aWVzKCkgewogICAgICBpZiAodGhpcy5zbGVlcFN0YXRlID09PSBCb2R5LlNMRUVQSU5HIHx8IHRoaXMudHlwZSA9PT0gQm9keS5LSU5FTUFUSUMpIHsKICAgICAgICB0aGlzLmludk1hc3NTb2x2ZSA9IDA7CiAgICAgICAgdGhpcy5pbnZJbmVydGlhU29sdmUuc2V0WmVybygpOwogICAgICAgIHRoaXMuaW52SW5lcnRpYVdvcmxkU29sdmUuc2V0WmVybygpOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuaW52TWFzc1NvbHZlID0gdGhpcy5pbnZNYXNzOwogICAgICAgIHRoaXMuaW52SW5lcnRpYVNvbHZlLmNvcHkodGhpcy5pbnZJbmVydGlhKTsKICAgICAgICB0aGlzLmludkluZXJ0aWFXb3JsZFNvbHZlLmNvcHkodGhpcy5pbnZJbmVydGlhV29ybGQpOwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIENvbnZlcnQgYSB3b3JsZCBwb2ludCB0byBsb2NhbCBib2R5IGZyYW1lLgogICAgICovCgoKICAgIHBvaW50VG9Mb2NhbEZyYW1lKHdvcmxkUG9pbnQsIHJlc3VsdCkgewogICAgICBpZiAocmVzdWx0ID09PSB2b2lkIDApIHsKICAgICAgICByZXN1bHQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICB3b3JsZFBvaW50LnZzdWIodGhpcy5wb3NpdGlvbiwgcmVzdWx0KTsKICAgICAgdGhpcy5xdWF0ZXJuaW9uLmNvbmp1Z2F0ZSgpLnZtdWx0KHJlc3VsdCwgcmVzdWx0KTsKICAgICAgcmV0dXJuIHJlc3VsdDsKICAgIH0KICAgIC8qKgogICAgICogQ29udmVydCBhIHdvcmxkIHZlY3RvciB0byBsb2NhbCBib2R5IGZyYW1lLgogICAgICovCgoKICAgIHZlY3RvclRvTG9jYWxGcmFtZSh3b3JsZFZlY3RvciwgcmVzdWx0KSB7CiAgICAgIGlmIChyZXN1bHQgPT09IHZvaWQgMCkgewogICAgICAgIHJlc3VsdCA9IG5ldyBWZWMzKCk7CiAgICAgIH0KCiAgICAgIHRoaXMucXVhdGVybmlvbi5jb25qdWdhdGUoKS52bXVsdCh3b3JsZFZlY3RvciwgcmVzdWx0KTsKICAgICAgcmV0dXJuIHJlc3VsdDsKICAgIH0KICAgIC8qKgogICAgICogQ29udmVydCBhIGxvY2FsIGJvZHkgcG9pbnQgdG8gd29ybGQgZnJhbWUuCiAgICAgKi8KCgogICAgcG9pbnRUb1dvcmxkRnJhbWUobG9jYWxQb2ludCwgcmVzdWx0KSB7CiAgICAgIGlmIChyZXN1bHQgPT09IHZvaWQgMCkgewogICAgICAgIHJlc3VsdCA9IG5ldyBWZWMzKCk7CiAgICAgIH0KCiAgICAgIHRoaXMucXVhdGVybmlvbi52bXVsdChsb2NhbFBvaW50LCByZXN1bHQpOwogICAgICByZXN1bHQudmFkZCh0aGlzLnBvc2l0aW9uLCByZXN1bHQpOwogICAgICByZXR1cm4gcmVzdWx0OwogICAgfQogICAgLyoqCiAgICAgKiBDb252ZXJ0IGEgbG9jYWwgYm9keSBwb2ludCB0byB3b3JsZCBmcmFtZS4KICAgICAqLwoKCiAgICB2ZWN0b3JUb1dvcmxkRnJhbWUobG9jYWxWZWN0b3IsIHJlc3VsdCkgewogICAgICBpZiAocmVzdWx0ID09PSB2b2lkIDApIHsKICAgICAgICByZXN1bHQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICB0aGlzLnF1YXRlcm5pb24udm11bHQobG9jYWxWZWN0b3IsIHJlc3VsdCk7CiAgICAgIHJldHVybiByZXN1bHQ7CiAgICB9CiAgICAvKioKICAgICAqIEFkZCBhIHNoYXBlIHRvIHRoZSBib2R5IHdpdGggYSBsb2NhbCBvZmZzZXQgYW5kIG9yaWVudGF0aW9uLgogICAgICogQHJldHVybiBUaGUgYm9keSBvYmplY3QsIGZvciBjaGFpbmFiaWxpdHkuCiAgICAgKi8KCgogICAgYWRkU2hhcGUoc2hhcGUsIF9vZmZzZXQsIF9vcmllbnRhdGlvbikgewogICAgICBjb25zdCBvZmZzZXQgPSBuZXcgVmVjMygpOwogICAgICBjb25zdCBvcmllbnRhdGlvbiA9IG5ldyBRdWF0ZXJuaW9uKCk7CgogICAgICBpZiAoX29mZnNldCkgewogICAgICAgIG9mZnNldC5jb3B5KF9vZmZzZXQpOwogICAgICB9CgogICAgICBpZiAoX29yaWVudGF0aW9uKSB7CiAgICAgICAgb3JpZW50YXRpb24uY29weShfb3JpZW50YXRpb24pOwogICAgICB9CgogICAgICB0aGlzLnNoYXBlcy5wdXNoKHNoYXBlKTsKICAgICAgdGhpcy5zaGFwZU9mZnNldHMucHVzaChvZmZzZXQpOwogICAgICB0aGlzLnNoYXBlT3JpZW50YXRpb25zLnB1c2gob3JpZW50YXRpb24pOwogICAgICB0aGlzLnVwZGF0ZU1hc3NQcm9wZXJ0aWVzKCk7CiAgICAgIHRoaXMudXBkYXRlQm91bmRpbmdSYWRpdXMoKTsKICAgICAgdGhpcy5hYWJiTmVlZHNVcGRhdGUgPSB0cnVlOwogICAgICBzaGFwZS5ib2R5ID0gdGhpczsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICAvKioKICAgICAqIFJlbW92ZSBhIHNoYXBlIGZyb20gdGhlIGJvZHkuCiAgICAgKiBAcmV0dXJuIFRoZSBib2R5IG9iamVjdCwgZm9yIGNoYWluYWJpbGl0eS4KICAgICAqLwoKCiAgICByZW1vdmVTaGFwZShzaGFwZSkgewogICAgICBjb25zdCBpbmRleCA9IHRoaXMuc2hhcGVzLmluZGV4T2Yoc2hhcGUpOwoKICAgICAgaWYgKGluZGV4ID09PSAtMSkgewogICAgICAgIGNvbnNvbGUud2FybignU2hhcGUgZG9lcyBub3QgYmVsb25nIHRvIHRoZSBib2R5Jyk7CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgIH0KCiAgICAgIHRoaXMuc2hhcGVzLnNwbGljZShpbmRleCwgMSk7CiAgICAgIHRoaXMuc2hhcGVPZmZzZXRzLnNwbGljZShpbmRleCwgMSk7CiAgICAgIHRoaXMuc2hhcGVPcmllbnRhdGlvbnMuc3BsaWNlKGluZGV4LCAxKTsKICAgICAgdGhpcy51cGRhdGVNYXNzUHJvcGVydGllcygpOwogICAgICB0aGlzLnVwZGF0ZUJvdW5kaW5nUmFkaXVzKCk7CiAgICAgIHRoaXMuYWFiYk5lZWRzVXBkYXRlID0gdHJ1ZTsKICAgICAgc2hhcGUuYm9keSA9IG51bGw7CiAgICAgIHJldHVybiB0aGlzOwogICAgfQogICAgLyoqCiAgICAgKiBVcGRhdGUgdGhlIGJvdW5kaW5nIHJhZGl1cyBvZiB0aGUgYm9keS4gU2hvdWxkIGJlIGRvbmUgaWYgYW55IG9mIHRoZSBzaGFwZXMgYXJlIGNoYW5nZWQuCiAgICAgKi8KCgogICAgdXBkYXRlQm91bmRpbmdSYWRpdXMoKSB7CiAgICAgIGNvbnN0IHNoYXBlcyA9IHRoaXMuc2hhcGVzOwogICAgICBjb25zdCBzaGFwZU9mZnNldHMgPSB0aGlzLnNoYXBlT2Zmc2V0czsKICAgICAgY29uc3QgTiA9IHNoYXBlcy5sZW5ndGg7CiAgICAgIGxldCByYWRpdXMgPSAwOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IE47IGkrKykgewogICAgICAgIGNvbnN0IHNoYXBlID0gc2hhcGVzW2ldOwogICAgICAgIHNoYXBlLnVwZGF0ZUJvdW5kaW5nU3BoZXJlUmFkaXVzKCk7CiAgICAgICAgY29uc3Qgb2Zmc2V0ID0gc2hhcGVPZmZzZXRzW2ldLmxlbmd0aCgpOwogICAgICAgIGNvbnN0IHIgPSBzaGFwZS5ib3VuZGluZ1NwaGVyZVJhZGl1czsKCiAgICAgICAgaWYgKG9mZnNldCArIHIgPiByYWRpdXMpIHsKICAgICAgICAgIHJhZGl1cyA9IG9mZnNldCArIHI7CiAgICAgICAgfQogICAgICB9CgogICAgICB0aGlzLmJvdW5kaW5nUmFkaXVzID0gcmFkaXVzOwogICAgfQogICAgLyoqCiAgICAgKiBVcGRhdGVzIHRoZSAuYWFiYgogICAgICovCgoKICAgIHVwZGF0ZUFBQkIoKSB7CiAgICAgIGNvbnN0IHNoYXBlcyA9IHRoaXMuc2hhcGVzOwogICAgICBjb25zdCBzaGFwZU9mZnNldHMgPSB0aGlzLnNoYXBlT2Zmc2V0czsKICAgICAgY29uc3Qgc2hhcGVPcmllbnRhdGlvbnMgPSB0aGlzLnNoYXBlT3JpZW50YXRpb25zOwogICAgICBjb25zdCBOID0gc2hhcGVzLmxlbmd0aDsKICAgICAgY29uc3Qgb2Zmc2V0ID0gdG1wVmVjOwogICAgICBjb25zdCBvcmllbnRhdGlvbiA9IHRtcFF1YXQ7CiAgICAgIGNvbnN0IGJvZHlRdWF0ID0gdGhpcy5xdWF0ZXJuaW9uOwogICAgICBjb25zdCBhYWJiID0gdGhpcy5hYWJiOwogICAgICBjb25zdCBzaGFwZUFBQkIgPSB1cGRhdGVBQUJCX3NoYXBlQUFCQjsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpICE9PSBOOyBpKyspIHsKICAgICAgICBjb25zdCBzaGFwZSA9IHNoYXBlc1tpXTsgLy8gR2V0IHNoYXBlIHdvcmxkIHBvc2l0aW9uCgogICAgICAgIGJvZHlRdWF0LnZtdWx0KHNoYXBlT2Zmc2V0c1tpXSwgb2Zmc2V0KTsKICAgICAgICBvZmZzZXQudmFkZCh0aGlzLnBvc2l0aW9uLCBvZmZzZXQpOyAvLyBHZXQgc2hhcGUgd29ybGQgcXVhdGVybmlvbgoKICAgICAgICBib2R5UXVhdC5tdWx0KHNoYXBlT3JpZW50YXRpb25zW2ldLCBvcmllbnRhdGlvbik7IC8vIEdldCBzaGFwZSBBQUJCCgogICAgICAgIHNoYXBlLmNhbGN1bGF0ZVdvcmxkQUFCQihvZmZzZXQsIG9yaWVudGF0aW9uLCBzaGFwZUFBQkIubG93ZXJCb3VuZCwgc2hhcGVBQUJCLnVwcGVyQm91bmQpOwoKICAgICAgICBpZiAoaSA9PT0gMCkgewogICAgICAgICAgYWFiYi5jb3B5KHNoYXBlQUFCQik7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGFhYmIuZXh0ZW5kKHNoYXBlQUFCQik7CiAgICAgICAgfQogICAgICB9CgogICAgICB0aGlzLmFhYmJOZWVkc1VwZGF0ZSA9IGZhbHNlOwogICAgfQogICAgLyoqCiAgICAgKiBVcGRhdGUgYC5pbmVydGlhV29ybGRgIGFuZCBgLmludkluZXJ0aWFXb3JsZGAKICAgICAqLwoKCiAgICB1cGRhdGVJbmVydGlhV29ybGQoZm9yY2UpIHsKICAgICAgY29uc3QgSSA9IHRoaXMuaW52SW5lcnRpYTsKCiAgICAgIGlmIChJLnggPT09IEkueSAmJiBJLnkgPT09IEkueiAmJiAhZm9yY2UpIDsgZWxzZSB7CiAgICAgICAgY29uc3QgbTEgPSB1aXdfbTE7CiAgICAgICAgY29uc3QgbTIgPSB1aXdfbTI7CiAgICAgICAgbTEuc2V0Um90YXRpb25Gcm9tUXVhdGVybmlvbih0aGlzLnF1YXRlcm5pb24pOwogICAgICAgIG0xLnRyYW5zcG9zZShtMik7CiAgICAgICAgbTEuc2NhbGUoSSwgbTEpOwogICAgICAgIG0xLm1tdWx0KG0yLCB0aGlzLmludkluZXJ0aWFXb3JsZCk7CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogQXBwbHkgZm9yY2UgdG8gYSBwb2ludCBvZiB0aGUgYm9keS4gVGhpcyBjb3VsZCBmb3IgZXhhbXBsZSBiZSBhIHBvaW50IG9uIHRoZSBCb2R5IHN1cmZhY2UuCiAgICAgKiBBcHBseWluZyBmb3JjZSB0aGlzIHdheSB3aWxsIGFkZCB0byBCb2R5LmZvcmNlIGFuZCBCb2R5LnRvcnF1ZS4KICAgICAqIEBwYXJhbSBmb3JjZSBUaGUgYW1vdW50IG9mIGZvcmNlIHRvIGFkZC4KICAgICAqIEBwYXJhbSByZWxhdGl2ZVBvaW50IEEgcG9pbnQgcmVsYXRpdmUgdG8gdGhlIGNlbnRlciBvZiBtYXNzIHRvIGFwcGx5IHRoZSBmb3JjZSBvbi4KICAgICAqLwoKCiAgICBhcHBseUZvcmNlKGZvcmNlLCByZWxhdGl2ZVBvaW50KSB7CiAgICAgIGlmIChyZWxhdGl2ZVBvaW50ID09PSB2b2lkIDApIHsKICAgICAgICByZWxhdGl2ZVBvaW50ID0gbmV3IFZlYzMoKTsKICAgICAgfQoKICAgICAgLy8gTmVlZGVkPwogICAgICBpZiAodGhpcy50eXBlICE9PSBCb2R5LkRZTkFNSUMpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGlmICh0aGlzLnNsZWVwU3RhdGUgPT09IEJvZHkuU0xFRVBJTkcpIHsKICAgICAgICB0aGlzLndha2VVcCgpOwogICAgICB9IC8vIENvbXB1dGUgcHJvZHVjZWQgcm90YXRpb25hbCBmb3JjZQoKCiAgICAgIGNvbnN0IHJvdEZvcmNlID0gQm9keV9hcHBseUZvcmNlX3JvdEZvcmNlOwogICAgICByZWxhdGl2ZVBvaW50LmNyb3NzKGZvcmNlLCByb3RGb3JjZSk7IC8vIEFkZCBsaW5lYXIgZm9yY2UKCiAgICAgIHRoaXMuZm9yY2UudmFkZChmb3JjZSwgdGhpcy5mb3JjZSk7IC8vIEFkZCByb3RhdGlvbmFsIGZvcmNlCgogICAgICB0aGlzLnRvcnF1ZS52YWRkKHJvdEZvcmNlLCB0aGlzLnRvcnF1ZSk7CiAgICB9CiAgICAvKioKICAgICAqIEFwcGx5IGZvcmNlIHRvIGEgbG9jYWwgcG9pbnQgaW4gdGhlIGJvZHkuCiAgICAgKiBAcGFyYW0gZm9yY2UgVGhlIGZvcmNlIHZlY3RvciB0byBhcHBseSwgZGVmaW5lZCBsb2NhbGx5IGluIHRoZSBib2R5IGZyYW1lLgogICAgICogQHBhcmFtIGxvY2FsUG9pbnQgQSBsb2NhbCBwb2ludCBpbiB0aGUgYm9keSB0byBhcHBseSB0aGUgZm9yY2Ugb24uCiAgICAgKi8KCgogICAgYXBwbHlMb2NhbEZvcmNlKGxvY2FsRm9yY2UsIGxvY2FsUG9pbnQpIHsKICAgICAgaWYgKGxvY2FsUG9pbnQgPT09IHZvaWQgMCkgewogICAgICAgIGxvY2FsUG9pbnQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICBpZiAodGhpcy50eXBlICE9PSBCb2R5LkRZTkFNSUMpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGNvbnN0IHdvcmxkRm9yY2UgPSBCb2R5X2FwcGx5TG9jYWxGb3JjZV93b3JsZEZvcmNlOwogICAgICBjb25zdCByZWxhdGl2ZVBvaW50V29ybGQgPSBCb2R5X2FwcGx5TG9jYWxGb3JjZV9yZWxhdGl2ZVBvaW50V29ybGQ7IC8vIFRyYW5zZm9ybSB0aGUgZm9yY2UgdmVjdG9yIHRvIHdvcmxkIHNwYWNlCgogICAgICB0aGlzLnZlY3RvclRvV29ybGRGcmFtZShsb2NhbEZvcmNlLCB3b3JsZEZvcmNlKTsKICAgICAgdGhpcy52ZWN0b3JUb1dvcmxkRnJhbWUobG9jYWxQb2ludCwgcmVsYXRpdmVQb2ludFdvcmxkKTsKICAgICAgdGhpcy5hcHBseUZvcmNlKHdvcmxkRm9yY2UsIHJlbGF0aXZlUG9pbnRXb3JsZCk7CiAgICB9CiAgICAvKioKICAgICAqIEFwcGx5IHRvcnF1ZSB0byB0aGUgYm9keS4KICAgICAqIEBwYXJhbSB0b3JxdWUgVGhlIGFtb3VudCBvZiB0b3JxdWUgdG8gYWRkLgogICAgICovCgoKICAgIGFwcGx5VG9ycXVlKHRvcnF1ZSkgewogICAgICBpZiAodGhpcy50eXBlICE9PSBCb2R5LkRZTkFNSUMpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGlmICh0aGlzLnNsZWVwU3RhdGUgPT09IEJvZHkuU0xFRVBJTkcpIHsKICAgICAgICB0aGlzLndha2VVcCgpOwogICAgICB9IC8vIEFkZCByb3RhdGlvbmFsIGZvcmNlCgoKICAgICAgdGhpcy50b3JxdWUudmFkZCh0b3JxdWUsIHRoaXMudG9ycXVlKTsKICAgIH0KICAgIC8qKgogICAgICogQXBwbHkgaW1wdWxzZSB0byBhIHBvaW50IG9mIHRoZSBib2R5LiBUaGlzIGNvdWxkIGZvciBleGFtcGxlIGJlIGEgcG9pbnQgb24gdGhlIEJvZHkgc3VyZmFjZS4KICAgICAqIEFuIGltcHVsc2UgaXMgYSBmb3JjZSBhZGRlZCB0byBhIGJvZHkgZHVyaW5nIGEgc2hvcnQgcGVyaW9kIG9mIHRpbWUgKGltcHVsc2UgPSBmb3JjZSAqIHRpbWUpLgogICAgICogSW1wdWxzZXMgd2lsbCBiZSBhZGRlZCB0byBCb2R5LnZlbG9jaXR5IGFuZCBCb2R5LmFuZ3VsYXJWZWxvY2l0eS4KICAgICAqIEBwYXJhbSBpbXB1bHNlIFRoZSBhbW91bnQgb2YgaW1wdWxzZSB0byBhZGQuCiAgICAgKiBAcGFyYW0gcmVsYXRpdmVQb2ludCBBIHBvaW50IHJlbGF0aXZlIHRvIHRoZSBjZW50ZXIgb2YgbWFzcyB0byBhcHBseSB0aGUgZm9yY2Ugb24uCiAgICAgKi8KCgogICAgYXBwbHlJbXB1bHNlKGltcHVsc2UsIHJlbGF0aXZlUG9pbnQpIHsKICAgICAgaWYgKHJlbGF0aXZlUG9pbnQgPT09IHZvaWQgMCkgewogICAgICAgIHJlbGF0aXZlUG9pbnQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICBpZiAodGhpcy50eXBlICE9PSBCb2R5LkRZTkFNSUMpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGlmICh0aGlzLnNsZWVwU3RhdGUgPT09IEJvZHkuU0xFRVBJTkcpIHsKICAgICAgICB0aGlzLndha2VVcCgpOwogICAgICB9IC8vIENvbXB1dGUgcG9pbnQgcG9zaXRpb24gcmVsYXRpdmUgdG8gdGhlIGJvZHkgY2VudGVyCgoKICAgICAgY29uc3QgciA9IHJlbGF0aXZlUG9pbnQ7IC8vIENvbXB1dGUgcHJvZHVjZWQgY2VudHJhbCBpbXB1bHNlIHZlbG9jaXR5CgogICAgICBjb25zdCB2ZWxvID0gQm9keV9hcHBseUltcHVsc2VfdmVsbzsKICAgICAgdmVsby5jb3B5KGltcHVsc2UpOwogICAgICB2ZWxvLnNjYWxlKHRoaXMuaW52TWFzcywgdmVsbyk7IC8vIEFkZCBsaW5lYXIgaW1wdWxzZQoKICAgICAgdGhpcy52ZWxvY2l0eS52YWRkKHZlbG8sIHRoaXMudmVsb2NpdHkpOyAvLyBDb21wdXRlIHByb2R1Y2VkIHJvdGF0aW9uYWwgaW1wdWxzZSB2ZWxvY2l0eQoKICAgICAgY29uc3Qgcm90VmVsbyA9IEJvZHlfYXBwbHlJbXB1bHNlX3JvdFZlbG87CiAgICAgIHIuY3Jvc3MoaW1wdWxzZSwgcm90VmVsbyk7CiAgICAgIC8qCiAgICAgICByb3RWZWxvLnggKj0gdGhpcy5pbnZJbmVydGlhLng7CiAgICAgICByb3RWZWxvLnkgKj0gdGhpcy5pbnZJbmVydGlhLnk7CiAgICAgICByb3RWZWxvLnogKj0gdGhpcy5pbnZJbmVydGlhLno7CiAgICAgICAqLwoKICAgICAgdGhpcy5pbnZJbmVydGlhV29ybGQudm11bHQocm90VmVsbywgcm90VmVsbyk7IC8vIEFkZCByb3RhdGlvbmFsIEltcHVsc2UKCiAgICAgIHRoaXMuYW5ndWxhclZlbG9jaXR5LnZhZGQocm90VmVsbywgdGhpcy5hbmd1bGFyVmVsb2NpdHkpOwogICAgfQogICAgLyoqCiAgICAgKiBBcHBseSBsb2NhbGx5LWRlZmluZWQgaW1wdWxzZSB0byBhIGxvY2FsIHBvaW50IGluIHRoZSBib2R5LgogICAgICogQHBhcmFtIGZvcmNlIFRoZSBmb3JjZSB2ZWN0b3IgdG8gYXBwbHksIGRlZmluZWQgbG9jYWxseSBpbiB0aGUgYm9keSBmcmFtZS4KICAgICAqIEBwYXJhbSBsb2NhbFBvaW50IEEgbG9jYWwgcG9pbnQgaW4gdGhlIGJvZHkgdG8gYXBwbHkgdGhlIGZvcmNlIG9uLgogICAgICovCgoKICAgIGFwcGx5TG9jYWxJbXB1bHNlKGxvY2FsSW1wdWxzZSwgbG9jYWxQb2ludCkgewogICAgICBpZiAobG9jYWxQb2ludCA9PT0gdm9pZCAwKSB7CiAgICAgICAgbG9jYWxQb2ludCA9IG5ldyBWZWMzKCk7CiAgICAgIH0KCiAgICAgIGlmICh0aGlzLnR5cGUgIT09IEJvZHkuRFlOQU1JQykgewogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgY29uc3Qgd29ybGRJbXB1bHNlID0gQm9keV9hcHBseUxvY2FsSW1wdWxzZV93b3JsZEltcHVsc2U7CiAgICAgIGNvbnN0IHJlbGF0aXZlUG9pbnRXb3JsZCA9IEJvZHlfYXBwbHlMb2NhbEltcHVsc2VfcmVsYXRpdmVQb2ludDsgLy8gVHJhbnNmb3JtIHRoZSBmb3JjZSB2ZWN0b3IgdG8gd29ybGQgc3BhY2UKCiAgICAgIHRoaXMudmVjdG9yVG9Xb3JsZEZyYW1lKGxvY2FsSW1wdWxzZSwgd29ybGRJbXB1bHNlKTsKICAgICAgdGhpcy52ZWN0b3JUb1dvcmxkRnJhbWUobG9jYWxQb2ludCwgcmVsYXRpdmVQb2ludFdvcmxkKTsKICAgICAgdGhpcy5hcHBseUltcHVsc2Uod29ybGRJbXB1bHNlLCByZWxhdGl2ZVBvaW50V29ybGQpOwogICAgfQogICAgLyoqCiAgICAgKiBTaG91bGQgYmUgY2FsbGVkIHdoZW5ldmVyIHlvdSBjaGFuZ2UgdGhlIGJvZHkgc2hhcGUgb3IgbWFzcy4KICAgICAqLwoKCiAgICB1cGRhdGVNYXNzUHJvcGVydGllcygpIHsKICAgICAgY29uc3QgaGFsZkV4dGVudHMgPSBCb2R5X3VwZGF0ZU1hc3NQcm9wZXJ0aWVzX2hhbGZFeHRlbnRzOwogICAgICB0aGlzLmludk1hc3MgPSB0aGlzLm1hc3MgPiAwID8gMS4wIC8gdGhpcy5tYXNzIDogMDsKICAgICAgY29uc3QgSSA9IHRoaXMuaW5lcnRpYTsKICAgICAgY29uc3QgZml4ZWQgPSB0aGlzLmZpeGVkUm90YXRpb247IC8vIEFwcHJveGltYXRlIHdpdGggQUFCQiBib3gKCiAgICAgIHRoaXMudXBkYXRlQUFCQigpOwogICAgICBoYWxmRXh0ZW50cy5zZXQoKHRoaXMuYWFiYi51cHBlckJvdW5kLnggLSB0aGlzLmFhYmIubG93ZXJCb3VuZC54KSAvIDIsICh0aGlzLmFhYmIudXBwZXJCb3VuZC55IC0gdGhpcy5hYWJiLmxvd2VyQm91bmQueSkgLyAyLCAodGhpcy5hYWJiLnVwcGVyQm91bmQueiAtIHRoaXMuYWFiYi5sb3dlckJvdW5kLnopIC8gMik7CiAgICAgIEJveC5jYWxjdWxhdGVJbmVydGlhKGhhbGZFeHRlbnRzLCB0aGlzLm1hc3MsIEkpOwogICAgICB0aGlzLmludkluZXJ0aWEuc2V0KEkueCA+IDAgJiYgIWZpeGVkID8gMS4wIC8gSS54IDogMCwgSS55ID4gMCAmJiAhZml4ZWQgPyAxLjAgLyBJLnkgOiAwLCBJLnogPiAwICYmICFmaXhlZCA/IDEuMCAvIEkueiA6IDApOwogICAgICB0aGlzLnVwZGF0ZUluZXJ0aWFXb3JsZCh0cnVlKTsKICAgIH0KICAgIC8qKgogICAgICogR2V0IHdvcmxkIHZlbG9jaXR5IG9mIGEgcG9pbnQgaW4gdGhlIGJvZHkuCiAgICAgKiBAcGFyYW0gd29ybGRQb2ludAogICAgICogQHBhcmFtIHJlc3VsdAogICAgICogQHJldHVybiBUaGUgcmVzdWx0IHZlY3Rvci4KICAgICAqLwoKCiAgICBnZXRWZWxvY2l0eUF0V29ybGRQb2ludCh3b3JsZFBvaW50LCByZXN1bHQpIHsKICAgICAgY29uc3QgciA9IG5ldyBWZWMzKCk7CiAgICAgIHdvcmxkUG9pbnQudnN1Yih0aGlzLnBvc2l0aW9uLCByKTsKICAgICAgdGhpcy5hbmd1bGFyVmVsb2NpdHkuY3Jvc3MociwgcmVzdWx0KTsKICAgICAgdGhpcy52ZWxvY2l0eS52YWRkKHJlc3VsdCwgcmVzdWx0KTsKICAgICAgcmV0dXJuIHJlc3VsdDsKICAgIH0KICAgIC8qKgogICAgICogTW92ZSB0aGUgYm9keSBmb3J3YXJkIGluIHRpbWUuCiAgICAgKiBAcGFyYW0gZHQgVGltZSBzdGVwCiAgICAgKiBAcGFyYW0gcXVhdE5vcm1hbGl6ZSBTZXQgdG8gdHJ1ZSB0byBub3JtYWxpemUgdGhlIGJvZHkgcXVhdGVybmlvbgogICAgICogQHBhcmFtIHF1YXROb3JtYWxpemVGYXN0IElmIHRoZSBxdWF0ZXJuaW9uIHNob3VsZCBiZSBub3JtYWxpemVkIHVzaW5nICJmYXN0IiBxdWF0ZXJuaW9uIG5vcm1hbGl6YXRpb24KICAgICAqLwoKCiAgICBpbnRlZ3JhdGUoZHQsIHF1YXROb3JtYWxpemUsIHF1YXROb3JtYWxpemVGYXN0KSB7CiAgICAgIC8vIFNhdmUgcHJldmlvdXMgcG9zaXRpb24KICAgICAgdGhpcy5wcmV2aW91c1Bvc2l0aW9uLmNvcHkodGhpcy5wb3NpdGlvbik7CiAgICAgIHRoaXMucHJldmlvdXNRdWF0ZXJuaW9uLmNvcHkodGhpcy5xdWF0ZXJuaW9uKTsKCiAgICAgIGlmICghKHRoaXMudHlwZSA9PT0gQm9keS5EWU5BTUlDIHx8IHRoaXMudHlwZSA9PT0gQm9keS5LSU5FTUFUSUMpIHx8IHRoaXMuc2xlZXBTdGF0ZSA9PT0gQm9keS5TTEVFUElORykgewogICAgICAgIC8vIE9ubHkgZm9yIGR5bmFtaWMKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGNvbnN0IHZlbG8gPSB0aGlzLnZlbG9jaXR5OwogICAgICBjb25zdCBhbmd1bGFyVmVsbyA9IHRoaXMuYW5ndWxhclZlbG9jaXR5OwogICAgICBjb25zdCBwb3MgPSB0aGlzLnBvc2l0aW9uOwogICAgICBjb25zdCBmb3JjZSA9IHRoaXMuZm9yY2U7CiAgICAgIGNvbnN0IHRvcnF1ZSA9IHRoaXMudG9ycXVlOwogICAgICBjb25zdCBxdWF0ID0gdGhpcy5xdWF0ZXJuaW9uOwogICAgICBjb25zdCBpbnZNYXNzID0gdGhpcy5pbnZNYXNzOwogICAgICBjb25zdCBpbnZJbmVydGlhID0gdGhpcy5pbnZJbmVydGlhV29ybGQ7CiAgICAgIGNvbnN0IGxpbmVhckZhY3RvciA9IHRoaXMubGluZWFyRmFjdG9yOwogICAgICBjb25zdCBpTWR0ID0gaW52TWFzcyAqIGR0OwogICAgICB2ZWxvLnggKz0gZm9yY2UueCAqIGlNZHQgKiBsaW5lYXJGYWN0b3IueDsKICAgICAgdmVsby55ICs9IGZvcmNlLnkgKiBpTWR0ICogbGluZWFyRmFjdG9yLnk7CiAgICAgIHZlbG8ueiArPSBmb3JjZS56ICogaU1kdCAqIGxpbmVhckZhY3Rvci56OwogICAgICBjb25zdCBlID0gaW52SW5lcnRpYS5lbGVtZW50czsKICAgICAgY29uc3QgYW5ndWxhckZhY3RvciA9IHRoaXMuYW5ndWxhckZhY3RvcjsKICAgICAgY29uc3QgdHggPSB0b3JxdWUueCAqIGFuZ3VsYXJGYWN0b3IueDsKICAgICAgY29uc3QgdHkgPSB0b3JxdWUueSAqIGFuZ3VsYXJGYWN0b3IueTsKICAgICAgY29uc3QgdHogPSB0b3JxdWUueiAqIGFuZ3VsYXJGYWN0b3IuejsKICAgICAgYW5ndWxhclZlbG8ueCArPSBkdCAqIChlWzBdICogdHggKyBlWzFdICogdHkgKyBlWzJdICogdHopOwogICAgICBhbmd1bGFyVmVsby55ICs9IGR0ICogKGVbM10gKiB0eCArIGVbNF0gKiB0eSArIGVbNV0gKiB0eik7CiAgICAgIGFuZ3VsYXJWZWxvLnogKz0gZHQgKiAoZVs2XSAqIHR4ICsgZVs3XSAqIHR5ICsgZVs4XSAqIHR6KTsgLy8gVXNlIG5ldyB2ZWxvY2l0eSAgLSBsZWFwIGZyb2cKCiAgICAgIHBvcy54ICs9IHZlbG8ueCAqIGR0OwogICAgICBwb3MueSArPSB2ZWxvLnkgKiBkdDsKICAgICAgcG9zLnogKz0gdmVsby56ICogZHQ7CiAgICAgIHF1YXQuaW50ZWdyYXRlKHRoaXMuYW5ndWxhclZlbG9jaXR5LCBkdCwgdGhpcy5hbmd1bGFyRmFjdG9yLCBxdWF0KTsKCiAgICAgIGlmIChxdWF0Tm9ybWFsaXplKSB7CiAgICAgICAgaWYgKHF1YXROb3JtYWxpemVGYXN0KSB7CiAgICAgICAgICBxdWF0Lm5vcm1hbGl6ZUZhc3QoKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgcXVhdC5ub3JtYWxpemUoKTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIHRoaXMuYWFiYk5lZWRzVXBkYXRlID0gdHJ1ZTsgLy8gVXBkYXRlIHdvcmxkIGluZXJ0aWEKCiAgICAgIHRoaXMudXBkYXRlSW5lcnRpYVdvcmxkKCk7CiAgICB9CgogIH0KICBCb2R5LmlkQ291bnRlciA9IDA7CiAgQm9keS5DT0xMSURFX0VWRU5UX05BTUUgPSAnY29sbGlkZSc7CiAgQm9keS5EWU5BTUlDID0gQk9EWV9UWVBFUy5EWU5BTUlDOwogIEJvZHkuU1RBVElDID0gQk9EWV9UWVBFUy5TVEFUSUM7CiAgQm9keS5LSU5FTUFUSUMgPSBCT0RZX1RZUEVTLktJTkVNQVRJQzsKICBCb2R5LkFXQUtFID0gQk9EWV9TTEVFUF9TVEFURVMuQVdBS0U7CiAgQm9keS5TTEVFUFkgPSBCT0RZX1NMRUVQX1NUQVRFUy5TTEVFUFk7CiAgQm9keS5TTEVFUElORyA9IEJPRFlfU0xFRVBfU1RBVEVTLlNMRUVQSU5HOwogIEJvZHkud2FrZXVwRXZlbnQgPSB7CiAgICB0eXBlOiAnd2FrZXVwJwogIH07CiAgQm9keS5zbGVlcHlFdmVudCA9IHsKICAgIHR5cGU6ICdzbGVlcHknCiAgfTsKICBCb2R5LnNsZWVwRXZlbnQgPSB7CiAgICB0eXBlOiAnc2xlZXAnCiAgfTsKICBjb25zdCB0bXBWZWMgPSBuZXcgVmVjMygpOwogIGNvbnN0IHRtcFF1YXQgPSBuZXcgUXVhdGVybmlvbigpOwogIGNvbnN0IHVwZGF0ZUFBQkJfc2hhcGVBQUJCID0gbmV3IEFBQkIoKTsKICBjb25zdCB1aXdfbTEgPSBuZXcgTWF0MygpOwogIGNvbnN0IHVpd19tMiA9IG5ldyBNYXQzKCk7CiAgbmV3IE1hdDMoKTsKICBjb25zdCBCb2R5X2FwcGx5Rm9yY2Vfcm90Rm9yY2UgPSBuZXcgVmVjMygpOwogIGNvbnN0IEJvZHlfYXBwbHlMb2NhbEZvcmNlX3dvcmxkRm9yY2UgPSBuZXcgVmVjMygpOwogIGNvbnN0IEJvZHlfYXBwbHlMb2NhbEZvcmNlX3JlbGF0aXZlUG9pbnRXb3JsZCA9IG5ldyBWZWMzKCk7CiAgY29uc3QgQm9keV9hcHBseUltcHVsc2VfdmVsbyA9IG5ldyBWZWMzKCk7CiAgY29uc3QgQm9keV9hcHBseUltcHVsc2Vfcm90VmVsbyA9IG5ldyBWZWMzKCk7CiAgY29uc3QgQm9keV9hcHBseUxvY2FsSW1wdWxzZV93b3JsZEltcHVsc2UgPSBuZXcgVmVjMygpOwogIGNvbnN0IEJvZHlfYXBwbHlMb2NhbEltcHVsc2VfcmVsYXRpdmVQb2ludCA9IG5ldyBWZWMzKCk7CiAgY29uc3QgQm9keV91cGRhdGVNYXNzUHJvcGVydGllc19oYWxmRXh0ZW50cyA9IG5ldyBWZWMzKCk7CgogIC8qKgogICAqIEJhc2UgY2xhc3MgZm9yIGJyb2FkcGhhc2UgaW1wbGVtZW50YXRpb25zCiAgICogQGF1dGhvciBzY2h0ZXBwZQogICAqLwogIGNsYXNzIEJyb2FkcGhhc2UgewogICAgLyoqCiAgICAgKiBUaGUgd29ybGQgdG8gc2VhcmNoIGZvciBjb2xsaXNpb25zIGluLgogICAgICovCgogICAgLyoqCiAgICAgKiBJZiBzZXQgdG8gdHJ1ZSwgdGhlIGJyb2FkcGhhc2UgdXNlcyBib3VuZGluZyBib3hlcyBmb3IgaW50ZXJzZWN0aW9uIHRlc3RzLCBlbHNlIGl0IHVzZXMgYm91bmRpbmcgc3BoZXJlcy4KICAgICAqLwoKICAgIC8qKgogICAgICogU2V0IHRvIHRydWUgaWYgdGhlIG9iamVjdHMgaW4gdGhlIHdvcmxkIG1vdmVkLgogICAgICovCiAgICBjb25zdHJ1Y3RvcigpIHsKICAgICAgdGhpcy53b3JsZCA9IG51bGw7CiAgICAgIHRoaXMudXNlQm91bmRpbmdCb3hlcyA9IGZhbHNlOwogICAgICB0aGlzLmRpcnR5ID0gdHJ1ZTsKICAgIH0KICAgIC8qKgogICAgICogR2V0IHRoZSBjb2xsaXNpb24gcGFpcnMgZnJvbSB0aGUgd29ybGQKICAgICAqIEBwYXJhbSB3b3JsZCBUaGUgd29ybGQgdG8gc2VhcmNoIGluCiAgICAgKiBAcGFyYW0gcDEgRW1wdHkgYXJyYXkgdG8gYmUgZmlsbGVkIHdpdGggYm9keSBvYmplY3RzCiAgICAgKiBAcGFyYW0gcDIgRW1wdHkgYXJyYXkgdG8gYmUgZmlsbGVkIHdpdGggYm9keSBvYmplY3RzCiAgICAgKi8KCgogICAgY29sbGlzaW9uUGFpcnMod29ybGQsIHAxLCBwMikgewogICAgICB0aHJvdyBuZXcgRXJyb3IoJ2NvbGxpc2lvblBhaXJzIG5vdCBpbXBsZW1lbnRlZCBmb3IgdGhpcyBCcm9hZFBoYXNlIGNsYXNzIScpOwogICAgfQogICAgLyoqCiAgICAgKiBDaGVjayBpZiBhIGJvZHkgcGFpciBuZWVkcyB0byBiZSBpbnRlcnNlY3Rpb24gdGVzdGVkIGF0IGFsbC4KICAgICAqLwoKCiAgICBuZWVkQnJvYWRwaGFzZUNvbGxpc2lvbihib2R5QSwgYm9keUIpIHsKICAgICAgLy8gQ2hlY2sgY29sbGlzaW9uIGZpbHRlciBtYXNrcwogICAgICBpZiAoKGJvZHlBLmNvbGxpc2lvbkZpbHRlckdyb3VwICYgYm9keUIuY29sbGlzaW9uRmlsdGVyTWFzaykgPT09IDAgfHwgKGJvZHlCLmNvbGxpc2lvbkZpbHRlckdyb3VwICYgYm9keUEuY29sbGlzaW9uRmlsdGVyTWFzaykgPT09IDApIHsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0gLy8gQ2hlY2sgdHlwZXMKCgogICAgICBpZiAoKChib2R5QS50eXBlICYgQm9keS5TVEFUSUMpICE9PSAwIHx8IGJvZHlBLnNsZWVwU3RhdGUgPT09IEJvZHkuU0xFRVBJTkcpICYmICgoYm9keUIudHlwZSAmIEJvZHkuU1RBVElDKSAhPT0gMCB8fCBib2R5Qi5zbGVlcFN0YXRlID09PSBCb2R5LlNMRUVQSU5HKSkgewogICAgICAgIC8vIEJvdGggYm9kaWVzIGFyZSBzdGF0aWMgb3Igc2xlZXBpbmcuIFNraXAuCiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9CgogICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KICAgIC8qKgogICAgICogQ2hlY2sgaWYgdGhlIGJvdW5kaW5nIHZvbHVtZXMgb2YgdHdvIGJvZGllcyBpbnRlcnNlY3QuCiAgICAgKi8KCgogICAgaW50ZXJzZWN0aW9uVGVzdChib2R5QSwgYm9keUIsIHBhaXJzMSwgcGFpcnMyKSB7CiAgICAgIGlmICh0aGlzLnVzZUJvdW5kaW5nQm94ZXMpIHsKICAgICAgICB0aGlzLmRvQm91bmRpbmdCb3hCcm9hZHBoYXNlKGJvZHlBLCBib2R5QiwgcGFpcnMxLCBwYWlyczIpOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuZG9Cb3VuZGluZ1NwaGVyZUJyb2FkcGhhc2UoYm9keUEsIGJvZHlCLCBwYWlyczEsIHBhaXJzMik7CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogQ2hlY2sgaWYgdGhlIGJvdW5kaW5nIHNwaGVyZXMgb2YgdHdvIGJvZGllcyBhcmUgaW50ZXJzZWN0aW5nLgogICAgICogQHBhcmFtIHBhaXJzMSBib2R5QSBpcyBhcHBlbmRlZCB0byB0aGlzIGFycmF5IGlmIGludGVyc2VjdGlvbgogICAgICogQHBhcmFtIHBhaXJzMiBib2R5QiBpcyBhcHBlbmRlZCB0byB0aGlzIGFycmF5IGlmIGludGVyc2VjdGlvbgogICAgICovCgoKICAgIGRvQm91bmRpbmdTcGhlcmVCcm9hZHBoYXNlKGJvZHlBLCBib2R5QiwgcGFpcnMxLCBwYWlyczIpIHsKICAgICAgY29uc3QgciA9IEJyb2FkcGhhc2VfY29sbGlzaW9uUGFpcnNfcjsKICAgICAgYm9keUIucG9zaXRpb24udnN1Yihib2R5QS5wb3NpdGlvbiwgcik7CiAgICAgIGNvbnN0IGJvdW5kaW5nUmFkaXVzU3VtMiA9IChib2R5QS5ib3VuZGluZ1JhZGl1cyArIGJvZHlCLmJvdW5kaW5nUmFkaXVzKSAqKiAyOwogICAgICBjb25zdCBub3JtMiA9IHIubGVuZ3RoU3F1YXJlZCgpOwoKICAgICAgaWYgKG5vcm0yIDwgYm91bmRpbmdSYWRpdXNTdW0yKSB7CiAgICAgICAgcGFpcnMxLnB1c2goYm9keUEpOwogICAgICAgIHBhaXJzMi5wdXNoKGJvZHlCKTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBDaGVjayBpZiB0aGUgYm91bmRpbmcgYm94ZXMgb2YgdHdvIGJvZGllcyBhcmUgaW50ZXJzZWN0aW5nLgogICAgICovCgoKICAgIGRvQm91bmRpbmdCb3hCcm9hZHBoYXNlKGJvZHlBLCBib2R5QiwgcGFpcnMxLCBwYWlyczIpIHsKICAgICAgaWYgKGJvZHlBLmFhYmJOZWVkc1VwZGF0ZSkgewogICAgICAgIGJvZHlBLnVwZGF0ZUFBQkIoKTsKICAgICAgfQoKICAgICAgaWYgKGJvZHlCLmFhYmJOZWVkc1VwZGF0ZSkgewogICAgICAgIGJvZHlCLnVwZGF0ZUFBQkIoKTsKICAgICAgfSAvLyBDaGVjayBBQUJCIC8gQUFCQgoKCiAgICAgIGlmIChib2R5QS5hYWJiLm92ZXJsYXBzKGJvZHlCLmFhYmIpKSB7CiAgICAgICAgcGFpcnMxLnB1c2goYm9keUEpOwogICAgICAgIHBhaXJzMi5wdXNoKGJvZHlCKTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBSZW1vdmVzIGR1cGxpY2F0ZSBwYWlycyBmcm9tIHRoZSBwYWlyIGFycmF5cy4KICAgICAqLwoKCiAgICBtYWtlUGFpcnNVbmlxdWUocGFpcnMxLCBwYWlyczIpIHsKICAgICAgY29uc3QgdCA9IEJyb2FkcGhhc2VfbWFrZVBhaXJzVW5pcXVlX3RlbXA7CiAgICAgIGNvbnN0IHAxID0gQnJvYWRwaGFzZV9tYWtlUGFpcnNVbmlxdWVfcDE7CiAgICAgIGNvbnN0IHAyID0gQnJvYWRwaGFzZV9tYWtlUGFpcnNVbmlxdWVfcDI7CiAgICAgIGNvbnN0IE4gPSBwYWlyczEubGVuZ3RoOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IE47IGkrKykgewogICAgICAgIHAxW2ldID0gcGFpcnMxW2ldOwogICAgICAgIHAyW2ldID0gcGFpcnMyW2ldOwogICAgICB9CgogICAgICBwYWlyczEubGVuZ3RoID0gMDsKICAgICAgcGFpcnMyLmxlbmd0aCA9IDA7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gTjsgaSsrKSB7CiAgICAgICAgY29uc3QgaWQxID0gcDFbaV0uaWQ7CiAgICAgICAgY29uc3QgaWQyID0gcDJbaV0uaWQ7CiAgICAgICAgY29uc3Qga2V5ID0gaWQxIDwgaWQyID8gYCR7aWQxfSwke2lkMn1gIDogYCR7aWQyfSwke2lkMX1gOwogICAgICAgIHRba2V5XSA9IGk7CiAgICAgICAgdC5rZXlzLnB1c2goa2V5KTsKICAgICAgfQoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IHQua2V5cy5sZW5ndGg7IGkrKykgewogICAgICAgIGNvbnN0IGtleSA9IHQua2V5cy5wb3AoKTsKICAgICAgICBjb25zdCBwYWlySW5kZXggPSB0W2tleV07CiAgICAgICAgcGFpcnMxLnB1c2gocDFbcGFpckluZGV4XSk7CiAgICAgICAgcGFpcnMyLnB1c2gocDJbcGFpckluZGV4XSk7CiAgICAgICAgZGVsZXRlIHRba2V5XTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBUbyBiZSBpbXBsZW1lbnRlZCBieSBzdWJjYXNzZXMKICAgICAqLwoKCiAgICBzZXRXb3JsZCh3b3JsZCkge30KICAgIC8qKgogICAgICogQ2hlY2sgaWYgdGhlIGJvdW5kaW5nIHNwaGVyZXMgb2YgdHdvIGJvZGllcyBvdmVybGFwLgogICAgICovCgoKICAgIHN0YXRpYyBib3VuZGluZ1NwaGVyZUNoZWNrKGJvZHlBLCBib2R5QikgewogICAgICBjb25zdCBkaXN0ID0gbmV3IFZlYzMoKTsgLy8gYnNjX2Rpc3Q7CgogICAgICBib2R5QS5wb3NpdGlvbi52c3ViKGJvZHlCLnBvc2l0aW9uLCBkaXN0KTsKICAgICAgY29uc3Qgc2EgPSBib2R5QS5zaGFwZXNbMF07CiAgICAgIGNvbnN0IHNiID0gYm9keUIuc2hhcGVzWzBdOwogICAgICByZXR1cm4gTWF0aC5wb3coc2EuYm91bmRpbmdTcGhlcmVSYWRpdXMgKyBzYi5ib3VuZGluZ1NwaGVyZVJhZGl1cywgMikgPiBkaXN0Lmxlbmd0aFNxdWFyZWQoKTsKICAgIH0KICAgIC8qKgogICAgICogUmV0dXJucyBhbGwgdGhlIGJvZGllcyB3aXRoaW4gdGhlIEFBQkIuCiAgICAgKi8KCgogICAgYWFiYlF1ZXJ5KHdvcmxkLCBhYWJiLCByZXN1bHQpIHsKICAgICAgY29uc29sZS53YXJuKCcuYWFiYlF1ZXJ5IGlzIG5vdCBpbXBsZW1lbnRlZCBpbiB0aGlzIEJyb2FkcGhhc2Ugc3ViY2xhc3MuJyk7CiAgICAgIHJldHVybiBbXTsKICAgIH0KCiAgfSAvLyBUZW1wIG9iamVjdHMKCiAgY29uc3QgQnJvYWRwaGFzZV9jb2xsaXNpb25QYWlyc19yID0gbmV3IFZlYzMoKTsKICBuZXcgVmVjMygpOwogIG5ldyBRdWF0ZXJuaW9uKCk7CiAgbmV3IFZlYzMoKTsKICBjb25zdCBCcm9hZHBoYXNlX21ha2VQYWlyc1VuaXF1ZV90ZW1wID0gewogICAga2V5czogW10KICB9OwogIGNvbnN0IEJyb2FkcGhhc2VfbWFrZVBhaXJzVW5pcXVlX3AxID0gW107CiAgY29uc3QgQnJvYWRwaGFzZV9tYWtlUGFpcnNVbmlxdWVfcDIgPSBbXTsKICBuZXcgVmVjMygpOwogIG5ldyBWZWMzKCk7CiAgbmV3IFZlYzMoKTsKCiAgLyoqCiAgICogTmFpdmUgYnJvYWRwaGFzZSBpbXBsZW1lbnRhdGlvbiwgdXNlZCBpbiBsYWNrIG9mIGJldHRlciBvbmVzLgogICAqCiAgICogVGhlIG5haXZlIGJyb2FkcGhhc2UgbG9va3MgYXQgYWxsIHBvc3NpYmxlIHBhaXJzIHdpdGhvdXQgcmVzdHJpY3Rpb24sIHRoZXJlZm9yZSBpdCBoYXMgY29tcGxleGl0eSBOXjIgXyh3aGljaCBpcyBiYWQpXwogICAqLwogIGNsYXNzIE5haXZlQnJvYWRwaGFzZSBleHRlbmRzIEJyb2FkcGhhc2UgewogICAgLyoqCiAgICAgKiBAdG9kbyBSZW1vdmUgdXNlbGVzcyBjb25zdHJ1Y3RvcgogICAgICovCiAgICBjb25zdHJ1Y3RvcigpIHsKICAgICAgc3VwZXIoKTsKICAgIH0KICAgIC8qKgogICAgICogR2V0IGFsbCB0aGUgY29sbGlzaW9uIHBhaXJzIGluIHRoZSBwaHlzaWNzIHdvcmxkCiAgICAgKi8KCgogICAgY29sbGlzaW9uUGFpcnMod29ybGQsIHBhaXJzMSwgcGFpcnMyKSB7CiAgICAgIGNvbnN0IGJvZGllcyA9IHdvcmxkLmJvZGllczsKICAgICAgY29uc3QgbiA9IGJvZGllcy5sZW5ndGg7CiAgICAgIGxldCBiaTsKICAgICAgbGV0IGJqOyAvLyBOYWl2ZSBOXjIgZnR3IQoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IG47IGkrKykgewogICAgICAgIGZvciAobGV0IGogPSAwOyBqICE9PSBpOyBqKyspIHsKICAgICAgICAgIGJpID0gYm9kaWVzW2ldOwogICAgICAgICAgYmogPSBib2RpZXNbal07CgogICAgICAgICAgaWYgKCF0aGlzLm5lZWRCcm9hZHBoYXNlQ29sbGlzaW9uKGJpLCBiaikpIHsKICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICB9CgogICAgICAgICAgdGhpcy5pbnRlcnNlY3Rpb25UZXN0KGJpLCBiaiwgcGFpcnMxLCBwYWlyczIpOwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBSZXR1cm5zIGFsbCB0aGUgYm9kaWVzIHdpdGhpbiBhbiBBQUJCLgogICAgICogQHBhcmFtIHJlc3VsdCBBbiBhcnJheSB0byBzdG9yZSByZXN1bHRpbmcgYm9kaWVzIGluLgogICAgICovCgoKICAgIGFhYmJRdWVyeSh3b3JsZCwgYWFiYiwgcmVzdWx0KSB7CiAgICAgIGlmIChyZXN1bHQgPT09IHZvaWQgMCkgewogICAgICAgIHJlc3VsdCA9IFtdOwogICAgICB9CgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHdvcmxkLmJvZGllcy5sZW5ndGg7IGkrKykgewogICAgICAgIGNvbnN0IGIgPSB3b3JsZC5ib2RpZXNbaV07CgogICAgICAgIGlmIChiLmFhYmJOZWVkc1VwZGF0ZSkgewogICAgICAgICAgYi51cGRhdGVBQUJCKCk7CiAgICAgICAgfSAvLyBVZ2x5IGhhY2sgdW50aWwgQm9keSBnZXRzIGFhYmIKCgogICAgICAgIGlmIChiLmFhYmIub3ZlcmxhcHMoYWFiYikpIHsKICAgICAgICAgIHJlc3VsdC5wdXNoKGIpOwogICAgICAgIH0KICAgICAgfQoKICAgICAgcmV0dXJuIHJlc3VsdDsKICAgIH0KCiAgfQoKICAvKioKICAgKiBTdG9yYWdlIGZvciBSYXkgY2FzdGluZyBkYXRhCiAgICovCiAgY2xhc3MgUmF5Y2FzdFJlc3VsdCB7CiAgICAvKioKICAgICAqIHJheUZyb21Xb3JsZAogICAgICovCgogICAgLyoqCiAgICAgKiByYXlUb1dvcmxkCiAgICAgKi8KCiAgICAvKioKICAgICAqIGhpdE5vcm1hbFdvcmxkCiAgICAgKi8KCiAgICAvKioKICAgICAqIGhpdFBvaW50V29ybGQKICAgICAqLwoKICAgIC8qKgogICAgICogaGFzSGl0CiAgICAgKi8KCiAgICAvKioKICAgICAqIHNoYXBlCiAgICAgKi8KCiAgICAvKioKICAgICAqIGJvZHkKICAgICAqLwoKICAgIC8qKgogICAgICogVGhlIGluZGV4IG9mIHRoZSBoaXQgdHJpYW5nbGUsIGlmIHRoZSBoaXQgc2hhcGUgd2FzIGEgdHJpbWVzaAogICAgICovCgogICAgLyoqCiAgICAgKiBEaXN0YW5jZSB0byB0aGUgaGl0LiBXaWxsIGJlIHNldCB0byAtMSBpZiB0aGVyZSB3YXMgbm8gaGl0CiAgICAgKi8KCiAgICAvKioKICAgICAqIElmIHRoZSByYXkgc2hvdWxkIHN0b3AgdHJhdmVyc2luZyB0aGUgYm9kaWVzCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKCkgewogICAgICB0aGlzLnJheUZyb21Xb3JsZCA9IG5ldyBWZWMzKCk7CiAgICAgIHRoaXMucmF5VG9Xb3JsZCA9IG5ldyBWZWMzKCk7CiAgICAgIHRoaXMuaGl0Tm9ybWFsV29ybGQgPSBuZXcgVmVjMygpOwogICAgICB0aGlzLmhpdFBvaW50V29ybGQgPSBuZXcgVmVjMygpOwogICAgICB0aGlzLmhhc0hpdCA9IGZhbHNlOwogICAgICB0aGlzLnNoYXBlID0gbnVsbDsKICAgICAgdGhpcy5ib2R5ID0gbnVsbDsKICAgICAgdGhpcy5oaXRGYWNlSW5kZXggPSAtMTsKICAgICAgdGhpcy5kaXN0YW5jZSA9IC0xOwogICAgICB0aGlzLnNob3VsZFN0b3AgPSBmYWxzZTsKICAgIH0KICAgIC8qKgogICAgICogUmVzZXQgYWxsIHJlc3VsdCBkYXRhLgogICAgICovCgoKICAgIHJlc2V0KCkgewogICAgICB0aGlzLnJheUZyb21Xb3JsZC5zZXRaZXJvKCk7CiAgICAgIHRoaXMucmF5VG9Xb3JsZC5zZXRaZXJvKCk7CiAgICAgIHRoaXMuaGl0Tm9ybWFsV29ybGQuc2V0WmVybygpOwogICAgICB0aGlzLmhpdFBvaW50V29ybGQuc2V0WmVybygpOwogICAgICB0aGlzLmhhc0hpdCA9IGZhbHNlOwogICAgICB0aGlzLnNoYXBlID0gbnVsbDsKICAgICAgdGhpcy5ib2R5ID0gbnVsbDsKICAgICAgdGhpcy5oaXRGYWNlSW5kZXggPSAtMTsKICAgICAgdGhpcy5kaXN0YW5jZSA9IC0xOwogICAgICB0aGlzLnNob3VsZFN0b3AgPSBmYWxzZTsKICAgIH0KICAgIC8qKgogICAgICogYWJvcnQKICAgICAqLwoKCiAgICBhYm9ydCgpIHsKICAgICAgdGhpcy5zaG91bGRTdG9wID0gdHJ1ZTsKICAgIH0KICAgIC8qKgogICAgICogU2V0IHJlc3VsdCBkYXRhLgogICAgICovCgoKICAgIHNldChyYXlGcm9tV29ybGQsIHJheVRvV29ybGQsIGhpdE5vcm1hbFdvcmxkLCBoaXRQb2ludFdvcmxkLCBzaGFwZSwgYm9keSwgZGlzdGFuY2UpIHsKICAgICAgdGhpcy5yYXlGcm9tV29ybGQuY29weShyYXlGcm9tV29ybGQpOwogICAgICB0aGlzLnJheVRvV29ybGQuY29weShyYXlUb1dvcmxkKTsKICAgICAgdGhpcy5oaXROb3JtYWxXb3JsZC5jb3B5KGhpdE5vcm1hbFdvcmxkKTsKICAgICAgdGhpcy5oaXRQb2ludFdvcmxkLmNvcHkoaGl0UG9pbnRXb3JsZCk7CiAgICAgIHRoaXMuc2hhcGUgPSBzaGFwZTsKICAgICAgdGhpcy5ib2R5ID0gYm9keTsKICAgICAgdGhpcy5kaXN0YW5jZSA9IGRpc3RhbmNlOwogICAgfQoKICB9CgogIGxldCBfU2hhcGUkdHlwZXMkU1BIRVJFLCBfU2hhcGUkdHlwZXMkUExBTkUsIF9TaGFwZSR0eXBlcyRCT1gsIF9TaGFwZSR0eXBlcyRDWUxJTkRFUiwgX1NoYXBlJHR5cGVzJENPTlZFWFBPLCBfU2hhcGUkdHlwZXMkSEVJR0hURkksIF9TaGFwZSR0eXBlcyRUUklNRVNIOwoKICAvKioKICAgKiBSQVlfTU9ERVMKICAgKi8KICBjb25zdCBSQVlfTU9ERVMgPSB7CiAgICAvKiogQ0xPU0VTVCAqLwogICAgQ0xPU0VTVDogMSwKCiAgICAvKiogQU5ZICovCiAgICBBTlk6IDIsCgogICAgLyoqIEFMTCAqLwogICAgQUxMOiA0CiAgfTsKICAvKioKICAgKiBSYXlNb2RlCiAgICovCgogIF9TaGFwZSR0eXBlcyRTUEhFUkUgPSBTaGFwZS50eXBlcy5TUEhFUkU7CiAgX1NoYXBlJHR5cGVzJFBMQU5FID0gU2hhcGUudHlwZXMuUExBTkU7CiAgX1NoYXBlJHR5cGVzJEJPWCA9IFNoYXBlLnR5cGVzLkJPWDsKICBfU2hhcGUkdHlwZXMkQ1lMSU5ERVIgPSBTaGFwZS50eXBlcy5DWUxJTkRFUjsKICBfU2hhcGUkdHlwZXMkQ09OVkVYUE8gPSBTaGFwZS50eXBlcy5DT05WRVhQT0xZSEVEUk9OOwogIF9TaGFwZSR0eXBlcyRIRUlHSFRGSSA9IFNoYXBlLnR5cGVzLkhFSUdIVEZJRUxEOwogIF9TaGFwZSR0eXBlcyRUUklNRVNIID0gU2hhcGUudHlwZXMuVFJJTUVTSDsKCiAgLyoqCiAgICogQSBsaW5lIGluIDNEIHNwYWNlIHRoYXQgaW50ZXJzZWN0cyBib2RpZXMgYW5kIHJldHVybiBwb2ludHMuCiAgICovCiAgY2xhc3MgUmF5IHsKICAgIC8qKgogICAgICogZnJvbQogICAgICovCgogICAgLyoqCiAgICAgKiB0bwogICAgICovCgogICAgLyoqCiAgICAgKiBkaXJlY3Rpb24KICAgICAqLwoKICAgIC8qKgogICAgICogVGhlIHByZWNpc2lvbiBvZiB0aGUgcmF5LiBVc2VkIHdoZW4gY2hlY2tpbmcgcGFyYWxsZWxpdHkgZXRjLgogICAgICogQGRlZmF1bHQgMC4wMDAxCiAgICAgKi8KCiAgICAvKioKICAgICAqIFNldCB0byBgZmFsc2VgIGlmIHlvdSBkb24ndCB3YW50IHRoZSBSYXkgdG8gdGFrZSBgY29sbGlzaW9uUmVzcG9uc2VgIGZsYWdzIGludG8gYWNjb3VudCBvbiBib2RpZXMgYW5kIHNoYXBlcy4KICAgICAqIEBkZWZhdWx0IHRydWUKICAgICAqLwoKICAgIC8qKgogICAgICogSWYgc2V0IHRvIGB0cnVlYCwgdGhlIHJheSBza2lwcyBhbnkgaGl0cyB3aXRoIG5vcm1hbC5kb3QocmF5RGlyZWN0aW9uKSA8IDAuCiAgICAgKiBAZGVmYXVsdCBmYWxzZQogICAgICovCgogICAgLyoqCiAgICAgKiBjb2xsaXNpb25GaWx0ZXJNYXNrCiAgICAgKiBAZGVmYXVsdCAtMQogICAgICovCgogICAgLyoqCiAgICAgKiBjb2xsaXNpb25GaWx0ZXJHcm91cAogICAgICogQGRlZmF1bHQgLTEKICAgICAqLwoKICAgIC8qKgogICAgICogVGhlIGludGVyc2VjdGlvbiBtb2RlLiBTaG91bGQgYmUgUmF5LkFOWSwgUmF5LkFMTCBvciBSYXkuQ0xPU0VTVC4KICAgICAqIEBkZWZhdWx0IFJBWS5BTlkKICAgICAqLwoKICAgIC8qKgogICAgICogQ3VycmVudCByZXN1bHQgb2JqZWN0LgogICAgICovCgogICAgLyoqCiAgICAgKiBXaWxsIGJlIHNldCB0byBgdHJ1ZWAgZHVyaW5nIGludGVyc2VjdFdvcmxkKCkgaWYgdGhlIHJheSBoaXQgYW55dGhpbmcuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFVzZXItcHJvdmlkZWQgcmVzdWx0IGNhbGxiYWNrLiBXaWxsIGJlIHVzZWQgaWYgbW9kZSBpcyBSYXkuQUxMLgogICAgICovCgogICAgLyoqCiAgICAgKiBDTE9TRVNUCiAgICAgKi8KCiAgICAvKioKICAgICAqIEFOWQogICAgICovCgogICAgLyoqCiAgICAgKiBBTEwKICAgICAqLwogICAgZ2V0IFtfU2hhcGUkdHlwZXMkU1BIRVJFXSgpIHsKICAgICAgcmV0dXJuIHRoaXMuX2ludGVyc2VjdFNwaGVyZTsKICAgIH0KCiAgICBnZXQgW19TaGFwZSR0eXBlcyRQTEFORV0oKSB7CiAgICAgIHJldHVybiB0aGlzLl9pbnRlcnNlY3RQbGFuZTsKICAgIH0KCiAgICBnZXQgW19TaGFwZSR0eXBlcyRCT1hdKCkgewogICAgICByZXR1cm4gdGhpcy5faW50ZXJzZWN0Qm94OwogICAgfQoKICAgIGdldCBbX1NoYXBlJHR5cGVzJENZTElOREVSXSgpIHsKICAgICAgcmV0dXJuIHRoaXMuX2ludGVyc2VjdENvbnZleDsKICAgIH0KCiAgICBnZXQgW19TaGFwZSR0eXBlcyRDT05WRVhQT10oKSB7CiAgICAgIHJldHVybiB0aGlzLl9pbnRlcnNlY3RDb252ZXg7CiAgICB9CgogICAgZ2V0IFtfU2hhcGUkdHlwZXMkSEVJR0hURkldKCkgewogICAgICByZXR1cm4gdGhpcy5faW50ZXJzZWN0SGVpZ2h0ZmllbGQ7CiAgICB9CgogICAgZ2V0IFtfU2hhcGUkdHlwZXMkVFJJTUVTSF0oKSB7CiAgICAgIHJldHVybiB0aGlzLl9pbnRlcnNlY3RUcmltZXNoOwogICAgfQoKICAgIGNvbnN0cnVjdG9yKGZyb20sIHRvKSB7CiAgICAgIGlmIChmcm9tID09PSB2b2lkIDApIHsKICAgICAgICBmcm9tID0gbmV3IFZlYzMoKTsKICAgICAgfQoKICAgICAgaWYgKHRvID09PSB2b2lkIDApIHsKICAgICAgICB0byA9IG5ldyBWZWMzKCk7CiAgICAgIH0KCiAgICAgIHRoaXMuZnJvbSA9IGZyb20uY2xvbmUoKTsKICAgICAgdGhpcy50byA9IHRvLmNsb25lKCk7CiAgICAgIHRoaXMuZGlyZWN0aW9uID0gbmV3IFZlYzMoKTsKICAgICAgdGhpcy5wcmVjaXNpb24gPSAwLjAwMDE7CiAgICAgIHRoaXMuY2hlY2tDb2xsaXNpb25SZXNwb25zZSA9IHRydWU7CiAgICAgIHRoaXMuc2tpcEJhY2tmYWNlcyA9IGZhbHNlOwogICAgICB0aGlzLmNvbGxpc2lvbkZpbHRlck1hc2sgPSAtMTsKICAgICAgdGhpcy5jb2xsaXNpb25GaWx0ZXJHcm91cCA9IC0xOwogICAgICB0aGlzLm1vZGUgPSBSYXkuQU5ZOwogICAgICB0aGlzLnJlc3VsdCA9IG5ldyBSYXljYXN0UmVzdWx0KCk7CiAgICAgIHRoaXMuaGFzSGl0ID0gZmFsc2U7CgogICAgICB0aGlzLmNhbGxiYWNrID0gcmVzdWx0ID0+IHt9OwogICAgfQogICAgLyoqCiAgICAgKiBEbyBpdGVyc2VjdGlvbiBhZ2FpbnN0IGFsbCBib2RpZXMgaW4gdGhlIGdpdmVuIFdvcmxkLgogICAgICogQHJldHVybiBUcnVlIGlmIHRoZSByYXkgaGl0IGFueXRoaW5nLCBvdGhlcndpc2UgZmFsc2UuCiAgICAgKi8KCgogICAgaW50ZXJzZWN0V29ybGQod29ybGQsIG9wdGlvbnMpIHsKICAgICAgdGhpcy5tb2RlID0gb3B0aW9ucy5tb2RlIHx8IFJheS5BTlk7CiAgICAgIHRoaXMucmVzdWx0ID0gb3B0aW9ucy5yZXN1bHQgfHwgbmV3IFJheWNhc3RSZXN1bHQoKTsKICAgICAgdGhpcy5za2lwQmFja2ZhY2VzID0gISFvcHRpb25zLnNraXBCYWNrZmFjZXM7CiAgICAgIHRoaXMuY29sbGlzaW9uRmlsdGVyTWFzayA9IHR5cGVvZiBvcHRpb25zLmNvbGxpc2lvbkZpbHRlck1hc2sgIT09ICd1bmRlZmluZWQnID8gb3B0aW9ucy5jb2xsaXNpb25GaWx0ZXJNYXNrIDogLTE7CiAgICAgIHRoaXMuY29sbGlzaW9uRmlsdGVyR3JvdXAgPSB0eXBlb2Ygb3B0aW9ucy5jb2xsaXNpb25GaWx0ZXJHcm91cCAhPT0gJ3VuZGVmaW5lZCcgPyBvcHRpb25zLmNvbGxpc2lvbkZpbHRlckdyb3VwIDogLTE7CiAgICAgIHRoaXMuY2hlY2tDb2xsaXNpb25SZXNwb25zZSA9IHR5cGVvZiBvcHRpb25zLmNoZWNrQ29sbGlzaW9uUmVzcG9uc2UgIT09ICd1bmRlZmluZWQnID8gb3B0aW9ucy5jaGVja0NvbGxpc2lvblJlc3BvbnNlIDogdHJ1ZTsKCiAgICAgIGlmIChvcHRpb25zLmZyb20pIHsKICAgICAgICB0aGlzLmZyb20uY29weShvcHRpb25zLmZyb20pOwogICAgICB9CgogICAgICBpZiAob3B0aW9ucy50bykgewogICAgICAgIHRoaXMudG8uY29weShvcHRpb25zLnRvKTsKICAgICAgfQoKICAgICAgdGhpcy5jYWxsYmFjayA9IG9wdGlvbnMuY2FsbGJhY2sgfHwgKCgpID0+IHt9KTsKCiAgICAgIHRoaXMuaGFzSGl0ID0gZmFsc2U7CiAgICAgIHRoaXMucmVzdWx0LnJlc2V0KCk7CiAgICAgIHRoaXMudXBkYXRlRGlyZWN0aW9uKCk7CiAgICAgIHRoaXMuZ2V0QUFCQih0bXBBQUJCJDEpOwogICAgICB0bXBBcnJheS5sZW5ndGggPSAwOwogICAgICB3b3JsZC5icm9hZHBoYXNlLmFhYmJRdWVyeSh3b3JsZCwgdG1wQUFCQiQxLCB0bXBBcnJheSk7CiAgICAgIHRoaXMuaW50ZXJzZWN0Qm9kaWVzKHRtcEFycmF5KTsKICAgICAgcmV0dXJuIHRoaXMuaGFzSGl0OwogICAgfQogICAgLyoqCiAgICAgKiBTaG9vdCBhIHJheSBhdCBhIGJvZHksIGdldCBiYWNrIGluZm9ybWF0aW9uIGFib3V0IHRoZSBoaXQuCiAgICAgKiBAZGVwcmVjYXRlZCBAcGFyYW0gcmVzdWx0IHNldCB0aGUgcmVzdWx0IHByb3BlcnR5IG9mIHRoZSBSYXkgaW5zdGVhZC4KICAgICAqLwoKCiAgICBpbnRlcnNlY3RCb2R5KGJvZHksIHJlc3VsdCkgewogICAgICBpZiAocmVzdWx0KSB7CiAgICAgICAgdGhpcy5yZXN1bHQgPSByZXN1bHQ7CiAgICAgICAgdGhpcy51cGRhdGVEaXJlY3Rpb24oKTsKICAgICAgfQoKICAgICAgY29uc3QgY2hlY2tDb2xsaXNpb25SZXNwb25zZSA9IHRoaXMuY2hlY2tDb2xsaXNpb25SZXNwb25zZTsKCiAgICAgIGlmIChjaGVja0NvbGxpc2lvblJlc3BvbnNlICYmICFib2R5LmNvbGxpc2lvblJlc3BvbnNlKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICBpZiAoKHRoaXMuY29sbGlzaW9uRmlsdGVyR3JvdXAgJiBib2R5LmNvbGxpc2lvbkZpbHRlck1hc2spID09PSAwIHx8IChib2R5LmNvbGxpc2lvbkZpbHRlckdyb3VwICYgdGhpcy5jb2xsaXNpb25GaWx0ZXJNYXNrKSA9PT0gMCkgewogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgY29uc3QgeGkgPSBpbnRlcnNlY3RCb2R5X3hpOwogICAgICBjb25zdCBxaSA9IGludGVyc2VjdEJvZHlfcWk7CgogICAgICBmb3IgKGxldCBpID0gMCwgTiA9IGJvZHkuc2hhcGVzLmxlbmd0aDsgaSA8IE47IGkrKykgewogICAgICAgIGNvbnN0IHNoYXBlID0gYm9keS5zaGFwZXNbaV07CgogICAgICAgIGlmIChjaGVja0NvbGxpc2lvblJlc3BvbnNlICYmICFzaGFwZS5jb2xsaXNpb25SZXNwb25zZSkgewogICAgICAgICAgY29udGludWU7IC8vIFNraXAKICAgICAgICB9CgogICAgICAgIGJvZHkucXVhdGVybmlvbi5tdWx0KGJvZHkuc2hhcGVPcmllbnRhdGlvbnNbaV0sIHFpKTsKICAgICAgICBib2R5LnF1YXRlcm5pb24udm11bHQoYm9keS5zaGFwZU9mZnNldHNbaV0sIHhpKTsKICAgICAgICB4aS52YWRkKGJvZHkucG9zaXRpb24sIHhpKTsKICAgICAgICB0aGlzLmludGVyc2VjdFNoYXBlKHNoYXBlLCBxaSwgeGksIGJvZHkpOwoKICAgICAgICBpZiAodGhpcy5yZXN1bHQuc2hvdWxkU3RvcCkgewogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIFNob290IGEgcmF5IGF0IGFuIGFycmF5IGJvZGllcywgZ2V0IGJhY2sgaW5mb3JtYXRpb24gYWJvdXQgdGhlIGhpdC4KICAgICAqIEBwYXJhbSBib2RpZXMgQW4gYXJyYXkgb2YgQm9keSBvYmplY3RzLgogICAgICogQGRlcHJlY2F0ZWQgQHBhcmFtIHJlc3VsdCBzZXQgdGhlIHJlc3VsdCBwcm9wZXJ0eSBvZiB0aGUgUmF5IGluc3RlYWQuCiAgICAgKgogICAgICovCgoKICAgIGludGVyc2VjdEJvZGllcyhib2RpZXMsIHJlc3VsdCkgewogICAgICBpZiAocmVzdWx0KSB7CiAgICAgICAgdGhpcy5yZXN1bHQgPSByZXN1bHQ7CiAgICAgICAgdGhpcy51cGRhdGVEaXJlY3Rpb24oKTsKICAgICAgfQoKICAgICAgZm9yIChsZXQgaSA9IDAsIGwgPSBib2RpZXMubGVuZ3RoOyAhdGhpcy5yZXN1bHQuc2hvdWxkU3RvcCAmJiBpIDwgbDsgaSsrKSB7CiAgICAgICAgdGhpcy5pbnRlcnNlY3RCb2R5KGJvZGllc1tpXSk7CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogVXBkYXRlcyB0aGUgZGlyZWN0aW9uIHZlY3Rvci4KICAgICAqLwoKCiAgICB1cGRhdGVEaXJlY3Rpb24oKSB7CiAgICAgIHRoaXMudG8udnN1Yih0aGlzLmZyb20sIHRoaXMuZGlyZWN0aW9uKTsKICAgICAgdGhpcy5kaXJlY3Rpb24ubm9ybWFsaXplKCk7CiAgICB9CgogICAgaW50ZXJzZWN0U2hhcGUoc2hhcGUsIHF1YXQsIHBvc2l0aW9uLCBib2R5KSB7CiAgICAgIGNvbnN0IGZyb20gPSB0aGlzLmZyb207IC8vIENoZWNraW5nIGJvdW5kaW5nU3BoZXJlCgogICAgICBjb25zdCBkaXN0YW5jZSA9IGRpc3RhbmNlRnJvbUludGVyc2VjdGlvbihmcm9tLCB0aGlzLmRpcmVjdGlvbiwgcG9zaXRpb24pOwoKICAgICAgaWYgKGRpc3RhbmNlID4gc2hhcGUuYm91bmRpbmdTcGhlcmVSYWRpdXMpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGNvbnN0IGludGVyc2VjdE1ldGhvZCA9IHRoaXNbc2hhcGUudHlwZV07CgogICAgICBpZiAoaW50ZXJzZWN0TWV0aG9kKSB7CiAgICAgICAgaW50ZXJzZWN0TWV0aG9kLmNhbGwodGhpcywgc2hhcGUsIHF1YXQsIHBvc2l0aW9uLCBib2R5LCBzaGFwZSk7CiAgICAgIH0KICAgIH0KCiAgICBfaW50ZXJzZWN0Qm94KGJveCwgcXVhdCwgcG9zaXRpb24sIGJvZHksIHJlcG9ydGVkU2hhcGUpIHsKICAgICAgcmV0dXJuIHRoaXMuX2ludGVyc2VjdENvbnZleChib3guY29udmV4UG9seWhlZHJvblJlcHJlc2VudGF0aW9uLCBxdWF0LCBwb3NpdGlvbiwgYm9keSwgcmVwb3J0ZWRTaGFwZSk7CiAgICB9CgogICAgX2ludGVyc2VjdFBsYW5lKHNoYXBlLCBxdWF0LCBwb3NpdGlvbiwgYm9keSwgcmVwb3J0ZWRTaGFwZSkgewogICAgICBjb25zdCBmcm9tID0gdGhpcy5mcm9tOwogICAgICBjb25zdCB0byA9IHRoaXMudG87CiAgICAgIGNvbnN0IGRpcmVjdGlvbiA9IHRoaXMuZGlyZWN0aW9uOyAvLyBHZXQgcGxhbmUgbm9ybWFsCgogICAgICBjb25zdCB3b3JsZE5vcm1hbCA9IG5ldyBWZWMzKDAsIDAsIDEpOwogICAgICBxdWF0LnZtdWx0KHdvcmxkTm9ybWFsLCB3b3JsZE5vcm1hbCk7CiAgICAgIGNvbnN0IGxlbiA9IG5ldyBWZWMzKCk7CiAgICAgIGZyb20udnN1Yihwb3NpdGlvbiwgbGVuKTsKICAgICAgY29uc3QgcGxhbmVUb0Zyb20gPSBsZW4uZG90KHdvcmxkTm9ybWFsKTsKICAgICAgdG8udnN1Yihwb3NpdGlvbiwgbGVuKTsKICAgICAgY29uc3QgcGxhbmVUb1RvID0gbGVuLmRvdCh3b3JsZE5vcm1hbCk7CgogICAgICBpZiAocGxhbmVUb0Zyb20gKiBwbGFuZVRvVG8gPiAwKSB7CiAgICAgICAgLy8gImZyb20iIGFuZCAidG8iIGFyZSBvbiB0aGUgc2FtZSBzaWRlIG9mIHRoZSBwbGFuZS4uLiBiYWlsIG91dAogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgaWYgKGZyb20uZGlzdGFuY2VUbyh0bykgPCBwbGFuZVRvRnJvbSkgewogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgY29uc3Qgbl9kb3RfZGlyID0gd29ybGROb3JtYWwuZG90KGRpcmVjdGlvbik7CgogICAgICBpZiAoTWF0aC5hYnMobl9kb3RfZGlyKSA8IHRoaXMucHJlY2lzaW9uKSB7CiAgICAgICAgLy8gTm8gaW50ZXJzZWN0aW9uCiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICBjb25zdCBwbGFuZVBvaW50VG9Gcm9tID0gbmV3IFZlYzMoKTsKICAgICAgY29uc3QgZGlyX3NjYWxlZF93aXRoX3QgPSBuZXcgVmVjMygpOwogICAgICBjb25zdCBoaXRQb2ludFdvcmxkID0gbmV3IFZlYzMoKTsKICAgICAgZnJvbS52c3ViKHBvc2l0aW9uLCBwbGFuZVBvaW50VG9Gcm9tKTsKICAgICAgY29uc3QgdCA9IC13b3JsZE5vcm1hbC5kb3QocGxhbmVQb2ludFRvRnJvbSkgLyBuX2RvdF9kaXI7CiAgICAgIGRpcmVjdGlvbi5zY2FsZSh0LCBkaXJfc2NhbGVkX3dpdGhfdCk7CiAgICAgIGZyb20udmFkZChkaXJfc2NhbGVkX3dpdGhfdCwgaGl0UG9pbnRXb3JsZCk7CiAgICAgIHRoaXMucmVwb3J0SW50ZXJzZWN0aW9uKHdvcmxkTm9ybWFsLCBoaXRQb2ludFdvcmxkLCByZXBvcnRlZFNoYXBlLCBib2R5LCAtMSk7CiAgICB9CiAgICAvKioKICAgICAqIEdldCB0aGUgd29ybGQgQUFCQiBvZiB0aGUgcmF5LgogICAgICovCgoKICAgIGdldEFBQkIoYWFiYikgewogICAgICBjb25zdCB7CiAgICAgICAgbG93ZXJCb3VuZCwKICAgICAgICB1cHBlckJvdW5kCiAgICAgIH0gPSBhYWJiOwogICAgICBjb25zdCB0byA9IHRoaXMudG87CiAgICAgIGNvbnN0IGZyb20gPSB0aGlzLmZyb207CiAgICAgIGxvd2VyQm91bmQueCA9IE1hdGgubWluKHRvLngsIGZyb20ueCk7CiAgICAgIGxvd2VyQm91bmQueSA9IE1hdGgubWluKHRvLnksIGZyb20ueSk7CiAgICAgIGxvd2VyQm91bmQueiA9IE1hdGgubWluKHRvLnosIGZyb20ueik7CiAgICAgIHVwcGVyQm91bmQueCA9IE1hdGgubWF4KHRvLngsIGZyb20ueCk7CiAgICAgIHVwcGVyQm91bmQueSA9IE1hdGgubWF4KHRvLnksIGZyb20ueSk7CiAgICAgIHVwcGVyQm91bmQueiA9IE1hdGgubWF4KHRvLnosIGZyb20ueik7CiAgICB9CgogICAgX2ludGVyc2VjdEhlaWdodGZpZWxkKHNoYXBlLCBxdWF0LCBwb3NpdGlvbiwgYm9keSwgcmVwb3J0ZWRTaGFwZSkgewogICAgICBzaGFwZS5kYXRhOwogICAgICBzaGFwZS5lbGVtZW50U2l6ZTsgLy8gQ29udmVydCB0aGUgcmF5IHRvIGxvY2FsIGhlaWdodGZpZWxkIGNvb3JkaW5hdGVzCgogICAgICBjb25zdCBsb2NhbFJheSA9IGludGVyc2VjdEhlaWdodGZpZWxkX2xvY2FsUmF5OyAvL25ldyBSYXkodGhpcy5mcm9tLCB0aGlzLnRvKTsKCiAgICAgIGxvY2FsUmF5LmZyb20uY29weSh0aGlzLmZyb20pOwogICAgICBsb2NhbFJheS50by5jb3B5KHRoaXMudG8pOwogICAgICBUcmFuc2Zvcm0ucG9pbnRUb0xvY2FsRnJhbWUocG9zaXRpb24sIHF1YXQsIGxvY2FsUmF5LmZyb20sIGxvY2FsUmF5LmZyb20pOwogICAgICBUcmFuc2Zvcm0ucG9pbnRUb0xvY2FsRnJhbWUocG9zaXRpb24sIHF1YXQsIGxvY2FsUmF5LnRvLCBsb2NhbFJheS50byk7CiAgICAgIGxvY2FsUmF5LnVwZGF0ZURpcmVjdGlvbigpOyAvLyBHZXQgdGhlIGluZGV4IG9mIHRoZSBkYXRhIHBvaW50cyB0byB0ZXN0IGFnYWluc3QKCiAgICAgIGNvbnN0IGluZGV4ID0gaW50ZXJzZWN0SGVpZ2h0ZmllbGRfaW5kZXg7CiAgICAgIGxldCBpTWluWDsKICAgICAgbGV0IGlNaW5ZOwogICAgICBsZXQgaU1heFg7CiAgICAgIGxldCBpTWF4WTsgLy8gU2V0IHRvIG1heAoKICAgICAgaU1pblggPSBpTWluWSA9IDA7CiAgICAgIGlNYXhYID0gaU1heFkgPSBzaGFwZS5kYXRhLmxlbmd0aCAtIDE7CiAgICAgIGNvbnN0IGFhYmIgPSBuZXcgQUFCQigpOwogICAgICBsb2NhbFJheS5nZXRBQUJCKGFhYmIpOwogICAgICBzaGFwZS5nZXRJbmRleE9mUG9zaXRpb24oYWFiYi5sb3dlckJvdW5kLngsIGFhYmIubG93ZXJCb3VuZC55LCBpbmRleCwgdHJ1ZSk7CiAgICAgIGlNaW5YID0gTWF0aC5tYXgoaU1pblgsIGluZGV4WzBdKTsKICAgICAgaU1pblkgPSBNYXRoLm1heChpTWluWSwgaW5kZXhbMV0pOwogICAgICBzaGFwZS5nZXRJbmRleE9mUG9zaXRpb24oYWFiYi51cHBlckJvdW5kLngsIGFhYmIudXBwZXJCb3VuZC55LCBpbmRleCwgdHJ1ZSk7CiAgICAgIGlNYXhYID0gTWF0aC5taW4oaU1heFgsIGluZGV4WzBdICsgMSk7CiAgICAgIGlNYXhZID0gTWF0aC5taW4oaU1heFksIGluZGV4WzFdICsgMSk7CgogICAgICBmb3IgKGxldCBpID0gaU1pblg7IGkgPCBpTWF4WDsgaSsrKSB7CiAgICAgICAgZm9yIChsZXQgaiA9IGlNaW5ZOyBqIDwgaU1heFk7IGorKykgewogICAgICAgICAgaWYgKHRoaXMucmVzdWx0LnNob3VsZFN0b3ApIHsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgfQoKICAgICAgICAgIHNoYXBlLmdldEFhYmJBdEluZGV4KGksIGosIGFhYmIpOwoKICAgICAgICAgIGlmICghYWFiYi5vdmVybGFwc1JheShsb2NhbFJheSkpIHsKICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICB9IC8vIExvd2VyIHRyaWFuZ2xlCgoKICAgICAgICAgIHNoYXBlLmdldENvbnZleFRyaWFuZ2xlUGlsbGFyKGksIGosIGZhbHNlKTsKICAgICAgICAgIFRyYW5zZm9ybS5wb2ludFRvV29ybGRGcmFtZShwb3NpdGlvbiwgcXVhdCwgc2hhcGUucGlsbGFyT2Zmc2V0LCB3b3JsZFBpbGxhck9mZnNldCk7CgogICAgICAgICAgdGhpcy5faW50ZXJzZWN0Q29udmV4KHNoYXBlLnBpbGxhckNvbnZleCwgcXVhdCwgd29ybGRQaWxsYXJPZmZzZXQsIGJvZHksIHJlcG9ydGVkU2hhcGUsIGludGVyc2VjdENvbnZleE9wdGlvbnMpOwoKICAgICAgICAgIGlmICh0aGlzLnJlc3VsdC5zaG91bGRTdG9wKSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgIH0gLy8gVXBwZXIgdHJpYW5nbGUKCgogICAgICAgICAgc2hhcGUuZ2V0Q29udmV4VHJpYW5nbGVQaWxsYXIoaSwgaiwgdHJ1ZSk7CiAgICAgICAgICBUcmFuc2Zvcm0ucG9pbnRUb1dvcmxkRnJhbWUocG9zaXRpb24sIHF1YXQsIHNoYXBlLnBpbGxhck9mZnNldCwgd29ybGRQaWxsYXJPZmZzZXQpOwoKICAgICAgICAgIHRoaXMuX2ludGVyc2VjdENvbnZleChzaGFwZS5waWxsYXJDb252ZXgsIHF1YXQsIHdvcmxkUGlsbGFyT2Zmc2V0LCBib2R5LCByZXBvcnRlZFNoYXBlLCBpbnRlcnNlY3RDb252ZXhPcHRpb25zKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KCiAgICBfaW50ZXJzZWN0U3BoZXJlKHNwaGVyZSwgcXVhdCwgcG9zaXRpb24sIGJvZHksIHJlcG9ydGVkU2hhcGUpIHsKICAgICAgY29uc3QgZnJvbSA9IHRoaXMuZnJvbTsKICAgICAgY29uc3QgdG8gPSB0aGlzLnRvOwogICAgICBjb25zdCByID0gc3BoZXJlLnJhZGl1czsKICAgICAgY29uc3QgYSA9ICh0by54IC0gZnJvbS54KSAqKiAyICsgKHRvLnkgLSBmcm9tLnkpICoqIDIgKyAodG8ueiAtIGZyb20ueikgKiogMjsKICAgICAgY29uc3QgYiA9IDIgKiAoKHRvLnggLSBmcm9tLngpICogKGZyb20ueCAtIHBvc2l0aW9uLngpICsgKHRvLnkgLSBmcm9tLnkpICogKGZyb20ueSAtIHBvc2l0aW9uLnkpICsgKHRvLnogLSBmcm9tLnopICogKGZyb20ueiAtIHBvc2l0aW9uLnopKTsKICAgICAgY29uc3QgYyA9IChmcm9tLnggLSBwb3NpdGlvbi54KSAqKiAyICsgKGZyb20ueSAtIHBvc2l0aW9uLnkpICoqIDIgKyAoZnJvbS56IC0gcG9zaXRpb24ueikgKiogMiAtIHIgKiogMjsKICAgICAgY29uc3QgZGVsdGEgPSBiICoqIDIgLSA0ICogYSAqIGM7CiAgICAgIGNvbnN0IGludGVyc2VjdGlvblBvaW50ID0gUmF5X2ludGVyc2VjdFNwaGVyZV9pbnRlcnNlY3Rpb25Qb2ludDsKICAgICAgY29uc3Qgbm9ybWFsID0gUmF5X2ludGVyc2VjdFNwaGVyZV9ub3JtYWw7CgogICAgICBpZiAoZGVsdGEgPCAwKSB7CiAgICAgICAgLy8gTm8gaW50ZXJzZWN0aW9uCiAgICAgICAgcmV0dXJuOwogICAgICB9IGVsc2UgaWYgKGRlbHRhID09PSAwKSB7CiAgICAgICAgLy8gc2luZ2xlIGludGVyc2VjdGlvbiBwb2ludAogICAgICAgIGZyb20ubGVycCh0bywgZGVsdGEsIGludGVyc2VjdGlvblBvaW50KTsKICAgICAgICBpbnRlcnNlY3Rpb25Qb2ludC52c3ViKHBvc2l0aW9uLCBub3JtYWwpOwogICAgICAgIG5vcm1hbC5ub3JtYWxpemUoKTsKICAgICAgICB0aGlzLnJlcG9ydEludGVyc2VjdGlvbihub3JtYWwsIGludGVyc2VjdGlvblBvaW50LCByZXBvcnRlZFNoYXBlLCBib2R5LCAtMSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgY29uc3QgZDEgPSAoLWIgLSBNYXRoLnNxcnQoZGVsdGEpKSAvICgyICogYSk7CiAgICAgICAgY29uc3QgZDIgPSAoLWIgKyBNYXRoLnNxcnQoZGVsdGEpKSAvICgyICogYSk7CgogICAgICAgIGlmIChkMSA+PSAwICYmIGQxIDw9IDEpIHsKICAgICAgICAgIGZyb20ubGVycCh0bywgZDEsIGludGVyc2VjdGlvblBvaW50KTsKICAgICAgICAgIGludGVyc2VjdGlvblBvaW50LnZzdWIocG9zaXRpb24sIG5vcm1hbCk7CiAgICAgICAgICBub3JtYWwubm9ybWFsaXplKCk7CiAgICAgICAgICB0aGlzLnJlcG9ydEludGVyc2VjdGlvbihub3JtYWwsIGludGVyc2VjdGlvblBvaW50LCByZXBvcnRlZFNoYXBlLCBib2R5LCAtMSk7CiAgICAgICAgfQoKICAgICAgICBpZiAodGhpcy5yZXN1bHQuc2hvdWxkU3RvcCkgewogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgaWYgKGQyID49IDAgJiYgZDIgPD0gMSkgewogICAgICAgICAgZnJvbS5sZXJwKHRvLCBkMiwgaW50ZXJzZWN0aW9uUG9pbnQpOwogICAgICAgICAgaW50ZXJzZWN0aW9uUG9pbnQudnN1Yihwb3NpdGlvbiwgbm9ybWFsKTsKICAgICAgICAgIG5vcm1hbC5ub3JtYWxpemUoKTsKICAgICAgICAgIHRoaXMucmVwb3J0SW50ZXJzZWN0aW9uKG5vcm1hbCwgaW50ZXJzZWN0aW9uUG9pbnQsIHJlcG9ydGVkU2hhcGUsIGJvZHksIC0xKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KCiAgICBfaW50ZXJzZWN0Q29udmV4KHNoYXBlLCBxdWF0LCBwb3NpdGlvbiwgYm9keSwgcmVwb3J0ZWRTaGFwZSwgb3B0aW9ucykgewogICAgICBjb25zdCBub3JtYWwgPSBpbnRlcnNlY3RDb252ZXhfbm9ybWFsOwogICAgICBjb25zdCB2ZWN0b3IgPSBpbnRlcnNlY3RDb252ZXhfdmVjdG9yOwogICAgICBjb25zdCBmYWNlTGlzdCA9IG9wdGlvbnMgJiYgb3B0aW9ucy5mYWNlTGlzdCB8fCBudWxsOyAvLyBDaGVja2luZyBmYWNlcwoKICAgICAgY29uc3QgZmFjZXMgPSBzaGFwZS5mYWNlczsKICAgICAgY29uc3QgdmVydGljZXMgPSBzaGFwZS52ZXJ0aWNlczsKICAgICAgY29uc3Qgbm9ybWFscyA9IHNoYXBlLmZhY2VOb3JtYWxzOwogICAgICBjb25zdCBkaXJlY3Rpb24gPSB0aGlzLmRpcmVjdGlvbjsKICAgICAgY29uc3QgZnJvbSA9IHRoaXMuZnJvbTsKICAgICAgY29uc3QgdG8gPSB0aGlzLnRvOwogICAgICBjb25zdCBmcm9tVG9EaXN0YW5jZSA9IGZyb20uZGlzdGFuY2VUbyh0byk7CiAgICAgIGNvbnN0IE5mYWNlcyA9IGZhY2VMaXN0ID8gZmFjZUxpc3QubGVuZ3RoIDogZmFjZXMubGVuZ3RoOwogICAgICBjb25zdCByZXN1bHQgPSB0aGlzLnJlc3VsdDsKCiAgICAgIGZvciAobGV0IGogPSAwOyAhcmVzdWx0LnNob3VsZFN0b3AgJiYgaiA8IE5mYWNlczsgaisrKSB7CiAgICAgICAgY29uc3QgZmkgPSBmYWNlTGlzdCA/IGZhY2VMaXN0W2pdIDogajsKICAgICAgICBjb25zdCBmYWNlID0gZmFjZXNbZmldOwogICAgICAgIGNvbnN0IGZhY2VOb3JtYWwgPSBub3JtYWxzW2ZpXTsKICAgICAgICBjb25zdCBxID0gcXVhdDsKICAgICAgICBjb25zdCB4ID0gcG9zaXRpb247IC8vIGRldGVybWluZSBpZiByYXkgaW50ZXJzZWN0cyB0aGUgcGxhbmUgb2YgdGhlIGZhY2UKICAgICAgICAvLyBub3RlOiB0aGlzIHdvcmtzIHJlZ2FyZGxlc3Mgb2YgdGhlIGRpcmVjdGlvbiBvZiB0aGUgZmFjZSBub3JtYWwKICAgICAgICAvLyBHZXQgcGxhbmUgcG9pbnQgaW4gd29ybGQgY29vcmRpbmF0ZXMuLi4KCiAgICAgICAgdmVjdG9yLmNvcHkodmVydGljZXNbZmFjZVswXV0pOwogICAgICAgIHEudm11bHQodmVjdG9yLCB2ZWN0b3IpOwogICAgICAgIHZlY3Rvci52YWRkKHgsIHZlY3Rvcik7IC8vIC4uLmJ1dCBtYWtlIGl0IHJlbGF0aXZlIHRvIHRoZSByYXkgZnJvbS4gV2UnbGwgZml4IHRoaXMgbGF0ZXIuCgogICAgICAgIHZlY3Rvci52c3ViKGZyb20sIHZlY3Rvcik7IC8vIEdldCBwbGFuZSBub3JtYWwKCiAgICAgICAgcS52bXVsdChmYWNlTm9ybWFsLCBub3JtYWwpOyAvLyBJZiB0aGlzIGRvdCBwcm9kdWN0IGlzIG5lZ2F0aXZlLCB3ZSBoYXZlIHNvbWV0aGluZyBpbnRlcmVzdGluZwoKICAgICAgICBjb25zdCBkb3QgPSBkaXJlY3Rpb24uZG90KG5vcm1hbCk7IC8vIEJhaWwgb3V0IGlmIHJheSBhbmQgcGxhbmUgYXJlIHBhcmFsbGVsCgogICAgICAgIGlmIChNYXRoLmFicyhkb3QpIDwgdGhpcy5wcmVjaXNpb24pIHsKICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgIH0gLy8gY2FsYyBkaXN0YW5jZSB0byBwbGFuZQoKCiAgICAgICAgY29uc3Qgc2NhbGFyID0gbm9ybWFsLmRvdCh2ZWN0b3IpIC8gZG90OyAvLyBpZiBuZWdhdGl2ZSBkaXN0YW5jZSwgdGhlbiBwbGFuZSBpcyBiZWhpbmQgcmF5CgogICAgICAgIGlmIChzY2FsYXIgPCAwKSB7CiAgICAgICAgICBjb250aW51ZTsKICAgICAgICB9IC8vIGlmIChkb3QgPCAwKSB7CiAgICAgICAgLy8gSW50ZXJzZWN0aW9uIHBvaW50IGlzIGZyb20gKyBkaXJlY3Rpb24gKiBzY2FsYXIKCgogICAgICAgIGRpcmVjdGlvbi5zY2FsZShzY2FsYXIsIGludGVyc2VjdFBvaW50KTsKICAgICAgICBpbnRlcnNlY3RQb2ludC52YWRkKGZyb20sIGludGVyc2VjdFBvaW50KTsgLy8gYSBpcyB0aGUgcG9pbnQgd2UgY29tcGFyZSBwb2ludHMgYiBhbmQgYyB3aXRoLgoKICAgICAgICBhLmNvcHkodmVydGljZXNbZmFjZVswXV0pOwogICAgICAgIHEudm11bHQoYSwgYSk7CiAgICAgICAgeC52YWRkKGEsIGEpOwoKICAgICAgICBmb3IgKGxldCBpID0gMTsgIXJlc3VsdC5zaG91bGRTdG9wICYmIGkgPCBmYWNlLmxlbmd0aCAtIDE7IGkrKykgewogICAgICAgICAgLy8gVHJhbnNmb3JtIDMgdmVydGljZXMgdG8gd29ybGQgY29vcmRzCiAgICAgICAgICBiLmNvcHkodmVydGljZXNbZmFjZVtpXV0pOwogICAgICAgICAgYy5jb3B5KHZlcnRpY2VzW2ZhY2VbaSArIDFdXSk7CiAgICAgICAgICBxLnZtdWx0KGIsIGIpOwogICAgICAgICAgcS52bXVsdChjLCBjKTsKICAgICAgICAgIHgudmFkZChiLCBiKTsKICAgICAgICAgIHgudmFkZChjLCBjKTsKICAgICAgICAgIGNvbnN0IGRpc3RhbmNlID0gaW50ZXJzZWN0UG9pbnQuZGlzdGFuY2VUbyhmcm9tKTsKCiAgICAgICAgICBpZiAoIShSYXkucG9pbnRJblRyaWFuZ2xlKGludGVyc2VjdFBvaW50LCBhLCBiLCBjKSB8fCBSYXkucG9pbnRJblRyaWFuZ2xlKGludGVyc2VjdFBvaW50LCBiLCBhLCBjKSkgfHwgZGlzdGFuY2UgPiBmcm9tVG9EaXN0YW5jZSkgewogICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgIH0KCiAgICAgICAgICB0aGlzLnJlcG9ydEludGVyc2VjdGlvbihub3JtYWwsIGludGVyc2VjdFBvaW50LCByZXBvcnRlZFNoYXBlLCBib2R5LCBmaSk7CiAgICAgICAgfSAvLyB9CgogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIEB0b2RvIE9wdGltaXplIGJ5IHRyYW5zZm9ybWluZyB0aGUgd29ybGQgdG8gbG9jYWwgc3BhY2UgZmlyc3QuCiAgICAgKiBAdG9kbyBVc2UgT2N0cmVlIGxvb2t1cAogICAgICovCgoKICAgIF9pbnRlcnNlY3RUcmltZXNoKG1lc2gsIHF1YXQsIHBvc2l0aW9uLCBib2R5LCByZXBvcnRlZFNoYXBlLCBvcHRpb25zKSB7CiAgICAgIGNvbnN0IG5vcm1hbCA9IGludGVyc2VjdFRyaW1lc2hfbm9ybWFsOwogICAgICBjb25zdCB0cmlhbmdsZXMgPSBpbnRlcnNlY3RUcmltZXNoX3RyaWFuZ2xlczsKICAgICAgY29uc3QgdHJlZVRyYW5zZm9ybSA9IGludGVyc2VjdFRyaW1lc2hfdHJlZVRyYW5zZm9ybTsKICAgICAgY29uc3QgdmVjdG9yID0gaW50ZXJzZWN0Q29udmV4X3ZlY3RvcjsKICAgICAgY29uc3QgbG9jYWxEaXJlY3Rpb24gPSBpbnRlcnNlY3RUcmltZXNoX2xvY2FsRGlyZWN0aW9uOwogICAgICBjb25zdCBsb2NhbEZyb20gPSBpbnRlcnNlY3RUcmltZXNoX2xvY2FsRnJvbTsKICAgICAgY29uc3QgbG9jYWxUbyA9IGludGVyc2VjdFRyaW1lc2hfbG9jYWxUbzsKICAgICAgY29uc3Qgd29ybGRJbnRlcnNlY3RQb2ludCA9IGludGVyc2VjdFRyaW1lc2hfd29ybGRJbnRlcnNlY3RQb2ludDsKICAgICAgY29uc3Qgd29ybGROb3JtYWwgPSBpbnRlcnNlY3RUcmltZXNoX3dvcmxkTm9ybWFsOyAvLyBDaGVja2luZyBmYWNlcwoKICAgICAgY29uc3QgaW5kaWNlcyA9IG1lc2guaW5kaWNlczsKICAgICAgbWVzaC52ZXJ0aWNlczsgLy8gY29uc3Qgbm9ybWFscyA9IG1lc2guZmFjZU5vcm1hbHMKCiAgICAgIGNvbnN0IGZyb20gPSB0aGlzLmZyb207CiAgICAgIGNvbnN0IHRvID0gdGhpcy50bzsKICAgICAgY29uc3QgZGlyZWN0aW9uID0gdGhpcy5kaXJlY3Rpb247CiAgICAgIHRyZWVUcmFuc2Zvcm0ucG9zaXRpb24uY29weShwb3NpdGlvbik7CiAgICAgIHRyZWVUcmFuc2Zvcm0ucXVhdGVybmlvbi5jb3B5KHF1YXQpOyAvLyBUcmFuc2Zvcm0gcmF5IHRvIGxvY2FsIHNwYWNlIQoKICAgICAgVHJhbnNmb3JtLnZlY3RvclRvTG9jYWxGcmFtZShwb3NpdGlvbiwgcXVhdCwgZGlyZWN0aW9uLCBsb2NhbERpcmVjdGlvbik7CiAgICAgIFRyYW5zZm9ybS5wb2ludFRvTG9jYWxGcmFtZShwb3NpdGlvbiwgcXVhdCwgZnJvbSwgbG9jYWxGcm9tKTsKICAgICAgVHJhbnNmb3JtLnBvaW50VG9Mb2NhbEZyYW1lKHBvc2l0aW9uLCBxdWF0LCB0bywgbG9jYWxUbyk7CiAgICAgIGxvY2FsVG8ueCAqPSBtZXNoLnNjYWxlLng7CiAgICAgIGxvY2FsVG8ueSAqPSBtZXNoLnNjYWxlLnk7CiAgICAgIGxvY2FsVG8ueiAqPSBtZXNoLnNjYWxlLno7CiAgICAgIGxvY2FsRnJvbS54ICo9IG1lc2guc2NhbGUueDsKICAgICAgbG9jYWxGcm9tLnkgKj0gbWVzaC5zY2FsZS55OwogICAgICBsb2NhbEZyb20ueiAqPSBtZXNoLnNjYWxlLno7CiAgICAgIGxvY2FsVG8udnN1Yihsb2NhbEZyb20sIGxvY2FsRGlyZWN0aW9uKTsKICAgICAgbG9jYWxEaXJlY3Rpb24ubm9ybWFsaXplKCk7CiAgICAgIGNvbnN0IGZyb21Ub0Rpc3RhbmNlU3F1YXJlZCA9IGxvY2FsRnJvbS5kaXN0YW5jZVNxdWFyZWQobG9jYWxUbyk7CiAgICAgIG1lc2gudHJlZS5yYXlRdWVyeSh0aGlzLCB0cmVlVHJhbnNmb3JtLCB0cmlhbmdsZXMpOwoKICAgICAgZm9yIChsZXQgaSA9IDAsIE4gPSB0cmlhbmdsZXMubGVuZ3RoOyAhdGhpcy5yZXN1bHQuc2hvdWxkU3RvcCAmJiBpICE9PSBOOyBpKyspIHsKICAgICAgICBjb25zdCB0cmlhbmdsZXNJbmRleCA9IHRyaWFuZ2xlc1tpXTsKICAgICAgICBtZXNoLmdldE5vcm1hbCh0cmlhbmdsZXNJbmRleCwgbm9ybWFsKTsgLy8gZGV0ZXJtaW5lIGlmIHJheSBpbnRlcnNlY3RzIHRoZSBwbGFuZSBvZiB0aGUgZmFjZQogICAgICAgIC8vIG5vdGU6IHRoaXMgd29ya3MgcmVnYXJkbGVzcyBvZiB0aGUgZGlyZWN0aW9uIG9mIHRoZSBmYWNlIG5vcm1hbAogICAgICAgIC8vIEdldCBwbGFuZSBwb2ludCBpbiB3b3JsZCBjb29yZGluYXRlcy4uLgoKICAgICAgICBtZXNoLmdldFZlcnRleChpbmRpY2VzW3RyaWFuZ2xlc0luZGV4ICogM10sIGEpOyAvLyAuLi5idXQgbWFrZSBpdCByZWxhdGl2ZSB0byB0aGUgcmF5IGZyb20uIFdlJ2xsIGZpeCB0aGlzIGxhdGVyLgoKICAgICAgICBhLnZzdWIobG9jYWxGcm9tLCB2ZWN0b3IpOyAvLyBJZiB0aGlzIGRvdCBwcm9kdWN0IGlzIG5lZ2F0aXZlLCB3ZSBoYXZlIHNvbWV0aGluZyBpbnRlcmVzdGluZwoKICAgICAgICBjb25zdCBkb3QgPSBsb2NhbERpcmVjdGlvbi5kb3Qobm9ybWFsKTsgLy8gQmFpbCBvdXQgaWYgcmF5IGFuZCBwbGFuZSBhcmUgcGFyYWxsZWwKICAgICAgICAvLyBpZiAoTWF0aC5hYnMoIGRvdCApIDwgdGhpcy5wcmVjaXNpb24pewogICAgICAgIC8vICAgICBjb250aW51ZTsKICAgICAgICAvLyB9CiAgICAgICAgLy8gY2FsYyBkaXN0YW5jZSB0byBwbGFuZQoKICAgICAgICBjb25zdCBzY2FsYXIgPSBub3JtYWwuZG90KHZlY3RvcikgLyBkb3Q7IC8vIGlmIG5lZ2F0aXZlIGRpc3RhbmNlLCB0aGVuIHBsYW5lIGlzIGJlaGluZCByYXkKCiAgICAgICAgaWYgKHNjYWxhciA8IDApIHsKICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgIH0gLy8gSW50ZXJzZWN0aW9uIHBvaW50IGlzIGZyb20gKyBkaXJlY3Rpb24gKiBzY2FsYXIKCgogICAgICAgIGxvY2FsRGlyZWN0aW9uLnNjYWxlKHNjYWxhciwgaW50ZXJzZWN0UG9pbnQpOwogICAgICAgIGludGVyc2VjdFBvaW50LnZhZGQobG9jYWxGcm9tLCBpbnRlcnNlY3RQb2ludCk7IC8vIEdldCB0cmlhbmdsZSB2ZXJ0aWNlcwoKICAgICAgICBtZXNoLmdldFZlcnRleChpbmRpY2VzW3RyaWFuZ2xlc0luZGV4ICogMyArIDFdLCBiKTsKICAgICAgICBtZXNoLmdldFZlcnRleChpbmRpY2VzW3RyaWFuZ2xlc0luZGV4ICogMyArIDJdLCBjKTsKICAgICAgICBjb25zdCBzcXVhcmVkRGlzdGFuY2UgPSBpbnRlcnNlY3RQb2ludC5kaXN0YW5jZVNxdWFyZWQobG9jYWxGcm9tKTsKCiAgICAgICAgaWYgKCEoUmF5LnBvaW50SW5UcmlhbmdsZShpbnRlcnNlY3RQb2ludCwgYiwgYSwgYykgfHwgUmF5LnBvaW50SW5UcmlhbmdsZShpbnRlcnNlY3RQb2ludCwgYSwgYiwgYykpIHx8IHNxdWFyZWREaXN0YW5jZSA+IGZyb21Ub0Rpc3RhbmNlU3F1YXJlZCkgewogICAgICAgICAgY29udGludWU7CiAgICAgICAgfSAvLyB0cmFuc2Zvcm0gaW50ZXJzZWN0cG9pbnQgYW5kIG5vcm1hbCB0byB3b3JsZAoKCiAgICAgICAgVHJhbnNmb3JtLnZlY3RvclRvV29ybGRGcmFtZShxdWF0LCBub3JtYWwsIHdvcmxkTm9ybWFsKTsKICAgICAgICBUcmFuc2Zvcm0ucG9pbnRUb1dvcmxkRnJhbWUocG9zaXRpb24sIHF1YXQsIGludGVyc2VjdFBvaW50LCB3b3JsZEludGVyc2VjdFBvaW50KTsKICAgICAgICB0aGlzLnJlcG9ydEludGVyc2VjdGlvbih3b3JsZE5vcm1hbCwgd29ybGRJbnRlcnNlY3RQb2ludCwgcmVwb3J0ZWRTaGFwZSwgYm9keSwgdHJpYW5nbGVzSW5kZXgpOwogICAgICB9CgogICAgICB0cmlhbmdsZXMubGVuZ3RoID0gMDsKICAgIH0KICAgIC8qKgogICAgICogQHJldHVybiBUcnVlIGlmIHRoZSBpbnRlcnNlY3Rpb25zIHNob3VsZCBjb250aW51ZQogICAgICovCgoKICAgIHJlcG9ydEludGVyc2VjdGlvbihub3JtYWwsIGhpdFBvaW50V29ybGQsIHNoYXBlLCBib2R5LCBoaXRGYWNlSW5kZXgpIHsKICAgICAgY29uc3QgZnJvbSA9IHRoaXMuZnJvbTsKICAgICAgY29uc3QgdG8gPSB0aGlzLnRvOwogICAgICBjb25zdCBkaXN0YW5jZSA9IGZyb20uZGlzdGFuY2VUbyhoaXRQb2ludFdvcmxkKTsKICAgICAgY29uc3QgcmVzdWx0ID0gdGhpcy5yZXN1bHQ7IC8vIFNraXAgYmFjayBmYWNlcz8KCiAgICAgIGlmICh0aGlzLnNraXBCYWNrZmFjZXMgJiYgbm9ybWFsLmRvdCh0aGlzLmRpcmVjdGlvbikgPiAwKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICByZXN1bHQuaGl0RmFjZUluZGV4ID0gdHlwZW9mIGhpdEZhY2VJbmRleCAhPT0gJ3VuZGVmaW5lZCcgPyBoaXRGYWNlSW5kZXggOiAtMTsKCiAgICAgIHN3aXRjaCAodGhpcy5tb2RlKSB7CiAgICAgICAgY2FzZSBSYXkuQUxMOgogICAgICAgICAgdGhpcy5oYXNIaXQgPSB0cnVlOwogICAgICAgICAgcmVzdWx0LnNldChmcm9tLCB0bywgbm9ybWFsLCBoaXRQb2ludFdvcmxkLCBzaGFwZSwgYm9keSwgZGlzdGFuY2UpOwogICAgICAgICAgcmVzdWx0Lmhhc0hpdCA9IHRydWU7CiAgICAgICAgICB0aGlzLmNhbGxiYWNrKHJlc3VsdCk7CiAgICAgICAgICBicmVhazsKCiAgICAgICAgY2FzZSBSYXkuQ0xPU0VTVDoKICAgICAgICAgIC8vIFN0b3JlIGlmIGNsb3NlciB0aGFuIGN1cnJlbnQgY2xvc2VzdAogICAgICAgICAgaWYgKGRpc3RhbmNlIDwgcmVzdWx0LmRpc3RhbmNlIHx8ICFyZXN1bHQuaGFzSGl0KSB7CiAgICAgICAgICAgIHRoaXMuaGFzSGl0ID0gdHJ1ZTsKICAgICAgICAgICAgcmVzdWx0Lmhhc0hpdCA9IHRydWU7CiAgICAgICAgICAgIHJlc3VsdC5zZXQoZnJvbSwgdG8sIG5vcm1hbCwgaGl0UG9pbnRXb3JsZCwgc2hhcGUsIGJvZHksIGRpc3RhbmNlKTsKICAgICAgICAgIH0KCiAgICAgICAgICBicmVhazsKCiAgICAgICAgY2FzZSBSYXkuQU5ZOgogICAgICAgICAgLy8gUmVwb3J0IGFuZCBzdG9wLgogICAgICAgICAgdGhpcy5oYXNIaXQgPSB0cnVlOwogICAgICAgICAgcmVzdWx0Lmhhc0hpdCA9IHRydWU7CiAgICAgICAgICByZXN1bHQuc2V0KGZyb20sIHRvLCBub3JtYWwsIGhpdFBvaW50V29ybGQsIHNoYXBlLCBib2R5LCBkaXN0YW5jZSk7CiAgICAgICAgICByZXN1bHQuc2hvdWxkU3RvcCA9IHRydWU7CiAgICAgICAgICBicmVhazsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBBcyBwZXIgIkJhcnljZW50cmljIFRlY2huaXF1ZSIgYXMgbmFtZWQKICAgICAqIHtAbGluayBodHRwczovL3d3dy5ibGFja3Bhd24uY29tL3RleHRzL3BvaW50aW5wb2x5L2RlZmF1bHQuaHRtbCBoZXJlfSBidXQgd2l0aG91dCB0aGUgZGl2aXNpb24KICAgICAqLwoKCiAgICBzdGF0aWMgcG9pbnRJblRyaWFuZ2xlKHAsIGEsIGIsIGMpIHsKICAgICAgYy52c3ViKGEsIHYwKTsKICAgICAgYi52c3ViKGEsIHYxKTsKICAgICAgcC52c3ViKGEsIHYyKTsKICAgICAgY29uc3QgZG90MDAgPSB2MC5kb3QodjApOwogICAgICBjb25zdCBkb3QwMSA9IHYwLmRvdCh2MSk7CiAgICAgIGNvbnN0IGRvdDAyID0gdjAuZG90KHYyKTsKICAgICAgY29uc3QgZG90MTEgPSB2MS5kb3QodjEpOwogICAgICBjb25zdCBkb3QxMiA9IHYxLmRvdCh2Mik7CiAgICAgIGxldCB1OwogICAgICBsZXQgdjsKICAgICAgcmV0dXJuICh1ID0gZG90MTEgKiBkb3QwMiAtIGRvdDAxICogZG90MTIpID49IDAgJiYgKHYgPSBkb3QwMCAqIGRvdDEyIC0gZG90MDEgKiBkb3QwMikgPj0gMCAmJiB1ICsgdiA8IGRvdDAwICogZG90MTEgLSBkb3QwMSAqIGRvdDAxOwogICAgfQoKICB9CiAgUmF5LkNMT1NFU1QgPSBSQVlfTU9ERVMuQ0xPU0VTVDsKICBSYXkuQU5ZID0gUkFZX01PREVTLkFOWTsKICBSYXkuQUxMID0gUkFZX01PREVTLkFMTDsKICBjb25zdCB0bXBBQUJCJDEgPSBuZXcgQUFCQigpOwogIGNvbnN0IHRtcEFycmF5ID0gW107CiAgY29uc3QgdjEgPSBuZXcgVmVjMygpOwogIGNvbnN0IHYyID0gbmV3IFZlYzMoKTsKICBjb25zdCBpbnRlcnNlY3RCb2R5X3hpID0gbmV3IFZlYzMoKTsKICBjb25zdCBpbnRlcnNlY3RCb2R5X3FpID0gbmV3IFF1YXRlcm5pb24oKTsKICBjb25zdCBpbnRlcnNlY3RQb2ludCA9IG5ldyBWZWMzKCk7CiAgY29uc3QgYSA9IG5ldyBWZWMzKCk7CiAgY29uc3QgYiA9IG5ldyBWZWMzKCk7CiAgY29uc3QgYyA9IG5ldyBWZWMzKCk7CiAgbmV3IFZlYzMoKTsKICBuZXcgUmF5Y2FzdFJlc3VsdCgpOwogIGNvbnN0IGludGVyc2VjdENvbnZleE9wdGlvbnMgPSB7CiAgICBmYWNlTGlzdDogWzBdCiAgfTsKICBjb25zdCB3b3JsZFBpbGxhck9mZnNldCA9IG5ldyBWZWMzKCk7CiAgY29uc3QgaW50ZXJzZWN0SGVpZ2h0ZmllbGRfbG9jYWxSYXkgPSBuZXcgUmF5KCk7CiAgY29uc3QgaW50ZXJzZWN0SGVpZ2h0ZmllbGRfaW5kZXggPSBbXTsKICBjb25zdCBSYXlfaW50ZXJzZWN0U3BoZXJlX2ludGVyc2VjdGlvblBvaW50ID0gbmV3IFZlYzMoKTsKICBjb25zdCBSYXlfaW50ZXJzZWN0U3BoZXJlX25vcm1hbCA9IG5ldyBWZWMzKCk7CiAgY29uc3QgaW50ZXJzZWN0Q29udmV4X25vcm1hbCA9IG5ldyBWZWMzKCk7CiAgbmV3IFZlYzMoKTsKICBuZXcgVmVjMygpOwogIGNvbnN0IGludGVyc2VjdENvbnZleF92ZWN0b3IgPSBuZXcgVmVjMygpOwogIGNvbnN0IGludGVyc2VjdFRyaW1lc2hfbm9ybWFsID0gbmV3IFZlYzMoKTsKICBjb25zdCBpbnRlcnNlY3RUcmltZXNoX2xvY2FsRGlyZWN0aW9uID0gbmV3IFZlYzMoKTsKICBjb25zdCBpbnRlcnNlY3RUcmltZXNoX2xvY2FsRnJvbSA9IG5ldyBWZWMzKCk7CiAgY29uc3QgaW50ZXJzZWN0VHJpbWVzaF9sb2NhbFRvID0gbmV3IFZlYzMoKTsKICBjb25zdCBpbnRlcnNlY3RUcmltZXNoX3dvcmxkTm9ybWFsID0gbmV3IFZlYzMoKTsKICBjb25zdCBpbnRlcnNlY3RUcmltZXNoX3dvcmxkSW50ZXJzZWN0UG9pbnQgPSBuZXcgVmVjMygpOwogIG5ldyBBQUJCKCk7CiAgY29uc3QgaW50ZXJzZWN0VHJpbWVzaF90cmlhbmdsZXMgPSBbXTsKICBjb25zdCBpbnRlcnNlY3RUcmltZXNoX3RyZWVUcmFuc2Zvcm0gPSBuZXcgVHJhbnNmb3JtKCk7CiAgY29uc3QgdjAgPSBuZXcgVmVjMygpOwogIGNvbnN0IGludGVyc2VjdCA9IG5ldyBWZWMzKCk7CgogIGZ1bmN0aW9uIGRpc3RhbmNlRnJvbUludGVyc2VjdGlvbihmcm9tLCBkaXJlY3Rpb24sIHBvc2l0aW9uKSB7CiAgICAvLyB2MCBpcyB2ZWN0b3IgZnJvbSBmcm9tIHRvIHBvc2l0aW9uCiAgICBwb3NpdGlvbi52c3ViKGZyb20sIHYwKTsKICAgIGNvbnN0IGRvdCA9IHYwLmRvdChkaXJlY3Rpb24pOyAvLyBpbnRlcnNlY3QgPSBkaXJlY3Rpb24qZG90ICsgZnJvbQoKICAgIGRpcmVjdGlvbi5zY2FsZShkb3QsIGludGVyc2VjdCk7CiAgICBpbnRlcnNlY3QudmFkZChmcm9tLCBpbnRlcnNlY3QpOwogICAgY29uc3QgZGlzdGFuY2UgPSBwb3NpdGlvbi5kaXN0YW5jZVRvKGludGVyc2VjdCk7CiAgICByZXR1cm4gZGlzdGFuY2U7CiAgfQoKICAvKioKICAgKiBTd2VlcCBhbmQgcHJ1bmUgYnJvYWRwaGFzZSBhbG9uZyBvbmUgYXhpcy4KICAgKi8KICBjbGFzcyBTQVBCcm9hZHBoYXNlIGV4dGVuZHMgQnJvYWRwaGFzZSB7CiAgICAvKioKICAgICAqIExpc3Qgb2YgYm9kaWVzIGN1cnJlbnRseSBpbiB0aGUgYnJvYWRwaGFzZS4KICAgICAqLwoKICAgIC8qKgogICAgICogVGhlIHdvcmxkIHRvIHNlYXJjaCBpbi4KICAgICAqLwoKICAgIC8qKgogICAgICogQXhpcyB0byBzb3J0IHRoZSBib2RpZXMgYWxvbmcuCiAgICAgKiBTZXQgdG8gMCBmb3IgeCBheGlzLCBhbmQgMSBmb3IgeSBheGlzLgogICAgICogRm9yIGJlc3QgcGVyZm9ybWFuY2UsIHBpY2sgdGhlIGF4aXMgd2hlcmUgYm9kaWVzIGFyZSBtb3N0IGRpc3RyaWJ1dGVkLgogICAgICovCgogICAgLyoqCiAgICAgKiBDaGVjayBpZiB0aGUgYm91bmRzIG9mIHR3byBib2RpZXMgb3ZlcmxhcCwgYWxvbmcgdGhlIGdpdmVuIFNBUCBheGlzLgogICAgICovCiAgICBzdGF0aWMgY2hlY2tCb3VuZHMoYmksIGJqLCBheGlzSW5kZXgpIHsKICAgICAgbGV0IGJpUG9zOwogICAgICBsZXQgYmpQb3M7CgogICAgICBpZiAoYXhpc0luZGV4ID09PSAwKSB7CiAgICAgICAgYmlQb3MgPSBiaS5wb3NpdGlvbi54OwogICAgICAgIGJqUG9zID0gYmoucG9zaXRpb24ueDsKICAgICAgfSBlbHNlIGlmIChheGlzSW5kZXggPT09IDEpIHsKICAgICAgICBiaVBvcyA9IGJpLnBvc2l0aW9uLnk7CiAgICAgICAgYmpQb3MgPSBiai5wb3NpdGlvbi55OwogICAgICB9IGVsc2UgaWYgKGF4aXNJbmRleCA9PT0gMikgewogICAgICAgIGJpUG9zID0gYmkucG9zaXRpb24uejsKICAgICAgICBialBvcyA9IGJqLnBvc2l0aW9uLno7CiAgICAgIH0KCiAgICAgIGNvbnN0IHJpID0gYmkuYm91bmRpbmdSYWRpdXMsCiAgICAgICAgICAgIHJqID0gYmouYm91bmRpbmdSYWRpdXMsCiAgICAgICAgICAgIGJvdW5kQTIgPSBiaVBvcyArIHJpLAogICAgICAgICAgICBib3VuZEIxID0gYmpQb3MgLSByajsKICAgICAgcmV0dXJuIGJvdW5kQjEgPCBib3VuZEEyOwogICAgfSAvLyBOb3RlOiB0aGVzZSBhcmUgaWRlbnRpY2FsLCBzYXZlIGZvciB4L3kveiBsb3dlcmJvdW5kCgogICAgLyoqCiAgICAgKiBpbnNlcnRpb25Tb3J0WAogICAgICovCgoKICAgIHN0YXRpYyBpbnNlcnRpb25Tb3J0WChhKSB7CiAgICAgIGZvciAobGV0IGkgPSAxLCBsID0gYS5sZW5ndGg7IGkgPCBsOyBpKyspIHsKICAgICAgICBjb25zdCB2ID0gYVtpXTsKICAgICAgICBsZXQgajsKCiAgICAgICAgZm9yIChqID0gaSAtIDE7IGogPj0gMDsgai0tKSB7CiAgICAgICAgICBpZiAoYVtqXS5hYWJiLmxvd2VyQm91bmQueCA8PSB2LmFhYmIubG93ZXJCb3VuZC54KSB7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgfQoKICAgICAgICAgIGFbaiArIDFdID0gYVtqXTsKICAgICAgICB9CgogICAgICAgIGFbaiArIDFdID0gdjsKICAgICAgfQoKICAgICAgcmV0dXJuIGE7CiAgICB9CiAgICAvKioKICAgICAqIGluc2VydGlvblNvcnRZCiAgICAgKi8KCgogICAgc3RhdGljIGluc2VydGlvblNvcnRZKGEpIHsKICAgICAgZm9yIChsZXQgaSA9IDEsIGwgPSBhLmxlbmd0aDsgaSA8IGw7IGkrKykgewogICAgICAgIGNvbnN0IHYgPSBhW2ldOwogICAgICAgIGxldCBqOwoKICAgICAgICBmb3IgKGogPSBpIC0gMTsgaiA+PSAwOyBqLS0pIHsKICAgICAgICAgIGlmIChhW2pdLmFhYmIubG93ZXJCb3VuZC55IDw9IHYuYWFiYi5sb3dlckJvdW5kLnkpIHsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CgogICAgICAgICAgYVtqICsgMV0gPSBhW2pdOwogICAgICAgIH0KCiAgICAgICAgYVtqICsgMV0gPSB2OwogICAgICB9CgogICAgICByZXR1cm4gYTsKICAgIH0KICAgIC8qKgogICAgICogaW5zZXJ0aW9uU29ydFoKICAgICAqLwoKCiAgICBzdGF0aWMgaW5zZXJ0aW9uU29ydFooYSkgewogICAgICBmb3IgKGxldCBpID0gMSwgbCA9IGEubGVuZ3RoOyBpIDwgbDsgaSsrKSB7CiAgICAgICAgY29uc3QgdiA9IGFbaV07CiAgICAgICAgbGV0IGo7CgogICAgICAgIGZvciAoaiA9IGkgLSAxOyBqID49IDA7IGotLSkgewogICAgICAgICAgaWYgKGFbal0uYWFiYi5sb3dlckJvdW5kLnogPD0gdi5hYWJiLmxvd2VyQm91bmQueikgewogICAgICAgICAgICBicmVhazsKICAgICAgICAgIH0KCiAgICAgICAgICBhW2ogKyAxXSA9IGFbal07CiAgICAgICAgfQoKICAgICAgICBhW2ogKyAxXSA9IHY7CiAgICAgIH0KCiAgICAgIHJldHVybiBhOwogICAgfQoKICAgIGNvbnN0cnVjdG9yKHdvcmxkKSB7CiAgICAgIHN1cGVyKCk7CiAgICAgIHRoaXMuYXhpc0xpc3QgPSBbXTsKICAgICAgdGhpcy53b3JsZCA9IG51bGw7CiAgICAgIHRoaXMuYXhpc0luZGV4ID0gMDsKICAgICAgY29uc3QgYXhpc0xpc3QgPSB0aGlzLmF4aXNMaXN0OwoKICAgICAgdGhpcy5fYWRkQm9keUhhbmRsZXIgPSBldmVudCA9PiB7CiAgICAgICAgYXhpc0xpc3QucHVzaChldmVudC5ib2R5KTsKICAgICAgfTsKCiAgICAgIHRoaXMuX3JlbW92ZUJvZHlIYW5kbGVyID0gZXZlbnQgPT4gewogICAgICAgIGNvbnN0IGlkeCA9IGF4aXNMaXN0LmluZGV4T2YoZXZlbnQuYm9keSk7CgogICAgICAgIGlmIChpZHggIT09IC0xKSB7CiAgICAgICAgICBheGlzTGlzdC5zcGxpY2UoaWR4LCAxKTsKICAgICAgICB9CiAgICAgIH07CgogICAgICBpZiAod29ybGQpIHsKICAgICAgICB0aGlzLnNldFdvcmxkKHdvcmxkKTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBDaGFuZ2UgdGhlIHdvcmxkCiAgICAgKi8KCgogICAgc2V0V29ybGQod29ybGQpIHsKICAgICAgLy8gQ2xlYXIgdGhlIG9sZCBheGlzIGFycmF5CiAgICAgIHRoaXMuYXhpc0xpc3QubGVuZ3RoID0gMDsgLy8gQWRkIGFsbCBib2RpZXMgZnJvbSB0aGUgbmV3IHdvcmxkCgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHdvcmxkLmJvZGllcy5sZW5ndGg7IGkrKykgewogICAgICAgIHRoaXMuYXhpc0xpc3QucHVzaCh3b3JsZC5ib2RpZXNbaV0pOwogICAgICB9IC8vIFJlbW92ZSBvbGQgaGFuZGxlcnMsIGlmIGFueQoKCiAgICAgIHdvcmxkLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2FkZEJvZHknLCB0aGlzLl9hZGRCb2R5SGFuZGxlcik7CiAgICAgIHdvcmxkLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ3JlbW92ZUJvZHknLCB0aGlzLl9yZW1vdmVCb2R5SGFuZGxlcik7IC8vIEFkZCBoYW5kbGVycyB0byB1cGRhdGUgdGhlIGxpc3Qgb2YgYm9kaWVzLgoKICAgICAgd29ybGQuYWRkRXZlbnRMaXN0ZW5lcignYWRkQm9keScsIHRoaXMuX2FkZEJvZHlIYW5kbGVyKTsKICAgICAgd29ybGQuYWRkRXZlbnRMaXN0ZW5lcigncmVtb3ZlQm9keScsIHRoaXMuX3JlbW92ZUJvZHlIYW5kbGVyKTsKICAgICAgdGhpcy53b3JsZCA9IHdvcmxkOwogICAgICB0aGlzLmRpcnR5ID0gdHJ1ZTsKICAgIH0KICAgIC8qKgogICAgICogQ29sbGVjdCBhbGwgY29sbGlzaW9uIHBhaXJzCiAgICAgKi8KCgogICAgY29sbGlzaW9uUGFpcnMod29ybGQsIHAxLCBwMikgewogICAgICBjb25zdCBib2RpZXMgPSB0aGlzLmF4aXNMaXN0OwogICAgICBjb25zdCBOID0gYm9kaWVzLmxlbmd0aDsKICAgICAgY29uc3QgYXhpc0luZGV4ID0gdGhpcy5heGlzSW5kZXg7CiAgICAgIGxldCBpOwogICAgICBsZXQgajsKCiAgICAgIGlmICh0aGlzLmRpcnR5KSB7CiAgICAgICAgdGhpcy5zb3J0TGlzdCgpOwogICAgICAgIHRoaXMuZGlydHkgPSBmYWxzZTsKICAgICAgfSAvLyBMb29rIHRocm91Z2ggdGhlIGxpc3QKCgogICAgICBmb3IgKGkgPSAwOyBpICE9PSBOOyBpKyspIHsKICAgICAgICBjb25zdCBiaSA9IGJvZGllc1tpXTsKCiAgICAgICAgZm9yIChqID0gaSArIDE7IGogPCBOOyBqKyspIHsKICAgICAgICAgIGNvbnN0IGJqID0gYm9kaWVzW2pdOwoKICAgICAgICAgIGlmICghdGhpcy5uZWVkQnJvYWRwaGFzZUNvbGxpc2lvbihiaSwgYmopKSB7CiAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgfQoKICAgICAgICAgIGlmICghU0FQQnJvYWRwaGFzZS5jaGVja0JvdW5kcyhiaSwgYmosIGF4aXNJbmRleCkpIHsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CgogICAgICAgICAgdGhpcy5pbnRlcnNlY3Rpb25UZXN0KGJpLCBiaiwgcDEsIHAyKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KCiAgICBzb3J0TGlzdCgpIHsKICAgICAgY29uc3QgYXhpc0xpc3QgPSB0aGlzLmF4aXNMaXN0OwogICAgICBjb25zdCBheGlzSW5kZXggPSB0aGlzLmF4aXNJbmRleDsKICAgICAgY29uc3QgTiA9IGF4aXNMaXN0Lmxlbmd0aDsgLy8gVXBkYXRlIEFBQkJzCgogICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gTjsgaSsrKSB7CiAgICAgICAgY29uc3QgYmkgPSBheGlzTGlzdFtpXTsKCiAgICAgICAgaWYgKGJpLmFhYmJOZWVkc1VwZGF0ZSkgewogICAgICAgICAgYmkudXBkYXRlQUFCQigpOwogICAgICAgIH0KICAgICAgfSAvLyBTb3J0IHRoZSBsaXN0CgoKICAgICAgaWYgKGF4aXNJbmRleCA9PT0gMCkgewogICAgICAgIFNBUEJyb2FkcGhhc2UuaW5zZXJ0aW9uU29ydFgoYXhpc0xpc3QpOwogICAgICB9IGVsc2UgaWYgKGF4aXNJbmRleCA9PT0gMSkgewogICAgICAgIFNBUEJyb2FkcGhhc2UuaW5zZXJ0aW9uU29ydFkoYXhpc0xpc3QpOwogICAgICB9IGVsc2UgaWYgKGF4aXNJbmRleCA9PT0gMikgewogICAgICAgIFNBUEJyb2FkcGhhc2UuaW5zZXJ0aW9uU29ydFooYXhpc0xpc3QpOwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIENvbXB1dGVzIHRoZSB2YXJpYW5jZSBvZiB0aGUgYm9keSBwb3NpdGlvbnMgYW5kIGVzdGltYXRlcyB0aGUgYmVzdCBheGlzIHRvIHVzZS4KICAgICAqIFdpbGwgYXV0b21hdGljYWxseSBzZXQgcHJvcGVydHkgYGF4aXNJbmRleGAuCiAgICAgKi8KCgogICAgYXV0b0RldGVjdEF4aXMoKSB7CiAgICAgIGxldCBzdW1YID0gMDsKICAgICAgbGV0IHN1bVgyID0gMDsKICAgICAgbGV0IHN1bVkgPSAwOwogICAgICBsZXQgc3VtWTIgPSAwOwogICAgICBsZXQgc3VtWiA9IDA7CiAgICAgIGxldCBzdW1aMiA9IDA7CiAgICAgIGNvbnN0IGJvZGllcyA9IHRoaXMuYXhpc0xpc3Q7CiAgICAgIGNvbnN0IE4gPSBib2RpZXMubGVuZ3RoOwogICAgICBjb25zdCBpbnZOID0gMSAvIE47CgogICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gTjsgaSsrKSB7CiAgICAgICAgY29uc3QgYiA9IGJvZGllc1tpXTsKICAgICAgICBjb25zdCBjZW50ZXJYID0gYi5wb3NpdGlvbi54OwogICAgICAgIHN1bVggKz0gY2VudGVyWDsKICAgICAgICBzdW1YMiArPSBjZW50ZXJYICogY2VudGVyWDsKICAgICAgICBjb25zdCBjZW50ZXJZID0gYi5wb3NpdGlvbi55OwogICAgICAgIHN1bVkgKz0gY2VudGVyWTsKICAgICAgICBzdW1ZMiArPSBjZW50ZXJZICogY2VudGVyWTsKICAgICAgICBjb25zdCBjZW50ZXJaID0gYi5wb3NpdGlvbi56OwogICAgICAgIHN1bVogKz0gY2VudGVyWjsKICAgICAgICBzdW1aMiArPSBjZW50ZXJaICogY2VudGVyWjsKICAgICAgfQoKICAgICAgY29uc3QgdmFyaWFuY2VYID0gc3VtWDIgLSBzdW1YICogc3VtWCAqIGludk47CiAgICAgIGNvbnN0IHZhcmlhbmNlWSA9IHN1bVkyIC0gc3VtWSAqIHN1bVkgKiBpbnZOOwogICAgICBjb25zdCB2YXJpYW5jZVogPSBzdW1aMiAtIHN1bVogKiBzdW1aICogaW52TjsKCiAgICAgIGlmICh2YXJpYW5jZVggPiB2YXJpYW5jZVkpIHsKICAgICAgICBpZiAodmFyaWFuY2VYID4gdmFyaWFuY2VaKSB7CiAgICAgICAgICB0aGlzLmF4aXNJbmRleCA9IDA7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHRoaXMuYXhpc0luZGV4ID0gMjsKICAgICAgICB9CiAgICAgIH0gZWxzZSBpZiAodmFyaWFuY2VZID4gdmFyaWFuY2VaKSB7CiAgICAgICAgdGhpcy5heGlzSW5kZXggPSAxOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuYXhpc0luZGV4ID0gMjsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBSZXR1cm5zIGFsbCB0aGUgYm9kaWVzIHdpdGhpbiBhbiBBQUJCLgogICAgICogQHBhcmFtIHJlc3VsdCBBbiBhcnJheSB0byBzdG9yZSByZXN1bHRpbmcgYm9kaWVzIGluLgogICAgICovCgoKICAgIGFhYmJRdWVyeSh3b3JsZCwgYWFiYiwgcmVzdWx0KSB7CiAgICAgIGlmIChyZXN1bHQgPT09IHZvaWQgMCkgewogICAgICAgIHJlc3VsdCA9IFtdOwogICAgICB9CgogICAgICBpZiAodGhpcy5kaXJ0eSkgewogICAgICAgIHRoaXMuc29ydExpc3QoKTsKICAgICAgICB0aGlzLmRpcnR5ID0gZmFsc2U7CiAgICAgIH0KCiAgICAgIGNvbnN0IGF4aXNJbmRleCA9IHRoaXMuYXhpc0luZGV4OwogICAgICBsZXQgYXhpcyA9ICd4JzsKCiAgICAgIGlmIChheGlzSW5kZXggPT09IDEpIHsKICAgICAgICBheGlzID0gJ3knOwogICAgICB9CgogICAgICBpZiAoYXhpc0luZGV4ID09PSAyKSB7CiAgICAgICAgYXhpcyA9ICd6JzsKICAgICAgfQoKICAgICAgY29uc3QgYXhpc0xpc3QgPSB0aGlzLmF4aXNMaXN0OwogICAgICBhYWJiLmxvd2VyQm91bmRbYXhpc107CiAgICAgIGFhYmIudXBwZXJCb3VuZFtheGlzXTsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgYXhpc0xpc3QubGVuZ3RoOyBpKyspIHsKICAgICAgICBjb25zdCBiID0gYXhpc0xpc3RbaV07CgogICAgICAgIGlmIChiLmFhYmJOZWVkc1VwZGF0ZSkgewogICAgICAgICAgYi51cGRhdGVBQUJCKCk7CiAgICAgICAgfQoKICAgICAgICBpZiAoYi5hYWJiLm92ZXJsYXBzKGFhYmIpKSB7CiAgICAgICAgICByZXN1bHQucHVzaChiKTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIHJldHVybiByZXN1bHQ7CiAgICB9CgogIH0KCiAgY2xhc3MgVXRpbHMgewogICAgLyoqCiAgICAgKiBFeHRlbmQgYW4gb3B0aW9ucyBvYmplY3Qgd2l0aCBkZWZhdWx0IHZhbHVlcy4KICAgICAqIEBwYXJhbSBvcHRpb25zIFRoZSBvcHRpb25zIG9iamVjdC4gTWF5IGJlIGZhbHN5OiBpbiB0aGlzIGNhc2UsIGEgbmV3IG9iamVjdCBpcyBjcmVhdGVkIGFuZCByZXR1cm5lZC4KICAgICAqIEBwYXJhbSBkZWZhdWx0cyBBbiBvYmplY3QgY29udGFpbmluZyBkZWZhdWx0IHZhbHVlcy4KICAgICAqIEByZXR1cm4gVGhlIG1vZGlmaWVkIG9wdGlvbnMgb2JqZWN0LgogICAgICovCiAgICBzdGF0aWMgZGVmYXVsdHMob3B0aW9ucywgZGVmYXVsdHMpIHsKICAgICAgaWYgKG9wdGlvbnMgPT09IHZvaWQgMCkgewogICAgICAgIG9wdGlvbnMgPSB7fTsKICAgICAgfQoKICAgICAgZm9yIChsZXQga2V5IGluIGRlZmF1bHRzKSB7CiAgICAgICAgaWYgKCEoa2V5IGluIG9wdGlvbnMpKSB7CiAgICAgICAgICBvcHRpb25zW2tleV0gPSBkZWZhdWx0c1trZXldOwogICAgICAgIH0KICAgICAgfQoKICAgICAgcmV0dXJuIG9wdGlvbnM7CiAgICB9CgogIH0KCiAgLyoqCiAgICogQ29uc3RyYWludCBiYXNlIGNsYXNzCiAgICovCiAgY2xhc3MgQ29uc3RyYWludCB7CiAgICAvKioKICAgICAqIEVxdWF0aW9ucyB0byBiZSBzb2x2ZWQgaW4gdGhpcyBjb25zdHJhaW50LgogICAgICovCgogICAgLyoqCiAgICAgKiBCb2R5IEEuCiAgICAgKi8KCiAgICAvKioKICAgICAqIEJvZHkgQi4KICAgICAqLwoKICAgIC8qKgogICAgICogU2V0IHRvIGZhbHNlIGlmIHlvdSBkb24ndCB3YW50IHRoZSBib2RpZXMgdG8gY29sbGlkZSB3aGVuIHRoZXkgYXJlIGNvbm5lY3RlZC4KICAgICAqLwogICAgY29uc3RydWN0b3IoYm9keUEsIGJvZHlCLCBvcHRpb25zKSB7CiAgICAgIGlmIChvcHRpb25zID09PSB2b2lkIDApIHsKICAgICAgICBvcHRpb25zID0ge307CiAgICAgIH0KCiAgICAgIG9wdGlvbnMgPSBVdGlscy5kZWZhdWx0cyhvcHRpb25zLCB7CiAgICAgICAgY29sbGlkZUNvbm5lY3RlZDogdHJ1ZSwKICAgICAgICB3YWtlVXBCb2RpZXM6IHRydWUKICAgICAgfSk7CiAgICAgIHRoaXMuZXF1YXRpb25zID0gW107CiAgICAgIHRoaXMuYm9keUEgPSBib2R5QTsKICAgICAgdGhpcy5ib2R5QiA9IGJvZHlCOwogICAgICB0aGlzLmlkID0gQ29uc3RyYWludC5pZENvdW50ZXIrKzsKICAgICAgdGhpcy5jb2xsaWRlQ29ubmVjdGVkID0gb3B0aW9ucy5jb2xsaWRlQ29ubmVjdGVkOwoKICAgICAgaWYgKG9wdGlvbnMud2FrZVVwQm9kaWVzKSB7CiAgICAgICAgaWYgKGJvZHlBKSB7CiAgICAgICAgICBib2R5QS53YWtlVXAoKTsKICAgICAgICB9CgogICAgICAgIGlmIChib2R5QikgewogICAgICAgICAgYm9keUIud2FrZVVwKCk7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIFVwZGF0ZSBhbGwgdGhlIGVxdWF0aW9ucyB3aXRoIGRhdGEuCiAgICAgKi8KCgogICAgdXBkYXRlKCkgewogICAgICB0aHJvdyBuZXcgRXJyb3IoJ21ldGhvZCB1cGRhdGUoKSBub3QgaW1wbG1lbWVudGVkIGluIHRoaXMgQ29uc3RyYWludCBzdWJjbGFzcyEnKTsKICAgIH0KICAgIC8qKgogICAgICogRW5hYmxlcyBhbGwgZXF1YXRpb25zIGluIHRoZSBjb25zdHJhaW50LgogICAgICovCgoKICAgIGVuYWJsZSgpIHsKICAgICAgY29uc3QgZXFzID0gdGhpcy5lcXVhdGlvbnM7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGVxcy5sZW5ndGg7IGkrKykgewogICAgICAgIGVxc1tpXS5lbmFibGVkID0gdHJ1ZTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBEaXNhYmxlcyBhbGwgZXF1YXRpb25zIGluIHRoZSBjb25zdHJhaW50LgogICAgICovCgoKICAgIGRpc2FibGUoKSB7CiAgICAgIGNvbnN0IGVxcyA9IHRoaXMuZXF1YXRpb25zOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBlcXMubGVuZ3RoOyBpKyspIHsKICAgICAgICBlcXNbaV0uZW5hYmxlZCA9IGZhbHNlOwogICAgICB9CiAgICB9CgogIH0KICBDb25zdHJhaW50LmlkQ291bnRlciA9IDA7CgogIC8qKgogICAqIEFuIGVsZW1lbnQgY29udGFpbmluZyA2IGVudHJpZXMsIDMgc3BhdGlhbCBhbmQgMyByb3RhdGlvbmFsIGRlZ3JlZXMgb2YgZnJlZWRvbS4KICAgKi8KCiAgY2xhc3MgSmFjb2JpYW5FbGVtZW50IHsKICAgIC8qKgogICAgICogc3BhdGlhbAogICAgICovCgogICAgLyoqCiAgICAgKiByb3RhdGlvbmFsCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKCkgewogICAgICB0aGlzLnNwYXRpYWwgPSBuZXcgVmVjMygpOwogICAgICB0aGlzLnJvdGF0aW9uYWwgPSBuZXcgVmVjMygpOwogICAgfQogICAgLyoqCiAgICAgKiBNdWx0aXBseSB3aXRoIG90aGVyIEphY29iaWFuRWxlbWVudAogICAgICovCgoKICAgIG11bHRpcGx5RWxlbWVudChlbGVtZW50KSB7CiAgICAgIHJldHVybiBlbGVtZW50LnNwYXRpYWwuZG90KHRoaXMuc3BhdGlhbCkgKyBlbGVtZW50LnJvdGF0aW9uYWwuZG90KHRoaXMucm90YXRpb25hbCk7CiAgICB9CiAgICAvKioKICAgICAqIE11bHRpcGx5IHdpdGggdHdvIHZlY3RvcnMKICAgICAqLwoKCiAgICBtdWx0aXBseVZlY3RvcnMoc3BhdGlhbCwgcm90YXRpb25hbCkgewogICAgICByZXR1cm4gc3BhdGlhbC5kb3QodGhpcy5zcGF0aWFsKSArIHJvdGF0aW9uYWwuZG90KHRoaXMucm90YXRpb25hbCk7CiAgICB9CgogIH0KCiAgLyoqCiAgICogRXF1YXRpb24gYmFzZSBjbGFzcy4KICAgKgogICAqIGBhYCwgYGJgIGFuZCBgZXBzYCBhcmUge0BsaW5rIGh0dHBzOi8vd3d3OC5jcy51bXUuc2Uva3Vyc2VyLzVEVjA1OC9WVDE1L2xlY3R1cmVzL1NQT09LbGFibm90ZXMucGRmIFNQT09LfSBwYXJhbWV0ZXJzIHRoYXQgZGVmYXVsdCB0byBgMC4wYC4gU2VlIHtAbGluayBodHRwczovL2dpdGh1Yi5jb20vc2NodGVwcGUvY2Fubm9uLmpzL2lzc3Vlcy8yMzgjaXNzdWVjb21tZW50LTE0NzE3MjMyNyB0aGlzIGV4Y2hhbmdlfSBmb3IgbW9yZSBkZXRhaWxzIG9uIENhbm5vbidzIHBoeXNpY3MgaW1wbGVtZW50YXRpb24uCiAgICovCiAgY2xhc3MgRXF1YXRpb24gewogICAgLyoqCiAgICAgKiBNaW5pbXVtIChyZWFkOiBuZWdhdGl2ZSBtYXgpIGZvcmNlIHRvIGJlIGFwcGxpZWQgYnkgdGhlIGNvbnN0cmFpbnQuCiAgICAgKi8KCiAgICAvKioKICAgICAqIE1heGltdW0gKHJlYWQ6IHBvc2l0aXZlIG1heCkgZm9yY2UgdG8gYmUgYXBwbGllZCBieSB0aGUgY29uc3RyYWludC4KICAgICAqLwoKICAgIC8qKgogICAgICogU1BPT0sgcGFyYW1ldGVyCiAgICAgKi8KCiAgICAvKioKICAgICAqIFNQT09LIHBhcmFtZXRlcgogICAgICovCgogICAgLyoqCiAgICAgKiBTUE9PSyBwYXJhbWV0ZXIKICAgICAqLwoKICAgIC8qKgogICAgICogQSBudW1iZXIsIHByb3BvcnRpb25hbCB0byB0aGUgZm9yY2UgYWRkZWQgdG8gdGhlIGJvZGllcy4KICAgICAqLwogICAgY29uc3RydWN0b3IoYmksIGJqLCBtaW5Gb3JjZSwgbWF4Rm9yY2UpIHsKICAgICAgaWYgKG1pbkZvcmNlID09PSB2b2lkIDApIHsKICAgICAgICBtaW5Gb3JjZSA9IC0xZTY7CiAgICAgIH0KCiAgICAgIGlmIChtYXhGb3JjZSA9PT0gdm9pZCAwKSB7CiAgICAgICAgbWF4Rm9yY2UgPSAxZTY7CiAgICAgIH0KCiAgICAgIHRoaXMuaWQgPSBFcXVhdGlvbi5pZENvdW50ZXIrKzsKICAgICAgdGhpcy5taW5Gb3JjZSA9IG1pbkZvcmNlOwogICAgICB0aGlzLm1heEZvcmNlID0gbWF4Rm9yY2U7CiAgICAgIHRoaXMuYmkgPSBiaTsKICAgICAgdGhpcy5iaiA9IGJqOwogICAgICB0aGlzLmEgPSAwLjA7IC8vIFNQT09LIHBhcmFtZXRlcgoKICAgICAgdGhpcy5iID0gMC4wOyAvLyBTUE9PSyBwYXJhbWV0ZXIKCiAgICAgIHRoaXMuZXBzID0gMC4wOyAvLyBTUE9PSyBwYXJhbWV0ZXIKCiAgICAgIHRoaXMuamFjb2JpYW5FbGVtZW50QSA9IG5ldyBKYWNvYmlhbkVsZW1lbnQoKTsKICAgICAgdGhpcy5qYWNvYmlhbkVsZW1lbnRCID0gbmV3IEphY29iaWFuRWxlbWVudCgpOwogICAgICB0aGlzLmVuYWJsZWQgPSB0cnVlOwogICAgICB0aGlzLm11bHRpcGxpZXIgPSAwOwogICAgICB0aGlzLnNldFNwb29rUGFyYW1zKDFlNywgNCwgMSAvIDYwKTsgLy8gU2V0IHR5cGljYWwgc3Bvb2sgcGFyYW1zCiAgICB9CiAgICAvKioKICAgICAqIFJlY2FsY3VsYXRlcyBhLCBiLCBhbmQgZXBzLgogICAgICoKICAgICAqIFRoZSBFcXVhdGlvbiBjb25zdHJ1Y3RvciBzZXRzIHR5cGljYWwgU1BPT0sgcGFyYW1ldGVycyBhcyBzdWNoOgogICAgICogKiBgc3RpZmZuZXNzYCA9IDFlNwogICAgICogKiBgcmVsYXhhdGlvbmAgPSA0CiAgICAgKiAqIGB0aW1lU3RlcGA9IDEgLyA2MCwgX25vdGUgdGhlIGhhcmRjb2RlZCByZWZyZXNoIHJhdGUuXwogICAgICovCgoKICAgIHNldFNwb29rUGFyYW1zKHN0aWZmbmVzcywgcmVsYXhhdGlvbiwgdGltZVN0ZXApIHsKICAgICAgY29uc3QgZCA9IHJlbGF4YXRpb247CiAgICAgIGNvbnN0IGsgPSBzdGlmZm5lc3M7CiAgICAgIGNvbnN0IGggPSB0aW1lU3RlcDsKICAgICAgdGhpcy5hID0gNC4wIC8gKGggKiAoMSArIDQgKiBkKSk7CiAgICAgIHRoaXMuYiA9IDQuMCAqIGQgLyAoMSArIDQgKiBkKTsKICAgICAgdGhpcy5lcHMgPSA0LjAgLyAoaCAqIGggKiBrICogKDEgKyA0ICogZCkpOwogICAgfQogICAgLyoqCiAgICAgKiBDb21wdXRlcyB0aGUgcmlnaHQgaGFuZCBzaWRlIG9mIHRoZSBTUE9PSyBlcXVhdGlvbgogICAgICovCgoKICAgIGNvbXB1dGVCKGEsIGIsIGgpIHsKICAgICAgY29uc3QgR1cgPSB0aGlzLmNvbXB1dGVHVygpOwogICAgICBjb25zdCBHcSA9IHRoaXMuY29tcHV0ZUdxKCk7CiAgICAgIGNvbnN0IEdpTWYgPSB0aGlzLmNvbXB1dGVHaU1mKCk7CiAgICAgIHJldHVybiAtR3EgKiBhIC0gR1cgKiBiIC0gR2lNZiAqIGg7CiAgICB9CiAgICAvKioKICAgICAqIENvbXB1dGVzIEcqcSwgd2hlcmUgcSBhcmUgdGhlIGdlbmVyYWxpemVkIGJvZHkgY29vcmRpbmF0ZXMKICAgICAqLwoKCiAgICBjb21wdXRlR3EoKSB7CiAgICAgIGNvbnN0IEdBID0gdGhpcy5qYWNvYmlhbkVsZW1lbnRBOwogICAgICBjb25zdCBHQiA9IHRoaXMuamFjb2JpYW5FbGVtZW50QjsKICAgICAgY29uc3QgYmkgPSB0aGlzLmJpOwogICAgICBjb25zdCBiaiA9IHRoaXMuYmo7CiAgICAgIGNvbnN0IHhpID0gYmkucG9zaXRpb247CiAgICAgIGNvbnN0IHhqID0gYmoucG9zaXRpb247CiAgICAgIHJldHVybiBHQS5zcGF0aWFsLmRvdCh4aSkgKyBHQi5zcGF0aWFsLmRvdCh4aik7CiAgICB9CiAgICAvKioKICAgICAqIENvbXB1dGVzIEcqVywgd2hlcmUgVyBhcmUgdGhlIGJvZHkgdmVsb2NpdGllcwogICAgICovCgoKICAgIGNvbXB1dGVHVygpIHsKICAgICAgY29uc3QgR0EgPSB0aGlzLmphY29iaWFuRWxlbWVudEE7CiAgICAgIGNvbnN0IEdCID0gdGhpcy5qYWNvYmlhbkVsZW1lbnRCOwogICAgICBjb25zdCBiaSA9IHRoaXMuYmk7CiAgICAgIGNvbnN0IGJqID0gdGhpcy5iajsKICAgICAgY29uc3QgdmkgPSBiaS52ZWxvY2l0eTsKICAgICAgY29uc3QgdmogPSBiai52ZWxvY2l0eTsKICAgICAgY29uc3Qgd2kgPSBiaS5hbmd1bGFyVmVsb2NpdHk7CiAgICAgIGNvbnN0IHdqID0gYmouYW5ndWxhclZlbG9jaXR5OwogICAgICByZXR1cm4gR0EubXVsdGlwbHlWZWN0b3JzKHZpLCB3aSkgKyBHQi5tdWx0aXBseVZlY3RvcnModmosIHdqKTsKICAgIH0KICAgIC8qKgogICAgICogQ29tcHV0ZXMgRypXbGFtYmRhLCB3aGVyZSBXIGFyZSB0aGUgYm9keSB2ZWxvY2l0aWVzCiAgICAgKi8KCgogICAgY29tcHV0ZUdXbGFtYmRhKCkgewogICAgICBjb25zdCBHQSA9IHRoaXMuamFjb2JpYW5FbGVtZW50QTsKICAgICAgY29uc3QgR0IgPSB0aGlzLmphY29iaWFuRWxlbWVudEI7CiAgICAgIGNvbnN0IGJpID0gdGhpcy5iaTsKICAgICAgY29uc3QgYmogPSB0aGlzLmJqOwogICAgICBjb25zdCB2aSA9IGJpLnZsYW1iZGE7CiAgICAgIGNvbnN0IHZqID0gYmoudmxhbWJkYTsKICAgICAgY29uc3Qgd2kgPSBiaS53bGFtYmRhOwogICAgICBjb25zdCB3aiA9IGJqLndsYW1iZGE7CiAgICAgIHJldHVybiBHQS5tdWx0aXBseVZlY3RvcnModmksIHdpKSArIEdCLm11bHRpcGx5VmVjdG9ycyh2aiwgd2opOwogICAgfQogICAgLyoqCiAgICAgKiBDb21wdXRlcyBHKmludihNKSpmLCB3aGVyZSBNIGlzIHRoZSBtYXNzIG1hdHJpeCB3aXRoIGRpYWdvbmFsIGJsb2NrcyBmb3IgZWFjaCBib2R5LCBhbmQgZiBhcmUgdGhlIGZvcmNlcyBvbiB0aGUgYm9kaWVzLgogICAgICovCgoKICAgIGNvbXB1dGVHaU1mKCkgewogICAgICBjb25zdCBHQSA9IHRoaXMuamFjb2JpYW5FbGVtZW50QTsKICAgICAgY29uc3QgR0IgPSB0aGlzLmphY29iaWFuRWxlbWVudEI7CiAgICAgIGNvbnN0IGJpID0gdGhpcy5iaTsKICAgICAgY29uc3QgYmogPSB0aGlzLmJqOwogICAgICBjb25zdCBmaSA9IGJpLmZvcmNlOwogICAgICBjb25zdCB0aSA9IGJpLnRvcnF1ZTsKICAgICAgY29uc3QgZmogPSBiai5mb3JjZTsKICAgICAgY29uc3QgdGogPSBiai50b3JxdWU7CiAgICAgIGNvbnN0IGludk1hc3NpID0gYmkuaW52TWFzc1NvbHZlOwogICAgICBjb25zdCBpbnZNYXNzaiA9IGJqLmludk1hc3NTb2x2ZTsKICAgICAgZmkuc2NhbGUoaW52TWFzc2ksIGlNZmkpOwogICAgICBmai5zY2FsZShpbnZNYXNzaiwgaU1maik7CiAgICAgIGJpLmludkluZXJ0aWFXb3JsZFNvbHZlLnZtdWx0KHRpLCBpbnZJaV92bXVsdF90YXVpKTsKICAgICAgYmouaW52SW5lcnRpYVdvcmxkU29sdmUudm11bHQodGosIGludklqX3ZtdWx0X3RhdWopOwogICAgICByZXR1cm4gR0EubXVsdGlwbHlWZWN0b3JzKGlNZmksIGludklpX3ZtdWx0X3RhdWkpICsgR0IubXVsdGlwbHlWZWN0b3JzKGlNZmosIGludklqX3ZtdWx0X3RhdWopOwogICAgfQogICAgLyoqCiAgICAgKiBDb21wdXRlcyBHKmludihNKSpHJwogICAgICovCgoKICAgIGNvbXB1dGVHaU1HdCgpIHsKICAgICAgY29uc3QgR0EgPSB0aGlzLmphY29iaWFuRWxlbWVudEE7CiAgICAgIGNvbnN0IEdCID0gdGhpcy5qYWNvYmlhbkVsZW1lbnRCOwogICAgICBjb25zdCBiaSA9IHRoaXMuYmk7CiAgICAgIGNvbnN0IGJqID0gdGhpcy5iajsKICAgICAgY29uc3QgaW52TWFzc2kgPSBiaS5pbnZNYXNzU29sdmU7CiAgICAgIGNvbnN0IGludk1hc3NqID0gYmouaW52TWFzc1NvbHZlOwogICAgICBjb25zdCBpbnZJaSA9IGJpLmludkluZXJ0aWFXb3JsZFNvbHZlOwogICAgICBjb25zdCBpbnZJaiA9IGJqLmludkluZXJ0aWFXb3JsZFNvbHZlOwogICAgICBsZXQgcmVzdWx0ID0gaW52TWFzc2kgKyBpbnZNYXNzajsKICAgICAgaW52SWkudm11bHQoR0Eucm90YXRpb25hbCwgdG1wKTsKICAgICAgcmVzdWx0ICs9IHRtcC5kb3QoR0Eucm90YXRpb25hbCk7CiAgICAgIGludklqLnZtdWx0KEdCLnJvdGF0aW9uYWwsIHRtcCk7CiAgICAgIHJlc3VsdCArPSB0bXAuZG90KEdCLnJvdGF0aW9uYWwpOwogICAgICByZXR1cm4gcmVzdWx0OwogICAgfQogICAgLyoqCiAgICAgKiBBZGQgY29uc3RyYWludCB2ZWxvY2l0eSB0byB0aGUgYm9kaWVzLgogICAgICovCgoKICAgIGFkZFRvV2xhbWJkYShkZWx0YWxhbWJkYSkgewogICAgICBjb25zdCBHQSA9IHRoaXMuamFjb2JpYW5FbGVtZW50QTsKICAgICAgY29uc3QgR0IgPSB0aGlzLmphY29iaWFuRWxlbWVudEI7CiAgICAgIGNvbnN0IGJpID0gdGhpcy5iaTsKICAgICAgY29uc3QgYmogPSB0aGlzLmJqOwogICAgICBjb25zdCB0ZW1wID0gYWRkVG9XbGFtYmRhX3RlbXA7IC8vIEFkZCB0byBsaW5lYXIgdmVsb2NpdHkKICAgICAgLy8gdl9sYW1iZGEgKz0gaW52KE0pICogZGVsdGFfbGFtYmEgKiBHCgogICAgICBiaS52bGFtYmRhLmFkZFNjYWxlZFZlY3RvcihiaS5pbnZNYXNzU29sdmUgKiBkZWx0YWxhbWJkYSwgR0Euc3BhdGlhbCwgYmkudmxhbWJkYSk7CiAgICAgIGJqLnZsYW1iZGEuYWRkU2NhbGVkVmVjdG9yKGJqLmludk1hc3NTb2x2ZSAqIGRlbHRhbGFtYmRhLCBHQi5zcGF0aWFsLCBiai52bGFtYmRhKTsgLy8gQWRkIHRvIGFuZ3VsYXIgdmVsb2NpdHkKCiAgICAgIGJpLmludkluZXJ0aWFXb3JsZFNvbHZlLnZtdWx0KEdBLnJvdGF0aW9uYWwsIHRlbXApOwogICAgICBiaS53bGFtYmRhLmFkZFNjYWxlZFZlY3RvcihkZWx0YWxhbWJkYSwgdGVtcCwgYmkud2xhbWJkYSk7CiAgICAgIGJqLmludkluZXJ0aWFXb3JsZFNvbHZlLnZtdWx0KEdCLnJvdGF0aW9uYWwsIHRlbXApOwogICAgICBiai53bGFtYmRhLmFkZFNjYWxlZFZlY3RvcihkZWx0YWxhbWJkYSwgdGVtcCwgYmoud2xhbWJkYSk7CiAgICB9CiAgICAvKioKICAgICAqIENvbXB1dGUgdGhlIGRlbm9taW5hdG9yIHBhcnQgb2YgdGhlIFNQT09LIGVxdWF0aW9uOiBDID0gRyppbnYoTSkqRycgKyBlcHMKICAgICAqLwoKCiAgICBjb21wdXRlQygpIHsKICAgICAgcmV0dXJuIHRoaXMuY29tcHV0ZUdpTUd0KCkgKyB0aGlzLmVwczsKICAgIH0KCiAgfQogIEVxdWF0aW9uLmlkQ291bnRlciA9IDA7CiAgY29uc3QgaU1maSA9IG5ldyBWZWMzKCk7CiAgY29uc3QgaU1maiA9IG5ldyBWZWMzKCk7CiAgY29uc3QgaW52SWlfdm11bHRfdGF1aSA9IG5ldyBWZWMzKCk7CiAgY29uc3QgaW52SWpfdm11bHRfdGF1aiA9IG5ldyBWZWMzKCk7CiAgY29uc3QgdG1wID0gbmV3IFZlYzMoKTsKICBjb25zdCBhZGRUb1dsYW1iZGFfdGVtcCA9IG5ldyBWZWMzKCk7CgogIC8qKgogICAqIENvbnRhY3Qvbm9uLXBlbmV0cmF0aW9uIGNvbnN0cmFpbnQgZXF1YXRpb24KICAgKi8KICBjbGFzcyBDb250YWN0RXF1YXRpb24gZXh0ZW5kcyBFcXVhdGlvbiB7CiAgICAvKioKICAgICAqICJib3VuY2luZXNzIjogdTEgPSAtZSp1MAogICAgICovCgogICAgLyoqCiAgICAgKiBXb3JsZC1vcmllbnRlZCB2ZWN0b3IgdGhhdCBnb2VzIGZyb20gdGhlIGNlbnRlciBvZiBiaSB0byB0aGUgY29udGFjdCBwb2ludC4KICAgICAqLwoKICAgIC8qKgogICAgICogV29ybGQtb3JpZW50ZWQgdmVjdG9yIHRoYXQgc3RhcnRzIGluIGJvZHkgaiBwb3NpdGlvbiBhbmQgZ29lcyB0byB0aGUgY29udGFjdCBwb2ludC4KICAgICAqLwoKICAgIC8qKgogICAgICogQ29udGFjdCBub3JtYWwsIHBvaW50aW5nIG91dCBvZiBib2R5IGkuCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKGJvZHlBLCBib2R5QiwgbWF4Rm9yY2UpIHsKICAgICAgaWYgKG1heEZvcmNlID09PSB2b2lkIDApIHsKICAgICAgICBtYXhGb3JjZSA9IDFlNjsKICAgICAgfQoKICAgICAgc3VwZXIoYm9keUEsIGJvZHlCLCAwLCBtYXhGb3JjZSk7CiAgICAgIHRoaXMucmVzdGl0dXRpb24gPSAwLjA7CiAgICAgIHRoaXMucmkgPSBuZXcgVmVjMygpOwogICAgICB0aGlzLnJqID0gbmV3IFZlYzMoKTsKICAgICAgdGhpcy5uaSA9IG5ldyBWZWMzKCk7CiAgICB9CgogICAgY29tcHV0ZUIoaCkgewogICAgICBjb25zdCBhID0gdGhpcy5hOwogICAgICBjb25zdCBiID0gdGhpcy5iOwogICAgICBjb25zdCBiaSA9IHRoaXMuYmk7CiAgICAgIGNvbnN0IGJqID0gdGhpcy5iajsKICAgICAgY29uc3QgcmkgPSB0aGlzLnJpOwogICAgICBjb25zdCByaiA9IHRoaXMucmo7CiAgICAgIGNvbnN0IHJpeG4gPSBDb250YWN0RXF1YXRpb25fY29tcHV0ZUJfdGVtcDE7CiAgICAgIGNvbnN0IHJqeG4gPSBDb250YWN0RXF1YXRpb25fY29tcHV0ZUJfdGVtcDI7CiAgICAgIGNvbnN0IHZpID0gYmkudmVsb2NpdHk7CiAgICAgIGNvbnN0IHdpID0gYmkuYW5ndWxhclZlbG9jaXR5OwogICAgICBiaS5mb3JjZTsKICAgICAgYmkudG9ycXVlOwogICAgICBjb25zdCB2aiA9IGJqLnZlbG9jaXR5OwogICAgICBjb25zdCB3aiA9IGJqLmFuZ3VsYXJWZWxvY2l0eTsKICAgICAgYmouZm9yY2U7CiAgICAgIGJqLnRvcnF1ZTsKICAgICAgY29uc3QgcGVuZXRyYXRpb25WZWMgPSBDb250YWN0RXF1YXRpb25fY29tcHV0ZUJfdGVtcDM7CiAgICAgIGNvbnN0IEdBID0gdGhpcy5qYWNvYmlhbkVsZW1lbnRBOwogICAgICBjb25zdCBHQiA9IHRoaXMuamFjb2JpYW5FbGVtZW50QjsKICAgICAgY29uc3QgbiA9IHRoaXMubmk7IC8vIENhbHVjbGF0ZSBjcm9zcyBwcm9kdWN0cwoKICAgICAgcmkuY3Jvc3Mobiwgcml4bik7CiAgICAgIHJqLmNyb3NzKG4sIHJqeG4pOyAvLyBnID0geGorcmogLSh4aStyaSkKICAgICAgLy8gRyA9IFsgLW5pICAtcml4biAgbmkgIHJqeG4gXQoKICAgICAgbi5uZWdhdGUoR0Euc3BhdGlhbCk7CiAgICAgIHJpeG4ubmVnYXRlKEdBLnJvdGF0aW9uYWwpOwogICAgICBHQi5zcGF0aWFsLmNvcHkobik7CiAgICAgIEdCLnJvdGF0aW9uYWwuY29weShyanhuKTsgLy8gQ2FsY3VsYXRlIHRoZSBwZW5ldHJhdGlvbiB2ZWN0b3IKCiAgICAgIHBlbmV0cmF0aW9uVmVjLmNvcHkoYmoucG9zaXRpb24pOwogICAgICBwZW5ldHJhdGlvblZlYy52YWRkKHJqLCBwZW5ldHJhdGlvblZlYyk7CiAgICAgIHBlbmV0cmF0aW9uVmVjLnZzdWIoYmkucG9zaXRpb24sIHBlbmV0cmF0aW9uVmVjKTsKICAgICAgcGVuZXRyYXRpb25WZWMudnN1YihyaSwgcGVuZXRyYXRpb25WZWMpOwogICAgICBjb25zdCBnID0gbi5kb3QocGVuZXRyYXRpb25WZWMpOyAvLyBDb21wdXRlIGl0ZXJhdGlvbgoKICAgICAgY29uc3QgZVBsdXNPbmUgPSB0aGlzLnJlc3RpdHV0aW9uICsgMTsKICAgICAgY29uc3QgR1cgPSBlUGx1c09uZSAqIHZqLmRvdChuKSAtIGVQbHVzT25lICogdmkuZG90KG4pICsgd2ouZG90KHJqeG4pIC0gd2kuZG90KHJpeG4pOwogICAgICBjb25zdCBHaU1mID0gdGhpcy5jb21wdXRlR2lNZigpOwogICAgICBjb25zdCBCID0gLWcgKiBhIC0gR1cgKiBiIC0gaCAqIEdpTWY7CiAgICAgIHJldHVybiBCOwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgdGhlIGN1cnJlbnQgcmVsYXRpdmUgdmVsb2NpdHkgaW4gdGhlIGNvbnRhY3QgcG9pbnQuCiAgICAgKi8KCgogICAgZ2V0SW1wYWN0VmVsb2NpdHlBbG9uZ05vcm1hbCgpIHsKICAgICAgY29uc3QgdmkgPSBDb250YWN0RXF1YXRpb25fZ2V0SW1wYWN0VmVsb2NpdHlBbG9uZ05vcm1hbF92aTsKICAgICAgY29uc3QgdmogPSBDb250YWN0RXF1YXRpb25fZ2V0SW1wYWN0VmVsb2NpdHlBbG9uZ05vcm1hbF92ajsKICAgICAgY29uc3QgeGkgPSBDb250YWN0RXF1YXRpb25fZ2V0SW1wYWN0VmVsb2NpdHlBbG9uZ05vcm1hbF94aTsKICAgICAgY29uc3QgeGogPSBDb250YWN0RXF1YXRpb25fZ2V0SW1wYWN0VmVsb2NpdHlBbG9uZ05vcm1hbF94ajsKICAgICAgY29uc3QgcmVsVmVsID0gQ29udGFjdEVxdWF0aW9uX2dldEltcGFjdFZlbG9jaXR5QWxvbmdOb3JtYWxfcmVsVmVsOwogICAgICB0aGlzLmJpLnBvc2l0aW9uLnZhZGQodGhpcy5yaSwgeGkpOwogICAgICB0aGlzLmJqLnBvc2l0aW9uLnZhZGQodGhpcy5yaiwgeGopOwogICAgICB0aGlzLmJpLmdldFZlbG9jaXR5QXRXb3JsZFBvaW50KHhpLCB2aSk7CiAgICAgIHRoaXMuYmouZ2V0VmVsb2NpdHlBdFdvcmxkUG9pbnQoeGosIHZqKTsKICAgICAgdmkudnN1Yih2aiwgcmVsVmVsKTsKICAgICAgcmV0dXJuIHRoaXMubmkuZG90KHJlbFZlbCk7CiAgICB9CgogIH0KICBjb25zdCBDb250YWN0RXF1YXRpb25fY29tcHV0ZUJfdGVtcDEgPSBuZXcgVmVjMygpOyAvLyBUZW1wIHZlY3RvcnMKCiAgY29uc3QgQ29udGFjdEVxdWF0aW9uX2NvbXB1dGVCX3RlbXAyID0gbmV3IFZlYzMoKTsKICBjb25zdCBDb250YWN0RXF1YXRpb25fY29tcHV0ZUJfdGVtcDMgPSBuZXcgVmVjMygpOwogIGNvbnN0IENvbnRhY3RFcXVhdGlvbl9nZXRJbXBhY3RWZWxvY2l0eUFsb25nTm9ybWFsX3ZpID0gbmV3IFZlYzMoKTsKICBjb25zdCBDb250YWN0RXF1YXRpb25fZ2V0SW1wYWN0VmVsb2NpdHlBbG9uZ05vcm1hbF92aiA9IG5ldyBWZWMzKCk7CiAgY29uc3QgQ29udGFjdEVxdWF0aW9uX2dldEltcGFjdFZlbG9jaXR5QWxvbmdOb3JtYWxfeGkgPSBuZXcgVmVjMygpOwogIGNvbnN0IENvbnRhY3RFcXVhdGlvbl9nZXRJbXBhY3RWZWxvY2l0eUFsb25nTm9ybWFsX3hqID0gbmV3IFZlYzMoKTsKICBjb25zdCBDb250YWN0RXF1YXRpb25fZ2V0SW1wYWN0VmVsb2NpdHlBbG9uZ05vcm1hbF9yZWxWZWwgPSBuZXcgVmVjMygpOwoKICAvKioKICAgKiBDb25uZWN0cyB0d28gYm9kaWVzIGF0IGdpdmVuIG9mZnNldCBwb2ludHMuCiAgICogQGV4YW1wbGUKICAgKiAgICAgY29uc3QgYm9keUEgPSBuZXcgQm9keSh7IG1hc3M6IDEgfSkKICAgKiAgICAgY29uc3QgYm9keUIgPSBuZXcgQm9keSh7IG1hc3M6IDEgfSkKICAgKiAgICAgYm9keUEucG9zaXRpb24uc2V0KC0xLCAwLCAwKQogICAqICAgICBib2R5Qi5wb3NpdGlvbi5zZXQoMSwgMCwgMCkKICAgKiAgICAgYm9keUEuYWRkU2hhcGUoc2hhcGVBKQogICAqICAgICBib2R5Qi5hZGRTaGFwZShzaGFwZUIpCiAgICogICAgIHdvcmxkLmFkZEJvZHkoYm9keUEpCiAgICogICAgIHdvcmxkLmFkZEJvZHkoYm9keUIpCiAgICogICAgIGNvbnN0IGxvY2FsUGl2b3RBID0gbmV3IFZlYzMoMSwgMCwgMCkKICAgKiAgICAgY29uc3QgbG9jYWxQaXZvdEIgPSBuZXcgVmVjMygtMSwgMCwgMCkKICAgKiAgICAgY29uc3QgY29uc3RyYWludCA9IG5ldyBQb2ludFRvUG9pbnRDb25zdHJhaW50KGJvZHlBLCBsb2NhbFBpdm90QSwgYm9keUIsIGxvY2FsUGl2b3RCKQogICAqICAgICB3b3JsZC5hZGRDb25zdHJhaW50KGNvbnN0cmFpbnQpCiAgICovCiAgY2xhc3MgUG9pbnRUb1BvaW50Q29uc3RyYWludCBleHRlbmRzIENvbnN0cmFpbnQgewogICAgLyoqCiAgICAgKiBQaXZvdCwgZGVmaW5lZCBsb2NhbGx5IGluIGJvZHlBLgogICAgICovCgogICAgLyoqCiAgICAgKiBQaXZvdCwgZGVmaW5lZCBsb2NhbGx5IGluIGJvZHlCLgogICAgICovCgogICAgLyoqCiAgICAgKiBAcGFyYW0gcGl2b3RBIFRoZSBwb2ludCByZWxhdGl2ZSB0byB0aGUgY2VudGVyIG9mIG1hc3Mgb2YgYm9keUEgd2hpY2ggYm9keUEgaXMgY29uc3RyYWluZWQgdG8uCiAgICAgKiBAcGFyYW0gYm9keUIgQm9keSB0aGF0IHdpbGwgYmUgY29uc3RyYWluZWQgaW4gYSBzaW1pbGFyIHdheSB0byB0aGUgc2FtZSBwb2ludCBhcyBib2R5QS4gV2Ugd2lsbCB0aGVyZWZvcmUgZ2V0IGEgbGluayBiZXR3ZWVuIGJvZHlBIGFuZCBib2R5Qi4gSWYgbm90IHNwZWNpZmllZCwgYm9keUEgd2lsbCBiZSBjb25zdHJhaW5lZCB0byBhIHN0YXRpYyBwb2ludC4KICAgICAqIEBwYXJhbSBwaXZvdEIgVGhlIHBvaW50IHJlbGF0aXZlIHRvIHRoZSBjZW50ZXIgb2YgbWFzcyBvZiBib2R5QiB3aGljaCBib2R5QiBpcyBjb25zdHJhaW5lZCB0by4KICAgICAqIEBwYXJhbSBtYXhGb3JjZSBUaGUgbWF4aW11bSBmb3JjZSB0aGF0IHNob3VsZCBiZSBhcHBsaWVkIHRvIGNvbnN0cmFpbiB0aGUgYm9kaWVzLgogICAgICovCiAgICBjb25zdHJ1Y3Rvcihib2R5QSwgcGl2b3RBLCBib2R5QiwgcGl2b3RCLCBtYXhGb3JjZSkgewogICAgICBpZiAocGl2b3RBID09PSB2b2lkIDApIHsKICAgICAgICBwaXZvdEEgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICBpZiAocGl2b3RCID09PSB2b2lkIDApIHsKICAgICAgICBwaXZvdEIgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICBpZiAobWF4Rm9yY2UgPT09IHZvaWQgMCkgewogICAgICAgIG1heEZvcmNlID0gMWU2OwogICAgICB9CgogICAgICBzdXBlcihib2R5QSwgYm9keUIpOwogICAgICB0aGlzLnBpdm90QSA9IHBpdm90QS5jbG9uZSgpOwogICAgICB0aGlzLnBpdm90QiA9IHBpdm90Qi5jbG9uZSgpOwogICAgICBjb25zdCB4ID0gdGhpcy5lcXVhdGlvblggPSBuZXcgQ29udGFjdEVxdWF0aW9uKGJvZHlBLCBib2R5Qik7CiAgICAgIGNvbnN0IHkgPSB0aGlzLmVxdWF0aW9uWSA9IG5ldyBDb250YWN0RXF1YXRpb24oYm9keUEsIGJvZHlCKTsKICAgICAgY29uc3QgeiA9IHRoaXMuZXF1YXRpb25aID0gbmV3IENvbnRhY3RFcXVhdGlvbihib2R5QSwgYm9keUIpOyAvLyBFcXVhdGlvbnMgdG8gYmUgZmVkIHRvIHRoZSBzb2x2ZXIKCiAgICAgIHRoaXMuZXF1YXRpb25zLnB1c2goeCwgeSwgeik7IC8vIE1ha2UgdGhlIGVxdWF0aW9ucyBiaWRpcmVjdGlvbmFsCgogICAgICB4Lm1pbkZvcmNlID0geS5taW5Gb3JjZSA9IHoubWluRm9yY2UgPSAtbWF4Rm9yY2U7CiAgICAgIHgubWF4Rm9yY2UgPSB5Lm1heEZvcmNlID0gei5tYXhGb3JjZSA9IG1heEZvcmNlOwogICAgICB4Lm5pLnNldCgxLCAwLCAwKTsKICAgICAgeS5uaS5zZXQoMCwgMSwgMCk7CiAgICAgIHoubmkuc2V0KDAsIDAsIDEpOwogICAgfQoKICAgIHVwZGF0ZSgpIHsKICAgICAgY29uc3QgYm9keUEgPSB0aGlzLmJvZHlBOwogICAgICBjb25zdCBib2R5QiA9IHRoaXMuYm9keUI7CiAgICAgIGNvbnN0IHggPSB0aGlzLmVxdWF0aW9uWDsKICAgICAgY29uc3QgeSA9IHRoaXMuZXF1YXRpb25ZOwogICAgICBjb25zdCB6ID0gdGhpcy5lcXVhdGlvblo7IC8vIFJvdGF0ZSB0aGUgcGl2b3RzIHRvIHdvcmxkIHNwYWNlCgogICAgICBib2R5QS5xdWF0ZXJuaW9uLnZtdWx0KHRoaXMucGl2b3RBLCB4LnJpKTsKICAgICAgYm9keUIucXVhdGVybmlvbi52bXVsdCh0aGlzLnBpdm90QiwgeC5yaik7CiAgICAgIHkucmkuY29weSh4LnJpKTsKICAgICAgeS5yai5jb3B5KHgucmopOwogICAgICB6LnJpLmNvcHkoeC5yaSk7CiAgICAgIHoucmouY29weSh4LnJqKTsKICAgIH0KCiAgfQoKICAvKioKICAgKiBDb25lIGVxdWF0aW9uLiBXb3JrcyB0byBrZWVwIHRoZSBnaXZlbiBib2R5IHdvcmxkIHZlY3RvcnMgYWxpZ25lZCwgb3IgdGlsdGVkIHdpdGhpbiBhIGdpdmVuIGFuZ2xlIGZyb20gZWFjaCBvdGhlci4KICAgKi8KICBjbGFzcyBDb25lRXF1YXRpb24gZXh0ZW5kcyBFcXVhdGlvbiB7CiAgICAvKioKICAgICAqIExvY2FsIGF4aXMgaW4gQQogICAgICovCgogICAgLyoqCiAgICAgKiBMb2NhbCBheGlzIGluIEIKICAgICAqLwoKICAgIC8qKgogICAgICogVGhlICJjb25lIGFuZ2xlIiB0byBrZWVwCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKGJvZHlBLCBib2R5Qiwgb3B0aW9ucykgewogICAgICBpZiAob3B0aW9ucyA9PT0gdm9pZCAwKSB7CiAgICAgICAgb3B0aW9ucyA9IHt9OwogICAgICB9CgogICAgICBjb25zdCBtYXhGb3JjZSA9IHR5cGVvZiBvcHRpb25zLm1heEZvcmNlICE9PSAndW5kZWZpbmVkJyA/IG9wdGlvbnMubWF4Rm9yY2UgOiAxZTY7CiAgICAgIHN1cGVyKGJvZHlBLCBib2R5QiwgLW1heEZvcmNlLCBtYXhGb3JjZSk7CiAgICAgIHRoaXMuYXhpc0EgPSBvcHRpb25zLmF4aXNBID8gb3B0aW9ucy5heGlzQS5jbG9uZSgpIDogbmV3IFZlYzMoMSwgMCwgMCk7CiAgICAgIHRoaXMuYXhpc0IgPSBvcHRpb25zLmF4aXNCID8gb3B0aW9ucy5heGlzQi5jbG9uZSgpIDogbmV3IFZlYzMoMCwgMSwgMCk7CiAgICAgIHRoaXMuYW5nbGUgPSB0eXBlb2Ygb3B0aW9ucy5hbmdsZSAhPT0gJ3VuZGVmaW5lZCcgPyBvcHRpb25zLmFuZ2xlIDogMDsKICAgIH0KCiAgICBjb21wdXRlQihoKSB7CiAgICAgIGNvbnN0IGEgPSB0aGlzLmE7CiAgICAgIGNvbnN0IGIgPSB0aGlzLmI7CiAgICAgIGNvbnN0IG5pID0gdGhpcy5heGlzQTsKICAgICAgY29uc3QgbmogPSB0aGlzLmF4aXNCOwogICAgICBjb25zdCBuaXhuaiA9IHRtcFZlYzEkMjsKICAgICAgY29uc3Qgbmp4bmkgPSB0bXBWZWMyJDI7CiAgICAgIGNvbnN0IEdBID0gdGhpcy5qYWNvYmlhbkVsZW1lbnRBOwogICAgICBjb25zdCBHQiA9IHRoaXMuamFjb2JpYW5FbGVtZW50QjsgLy8gQ2FsdWNsYXRlIGNyb3NzIHByb2R1Y3RzCgogICAgICBuaS5jcm9zcyhuaiwgbml4bmopOwogICAgICBuai5jcm9zcyhuaSwgbmp4bmkpOyAvLyBUaGUgYW5nbGUgYmV0d2VlbiB0d28gdmVjdG9yIGlzOgogICAgICAvLyBjb3ModGhldGEpID0gYSAqIGIgLyAobGVuZ3RoKGEpICogbGVuZ3RoKGIpID0geyBsZW4oYSkgPSBsZW4oYikgPSAxIH0gPSBhICogYgogICAgICAvLyBnID0gYSAqIGIKICAgICAgLy8gZ2RvdCA9IChiIHggYSkgKiB3aSArIChhIHggYikgKiB3agogICAgICAvLyBHID0gWzAgYnhhIDAgYXhiXQogICAgICAvLyBXID0gW3ZpIHdpIHZqIHdqXQoKICAgICAgR0Eucm90YXRpb25hbC5jb3B5KG5qeG5pKTsKICAgICAgR0Iucm90YXRpb25hbC5jb3B5KG5peG5qKTsKICAgICAgY29uc3QgZyA9IE1hdGguY29zKHRoaXMuYW5nbGUpIC0gbmkuZG90KG5qKTsKICAgICAgY29uc3QgR1cgPSB0aGlzLmNvbXB1dGVHVygpOwogICAgICBjb25zdCBHaU1mID0gdGhpcy5jb21wdXRlR2lNZigpOwogICAgICBjb25zdCBCID0gLWcgKiBhIC0gR1cgKiBiIC0gaCAqIEdpTWY7CiAgICAgIHJldHVybiBCOwogICAgfQoKICB9CiAgY29uc3QgdG1wVmVjMSQyID0gbmV3IFZlYzMoKTsKICBjb25zdCB0bXBWZWMyJDIgPSBuZXcgVmVjMygpOwoKICAvKioKICAgKiBSb3RhdGlvbmFsIGNvbnN0cmFpbnQuIFdvcmtzIHRvIGtlZXAgdGhlIGxvY2FsIHZlY3RvcnMgb3J0aG9nb25hbCB0byBlYWNoIG90aGVyIGluIHdvcmxkIHNwYWNlLgogICAqLwogIGNsYXNzIFJvdGF0aW9uYWxFcXVhdGlvbiBleHRlbmRzIEVxdWF0aW9uIHsKICAgIC8qKgogICAgICogV29ybGQgb3JpZW50ZWQgcm90YXRpb25hbCBheGlzLgogICAgICovCgogICAgLyoqCiAgICAgKiBXb3JsZCBvcmllbnRlZCByb3RhdGlvbmFsIGF4aXMuCiAgICAgKi8KCiAgICAvKioKICAgICAqIG1heEFuZ2xlCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKGJvZHlBLCBib2R5Qiwgb3B0aW9ucykgewogICAgICBpZiAob3B0aW9ucyA9PT0gdm9pZCAwKSB7CiAgICAgICAgb3B0aW9ucyA9IHt9OwogICAgICB9CgogICAgICBjb25zdCBtYXhGb3JjZSA9IHR5cGVvZiBvcHRpb25zLm1heEZvcmNlICE9PSAndW5kZWZpbmVkJyA/IG9wdGlvbnMubWF4Rm9yY2UgOiAxZTY7CiAgICAgIHN1cGVyKGJvZHlBLCBib2R5QiwgLW1heEZvcmNlLCBtYXhGb3JjZSk7CiAgICAgIHRoaXMuYXhpc0EgPSBvcHRpb25zLmF4aXNBID8gb3B0aW9ucy5heGlzQS5jbG9uZSgpIDogbmV3IFZlYzMoMSwgMCwgMCk7CiAgICAgIHRoaXMuYXhpc0IgPSBvcHRpb25zLmF4aXNCID8gb3B0aW9ucy5heGlzQi5jbG9uZSgpIDogbmV3IFZlYzMoMCwgMSwgMCk7CiAgICAgIHRoaXMubWF4QW5nbGUgPSBNYXRoLlBJIC8gMjsKICAgIH0KCiAgICBjb21wdXRlQihoKSB7CiAgICAgIGNvbnN0IGEgPSB0aGlzLmE7CiAgICAgIGNvbnN0IGIgPSB0aGlzLmI7CiAgICAgIGNvbnN0IG5pID0gdGhpcy5heGlzQTsKICAgICAgY29uc3QgbmogPSB0aGlzLmF4aXNCOwogICAgICBjb25zdCBuaXhuaiA9IHRtcFZlYzEkMTsKICAgICAgY29uc3Qgbmp4bmkgPSB0bXBWZWMyJDE7CiAgICAgIGNvbnN0IEdBID0gdGhpcy5qYWNvYmlhbkVsZW1lbnRBOwogICAgICBjb25zdCBHQiA9IHRoaXMuamFjb2JpYW5FbGVtZW50QjsgLy8gQ2FsdWNsYXRlIGNyb3NzIHByb2R1Y3RzCgogICAgICBuaS5jcm9zcyhuaiwgbml4bmopOwogICAgICBuai5jcm9zcyhuaSwgbmp4bmkpOyAvLyBnID0gbmkgKiBuagogICAgICAvLyBnZG90ID0gKG5qIHggbmkpICogd2kgKyAobmkgeCBuaikgKiB3agogICAgICAvLyBHID0gWzAgbmp4bmkgMCBuaXhual0KICAgICAgLy8gVyA9IFt2aSB3aSB2aiB3al0KCiAgICAgIEdBLnJvdGF0aW9uYWwuY29weShuanhuaSk7CiAgICAgIEdCLnJvdGF0aW9uYWwuY29weShuaXhuaik7CiAgICAgIGNvbnN0IGcgPSBNYXRoLmNvcyh0aGlzLm1heEFuZ2xlKSAtIG5pLmRvdChuaik7CiAgICAgIGNvbnN0IEdXID0gdGhpcy5jb21wdXRlR1coKTsKICAgICAgY29uc3QgR2lNZiA9IHRoaXMuY29tcHV0ZUdpTWYoKTsKICAgICAgY29uc3QgQiA9IC1nICogYSAtIEdXICogYiAtIGggKiBHaU1mOwogICAgICByZXR1cm4gQjsKICAgIH0KCiAgfQogIGNvbnN0IHRtcFZlYzEkMSA9IG5ldyBWZWMzKCk7CiAgY29uc3QgdG1wVmVjMiQxID0gbmV3IFZlYzMoKTsKCiAgLyoqCiAgICogQSBDb25lIFR3aXN0IGNvbnN0cmFpbnQsIHVzZWZ1bCBmb3IgcmFnZG9sbHMuCiAgICovCiAgY2xhc3MgQ29uZVR3aXN0Q29uc3RyYWludCBleHRlbmRzIFBvaW50VG9Qb2ludENvbnN0cmFpbnQgewogICAgLyoqCiAgICAgKiBUaGUgYXhpcyBkaXJlY3Rpb24gZm9yIHRoZSBjb25zdHJhaW50IG9mIHRoZSBib2R5IEEuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFRoZSBheGlzIGRpcmVjdGlvbiBmb3IgdGhlIGNvbnN0cmFpbnQgb2YgdGhlIGJvZHkgQi4KICAgICAqLwoKICAgIC8qKgogICAgICogVGhlIGFwZXJ0dXJlIGFuZ2xlIG9mIHRoZSBjb25lLgogICAgICovCgogICAgLyoqCiAgICAgKiBUaGUgdHdpc3QgYW5nbGUgb2YgdGhlIGpvaW50LgogICAgICovCiAgICBjb25zdHJ1Y3Rvcihib2R5QSwgYm9keUIsIG9wdGlvbnMpIHsKICAgICAgaWYgKG9wdGlvbnMgPT09IHZvaWQgMCkgewogICAgICAgIG9wdGlvbnMgPSB7fTsKICAgICAgfQoKICAgICAgY29uc3QgbWF4Rm9yY2UgPSB0eXBlb2Ygb3B0aW9ucy5tYXhGb3JjZSAhPT0gJ3VuZGVmaW5lZCcgPyBvcHRpb25zLm1heEZvcmNlIDogMWU2OyAvLyBTZXQgcGl2b3QgcG9pbnQgaW4gYmV0d2VlbgoKICAgICAgY29uc3QgcGl2b3RBID0gb3B0aW9ucy5waXZvdEEgPyBvcHRpb25zLnBpdm90QS5jbG9uZSgpIDogbmV3IFZlYzMoKTsKICAgICAgY29uc3QgcGl2b3RCID0gb3B0aW9ucy5waXZvdEIgPyBvcHRpb25zLnBpdm90Qi5jbG9uZSgpIDogbmV3IFZlYzMoKTsKICAgICAgc3VwZXIoYm9keUEsIHBpdm90QSwgYm9keUIsIHBpdm90QiwgbWF4Rm9yY2UpOwogICAgICB0aGlzLmF4aXNBID0gb3B0aW9ucy5heGlzQSA/IG9wdGlvbnMuYXhpc0EuY2xvbmUoKSA6IG5ldyBWZWMzKCk7CiAgICAgIHRoaXMuYXhpc0IgPSBvcHRpb25zLmF4aXNCID8gb3B0aW9ucy5heGlzQi5jbG9uZSgpIDogbmV3IFZlYzMoKTsKICAgICAgdGhpcy5jb2xsaWRlQ29ubmVjdGVkID0gISFvcHRpb25zLmNvbGxpZGVDb25uZWN0ZWQ7CiAgICAgIHRoaXMuYW5nbGUgPSB0eXBlb2Ygb3B0aW9ucy5hbmdsZSAhPT0gJ3VuZGVmaW5lZCcgPyBvcHRpb25zLmFuZ2xlIDogMDsKICAgICAgY29uc3QgYyA9IHRoaXMuY29uZUVxdWF0aW9uID0gbmV3IENvbmVFcXVhdGlvbihib2R5QSwgYm9keUIsIG9wdGlvbnMpOwogICAgICBjb25zdCB0ID0gdGhpcy50d2lzdEVxdWF0aW9uID0gbmV3IFJvdGF0aW9uYWxFcXVhdGlvbihib2R5QSwgYm9keUIsIG9wdGlvbnMpOwogICAgICB0aGlzLnR3aXN0QW5nbGUgPSB0eXBlb2Ygb3B0aW9ucy50d2lzdEFuZ2xlICE9PSAndW5kZWZpbmVkJyA/IG9wdGlvbnMudHdpc3RBbmdsZSA6IDA7IC8vIE1ha2UgdGhlIGNvbmUgZXF1YXRpb24gcHVzaCB0aGUgYm9kaWVzIHRvd2FyZCB0aGUgY29uZSBheGlzLCBub3Qgb3V0d2FyZAoKICAgICAgYy5tYXhGb3JjZSA9IDA7CiAgICAgIGMubWluRm9yY2UgPSAtbWF4Rm9yY2U7IC8vIE1ha2UgdGhlIHR3aXN0IGVxdWF0aW9uIGFkZCB0b3JxdWUgdG93YXJkIHRoZSBpbml0aWFsIHBvc2l0aW9uCgogICAgICB0Lm1heEZvcmNlID0gMDsKICAgICAgdC5taW5Gb3JjZSA9IC1tYXhGb3JjZTsKICAgICAgdGhpcy5lcXVhdGlvbnMucHVzaChjLCB0KTsKICAgIH0KCiAgICB1cGRhdGUoKSB7CiAgICAgIGNvbnN0IGJvZHlBID0gdGhpcy5ib2R5QTsKICAgICAgY29uc3QgYm9keUIgPSB0aGlzLmJvZHlCOwogICAgICBjb25zdCBjb25lID0gdGhpcy5jb25lRXF1YXRpb247CiAgICAgIGNvbnN0IHR3aXN0ID0gdGhpcy50d2lzdEVxdWF0aW9uOwogICAgICBzdXBlci51cGRhdGUoKTsgLy8gVXBkYXRlIHRoZSBheGVzIHRvIHRoZSBjb25lIGNvbnN0cmFpbnQKCiAgICAgIGJvZHlBLnZlY3RvclRvV29ybGRGcmFtZSh0aGlzLmF4aXNBLCBjb25lLmF4aXNBKTsKICAgICAgYm9keUIudmVjdG9yVG9Xb3JsZEZyYW1lKHRoaXMuYXhpc0IsIGNvbmUuYXhpc0IpOyAvLyBVcGRhdGUgdGhlIHdvcmxkIGF4ZXMgaW4gdGhlIHR3aXN0IGNvbnN0cmFpbnQKCiAgICAgIHRoaXMuYXhpc0EudGFuZ2VudHModHdpc3QuYXhpc0EsIHR3aXN0LmF4aXNBKTsKICAgICAgYm9keUEudmVjdG9yVG9Xb3JsZEZyYW1lKHR3aXN0LmF4aXNBLCB0d2lzdC5heGlzQSk7CiAgICAgIHRoaXMuYXhpc0IudGFuZ2VudHModHdpc3QuYXhpc0IsIHR3aXN0LmF4aXNCKTsKICAgICAgYm9keUIudmVjdG9yVG9Xb3JsZEZyYW1lKHR3aXN0LmF4aXNCLCB0d2lzdC5heGlzQik7CiAgICAgIGNvbmUuYW5nbGUgPSB0aGlzLmFuZ2xlOwogICAgICB0d2lzdC5tYXhBbmdsZSA9IHRoaXMudHdpc3RBbmdsZTsKICAgIH0KCiAgfQogIG5ldyBWZWMzKCk7CiAgbmV3IFZlYzMoKTsKCiAgLyoqCiAgICogQ29uc3RyYWlucyB0d28gYm9kaWVzIHRvIGJlIGF0IGEgY29uc3RhbnQgZGlzdGFuY2UgZnJvbSBlYWNoIG90aGVycyBjZW50ZXIgb2YgbWFzcy4KICAgKi8KICBjbGFzcyBEaXN0YW5jZUNvbnN0cmFpbnQgZXh0ZW5kcyBDb25zdHJhaW50IHsKICAgIC8qKgogICAgICogVGhlIGRpc3RhbmNlIHRvIGtlZXAuIElmIHVuZGVmaW5lZCwgaXQgd2lsbCBiZSBzZXQgdG8gdGhlIGN1cnJlbnQgZGlzdGFuY2UgYmV0d2VlbiBib2R5QSBhbmQgYm9keUIKICAgICAqLwoKICAgIC8qKgogICAgICogQHBhcmFtIGRpc3RhbmNlIFRoZSBkaXN0YW5jZSB0byBrZWVwLiBJZiB1bmRlZmluZWQsIGl0IHdpbGwgYmUgc2V0IHRvIHRoZSBjdXJyZW50IGRpc3RhbmNlIGJldHdlZW4gYm9keUEgYW5kIGJvZHlCLgogICAgICogQHBhcmFtIG1heEZvcmNlIFRoZSBtYXhpbXVtIGZvcmNlIHRoYXQgc2hvdWxkIGJlIGFwcGxpZWQgdG8gY29uc3RyYWluIHRoZSBib2RpZXMuCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKGJvZHlBLCBib2R5QiwgZGlzdGFuY2UsIG1heEZvcmNlKSB7CiAgICAgIGlmIChtYXhGb3JjZSA9PT0gdm9pZCAwKSB7CiAgICAgICAgbWF4Rm9yY2UgPSAxZTY7CiAgICAgIH0KCiAgICAgIHN1cGVyKGJvZHlBLCBib2R5Qik7CgogICAgICBpZiAodHlwZW9mIGRpc3RhbmNlID09PSAndW5kZWZpbmVkJykgewogICAgICAgIGRpc3RhbmNlID0gYm9keUEucG9zaXRpb24uZGlzdGFuY2VUbyhib2R5Qi5wb3NpdGlvbik7CiAgICAgIH0KCiAgICAgIHRoaXMuZGlzdGFuY2UgPSBkaXN0YW5jZTsKICAgICAgY29uc3QgZXEgPSB0aGlzLmRpc3RhbmNlRXF1YXRpb24gPSBuZXcgQ29udGFjdEVxdWF0aW9uKGJvZHlBLCBib2R5Qik7CiAgICAgIHRoaXMuZXF1YXRpb25zLnB1c2goZXEpOyAvLyBNYWtlIGl0IGJpZGlyZWN0aW9uYWwKCiAgICAgIGVxLm1pbkZvcmNlID0gLW1heEZvcmNlOwogICAgICBlcS5tYXhGb3JjZSA9IG1heEZvcmNlOwogICAgfQogICAgLyoqCiAgICAgKiB1cGRhdGUKICAgICAqLwoKCiAgICB1cGRhdGUoKSB7CiAgICAgIGNvbnN0IGJvZHlBID0gdGhpcy5ib2R5QTsKICAgICAgY29uc3QgYm9keUIgPSB0aGlzLmJvZHlCOwogICAgICBjb25zdCBlcSA9IHRoaXMuZGlzdGFuY2VFcXVhdGlvbjsKICAgICAgY29uc3QgaGFsZkRpc3QgPSB0aGlzLmRpc3RhbmNlICogMC41OwogICAgICBjb25zdCBub3JtYWwgPSBlcS5uaTsKICAgICAgYm9keUIucG9zaXRpb24udnN1Yihib2R5QS5wb3NpdGlvbiwgbm9ybWFsKTsKICAgICAgbm9ybWFsLm5vcm1hbGl6ZSgpOwogICAgICBub3JtYWwuc2NhbGUoaGFsZkRpc3QsIGVxLnJpKTsKICAgICAgbm9ybWFsLnNjYWxlKC1oYWxmRGlzdCwgZXEucmopOwogICAgfQoKICB9CgogIC8qKgogICAqIExvY2sgY29uc3RyYWludC4gV2lsbCByZW1vdmUgYWxsIGRlZ3JlZXMgb2YgZnJlZWRvbSBiZXR3ZWVuIHRoZSBib2RpZXMuCiAgICovCiAgY2xhc3MgTG9ja0NvbnN0cmFpbnQgZXh0ZW5kcyBQb2ludFRvUG9pbnRDb25zdHJhaW50IHsKICAgIGNvbnN0cnVjdG9yKGJvZHlBLCBib2R5Qiwgb3B0aW9ucykgewogICAgICBpZiAob3B0aW9ucyA9PT0gdm9pZCAwKSB7CiAgICAgICAgb3B0aW9ucyA9IHt9OwogICAgICB9CgogICAgICBjb25zdCBtYXhGb3JjZSA9IHR5cGVvZiBvcHRpb25zLm1heEZvcmNlICE9PSAndW5kZWZpbmVkJyA/IG9wdGlvbnMubWF4Rm9yY2UgOiAxZTY7IC8vIFNldCBwaXZvdCBwb2ludCBpbiBiZXR3ZWVuCgogICAgICBjb25zdCBwaXZvdEEgPSBuZXcgVmVjMygpOwogICAgICBjb25zdCBwaXZvdEIgPSBuZXcgVmVjMygpOwogICAgICBjb25zdCBoYWxmV2F5ID0gbmV3IFZlYzMoKTsKICAgICAgYm9keUEucG9zaXRpb24udmFkZChib2R5Qi5wb3NpdGlvbiwgaGFsZldheSk7CiAgICAgIGhhbGZXYXkuc2NhbGUoMC41LCBoYWxmV2F5KTsKICAgICAgYm9keUIucG9pbnRUb0xvY2FsRnJhbWUoaGFsZldheSwgcGl2b3RCKTsKICAgICAgYm9keUEucG9pbnRUb0xvY2FsRnJhbWUoaGFsZldheSwgcGl2b3RBKTsgLy8gVGhlIHBvaW50LXRvLXBvaW50IGNvbnN0cmFpbnQgd2lsbCBrZWVwIGEgcG9pbnQgc2hhcmVkIGJldHdlZW4gdGhlIGJvZGllcwoKICAgICAgc3VwZXIoYm9keUEsIHBpdm90QSwgYm9keUIsIHBpdm90QiwgbWF4Rm9yY2UpOyAvLyBTdG9yZSBpbml0aWFsIHJvdGF0aW9uIG9mIHRoZSBib2RpZXMgYXMgdW5pdCB2ZWN0b3JzIGluIHRoZSBsb2NhbCBib2R5IHNwYWNlcwoKICAgICAgdGhpcy54QSA9IGJvZHlBLnZlY3RvclRvTG9jYWxGcmFtZShWZWMzLlVOSVRfWCk7CiAgICAgIHRoaXMueEIgPSBib2R5Qi52ZWN0b3JUb0xvY2FsRnJhbWUoVmVjMy5VTklUX1gpOwogICAgICB0aGlzLnlBID0gYm9keUEudmVjdG9yVG9Mb2NhbEZyYW1lKFZlYzMuVU5JVF9ZKTsKICAgICAgdGhpcy55QiA9IGJvZHlCLnZlY3RvclRvTG9jYWxGcmFtZShWZWMzLlVOSVRfWSk7CiAgICAgIHRoaXMuekEgPSBib2R5QS52ZWN0b3JUb0xvY2FsRnJhbWUoVmVjMy5VTklUX1opOwogICAgICB0aGlzLnpCID0gYm9keUIudmVjdG9yVG9Mb2NhbEZyYW1lKFZlYzMuVU5JVF9aKTsgLy8gLi4uYW5kIHRoZSBmb2xsb3dpbmcgcm90YXRpb25hbCBlcXVhdGlvbnMgd2lsbCBrZWVwIGFsbCByb3RhdGlvbmFsIERPRidzIGluIHBsYWNlCgogICAgICBjb25zdCByMSA9IHRoaXMucm90YXRpb25hbEVxdWF0aW9uMSA9IG5ldyBSb3RhdGlvbmFsRXF1YXRpb24oYm9keUEsIGJvZHlCLCBvcHRpb25zKTsKICAgICAgY29uc3QgcjIgPSB0aGlzLnJvdGF0aW9uYWxFcXVhdGlvbjIgPSBuZXcgUm90YXRpb25hbEVxdWF0aW9uKGJvZHlBLCBib2R5Qiwgb3B0aW9ucyk7CiAgICAgIGNvbnN0IHIzID0gdGhpcy5yb3RhdGlvbmFsRXF1YXRpb24zID0gbmV3IFJvdGF0aW9uYWxFcXVhdGlvbihib2R5QSwgYm9keUIsIG9wdGlvbnMpOwogICAgICB0aGlzLmVxdWF0aW9ucy5wdXNoKHIxLCByMiwgcjMpOwogICAgfQogICAgLyoqCiAgICAgKiB1cGRhdGUKICAgICAqLwoKCiAgICB1cGRhdGUoKSB7CiAgICAgIGNvbnN0IGJvZHlBID0gdGhpcy5ib2R5QTsKICAgICAgY29uc3QgYm9keUIgPSB0aGlzLmJvZHlCOwogICAgICB0aGlzLm1vdG9yRXF1YXRpb247CiAgICAgIGNvbnN0IHIxID0gdGhpcy5yb3RhdGlvbmFsRXF1YXRpb24xOwogICAgICBjb25zdCByMiA9IHRoaXMucm90YXRpb25hbEVxdWF0aW9uMjsKICAgICAgY29uc3QgcjMgPSB0aGlzLnJvdGF0aW9uYWxFcXVhdGlvbjM7CiAgICAgIHN1cGVyLnVwZGF0ZSgpOyAvLyBUaGVzZSB2ZWN0b3IgcGFpcnMgbXVzdCBiZSBvcnRob2dvbmFsCgogICAgICBib2R5QS52ZWN0b3JUb1dvcmxkRnJhbWUodGhpcy54QSwgcjEuYXhpc0EpOwogICAgICBib2R5Qi52ZWN0b3JUb1dvcmxkRnJhbWUodGhpcy55QiwgcjEuYXhpc0IpOwogICAgICBib2R5QS52ZWN0b3JUb1dvcmxkRnJhbWUodGhpcy55QSwgcjIuYXhpc0EpOwogICAgICBib2R5Qi52ZWN0b3JUb1dvcmxkRnJhbWUodGhpcy56QiwgcjIuYXhpc0IpOwogICAgICBib2R5QS52ZWN0b3JUb1dvcmxkRnJhbWUodGhpcy56QSwgcjMuYXhpc0EpOwogICAgICBib2R5Qi52ZWN0b3JUb1dvcmxkRnJhbWUodGhpcy54QiwgcjMuYXhpc0IpOwogICAgfQoKICB9CiAgbmV3IFZlYzMoKTsKICBuZXcgVmVjMygpOwoKICAvKioKICAgKiBSb3RhdGlvbmFsIG1vdG9yIGNvbnN0cmFpbnQuIFRyaWVzIHRvIGtlZXAgdGhlIHJlbGF0aXZlIGFuZ3VsYXIgdmVsb2NpdHkgb2YgdGhlIGJvZGllcyB0byBhIGdpdmVuIHZhbHVlLgogICAqLwogIGNsYXNzIFJvdGF0aW9uYWxNb3RvckVxdWF0aW9uIGV4dGVuZHMgRXF1YXRpb24gewogICAgLyoqCiAgICAgKiBXb3JsZCBvcmllbnRlZCByb3RhdGlvbmFsIGF4aXMuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFdvcmxkIG9yaWVudGVkIHJvdGF0aW9uYWwgYXhpcy4KICAgICAqLwoKICAgIC8qKgogICAgICogTW90b3IgdmVsb2NpdHkuCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKGJvZHlBLCBib2R5QiwgbWF4Rm9yY2UpIHsKICAgICAgaWYgKG1heEZvcmNlID09PSB2b2lkIDApIHsKICAgICAgICBtYXhGb3JjZSA9IDFlNjsKICAgICAgfQoKICAgICAgc3VwZXIoYm9keUEsIGJvZHlCLCAtbWF4Rm9yY2UsIG1heEZvcmNlKTsKICAgICAgdGhpcy5heGlzQSA9IG5ldyBWZWMzKCk7CiAgICAgIHRoaXMuYXhpc0IgPSBuZXcgVmVjMygpOwogICAgICB0aGlzLnRhcmdldFZlbG9jaXR5ID0gMDsKICAgIH0KCiAgICBjb21wdXRlQihoKSB7CiAgICAgIHRoaXMuYTsKICAgICAgY29uc3QgYiA9IHRoaXMuYjsKICAgICAgdGhpcy5iaTsKICAgICAgdGhpcy5iajsKICAgICAgY29uc3QgYXhpc0EgPSB0aGlzLmF4aXNBOwogICAgICBjb25zdCBheGlzQiA9IHRoaXMuYXhpc0I7CiAgICAgIGNvbnN0IEdBID0gdGhpcy5qYWNvYmlhbkVsZW1lbnRBOwogICAgICBjb25zdCBHQiA9IHRoaXMuamFjb2JpYW5FbGVtZW50QjsgLy8gZyA9IDAKICAgICAgLy8gZ2RvdCA9IGF4aXNBICogd2kgLSBheGlzQiAqIHdqCiAgICAgIC8vIGdkb3QgPSBHICogVyA9IEcgKiBbdmkgd2kgdmogd2pdCiAgICAgIC8vID0+CiAgICAgIC8vIEcgPSBbMCBheGlzQSAwIC1heGlzQl0KCiAgICAgIEdBLnJvdGF0aW9uYWwuY29weShheGlzQSk7CiAgICAgIGF4aXNCLm5lZ2F0ZShHQi5yb3RhdGlvbmFsKTsKICAgICAgY29uc3QgR1cgPSB0aGlzLmNvbXB1dGVHVygpIC0gdGhpcy50YXJnZXRWZWxvY2l0eTsKICAgICAgY29uc3QgR2lNZiA9IHRoaXMuY29tcHV0ZUdpTWYoKTsKICAgICAgY29uc3QgQiA9IC1HVyAqIGIgLSBoICogR2lNZjsKICAgICAgcmV0dXJuIEI7CiAgICB9CgogIH0KCiAgLyoqCiAgICogSGluZ2UgY29uc3RyYWludC4gVGhpbmsgb2YgaXQgYXMgYSBkb29yIGhpbmdlLiBJdCB0cmllcyB0byBrZWVwIHRoZSBkb29yIGluIHRoZSBjb3JyZWN0IHBsYWNlIGFuZCB3aXRoIHRoZSBjb3JyZWN0IG9yaWVudGF0aW9uLgogICAqLwogIGNsYXNzIEhpbmdlQ29uc3RyYWludCBleHRlbmRzIFBvaW50VG9Qb2ludENvbnN0cmFpbnQgewogICAgLyoqCiAgICAgKiBSb3RhdGlvbiBheGlzLCBkZWZpbmVkIGxvY2FsbHkgaW4gYm9keUEuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFJvdGF0aW9uIGF4aXMsIGRlZmluZWQgbG9jYWxseSBpbiBib2R5Qi4KICAgICAqLwogICAgY29uc3RydWN0b3IoYm9keUEsIGJvZHlCLCBvcHRpb25zKSB7CiAgICAgIGlmIChvcHRpb25zID09PSB2b2lkIDApIHsKICAgICAgICBvcHRpb25zID0ge307CiAgICAgIH0KCiAgICAgIGNvbnN0IG1heEZvcmNlID0gdHlwZW9mIG9wdGlvbnMubWF4Rm9yY2UgIT09ICd1bmRlZmluZWQnID8gb3B0aW9ucy5tYXhGb3JjZSA6IDFlNjsKICAgICAgY29uc3QgcGl2b3RBID0gb3B0aW9ucy5waXZvdEEgPyBvcHRpb25zLnBpdm90QS5jbG9uZSgpIDogbmV3IFZlYzMoKTsKICAgICAgY29uc3QgcGl2b3RCID0gb3B0aW9ucy5waXZvdEIgPyBvcHRpb25zLnBpdm90Qi5jbG9uZSgpIDogbmV3IFZlYzMoKTsKICAgICAgc3VwZXIoYm9keUEsIHBpdm90QSwgYm9keUIsIHBpdm90QiwgbWF4Rm9yY2UpOwogICAgICBjb25zdCBheGlzQSA9IHRoaXMuYXhpc0EgPSBvcHRpb25zLmF4aXNBID8gb3B0aW9ucy5heGlzQS5jbG9uZSgpIDogbmV3IFZlYzMoMSwgMCwgMCk7CiAgICAgIGF4aXNBLm5vcm1hbGl6ZSgpOwogICAgICBjb25zdCBheGlzQiA9IHRoaXMuYXhpc0IgPSBvcHRpb25zLmF4aXNCID8gb3B0aW9ucy5heGlzQi5jbG9uZSgpIDogbmV3IFZlYzMoMSwgMCwgMCk7CiAgICAgIGF4aXNCLm5vcm1hbGl6ZSgpOwogICAgICB0aGlzLmNvbGxpZGVDb25uZWN0ZWQgPSAhIW9wdGlvbnMuY29sbGlkZUNvbm5lY3RlZDsKICAgICAgY29uc3Qgcm90YXRpb25hbDEgPSB0aGlzLnJvdGF0aW9uYWxFcXVhdGlvbjEgPSBuZXcgUm90YXRpb25hbEVxdWF0aW9uKGJvZHlBLCBib2R5Qiwgb3B0aW9ucyk7CiAgICAgIGNvbnN0IHJvdGF0aW9uYWwyID0gdGhpcy5yb3RhdGlvbmFsRXF1YXRpb24yID0gbmV3IFJvdGF0aW9uYWxFcXVhdGlvbihib2R5QSwgYm9keUIsIG9wdGlvbnMpOwogICAgICBjb25zdCBtb3RvciA9IHRoaXMubW90b3JFcXVhdGlvbiA9IG5ldyBSb3RhdGlvbmFsTW90b3JFcXVhdGlvbihib2R5QSwgYm9keUIsIG1heEZvcmNlKTsKICAgICAgbW90b3IuZW5hYmxlZCA9IGZhbHNlOyAvLyBOb3QgZW5hYmxlZCBieSBkZWZhdWx0CiAgICAgIC8vIEVxdWF0aW9ucyB0byBiZSBmZWQgdG8gdGhlIHNvbHZlcgoKICAgICAgdGhpcy5lcXVhdGlvbnMucHVzaChyb3RhdGlvbmFsMSwgcm90YXRpb25hbDIsIG1vdG9yKTsKICAgIH0KICAgIC8qKgogICAgICogZW5hYmxlTW90b3IKICAgICAqLwoKCiAgICBlbmFibGVNb3RvcigpIHsKICAgICAgdGhpcy5tb3RvckVxdWF0aW9uLmVuYWJsZWQgPSB0cnVlOwogICAgfQogICAgLyoqCiAgICAgKiBkaXNhYmxlTW90b3IKICAgICAqLwoKCiAgICBkaXNhYmxlTW90b3IoKSB7CiAgICAgIHRoaXMubW90b3JFcXVhdGlvbi5lbmFibGVkID0gZmFsc2U7CiAgICB9CiAgICAvKioKICAgICAqIHNldE1vdG9yU3BlZWQKICAgICAqLwoKCiAgICBzZXRNb3RvclNwZWVkKHNwZWVkKSB7CiAgICAgIHRoaXMubW90b3JFcXVhdGlvbi50YXJnZXRWZWxvY2l0eSA9IHNwZWVkOwogICAgfQogICAgLyoqCiAgICAgKiBzZXRNb3Rvck1heEZvcmNlCiAgICAgKi8KCgogICAgc2V0TW90b3JNYXhGb3JjZShtYXhGb3JjZSkgewogICAgICB0aGlzLm1vdG9yRXF1YXRpb24ubWF4Rm9yY2UgPSBtYXhGb3JjZTsKICAgICAgdGhpcy5tb3RvckVxdWF0aW9uLm1pbkZvcmNlID0gLW1heEZvcmNlOwogICAgfQogICAgLyoqCiAgICAgKiB1cGRhdGUKICAgICAqLwoKCiAgICB1cGRhdGUoKSB7CiAgICAgIGNvbnN0IGJvZHlBID0gdGhpcy5ib2R5QTsKICAgICAgY29uc3QgYm9keUIgPSB0aGlzLmJvZHlCOwogICAgICBjb25zdCBtb3RvciA9IHRoaXMubW90b3JFcXVhdGlvbjsKICAgICAgY29uc3QgcjEgPSB0aGlzLnJvdGF0aW9uYWxFcXVhdGlvbjE7CiAgICAgIGNvbnN0IHIyID0gdGhpcy5yb3RhdGlvbmFsRXF1YXRpb24yOwogICAgICBjb25zdCB3b3JsZEF4aXNBID0gSGluZ2VDb25zdHJhaW50X3VwZGF0ZV90bXBWZWMxOwogICAgICBjb25zdCB3b3JsZEF4aXNCID0gSGluZ2VDb25zdHJhaW50X3VwZGF0ZV90bXBWZWMyOwogICAgICBjb25zdCBheGlzQSA9IHRoaXMuYXhpc0E7CiAgICAgIGNvbnN0IGF4aXNCID0gdGhpcy5heGlzQjsKICAgICAgc3VwZXIudXBkYXRlKCk7IC8vIEdldCB3b3JsZCBheGVzCgogICAgICBib2R5QS5xdWF0ZXJuaW9uLnZtdWx0KGF4aXNBLCB3b3JsZEF4aXNBKTsKICAgICAgYm9keUIucXVhdGVybmlvbi52bXVsdChheGlzQiwgd29ybGRBeGlzQik7CiAgICAgIHdvcmxkQXhpc0EudGFuZ2VudHMocjEuYXhpc0EsIHIyLmF4aXNBKTsKICAgICAgcjEuYXhpc0IuY29weSh3b3JsZEF4aXNCKTsKICAgICAgcjIuYXhpc0IuY29weSh3b3JsZEF4aXNCKTsKCiAgICAgIGlmICh0aGlzLm1vdG9yRXF1YXRpb24uZW5hYmxlZCkgewogICAgICAgIGJvZHlBLnF1YXRlcm5pb24udm11bHQodGhpcy5heGlzQSwgbW90b3IuYXhpc0EpOwogICAgICAgIGJvZHlCLnF1YXRlcm5pb24udm11bHQodGhpcy5heGlzQiwgbW90b3IuYXhpc0IpOwogICAgICB9CiAgICB9CgogIH0KICBjb25zdCBIaW5nZUNvbnN0cmFpbnRfdXBkYXRlX3RtcFZlYzEgPSBuZXcgVmVjMygpOwogIGNvbnN0IEhpbmdlQ29uc3RyYWludF91cGRhdGVfdG1wVmVjMiA9IG5ldyBWZWMzKCk7CgogIC8qKgogICAqIENvbnN0cmFpbnMgdGhlIHNsaXBwaW5nIGluIGEgY29udGFjdCBhbG9uZyBhIHRhbmdlbnQKICAgKi8KICBjbGFzcyBGcmljdGlvbkVxdWF0aW9uIGV4dGVuZHMgRXF1YXRpb24gewogICAgLy8gVGFuZ2VudAoKICAgIC8qKgogICAgICogQHBhcmFtIHNsaXBGb3JjZSBzaG91bGQgYmUgKy1GX2ZyaWN0aW9uID0gKy1tdSAqIEZfbm9ybWFsID0gKy1tdSAqIG0gKiBnCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKGJvZHlBLCBib2R5Qiwgc2xpcEZvcmNlKSB7CiAgICAgIHN1cGVyKGJvZHlBLCBib2R5QiwgLXNsaXBGb3JjZSwgc2xpcEZvcmNlKTsKICAgICAgdGhpcy5yaSA9IG5ldyBWZWMzKCk7CiAgICAgIHRoaXMucmogPSBuZXcgVmVjMygpOwogICAgICB0aGlzLnQgPSBuZXcgVmVjMygpOwogICAgfQoKICAgIGNvbXB1dGVCKGgpIHsKICAgICAgdGhpcy5hOwogICAgICBjb25zdCBiID0gdGhpcy5iOwogICAgICB0aGlzLmJpOwogICAgICB0aGlzLmJqOwogICAgICBjb25zdCByaSA9IHRoaXMucmk7CiAgICAgIGNvbnN0IHJqID0gdGhpcy5yajsKICAgICAgY29uc3Qgcml4dCA9IEZyaWN0aW9uRXF1YXRpb25fY29tcHV0ZUJfdGVtcDE7CiAgICAgIGNvbnN0IHJqeHQgPSBGcmljdGlvbkVxdWF0aW9uX2NvbXB1dGVCX3RlbXAyOwogICAgICBjb25zdCB0ID0gdGhpcy50OyAvLyBDYWx1Y2xhdGUgY3Jvc3MgcHJvZHVjdHMKCiAgICAgIHJpLmNyb3NzKHQsIHJpeHQpOwogICAgICByai5jcm9zcyh0LCByanh0KTsgLy8gRyA9IFstdCAtcml4dCB0IHJqeHRdCiAgICAgIC8vIEFuZCByZW1lbWJlciwgdGhpcyBpcyBhIHB1cmUgdmVsb2NpdHkgY29uc3RyYWludCwgZyBpcyBhbHdheXMgemVybyEKCiAgICAgIGNvbnN0IEdBID0gdGhpcy5qYWNvYmlhbkVsZW1lbnRBOwogICAgICBjb25zdCBHQiA9IHRoaXMuamFjb2JpYW5FbGVtZW50QjsKICAgICAgdC5uZWdhdGUoR0Euc3BhdGlhbCk7CiAgICAgIHJpeHQubmVnYXRlKEdBLnJvdGF0aW9uYWwpOwogICAgICBHQi5zcGF0aWFsLmNvcHkodCk7CiAgICAgIEdCLnJvdGF0aW9uYWwuY29weShyanh0KTsKICAgICAgY29uc3QgR1cgPSB0aGlzLmNvbXB1dGVHVygpOwogICAgICBjb25zdCBHaU1mID0gdGhpcy5jb21wdXRlR2lNZigpOwogICAgICBjb25zdCBCID0gLUdXICogYiAtIGggKiBHaU1mOwogICAgICByZXR1cm4gQjsKICAgIH0KCiAgfQogIGNvbnN0IEZyaWN0aW9uRXF1YXRpb25fY29tcHV0ZUJfdGVtcDEgPSBuZXcgVmVjMygpOwogIGNvbnN0IEZyaWN0aW9uRXF1YXRpb25fY29tcHV0ZUJfdGVtcDIgPSBuZXcgVmVjMygpOwoKICAvKioKICAgKiBEZWZpbmVzIHdoYXQgaGFwcGVucyB3aGVuIHR3byBtYXRlcmlhbHMgbWVldC4KICAgKiBAdG9kbyBSZWZhY3RvciBtYXRlcmlhbHMgdG8gbWF0ZXJpYWxBIGFuZCBtYXRlcmlhbEIKICAgKi8KICBjbGFzcyBDb250YWN0TWF0ZXJpYWwgewogICAgLyoqCiAgICAgKiBJZGVudGlmaWVyIG9mIHRoaXMgbWF0ZXJpYWwuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFBhcnRpY2lwYXRpbmcgbWF0ZXJpYWxzLgogICAgICovCgogICAgLyoqCiAgICAgKiBGcmljdGlvbiBjb2VmZmljaWVudC4KICAgICAqIEBkZWZhdWx0IDAuMwogICAgICovCgogICAgLyoqCiAgICAgKiBSZXN0aXR1dGlvbiBjb2VmZmljaWVudC4KICAgICAqIEBkZWZhdWx0IDAuMwogICAgICovCgogICAgLyoqCiAgICAgKiBTdGlmZm5lc3Mgb2YgdGhlIHByb2R1Y2VkIGNvbnRhY3QgZXF1YXRpb25zLgogICAgICogQGRlZmF1bHQgMWU3CiAgICAgKi8KCiAgICAvKioKICAgICAqIFJlbGF4YXRpb24gdGltZSBvZiB0aGUgcHJvZHVjZWQgY29udGFjdCBlcXVhdGlvbnMuCiAgICAgKiBAZGVmYXVsdCAzCiAgICAgKi8KCiAgICAvKioKICAgICAqIFN0aWZmbmVzcyBvZiB0aGUgcHJvZHVjZWQgZnJpY3Rpb24gZXF1YXRpb25zLgogICAgICogQGRlZmF1bHQgMWU3CiAgICAgKi8KCiAgICAvKioKICAgICAqIFJlbGF4YXRpb24gdGltZSBvZiB0aGUgcHJvZHVjZWQgZnJpY3Rpb24gZXF1YXRpb25zCiAgICAgKiBAZGVmYXVsdCAzCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKG0xLCBtMiwgb3B0aW9ucykgewogICAgICBvcHRpb25zID0gVXRpbHMuZGVmYXVsdHMob3B0aW9ucywgewogICAgICAgIGZyaWN0aW9uOiAwLjMsCiAgICAgICAgcmVzdGl0dXRpb246IDAuMywKICAgICAgICBjb250YWN0RXF1YXRpb25TdGlmZm5lc3M6IDFlNywKICAgICAgICBjb250YWN0RXF1YXRpb25SZWxheGF0aW9uOiAzLAogICAgICAgIGZyaWN0aW9uRXF1YXRpb25TdGlmZm5lc3M6IDFlNywKICAgICAgICBmcmljdGlvbkVxdWF0aW9uUmVsYXhhdGlvbjogMwogICAgICB9KTsKICAgICAgdGhpcy5pZCA9IENvbnRhY3RNYXRlcmlhbC5pZENvdW50ZXIrKzsKICAgICAgdGhpcy5tYXRlcmlhbHMgPSBbbTEsIG0yXTsKICAgICAgdGhpcy5mcmljdGlvbiA9IG9wdGlvbnMuZnJpY3Rpb247CiAgICAgIHRoaXMucmVzdGl0dXRpb24gPSBvcHRpb25zLnJlc3RpdHV0aW9uOwogICAgICB0aGlzLmNvbnRhY3RFcXVhdGlvblN0aWZmbmVzcyA9IG9wdGlvbnMuY29udGFjdEVxdWF0aW9uU3RpZmZuZXNzOwogICAgICB0aGlzLmNvbnRhY3RFcXVhdGlvblJlbGF4YXRpb24gPSBvcHRpb25zLmNvbnRhY3RFcXVhdGlvblJlbGF4YXRpb247CiAgICAgIHRoaXMuZnJpY3Rpb25FcXVhdGlvblN0aWZmbmVzcyA9IG9wdGlvbnMuZnJpY3Rpb25FcXVhdGlvblN0aWZmbmVzczsKICAgICAgdGhpcy5mcmljdGlvbkVxdWF0aW9uUmVsYXhhdGlvbiA9IG9wdGlvbnMuZnJpY3Rpb25FcXVhdGlvblJlbGF4YXRpb247CiAgICB9CgogIH0KICBDb250YWN0TWF0ZXJpYWwuaWRDb3VudGVyID0gMDsKCiAgLyoqCiAgICogRGVmaW5lcyBhIHBoeXNpY3MgbWF0ZXJpYWwuCiAgICovCiAgY2xhc3MgTWF0ZXJpYWwgewogICAgLyoqCiAgICAgKiBNYXRlcmlhbCBuYW1lLgogICAgICogSWYgb3B0aW9ucyBpcyBhIHN0cmluZywgbmFtZSB3aWxsIGJlIHNldCB0byB0aGF0IHN0cmluZy4KICAgICAqIEB0b2RvIERlcHJlY2F0ZSB0aGlzCiAgICAgKi8KCiAgICAvKiogTWF0ZXJpYWwgaWQuICovCgogICAgLyoqCiAgICAgKiBGcmljdGlvbiBmb3IgdGhpcyBtYXRlcmlhbC4KICAgICAqIElmIG5vbi1uZWdhdGl2ZSwgaXQgd2lsbCBiZSB1c2VkIGluc3RlYWQgb2YgdGhlIGZyaWN0aW9uIGdpdmVuIGJ5IENvbnRhY3RNYXRlcmlhbHMuIElmIHRoZXJlJ3Mgbm8gbWF0Y2hpbmcgQ29udGFjdE1hdGVyaWFsLCB0aGUgdmFsdWUgZnJvbSBgZGVmYXVsdENvbnRhY3RNYXRlcmlhbGAgaW4gdGhlIFdvcmxkIHdpbGwgYmUgdXNlZC4KICAgICAqLwoKICAgIC8qKgogICAgICogUmVzdGl0dXRpb24gZm9yIHRoaXMgbWF0ZXJpYWwuCiAgICAgKiBJZiBub24tbmVnYXRpdmUsIGl0IHdpbGwgYmUgdXNlZCBpbnN0ZWFkIG9mIHRoZSByZXN0aXR1dGlvbiBnaXZlbiBieSBDb250YWN0TWF0ZXJpYWxzLiBJZiB0aGVyZSdzIG5vIG1hdGNoaW5nIENvbnRhY3RNYXRlcmlhbCwgdGhlIHZhbHVlIGZyb20gYGRlZmF1bHRDb250YWN0TWF0ZXJpYWxgIGluIHRoZSBXb3JsZCB3aWxsIGJlIHVzZWQuCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKG9wdGlvbnMpIHsKICAgICAgaWYgKG9wdGlvbnMgPT09IHZvaWQgMCkgewogICAgICAgIG9wdGlvbnMgPSB7fTsKICAgICAgfQoKICAgICAgbGV0IG5hbWUgPSAnJzsgLy8gQmFja3dhcmRzIGNvbXBhdGliaWxpdHkgZml4CgogICAgICBpZiAodHlwZW9mIG9wdGlvbnMgPT09ICdzdHJpbmcnKSB7CiAgICAgICAgLy9jb25zb2xlLndhcm4oYFBhc3NpbmcgYSBzdHJpbmcgdG8gTWF0ZXJpYWxPcHRpb25zIGlzIGRlcHJlY2F0ZWQsIGFuZCBoYXMgbm8gZWZmZWN0YCkKICAgICAgICBuYW1lID0gb3B0aW9uczsKICAgICAgICBvcHRpb25zID0ge307CiAgICAgIH0KCiAgICAgIHRoaXMubmFtZSA9IG5hbWU7CiAgICAgIHRoaXMuaWQgPSBNYXRlcmlhbC5pZENvdW50ZXIrKzsKICAgICAgdGhpcy5mcmljdGlvbiA9IHR5cGVvZiBvcHRpb25zLmZyaWN0aW9uICE9PSAndW5kZWZpbmVkJyA/IG9wdGlvbnMuZnJpY3Rpb24gOiAtMTsKICAgICAgdGhpcy5yZXN0aXR1dGlvbiA9IHR5cGVvZiBvcHRpb25zLnJlc3RpdHV0aW9uICE9PSAndW5kZWZpbmVkJyA/IG9wdGlvbnMucmVzdGl0dXRpb24gOiAtMTsKICAgIH0KCiAgfQogIE1hdGVyaWFsLmlkQ291bnRlciA9IDA7CgogIC8qKgogICAqIEEgc3ByaW5nLCBjb25uZWN0aW5nIHR3byBib2RpZXMuCiAgICogQGV4YW1wbGUKICAgKiAgICAgY29uc3Qgc3ByaW5nID0gbmV3IFNwcmluZyhib3hCb2R5LCBzcGhlcmVCb2R5LCB7CiAgICogICAgICAgcmVzdExlbmd0aDogMCwKICAgKiAgICAgICBzdGlmZm5lc3M6IDUwLAogICAqICAgICAgIGRhbXBpbmc6IDEsCiAgICogICAgIH0pCiAgICoKICAgKiAgICAgLy8gQ29tcHV0ZSB0aGUgZm9yY2UgYWZ0ZXIgZWFjaCBzdGVwCiAgICogICAgIHdvcmxkLmFkZEV2ZW50TGlzdGVuZXIoJ3Bvc3RTdGVwJywgKGV2ZW50KSA9PiB7CiAgICogICAgICAgc3ByaW5nLmFwcGx5Rm9yY2UoKQogICAqICAgICB9KQogICAqLwogIGNsYXNzIFNwcmluZyB7CiAgICAvKioKICAgICAqIFJlc3QgbGVuZ3RoIG9mIHRoZSBzcHJpbmcuIEEgbnVtYmVyID4gMC4KICAgICAqIEBkZWZhdWx0IDEKICAgICAqLwoKICAgIC8qKgogICAgICogU3RpZmZuZXNzIG9mIHRoZSBzcHJpbmcuIEEgbnVtYmVyID49IDAuCiAgICAgKiBAZGVmYXVsdCAxMDAKICAgICAqLwoKICAgIC8qKgogICAgICogRGFtcGluZyBvZiB0aGUgc3ByaW5nLiBBIG51bWJlciA+PSAwLgogICAgICogQGRlZmF1bHQgMQogICAgICovCgogICAgLyoqCiAgICAgKiBGaXJzdCBjb25uZWN0ZWQgYm9keS4KICAgICAqLwoKICAgIC8qKgogICAgICogU2Vjb25kIGNvbm5lY3RlZCBib2R5LgogICAgICovCgogICAgLyoqCiAgICAgKiBBbmNob3IgZm9yIGJvZHlBIGluIGxvY2FsIGJvZHlBIGNvb3JkaW5hdGVzLgogICAgICogV2hlcmUgdG8gaG9vayB0aGUgc3ByaW5nIHRvIGJvZHkgQSwgaW4gbG9jYWwgYm9keSBjb29yZGluYXRlcy4KICAgICAqIEBkZWZhdWx0IG5ldyBWZWMzKCkKICAgICAqLwoKICAgIC8qKgogICAgICogQW5jaG9yIGZvciBib2R5QiBpbiBsb2NhbCBib2R5QiBjb29yZGluYXRlcy4KICAgICAqIFdoZXJlIHRvIGhvb2sgdGhlIHNwcmluZyB0byBib2R5IEIsIGluIGxvY2FsIGJvZHkgY29vcmRpbmF0ZXMuCiAgICAgKiBAZGVmYXVsdCBuZXcgVmVjMygpCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKGJvZHlBLCBib2R5Qiwgb3B0aW9ucykgewogICAgICBpZiAob3B0aW9ucyA9PT0gdm9pZCAwKSB7CiAgICAgICAgb3B0aW9ucyA9IHt9OwogICAgICB9CgogICAgICB0aGlzLnJlc3RMZW5ndGggPSB0eXBlb2Ygb3B0aW9ucy5yZXN0TGVuZ3RoID09PSAnbnVtYmVyJyA/IG9wdGlvbnMucmVzdExlbmd0aCA6IDE7CiAgICAgIHRoaXMuc3RpZmZuZXNzID0gb3B0aW9ucy5zdGlmZm5lc3MgfHwgMTAwOwogICAgICB0aGlzLmRhbXBpbmcgPSBvcHRpb25zLmRhbXBpbmcgfHwgMTsKICAgICAgdGhpcy5ib2R5QSA9IGJvZHlBOwogICAgICB0aGlzLmJvZHlCID0gYm9keUI7CiAgICAgIHRoaXMubG9jYWxBbmNob3JBID0gbmV3IFZlYzMoKTsKICAgICAgdGhpcy5sb2NhbEFuY2hvckIgPSBuZXcgVmVjMygpOwoKICAgICAgaWYgKG9wdGlvbnMubG9jYWxBbmNob3JBKSB7CiAgICAgICAgdGhpcy5sb2NhbEFuY2hvckEuY29weShvcHRpb25zLmxvY2FsQW5jaG9yQSk7CiAgICAgIH0KCiAgICAgIGlmIChvcHRpb25zLmxvY2FsQW5jaG9yQikgewogICAgICAgIHRoaXMubG9jYWxBbmNob3JCLmNvcHkob3B0aW9ucy5sb2NhbEFuY2hvckIpOwogICAgICB9CgogICAgICBpZiAob3B0aW9ucy53b3JsZEFuY2hvckEpIHsKICAgICAgICB0aGlzLnNldFdvcmxkQW5jaG9yQShvcHRpb25zLndvcmxkQW5jaG9yQSk7CiAgICAgIH0KCiAgICAgIGlmIChvcHRpb25zLndvcmxkQW5jaG9yQikgewogICAgICAgIHRoaXMuc2V0V29ybGRBbmNob3JCKG9wdGlvbnMud29ybGRBbmNob3JCKTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBTZXQgdGhlIGFuY2hvciBwb2ludCBvbiBib2R5IEEsIHVzaW5nIHdvcmxkIGNvb3JkaW5hdGVzLgogICAgICovCgoKICAgIHNldFdvcmxkQW5jaG9yQSh3b3JsZEFuY2hvckEpIHsKICAgICAgdGhpcy5ib2R5QS5wb2ludFRvTG9jYWxGcmFtZSh3b3JsZEFuY2hvckEsIHRoaXMubG9jYWxBbmNob3JBKTsKICAgIH0KICAgIC8qKgogICAgICogU2V0IHRoZSBhbmNob3IgcG9pbnQgb24gYm9keSBCLCB1c2luZyB3b3JsZCBjb29yZGluYXRlcy4KICAgICAqLwoKCiAgICBzZXRXb3JsZEFuY2hvckIod29ybGRBbmNob3JCKSB7CiAgICAgIHRoaXMuYm9keUIucG9pbnRUb0xvY2FsRnJhbWUod29ybGRBbmNob3JCLCB0aGlzLmxvY2FsQW5jaG9yQik7CiAgICB9CiAgICAvKioKICAgICAqIEdldCB0aGUgYW5jaG9yIHBvaW50IG9uIGJvZHkgQSwgaW4gd29ybGQgY29vcmRpbmF0ZXMuCiAgICAgKiBAcGFyYW0gcmVzdWx0IFRoZSB2ZWN0b3IgdG8gc3RvcmUgdGhlIHJlc3VsdCBpbi4KICAgICAqLwoKCiAgICBnZXRXb3JsZEFuY2hvckEocmVzdWx0KSB7CiAgICAgIHRoaXMuYm9keUEucG9pbnRUb1dvcmxkRnJhbWUodGhpcy5sb2NhbEFuY2hvckEsIHJlc3VsdCk7CiAgICB9CiAgICAvKioKICAgICAqIEdldCB0aGUgYW5jaG9yIHBvaW50IG9uIGJvZHkgQiwgaW4gd29ybGQgY29vcmRpbmF0ZXMuCiAgICAgKiBAcGFyYW0gcmVzdWx0IFRoZSB2ZWN0b3IgdG8gc3RvcmUgdGhlIHJlc3VsdCBpbi4KICAgICAqLwoKCiAgICBnZXRXb3JsZEFuY2hvckIocmVzdWx0KSB7CiAgICAgIHRoaXMuYm9keUIucG9pbnRUb1dvcmxkRnJhbWUodGhpcy5sb2NhbEFuY2hvckIsIHJlc3VsdCk7CiAgICB9CiAgICAvKioKICAgICAqIEFwcGx5IHRoZSBzcHJpbmcgZm9yY2UgdG8gdGhlIGNvbm5lY3RlZCBib2RpZXMuCiAgICAgKi8KCgogICAgYXBwbHlGb3JjZSgpIHsKICAgICAgY29uc3QgayA9IHRoaXMuc3RpZmZuZXNzOwogICAgICBjb25zdCBkID0gdGhpcy5kYW1waW5nOwogICAgICBjb25zdCBsID0gdGhpcy5yZXN0TGVuZ3RoOwogICAgICBjb25zdCBib2R5QSA9IHRoaXMuYm9keUE7CiAgICAgIGNvbnN0IGJvZHlCID0gdGhpcy5ib2R5QjsKICAgICAgY29uc3QgciA9IGFwcGx5Rm9yY2VfcjsKICAgICAgY29uc3Qgcl91bml0ID0gYXBwbHlGb3JjZV9yX3VuaXQ7CiAgICAgIGNvbnN0IHUgPSBhcHBseUZvcmNlX3U7CiAgICAgIGNvbnN0IGYgPSBhcHBseUZvcmNlX2Y7CiAgICAgIGNvbnN0IHRtcCA9IGFwcGx5Rm9yY2VfdG1wOwogICAgICBjb25zdCB3b3JsZEFuY2hvckEgPSBhcHBseUZvcmNlX3dvcmxkQW5jaG9yQTsKICAgICAgY29uc3Qgd29ybGRBbmNob3JCID0gYXBwbHlGb3JjZV93b3JsZEFuY2hvckI7CiAgICAgIGNvbnN0IHJpID0gYXBwbHlGb3JjZV9yaTsKICAgICAgY29uc3QgcmogPSBhcHBseUZvcmNlX3JqOwogICAgICBjb25zdCByaV94X2YgPSBhcHBseUZvcmNlX3JpX3hfZjsKICAgICAgY29uc3QgcmpfeF9mID0gYXBwbHlGb3JjZV9yal94X2Y7IC8vIEdldCB3b3JsZCBhbmNob3JzCgogICAgICB0aGlzLmdldFdvcmxkQW5jaG9yQSh3b3JsZEFuY2hvckEpOwogICAgICB0aGlzLmdldFdvcmxkQW5jaG9yQih3b3JsZEFuY2hvckIpOyAvLyBHZXQgb2Zmc2V0IHBvaW50cwoKICAgICAgd29ybGRBbmNob3JBLnZzdWIoYm9keUEucG9zaXRpb24sIHJpKTsKICAgICAgd29ybGRBbmNob3JCLnZzdWIoYm9keUIucG9zaXRpb24sIHJqKTsgLy8gQ29tcHV0ZSBkaXN0YW5jZSB2ZWN0b3IgYmV0d2VlbiB3b3JsZCBhbmNob3IgcG9pbnRzCgogICAgICB3b3JsZEFuY2hvckIudnN1Yih3b3JsZEFuY2hvckEsIHIpOwogICAgICBjb25zdCBybGVuID0gci5sZW5ndGgoKTsKICAgICAgcl91bml0LmNvcHkocik7CiAgICAgIHJfdW5pdC5ub3JtYWxpemUoKTsgLy8gQ29tcHV0ZSByZWxhdGl2ZSB2ZWxvY2l0eSBvZiB0aGUgYW5jaG9yIHBvaW50cywgdQoKICAgICAgYm9keUIudmVsb2NpdHkudnN1Yihib2R5QS52ZWxvY2l0eSwgdSk7IC8vIEFkZCByb3RhdGlvbmFsIHZlbG9jaXR5CgogICAgICBib2R5Qi5hbmd1bGFyVmVsb2NpdHkuY3Jvc3MocmosIHRtcCk7CiAgICAgIHUudmFkZCh0bXAsIHUpOwogICAgICBib2R5QS5hbmd1bGFyVmVsb2NpdHkuY3Jvc3MocmksIHRtcCk7CiAgICAgIHUudnN1Yih0bXAsIHUpOyAvLyBGID0gLSBrICogKCB4IC0gTCApIC0gRCAqICggdSApCgogICAgICByX3VuaXQuc2NhbGUoLWsgKiAocmxlbiAtIGwpIC0gZCAqIHUuZG90KHJfdW5pdCksIGYpOyAvLyBBZGQgZm9yY2VzIHRvIGJvZGllcwoKICAgICAgYm9keUEuZm9yY2UudnN1YihmLCBib2R5QS5mb3JjZSk7CiAgICAgIGJvZHlCLmZvcmNlLnZhZGQoZiwgYm9keUIuZm9yY2UpOyAvLyBBbmd1bGFyIGZvcmNlCgogICAgICByaS5jcm9zcyhmLCByaV94X2YpOwogICAgICByai5jcm9zcyhmLCByal94X2YpOwogICAgICBib2R5QS50b3JxdWUudnN1YihyaV94X2YsIGJvZHlBLnRvcnF1ZSk7CiAgICAgIGJvZHlCLnRvcnF1ZS52YWRkKHJqX3hfZiwgYm9keUIudG9ycXVlKTsKICAgIH0KCiAgfQogIGNvbnN0IGFwcGx5Rm9yY2VfciA9IG5ldyBWZWMzKCk7CiAgY29uc3QgYXBwbHlGb3JjZV9yX3VuaXQgPSBuZXcgVmVjMygpOwogIGNvbnN0IGFwcGx5Rm9yY2VfdSA9IG5ldyBWZWMzKCk7CiAgY29uc3QgYXBwbHlGb3JjZV9mID0gbmV3IFZlYzMoKTsKICBjb25zdCBhcHBseUZvcmNlX3dvcmxkQW5jaG9yQSA9IG5ldyBWZWMzKCk7CiAgY29uc3QgYXBwbHlGb3JjZV93b3JsZEFuY2hvckIgPSBuZXcgVmVjMygpOwogIGNvbnN0IGFwcGx5Rm9yY2VfcmkgPSBuZXcgVmVjMygpOwogIGNvbnN0IGFwcGx5Rm9yY2VfcmogPSBuZXcgVmVjMygpOwogIGNvbnN0IGFwcGx5Rm9yY2VfcmlfeF9mID0gbmV3IFZlYzMoKTsKICBjb25zdCBhcHBseUZvcmNlX3JqX3hfZiA9IG5ldyBWZWMzKCk7CiAgY29uc3QgYXBwbHlGb3JjZV90bXAgPSBuZXcgVmVjMygpOwoKICAvKioKICAgKiBXaGVlbEluZm8KICAgKi8KICBjbGFzcyBXaGVlbEluZm8gewogICAgLyoqCiAgICAgKiBNYXggdHJhdmVsIGRpc3RhbmNlIG9mIHRoZSBzdXNwZW5zaW9uLCBpbiBtZXRlcnMuCiAgICAgKiBAZGVmYXVsdCAxCiAgICAgKi8KCiAgICAvKioKICAgICAqIFNwZWVkIHRvIGFwcGx5IHRvIHRoZSB3aGVlbCByb3RhdGlvbiB3aGVuIHRoZSB3aGVlbCBpcyBzbGlkaW5nLgogICAgICogQGRlZmF1bHQgLTAuMQogICAgICovCgogICAgLyoqCiAgICAgKiBJZiB0aGUgY3VzdG9tU2xpZGluZ1JvdGF0aW9uYWxTcGVlZCBzaG91bGQgYmUgdXNlZC4KICAgICAqIEBkZWZhdWx0IGZhbHNlCiAgICAgKi8KCiAgICAvKioKICAgICAqIHNsaWRpbmcKICAgICAqLwoKICAgIC8qKgogICAgICogQ29ubmVjdGlvbiBwb2ludCwgZGVmaW5lZCBsb2NhbGx5IGluIHRoZSBjaGFzc2lzIGJvZHkgZnJhbWUuCiAgICAgKi8KCiAgICAvKioKICAgICAqIGNoYXNzaXNDb25uZWN0aW9uUG9pbnRXb3JsZAogICAgICovCgogICAgLyoqCiAgICAgKiBkaXJlY3Rpb25Mb2NhbAogICAgICovCgogICAgLyoqCiAgICAgKiBkaXJlY3Rpb25Xb3JsZAogICAgICovCgogICAgLyoqCiAgICAgKiBheGxlTG9jYWwKICAgICAqLwoKICAgIC8qKgogICAgICogYXhsZVdvcmxkCiAgICAgKi8KCiAgICAvKioKICAgICAqIHN1c3BlbnNpb25SZXN0TGVuZ3RoCiAgICAgKiBAZGVmYXVsdCAxCiAgICAgKi8KCiAgICAvKioKICAgICAqIHN1c3BlbnNpb25NYXhMZW5ndGgKICAgICAqIEBkZWZhdWx0IDIKICAgICAqLwoKICAgIC8qKgogICAgICogcmFkaXVzCiAgICAgKiBAZGVmYXVsdCAxCiAgICAgKi8KCiAgICAvKioKICAgICAqIHN1c3BlbnNpb25TdGlmZm5lc3MKICAgICAqIEBkZWZhdWx0IDEwMAogICAgICovCgogICAgLyoqCiAgICAgKiBkYW1waW5nQ29tcHJlc3Npb24KICAgICAqIEBkZWZhdWx0IDEwCiAgICAgKi8KCiAgICAvKioKICAgICAqIGRhbXBpbmdSZWxheGF0aW9uCiAgICAgKiBAZGVmYXVsdCAxMAogICAgICovCgogICAgLyoqCiAgICAgKiBmcmljdGlvblNsaXAKICAgICAqIEBkZWZhdWx0IDEwLjUKICAgICAqLwoKICAgIC8qKiBmb3J3YXJkQWNjZWxlcmF0aW9uICovCgogICAgLyoqIHNpZGVBY2NlbGVyYXRpb24gKi8KCiAgICAvKioKICAgICAqIHN0ZWVyaW5nCiAgICAgKiBAZGVmYXVsdCAwCiAgICAgKi8KCiAgICAvKioKICAgICAqIFJvdGF0aW9uIHZhbHVlLCBpbiByYWRpYW5zLgogICAgICogQGRlZmF1bHQgMAogICAgICovCgogICAgLyoqCiAgICAgKiBkZWx0YVJvdGF0aW9uCiAgICAgKiBAZGVmYXVsdCAwCiAgICAgKi8KCiAgICAvKioKICAgICAqIHJvbGxJbmZsdWVuY2UKICAgICAqIEBkZWZhdWx0IDAuMDEKICAgICAqLwoKICAgIC8qKgogICAgICogbWF4U3VzcGVuc2lvbkZvcmNlCiAgICAgKi8KCiAgICAvKioKICAgICAqIGVuZ2luZUZvcmNlCiAgICAgKi8KCiAgICAvKioKICAgICAqIGJyYWtlCiAgICAgKi8KCiAgICAvKioKICAgICAqIGlzRnJvbnRXaGVlbAogICAgICogQGRlZmF1bHQgdHJ1ZQogICAgICovCgogICAgLyoqCiAgICAgKiBjbGlwcGVkSW52Q29udGFjdERvdFN1c3BlbnNpb24KICAgICAqIEBkZWZhdWx0IDEKICAgICAqLwoKICAgIC8qKgogICAgICogc3VzcGVuc2lvblJlbGF0aXZlVmVsb2NpdHkKICAgICAqIEBkZWZhdWx0IDAKICAgICAqLwoKICAgIC8qKgogICAgICogc3VzcGVuc2lvbkZvcmNlCiAgICAgKiBAZGVmYXVsdCAwCiAgICAgKi8KCiAgICAvKioKICAgICAqIHNsaXBJbmZvCiAgICAgKi8KCiAgICAvKioKICAgICAqIHNraWRJbmZvCiAgICAgKiBAZGVmYXVsdCAwCiAgICAgKi8KCiAgICAvKioKICAgICAqIHN1c3BlbnNpb25MZW5ndGgKICAgICAqIEBkZWZhdWx0IDAKICAgICAqLwoKICAgIC8qKgogICAgICogc2lkZUltcHVsc2UKICAgICAqLwoKICAgIC8qKgogICAgICogZm9yd2FyZEltcHVsc2UKICAgICAqLwoKICAgIC8qKgogICAgICogVGhlIHJlc3VsdCBmcm9tIHJheWNhc3RpbmcuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFdoZWVsIHdvcmxkIHRyYW5zZm9ybS4KICAgICAqLwoKICAgIC8qKgogICAgICogaXNJbkNvbnRhY3QKICAgICAqLwogICAgY29uc3RydWN0b3Iob3B0aW9ucykgewogICAgICBpZiAob3B0aW9ucyA9PT0gdm9pZCAwKSB7CiAgICAgICAgb3B0aW9ucyA9IHt9OwogICAgICB9CgogICAgICBvcHRpb25zID0gVXRpbHMuZGVmYXVsdHMob3B0aW9ucywgewogICAgICAgIGNoYXNzaXNDb25uZWN0aW9uUG9pbnRMb2NhbDogbmV3IFZlYzMoKSwKICAgICAgICBjaGFzc2lzQ29ubmVjdGlvblBvaW50V29ybGQ6IG5ldyBWZWMzKCksCiAgICAgICAgZGlyZWN0aW9uTG9jYWw6IG5ldyBWZWMzKCksCiAgICAgICAgZGlyZWN0aW9uV29ybGQ6IG5ldyBWZWMzKCksCiAgICAgICAgYXhsZUxvY2FsOiBuZXcgVmVjMygpLAogICAgICAgIGF4bGVXb3JsZDogbmV3IFZlYzMoKSwKICAgICAgICBzdXNwZW5zaW9uUmVzdExlbmd0aDogMSwKICAgICAgICBzdXNwZW5zaW9uTWF4TGVuZ3RoOiAyLAogICAgICAgIHJhZGl1czogMSwKICAgICAgICBzdXNwZW5zaW9uU3RpZmZuZXNzOiAxMDAsCiAgICAgICAgZGFtcGluZ0NvbXByZXNzaW9uOiAxMCwKICAgICAgICBkYW1waW5nUmVsYXhhdGlvbjogMTAsCiAgICAgICAgZnJpY3Rpb25TbGlwOiAxMC41LAogICAgICAgIGZvcndhcmRBY2NlbGVyYXRpb246IDEsCiAgICAgICAgc2lkZUFjY2VsZXJhdGlvbjogMSwKICAgICAgICBzdGVlcmluZzogMCwKICAgICAgICByb3RhdGlvbjogMCwKICAgICAgICBkZWx0YVJvdGF0aW9uOiAwLAogICAgICAgIHJvbGxJbmZsdWVuY2U6IDAuMDEsCiAgICAgICAgbWF4U3VzcGVuc2lvbkZvcmNlOiBOdW1iZXIuTUFYX1ZBTFVFLAogICAgICAgIGlzRnJvbnRXaGVlbDogdHJ1ZSwKICAgICAgICBjbGlwcGVkSW52Q29udGFjdERvdFN1c3BlbnNpb246IDEsCiAgICAgICAgc3VzcGVuc2lvblJlbGF0aXZlVmVsb2NpdHk6IDAsCiAgICAgICAgc3VzcGVuc2lvbkZvcmNlOiAwLAogICAgICAgIHNsaXBJbmZvOiAwLAogICAgICAgIHNraWRJbmZvOiAwLAogICAgICAgIHN1c3BlbnNpb25MZW5ndGg6IDAsCiAgICAgICAgbWF4U3VzcGVuc2lvblRyYXZlbDogMSwKICAgICAgICB1c2VDdXN0b21TbGlkaW5nUm90YXRpb25hbFNwZWVkOiBmYWxzZSwKICAgICAgICBjdXN0b21TbGlkaW5nUm90YXRpb25hbFNwZWVkOiAtMC4xCiAgICAgIH0pOwogICAgICB0aGlzLm1heFN1c3BlbnNpb25UcmF2ZWwgPSBvcHRpb25zLm1heFN1c3BlbnNpb25UcmF2ZWw7CiAgICAgIHRoaXMuY3VzdG9tU2xpZGluZ1JvdGF0aW9uYWxTcGVlZCA9IG9wdGlvbnMuY3VzdG9tU2xpZGluZ1JvdGF0aW9uYWxTcGVlZDsKICAgICAgdGhpcy51c2VDdXN0b21TbGlkaW5nUm90YXRpb25hbFNwZWVkID0gb3B0aW9ucy51c2VDdXN0b21TbGlkaW5nUm90YXRpb25hbFNwZWVkOwogICAgICB0aGlzLnNsaWRpbmcgPSBmYWxzZTsKICAgICAgdGhpcy5jaGFzc2lzQ29ubmVjdGlvblBvaW50TG9jYWwgPSBvcHRpb25zLmNoYXNzaXNDb25uZWN0aW9uUG9pbnRMb2NhbC5jbG9uZSgpOwogICAgICB0aGlzLmNoYXNzaXNDb25uZWN0aW9uUG9pbnRXb3JsZCA9IG9wdGlvbnMuY2hhc3Npc0Nvbm5lY3Rpb25Qb2ludFdvcmxkLmNsb25lKCk7CiAgICAgIHRoaXMuZGlyZWN0aW9uTG9jYWwgPSBvcHRpb25zLmRpcmVjdGlvbkxvY2FsLmNsb25lKCk7CiAgICAgIHRoaXMuZGlyZWN0aW9uV29ybGQgPSBvcHRpb25zLmRpcmVjdGlvbldvcmxkLmNsb25lKCk7CiAgICAgIHRoaXMuYXhsZUxvY2FsID0gb3B0aW9ucy5heGxlTG9jYWwuY2xvbmUoKTsKICAgICAgdGhpcy5heGxlV29ybGQgPSBvcHRpb25zLmF4bGVXb3JsZC5jbG9uZSgpOwogICAgICB0aGlzLnN1c3BlbnNpb25SZXN0TGVuZ3RoID0gb3B0aW9ucy5zdXNwZW5zaW9uUmVzdExlbmd0aDsKICAgICAgdGhpcy5zdXNwZW5zaW9uTWF4TGVuZ3RoID0gb3B0aW9ucy5zdXNwZW5zaW9uTWF4TGVuZ3RoOwogICAgICB0aGlzLnJhZGl1cyA9IG9wdGlvbnMucmFkaXVzOwogICAgICB0aGlzLnN1c3BlbnNpb25TdGlmZm5lc3MgPSBvcHRpb25zLnN1c3BlbnNpb25TdGlmZm5lc3M7CiAgICAgIHRoaXMuZGFtcGluZ0NvbXByZXNzaW9uID0gb3B0aW9ucy5kYW1waW5nQ29tcHJlc3Npb247CiAgICAgIHRoaXMuZGFtcGluZ1JlbGF4YXRpb24gPSBvcHRpb25zLmRhbXBpbmdSZWxheGF0aW9uOwogICAgICB0aGlzLmZyaWN0aW9uU2xpcCA9IG9wdGlvbnMuZnJpY3Rpb25TbGlwOwogICAgICB0aGlzLmZvcndhcmRBY2NlbGVyYXRpb24gPSBvcHRpb25zLmZvcndhcmRBY2NlbGVyYXRpb247CiAgICAgIHRoaXMuc2lkZUFjY2VsZXJhdGlvbiA9IG9wdGlvbnMuc2lkZUFjY2VsZXJhdGlvbjsKICAgICAgdGhpcy5zdGVlcmluZyA9IDA7CiAgICAgIHRoaXMucm90YXRpb24gPSAwOwogICAgICB0aGlzLmRlbHRhUm90YXRpb24gPSAwOwogICAgICB0aGlzLnJvbGxJbmZsdWVuY2UgPSBvcHRpb25zLnJvbGxJbmZsdWVuY2U7CiAgICAgIHRoaXMubWF4U3VzcGVuc2lvbkZvcmNlID0gb3B0aW9ucy5tYXhTdXNwZW5zaW9uRm9yY2U7CiAgICAgIHRoaXMuZW5naW5lRm9yY2UgPSAwOwogICAgICB0aGlzLmJyYWtlID0gMDsKICAgICAgdGhpcy5pc0Zyb250V2hlZWwgPSBvcHRpb25zLmlzRnJvbnRXaGVlbDsKICAgICAgdGhpcy5jbGlwcGVkSW52Q29udGFjdERvdFN1c3BlbnNpb24gPSAxOwogICAgICB0aGlzLnN1c3BlbnNpb25SZWxhdGl2ZVZlbG9jaXR5ID0gMDsKICAgICAgdGhpcy5zdXNwZW5zaW9uRm9yY2UgPSAwOwogICAgICB0aGlzLnNsaXBJbmZvID0gMDsKICAgICAgdGhpcy5za2lkSW5mbyA9IDA7CiAgICAgIHRoaXMuc3VzcGVuc2lvbkxlbmd0aCA9IDA7CiAgICAgIHRoaXMuc2lkZUltcHVsc2UgPSAwOwogICAgICB0aGlzLmZvcndhcmRJbXB1bHNlID0gMDsKICAgICAgdGhpcy5yYXljYXN0UmVzdWx0ID0gbmV3IFJheWNhc3RSZXN1bHQoKTsKICAgICAgdGhpcy53b3JsZFRyYW5zZm9ybSA9IG5ldyBUcmFuc2Zvcm0oKTsKICAgICAgdGhpcy5pc0luQ29udGFjdCA9IGZhbHNlOwogICAgfQoKICAgIHVwZGF0ZVdoZWVsKGNoYXNzaXMpIHsKICAgICAgY29uc3QgcmF5Y2FzdFJlc3VsdCA9IHRoaXMucmF5Y2FzdFJlc3VsdDsKCiAgICAgIGlmICh0aGlzLmlzSW5Db250YWN0KSB7CiAgICAgICAgY29uc3QgcHJvamVjdCA9IHJheWNhc3RSZXN1bHQuaGl0Tm9ybWFsV29ybGQuZG90KHJheWNhc3RSZXN1bHQuZGlyZWN0aW9uV29ybGQpOwogICAgICAgIHJheWNhc3RSZXN1bHQuaGl0UG9pbnRXb3JsZC52c3ViKGNoYXNzaXMucG9zaXRpb24sIHJlbHBvcyk7CiAgICAgICAgY2hhc3Npcy5nZXRWZWxvY2l0eUF0V29ybGRQb2ludChyZWxwb3MsIGNoYXNzaXNfdmVsb2NpdHlfYXRfY29udGFjdFBvaW50KTsKICAgICAgICBjb25zdCBwcm9qVmVsID0gcmF5Y2FzdFJlc3VsdC5oaXROb3JtYWxXb3JsZC5kb3QoY2hhc3Npc192ZWxvY2l0eV9hdF9jb250YWN0UG9pbnQpOwoKICAgICAgICBpZiAocHJvamVjdCA+PSAtMC4xKSB7CiAgICAgICAgICB0aGlzLnN1c3BlbnNpb25SZWxhdGl2ZVZlbG9jaXR5ID0gMC4wOwogICAgICAgICAgdGhpcy5jbGlwcGVkSW52Q29udGFjdERvdFN1c3BlbnNpb24gPSAxLjAgLyAwLjE7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGNvbnN0IGludiA9IC0xIC8gcHJvamVjdDsKICAgICAgICAgIHRoaXMuc3VzcGVuc2lvblJlbGF0aXZlVmVsb2NpdHkgPSBwcm9qVmVsICogaW52OwogICAgICAgICAgdGhpcy5jbGlwcGVkSW52Q29udGFjdERvdFN1c3BlbnNpb24gPSBpbnY7CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIC8vIE5vdCBpbiBjb250YWN0IDogcG9zaXRpb24gd2hlZWwgaW4gYSBuaWNlIChyZXN0IGxlbmd0aCkgcG9zaXRpb24KICAgICAgICByYXljYXN0UmVzdWx0LnN1c3BlbnNpb25MZW5ndGggPSB0aGlzLnN1c3BlbnNpb25SZXN0TGVuZ3RoOwogICAgICAgIHRoaXMuc3VzcGVuc2lvblJlbGF0aXZlVmVsb2NpdHkgPSAwLjA7CiAgICAgICAgcmF5Y2FzdFJlc3VsdC5kaXJlY3Rpb25Xb3JsZC5zY2FsZSgtMSwgcmF5Y2FzdFJlc3VsdC5oaXROb3JtYWxXb3JsZCk7CiAgICAgICAgdGhpcy5jbGlwcGVkSW52Q29udGFjdERvdFN1c3BlbnNpb24gPSAxLjA7CiAgICAgIH0KICAgIH0KCiAgfQogIGNvbnN0IGNoYXNzaXNfdmVsb2NpdHlfYXRfY29udGFjdFBvaW50ID0gbmV3IFZlYzMoKTsKICBjb25zdCByZWxwb3MgPSBuZXcgVmVjMygpOwoKICAvKioKICAgKiBWZWhpY2xlIGhlbHBlciBjbGFzcyB0aGF0IGNhc3RzIHJheXMgZnJvbSB0aGUgd2hlZWwgcG9zaXRpb25zIHRvd2FyZHMgdGhlIGdyb3VuZCBhbmQgYXBwbGllcyBmb3JjZXMuCiAgICovCiAgY2xhc3MgUmF5Y2FzdFZlaGljbGUgewogICAgLyoqIFRoZSBjYXIgY2hhc3NpcyBib2R5LiAqLwoKICAgIC8qKiBUaGUgd2hlZWxzLiAqLwoKICAgIC8qKiBXaWxsIGJlIHNldCB0byB0cnVlIGlmIHRoZSBjYXIgaXMgc2xpZGluZy4gKi8KCiAgICAvKiogSW5kZXggb2YgdGhlIHJpZ2h0IGF4aXMuIHg9MCwgeT0xLCB6PTIgKi8KCiAgICAvKiogSW5kZXggb2YgdGhlIGZvcndhcmQgYXhpcy4geD0wLCB5PTEsIHo9MiAqLwoKICAgIC8qKiBJbmRleCBvZiB0aGUgdXAgYXhpcy4geD0wLCB5PTEsIHo9MiAqLwoKICAgIC8qKiBUaGUgY29uc3RyYWludHMuICovCgogICAgLyoqIE9wdGlvbmFsIHByZS1zdGVwIGNhbGxiYWNrLiAqLwoKICAgIC8qKiBOdW1iZXIgb2Ygd2hlZWxzIG9uIHRoZSBncm91bmQuICovCiAgICBjb25zdHJ1Y3RvcihvcHRpb25zKSB7CiAgICAgIHRoaXMuY2hhc3Npc0JvZHkgPSBvcHRpb25zLmNoYXNzaXNCb2R5OwogICAgICB0aGlzLndoZWVsSW5mb3MgPSBbXTsKICAgICAgdGhpcy5zbGlkaW5nID0gZmFsc2U7CiAgICAgIHRoaXMud29ybGQgPSBudWxsOwogICAgICB0aGlzLmluZGV4UmlnaHRBeGlzID0gdHlwZW9mIG9wdGlvbnMuaW5kZXhSaWdodEF4aXMgIT09ICd1bmRlZmluZWQnID8gb3B0aW9ucy5pbmRleFJpZ2h0QXhpcyA6IDI7CiAgICAgIHRoaXMuaW5kZXhGb3J3YXJkQXhpcyA9IHR5cGVvZiBvcHRpb25zLmluZGV4Rm9yd2FyZEF4aXMgIT09ICd1bmRlZmluZWQnID8gb3B0aW9ucy5pbmRleEZvcndhcmRBeGlzIDogMDsKICAgICAgdGhpcy5pbmRleFVwQXhpcyA9IHR5cGVvZiBvcHRpb25zLmluZGV4VXBBeGlzICE9PSAndW5kZWZpbmVkJyA/IG9wdGlvbnMuaW5kZXhVcEF4aXMgOiAxOwogICAgICB0aGlzLmNvbnN0cmFpbnRzID0gW107CgogICAgICB0aGlzLnByZVN0ZXBDYWxsYmFjayA9ICgpID0+IHt9OwoKICAgICAgdGhpcy5jdXJyZW50VmVoaWNsZVNwZWVkS21Ib3VyID0gMDsKICAgICAgdGhpcy5udW1XaGVlbHNPbkdyb3VuZCA9IDA7CiAgICB9CiAgICAvKioKICAgICAqIEFkZCBhIHdoZWVsLiBGb3IgaW5mb3JtYXRpb24gYWJvdXQgdGhlIG9wdGlvbnMsIHNlZSBgV2hlZWxJbmZvYC4KICAgICAqLwoKCiAgICBhZGRXaGVlbChvcHRpb25zKSB7CiAgICAgIGlmIChvcHRpb25zID09PSB2b2lkIDApIHsKICAgICAgICBvcHRpb25zID0ge307CiAgICAgIH0KCiAgICAgIGNvbnN0IGluZm8gPSBuZXcgV2hlZWxJbmZvKG9wdGlvbnMpOwogICAgICBjb25zdCBpbmRleCA9IHRoaXMud2hlZWxJbmZvcy5sZW5ndGg7CiAgICAgIHRoaXMud2hlZWxJbmZvcy5wdXNoKGluZm8pOwogICAgICByZXR1cm4gaW5kZXg7CiAgICB9CiAgICAvKioKICAgICAqIFNldCB0aGUgc3RlZXJpbmcgdmFsdWUgb2YgYSB3aGVlbC4KICAgICAqLwoKCiAgICBzZXRTdGVlcmluZ1ZhbHVlKHZhbHVlLCB3aGVlbEluZGV4KSB7CiAgICAgIGNvbnN0IHdoZWVsID0gdGhpcy53aGVlbEluZm9zW3doZWVsSW5kZXhdOwogICAgICB3aGVlbC5zdGVlcmluZyA9IHZhbHVlOwogICAgfQogICAgLyoqCiAgICAgKiBTZXQgdGhlIHdoZWVsIGZvcmNlIHRvIGFwcGx5IG9uIG9uZSBvZiB0aGUgd2hlZWxzIGVhY2ggdGltZSBzdGVwCiAgICAgKi8KCgogICAgYXBwbHlFbmdpbmVGb3JjZSh2YWx1ZSwgd2hlZWxJbmRleCkgewogICAgICB0aGlzLndoZWVsSW5mb3Nbd2hlZWxJbmRleF0uZW5naW5lRm9yY2UgPSB2YWx1ZTsKICAgIH0KICAgIC8qKgogICAgICogU2V0IHRoZSBicmFraW5nIGZvcmNlIG9mIGEgd2hlZWwKICAgICAqLwoKCiAgICBzZXRCcmFrZShicmFrZSwgd2hlZWxJbmRleCkgewogICAgICB0aGlzLndoZWVsSW5mb3Nbd2hlZWxJbmRleF0uYnJha2UgPSBicmFrZTsKICAgIH0KICAgIC8qKgogICAgICogQWRkIHRoZSB2ZWhpY2xlIGluY2x1ZGluZyBpdHMgY29uc3RyYWludHMgdG8gdGhlIHdvcmxkLgogICAgICovCgoKICAgIGFkZFRvV29ybGQod29ybGQpIHsKICAgICAgd29ybGQuYWRkQm9keSh0aGlzLmNoYXNzaXNCb2R5KTsKICAgICAgY29uc3QgdGhhdCA9IHRoaXM7CgogICAgICB0aGlzLnByZVN0ZXBDYWxsYmFjayA9ICgpID0+IHsKICAgICAgICB0aGF0LnVwZGF0ZVZlaGljbGUod29ybGQuZHQpOwogICAgICB9OwoKICAgICAgd29ybGQuYWRkRXZlbnRMaXN0ZW5lcigncHJlU3RlcCcsIHRoaXMucHJlU3RlcENhbGxiYWNrKTsKICAgICAgdGhpcy53b3JsZCA9IHdvcmxkOwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgb25lIG9mIHRoZSB3aGVlbCBheGxlcywgd29ybGQtb3JpZW50ZWQuCiAgICAgKi8KCgogICAgZ2V0VmVoaWNsZUF4aXNXb3JsZChheGlzSW5kZXgsIHJlc3VsdCkgewogICAgICByZXN1bHQuc2V0KGF4aXNJbmRleCA9PT0gMCA/IDEgOiAwLCBheGlzSW5kZXggPT09IDEgPyAxIDogMCwgYXhpc0luZGV4ID09PSAyID8gMSA6IDApOwogICAgICB0aGlzLmNoYXNzaXNCb2R5LnZlY3RvclRvV29ybGRGcmFtZShyZXN1bHQsIHJlc3VsdCk7CiAgICB9CgogICAgdXBkYXRlVmVoaWNsZSh0aW1lU3RlcCkgewogICAgICBjb25zdCB3aGVlbEluZm9zID0gdGhpcy53aGVlbEluZm9zOwogICAgICBjb25zdCBudW1XaGVlbHMgPSB3aGVlbEluZm9zLmxlbmd0aDsKICAgICAgY29uc3QgY2hhc3Npc0JvZHkgPSB0aGlzLmNoYXNzaXNCb2R5OwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBudW1XaGVlbHM7IGkrKykgewogICAgICAgIHRoaXMudXBkYXRlV2hlZWxUcmFuc2Zvcm0oaSk7CiAgICAgIH0KCiAgICAgIHRoaXMuY3VycmVudFZlaGljbGVTcGVlZEttSG91ciA9IDMuNiAqIGNoYXNzaXNCb2R5LnZlbG9jaXR5Lmxlbmd0aCgpOwogICAgICBjb25zdCBmb3J3YXJkV29ybGQgPSBuZXcgVmVjMygpOwogICAgICB0aGlzLmdldFZlaGljbGVBeGlzV29ybGQodGhpcy5pbmRleEZvcndhcmRBeGlzLCBmb3J3YXJkV29ybGQpOwoKICAgICAgaWYgKGZvcndhcmRXb3JsZC5kb3QoY2hhc3Npc0JvZHkudmVsb2NpdHkpIDwgMCkgewogICAgICAgIHRoaXMuY3VycmVudFZlaGljbGVTcGVlZEttSG91ciAqPSAtMTsKICAgICAgfSAvLyBzaW11bGF0ZSBzdXNwZW5zaW9uCgoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBudW1XaGVlbHM7IGkrKykgewogICAgICAgIHRoaXMuY2FzdFJheSh3aGVlbEluZm9zW2ldKTsKICAgICAgfQoKICAgICAgdGhpcy51cGRhdGVTdXNwZW5zaW9uKHRpbWVTdGVwKTsKICAgICAgY29uc3QgaW1wdWxzZSA9IG5ldyBWZWMzKCk7CiAgICAgIGNvbnN0IHJlbHBvcyA9IG5ldyBWZWMzKCk7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IG51bVdoZWVsczsgaSsrKSB7CiAgICAgICAgLy9hcHBseSBzdXNwZW5zaW9uIGZvcmNlCiAgICAgICAgY29uc3Qgd2hlZWwgPSB3aGVlbEluZm9zW2ldOwogICAgICAgIGxldCBzdXNwZW5zaW9uRm9yY2UgPSB3aGVlbC5zdXNwZW5zaW9uRm9yY2U7CgogICAgICAgIGlmIChzdXNwZW5zaW9uRm9yY2UgPiB3aGVlbC5tYXhTdXNwZW5zaW9uRm9yY2UpIHsKICAgICAgICAgIHN1c3BlbnNpb25Gb3JjZSA9IHdoZWVsLm1heFN1c3BlbnNpb25Gb3JjZTsKICAgICAgICB9CgogICAgICAgIHdoZWVsLnJheWNhc3RSZXN1bHQuaGl0Tm9ybWFsV29ybGQuc2NhbGUoc3VzcGVuc2lvbkZvcmNlICogdGltZVN0ZXAsIGltcHVsc2UpOwogICAgICAgIHdoZWVsLnJheWNhc3RSZXN1bHQuaGl0UG9pbnRXb3JsZC52c3ViKGNoYXNzaXNCb2R5LnBvc2l0aW9uLCByZWxwb3MpOwogICAgICAgIGNoYXNzaXNCb2R5LmFwcGx5SW1wdWxzZShpbXB1bHNlLCByZWxwb3MpOwogICAgICB9CgogICAgICB0aGlzLnVwZGF0ZUZyaWN0aW9uKHRpbWVTdGVwKTsKICAgICAgY29uc3QgaGl0Tm9ybWFsV29ybGRTY2FsZWRXaXRoUHJvaiA9IG5ldyBWZWMzKCk7CiAgICAgIGNvbnN0IGZ3ZCA9IG5ldyBWZWMzKCk7CiAgICAgIGNvbnN0IHZlbCA9IG5ldyBWZWMzKCk7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IG51bVdoZWVsczsgaSsrKSB7CiAgICAgICAgY29uc3Qgd2hlZWwgPSB3aGVlbEluZm9zW2ldOyAvL2NvbnN0IHJlbHBvcyA9IG5ldyBWZWMzKCk7CiAgICAgICAgLy93aGVlbC5jaGFzc2lzQ29ubmVjdGlvblBvaW50V29ybGQudnN1YihjaGFzc2lzQm9keS5wb3NpdGlvbiwgcmVscG9zKTsKCiAgICAgICAgY2hhc3Npc0JvZHkuZ2V0VmVsb2NpdHlBdFdvcmxkUG9pbnQod2hlZWwuY2hhc3Npc0Nvbm5lY3Rpb25Qb2ludFdvcmxkLCB2ZWwpOyAvLyBIYWNrIHRvIGdldCB0aGUgcm90YXRpb24gaW4gdGhlIGNvcnJlY3QgZGlyZWN0aW9uCgogICAgICAgIGxldCBtID0gMTsKCiAgICAgICAgc3dpdGNoICh0aGlzLmluZGV4VXBBeGlzKSB7CiAgICAgICAgICBjYXNlIDE6CiAgICAgICAgICAgIG0gPSAtMTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgfQoKICAgICAgICBpZiAod2hlZWwuaXNJbkNvbnRhY3QpIHsKICAgICAgICAgIHRoaXMuZ2V0VmVoaWNsZUF4aXNXb3JsZCh0aGlzLmluZGV4Rm9yd2FyZEF4aXMsIGZ3ZCk7CiAgICAgICAgICBjb25zdCBwcm9qID0gZndkLmRvdCh3aGVlbC5yYXljYXN0UmVzdWx0LmhpdE5vcm1hbFdvcmxkKTsKICAgICAgICAgIHdoZWVsLnJheWNhc3RSZXN1bHQuaGl0Tm9ybWFsV29ybGQuc2NhbGUocHJvaiwgaGl0Tm9ybWFsV29ybGRTY2FsZWRXaXRoUHJvaik7CiAgICAgICAgICBmd2QudnN1YihoaXROb3JtYWxXb3JsZFNjYWxlZFdpdGhQcm9qLCBmd2QpOwogICAgICAgICAgY29uc3QgcHJvajIgPSBmd2QuZG90KHZlbCk7CiAgICAgICAgICB3aGVlbC5kZWx0YVJvdGF0aW9uID0gbSAqIHByb2oyICogdGltZVN0ZXAgLyB3aGVlbC5yYWRpdXM7CiAgICAgICAgfQoKICAgICAgICBpZiAoKHdoZWVsLnNsaWRpbmcgfHwgIXdoZWVsLmlzSW5Db250YWN0KSAmJiB3aGVlbC5lbmdpbmVGb3JjZSAhPT0gMCAmJiB3aGVlbC51c2VDdXN0b21TbGlkaW5nUm90YXRpb25hbFNwZWVkKSB7CiAgICAgICAgICAvLyBBcHBseSBjdXN0b20gcm90YXRpb24gd2hlbiBhY2NlbGVyYXRpbmcgYW5kIHNsaWRpbmcKICAgICAgICAgIHdoZWVsLmRlbHRhUm90YXRpb24gPSAod2hlZWwuZW5naW5lRm9yY2UgPiAwID8gMSA6IC0xKSAqIHdoZWVsLmN1c3RvbVNsaWRpbmdSb3RhdGlvbmFsU3BlZWQgKiB0aW1lU3RlcDsKICAgICAgICB9IC8vIExvY2sgd2hlZWxzCgoKICAgICAgICBpZiAoTWF0aC5hYnMod2hlZWwuYnJha2UpID4gTWF0aC5hYnMod2hlZWwuZW5naW5lRm9yY2UpKSB7CiAgICAgICAgICB3aGVlbC5kZWx0YVJvdGF0aW9uID0gMDsKICAgICAgICB9CgogICAgICAgIHdoZWVsLnJvdGF0aW9uICs9IHdoZWVsLmRlbHRhUm90YXRpb247IC8vIFVzZSB0aGUgb2xkIHZhbHVlCgogICAgICAgIHdoZWVsLmRlbHRhUm90YXRpb24gKj0gMC45OTsgLy8gZGFtcGluZyBvZiByb3RhdGlvbiB3aGVuIG5vdCBpbiBjb250YWN0CiAgICAgIH0KICAgIH0KCiAgICB1cGRhdGVTdXNwZW5zaW9uKGRlbHRhVGltZSkgewogICAgICBjb25zdCBjaGFzc2lzQm9keSA9IHRoaXMuY2hhc3Npc0JvZHk7CiAgICAgIGNvbnN0IGNoYXNzaXNNYXNzID0gY2hhc3Npc0JvZHkubWFzczsKICAgICAgY29uc3Qgd2hlZWxJbmZvcyA9IHRoaXMud2hlZWxJbmZvczsKICAgICAgY29uc3QgbnVtV2hlZWxzID0gd2hlZWxJbmZvcy5sZW5ndGg7CgogICAgICBmb3IgKGxldCB3X2l0ID0gMDsgd19pdCA8IG51bVdoZWVsczsgd19pdCsrKSB7CiAgICAgICAgY29uc3Qgd2hlZWwgPSB3aGVlbEluZm9zW3dfaXRdOwoKICAgICAgICBpZiAod2hlZWwuaXNJbkNvbnRhY3QpIHsKICAgICAgICAgIGxldCBmb3JjZTsgLy8gU3ByaW5nCgogICAgICAgICAgY29uc3Qgc3VzcF9sZW5ndGggPSB3aGVlbC5zdXNwZW5zaW9uUmVzdExlbmd0aDsKICAgICAgICAgIGNvbnN0IGN1cnJlbnRfbGVuZ3RoID0gd2hlZWwuc3VzcGVuc2lvbkxlbmd0aDsKICAgICAgICAgIGNvbnN0IGxlbmd0aF9kaWZmID0gc3VzcF9sZW5ndGggLSBjdXJyZW50X2xlbmd0aDsKICAgICAgICAgIGZvcmNlID0gd2hlZWwuc3VzcGVuc2lvblN0aWZmbmVzcyAqIGxlbmd0aF9kaWZmICogd2hlZWwuY2xpcHBlZEludkNvbnRhY3REb3RTdXNwZW5zaW9uOyAvLyBEYW1wZXIKCiAgICAgICAgICBjb25zdCBwcm9qZWN0ZWRfcmVsX3ZlbCA9IHdoZWVsLnN1c3BlbnNpb25SZWxhdGl2ZVZlbG9jaXR5OwogICAgICAgICAgbGV0IHN1c3BfZGFtcGluZzsKCiAgICAgICAgICBpZiAocHJvamVjdGVkX3JlbF92ZWwgPCAwKSB7CiAgICAgICAgICAgIHN1c3BfZGFtcGluZyA9IHdoZWVsLmRhbXBpbmdDb21wcmVzc2lvbjsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHN1c3BfZGFtcGluZyA9IHdoZWVsLmRhbXBpbmdSZWxheGF0aW9uOwogICAgICAgICAgfQoKICAgICAgICAgIGZvcmNlIC09IHN1c3BfZGFtcGluZyAqIHByb2plY3RlZF9yZWxfdmVsOwogICAgICAgICAgd2hlZWwuc3VzcGVuc2lvbkZvcmNlID0gZm9yY2UgKiBjaGFzc2lzTWFzczsKCiAgICAgICAgICBpZiAod2hlZWwuc3VzcGVuc2lvbkZvcmNlIDwgMCkgewogICAgICAgICAgICB3aGVlbC5zdXNwZW5zaW9uRm9yY2UgPSAwOwogICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB3aGVlbC5zdXNwZW5zaW9uRm9yY2UgPSAwOwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBSZW1vdmUgdGhlIHZlaGljbGUgaW5jbHVkaW5nIGl0cyBjb25zdHJhaW50cyBmcm9tIHRoZSB3b3JsZC4KICAgICAqLwoKCiAgICByZW1vdmVGcm9tV29ybGQod29ybGQpIHsKICAgICAgdGhpcy5jb25zdHJhaW50czsKICAgICAgd29ybGQucmVtb3ZlQm9keSh0aGlzLmNoYXNzaXNCb2R5KTsKICAgICAgd29ybGQucmVtb3ZlRXZlbnRMaXN0ZW5lcigncHJlU3RlcCcsIHRoaXMucHJlU3RlcENhbGxiYWNrKTsKICAgICAgdGhpcy53b3JsZCA9IG51bGw7CiAgICB9CgogICAgY2FzdFJheSh3aGVlbCkgewogICAgICBjb25zdCByYXl2ZWN0b3IgPSBjYXN0UmF5X3JheXZlY3RvcjsKICAgICAgY29uc3QgdGFyZ2V0ID0gY2FzdFJheV90YXJnZXQ7CiAgICAgIHRoaXMudXBkYXRlV2hlZWxUcmFuc2Zvcm1Xb3JsZCh3aGVlbCk7CiAgICAgIGNvbnN0IGNoYXNzaXNCb2R5ID0gdGhpcy5jaGFzc2lzQm9keTsKICAgICAgbGV0IGRlcHRoID0gLTE7CiAgICAgIGNvbnN0IHJheWxlbiA9IHdoZWVsLnN1c3BlbnNpb25SZXN0TGVuZ3RoICsgd2hlZWwucmFkaXVzOwogICAgICB3aGVlbC5kaXJlY3Rpb25Xb3JsZC5zY2FsZShyYXlsZW4sIHJheXZlY3Rvcik7CiAgICAgIGNvbnN0IHNvdXJjZSA9IHdoZWVsLmNoYXNzaXNDb25uZWN0aW9uUG9pbnRXb3JsZDsKICAgICAgc291cmNlLnZhZGQocmF5dmVjdG9yLCB0YXJnZXQpOwogICAgICBjb25zdCByYXljYXN0UmVzdWx0ID0gd2hlZWwucmF5Y2FzdFJlc3VsdDsKICAgICAgcmF5Y2FzdFJlc3VsdC5yZXNldCgpOyAvLyBUdXJuIG9mZiByYXkgY29sbGlzaW9uIHdpdGggdGhlIGNoYXNzaXMgdGVtcG9yYXJpbHkKCiAgICAgIGNvbnN0IG9sZFN0YXRlID0gY2hhc3Npc0JvZHkuY29sbGlzaW9uUmVzcG9uc2U7CiAgICAgIGNoYXNzaXNCb2R5LmNvbGxpc2lvblJlc3BvbnNlID0gZmFsc2U7IC8vIENhc3QgcmF5IGFnYWluc3Qgd29ybGQKCiAgICAgIHRoaXMud29ybGQucmF5VGVzdChzb3VyY2UsIHRhcmdldCwgcmF5Y2FzdFJlc3VsdCk7CiAgICAgIGNoYXNzaXNCb2R5LmNvbGxpc2lvblJlc3BvbnNlID0gb2xkU3RhdGU7CiAgICAgIGNvbnN0IG9iamVjdCA9IHJheWNhc3RSZXN1bHQuYm9keTsKICAgICAgd2hlZWwucmF5Y2FzdFJlc3VsdC5ncm91bmRPYmplY3QgPSAwOwoKICAgICAgaWYgKG9iamVjdCkgewogICAgICAgIGRlcHRoID0gcmF5Y2FzdFJlc3VsdC5kaXN0YW5jZTsKICAgICAgICB3aGVlbC5yYXljYXN0UmVzdWx0LmhpdE5vcm1hbFdvcmxkID0gcmF5Y2FzdFJlc3VsdC5oaXROb3JtYWxXb3JsZDsKICAgICAgICB3aGVlbC5pc0luQ29udGFjdCA9IHRydWU7CiAgICAgICAgY29uc3QgaGl0RGlzdGFuY2UgPSByYXljYXN0UmVzdWx0LmRpc3RhbmNlOwogICAgICAgIHdoZWVsLnN1c3BlbnNpb25MZW5ndGggPSBoaXREaXN0YW5jZSAtIHdoZWVsLnJhZGl1czsgLy8gY2xhbXAgb24gbWF4IHN1c3BlbnNpb24gdHJhdmVsCgogICAgICAgIGNvbnN0IG1pblN1c3BlbnNpb25MZW5ndGggPSB3aGVlbC5zdXNwZW5zaW9uUmVzdExlbmd0aCAtIHdoZWVsLm1heFN1c3BlbnNpb25UcmF2ZWw7CiAgICAgICAgY29uc3QgbWF4U3VzcGVuc2lvbkxlbmd0aCA9IHdoZWVsLnN1c3BlbnNpb25SZXN0TGVuZ3RoICsgd2hlZWwubWF4U3VzcGVuc2lvblRyYXZlbDsKCiAgICAgICAgaWYgKHdoZWVsLnN1c3BlbnNpb25MZW5ndGggPCBtaW5TdXNwZW5zaW9uTGVuZ3RoKSB7CiAgICAgICAgICB3aGVlbC5zdXNwZW5zaW9uTGVuZ3RoID0gbWluU3VzcGVuc2lvbkxlbmd0aDsKICAgICAgICB9CgogICAgICAgIGlmICh3aGVlbC5zdXNwZW5zaW9uTGVuZ3RoID4gbWF4U3VzcGVuc2lvbkxlbmd0aCkgewogICAgICAgICAgd2hlZWwuc3VzcGVuc2lvbkxlbmd0aCA9IG1heFN1c3BlbnNpb25MZW5ndGg7CiAgICAgICAgICB3aGVlbC5yYXljYXN0UmVzdWx0LnJlc2V0KCk7CiAgICAgICAgfQoKICAgICAgICBjb25zdCBkZW5vbWluYXRvciA9IHdoZWVsLnJheWNhc3RSZXN1bHQuaGl0Tm9ybWFsV29ybGQuZG90KHdoZWVsLmRpcmVjdGlvbldvcmxkKTsKICAgICAgICBjb25zdCBjaGFzc2lzX3ZlbG9jaXR5X2F0X2NvbnRhY3RQb2ludCA9IG5ldyBWZWMzKCk7CiAgICAgICAgY2hhc3Npc0JvZHkuZ2V0VmVsb2NpdHlBdFdvcmxkUG9pbnQod2hlZWwucmF5Y2FzdFJlc3VsdC5oaXRQb2ludFdvcmxkLCBjaGFzc2lzX3ZlbG9jaXR5X2F0X2NvbnRhY3RQb2ludCk7CiAgICAgICAgY29uc3QgcHJvalZlbCA9IHdoZWVsLnJheWNhc3RSZXN1bHQuaGl0Tm9ybWFsV29ybGQuZG90KGNoYXNzaXNfdmVsb2NpdHlfYXRfY29udGFjdFBvaW50KTsKCiAgICAgICAgaWYgKGRlbm9taW5hdG9yID49IC0wLjEpIHsKICAgICAgICAgIHdoZWVsLnN1c3BlbnNpb25SZWxhdGl2ZVZlbG9jaXR5ID0gMDsKICAgICAgICAgIHdoZWVsLmNsaXBwZWRJbnZDb250YWN0RG90U3VzcGVuc2lvbiA9IDEgLyAwLjE7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGNvbnN0IGludiA9IC0xIC8gZGVub21pbmF0b3I7CiAgICAgICAgICB3aGVlbC5zdXNwZW5zaW9uUmVsYXRpdmVWZWxvY2l0eSA9IHByb2pWZWwgKiBpbnY7CiAgICAgICAgICB3aGVlbC5jbGlwcGVkSW52Q29udGFjdERvdFN1c3BlbnNpb24gPSBpbnY7CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIC8vcHV0IHdoZWVsIGluZm8gYXMgaW4gcmVzdCBwb3NpdGlvbgogICAgICAgIHdoZWVsLnN1c3BlbnNpb25MZW5ndGggPSB3aGVlbC5zdXNwZW5zaW9uUmVzdExlbmd0aCArIDAgKiB3aGVlbC5tYXhTdXNwZW5zaW9uVHJhdmVsOwogICAgICAgIHdoZWVsLnN1c3BlbnNpb25SZWxhdGl2ZVZlbG9jaXR5ID0gMC4wOwogICAgICAgIHdoZWVsLmRpcmVjdGlvbldvcmxkLnNjYWxlKC0xLCB3aGVlbC5yYXljYXN0UmVzdWx0LmhpdE5vcm1hbFdvcmxkKTsKICAgICAgICB3aGVlbC5jbGlwcGVkSW52Q29udGFjdERvdFN1c3BlbnNpb24gPSAxLjA7CiAgICAgIH0KCiAgICAgIHJldHVybiBkZXB0aDsKICAgIH0KCiAgICB1cGRhdGVXaGVlbFRyYW5zZm9ybVdvcmxkKHdoZWVsKSB7CiAgICAgIHdoZWVsLmlzSW5Db250YWN0ID0gZmFsc2U7CiAgICAgIGNvbnN0IGNoYXNzaXNCb2R5ID0gdGhpcy5jaGFzc2lzQm9keTsKICAgICAgY2hhc3Npc0JvZHkucG9pbnRUb1dvcmxkRnJhbWUod2hlZWwuY2hhc3Npc0Nvbm5lY3Rpb25Qb2ludExvY2FsLCB3aGVlbC5jaGFzc2lzQ29ubmVjdGlvblBvaW50V29ybGQpOwogICAgICBjaGFzc2lzQm9keS52ZWN0b3JUb1dvcmxkRnJhbWUod2hlZWwuZGlyZWN0aW9uTG9jYWwsIHdoZWVsLmRpcmVjdGlvbldvcmxkKTsKICAgICAgY2hhc3Npc0JvZHkudmVjdG9yVG9Xb3JsZEZyYW1lKHdoZWVsLmF4bGVMb2NhbCwgd2hlZWwuYXhsZVdvcmxkKTsKICAgIH0KICAgIC8qKgogICAgICogVXBkYXRlIG9uZSBvZiB0aGUgd2hlZWwgdHJhbnNmb3JtLgogICAgICogTm90ZSB3aGVuIHJlbmRlcmluZyB3aGVlbHM6IGR1cmluZyBlYWNoIHN0ZXAsIHdoZWVsIHRyYW5zZm9ybXMgYXJlIHVwZGF0ZWQgQkVGT1JFIHRoZSBjaGFzc2lzOyBpZS4gdGhlaXIgcG9zaXRpb24gYmVjb21lcyBpbnZhbGlkIGFmdGVyIHRoZSBzdGVwLiBUaHVzIHdoZW4geW91IHJlbmRlciB3aGVlbHMsIHlvdSBtdXN0IHVwZGF0ZSB3aGVlbCB0cmFuc2Zvcm1zIGJlZm9yZSByZW5kZXJpbmcgdGhlbS4gU2VlIHJheWNhc3RWZWhpY2xlIGRlbW8gZm9yIGFuIGV4YW1wbGUuCiAgICAgKiBAcGFyYW0gd2hlZWxJbmRleCBUaGUgd2hlZWwgaW5kZXggdG8gdXBkYXRlLgogICAgICovCgoKICAgIHVwZGF0ZVdoZWVsVHJhbnNmb3JtKHdoZWVsSW5kZXgpIHsKICAgICAgY29uc3QgdXAgPSB0bXBWZWM0OwogICAgICBjb25zdCByaWdodCA9IHRtcFZlYzU7CiAgICAgIGNvbnN0IGZ3ZCA9IHRtcFZlYzY7CiAgICAgIGNvbnN0IHdoZWVsID0gdGhpcy53aGVlbEluZm9zW3doZWVsSW5kZXhdOwogICAgICB0aGlzLnVwZGF0ZVdoZWVsVHJhbnNmb3JtV29ybGQod2hlZWwpOwogICAgICB3aGVlbC5kaXJlY3Rpb25Mb2NhbC5zY2FsZSgtMSwgdXApOwogICAgICByaWdodC5jb3B5KHdoZWVsLmF4bGVMb2NhbCk7CiAgICAgIHVwLmNyb3NzKHJpZ2h0LCBmd2QpOwogICAgICBmd2Qubm9ybWFsaXplKCk7CiAgICAgIHJpZ2h0Lm5vcm1hbGl6ZSgpOyAvLyBSb3RhdGUgYXJvdW5kIHN0ZWVyaW5nIG92ZXIgdGhlIHdoZWVsQXhsZQoKICAgICAgY29uc3Qgc3RlZXJpbmcgPSB3aGVlbC5zdGVlcmluZzsKICAgICAgY29uc3Qgc3RlZXJpbmdPcm4gPSBuZXcgUXVhdGVybmlvbigpOwogICAgICBzdGVlcmluZ09ybi5zZXRGcm9tQXhpc0FuZ2xlKHVwLCBzdGVlcmluZyk7CiAgICAgIGNvbnN0IHJvdGF0aW5nT3JuID0gbmV3IFF1YXRlcm5pb24oKTsKICAgICAgcm90YXRpbmdPcm4uc2V0RnJvbUF4aXNBbmdsZShyaWdodCwgd2hlZWwucm90YXRpb24pOyAvLyBXb3JsZCByb3RhdGlvbiBvZiB0aGUgd2hlZWwKCiAgICAgIGNvbnN0IHEgPSB3aGVlbC53b3JsZFRyYW5zZm9ybS5xdWF0ZXJuaW9uOwogICAgICB0aGlzLmNoYXNzaXNCb2R5LnF1YXRlcm5pb24ubXVsdChzdGVlcmluZ09ybiwgcSk7CiAgICAgIHEubXVsdChyb3RhdGluZ09ybiwgcSk7CiAgICAgIHEubm9ybWFsaXplKCk7IC8vIHdvcmxkIHBvc2l0aW9uIG9mIHRoZSB3aGVlbAoKICAgICAgY29uc3QgcCA9IHdoZWVsLndvcmxkVHJhbnNmb3JtLnBvc2l0aW9uOwogICAgICBwLmNvcHkod2hlZWwuZGlyZWN0aW9uV29ybGQpOwogICAgICBwLnNjYWxlKHdoZWVsLnN1c3BlbnNpb25MZW5ndGgsIHApOwogICAgICBwLnZhZGQod2hlZWwuY2hhc3Npc0Nvbm5lY3Rpb25Qb2ludFdvcmxkLCBwKTsKICAgIH0KICAgIC8qKgogICAgICogR2V0IHRoZSB3b3JsZCB0cmFuc2Zvcm0gb2Ygb25lIG9mIHRoZSB3aGVlbHMKICAgICAqLwoKCiAgICBnZXRXaGVlbFRyYW5zZm9ybVdvcmxkKHdoZWVsSW5kZXgpIHsKICAgICAgcmV0dXJuIHRoaXMud2hlZWxJbmZvc1t3aGVlbEluZGV4XS53b3JsZFRyYW5zZm9ybTsKICAgIH0KCiAgICB1cGRhdGVGcmljdGlvbih0aW1lU3RlcCkgewogICAgICBjb25zdCBzdXJmTm9ybWFsV1Nfc2NhbGVkX3Byb2ogPSB1cGRhdGVGcmljdGlvbl9zdXJmTm9ybWFsV1Nfc2NhbGVkX3Byb2o7IC8vY2FsY3VsYXRlIHRoZSBpbXB1bHNlLCBzbyB0aGF0IHRoZSB3aGVlbHMgZG9uJ3QgbW92ZSBzaWRld2FyZHMKCiAgICAgIGNvbnN0IHdoZWVsSW5mb3MgPSB0aGlzLndoZWVsSW5mb3M7CiAgICAgIGNvbnN0IG51bVdoZWVscyA9IHdoZWVsSW5mb3MubGVuZ3RoOwogICAgICBjb25zdCBjaGFzc2lzQm9keSA9IHRoaXMuY2hhc3Npc0JvZHk7CiAgICAgIGNvbnN0IGZvcndhcmRXUyA9IHVwZGF0ZUZyaWN0aW9uX2ZvcndhcmRXUzsKICAgICAgY29uc3QgYXhsZSA9IHVwZGF0ZUZyaWN0aW9uX2F4bGU7CiAgICAgIHRoaXMubnVtV2hlZWxzT25Hcm91bmQgPSAwOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBudW1XaGVlbHM7IGkrKykgewogICAgICAgIGNvbnN0IHdoZWVsID0gd2hlZWxJbmZvc1tpXTsKICAgICAgICBjb25zdCBncm91bmRPYmplY3QgPSB3aGVlbC5yYXljYXN0UmVzdWx0LmJvZHk7CgogICAgICAgIGlmIChncm91bmRPYmplY3QpIHsKICAgICAgICAgIHRoaXMubnVtV2hlZWxzT25Hcm91bmQrKzsKICAgICAgICB9CgogICAgICAgIHdoZWVsLnNpZGVJbXB1bHNlID0gMDsKICAgICAgICB3aGVlbC5mb3J3YXJkSW1wdWxzZSA9IDA7CgogICAgICAgIGlmICghZm9yd2FyZFdTW2ldKSB7CiAgICAgICAgICBmb3J3YXJkV1NbaV0gPSBuZXcgVmVjMygpOwogICAgICAgIH0KCiAgICAgICAgaWYgKCFheGxlW2ldKSB7CiAgICAgICAgICBheGxlW2ldID0gbmV3IFZlYzMoKTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbnVtV2hlZWxzOyBpKyspIHsKICAgICAgICBjb25zdCB3aGVlbCA9IHdoZWVsSW5mb3NbaV07CiAgICAgICAgY29uc3QgZ3JvdW5kT2JqZWN0ID0gd2hlZWwucmF5Y2FzdFJlc3VsdC5ib2R5OwoKICAgICAgICBpZiAoZ3JvdW5kT2JqZWN0KSB7CiAgICAgICAgICBjb25zdCBheGxlaSA9IGF4bGVbaV07CiAgICAgICAgICBjb25zdCB3aGVlbFRyYW5zID0gdGhpcy5nZXRXaGVlbFRyYW5zZm9ybVdvcmxkKGkpOyAvLyBHZXQgd29ybGQgYXhsZQoKICAgICAgICAgIHdoZWVsVHJhbnMudmVjdG9yVG9Xb3JsZEZyYW1lKGRpcmVjdGlvbnNbdGhpcy5pbmRleFJpZ2h0QXhpc10sIGF4bGVpKTsKICAgICAgICAgIGNvbnN0IHN1cmZOb3JtYWxXUyA9IHdoZWVsLnJheWNhc3RSZXN1bHQuaGl0Tm9ybWFsV29ybGQ7CiAgICAgICAgICBjb25zdCBwcm9qID0gYXhsZWkuZG90KHN1cmZOb3JtYWxXUyk7CiAgICAgICAgICBzdXJmTm9ybWFsV1Muc2NhbGUocHJvaiwgc3VyZk5vcm1hbFdTX3NjYWxlZF9wcm9qKTsKICAgICAgICAgIGF4bGVpLnZzdWIoc3VyZk5vcm1hbFdTX3NjYWxlZF9wcm9qLCBheGxlaSk7CiAgICAgICAgICBheGxlaS5ub3JtYWxpemUoKTsKICAgICAgICAgIHN1cmZOb3JtYWxXUy5jcm9zcyhheGxlaSwgZm9yd2FyZFdTW2ldKTsKICAgICAgICAgIGZvcndhcmRXU1tpXS5ub3JtYWxpemUoKTsKICAgICAgICAgIHdoZWVsLnNpZGVJbXB1bHNlID0gcmVzb2x2ZVNpbmdsZUJpbGF0ZXJhbChjaGFzc2lzQm9keSwgd2hlZWwucmF5Y2FzdFJlc3VsdC5oaXRQb2ludFdvcmxkLCBncm91bmRPYmplY3QsIHdoZWVsLnJheWNhc3RSZXN1bHQuaGl0UG9pbnRXb3JsZCwgYXhsZWkpOwogICAgICAgICAgd2hlZWwuc2lkZUltcHVsc2UgKj0gc2lkZUZyaWN0aW9uU3RpZmZuZXNzMjsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIGNvbnN0IHNpZGVGYWN0b3IgPSAxOwogICAgICBjb25zdCBmd2RGYWN0b3IgPSAwLjU7CiAgICAgIHRoaXMuc2xpZGluZyA9IGZhbHNlOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBudW1XaGVlbHM7IGkrKykgewogICAgICAgIGNvbnN0IHdoZWVsID0gd2hlZWxJbmZvc1tpXTsKICAgICAgICBjb25zdCBncm91bmRPYmplY3QgPSB3aGVlbC5yYXljYXN0UmVzdWx0LmJvZHk7CiAgICAgICAgbGV0IHJvbGxpbmdGcmljdGlvbiA9IDA7CiAgICAgICAgd2hlZWwuc2xpcEluZm8gPSAxOwoKICAgICAgICBpZiAoZ3JvdW5kT2JqZWN0KSB7CiAgICAgICAgICBjb25zdCBkZWZhdWx0Um9sbGluZ0ZyaWN0aW9uSW1wdWxzZSA9IDA7CiAgICAgICAgICBjb25zdCBtYXhJbXB1bHNlID0gd2hlZWwuYnJha2UgPyB3aGVlbC5icmFrZSA6IGRlZmF1bHRSb2xsaW5nRnJpY3Rpb25JbXB1bHNlOyAvLyBidFdoZWVsQ29udGFjdFBvaW50IGNvbnRhY3RQdChjaGFzc2lzQm9keSxncm91bmRPYmplY3Qsd2hlZWxJbmZyYXljYXN0SW5mby5oaXRQb2ludFdvcmxkLGZvcndhcmRXU1t3aGVlbF0sbWF4SW1wdWxzZSk7CiAgICAgICAgICAvLyByb2xsaW5nRnJpY3Rpb24gPSBjYWxjUm9sbGluZ0ZyaWN0aW9uKGNvbnRhY3RQdCk7CgogICAgICAgICAgcm9sbGluZ0ZyaWN0aW9uID0gY2FsY1JvbGxpbmdGcmljdGlvbihjaGFzc2lzQm9keSwgZ3JvdW5kT2JqZWN0LCB3aGVlbC5yYXljYXN0UmVzdWx0LmhpdFBvaW50V29ybGQsIGZvcndhcmRXU1tpXSwgbWF4SW1wdWxzZSk7CiAgICAgICAgICByb2xsaW5nRnJpY3Rpb24gKz0gd2hlZWwuZW5naW5lRm9yY2UgKiB0aW1lU3RlcDsgLy8gcm9sbGluZ0ZyaWN0aW9uID0gMDsKCiAgICAgICAgICBjb25zdCBmYWN0b3IgPSBtYXhJbXB1bHNlIC8gcm9sbGluZ0ZyaWN0aW9uOwogICAgICAgICAgd2hlZWwuc2xpcEluZm8gKj0gZmFjdG9yOwogICAgICAgIH0gLy9zd2l0Y2ggYmV0d2VlbiBhY3RpdmUgcm9sbGluZyAodGhyb3R0bGUpLCBicmFraW5nIGFuZCBub24tYWN0aXZlIHJvbGxpbmcgZnJpY3Rpb24gKG50aHJvdHRsZS9icmVhaykKCgogICAgICAgIHdoZWVsLmZvcndhcmRJbXB1bHNlID0gMDsKICAgICAgICB3aGVlbC5za2lkSW5mbyA9IDE7CgogICAgICAgIGlmIChncm91bmRPYmplY3QpIHsKICAgICAgICAgIHdoZWVsLnNraWRJbmZvID0gMTsKICAgICAgICAgIGNvbnN0IG1heGltcCA9IHdoZWVsLnN1c3BlbnNpb25Gb3JjZSAqIHRpbWVTdGVwICogd2hlZWwuZnJpY3Rpb25TbGlwOwogICAgICAgICAgY29uc3QgbWF4aW1wU2lkZSA9IG1heGltcDsKICAgICAgICAgIGNvbnN0IG1heGltcFNxdWFyZWQgPSBtYXhpbXAgKiBtYXhpbXBTaWRlOwogICAgICAgICAgd2hlZWwuZm9yd2FyZEltcHVsc2UgPSByb2xsaW5nRnJpY3Rpb247IC8vd2hlZWxJbmZvLmVuZ2luZUZvcmNlKiB0aW1lU3RlcDsKCiAgICAgICAgICBjb25zdCB4ID0gd2hlZWwuZm9yd2FyZEltcHVsc2UgKiBmd2RGYWN0b3IgLyB3aGVlbC5mb3J3YXJkQWNjZWxlcmF0aW9uOwogICAgICAgICAgY29uc3QgeSA9IHdoZWVsLnNpZGVJbXB1bHNlICogc2lkZUZhY3RvciAvIHdoZWVsLnNpZGVBY2NlbGVyYXRpb247CiAgICAgICAgICBjb25zdCBpbXB1bHNlU3F1YXJlZCA9IHggKiB4ICsgeSAqIHk7CiAgICAgICAgICB3aGVlbC5zbGlkaW5nID0gZmFsc2U7CgogICAgICAgICAgaWYgKGltcHVsc2VTcXVhcmVkID4gbWF4aW1wU3F1YXJlZCkgewogICAgICAgICAgICB0aGlzLnNsaWRpbmcgPSB0cnVlOwogICAgICAgICAgICB3aGVlbC5zbGlkaW5nID0gdHJ1ZTsKICAgICAgICAgICAgY29uc3QgZmFjdG9yID0gbWF4aW1wIC8gTWF0aC5zcXJ0KGltcHVsc2VTcXVhcmVkKTsKICAgICAgICAgICAgd2hlZWwuc2tpZEluZm8gKj0gZmFjdG9yOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQoKICAgICAgaWYgKHRoaXMuc2xpZGluZykgewogICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbnVtV2hlZWxzOyBpKyspIHsKICAgICAgICAgIGNvbnN0IHdoZWVsID0gd2hlZWxJbmZvc1tpXTsKCiAgICAgICAgICBpZiAod2hlZWwuc2lkZUltcHVsc2UgIT09IDApIHsKICAgICAgICAgICAgaWYgKHdoZWVsLnNraWRJbmZvIDwgMSkgewogICAgICAgICAgICAgIHdoZWVsLmZvcndhcmRJbXB1bHNlICo9IHdoZWVsLnNraWRJbmZvOwogICAgICAgICAgICAgIHdoZWVsLnNpZGVJbXB1bHNlICo9IHdoZWVsLnNraWRJbmZvOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9IC8vIGFwcGx5IHRoZSBpbXB1bHNlcwoKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbnVtV2hlZWxzOyBpKyspIHsKICAgICAgICBjb25zdCB3aGVlbCA9IHdoZWVsSW5mb3NbaV07CiAgICAgICAgY29uc3QgcmVsX3BvcyA9IG5ldyBWZWMzKCk7CiAgICAgICAgd2hlZWwucmF5Y2FzdFJlc3VsdC5oaXRQb2ludFdvcmxkLnZzdWIoY2hhc3Npc0JvZHkucG9zaXRpb24sIHJlbF9wb3MpOyAvLyBjYW5ub25zIGFwcGx5aW1wdWxzZSBpcyB1c2luZyB3b3JsZCBjb29yZCBmb3IgdGhlIHBvc2l0aW9uCiAgICAgICAgLy9yZWxfcG9zLmNvcHkod2hlZWwucmF5Y2FzdFJlc3VsdC5oaXRQb2ludFdvcmxkKTsKCiAgICAgICAgaWYgKHdoZWVsLmZvcndhcmRJbXB1bHNlICE9PSAwKSB7CiAgICAgICAgICBjb25zdCBpbXB1bHNlID0gbmV3IFZlYzMoKTsKICAgICAgICAgIGZvcndhcmRXU1tpXS5zY2FsZSh3aGVlbC5mb3J3YXJkSW1wdWxzZSwgaW1wdWxzZSk7CiAgICAgICAgICBjaGFzc2lzQm9keS5hcHBseUltcHVsc2UoaW1wdWxzZSwgcmVsX3Bvcyk7CiAgICAgICAgfQoKICAgICAgICBpZiAod2hlZWwuc2lkZUltcHVsc2UgIT09IDApIHsKICAgICAgICAgIGNvbnN0IGdyb3VuZE9iamVjdCA9IHdoZWVsLnJheWNhc3RSZXN1bHQuYm9keTsKICAgICAgICAgIGNvbnN0IHJlbF9wb3MyID0gbmV3IFZlYzMoKTsKICAgICAgICAgIHdoZWVsLnJheWNhc3RSZXN1bHQuaGl0UG9pbnRXb3JsZC52c3ViKGdyb3VuZE9iamVjdC5wb3NpdGlvbiwgcmVsX3BvczIpOyAvL3JlbF9wb3MyLmNvcHkod2hlZWwucmF5Y2FzdFJlc3VsdC5oaXRQb2ludFdvcmxkKTsKCiAgICAgICAgICBjb25zdCBzaWRlSW1wID0gbmV3IFZlYzMoKTsKICAgICAgICAgIGF4bGVbaV0uc2NhbGUod2hlZWwuc2lkZUltcHVsc2UsIHNpZGVJbXApOyAvLyBTY2FsZSB0aGUgcmVsYXRpdmUgcG9zaXRpb24gaW4gdGhlIHVwIGRpcmVjdGlvbiB3aXRoIHJvbGxJbmZsdWVuY2UuCiAgICAgICAgICAvLyBJZiByb2xsSW5mbHVlbmNlIGlzIDEsIHRoZSBpbXB1bHNlIHdpbGwgYmUgYXBwbGllZCBvbiB0aGUgaGl0UG9pbnQgKGVhc3kgdG8gcm9sbCBvdmVyKSwgaWYgaXQgaXMgemVybyBpdCB3aWxsIGJlIGFwcGxpZWQgaW4gdGhlIHNhbWUgcGxhbmUgYXMgdGhlIGNlbnRlciBvZiBtYXNzIChub3QgZWFzeSB0byByb2xsIG92ZXIpLgoKICAgICAgICAgIGNoYXNzaXNCb2R5LnZlY3RvclRvTG9jYWxGcmFtZShyZWxfcG9zLCByZWxfcG9zKTsKICAgICAgICAgIHJlbF9wb3NbJ3h5eidbdGhpcy5pbmRleFVwQXhpc11dICo9IHdoZWVsLnJvbGxJbmZsdWVuY2U7CiAgICAgICAgICBjaGFzc2lzQm9keS52ZWN0b3JUb1dvcmxkRnJhbWUocmVsX3BvcywgcmVsX3Bvcyk7CiAgICAgICAgICBjaGFzc2lzQm9keS5hcHBseUltcHVsc2Uoc2lkZUltcCwgcmVsX3Bvcyk7IC8vYXBwbHkgZnJpY3Rpb24gaW1wdWxzZSBvbiB0aGUgZ3JvdW5kCgogICAgICAgICAgc2lkZUltcC5zY2FsZSgtMSwgc2lkZUltcCk7CiAgICAgICAgICBncm91bmRPYmplY3QuYXBwbHlJbXB1bHNlKHNpZGVJbXAsIHJlbF9wb3MyKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KCiAgfQogIG5ldyBWZWMzKCk7CiAgbmV3IFZlYzMoKTsKICBuZXcgVmVjMygpOwogIGNvbnN0IHRtcFZlYzQgPSBuZXcgVmVjMygpOwogIGNvbnN0IHRtcFZlYzUgPSBuZXcgVmVjMygpOwogIGNvbnN0IHRtcFZlYzYgPSBuZXcgVmVjMygpOwogIG5ldyBSYXkoKTsKICBuZXcgVmVjMygpOwogIGNvbnN0IGNhc3RSYXlfcmF5dmVjdG9yID0gbmV3IFZlYzMoKTsKICBjb25zdCBjYXN0UmF5X3RhcmdldCA9IG5ldyBWZWMzKCk7CiAgY29uc3QgZGlyZWN0aW9ucyA9IFtuZXcgVmVjMygxLCAwLCAwKSwgbmV3IFZlYzMoMCwgMSwgMCksIG5ldyBWZWMzKDAsIDAsIDEpXTsKICBjb25zdCB1cGRhdGVGcmljdGlvbl9zdXJmTm9ybWFsV1Nfc2NhbGVkX3Byb2ogPSBuZXcgVmVjMygpOwogIGNvbnN0IHVwZGF0ZUZyaWN0aW9uX2F4bGUgPSBbXTsKICBjb25zdCB1cGRhdGVGcmljdGlvbl9mb3J3YXJkV1MgPSBbXTsKICBjb25zdCBzaWRlRnJpY3Rpb25TdGlmZm5lc3MyID0gMTsKICBjb25zdCBjYWxjUm9sbGluZ0ZyaWN0aW9uX3ZlbDEgPSBuZXcgVmVjMygpOwogIGNvbnN0IGNhbGNSb2xsaW5nRnJpY3Rpb25fdmVsMiA9IG5ldyBWZWMzKCk7CiAgY29uc3QgY2FsY1JvbGxpbmdGcmljdGlvbl92ZWwgPSBuZXcgVmVjMygpOwoKICBmdW5jdGlvbiBjYWxjUm9sbGluZ0ZyaWN0aW9uKGJvZHkwLCBib2R5MSwgZnJpY3Rpb25Qb3NXb3JsZCwgZnJpY3Rpb25EaXJlY3Rpb25Xb3JsZCwgbWF4SW1wdWxzZSkgewogICAgbGV0IGoxID0gMDsKICAgIGNvbnN0IGNvbnRhY3RQb3NXb3JsZCA9IGZyaWN0aW9uUG9zV29ybGQ7IC8vIGNvbnN0IHJlbF9wb3MxID0gbmV3IFZlYzMoKTsKICAgIC8vIGNvbnN0IHJlbF9wb3MyID0gbmV3IFZlYzMoKTsKCiAgICBjb25zdCB2ZWwxID0gY2FsY1JvbGxpbmdGcmljdGlvbl92ZWwxOwogICAgY29uc3QgdmVsMiA9IGNhbGNSb2xsaW5nRnJpY3Rpb25fdmVsMjsKICAgIGNvbnN0IHZlbCA9IGNhbGNSb2xsaW5nRnJpY3Rpb25fdmVsOyAvLyBjb250YWN0UG9zV29ybGQudnN1Yihib2R5MC5wb3NpdGlvbiwgcmVsX3BvczEpOwogICAgLy8gY29udGFjdFBvc1dvcmxkLnZzdWIoYm9keTEucG9zaXRpb24sIHJlbF9wb3MyKTsKCiAgICBib2R5MC5nZXRWZWxvY2l0eUF0V29ybGRQb2ludChjb250YWN0UG9zV29ybGQsIHZlbDEpOwogICAgYm9keTEuZ2V0VmVsb2NpdHlBdFdvcmxkUG9pbnQoY29udGFjdFBvc1dvcmxkLCB2ZWwyKTsKICAgIHZlbDEudnN1Yih2ZWwyLCB2ZWwpOwogICAgY29uc3QgdnJlbCA9IGZyaWN0aW9uRGlyZWN0aW9uV29ybGQuZG90KHZlbCk7CiAgICBjb25zdCBkZW5vbTAgPSBjb21wdXRlSW1wdWxzZURlbm9taW5hdG9yKGJvZHkwLCBmcmljdGlvblBvc1dvcmxkLCBmcmljdGlvbkRpcmVjdGlvbldvcmxkKTsKICAgIGNvbnN0IGRlbm9tMSA9IGNvbXB1dGVJbXB1bHNlRGVub21pbmF0b3IoYm9keTEsIGZyaWN0aW9uUG9zV29ybGQsIGZyaWN0aW9uRGlyZWN0aW9uV29ybGQpOwogICAgY29uc3QgcmVsYXhhdGlvbiA9IDE7CiAgICBjb25zdCBqYWNEaWFnQUJJbnYgPSByZWxheGF0aW9uIC8gKGRlbm9tMCArIGRlbm9tMSk7IC8vIGNhbGN1bGF0ZSBqIHRoYXQgbW92ZXMgdXMgdG8gemVybyByZWxhdGl2ZSB2ZWxvY2l0eQoKICAgIGoxID0gLXZyZWwgKiBqYWNEaWFnQUJJbnY7CgogICAgaWYgKG1heEltcHVsc2UgPCBqMSkgewogICAgICBqMSA9IG1heEltcHVsc2U7CiAgICB9CgogICAgaWYgKGoxIDwgLW1heEltcHVsc2UpIHsKICAgICAgajEgPSAtbWF4SW1wdWxzZTsKICAgIH0KCiAgICByZXR1cm4gajE7CiAgfQoKICBjb25zdCBjb21wdXRlSW1wdWxzZURlbm9taW5hdG9yX3IwID0gbmV3IFZlYzMoKTsKICBjb25zdCBjb21wdXRlSW1wdWxzZURlbm9taW5hdG9yX2MwID0gbmV3IFZlYzMoKTsKICBjb25zdCBjb21wdXRlSW1wdWxzZURlbm9taW5hdG9yX3ZlYyA9IG5ldyBWZWMzKCk7CiAgY29uc3QgY29tcHV0ZUltcHVsc2VEZW5vbWluYXRvcl9tID0gbmV3IFZlYzMoKTsKCiAgZnVuY3Rpb24gY29tcHV0ZUltcHVsc2VEZW5vbWluYXRvcihib2R5LCBwb3MsIG5vcm1hbCkgewogICAgY29uc3QgcjAgPSBjb21wdXRlSW1wdWxzZURlbm9taW5hdG9yX3IwOwogICAgY29uc3QgYzAgPSBjb21wdXRlSW1wdWxzZURlbm9taW5hdG9yX2MwOwogICAgY29uc3QgdmVjID0gY29tcHV0ZUltcHVsc2VEZW5vbWluYXRvcl92ZWM7CiAgICBjb25zdCBtID0gY29tcHV0ZUltcHVsc2VEZW5vbWluYXRvcl9tOwogICAgcG9zLnZzdWIoYm9keS5wb3NpdGlvbiwgcjApOwogICAgcjAuY3Jvc3Mobm9ybWFsLCBjMCk7CiAgICBib2R5LmludkluZXJ0aWFXb3JsZC52bXVsdChjMCwgbSk7CiAgICBtLmNyb3NzKHIwLCB2ZWMpOwogICAgcmV0dXJuIGJvZHkuaW52TWFzcyArIG5vcm1hbC5kb3QodmVjKTsKICB9CgogIGNvbnN0IHJlc29sdmVTaW5nbGVCaWxhdGVyYWxfdmVsMSA9IG5ldyBWZWMzKCk7CiAgY29uc3QgcmVzb2x2ZVNpbmdsZUJpbGF0ZXJhbF92ZWwyID0gbmV3IFZlYzMoKTsKICBjb25zdCByZXNvbHZlU2luZ2xlQmlsYXRlcmFsX3ZlbCA9IG5ldyBWZWMzKCk7IC8vIGJpbGF0ZXJhbCBjb25zdHJhaW50IGJldHdlZW4gdHdvIGR5bmFtaWMgb2JqZWN0cwoKICBmdW5jdGlvbiByZXNvbHZlU2luZ2xlQmlsYXRlcmFsKGJvZHkxLCBwb3MxLCBib2R5MiwgcG9zMiwgbm9ybWFsKSB7CiAgICBjb25zdCBub3JtYWxMZW5TcXIgPSBub3JtYWwubGVuZ3RoU3F1YXJlZCgpOwoKICAgIGlmIChub3JtYWxMZW5TcXIgPiAxLjEpIHsKICAgICAgcmV0dXJuIDA7IC8vIG5vIGltcHVsc2UKICAgIH0gLy8gY29uc3QgcmVsX3BvczEgPSBuZXcgVmVjMygpOwogICAgLy8gY29uc3QgcmVsX3BvczIgPSBuZXcgVmVjMygpOwogICAgLy8gcG9zMS52c3ViKGJvZHkxLnBvc2l0aW9uLCByZWxfcG9zMSk7CiAgICAvLyBwb3MyLnZzdWIoYm9keTIucG9zaXRpb24sIHJlbF9wb3MyKTsKCgogICAgY29uc3QgdmVsMSA9IHJlc29sdmVTaW5nbGVCaWxhdGVyYWxfdmVsMTsKICAgIGNvbnN0IHZlbDIgPSByZXNvbHZlU2luZ2xlQmlsYXRlcmFsX3ZlbDI7CiAgICBjb25zdCB2ZWwgPSByZXNvbHZlU2luZ2xlQmlsYXRlcmFsX3ZlbDsKICAgIGJvZHkxLmdldFZlbG9jaXR5QXRXb3JsZFBvaW50KHBvczEsIHZlbDEpOwogICAgYm9keTIuZ2V0VmVsb2NpdHlBdFdvcmxkUG9pbnQocG9zMiwgdmVsMik7CiAgICB2ZWwxLnZzdWIodmVsMiwgdmVsKTsKICAgIGNvbnN0IHJlbF92ZWwgPSBub3JtYWwuZG90KHZlbCk7CiAgICBjb25zdCBjb250YWN0RGFtcGluZyA9IDAuMjsKICAgIGNvbnN0IG1hc3NUZXJtID0gMSAvIChib2R5MS5pbnZNYXNzICsgYm9keTIuaW52TWFzcyk7CiAgICBjb25zdCBpbXB1bHNlID0gLWNvbnRhY3REYW1waW5nICogcmVsX3ZlbCAqIG1hc3NUZXJtOwogICAgcmV0dXJuIGltcHVsc2U7CiAgfQoKICAvKioKICAgKiBTcGhlcmljYWwgc2hhcGUKICAgKiBAZXhhbXBsZQogICAqICAgICBjb25zdCByYWRpdXMgPSAxCiAgICogICAgIGNvbnN0IHNwaGVyZVNoYXBlID0gbmV3IENBTk5PTi5TcGhlcmUocmFkaXVzKQogICAqICAgICBjb25zdCBzcGhlcmVCb2R5ID0gbmV3IENBTk5PTi5Cb2R5KHsgbWFzczogMSwgc2hhcGU6IHNwaGVyZVNoYXBlIH0pCiAgICogICAgIHdvcmxkLmFkZEJvZHkoc3BoZXJlQm9keSkKICAgKi8KICBjbGFzcyBTcGhlcmUgZXh0ZW5kcyBTaGFwZSB7CiAgICAvKioKICAgICAqIFRoZSByYWRpdXMgb2YgdGhlIHNwaGVyZS4KICAgICAqLwoKICAgIC8qKgogICAgICoKICAgICAqIEBwYXJhbSByYWRpdXMgVGhlIHJhZGl1cyBvZiB0aGUgc3BoZXJlLCBhIG5vbi1uZWdhdGl2ZSBudW1iZXIuCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKHJhZGl1cykgewogICAgICBzdXBlcih7CiAgICAgICAgdHlwZTogU2hhcGUudHlwZXMuU1BIRVJFCiAgICAgIH0pOwogICAgICB0aGlzLnJhZGl1cyA9IHJhZGl1cyAhPT0gdW5kZWZpbmVkID8gcmFkaXVzIDogMS4wOwoKICAgICAgaWYgKHRoaXMucmFkaXVzIDwgMCkgewogICAgICAgIHRocm93IG5ldyBFcnJvcignVGhlIHNwaGVyZSByYWRpdXMgY2Fubm90IGJlIG5lZ2F0aXZlLicpOwogICAgICB9CgogICAgICB0aGlzLnVwZGF0ZUJvdW5kaW5nU3BoZXJlUmFkaXVzKCk7CiAgICB9CiAgICAvKiogY2FsY3VsYXRlTG9jYWxJbmVydGlhICovCgoKICAgIGNhbGN1bGF0ZUxvY2FsSW5lcnRpYShtYXNzLCB0YXJnZXQpIHsKICAgICAgaWYgKHRhcmdldCA9PT0gdm9pZCAwKSB7CiAgICAgICAgdGFyZ2V0ID0gbmV3IFZlYzMoKTsKICAgICAgfQoKICAgICAgY29uc3QgSSA9IDIuMCAqIG1hc3MgKiB0aGlzLnJhZGl1cyAqIHRoaXMucmFkaXVzIC8gNS4wOwogICAgICB0YXJnZXQueCA9IEk7CiAgICAgIHRhcmdldC55ID0gSTsKICAgICAgdGFyZ2V0LnogPSBJOwogICAgICByZXR1cm4gdGFyZ2V0OwogICAgfQogICAgLyoqIHZvbHVtZSAqLwoKCiAgICB2b2x1bWUoKSB7CiAgICAgIHJldHVybiA0LjAgKiBNYXRoLlBJICogTWF0aC5wb3codGhpcy5yYWRpdXMsIDMpIC8gMy4wOwogICAgfQoKICAgIHVwZGF0ZUJvdW5kaW5nU3BoZXJlUmFkaXVzKCkgewogICAgICB0aGlzLmJvdW5kaW5nU3BoZXJlUmFkaXVzID0gdGhpcy5yYWRpdXM7CiAgICB9CgogICAgY2FsY3VsYXRlV29ybGRBQUJCKHBvcywgcXVhdCwgbWluLCBtYXgpIHsKICAgICAgY29uc3QgciA9IHRoaXMucmFkaXVzOwogICAgICBjb25zdCBheGVzID0gWyd4JywgJ3knLCAneiddOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBheGVzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgY29uc3QgYXggPSBheGVzW2ldOwogICAgICAgIG1pbltheF0gPSBwb3NbYXhdIC0gcjsKICAgICAgICBtYXhbYXhdID0gcG9zW2F4XSArIHI7CiAgICAgIH0KICAgIH0KCiAgfQogIG5ldyBWZWMzKCk7CiAgbmV3IFZlYzMoKTsKICBuZXcgVmVjMygpOyAvLyBUZW1wIHZlY3RvcnMgZm9yIGNhbGN1bGF0aW9uCgogIG5ldyBWZWMzKCk7IC8vIFJlbGF0aXZlIHZlbG9jaXR5CgogIG5ldyBWZWMzKCk7CiAgbmV3IFZlYzMoKTsKICBuZXcgVmVjMygpOwogIG5ldyBWZWMzKCk7CiAgbmV3IFZlYzMoKTsKCiAgLyoqCiAgICogQ3lsaW5kZXIgY2xhc3MuCiAgICogQGV4YW1wbGUKICAgKiAgICAgY29uc3QgcmFkaXVzVG9wID0gMC41CiAgICogICAgIGNvbnN0IHJhZGl1c0JvdHRvbSA9IDAuNQogICAqICAgICBjb25zdCBoZWlnaHQgPSAyCiAgICogICAgIGNvbnN0IG51bVNlZ21lbnRzID0gMTIKICAgKiAgICAgY29uc3QgY3lsaW5kZXJTaGFwZSA9IG5ldyBDQU5OT04uQ3lsaW5kZXIocmFkaXVzVG9wLCByYWRpdXNCb3R0b20sIGhlaWdodCwgbnVtU2VnbWVudHMpCiAgICogICAgIGNvbnN0IGN5bGluZGVyQm9keSA9IG5ldyBDQU5OT04uQm9keSh7IG1hc3M6IDEsIHNoYXBlOiBjeWxpbmRlclNoYXBlIH0pCiAgICogICAgIHdvcmxkLmFkZEJvZHkoY3lsaW5kZXJCb2R5KQogICAqLwoKICBjbGFzcyBDeWxpbmRlciBleHRlbmRzIENvbnZleFBvbHloZWRyb24gewogICAgLyoqIFRoZSByYWRpdXMgb2YgdGhlIHRvcCBvZiB0aGUgQ3lsaW5kZXIuICovCgogICAgLyoqIFRoZSByYWRpdXMgb2YgdGhlIGJvdHRvbSBvZiB0aGUgQ3lsaW5kZXIuICovCgogICAgLyoqIFRoZSBoZWlnaHQgb2YgdGhlIEN5bGluZGVyLiAqLwoKICAgIC8qKiBUaGUgbnVtYmVyIG9mIHNlZ21lbnRzIHRvIGJ1aWxkIHRoZSBjeWxpbmRlciBvdXQgb2YuICovCgogICAgLyoqCiAgICAgKiBAcGFyYW0gcmFkaXVzVG9wIFRoZSByYWRpdXMgb2YgdGhlIHRvcCBvZiB0aGUgQ3lsaW5kZXIuCiAgICAgKiBAcGFyYW0gcmFkaXVzQm90dG9tIFRoZSByYWRpdXMgb2YgdGhlIGJvdHRvbSBvZiB0aGUgQ3lsaW5kZXIuCiAgICAgKiBAcGFyYW0gaGVpZ2h0IFRoZSBoZWlnaHQgb2YgdGhlIEN5bGluZGVyLgogICAgICogQHBhcmFtIG51bVNlZ21lbnRzIFRoZSBudW1iZXIgb2Ygc2VnbWVudHMgdG8gYnVpbGQgdGhlIGN5bGluZGVyIG91dCBvZi4KICAgICAqLwogICAgY29uc3RydWN0b3IocmFkaXVzVG9wLCByYWRpdXNCb3R0b20sIGhlaWdodCwgbnVtU2VnbWVudHMpIHsKICAgICAgaWYgKHJhZGl1c1RvcCA9PT0gdm9pZCAwKSB7CiAgICAgICAgcmFkaXVzVG9wID0gMTsKICAgICAgfQoKICAgICAgaWYgKHJhZGl1c0JvdHRvbSA9PT0gdm9pZCAwKSB7CiAgICAgICAgcmFkaXVzQm90dG9tID0gMTsKICAgICAgfQoKICAgICAgaWYgKGhlaWdodCA9PT0gdm9pZCAwKSB7CiAgICAgICAgaGVpZ2h0ID0gMTsKICAgICAgfQoKICAgICAgaWYgKG51bVNlZ21lbnRzID09PSB2b2lkIDApIHsKICAgICAgICBudW1TZWdtZW50cyA9IDg7CiAgICAgIH0KCiAgICAgIGlmIChyYWRpdXNUb3AgPCAwKSB7CiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdUaGUgY3lsaW5kZXIgcmFkaXVzVG9wIGNhbm5vdCBiZSBuZWdhdGl2ZS4nKTsKICAgICAgfQoKICAgICAgaWYgKHJhZGl1c0JvdHRvbSA8IDApIHsKICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1RoZSBjeWxpbmRlciByYWRpdXNCb3R0b20gY2Fubm90IGJlIG5lZ2F0aXZlLicpOwogICAgICB9CgogICAgICBjb25zdCBOID0gbnVtU2VnbWVudHM7CiAgICAgIGNvbnN0IHZlcnRpY2VzID0gW107CiAgICAgIGNvbnN0IGF4ZXMgPSBbXTsKICAgICAgY29uc3QgZmFjZXMgPSBbXTsKICAgICAgY29uc3QgYm90dG9tZmFjZSA9IFtdOwogICAgICBjb25zdCB0b3BmYWNlID0gW107CiAgICAgIGNvbnN0IGNvcyA9IE1hdGguY29zOwogICAgICBjb25zdCBzaW4gPSBNYXRoLnNpbjsgLy8gRmlyc3QgYm90dG9tIHBvaW50CgogICAgICB2ZXJ0aWNlcy5wdXNoKG5ldyBWZWMzKC1yYWRpdXNCb3R0b20gKiBzaW4oMCksIC1oZWlnaHQgKiAwLjUsIHJhZGl1c0JvdHRvbSAqIGNvcygwKSkpOwogICAgICBib3R0b21mYWNlLnB1c2goMCk7IC8vIEZpcnN0IHRvcCBwb2ludAoKICAgICAgdmVydGljZXMucHVzaChuZXcgVmVjMygtcmFkaXVzVG9wICogc2luKDApLCBoZWlnaHQgKiAwLjUsIHJhZGl1c1RvcCAqIGNvcygwKSkpOwogICAgICB0b3BmYWNlLnB1c2goMSk7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IE47IGkrKykgewogICAgICAgIGNvbnN0IHRoZXRhID0gMiAqIE1hdGguUEkgLyBOICogKGkgKyAxKTsKICAgICAgICBjb25zdCB0aGV0YU4gPSAyICogTWF0aC5QSSAvIE4gKiAoaSArIDAuNSk7CgogICAgICAgIGlmIChpIDwgTiAtIDEpIHsKICAgICAgICAgIC8vIEJvdHRvbQogICAgICAgICAgdmVydGljZXMucHVzaChuZXcgVmVjMygtcmFkaXVzQm90dG9tICogc2luKHRoZXRhKSwgLWhlaWdodCAqIDAuNSwgcmFkaXVzQm90dG9tICogY29zKHRoZXRhKSkpOwogICAgICAgICAgYm90dG9tZmFjZS5wdXNoKDIgKiBpICsgMik7IC8vIFRvcAoKICAgICAgICAgIHZlcnRpY2VzLnB1c2gobmV3IFZlYzMoLXJhZGl1c1RvcCAqIHNpbih0aGV0YSksIGhlaWdodCAqIDAuNSwgcmFkaXVzVG9wICogY29zKHRoZXRhKSkpOwogICAgICAgICAgdG9wZmFjZS5wdXNoKDIgKiBpICsgMyk7IC8vIEZhY2UKCiAgICAgICAgICBmYWNlcy5wdXNoKFsyICogaSwgMiAqIGkgKyAxLCAyICogaSArIDMsIDIgKiBpICsgMl0pOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBmYWNlcy5wdXNoKFsyICogaSwgMiAqIGkgKyAxLCAxLCAwXSk7IC8vIENvbm5lY3QKICAgICAgICB9IC8vIEF4aXM6IHdlIGNhbiBjdXQgb2ZmIGhhbGYgb2YgdGhlbSBpZiB3ZSBoYXZlIGV2ZW4gbnVtYmVyIG9mIHNlZ21lbnRzCgoKICAgICAgICBpZiAoTiAlIDIgPT09IDEgfHwgaSA8IE4gLyAyKSB7CiAgICAgICAgICBheGVzLnB1c2gobmV3IFZlYzMoLXNpbih0aGV0YU4pLCAwLCBjb3ModGhldGFOKSkpOwogICAgICAgIH0KICAgICAgfQoKICAgICAgZmFjZXMucHVzaChib3R0b21mYWNlKTsKICAgICAgYXhlcy5wdXNoKG5ldyBWZWMzKDAsIDEsIDApKTsgLy8gUmVvcmRlciB0b3AgZmFjZQoKICAgICAgY29uc3QgdGVtcCA9IFtdOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0b3BmYWNlLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgdGVtcC5wdXNoKHRvcGZhY2VbdG9wZmFjZS5sZW5ndGggLSBpIC0gMV0pOwogICAgICB9CgogICAgICBmYWNlcy5wdXNoKHRlbXApOwogICAgICBzdXBlcih7CiAgICAgICAgdmVydGljZXMsCiAgICAgICAgZmFjZXMsCiAgICAgICAgYXhlcwogICAgICB9KTsKICAgICAgdGhpcy50eXBlID0gU2hhcGUudHlwZXMuQ1lMSU5ERVI7CiAgICAgIHRoaXMucmFkaXVzVG9wID0gcmFkaXVzVG9wOwogICAgICB0aGlzLnJhZGl1c0JvdHRvbSA9IHJhZGl1c0JvdHRvbTsKICAgICAgdGhpcy5oZWlnaHQgPSBoZWlnaHQ7CiAgICAgIHRoaXMubnVtU2VnbWVudHMgPSBudW1TZWdtZW50czsKICAgIH0KCiAgfQoKICAvKioKICAgKiBQYXJ0aWNsZSBzaGFwZS4KICAgKiBAZXhhbXBsZQogICAqICAgICBjb25zdCBwYXJ0aWNsZVNoYXBlID0gbmV3IENBTk5PTi5QYXJ0aWNsZSgpCiAgICogICAgIGNvbnN0IHBhcnRpY2xlQm9keSA9IG5ldyBDQU5OT04uQm9keSh7IG1hc3M6IDEsIHNoYXBlOiBwYXJ0aWNsZVNoYXBlIH0pCiAgICogICAgIHdvcmxkLmFkZEJvZHkocGFydGljbGVCb2R5KQogICAqLwogIGNsYXNzIFBhcnRpY2xlIGV4dGVuZHMgU2hhcGUgewogICAgY29uc3RydWN0b3IoKSB7CiAgICAgIHN1cGVyKHsKICAgICAgICB0eXBlOiBTaGFwZS50eXBlcy5QQVJUSUNMRQogICAgICB9KTsKICAgIH0KICAgIC8qKgogICAgICogY2FsY3VsYXRlTG9jYWxJbmVydGlhCiAgICAgKi8KCgogICAgY2FsY3VsYXRlTG9jYWxJbmVydGlhKG1hc3MsIHRhcmdldCkgewogICAgICBpZiAodGFyZ2V0ID09PSB2b2lkIDApIHsKICAgICAgICB0YXJnZXQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICB0YXJnZXQuc2V0KDAsIDAsIDApOwogICAgICByZXR1cm4gdGFyZ2V0OwogICAgfQoKICAgIHZvbHVtZSgpIHsKICAgICAgcmV0dXJuIDA7CiAgICB9CgogICAgdXBkYXRlQm91bmRpbmdTcGhlcmVSYWRpdXMoKSB7CiAgICAgIHRoaXMuYm91bmRpbmdTcGhlcmVSYWRpdXMgPSAwOwogICAgfQoKICAgIGNhbGN1bGF0ZVdvcmxkQUFCQihwb3MsIHF1YXQsIG1pbiwgbWF4KSB7CiAgICAgIC8vIEdldCBlYWNoIGF4aXMgbWF4CiAgICAgIG1pbi5jb3B5KHBvcyk7CiAgICAgIG1heC5jb3B5KHBvcyk7CiAgICB9CgogIH0KCiAgLyoqCiAgICogQSBwbGFuZSwgZmFjaW5nIGluIHRoZSBaIGRpcmVjdGlvbi4gVGhlIHBsYW5lIGhhcyBpdHMgc3VyZmFjZSBhdCB6PTAgYW5kIGV2ZXJ5dGhpbmcgYmVsb3cgej0wIGlzIGFzc3VtZWQgdG8gYmUgc29saWQgcGxhbmUuIFRvIG1ha2UgdGhlIHBsYW5lIGZhY2UgaW4gc29tZSBvdGhlciBkaXJlY3Rpb24gdGhhbiB6LCB5b3UgbXVzdCBwdXQgaXQgaW5zaWRlIGEgQm9keSBhbmQgcm90YXRlIHRoYXQgYm9keS4gU2VlIHRoZSBkZW1vcy4KICAgKiBAZXhhbXBsZQogICAqICAgICBjb25zdCBwbGFuZVNoYXBlID0gbmV3IENBTk5PTi5QbGFuZSgpCiAgICogICAgIGNvbnN0IHBsYW5lQm9keSA9IG5ldyBDQU5OT04uQm9keSh7IG1hc3M6IDAsIHNoYXBlOiAgcGxhbmVTaGFwZSB9KQogICAqICAgICBwbGFuZUJvZHkucXVhdGVybmlvbi5zZXRGcm9tRXVsZXIoLU1hdGguUEkgLyAyLCAwLCAwKSAvLyBtYWtlIGl0IGZhY2UgdXAKICAgKiAgICAgd29ybGQuYWRkQm9keShwbGFuZUJvZHkpCiAgICovCiAgY2xhc3MgUGxhbmUgZXh0ZW5kcyBTaGFwZSB7CiAgICAvKiogd29ybGROb3JtYWwgKi8KCiAgICAvKiogd29ybGROb3JtYWxOZWVkc1VwZGF0ZSAqLwogICAgY29uc3RydWN0b3IoKSB7CiAgICAgIHN1cGVyKHsKICAgICAgICB0eXBlOiBTaGFwZS50eXBlcy5QTEFORQogICAgICB9KTsgLy8gV29ybGQgb3JpZW50ZWQgbm9ybWFsCgogICAgICB0aGlzLndvcmxkTm9ybWFsID0gbmV3IFZlYzMoKTsKICAgICAgdGhpcy53b3JsZE5vcm1hbE5lZWRzVXBkYXRlID0gdHJ1ZTsKICAgICAgdGhpcy5ib3VuZGluZ1NwaGVyZVJhZGl1cyA9IE51bWJlci5NQVhfVkFMVUU7CiAgICB9CiAgICAvKiogY29tcHV0ZVdvcmxkTm9ybWFsICovCgoKICAgIGNvbXB1dGVXb3JsZE5vcm1hbChxdWF0KSB7CiAgICAgIGNvbnN0IG4gPSB0aGlzLndvcmxkTm9ybWFsOwogICAgICBuLnNldCgwLCAwLCAxKTsKICAgICAgcXVhdC52bXVsdChuLCBuKTsKICAgICAgdGhpcy53b3JsZE5vcm1hbE5lZWRzVXBkYXRlID0gZmFsc2U7CiAgICB9CgogICAgY2FsY3VsYXRlTG9jYWxJbmVydGlhKG1hc3MsIHRhcmdldCkgewogICAgICBpZiAodGFyZ2V0ID09PSB2b2lkIDApIHsKICAgICAgICB0YXJnZXQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICByZXR1cm4gdGFyZ2V0OwogICAgfQoKICAgIHZvbHVtZSgpIHsKICAgICAgcmV0dXJuICgvLyBUaGUgcGxhbmUgaXMgaW5maW5pdGUuLi4KICAgICAgICBOdW1iZXIuTUFYX1ZBTFVFCiAgICAgICk7CiAgICB9CgogICAgY2FsY3VsYXRlV29ybGRBQUJCKHBvcywgcXVhdCwgbWluLCBtYXgpIHsKICAgICAgLy8gVGhlIHBsYW5lIEFBQkIgaXMgaW5maW5pdGUsIGV4Y2VwdCBpZiB0aGUgbm9ybWFsIGlzIHBvaW50aW5nIGFsb25nIGFueSBheGlzCiAgICAgIHRlbXBOb3JtYWwuc2V0KDAsIDAsIDEpOyAvLyBEZWZhdWx0IHBsYW5lIG5vcm1hbCBpcyB6CgogICAgICBxdWF0LnZtdWx0KHRlbXBOb3JtYWwsIHRlbXBOb3JtYWwpOwogICAgICBjb25zdCBtYXhWYWwgPSBOdW1iZXIuTUFYX1ZBTFVFOwogICAgICBtaW4uc2V0KC1tYXhWYWwsIC1tYXhWYWwsIC1tYXhWYWwpOwogICAgICBtYXguc2V0KG1heFZhbCwgbWF4VmFsLCBtYXhWYWwpOwoKICAgICAgaWYgKHRlbXBOb3JtYWwueCA9PT0gMSkgewogICAgICAgIG1heC54ID0gcG9zLng7CiAgICAgIH0gZWxzZSBpZiAodGVtcE5vcm1hbC54ID09PSAtMSkgewogICAgICAgIG1pbi54ID0gcG9zLng7CiAgICAgIH0KCiAgICAgIGlmICh0ZW1wTm9ybWFsLnkgPT09IDEpIHsKICAgICAgICBtYXgueSA9IHBvcy55OwogICAgICB9IGVsc2UgaWYgKHRlbXBOb3JtYWwueSA9PT0gLTEpIHsKICAgICAgICBtaW4ueSA9IHBvcy55OwogICAgICB9CgogICAgICBpZiAodGVtcE5vcm1hbC56ID09PSAxKSB7CiAgICAgICAgbWF4LnogPSBwb3MuejsKICAgICAgfSBlbHNlIGlmICh0ZW1wTm9ybWFsLnogPT09IC0xKSB7CiAgICAgICAgbWluLnogPSBwb3MuejsKICAgICAgfQogICAgfQoKICAgIHVwZGF0ZUJvdW5kaW5nU3BoZXJlUmFkaXVzKCkgewogICAgICB0aGlzLmJvdW5kaW5nU3BoZXJlUmFkaXVzID0gTnVtYmVyLk1BWF9WQUxVRTsKICAgIH0KCiAgfQogIGNvbnN0IHRlbXBOb3JtYWwgPSBuZXcgVmVjMygpOwoKICAvKioKICAgKiBIZWlnaHRmaWVsZCBzaGFwZSBjbGFzcy4gSGVpZ2h0IGRhdGEgaXMgZ2l2ZW4gYXMgYW4gYXJyYXkuIFRoZXNlIGRhdGEgcG9pbnRzIGFyZSBzcHJlYWQgb3V0IGV2ZW5seSB3aXRoIGEgZ2l2ZW4gZGlzdGFuY2UuCiAgICogQHRvZG8gU2hvdWxkIGJlIHBvc3NpYmxlIHRvIHVzZSBhbG9uZyBhbGwgYXhlcywgbm90IGp1c3QgeQogICAqIEB0b2RvIHNob3VsZCBiZSBwb3NzaWJsZSB0byBzY2FsZSBhbG9uZyBhbGwgYXhlcwogICAqIEB0b2RvIFJlZmFjdG9yIGVsZW1lbnRTaXplIHRvIGVsZW1lbnRTaXplWCBhbmQgZWxlbWVudFNpemVZCiAgICoKICAgKiBAZXhhbXBsZQogICAqICAgICAvLyBHZW5lcmF0ZSBzb21lIGhlaWdodCBkYXRhICh5LXZhbHVlcykuCiAgICogICAgIGNvbnN0IGRhdGEgPSBbXQogICAqICAgICBmb3IgKGxldCBpID0gMDsgaSA8IDEwMDA7IGkrKykgewogICAqICAgICAgICAgY29uc3QgeSA9IDAuNSAqIE1hdGguY29zKDAuMiAqIGkpCiAgICogICAgICAgICBkYXRhLnB1c2goeSkKICAgKiAgICAgfQogICAqCiAgICogICAgIC8vIENyZWF0ZSB0aGUgaGVpZ2h0ZmllbGQgc2hhcGUKICAgKiAgICAgY29uc3QgaGVpZ2h0ZmllbGRTaGFwZSA9IG5ldyBDQU5OT04uSGVpZ2h0ZmllbGQoZGF0YSwgewogICAqICAgICAgICAgZWxlbWVudFNpemU6IDEgLy8gRGlzdGFuY2UgYmV0d2VlbiB0aGUgZGF0YSBwb2ludHMgaW4gWCBhbmQgWSBkaXJlY3Rpb25zCiAgICogICAgIH0pCiAgICogICAgIGNvbnN0IGhlaWdodGZpZWxkQm9keSA9IG5ldyBDQU5OT04uQm9keSh7IHNoYXBlOiBoZWlnaHRmaWVsZFNoYXBlIH0pCiAgICogICAgIHdvcmxkLmFkZEJvZHkoaGVpZ2h0ZmllbGRCb2R5KQogICAqLwogIGNsYXNzIEhlaWdodGZpZWxkIGV4dGVuZHMgU2hhcGUgewogICAgLyoqCiAgICAgKiBBbiBhcnJheSBvZiBudW1iZXJzLCBvciBoZWlnaHQgdmFsdWVzLCB0aGF0IGFyZSBzcHJlYWQgb3V0IGFsb25nIHRoZSB4IGF4aXMuCiAgICAgKi8KCiAgICAvKioKICAgICAqIE1heCB2YWx1ZSBvZiB0aGUgZGF0YSBwb2ludHMgaW4gdGhlIGRhdGEgYXJyYXkuCiAgICAgKi8KCiAgICAvKioKICAgICAqIE1pbmltdW0gdmFsdWUgb2YgdGhlIGRhdGEgcG9pbnRzIGluIHRoZSBkYXRhIGFycmF5LgogICAgICovCgogICAgLyoqCiAgICAgKiBXb3JsZCBzcGFjaW5nIGJldHdlZW4gdGhlIGRhdGEgcG9pbnRzIGluIFggYW5kIFkgZGlyZWN0aW9uLgogICAgICogQHRvZG8gZWxlbWVudFNpemVYIGFuZCBZCiAgICAgKiBAZGVmYXVsdCAxCiAgICAgKi8KCiAgICAvKioKICAgICAqIEBkZWZhdWx0IHRydWUKICAgICAqLwoKICAgIC8qKgogICAgICogQHBhcmFtIGRhdGEgQW4gYXJyYXkgb2YgbnVtYmVycywgb3IgaGVpZ2h0IHZhbHVlcywgdGhhdCBhcmUgc3ByZWFkIG91dCBhbG9uZyB0aGUgeCBheGlzLgogICAgICovCiAgICBjb25zdHJ1Y3RvcihkYXRhLCBvcHRpb25zKSB7CiAgICAgIGlmIChvcHRpb25zID09PSB2b2lkIDApIHsKICAgICAgICBvcHRpb25zID0ge307CiAgICAgIH0KCiAgICAgIG9wdGlvbnMgPSBVdGlscy5kZWZhdWx0cyhvcHRpb25zLCB7CiAgICAgICAgbWF4VmFsdWU6IG51bGwsCiAgICAgICAgbWluVmFsdWU6IG51bGwsCiAgICAgICAgZWxlbWVudFNpemU6IDEKICAgICAgfSk7CiAgICAgIHN1cGVyKHsKICAgICAgICB0eXBlOiBTaGFwZS50eXBlcy5IRUlHSFRGSUVMRAogICAgICB9KTsKICAgICAgdGhpcy5kYXRhID0gZGF0YTsKICAgICAgdGhpcy5tYXhWYWx1ZSA9IG9wdGlvbnMubWF4VmFsdWU7CiAgICAgIHRoaXMubWluVmFsdWUgPSBvcHRpb25zLm1pblZhbHVlOwogICAgICB0aGlzLmVsZW1lbnRTaXplID0gb3B0aW9ucy5lbGVtZW50U2l6ZTsKCiAgICAgIGlmIChvcHRpb25zLm1pblZhbHVlID09PSBudWxsKSB7CiAgICAgICAgdGhpcy51cGRhdGVNaW5WYWx1ZSgpOwogICAgICB9CgogICAgICBpZiAob3B0aW9ucy5tYXhWYWx1ZSA9PT0gbnVsbCkgewogICAgICAgIHRoaXMudXBkYXRlTWF4VmFsdWUoKTsKICAgICAgfQoKICAgICAgdGhpcy5jYWNoZUVuYWJsZWQgPSB0cnVlOwogICAgICB0aGlzLnBpbGxhckNvbnZleCA9IG5ldyBDb252ZXhQb2x5aGVkcm9uKCk7CiAgICAgIHRoaXMucGlsbGFyT2Zmc2V0ID0gbmV3IFZlYzMoKTsKICAgICAgdGhpcy51cGRhdGVCb3VuZGluZ1NwaGVyZVJhZGl1cygpOyAvLyAiaV9qX2lzVXBwZXIiID0+IHsgY29udmV4OiAuLi4sIG9mZnNldDogLi4uIH0KICAgICAgLy8gZm9yIGV4YW1wbGU6CiAgICAgIC8vIF9jYWNoZWRQaWxsYXJzWyIwXzJfMSJdCgogICAgICB0aGlzLl9jYWNoZWRQaWxsYXJzID0ge307CiAgICB9CiAgICAvKioKICAgICAqIENhbGwgd2hlbmV2ZXIgeW91IGNoYW5nZSB0aGUgZGF0YSBhcnJheS4KICAgICAqLwoKCiAgICB1cGRhdGUoKSB7CiAgICAgIHRoaXMuX2NhY2hlZFBpbGxhcnMgPSB7fTsKICAgIH0KICAgIC8qKgogICAgICogVXBkYXRlIHRoZSBgbWluVmFsdWVgIHByb3BlcnR5CiAgICAgKi8KCgogICAgdXBkYXRlTWluVmFsdWUoKSB7CiAgICAgIGNvbnN0IGRhdGEgPSB0aGlzLmRhdGE7CiAgICAgIGxldCBtaW5WYWx1ZSA9IGRhdGFbMF1bMF07CgogICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gZGF0YS5sZW5ndGg7IGkrKykgewogICAgICAgIGZvciAobGV0IGogPSAwOyBqICE9PSBkYXRhW2ldLmxlbmd0aDsgaisrKSB7CiAgICAgICAgICBjb25zdCB2ID0gZGF0YVtpXVtqXTsKCiAgICAgICAgICBpZiAodiA8IG1pblZhbHVlKSB7CiAgICAgICAgICAgIG1pblZhbHVlID0gdjsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KCiAgICAgIHRoaXMubWluVmFsdWUgPSBtaW5WYWx1ZTsKICAgIH0KICAgIC8qKgogICAgICogVXBkYXRlIHRoZSBgbWF4VmFsdWVgIHByb3BlcnR5CiAgICAgKi8KCgogICAgdXBkYXRlTWF4VmFsdWUoKSB7CiAgICAgIGNvbnN0IGRhdGEgPSB0aGlzLmRhdGE7CiAgICAgIGxldCBtYXhWYWx1ZSA9IGRhdGFbMF1bMF07CgogICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gZGF0YS5sZW5ndGg7IGkrKykgewogICAgICAgIGZvciAobGV0IGogPSAwOyBqICE9PSBkYXRhW2ldLmxlbmd0aDsgaisrKSB7CiAgICAgICAgICBjb25zdCB2ID0gZGF0YVtpXVtqXTsKCiAgICAgICAgICBpZiAodiA+IG1heFZhbHVlKSB7CiAgICAgICAgICAgIG1heFZhbHVlID0gdjsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KCiAgICAgIHRoaXMubWF4VmFsdWUgPSBtYXhWYWx1ZTsKICAgIH0KICAgIC8qKgogICAgICogU2V0IHRoZSBoZWlnaHQgdmFsdWUgYXQgYW4gaW5kZXguIERvbid0IGZvcmdldCB0byB1cGRhdGUgbWF4VmFsdWUgYW5kIG1pblZhbHVlIGFmdGVyIHlvdSdyZSBkb25lLgogICAgICovCgoKICAgIHNldEhlaWdodFZhbHVlQXRJbmRleCh4aSwgeWksIHZhbHVlKSB7CiAgICAgIGNvbnN0IGRhdGEgPSB0aGlzLmRhdGE7CiAgICAgIGRhdGFbeGldW3lpXSA9IHZhbHVlOyAvLyBJbnZhbGlkYXRlIGNhY2hlCgogICAgICB0aGlzLmNsZWFyQ2FjaGVkQ29udmV4VHJpYW5nbGVQaWxsYXIoeGksIHlpLCBmYWxzZSk7CgogICAgICBpZiAoeGkgPiAwKSB7CiAgICAgICAgdGhpcy5jbGVhckNhY2hlZENvbnZleFRyaWFuZ2xlUGlsbGFyKHhpIC0gMSwgeWksIHRydWUpOwogICAgICAgIHRoaXMuY2xlYXJDYWNoZWRDb252ZXhUcmlhbmdsZVBpbGxhcih4aSAtIDEsIHlpLCBmYWxzZSk7CiAgICAgIH0KCiAgICAgIGlmICh5aSA+IDApIHsKICAgICAgICB0aGlzLmNsZWFyQ2FjaGVkQ29udmV4VHJpYW5nbGVQaWxsYXIoeGksIHlpIC0gMSwgdHJ1ZSk7CiAgICAgICAgdGhpcy5jbGVhckNhY2hlZENvbnZleFRyaWFuZ2xlUGlsbGFyKHhpLCB5aSAtIDEsIGZhbHNlKTsKICAgICAgfQoKICAgICAgaWYgKHlpID4gMCAmJiB4aSA+IDApIHsKICAgICAgICB0aGlzLmNsZWFyQ2FjaGVkQ29udmV4VHJpYW5nbGVQaWxsYXIoeGkgLSAxLCB5aSAtIDEsIHRydWUpOwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIEdldCBtYXgvbWluIGluIGEgcmVjdGFuZ2xlIGluIHRoZSBtYXRyaXggZGF0YQogICAgICogQHBhcmFtIHJlc3VsdCBBbiBhcnJheSB0byBzdG9yZSB0aGUgcmVzdWx0cyBpbi4KICAgICAqIEByZXR1cm4gVGhlIHJlc3VsdCBhcnJheSwgaWYgaXQgd2FzIHBhc3NlZCBpbi4gTWluaW11bSB3aWxsIGJlIGF0IHBvc2l0aW9uIDAgYW5kIG1heCBhdCAxLgogICAgICovCgoKICAgIGdldFJlY3RNaW5NYXgoaU1pblgsIGlNaW5ZLCBpTWF4WCwgaU1heFksIHJlc3VsdCkgewogICAgICBpZiAocmVzdWx0ID09PSB2b2lkIDApIHsKICAgICAgICByZXN1bHQgPSBbXTsKICAgICAgfQoKICAgICAgLy8gR2V0IG1heCBhbmQgbWluIG9mIHRoZSBkYXRhCiAgICAgIGNvbnN0IGRhdGEgPSB0aGlzLmRhdGE7IC8vIFNldCBmaXJzdCB2YWx1ZQoKICAgICAgbGV0IG1heCA9IHRoaXMubWluVmFsdWU7CgogICAgICBmb3IgKGxldCBpID0gaU1pblg7IGkgPD0gaU1heFg7IGkrKykgewogICAgICAgIGZvciAobGV0IGogPSBpTWluWTsgaiA8PSBpTWF4WTsgaisrKSB7CiAgICAgICAgICBjb25zdCBoZWlnaHQgPSBkYXRhW2ldW2pdOwoKICAgICAgICAgIGlmIChoZWlnaHQgPiBtYXgpIHsKICAgICAgICAgICAgbWF4ID0gaGVpZ2h0OwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQoKICAgICAgcmVzdWx0WzBdID0gdGhpcy5taW5WYWx1ZTsKICAgICAgcmVzdWx0WzFdID0gbWF4OwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgdGhlIGluZGV4IG9mIGEgbG9jYWwgcG9zaXRpb24gb24gdGhlIGhlaWdodGZpZWxkLiBUaGUgaW5kZXhlcyBpbmRpY2F0ZSB0aGUgcmVjdGFuZ2xlcywgc28gaWYgeW91ciB0ZXJyYWluIGlzIG1hZGUgb2YgTiB4IE4gaGVpZ2h0IGRhdGEgcG9pbnRzLCB5b3Ugd2lsbCBoYXZlIHJlY3RhbmdsZSBpbmRleGVzIHJhbmdpbmcgZnJvbSAwIHRvIE4tMS4KICAgICAqIEBwYXJhbSByZXN1bHQgVHdvLWVsZW1lbnQgYXJyYXkKICAgICAqIEBwYXJhbSBjbGFtcCBJZiB0aGUgcG9zaXRpb24gc2hvdWxkIGJlIGNsYW1wZWQgdG8gdGhlIGhlaWdodGZpZWxkIGVkZ2UuCiAgICAgKi8KCgogICAgZ2V0SW5kZXhPZlBvc2l0aW9uKHgsIHksIHJlc3VsdCwgY2xhbXApIHsKICAgICAgLy8gR2V0IHRoZSBpbmRleCBvZiB0aGUgZGF0YSBwb2ludHMgdG8gdGVzdCBhZ2FpbnN0CiAgICAgIGNvbnN0IHcgPSB0aGlzLmVsZW1lbnRTaXplOwogICAgICBjb25zdCBkYXRhID0gdGhpcy5kYXRhOwogICAgICBsZXQgeGkgPSBNYXRoLmZsb29yKHggLyB3KTsKICAgICAgbGV0IHlpID0gTWF0aC5mbG9vcih5IC8gdyk7CiAgICAgIHJlc3VsdFswXSA9IHhpOwogICAgICByZXN1bHRbMV0gPSB5aTsKCiAgICAgIGlmIChjbGFtcCkgewogICAgICAgIC8vIENsYW1wIGluZGV4IHRvIGVkZ2VzCiAgICAgICAgaWYgKHhpIDwgMCkgewogICAgICAgICAgeGkgPSAwOwogICAgICAgIH0KCiAgICAgICAgaWYgKHlpIDwgMCkgewogICAgICAgICAgeWkgPSAwOwogICAgICAgIH0KCiAgICAgICAgaWYgKHhpID49IGRhdGEubGVuZ3RoIC0gMSkgewogICAgICAgICAgeGkgPSBkYXRhLmxlbmd0aCAtIDE7CiAgICAgICAgfQoKICAgICAgICBpZiAoeWkgPj0gZGF0YVswXS5sZW5ndGggLSAxKSB7CiAgICAgICAgICB5aSA9IGRhdGFbMF0ubGVuZ3RoIC0gMTsKICAgICAgICB9CiAgICAgIH0gLy8gQmFpbCBvdXQgaWYgd2UgYXJlIG91dCBvZiB0aGUgdGVycmFpbgoKCiAgICAgIGlmICh4aSA8IDAgfHwgeWkgPCAwIHx8IHhpID49IGRhdGEubGVuZ3RoIC0gMSB8fCB5aSA+PSBkYXRhWzBdLmxlbmd0aCAtIDEpIHsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0KCiAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIGdldFRyaWFuZ2xlQXQoeCwgeSwgZWRnZUNsYW1wLCBhLCBiLCBjKSB7CiAgICAgIGNvbnN0IGlkeCA9IGdldEhlaWdodEF0X2lkeDsKICAgICAgdGhpcy5nZXRJbmRleE9mUG9zaXRpb24oeCwgeSwgaWR4LCBlZGdlQ2xhbXApOwogICAgICBsZXQgeGkgPSBpZHhbMF07CiAgICAgIGxldCB5aSA9IGlkeFsxXTsKICAgICAgY29uc3QgZGF0YSA9IHRoaXMuZGF0YTsKCiAgICAgIGlmIChlZGdlQ2xhbXApIHsKICAgICAgICB4aSA9IE1hdGgubWluKGRhdGEubGVuZ3RoIC0gMiwgTWF0aC5tYXgoMCwgeGkpKTsKICAgICAgICB5aSA9IE1hdGgubWluKGRhdGFbMF0ubGVuZ3RoIC0gMiwgTWF0aC5tYXgoMCwgeWkpKTsKICAgICAgfQoKICAgICAgY29uc3QgZWxlbWVudFNpemUgPSB0aGlzLmVsZW1lbnRTaXplOwogICAgICBjb25zdCBsb3dlckRpc3QyID0gKHggLyBlbGVtZW50U2l6ZSAtIHhpKSAqKiAyICsgKHkgLyBlbGVtZW50U2l6ZSAtIHlpKSAqKiAyOwogICAgICBjb25zdCB1cHBlckRpc3QyID0gKHggLyBlbGVtZW50U2l6ZSAtICh4aSArIDEpKSAqKiAyICsgKHkgLyBlbGVtZW50U2l6ZSAtICh5aSArIDEpKSAqKiAyOwogICAgICBjb25zdCB1cHBlciA9IGxvd2VyRGlzdDIgPiB1cHBlckRpc3QyOwogICAgICB0aGlzLmdldFRyaWFuZ2xlKHhpLCB5aSwgdXBwZXIsIGEsIGIsIGMpOwogICAgICByZXR1cm4gdXBwZXI7CiAgICB9CgogICAgZ2V0Tm9ybWFsQXQoeCwgeSwgZWRnZUNsYW1wLCByZXN1bHQpIHsKICAgICAgY29uc3QgYSA9IGdldE5vcm1hbEF0X2E7CiAgICAgIGNvbnN0IGIgPSBnZXROb3JtYWxBdF9iOwogICAgICBjb25zdCBjID0gZ2V0Tm9ybWFsQXRfYzsKICAgICAgY29uc3QgZTAgPSBnZXROb3JtYWxBdF9lMDsKICAgICAgY29uc3QgZTEgPSBnZXROb3JtYWxBdF9lMTsKICAgICAgdGhpcy5nZXRUcmlhbmdsZUF0KHgsIHksIGVkZ2VDbGFtcCwgYSwgYiwgYyk7CiAgICAgIGIudnN1YihhLCBlMCk7CiAgICAgIGMudnN1YihhLCBlMSk7CiAgICAgIGUwLmNyb3NzKGUxLCByZXN1bHQpOwogICAgICByZXN1bHQubm9ybWFsaXplKCk7CiAgICB9CiAgICAvKioKICAgICAqIEdldCBhbiBBQUJCIG9mIGEgc3F1YXJlIGluIHRoZSBoZWlnaHRmaWVsZAogICAgICogQHBhcmFtIHhpCiAgICAgKiBAcGFyYW0geWkKICAgICAqIEBwYXJhbSByZXN1bHQKICAgICAqLwoKCiAgICBnZXRBYWJiQXRJbmRleCh4aSwgeWksIF9yZWYpIHsKICAgICAgbGV0IHsKICAgICAgICBsb3dlckJvdW5kLAogICAgICAgIHVwcGVyQm91bmQKICAgICAgfSA9IF9yZWY7CiAgICAgIGNvbnN0IGRhdGEgPSB0aGlzLmRhdGE7CiAgICAgIGNvbnN0IGVsZW1lbnRTaXplID0gdGhpcy5lbGVtZW50U2l6ZTsKICAgICAgbG93ZXJCb3VuZC5zZXQoeGkgKiBlbGVtZW50U2l6ZSwgeWkgKiBlbGVtZW50U2l6ZSwgZGF0YVt4aV1beWldKTsKICAgICAgdXBwZXJCb3VuZC5zZXQoKHhpICsgMSkgKiBlbGVtZW50U2l6ZSwgKHlpICsgMSkgKiBlbGVtZW50U2l6ZSwgZGF0YVt4aSArIDFdW3lpICsgMV0pOwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgdGhlIGhlaWdodCBpbiB0aGUgaGVpZ2h0ZmllbGQgYXQgYSBnaXZlbiBwb3NpdGlvbgogICAgICovCgoKICAgIGdldEhlaWdodEF0KHgsIHksIGVkZ2VDbGFtcCkgewogICAgICBjb25zdCBkYXRhID0gdGhpcy5kYXRhOwogICAgICBjb25zdCBhID0gZ2V0SGVpZ2h0QXRfYTsKICAgICAgY29uc3QgYiA9IGdldEhlaWdodEF0X2I7CiAgICAgIGNvbnN0IGMgPSBnZXRIZWlnaHRBdF9jOwogICAgICBjb25zdCBpZHggPSBnZXRIZWlnaHRBdF9pZHg7CiAgICAgIHRoaXMuZ2V0SW5kZXhPZlBvc2l0aW9uKHgsIHksIGlkeCwgZWRnZUNsYW1wKTsKICAgICAgbGV0IHhpID0gaWR4WzBdOwogICAgICBsZXQgeWkgPSBpZHhbMV07CgogICAgICBpZiAoZWRnZUNsYW1wKSB7CiAgICAgICAgeGkgPSBNYXRoLm1pbihkYXRhLmxlbmd0aCAtIDIsIE1hdGgubWF4KDAsIHhpKSk7CiAgICAgICAgeWkgPSBNYXRoLm1pbihkYXRhWzBdLmxlbmd0aCAtIDIsIE1hdGgubWF4KDAsIHlpKSk7CiAgICAgIH0KCiAgICAgIGNvbnN0IHVwcGVyID0gdGhpcy5nZXRUcmlhbmdsZUF0KHgsIHksIGVkZ2VDbGFtcCwgYSwgYiwgYyk7CiAgICAgIGJhcnljZW50cmljV2VpZ2h0cyh4LCB5LCBhLngsIGEueSwgYi54LCBiLnksIGMueCwgYy55LCBnZXRIZWlnaHRBdF93ZWlnaHRzKTsKICAgICAgY29uc3QgdyA9IGdldEhlaWdodEF0X3dlaWdodHM7CgogICAgICBpZiAodXBwZXIpIHsKICAgICAgICAvLyBUb3AgdHJpYW5nbGUgdmVydHMKICAgICAgICByZXR1cm4gZGF0YVt4aSArIDFdW3lpICsgMV0gKiB3LnggKyBkYXRhW3hpXVt5aSArIDFdICogdy55ICsgZGF0YVt4aSArIDFdW3lpXSAqIHcuejsKICAgICAgfSBlbHNlIHsKICAgICAgICAvLyBUb3AgdHJpYW5nbGUgdmVydHMKICAgICAgICByZXR1cm4gZGF0YVt4aV1beWldICogdy54ICsgZGF0YVt4aSArIDFdW3lpXSAqIHcueSArIGRhdGFbeGldW3lpICsgMV0gKiB3Lno7CiAgICAgIH0KICAgIH0KCiAgICBnZXRDYWNoZUNvbnZleFRyaWFuZ2xlUGlsbGFyS2V5KHhpLCB5aSwgZ2V0VXBwZXJUcmlhbmdsZSkgewogICAgICByZXR1cm4gYCR7eGl9XyR7eWl9XyR7Z2V0VXBwZXJUcmlhbmdsZSA/IDEgOiAwfWA7CiAgICB9CgogICAgZ2V0Q2FjaGVkQ29udmV4VHJpYW5nbGVQaWxsYXIoeGksIHlpLCBnZXRVcHBlclRyaWFuZ2xlKSB7CiAgICAgIHJldHVybiB0aGlzLl9jYWNoZWRQaWxsYXJzW3RoaXMuZ2V0Q2FjaGVDb252ZXhUcmlhbmdsZVBpbGxhcktleSh4aSwgeWksIGdldFVwcGVyVHJpYW5nbGUpXTsKICAgIH0KCiAgICBzZXRDYWNoZWRDb252ZXhUcmlhbmdsZVBpbGxhcih4aSwgeWksIGdldFVwcGVyVHJpYW5nbGUsIGNvbnZleCwgb2Zmc2V0KSB7CiAgICAgIHRoaXMuX2NhY2hlZFBpbGxhcnNbdGhpcy5nZXRDYWNoZUNvbnZleFRyaWFuZ2xlUGlsbGFyS2V5KHhpLCB5aSwgZ2V0VXBwZXJUcmlhbmdsZSldID0gewogICAgICAgIGNvbnZleCwKICAgICAgICBvZmZzZXQKICAgICAgfTsKICAgIH0KCiAgICBjbGVhckNhY2hlZENvbnZleFRyaWFuZ2xlUGlsbGFyKHhpLCB5aSwgZ2V0VXBwZXJUcmlhbmdsZSkgewogICAgICBkZWxldGUgdGhpcy5fY2FjaGVkUGlsbGFyc1t0aGlzLmdldENhY2hlQ29udmV4VHJpYW5nbGVQaWxsYXJLZXkoeGksIHlpLCBnZXRVcHBlclRyaWFuZ2xlKV07CiAgICB9CiAgICAvKioKICAgICAqIEdldCBhIHRyaWFuZ2xlIGZyb20gdGhlIGhlaWdodGZpZWxkCiAgICAgKi8KCgogICAgZ2V0VHJpYW5nbGUoeGksIHlpLCB1cHBlciwgYSwgYiwgYykgewogICAgICBjb25zdCBkYXRhID0gdGhpcy5kYXRhOwogICAgICBjb25zdCBlbGVtZW50U2l6ZSA9IHRoaXMuZWxlbWVudFNpemU7CgogICAgICBpZiAodXBwZXIpIHsKICAgICAgICAvLyBUb3AgdHJpYW5nbGUgdmVydHMKICAgICAgICBhLnNldCgoeGkgKyAxKSAqIGVsZW1lbnRTaXplLCAoeWkgKyAxKSAqIGVsZW1lbnRTaXplLCBkYXRhW3hpICsgMV1beWkgKyAxXSk7CiAgICAgICAgYi5zZXQoeGkgKiBlbGVtZW50U2l6ZSwgKHlpICsgMSkgKiBlbGVtZW50U2l6ZSwgZGF0YVt4aV1beWkgKyAxXSk7CiAgICAgICAgYy5zZXQoKHhpICsgMSkgKiBlbGVtZW50U2l6ZSwgeWkgKiBlbGVtZW50U2l6ZSwgZGF0YVt4aSArIDFdW3lpXSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgLy8gVG9wIHRyaWFuZ2xlIHZlcnRzCiAgICAgICAgYS5zZXQoeGkgKiBlbGVtZW50U2l6ZSwgeWkgKiBlbGVtZW50U2l6ZSwgZGF0YVt4aV1beWldKTsKICAgICAgICBiLnNldCgoeGkgKyAxKSAqIGVsZW1lbnRTaXplLCB5aSAqIGVsZW1lbnRTaXplLCBkYXRhW3hpICsgMV1beWldKTsKICAgICAgICBjLnNldCh4aSAqIGVsZW1lbnRTaXplLCAoeWkgKyAxKSAqIGVsZW1lbnRTaXplLCBkYXRhW3hpXVt5aSArIDFdKTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBHZXQgYSB0cmlhbmdsZSBpbiB0aGUgdGVycmFpbiBpbiB0aGUgZm9ybSBvZiBhIHRyaWFuZ3VsYXIgY29udmV4IHNoYXBlLgogICAgICovCgoKICAgIGdldENvbnZleFRyaWFuZ2xlUGlsbGFyKHhpLCB5aSwgZ2V0VXBwZXJUcmlhbmdsZSkgewogICAgICBsZXQgcmVzdWx0ID0gdGhpcy5waWxsYXJDb252ZXg7CiAgICAgIGxldCBvZmZzZXRSZXN1bHQgPSB0aGlzLnBpbGxhck9mZnNldDsKCiAgICAgIGlmICh0aGlzLmNhY2hlRW5hYmxlZCkgewogICAgICAgIGNvbnN0IGRhdGEgPSB0aGlzLmdldENhY2hlZENvbnZleFRyaWFuZ2xlUGlsbGFyKHhpLCB5aSwgZ2V0VXBwZXJUcmlhbmdsZSk7CgogICAgICAgIGlmIChkYXRhKSB7CiAgICAgICAgICB0aGlzLnBpbGxhckNvbnZleCA9IGRhdGEuY29udmV4OwogICAgICAgICAgdGhpcy5waWxsYXJPZmZzZXQgPSBkYXRhLm9mZnNldDsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIHJlc3VsdCA9IG5ldyBDb252ZXhQb2x5aGVkcm9uKCk7CiAgICAgICAgb2Zmc2V0UmVzdWx0ID0gbmV3IFZlYzMoKTsKICAgICAgICB0aGlzLnBpbGxhckNvbnZleCA9IHJlc3VsdDsKICAgICAgICB0aGlzLnBpbGxhck9mZnNldCA9IG9mZnNldFJlc3VsdDsKICAgICAgfQoKICAgICAgY29uc3QgZGF0YSA9IHRoaXMuZGF0YTsKICAgICAgY29uc3QgZWxlbWVudFNpemUgPSB0aGlzLmVsZW1lbnRTaXplOwogICAgICBjb25zdCBmYWNlcyA9IHJlc3VsdC5mYWNlczsgLy8gUmV1c2UgdmVydHMgaWYgcG9zc2libGUKCiAgICAgIHJlc3VsdC52ZXJ0aWNlcy5sZW5ndGggPSA2OwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCA2OyBpKyspIHsKICAgICAgICBpZiAoIXJlc3VsdC52ZXJ0aWNlc1tpXSkgewogICAgICAgICAgcmVzdWx0LnZlcnRpY2VzW2ldID0gbmV3IFZlYzMoKTsKICAgICAgICB9CiAgICAgIH0gLy8gUmV1c2UgZmFjZXMgaWYgcG9zc2libGUKCgogICAgICBmYWNlcy5sZW5ndGggPSA1OwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCA1OyBpKyspIHsKICAgICAgICBpZiAoIWZhY2VzW2ldKSB7CiAgICAgICAgICBmYWNlc1tpXSA9IFtdOwogICAgICAgIH0KICAgICAgfQoKICAgICAgY29uc3QgdmVydHMgPSByZXN1bHQudmVydGljZXM7CiAgICAgIGNvbnN0IGggPSAoTWF0aC5taW4oZGF0YVt4aV1beWldLCBkYXRhW3hpICsgMV1beWldLCBkYXRhW3hpXVt5aSArIDFdLCBkYXRhW3hpICsgMV1beWkgKyAxXSkgLSB0aGlzLm1pblZhbHVlKSAvIDIgKyB0aGlzLm1pblZhbHVlOwoKICAgICAgaWYgKCFnZXRVcHBlclRyaWFuZ2xlKSB7CiAgICAgICAgLy8gQ2VudGVyIG9mIHRoZSB0cmlhbmdsZSBwaWxsYXIgLSBhbGwgcG9seWdvbnMgYXJlIGdpdmVuIHJlbGF0aXZlIHRvIHRoaXMgb25lCiAgICAgICAgb2Zmc2V0UmVzdWx0LnNldCgoeGkgKyAwLjI1KSAqIGVsZW1lbnRTaXplLCAvLyBzb3J0IG9mIGNlbnRlciBvZiBhIHRyaWFuZ2xlCiAgICAgICAgKHlpICsgMC4yNSkgKiBlbGVtZW50U2l6ZSwgaCAvLyB2ZXJ0aWNhbCBjZW50ZXIKICAgICAgICApOyAvLyBUb3AgdHJpYW5nbGUgdmVydHMKCiAgICAgICAgdmVydHNbMF0uc2V0KC0wLjI1ICogZWxlbWVudFNpemUsIC0wLjI1ICogZWxlbWVudFNpemUsIGRhdGFbeGldW3lpXSAtIGgpOwogICAgICAgIHZlcnRzWzFdLnNldCgwLjc1ICogZWxlbWVudFNpemUsIC0wLjI1ICogZWxlbWVudFNpemUsIGRhdGFbeGkgKyAxXVt5aV0gLSBoKTsKICAgICAgICB2ZXJ0c1syXS5zZXQoLTAuMjUgKiBlbGVtZW50U2l6ZSwgMC43NSAqIGVsZW1lbnRTaXplLCBkYXRhW3hpXVt5aSArIDFdIC0gaCk7IC8vIGJvdHRvbSB0cmlhbmdsZSB2ZXJ0cwoKICAgICAgICB2ZXJ0c1szXS5zZXQoLTAuMjUgKiBlbGVtZW50U2l6ZSwgLTAuMjUgKiBlbGVtZW50U2l6ZSwgLU1hdGguYWJzKGgpIC0gMSk7CiAgICAgICAgdmVydHNbNF0uc2V0KDAuNzUgKiBlbGVtZW50U2l6ZSwgLTAuMjUgKiBlbGVtZW50U2l6ZSwgLU1hdGguYWJzKGgpIC0gMSk7CiAgICAgICAgdmVydHNbNV0uc2V0KC0wLjI1ICogZWxlbWVudFNpemUsIDAuNzUgKiBlbGVtZW50U2l6ZSwgLU1hdGguYWJzKGgpIC0gMSk7IC8vIHRvcCB0cmlhbmdsZQoKICAgICAgICBmYWNlc1swXVswXSA9IDA7CiAgICAgICAgZmFjZXNbMF1bMV0gPSAxOwogICAgICAgIGZhY2VzWzBdWzJdID0gMjsgLy8gYm90dG9tIHRyaWFuZ2xlCgogICAgICAgIGZhY2VzWzFdWzBdID0gNTsKICAgICAgICBmYWNlc1sxXVsxXSA9IDQ7CiAgICAgICAgZmFjZXNbMV1bMl0gPSAzOyAvLyAteCBmYWNpbmcgcXVhZAoKICAgICAgICBmYWNlc1syXVswXSA9IDA7CiAgICAgICAgZmFjZXNbMl1bMV0gPSAyOwogICAgICAgIGZhY2VzWzJdWzJdID0gNTsKICAgICAgICBmYWNlc1syXVszXSA9IDM7IC8vIC15IGZhY2luZyBxdWFkCgogICAgICAgIGZhY2VzWzNdWzBdID0gMTsKICAgICAgICBmYWNlc1szXVsxXSA9IDA7CiAgICAgICAgZmFjZXNbM11bMl0gPSAzOwogICAgICAgIGZhY2VzWzNdWzNdID0gNDsgLy8gK3h5IGZhY2luZyBxdWFkCgogICAgICAgIGZhY2VzWzRdWzBdID0gNDsKICAgICAgICBmYWNlc1s0XVsxXSA9IDU7CiAgICAgICAgZmFjZXNbNF1bMl0gPSAyOwogICAgICAgIGZhY2VzWzRdWzNdID0gMTsKICAgICAgfSBlbHNlIHsKICAgICAgICAvLyBDZW50ZXIgb2YgdGhlIHRyaWFuZ2xlIHBpbGxhciAtIGFsbCBwb2x5Z29ucyBhcmUgZ2l2ZW4gcmVsYXRpdmUgdG8gdGhpcyBvbmUKICAgICAgICBvZmZzZXRSZXN1bHQuc2V0KCh4aSArIDAuNzUpICogZWxlbWVudFNpemUsIC8vIHNvcnQgb2YgY2VudGVyIG9mIGEgdHJpYW5nbGUKICAgICAgICAoeWkgKyAwLjc1KSAqIGVsZW1lbnRTaXplLCBoIC8vIHZlcnRpY2FsIGNlbnRlcgogICAgICAgICk7IC8vIFRvcCB0cmlhbmdsZSB2ZXJ0cwoKICAgICAgICB2ZXJ0c1swXS5zZXQoMC4yNSAqIGVsZW1lbnRTaXplLCAwLjI1ICogZWxlbWVudFNpemUsIGRhdGFbeGkgKyAxXVt5aSArIDFdIC0gaCk7CiAgICAgICAgdmVydHNbMV0uc2V0KC0wLjc1ICogZWxlbWVudFNpemUsIDAuMjUgKiBlbGVtZW50U2l6ZSwgZGF0YVt4aV1beWkgKyAxXSAtIGgpOwogICAgICAgIHZlcnRzWzJdLnNldCgwLjI1ICogZWxlbWVudFNpemUsIC0wLjc1ICogZWxlbWVudFNpemUsIGRhdGFbeGkgKyAxXVt5aV0gLSBoKTsgLy8gYm90dG9tIHRyaWFuZ2xlIHZlcnRzCgogICAgICAgIHZlcnRzWzNdLnNldCgwLjI1ICogZWxlbWVudFNpemUsIDAuMjUgKiBlbGVtZW50U2l6ZSwgLU1hdGguYWJzKGgpIC0gMSk7CiAgICAgICAgdmVydHNbNF0uc2V0KC0wLjc1ICogZWxlbWVudFNpemUsIDAuMjUgKiBlbGVtZW50U2l6ZSwgLU1hdGguYWJzKGgpIC0gMSk7CiAgICAgICAgdmVydHNbNV0uc2V0KDAuMjUgKiBlbGVtZW50U2l6ZSwgLTAuNzUgKiBlbGVtZW50U2l6ZSwgLU1hdGguYWJzKGgpIC0gMSk7IC8vIFRvcCB0cmlhbmdsZQoKICAgICAgICBmYWNlc1swXVswXSA9IDA7CiAgICAgICAgZmFjZXNbMF1bMV0gPSAxOwogICAgICAgIGZhY2VzWzBdWzJdID0gMjsgLy8gYm90dG9tIHRyaWFuZ2xlCgogICAgICAgIGZhY2VzWzFdWzBdID0gNTsKICAgICAgICBmYWNlc1sxXVsxXSA9IDQ7CiAgICAgICAgZmFjZXNbMV1bMl0gPSAzOyAvLyAreCBmYWNpbmcgcXVhZAoKICAgICAgICBmYWNlc1syXVswXSA9IDI7CiAgICAgICAgZmFjZXNbMl1bMV0gPSA1OwogICAgICAgIGZhY2VzWzJdWzJdID0gMzsKICAgICAgICBmYWNlc1syXVszXSA9IDA7IC8vICt5IGZhY2luZyBxdWFkCgogICAgICAgIGZhY2VzWzNdWzBdID0gMzsKICAgICAgICBmYWNlc1szXVsxXSA9IDQ7CiAgICAgICAgZmFjZXNbM11bMl0gPSAxOwogICAgICAgIGZhY2VzWzNdWzNdID0gMDsgLy8gLXh5IGZhY2luZyBxdWFkCgogICAgICAgIGZhY2VzWzRdWzBdID0gMTsKICAgICAgICBmYWNlc1s0XVsxXSA9IDQ7CiAgICAgICAgZmFjZXNbNF1bMl0gPSA1OwogICAgICAgIGZhY2VzWzRdWzNdID0gMjsKICAgICAgfQoKICAgICAgcmVzdWx0LmNvbXB1dGVOb3JtYWxzKCk7CiAgICAgIHJlc3VsdC5jb21wdXRlRWRnZXMoKTsKICAgICAgcmVzdWx0LnVwZGF0ZUJvdW5kaW5nU3BoZXJlUmFkaXVzKCk7CiAgICAgIHRoaXMuc2V0Q2FjaGVkQ29udmV4VHJpYW5nbGVQaWxsYXIoeGksIHlpLCBnZXRVcHBlclRyaWFuZ2xlLCByZXN1bHQsIG9mZnNldFJlc3VsdCk7CiAgICB9CgogICAgY2FsY3VsYXRlTG9jYWxJbmVydGlhKG1hc3MsIHRhcmdldCkgewogICAgICBpZiAodGFyZ2V0ID09PSB2b2lkIDApIHsKICAgICAgICB0YXJnZXQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICB0YXJnZXQuc2V0KDAsIDAsIDApOwogICAgICByZXR1cm4gdGFyZ2V0OwogICAgfQoKICAgIHZvbHVtZSgpIHsKICAgICAgcmV0dXJuICgvLyBUaGUgdGVycmFpbiBpcyBpbmZpbml0ZQogICAgICAgIE51bWJlci5NQVhfVkFMVUUKICAgICAgKTsKICAgIH0KCiAgICBjYWxjdWxhdGVXb3JsZEFBQkIocG9zLCBxdWF0LCBtaW4sIG1heCkgewogICAgICAvKiogQFRPRE8gZG8gaXQgcHJvcGVybHkgKi8KICAgICAgbWluLnNldCgtTnVtYmVyLk1BWF9WQUxVRSwgLU51bWJlci5NQVhfVkFMVUUsIC1OdW1iZXIuTUFYX1ZBTFVFKTsKICAgICAgbWF4LnNldChOdW1iZXIuTUFYX1ZBTFVFLCBOdW1iZXIuTUFYX1ZBTFVFLCBOdW1iZXIuTUFYX1ZBTFVFKTsKICAgIH0KCiAgICB1cGRhdGVCb3VuZGluZ1NwaGVyZVJhZGl1cygpIHsKICAgICAgLy8gVXNlIHRoZSBib3VuZGluZyBib3ggb2YgdGhlIG1pbi9tYXggdmFsdWVzCiAgICAgIGNvbnN0IGRhdGEgPSB0aGlzLmRhdGE7CiAgICAgIGNvbnN0IHMgPSB0aGlzLmVsZW1lbnRTaXplOwogICAgICB0aGlzLmJvdW5kaW5nU3BoZXJlUmFkaXVzID0gbmV3IFZlYzMoZGF0YS5sZW5ndGggKiBzLCBkYXRhWzBdLmxlbmd0aCAqIHMsIE1hdGgubWF4KE1hdGguYWJzKHRoaXMubWF4VmFsdWUpLCBNYXRoLmFicyh0aGlzLm1pblZhbHVlKSkpLmxlbmd0aCgpOwogICAgfQogICAgLyoqCiAgICAgKiBTZXRzIHRoZSBoZWlnaHQgdmFsdWVzIGZyb20gYW4gaW1hZ2UuIEN1cnJlbnRseSBvbmx5IHN1cHBvcnRlZCBpbiBicm93c2VyLgogICAgICovCgoKICAgIHNldEhlaWdodHNGcm9tSW1hZ2UoaW1hZ2UsIHNjYWxlKSB7CiAgICAgIGNvbnN0IHsKICAgICAgICB4LAogICAgICAgIHosCiAgICAgICAgeQogICAgICB9ID0gc2NhbGU7CiAgICAgIGNvbnN0IGNhbnZhcyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2NhbnZhcycpOwogICAgICBjYW52YXMud2lkdGggPSBpbWFnZS53aWR0aDsKICAgICAgY2FudmFzLmhlaWdodCA9IGltYWdlLmhlaWdodDsKICAgICAgY29uc3QgY29udGV4dCA9IGNhbnZhcy5nZXRDb250ZXh0KCcyZCcpOwogICAgICBjb250ZXh0LmRyYXdJbWFnZShpbWFnZSwgMCwgMCk7CiAgICAgIGNvbnN0IGltYWdlRGF0YSA9IGNvbnRleHQuZ2V0SW1hZ2VEYXRhKDAsIDAsIGltYWdlLndpZHRoLCBpbWFnZS5oZWlnaHQpOwogICAgICBjb25zdCBtYXRyaXggPSB0aGlzLmRhdGE7CiAgICAgIG1hdHJpeC5sZW5ndGggPSAwOwogICAgICB0aGlzLmVsZW1lbnRTaXplID0gTWF0aC5hYnMoeCkgLyBpbWFnZURhdGEud2lkdGg7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGltYWdlRGF0YS5oZWlnaHQ7IGkrKykgewogICAgICAgIGNvbnN0IHJvdyA9IFtdOwoKICAgICAgICBmb3IgKGxldCBqID0gMDsgaiA8IGltYWdlRGF0YS53aWR0aDsgaisrKSB7CiAgICAgICAgICBjb25zdCBhID0gaW1hZ2VEYXRhLmRhdGFbKGkgKiBpbWFnZURhdGEuaGVpZ2h0ICsgaikgKiA0XTsKICAgICAgICAgIGNvbnN0IGIgPSBpbWFnZURhdGEuZGF0YVsoaSAqIGltYWdlRGF0YS5oZWlnaHQgKyBqKSAqIDQgKyAxXTsKICAgICAgICAgIGNvbnN0IGMgPSBpbWFnZURhdGEuZGF0YVsoaSAqIGltYWdlRGF0YS5oZWlnaHQgKyBqKSAqIDQgKyAyXTsKICAgICAgICAgIGNvbnN0IGhlaWdodCA9IChhICsgYiArIGMpIC8gNCAvIDI1NSAqIHo7CgogICAgICAgICAgaWYgKHggPCAwKSB7CiAgICAgICAgICAgIHJvdy5wdXNoKGhlaWdodCk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICByb3cudW5zaGlmdChoZWlnaHQpOwogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgaWYgKHkgPCAwKSB7CiAgICAgICAgICBtYXRyaXgudW5zaGlmdChyb3cpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBtYXRyaXgucHVzaChyb3cpOwogICAgICAgIH0KICAgICAgfQoKICAgICAgdGhpcy51cGRhdGVNYXhWYWx1ZSgpOwogICAgICB0aGlzLnVwZGF0ZU1pblZhbHVlKCk7CiAgICAgIHRoaXMudXBkYXRlKCk7CiAgICB9CgogIH0KICBjb25zdCBnZXRIZWlnaHRBdF9pZHggPSBbXTsKICBjb25zdCBnZXRIZWlnaHRBdF93ZWlnaHRzID0gbmV3IFZlYzMoKTsKICBjb25zdCBnZXRIZWlnaHRBdF9hID0gbmV3IFZlYzMoKTsKICBjb25zdCBnZXRIZWlnaHRBdF9iID0gbmV3IFZlYzMoKTsKICBjb25zdCBnZXRIZWlnaHRBdF9jID0gbmV3IFZlYzMoKTsKICBjb25zdCBnZXROb3JtYWxBdF9hID0gbmV3IFZlYzMoKTsKICBjb25zdCBnZXROb3JtYWxBdF9iID0gbmV3IFZlYzMoKTsKICBjb25zdCBnZXROb3JtYWxBdF9jID0gbmV3IFZlYzMoKTsKICBjb25zdCBnZXROb3JtYWxBdF9lMCA9IG5ldyBWZWMzKCk7CiAgY29uc3QgZ2V0Tm9ybWFsQXRfZTEgPSBuZXcgVmVjMygpOyAvLyBmcm9tIGh0dHBzOi8vZW4ud2lraXBlZGlhLm9yZy93aWtpL0JhcnljZW50cmljX2Nvb3JkaW5hdGVfc3lzdGVtCgogIGZ1bmN0aW9uIGJhcnljZW50cmljV2VpZ2h0cyh4LCB5LCBheCwgYXksIGJ4LCBieSwgY3gsIGN5LCByZXN1bHQpIHsKICAgIHJlc3VsdC54ID0gKChieSAtIGN5KSAqICh4IC0gY3gpICsgKGN4IC0gYngpICogKHkgLSBjeSkpIC8gKChieSAtIGN5KSAqIChheCAtIGN4KSArIChjeCAtIGJ4KSAqIChheSAtIGN5KSk7CiAgICByZXN1bHQueSA9ICgoY3kgLSBheSkgKiAoeCAtIGN4KSArIChheCAtIGN4KSAqICh5IC0gY3kpKSAvICgoYnkgLSBjeSkgKiAoYXggLSBjeCkgKyAoY3ggLSBieCkgKiAoYXkgLSBjeSkpOwogICAgcmVzdWx0LnogPSAxIC0gcmVzdWx0LnggLSByZXN1bHQueTsKICB9CgogIC8qKgogICAqIE9jdHJlZU5vZGUKICAgKi8KICBjbGFzcyBPY3RyZWVOb2RlIHsKICAgIC8qKiBUaGUgcm9vdCBub2RlICovCgogICAgLyoqIEJvdW5kYXJ5IG9mIHRoaXMgbm9kZSAqLwoKICAgIC8qKiBDb250YWluZWQgZGF0YSBhdCB0aGUgY3VycmVudCBub2RlIGxldmVsICovCgogICAgLyoqIENoaWxkcmVuIHRvIHRoaXMgbm9kZSAqLwogICAgY29uc3RydWN0b3Iob3B0aW9ucykgewogICAgICBpZiAob3B0aW9ucyA9PT0gdm9pZCAwKSB7CiAgICAgICAgb3B0aW9ucyA9IHt9OwogICAgICB9CgogICAgICB0aGlzLnJvb3QgPSBvcHRpb25zLnJvb3QgfHwgbnVsbDsKICAgICAgdGhpcy5hYWJiID0gb3B0aW9ucy5hYWJiID8gb3B0aW9ucy5hYWJiLmNsb25lKCkgOiBuZXcgQUFCQigpOwogICAgICB0aGlzLmRhdGEgPSBbXTsKICAgICAgdGhpcy5jaGlsZHJlbiA9IFtdOwogICAgfQogICAgLyoqCiAgICAgKiByZXNldAogICAgICovCgoKICAgIHJlc2V0KCkgewogICAgICB0aGlzLmNoaWxkcmVuLmxlbmd0aCA9IHRoaXMuZGF0YS5sZW5ndGggPSAwOwogICAgfQogICAgLyoqCiAgICAgKiBJbnNlcnQgZGF0YSBpbnRvIHRoaXMgbm9kZQogICAgICogQHJldHVybiBUcnVlIGlmIHN1Y2Nlc3NmdWwsIG90aGVyd2lzZSBmYWxzZQogICAgICovCgoKICAgIGluc2VydChhYWJiLCBlbGVtZW50RGF0YSwgbGV2ZWwpIHsKICAgICAgaWYgKGxldmVsID09PSB2b2lkIDApIHsKICAgICAgICBsZXZlbCA9IDA7CiAgICAgIH0KCiAgICAgIGNvbnN0IG5vZGVEYXRhID0gdGhpcy5kYXRhOyAvLyBJZ25vcmUgb2JqZWN0cyB0aGF0IGRvIG5vdCBiZWxvbmcgaW4gdGhpcyBub2RlCgogICAgICBpZiAoIXRoaXMuYWFiYi5jb250YWlucyhhYWJiKSkgewogICAgICAgIHJldHVybiBmYWxzZTsgLy8gb2JqZWN0IGNhbm5vdCBiZSBhZGRlZAogICAgICB9CgogICAgICBjb25zdCBjaGlsZHJlbiA9IHRoaXMuY2hpbGRyZW47CiAgICAgIGNvbnN0IG1heERlcHRoID0gdGhpcy5tYXhEZXB0aCB8fCB0aGlzLnJvb3QubWF4RGVwdGg7CgogICAgICBpZiAobGV2ZWwgPCBtYXhEZXB0aCkgewogICAgICAgIC8vIFN1YmRpdmlkZSBpZiB0aGVyZSBhcmUgbm8gY2hpbGRyZW4geWV0CiAgICAgICAgbGV0IHN1YmRpdmlkZWQgPSBmYWxzZTsKCiAgICAgICAgaWYgKCFjaGlsZHJlbi5sZW5ndGgpIHsKICAgICAgICAgIHRoaXMuc3ViZGl2aWRlKCk7CiAgICAgICAgICBzdWJkaXZpZGVkID0gdHJ1ZTsKICAgICAgICB9IC8vIGFkZCB0byB3aGljaGV2ZXIgbm9kZSB3aWxsIGFjY2VwdCBpdAoKCiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IDg7IGkrKykgewogICAgICAgICAgaWYgKGNoaWxkcmVuW2ldLmluc2VydChhYWJiLCBlbGVtZW50RGF0YSwgbGV2ZWwgKyAxKSkgewogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGlmIChzdWJkaXZpZGVkKSB7CiAgICAgICAgICAvLyBObyBjaGlsZHJlbiBhY2NlcHRlZCEgTWlnaHQgYXMgd2VsbCBqdXN0IHJlbW92ZSBlbSBzaW5jZSB0aGV5IGNvbnRhaW4gbm9uZQogICAgICAgICAgY2hpbGRyZW4ubGVuZ3RoID0gMDsKICAgICAgICB9CiAgICAgIH0gLy8gVG9vIGRlZXAsIG9yIGNoaWxkcmVuIGRpZG50IHdhbnQgaXQuIGFkZCBpdCBpbiBjdXJyZW50IG5vZGUKCgogICAgICBub2RlRGF0YS5wdXNoKGVsZW1lbnREYXRhKTsKICAgICAgcmV0dXJuIHRydWU7CiAgICB9CiAgICAvKioKICAgICAqIENyZWF0ZSA4IGVxdWFsbHkgc2l6ZWQgY2hpbGRyZW4gbm9kZXMgYW5kIHB1dCB0aGVtIGluIHRoZSBgY2hpbGRyZW5gIGFycmF5LgogICAgICovCgoKICAgIHN1YmRpdmlkZSgpIHsKICAgICAgY29uc3QgYWFiYiA9IHRoaXMuYWFiYjsKICAgICAgY29uc3QgbCA9IGFhYmIubG93ZXJCb3VuZDsKICAgICAgY29uc3QgdSA9IGFhYmIudXBwZXJCb3VuZDsKICAgICAgY29uc3QgY2hpbGRyZW4gPSB0aGlzLmNoaWxkcmVuOwogICAgICBjaGlsZHJlbi5wdXNoKG5ldyBPY3RyZWVOb2RlKHsKICAgICAgICBhYWJiOiBuZXcgQUFCQih7CiAgICAgICAgICBsb3dlckJvdW5kOiBuZXcgVmVjMygwLCAwLCAwKQogICAgICAgIH0pCiAgICAgIH0pLCBuZXcgT2N0cmVlTm9kZSh7CiAgICAgICAgYWFiYjogbmV3IEFBQkIoewogICAgICAgICAgbG93ZXJCb3VuZDogbmV3IFZlYzMoMSwgMCwgMCkKICAgICAgICB9KQogICAgICB9KSwgbmV3IE9jdHJlZU5vZGUoewogICAgICAgIGFhYmI6IG5ldyBBQUJCKHsKICAgICAgICAgIGxvd2VyQm91bmQ6IG5ldyBWZWMzKDEsIDEsIDApCiAgICAgICAgfSkKICAgICAgfSksIG5ldyBPY3RyZWVOb2RlKHsKICAgICAgICBhYWJiOiBuZXcgQUFCQih7CiAgICAgICAgICBsb3dlckJvdW5kOiBuZXcgVmVjMygxLCAxLCAxKQogICAgICAgIH0pCiAgICAgIH0pLCBuZXcgT2N0cmVlTm9kZSh7CiAgICAgICAgYWFiYjogbmV3IEFBQkIoewogICAgICAgICAgbG93ZXJCb3VuZDogbmV3IFZlYzMoMCwgMSwgMSkKICAgICAgICB9KQogICAgICB9KSwgbmV3IE9jdHJlZU5vZGUoewogICAgICAgIGFhYmI6IG5ldyBBQUJCKHsKICAgICAgICAgIGxvd2VyQm91bmQ6IG5ldyBWZWMzKDAsIDAsIDEpCiAgICAgICAgfSkKICAgICAgfSksIG5ldyBPY3RyZWVOb2RlKHsKICAgICAgICBhYWJiOiBuZXcgQUFCQih7CiAgICAgICAgICBsb3dlckJvdW5kOiBuZXcgVmVjMygxLCAwLCAxKQogICAgICAgIH0pCiAgICAgIH0pLCBuZXcgT2N0cmVlTm9kZSh7CiAgICAgICAgYWFiYjogbmV3IEFBQkIoewogICAgICAgICAgbG93ZXJCb3VuZDogbmV3IFZlYzMoMCwgMSwgMCkKICAgICAgICB9KQogICAgICB9KSk7CiAgICAgIHUudnN1YihsLCBoYWxmRGlhZ29uYWwpOwogICAgICBoYWxmRGlhZ29uYWwuc2NhbGUoMC41LCBoYWxmRGlhZ29uYWwpOwogICAgICBjb25zdCByb290ID0gdGhpcy5yb290IHx8IHRoaXM7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gODsgaSsrKSB7CiAgICAgICAgY29uc3QgY2hpbGQgPSBjaGlsZHJlbltpXTsgLy8gU2V0IGN1cnJlbnQgbm9kZSBhcyByb290CgogICAgICAgIGNoaWxkLnJvb3QgPSByb290OyAvLyBDb21wdXRlIGJvdW5kcwoKICAgICAgICBjb25zdCBsb3dlckJvdW5kID0gY2hpbGQuYWFiYi5sb3dlckJvdW5kOwogICAgICAgIGxvd2VyQm91bmQueCAqPSBoYWxmRGlhZ29uYWwueDsKICAgICAgICBsb3dlckJvdW5kLnkgKj0gaGFsZkRpYWdvbmFsLnk7CiAgICAgICAgbG93ZXJCb3VuZC56ICo9IGhhbGZEaWFnb25hbC56OwogICAgICAgIGxvd2VyQm91bmQudmFkZChsLCBsb3dlckJvdW5kKTsgLy8gVXBwZXIgYm91bmQgaXMgYWx3YXlzIGxvd2VyIGJvdW5kICsgaGFsZkRpYWdvbmFsCgogICAgICAgIGxvd2VyQm91bmQudmFkZChoYWxmRGlhZ29uYWwsIGNoaWxkLmFhYmIudXBwZXJCb3VuZCk7CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogR2V0IGFsbCBkYXRhLCBwb3RlbnRpYWxseSB3aXRoaW4gYW4gQUFCQgogICAgICogQHJldHVybiBUaGUgInJlc3VsdCIgb2JqZWN0CiAgICAgKi8KCgogICAgYWFiYlF1ZXJ5KGFhYmIsIHJlc3VsdCkgewogICAgICB0aGlzLmRhdGE7IC8vIGFib3J0IGlmIHRoZSByYW5nZSBkb2VzIG5vdCBpbnRlcnNlY3QgdGhpcyBub2RlCiAgICAgIC8vIGlmICghdGhpcy5hYWJiLm92ZXJsYXBzKGFhYmIpKXsKICAgICAgLy8gICAgIHJldHVybiByZXN1bHQ7CiAgICAgIC8vIH0KICAgICAgLy8gQWRkIG9iamVjdHMgYXQgdGhpcyBsZXZlbAogICAgICAvLyBBcnJheS5wcm90b3R5cGUucHVzaC5hcHBseShyZXN1bHQsIG5vZGVEYXRhKTsKICAgICAgLy8gQWRkIGNoaWxkIGRhdGEKICAgICAgLy8gQHRvZG8gdW53cmFwIHJlY3Vyc2lvbiBpbnRvIGEgcXVldWUgLyBsb29wLCB0aGF0J3MgZmFzdGVyIGluIEpTCgogICAgICB0aGlzLmNoaWxkcmVuOyAvLyBmb3IgKGxldCBpID0gMCwgTiA9IHRoaXMuY2hpbGRyZW4ubGVuZ3RoOyBpICE9PSBOOyBpKyspIHsKICAgICAgLy8gICAgIGNoaWxkcmVuW2ldLmFhYmJRdWVyeShhYWJiLCByZXN1bHQpOwogICAgICAvLyB9CgogICAgICBjb25zdCBxdWV1ZSA9IFt0aGlzXTsKCiAgICAgIHdoaWxlIChxdWV1ZS5sZW5ndGgpIHsKICAgICAgICBjb25zdCBub2RlID0gcXVldWUucG9wKCk7CgogICAgICAgIGlmIChub2RlLmFhYmIub3ZlcmxhcHMoYWFiYikpIHsKICAgICAgICAgIEFycmF5LnByb3RvdHlwZS5wdXNoLmFwcGx5KHJlc3VsdCwgbm9kZS5kYXRhKTsKICAgICAgICB9CgogICAgICAgIEFycmF5LnByb3RvdHlwZS5wdXNoLmFwcGx5KHF1ZXVlLCBub2RlLmNoaWxkcmVuKTsKICAgICAgfQoKICAgICAgcmV0dXJuIHJlc3VsdDsKICAgIH0KICAgIC8qKgogICAgICogR2V0IGFsbCBkYXRhLCBwb3RlbnRpYWxseSBpbnRlcnNlY3RlZCBieSBhIHJheS4KICAgICAqIEByZXR1cm4gVGhlICJyZXN1bHQiIG9iamVjdAogICAgICovCgoKICAgIHJheVF1ZXJ5KHJheSwgdHJlZVRyYW5zZm9ybSwgcmVzdWx0KSB7CiAgICAgIC8vIFVzZSBhYWJiIHF1ZXJ5IGZvciBub3cuCgogICAgICAvKiogQHRvZG8gaW1wbGVtZW50IHJlYWwgcmF5IHF1ZXJ5IHdoaWNoIG5lZWRzIGxlc3MgbG9va3VwcyAqLwogICAgICByYXkuZ2V0QUFCQih0bXBBQUJCKTsKICAgICAgdG1wQUFCQi50b0xvY2FsRnJhbWUodHJlZVRyYW5zZm9ybSwgdG1wQUFCQik7CiAgICAgIHRoaXMuYWFiYlF1ZXJ5KHRtcEFBQkIsIHJlc3VsdCk7CiAgICAgIHJldHVybiByZXN1bHQ7CiAgICB9CiAgICAvKioKICAgICAqIHJlbW92ZUVtcHR5Tm9kZXMKICAgICAqLwoKCiAgICByZW1vdmVFbXB0eU5vZGVzKCkgewogICAgICBmb3IgKGxldCBpID0gdGhpcy5jaGlsZHJlbi5sZW5ndGggLSAxOyBpID49IDA7IGktLSkgewogICAgICAgIHRoaXMuY2hpbGRyZW5baV0ucmVtb3ZlRW1wdHlOb2RlcygpOwoKICAgICAgICBpZiAoIXRoaXMuY2hpbGRyZW5baV0uY2hpbGRyZW4ubGVuZ3RoICYmICF0aGlzLmNoaWxkcmVuW2ldLmRhdGEubGVuZ3RoKSB7CiAgICAgICAgICB0aGlzLmNoaWxkcmVuLnNwbGljZShpLCAxKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KCiAgfQogIC8qKgogICAqIE9jdHJlZQogICAqLwoKCiAgY2xhc3MgT2N0cmVlIGV4dGVuZHMgT2N0cmVlTm9kZSB7CiAgICAvKioKICAgICAqIE1heGltdW0gc3ViZGl2aXNpb24gZGVwdGgKICAgICAqIEBkZWZhdWx0IDgKICAgICAqLwoKICAgIC8qKgogICAgICogQHBhcmFtIGFhYmIgVGhlIHRvdGFsIEFBQkIgb2YgdGhlIHRyZWUKICAgICAqLwogICAgY29uc3RydWN0b3IoYWFiYiwgb3B0aW9ucykgewogICAgICBpZiAob3B0aW9ucyA9PT0gdm9pZCAwKSB7CiAgICAgICAgb3B0aW9ucyA9IHt9OwogICAgICB9CgogICAgICBzdXBlcih7CiAgICAgICAgcm9vdDogbnVsbCwKICAgICAgICBhYWJiCiAgICAgIH0pOwogICAgICB0aGlzLm1heERlcHRoID0gdHlwZW9mIG9wdGlvbnMubWF4RGVwdGggIT09ICd1bmRlZmluZWQnID8gb3B0aW9ucy5tYXhEZXB0aCA6IDg7CiAgICB9CgogIH0KICBjb25zdCBoYWxmRGlhZ29uYWwgPSBuZXcgVmVjMygpOwogIGNvbnN0IHRtcEFBQkIgPSBuZXcgQUFCQigpOwoKICAvKioKICAgKiBUcmltZXNoLgogICAqIEBleGFtcGxlCiAgICogICAgIC8vIEhvdyB0byBtYWtlIGEgbWVzaCB3aXRoIGEgc2luZ2xlIHRyaWFuZ2xlCiAgICogICAgIGNvbnN0IHZlcnRpY2VzID0gWwogICAqICAgICAgICAgMCwgMCwgMCwgLy8gdmVydGV4IDAKICAgKiAgICAgICAgIDEsIDAsIDAsIC8vIHZlcnRleCAxCiAgICogICAgICAgICAwLCAxLCAwICAvLyB2ZXJ0ZXggMgogICAqICAgICBdCiAgICogICAgIGNvbnN0IGluZGljZXMgPSBbCiAgICogICAgICAgICAwLCAxLCAyICAvLyB0cmlhbmdsZSAwCiAgICogICAgIF0KICAgKiAgICAgY29uc3QgdHJpbWVzaFNoYXBlID0gbmV3IENBTk5PTi5UcmltZXNoKHZlcnRpY2VzLCBpbmRpY2VzKQogICAqLwogIGNsYXNzIFRyaW1lc2ggZXh0ZW5kcyBTaGFwZSB7CiAgICAvKioKICAgICAqIHZlcnRpY2VzCiAgICAgKi8KCiAgICAvKioKICAgICAqIEFycmF5IG9mIGludGVnZXJzLCBpbmRpY2F0aW5nIHdoaWNoIHZlcnRpY2VzIGVhY2ggdHJpYW5nbGUgY29uc2lzdHMgb2YuIFRoZSBsZW5ndGggb2YgdGhpcyBhcnJheSBpcyB0aHVzIDMgdGltZXMgdGhlIG51bWJlciBvZiB0cmlhbmdsZXMuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFRoZSBub3JtYWxzIGRhdGEuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFRoZSBsb2NhbCBBQUJCIG9mIHRoZSBtZXNoLgogICAgICovCgogICAgLyoqCiAgICAgKiBSZWZlcmVuY2VzIHRvIHZlcnRleCBwYWlycywgbWFraW5nIHVwIGFsbCB1bmlxdWUgZWRnZXMgaW4gdGhlIHRyaW1lc2guCiAgICAgKi8KCiAgICAvKioKICAgICAqIExvY2FsIHNjYWxpbmcgb2YgdGhlIG1lc2guIFVzZSAuc2V0U2NhbGUoKSB0byBzZXQgaXQuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFRoZSBpbmRleGVkIHRyaWFuZ2xlcy4gVXNlIC51cGRhdGVUcmVlKCkgdG8gdXBkYXRlIGl0LgogICAgICovCiAgICBjb25zdHJ1Y3Rvcih2ZXJ0aWNlcywgaW5kaWNlcykgewogICAgICBzdXBlcih7CiAgICAgICAgdHlwZTogU2hhcGUudHlwZXMuVFJJTUVTSAogICAgICB9KTsKICAgICAgdGhpcy52ZXJ0aWNlcyA9IG5ldyBGbG9hdDMyQXJyYXkodmVydGljZXMpOwogICAgICB0aGlzLmluZGljZXMgPSBuZXcgSW50MTZBcnJheShpbmRpY2VzKTsKICAgICAgdGhpcy5ub3JtYWxzID0gbmV3IEZsb2F0MzJBcnJheShpbmRpY2VzLmxlbmd0aCk7CiAgICAgIHRoaXMuYWFiYiA9IG5ldyBBQUJCKCk7CiAgICAgIHRoaXMuZWRnZXMgPSBudWxsOwogICAgICB0aGlzLnNjYWxlID0gbmV3IFZlYzMoMSwgMSwgMSk7CiAgICAgIHRoaXMudHJlZSA9IG5ldyBPY3RyZWUoKTsKICAgICAgdGhpcy51cGRhdGVFZGdlcygpOwogICAgICB0aGlzLnVwZGF0ZU5vcm1hbHMoKTsKICAgICAgdGhpcy51cGRhdGVBQUJCKCk7CiAgICAgIHRoaXMudXBkYXRlQm91bmRpbmdTcGhlcmVSYWRpdXMoKTsKICAgICAgdGhpcy51cGRhdGVUcmVlKCk7CiAgICB9CiAgICAvKioKICAgICAqIHVwZGF0ZVRyZWUKICAgICAqLwoKCiAgICB1cGRhdGVUcmVlKCkgewogICAgICBjb25zdCB0cmVlID0gdGhpcy50cmVlOwogICAgICB0cmVlLnJlc2V0KCk7CiAgICAgIHRyZWUuYWFiYi5jb3B5KHRoaXMuYWFiYik7CiAgICAgIGNvbnN0IHNjYWxlID0gdGhpcy5zY2FsZTsgLy8gVGhlIGxvY2FsIG1lc2ggQUFCQiBpcyBzY2FsZWQsIGJ1dCB0aGUgb2N0cmVlIEFBQkIgc2hvdWxkIGJlIHVuc2NhbGVkCgogICAgICB0cmVlLmFhYmIubG93ZXJCb3VuZC54ICo9IDEgLyBzY2FsZS54OwogICAgICB0cmVlLmFhYmIubG93ZXJCb3VuZC55ICo9IDEgLyBzY2FsZS55OwogICAgICB0cmVlLmFhYmIubG93ZXJCb3VuZC56ICo9IDEgLyBzY2FsZS56OwogICAgICB0cmVlLmFhYmIudXBwZXJCb3VuZC54ICo9IDEgLyBzY2FsZS54OwogICAgICB0cmVlLmFhYmIudXBwZXJCb3VuZC55ICo9IDEgLyBzY2FsZS55OwogICAgICB0cmVlLmFhYmIudXBwZXJCb3VuZC56ICo9IDEgLyBzY2FsZS56OyAvLyBJbnNlcnQgYWxsIHRyaWFuZ2xlcwoKICAgICAgY29uc3QgdHJpYW5nbGVBQUJCID0gbmV3IEFBQkIoKTsKICAgICAgY29uc3QgYSA9IG5ldyBWZWMzKCk7CiAgICAgIGNvbnN0IGIgPSBuZXcgVmVjMygpOwogICAgICBjb25zdCBjID0gbmV3IFZlYzMoKTsKICAgICAgY29uc3QgcG9pbnRzID0gW2EsIGIsIGNdOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLmluZGljZXMubGVuZ3RoIC8gMzsgaSsrKSB7CiAgICAgICAgLy90aGlzLmdldFRyaWFuZ2xlVmVydGljZXMoaSwgYSwgYiwgYyk7CiAgICAgICAgLy8gR2V0IHVuc2NhbGVkIHRyaWFuZ2xlIHZlcnRzCiAgICAgICAgY29uc3QgaTMgPSBpICogMzsKCiAgICAgICAgdGhpcy5fZ2V0VW5zY2FsZWRWZXJ0ZXgodGhpcy5pbmRpY2VzW2kzXSwgYSk7CgogICAgICAgIHRoaXMuX2dldFVuc2NhbGVkVmVydGV4KHRoaXMuaW5kaWNlc1tpMyArIDFdLCBiKTsKCiAgICAgICAgdGhpcy5fZ2V0VW5zY2FsZWRWZXJ0ZXgodGhpcy5pbmRpY2VzW2kzICsgMl0sIGMpOwoKICAgICAgICB0cmlhbmdsZUFBQkIuc2V0RnJvbVBvaW50cyhwb2ludHMpOwogICAgICAgIHRyZWUuaW5zZXJ0KHRyaWFuZ2xlQUFCQiwgaSk7CiAgICAgIH0KCiAgICAgIHRyZWUucmVtb3ZlRW1wdHlOb2RlcygpOwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgdHJpYW5nbGVzIGluIGEgbG9jYWwgQUFCQiBmcm9tIHRoZSB0cmltZXNoLgogICAgICogQHBhcmFtIHJlc3VsdCBBbiBhcnJheSBvZiBpbnRlZ2VycywgcmVmZXJlbmNpbmcgdGhlIHF1ZXJpZWQgdHJpYW5nbGVzLgogICAgICovCgoKICAgIGdldFRyaWFuZ2xlc0luQUFCQihhYWJiLCByZXN1bHQpIHsKICAgICAgdW5zY2FsZWRBQUJCLmNvcHkoYWFiYik7IC8vIFNjYWxlIGl0IHRvIGxvY2FsCgogICAgICBjb25zdCBzY2FsZSA9IHRoaXMuc2NhbGU7CiAgICAgIGNvbnN0IGlzeCA9IHNjYWxlLng7CiAgICAgIGNvbnN0IGlzeSA9IHNjYWxlLnk7CiAgICAgIGNvbnN0IGlzeiA9IHNjYWxlLno7CiAgICAgIGNvbnN0IGwgPSB1bnNjYWxlZEFBQkIubG93ZXJCb3VuZDsKICAgICAgY29uc3QgdSA9IHVuc2NhbGVkQUFCQi51cHBlckJvdW5kOwogICAgICBsLnggLz0gaXN4OwogICAgICBsLnkgLz0gaXN5OwogICAgICBsLnogLz0gaXN6OwogICAgICB1LnggLz0gaXN4OwogICAgICB1LnkgLz0gaXN5OwogICAgICB1LnogLz0gaXN6OwogICAgICByZXR1cm4gdGhpcy50cmVlLmFhYmJRdWVyeSh1bnNjYWxlZEFBQkIsIHJlc3VsdCk7CiAgICB9CiAgICAvKioKICAgICAqIHNldFNjYWxlCiAgICAgKi8KCgogICAgc2V0U2NhbGUoc2NhbGUpIHsKICAgICAgY29uc3Qgd2FzVW5pZm9ybSA9IHRoaXMuc2NhbGUueCA9PT0gdGhpcy5zY2FsZS55ICYmIHRoaXMuc2NhbGUueSA9PT0gdGhpcy5zY2FsZS56OwogICAgICBjb25zdCBpc1VuaWZvcm0gPSBzY2FsZS54ID09PSBzY2FsZS55ICYmIHNjYWxlLnkgPT09IHNjYWxlLno7CgogICAgICBpZiAoISh3YXNVbmlmb3JtICYmIGlzVW5pZm9ybSkpIHsKICAgICAgICAvLyBOb24tdW5pZm9ybSBzY2FsaW5nLiBOZWVkIHRvIHVwZGF0ZSBub3JtYWxzLgogICAgICAgIHRoaXMudXBkYXRlTm9ybWFscygpOwogICAgICB9CgogICAgICB0aGlzLnNjYWxlLmNvcHkoc2NhbGUpOwogICAgICB0aGlzLnVwZGF0ZUFBQkIoKTsKICAgICAgdGhpcy51cGRhdGVCb3VuZGluZ1NwaGVyZVJhZGl1cygpOwogICAgfQogICAgLyoqCiAgICAgKiBDb21wdXRlIHRoZSBub3JtYWxzIG9mIHRoZSBmYWNlcy4gV2lsbCBzYXZlIGluIHRoZSBgLm5vcm1hbHNgIGFycmF5LgogICAgICovCgoKICAgIHVwZGF0ZU5vcm1hbHMoKSB7CiAgICAgIGNvbnN0IG4gPSBjb21wdXRlTm9ybWFsc19uOyAvLyBHZW5lcmF0ZSBub3JtYWxzCgogICAgICBjb25zdCBub3JtYWxzID0gdGhpcy5ub3JtYWxzOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLmluZGljZXMubGVuZ3RoIC8gMzsgaSsrKSB7CiAgICAgICAgY29uc3QgaTMgPSBpICogMzsKICAgICAgICBjb25zdCBhID0gdGhpcy5pbmRpY2VzW2kzXTsKICAgICAgICBjb25zdCBiID0gdGhpcy5pbmRpY2VzW2kzICsgMV07CiAgICAgICAgY29uc3QgYyA9IHRoaXMuaW5kaWNlc1tpMyArIDJdOwogICAgICAgIHRoaXMuZ2V0VmVydGV4KGEsIHZhKTsKICAgICAgICB0aGlzLmdldFZlcnRleChiLCB2Yik7CiAgICAgICAgdGhpcy5nZXRWZXJ0ZXgoYywgdmMpOwogICAgICAgIFRyaW1lc2guY29tcHV0ZU5vcm1hbCh2YiwgdmEsIHZjLCBuKTsKICAgICAgICBub3JtYWxzW2kzXSA9IG4ueDsKICAgICAgICBub3JtYWxzW2kzICsgMV0gPSBuLnk7CiAgICAgICAgbm9ybWFsc1tpMyArIDJdID0gbi56OwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIFVwZGF0ZSB0aGUgYC5lZGdlc2AgcHJvcGVydHkKICAgICAqLwoKCiAgICB1cGRhdGVFZGdlcygpIHsKICAgICAgY29uc3QgZWRnZXMgPSB7fTsKCiAgICAgIGNvbnN0IGFkZCA9IChhLCBiKSA9PiB7CiAgICAgICAgY29uc3Qga2V5ID0gYSA8IGIgPyBgJHthfV8ke2J9YCA6IGAke2J9XyR7YX1gOwogICAgICAgIGVkZ2VzW2tleV0gPSB0cnVlOwogICAgICB9OwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLmluZGljZXMubGVuZ3RoIC8gMzsgaSsrKSB7CiAgICAgICAgY29uc3QgaTMgPSBpICogMzsKICAgICAgICBjb25zdCBhID0gdGhpcy5pbmRpY2VzW2kzXTsKICAgICAgICBjb25zdCBiID0gdGhpcy5pbmRpY2VzW2kzICsgMV07CiAgICAgICAgY29uc3QgYyA9IHRoaXMuaW5kaWNlc1tpMyArIDJdOwogICAgICAgIGFkZChhLCBiKTsKICAgICAgICBhZGQoYiwgYyk7CiAgICAgICAgYWRkKGMsIGEpOwogICAgICB9CgogICAgICBjb25zdCBrZXlzID0gT2JqZWN0LmtleXMoZWRnZXMpOwogICAgICB0aGlzLmVkZ2VzID0gbmV3IEludDE2QXJyYXkoa2V5cy5sZW5ndGggKiAyKTsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwga2V5cy5sZW5ndGg7IGkrKykgewogICAgICAgIGNvbnN0IGluZGljZXMgPSBrZXlzW2ldLnNwbGl0KCdfJyk7CiAgICAgICAgdGhpcy5lZGdlc1syICogaV0gPSBwYXJzZUludChpbmRpY2VzWzBdLCAxMCk7CiAgICAgICAgdGhpcy5lZGdlc1syICogaSArIDFdID0gcGFyc2VJbnQoaW5kaWNlc1sxXSwgMTApOwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIEdldCBhbiBlZGdlIHZlcnRleAogICAgICogQHBhcmFtIGZpcnN0T3JTZWNvbmQgMCBvciAxLCBkZXBlbmRpbmcgb24gd2hpY2ggb25lIG9mIHRoZSB2ZXJ0aWNlcyB5b3UgbmVlZC4KICAgICAqIEBwYXJhbSB2ZXJ0ZXhTdG9yZSBXaGVyZSB0byBzdG9yZSB0aGUgcmVzdWx0CiAgICAgKi8KCgogICAgZ2V0RWRnZVZlcnRleChlZGdlSW5kZXgsIGZpcnN0T3JTZWNvbmQsIHZlcnRleFN0b3JlKSB7CiAgICAgIGNvbnN0IHZlcnRleEluZGV4ID0gdGhpcy5lZGdlc1tlZGdlSW5kZXggKiAyICsgKGZpcnN0T3JTZWNvbmQgPyAxIDogMCldOwogICAgICB0aGlzLmdldFZlcnRleCh2ZXJ0ZXhJbmRleCwgdmVydGV4U3RvcmUpOwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgYSB2ZWN0b3IgYWxvbmcgYW4gZWRnZS4KICAgICAqLwoKCiAgICBnZXRFZGdlVmVjdG9yKGVkZ2VJbmRleCwgdmVjdG9yU3RvcmUpIHsKICAgICAgY29uc3QgdmEgPSBnZXRFZGdlVmVjdG9yX3ZhOwogICAgICBjb25zdCB2YiA9IGdldEVkZ2VWZWN0b3JfdmI7CiAgICAgIHRoaXMuZ2V0RWRnZVZlcnRleChlZGdlSW5kZXgsIDAsIHZhKTsKICAgICAgdGhpcy5nZXRFZGdlVmVydGV4KGVkZ2VJbmRleCwgMSwgdmIpOwogICAgICB2Yi52c3ViKHZhLCB2ZWN0b3JTdG9yZSk7CiAgICB9CiAgICAvKioKICAgICAqIEdldCBmYWNlIG5vcm1hbCBnaXZlbiAzIHZlcnRpY2VzCiAgICAgKi8KCgogICAgc3RhdGljIGNvbXB1dGVOb3JtYWwodmEsIHZiLCB2YywgdGFyZ2V0KSB7CiAgICAgIHZiLnZzdWIodmEsIGFiKTsKICAgICAgdmMudnN1Yih2YiwgY2IpOwogICAgICBjYi5jcm9zcyhhYiwgdGFyZ2V0KTsKCiAgICAgIGlmICghdGFyZ2V0LmlzWmVybygpKSB7CiAgICAgICAgdGFyZ2V0Lm5vcm1hbGl6ZSgpOwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIEdldCB2ZXJ0ZXggaS4KICAgICAqIEByZXR1cm4gVGhlICJvdXQiIHZlY3RvciBvYmplY3QKICAgICAqLwoKCiAgICBnZXRWZXJ0ZXgoaSwgb3V0KSB7CiAgICAgIGNvbnN0IHNjYWxlID0gdGhpcy5zY2FsZTsKCiAgICAgIHRoaXMuX2dldFVuc2NhbGVkVmVydGV4KGksIG91dCk7CgogICAgICBvdXQueCAqPSBzY2FsZS54OwogICAgICBvdXQueSAqPSBzY2FsZS55OwogICAgICBvdXQueiAqPSBzY2FsZS56OwogICAgICByZXR1cm4gb3V0OwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgcmF3IHZlcnRleCBpCiAgICAgKiBAcmV0dXJuIFRoZSAib3V0IiB2ZWN0b3Igb2JqZWN0CiAgICAgKi8KCgogICAgX2dldFVuc2NhbGVkVmVydGV4KGksIG91dCkgewogICAgICBjb25zdCBpMyA9IGkgKiAzOwogICAgICBjb25zdCB2ZXJ0aWNlcyA9IHRoaXMudmVydGljZXM7CiAgICAgIHJldHVybiBvdXQuc2V0KHZlcnRpY2VzW2kzXSwgdmVydGljZXNbaTMgKyAxXSwgdmVydGljZXNbaTMgKyAyXSk7CiAgICB9CiAgICAvKioKICAgICAqIEdldCBhIHZlcnRleCBmcm9tIHRoZSB0cmltZXNoLHRyYW5zZm9ybWVkIGJ5IHRoZSBnaXZlbiBwb3NpdGlvbiBhbmQgcXVhdGVybmlvbi4KICAgICAqIEByZXR1cm4gVGhlICJvdXQiIHZlY3RvciBvYmplY3QKICAgICAqLwoKCiAgICBnZXRXb3JsZFZlcnRleChpLCBwb3MsIHF1YXQsIG91dCkgewogICAgICB0aGlzLmdldFZlcnRleChpLCBvdXQpOwogICAgICBUcmFuc2Zvcm0ucG9pbnRUb1dvcmxkRnJhbWUocG9zLCBxdWF0LCBvdXQsIG91dCk7CiAgICAgIHJldHVybiBvdXQ7CiAgICB9CiAgICAvKioKICAgICAqIEdldCB0aGUgdGhyZWUgdmVydGljZXMgZm9yIHRyaWFuZ2xlIGkuCiAgICAgKi8KCgogICAgZ2V0VHJpYW5nbGVWZXJ0aWNlcyhpLCBhLCBiLCBjKSB7CiAgICAgIGNvbnN0IGkzID0gaSAqIDM7CiAgICAgIHRoaXMuZ2V0VmVydGV4KHRoaXMuaW5kaWNlc1tpM10sIGEpOwogICAgICB0aGlzLmdldFZlcnRleCh0aGlzLmluZGljZXNbaTMgKyAxXSwgYik7CiAgICAgIHRoaXMuZ2V0VmVydGV4KHRoaXMuaW5kaWNlc1tpMyArIDJdLCBjKTsKICAgIH0KICAgIC8qKgogICAgICogQ29tcHV0ZSB0aGUgbm9ybWFsIG9mIHRyaWFuZ2xlIGkuCiAgICAgKiBAcmV0dXJuIFRoZSAidGFyZ2V0IiB2ZWN0b3Igb2JqZWN0CiAgICAgKi8KCgogICAgZ2V0Tm9ybWFsKGksIHRhcmdldCkgewogICAgICBjb25zdCBpMyA9IGkgKiAzOwogICAgICByZXR1cm4gdGFyZ2V0LnNldCh0aGlzLm5vcm1hbHNbaTNdLCB0aGlzLm5vcm1hbHNbaTMgKyAxXSwgdGhpcy5ub3JtYWxzW2kzICsgMl0pOwogICAgfQogICAgLyoqCiAgICAgKiBAcmV0dXJuIFRoZSAidGFyZ2V0IiB2ZWN0b3Igb2JqZWN0CiAgICAgKi8KCgogICAgY2FsY3VsYXRlTG9jYWxJbmVydGlhKG1hc3MsIHRhcmdldCkgewogICAgICAvLyBBcHByb3hpbWF0ZSB3aXRoIGJveCBpbmVydGlhCiAgICAgIC8vIEV4YWN0IGluZXJ0aWEgY2FsY3VsYXRpb24gaXMgb3ZlcmtpbGwsIGJ1dCBzZWUgaHR0cDovL2dlb21ldHJpY3Rvb2xzLmNvbS9Eb2N1bWVudGF0aW9uL1BvbHloZWRyYWxNYXNzUHJvcGVydGllcy5wZGYgZm9yIHRoZSBjb3JyZWN0IHdheSB0byBkbyBpdAogICAgICB0aGlzLmNvbXB1dGVMb2NhbEFBQkIoY2xpX2FhYmIpOwogICAgICBjb25zdCB4ID0gY2xpX2FhYmIudXBwZXJCb3VuZC54IC0gY2xpX2FhYmIubG93ZXJCb3VuZC54OwogICAgICBjb25zdCB5ID0gY2xpX2FhYmIudXBwZXJCb3VuZC55IC0gY2xpX2FhYmIubG93ZXJCb3VuZC55OwogICAgICBjb25zdCB6ID0gY2xpX2FhYmIudXBwZXJCb3VuZC56IC0gY2xpX2FhYmIubG93ZXJCb3VuZC56OwogICAgICByZXR1cm4gdGFyZ2V0LnNldCgxLjAgLyAxMi4wICogbWFzcyAqICgyICogeSAqIDIgKiB5ICsgMiAqIHogKiAyICogeiksIDEuMCAvIDEyLjAgKiBtYXNzICogKDIgKiB4ICogMiAqIHggKyAyICogeiAqIDIgKiB6KSwgMS4wIC8gMTIuMCAqIG1hc3MgKiAoMiAqIHkgKiAyICogeSArIDIgKiB4ICogMiAqIHgpKTsKICAgIH0KICAgIC8qKgogICAgICogQ29tcHV0ZSB0aGUgbG9jYWwgQUFCQiBmb3IgdGhlIHRyaW1lc2gKICAgICAqLwoKCiAgICBjb21wdXRlTG9jYWxBQUJCKGFhYmIpIHsKICAgICAgY29uc3QgbCA9IGFhYmIubG93ZXJCb3VuZDsKICAgICAgY29uc3QgdSA9IGFhYmIudXBwZXJCb3VuZDsKICAgICAgY29uc3QgbiA9IHRoaXMudmVydGljZXMubGVuZ3RoOwogICAgICB0aGlzLnZlcnRpY2VzOwogICAgICBjb25zdCB2ID0gY29tcHV0ZUxvY2FsQUFCQl93b3JsZFZlcnQ7CiAgICAgIHRoaXMuZ2V0VmVydGV4KDAsIHYpOwogICAgICBsLmNvcHkodik7CiAgICAgIHUuY29weSh2KTsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpICE9PSBuOyBpKyspIHsKICAgICAgICB0aGlzLmdldFZlcnRleChpLCB2KTsKCiAgICAgICAgaWYgKHYueCA8IGwueCkgewogICAgICAgICAgbC54ID0gdi54OwogICAgICAgIH0gZWxzZSBpZiAodi54ID4gdS54KSB7CiAgICAgICAgICB1LnggPSB2Lng7CiAgICAgICAgfQoKICAgICAgICBpZiAodi55IDwgbC55KSB7CiAgICAgICAgICBsLnkgPSB2Lnk7CiAgICAgICAgfSBlbHNlIGlmICh2LnkgPiB1LnkpIHsKICAgICAgICAgIHUueSA9IHYueTsKICAgICAgICB9CgogICAgICAgIGlmICh2LnogPCBsLnopIHsKICAgICAgICAgIGwueiA9IHYuejsKICAgICAgICB9IGVsc2UgaWYgKHYueiA+IHUueikgewogICAgICAgICAgdS56ID0gdi56OwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBVcGRhdGUgdGhlIGAuYWFiYmAgcHJvcGVydHkKICAgICAqLwoKCiAgICB1cGRhdGVBQUJCKCkgewogICAgICB0aGlzLmNvbXB1dGVMb2NhbEFBQkIodGhpcy5hYWJiKTsKICAgIH0KICAgIC8qKgogICAgICogV2lsbCB1cGRhdGUgdGhlIGAuYm91bmRpbmdTcGhlcmVSYWRpdXNgIHByb3BlcnR5CiAgICAgKi8KCgogICAgdXBkYXRlQm91bmRpbmdTcGhlcmVSYWRpdXMoKSB7CiAgICAgIC8vIEFzc3VtZSBwb2ludHMgYXJlIGRpc3RyaWJ1dGVkIHdpdGggbG9jYWwgKDAsMCwwKSBhcyBjZW50ZXIKICAgICAgbGV0IG1heDIgPSAwOwogICAgICBjb25zdCB2ZXJ0aWNlcyA9IHRoaXMudmVydGljZXM7CiAgICAgIGNvbnN0IHYgPSBuZXcgVmVjMygpOwoKICAgICAgZm9yIChsZXQgaSA9IDAsIE4gPSB2ZXJ0aWNlcy5sZW5ndGggLyAzOyBpICE9PSBOOyBpKyspIHsKICAgICAgICB0aGlzLmdldFZlcnRleChpLCB2KTsKICAgICAgICBjb25zdCBub3JtMiA9IHYubGVuZ3RoU3F1YXJlZCgpOwoKICAgICAgICBpZiAobm9ybTIgPiBtYXgyKSB7CiAgICAgICAgICBtYXgyID0gbm9ybTI7CiAgICAgICAgfQogICAgICB9CgogICAgICB0aGlzLmJvdW5kaW5nU3BoZXJlUmFkaXVzID0gTWF0aC5zcXJ0KG1heDIpOwogICAgfQogICAgLyoqCiAgICAgKiBjYWxjdWxhdGVXb3JsZEFBQkIKICAgICAqLwoKCiAgICBjYWxjdWxhdGVXb3JsZEFBQkIocG9zLCBxdWF0LCBtaW4sIG1heCkgewogICAgICAvKgogICAgICAgICAgY29uc3QgbiA9IHRoaXMudmVydGljZXMubGVuZ3RoIC8gMywKICAgICAgICAgICAgICB2ZXJ0cyA9IHRoaXMudmVydGljZXM7CiAgICAgICAgICBjb25zdCBtaW54LG1pbnksbWlueixtYXh4LG1heHksbWF4ejsKICAgICAgICAgICBjb25zdCB2ID0gdGVtcFdvcmxkVmVydGV4OwogICAgICAgICAgZm9yKGxldCBpPTA7IGk8bjsgaSsrKXsKICAgICAgICAgICAgICB0aGlzLmdldFZlcnRleChpLCB2KTsKICAgICAgICAgICAgICBxdWF0LnZtdWx0KHYsIHYpOwogICAgICAgICAgICAgIHBvcy52YWRkKHYsIHYpOwogICAgICAgICAgICAgIGlmICh2LnggPCBtaW54IHx8IG1pbng9PT11bmRlZmluZWQpewogICAgICAgICAgICAgICAgICBtaW54ID0gdi54OwogICAgICAgICAgICAgIH0gZWxzZSBpZih2LnggPiBtYXh4IHx8IG1heHg9PT11bmRlZmluZWQpewogICAgICAgICAgICAgICAgICBtYXh4ID0gdi54OwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgaWYgKHYueSA8IG1pbnkgfHwgbWlueT09PXVuZGVmaW5lZCl7CiAgICAgICAgICAgICAgICAgIG1pbnkgPSB2Lnk7CiAgICAgICAgICAgICAgfSBlbHNlIGlmKHYueSA+IG1heHkgfHwgbWF4eT09PXVuZGVmaW5lZCl7CiAgICAgICAgICAgICAgICAgIG1heHkgPSB2Lnk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICBpZiAodi56IDwgbWlueiB8fCBtaW56PT09dW5kZWZpbmVkKXsKICAgICAgICAgICAgICAgICAgbWlueiA9IHYuejsKICAgICAgICAgICAgICB9IGVsc2UgaWYodi56ID4gbWF4eiB8fCBtYXh6PT09dW5kZWZpbmVkKXsKICAgICAgICAgICAgICAgICAgbWF4eiA9IHYuejsKICAgICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICBtaW4uc2V0KG1pbngsbWlueSxtaW56KTsKICAgICAgICAgIG1heC5zZXQobWF4eCxtYXh5LG1heHopOwogICAgICAgICAgKi8KICAgICAgLy8gRmFzdGVyIGFwcHJveGltYXRpb24gdXNpbmcgbG9jYWwgQUFCQgogICAgICBjb25zdCBmcmFtZSA9IGNhbGN1bGF0ZVdvcmxkQUFCQl9mcmFtZTsKICAgICAgY29uc3QgcmVzdWx0ID0gY2FsY3VsYXRlV29ybGRBQUJCX2FhYmI7CiAgICAgIGZyYW1lLnBvc2l0aW9uID0gcG9zOwogICAgICBmcmFtZS5xdWF0ZXJuaW9uID0gcXVhdDsKICAgICAgdGhpcy5hYWJiLnRvV29ybGRGcmFtZShmcmFtZSwgcmVzdWx0KTsKICAgICAgbWluLmNvcHkocmVzdWx0Lmxvd2VyQm91bmQpOwogICAgICBtYXguY29weShyZXN1bHQudXBwZXJCb3VuZCk7CiAgICB9CiAgICAvKioKICAgICAqIEdldCBhcHByb3hpbWF0ZSB2b2x1bWUKICAgICAqLwoKCiAgICB2b2x1bWUoKSB7CiAgICAgIHJldHVybiA0LjAgKiBNYXRoLlBJICogdGhpcy5ib3VuZGluZ1NwaGVyZVJhZGl1cyAvIDMuMDsKICAgIH0KICAgIC8qKgogICAgICogQ3JlYXRlIGEgVHJpbWVzaCBpbnN0YW5jZSwgc2hhcGVkIGFzIGEgdG9ydXMuCiAgICAgKi8KCgogICAgc3RhdGljIGNyZWF0ZVRvcnVzKHJhZGl1cywgdHViZSwgcmFkaWFsU2VnbWVudHMsIHR1YnVsYXJTZWdtZW50cywgYXJjKSB7CiAgICAgIGlmIChyYWRpdXMgPT09IHZvaWQgMCkgewogICAgICAgIHJhZGl1cyA9IDE7CiAgICAgIH0KCiAgICAgIGlmICh0dWJlID09PSB2b2lkIDApIHsKICAgICAgICB0dWJlID0gMC41OwogICAgICB9CgogICAgICBpZiAocmFkaWFsU2VnbWVudHMgPT09IHZvaWQgMCkgewogICAgICAgIHJhZGlhbFNlZ21lbnRzID0gODsKICAgICAgfQoKICAgICAgaWYgKHR1YnVsYXJTZWdtZW50cyA9PT0gdm9pZCAwKSB7CiAgICAgICAgdHVidWxhclNlZ21lbnRzID0gNjsKICAgICAgfQoKICAgICAgaWYgKGFyYyA9PT0gdm9pZCAwKSB7CiAgICAgICAgYXJjID0gTWF0aC5QSSAqIDI7CiAgICAgIH0KCiAgICAgIGNvbnN0IHZlcnRpY2VzID0gW107CiAgICAgIGNvbnN0IGluZGljZXMgPSBbXTsKCiAgICAgIGZvciAobGV0IGogPSAwOyBqIDw9IHJhZGlhbFNlZ21lbnRzOyBqKyspIHsKICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8PSB0dWJ1bGFyU2VnbWVudHM7IGkrKykgewogICAgICAgICAgY29uc3QgdSA9IGkgLyB0dWJ1bGFyU2VnbWVudHMgKiBhcmM7CiAgICAgICAgICBjb25zdCB2ID0gaiAvIHJhZGlhbFNlZ21lbnRzICogTWF0aC5QSSAqIDI7CiAgICAgICAgICBjb25zdCB4ID0gKHJhZGl1cyArIHR1YmUgKiBNYXRoLmNvcyh2KSkgKiBNYXRoLmNvcyh1KTsKICAgICAgICAgIGNvbnN0IHkgPSAocmFkaXVzICsgdHViZSAqIE1hdGguY29zKHYpKSAqIE1hdGguc2luKHUpOwogICAgICAgICAgY29uc3QgeiA9IHR1YmUgKiBNYXRoLnNpbih2KTsKICAgICAgICAgIHZlcnRpY2VzLnB1c2goeCwgeSwgeik7CiAgICAgICAgfQogICAgICB9CgogICAgICBmb3IgKGxldCBqID0gMTsgaiA8PSByYWRpYWxTZWdtZW50czsgaisrKSB7CiAgICAgICAgZm9yIChsZXQgaSA9IDE7IGkgPD0gdHVidWxhclNlZ21lbnRzOyBpKyspIHsKICAgICAgICAgIGNvbnN0IGEgPSAodHVidWxhclNlZ21lbnRzICsgMSkgKiBqICsgaSAtIDE7CiAgICAgICAgICBjb25zdCBiID0gKHR1YnVsYXJTZWdtZW50cyArIDEpICogKGogLSAxKSArIGkgLSAxOwogICAgICAgICAgY29uc3QgYyA9ICh0dWJ1bGFyU2VnbWVudHMgKyAxKSAqIChqIC0gMSkgKyBpOwogICAgICAgICAgY29uc3QgZCA9ICh0dWJ1bGFyU2VnbWVudHMgKyAxKSAqIGogKyBpOwogICAgICAgICAgaW5kaWNlcy5wdXNoKGEsIGIsIGQpOwogICAgICAgICAgaW5kaWNlcy5wdXNoKGIsIGMsIGQpOwogICAgICAgIH0KICAgICAgfQoKICAgICAgcmV0dXJuIG5ldyBUcmltZXNoKHZlcnRpY2VzLCBpbmRpY2VzKTsKICAgIH0KCiAgfQogIGNvbnN0IGNvbXB1dGVOb3JtYWxzX24gPSBuZXcgVmVjMygpOwogIGNvbnN0IHVuc2NhbGVkQUFCQiA9IG5ldyBBQUJCKCk7CiAgY29uc3QgZ2V0RWRnZVZlY3Rvcl92YSA9IG5ldyBWZWMzKCk7CiAgY29uc3QgZ2V0RWRnZVZlY3Rvcl92YiA9IG5ldyBWZWMzKCk7CiAgY29uc3QgY2IgPSBuZXcgVmVjMygpOwogIGNvbnN0IGFiID0gbmV3IFZlYzMoKTsKICBjb25zdCB2YSA9IG5ldyBWZWMzKCk7CiAgY29uc3QgdmIgPSBuZXcgVmVjMygpOwogIGNvbnN0IHZjID0gbmV3IFZlYzMoKTsKICBjb25zdCBjbGlfYWFiYiA9IG5ldyBBQUJCKCk7CiAgY29uc3QgY29tcHV0ZUxvY2FsQUFCQl93b3JsZFZlcnQgPSBuZXcgVmVjMygpOwogIGNvbnN0IGNhbGN1bGF0ZVdvcmxkQUFCQl9mcmFtZSA9IG5ldyBUcmFuc2Zvcm0oKTsKICBjb25zdCBjYWxjdWxhdGVXb3JsZEFBQkJfYWFiYiA9IG5ldyBBQUJCKCk7CgogIC8qKgogICAqIENvbnN0cmFpbnQgZXF1YXRpb24gc29sdmVyIGJhc2UgY2xhc3MuCiAgICovCiAgY2xhc3MgU29sdmVyIHsKICAgIC8qKgogICAgICogQWxsIGVxdWF0aW9ucyB0byBiZSBzb2x2ZWQKICAgICAqLwoKICAgIC8qKgogICAgICogQHRvZG8gcmVtb3ZlIHVzZWxlc3MgY29uc3RydWN0b3IKICAgICAqLwogICAgY29uc3RydWN0b3IoKSB7CiAgICAgIHRoaXMuZXF1YXRpb25zID0gW107CiAgICB9CiAgICAvKioKICAgICAqIFNob3VsZCBiZSBpbXBsZW1lbnRlZCBpbiBzdWJjbGFzc2VzIQogICAgICogQHRvZG8gdXNlIGFic3RyYWN0CiAgICAgKiBAcmV0dXJuIG51bWJlciBvZiBpdGVyYXRpb25zIHBlcmZvcm1lZAogICAgICovCgoKICAgIHNvbHZlKGR0LCB3b3JsZCkgewogICAgICByZXR1cm4gKC8vIFNob3VsZCByZXR1cm4gdGhlIG51bWJlciBvZiBpdGVyYXRpb25zIGRvbmUhCiAgICAgICAgMAogICAgICApOwogICAgfQogICAgLyoqCiAgICAgKiBBZGQgYW4gZXF1YXRpb24KICAgICAqLwoKCiAgICBhZGRFcXVhdGlvbihlcSkgewogICAgICBpZiAoZXEuZW5hYmxlZCAmJiAhZXEuYmkuaXNUcmlnZ2VyICYmICFlcS5iai5pc1RyaWdnZXIpIHsKICAgICAgICB0aGlzLmVxdWF0aW9ucy5wdXNoKGVxKTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBSZW1vdmUgYW4gZXF1YXRpb24KICAgICAqLwoKCiAgICByZW1vdmVFcXVhdGlvbihlcSkgewogICAgICBjb25zdCBlcXMgPSB0aGlzLmVxdWF0aW9uczsKICAgICAgY29uc3QgaSA9IGVxcy5pbmRleE9mKGVxKTsKCiAgICAgIGlmIChpICE9PSAtMSkgewogICAgICAgIGVxcy5zcGxpY2UoaSwgMSk7CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogQWRkIGFsbCBlcXVhdGlvbnMKICAgICAqLwoKCiAgICByZW1vdmVBbGxFcXVhdGlvbnMoKSB7CiAgICAgIHRoaXMuZXF1YXRpb25zLmxlbmd0aCA9IDA7CiAgICB9CgogIH0KCiAgLyoqCiAgICogQ29uc3RyYWludCBlcXVhdGlvbiBHYXVzcy1TZWlkZWwgc29sdmVyLgogICAqIEB0b2RvIFRoZSBzcG9vayBwYXJhbWV0ZXJzIHNob3VsZCBiZSBzcGVjaWZpZWQgZm9yIGVhY2ggY29uc3RyYWludCwgbm90IGdsb2JhbGx5LgogICAqIEBzZWUgaHR0cHM6Ly93d3c4LmNzLnVtdS5zZS9rdXJzZXIvNURWMDU4L1ZUMDkvbGVjdHVyZXMvc3Bvb2tub3Rlcy5wZGYKICAgKi8KICBjbGFzcyBHU1NvbHZlciBleHRlbmRzIFNvbHZlciB7CiAgICAvKioKICAgICAqIFRoZSBudW1iZXIgb2Ygc29sdmVyIGl0ZXJhdGlvbnMgZGV0ZXJtaW5lcyBxdWFsaXR5IG9mIHRoZSBjb25zdHJhaW50cyBpbiB0aGUgd29ybGQuCiAgICAgKiBUaGUgbW9yZSBpdGVyYXRpb25zLCB0aGUgbW9yZSBjb3JyZWN0IHNpbXVsYXRpb24uIE1vcmUgaXRlcmF0aW9ucyBuZWVkIG1vcmUgY29tcHV0YXRpb25zIHRob3VnaC4gSWYgeW91IGhhdmUgYSBsYXJnZSBncmF2aXR5IGZvcmNlIGluIHlvdXIgd29ybGQsIHlvdSB3aWxsIG5lZWQgbW9yZSBpdGVyYXRpb25zLgogICAgICovCgogICAgLyoqCiAgICAgKiBXaGVuIHRvbGVyYW5jZSBpcyByZWFjaGVkLCB0aGUgc3lzdGVtIGlzIGFzc3VtZWQgdG8gYmUgY29udmVyZ2VkLgogICAgICovCgogICAgLyoqCiAgICAgKiBAdG9kbyByZW1vdmUgdXNlbGVzcyBjb25zdHJ1Y3RvcgogICAgICovCiAgICBjb25zdHJ1Y3RvcigpIHsKICAgICAgc3VwZXIoKTsKICAgICAgdGhpcy5pdGVyYXRpb25zID0gMTA7CiAgICAgIHRoaXMudG9sZXJhbmNlID0gMWUtNzsKICAgIH0KICAgIC8qKgogICAgICogU29sdmUKICAgICAqIEByZXR1cm4gbnVtYmVyIG9mIGl0ZXJhdGlvbnMgcGVyZm9ybWVkCiAgICAgKi8KCgogICAgc29sdmUoZHQsIHdvcmxkKSB7CiAgICAgIGxldCBpdGVyID0gMDsKICAgICAgY29uc3QgbWF4SXRlciA9IHRoaXMuaXRlcmF0aW9uczsKICAgICAgY29uc3QgdG9sU3F1YXJlZCA9IHRoaXMudG9sZXJhbmNlICogdGhpcy50b2xlcmFuY2U7CiAgICAgIGNvbnN0IGVxdWF0aW9ucyA9IHRoaXMuZXF1YXRpb25zOwogICAgICBjb25zdCBOZXEgPSBlcXVhdGlvbnMubGVuZ3RoOwogICAgICBjb25zdCBib2RpZXMgPSB3b3JsZC5ib2RpZXM7CiAgICAgIGNvbnN0IE5ib2RpZXMgPSBib2RpZXMubGVuZ3RoOwogICAgICBjb25zdCBoID0gZHQ7CiAgICAgIGxldCBCOwogICAgICBsZXQgaW52QzsKICAgICAgbGV0IGRlbHRhbGFtYmRhOwogICAgICBsZXQgZGVsdGFsYW1iZGFUb3Q7CiAgICAgIGxldCBHV2xhbWJkYTsKICAgICAgbGV0IGxhbWJkYWo7IC8vIFVwZGF0ZSBzb2x2ZSBtYXNzCgogICAgICBpZiAoTmVxICE9PSAwKSB7CiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IE5ib2RpZXM7IGkrKykgewogICAgICAgICAgYm9kaWVzW2ldLnVwZGF0ZVNvbHZlTWFzc1Byb3BlcnRpZXMoKTsKICAgICAgICB9CiAgICAgIH0gLy8gVGhpbmdzIHRoYXQgZG8gbm90IGNoYW5nZSBkdXJpbmcgaXRlcmF0aW9uIGNhbiBiZSBjb21wdXRlZCBvbmNlCgoKICAgICAgY29uc3QgaW52Q3MgPSBHU1NvbHZlcl9zb2x2ZV9pbnZDczsKICAgICAgY29uc3QgQnMgPSBHU1NvbHZlcl9zb2x2ZV9CczsKICAgICAgY29uc3QgbGFtYmRhID0gR1NTb2x2ZXJfc29sdmVfbGFtYmRhOwogICAgICBpbnZDcy5sZW5ndGggPSBOZXE7CiAgICAgIEJzLmxlbmd0aCA9IE5lcTsKICAgICAgbGFtYmRhLmxlbmd0aCA9IE5lcTsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpICE9PSBOZXE7IGkrKykgewogICAgICAgIGNvbnN0IGMgPSBlcXVhdGlvbnNbaV07CiAgICAgICAgbGFtYmRhW2ldID0gMC4wOwogICAgICAgIEJzW2ldID0gYy5jb21wdXRlQihoKTsKICAgICAgICBpbnZDc1tpXSA9IDEuMCAvIGMuY29tcHV0ZUMoKTsKICAgICAgfQoKICAgICAgaWYgKE5lcSAhPT0gMCkgewogICAgICAgIC8vIFJlc2V0IHZsYW1iZGEKICAgICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gTmJvZGllczsgaSsrKSB7CiAgICAgICAgICBjb25zdCBiID0gYm9kaWVzW2ldOwogICAgICAgICAgY29uc3QgdmxhbWJkYSA9IGIudmxhbWJkYTsKICAgICAgICAgIGNvbnN0IHdsYW1iZGEgPSBiLndsYW1iZGE7CiAgICAgICAgICB2bGFtYmRhLnNldCgwLCAwLCAwKTsKICAgICAgICAgIHdsYW1iZGEuc2V0KDAsIDAsIDApOwogICAgICAgIH0gLy8gSXRlcmF0ZSBvdmVyIGVxdWF0aW9ucwoKCiAgICAgICAgZm9yIChpdGVyID0gMDsgaXRlciAhPT0gbWF4SXRlcjsgaXRlcisrKSB7CiAgICAgICAgICAvLyBBY2N1bXVsYXRlIHRoZSB0b3RhbCBlcnJvciBmb3IgZWFjaCBpdGVyYXRpb24uCiAgICAgICAgICBkZWx0YWxhbWJkYVRvdCA9IDAuMDsKCiAgICAgICAgICBmb3IgKGxldCBqID0gMDsgaiAhPT0gTmVxOyBqKyspIHsKICAgICAgICAgICAgY29uc3QgYyA9IGVxdWF0aW9uc1tqXTsgLy8gQ29tcHV0ZSBpdGVyYXRpb24KCiAgICAgICAgICAgIEIgPSBCc1tqXTsKICAgICAgICAgICAgaW52QyA9IGludkNzW2pdOwogICAgICAgICAgICBsYW1iZGFqID0gbGFtYmRhW2pdOwogICAgICAgICAgICBHV2xhbWJkYSA9IGMuY29tcHV0ZUdXbGFtYmRhKCk7CiAgICAgICAgICAgIGRlbHRhbGFtYmRhID0gaW52QyAqIChCIC0gR1dsYW1iZGEgLSBjLmVwcyAqIGxhbWJkYWopOyAvLyBDbGFtcCBpZiB3ZSBhcmUgbm90IHdpdGhpbiB0aGUgbWluL21heCBpbnRlcnZhbAoKICAgICAgICAgICAgaWYgKGxhbWJkYWogKyBkZWx0YWxhbWJkYSA8IGMubWluRm9yY2UpIHsKICAgICAgICAgICAgICBkZWx0YWxhbWJkYSA9IGMubWluRm9yY2UgLSBsYW1iZGFqOwogICAgICAgICAgICB9IGVsc2UgaWYgKGxhbWJkYWogKyBkZWx0YWxhbWJkYSA+IGMubWF4Rm9yY2UpIHsKICAgICAgICAgICAgICBkZWx0YWxhbWJkYSA9IGMubWF4Rm9yY2UgLSBsYW1iZGFqOwogICAgICAgICAgICB9CgogICAgICAgICAgICBsYW1iZGFbal0gKz0gZGVsdGFsYW1iZGE7CiAgICAgICAgICAgIGRlbHRhbGFtYmRhVG90ICs9IGRlbHRhbGFtYmRhID4gMC4wID8gZGVsdGFsYW1iZGEgOiAtZGVsdGFsYW1iZGE7IC8vIGFicyhkZWx0YWxhbWJkYSkKCiAgICAgICAgICAgIGMuYWRkVG9XbGFtYmRhKGRlbHRhbGFtYmRhKTsKICAgICAgICAgIH0gLy8gSWYgdGhlIHRvdGFsIGVycm9yIGlzIHNtYWxsIGVub3VnaCAtIHN0b3AgaXRlcmF0ZQoKCiAgICAgICAgICBpZiAoZGVsdGFsYW1iZGFUb3QgKiBkZWx0YWxhbWJkYVRvdCA8IHRvbFNxdWFyZWQpIHsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CiAgICAgICAgfSAvLyBBZGQgcmVzdWx0IHRvIHZlbG9jaXR5CgoKICAgICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gTmJvZGllczsgaSsrKSB7CiAgICAgICAgICBjb25zdCBiID0gYm9kaWVzW2ldOwogICAgICAgICAgY29uc3QgdiA9IGIudmVsb2NpdHk7CiAgICAgICAgICBjb25zdCB3ID0gYi5hbmd1bGFyVmVsb2NpdHk7CiAgICAgICAgICBiLnZsYW1iZGEudm11bChiLmxpbmVhckZhY3RvciwgYi52bGFtYmRhKTsKICAgICAgICAgIHYudmFkZChiLnZsYW1iZGEsIHYpOwogICAgICAgICAgYi53bGFtYmRhLnZtdWwoYi5hbmd1bGFyRmFjdG9yLCBiLndsYW1iZGEpOwogICAgICAgICAgdy52YWRkKGIud2xhbWJkYSwgdyk7CiAgICAgICAgfSAvLyBTZXQgdGhlIGAubXVsdGlwbGllcmAgcHJvcGVydHkgb2YgZWFjaCBlcXVhdGlvbgoKCiAgICAgICAgbGV0IGwgPSBlcXVhdGlvbnMubGVuZ3RoOwogICAgICAgIGNvbnN0IGludkR0ID0gMSAvIGg7CgogICAgICAgIHdoaWxlIChsLS0pIHsKICAgICAgICAgIGVxdWF0aW9uc1tsXS5tdWx0aXBsaWVyID0gbGFtYmRhW2xdICogaW52RHQ7CiAgICAgICAgfQogICAgICB9CgogICAgICByZXR1cm4gaXRlcjsKICAgIH0KCiAgfSAvLyBKdXN0IHRlbXBvcmFyeSBudW1iZXIgaG9sZGVycyB0aGF0IHdlIHdhbnQgdG8gcmV1c2UgZWFjaCBpdGVyYXRpb24uCgogIGNvbnN0IEdTU29sdmVyX3NvbHZlX2xhbWJkYSA9IFtdOwogIGNvbnN0IEdTU29sdmVyX3NvbHZlX2ludkNzID0gW107CiAgY29uc3QgR1NTb2x2ZXJfc29sdmVfQnMgPSBbXTsKCiAgLyoqCiAgICogU3BsaXRzIHRoZSBlcXVhdGlvbnMgaW50byBpc2xhbmRzIGFuZCBzb2x2ZXMgdGhlbSBpbmRlcGVuZGVudGx5LiBDYW4gaW1wcm92ZSBwZXJmb3JtYW5jZS4KICAgKi8KICBjbGFzcyBTcGxpdFNvbHZlciBleHRlbmRzIFNvbHZlciB7CiAgICAvKioKICAgICAqIFRoZSBudW1iZXIgb2Ygc29sdmVyIGl0ZXJhdGlvbnMgZGV0ZXJtaW5lcyBxdWFsaXR5IG9mIHRoZSBjb25zdHJhaW50cyBpbiB0aGUgd29ybGQuIFRoZSBtb3JlIGl0ZXJhdGlvbnMsIHRoZSBtb3JlIGNvcnJlY3Qgc2ltdWxhdGlvbi4gTW9yZSBpdGVyYXRpb25zIG5lZWQgbW9yZSBjb21wdXRhdGlvbnMgdGhvdWdoLiBJZiB5b3UgaGF2ZSBhIGxhcmdlIGdyYXZpdHkgZm9yY2UgaW4geW91ciB3b3JsZCwgeW91IHdpbGwgbmVlZCBtb3JlIGl0ZXJhdGlvbnMuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFdoZW4gdG9sZXJhbmNlIGlzIHJlYWNoZWQsIHRoZSBzeXN0ZW0gaXMgYXNzdW1lZCB0byBiZSBjb252ZXJnZWQuCiAgICAgKi8KCiAgICAvKiogc3Vic29sdmVyICovCiAgICBjb25zdHJ1Y3RvcihzdWJzb2x2ZXIpIHsKICAgICAgc3VwZXIoKTsKICAgICAgdGhpcy5pdGVyYXRpb25zID0gMTA7CiAgICAgIHRoaXMudG9sZXJhbmNlID0gMWUtNzsKICAgICAgdGhpcy5zdWJzb2x2ZXIgPSBzdWJzb2x2ZXI7CiAgICAgIHRoaXMubm9kZXMgPSBbXTsKICAgICAgdGhpcy5ub2RlUG9vbCA9IFtdOyAvLyBDcmVhdGUgbmVlZGVkIG5vZGVzLCByZXVzZSBpZiBwb3NzaWJsZQoKICAgICAgd2hpbGUgKHRoaXMubm9kZVBvb2wubGVuZ3RoIDwgMTI4KSB7CiAgICAgICAgdGhpcy5ub2RlUG9vbC5wdXNoKHRoaXMuY3JlYXRlTm9kZSgpKTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBjcmVhdGVOb2RlCiAgICAgKi8KCgogICAgY3JlYXRlTm9kZSgpIHsKICAgICAgcmV0dXJuIHsKICAgICAgICBib2R5OiBudWxsLAogICAgICAgIGNoaWxkcmVuOiBbXSwKICAgICAgICBlcXM6IFtdLAogICAgICAgIHZpc2l0ZWQ6IGZhbHNlCiAgICAgIH07CiAgICB9CiAgICAvKioKICAgICAqIFNvbHZlIHRoZSBzdWJzeXN0ZW1zCiAgICAgKiBAcmV0dXJuIG51bWJlciBvZiBpdGVyYXRpb25zIHBlcmZvcm1lZAogICAgICovCgoKICAgIHNvbHZlKGR0LCB3b3JsZCkgewogICAgICBjb25zdCBub2RlcyA9IFNwbGl0U29sdmVyX3NvbHZlX25vZGVzOwogICAgICBjb25zdCBub2RlUG9vbCA9IHRoaXMubm9kZVBvb2w7CiAgICAgIGNvbnN0IGJvZGllcyA9IHdvcmxkLmJvZGllczsKICAgICAgY29uc3QgZXF1YXRpb25zID0gdGhpcy5lcXVhdGlvbnM7CiAgICAgIGNvbnN0IE5lcSA9IGVxdWF0aW9ucy5sZW5ndGg7CiAgICAgIGNvbnN0IE5ib2RpZXMgPSBib2RpZXMubGVuZ3RoOwogICAgICBjb25zdCBzdWJzb2x2ZXIgPSB0aGlzLnN1YnNvbHZlcjsgLy8gQ3JlYXRlIG5lZWRlZCBub2RlcywgcmV1c2UgaWYgcG9zc2libGUKCiAgICAgIHdoaWxlIChub2RlUG9vbC5sZW5ndGggPCBOYm9kaWVzKSB7CiAgICAgICAgbm9kZVBvb2wucHVzaCh0aGlzLmNyZWF0ZU5vZGUoKSk7CiAgICAgIH0KCiAgICAgIG5vZGVzLmxlbmd0aCA9IE5ib2RpZXM7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IE5ib2RpZXM7IGkrKykgewogICAgICAgIG5vZGVzW2ldID0gbm9kZVBvb2xbaV07CiAgICAgIH0gLy8gUmVzZXQgbm9kZSB2YWx1ZXMKCgogICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gTmJvZGllczsgaSsrKSB7CiAgICAgICAgY29uc3Qgbm9kZSA9IG5vZGVzW2ldOwogICAgICAgIG5vZGUuYm9keSA9IGJvZGllc1tpXTsKICAgICAgICBub2RlLmNoaWxkcmVuLmxlbmd0aCA9IDA7CiAgICAgICAgbm9kZS5lcXMubGVuZ3RoID0gMDsKICAgICAgICBub2RlLnZpc2l0ZWQgPSBmYWxzZTsKICAgICAgfQoKICAgICAgZm9yIChsZXQgayA9IDA7IGsgIT09IE5lcTsgaysrKSB7CiAgICAgICAgY29uc3QgZXEgPSBlcXVhdGlvbnNba107CiAgICAgICAgY29uc3QgaSA9IGJvZGllcy5pbmRleE9mKGVxLmJpKTsKICAgICAgICBjb25zdCBqID0gYm9kaWVzLmluZGV4T2YoZXEuYmopOwogICAgICAgIGNvbnN0IG5pID0gbm9kZXNbaV07CiAgICAgICAgY29uc3QgbmogPSBub2Rlc1tqXTsKICAgICAgICBuaS5jaGlsZHJlbi5wdXNoKG5qKTsKICAgICAgICBuaS5lcXMucHVzaChlcSk7CiAgICAgICAgbmouY2hpbGRyZW4ucHVzaChuaSk7CiAgICAgICAgbmouZXFzLnB1c2goZXEpOwogICAgICB9CgogICAgICBsZXQgY2hpbGQ7CiAgICAgIGxldCBuID0gMDsKICAgICAgbGV0IGVxcyA9IFNwbGl0U29sdmVyX3NvbHZlX2VxczsKICAgICAgc3Vic29sdmVyLnRvbGVyYW5jZSA9IHRoaXMudG9sZXJhbmNlOwogICAgICBzdWJzb2x2ZXIuaXRlcmF0aW9ucyA9IHRoaXMuaXRlcmF0aW9uczsKICAgICAgY29uc3QgZHVtbXlXb3JsZCA9IFNwbGl0U29sdmVyX3NvbHZlX2R1bW15V29ybGQ7CgogICAgICB3aGlsZSAoY2hpbGQgPSBnZXRVbnZpc2l0ZWROb2RlKG5vZGVzKSkgewogICAgICAgIGVxcy5sZW5ndGggPSAwOwogICAgICAgIGR1bW15V29ybGQuYm9kaWVzLmxlbmd0aCA9IDA7CiAgICAgICAgYmZzKGNoaWxkLCB2aXNpdEZ1bmMsIGR1bW15V29ybGQuYm9kaWVzLCBlcXMpOwogICAgICAgIGNvbnN0IE5lcXMgPSBlcXMubGVuZ3RoOwogICAgICAgIGVxcyA9IGVxcy5zb3J0KHNvcnRCeUlkKTsKCiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IE5lcXM7IGkrKykgewogICAgICAgICAgc3Vic29sdmVyLmFkZEVxdWF0aW9uKGVxc1tpXSk7CiAgICAgICAgfQoKICAgICAgICBzdWJzb2x2ZXIuc29sdmUoZHQsIGR1bW15V29ybGQpOwogICAgICAgIHN1YnNvbHZlci5yZW1vdmVBbGxFcXVhdGlvbnMoKTsKICAgICAgICBuKys7CiAgICAgIH0KCiAgICAgIHJldHVybiBuOwogICAgfQoKICB9IC8vIFJldHVybnMgdGhlIG51bWJlciBvZiBzdWJzeXN0ZW1zCgogIGNvbnN0IFNwbGl0U29sdmVyX3NvbHZlX25vZGVzID0gW107IC8vIEFsbCBhbGxvY2F0ZWQgbm9kZSBvYmplY3RzCgogIGNvbnN0IFNwbGl0U29sdmVyX3NvbHZlX2VxcyA9IFtdOyAvLyBUZW1wIGFycmF5CgogIGNvbnN0IFNwbGl0U29sdmVyX3NvbHZlX2R1bW15V29ybGQgPSB7CiAgICBib2RpZXM6IFtdCiAgfTsgLy8gVGVtcCBvYmplY3QKCiAgY29uc3QgU1RBVElDID0gQm9keS5TVEFUSUM7CgogIGZ1bmN0aW9uIGdldFVudmlzaXRlZE5vZGUobm9kZXMpIHsKICAgIGNvbnN0IE5ub2RlcyA9IG5vZGVzLmxlbmd0aDsKCiAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gTm5vZGVzOyBpKyspIHsKICAgICAgY29uc3Qgbm9kZSA9IG5vZGVzW2ldOwoKICAgICAgaWYgKCFub2RlLnZpc2l0ZWQgJiYgIShub2RlLmJvZHkudHlwZSAmIFNUQVRJQykpIHsKICAgICAgICByZXR1cm4gbm9kZTsKICAgICAgfQogICAgfQoKICAgIHJldHVybiBmYWxzZTsKICB9CgogIGNvbnN0IHF1ZXVlID0gW107CgogIGZ1bmN0aW9uIGJmcyhyb290LCB2aXNpdEZ1bmMsIGJkcywgZXFzKSB7CiAgICBxdWV1ZS5wdXNoKHJvb3QpOwogICAgcm9vdC52aXNpdGVkID0gdHJ1ZTsKICAgIHZpc2l0RnVuYyhyb290LCBiZHMsIGVxcyk7CgogICAgd2hpbGUgKHF1ZXVlLmxlbmd0aCkgewogICAgICBjb25zdCBub2RlID0gcXVldWUucG9wKCk7IC8vIExvb3Agb3ZlciB1bnZpc2l0ZWQgY2hpbGQgbm9kZXMKCiAgICAgIGxldCBjaGlsZDsKCiAgICAgIHdoaWxlIChjaGlsZCA9IGdldFVudmlzaXRlZE5vZGUobm9kZS5jaGlsZHJlbikpIHsKICAgICAgICBjaGlsZC52aXNpdGVkID0gdHJ1ZTsKICAgICAgICB2aXNpdEZ1bmMoY2hpbGQsIGJkcywgZXFzKTsKICAgICAgICBxdWV1ZS5wdXNoKGNoaWxkKTsKICAgICAgfQogICAgfQogIH0KCiAgZnVuY3Rpb24gdmlzaXRGdW5jKG5vZGUsIGJkcywgZXFzKSB7CiAgICBiZHMucHVzaChub2RlLmJvZHkpOwogICAgY29uc3QgTmVxcyA9IG5vZGUuZXFzLmxlbmd0aDsKCiAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gTmVxczsgaSsrKSB7CiAgICAgIGNvbnN0IGVxID0gbm9kZS5lcXNbaV07CgogICAgICBpZiAoIWVxcy5pbmNsdWRlcyhlcSkpIHsKICAgICAgICBlcXMucHVzaChlcSk7CiAgICAgIH0KICAgIH0KICB9CgogIGZ1bmN0aW9uIHNvcnRCeUlkKGEsIGIpIHsKICAgIHJldHVybiBiLmlkIC0gYS5pZDsKICB9CgogIC8qKgogICAqIEZvciBwb29saW5nIG9iamVjdHMgdGhhdCBjYW4gYmUgcmV1c2VkLgogICAqLwogIGNsYXNzIFBvb2wgewogICAgY29uc3RydWN0b3IoKSB7CiAgICAgIHRoaXMub2JqZWN0cyA9IFtdOwogICAgICB0aGlzLnR5cGUgPSBPYmplY3Q7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZWxlYXNlIGFuIG9iamVjdCBhZnRlciB1c2UKICAgICAqLwogICAgcmVsZWFzZSgpIHsKICAgICAgY29uc3QgTmFyZ3MgPSBhcmd1bWVudHMubGVuZ3RoOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IE5hcmdzOyBpKyspIHsKICAgICAgICB0aGlzLm9iamVjdHMucHVzaChpIDwgMCB8fCBhcmd1bWVudHMubGVuZ3RoIDw9IGkgPyB1bmRlZmluZWQgOiBhcmd1bWVudHNbaV0pOwogICAgICB9CgogICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIC8qKgogICAgICogR2V0IGFuIG9iamVjdAogICAgICovCgoKICAgIGdldCgpIHsKICAgICAgaWYgKHRoaXMub2JqZWN0cy5sZW5ndGggPT09IDApIHsKICAgICAgICByZXR1cm4gdGhpcy5jb25zdHJ1Y3RPYmplY3QoKTsKICAgICAgfSBlbHNlIHsKICAgICAgICByZXR1cm4gdGhpcy5vYmplY3RzLnBvcCgpOwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIENvbnN0cnVjdCBhbiBvYmplY3QuIFNob3VsZCBiZSBpbXBsZW1lbnRlZCBpbiBlYWNoIHN1YmNsYXNzLgogICAgICovCgoKICAgIGNvbnN0cnVjdE9iamVjdCgpIHsKICAgICAgdGhyb3cgbmV3IEVycm9yKCdjb25zdHJ1Y3RPYmplY3QoKSBub3QgaW1wbGVtZW50ZWQgaW4gdGhpcyBQb29sIHN1YmNsYXNzIHlldCEnKTsKICAgIH0KICAgIC8qKgogICAgICogQHJldHVybiBTZWxmLCBmb3IgY2hhaW5pbmcKICAgICAqLwoKCiAgICByZXNpemUoc2l6ZSkgewogICAgICBjb25zdCBvYmplY3RzID0gdGhpcy5vYmplY3RzOwoKICAgICAgd2hpbGUgKG9iamVjdHMubGVuZ3RoID4gc2l6ZSkgewogICAgICAgIG9iamVjdHMucG9wKCk7CiAgICAgIH0KCiAgICAgIHdoaWxlIChvYmplY3RzLmxlbmd0aCA8IHNpemUpIHsKICAgICAgICBvYmplY3RzLnB1c2godGhpcy5jb25zdHJ1Y3RPYmplY3QoKSk7CiAgICAgIH0KCiAgICAgIHJldHVybiB0aGlzOwogICAgfQoKICB9CgogIC8qKgogICAqIFZlYzNQb29sCiAgICovCgogIGNsYXNzIFZlYzNQb29sIGV4dGVuZHMgUG9vbCB7CiAgICBjb25zdHJ1Y3RvcigpIHsKICAgICAgc3VwZXIoLi4uYXJndW1lbnRzKTsKICAgICAgdGhpcy50eXBlID0gVmVjMzsKICAgIH0KCiAgICAvKioKICAgICAqIENvbnN0cnVjdCBhIHZlY3RvcgogICAgICovCiAgICBjb25zdHJ1Y3RPYmplY3QoKSB7CiAgICAgIHJldHVybiBuZXcgVmVjMygpOwogICAgfQoKICB9CgogIC8vIE5hbWluZyBydWxlOiBiYXNlZCBvZiB0aGUgb3JkZXIgaW4gU0hBUEVfVFlQRVMsCiAgLy8gdGhlIGZpcnN0IHBhcnQgb2YgdGhlIG1ldGhvZCBpcyBmb3JtZWQgYnkgdGhlCiAgLy8gc2hhcGUgdHlwZSB0aGF0IGNvbWVzIGJlZm9yZSwgaW4gdGhlIHNlY29uZCBwYXJ0CiAgLy8gdGhlcmUgaXMgdGhlIHNoYXBlIHR5cGUgdGhhdCBjb21lcyBhZnRlciBpbiB0aGUgU0hBUEVfVFlQRVMgbGlzdAogIGNvbnN0IENPTExJU0lPTl9UWVBFUyA9IHsKICAgIHNwaGVyZVNwaGVyZTogU2hhcGUudHlwZXMuU1BIRVJFLAogICAgc3BoZXJlUGxhbmU6IFNoYXBlLnR5cGVzLlNQSEVSRSB8IFNoYXBlLnR5cGVzLlBMQU5FLAogICAgYm94Qm94OiBTaGFwZS50eXBlcy5CT1ggfCBTaGFwZS50eXBlcy5CT1gsCiAgICBzcGhlcmVCb3g6IFNoYXBlLnR5cGVzLlNQSEVSRSB8IFNoYXBlLnR5cGVzLkJPWCwKICAgIHBsYW5lQm94OiBTaGFwZS50eXBlcy5QTEFORSB8IFNoYXBlLnR5cGVzLkJPWCwKICAgIGNvbnZleENvbnZleDogU2hhcGUudHlwZXMuQ09OVkVYUE9MWUhFRFJPTiwKICAgIHNwaGVyZUNvbnZleDogU2hhcGUudHlwZXMuU1BIRVJFIHwgU2hhcGUudHlwZXMuQ09OVkVYUE9MWUhFRFJPTiwKICAgIHBsYW5lQ29udmV4OiBTaGFwZS50eXBlcy5QTEFORSB8IFNoYXBlLnR5cGVzLkNPTlZFWFBPTFlIRURST04sCiAgICBib3hDb252ZXg6IFNoYXBlLnR5cGVzLkJPWCB8IFNoYXBlLnR5cGVzLkNPTlZFWFBPTFlIRURST04sCiAgICBzcGhlcmVIZWlnaHRmaWVsZDogU2hhcGUudHlwZXMuU1BIRVJFIHwgU2hhcGUudHlwZXMuSEVJR0hURklFTEQsCiAgICBib3hIZWlnaHRmaWVsZDogU2hhcGUudHlwZXMuQk9YIHwgU2hhcGUudHlwZXMuSEVJR0hURklFTEQsCiAgICBjb252ZXhIZWlnaHRmaWVsZDogU2hhcGUudHlwZXMuQ09OVkVYUE9MWUhFRFJPTiB8IFNoYXBlLnR5cGVzLkhFSUdIVEZJRUxELAogICAgc3BoZXJlUGFydGljbGU6IFNoYXBlLnR5cGVzLlBBUlRJQ0xFIHwgU2hhcGUudHlwZXMuU1BIRVJFLAogICAgcGxhbmVQYXJ0aWNsZTogU2hhcGUudHlwZXMuUExBTkUgfCBTaGFwZS50eXBlcy5QQVJUSUNMRSwKICAgIGJveFBhcnRpY2xlOiBTaGFwZS50eXBlcy5CT1ggfCBTaGFwZS50eXBlcy5QQVJUSUNMRSwKICAgIGNvbnZleFBhcnRpY2xlOiBTaGFwZS50eXBlcy5QQVJUSUNMRSB8IFNoYXBlLnR5cGVzLkNPTlZFWFBPTFlIRURST04sCiAgICBjeWxpbmRlckN5bGluZGVyOiBTaGFwZS50eXBlcy5DWUxJTkRFUiwKICAgIHNwaGVyZUN5bGluZGVyOiBTaGFwZS50eXBlcy5TUEhFUkUgfCBTaGFwZS50eXBlcy5DWUxJTkRFUiwKICAgIHBsYW5lQ3lsaW5kZXI6IFNoYXBlLnR5cGVzLlBMQU5FIHwgU2hhcGUudHlwZXMuQ1lMSU5ERVIsCiAgICBib3hDeWxpbmRlcjogU2hhcGUudHlwZXMuQk9YIHwgU2hhcGUudHlwZXMuQ1lMSU5ERVIsCiAgICBjb252ZXhDeWxpbmRlcjogU2hhcGUudHlwZXMuQ09OVkVYUE9MWUhFRFJPTiB8IFNoYXBlLnR5cGVzLkNZTElOREVSLAogICAgaGVpZ2h0ZmllbGRDeWxpbmRlcjogU2hhcGUudHlwZXMuSEVJR0hURklFTEQgfCBTaGFwZS50eXBlcy5DWUxJTkRFUiwKICAgIHBhcnRpY2xlQ3lsaW5kZXI6IFNoYXBlLnR5cGVzLlBBUlRJQ0xFIHwgU2hhcGUudHlwZXMuQ1lMSU5ERVIsCiAgICBzcGhlcmVUcmltZXNoOiBTaGFwZS50eXBlcy5TUEhFUkUgfCBTaGFwZS50eXBlcy5UUklNRVNILAogICAgcGxhbmVUcmltZXNoOiBTaGFwZS50eXBlcy5QTEFORSB8IFNoYXBlLnR5cGVzLlRSSU1FU0gKICB9OwoKICAvKioKICAgKiBIZWxwZXIgY2xhc3MgZm9yIHRoZSBXb3JsZC4gR2VuZXJhdGVzIENvbnRhY3RFcXVhdGlvbnMuCiAgICogQHRvZG8gU3BoZXJlLUNvbnZleFBvbHloZWRyb24gY29udGFjdHMKICAgKiBAdG9kbyBDb250YWN0IHJlZHVjdGlvbgogICAqIEB0b2RvIHNob3VsZCBtb3ZlIG1ldGhvZHMgdG8gcHJvdG90eXBlCiAgICovCiAgY2xhc3MgTmFycm93cGhhc2UgewogICAgLyoqCiAgICAgKiBJbnRlcm5hbCBzdG9yYWdlIG9mIHBvb2xlZCBjb250YWN0IHBvaW50cy4KICAgICAqLwoKICAgIC8qKgogICAgICogUG9vbGVkIHZlY3RvcnMuCiAgICAgKi8KICAgIGdldCBbQ09MTElTSU9OX1RZUEVTLnNwaGVyZVNwaGVyZV0oKSB7CiAgICAgIHJldHVybiB0aGlzLnNwaGVyZVNwaGVyZTsKICAgIH0KCiAgICBnZXQgW0NPTExJU0lPTl9UWVBFUy5zcGhlcmVQbGFuZV0oKSB7CiAgICAgIHJldHVybiB0aGlzLnNwaGVyZVBsYW5lOwogICAgfQoKICAgIGdldCBbQ09MTElTSU9OX1RZUEVTLmJveEJveF0oKSB7CiAgICAgIHJldHVybiB0aGlzLmJveEJveDsKICAgIH0KCiAgICBnZXQgW0NPTExJU0lPTl9UWVBFUy5zcGhlcmVCb3hdKCkgewogICAgICByZXR1cm4gdGhpcy5zcGhlcmVCb3g7CiAgICB9CgogICAgZ2V0IFtDT0xMSVNJT05fVFlQRVMucGxhbmVCb3hdKCkgewogICAgICByZXR1cm4gdGhpcy5wbGFuZUJveDsKICAgIH0KCiAgICBnZXQgW0NPTExJU0lPTl9UWVBFUy5jb252ZXhDb252ZXhdKCkgewogICAgICByZXR1cm4gdGhpcy5jb252ZXhDb252ZXg7CiAgICB9CgogICAgZ2V0IFtDT0xMSVNJT05fVFlQRVMuc3BoZXJlQ29udmV4XSgpIHsKICAgICAgcmV0dXJuIHRoaXMuc3BoZXJlQ29udmV4OwogICAgfQoKICAgIGdldCBbQ09MTElTSU9OX1RZUEVTLnBsYW5lQ29udmV4XSgpIHsKICAgICAgcmV0dXJuIHRoaXMucGxhbmVDb252ZXg7CiAgICB9CgogICAgZ2V0IFtDT0xMSVNJT05fVFlQRVMuYm94Q29udmV4XSgpIHsKICAgICAgcmV0dXJuIHRoaXMuYm94Q29udmV4OwogICAgfQoKICAgIGdldCBbQ09MTElTSU9OX1RZUEVTLnNwaGVyZUhlaWdodGZpZWxkXSgpIHsKICAgICAgcmV0dXJuIHRoaXMuc3BoZXJlSGVpZ2h0ZmllbGQ7CiAgICB9CgogICAgZ2V0IFtDT0xMSVNJT05fVFlQRVMuYm94SGVpZ2h0ZmllbGRdKCkgewogICAgICByZXR1cm4gdGhpcy5ib3hIZWlnaHRmaWVsZDsKICAgIH0KCiAgICBnZXQgW0NPTExJU0lPTl9UWVBFUy5jb252ZXhIZWlnaHRmaWVsZF0oKSB7CiAgICAgIHJldHVybiB0aGlzLmNvbnZleEhlaWdodGZpZWxkOwogICAgfQoKICAgIGdldCBbQ09MTElTSU9OX1RZUEVTLnNwaGVyZVBhcnRpY2xlXSgpIHsKICAgICAgcmV0dXJuIHRoaXMuc3BoZXJlUGFydGljbGU7CiAgICB9CgogICAgZ2V0IFtDT0xMSVNJT05fVFlQRVMucGxhbmVQYXJ0aWNsZV0oKSB7CiAgICAgIHJldHVybiB0aGlzLnBsYW5lUGFydGljbGU7CiAgICB9CgogICAgZ2V0IFtDT0xMSVNJT05fVFlQRVMuYm94UGFydGljbGVdKCkgewogICAgICByZXR1cm4gdGhpcy5ib3hQYXJ0aWNsZTsKICAgIH0KCiAgICBnZXQgW0NPTExJU0lPTl9UWVBFUy5jb252ZXhQYXJ0aWNsZV0oKSB7CiAgICAgIHJldHVybiB0aGlzLmNvbnZleFBhcnRpY2xlOwogICAgfQoKICAgIGdldCBbQ09MTElTSU9OX1RZUEVTLmN5bGluZGVyQ3lsaW5kZXJdKCkgewogICAgICByZXR1cm4gdGhpcy5jb252ZXhDb252ZXg7CiAgICB9CgogICAgZ2V0IFtDT0xMSVNJT05fVFlQRVMuc3BoZXJlQ3lsaW5kZXJdKCkgewogICAgICByZXR1cm4gdGhpcy5zcGhlcmVDb252ZXg7CiAgICB9CgogICAgZ2V0IFtDT0xMSVNJT05fVFlQRVMucGxhbmVDeWxpbmRlcl0oKSB7CiAgICAgIHJldHVybiB0aGlzLnBsYW5lQ29udmV4OwogICAgfQoKICAgIGdldCBbQ09MTElTSU9OX1RZUEVTLmJveEN5bGluZGVyXSgpIHsKICAgICAgcmV0dXJuIHRoaXMuYm94Q29udmV4OwogICAgfQoKICAgIGdldCBbQ09MTElTSU9OX1RZUEVTLmNvbnZleEN5bGluZGVyXSgpIHsKICAgICAgcmV0dXJuIHRoaXMuY29udmV4Q29udmV4OwogICAgfQoKICAgIGdldCBbQ09MTElTSU9OX1RZUEVTLmhlaWdodGZpZWxkQ3lsaW5kZXJdKCkgewogICAgICByZXR1cm4gdGhpcy5oZWlnaHRmaWVsZEN5bGluZGVyOwogICAgfQoKICAgIGdldCBbQ09MTElTSU9OX1RZUEVTLnBhcnRpY2xlQ3lsaW5kZXJdKCkgewogICAgICByZXR1cm4gdGhpcy5wYXJ0aWNsZUN5bGluZGVyOwogICAgfQoKICAgIGdldCBbQ09MTElTSU9OX1RZUEVTLnNwaGVyZVRyaW1lc2hdKCkgewogICAgICByZXR1cm4gdGhpcy5zcGhlcmVUcmltZXNoOwogICAgfQoKICAgIGdldCBbQ09MTElTSU9OX1RZUEVTLnBsYW5lVHJpbWVzaF0oKSB7CiAgICAgIHJldHVybiB0aGlzLnBsYW5lVHJpbWVzaDsKICAgIH0gLy8gZ2V0IFtDT0xMSVNJT05fVFlQRVMuY29udmV4VHJpbWVzaF0oKSB7CiAgICAvLyAgIHJldHVybiB0aGlzLmNvbnZleFRyaW1lc2gKICAgIC8vIH0KCgogICAgY29uc3RydWN0b3Iod29ybGQpIHsKICAgICAgdGhpcy5jb250YWN0UG9pbnRQb29sID0gW107CiAgICAgIHRoaXMuZnJpY3Rpb25FcXVhdGlvblBvb2wgPSBbXTsKICAgICAgdGhpcy5yZXN1bHQgPSBbXTsKICAgICAgdGhpcy5mcmljdGlvblJlc3VsdCA9IFtdOwogICAgICB0aGlzLnYzcG9vbCA9IG5ldyBWZWMzUG9vbCgpOwogICAgICB0aGlzLndvcmxkID0gd29ybGQ7CiAgICAgIHRoaXMuY3VycmVudENvbnRhY3RNYXRlcmlhbCA9IHdvcmxkLmRlZmF1bHRDb250YWN0TWF0ZXJpYWw7CiAgICAgIHRoaXMuZW5hYmxlRnJpY3Rpb25SZWR1Y3Rpb24gPSBmYWxzZTsKICAgIH0KICAgIC8qKgogICAgICogTWFrZSBhIGNvbnRhY3Qgb2JqZWN0LCBieSB1c2luZyB0aGUgaW50ZXJuYWwgcG9vbCBvciBjcmVhdGluZyBhIG5ldyBvbmUuCiAgICAgKi8KCgogICAgY3JlYXRlQ29udGFjdEVxdWF0aW9uKGJpLCBiaiwgc2ksIHNqLCBvdmVycmlkZVNoYXBlQSwgb3ZlcnJpZGVTaGFwZUIpIHsKICAgICAgbGV0IGM7CgogICAgICBpZiAodGhpcy5jb250YWN0UG9pbnRQb29sLmxlbmd0aCkgewogICAgICAgIGMgPSB0aGlzLmNvbnRhY3RQb2ludFBvb2wucG9wKCk7CiAgICAgICAgYy5iaSA9IGJpOwogICAgICAgIGMuYmogPSBiajsKICAgICAgfSBlbHNlIHsKICAgICAgICBjID0gbmV3IENvbnRhY3RFcXVhdGlvbihiaSwgYmopOwogICAgICB9CgogICAgICBjLmVuYWJsZWQgPSBiaS5jb2xsaXNpb25SZXNwb25zZSAmJiBiai5jb2xsaXNpb25SZXNwb25zZSAmJiBzaS5jb2xsaXNpb25SZXNwb25zZSAmJiBzai5jb2xsaXNpb25SZXNwb25zZTsKICAgICAgY29uc3QgY20gPSB0aGlzLmN1cnJlbnRDb250YWN0TWF0ZXJpYWw7CiAgICAgIGMucmVzdGl0dXRpb24gPSBjbS5yZXN0aXR1dGlvbjsKICAgICAgYy5zZXRTcG9va1BhcmFtcyhjbS5jb250YWN0RXF1YXRpb25TdGlmZm5lc3MsIGNtLmNvbnRhY3RFcXVhdGlvblJlbGF4YXRpb24sIHRoaXMud29ybGQuZHQpOwogICAgICBjb25zdCBtYXRBID0gc2kubWF0ZXJpYWwgfHwgYmkubWF0ZXJpYWw7CiAgICAgIGNvbnN0IG1hdEIgPSBzai5tYXRlcmlhbCB8fCBiai5tYXRlcmlhbDsKCiAgICAgIGlmIChtYXRBICYmIG1hdEIgJiYgbWF0QS5yZXN0aXR1dGlvbiA+PSAwICYmIG1hdEIucmVzdGl0dXRpb24gPj0gMCkgewogICAgICAgIGMucmVzdGl0dXRpb24gPSBtYXRBLnJlc3RpdHV0aW9uICogbWF0Qi5yZXN0aXR1dGlvbjsKICAgICAgfQoKICAgICAgYy5zaSA9IG92ZXJyaWRlU2hhcGVBIHx8IHNpOwogICAgICBjLnNqID0gb3ZlcnJpZGVTaGFwZUIgfHwgc2o7CiAgICAgIHJldHVybiBjOwogICAgfQoKICAgIGNyZWF0ZUZyaWN0aW9uRXF1YXRpb25zRnJvbUNvbnRhY3QoY29udGFjdEVxdWF0aW9uLCBvdXRBcnJheSkgewogICAgICBjb25zdCBib2R5QSA9IGNvbnRhY3RFcXVhdGlvbi5iaTsKICAgICAgY29uc3QgYm9keUIgPSBjb250YWN0RXF1YXRpb24uYmo7CiAgICAgIGNvbnN0IHNoYXBlQSA9IGNvbnRhY3RFcXVhdGlvbi5zaTsKICAgICAgY29uc3Qgc2hhcGVCID0gY29udGFjdEVxdWF0aW9uLnNqOwogICAgICBjb25zdCB3b3JsZCA9IHRoaXMud29ybGQ7CiAgICAgIGNvbnN0IGNtID0gdGhpcy5jdXJyZW50Q29udGFjdE1hdGVyaWFsOyAvLyBJZiBmcmljdGlvbiBvciByZXN0aXR1dGlvbiB3ZXJlIHNwZWNpZmllZCBpbiB0aGUgbWF0ZXJpYWwsIHVzZSB0aGVtCgogICAgICBsZXQgZnJpY3Rpb24gPSBjbS5mcmljdGlvbjsKICAgICAgY29uc3QgbWF0QSA9IHNoYXBlQS5tYXRlcmlhbCB8fCBib2R5QS5tYXRlcmlhbDsKICAgICAgY29uc3QgbWF0QiA9IHNoYXBlQi5tYXRlcmlhbCB8fCBib2R5Qi5tYXRlcmlhbDsKCiAgICAgIGlmIChtYXRBICYmIG1hdEIgJiYgbWF0QS5mcmljdGlvbiA+PSAwICYmIG1hdEIuZnJpY3Rpb24gPj0gMCkgewogICAgICAgIGZyaWN0aW9uID0gbWF0QS5mcmljdGlvbiAqIG1hdEIuZnJpY3Rpb247CiAgICAgIH0KCiAgICAgIGlmIChmcmljdGlvbiA+IDApIHsKICAgICAgICAvLyBDcmVhdGUgMiB0YW5nZW50IGVxdWF0aW9ucwogICAgICAgIC8vIFVzZXJzIG1heSBwcm92aWRlIGEgZm9yY2UgZGlmZmVyZW50IGZyb20gZ2xvYmFsIGdyYXZpdHkgdG8gdXNlIHdoZW4gY29tcHV0aW5nIGNvbnRhY3QgZnJpY3Rpb24uCiAgICAgICAgY29uc3QgbXVnID0gZnJpY3Rpb24gKiAod29ybGQuZnJpY3Rpb25HcmF2aXR5IHx8IHdvcmxkLmdyYXZpdHkpLmxlbmd0aCgpOwogICAgICAgIGxldCByZWR1Y2VkTWFzcyA9IGJvZHlBLmludk1hc3MgKyBib2R5Qi5pbnZNYXNzOwoKICAgICAgICBpZiAocmVkdWNlZE1hc3MgPiAwKSB7CiAgICAgICAgICByZWR1Y2VkTWFzcyA9IDEgLyByZWR1Y2VkTWFzczsKICAgICAgICB9CgogICAgICAgIGNvbnN0IHBvb2wgPSB0aGlzLmZyaWN0aW9uRXF1YXRpb25Qb29sOwogICAgICAgIGNvbnN0IGMxID0gcG9vbC5sZW5ndGggPyBwb29sLnBvcCgpIDogbmV3IEZyaWN0aW9uRXF1YXRpb24oYm9keUEsIGJvZHlCLCBtdWcgKiByZWR1Y2VkTWFzcyk7CiAgICAgICAgY29uc3QgYzIgPSBwb29sLmxlbmd0aCA/IHBvb2wucG9wKCkgOiBuZXcgRnJpY3Rpb25FcXVhdGlvbihib2R5QSwgYm9keUIsIG11ZyAqIHJlZHVjZWRNYXNzKTsKICAgICAgICBjMS5iaSA9IGMyLmJpID0gYm9keUE7CiAgICAgICAgYzEuYmogPSBjMi5iaiA9IGJvZHlCOwogICAgICAgIGMxLm1pbkZvcmNlID0gYzIubWluRm9yY2UgPSAtbXVnICogcmVkdWNlZE1hc3M7CiAgICAgICAgYzEubWF4Rm9yY2UgPSBjMi5tYXhGb3JjZSA9IG11ZyAqIHJlZHVjZWRNYXNzOyAvLyBDb3B5IG92ZXIgdGhlIHJlbGF0aXZlIHZlY3RvcnMKCiAgICAgICAgYzEucmkuY29weShjb250YWN0RXF1YXRpb24ucmkpOwogICAgICAgIGMxLnJqLmNvcHkoY29udGFjdEVxdWF0aW9uLnJqKTsKICAgICAgICBjMi5yaS5jb3B5KGNvbnRhY3RFcXVhdGlvbi5yaSk7CiAgICAgICAgYzIucmouY29weShjb250YWN0RXF1YXRpb24ucmopOyAvLyBDb25zdHJ1Y3QgdGFuZ2VudHMKCiAgICAgICAgY29udGFjdEVxdWF0aW9uLm5pLnRhbmdlbnRzKGMxLnQsIGMyLnQpOyAvLyBTZXQgc3Bvb2sgcGFyYW1zCgogICAgICAgIGMxLnNldFNwb29rUGFyYW1zKGNtLmZyaWN0aW9uRXF1YXRpb25TdGlmZm5lc3MsIGNtLmZyaWN0aW9uRXF1YXRpb25SZWxheGF0aW9uLCB3b3JsZC5kdCk7CiAgICAgICAgYzIuc2V0U3Bvb2tQYXJhbXMoY20uZnJpY3Rpb25FcXVhdGlvblN0aWZmbmVzcywgY20uZnJpY3Rpb25FcXVhdGlvblJlbGF4YXRpb24sIHdvcmxkLmR0KTsKICAgICAgICBjMS5lbmFibGVkID0gYzIuZW5hYmxlZCA9IGNvbnRhY3RFcXVhdGlvbi5lbmFibGVkOwogICAgICAgIG91dEFycmF5LnB1c2goYzEsIGMyKTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgfQoKICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQogICAgLyoqCiAgICAgKiBUYWtlIHRoZSBhdmVyYWdlIE4gbGF0ZXN0IGNvbnRhY3QgcG9pbnQgb24gdGhlIHBsYW5lLgogICAgICovCgoKICAgIGNyZWF0ZUZyaWN0aW9uRnJvbUF2ZXJhZ2UobnVtQ29udGFjdHMpIHsKICAgICAgLy8gVGhlIGxhc3QgY29udGFjdEVxdWF0aW9uCiAgICAgIGxldCBjID0gdGhpcy5yZXN1bHRbdGhpcy5yZXN1bHQubGVuZ3RoIC0gMV07IC8vIENyZWF0ZSB0aGUgcmVzdWx0OiB0d28gImF2ZXJhZ2UiIGZyaWN0aW9uIGVxdWF0aW9ucwoKICAgICAgaWYgKCF0aGlzLmNyZWF0ZUZyaWN0aW9uRXF1YXRpb25zRnJvbUNvbnRhY3QoYywgdGhpcy5mcmljdGlvblJlc3VsdCkgfHwgbnVtQ29udGFjdHMgPT09IDEpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGNvbnN0IGYxID0gdGhpcy5mcmljdGlvblJlc3VsdFt0aGlzLmZyaWN0aW9uUmVzdWx0Lmxlbmd0aCAtIDJdOwogICAgICBjb25zdCBmMiA9IHRoaXMuZnJpY3Rpb25SZXN1bHRbdGhpcy5mcmljdGlvblJlc3VsdC5sZW5ndGggLSAxXTsKICAgICAgYXZlcmFnZU5vcm1hbC5zZXRaZXJvKCk7CiAgICAgIGF2ZXJhZ2VDb250YWN0UG9pbnRBLnNldFplcm8oKTsKICAgICAgYXZlcmFnZUNvbnRhY3RQb2ludEIuc2V0WmVybygpOwogICAgICBjb25zdCBib2R5QSA9IGMuYmk7CiAgICAgIGMuYmo7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gbnVtQ29udGFjdHM7IGkrKykgewogICAgICAgIGMgPSB0aGlzLnJlc3VsdFt0aGlzLnJlc3VsdC5sZW5ndGggLSAxIC0gaV07CgogICAgICAgIGlmIChjLmJpICE9PSBib2R5QSkgewogICAgICAgICAgYXZlcmFnZU5vcm1hbC52YWRkKGMubmksIGF2ZXJhZ2VOb3JtYWwpOwogICAgICAgICAgYXZlcmFnZUNvbnRhY3RQb2ludEEudmFkZChjLnJpLCBhdmVyYWdlQ29udGFjdFBvaW50QSk7CiAgICAgICAgICBhdmVyYWdlQ29udGFjdFBvaW50Qi52YWRkKGMucmosIGF2ZXJhZ2VDb250YWN0UG9pbnRCKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgYXZlcmFnZU5vcm1hbC52c3ViKGMubmksIGF2ZXJhZ2VOb3JtYWwpOwogICAgICAgICAgYXZlcmFnZUNvbnRhY3RQb2ludEEudmFkZChjLnJqLCBhdmVyYWdlQ29udGFjdFBvaW50QSk7CiAgICAgICAgICBhdmVyYWdlQ29udGFjdFBvaW50Qi52YWRkKGMucmksIGF2ZXJhZ2VDb250YWN0UG9pbnRCKTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIGNvbnN0IGludk51bUNvbnRhY3RzID0gMSAvIG51bUNvbnRhY3RzOwogICAgICBhdmVyYWdlQ29udGFjdFBvaW50QS5zY2FsZShpbnZOdW1Db250YWN0cywgZjEucmkpOwogICAgICBhdmVyYWdlQ29udGFjdFBvaW50Qi5zY2FsZShpbnZOdW1Db250YWN0cywgZjEucmopOwogICAgICBmMi5yaS5jb3B5KGYxLnJpKTsgLy8gU2hvdWxkIGJlIHRoZSBzYW1lCgogICAgICBmMi5yai5jb3B5KGYxLnJqKTsKICAgICAgYXZlcmFnZU5vcm1hbC5ub3JtYWxpemUoKTsKICAgICAgYXZlcmFnZU5vcm1hbC50YW5nZW50cyhmMS50LCBmMi50KTsgLy8gcmV0dXJuIGVxOwogICAgfQogICAgLyoqCiAgICAgKiBHZW5lcmF0ZSBhbGwgY29udGFjdHMgYmV0d2VlbiBhIGxpc3Qgb2YgYm9keSBwYWlycwogICAgICogQHBhcmFtIHAxIEFycmF5IG9mIGJvZHkgaW5kaWNlcwogICAgICogQHBhcmFtIHAyIEFycmF5IG9mIGJvZHkgaW5kaWNlcwogICAgICogQHBhcmFtIHJlc3VsdCBBcnJheSB0byBzdG9yZSBnZW5lcmF0ZWQgY29udGFjdHMKICAgICAqIEBwYXJhbSBvbGRjb250YWN0cyBPcHRpb25hbC4gQXJyYXkgb2YgcmV1c2FibGUgY29udGFjdCBvYmplY3RzCiAgICAgKi8KCgogICAgZ2V0Q29udGFjdHMocDEsIHAyLCB3b3JsZCwgcmVzdWx0LCBvbGRjb250YWN0cywgZnJpY3Rpb25SZXN1bHQsIGZyaWN0aW9uUG9vbCkgewogICAgICAvLyBTYXZlIG9sZCBjb250YWN0IG9iamVjdHMKICAgICAgdGhpcy5jb250YWN0UG9pbnRQb29sID0gb2xkY29udGFjdHM7CiAgICAgIHRoaXMuZnJpY3Rpb25FcXVhdGlvblBvb2wgPSBmcmljdGlvblBvb2w7CiAgICAgIHRoaXMucmVzdWx0ID0gcmVzdWx0OwogICAgICB0aGlzLmZyaWN0aW9uUmVzdWx0ID0gZnJpY3Rpb25SZXN1bHQ7CiAgICAgIGNvbnN0IHFpID0gdG1wUXVhdDE7CiAgICAgIGNvbnN0IHFqID0gdG1wUXVhdDI7CiAgICAgIGNvbnN0IHhpID0gdG1wVmVjMTsKICAgICAgY29uc3QgeGogPSB0bXBWZWMyOwoKICAgICAgZm9yIChsZXQgayA9IDAsIE4gPSBwMS5sZW5ndGg7IGsgIT09IE47IGsrKykgewogICAgICAgIC8vIEdldCBjdXJyZW50IGNvbGxpc2lvbiBib2RpZXMKICAgICAgICBjb25zdCBiaSA9IHAxW2tdOwogICAgICAgIGNvbnN0IGJqID0gcDJba107IC8vIEdldCBjb250YWN0IG1hdGVyaWFsCgogICAgICAgIGxldCBib2R5Q29udGFjdE1hdGVyaWFsID0gbnVsbDsKCiAgICAgICAgaWYgKGJpLm1hdGVyaWFsICYmIGJqLm1hdGVyaWFsKSB7CiAgICAgICAgICBib2R5Q29udGFjdE1hdGVyaWFsID0gd29ybGQuZ2V0Q29udGFjdE1hdGVyaWFsKGJpLm1hdGVyaWFsLCBiai5tYXRlcmlhbCkgfHwgbnVsbDsKICAgICAgICB9CgogICAgICAgIGNvbnN0IGp1c3RUZXN0ID0gYmkudHlwZSAmIEJvZHkuS0lORU1BVElDICYmIGJqLnR5cGUgJiBCb2R5LlNUQVRJQyB8fCBiaS50eXBlICYgQm9keS5TVEFUSUMgJiYgYmoudHlwZSAmIEJvZHkuS0lORU1BVElDIHx8IGJpLnR5cGUgJiBCb2R5LktJTkVNQVRJQyAmJiBiai50eXBlICYgQm9keS5LSU5FTUFUSUM7CgogICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgYmkuc2hhcGVzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICBiaS5xdWF0ZXJuaW9uLm11bHQoYmkuc2hhcGVPcmllbnRhdGlvbnNbaV0sIHFpKTsKICAgICAgICAgIGJpLnF1YXRlcm5pb24udm11bHQoYmkuc2hhcGVPZmZzZXRzW2ldLCB4aSk7CiAgICAgICAgICB4aS52YWRkKGJpLnBvc2l0aW9uLCB4aSk7CiAgICAgICAgICBjb25zdCBzaSA9IGJpLnNoYXBlc1tpXTsKCiAgICAgICAgICBmb3IgKGxldCBqID0gMDsgaiA8IGJqLnNoYXBlcy5sZW5ndGg7IGorKykgewogICAgICAgICAgICAvLyBDb21wdXRlIHdvcmxkIHRyYW5zZm9ybSBvZiBzaGFwZXMKICAgICAgICAgICAgYmoucXVhdGVybmlvbi5tdWx0KGJqLnNoYXBlT3JpZW50YXRpb25zW2pdLCBxaik7CiAgICAgICAgICAgIGJqLnF1YXRlcm5pb24udm11bHQoYmouc2hhcGVPZmZzZXRzW2pdLCB4aik7CiAgICAgICAgICAgIHhqLnZhZGQoYmoucG9zaXRpb24sIHhqKTsKICAgICAgICAgICAgY29uc3Qgc2ogPSBiai5zaGFwZXNbal07CgogICAgICAgICAgICBpZiAoIShzaS5jb2xsaXNpb25GaWx0ZXJNYXNrICYgc2ouY29sbGlzaW9uRmlsdGVyR3JvdXAgJiYgc2ouY29sbGlzaW9uRmlsdGVyTWFzayAmIHNpLmNvbGxpc2lvbkZpbHRlckdyb3VwKSkgewogICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoeGkuZGlzdGFuY2VUbyh4aikgPiBzaS5ib3VuZGluZ1NwaGVyZVJhZGl1cyArIHNqLmJvdW5kaW5nU3BoZXJlUmFkaXVzKSB7CiAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgIH0gLy8gR2V0IGNvbGxpc2lvbiBtYXRlcmlhbAoKCiAgICAgICAgICAgIGxldCBzaGFwZUNvbnRhY3RNYXRlcmlhbCA9IG51bGw7CgogICAgICAgICAgICBpZiAoc2kubWF0ZXJpYWwgJiYgc2oubWF0ZXJpYWwpIHsKICAgICAgICAgICAgICBzaGFwZUNvbnRhY3RNYXRlcmlhbCA9IHdvcmxkLmdldENvbnRhY3RNYXRlcmlhbChzaS5tYXRlcmlhbCwgc2oubWF0ZXJpYWwpIHx8IG51bGw7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHRoaXMuY3VycmVudENvbnRhY3RNYXRlcmlhbCA9IHNoYXBlQ29udGFjdE1hdGVyaWFsIHx8IGJvZHlDb250YWN0TWF0ZXJpYWwgfHwgd29ybGQuZGVmYXVsdENvbnRhY3RNYXRlcmlhbDsgLy8gR2V0IGNvbnRhY3RzCgogICAgICAgICAgICBjb25zdCByZXNvbHZlckluZGV4ID0gc2kudHlwZSB8IHNqLnR5cGU7CiAgICAgICAgICAgIGNvbnN0IHJlc29sdmVyID0gdGhpc1tyZXNvbHZlckluZGV4XTsKCiAgICAgICAgICAgIGlmIChyZXNvbHZlcikgewogICAgICAgICAgICAgIGxldCByZXR2YWwgPSBmYWxzZTsgLy8gVE8gRE86IGludmVzdGlnYXRlIHdoeSBzcGhlcmVQYXJ0aWNsZSBhbmQgY29udmV4UGFydGljbGUKICAgICAgICAgICAgICAvLyByZXNvbHZlcnMgZXhwZWN0IHNpIGFuZCBzaiBzaGFwZXMgdG8gYmUgaW4gcmV2ZXJzZSBvcmRlcgogICAgICAgICAgICAgIC8vIChpLmUuIGxhcmdlciBpbnRlZ2VyIHZhbHVlIHR5cGUgZmlyc3QgaW5zdGVhZCBvZiBzbWFsbGVyIGZpcnN0KQoKICAgICAgICAgICAgICBpZiAoc2kudHlwZSA8IHNqLnR5cGUpIHsKICAgICAgICAgICAgICAgIHJldHZhbCA9IHJlc29sdmVyLmNhbGwodGhpcywgc2ksIHNqLCB4aSwgeGosIHFpLCBxaiwgYmksIGJqLCBzaSwgc2osIGp1c3RUZXN0KTsKICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgcmV0dmFsID0gcmVzb2x2ZXIuY2FsbCh0aGlzLCBzaiwgc2ksIHhqLCB4aSwgcWosIHFpLCBiaiwgYmksIHNpLCBzaiwganVzdFRlc3QpOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgaWYgKHJldHZhbCAmJiBqdXN0VGVzdCkgewogICAgICAgICAgICAgICAgLy8gUmVnaXN0ZXIgb3ZlcmxhcAogICAgICAgICAgICAgICAgd29ybGQuc2hhcGVPdmVybGFwS2VlcGVyLnNldChzaS5pZCwgc2ouaWQpOwogICAgICAgICAgICAgICAgd29ybGQuYm9keU92ZXJsYXBLZWVwZXIuc2V0KGJpLmlkLCBiai5pZCk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICB9CgogICAgc3BoZXJlU3BoZXJlKHNpLCBzaiwgeGksIHhqLCBxaSwgcWosIGJpLCBiaiwgcnNpLCByc2osIGp1c3RUZXN0KSB7CiAgICAgIGlmIChqdXN0VGVzdCkgewogICAgICAgIHJldHVybiB4aS5kaXN0YW5jZVNxdWFyZWQoeGopIDwgKHNpLnJhZGl1cyArIHNqLnJhZGl1cykgKiogMjsKICAgICAgfSAvLyBXZSB3aWxsIGhhdmUgb25seSBvbmUgY29udGFjdCBpbiB0aGlzIGNhc2UKCgogICAgICBjb25zdCBjb250YWN0RXEgPSB0aGlzLmNyZWF0ZUNvbnRhY3RFcXVhdGlvbihiaSwgYmosIHNpLCBzaiwgcnNpLCByc2opOyAvLyBDb250YWN0IG5vcm1hbAoKICAgICAgeGoudnN1Yih4aSwgY29udGFjdEVxLm5pKTsKICAgICAgY29udGFjdEVxLm5pLm5vcm1hbGl6ZSgpOyAvLyBDb250YWN0IHBvaW50IGxvY2F0aW9ucwoKICAgICAgY29udGFjdEVxLnJpLmNvcHkoY29udGFjdEVxLm5pKTsKICAgICAgY29udGFjdEVxLnJqLmNvcHkoY29udGFjdEVxLm5pKTsKICAgICAgY29udGFjdEVxLnJpLnNjYWxlKHNpLnJhZGl1cywgY29udGFjdEVxLnJpKTsKICAgICAgY29udGFjdEVxLnJqLnNjYWxlKC1zai5yYWRpdXMsIGNvbnRhY3RFcS5yaik7CiAgICAgIGNvbnRhY3RFcS5yaS52YWRkKHhpLCBjb250YWN0RXEucmkpOwogICAgICBjb250YWN0RXEucmkudnN1YihiaS5wb3NpdGlvbiwgY29udGFjdEVxLnJpKTsKICAgICAgY29udGFjdEVxLnJqLnZhZGQoeGosIGNvbnRhY3RFcS5yaik7CiAgICAgIGNvbnRhY3RFcS5yai52c3ViKGJqLnBvc2l0aW9uLCBjb250YWN0RXEucmopOwogICAgICB0aGlzLnJlc3VsdC5wdXNoKGNvbnRhY3RFcSk7CiAgICAgIHRoaXMuY3JlYXRlRnJpY3Rpb25FcXVhdGlvbnNGcm9tQ29udGFjdChjb250YWN0RXEsIHRoaXMuZnJpY3Rpb25SZXN1bHQpOwogICAgfQoKICAgIHNwaGVyZVBsYW5lKHNpLCBzaiwgeGksIHhqLCBxaSwgcWosIGJpLCBiaiwgcnNpLCByc2osIGp1c3RUZXN0KSB7CiAgICAgIC8vIFdlIHdpbGwgaGF2ZSBvbmUgY29udGFjdCBpbiB0aGlzIGNhc2UKICAgICAgY29uc3QgciA9IHRoaXMuY3JlYXRlQ29udGFjdEVxdWF0aW9uKGJpLCBiaiwgc2ksIHNqLCByc2ksIHJzaik7IC8vIENvbnRhY3Qgbm9ybWFsCgogICAgICByLm5pLnNldCgwLCAwLCAxKTsKICAgICAgcWoudm11bHQoci5uaSwgci5uaSk7CiAgICAgIHIubmkubmVnYXRlKHIubmkpOyAvLyBib2R5IGkgaXMgdGhlIHNwaGVyZSwgZmxpcCBub3JtYWwKCiAgICAgIHIubmkubm9ybWFsaXplKCk7IC8vIE5lZWRlZD8KICAgICAgLy8gVmVjdG9yIGZyb20gc3BoZXJlIGNlbnRlciB0byBjb250YWN0IHBvaW50CgogICAgICByLm5pLnNjYWxlKHNpLnJhZGl1cywgci5yaSk7IC8vIFByb2plY3QgZG93biBzcGhlcmUgb24gcGxhbmUKCiAgICAgIHhpLnZzdWIoeGosIHBvaW50X29uX3BsYW5lX3RvX3NwaGVyZSk7CiAgICAgIHIubmkuc2NhbGUoci5uaS5kb3QocG9pbnRfb25fcGxhbmVfdG9fc3BoZXJlKSwgcGxhbmVfdG9fc3BoZXJlX29ydGhvKTsKICAgICAgcG9pbnRfb25fcGxhbmVfdG9fc3BoZXJlLnZzdWIocGxhbmVfdG9fc3BoZXJlX29ydGhvLCByLnJqKTsgLy8gVGhlIHNwaGVyZSBwb3NpdGlvbiBwcm9qZWN0ZWQgdG8gcGxhbmUKCiAgICAgIGlmICgtcG9pbnRfb25fcGxhbmVfdG9fc3BoZXJlLmRvdChyLm5pKSA8PSBzaS5yYWRpdXMpIHsKICAgICAgICBpZiAoanVzdFRlc3QpIHsKICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0gLy8gTWFrZSBpdCByZWxhdGl2ZSB0byB0aGUgYm9keQoKCiAgICAgICAgY29uc3QgcmkgPSByLnJpOwogICAgICAgIGNvbnN0IHJqID0gci5yajsKICAgICAgICByaS52YWRkKHhpLCByaSk7CiAgICAgICAgcmkudnN1YihiaS5wb3NpdGlvbiwgcmkpOwogICAgICAgIHJqLnZhZGQoeGosIHJqKTsKICAgICAgICByai52c3ViKGJqLnBvc2l0aW9uLCByaik7CiAgICAgICAgdGhpcy5yZXN1bHQucHVzaChyKTsKICAgICAgICB0aGlzLmNyZWF0ZUZyaWN0aW9uRXF1YXRpb25zRnJvbUNvbnRhY3QociwgdGhpcy5mcmljdGlvblJlc3VsdCk7CiAgICAgIH0KICAgIH0KCiAgICBib3hCb3goc2ksIHNqLCB4aSwgeGosIHFpLCBxaiwgYmksIGJqLCByc2ksIHJzaiwganVzdFRlc3QpIHsKICAgICAgc2kuY29udmV4UG9seWhlZHJvblJlcHJlc2VudGF0aW9uLm1hdGVyaWFsID0gc2kubWF0ZXJpYWw7CiAgICAgIHNqLmNvbnZleFBvbHloZWRyb25SZXByZXNlbnRhdGlvbi5tYXRlcmlhbCA9IHNqLm1hdGVyaWFsOwogICAgICBzaS5jb252ZXhQb2x5aGVkcm9uUmVwcmVzZW50YXRpb24uY29sbGlzaW9uUmVzcG9uc2UgPSBzaS5jb2xsaXNpb25SZXNwb25zZTsKICAgICAgc2ouY29udmV4UG9seWhlZHJvblJlcHJlc2VudGF0aW9uLmNvbGxpc2lvblJlc3BvbnNlID0gc2ouY29sbGlzaW9uUmVzcG9uc2U7CiAgICAgIHJldHVybiB0aGlzLmNvbnZleENvbnZleChzaS5jb252ZXhQb2x5aGVkcm9uUmVwcmVzZW50YXRpb24sIHNqLmNvbnZleFBvbHloZWRyb25SZXByZXNlbnRhdGlvbiwgeGksIHhqLCBxaSwgcWosIGJpLCBiaiwgc2ksIHNqLCBqdXN0VGVzdCk7CiAgICB9CgogICAgc3BoZXJlQm94KHNpLCBzaiwgeGksIHhqLCBxaSwgcWosIGJpLCBiaiwgcnNpLCByc2osIGp1c3RUZXN0KSB7CiAgICAgIGNvbnN0IHYzcG9vbCA9IHRoaXMudjNwb29sOyAvLyB3ZSByZWZlciB0byB0aGUgYm94IGFzIGJvZHkgagoKICAgICAgY29uc3Qgc2lkZXMgPSBzcGhlcmVCb3hfc2lkZXM7CiAgICAgIHhpLnZzdWIoeGosIGJveF90b19zcGhlcmUpOwogICAgICBzai5nZXRTaWRlTm9ybWFscyhzaWRlcywgcWopOwogICAgICBjb25zdCBSID0gc2kucmFkaXVzOwoKICAgICAgbGV0IGZvdW5kID0gZmFsc2U7IC8vIFN0b3JlIHRoZSByZXN1bHRpbmcgc2lkZSBwZW5ldHJhdGlvbiBpbmZvCgogICAgICBjb25zdCBzaWRlX25zID0gc3BoZXJlQm94X3NpZGVfbnM7CiAgICAgIGNvbnN0IHNpZGVfbnMxID0gc3BoZXJlQm94X3NpZGVfbnMxOwogICAgICBjb25zdCBzaWRlX25zMiA9IHNwaGVyZUJveF9zaWRlX25zMjsKICAgICAgbGV0IHNpZGVfaCA9IG51bGw7CiAgICAgIGxldCBzaWRlX3BlbmV0cmF0aW9ucyA9IDA7CiAgICAgIGxldCBzaWRlX2RvdDEgPSAwOwogICAgICBsZXQgc2lkZV9kb3QyID0gMDsKICAgICAgbGV0IHNpZGVfZGlzdGFuY2UgPSBudWxsOwoKICAgICAgZm9yIChsZXQgaWR4ID0gMCwgbnNpZGVzID0gc2lkZXMubGVuZ3RoOyBpZHggIT09IG5zaWRlcyAmJiBmb3VuZCA9PT0gZmFsc2U7IGlkeCsrKSB7CiAgICAgICAgLy8gR2V0IHRoZSBwbGFuZSBzaWRlIG5vcm1hbCAobnMpCiAgICAgICAgY29uc3QgbnMgPSBzcGhlcmVCb3hfbnM7CiAgICAgICAgbnMuY29weShzaWRlc1tpZHhdKTsKICAgICAgICBjb25zdCBoID0gbnMubGVuZ3RoKCk7CiAgICAgICAgbnMubm9ybWFsaXplKCk7IC8vIFRoZSBub3JtYWwvZGlzdGFuY2UgZG90IHByb2R1Y3QgdGVsbHMgd2hpY2ggc2lkZSBvZiB0aGUgcGxhbmUgd2UgYXJlCgogICAgICAgIGNvbnN0IGRvdCA9IGJveF90b19zcGhlcmUuZG90KG5zKTsKCiAgICAgICAgaWYgKGRvdCA8IGggKyBSICYmIGRvdCA+IDApIHsKICAgICAgICAgIC8vIEludGVyc2VjdHMgcGxhbmUuIE5vdyBjaGVjayB0aGUgb3RoZXIgdHdvIGRpbWVuc2lvbnMKICAgICAgICAgIGNvbnN0IG5zMSA9IHNwaGVyZUJveF9uczE7CiAgICAgICAgICBjb25zdCBuczIgPSBzcGhlcmVCb3hfbnMyOwogICAgICAgICAgbnMxLmNvcHkoc2lkZXNbKGlkeCArIDEpICUgM10pOwogICAgICAgICAgbnMyLmNvcHkoc2lkZXNbKGlkeCArIDIpICUgM10pOwogICAgICAgICAgY29uc3QgaDEgPSBuczEubGVuZ3RoKCk7CiAgICAgICAgICBjb25zdCBoMiA9IG5zMi5sZW5ndGgoKTsKICAgICAgICAgIG5zMS5ub3JtYWxpemUoKTsKICAgICAgICAgIG5zMi5ub3JtYWxpemUoKTsKICAgICAgICAgIGNvbnN0IGRvdDEgPSBib3hfdG9fc3BoZXJlLmRvdChuczEpOwogICAgICAgICAgY29uc3QgZG90MiA9IGJveF90b19zcGhlcmUuZG90KG5zMik7CgogICAgICAgICAgaWYgKGRvdDEgPCBoMSAmJiBkb3QxID4gLWgxICYmIGRvdDIgPCBoMiAmJiBkb3QyID4gLWgyKSB7CiAgICAgICAgICAgIGNvbnN0IGRpc3QgPSBNYXRoLmFicyhkb3QgLSBoIC0gUik7CgogICAgICAgICAgICBpZiAoc2lkZV9kaXN0YW5jZSA9PT0gbnVsbCB8fCBkaXN0IDwgc2lkZV9kaXN0YW5jZSkgewogICAgICAgICAgICAgIHNpZGVfZGlzdGFuY2UgPSBkaXN0OwogICAgICAgICAgICAgIHNpZGVfZG90MSA9IGRvdDE7CiAgICAgICAgICAgICAgc2lkZV9kb3QyID0gZG90MjsKICAgICAgICAgICAgICBzaWRlX2ggPSBoOwogICAgICAgICAgICAgIHNpZGVfbnMuY29weShucyk7CiAgICAgICAgICAgICAgc2lkZV9uczEuY29weShuczEpOwogICAgICAgICAgICAgIHNpZGVfbnMyLmNvcHkobnMyKTsKICAgICAgICAgICAgICBzaWRlX3BlbmV0cmF0aW9ucysrOwoKICAgICAgICAgICAgICBpZiAoanVzdFRlc3QpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQoKICAgICAgaWYgKHNpZGVfcGVuZXRyYXRpb25zKSB7CiAgICAgICAgZm91bmQgPSB0cnVlOwogICAgICAgIGNvbnN0IHIgPSB0aGlzLmNyZWF0ZUNvbnRhY3RFcXVhdGlvbihiaSwgYmosIHNpLCBzaiwgcnNpLCByc2opOwogICAgICAgIHNpZGVfbnMuc2NhbGUoLVIsIHIucmkpOyAvLyBTcGhlcmUgcgoKICAgICAgICByLm5pLmNvcHkoc2lkZV9ucyk7CiAgICAgICAgci5uaS5uZWdhdGUoci5uaSk7IC8vIE5vcm1hbCBzaG91bGQgYmUgb3V0IG9mIHNwaGVyZQoKICAgICAgICBzaWRlX25zLnNjYWxlKHNpZGVfaCwgc2lkZV9ucyk7CiAgICAgICAgc2lkZV9uczEuc2NhbGUoc2lkZV9kb3QxLCBzaWRlX25zMSk7CiAgICAgICAgc2lkZV9ucy52YWRkKHNpZGVfbnMxLCBzaWRlX25zKTsKICAgICAgICBzaWRlX25zMi5zY2FsZShzaWRlX2RvdDIsIHNpZGVfbnMyKTsKICAgICAgICBzaWRlX25zLnZhZGQoc2lkZV9uczIsIHIucmopOyAvLyBNYWtlIHJlbGF0aXZlIHRvIGJvZGllcwoKICAgICAgICByLnJpLnZhZGQoeGksIHIucmkpOwogICAgICAgIHIucmkudnN1YihiaS5wb3NpdGlvbiwgci5yaSk7CiAgICAgICAgci5yai52YWRkKHhqLCByLnJqKTsKICAgICAgICByLnJqLnZzdWIoYmoucG9zaXRpb24sIHIucmopOwogICAgICAgIHRoaXMucmVzdWx0LnB1c2gocik7CiAgICAgICAgdGhpcy5jcmVhdGVGcmljdGlvbkVxdWF0aW9uc0Zyb21Db250YWN0KHIsIHRoaXMuZnJpY3Rpb25SZXN1bHQpOwogICAgICB9IC8vIENoZWNrIGNvcm5lcnMKCgogICAgICBsZXQgcmogPSB2M3Bvb2wuZ2V0KCk7CiAgICAgIGNvbnN0IHNwaGVyZV90b19jb3JuZXIgPSBzcGhlcmVCb3hfc3BoZXJlX3RvX2Nvcm5lcjsKCiAgICAgIGZvciAobGV0IGogPSAwOyBqICE9PSAyICYmICFmb3VuZDsgaisrKSB7CiAgICAgICAgZm9yIChsZXQgayA9IDA7IGsgIT09IDIgJiYgIWZvdW5kOyBrKyspIHsKICAgICAgICAgIGZvciAobGV0IGwgPSAwOyBsICE9PSAyICYmICFmb3VuZDsgbCsrKSB7CiAgICAgICAgICAgIHJqLnNldCgwLCAwLCAwKTsKCiAgICAgICAgICAgIGlmIChqKSB7CiAgICAgICAgICAgICAgcmoudmFkZChzaWRlc1swXSwgcmopOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIHJqLnZzdWIoc2lkZXNbMF0sIHJqKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKGspIHsKICAgICAgICAgICAgICByai52YWRkKHNpZGVzWzFdLCByaik7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgcmoudnN1YihzaWRlc1sxXSwgcmopOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAobCkgewogICAgICAgICAgICAgIHJqLnZhZGQoc2lkZXNbMl0sIHJqKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICByai52c3ViKHNpZGVzWzJdLCByaik7CiAgICAgICAgICAgIH0gLy8gV29ybGQgcG9zaXRpb24gb2YgY29ybmVyCgoKICAgICAgICAgICAgeGoudmFkZChyaiwgc3BoZXJlX3RvX2Nvcm5lcik7CiAgICAgICAgICAgIHNwaGVyZV90b19jb3JuZXIudnN1Yih4aSwgc3BoZXJlX3RvX2Nvcm5lcik7CgogICAgICAgICAgICBpZiAoc3BoZXJlX3RvX2Nvcm5lci5sZW5ndGhTcXVhcmVkKCkgPCBSICogUikgewogICAgICAgICAgICAgIGlmIChqdXN0VGVzdCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBmb3VuZCA9IHRydWU7CiAgICAgICAgICAgICAgY29uc3QgciA9IHRoaXMuY3JlYXRlQ29udGFjdEVxdWF0aW9uKGJpLCBiaiwgc2ksIHNqLCByc2ksIHJzaik7CiAgICAgICAgICAgICAgci5yaS5jb3B5KHNwaGVyZV90b19jb3JuZXIpOwogICAgICAgICAgICAgIHIucmkubm9ybWFsaXplKCk7CiAgICAgICAgICAgICAgci5uaS5jb3B5KHIucmkpOwogICAgICAgICAgICAgIHIucmkuc2NhbGUoUiwgci5yaSk7CiAgICAgICAgICAgICAgci5yai5jb3B5KHJqKTsgLy8gTWFrZSByZWxhdGl2ZSB0byBib2RpZXMKCiAgICAgICAgICAgICAgci5yaS52YWRkKHhpLCByLnJpKTsKICAgICAgICAgICAgICByLnJpLnZzdWIoYmkucG9zaXRpb24sIHIucmkpOwogICAgICAgICAgICAgIHIucmoudmFkZCh4aiwgci5yaik7CiAgICAgICAgICAgICAgci5yai52c3ViKGJqLnBvc2l0aW9uLCByLnJqKTsKICAgICAgICAgICAgICB0aGlzLnJlc3VsdC5wdXNoKHIpOwogICAgICAgICAgICAgIHRoaXMuY3JlYXRlRnJpY3Rpb25FcXVhdGlvbnNGcm9tQ29udGFjdChyLCB0aGlzLmZyaWN0aW9uUmVzdWx0KTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQoKICAgICAgdjNwb29sLnJlbGVhc2UocmopOwogICAgICByaiA9IG51bGw7IC8vIENoZWNrIGVkZ2VzCgogICAgICBjb25zdCBlZGdlVGFuZ2VudCA9IHYzcG9vbC5nZXQoKTsKICAgICAgY29uc3QgZWRnZUNlbnRlciA9IHYzcG9vbC5nZXQoKTsKICAgICAgY29uc3QgciA9IHYzcG9vbC5nZXQoKTsgLy8gciA9IGVkZ2UgY2VudGVyIHRvIHNwaGVyZSBjZW50ZXIKCiAgICAgIGNvbnN0IG9ydGhvZ29uYWwgPSB2M3Bvb2wuZ2V0KCk7CiAgICAgIGNvbnN0IGRpc3QgPSB2M3Bvb2wuZ2V0KCk7CiAgICAgIGNvbnN0IE5zaWRlcyA9IHNpZGVzLmxlbmd0aDsKCiAgICAgIGZvciAobGV0IGogPSAwOyBqICE9PSBOc2lkZXMgJiYgIWZvdW5kOyBqKyspIHsKICAgICAgICBmb3IgKGxldCBrID0gMDsgayAhPT0gTnNpZGVzICYmICFmb3VuZDsgaysrKSB7CiAgICAgICAgICBpZiAoaiAlIDMgIT09IGsgJSAzKSB7CiAgICAgICAgICAgIC8vIEdldCBlZGdlIHRhbmdlbnQKICAgICAgICAgICAgc2lkZXNba10uY3Jvc3Moc2lkZXNbal0sIGVkZ2VUYW5nZW50KTsKICAgICAgICAgICAgZWRnZVRhbmdlbnQubm9ybWFsaXplKCk7CiAgICAgICAgICAgIHNpZGVzW2pdLnZhZGQoc2lkZXNba10sIGVkZ2VDZW50ZXIpOwogICAgICAgICAgICByLmNvcHkoeGkpOwogICAgICAgICAgICByLnZzdWIoZWRnZUNlbnRlciwgcik7CiAgICAgICAgICAgIHIudnN1Yih4aiwgcik7CiAgICAgICAgICAgIGNvbnN0IG9ydGhvbm9ybSA9IHIuZG90KGVkZ2VUYW5nZW50KTsgLy8gZGlzdGFuY2UgZnJvbSBlZGdlIGNlbnRlciB0byBzcGhlcmUgY2VudGVyIGluIHRoZSB0YW5nZW50IGRpcmVjdGlvbgoKICAgICAgICAgICAgZWRnZVRhbmdlbnQuc2NhbGUob3J0aG9ub3JtLCBvcnRob2dvbmFsKTsgLy8gVmVjdG9yIGZyb20gZWRnZSBjZW50ZXIgdG8gc3BoZXJlIGNlbnRlciBpbiB0aGUgdGFuZ2VudCBkaXJlY3Rpb24KICAgICAgICAgICAgLy8gRmluZCB0aGUgdGhpcmQgc2lkZSBvcnRob2dvbmFsIHRvIHRoaXMgb25lCgogICAgICAgICAgICBsZXQgbCA9IDA7CgogICAgICAgICAgICB3aGlsZSAobCA9PT0gaiAlIDMgfHwgbCA9PT0gayAlIDMpIHsKICAgICAgICAgICAgICBsKys7CiAgICAgICAgICAgIH0gLy8gdmVjIGZyb20gZWRnZSBjZW50ZXIgdG8gc3BoZXJlIHByb2plY3RlZCB0byB0aGUgcGxhbmUgb3J0aG9nb25hbCB0byB0aGUgZWRnZSB0YW5nZW50CgoKICAgICAgICAgICAgZGlzdC5jb3B5KHhpKTsKICAgICAgICAgICAgZGlzdC52c3ViKG9ydGhvZ29uYWwsIGRpc3QpOwogICAgICAgICAgICBkaXN0LnZzdWIoZWRnZUNlbnRlciwgZGlzdCk7CiAgICAgICAgICAgIGRpc3QudnN1Yih4aiwgZGlzdCk7IC8vIERpc3RhbmNlcyBpbiB0YW5nZW50IGRpcmVjdGlvbiBhbmQgZGlzdGFuY2UgaW4gdGhlIHBsYW5lIG9ydGhvZ29uYWwgdG8gaXQKCiAgICAgICAgICAgIGNvbnN0IHRkaXN0ID0gTWF0aC5hYnMob3J0aG9ub3JtKTsKICAgICAgICAgICAgY29uc3QgbmRpc3QgPSBkaXN0Lmxlbmd0aCgpOwoKICAgICAgICAgICAgaWYgKHRkaXN0IDwgc2lkZXNbbF0ubGVuZ3RoKCkgJiYgbmRpc3QgPCBSKSB7CiAgICAgICAgICAgICAgaWYgKGp1c3RUZXN0KSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIGZvdW5kID0gdHJ1ZTsKICAgICAgICAgICAgICBjb25zdCByZXMgPSB0aGlzLmNyZWF0ZUNvbnRhY3RFcXVhdGlvbihiaSwgYmosIHNpLCBzaiwgcnNpLCByc2opOwogICAgICAgICAgICAgIGVkZ2VDZW50ZXIudmFkZChvcnRob2dvbmFsLCByZXMucmopOyAvLyBib3ggcmoKCiAgICAgICAgICAgICAgcmVzLnJqLmNvcHkocmVzLnJqKTsKICAgICAgICAgICAgICBkaXN0Lm5lZ2F0ZShyZXMubmkpOwogICAgICAgICAgICAgIHJlcy5uaS5ub3JtYWxpemUoKTsKICAgICAgICAgICAgICByZXMucmkuY29weShyZXMucmopOwogICAgICAgICAgICAgIHJlcy5yaS52YWRkKHhqLCByZXMucmkpOwogICAgICAgICAgICAgIHJlcy5yaS52c3ViKHhpLCByZXMucmkpOwogICAgICAgICAgICAgIHJlcy5yaS5ub3JtYWxpemUoKTsKICAgICAgICAgICAgICByZXMucmkuc2NhbGUoUiwgcmVzLnJpKTsgLy8gTWFrZSByZWxhdGl2ZSB0byBib2RpZXMKCiAgICAgICAgICAgICAgcmVzLnJpLnZhZGQoeGksIHJlcy5yaSk7CiAgICAgICAgICAgICAgcmVzLnJpLnZzdWIoYmkucG9zaXRpb24sIHJlcy5yaSk7CiAgICAgICAgICAgICAgcmVzLnJqLnZhZGQoeGosIHJlcy5yaik7CiAgICAgICAgICAgICAgcmVzLnJqLnZzdWIoYmoucG9zaXRpb24sIHJlcy5yaik7CiAgICAgICAgICAgICAgdGhpcy5yZXN1bHQucHVzaChyZXMpOwogICAgICAgICAgICAgIHRoaXMuY3JlYXRlRnJpY3Rpb25FcXVhdGlvbnNGcm9tQ29udGFjdChyZXMsIHRoaXMuZnJpY3Rpb25SZXN1bHQpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CgogICAgICB2M3Bvb2wucmVsZWFzZShlZGdlVGFuZ2VudCwgZWRnZUNlbnRlciwgciwgb3J0aG9nb25hbCwgZGlzdCk7CiAgICB9CgogICAgcGxhbmVCb3goc2ksIHNqLCB4aSwgeGosIHFpLCBxaiwgYmksIGJqLCByc2ksIHJzaiwganVzdFRlc3QpIHsKICAgICAgc2ouY29udmV4UG9seWhlZHJvblJlcHJlc2VudGF0aW9uLm1hdGVyaWFsID0gc2oubWF0ZXJpYWw7CiAgICAgIHNqLmNvbnZleFBvbHloZWRyb25SZXByZXNlbnRhdGlvbi5jb2xsaXNpb25SZXNwb25zZSA9IHNqLmNvbGxpc2lvblJlc3BvbnNlOwogICAgICBzai5jb252ZXhQb2x5aGVkcm9uUmVwcmVzZW50YXRpb24uaWQgPSBzai5pZDsKICAgICAgcmV0dXJuIHRoaXMucGxhbmVDb252ZXgoc2ksIHNqLmNvbnZleFBvbHloZWRyb25SZXByZXNlbnRhdGlvbiwgeGksIHhqLCBxaSwgcWosIGJpLCBiaiwgc2ksIHNqLCBqdXN0VGVzdCk7CiAgICB9CgogICAgY29udmV4Q29udmV4KHNpLCBzaiwgeGksIHhqLCBxaSwgcWosIGJpLCBiaiwgcnNpLCByc2osIGp1c3RUZXN0LCBmYWNlTGlzdEEsIGZhY2VMaXN0QikgewogICAgICBjb25zdCBzZXBBeGlzID0gY29udmV4Q29udmV4X3NlcEF4aXM7CgogICAgICBpZiAoeGkuZGlzdGFuY2VUbyh4aikgPiBzaS5ib3VuZGluZ1NwaGVyZVJhZGl1cyArIHNqLmJvdW5kaW5nU3BoZXJlUmFkaXVzKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICBpZiAoc2kuZmluZFNlcGFyYXRpbmdBeGlzKHNqLCB4aSwgcWksIHhqLCBxaiwgc2VwQXhpcywgZmFjZUxpc3RBLCBmYWNlTGlzdEIpKSB7CiAgICAgICAgY29uc3QgcmVzID0gW107CiAgICAgICAgY29uc3QgcSA9IGNvbnZleENvbnZleF9xOwogICAgICAgIHNpLmNsaXBBZ2FpbnN0SHVsbCh4aSwgcWksIHNqLCB4aiwgcWosIHNlcEF4aXMsIC0xMDAsIDEwMCwgcmVzKTsKICAgICAgICBsZXQgbnVtQ29udGFjdHMgPSAwOwoKICAgICAgICBmb3IgKGxldCBqID0gMDsgaiAhPT0gcmVzLmxlbmd0aDsgaisrKSB7CiAgICAgICAgICBpZiAoanVzdFRlc3QpIHsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICB9CgogICAgICAgICAgY29uc3QgciA9IHRoaXMuY3JlYXRlQ29udGFjdEVxdWF0aW9uKGJpLCBiaiwgc2ksIHNqLCByc2ksIHJzaik7CiAgICAgICAgICBjb25zdCByaSA9IHIucmk7CiAgICAgICAgICBjb25zdCByaiA9IHIucmo7CiAgICAgICAgICBzZXBBeGlzLm5lZ2F0ZShyLm5pKTsKICAgICAgICAgIHJlc1tqXS5ub3JtYWwubmVnYXRlKHEpOwogICAgICAgICAgcS5zY2FsZShyZXNbal0uZGVwdGgsIHEpOwogICAgICAgICAgcmVzW2pdLnBvaW50LnZhZGQocSwgcmkpOwogICAgICAgICAgcmouY29weShyZXNbal0ucG9pbnQpOyAvLyBDb250YWN0IHBvaW50cyBhcmUgaW4gd29ybGQgY29vcmRpbmF0ZXMuIFRyYW5zZm9ybSBiYWNrIHRvIHJlbGF0aXZlCgogICAgICAgICAgcmkudnN1Yih4aSwgcmkpOwogICAgICAgICAgcmoudnN1Yih4aiwgcmopOyAvLyBNYWtlIHJlbGF0aXZlIHRvIGJvZGllcwoKICAgICAgICAgIHJpLnZhZGQoeGksIHJpKTsKICAgICAgICAgIHJpLnZzdWIoYmkucG9zaXRpb24sIHJpKTsKICAgICAgICAgIHJqLnZhZGQoeGosIHJqKTsKICAgICAgICAgIHJqLnZzdWIoYmoucG9zaXRpb24sIHJqKTsKICAgICAgICAgIHRoaXMucmVzdWx0LnB1c2gocik7CiAgICAgICAgICBudW1Db250YWN0cysrOwoKICAgICAgICAgIGlmICghdGhpcy5lbmFibGVGcmljdGlvblJlZHVjdGlvbikgewogICAgICAgICAgICB0aGlzLmNyZWF0ZUZyaWN0aW9uRXF1YXRpb25zRnJvbUNvbnRhY3QociwgdGhpcy5mcmljdGlvblJlc3VsdCk7CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBpZiAodGhpcy5lbmFibGVGcmljdGlvblJlZHVjdGlvbiAmJiBudW1Db250YWN0cykgewogICAgICAgICAgdGhpcy5jcmVhdGVGcmljdGlvbkZyb21BdmVyYWdlKG51bUNvbnRhY3RzKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KCiAgICBzcGhlcmVDb252ZXgoc2ksIHNqLCB4aSwgeGosIHFpLCBxaiwgYmksIGJqLCByc2ksIHJzaiwganVzdFRlc3QpIHsKICAgICAgY29uc3QgdjNwb29sID0gdGhpcy52M3Bvb2w7CiAgICAgIHhpLnZzdWIoeGosIGNvbnZleF90b19zcGhlcmUpOwogICAgICBjb25zdCBub3JtYWxzID0gc2ouZmFjZU5vcm1hbHM7CiAgICAgIGNvbnN0IGZhY2VzID0gc2ouZmFjZXM7CiAgICAgIGNvbnN0IHZlcnRzID0gc2oudmVydGljZXM7CiAgICAgIGNvbnN0IFIgPSBzaS5yYWRpdXM7CiAgICAgIC8vICAgICByZXR1cm47CiAgICAgIC8vIH0KCiAgICAgIGxldCBmb3VuZCA9IGZhbHNlOyAvLyBDaGVjayBjb3JuZXJzCgogICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gdmVydHMubGVuZ3RoOyBpKyspIHsKICAgICAgICBjb25zdCB2ID0gdmVydHNbaV07IC8vIFdvcmxkIHBvc2l0aW9uIG9mIGNvcm5lcgoKICAgICAgICBjb25zdCB3b3JsZENvcm5lciA9IHNwaGVyZUNvbnZleF93b3JsZENvcm5lcjsKICAgICAgICBxai52bXVsdCh2LCB3b3JsZENvcm5lcik7CiAgICAgICAgeGoudmFkZCh3b3JsZENvcm5lciwgd29ybGRDb3JuZXIpOwogICAgICAgIGNvbnN0IHNwaGVyZV90b19jb3JuZXIgPSBzcGhlcmVDb252ZXhfc3BoZXJlVG9Db3JuZXI7CiAgICAgICAgd29ybGRDb3JuZXIudnN1Yih4aSwgc3BoZXJlX3RvX2Nvcm5lcik7CgogICAgICAgIGlmIChzcGhlcmVfdG9fY29ybmVyLmxlbmd0aFNxdWFyZWQoKSA8IFIgKiBSKSB7CiAgICAgICAgICBpZiAoanVzdFRlc3QpIHsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICB9CgogICAgICAgICAgZm91bmQgPSB0cnVlOwogICAgICAgICAgY29uc3QgciA9IHRoaXMuY3JlYXRlQ29udGFjdEVxdWF0aW9uKGJpLCBiaiwgc2ksIHNqLCByc2ksIHJzaik7CiAgICAgICAgICByLnJpLmNvcHkoc3BoZXJlX3RvX2Nvcm5lcik7CiAgICAgICAgICByLnJpLm5vcm1hbGl6ZSgpOwogICAgICAgICAgci5uaS5jb3B5KHIucmkpOwogICAgICAgICAgci5yaS5zY2FsZShSLCByLnJpKTsKICAgICAgICAgIHdvcmxkQ29ybmVyLnZzdWIoeGosIHIucmopOyAvLyBTaG91bGQgYmUgcmVsYXRpdmUgdG8gdGhlIGJvZHkuCgogICAgICAgICAgci5yaS52YWRkKHhpLCByLnJpKTsKICAgICAgICAgIHIucmkudnN1YihiaS5wb3NpdGlvbiwgci5yaSk7IC8vIFNob3VsZCBiZSByZWxhdGl2ZSB0byB0aGUgYm9keS4KCiAgICAgICAgICByLnJqLnZhZGQoeGosIHIucmopOwogICAgICAgICAgci5yai52c3ViKGJqLnBvc2l0aW9uLCByLnJqKTsKICAgICAgICAgIHRoaXMucmVzdWx0LnB1c2gocik7CiAgICAgICAgICB0aGlzLmNyZWF0ZUZyaWN0aW9uRXF1YXRpb25zRnJvbUNvbnRhY3QociwgdGhpcy5mcmljdGlvblJlc3VsdCk7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICB9IC8vIENoZWNrIHNpZGUgKHBsYW5lKSBpbnRlcnNlY3Rpb25zCgoKICAgICAgZm9yIChsZXQgaSA9IDAsIG5mYWNlcyA9IGZhY2VzLmxlbmd0aDsgaSAhPT0gbmZhY2VzICYmIGZvdW5kID09PSBmYWxzZTsgaSsrKSB7CiAgICAgICAgY29uc3Qgbm9ybWFsID0gbm9ybWFsc1tpXTsKICAgICAgICBjb25zdCBmYWNlID0gZmFjZXNbaV07IC8vIEdldCB3b3JsZC10cmFuc2Zvcm1lZCBub3JtYWwgb2YgdGhlIGZhY2UKCiAgICAgICAgY29uc3Qgd29ybGROb3JtYWwgPSBzcGhlcmVDb252ZXhfd29ybGROb3JtYWw7CiAgICAgICAgcWoudm11bHQobm9ybWFsLCB3b3JsZE5vcm1hbCk7IC8vIEdldCBhIHdvcmxkIHZlcnRleCBmcm9tIHRoZSBmYWNlCgogICAgICAgIGNvbnN0IHdvcmxkUG9pbnQgPSBzcGhlcmVDb252ZXhfd29ybGRQb2ludDsKICAgICAgICBxai52bXVsdCh2ZXJ0c1tmYWNlWzBdXSwgd29ybGRQb2ludCk7CiAgICAgICAgd29ybGRQb2ludC52YWRkKHhqLCB3b3JsZFBvaW50KTsgLy8gR2V0IGEgcG9pbnQgb24gdGhlIHNwaGVyZSwgY2xvc2VzdCB0byB0aGUgZmFjZSBub3JtYWwKCiAgICAgICAgY29uc3Qgd29ybGRTcGhlcmVQb2ludENsb3Nlc3RUb1BsYW5lID0gc3BoZXJlQ29udmV4X3dvcmxkU3BoZXJlUG9pbnRDbG9zZXN0VG9QbGFuZTsKICAgICAgICB3b3JsZE5vcm1hbC5zY2FsZSgtUiwgd29ybGRTcGhlcmVQb2ludENsb3Nlc3RUb1BsYW5lKTsKICAgICAgICB4aS52YWRkKHdvcmxkU3BoZXJlUG9pbnRDbG9zZXN0VG9QbGFuZSwgd29ybGRTcGhlcmVQb2ludENsb3Nlc3RUb1BsYW5lKTsgLy8gVmVjdG9yIGZyb20gYSBmYWNlIHBvaW50IHRvIHRoZSBjbG9zZXN0IHBvaW50IG9uIHRoZSBzcGhlcmUKCiAgICAgICAgY29uc3QgcGVuZXRyYXRpb25WZWMgPSBzcGhlcmVDb252ZXhfcGVuZXRyYXRpb25WZWM7CiAgICAgICAgd29ybGRTcGhlcmVQb2ludENsb3Nlc3RUb1BsYW5lLnZzdWIod29ybGRQb2ludCwgcGVuZXRyYXRpb25WZWMpOyAvLyBUaGUgcGVuZXRyYXRpb24uIE5lZ2F0aXZlIHZhbHVlIG1lYW5zIG92ZXJsYXAuCgogICAgICAgIGNvbnN0IHBlbmV0cmF0aW9uID0gcGVuZXRyYXRpb25WZWMuZG90KHdvcmxkTm9ybWFsKTsKICAgICAgICBjb25zdCB3b3JsZFBvaW50VG9TcGhlcmUgPSBzcGhlcmVDb252ZXhfc3BoZXJlVG9Xb3JsZFBvaW50OwogICAgICAgIHhpLnZzdWIod29ybGRQb2ludCwgd29ybGRQb2ludFRvU3BoZXJlKTsKCiAgICAgICAgaWYgKHBlbmV0cmF0aW9uIDwgMCAmJiB3b3JsZFBvaW50VG9TcGhlcmUuZG90KHdvcmxkTm9ybWFsKSA+IDApIHsKICAgICAgICAgIC8vIEludGVyc2VjdHMgcGxhbmUuIE5vdyBjaGVjayBpZiB0aGUgc3BoZXJlIGlzIGluc2lkZSB0aGUgZmFjZSBwb2x5Z29uCiAgICAgICAgICBjb25zdCBmYWNlVmVydHMgPSBbXTsgLy8gRmFjZSB2ZXJ0aWNlcywgaW4gd29ybGQgY29vcmRzCgogICAgICAgICAgZm9yIChsZXQgaiA9IDAsIE52ZXJ0cyA9IGZhY2UubGVuZ3RoOyBqICE9PSBOdmVydHM7IGorKykgewogICAgICAgICAgICBjb25zdCB3b3JsZFZlcnRleCA9IHYzcG9vbC5nZXQoKTsKICAgICAgICAgICAgcWoudm11bHQodmVydHNbZmFjZVtqXV0sIHdvcmxkVmVydGV4KTsKICAgICAgICAgICAgeGoudmFkZCh3b3JsZFZlcnRleCwgd29ybGRWZXJ0ZXgpOwogICAgICAgICAgICBmYWNlVmVydHMucHVzaCh3b3JsZFZlcnRleCk7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKHBvaW50SW5Qb2x5Z29uKGZhY2VWZXJ0cywgd29ybGROb3JtYWwsIHhpKSkgewogICAgICAgICAgICAvLyBJcyB0aGUgc3BoZXJlIGNlbnRlciBpbiB0aGUgZmFjZSBwb2x5Z29uPwogICAgICAgICAgICBpZiAoanVzdFRlc3QpIHsKICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgZm91bmQgPSB0cnVlOwogICAgICAgICAgICBjb25zdCByID0gdGhpcy5jcmVhdGVDb250YWN0RXF1YXRpb24oYmksIGJqLCBzaSwgc2osIHJzaSwgcnNqKTsKICAgICAgICAgICAgd29ybGROb3JtYWwuc2NhbGUoLVIsIHIucmkpOyAvLyBDb250YWN0IG9mZnNldCwgZnJvbSBzcGhlcmUgY2VudGVyIHRvIGNvbnRhY3QKCiAgICAgICAgICAgIHdvcmxkTm9ybWFsLm5lZ2F0ZShyLm5pKTsgLy8gTm9ybWFsIHBvaW50aW5nIG91dCBvZiBzcGhlcmUKCiAgICAgICAgICAgIGNvbnN0IHBlbmV0cmF0aW9uVmVjMiA9IHYzcG9vbC5nZXQoKTsKICAgICAgICAgICAgd29ybGROb3JtYWwuc2NhbGUoLXBlbmV0cmF0aW9uLCBwZW5ldHJhdGlvblZlYzIpOwogICAgICAgICAgICBjb25zdCBwZW5ldHJhdGlvblNwaGVyZVBvaW50ID0gdjNwb29sLmdldCgpOwogICAgICAgICAgICB3b3JsZE5vcm1hbC5zY2FsZSgtUiwgcGVuZXRyYXRpb25TcGhlcmVQb2ludCk7IC8veGkudnN1Yih4aikudmFkZChwZW5ldHJhdGlvblNwaGVyZVBvaW50KS52YWRkKHBlbmV0cmF0aW9uVmVjMiAsIHIucmopOwoKICAgICAgICAgICAgeGkudnN1Yih4aiwgci5yaik7CiAgICAgICAgICAgIHIucmoudmFkZChwZW5ldHJhdGlvblNwaGVyZVBvaW50LCByLnJqKTsKICAgICAgICAgICAgci5yai52YWRkKHBlbmV0cmF0aW9uVmVjMiwgci5yaik7IC8vIFNob3VsZCBiZSByZWxhdGl2ZSB0byB0aGUgYm9keS4KCiAgICAgICAgICAgIHIucmoudmFkZCh4aiwgci5yaik7CiAgICAgICAgICAgIHIucmoudnN1Yihiai5wb3NpdGlvbiwgci5yaik7IC8vIFNob3VsZCBiZSByZWxhdGl2ZSB0byB0aGUgYm9keS4KCiAgICAgICAgICAgIHIucmkudmFkZCh4aSwgci5yaSk7CiAgICAgICAgICAgIHIucmkudnN1YihiaS5wb3NpdGlvbiwgci5yaSk7CiAgICAgICAgICAgIHYzcG9vbC5yZWxlYXNlKHBlbmV0cmF0aW9uVmVjMik7CiAgICAgICAgICAgIHYzcG9vbC5yZWxlYXNlKHBlbmV0cmF0aW9uU3BoZXJlUG9pbnQpOwogICAgICAgICAgICB0aGlzLnJlc3VsdC5wdXNoKHIpOwogICAgICAgICAgICB0aGlzLmNyZWF0ZUZyaWN0aW9uRXF1YXRpb25zRnJvbUNvbnRhY3QociwgdGhpcy5mcmljdGlvblJlc3VsdCk7IC8vIFJlbGVhc2Ugd29ybGQgdmVydGljZXMKCiAgICAgICAgICAgIGZvciAobGV0IGogPSAwLCBOZmFjZXZlcnRzID0gZmFjZVZlcnRzLmxlbmd0aDsgaiAhPT0gTmZhY2V2ZXJ0czsgaisrKSB7CiAgICAgICAgICAgICAgdjNwb29sLnJlbGVhc2UoZmFjZVZlcnRzW2pdKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuOyAvLyBXZSBvbmx5IGV4cGVjdCAqb25lKiBmYWNlIGNvbnRhY3QKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIC8vIEVkZ2U/CiAgICAgICAgICAgIGZvciAobGV0IGogPSAwOyBqICE9PSBmYWNlLmxlbmd0aDsgaisrKSB7CiAgICAgICAgICAgICAgLy8gR2V0IHR3byB3b3JsZCB0cmFuc2Zvcm1lZCB2ZXJ0aWNlcwogICAgICAgICAgICAgIGNvbnN0IHYxID0gdjNwb29sLmdldCgpOwogICAgICAgICAgICAgIGNvbnN0IHYyID0gdjNwb29sLmdldCgpOwogICAgICAgICAgICAgIHFqLnZtdWx0KHZlcnRzW2ZhY2VbKGogKyAxKSAlIGZhY2UubGVuZ3RoXV0sIHYxKTsKICAgICAgICAgICAgICBxai52bXVsdCh2ZXJ0c1tmYWNlWyhqICsgMikgJSBmYWNlLmxlbmd0aF1dLCB2Mik7CiAgICAgICAgICAgICAgeGoudmFkZCh2MSwgdjEpOwogICAgICAgICAgICAgIHhqLnZhZGQodjIsIHYyKTsgLy8gQ29uc3RydWN0IGVkZ2UgdmVjdG9yCgogICAgICAgICAgICAgIGNvbnN0IGVkZ2UgPSBzcGhlcmVDb252ZXhfZWRnZTsKICAgICAgICAgICAgICB2Mi52c3ViKHYxLCBlZGdlKTsgLy8gQ29uc3RydWN0IHRoZSBzYW1lIHZlY3RvciwgYnV0IG5vcm1hbGl6ZWQKCiAgICAgICAgICAgICAgY29uc3QgZWRnZVVuaXQgPSBzcGhlcmVDb252ZXhfZWRnZVVuaXQ7CiAgICAgICAgICAgICAgZWRnZS51bml0KGVkZ2VVbml0KTsgLy8gcCBpcyB4aSBwcm9qZWN0ZWQgb250byB0aGUgZWRnZQoKICAgICAgICAgICAgICBjb25zdCBwID0gdjNwb29sLmdldCgpOwogICAgICAgICAgICAgIGNvbnN0IHYxX3RvX3hpID0gdjNwb29sLmdldCgpOwogICAgICAgICAgICAgIHhpLnZzdWIodjEsIHYxX3RvX3hpKTsKICAgICAgICAgICAgICBjb25zdCBkb3QgPSB2MV90b194aS5kb3QoZWRnZVVuaXQpOwogICAgICAgICAgICAgIGVkZ2VVbml0LnNjYWxlKGRvdCwgcCk7CiAgICAgICAgICAgICAgcC52YWRkKHYxLCBwKTsgLy8gQ29tcHV0ZSBhIHZlY3RvciBmcm9tIHAgdG8gdGhlIGNlbnRlciBvZiB0aGUgc3BoZXJlCgogICAgICAgICAgICAgIGNvbnN0IHhpX3RvX3AgPSB2M3Bvb2wuZ2V0KCk7CiAgICAgICAgICAgICAgcC52c3ViKHhpLCB4aV90b19wKTsgLy8gQ29sbGlzaW9uIGlmIHRoZSBlZGdlLXNwaGVyZSBkaXN0YW5jZSBpcyBsZXNzIHRoYW4gdGhlIHJhZGl1cwogICAgICAgICAgICAgIC8vIEFORCBpZiBwIGlzIGluIGJldHdlZW4gdjEgYW5kIHYyCgogICAgICAgICAgICAgIGlmIChkb3QgPiAwICYmIGRvdCAqIGRvdCA8IGVkZ2UubGVuZ3RoU3F1YXJlZCgpICYmIHhpX3RvX3AubGVuZ3RoU3F1YXJlZCgpIDwgUiAqIFIpIHsKICAgICAgICAgICAgICAgIC8vIENvbGxpc2lvbiBpZiB0aGUgZWRnZS1zcGhlcmUgZGlzdGFuY2UgaXMgbGVzcyB0aGFuIHRoZSByYWRpdXMKICAgICAgICAgICAgICAgIC8vIEVkZ2UgY29udGFjdCEKICAgICAgICAgICAgICAgIGlmIChqdXN0VGVzdCkgewogICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBjb25zdCByID0gdGhpcy5jcmVhdGVDb250YWN0RXF1YXRpb24oYmksIGJqLCBzaSwgc2osIHJzaSwgcnNqKTsKICAgICAgICAgICAgICAgIHAudnN1Yih4aiwgci5yaik7CiAgICAgICAgICAgICAgICBwLnZzdWIoeGksIHIubmkpOwogICAgICAgICAgICAgICAgci5uaS5ub3JtYWxpemUoKTsKICAgICAgICAgICAgICAgIHIubmkuc2NhbGUoUiwgci5yaSk7IC8vIFNob3VsZCBiZSByZWxhdGl2ZSB0byB0aGUgYm9keS4KCiAgICAgICAgICAgICAgICByLnJqLnZhZGQoeGosIHIucmopOwogICAgICAgICAgICAgICAgci5yai52c3ViKGJqLnBvc2l0aW9uLCByLnJqKTsgLy8gU2hvdWxkIGJlIHJlbGF0aXZlIHRvIHRoZSBib2R5LgoKICAgICAgICAgICAgICAgIHIucmkudmFkZCh4aSwgci5yaSk7CiAgICAgICAgICAgICAgICByLnJpLnZzdWIoYmkucG9zaXRpb24sIHIucmkpOwogICAgICAgICAgICAgICAgdGhpcy5yZXN1bHQucHVzaChyKTsKICAgICAgICAgICAgICAgIHRoaXMuY3JlYXRlRnJpY3Rpb25FcXVhdGlvbnNGcm9tQ29udGFjdChyLCB0aGlzLmZyaWN0aW9uUmVzdWx0KTsgLy8gUmVsZWFzZSB3b3JsZCB2ZXJ0aWNlcwoKICAgICAgICAgICAgICAgIGZvciAobGV0IGogPSAwLCBOZmFjZXZlcnRzID0gZmFjZVZlcnRzLmxlbmd0aDsgaiAhPT0gTmZhY2V2ZXJ0czsgaisrKSB7CiAgICAgICAgICAgICAgICAgIHYzcG9vbC5yZWxlYXNlKGZhY2VWZXJ0c1tqXSk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgdjNwb29sLnJlbGVhc2UodjEpOwogICAgICAgICAgICAgICAgdjNwb29sLnJlbGVhc2UodjIpOwogICAgICAgICAgICAgICAgdjNwb29sLnJlbGVhc2UocCk7CiAgICAgICAgICAgICAgICB2M3Bvb2wucmVsZWFzZSh4aV90b19wKTsKICAgICAgICAgICAgICAgIHYzcG9vbC5yZWxlYXNlKHYxX3RvX3hpKTsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIHYzcG9vbC5yZWxlYXNlKHYxKTsKICAgICAgICAgICAgICB2M3Bvb2wucmVsZWFzZSh2Mik7CiAgICAgICAgICAgICAgdjNwb29sLnJlbGVhc2UocCk7CiAgICAgICAgICAgICAgdjNwb29sLnJlbGVhc2UoeGlfdG9fcCk7CiAgICAgICAgICAgICAgdjNwb29sLnJlbGVhc2UodjFfdG9feGkpOwogICAgICAgICAgICB9CiAgICAgICAgICB9IC8vIFJlbGVhc2Ugd29ybGQgdmVydGljZXMKCgogICAgICAgICAgZm9yIChsZXQgaiA9IDAsIE5mYWNldmVydHMgPSBmYWNlVmVydHMubGVuZ3RoOyBqICE9PSBOZmFjZXZlcnRzOyBqKyspIHsKICAgICAgICAgICAgdjNwb29sLnJlbGVhc2UoZmFjZVZlcnRzW2pdKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgIH0KCiAgICBwbGFuZUNvbnZleChwbGFuZVNoYXBlLCBjb252ZXhTaGFwZSwgcGxhbmVQb3NpdGlvbiwgY29udmV4UG9zaXRpb24sIHBsYW5lUXVhdCwgY29udmV4UXVhdCwgcGxhbmVCb2R5LCBjb252ZXhCb2R5LCBzaSwgc2osIGp1c3RUZXN0KSB7CiAgICAgIC8vIFNpbXBseSByZXR1cm4gdGhlIHBvaW50cyBiZWhpbmQgdGhlIHBsYW5lLgogICAgICBjb25zdCB3b3JsZFZlcnRleCA9IHBsYW5lQ29udmV4X3Y7CiAgICAgIGNvbnN0IHdvcmxkTm9ybWFsID0gcGxhbmVDb252ZXhfbm9ybWFsOwogICAgICB3b3JsZE5vcm1hbC5zZXQoMCwgMCwgMSk7CiAgICAgIHBsYW5lUXVhdC52bXVsdCh3b3JsZE5vcm1hbCwgd29ybGROb3JtYWwpOyAvLyBUdXJuIG5vcm1hbCBhY2NvcmRpbmcgdG8gcGxhbmUgb3JpZW50YXRpb24KCiAgICAgIGxldCBudW1Db250YWN0cyA9IDA7CiAgICAgIGNvbnN0IHJlbHBvcyA9IHBsYW5lQ29udmV4X3JlbHBvczsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpICE9PSBjb252ZXhTaGFwZS52ZXJ0aWNlcy5sZW5ndGg7IGkrKykgewogICAgICAgIC8vIEdldCB3b3JsZCBjb252ZXggdmVydGV4CiAgICAgICAgd29ybGRWZXJ0ZXguY29weShjb252ZXhTaGFwZS52ZXJ0aWNlc1tpXSk7CiAgICAgICAgY29udmV4UXVhdC52bXVsdCh3b3JsZFZlcnRleCwgd29ybGRWZXJ0ZXgpOwogICAgICAgIGNvbnZleFBvc2l0aW9uLnZhZGQod29ybGRWZXJ0ZXgsIHdvcmxkVmVydGV4KTsKICAgICAgICB3b3JsZFZlcnRleC52c3ViKHBsYW5lUG9zaXRpb24sIHJlbHBvcyk7CiAgICAgICAgY29uc3QgZG90ID0gd29ybGROb3JtYWwuZG90KHJlbHBvcyk7CgogICAgICAgIGlmIChkb3QgPD0gMC4wKSB7CiAgICAgICAgICBpZiAoanVzdFRlc3QpIHsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICB9CgogICAgICAgICAgY29uc3QgciA9IHRoaXMuY3JlYXRlQ29udGFjdEVxdWF0aW9uKHBsYW5lQm9keSwgY29udmV4Qm9keSwgcGxhbmVTaGFwZSwgY29udmV4U2hhcGUsIHNpLCBzaik7IC8vIEdldCB2ZXJ0ZXggcG9zaXRpb24gcHJvamVjdGVkIG9uIHBsYW5lCgogICAgICAgICAgY29uc3QgcHJvamVjdGVkID0gcGxhbmVDb252ZXhfcHJvamVjdGVkOwogICAgICAgICAgd29ybGROb3JtYWwuc2NhbGUod29ybGROb3JtYWwuZG90KHJlbHBvcyksIHByb2plY3RlZCk7CiAgICAgICAgICB3b3JsZFZlcnRleC52c3ViKHByb2plY3RlZCwgcHJvamVjdGVkKTsKICAgICAgICAgIHByb2plY3RlZC52c3ViKHBsYW5lUG9zaXRpb24sIHIucmkpOyAvLyBGcm9tIHBsYW5lIHRvIHZlcnRleCBwcm9qZWN0ZWQgb24gcGxhbmUKCiAgICAgICAgICByLm5pLmNvcHkod29ybGROb3JtYWwpOyAvLyBDb250YWN0IG5vcm1hbCBpcyB0aGUgcGxhbmUgbm9ybWFsIG91dCBmcm9tIHBsYW5lCiAgICAgICAgICAvLyByaiBpcyBub3cganVzdCB0aGUgdmVjdG9yIGZyb20gdGhlIGNvbnZleCBjZW50ZXIgdG8gdGhlIHZlcnRleAoKICAgICAgICAgIHdvcmxkVmVydGV4LnZzdWIoY29udmV4UG9zaXRpb24sIHIucmopOyAvLyBNYWtlIGl0IHJlbGF0aXZlIHRvIHRoZSBib2R5CgogICAgICAgICAgci5yaS52YWRkKHBsYW5lUG9zaXRpb24sIHIucmkpOwogICAgICAgICAgci5yaS52c3ViKHBsYW5lQm9keS5wb3NpdGlvbiwgci5yaSk7CiAgICAgICAgICByLnJqLnZhZGQoY29udmV4UG9zaXRpb24sIHIucmopOwogICAgICAgICAgci5yai52c3ViKGNvbnZleEJvZHkucG9zaXRpb24sIHIucmopOwogICAgICAgICAgdGhpcy5yZXN1bHQucHVzaChyKTsKICAgICAgICAgIG51bUNvbnRhY3RzKys7CgogICAgICAgICAgaWYgKCF0aGlzLmVuYWJsZUZyaWN0aW9uUmVkdWN0aW9uKSB7CiAgICAgICAgICAgIHRoaXMuY3JlYXRlRnJpY3Rpb25FcXVhdGlvbnNGcm9tQ29udGFjdChyLCB0aGlzLmZyaWN0aW9uUmVzdWx0KTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KCiAgICAgIGlmICh0aGlzLmVuYWJsZUZyaWN0aW9uUmVkdWN0aW9uICYmIG51bUNvbnRhY3RzKSB7CiAgICAgICAgdGhpcy5jcmVhdGVGcmljdGlvbkZyb21BdmVyYWdlKG51bUNvbnRhY3RzKTsKICAgICAgfQogICAgfQoKICAgIGJveENvbnZleChzaSwgc2osIHhpLCB4aiwgcWksIHFqLCBiaSwgYmosIHJzaSwgcnNqLCBqdXN0VGVzdCkgewogICAgICBzaS5jb252ZXhQb2x5aGVkcm9uUmVwcmVzZW50YXRpb24ubWF0ZXJpYWwgPSBzaS5tYXRlcmlhbDsKICAgICAgc2kuY29udmV4UG9seWhlZHJvblJlcHJlc2VudGF0aW9uLmNvbGxpc2lvblJlc3BvbnNlID0gc2kuY29sbGlzaW9uUmVzcG9uc2U7CiAgICAgIHJldHVybiB0aGlzLmNvbnZleENvbnZleChzaS5jb252ZXhQb2x5aGVkcm9uUmVwcmVzZW50YXRpb24sIHNqLCB4aSwgeGosIHFpLCBxaiwgYmksIGJqLCBzaSwgc2osIGp1c3RUZXN0KTsKICAgIH0KCiAgICBzcGhlcmVIZWlnaHRmaWVsZChzcGhlcmVTaGFwZSwgaGZTaGFwZSwgc3BoZXJlUG9zLCBoZlBvcywgc3BoZXJlUXVhdCwgaGZRdWF0LCBzcGhlcmVCb2R5LCBoZkJvZHksIHJzaSwgcnNqLCBqdXN0VGVzdCkgewogICAgICBjb25zdCBkYXRhID0gaGZTaGFwZS5kYXRhOwogICAgICBjb25zdCByYWRpdXMgPSBzcGhlcmVTaGFwZS5yYWRpdXM7CiAgICAgIGNvbnN0IHcgPSBoZlNoYXBlLmVsZW1lbnRTaXplOwogICAgICBjb25zdCB3b3JsZFBpbGxhck9mZnNldCA9IHNwaGVyZUhlaWdodGZpZWxkX3RtcDI7IC8vIEdldCBzcGhlcmUgcG9zaXRpb24gdG8gaGVpZ2h0ZmllbGQgbG9jYWwhCgogICAgICBjb25zdCBsb2NhbFNwaGVyZVBvcyA9IHNwaGVyZUhlaWdodGZpZWxkX3RtcDE7CiAgICAgIFRyYW5zZm9ybS5wb2ludFRvTG9jYWxGcmFtZShoZlBvcywgaGZRdWF0LCBzcGhlcmVQb3MsIGxvY2FsU3BoZXJlUG9zKTsgLy8gR2V0IHRoZSBpbmRleCBvZiB0aGUgZGF0YSBwb2ludHMgdG8gdGVzdCBhZ2FpbnN0CgogICAgICBsZXQgaU1pblggPSBNYXRoLmZsb29yKChsb2NhbFNwaGVyZVBvcy54IC0gcmFkaXVzKSAvIHcpIC0gMTsKICAgICAgbGV0IGlNYXhYID0gTWF0aC5jZWlsKChsb2NhbFNwaGVyZVBvcy54ICsgcmFkaXVzKSAvIHcpICsgMTsKICAgICAgbGV0IGlNaW5ZID0gTWF0aC5mbG9vcigobG9jYWxTcGhlcmVQb3MueSAtIHJhZGl1cykgLyB3KSAtIDE7CiAgICAgIGxldCBpTWF4WSA9IE1hdGguY2VpbCgobG9jYWxTcGhlcmVQb3MueSArIHJhZGl1cykgLyB3KSArIDE7IC8vIEJhaWwgb3V0IGlmIHdlIGFyZSBvdXQgb2YgdGhlIHRlcnJhaW4KCiAgICAgIGlmIChpTWF4WCA8IDAgfHwgaU1heFkgPCAwIHx8IGlNaW5YID4gZGF0YS5sZW5ndGggfHwgaU1pblkgPiBkYXRhWzBdLmxlbmd0aCkgewogICAgICAgIHJldHVybjsKICAgICAgfSAvLyBDbGFtcCBpbmRleCB0byBlZGdlcwoKCiAgICAgIGlmIChpTWluWCA8IDApIHsKICAgICAgICBpTWluWCA9IDA7CiAgICAgIH0KCiAgICAgIGlmIChpTWF4WCA8IDApIHsKICAgICAgICBpTWF4WCA9IDA7CiAgICAgIH0KCiAgICAgIGlmIChpTWluWSA8IDApIHsKICAgICAgICBpTWluWSA9IDA7CiAgICAgIH0KCiAgICAgIGlmIChpTWF4WSA8IDApIHsKICAgICAgICBpTWF4WSA9IDA7CiAgICAgIH0KCiAgICAgIGlmIChpTWluWCA+PSBkYXRhLmxlbmd0aCkgewogICAgICAgIGlNaW5YID0gZGF0YS5sZW5ndGggLSAxOwogICAgICB9CgogICAgICBpZiAoaU1heFggPj0gZGF0YS5sZW5ndGgpIHsKICAgICAgICBpTWF4WCA9IGRhdGEubGVuZ3RoIC0gMTsKICAgICAgfQoKICAgICAgaWYgKGlNYXhZID49IGRhdGFbMF0ubGVuZ3RoKSB7CiAgICAgICAgaU1heFkgPSBkYXRhWzBdLmxlbmd0aCAtIDE7CiAgICAgIH0KCiAgICAgIGlmIChpTWluWSA+PSBkYXRhWzBdLmxlbmd0aCkgewogICAgICAgIGlNaW5ZID0gZGF0YVswXS5sZW5ndGggLSAxOwogICAgICB9CgogICAgICBjb25zdCBtaW5NYXggPSBbXTsKICAgICAgaGZTaGFwZS5nZXRSZWN0TWluTWF4KGlNaW5YLCBpTWluWSwgaU1heFgsIGlNYXhZLCBtaW5NYXgpOwogICAgICBjb25zdCBtaW4gPSBtaW5NYXhbMF07CiAgICAgIGNvbnN0IG1heCA9IG1pbk1heFsxXTsgLy8gQmFpbCBvdXQgaWYgd2UgY2FuJ3QgdG91Y2ggdGhlIGJvdW5kaW5nIGhlaWdodCBib3gKCiAgICAgIGlmIChsb2NhbFNwaGVyZVBvcy56IC0gcmFkaXVzID4gbWF4IHx8IGxvY2FsU3BoZXJlUG9zLnogKyByYWRpdXMgPCBtaW4pIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGNvbnN0IHJlc3VsdCA9IHRoaXMucmVzdWx0OwoKICAgICAgZm9yIChsZXQgaSA9IGlNaW5YOyBpIDwgaU1heFg7IGkrKykgewogICAgICAgIGZvciAobGV0IGogPSBpTWluWTsgaiA8IGlNYXhZOyBqKyspIHsKICAgICAgICAgIGNvbnN0IG51bUNvbnRhY3RzQmVmb3JlID0gcmVzdWx0Lmxlbmd0aDsKICAgICAgICAgIGxldCBpbnRlcnNlY3RpbmcgPSBmYWxzZTsgLy8gTG93ZXIgdHJpYW5nbGUKCiAgICAgICAgICBoZlNoYXBlLmdldENvbnZleFRyaWFuZ2xlUGlsbGFyKGksIGosIGZhbHNlKTsKICAgICAgICAgIFRyYW5zZm9ybS5wb2ludFRvV29ybGRGcmFtZShoZlBvcywgaGZRdWF0LCBoZlNoYXBlLnBpbGxhck9mZnNldCwgd29ybGRQaWxsYXJPZmZzZXQpOwoKICAgICAgICAgIGlmIChzcGhlcmVQb3MuZGlzdGFuY2VUbyh3b3JsZFBpbGxhck9mZnNldCkgPCBoZlNoYXBlLnBpbGxhckNvbnZleC5ib3VuZGluZ1NwaGVyZVJhZGl1cyArIHNwaGVyZVNoYXBlLmJvdW5kaW5nU3BoZXJlUmFkaXVzKSB7CiAgICAgICAgICAgIGludGVyc2VjdGluZyA9IHRoaXMuc3BoZXJlQ29udmV4KHNwaGVyZVNoYXBlLCBoZlNoYXBlLnBpbGxhckNvbnZleCwgc3BoZXJlUG9zLCB3b3JsZFBpbGxhck9mZnNldCwgc3BoZXJlUXVhdCwgaGZRdWF0LCBzcGhlcmVCb2R5LCBoZkJvZHksIHNwaGVyZVNoYXBlLCBoZlNoYXBlLCBqdXN0VGVzdCk7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKGp1c3RUZXN0ICYmIGludGVyc2VjdGluZykgewogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgIH0gLy8gVXBwZXIgdHJpYW5nbGUKCgogICAgICAgICAgaGZTaGFwZS5nZXRDb252ZXhUcmlhbmdsZVBpbGxhcihpLCBqLCB0cnVlKTsKICAgICAgICAgIFRyYW5zZm9ybS5wb2ludFRvV29ybGRGcmFtZShoZlBvcywgaGZRdWF0LCBoZlNoYXBlLnBpbGxhck9mZnNldCwgd29ybGRQaWxsYXJPZmZzZXQpOwoKICAgICAgICAgIGlmIChzcGhlcmVQb3MuZGlzdGFuY2VUbyh3b3JsZFBpbGxhck9mZnNldCkgPCBoZlNoYXBlLnBpbGxhckNvbnZleC5ib3VuZGluZ1NwaGVyZVJhZGl1cyArIHNwaGVyZVNoYXBlLmJvdW5kaW5nU3BoZXJlUmFkaXVzKSB7CiAgICAgICAgICAgIGludGVyc2VjdGluZyA9IHRoaXMuc3BoZXJlQ29udmV4KHNwaGVyZVNoYXBlLCBoZlNoYXBlLnBpbGxhckNvbnZleCwgc3BoZXJlUG9zLCB3b3JsZFBpbGxhck9mZnNldCwgc3BoZXJlUXVhdCwgaGZRdWF0LCBzcGhlcmVCb2R5LCBoZkJvZHksIHNwaGVyZVNoYXBlLCBoZlNoYXBlLCBqdXN0VGVzdCk7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKGp1c3RUZXN0ICYmIGludGVyc2VjdGluZykgewogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgIH0KCiAgICAgICAgICBjb25zdCBudW1Db250YWN0cyA9IHJlc3VsdC5sZW5ndGggLSBudW1Db250YWN0c0JlZm9yZTsKCiAgICAgICAgICBpZiAobnVtQ29udGFjdHMgPiAyKSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgIH0KICAgICAgICAgIC8qCiAgICAgICAgICAgIC8vIFNraXAgYWxsIGJ1dCAxCiAgICAgICAgICAgIGZvciAobGV0IGsgPSAwOyBrIDwgbnVtQ29udGFjdHMgLSAxOyBrKyspIHsKICAgICAgICAgICAgICAgIHJlc3VsdC5wb3AoKTsKICAgICAgICAgICAgfQogICAgICAgICAgKi8KCiAgICAgICAgfQogICAgICB9CiAgICB9CgogICAgYm94SGVpZ2h0ZmllbGQoc2ksIHNqLCB4aSwgeGosIHFpLCBxaiwgYmksIGJqLCByc2ksIHJzaiwganVzdFRlc3QpIHsKICAgICAgc2kuY29udmV4UG9seWhlZHJvblJlcHJlc2VudGF0aW9uLm1hdGVyaWFsID0gc2kubWF0ZXJpYWw7CiAgICAgIHNpLmNvbnZleFBvbHloZWRyb25SZXByZXNlbnRhdGlvbi5jb2xsaXNpb25SZXNwb25zZSA9IHNpLmNvbGxpc2lvblJlc3BvbnNlOwogICAgICByZXR1cm4gdGhpcy5jb252ZXhIZWlnaHRmaWVsZChzaS5jb252ZXhQb2x5aGVkcm9uUmVwcmVzZW50YXRpb24sIHNqLCB4aSwgeGosIHFpLCBxaiwgYmksIGJqLCBzaSwgc2osIGp1c3RUZXN0KTsKICAgIH0KCiAgICBjb252ZXhIZWlnaHRmaWVsZChjb252ZXhTaGFwZSwgaGZTaGFwZSwgY29udmV4UG9zLCBoZlBvcywgY29udmV4UXVhdCwgaGZRdWF0LCBjb252ZXhCb2R5LCBoZkJvZHksIHJzaSwgcnNqLCBqdXN0VGVzdCkgewogICAgICBjb25zdCBkYXRhID0gaGZTaGFwZS5kYXRhOwogICAgICBjb25zdCB3ID0gaGZTaGFwZS5lbGVtZW50U2l6ZTsKICAgICAgY29uc3QgcmFkaXVzID0gY29udmV4U2hhcGUuYm91bmRpbmdTcGhlcmVSYWRpdXM7CiAgICAgIGNvbnN0IHdvcmxkUGlsbGFyT2Zmc2V0ID0gY29udmV4SGVpZ2h0ZmllbGRfdG1wMjsKICAgICAgY29uc3QgZmFjZUxpc3QgPSBjb252ZXhIZWlnaHRmaWVsZF9mYWNlTGlzdDsgLy8gR2V0IHNwaGVyZSBwb3NpdGlvbiB0byBoZWlnaHRmaWVsZCBsb2NhbCEKCiAgICAgIGNvbnN0IGxvY2FsQ29udmV4UG9zID0gY29udmV4SGVpZ2h0ZmllbGRfdG1wMTsKICAgICAgVHJhbnNmb3JtLnBvaW50VG9Mb2NhbEZyYW1lKGhmUG9zLCBoZlF1YXQsIGNvbnZleFBvcywgbG9jYWxDb252ZXhQb3MpOyAvLyBHZXQgdGhlIGluZGV4IG9mIHRoZSBkYXRhIHBvaW50cyB0byB0ZXN0IGFnYWluc3QKCiAgICAgIGxldCBpTWluWCA9IE1hdGguZmxvb3IoKGxvY2FsQ29udmV4UG9zLnggLSByYWRpdXMpIC8gdykgLSAxOwogICAgICBsZXQgaU1heFggPSBNYXRoLmNlaWwoKGxvY2FsQ29udmV4UG9zLnggKyByYWRpdXMpIC8gdykgKyAxOwogICAgICBsZXQgaU1pblkgPSBNYXRoLmZsb29yKChsb2NhbENvbnZleFBvcy55IC0gcmFkaXVzKSAvIHcpIC0gMTsKICAgICAgbGV0IGlNYXhZID0gTWF0aC5jZWlsKChsb2NhbENvbnZleFBvcy55ICsgcmFkaXVzKSAvIHcpICsgMTsgLy8gQmFpbCBvdXQgaWYgd2UgYXJlIG91dCBvZiB0aGUgdGVycmFpbgoKICAgICAgaWYgKGlNYXhYIDwgMCB8fCBpTWF4WSA8IDAgfHwgaU1pblggPiBkYXRhLmxlbmd0aCB8fCBpTWluWSA+IGRhdGFbMF0ubGVuZ3RoKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9IC8vIENsYW1wIGluZGV4IHRvIGVkZ2VzCgoKICAgICAgaWYgKGlNaW5YIDwgMCkgewogICAgICAgIGlNaW5YID0gMDsKICAgICAgfQoKICAgICAgaWYgKGlNYXhYIDwgMCkgewogICAgICAgIGlNYXhYID0gMDsKICAgICAgfQoKICAgICAgaWYgKGlNaW5ZIDwgMCkgewogICAgICAgIGlNaW5ZID0gMDsKICAgICAgfQoKICAgICAgaWYgKGlNYXhZIDwgMCkgewogICAgICAgIGlNYXhZID0gMDsKICAgICAgfQoKICAgICAgaWYgKGlNaW5YID49IGRhdGEubGVuZ3RoKSB7CiAgICAgICAgaU1pblggPSBkYXRhLmxlbmd0aCAtIDE7CiAgICAgIH0KCiAgICAgIGlmIChpTWF4WCA+PSBkYXRhLmxlbmd0aCkgewogICAgICAgIGlNYXhYID0gZGF0YS5sZW5ndGggLSAxOwogICAgICB9CgogICAgICBpZiAoaU1heFkgPj0gZGF0YVswXS5sZW5ndGgpIHsKICAgICAgICBpTWF4WSA9IGRhdGFbMF0ubGVuZ3RoIC0gMTsKICAgICAgfQoKICAgICAgaWYgKGlNaW5ZID49IGRhdGFbMF0ubGVuZ3RoKSB7CiAgICAgICAgaU1pblkgPSBkYXRhWzBdLmxlbmd0aCAtIDE7CiAgICAgIH0KCiAgICAgIGNvbnN0IG1pbk1heCA9IFtdOwogICAgICBoZlNoYXBlLmdldFJlY3RNaW5NYXgoaU1pblgsIGlNaW5ZLCBpTWF4WCwgaU1heFksIG1pbk1heCk7CiAgICAgIGNvbnN0IG1pbiA9IG1pbk1heFswXTsKICAgICAgY29uc3QgbWF4ID0gbWluTWF4WzFdOyAvLyBCYWlsIG91dCBpZiB3ZSdyZSBjYW50IHRvdWNoIHRoZSBib3VuZGluZyBoZWlnaHQgYm94CgogICAgICBpZiAobG9jYWxDb252ZXhQb3MueiAtIHJhZGl1cyA+IG1heCB8fCBsb2NhbENvbnZleFBvcy56ICsgcmFkaXVzIDwgbWluKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICBmb3IgKGxldCBpID0gaU1pblg7IGkgPCBpTWF4WDsgaSsrKSB7CiAgICAgICAgZm9yIChsZXQgaiA9IGlNaW5ZOyBqIDwgaU1heFk7IGorKykgewogICAgICAgICAgbGV0IGludGVyc2VjdGluZyA9IGZhbHNlOyAvLyBMb3dlciB0cmlhbmdsZQoKICAgICAgICAgIGhmU2hhcGUuZ2V0Q29udmV4VHJpYW5nbGVQaWxsYXIoaSwgaiwgZmFsc2UpOwogICAgICAgICAgVHJhbnNmb3JtLnBvaW50VG9Xb3JsZEZyYW1lKGhmUG9zLCBoZlF1YXQsIGhmU2hhcGUucGlsbGFyT2Zmc2V0LCB3b3JsZFBpbGxhck9mZnNldCk7CgogICAgICAgICAgaWYgKGNvbnZleFBvcy5kaXN0YW5jZVRvKHdvcmxkUGlsbGFyT2Zmc2V0KSA8IGhmU2hhcGUucGlsbGFyQ29udmV4LmJvdW5kaW5nU3BoZXJlUmFkaXVzICsgY29udmV4U2hhcGUuYm91bmRpbmdTcGhlcmVSYWRpdXMpIHsKICAgICAgICAgICAgaW50ZXJzZWN0aW5nID0gdGhpcy5jb252ZXhDb252ZXgoY29udmV4U2hhcGUsIGhmU2hhcGUucGlsbGFyQ29udmV4LCBjb252ZXhQb3MsIHdvcmxkUGlsbGFyT2Zmc2V0LCBjb252ZXhRdWF0LCBoZlF1YXQsIGNvbnZleEJvZHksIGhmQm9keSwgbnVsbCwgbnVsbCwganVzdFRlc3QsIGZhY2VMaXN0LCBudWxsKTsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoanVzdFRlc3QgJiYgaW50ZXJzZWN0aW5nKSB7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgfSAvLyBVcHBlciB0cmlhbmdsZQoKCiAgICAgICAgICBoZlNoYXBlLmdldENvbnZleFRyaWFuZ2xlUGlsbGFyKGksIGosIHRydWUpOwogICAgICAgICAgVHJhbnNmb3JtLnBvaW50VG9Xb3JsZEZyYW1lKGhmUG9zLCBoZlF1YXQsIGhmU2hhcGUucGlsbGFyT2Zmc2V0LCB3b3JsZFBpbGxhck9mZnNldCk7CgogICAgICAgICAgaWYgKGNvbnZleFBvcy5kaXN0YW5jZVRvKHdvcmxkUGlsbGFyT2Zmc2V0KSA8IGhmU2hhcGUucGlsbGFyQ29udmV4LmJvdW5kaW5nU3BoZXJlUmFkaXVzICsgY29udmV4U2hhcGUuYm91bmRpbmdTcGhlcmVSYWRpdXMpIHsKICAgICAgICAgICAgaW50ZXJzZWN0aW5nID0gdGhpcy5jb252ZXhDb252ZXgoY29udmV4U2hhcGUsIGhmU2hhcGUucGlsbGFyQ29udmV4LCBjb252ZXhQb3MsIHdvcmxkUGlsbGFyT2Zmc2V0LCBjb252ZXhRdWF0LCBoZlF1YXQsIGNvbnZleEJvZHksIGhmQm9keSwgbnVsbCwgbnVsbCwganVzdFRlc3QsIGZhY2VMaXN0LCBudWxsKTsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoanVzdFRlc3QgJiYgaW50ZXJzZWN0aW5nKSB7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgfQoKICAgIHNwaGVyZVBhcnRpY2xlKHNqLCBzaSwgeGosIHhpLCBxaiwgcWksIGJqLCBiaSwgcnNpLCByc2osIGp1c3RUZXN0KSB7CiAgICAgIC8vIFRoZSBub3JtYWwgaXMgdGhlIHVuaXQgdmVjdG9yIGZyb20gc3BoZXJlIGNlbnRlciB0byBwYXJ0aWNsZSBjZW50ZXIKICAgICAgY29uc3Qgbm9ybWFsID0gcGFydGljbGVTcGhlcmVfbm9ybWFsOwogICAgICBub3JtYWwuc2V0KDAsIDAsIDEpOwogICAgICB4aS52c3ViKHhqLCBub3JtYWwpOwogICAgICBjb25zdCBsZW5ndGhTcXVhcmVkID0gbm9ybWFsLmxlbmd0aFNxdWFyZWQoKTsKCiAgICAgIGlmIChsZW5ndGhTcXVhcmVkIDw9IHNqLnJhZGl1cyAqIHNqLnJhZGl1cykgewogICAgICAgIGlmIChqdXN0VGVzdCkgewogICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQoKICAgICAgICBjb25zdCByID0gdGhpcy5jcmVhdGVDb250YWN0RXF1YXRpb24oYmksIGJqLCBzaSwgc2osIHJzaSwgcnNqKTsKICAgICAgICBub3JtYWwubm9ybWFsaXplKCk7CiAgICAgICAgci5yai5jb3B5KG5vcm1hbCk7CiAgICAgICAgci5yai5zY2FsZShzai5yYWRpdXMsIHIucmopOwogICAgICAgIHIubmkuY29weShub3JtYWwpOyAvLyBDb250YWN0IG5vcm1hbAoKICAgICAgICByLm5pLm5lZ2F0ZShyLm5pKTsKICAgICAgICByLnJpLnNldCgwLCAwLCAwKTsgLy8gQ2VudGVyIG9mIHBhcnRpY2xlCgogICAgICAgIHRoaXMucmVzdWx0LnB1c2gocik7CiAgICAgICAgdGhpcy5jcmVhdGVGcmljdGlvbkVxdWF0aW9uc0Zyb21Db250YWN0KHIsIHRoaXMuZnJpY3Rpb25SZXN1bHQpOwogICAgICB9CiAgICB9CgogICAgcGxhbmVQYXJ0aWNsZShzaiwgc2ksIHhqLCB4aSwgcWosIHFpLCBiaiwgYmksIHJzaSwgcnNqLCBqdXN0VGVzdCkgewogICAgICBjb25zdCBub3JtYWwgPSBwYXJ0aWNsZVBsYW5lX25vcm1hbDsKICAgICAgbm9ybWFsLnNldCgwLCAwLCAxKTsKICAgICAgYmoucXVhdGVybmlvbi52bXVsdChub3JtYWwsIG5vcm1hbCk7IC8vIFR1cm4gbm9ybWFsIGFjY29yZGluZyB0byBwbGFuZSBvcmllbnRhdGlvbgoKICAgICAgY29uc3QgcmVscG9zID0gcGFydGljbGVQbGFuZV9yZWxwb3M7CiAgICAgIHhpLnZzdWIoYmoucG9zaXRpb24sIHJlbHBvcyk7CiAgICAgIGNvbnN0IGRvdCA9IG5vcm1hbC5kb3QocmVscG9zKTsKCiAgICAgIGlmIChkb3QgPD0gMC4wKSB7CiAgICAgICAgaWYgKGp1c3RUZXN0KSB7CiAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CgogICAgICAgIGNvbnN0IHIgPSB0aGlzLmNyZWF0ZUNvbnRhY3RFcXVhdGlvbihiaSwgYmosIHNpLCBzaiwgcnNpLCByc2opOwogICAgICAgIHIubmkuY29weShub3JtYWwpOyAvLyBDb250YWN0IG5vcm1hbCBpcyB0aGUgcGxhbmUgbm9ybWFsCgogICAgICAgIHIubmkubmVnYXRlKHIubmkpOwogICAgICAgIHIucmkuc2V0KDAsIDAsIDApOyAvLyBDZW50ZXIgb2YgcGFydGljbGUKICAgICAgICAvLyBHZXQgcGFydGljbGUgcG9zaXRpb24gcHJvamVjdGVkIG9uIHBsYW5lCgogICAgICAgIGNvbnN0IHByb2plY3RlZCA9IHBhcnRpY2xlUGxhbmVfcHJvamVjdGVkOwogICAgICAgIG5vcm1hbC5zY2FsZShub3JtYWwuZG90KHhpKSwgcHJvamVjdGVkKTsKICAgICAgICB4aS52c3ViKHByb2plY3RlZCwgcHJvamVjdGVkKTsgLy9wcm9qZWN0ZWQudmFkZChiai5wb3NpdGlvbixwcm9qZWN0ZWQpOwogICAgICAgIC8vIHJqIGlzIG5vdyB0aGUgcHJvamVjdGVkIHdvcmxkIHBvc2l0aW9uIG1pbnVzIHBsYW5lIHBvc2l0aW9uCgogICAgICAgIHIucmouY29weShwcm9qZWN0ZWQpOwogICAgICAgIHRoaXMucmVzdWx0LnB1c2gocik7CiAgICAgICAgdGhpcy5jcmVhdGVGcmljdGlvbkVxdWF0aW9uc0Zyb21Db250YWN0KHIsIHRoaXMuZnJpY3Rpb25SZXN1bHQpOwogICAgICB9CiAgICB9CgogICAgYm94UGFydGljbGUoc2ksIHNqLCB4aSwgeGosIHFpLCBxaiwgYmksIGJqLCByc2ksIHJzaiwganVzdFRlc3QpIHsKICAgICAgc2kuY29udmV4UG9seWhlZHJvblJlcHJlc2VudGF0aW9uLm1hdGVyaWFsID0gc2kubWF0ZXJpYWw7CiAgICAgIHNpLmNvbnZleFBvbHloZWRyb25SZXByZXNlbnRhdGlvbi5jb2xsaXNpb25SZXNwb25zZSA9IHNpLmNvbGxpc2lvblJlc3BvbnNlOwogICAgICByZXR1cm4gdGhpcy5jb252ZXhQYXJ0aWNsZShzaS5jb252ZXhQb2x5aGVkcm9uUmVwcmVzZW50YXRpb24sIHNqLCB4aSwgeGosIHFpLCBxaiwgYmksIGJqLCBzaSwgc2osIGp1c3RUZXN0KTsKICAgIH0KCiAgICBjb252ZXhQYXJ0aWNsZShzaiwgc2ksIHhqLCB4aSwgcWosIHFpLCBiaiwgYmksIHJzaSwgcnNqLCBqdXN0VGVzdCkgewogICAgICBsZXQgcGVuZXRyYXRlZEZhY2VJbmRleCA9IC0xOwogICAgICBjb25zdCBwZW5ldHJhdGVkRmFjZU5vcm1hbCA9IGNvbnZleFBhcnRpY2xlX3BlbmV0cmF0ZWRGYWNlTm9ybWFsOwogICAgICBjb25zdCB3b3JsZFBlbmV0cmF0aW9uVmVjID0gY29udmV4UGFydGljbGVfd29ybGRQZW5ldHJhdGlvblZlYzsKICAgICAgbGV0IG1pblBlbmV0cmF0aW9uID0gbnVsbDsKCiAgICAgIGNvbnN0IGxvY2FsID0gY29udmV4UGFydGljbGVfbG9jYWw7CiAgICAgIGxvY2FsLmNvcHkoeGkpOwogICAgICBsb2NhbC52c3ViKHhqLCBsb2NhbCk7IC8vIENvbnZlcnQgcG9zaXRpb24gdG8gcmVsYXRpdmUgdGhlIGNvbnZleCBvcmlnaW4KCiAgICAgIHFqLmNvbmp1Z2F0ZShjcWopOwogICAgICBjcWoudm11bHQobG9jYWwsIGxvY2FsKTsKCiAgICAgIGlmIChzai5wb2ludElzSW5zaWRlKGxvY2FsKSkgewogICAgICAgIGlmIChzai53b3JsZFZlcnRpY2VzTmVlZHNVcGRhdGUpIHsKICAgICAgICAgIHNqLmNvbXB1dGVXb3JsZFZlcnRpY2VzKHhqLCBxaik7CiAgICAgICAgfQoKICAgICAgICBpZiAoc2oud29ybGRGYWNlTm9ybWFsc05lZWRzVXBkYXRlKSB7CiAgICAgICAgICBzai5jb21wdXRlV29ybGRGYWNlTm9ybWFscyhxaik7CiAgICAgICAgfSAvLyBGb3IgZWFjaCB3b3JsZCBwb2x5Z29uIGluIHRoZSBwb2x5aGVkcmEKCgogICAgICAgIGZvciAobGV0IGkgPSAwLCBuZmFjZXMgPSBzai5mYWNlcy5sZW5ndGg7IGkgIT09IG5mYWNlczsgaSsrKSB7CiAgICAgICAgICAvLyBDb25zdHJ1Y3Qgd29ybGQgZmFjZSB2ZXJ0aWNlcwogICAgICAgICAgY29uc3QgdmVydHMgPSBbc2oud29ybGRWZXJ0aWNlc1tzai5mYWNlc1tpXVswXV1dOwogICAgICAgICAgY29uc3Qgbm9ybWFsID0gc2oud29ybGRGYWNlTm9ybWFsc1tpXTsgLy8gQ2hlY2sgaG93IG11Y2ggdGhlIHBhcnRpY2xlIHBlbmV0cmF0ZXMgdGhlIHBvbHlnb24gcGxhbmUuCgogICAgICAgICAgeGkudnN1Yih2ZXJ0c1swXSwgY29udmV4UGFydGljbGVfdmVydGV4VG9QYXJ0aWNsZSk7CiAgICAgICAgICBjb25zdCBwZW5ldHJhdGlvbiA9IC1ub3JtYWwuZG90KGNvbnZleFBhcnRpY2xlX3ZlcnRleFRvUGFydGljbGUpOwoKICAgICAgICAgIGlmIChtaW5QZW5ldHJhdGlvbiA9PT0gbnVsbCB8fCBNYXRoLmFicyhwZW5ldHJhdGlvbikgPCBNYXRoLmFicyhtaW5QZW5ldHJhdGlvbikpIHsKICAgICAgICAgICAgaWYgKGp1c3RUZXN0KSB7CiAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIG1pblBlbmV0cmF0aW9uID0gcGVuZXRyYXRpb247CiAgICAgICAgICAgIHBlbmV0cmF0ZWRGYWNlSW5kZXggPSBpOwogICAgICAgICAgICBwZW5ldHJhdGVkRmFjZU5vcm1hbC5jb3B5KG5vcm1hbCk7CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBpZiAocGVuZXRyYXRlZEZhY2VJbmRleCAhPT0gLTEpIHsKICAgICAgICAgIC8vIFNldHVwIGNvbnRhY3QKICAgICAgICAgIGNvbnN0IHIgPSB0aGlzLmNyZWF0ZUNvbnRhY3RFcXVhdGlvbihiaSwgYmosIHNpLCBzaiwgcnNpLCByc2opOwogICAgICAgICAgcGVuZXRyYXRlZEZhY2VOb3JtYWwuc2NhbGUobWluUGVuZXRyYXRpb24sIHdvcmxkUGVuZXRyYXRpb25WZWMpOyAvLyByaiBpcyB0aGUgcGFydGljbGUgcG9zaXRpb24gcHJvamVjdGVkIHRvIHRoZSBmYWNlCgogICAgICAgICAgd29ybGRQZW5ldHJhdGlvblZlYy52YWRkKHhpLCB3b3JsZFBlbmV0cmF0aW9uVmVjKTsKICAgICAgICAgIHdvcmxkUGVuZXRyYXRpb25WZWMudnN1Yih4aiwgd29ybGRQZW5ldHJhdGlvblZlYyk7CiAgICAgICAgICByLnJqLmNvcHkod29ybGRQZW5ldHJhdGlvblZlYyk7IC8vY29uc3QgcHJvamVjdGVkVG9GYWNlID0geGkudnN1Yih4aikudmFkZCh3b3JsZFBlbmV0cmF0aW9uVmVjKTsKICAgICAgICAgIC8vcHJvamVjdGVkVG9GYWNlLmNvcHkoci5yaik7CiAgICAgICAgICAvL3FqLnZtdWx0KHIucmosci5yaik7CgogICAgICAgICAgcGVuZXRyYXRlZEZhY2VOb3JtYWwubmVnYXRlKHIubmkpOyAvLyBDb250YWN0IG5vcm1hbAoKICAgICAgICAgIHIucmkuc2V0KDAsIDAsIDApOyAvLyBDZW50ZXIgb2YgcGFydGljbGUKCiAgICAgICAgICBjb25zdCByaSA9IHIucmk7CiAgICAgICAgICBjb25zdCByaiA9IHIucmo7IC8vIE1ha2UgcmVsYXRpdmUgdG8gYm9kaWVzCgogICAgICAgICAgcmkudmFkZCh4aSwgcmkpOwogICAgICAgICAgcmkudnN1YihiaS5wb3NpdGlvbiwgcmkpOwogICAgICAgICAgcmoudmFkZCh4aiwgcmopOwogICAgICAgICAgcmoudnN1Yihiai5wb3NpdGlvbiwgcmopOwogICAgICAgICAgdGhpcy5yZXN1bHQucHVzaChyKTsKICAgICAgICAgIHRoaXMuY3JlYXRlRnJpY3Rpb25FcXVhdGlvbnNGcm9tQ29udGFjdChyLCB0aGlzLmZyaWN0aW9uUmVzdWx0KTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgY29uc29sZS53YXJuKCdQb2ludCBmb3VuZCBpbnNpZGUgY29udmV4LCBidXQgZGlkIG5vdCBmaW5kIHBlbmV0cmF0aW5nIGZhY2UhJyk7CiAgICAgICAgfQogICAgICB9CiAgICB9CgogICAgaGVpZ2h0ZmllbGRDeWxpbmRlcihoZlNoYXBlLCBjb252ZXhTaGFwZSwgaGZQb3MsIGNvbnZleFBvcywgaGZRdWF0LCBjb252ZXhRdWF0LCBoZkJvZHksIGNvbnZleEJvZHksIHJzaSwgcnNqLCBqdXN0VGVzdCkgewogICAgICByZXR1cm4gdGhpcy5jb252ZXhIZWlnaHRmaWVsZChjb252ZXhTaGFwZSwgaGZTaGFwZSwgY29udmV4UG9zLCBoZlBvcywgY29udmV4UXVhdCwgaGZRdWF0LCBjb252ZXhCb2R5LCBoZkJvZHksIHJzaSwgcnNqLCBqdXN0VGVzdCk7CiAgICB9CgogICAgcGFydGljbGVDeWxpbmRlcihzaSwgc2osIHhpLCB4aiwgcWksIHFqLCBiaSwgYmosIHJzaSwgcnNqLCBqdXN0VGVzdCkgewogICAgICByZXR1cm4gdGhpcy5jb252ZXhQYXJ0aWNsZShzaiwgc2ksIHhqLCB4aSwgcWosIHFpLCBiaiwgYmksIHJzaSwgcnNqLCBqdXN0VGVzdCk7CiAgICB9CgogICAgc3BoZXJlVHJpbWVzaChzcGhlcmVTaGFwZSwgdHJpbWVzaFNoYXBlLCBzcGhlcmVQb3MsIHRyaW1lc2hQb3MsIHNwaGVyZVF1YXQsIHRyaW1lc2hRdWF0LCBzcGhlcmVCb2R5LCB0cmltZXNoQm9keSwgcnNpLCByc2osIGp1c3RUZXN0KSB7CiAgICAgIGNvbnN0IGVkZ2VWZXJ0ZXhBID0gc3BoZXJlVHJpbWVzaF9lZGdlVmVydGV4QTsKICAgICAgY29uc3QgZWRnZVZlcnRleEIgPSBzcGhlcmVUcmltZXNoX2VkZ2VWZXJ0ZXhCOwogICAgICBjb25zdCBlZGdlVmVjdG9yID0gc3BoZXJlVHJpbWVzaF9lZGdlVmVjdG9yOwogICAgICBjb25zdCBlZGdlVmVjdG9yVW5pdCA9IHNwaGVyZVRyaW1lc2hfZWRnZVZlY3RvclVuaXQ7CiAgICAgIGNvbnN0IGxvY2FsU3BoZXJlUG9zID0gc3BoZXJlVHJpbWVzaF9sb2NhbFNwaGVyZVBvczsKICAgICAgY29uc3QgdG1wID0gc3BoZXJlVHJpbWVzaF90bXA7CiAgICAgIGNvbnN0IGxvY2FsU3BoZXJlQUFCQiA9IHNwaGVyZVRyaW1lc2hfbG9jYWxTcGhlcmVBQUJCOwogICAgICBjb25zdCB2MiA9IHNwaGVyZVRyaW1lc2hfdjI7CiAgICAgIGNvbnN0IHJlbHBvcyA9IHNwaGVyZVRyaW1lc2hfcmVscG9zOwogICAgICBjb25zdCB0cmlhbmdsZXMgPSBzcGhlcmVUcmltZXNoX3RyaWFuZ2xlczsgLy8gQ29udmVydCBzcGhlcmUgcG9zaXRpb24gdG8gbG9jYWwgaW4gdGhlIHRyaW1lc2gKCiAgICAgIFRyYW5zZm9ybS5wb2ludFRvTG9jYWxGcmFtZSh0cmltZXNoUG9zLCB0cmltZXNoUXVhdCwgc3BoZXJlUG9zLCBsb2NhbFNwaGVyZVBvcyk7IC8vIEdldCB0aGUgYWFiYiBvZiB0aGUgc3BoZXJlIGxvY2FsbHkgaW4gdGhlIHRyaW1lc2gKCiAgICAgIGNvbnN0IHNwaGVyZVJhZGl1cyA9IHNwaGVyZVNoYXBlLnJhZGl1czsKICAgICAgbG9jYWxTcGhlcmVBQUJCLmxvd2VyQm91bmQuc2V0KGxvY2FsU3BoZXJlUG9zLnggLSBzcGhlcmVSYWRpdXMsIGxvY2FsU3BoZXJlUG9zLnkgLSBzcGhlcmVSYWRpdXMsIGxvY2FsU3BoZXJlUG9zLnogLSBzcGhlcmVSYWRpdXMpOwogICAgICBsb2NhbFNwaGVyZUFBQkIudXBwZXJCb3VuZC5zZXQobG9jYWxTcGhlcmVQb3MueCArIHNwaGVyZVJhZGl1cywgbG9jYWxTcGhlcmVQb3MueSArIHNwaGVyZVJhZGl1cywgbG9jYWxTcGhlcmVQb3MueiArIHNwaGVyZVJhZGl1cyk7CiAgICAgIHRyaW1lc2hTaGFwZS5nZXRUcmlhbmdsZXNJbkFBQkIobG9jYWxTcGhlcmVBQUJCLCB0cmlhbmdsZXMpOyAvL2ZvciAobGV0IGkgPSAwOyBpIDwgdHJpbWVzaFNoYXBlLmluZGljZXMubGVuZ3RoIC8gMzsgaSsrKSB0cmlhbmdsZXMucHVzaChpKTsgLy8gQWxsCiAgICAgIC8vIFZlcnRpY2VzCgogICAgICBjb25zdCB2ID0gc3BoZXJlVHJpbWVzaF92OwogICAgICBjb25zdCByYWRpdXNTcXVhcmVkID0gc3BoZXJlU2hhcGUucmFkaXVzICogc3BoZXJlU2hhcGUucmFkaXVzOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0cmlhbmdsZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICBmb3IgKGxldCBqID0gMDsgaiA8IDM7IGorKykgewogICAgICAgICAgdHJpbWVzaFNoYXBlLmdldFZlcnRleCh0cmltZXNoU2hhcGUuaW5kaWNlc1t0cmlhbmdsZXNbaV0gKiAzICsgal0sIHYpOyAvLyBDaGVjayB2ZXJ0ZXggb3ZlcmxhcCBpbiBzcGhlcmUKCiAgICAgICAgICB2LnZzdWIobG9jYWxTcGhlcmVQb3MsIHJlbHBvcyk7CgogICAgICAgICAgaWYgKHJlbHBvcy5sZW5ndGhTcXVhcmVkKCkgPD0gcmFkaXVzU3F1YXJlZCkgewogICAgICAgICAgICAvLyBTYWZlIHVwCiAgICAgICAgICAgIHYyLmNvcHkodik7CiAgICAgICAgICAgIFRyYW5zZm9ybS5wb2ludFRvV29ybGRGcmFtZSh0cmltZXNoUG9zLCB0cmltZXNoUXVhdCwgdjIsIHYpOwogICAgICAgICAgICB2LnZzdWIoc3BoZXJlUG9zLCByZWxwb3MpOwoKICAgICAgICAgICAgaWYgKGp1c3RUZXN0KSB7CiAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGxldCByID0gdGhpcy5jcmVhdGVDb250YWN0RXF1YXRpb24oc3BoZXJlQm9keSwgdHJpbWVzaEJvZHksIHNwaGVyZVNoYXBlLCB0cmltZXNoU2hhcGUsIHJzaSwgcnNqKTsKICAgICAgICAgICAgci5uaS5jb3B5KHJlbHBvcyk7CiAgICAgICAgICAgIHIubmkubm9ybWFsaXplKCk7IC8vIHJpIGlzIHRoZSB2ZWN0b3IgZnJvbSBzcGhlcmUgY2VudGVyIHRvIHRoZSBzcGhlcmUgc3VyZmFjZQoKICAgICAgICAgICAgci5yaS5jb3B5KHIubmkpOwogICAgICAgICAgICByLnJpLnNjYWxlKHNwaGVyZVNoYXBlLnJhZGl1cywgci5yaSk7CiAgICAgICAgICAgIHIucmkudmFkZChzcGhlcmVQb3MsIHIucmkpOwogICAgICAgICAgICByLnJpLnZzdWIoc3BoZXJlQm9keS5wb3NpdGlvbiwgci5yaSk7CiAgICAgICAgICAgIHIucmouY29weSh2KTsKICAgICAgICAgICAgci5yai52c3ViKHRyaW1lc2hCb2R5LnBvc2l0aW9uLCByLnJqKTsgLy8gU3RvcmUgcmVzdWx0CgogICAgICAgICAgICB0aGlzLnJlc3VsdC5wdXNoKHIpOwogICAgICAgICAgICB0aGlzLmNyZWF0ZUZyaWN0aW9uRXF1YXRpb25zRnJvbUNvbnRhY3QociwgdGhpcy5mcmljdGlvblJlc3VsdCk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9IC8vIENoZWNrIGFsbCBlZGdlcwoKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdHJpYW5nbGVzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCAzOyBqKyspIHsKICAgICAgICAgIHRyaW1lc2hTaGFwZS5nZXRWZXJ0ZXgodHJpbWVzaFNoYXBlLmluZGljZXNbdHJpYW5nbGVzW2ldICogMyArIGpdLCBlZGdlVmVydGV4QSk7CiAgICAgICAgICB0cmltZXNoU2hhcGUuZ2V0VmVydGV4KHRyaW1lc2hTaGFwZS5pbmRpY2VzW3RyaWFuZ2xlc1tpXSAqIDMgKyAoaiArIDEpICUgM10sIGVkZ2VWZXJ0ZXhCKTsKICAgICAgICAgIGVkZ2VWZXJ0ZXhCLnZzdWIoZWRnZVZlcnRleEEsIGVkZ2VWZWN0b3IpOyAvLyBQcm9qZWN0IHNwaGVyZSBwb3NpdGlvbiB0byB0aGUgZWRnZQoKICAgICAgICAgIGxvY2FsU3BoZXJlUG9zLnZzdWIoZWRnZVZlcnRleEIsIHRtcCk7CiAgICAgICAgICBjb25zdCBwb3NpdGlvbkFsb25nRWRnZUIgPSB0bXAuZG90KGVkZ2VWZWN0b3IpOwogICAgICAgICAgbG9jYWxTcGhlcmVQb3MudnN1YihlZGdlVmVydGV4QSwgdG1wKTsKICAgICAgICAgIGxldCBwb3NpdGlvbkFsb25nRWRnZUEgPSB0bXAuZG90KGVkZ2VWZWN0b3IpOwoKICAgICAgICAgIGlmIChwb3NpdGlvbkFsb25nRWRnZUEgPiAwICYmIHBvc2l0aW9uQWxvbmdFZGdlQiA8IDApIHsKICAgICAgICAgICAgLy8gTm93IGNoZWNrIHRoZSBvcnRob2dvbmFsIGRpc3RhbmNlIGZyb20gZWRnZSB0byBzcGhlcmUgY2VudGVyCiAgICAgICAgICAgIGxvY2FsU3BoZXJlUG9zLnZzdWIoZWRnZVZlcnRleEEsIHRtcCk7CiAgICAgICAgICAgIGVkZ2VWZWN0b3JVbml0LmNvcHkoZWRnZVZlY3Rvcik7CiAgICAgICAgICAgIGVkZ2VWZWN0b3JVbml0Lm5vcm1hbGl6ZSgpOwogICAgICAgICAgICBwb3NpdGlvbkFsb25nRWRnZUEgPSB0bXAuZG90KGVkZ2VWZWN0b3JVbml0KTsKICAgICAgICAgICAgZWRnZVZlY3RvclVuaXQuc2NhbGUocG9zaXRpb25BbG9uZ0VkZ2VBLCB0bXApOwogICAgICAgICAgICB0bXAudmFkZChlZGdlVmVydGV4QSwgdG1wKTsgLy8gdG1wIGlzIG5vdyB0aGUgc3BoZXJlIGNlbnRlciBwb3NpdGlvbiBwcm9qZWN0ZWQgdG8gdGhlIGVkZ2UsIGRlZmluZWQgbG9jYWxseSBpbiB0aGUgdHJpbWVzaCBmcmFtZQoKICAgICAgICAgICAgY29uc3QgZGlzdCA9IHRtcC5kaXN0YW5jZVRvKGxvY2FsU3BoZXJlUG9zKTsKCiAgICAgICAgICAgIGlmIChkaXN0IDwgc3BoZXJlU2hhcGUucmFkaXVzKSB7CiAgICAgICAgICAgICAgaWYgKGp1c3RUZXN0KSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIGNvbnN0IHIgPSB0aGlzLmNyZWF0ZUNvbnRhY3RFcXVhdGlvbihzcGhlcmVCb2R5LCB0cmltZXNoQm9keSwgc3BoZXJlU2hhcGUsIHRyaW1lc2hTaGFwZSwgcnNpLCByc2opOwogICAgICAgICAgICAgIHRtcC52c3ViKGxvY2FsU3BoZXJlUG9zLCByLm5pKTsKICAgICAgICAgICAgICByLm5pLm5vcm1hbGl6ZSgpOwogICAgICAgICAgICAgIHIubmkuc2NhbGUoc3BoZXJlU2hhcGUucmFkaXVzLCByLnJpKTsKICAgICAgICAgICAgICByLnJpLnZhZGQoc3BoZXJlUG9zLCByLnJpKTsKICAgICAgICAgICAgICByLnJpLnZzdWIoc3BoZXJlQm9keS5wb3NpdGlvbiwgci5yaSk7CiAgICAgICAgICAgICAgVHJhbnNmb3JtLnBvaW50VG9Xb3JsZEZyYW1lKHRyaW1lc2hQb3MsIHRyaW1lc2hRdWF0LCB0bXAsIHRtcCk7CiAgICAgICAgICAgICAgdG1wLnZzdWIodHJpbWVzaEJvZHkucG9zaXRpb24sIHIucmopOwogICAgICAgICAgICAgIFRyYW5zZm9ybS52ZWN0b3JUb1dvcmxkRnJhbWUodHJpbWVzaFF1YXQsIHIubmksIHIubmkpOwogICAgICAgICAgICAgIFRyYW5zZm9ybS52ZWN0b3JUb1dvcmxkRnJhbWUodHJpbWVzaFF1YXQsIHIucmksIHIucmkpOwogICAgICAgICAgICAgIHRoaXMucmVzdWx0LnB1c2gocik7CiAgICAgICAgICAgICAgdGhpcy5jcmVhdGVGcmljdGlvbkVxdWF0aW9uc0Zyb21Db250YWN0KHIsIHRoaXMuZnJpY3Rpb25SZXN1bHQpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9IC8vIFRyaWFuZ2xlIGZhY2VzCgoKICAgICAgY29uc3QgdmEgPSBzcGhlcmVUcmltZXNoX3ZhOwogICAgICBjb25zdCB2YiA9IHNwaGVyZVRyaW1lc2hfdmI7CiAgICAgIGNvbnN0IHZjID0gc3BoZXJlVHJpbWVzaF92YzsKICAgICAgY29uc3Qgbm9ybWFsID0gc3BoZXJlVHJpbWVzaF9ub3JtYWw7CgogICAgICBmb3IgKGxldCBpID0gMCwgTiA9IHRyaWFuZ2xlcy5sZW5ndGg7IGkgIT09IE47IGkrKykgewogICAgICAgIHRyaW1lc2hTaGFwZS5nZXRUcmlhbmdsZVZlcnRpY2VzKHRyaWFuZ2xlc1tpXSwgdmEsIHZiLCB2Yyk7CiAgICAgICAgdHJpbWVzaFNoYXBlLmdldE5vcm1hbCh0cmlhbmdsZXNbaV0sIG5vcm1hbCk7CiAgICAgICAgbG9jYWxTcGhlcmVQb3MudnN1Yih2YSwgdG1wKTsKICAgICAgICBsZXQgZGlzdCA9IHRtcC5kb3Qobm9ybWFsKTsKICAgICAgICBub3JtYWwuc2NhbGUoZGlzdCwgdG1wKTsKICAgICAgICBsb2NhbFNwaGVyZVBvcy52c3ViKHRtcCwgdG1wKTsgLy8gdG1wIGlzIG5vdyB0aGUgc3BoZXJlIHBvc2l0aW9uIHByb2plY3RlZCB0byB0aGUgdHJpYW5nbGUgcGxhbmUKCiAgICAgICAgZGlzdCA9IHRtcC5kaXN0YW5jZVRvKGxvY2FsU3BoZXJlUG9zKTsKCiAgICAgICAgaWYgKFJheS5wb2ludEluVHJpYW5nbGUodG1wLCB2YSwgdmIsIHZjKSAmJiBkaXN0IDwgc3BoZXJlU2hhcGUucmFkaXVzKSB7CiAgICAgICAgICBpZiAoanVzdFRlc3QpIHsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICB9CgogICAgICAgICAgbGV0IHIgPSB0aGlzLmNyZWF0ZUNvbnRhY3RFcXVhdGlvbihzcGhlcmVCb2R5LCB0cmltZXNoQm9keSwgc3BoZXJlU2hhcGUsIHRyaW1lc2hTaGFwZSwgcnNpLCByc2opOwogICAgICAgICAgdG1wLnZzdWIobG9jYWxTcGhlcmVQb3MsIHIubmkpOwogICAgICAgICAgci5uaS5ub3JtYWxpemUoKTsKICAgICAgICAgIHIubmkuc2NhbGUoc3BoZXJlU2hhcGUucmFkaXVzLCByLnJpKTsKICAgICAgICAgIHIucmkudmFkZChzcGhlcmVQb3MsIHIucmkpOwogICAgICAgICAgci5yaS52c3ViKHNwaGVyZUJvZHkucG9zaXRpb24sIHIucmkpOwogICAgICAgICAgVHJhbnNmb3JtLnBvaW50VG9Xb3JsZEZyYW1lKHRyaW1lc2hQb3MsIHRyaW1lc2hRdWF0LCB0bXAsIHRtcCk7CiAgICAgICAgICB0bXAudnN1Yih0cmltZXNoQm9keS5wb3NpdGlvbiwgci5yaik7CiAgICAgICAgICBUcmFuc2Zvcm0udmVjdG9yVG9Xb3JsZEZyYW1lKHRyaW1lc2hRdWF0LCByLm5pLCByLm5pKTsKICAgICAgICAgIFRyYW5zZm9ybS52ZWN0b3JUb1dvcmxkRnJhbWUodHJpbWVzaFF1YXQsIHIucmksIHIucmkpOwogICAgICAgICAgdGhpcy5yZXN1bHQucHVzaChyKTsKICAgICAgICAgIHRoaXMuY3JlYXRlRnJpY3Rpb25FcXVhdGlvbnNGcm9tQ29udGFjdChyLCB0aGlzLmZyaWN0aW9uUmVzdWx0KTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIHRyaWFuZ2xlcy5sZW5ndGggPSAwOwogICAgfQoKICAgIHBsYW5lVHJpbWVzaChwbGFuZVNoYXBlLCB0cmltZXNoU2hhcGUsIHBsYW5lUG9zLCB0cmltZXNoUG9zLCBwbGFuZVF1YXQsIHRyaW1lc2hRdWF0LCBwbGFuZUJvZHksIHRyaW1lc2hCb2R5LCByc2ksIHJzaiwganVzdFRlc3QpIHsKICAgICAgLy8gTWFrZSBjb250YWN0cyEKICAgICAgY29uc3QgdiA9IG5ldyBWZWMzKCk7CiAgICAgIGNvbnN0IG5vcm1hbCA9IHBsYW5lVHJpbWVzaF9ub3JtYWw7CiAgICAgIG5vcm1hbC5zZXQoMCwgMCwgMSk7CiAgICAgIHBsYW5lUXVhdC52bXVsdChub3JtYWwsIG5vcm1hbCk7IC8vIFR1cm4gbm9ybWFsIGFjY29yZGluZyB0byBwbGFuZQoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0cmltZXNoU2hhcGUudmVydGljZXMubGVuZ3RoIC8gMzsgaSsrKSB7CiAgICAgICAgLy8gR2V0IHdvcmxkIHZlcnRleCBmcm9tIHRyaW1lc2gKICAgICAgICB0cmltZXNoU2hhcGUuZ2V0VmVydGV4KGksIHYpOyAvLyBTYWZlIHVwCgogICAgICAgIGNvbnN0IHYyID0gbmV3IFZlYzMoKTsKICAgICAgICB2Mi5jb3B5KHYpOwogICAgICAgIFRyYW5zZm9ybS5wb2ludFRvV29ybGRGcmFtZSh0cmltZXNoUG9zLCB0cmltZXNoUXVhdCwgdjIsIHYpOyAvLyBDaGVjayBwbGFuZSBzaWRlCgogICAgICAgIGNvbnN0IHJlbHBvcyA9IHBsYW5lVHJpbWVzaF9yZWxwb3M7CiAgICAgICAgdi52c3ViKHBsYW5lUG9zLCByZWxwb3MpOwogICAgICAgIGNvbnN0IGRvdCA9IG5vcm1hbC5kb3QocmVscG9zKTsKCiAgICAgICAgaWYgKGRvdCA8PSAwLjApIHsKICAgICAgICAgIGlmIChqdXN0VGVzdCkgewogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgIH0KCiAgICAgICAgICBjb25zdCByID0gdGhpcy5jcmVhdGVDb250YWN0RXF1YXRpb24ocGxhbmVCb2R5LCB0cmltZXNoQm9keSwgcGxhbmVTaGFwZSwgdHJpbWVzaFNoYXBlLCByc2ksIHJzaik7CiAgICAgICAgICByLm5pLmNvcHkobm9ybWFsKTsgLy8gQ29udGFjdCBub3JtYWwgaXMgdGhlIHBsYW5lIG5vcm1hbAogICAgICAgICAgLy8gR2V0IHZlcnRleCBwb3NpdGlvbiBwcm9qZWN0ZWQgb24gcGxhbmUKCiAgICAgICAgICBjb25zdCBwcm9qZWN0ZWQgPSBwbGFuZVRyaW1lc2hfcHJvamVjdGVkOwogICAgICAgICAgbm9ybWFsLnNjYWxlKHJlbHBvcy5kb3Qobm9ybWFsKSwgcHJvamVjdGVkKTsKICAgICAgICAgIHYudnN1Yihwcm9qZWN0ZWQsIHByb2plY3RlZCk7IC8vIHJpIGlzIHRoZSBwcm9qZWN0ZWQgd29ybGQgcG9zaXRpb24gbWludXMgcGxhbmUgcG9zaXRpb24KCiAgICAgICAgICByLnJpLmNvcHkocHJvamVjdGVkKTsKICAgICAgICAgIHIucmkudnN1YihwbGFuZUJvZHkucG9zaXRpb24sIHIucmkpOwogICAgICAgICAgci5yai5jb3B5KHYpOwogICAgICAgICAgci5yai52c3ViKHRyaW1lc2hCb2R5LnBvc2l0aW9uLCByLnJqKTsgLy8gU3RvcmUgcmVzdWx0CgogICAgICAgICAgdGhpcy5yZXN1bHQucHVzaChyKTsKICAgICAgICAgIHRoaXMuY3JlYXRlRnJpY3Rpb25FcXVhdGlvbnNGcm9tQ29udGFjdChyLCB0aGlzLmZyaWN0aW9uUmVzdWx0KTsKICAgICAgICB9CiAgICAgIH0KICAgIH0gLy8gY29udmV4VHJpbWVzaCgKICAgIC8vICAgc2k6IENvbnZleFBvbHloZWRyb24sIHNqOiBUcmltZXNoLCB4aTogVmVjMywgeGo6IFZlYzMsIHFpOiBRdWF0ZXJuaW9uLCBxajogUXVhdGVybmlvbiwKICAgIC8vICAgYmk6IEJvZHksIGJqOiBCb2R5LCByc2k/OiBTaGFwZSB8IG51bGwsIHJzaj86IFNoYXBlIHwgbnVsbCwKICAgIC8vICAgZmFjZUxpc3RBPzogbnVtYmVyW10gfCBudWxsLCBmYWNlTGlzdEI/OiBudW1iZXJbXSB8IG51bGwsCiAgICAvLyApIHsKICAgIC8vICAgY29uc3Qgc2VwQXhpcyA9IGNvbnZleENvbnZleF9zZXBBeGlzOwogICAgLy8gICBpZih4aS5kaXN0YW5jZVRvKHhqKSA+IHNpLmJvdW5kaW5nU3BoZXJlUmFkaXVzICsgc2ouYm91bmRpbmdTcGhlcmVSYWRpdXMpewogICAgLy8gICAgICAgcmV0dXJuOwogICAgLy8gICB9CiAgICAvLyAgIC8vIENvbnN0cnVjdCBhIHRlbXAgaHVsbCBmb3IgZWFjaCB0cmlhbmdsZQogICAgLy8gICBjb25zdCBodWxsQiA9IG5ldyBDb252ZXhQb2x5aGVkcm9uKCk7CiAgICAvLyAgIGh1bGxCLmZhY2VzID0gW1swLDEsMl1dOwogICAgLy8gICBjb25zdCB2YSA9IG5ldyBWZWMzKCk7CiAgICAvLyAgIGNvbnN0IHZiID0gbmV3IFZlYzMoKTsKICAgIC8vICAgY29uc3QgdmMgPSBuZXcgVmVjMygpOwogICAgLy8gICBodWxsQi52ZXJ0aWNlcyA9IFsKICAgIC8vICAgICAgIHZhLAogICAgLy8gICAgICAgdmIsCiAgICAvLyAgICAgICB2YwogICAgLy8gICBdOwogICAgLy8gICBmb3IgKGxldCBpID0gMDsgaSA8IHNqLmluZGljZXMubGVuZ3RoIC8gMzsgaSsrKSB7CiAgICAvLyAgICAgICBjb25zdCB0cmlhbmdsZU5vcm1hbCA9IG5ldyBWZWMzKCk7CiAgICAvLyAgICAgICBzai5nZXROb3JtYWwoaSwgdHJpYW5nbGVOb3JtYWwpOwogICAgLy8gICAgICAgaHVsbEIuZmFjZU5vcm1hbHMgPSBbdHJpYW5nbGVOb3JtYWxdOwogICAgLy8gICAgICAgc2ouZ2V0VHJpYW5nbGVWZXJ0aWNlcyhpLCB2YSwgdmIsIHZjKTsKICAgIC8vICAgICAgIGxldCBkID0gc2kudGVzdFNlcEF4aXModHJpYW5nbGVOb3JtYWwsIGh1bGxCLCB4aSwgcWksIHhqLCBxaik7CiAgICAvLyAgICAgICBpZighZCl7CiAgICAvLyAgICAgICAgICAgdHJpYW5nbGVOb3JtYWwuc2NhbGUoLTEsIHRyaWFuZ2xlTm9ybWFsKTsKICAgIC8vICAgICAgICAgICBkID0gc2kudGVzdFNlcEF4aXModHJpYW5nbGVOb3JtYWwsIGh1bGxCLCB4aSwgcWksIHhqLCBxaik7CiAgICAvLyAgICAgICAgICAgaWYoIWQpewogICAgLy8gICAgICAgICAgICAgICBjb250aW51ZTsKICAgIC8vICAgICAgICAgICB9CiAgICAvLyAgICAgICB9CiAgICAvLyAgICAgICBjb25zdCByZXM6IENvbnZleFBvbHloZWRyb25Db250YWN0UG9pbnRbXSA9IFtdOwogICAgLy8gICAgICAgY29uc3QgcSA9IGNvbnZleENvbnZleF9xOwogICAgLy8gICAgICAgc2kuY2xpcEFnYWluc3RIdWxsKHhpLHFpLGh1bGxCLHhqLHFqLHRyaWFuZ2xlTm9ybWFsLC0xMDAsMTAwLHJlcyk7CiAgICAvLyAgICAgICBmb3IobGV0IGogPSAwOyBqICE9PSByZXMubGVuZ3RoOyBqKyspewogICAgLy8gICAgICAgICAgIGNvbnN0IHIgPSB0aGlzLmNyZWF0ZUNvbnRhY3RFcXVhdGlvbihiaSxiaixzaSxzaixyc2kscnNqKSwKICAgIC8vICAgICAgICAgICAgICAgcmkgPSByLnJpLAogICAgLy8gICAgICAgICAgICAgICByaiA9IHIucmo7CiAgICAvLyAgICAgICAgICAgci5uaS5jb3B5KHRyaWFuZ2xlTm9ybWFsKTsKICAgIC8vICAgICAgICAgICByLm5pLm5lZ2F0ZShyLm5pKTsKICAgIC8vICAgICAgICAgICByZXNbal0ubm9ybWFsLm5lZ2F0ZShxKTsKICAgIC8vICAgICAgICAgICBxLm11bHQocmVzW2pdLmRlcHRoLCBxKTsKICAgIC8vICAgICAgICAgICByZXNbal0ucG9pbnQudmFkZChxLCByaSk7CiAgICAvLyAgICAgICAgICAgcmouY29weShyZXNbal0ucG9pbnQpOwogICAgLy8gICAgICAgICAgIC8vIENvbnRhY3QgcG9pbnRzIGFyZSBpbiB3b3JsZCBjb29yZGluYXRlcy4gVHJhbnNmb3JtIGJhY2sgdG8gcmVsYXRpdmUKICAgIC8vICAgICAgICAgICByaS52c3ViKHhpLHJpKTsKICAgIC8vICAgICAgICAgICByai52c3ViKHhqLHJqKTsKICAgIC8vICAgICAgICAgICAvLyBNYWtlIHJlbGF0aXZlIHRvIGJvZGllcwogICAgLy8gICAgICAgICAgIHJpLnZhZGQoeGksIHJpKTsKICAgIC8vICAgICAgICAgICByaS52c3ViKGJpLnBvc2l0aW9uLCByaSk7CiAgICAvLyAgICAgICAgICAgcmoudmFkZCh4aiwgcmopOwogICAgLy8gICAgICAgICAgIHJqLnZzdWIoYmoucG9zaXRpb24sIHJqKTsKICAgIC8vICAgICAgICAgICByZXN1bHQucHVzaChyKTsKICAgIC8vICAgICAgIH0KICAgIC8vICAgfQogICAgLy8gfQoKCiAgfQogIGNvbnN0IGF2ZXJhZ2VOb3JtYWwgPSBuZXcgVmVjMygpOwogIGNvbnN0IGF2ZXJhZ2VDb250YWN0UG9pbnRBID0gbmV3IFZlYzMoKTsKICBjb25zdCBhdmVyYWdlQ29udGFjdFBvaW50QiA9IG5ldyBWZWMzKCk7CiAgY29uc3QgdG1wVmVjMSA9IG5ldyBWZWMzKCk7CiAgY29uc3QgdG1wVmVjMiA9IG5ldyBWZWMzKCk7CiAgY29uc3QgdG1wUXVhdDEgPSBuZXcgUXVhdGVybmlvbigpOwogIGNvbnN0IHRtcFF1YXQyID0gbmV3IFF1YXRlcm5pb24oKTsKCiAgY29uc3QgcGxhbmVUcmltZXNoX25vcm1hbCA9IG5ldyBWZWMzKCk7CiAgY29uc3QgcGxhbmVUcmltZXNoX3JlbHBvcyA9IG5ldyBWZWMzKCk7CiAgY29uc3QgcGxhbmVUcmltZXNoX3Byb2plY3RlZCA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlVHJpbWVzaF9ub3JtYWwgPSBuZXcgVmVjMygpOwogIGNvbnN0IHNwaGVyZVRyaW1lc2hfcmVscG9zID0gbmV3IFZlYzMoKTsKICBuZXcgVmVjMygpOwogIGNvbnN0IHNwaGVyZVRyaW1lc2hfdiA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlVHJpbWVzaF92MiA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlVHJpbWVzaF9lZGdlVmVydGV4QSA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlVHJpbWVzaF9lZGdlVmVydGV4QiA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlVHJpbWVzaF9lZGdlVmVjdG9yID0gbmV3IFZlYzMoKTsKICBjb25zdCBzcGhlcmVUcmltZXNoX2VkZ2VWZWN0b3JVbml0ID0gbmV3IFZlYzMoKTsKICBjb25zdCBzcGhlcmVUcmltZXNoX2xvY2FsU3BoZXJlUG9zID0gbmV3IFZlYzMoKTsKICBjb25zdCBzcGhlcmVUcmltZXNoX3RtcCA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlVHJpbWVzaF92YSA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlVHJpbWVzaF92YiA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlVHJpbWVzaF92YyA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlVHJpbWVzaF9sb2NhbFNwaGVyZUFBQkIgPSBuZXcgQUFCQigpOwogIGNvbnN0IHNwaGVyZVRyaW1lc2hfdHJpYW5nbGVzID0gW107CiAgY29uc3QgcG9pbnRfb25fcGxhbmVfdG9fc3BoZXJlID0gbmV3IFZlYzMoKTsKICBjb25zdCBwbGFuZV90b19zcGhlcmVfb3J0aG8gPSBuZXcgVmVjMygpOyAvLyBTZWUgaHR0cDovL2J1bGxldHBoeXNpY3MuY29tL0J1bGxldC9CdWxsZXRGdWxsL1NwaGVyZVRyaWFuZ2xlRGV0ZWN0b3JfOGNwcF9zb3VyY2UuaHRtbAoKICBjb25zdCBwb2ludEluUG9seWdvbl9lZGdlID0gbmV3IFZlYzMoKTsKICBjb25zdCBwb2ludEluUG9seWdvbl9lZGdlX3hfbm9ybWFsID0gbmV3IFZlYzMoKTsKICBjb25zdCBwb2ludEluUG9seWdvbl92dHAgPSBuZXcgVmVjMygpOwoKICBmdW5jdGlvbiBwb2ludEluUG9seWdvbih2ZXJ0cywgbm9ybWFsLCBwKSB7CiAgICBsZXQgcG9zaXRpdmVSZXN1bHQgPSBudWxsOwogICAgY29uc3QgTiA9IHZlcnRzLmxlbmd0aDsKCiAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gTjsgaSsrKSB7CiAgICAgIGNvbnN0IHYgPSB2ZXJ0c1tpXTsgLy8gR2V0IGVkZ2UgdG8gdGhlIG5leHQgdmVydGV4CgogICAgICBjb25zdCBlZGdlID0gcG9pbnRJblBvbHlnb25fZWRnZTsKICAgICAgdmVydHNbKGkgKyAxKSAlIE5dLnZzdWIodiwgZWRnZSk7IC8vIEdldCBjcm9zcyBwcm9kdWN0IGJldHdlZW4gcG9seWdvbiBub3JtYWwgYW5kIHRoZSBlZGdlCgogICAgICBjb25zdCBlZGdlX3hfbm9ybWFsID0gcG9pbnRJblBvbHlnb25fZWRnZV94X25vcm1hbDsgLy9jb25zdCBlZGdlX3hfbm9ybWFsID0gbmV3IFZlYzMoKTsKCiAgICAgIGVkZ2UuY3Jvc3Mobm9ybWFsLCBlZGdlX3hfbm9ybWFsKTsgLy8gR2V0IHZlY3RvciBiZXR3ZWVuIHBvaW50IGFuZCBjdXJyZW50IHZlcnRleAoKICAgICAgY29uc3QgdmVydGV4X3RvX3AgPSBwb2ludEluUG9seWdvbl92dHA7CiAgICAgIHAudnN1Yih2LCB2ZXJ0ZXhfdG9fcCk7IC8vIFRoaXMgZG90IHByb2R1Y3QgZGV0ZXJtaW5lcyB3aGljaCBzaWRlIG9mIHRoZSBlZGdlIHRoZSBwb2ludCBpcwoKICAgICAgY29uc3QgciA9IGVkZ2VfeF9ub3JtYWwuZG90KHZlcnRleF90b19wKTsgLy8gSWYgYWxsIHN1Y2ggZG90IHByb2R1Y3RzIGhhdmUgc2FtZSBzaWduLCB3ZSBhcmUgaW5zaWRlIHRoZSBwb2x5Z29uLgoKICAgICAgaWYgKHBvc2l0aXZlUmVzdWx0ID09PSBudWxsIHx8IHIgPiAwICYmIHBvc2l0aXZlUmVzdWx0ID09PSB0cnVlIHx8IHIgPD0gMCAmJiBwb3NpdGl2ZVJlc3VsdCA9PT0gZmFsc2UpIHsKICAgICAgICBpZiAocG9zaXRpdmVSZXN1bHQgPT09IG51bGwpIHsKICAgICAgICAgIHBvc2l0aXZlUmVzdWx0ID0gciA+IDA7CiAgICAgICAgfQoKICAgICAgICBjb250aW51ZTsKICAgICAgfSBlbHNlIHsKICAgICAgICByZXR1cm4gZmFsc2U7IC8vIEVuY291bnRlcmVkIHNvbWUgb3RoZXIgc2lnbi4gRXhpdC4KICAgICAgfQogICAgfSAvLyBJZiB3ZSBnb3QgaGVyZSwgYWxsIGRvdCBwcm9kdWN0cyB3ZXJlIG9mIHRoZSBzYW1lIHNpZ24uCgoKICAgIHJldHVybiB0cnVlOwogIH0KCiAgY29uc3QgYm94X3RvX3NwaGVyZSA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlQm94X25zID0gbmV3IFZlYzMoKTsKICBjb25zdCBzcGhlcmVCb3hfbnMxID0gbmV3IFZlYzMoKTsKICBjb25zdCBzcGhlcmVCb3hfbnMyID0gbmV3IFZlYzMoKTsKICBjb25zdCBzcGhlcmVCb3hfc2lkZXMgPSBbbmV3IFZlYzMoKSwgbmV3IFZlYzMoKSwgbmV3IFZlYzMoKSwgbmV3IFZlYzMoKSwgbmV3IFZlYzMoKSwgbmV3IFZlYzMoKV07CiAgY29uc3Qgc3BoZXJlQm94X3NwaGVyZV90b19jb3JuZXIgPSBuZXcgVmVjMygpOwogIGNvbnN0IHNwaGVyZUJveF9zaWRlX25zID0gbmV3IFZlYzMoKTsKICBjb25zdCBzcGhlcmVCb3hfc2lkZV9uczEgPSBuZXcgVmVjMygpOwogIGNvbnN0IHNwaGVyZUJveF9zaWRlX25zMiA9IG5ldyBWZWMzKCk7CiAgY29uc3QgY29udmV4X3RvX3NwaGVyZSA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlQ29udmV4X2VkZ2UgPSBuZXcgVmVjMygpOwogIGNvbnN0IHNwaGVyZUNvbnZleF9lZGdlVW5pdCA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlQ29udmV4X3NwaGVyZVRvQ29ybmVyID0gbmV3IFZlYzMoKTsKICBjb25zdCBzcGhlcmVDb252ZXhfd29ybGRDb3JuZXIgPSBuZXcgVmVjMygpOwogIGNvbnN0IHNwaGVyZUNvbnZleF93b3JsZE5vcm1hbCA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlQ29udmV4X3dvcmxkUG9pbnQgPSBuZXcgVmVjMygpOwogIGNvbnN0IHNwaGVyZUNvbnZleF93b3JsZFNwaGVyZVBvaW50Q2xvc2VzdFRvUGxhbmUgPSBuZXcgVmVjMygpOwogIGNvbnN0IHNwaGVyZUNvbnZleF9wZW5ldHJhdGlvblZlYyA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlQ29udmV4X3NwaGVyZVRvV29ybGRQb2ludCA9IG5ldyBWZWMzKCk7CiAgbmV3IFZlYzMoKTsKICBuZXcgVmVjMygpOwogIGNvbnN0IHBsYW5lQ29udmV4X3YgPSBuZXcgVmVjMygpOwogIGNvbnN0IHBsYW5lQ29udmV4X25vcm1hbCA9IG5ldyBWZWMzKCk7CiAgY29uc3QgcGxhbmVDb252ZXhfcmVscG9zID0gbmV3IFZlYzMoKTsKICBjb25zdCBwbGFuZUNvbnZleF9wcm9qZWN0ZWQgPSBuZXcgVmVjMygpOwogIGNvbnN0IGNvbnZleENvbnZleF9zZXBBeGlzID0gbmV3IFZlYzMoKTsKICBjb25zdCBjb252ZXhDb252ZXhfcSA9IG5ldyBWZWMzKCk7CiAgY29uc3QgcGFydGljbGVQbGFuZV9ub3JtYWwgPSBuZXcgVmVjMygpOwogIGNvbnN0IHBhcnRpY2xlUGxhbmVfcmVscG9zID0gbmV3IFZlYzMoKTsKICBjb25zdCBwYXJ0aWNsZVBsYW5lX3Byb2plY3RlZCA9IG5ldyBWZWMzKCk7CiAgY29uc3QgcGFydGljbGVTcGhlcmVfbm9ybWFsID0gbmV3IFZlYzMoKTsgLy8gV0lQCgogIGNvbnN0IGNxaiA9IG5ldyBRdWF0ZXJuaW9uKCk7CiAgY29uc3QgY29udmV4UGFydGljbGVfbG9jYWwgPSBuZXcgVmVjMygpOwogIG5ldyBWZWMzKCk7CiAgY29uc3QgY29udmV4UGFydGljbGVfcGVuZXRyYXRlZEZhY2VOb3JtYWwgPSBuZXcgVmVjMygpOwogIGNvbnN0IGNvbnZleFBhcnRpY2xlX3ZlcnRleFRvUGFydGljbGUgPSBuZXcgVmVjMygpOwogIGNvbnN0IGNvbnZleFBhcnRpY2xlX3dvcmxkUGVuZXRyYXRpb25WZWMgPSBuZXcgVmVjMygpOwogIGNvbnN0IGNvbnZleEhlaWdodGZpZWxkX3RtcDEgPSBuZXcgVmVjMygpOwogIGNvbnN0IGNvbnZleEhlaWdodGZpZWxkX3RtcDIgPSBuZXcgVmVjMygpOwogIGNvbnN0IGNvbnZleEhlaWdodGZpZWxkX2ZhY2VMaXN0ID0gWzBdOwogIGNvbnN0IHNwaGVyZUhlaWdodGZpZWxkX3RtcDEgPSBuZXcgVmVjMygpOwogIGNvbnN0IHNwaGVyZUhlaWdodGZpZWxkX3RtcDIgPSBuZXcgVmVjMygpOwoKICBjbGFzcyBPdmVybGFwS2VlcGVyIHsKICAgIC8qKgogICAgICogQHRvZG8gUmVtb3ZlIHVzZWxlc3MgY29uc3RydWN0b3IKICAgICAqLwogICAgY29uc3RydWN0b3IoKSB7CiAgICAgIHRoaXMuY3VycmVudCA9IFtdOwogICAgICB0aGlzLnByZXZpb3VzID0gW107CiAgICB9CiAgICAvKioKICAgICAqIGdldEtleQogICAgICovCgoKICAgIGdldEtleShpLCBqKSB7CiAgICAgIGlmIChqIDwgaSkgewogICAgICAgIGNvbnN0IHRlbXAgPSBqOwogICAgICAgIGogPSBpOwogICAgICAgIGkgPSB0ZW1wOwogICAgICB9CgogICAgICByZXR1cm4gaSA8PCAxNiB8IGo7CiAgICB9CiAgICAvKioKICAgICAqIHNldAogICAgICovCgoKICAgIHNldChpLCBqKSB7CiAgICAgIC8vIEluc2VydGlvbiBzb3J0LiBUaGlzIHdheSB0aGUgZGlmZiB3aWxsIGhhdmUgbGluZWFyIGNvbXBsZXhpdHkuCiAgICAgIGNvbnN0IGtleSA9IHRoaXMuZ2V0S2V5KGksIGopOwogICAgICBjb25zdCBjdXJyZW50ID0gdGhpcy5jdXJyZW50OwogICAgICBsZXQgaW5kZXggPSAwOwoKICAgICAgd2hpbGUgKGtleSA+IGN1cnJlbnRbaW5kZXhdKSB7CiAgICAgICAgaW5kZXgrKzsKICAgICAgfQoKICAgICAgaWYgKGtleSA9PT0gY3VycmVudFtpbmRleF0pIHsKICAgICAgICByZXR1cm47IC8vIFBhaXIgd2FzIGFscmVhZHkgYWRkZWQKICAgICAgfQoKICAgICAgZm9yIChsZXQgaiA9IGN1cnJlbnQubGVuZ3RoIC0gMTsgaiA+PSBpbmRleDsgai0tKSB7CiAgICAgICAgY3VycmVudFtqICsgMV0gPSBjdXJyZW50W2pdOwogICAgICB9CgogICAgICBjdXJyZW50W2luZGV4XSA9IGtleTsKICAgIH0KICAgIC8qKgogICAgICogdGljawogICAgICovCgoKICAgIHRpY2soKSB7CiAgICAgIGNvbnN0IHRtcCA9IHRoaXMuY3VycmVudDsKICAgICAgdGhpcy5jdXJyZW50ID0gdGhpcy5wcmV2aW91czsKICAgICAgdGhpcy5wcmV2aW91cyA9IHRtcDsKICAgICAgdGhpcy5jdXJyZW50Lmxlbmd0aCA9IDA7CiAgICB9CiAgICAvKioKICAgICAqIGdldERpZmYKICAgICAqLwoKCiAgICBnZXREaWZmKGFkZGl0aW9ucywgcmVtb3ZhbHMpIHsKICAgICAgY29uc3QgYSA9IHRoaXMuY3VycmVudDsKICAgICAgY29uc3QgYiA9IHRoaXMucHJldmlvdXM7CiAgICAgIGNvbnN0IGFsID0gYS5sZW5ndGg7CiAgICAgIGNvbnN0IGJsID0gYi5sZW5ndGg7CiAgICAgIGxldCBqID0gMDsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgYWw7IGkrKykgewogICAgICAgIGxldCBmb3VuZCA9IGZhbHNlOwogICAgICAgIGNvbnN0IGtleUEgPSBhW2ldOwoKICAgICAgICB3aGlsZSAoa2V5QSA+IGJbal0pIHsKICAgICAgICAgIGorKzsKICAgICAgICB9CgogICAgICAgIGZvdW5kID0ga2V5QSA9PT0gYltqXTsKCiAgICAgICAgaWYgKCFmb3VuZCkgewogICAgICAgICAgdW5wYWNrQW5kUHVzaChhZGRpdGlvbnMsIGtleUEpOwogICAgICAgIH0KICAgICAgfQoKICAgICAgaiA9IDA7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGJsOyBpKyspIHsKICAgICAgICBsZXQgZm91bmQgPSBmYWxzZTsKICAgICAgICBjb25zdCBrZXlCID0gYltpXTsKCiAgICAgICAgd2hpbGUgKGtleUIgPiBhW2pdKSB7CiAgICAgICAgICBqKys7CiAgICAgICAgfQoKICAgICAgICBmb3VuZCA9IGFbal0gPT09IGtleUI7CgogICAgICAgIGlmICghZm91bmQpIHsKICAgICAgICAgIHVucGFja0FuZFB1c2gocmVtb3ZhbHMsIGtleUIpOwogICAgICAgIH0KICAgICAgfQogICAgfQoKICB9CgogIGZ1bmN0aW9uIHVucGFja0FuZFB1c2goYXJyYXksIGtleSkgewogICAgYXJyYXkucHVzaCgoa2V5ICYgMHhmZmZmMDAwMCkgPj4gMTYsIGtleSAmIDB4MDAwMGZmZmYpOwogIH0KCiAgY29uc3QgZ2V0S2V5ID0gKGksIGopID0+IGkgPCBqID8gYCR7aX0tJHtqfWAgOiBgJHtqfS0ke2l9YDsKICAvKioKICAgKiBUdXBsZURpY3Rpb25hcnkKICAgKi8KCgogIGNsYXNzIFR1cGxlRGljdGlvbmFyeSB7CiAgICBjb25zdHJ1Y3RvcigpIHsKICAgICAgdGhpcy5kYXRhID0gewogICAgICAgIGtleXM6IFtdCiAgICAgIH07CiAgICB9CgogICAgLyoqIGdldCAqLwogICAgZ2V0KGksIGopIHsKICAgICAgY29uc3Qga2V5ID0gZ2V0S2V5KGksIGopOwogICAgICByZXR1cm4gdGhpcy5kYXRhW2tleV07CiAgICB9CiAgICAvKiogc2V0ICovCgoKICAgIHNldChpLCBqLCB2YWx1ZSkgewogICAgICBjb25zdCBrZXkgPSBnZXRLZXkoaSwgaik7IC8vIENoZWNrIGlmIGtleSBhbHJlYWR5IGV4aXN0cwoKICAgICAgaWYgKCF0aGlzLmdldChpLCBqKSkgewogICAgICAgIHRoaXMuZGF0YS5rZXlzLnB1c2goa2V5KTsKICAgICAgfQoKICAgICAgdGhpcy5kYXRhW2tleV0gPSB2YWx1ZTsKICAgIH0KICAgIC8qKiBkZWxldGUgKi8KCgogICAgZGVsZXRlKGksIGopIHsKICAgICAgY29uc3Qga2V5ID0gZ2V0S2V5KGksIGopOwogICAgICBjb25zdCBpbmRleCA9IHRoaXMuZGF0YS5rZXlzLmluZGV4T2Yoa2V5KTsKCiAgICAgIGlmIChpbmRleCAhPT0gLTEpIHsKICAgICAgICB0aGlzLmRhdGEua2V5cy5zcGxpY2UoaW5kZXgsIDEpOwogICAgICB9CgogICAgICBkZWxldGUgdGhpcy5kYXRhW2tleV07CiAgICB9CiAgICAvKiogcmVzZXQgKi8KCgogICAgcmVzZXQoKSB7CiAgICAgIGNvbnN0IGRhdGEgPSB0aGlzLmRhdGE7CiAgICAgIGNvbnN0IGtleXMgPSBkYXRhLmtleXM7CgogICAgICB3aGlsZSAoa2V5cy5sZW5ndGggPiAwKSB7CiAgICAgICAgY29uc3Qga2V5ID0ga2V5cy5wb3AoKTsKICAgICAgICBkZWxldGUgZGF0YVtrZXldOwogICAgICB9CiAgICB9CgogIH0KCiAgLyoqCiAgICogVGhlIHBoeXNpY3Mgd29ybGQKICAgKi8KICBjbGFzcyBXb3JsZCBleHRlbmRzIEV2ZW50VGFyZ2V0IHsKICAgIC8qKgogICAgICogQ3VycmVudGx5IC8gbGFzdCB1c2VkIHRpbWVzdGVwLiBJcyBzZXQgdG8gLTEgaWYgbm90IGF2YWlsYWJsZS4gVGhpcyB2YWx1ZSBpcyB1cGRhdGVkIGJlZm9yZSBlYWNoIGludGVybmFsIHN0ZXAsIHdoaWNoIG1lYW5zIHRoYXQgaXQgaXMgImZyZXNoIiBpbnNpZGUgZXZlbnQgY2FsbGJhY2tzLgogICAgICovCgogICAgLyoqCiAgICAgKiBNYWtlcyBib2RpZXMgZ28gdG8gc2xlZXAgd2hlbiB0aGV5J3ZlIGJlZW4gaW5hY3RpdmUuCiAgICAgKiBAZGVmYXVsdCBmYWxzZQogICAgICovCgogICAgLyoqCiAgICAgKiBBbGwgdGhlIGN1cnJlbnQgY29udGFjdHMgKGluc3RhbmNlcyBvZiBDb250YWN0RXF1YXRpb24pIGluIHRoZSB3b3JsZC4KICAgICAqLwoKICAgIC8qKgogICAgICogSG93IG9mdGVuIHRvIG5vcm1hbGl6ZSBxdWF0ZXJuaW9ucy4gU2V0IHRvIDAgZm9yIGV2ZXJ5IHN0ZXAsIDEgZm9yIGV2ZXJ5IHNlY29uZCBldGMuLiBBIGxhcmdlciB2YWx1ZSBpbmNyZWFzZXMgcGVyZm9ybWFuY2UuIElmIGJvZGllcyB0ZW5kIHRvIGV4cGxvZGUsIHNldCB0byBhIHNtYWxsZXIgdmFsdWUgKHplcm8gdG8gYmUgc3VyZSBub3RoaW5nIGNhbiBnbyB3cm9uZykuCiAgICAgKiBAZGVmYXVsdCAwCiAgICAgKi8KCiAgICAvKioKICAgICAqIFNldCB0byB0cnVlIHRvIHVzZSBmYXN0IHF1YXRlcm5pb24gbm9ybWFsaXphdGlvbi4gSXQgaXMgb2Z0ZW4gZW5vdWdoIGFjY3VyYXRlIHRvIHVzZS4KICAgICAqIElmIGJvZGllcyB0ZW5kIHRvIGV4cGxvZGUsIHNldCB0byBmYWxzZS4KICAgICAqIEBkZWZhdWx0IGZhbHNlCiAgICAgKi8KCiAgICAvKioKICAgICAqIFRoZSB3YWxsLWNsb2NrIHRpbWUgc2luY2Ugc2ltdWxhdGlvbiBzdGFydC4KICAgICAqLwoKICAgIC8qKgogICAgICogTnVtYmVyIG9mIHRpbWVzdGVwcyB0YWtlbiBzaW5jZSBzdGFydC4KICAgICAqLwoKICAgIC8qKgogICAgICogRGVmYXVsdCBhbmQgbGFzdCB0aW1lc3RlcCBzaXplcy4KICAgICAqLwoKICAgIC8qKgogICAgICogVGhlIGdyYXZpdHkgb2YgdGhlIHdvcmxkLgogICAgICovCgogICAgLyoqCiAgICAgKiBHcmF2aXR5IHRvIHVzZSB3aGVuIGFwcHJveGltYXRpbmcgdGhlIGZyaWN0aW9uIG1heCBmb3JjZSAobXUqbWFzcypncmF2aXR5KS4KICAgICAqIElmIHVuZGVmaW5lZCwgZ2xvYmFsIGdyYXZpdHkgd2lsbCBiZSB1c2VkLgogICAgICogVXNlIHRvIGVuYWJsZSBmcmljdGlvbiBpbiBhIFdvcmxkIHdpdGggYSBudWxsIGdyYXZpdHkgdmVjdG9yIChubyBncmF2aXR5KS4KICAgICAqLwoKICAgIC8qKgogICAgICogVGhlIGJyb2FkcGhhc2UgYWxnb3JpdGhtIHRvIHVzZS4KICAgICAqIEBkZWZhdWx0IE5haXZlQnJvYWRwaGFzZQogICAgICovCgogICAgLyoqCiAgICAgKiBBbGwgYm9kaWVzIGluIHRoaXMgd29ybGQKICAgICAqLwoKICAgIC8qKgogICAgICogVHJ1ZSBpZiBhbnkgYm9kaWVzIGFyZSBub3Qgc2xlZXBpbmcsIGZhbHNlIGlmIGV2ZXJ5IGJvZHkgaXMgc2xlZXBpbmcuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFRoZSBzb2x2ZXIgYWxnb3JpdGhtIHRvIHVzZS4KICAgICAqIEBkZWZhdWx0IEdTU29sdmVyCiAgICAgKi8KCiAgICAvKioKICAgICAqIGNvbGxpc2lvbk1hdHJpeAogICAgICovCgogICAgLyoqCiAgICAgKiBDb2xsaXNpb25NYXRyaXggZnJvbSB0aGUgcHJldmlvdXMgc3RlcC4KICAgICAqLwoKICAgIC8qKgogICAgICogQWxsIGFkZGVkIGNvbnRhY3RtYXRlcmlhbHMuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFVzZWQgdG8gbG9vayB1cCBhIENvbnRhY3RNYXRlcmlhbCBnaXZlbiB0d28gaW5zdGFuY2VzIG9mIE1hdGVyaWFsLgogICAgICovCgogICAgLyoqCiAgICAgKiBUaGUgZGVmYXVsdCBtYXRlcmlhbCBvZiB0aGUgYm9kaWVzLgogICAgICovCgogICAgLyoqCiAgICAgKiBUaGlzIGNvbnRhY3QgbWF0ZXJpYWwgaXMgdXNlZCBpZiBubyBzdWl0YWJsZSBjb250YWN0bWF0ZXJpYWwgaXMgZm91bmQgZm9yIGEgY29udGFjdC4KICAgICAqLwoKICAgIC8qKgogICAgICogVGltZSBhY2N1bXVsYXRvciBmb3IgaW50ZXJwb2xhdGlvbi4KICAgICAqIEBzZWUgaHR0cHM6Ly9nYWZmZXJvbmdhbWVzLmNvbS9nYW1lLXBoeXNpY3MvZml4LXlvdXItdGltZXN0ZXAvCiAgICAgKi8KCiAgICAvKioKICAgICAqIERpc3BhdGNoZWQgYWZ0ZXIgYSBib2R5IGhhcyBiZWVuIGFkZGVkIHRvIHRoZSB3b3JsZC4KICAgICAqLwoKICAgIC8qKgogICAgICogRGlzcGF0Y2hlZCBhZnRlciBhIGJvZHkgaGFzIGJlZW4gcmVtb3ZlZCBmcm9tIHRoZSB3b3JsZC4KICAgICAqLwogICAgY29uc3RydWN0b3Iob3B0aW9ucykgewogICAgICBpZiAob3B0aW9ucyA9PT0gdm9pZCAwKSB7CiAgICAgICAgb3B0aW9ucyA9IHt9OwogICAgICB9CgogICAgICBzdXBlcigpOwogICAgICB0aGlzLmR0ID0gLTE7CiAgICAgIHRoaXMuYWxsb3dTbGVlcCA9ICEhb3B0aW9ucy5hbGxvd1NsZWVwOwogICAgICB0aGlzLmNvbnRhY3RzID0gW107CiAgICAgIHRoaXMuZnJpY3Rpb25FcXVhdGlvbnMgPSBbXTsKICAgICAgdGhpcy5xdWF0Tm9ybWFsaXplU2tpcCA9IG9wdGlvbnMucXVhdE5vcm1hbGl6ZVNraXAgIT09IHVuZGVmaW5lZCA/IG9wdGlvbnMucXVhdE5vcm1hbGl6ZVNraXAgOiAwOwogICAgICB0aGlzLnF1YXROb3JtYWxpemVGYXN0ID0gb3B0aW9ucy5xdWF0Tm9ybWFsaXplRmFzdCAhPT0gdW5kZWZpbmVkID8gb3B0aW9ucy5xdWF0Tm9ybWFsaXplRmFzdCA6IGZhbHNlOwogICAgICB0aGlzLnRpbWUgPSAwLjA7CiAgICAgIHRoaXMuc3RlcG51bWJlciA9IDA7CiAgICAgIHRoaXMuZGVmYXVsdF9kdCA9IDEgLyA2MDsKICAgICAgdGhpcy5uZXh0SWQgPSAwOwogICAgICB0aGlzLmdyYXZpdHkgPSBuZXcgVmVjMygpOwoKICAgICAgaWYgKG9wdGlvbnMuZ3Jhdml0eSkgewogICAgICAgIHRoaXMuZ3Jhdml0eS5jb3B5KG9wdGlvbnMuZ3Jhdml0eSk7CiAgICAgIH0KCiAgICAgIGlmIChvcHRpb25zLmZyaWN0aW9uR3Jhdml0eSkgewogICAgICAgIHRoaXMuZnJpY3Rpb25HcmF2aXR5ID0gbmV3IFZlYzMoKTsKICAgICAgICB0aGlzLmZyaWN0aW9uR3Jhdml0eS5jb3B5KG9wdGlvbnMuZnJpY3Rpb25HcmF2aXR5KTsKICAgICAgfQoKICAgICAgdGhpcy5icm9hZHBoYXNlID0gb3B0aW9ucy5icm9hZHBoYXNlICE9PSB1bmRlZmluZWQgPyBvcHRpb25zLmJyb2FkcGhhc2UgOiBuZXcgTmFpdmVCcm9hZHBoYXNlKCk7CiAgICAgIHRoaXMuYm9kaWVzID0gW107CiAgICAgIHRoaXMuaGFzQWN0aXZlQm9kaWVzID0gZmFsc2U7CiAgICAgIHRoaXMuc29sdmVyID0gb3B0aW9ucy5zb2x2ZXIgIT09IHVuZGVmaW5lZCA/IG9wdGlvbnMuc29sdmVyIDogbmV3IEdTU29sdmVyKCk7CiAgICAgIHRoaXMuY29uc3RyYWludHMgPSBbXTsKICAgICAgdGhpcy5uYXJyb3dwaGFzZSA9IG5ldyBOYXJyb3dwaGFzZSh0aGlzKTsKICAgICAgdGhpcy5jb2xsaXNpb25NYXRyaXggPSBuZXcgQXJyYXlDb2xsaXNpb25NYXRyaXgoKTsKICAgICAgdGhpcy5jb2xsaXNpb25NYXRyaXhQcmV2aW91cyA9IG5ldyBBcnJheUNvbGxpc2lvbk1hdHJpeCgpOwogICAgICB0aGlzLmJvZHlPdmVybGFwS2VlcGVyID0gbmV3IE92ZXJsYXBLZWVwZXIoKTsKICAgICAgdGhpcy5zaGFwZU92ZXJsYXBLZWVwZXIgPSBuZXcgT3ZlcmxhcEtlZXBlcigpOwogICAgICB0aGlzLmNvbnRhY3RtYXRlcmlhbHMgPSBbXTsKICAgICAgdGhpcy5jb250YWN0TWF0ZXJpYWxUYWJsZSA9IG5ldyBUdXBsZURpY3Rpb25hcnkoKTsKICAgICAgdGhpcy5kZWZhdWx0TWF0ZXJpYWwgPSBuZXcgTWF0ZXJpYWwoJ2RlZmF1bHQnKTsKICAgICAgdGhpcy5kZWZhdWx0Q29udGFjdE1hdGVyaWFsID0gbmV3IENvbnRhY3RNYXRlcmlhbCh0aGlzLmRlZmF1bHRNYXRlcmlhbCwgdGhpcy5kZWZhdWx0TWF0ZXJpYWwsIHsKICAgICAgICBmcmljdGlvbjogMC4zLAogICAgICAgIHJlc3RpdHV0aW9uOiAwLjAKICAgICAgfSk7CiAgICAgIHRoaXMuZG9Qcm9maWxpbmcgPSBmYWxzZTsKICAgICAgdGhpcy5wcm9maWxlID0gewogICAgICAgIHNvbHZlOiAwLAogICAgICAgIG1ha2VDb250YWN0Q29uc3RyYWludHM6IDAsCiAgICAgICAgYnJvYWRwaGFzZTogMCwKICAgICAgICBpbnRlZ3JhdGU6IDAsCiAgICAgICAgbmFycm93cGhhc2U6IDAKICAgICAgfTsKICAgICAgdGhpcy5hY2N1bXVsYXRvciA9IDA7CiAgICAgIHRoaXMuc3Vic3lzdGVtcyA9IFtdOwogICAgICB0aGlzLmFkZEJvZHlFdmVudCA9IHsKICAgICAgICB0eXBlOiAnYWRkQm9keScsCiAgICAgICAgYm9keTogbnVsbAogICAgICB9OwogICAgICB0aGlzLnJlbW92ZUJvZHlFdmVudCA9IHsKICAgICAgICB0eXBlOiAncmVtb3ZlQm9keScsCiAgICAgICAgYm9keTogbnVsbAogICAgICB9OwogICAgICB0aGlzLmlkVG9Cb2R5TWFwID0ge307CiAgICAgIHRoaXMuYnJvYWRwaGFzZS5zZXRXb3JsZCh0aGlzKTsKICAgIH0KICAgIC8qKgogICAgICogR2V0IHRoZSBjb250YWN0IG1hdGVyaWFsIGJldHdlZW4gbWF0ZXJpYWxzIG0xIGFuZCBtMgogICAgICogQHJldHVybiBUaGUgY29udGFjdCBtYXRlcmlhbCBpZiBpdCB3YXMgZm91bmQuCiAgICAgKi8KCgogICAgZ2V0Q29udGFjdE1hdGVyaWFsKG0xLCBtMikgewogICAgICByZXR1cm4gdGhpcy5jb250YWN0TWF0ZXJpYWxUYWJsZS5nZXQobTEuaWQsIG0yLmlkKTsKICAgIH0KICAgIC8qKgogICAgICogU3RvcmUgb2xkIGNvbGxpc2lvbiBzdGF0ZSBpbmZvCiAgICAgKi8KCgogICAgY29sbGlzaW9uTWF0cml4VGljaygpIHsKICAgICAgY29uc3QgdGVtcCA9IHRoaXMuY29sbGlzaW9uTWF0cml4UHJldmlvdXM7CiAgICAgIHRoaXMuY29sbGlzaW9uTWF0cml4UHJldmlvdXMgPSB0aGlzLmNvbGxpc2lvbk1hdHJpeDsKICAgICAgdGhpcy5jb2xsaXNpb25NYXRyaXggPSB0ZW1wOwogICAgICB0aGlzLmNvbGxpc2lvbk1hdHJpeC5yZXNldCgpOwogICAgICB0aGlzLmJvZHlPdmVybGFwS2VlcGVyLnRpY2soKTsKICAgICAgdGhpcy5zaGFwZU92ZXJsYXBLZWVwZXIudGljaygpOwogICAgfQogICAgLyoqCiAgICAgKiBBZGQgYSBjb25zdHJhaW50IHRvIHRoZSBzaW11bGF0aW9uLgogICAgICovCgoKICAgIGFkZENvbnN0cmFpbnQoYykgewogICAgICB0aGlzLmNvbnN0cmFpbnRzLnB1c2goYyk7CiAgICB9CiAgICAvKioKICAgICAqIFJlbW92ZXMgYSBjb25zdHJhaW50CiAgICAgKi8KCgogICAgcmVtb3ZlQ29uc3RyYWludChjKSB7CiAgICAgIGNvbnN0IGlkeCA9IHRoaXMuY29uc3RyYWludHMuaW5kZXhPZihjKTsKCiAgICAgIGlmIChpZHggIT09IC0xKSB7CiAgICAgICAgdGhpcy5jb25zdHJhaW50cy5zcGxpY2UoaWR4LCAxKTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBSYXljYXN0IHRlc3QKICAgICAqIEBkZXByZWNhdGVkIFVzZSAucmF5Y2FzdEFsbCwgLnJheWNhc3RDbG9zZXN0IG9yIC5yYXljYXN0QW55IGluc3RlYWQuCiAgICAgKi8KCgogICAgcmF5VGVzdChmcm9tLCB0bywgcmVzdWx0KSB7CiAgICAgIGlmIChyZXN1bHQgaW5zdGFuY2VvZiBSYXljYXN0UmVzdWx0KSB7CiAgICAgICAgLy8gRG8gcmF5Y2FzdENsb3Nlc3QKICAgICAgICB0aGlzLnJheWNhc3RDbG9zZXN0KGZyb20sIHRvLCB7CiAgICAgICAgICBza2lwQmFja2ZhY2VzOiB0cnVlCiAgICAgICAgfSwgcmVzdWx0KTsKICAgICAgfSBlbHNlIHsKICAgICAgICAvLyBEbyByYXljYXN0QWxsCiAgICAgICAgdGhpcy5yYXljYXN0QWxsKGZyb20sIHRvLCB7CiAgICAgICAgICBza2lwQmFja2ZhY2VzOiB0cnVlCiAgICAgICAgfSwgcmVzdWx0KTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBSYXkgY2FzdCBhZ2FpbnN0IGFsbCBib2RpZXMuIFRoZSBwcm92aWRlZCBjYWxsYmFjayB3aWxsIGJlIGV4ZWN1dGVkIGZvciBlYWNoIGhpdCB3aXRoIGEgUmF5Y2FzdFJlc3VsdCBhcyBzaW5nbGUgYXJndW1lbnQuCiAgICAgKiBAcmV0dXJuIFRydWUgaWYgYW55IGJvZHkgd2FzIGhpdC4KICAgICAqLwoKCiAgICByYXljYXN0QWxsKGZyb20sIHRvLCBvcHRpb25zLCBjYWxsYmFjaykgewogICAgICBpZiAob3B0aW9ucyA9PT0gdm9pZCAwKSB7CiAgICAgICAgb3B0aW9ucyA9IHt9OwogICAgICB9CgogICAgICBvcHRpb25zLm1vZGUgPSBSYXkuQUxMOwogICAgICBvcHRpb25zLmZyb20gPSBmcm9tOwogICAgICBvcHRpb25zLnRvID0gdG87CiAgICAgIG9wdGlvbnMuY2FsbGJhY2sgPSBjYWxsYmFjazsKICAgICAgcmV0dXJuIHRtcFJheS5pbnRlcnNlY3RXb3JsZCh0aGlzLCBvcHRpb25zKTsKICAgIH0KICAgIC8qKgogICAgICogUmF5IGNhc3QsIGFuZCBzdG9wIGF0IHRoZSBmaXJzdCByZXN1bHQuIE5vdGUgdGhhdCB0aGUgb3JkZXIgaXMgcmFuZG9tIC0gYnV0IHRoZSBtZXRob2QgaXMgZmFzdC4KICAgICAqIEByZXR1cm4gVHJ1ZSBpZiBhbnkgYm9keSB3YXMgaGl0LgogICAgICovCgoKICAgIHJheWNhc3RBbnkoZnJvbSwgdG8sIG9wdGlvbnMsIHJlc3VsdCkgewogICAgICBpZiAob3B0aW9ucyA9PT0gdm9pZCAwKSB7CiAgICAgICAgb3B0aW9ucyA9IHt9OwogICAgICB9CgogICAgICBvcHRpb25zLm1vZGUgPSBSYXkuQU5ZOwogICAgICBvcHRpb25zLmZyb20gPSBmcm9tOwogICAgICBvcHRpb25zLnRvID0gdG87CiAgICAgIG9wdGlvbnMucmVzdWx0ID0gcmVzdWx0OwogICAgICByZXR1cm4gdG1wUmF5LmludGVyc2VjdFdvcmxkKHRoaXMsIG9wdGlvbnMpOwogICAgfQogICAgLyoqCiAgICAgKiBSYXkgY2FzdCwgYW5kIHJldHVybiBpbmZvcm1hdGlvbiBvZiB0aGUgY2xvc2VzdCBoaXQuCiAgICAgKiBAcmV0dXJuIFRydWUgaWYgYW55IGJvZHkgd2FzIGhpdC4KICAgICAqLwoKCiAgICByYXljYXN0Q2xvc2VzdChmcm9tLCB0bywgb3B0aW9ucywgcmVzdWx0KSB7CiAgICAgIGlmIChvcHRpb25zID09PSB2b2lkIDApIHsKICAgICAgICBvcHRpb25zID0ge307CiAgICAgIH0KCiAgICAgIG9wdGlvbnMubW9kZSA9IFJheS5DTE9TRVNUOwogICAgICBvcHRpb25zLmZyb20gPSBmcm9tOwogICAgICBvcHRpb25zLnRvID0gdG87CiAgICAgIG9wdGlvbnMucmVzdWx0ID0gcmVzdWx0OwogICAgICByZXR1cm4gdG1wUmF5LmludGVyc2VjdFdvcmxkKHRoaXMsIG9wdGlvbnMpOwogICAgfQogICAgLyoqCiAgICAgKiBBZGQgYSByaWdpZCBib2R5IHRvIHRoZSBzaW11bGF0aW9uLgogICAgICogQHRvZG8gSWYgdGhlIHNpbXVsYXRpb24gaGFzIG5vdCB5ZXQgc3RhcnRlZCwgd2h5IHJlY3JldGUgYW5kIGNvcHkgYXJyYXlzIGZvciBlYWNoIGJvZHk/IEFjY3VtdWxhdGUgaW4gZHluYW1pYyBhcnJheXMgaW4gdGhpcyBjYXNlLgogICAgICogQHRvZG8gQWRkaW5nIGFuIGFycmF5IG9mIGJvZGllcyBzaG91bGQgYmUgcG9zc2libGUuIFRoaXMgd291bGQgc2F2ZSBzb21lIGxvb3BzIHRvbwogICAgICovCgoKICAgIGFkZEJvZHkoYm9keSkgewogICAgICBpZiAodGhpcy5ib2RpZXMuaW5jbHVkZXMoYm9keSkpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGJvZHkuaW5kZXggPSB0aGlzLmJvZGllcy5sZW5ndGg7CiAgICAgIHRoaXMuYm9kaWVzLnB1c2goYm9keSk7CiAgICAgIGJvZHkud29ybGQgPSB0aGlzOwogICAgICBib2R5LmluaXRQb3NpdGlvbi5jb3B5KGJvZHkucG9zaXRpb24pOwogICAgICBib2R5LmluaXRWZWxvY2l0eS5jb3B5KGJvZHkudmVsb2NpdHkpOwogICAgICBib2R5LnRpbWVMYXN0U2xlZXB5ID0gdGhpcy50aW1lOwoKICAgICAgaWYgKGJvZHkgaW5zdGFuY2VvZiBCb2R5KSB7CiAgICAgICAgYm9keS5pbml0QW5ndWxhclZlbG9jaXR5LmNvcHkoYm9keS5hbmd1bGFyVmVsb2NpdHkpOwogICAgICAgIGJvZHkuaW5pdFF1YXRlcm5pb24uY29weShib2R5LnF1YXRlcm5pb24pOwogICAgICB9CgogICAgICB0aGlzLmNvbGxpc2lvbk1hdHJpeC5zZXROdW1PYmplY3RzKHRoaXMuYm9kaWVzLmxlbmd0aCk7CiAgICAgIHRoaXMuYWRkQm9keUV2ZW50LmJvZHkgPSBib2R5OwogICAgICB0aGlzLmlkVG9Cb2R5TWFwW2JvZHkuaWRdID0gYm9keTsKICAgICAgdGhpcy5kaXNwYXRjaEV2ZW50KHRoaXMuYWRkQm9keUV2ZW50KTsKICAgIH0KICAgIC8qKgogICAgICogUmVtb3ZlIGEgcmlnaWQgYm9keSBmcm9tIHRoZSBzaW11bGF0aW9uLgogICAgICovCgoKICAgIHJlbW92ZUJvZHkoYm9keSkgewogICAgICBib2R5LndvcmxkID0gbnVsbDsKICAgICAgY29uc3QgbiA9IHRoaXMuYm9kaWVzLmxlbmd0aCAtIDE7CiAgICAgIGNvbnN0IGJvZGllcyA9IHRoaXMuYm9kaWVzOwogICAgICBjb25zdCBpZHggPSBib2RpZXMuaW5kZXhPZihib2R5KTsKCiAgICAgIGlmIChpZHggIT09IC0xKSB7CiAgICAgICAgYm9kaWVzLnNwbGljZShpZHgsIDEpOyAvLyBUb2RvOiBzaG91bGQgdXNlIGEgZ2FyYmFnZSBmcmVlIG1ldGhvZAogICAgICAgIC8vIFJlY29tcHV0ZSBpbmRleAoKICAgICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gYm9kaWVzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICBib2RpZXNbaV0uaW5kZXggPSBpOwogICAgICAgIH0KCiAgICAgICAgdGhpcy5jb2xsaXNpb25NYXRyaXguc2V0TnVtT2JqZWN0cyhuKTsKICAgICAgICB0aGlzLnJlbW92ZUJvZHlFdmVudC5ib2R5ID0gYm9keTsKICAgICAgICBkZWxldGUgdGhpcy5pZFRvQm9keU1hcFtib2R5LmlkXTsKICAgICAgICB0aGlzLmRpc3BhdGNoRXZlbnQodGhpcy5yZW1vdmVCb2R5RXZlbnQpOwogICAgICB9CiAgICB9CgogICAgZ2V0Qm9keUJ5SWQoaWQpIHsKICAgICAgcmV0dXJuIHRoaXMuaWRUb0JvZHlNYXBbaWRdOwogICAgfQogICAgLyoqCiAgICAgKiBAdG9kbyBNYWtlIGEgZmFzdGVyIG1hcAogICAgICovCgoKICAgIGdldFNoYXBlQnlJZChpZCkgewogICAgICBjb25zdCBib2RpZXMgPSB0aGlzLmJvZGllczsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgYm9kaWVzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgY29uc3Qgc2hhcGVzID0gYm9kaWVzW2ldLnNoYXBlczsKCiAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCBzaGFwZXMubGVuZ3RoOyBqKyspIHsKICAgICAgICAgIGNvbnN0IHNoYXBlID0gc2hhcGVzW2pdOwoKICAgICAgICAgIGlmIChzaGFwZS5pZCA9PT0gaWQpIHsKICAgICAgICAgICAgcmV0dXJuIHNoYXBlOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQoKICAgICAgcmV0dXJuIG51bGw7CiAgICB9CiAgICAvKioKICAgICAqIEFkZHMgYSBjb250YWN0IG1hdGVyaWFsIHRvIHRoZSBXb3JsZAogICAgICovCgoKICAgIGFkZENvbnRhY3RNYXRlcmlhbChjbWF0KSB7CiAgICAgIC8vIEFkZCBjb250YWN0IG1hdGVyaWFsCiAgICAgIHRoaXMuY29udGFjdG1hdGVyaWFscy5wdXNoKGNtYXQpOyAvLyBBZGQgY3VycmVudCBjb250YWN0IG1hdGVyaWFsIHRvIHRoZSBtYXRlcmlhbCB0YWJsZQoKICAgICAgdGhpcy5jb250YWN0TWF0ZXJpYWxUYWJsZS5zZXQoY21hdC5tYXRlcmlhbHNbMF0uaWQsIGNtYXQubWF0ZXJpYWxzWzFdLmlkLCBjbWF0KTsKICAgIH0KICAgIC8qKgogICAgICogUmVtb3ZlcyBhIGNvbnRhY3QgbWF0ZXJpYWwgZnJvbSB0aGUgV29ybGQuCiAgICAgKi8KCgogICAgcmVtb3ZlQ29udGFjdE1hdGVyaWFsKGNtYXQpIHsKICAgICAgY29uc3QgaWR4ID0gdGhpcy5jb250YWN0bWF0ZXJpYWxzLmluZGV4T2YoY21hdCk7CgogICAgICBpZiAoaWR4ID09PSAtMSkgewogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgdGhpcy5jb250YWN0bWF0ZXJpYWxzLnNwbGljZShpZHgsIDEpOwogICAgICB0aGlzLmNvbnRhY3RNYXRlcmlhbFRhYmxlLmRlbGV0ZShjbWF0Lm1hdGVyaWFsc1swXS5pZCwgY21hdC5tYXRlcmlhbHNbMV0uaWQpOwogICAgfQogICAgLyoqCiAgICAgKiBTdGVwIHRoZSBzaW11bGF0aW9uIGZvcndhcmQga2VlcGluZyB0cmFjayBvZiBsYXN0IGNhbGxlZCB0aW1lCiAgICAgKiB0byBiZSBhYmxlIHRvIHN0ZXAgdGhlIHdvcmxkIGF0IGEgZml4ZWQgcmF0ZSwgaW5kZXBlbmRlbnRseSBvZiBmcmFtZXJhdGUuCiAgICAgKgogICAgICogQHBhcmFtIGR0IFRoZSBmaXhlZCB0aW1lIHN0ZXAgc2l6ZSB0byB1c2UgKGRlZmF1bHQ6IDEgLyA2MCkuCiAgICAgKiBAcGFyYW0gbWF4U3ViU3RlcHMgTWF4aW11bSBudW1iZXIgb2YgZml4ZWQgc3RlcHMgdG8gdGFrZSBwZXIgZnVuY3Rpb24gY2FsbCAoZGVmYXVsdDogMTApLgogICAgICogQHNlZSBodHRwczovL2dhZmZlcm9uZ2FtZXMuY29tL3Bvc3QvZml4X3lvdXJfdGltZXN0ZXAvCiAgICAgKiBAZXhhbXBsZQogICAgICogICAgIC8vIFJ1biB0aGUgc2ltdWxhdGlvbiBpbmRlcGVuZGVudGx5IG9mIGZyYW1lcmF0ZSBldmVyeSAxIC8gNjAgbXMKICAgICAqICAgICB3b3JsZC5maXhlZFN0ZXAoKQogICAgICovCgoKICAgIGZpeGVkU3RlcChkdCwgbWF4U3ViU3RlcHMpIHsKICAgICAgaWYgKGR0ID09PSB2b2lkIDApIHsKICAgICAgICBkdCA9IDEgLyA2MDsKICAgICAgfQoKICAgICAgaWYgKG1heFN1YlN0ZXBzID09PSB2b2lkIDApIHsKICAgICAgICBtYXhTdWJTdGVwcyA9IDEwOwogICAgICB9CgogICAgICBjb25zdCB0aW1lID0gcGVyZm9ybWFuY2Uubm93KCkgLyAxMDAwOyAvLyBzZWNvbmRzCgogICAgICBpZiAoIXRoaXMubGFzdENhbGxUaW1lKSB7CiAgICAgICAgdGhpcy5zdGVwKGR0LCB1bmRlZmluZWQsIG1heFN1YlN0ZXBzKTsKICAgICAgfSBlbHNlIHsKICAgICAgICBjb25zdCB0aW1lU2luY2VMYXN0Q2FsbGVkID0gdGltZSAtIHRoaXMubGFzdENhbGxUaW1lOwogICAgICAgIHRoaXMuc3RlcChkdCwgdGltZVNpbmNlTGFzdENhbGxlZCwgbWF4U3ViU3RlcHMpOwogICAgICB9CgogICAgICB0aGlzLmxhc3RDYWxsVGltZSA9IHRpbWU7CiAgICB9CiAgICAvKioKICAgICAqIFN0ZXAgdGhlIHBoeXNpY3Mgd29ybGQgZm9yd2FyZCBpbiB0aW1lLgogICAgICoKICAgICAqIFRoZXJlIGFyZSB0d28gbW9kZXMuIFRoZSBzaW1wbGUgbW9kZSBpcyBmaXhlZCB0aW1lc3RlcHBpbmcgd2l0aG91dCBpbnRlcnBvbGF0aW9uLiBJbiB0aGlzIGNhc2UgeW91IG9ubHkgdXNlIHRoZSBmaXJzdCBhcmd1bWVudC4gVGhlIHNlY29uZCBjYXNlIHVzZXMgaW50ZXJwb2xhdGlvbi4gSW4gdGhhdCB5b3UgYWxzbyBwcm92aWRlIHRoZSB0aW1lIHNpbmNlIHRoZSBmdW5jdGlvbiB3YXMgbGFzdCB1c2VkLCBhcyB3ZWxsIGFzIHRoZSBtYXhpbXVtIGZpeGVkIHRpbWVzdGVwcyB0byB0YWtlLgogICAgICoKICAgICAqIEBwYXJhbSBkdCBUaGUgZml4ZWQgdGltZSBzdGVwIHNpemUgdG8gdXNlLgogICAgICogQHBhcmFtIHRpbWVTaW5jZUxhc3RDYWxsZWQgVGhlIHRpbWUgZWxhcHNlZCBzaW5jZSB0aGUgZnVuY3Rpb24gd2FzIGxhc3QgY2FsbGVkLgogICAgICogQHBhcmFtIG1heFN1YlN0ZXBzIE1heGltdW0gbnVtYmVyIG9mIGZpeGVkIHN0ZXBzIHRvIHRha2UgcGVyIGZ1bmN0aW9uIGNhbGwgKGRlZmF1bHQ6IDEwKS4KICAgICAqIEBzZWUgaHR0cHM6Ly93ZWIuYXJjaGl2ZS5vcmcvd2ViLzIwMTgwNDI2MTU0NTMxL2h0dHA6Ly9idWxsZXRwaHlzaWNzLm9yZy9tZWRpYXdpa2ktMS41LjgvaW5kZXgucGhwL1N0ZXBwaW5nX1RoZV9Xb3JsZCNXaGF0X2RvX3RoZV9wYXJhbWV0ZXJzX3RvX2J0RHluYW1pY3NXb3JsZDo6c3RlcFNpbXVsYXRpb25fbWVhbi4zRgogICAgICogQGV4YW1wbGUKICAgICAqICAgICAvLyBmaXhlZCB0aW1lc3RlcHBpbmcgd2l0aG91dCBpbnRlcnBvbGF0aW9uCiAgICAgKiAgICAgd29ybGQuc3RlcCgxIC8gNjApCiAgICAgKi8KCgogICAgc3RlcChkdCwgdGltZVNpbmNlTGFzdENhbGxlZCwgbWF4U3ViU3RlcHMpIHsKICAgICAgaWYgKG1heFN1YlN0ZXBzID09PSB2b2lkIDApIHsKICAgICAgICBtYXhTdWJTdGVwcyA9IDEwOwogICAgICB9CgogICAgICBpZiAodGltZVNpbmNlTGFzdENhbGxlZCA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgLy8gRml4ZWQsIHNpbXBsZSBzdGVwcGluZwogICAgICAgIHRoaXMuaW50ZXJuYWxTdGVwKGR0KTsgLy8gSW5jcmVtZW50IHRpbWUKCiAgICAgICAgdGhpcy50aW1lICs9IGR0OwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuYWNjdW11bGF0b3IgKz0gdGltZVNpbmNlTGFzdENhbGxlZDsKICAgICAgICBjb25zdCB0MCA9IHBlcmZvcm1hbmNlLm5vdygpOwogICAgICAgIGxldCBzdWJzdGVwcyA9IDA7CgogICAgICAgIHdoaWxlICh0aGlzLmFjY3VtdWxhdG9yID49IGR0ICYmIHN1YnN0ZXBzIDwgbWF4U3ViU3RlcHMpIHsKICAgICAgICAgIC8vIERvIGZpeGVkIHN0ZXBzIHRvIGNhdGNoIHVwCiAgICAgICAgICB0aGlzLmludGVybmFsU3RlcChkdCk7CiAgICAgICAgICB0aGlzLmFjY3VtdWxhdG9yIC09IGR0OwogICAgICAgICAgc3Vic3RlcHMrKzsKCiAgICAgICAgICBpZiAocGVyZm9ybWFuY2Uubm93KCkgLSB0MCA+IGR0ICogMTAwMCkgewogICAgICAgICAgICAvLyBUaGUgZnJhbWVyYXRlIGlzIG5vdCBpbnRlcmFjdGl2ZSBhbnltb3JlLgogICAgICAgICAgICAvLyBXZSBhcmUgYmVsb3cgdGhlIHRhcmdldCBmcmFtZXJhdGUuCiAgICAgICAgICAgIC8vIEJldHRlciBiYWlsIG91dC4KICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CiAgICAgICAgfSAvLyBSZW1vdmUgdGhlIGV4Y2VzcyBhY2N1bXVsYXRvciwgc2luY2Ugd2UgbWF5IG5vdAogICAgICAgIC8vIGhhdmUgaGFkIGVub3VnaCBzdWJzdGVwcyBhdmFpbGFibGUgdG8gY2F0Y2ggdXAKCgogICAgICAgIHRoaXMuYWNjdW11bGF0b3IgPSB0aGlzLmFjY3VtdWxhdG9yICUgZHQ7CiAgICAgICAgY29uc3QgdCA9IHRoaXMuYWNjdW11bGF0b3IgLyBkdDsKCiAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogIT09IHRoaXMuYm9kaWVzLmxlbmd0aDsgaisrKSB7CiAgICAgICAgICBjb25zdCBiID0gdGhpcy5ib2RpZXNbal07CiAgICAgICAgICBiLnByZXZpb3VzUG9zaXRpb24ubGVycChiLnBvc2l0aW9uLCB0LCBiLmludGVycG9sYXRlZFBvc2l0aW9uKTsKICAgICAgICAgIGIucHJldmlvdXNRdWF0ZXJuaW9uLnNsZXJwKGIucXVhdGVybmlvbiwgdCwgYi5pbnRlcnBvbGF0ZWRRdWF0ZXJuaW9uKTsKICAgICAgICAgIGIucHJldmlvdXNRdWF0ZXJuaW9uLm5vcm1hbGl6ZSgpOwogICAgICAgIH0KCiAgICAgICAgdGhpcy50aW1lICs9IHRpbWVTaW5jZUxhc3RDYWxsZWQ7CiAgICAgIH0KICAgIH0KCiAgICBpbnRlcm5hbFN0ZXAoZHQpIHsKICAgICAgdGhpcy5kdCA9IGR0OwogICAgICBjb25zdCBjb250YWN0cyA9IHRoaXMuY29udGFjdHM7CiAgICAgIGNvbnN0IHAxID0gV29ybGRfc3RlcF9wMTsKICAgICAgY29uc3QgcDIgPSBXb3JsZF9zdGVwX3AyOwogICAgICBjb25zdCBOID0gdGhpcy5ib2RpZXMubGVuZ3RoOwogICAgICBjb25zdCBib2RpZXMgPSB0aGlzLmJvZGllczsKICAgICAgY29uc3Qgc29sdmVyID0gdGhpcy5zb2x2ZXI7CiAgICAgIGNvbnN0IGdyYXZpdHkgPSB0aGlzLmdyYXZpdHk7CiAgICAgIGNvbnN0IGRvUHJvZmlsaW5nID0gdGhpcy5kb1Byb2ZpbGluZzsKICAgICAgY29uc3QgcHJvZmlsZSA9IHRoaXMucHJvZmlsZTsKICAgICAgY29uc3QgRFlOQU1JQyA9IEJvZHkuRFlOQU1JQzsKICAgICAgbGV0IHByb2ZpbGluZ1N0YXJ0ID0gLUluZmluaXR5OwogICAgICBjb25zdCBjb25zdHJhaW50cyA9IHRoaXMuY29uc3RyYWludHM7CiAgICAgIGNvbnN0IGZyaWN0aW9uRXF1YXRpb25Qb29sID0gV29ybGRfc3RlcF9mcmljdGlvbkVxdWF0aW9uUG9vbDsKICAgICAgZ3Jhdml0eS5sZW5ndGgoKTsKICAgICAgY29uc3QgZ3ggPSBncmF2aXR5Lng7CiAgICAgIGNvbnN0IGd5ID0gZ3Jhdml0eS55OwogICAgICBjb25zdCBneiA9IGdyYXZpdHkuejsKICAgICAgbGV0IGkgPSAwOwoKICAgICAgaWYgKGRvUHJvZmlsaW5nKSB7CiAgICAgICAgcHJvZmlsaW5nU3RhcnQgPSBwZXJmb3JtYW5jZS5ub3coKTsKICAgICAgfSAvLyBBZGQgZ3Jhdml0eSB0byBhbGwgb2JqZWN0cwoKCiAgICAgIGZvciAoaSA9IDA7IGkgIT09IE47IGkrKykgewogICAgICAgIGNvbnN0IGJpID0gYm9kaWVzW2ldOwoKICAgICAgICBpZiAoYmkudHlwZSA9PT0gRFlOQU1JQykgewogICAgICAgICAgLy8gT25seSBmb3IgZHluYW1pYyBib2RpZXMKICAgICAgICAgIGNvbnN0IGYgPSBiaS5mb3JjZTsKICAgICAgICAgIGNvbnN0IG0gPSBiaS5tYXNzOwogICAgICAgICAgZi54ICs9IG0gKiBneDsKICAgICAgICAgIGYueSArPSBtICogZ3k7CiAgICAgICAgICBmLnogKz0gbSAqIGd6OwogICAgICAgIH0KICAgICAgfSAvLyBVcGRhdGUgc3Vic3lzdGVtcwoKCiAgICAgIGZvciAobGV0IGkgPSAwLCBOc3Vic3lzdGVtcyA9IHRoaXMuc3Vic3lzdGVtcy5sZW5ndGg7IGkgIT09IE5zdWJzeXN0ZW1zOyBpKyspIHsKICAgICAgICB0aGlzLnN1YnN5c3RlbXNbaV0udXBkYXRlKCk7CiAgICAgIH0gLy8gQ29sbGlzaW9uIGRldGVjdGlvbgoKCiAgICAgIGlmIChkb1Byb2ZpbGluZykgewogICAgICAgIHByb2ZpbGluZ1N0YXJ0ID0gcGVyZm9ybWFuY2Uubm93KCk7CiAgICAgIH0KCiAgICAgIHAxLmxlbmd0aCA9IDA7IC8vIENsZWFuIHVwIHBhaXIgYXJyYXlzIGZyb20gbGFzdCBzdGVwCgogICAgICBwMi5sZW5ndGggPSAwOwogICAgICB0aGlzLmJyb2FkcGhhc2UuY29sbGlzaW9uUGFpcnModGhpcywgcDEsIHAyKTsKCiAgICAgIGlmIChkb1Byb2ZpbGluZykgewogICAgICAgIHByb2ZpbGUuYnJvYWRwaGFzZSA9IHBlcmZvcm1hbmNlLm5vdygpIC0gcHJvZmlsaW5nU3RhcnQ7CiAgICAgIH0gLy8gUmVtb3ZlIGNvbnN0cmFpbmVkIHBhaXJzIHdpdGggY29sbGlkZUNvbm5lY3RlZCA9PSBmYWxzZQoKCiAgICAgIGxldCBOY29uc3RyYWludHMgPSBjb25zdHJhaW50cy5sZW5ndGg7CgogICAgICBmb3IgKGkgPSAwOyBpICE9PSBOY29uc3RyYWludHM7IGkrKykgewogICAgICAgIGNvbnN0IGMgPSBjb25zdHJhaW50c1tpXTsKCiAgICAgICAgaWYgKCFjLmNvbGxpZGVDb25uZWN0ZWQpIHsKICAgICAgICAgIGZvciAobGV0IGogPSBwMS5sZW5ndGggLSAxOyBqID49IDA7IGogLT0gMSkgewogICAgICAgICAgICBpZiAoYy5ib2R5QSA9PT0gcDFbal0gJiYgYy5ib2R5QiA9PT0gcDJbal0gfHwgYy5ib2R5QiA9PT0gcDFbal0gJiYgYy5ib2R5QSA9PT0gcDJbal0pIHsKICAgICAgICAgICAgICBwMS5zcGxpY2UoaiwgMSk7CiAgICAgICAgICAgICAgcDIuc3BsaWNlKGosIDEpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CgogICAgICB0aGlzLmNvbGxpc2lvbk1hdHJpeFRpY2soKTsgLy8gR2VuZXJhdGUgY29udGFjdHMKCiAgICAgIGlmIChkb1Byb2ZpbGluZykgewogICAgICAgIHByb2ZpbGluZ1N0YXJ0ID0gcGVyZm9ybWFuY2Uubm93KCk7CiAgICAgIH0KCiAgICAgIGNvbnN0IG9sZGNvbnRhY3RzID0gV29ybGRfc3RlcF9vbGRDb250YWN0czsKICAgICAgY29uc3QgTm9sZENvbnRhY3RzID0gY29udGFjdHMubGVuZ3RoOwoKICAgICAgZm9yIChpID0gMDsgaSAhPT0gTm9sZENvbnRhY3RzOyBpKyspIHsKICAgICAgICBvbGRjb250YWN0cy5wdXNoKGNvbnRhY3RzW2ldKTsKICAgICAgfQoKICAgICAgY29udGFjdHMubGVuZ3RoID0gMDsgLy8gVHJhbnNmZXIgRnJpY3Rpb25FcXVhdGlvbiBmcm9tIGN1cnJlbnQgbGlzdCB0byB0aGUgcG9vbCBmb3IgcmV1c2UKCiAgICAgIGNvbnN0IE5vbGRGcmljdGlvbkVxdWF0aW9ucyA9IHRoaXMuZnJpY3Rpb25FcXVhdGlvbnMubGVuZ3RoOwoKICAgICAgZm9yIChpID0gMDsgaSAhPT0gTm9sZEZyaWN0aW9uRXF1YXRpb25zOyBpKyspIHsKICAgICAgICBmcmljdGlvbkVxdWF0aW9uUG9vbC5wdXNoKHRoaXMuZnJpY3Rpb25FcXVhdGlvbnNbaV0pOwogICAgICB9CgogICAgICB0aGlzLmZyaWN0aW9uRXF1YXRpb25zLmxlbmd0aCA9IDA7CiAgICAgIHRoaXMubmFycm93cGhhc2UuZ2V0Q29udGFjdHMocDEsIHAyLCB0aGlzLCBjb250YWN0cywgb2xkY29udGFjdHMsIC8vIFRvIGJlIHJldXNlZAogICAgICB0aGlzLmZyaWN0aW9uRXF1YXRpb25zLCBmcmljdGlvbkVxdWF0aW9uUG9vbCk7CgogICAgICBpZiAoZG9Qcm9maWxpbmcpIHsKICAgICAgICBwcm9maWxlLm5hcnJvd3BoYXNlID0gcGVyZm9ybWFuY2Uubm93KCkgLSBwcm9maWxpbmdTdGFydDsKICAgICAgfSAvLyBMb29wIG92ZXIgYWxsIGNvbGxpc2lvbnMKCgogICAgICBpZiAoZG9Qcm9maWxpbmcpIHsKICAgICAgICBwcm9maWxpbmdTdGFydCA9IHBlcmZvcm1hbmNlLm5vdygpOwogICAgICB9IC8vIEFkZCBhbGwgZnJpY3Rpb24gZXFzCgoKICAgICAgZm9yIChpID0gMDsgaSA8IHRoaXMuZnJpY3Rpb25FcXVhdGlvbnMubGVuZ3RoOyBpKyspIHsKICAgICAgICBzb2x2ZXIuYWRkRXF1YXRpb24odGhpcy5mcmljdGlvbkVxdWF0aW9uc1tpXSk7CiAgICAgIH0KCiAgICAgIGNvbnN0IG5jb250YWN0cyA9IGNvbnRhY3RzLmxlbmd0aDsKCiAgICAgIGZvciAobGV0IGsgPSAwOyBrICE9PSBuY29udGFjdHM7IGsrKykgewogICAgICAgIC8vIEN1cnJlbnQgY29udGFjdAogICAgICAgIGNvbnN0IGMgPSBjb250YWN0c1trXTsgLy8gR2V0IGN1cnJlbnQgY29sbGlzaW9uIGluZGVjZXMKCiAgICAgICAgY29uc3QgYmkgPSBjLmJpOwogICAgICAgIGNvbnN0IGJqID0gYy5iajsKICAgICAgICBjb25zdCBzaSA9IGMuc2k7CiAgICAgICAgY29uc3Qgc2ogPSBjLnNqOyAvLyBHZXQgY29sbGlzaW9uIHByb3BlcnRpZXMKCiAgICAgICAgbGV0IGNtOwoKICAgICAgICBpZiAoYmkubWF0ZXJpYWwgJiYgYmoubWF0ZXJpYWwpIHsKICAgICAgICAgIGNtID0gdGhpcy5nZXRDb250YWN0TWF0ZXJpYWwoYmkubWF0ZXJpYWwsIGJqLm1hdGVyaWFsKSB8fCB0aGlzLmRlZmF1bHRDb250YWN0TWF0ZXJpYWw7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGNtID0gdGhpcy5kZWZhdWx0Q29udGFjdE1hdGVyaWFsOwogICAgICAgIH0gLy8gYy5lbmFibGVkID0gYmkuY29sbGlzaW9uUmVzcG9uc2UgJiYgYmouY29sbGlzaW9uUmVzcG9uc2UgJiYgc2kuY29sbGlzaW9uUmVzcG9uc2UgJiYgc2ouY29sbGlzaW9uUmVzcG9uc2U7CgoKICAgICAgICBjbS5mcmljdGlvbjsgLy8gYy5yZXN0aXR1dGlvbiA9IGNtLnJlc3RpdHV0aW9uOwogICAgICAgIC8vIElmIGZyaWN0aW9uIG9yIHJlc3RpdHV0aW9uIHdlcmUgc3BlY2lmaWVkIGluIHRoZSBtYXRlcmlhbCwgdXNlIHRoZW0KCiAgICAgICAgaWYgKGJpLm1hdGVyaWFsICYmIGJqLm1hdGVyaWFsKSB7CiAgICAgICAgICBpZiAoYmkubWF0ZXJpYWwuZnJpY3Rpb24gPj0gMCAmJiBiai5tYXRlcmlhbC5mcmljdGlvbiA+PSAwKSB7CiAgICAgICAgICAgIGJpLm1hdGVyaWFsLmZyaWN0aW9uICogYmoubWF0ZXJpYWwuZnJpY3Rpb247CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKGJpLm1hdGVyaWFsLnJlc3RpdHV0aW9uID49IDAgJiYgYmoubWF0ZXJpYWwucmVzdGl0dXRpb24gPj0gMCkgewogICAgICAgICAgICBjLnJlc3RpdHV0aW9uID0gYmkubWF0ZXJpYWwucmVzdGl0dXRpb24gKiBiai5tYXRlcmlhbC5yZXN0aXR1dGlvbjsKICAgICAgICAgIH0KICAgICAgICB9IC8vIGMuc2V0U3Bvb2tQYXJhbXMoCiAgICAgICAgLy8gICAgICAgICAgIGNtLmNvbnRhY3RFcXVhdGlvblN0aWZmbmVzcywKICAgICAgICAvLyAgICAgICAgICAgY20uY29udGFjdEVxdWF0aW9uUmVsYXhhdGlvbiwKICAgICAgICAvLyAgICAgICAgICAgZHQKICAgICAgICAvLyAgICAgICApOwoKCiAgICAgICAgc29sdmVyLmFkZEVxdWF0aW9uKGMpOyAvLyAvLyBBZGQgZnJpY3Rpb24gY29uc3RyYWludCBlcXVhdGlvbgogICAgICAgIC8vIGlmKG11ID4gMCl7CiAgICAgICAgLy8gCS8vIENyZWF0ZSAyIHRhbmdlbnQgZXF1YXRpb25zCiAgICAgICAgLy8gCWNvbnN0IG11ZyA9IG11ICogZ25vcm07CiAgICAgICAgLy8gCWNvbnN0IHJlZHVjZWRNYXNzID0gKGJpLmludk1hc3MgKyBiai5pbnZNYXNzKTsKICAgICAgICAvLyAJaWYocmVkdWNlZE1hc3MgPiAwKXsKICAgICAgICAvLyAJCXJlZHVjZWRNYXNzID0gMS9yZWR1Y2VkTWFzczsKICAgICAgICAvLyAJfQogICAgICAgIC8vIAljb25zdCBwb29sID0gZnJpY3Rpb25FcXVhdGlvblBvb2w7CiAgICAgICAgLy8gCWNvbnN0IGMxID0gcG9vbC5sZW5ndGggPyBwb29sLnBvcCgpIDogbmV3IEZyaWN0aW9uRXF1YXRpb24oYmksYmosbXVnKnJlZHVjZWRNYXNzKTsKICAgICAgICAvLyAJY29uc3QgYzIgPSBwb29sLmxlbmd0aCA/IHBvb2wucG9wKCkgOiBuZXcgRnJpY3Rpb25FcXVhdGlvbihiaSxiaixtdWcqcmVkdWNlZE1hc3MpOwogICAgICAgIC8vIAl0aGlzLmZyaWN0aW9uRXF1YXRpb25zLnB1c2goYzEsIGMyKTsKICAgICAgICAvLyAJYzEuYmkgPSBjMi5iaSA9IGJpOwogICAgICAgIC8vIAljMS5iaiA9IGMyLmJqID0gYmo7CiAgICAgICAgLy8gCWMxLm1pbkZvcmNlID0gYzIubWluRm9yY2UgPSAtbXVnKnJlZHVjZWRNYXNzOwogICAgICAgIC8vIAljMS5tYXhGb3JjZSA9IGMyLm1heEZvcmNlID0gbXVnKnJlZHVjZWRNYXNzOwogICAgICAgIC8vIAkvLyBDb3B5IG92ZXIgdGhlIHJlbGF0aXZlIHZlY3RvcnMKICAgICAgICAvLyAJYzEucmkuY29weShjLnJpKTsKICAgICAgICAvLyAJYzEucmouY29weShjLnJqKTsKICAgICAgICAvLyAJYzIucmkuY29weShjLnJpKTsKICAgICAgICAvLyAJYzIucmouY29weShjLnJqKTsKICAgICAgICAvLyAJLy8gQ29uc3RydWN0IHRhbmdlbnRzCiAgICAgICAgLy8gCWMubmkudGFuZ2VudHMoYzEudCwgYzIudCk7CiAgICAgICAgLy8gICAgICAgICAgIC8vIFNldCBzcG9vayBwYXJhbXMKICAgICAgICAvLyAgICAgICAgICAgYzEuc2V0U3Bvb2tQYXJhbXMoY20uZnJpY3Rpb25FcXVhdGlvblN0aWZmbmVzcywgY20uZnJpY3Rpb25FcXVhdGlvblJlbGF4YXRpb24sIGR0KTsKICAgICAgICAvLyAgICAgICAgICAgYzIuc2V0U3Bvb2tQYXJhbXMoY20uZnJpY3Rpb25FcXVhdGlvblN0aWZmbmVzcywgY20uZnJpY3Rpb25FcXVhdGlvblJlbGF4YXRpb24sIGR0KTsKICAgICAgICAvLyAgICAgICAgICAgYzEuZW5hYmxlZCA9IGMyLmVuYWJsZWQgPSBjLmVuYWJsZWQ7CiAgICAgICAgLy8gCS8vIEFkZCBlcXVhdGlvbnMgdG8gc29sdmVyCiAgICAgICAgLy8gCXNvbHZlci5hZGRFcXVhdGlvbihjMSk7CiAgICAgICAgLy8gCXNvbHZlci5hZGRFcXVhdGlvbihjMik7CiAgICAgICAgLy8gfQoKICAgICAgICBpZiAoYmkuYWxsb3dTbGVlcCAmJiBiaS50eXBlID09PSBCb2R5LkRZTkFNSUMgJiYgYmkuc2xlZXBTdGF0ZSA9PT0gQm9keS5TTEVFUElORyAmJiBiai5zbGVlcFN0YXRlID09PSBCb2R5LkFXQUtFICYmIGJqLnR5cGUgIT09IEJvZHkuU1RBVElDKSB7CiAgICAgICAgICBjb25zdCBzcGVlZFNxdWFyZWRCID0gYmoudmVsb2NpdHkubGVuZ3RoU3F1YXJlZCgpICsgYmouYW5ndWxhclZlbG9jaXR5Lmxlbmd0aFNxdWFyZWQoKTsKICAgICAgICAgIGNvbnN0IHNwZWVkTGltaXRTcXVhcmVkQiA9IGJqLnNsZWVwU3BlZWRMaW1pdCAqKiAyOwoKICAgICAgICAgIGlmIChzcGVlZFNxdWFyZWRCID49IHNwZWVkTGltaXRTcXVhcmVkQiAqIDIpIHsKICAgICAgICAgICAgYmkud2FrZVVwQWZ0ZXJOYXJyb3dwaGFzZSA9IHRydWU7CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBpZiAoYmouYWxsb3dTbGVlcCAmJiBiai50eXBlID09PSBCb2R5LkRZTkFNSUMgJiYgYmouc2xlZXBTdGF0ZSA9PT0gQm9keS5TTEVFUElORyAmJiBiaS5zbGVlcFN0YXRlID09PSBCb2R5LkFXQUtFICYmIGJpLnR5cGUgIT09IEJvZHkuU1RBVElDKSB7CiAgICAgICAgICBjb25zdCBzcGVlZFNxdWFyZWRBID0gYmkudmVsb2NpdHkubGVuZ3RoU3F1YXJlZCgpICsgYmkuYW5ndWxhclZlbG9jaXR5Lmxlbmd0aFNxdWFyZWQoKTsKICAgICAgICAgIGNvbnN0IHNwZWVkTGltaXRTcXVhcmVkQSA9IGJpLnNsZWVwU3BlZWRMaW1pdCAqKiAyOwoKICAgICAgICAgIGlmIChzcGVlZFNxdWFyZWRBID49IHNwZWVkTGltaXRTcXVhcmVkQSAqIDIpIHsKICAgICAgICAgICAgYmoud2FrZVVwQWZ0ZXJOYXJyb3dwaGFzZSA9IHRydWU7CiAgICAgICAgICB9CiAgICAgICAgfSAvLyBOb3cgd2Uga25vdyB0aGF0IGkgYW5kIGogYXJlIGluIGNvbnRhY3QuIFNldCBjb2xsaXNpb24gbWF0cml4IHN0YXRlCgoKICAgICAgICB0aGlzLmNvbGxpc2lvbk1hdHJpeC5zZXQoYmksIGJqLCB0cnVlKTsKCiAgICAgICAgaWYgKCF0aGlzLmNvbGxpc2lvbk1hdHJpeFByZXZpb3VzLmdldChiaSwgYmopKSB7CiAgICAgICAgICAvLyBGaXJzdCBjb250YWN0IQogICAgICAgICAgLy8gV2UgcmV1c2UgdGhlIGNvbGxpZGVFdmVudCBvYmplY3QsIG90aGVyd2lzZSB3ZSB3aWxsIGVuZCB1cCBjcmVhdGluZyBuZXcgb2JqZWN0cyBmb3IgZWFjaCBuZXcgY29udGFjdCwgZXZlbiBpZiB0aGVyZSdzIG5vIGV2ZW50IGxpc3RlbmVyIGF0dGFjaGVkLgogICAgICAgICAgV29ybGRfc3RlcF9jb2xsaWRlRXZlbnQuYm9keSA9IGJqOwogICAgICAgICAgV29ybGRfc3RlcF9jb2xsaWRlRXZlbnQuY29udGFjdCA9IGM7CiAgICAgICAgICBiaS5kaXNwYXRjaEV2ZW50KFdvcmxkX3N0ZXBfY29sbGlkZUV2ZW50KTsKICAgICAgICAgIFdvcmxkX3N0ZXBfY29sbGlkZUV2ZW50LmJvZHkgPSBiaTsKICAgICAgICAgIGJqLmRpc3BhdGNoRXZlbnQoV29ybGRfc3RlcF9jb2xsaWRlRXZlbnQpOwogICAgICAgIH0KCiAgICAgICAgdGhpcy5ib2R5T3ZlcmxhcEtlZXBlci5zZXQoYmkuaWQsIGJqLmlkKTsKICAgICAgICB0aGlzLnNoYXBlT3ZlcmxhcEtlZXBlci5zZXQoc2kuaWQsIHNqLmlkKTsKICAgICAgfQoKICAgICAgdGhpcy5lbWl0Q29udGFjdEV2ZW50cygpOwoKICAgICAgaWYgKGRvUHJvZmlsaW5nKSB7CiAgICAgICAgcHJvZmlsZS5tYWtlQ29udGFjdENvbnN0cmFpbnRzID0gcGVyZm9ybWFuY2Uubm93KCkgLSBwcm9maWxpbmdTdGFydDsKICAgICAgICBwcm9maWxpbmdTdGFydCA9IHBlcmZvcm1hbmNlLm5vdygpOwogICAgICB9IC8vIFdha2UgdXAgYm9kaWVzCgoKICAgICAgZm9yIChpID0gMDsgaSAhPT0gTjsgaSsrKSB7CiAgICAgICAgY29uc3QgYmkgPSBib2RpZXNbaV07CgogICAgICAgIGlmIChiaS53YWtlVXBBZnRlck5hcnJvd3BoYXNlKSB7CiAgICAgICAgICBiaS53YWtlVXAoKTsKICAgICAgICAgIGJpLndha2VVcEFmdGVyTmFycm93cGhhc2UgPSBmYWxzZTsKICAgICAgICB9CiAgICAgIH0gLy8gQWRkIHVzZXItYWRkZWQgY29uc3RyYWludHMKCgogICAgICBOY29uc3RyYWludHMgPSBjb25zdHJhaW50cy5sZW5ndGg7CgogICAgICBmb3IgKGkgPSAwOyBpICE9PSBOY29uc3RyYWludHM7IGkrKykgewogICAgICAgIGNvbnN0IGMgPSBjb25zdHJhaW50c1tpXTsKICAgICAgICBjLnVwZGF0ZSgpOwoKICAgICAgICBmb3IgKGxldCBqID0gMCwgTmVxID0gYy5lcXVhdGlvbnMubGVuZ3RoOyBqICE9PSBOZXE7IGorKykgewogICAgICAgICAgY29uc3QgZXEgPSBjLmVxdWF0aW9uc1tqXTsKICAgICAgICAgIHNvbHZlci5hZGRFcXVhdGlvbihlcSk7CiAgICAgICAgfQogICAgICB9IC8vIFNvbHZlIHRoZSBjb25zdHJhaW5lZCBzeXN0ZW0KCgogICAgICBzb2x2ZXIuc29sdmUoZHQsIHRoaXMpOwoKICAgICAgaWYgKGRvUHJvZmlsaW5nKSB7CiAgICAgICAgcHJvZmlsZS5zb2x2ZSA9IHBlcmZvcm1hbmNlLm5vdygpIC0gcHJvZmlsaW5nU3RhcnQ7CiAgICAgIH0gLy8gUmVtb3ZlIGFsbCBjb250YWN0cyBmcm9tIHNvbHZlcgoKCiAgICAgIHNvbHZlci5yZW1vdmVBbGxFcXVhdGlvbnMoKTsgLy8gQXBwbHkgZGFtcGluZywgc2VlIGh0dHA6Ly9jb2RlLmdvb2dsZS5jb20vcC9idWxsZXQvaXNzdWVzL2RldGFpbD9pZD03NCBmb3IgZGV0YWlscwoKICAgICAgY29uc3QgcG93ID0gTWF0aC5wb3c7CgogICAgICBmb3IgKGkgPSAwOyBpICE9PSBOOyBpKyspIHsKICAgICAgICBjb25zdCBiaSA9IGJvZGllc1tpXTsKCiAgICAgICAgaWYgKGJpLnR5cGUgJiBEWU5BTUlDKSB7CiAgICAgICAgICAvLyBPbmx5IGZvciBkeW5hbWljIGJvZGllcwogICAgICAgICAgY29uc3QgbGQgPSBwb3coMS4wIC0gYmkubGluZWFyRGFtcGluZywgZHQpOwogICAgICAgICAgY29uc3QgdiA9IGJpLnZlbG9jaXR5OwogICAgICAgICAgdi5zY2FsZShsZCwgdik7CiAgICAgICAgICBjb25zdCBhdiA9IGJpLmFuZ3VsYXJWZWxvY2l0eTsKCiAgICAgICAgICBpZiAoYXYpIHsKICAgICAgICAgICAgY29uc3QgYWQgPSBwb3coMS4wIC0gYmkuYW5ndWxhckRhbXBpbmcsIGR0KTsKICAgICAgICAgICAgYXYuc2NhbGUoYWQsIGF2KTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KCiAgICAgIHRoaXMuZGlzcGF0Y2hFdmVudChXb3JsZF9zdGVwX3ByZVN0ZXBFdmVudCk7IC8vIExlYXAgZnJvZwogICAgICAvLyB2bmV3ID0gdiArIGgqZi9tCiAgICAgIC8vIHhuZXcgPSB4ICsgaCp2bmV3CgogICAgICBpZiAoZG9Qcm9maWxpbmcpIHsKICAgICAgICBwcm9maWxpbmdTdGFydCA9IHBlcmZvcm1hbmNlLm5vdygpOwogICAgICB9CgogICAgICBjb25zdCBzdGVwbnVtYmVyID0gdGhpcy5zdGVwbnVtYmVyOwogICAgICBjb25zdCBxdWF0Tm9ybWFsaXplID0gc3RlcG51bWJlciAlICh0aGlzLnF1YXROb3JtYWxpemVTa2lwICsgMSkgPT09IDA7CiAgICAgIGNvbnN0IHF1YXROb3JtYWxpemVGYXN0ID0gdGhpcy5xdWF0Tm9ybWFsaXplRmFzdDsKCiAgICAgIGZvciAoaSA9IDA7IGkgIT09IE47IGkrKykgewogICAgICAgIGJvZGllc1tpXS5pbnRlZ3JhdGUoZHQsIHF1YXROb3JtYWxpemUsIHF1YXROb3JtYWxpemVGYXN0KTsKICAgICAgfQoKICAgICAgdGhpcy5jbGVhckZvcmNlcygpOwogICAgICB0aGlzLmJyb2FkcGhhc2UuZGlydHkgPSB0cnVlOwoKICAgICAgaWYgKGRvUHJvZmlsaW5nKSB7CiAgICAgICAgcHJvZmlsZS5pbnRlZ3JhdGUgPSBwZXJmb3JtYW5jZS5ub3coKSAtIHByb2ZpbGluZ1N0YXJ0OwogICAgICB9IC8vIFVwZGF0ZSBzdGVwIG51bWJlcgoKCiAgICAgIHRoaXMuc3RlcG51bWJlciArPSAxOwogICAgICB0aGlzLmRpc3BhdGNoRXZlbnQoV29ybGRfc3RlcF9wb3N0U3RlcEV2ZW50KTsgLy8gU2xlZXBpbmcgdXBkYXRlCgogICAgICBsZXQgaGFzQWN0aXZlQm9kaWVzID0gdHJ1ZTsKCiAgICAgIGlmICh0aGlzLmFsbG93U2xlZXApIHsKICAgICAgICBoYXNBY3RpdmVCb2RpZXMgPSBmYWxzZTsKCiAgICAgICAgZm9yIChpID0gMDsgaSAhPT0gTjsgaSsrKSB7CiAgICAgICAgICBjb25zdCBiaSA9IGJvZGllc1tpXTsKICAgICAgICAgIGJpLnNsZWVwVGljayh0aGlzLnRpbWUpOwoKICAgICAgICAgIGlmIChiaS5zbGVlcFN0YXRlICE9PSBCb2R5LlNMRUVQSU5HKSB7CiAgICAgICAgICAgIGhhc0FjdGl2ZUJvZGllcyA9IHRydWU7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CgogICAgICB0aGlzLmhhc0FjdGl2ZUJvZGllcyA9IGhhc0FjdGl2ZUJvZGllczsKICAgIH0KCiAgICBlbWl0Q29udGFjdEV2ZW50cygpIHsKICAgICAgY29uc3QgaGFzQmVnaW5Db250YWN0ID0gdGhpcy5oYXNBbnlFdmVudExpc3RlbmVyKCdiZWdpbkNvbnRhY3QnKTsKICAgICAgY29uc3QgaGFzRW5kQ29udGFjdCA9IHRoaXMuaGFzQW55RXZlbnRMaXN0ZW5lcignZW5kQ29udGFjdCcpOwoKICAgICAgaWYgKGhhc0JlZ2luQ29udGFjdCB8fCBoYXNFbmRDb250YWN0KSB7CiAgICAgICAgdGhpcy5ib2R5T3ZlcmxhcEtlZXBlci5nZXREaWZmKGFkZGl0aW9ucywgcmVtb3ZhbHMpOwogICAgICB9CgogICAgICBpZiAoaGFzQmVnaW5Db250YWN0KSB7CiAgICAgICAgZm9yIChsZXQgaSA9IDAsIGwgPSBhZGRpdGlvbnMubGVuZ3RoOyBpIDwgbDsgaSArPSAyKSB7CiAgICAgICAgICBiZWdpbkNvbnRhY3RFdmVudC5ib2R5QSA9IHRoaXMuZ2V0Qm9keUJ5SWQoYWRkaXRpb25zW2ldKTsKICAgICAgICAgIGJlZ2luQ29udGFjdEV2ZW50LmJvZHlCID0gdGhpcy5nZXRCb2R5QnlJZChhZGRpdGlvbnNbaSArIDFdKTsKICAgICAgICAgIHRoaXMuZGlzcGF0Y2hFdmVudChiZWdpbkNvbnRhY3RFdmVudCk7CiAgICAgICAgfQoKICAgICAgICBiZWdpbkNvbnRhY3RFdmVudC5ib2R5QSA9IGJlZ2luQ29udGFjdEV2ZW50LmJvZHlCID0gbnVsbDsKICAgICAgfQoKICAgICAgaWYgKGhhc0VuZENvbnRhY3QpIHsKICAgICAgICBmb3IgKGxldCBpID0gMCwgbCA9IHJlbW92YWxzLmxlbmd0aDsgaSA8IGw7IGkgKz0gMikgewogICAgICAgICAgZW5kQ29udGFjdEV2ZW50LmJvZHlBID0gdGhpcy5nZXRCb2R5QnlJZChyZW1vdmFsc1tpXSk7CiAgICAgICAgICBlbmRDb250YWN0RXZlbnQuYm9keUIgPSB0aGlzLmdldEJvZHlCeUlkKHJlbW92YWxzW2kgKyAxXSk7CiAgICAgICAgICB0aGlzLmRpc3BhdGNoRXZlbnQoZW5kQ29udGFjdEV2ZW50KTsKICAgICAgICB9CgogICAgICAgIGVuZENvbnRhY3RFdmVudC5ib2R5QSA9IGVuZENvbnRhY3RFdmVudC5ib2R5QiA9IG51bGw7CiAgICAgIH0KCiAgICAgIGFkZGl0aW9ucy5sZW5ndGggPSByZW1vdmFscy5sZW5ndGggPSAwOwogICAgICBjb25zdCBoYXNCZWdpblNoYXBlQ29udGFjdCA9IHRoaXMuaGFzQW55RXZlbnRMaXN0ZW5lcignYmVnaW5TaGFwZUNvbnRhY3QnKTsKICAgICAgY29uc3QgaGFzRW5kU2hhcGVDb250YWN0ID0gdGhpcy5oYXNBbnlFdmVudExpc3RlbmVyKCdlbmRTaGFwZUNvbnRhY3QnKTsKCiAgICAgIGlmIChoYXNCZWdpblNoYXBlQ29udGFjdCB8fCBoYXNFbmRTaGFwZUNvbnRhY3QpIHsKICAgICAgICB0aGlzLnNoYXBlT3ZlcmxhcEtlZXBlci5nZXREaWZmKGFkZGl0aW9ucywgcmVtb3ZhbHMpOwogICAgICB9CgogICAgICBpZiAoaGFzQmVnaW5TaGFwZUNvbnRhY3QpIHsKICAgICAgICBmb3IgKGxldCBpID0gMCwgbCA9IGFkZGl0aW9ucy5sZW5ndGg7IGkgPCBsOyBpICs9IDIpIHsKICAgICAgICAgIGNvbnN0IHNoYXBlQSA9IHRoaXMuZ2V0U2hhcGVCeUlkKGFkZGl0aW9uc1tpXSk7CiAgICAgICAgICBjb25zdCBzaGFwZUIgPSB0aGlzLmdldFNoYXBlQnlJZChhZGRpdGlvbnNbaSArIDFdKTsKICAgICAgICAgIGJlZ2luU2hhcGVDb250YWN0RXZlbnQuc2hhcGVBID0gc2hhcGVBOwogICAgICAgICAgYmVnaW5TaGFwZUNvbnRhY3RFdmVudC5zaGFwZUIgPSBzaGFwZUI7CiAgICAgICAgICBpZiAoc2hhcGVBKSBiZWdpblNoYXBlQ29udGFjdEV2ZW50LmJvZHlBID0gc2hhcGVBLmJvZHk7CiAgICAgICAgICBpZiAoc2hhcGVCKSBiZWdpblNoYXBlQ29udGFjdEV2ZW50LmJvZHlCID0gc2hhcGVCLmJvZHk7CiAgICAgICAgICB0aGlzLmRpc3BhdGNoRXZlbnQoYmVnaW5TaGFwZUNvbnRhY3RFdmVudCk7CiAgICAgICAgfQoKICAgICAgICBiZWdpblNoYXBlQ29udGFjdEV2ZW50LmJvZHlBID0gYmVnaW5TaGFwZUNvbnRhY3RFdmVudC5ib2R5QiA9IGJlZ2luU2hhcGVDb250YWN0RXZlbnQuc2hhcGVBID0gYmVnaW5TaGFwZUNvbnRhY3RFdmVudC5zaGFwZUIgPSBudWxsOwogICAgICB9CgogICAgICBpZiAoaGFzRW5kU2hhcGVDb250YWN0KSB7CiAgICAgICAgZm9yIChsZXQgaSA9IDAsIGwgPSByZW1vdmFscy5sZW5ndGg7IGkgPCBsOyBpICs9IDIpIHsKICAgICAgICAgIGNvbnN0IHNoYXBlQSA9IHRoaXMuZ2V0U2hhcGVCeUlkKHJlbW92YWxzW2ldKTsKICAgICAgICAgIGNvbnN0IHNoYXBlQiA9IHRoaXMuZ2V0U2hhcGVCeUlkKHJlbW92YWxzW2kgKyAxXSk7CiAgICAgICAgICBlbmRTaGFwZUNvbnRhY3RFdmVudC5zaGFwZUEgPSBzaGFwZUE7CiAgICAgICAgICBlbmRTaGFwZUNvbnRhY3RFdmVudC5zaGFwZUIgPSBzaGFwZUI7CiAgICAgICAgICBpZiAoc2hhcGVBKSBlbmRTaGFwZUNvbnRhY3RFdmVudC5ib2R5QSA9IHNoYXBlQS5ib2R5OwogICAgICAgICAgaWYgKHNoYXBlQikgZW5kU2hhcGVDb250YWN0RXZlbnQuYm9keUIgPSBzaGFwZUIuYm9keTsKICAgICAgICAgIHRoaXMuZGlzcGF0Y2hFdmVudChlbmRTaGFwZUNvbnRhY3RFdmVudCk7CiAgICAgICAgfQoKICAgICAgICBlbmRTaGFwZUNvbnRhY3RFdmVudC5ib2R5QSA9IGVuZFNoYXBlQ29udGFjdEV2ZW50LmJvZHlCID0gZW5kU2hhcGVDb250YWN0RXZlbnQuc2hhcGVBID0gZW5kU2hhcGVDb250YWN0RXZlbnQuc2hhcGVCID0gbnVsbDsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBTZXRzIGFsbCBib2R5IGZvcmNlcyBpbiB0aGUgd29ybGQgdG8gemVyby4KICAgICAqLwoKCiAgICBjbGVhckZvcmNlcygpIHsKICAgICAgY29uc3QgYm9kaWVzID0gdGhpcy5ib2RpZXM7CiAgICAgIGNvbnN0IE4gPSBib2RpZXMubGVuZ3RoOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IE47IGkrKykgewogICAgICAgIGNvbnN0IGIgPSBib2RpZXNbaV07CiAgICAgICAgYi5mb3JjZTsKICAgICAgICBiLnRvcnF1ZTsKICAgICAgICBiLmZvcmNlLnNldCgwLCAwLCAwKTsKICAgICAgICBiLnRvcnF1ZS5zZXQoMCwgMCwgMCk7CiAgICAgIH0KICAgIH0KCiAgfSAvLyBUZW1wIHN0dWZmCgogIG5ldyBBQUJCKCk7CiAgY29uc3QgdG1wUmF5ID0gbmV3IFJheSgpOyAvLyBwZXJmb3JtYW5jZS5ub3coKSBmYWxsYmFjayBvbiBEYXRlLm5vdygpCgogIGNvbnN0IHBlcmZvcm1hbmNlID0gZ2xvYmFsVGhpcy5wZXJmb3JtYW5jZSB8fCB7fTsKCiAgaWYgKCFwZXJmb3JtYW5jZS5ub3cpIHsKICAgIGxldCBub3dPZmZzZXQgPSBEYXRlLm5vdygpOwoKICAgIGlmIChwZXJmb3JtYW5jZS50aW1pbmcgJiYgcGVyZm9ybWFuY2UudGltaW5nLm5hdmlnYXRpb25TdGFydCkgewogICAgICBub3dPZmZzZXQgPSBwZXJmb3JtYW5jZS50aW1pbmcubmF2aWdhdGlvblN0YXJ0OwogICAgfQoKICAgIHBlcmZvcm1hbmNlLm5vdyA9ICgpID0+IERhdGUubm93KCkgLSBub3dPZmZzZXQ7CiAgfQoKICBuZXcgVmVjMygpOyAvLyBEaXNwYXRjaGVkIGFmdGVyIHRoZSB3b3JsZCBoYXMgc3RlcHBlZCBmb3J3YXJkIGluIHRpbWUuCiAgLy8gUmV1c2FibGUgZXZlbnQgb2JqZWN0cyB0byBzYXZlIG1lbW9yeS4KCiAgY29uc3QgV29ybGRfc3RlcF9wb3N0U3RlcEV2ZW50ID0gewogICAgdHlwZTogJ3Bvc3RTdGVwJwogIH07IC8vIERpc3BhdGNoZWQgYmVmb3JlIHRoZSB3b3JsZCBzdGVwcyBmb3J3YXJkIGluIHRpbWUuCgogIGNvbnN0IFdvcmxkX3N0ZXBfcHJlU3RlcEV2ZW50ID0gewogICAgdHlwZTogJ3ByZVN0ZXAnCiAgfTsKICBjb25zdCBXb3JsZF9zdGVwX2NvbGxpZGVFdmVudCA9IHsKICAgIHR5cGU6IEJvZHkuQ09MTElERV9FVkVOVF9OQU1FLAogICAgYm9keTogbnVsbCwKICAgIGNvbnRhY3Q6IG51bGwKICB9OyAvLyBQb29scyBmb3IgdW51c2VkIG9iamVjdHMKCiAgY29uc3QgV29ybGRfc3RlcF9vbGRDb250YWN0cyA9IFtdOwogIGNvbnN0IFdvcmxkX3N0ZXBfZnJpY3Rpb25FcXVhdGlvblBvb2wgPSBbXTsgLy8gUmV1c2FibGUgYXJyYXlzIGZvciBjb2xsaXNpb24gcGFpcnMKCiAgY29uc3QgV29ybGRfc3RlcF9wMSA9IFtdOwogIGNvbnN0IFdvcmxkX3N0ZXBfcDIgPSBbXTsgLy8gU3R1ZmYgZm9yIGVtaXRDb250YWN0RXZlbnRzCgogIGNvbnN0IGFkZGl0aW9ucyA9IFtdOwogIGNvbnN0IHJlbW92YWxzID0gW107CiAgY29uc3QgYmVnaW5Db250YWN0RXZlbnQgPSB7CiAgICB0eXBlOiAnYmVnaW5Db250YWN0JywKICAgIGJvZHlBOiBudWxsLAogICAgYm9keUI6IG51bGwKICB9OwogIGNvbnN0IGVuZENvbnRhY3RFdmVudCA9IHsKICAgIHR5cGU6ICdlbmRDb250YWN0JywKICAgIGJvZHlBOiBudWxsLAogICAgYm9keUI6IG51bGwKICB9OwogIGNvbnN0IGJlZ2luU2hhcGVDb250YWN0RXZlbnQgPSB7CiAgICB0eXBlOiAnYmVnaW5TaGFwZUNvbnRhY3QnLAogICAgYm9keUE6IG51bGwsCiAgICBib2R5QjogbnVsbCwKICAgIHNoYXBlQTogbnVsbCwKICAgIHNoYXBlQjogbnVsbAogIH07CiAgY29uc3QgZW5kU2hhcGVDb250YWN0RXZlbnQgPSB7CiAgICB0eXBlOiAnZW5kU2hhcGVDb250YWN0JywKICAgIGJvZHlBOiBudWxsLAogICAgYm9keUI6IG51bGwsCiAgICBzaGFwZUE6IG51bGwsCiAgICBzaGFwZUI6IG51bGwKICB9OwoKICBjb25zdCBhZGRDb250YWN0TWF0ZXJpYWwgPSAod29ybGQsIGNyZWF0ZU1hdGVyaWFsLCBfcmVmLCB1dWlkKSA9PiB7CiAgICBsZXQgW21hdGVyaWFsQSwgbWF0ZXJpYWxCLCBvcHRpb25zXSA9IF9yZWY7CiAgICBjb25zdCBtYXRBID0gY3JlYXRlTWF0ZXJpYWwobWF0ZXJpYWxBKTsKICAgIGNvbnN0IG1hdEIgPSBjcmVhdGVNYXRlcmlhbChtYXRlcmlhbEIpOwogICAgY29uc3QgY29udGFjdE1hdGVyaWFsID0gbmV3IENvbnRhY3RNYXRlcmlhbChtYXRBLCBtYXRCLCBvcHRpb25zKTsKICAgIGNvbnRhY3RNYXRlcmlhbC51dWlkID0gdXVpZDsKICAgIHdvcmxkLmFkZENvbnRhY3RNYXRlcmlhbChjb250YWN0TWF0ZXJpYWwpOwogIH07CiAgY29uc3QgcmVtb3ZlQ29udGFjdE1hdGVyaWFsID0gKHdvcmxkLCBjbVVVSUQpID0+IHsKICAgIGNvbnN0IGluZGV4ID0gd29ybGQuY29udGFjdG1hdGVyaWFscy5maW5kSW5kZXgoX3JlZjIgPT4gewogICAgICBsZXQgewogICAgICAgIHV1aWQKICAgICAgfSA9IF9yZWYyOwogICAgICByZXR1cm4gdXVpZCA9PT0gY21VVUlEOwogICAgfSk7CiAgICBjb25zdCBbewogICAgICBpZDogaQogICAgfSwgewogICAgICBpZDogagogICAgfV0gPSB3b3JsZC5jb250YWN0bWF0ZXJpYWxzW2luZGV4XS5tYXRlcmlhbHM7CiAgICB3b3JsZC5jb250YWN0bWF0ZXJpYWxzLnNwbGljZShpbmRleCwgMSk7CiAgICBkZWxldGUgd29ybGQuY29udGFjdE1hdGVyaWFsVGFibGUuZGF0YVtpIDwgaiA/IGAke2l9LSR7an1gIDogYCR7an0tJHtpfWBdOwogIH07CgogIGxldCBtYXRlcmlhbElkID0gMDsKICBjb25zdCBjcmVhdGVNYXRlcmlhbEZhY3RvcnkgPSBtYXRlcmlhbHMgPT4gZnVuY3Rpb24gKG5hbWVPck9wdGlvbnMpIHsKICAgIGlmIChuYW1lT3JPcHRpb25zID09PSB2b2lkIDApIHsKICAgICAgbmFtZU9yT3B0aW9ucyA9IHt9OwogICAgfQogICAgY29uc3QgbWF0ZXJpYWxPcHRpb25zID0gdHlwZW9mIG5hbWVPck9wdGlvbnMgPT09ICdzdHJpbmcnID8gewogICAgICBuYW1lOiBuYW1lT3JPcHRpb25zCiAgICB9IDogewogICAgICBuYW1lOiBTeW1ib2wuZm9yKGBNYXRlcmlhbCR7bWF0ZXJpYWxJZCsrfWApLAogICAgICAuLi5uYW1lT3JPcHRpb25zCiAgICB9OwogICAgY29uc3QgewogICAgICBuYW1lCiAgICB9ID0gbWF0ZXJpYWxPcHRpb25zOwogICAgbWF0ZXJpYWxzW25hbWVdID0gbWF0ZXJpYWxzW25hbWVdIHx8IG5ldyBNYXRlcmlhbChtYXRlcmlhbE9wdGlvbnMpOwogICAgcmV0dXJuIG1hdGVyaWFsc1tuYW1lXTsKICB9OwoKICAvKioKICAgKiBAdHlwZWRlZiB7IGltcG9ydCgnY2Fubm9uLWVzJykuTWF0ZXJpYWxPcHRpb25zIH0gTWF0ZXJpYWxPcHRpb25zCiAgICovCgogIGNvbnN0IG1ha2VWZWMzID0gX3JlZiA9PiB7CiAgICBsZXQgW3gsIHksIHpdID0gX3JlZjsKICAgIHJldHVybiBuZXcgVmVjMyh4LCB5LCB6KTsKICB9OwogIGNvbnN0IHByZXBhcmVTcGhlcmUgPSBhcmdzID0+IEFycmF5LmlzQXJyYXkoYXJncykgPyBhcmdzIDogW2FyZ3NdOwogIGNvbnN0IHByZXBhcmVDb252ZXhQb2x5aGVkcm9uID0gX3JlZjIgPT4gewogICAgbGV0IFt2LCBmYWNlcywgbiwgYSwgYm91bmRpbmdTcGhlcmVSYWRpdXNdID0gX3JlZjI7CiAgICByZXR1cm4gW3sKICAgICAgYXhlczogYSA/IGEubWFwKG1ha2VWZWMzKSA6IHVuZGVmaW5lZCwKICAgICAgYm91bmRpbmdTcGhlcmVSYWRpdXMsCiAgICAgIGZhY2VzLAogICAgICBub3JtYWxzOiBuID8gbi5tYXAobWFrZVZlYzMpIDogdW5kZWZpbmVkLAogICAgICB2ZXJ0aWNlczogdiA/IHYubWFwKG1ha2VWZWMzKSA6IHVuZGVmaW5lZAogICAgfV07CiAgfTsKICBmdW5jdGlvbiBjcmVhdGVTaGFwZSh0eXBlLCBhcmdzKSB7CiAgICBzd2l0Y2ggKHR5cGUpIHsKICAgICAgY2FzZSAnQm94JzoKICAgICAgICByZXR1cm4gbmV3IEJveChuZXcgVmVjMyguLi5hcmdzLm1hcCh2ID0+IHYgLyAyKSkpOwogICAgICAvLyBleHRlbnRzID0+IGhhbGZFeHRlbnRzCiAgICAgIGNhc2UgJ0NvbnZleFBvbHloZWRyb24nOgogICAgICAgIHJldHVybiBuZXcgQ29udmV4UG9seWhlZHJvbiguLi5wcmVwYXJlQ29udmV4UG9seWhlZHJvbihhcmdzKSk7CiAgICAgIGNhc2UgJ0N5bGluZGVyJzoKICAgICAgICByZXR1cm4gbmV3IEN5bGluZGVyKC4uLmFyZ3MpOwogICAgICAvLyBbIHJhZGl1c1RvcCwgcmFkaXVzQm90dG9tLCBoZWlnaHQsIG51bVNlZ21lbnRzIF0gPSBhcmdzCiAgICAgIGNhc2UgJ0hlaWdodGZpZWxkJzoKICAgICAgICByZXR1cm4gbmV3IEhlaWdodGZpZWxkKC4uLmFyZ3MpOwogICAgICAvLyBbIEFycmF5IGRhdGEsIG9wdGlvbnM6IHttaW5WYWx1ZSwgbWF4VmFsdWUsIGVsZW1lbnRTaXplfSAgXSA9IGFyZ3MKICAgICAgY2FzZSAnUGFydGljbGUnOgogICAgICAgIHJldHVybiBuZXcgUGFydGljbGUoKTsKICAgICAgLy8gbm8gYXJncwogICAgICBjYXNlICdQbGFuZSc6CiAgICAgICAgcmV0dXJuIG5ldyBQbGFuZSgpOwogICAgICAvLyBubyBhcmdzLCBpbmZpbml0ZSB4IGFuZCB5CiAgICAgIGNhc2UgJ1NwaGVyZSc6CiAgICAgICAgcmV0dXJuIG5ldyBTcGhlcmUoLi4ucHJlcGFyZVNwaGVyZShhcmdzKSk7CiAgICAgIC8vIHJhZGl1cyA9IGFyZ3MKICAgICAgY2FzZSAnVHJpbWVzaCc6CiAgICAgICAgcmV0dXJuIG5ldyBUcmltZXNoKC4uLmFyZ3MpOwogICAgICAvLyBbdmVydGljZXMsIGluZGljZXNdID0gYXJncwogICAgfQogIH0KCiAgLyoqCiAgICogQHBhcmFtIHtUSFJFRS5RdWF0ZXJuaW9ufSB0YXJnZXQKICAgKiBAcGFyYW0ge3sgcm90YXRpb24/OiBUSFJFRS5WZWN0b3IzVHVwbGUgcXVhdGVybmlvbj86IFRIUkVFLlZlY3RvcjRUdXBsZSB9fSBwcm9wcwogICAqIEByZXR1cm5zIHtUSFJFRS5RdWF0ZXJuaW9ufQogICAqLwogIGNvbnN0IHNldFF1YXRlcm5pb24gPSAodGFyZ2V0LCBfcmVmMykgPT4gewogICAgbGV0IHsKICAgICAgcXVhdGVybmlvbiwKICAgICAgcm90YXRpb24KICAgIH0gPSBfcmVmMzsKICAgIGlmIChxdWF0ZXJuaW9uKSB7CiAgICAgIHRhcmdldC5zZXQoLi4ucXVhdGVybmlvbik7CiAgICB9IGVsc2UgaWYgKHJvdGF0aW9uKSB7CiAgICAgIHRhcmdldC5zZXRGcm9tRXVsZXIoLi4ucm90YXRpb24pOwogICAgfQogICAgcmV0dXJuIHRhcmdldDsKICB9OwoKICAvKioKICAgKiBAZnVuY3Rpb24KICAgKiBAcGFyYW0ge09iamVjdH0gb3B0aW9ucwogICAqIEBwYXJhbSB7c3RyaW5nfSBvcHRpb25zLnV1aWQKICAgKiBAcGFyYW0ge0JvZHlQcm9wc30gb3B0aW9ucy5wcm9wcwogICAqIEBwYXJhbSB7Qm9keVNoYXBlVHlwZX0gb3B0aW9ucy50eXBlCiAgICogQHBhcmFtIHsobWF0ZXJpYWxPcHRpb25zOiBNYXRlcmlhbE9wdGlvbnMpID0+IE1hdGVyaWFsID19IG9wdGlvbnMuY3JlYXRlTWF0ZXJpYWwKICAgKiBAcmV0dXJucyB7Qm9keX0KICAgKi8KICBjb25zdCBwcm9wc1RvQm9keSA9IG9wdGlvbnMgPT4gewogICAgY29uc3QgewogICAgICB1dWlkLAogICAgICBwcm9wcywKICAgICAgdHlwZSwKICAgICAgY3JlYXRlTWF0ZXJpYWwgPSBtYXRlcmlhbE9wdGlvbnMgPT4gbmV3IE1hdGVyaWFsKG1hdGVyaWFsT3B0aW9ucykKICAgIH0gPSBvcHRpb25zOwogICAgY29uc3QgewogICAgICBhbmd1bGFyRmFjdG9yID0gWzEsIDEsIDFdLAogICAgICBhbmd1bGFyVmVsb2NpdHkgPSBbMCwgMCwgMF0sCiAgICAgIGFyZ3MgPSBbXSwKICAgICAgY29sbGlzaW9uUmVzcG9uc2UsCiAgICAgIGxpbmVhckZhY3RvciA9IFsxLCAxLCAxXSwKICAgICAgbWFzcywKICAgICAgbWF0ZXJpYWwsCiAgICAgIG9uQ29sbGlkZSwKICAgICAgcG9zaXRpb24gPSBbMCwgMCwgMF0sCiAgICAgIHJvdGF0aW9uLAogICAgICBxdWF0ZXJuaW9uLAogICAgICBzaGFwZXMsCiAgICAgIHR5cGU6IGJvZHlUeXBlLAogICAgICB2ZWxvY2l0eSA9IFswLCAwLCAwXSwKICAgICAgLi4uZXh0cmEKICAgIH0gPSBwcm9wczsKICAgIGNvbnN0IGJvZHkgPSBuZXcgQm9keSh7CiAgICAgIC4uLmV4dHJhLAogICAgICBtYXNzOiBib2R5VHlwZSA9PT0gJ1N0YXRpYycgPyAwIDogbWFzcywKICAgICAgbWF0ZXJpYWw6IG1hdGVyaWFsID8gY3JlYXRlTWF0ZXJpYWwobWF0ZXJpYWwpIDogdW5kZWZpbmVkLAogICAgICB0eXBlOiBib2R5VHlwZSA/IEJvZHlbYm9keVR5cGUudG9VcHBlckNhc2UoKV0gOiB1bmRlZmluZWQKICAgIH0pOwogICAgYm9keS51dWlkID0gdXVpZDsKICAgIGlmIChjb2xsaXNpb25SZXNwb25zZSAhPT0gdW5kZWZpbmVkKSB7CiAgICAgIGJvZHkuY29sbGlzaW9uUmVzcG9uc2UgPSBjb2xsaXNpb25SZXNwb25zZTsKICAgIH0KICAgIGlmICh0eXBlID09PSAnQ29tcG91bmQnKSB7CiAgICAgIHNoYXBlcy5mb3JFYWNoKF9yZWY0ID0+IHsKICAgICAgICBsZXQgewogICAgICAgICAgdHlwZSwKICAgICAgICAgIGFyZ3MsCiAgICAgICAgICBwb3NpdGlvbiwKICAgICAgICAgIHJvdGF0aW9uLAogICAgICAgICAgcXVhdGVybmlvbiwKICAgICAgICAgIG1hdGVyaWFsLAogICAgICAgICAgLi4uZXh0cmEKICAgICAgICB9ID0gX3JlZjQ7CiAgICAgICAgY29uc3Qgc2hhcGVCb2R5ID0gYm9keS5hZGRTaGFwZShjcmVhdGVTaGFwZSh0eXBlLCBhcmdzKSwgcG9zaXRpb24gPyBuZXcgVmVjMyguLi5wb3NpdGlvbikgOiB1bmRlZmluZWQsIHNldFF1YXRlcm5pb24obmV3IFF1YXRlcm5pb24oMCwgMCwgMCwgMSksIHsKICAgICAgICAgIHF1YXRlcm5pb24sCiAgICAgICAgICByb3RhdGlvbgogICAgICAgIH0pKTsKICAgICAgICBpZiAobWF0ZXJpYWwpIHNoYXBlQm9keS5tYXRlcmlhbCA9IGNyZWF0ZU1hdGVyaWFsKG1hdGVyaWFsKTsKICAgICAgICBPYmplY3QuYXNzaWduKHNoYXBlQm9keSwgZXh0cmEpOwogICAgICB9KTsKICAgIH0gZWxzZSB7CiAgICAgIGJvZHkuYWRkU2hhcGUoY3JlYXRlU2hhcGUodHlwZSwgYXJncykpOwogICAgfQogICAgYm9keS5wb3NpdGlvbi5zZXQocG9zaXRpb25bMF0sIHBvc2l0aW9uWzFdLCBwb3NpdGlvblsyXSk7CiAgICBib2R5LnZlbG9jaXR5LnNldCh2ZWxvY2l0eVswXSwgdmVsb2NpdHlbMV0sIHZlbG9jaXR5WzJdKTsKICAgIGJvZHkuYW5ndWxhclZlbG9jaXR5LnNldChhbmd1bGFyVmVsb2NpdHlbMF0sIGFuZ3VsYXJWZWxvY2l0eVsxXSwgYW5ndWxhclZlbG9jaXR5WzJdKTsKICAgIGJvZHkubGluZWFyRmFjdG9yLnNldChsaW5lYXJGYWN0b3JbMF0sIGxpbmVhckZhY3RvclsxXSwgbGluZWFyRmFjdG9yWzJdKTsKICAgIGJvZHkuYW5ndWxhckZhY3Rvci5zZXQoYW5ndWxhckZhY3RvclswXSwgYW5ndWxhckZhY3RvclsxXSwgYW5ndWxhckZhY3RvclsyXSk7CiAgICBzZXRRdWF0ZXJuaW9uKGJvZHkucXVhdGVybmlvbiwgewogICAgICBxdWF0ZXJuaW9uLAogICAgICByb3RhdGlvbgogICAgfSk7CiAgICByZXR1cm4gYm9keTsKICB9OwoKICBjb25zdCBhZGRCb2RpZXMgPSAoc3RhdGUsIGNyZWF0ZU1hdGVyaWFsLCBfcmVmKSA9PiB7CiAgICBsZXQgewogICAgICBwcm9wcywKICAgICAgdHlwZSwKICAgICAgdXVpZAogICAgfSA9IF9yZWY7CiAgICBmb3IgKGxldCBpID0gMDsgaSA8IHV1aWQubGVuZ3RoOyBpKyspIHsKICAgICAgY29uc3QgYm9keSA9IHByb3BzVG9Cb2R5KHsKICAgICAgICBjcmVhdGVNYXRlcmlhbCwKICAgICAgICBwcm9wczogcHJvcHNbaV0sCiAgICAgICAgdHlwZSwKICAgICAgICB1dWlkOiB1dWlkW2ldCiAgICAgIH0pOwogICAgICBzdGF0ZS53b3JsZC5hZGRCb2R5KGJvZHkpOwogICAgICBpZiAocHJvcHNbaV0ub25Db2xsaWRlKSBib2R5LmFkZEV2ZW50TGlzdGVuZXIoJ2NvbGxpZGUnLCBfcmVmMiA9PiB7CiAgICAgICAgbGV0IHsKICAgICAgICAgIHR5cGUsCiAgICAgICAgICBib2R5LAogICAgICAgICAgdGFyZ2V0LAogICAgICAgICAgY29udGFjdAogICAgICAgIH0gPSBfcmVmMjsKICAgICAgICBpZiAoIWJvZHkudXVpZCB8fCAhdGFyZ2V0LnV1aWQpIHJldHVybjsKICAgICAgICBjb25zdCB7CiAgICAgICAgICBuaSwKICAgICAgICAgIHJpLAogICAgICAgICAgcmosCiAgICAgICAgICBiaSwKICAgICAgICAgIGJqLAogICAgICAgICAgaWQKICAgICAgICB9ID0gY29udGFjdDsKICAgICAgICBjb25zdCBjb250YWN0UG9pbnQgPSBiaS5wb3NpdGlvbi52YWRkKHJpKTsKICAgICAgICBjb25zdCBjb250YWN0Tm9ybWFsID0gYmkgPT09IGJvZHkgPyBuaSA6IG5pLnNjYWxlKC0xKTsKICAgICAgICBzZWxmLnBvc3RNZXNzYWdlKHsKICAgICAgICAgIGJvZHk6IGJvZHkudXVpZCwKICAgICAgICAgIGNvbGxpc2lvbkZpbHRlcnM6IHsKICAgICAgICAgICAgYm9keUZpbHRlckdyb3VwOiBib2R5LmNvbGxpc2lvbkZpbHRlckdyb3VwLAogICAgICAgICAgICBib2R5RmlsdGVyTWFzazogYm9keS5jb2xsaXNpb25GaWx0ZXJNYXNrLAogICAgICAgICAgICB0YXJnZXRGaWx0ZXJHcm91cDogdGFyZ2V0LmNvbGxpc2lvbkZpbHRlckdyb3VwLAogICAgICAgICAgICB0YXJnZXRGaWx0ZXJNYXNrOiB0YXJnZXQuY29sbGlzaW9uRmlsdGVyTWFzawogICAgICAgICAgfSwKICAgICAgICAgIGNvbnRhY3Q6IHsKICAgICAgICAgICAgLy8gQHRzLWV4cGVjdC1lcnJvciBUT0RPOiB1c2UgaWQgaW5zdGVhZCBvZiB1dWlkCiAgICAgICAgICAgIGJpOiBiaS51dWlkLAogICAgICAgICAgICAvLyBAdHMtZXhwZWN0LWVycm9yIFRPRE86IHVzZSBpZCBpbnN0ZWFkIG9mIHV1aWQKICAgICAgICAgICAgYmo6IGJqLnV1aWQsCiAgICAgICAgICAgIC8vIE5vcm1hbCBvZiB0aGUgY29udGFjdCwgcmVsYXRpdmUgdG8gdGhlIGNvbGxpZGluZyBib2R5CiAgICAgICAgICAgIGNvbnRhY3ROb3JtYWw6IGNvbnRhY3ROb3JtYWwudG9BcnJheSgpLAogICAgICAgICAgICAvLyBXb3JsZCBwb3NpdGlvbiBvZiB0aGUgY29udGFjdAogICAgICAgICAgICBjb250YWN0UG9pbnQ6IGNvbnRhY3RQb2ludC50b0FycmF5KCksCiAgICAgICAgICAgIGlkLAogICAgICAgICAgICBpbXBhY3RWZWxvY2l0eTogY29udGFjdC5nZXRJbXBhY3RWZWxvY2l0eUFsb25nTm9ybWFsKCksCiAgICAgICAgICAgIG5pOiBuaS50b0FycmF5KCksCiAgICAgICAgICAgIHJpOiByaS50b0FycmF5KCksCiAgICAgICAgICAgIHJqOiByai50b0FycmF5KCkKICAgICAgICAgIH0sCiAgICAgICAgICBvcDogJ2V2ZW50JywKICAgICAgICAgIHRhcmdldDogdGFyZ2V0LnV1aWQsCiAgICAgICAgICB0eXBlCiAgICAgICAgfSk7CiAgICAgIH0pOwogICAgfQogIH07CgogIGNvbnN0IHRyaXBsZXRUb1ZlYzMgPSB0ID0+IHQgPyBuZXcgVmVjMyguLi50KSA6IHVuZGVmaW5lZDsKCiAgY29uc3QgYWRkQ29uc3RyYWludCA9IChzdGF0ZSwgX3JlZikgPT4gewogICAgbGV0IHsKICAgICAgcHJvcHM6IFtib2R5QSwgYm9keUIsIHsKICAgICAgICBhbmdsZSwKICAgICAgICBheGlzQSwKICAgICAgICBheGlzQiwKICAgICAgICBjb2xsaWRlQ29ubmVjdGVkLAogICAgICAgIGRpc3RhbmNlLAogICAgICAgIG1heEZvcmNlLAogICAgICAgIG1heE11bHRpcGxpZXIsCiAgICAgICAgcGl2b3RBLAogICAgICAgIHBpdm90QiwKICAgICAgICB0d2lzdEFuZ2xlLAogICAgICAgIHdha2VVcEJvZGllcwogICAgICB9XSwKICAgICAgdHlwZSwKICAgICAgdXVpZAogICAgfSA9IF9yZWY7CiAgICBsZXQgY29uc3RyYWludDsKICAgIHN3aXRjaCAodHlwZSkgewogICAgICBjYXNlICdQb2ludFRvUG9pbnQnOgogICAgICAgIGNvbnN0cmFpbnQgPSBuZXcgUG9pbnRUb1BvaW50Q29uc3RyYWludChzdGF0ZS5ib2RpZXNbYm9keUFdLCB0cmlwbGV0VG9WZWMzKHBpdm90QSksIHN0YXRlLmJvZGllc1tib2R5Ql0sIHRyaXBsZXRUb1ZlYzMocGl2b3RCKSwgbWF4Rm9yY2UpOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlICdDb25lVHdpc3QnOgogICAgICAgIGNvbnN0cmFpbnQgPSBuZXcgQ29uZVR3aXN0Q29uc3RyYWludChzdGF0ZS5ib2RpZXNbYm9keUFdLCBzdGF0ZS5ib2RpZXNbYm9keUJdLCB7CiAgICAgICAgICBhbmdsZSwKICAgICAgICAgIGF4aXNBOiB0cmlwbGV0VG9WZWMzKGF4aXNBKSwKICAgICAgICAgIGF4aXNCOiB0cmlwbGV0VG9WZWMzKGF4aXNCKSwKICAgICAgICAgIGNvbGxpZGVDb25uZWN0ZWQsCiAgICAgICAgICBtYXhGb3JjZSwKICAgICAgICAgIHBpdm90QTogdHJpcGxldFRvVmVjMyhwaXZvdEEpLAogICAgICAgICAgcGl2b3RCOiB0cmlwbGV0VG9WZWMzKHBpdm90QiksCiAgICAgICAgICB0d2lzdEFuZ2xlCiAgICAgICAgfSk7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgJ0hpbmdlJzoKICAgICAgICBjb25zdHJhaW50ID0gbmV3IEhpbmdlQ29uc3RyYWludChzdGF0ZS5ib2RpZXNbYm9keUFdLCBzdGF0ZS5ib2RpZXNbYm9keUJdLCB7CiAgICAgICAgICBheGlzQTogdHJpcGxldFRvVmVjMyhheGlzQSksCiAgICAgICAgICBheGlzQjogdHJpcGxldFRvVmVjMyhheGlzQiksCiAgICAgICAgICBjb2xsaWRlQ29ubmVjdGVkLAogICAgICAgICAgbWF4Rm9yY2UsCiAgICAgICAgICBwaXZvdEE6IHRyaXBsZXRUb1ZlYzMocGl2b3RBKSwKICAgICAgICAgIHBpdm90QjogdHJpcGxldFRvVmVjMyhwaXZvdEIpCiAgICAgICAgfSk7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgJ0Rpc3RhbmNlJzoKICAgICAgICBjb25zdHJhaW50ID0gbmV3IERpc3RhbmNlQ29uc3RyYWludChzdGF0ZS5ib2RpZXNbYm9keUFdLCBzdGF0ZS5ib2RpZXNbYm9keUJdLCBkaXN0YW5jZSwgbWF4Rm9yY2UpOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlICdMb2NrJzoKICAgICAgICBjb25zdHJhaW50ID0gbmV3IExvY2tDb25zdHJhaW50KHN0YXRlLmJvZGllc1tib2R5QV0sIHN0YXRlLmJvZGllc1tib2R5Ql0sIHsKICAgICAgICAgIG1heEZvcmNlCiAgICAgICAgfSk7CiAgICAgICAgYnJlYWs7CiAgICAgIGRlZmF1bHQ6CiAgICAgICAgY29uc3RyYWludCA9IG5ldyBDb25zdHJhaW50KHN0YXRlLmJvZGllc1tib2R5QV0sIHN0YXRlLmJvZGllc1tib2R5Ql0sIHsKICAgICAgICAgIGNvbGxpZGVDb25uZWN0ZWQsCiAgICAgICAgICB3YWtlVXBCb2RpZXMKICAgICAgICB9KTsKICAgICAgICBicmVhazsKICAgIH0KICAgIGNvbnN0cmFpbnQudXVpZCA9IHV1aWQ7CiAgICBzdGF0ZS53b3JsZC5hZGRDb25zdHJhaW50KGNvbnN0cmFpbnQpOwogICAgaWYgKG1heE11bHRpcGxpZXIgIT09IHVuZGVmaW5lZCkgewogICAgICBjb25zdCBwb3N0U3RlcENvbnN0cmFpbnQgPSAoKSA9PiB7CiAgICAgICAgLy8gVGhlIG11bHRpcGxpZXIgaXMgcHJvcG9ydGlvbmFsIHRvIGhvdyBtdWNoIGZvcmNlIGlzIGFkZGVkIHRvIHRoZSBib2RpZXMgYnkgdGhlIGNvbnN0cmFpbnQuCiAgICAgICAgLy8gSWYgdGhpcyBleGNlZWRzIGEgbGltaXQgdGhlIGNvbnN0cmFpbnQgaXMgZGlzYWJsZWQuCiAgICAgICAgY29uc3QgbXVsdGlwbGllciA9IE1hdGguYWJzKGNvbnN0cmFpbnQuZXF1YXRpb25zWzBdLm11bHRpcGxpZXIpOwogICAgICAgIGlmIChtdWx0aXBsaWVyID4gbWF4TXVsdGlwbGllcikgewogICAgICAgICAgY29uc3RyYWludC5kaXNhYmxlKCk7CiAgICAgICAgfQogICAgICB9OwogICAgICBzdGF0ZS5jb25zdHJhaW50c1t1dWlkXSA9IHBvc3RTdGVwQ29uc3RyYWludDsKICAgICAgc3RhdGUud29ybGQuYWRkRXZlbnRMaXN0ZW5lcigncG9zdFN0ZXAnLCBzdGF0ZS5jb25zdHJhaW50c1t1dWlkXSk7CiAgICB9CiAgfTsKCiAgZnVuY3Rpb24gdG9VcHBlcmNhc2Uoc3RyKSB7CiAgICByZXR1cm4gc3RyLnRvVXBwZXJDYXNlKCk7CiAgfQogIGNvbnN0IGFkZFJheSA9IChzdGF0ZSwgX3JlZikgPT4gewogICAgbGV0IHsKICAgICAgcHJvcHM6IHsKICAgICAgICBmcm9tLAogICAgICAgIG1vZGUsCiAgICAgICAgdG8sCiAgICAgICAgLi4ucmF5T3B0aW9ucwogICAgICB9LAogICAgICB1dWlkCiAgICB9ID0gX3JlZjsKICAgIGNvbnN0IHJheSA9IG5ldyBSYXkodHJpcGxldFRvVmVjMyhmcm9tKSwgdHJpcGxldFRvVmVjMyh0bykpOwogICAgY29uc3Qgb3B0aW9ucyA9IHsKICAgICAgbW9kZTogUkFZX01PREVTW3RvVXBwZXJjYXNlKG1vZGUpXSwKICAgICAgcmVzdWx0OiBuZXcgUmF5Y2FzdFJlc3VsdCgpLAogICAgICAuLi5yYXlPcHRpb25zCiAgICB9OwogICAgc3RhdGUucmF5c1t1dWlkXSA9ICgpID0+IHsKICAgICAgcmF5LmludGVyc2VjdFdvcmxkKHN0YXRlLndvcmxkLCBvcHRpb25zKTsKICAgICAgaWYgKCFvcHRpb25zLnJlc3VsdCB8fCAhb3B0aW9ucy5yZXN1bHQuYm9keSkgcmV0dXJuOwogICAgICBjb25zdCB7CiAgICAgICAgYm9keSwKICAgICAgICBzaGFwZSwKICAgICAgICByYXlGcm9tV29ybGQsCiAgICAgICAgcmF5VG9Xb3JsZCwKICAgICAgICBoaXROb3JtYWxXb3JsZCwKICAgICAgICBoaXRQb2ludFdvcmxkLAogICAgICAgIC4uLnJlc3QKICAgICAgfSA9IG9wdGlvbnMucmVzdWx0OwogICAgICBjb25zdCBib2R5VVVJRCA9IGJvZHkudXVpZDsKICAgICAgaWYgKCFib2R5VVVJRCkgcmV0dXJuOwogICAgICBzZWxmLnBvc3RNZXNzYWdlKHsKICAgICAgICBib2R5OiBib2R5VVVJRCwKICAgICAgICBoaXROb3JtYWxXb3JsZDogaGl0Tm9ybWFsV29ybGQudG9BcnJheSgpLAogICAgICAgIGhpdFBvaW50V29ybGQ6IGhpdFBvaW50V29ybGQudG9BcnJheSgpLAogICAgICAgIG9wOiAnZXZlbnQnLAogICAgICAgIHJheTogewogICAgICAgICAgY29sbGlzaW9uRmlsdGVyR3JvdXA6IHJheS5jb2xsaXNpb25GaWx0ZXJHcm91cCwKICAgICAgICAgIGNvbGxpc2lvbkZpbHRlck1hc2s6IHJheS5jb2xsaXNpb25GaWx0ZXJNYXNrLAogICAgICAgICAgZGlyZWN0aW9uOiByYXkuZGlyZWN0aW9uLnRvQXJyYXkoKSwKICAgICAgICAgIGZyb20sCiAgICAgICAgICB0bywKICAgICAgICAgIHV1aWQKICAgICAgICB9LAogICAgICAgIHJheUZyb21Xb3JsZDogcmF5RnJvbVdvcmxkLnRvQXJyYXkoKSwKICAgICAgICByYXlUb1dvcmxkOiByYXlUb1dvcmxkLnRvQXJyYXkoKSwKICAgICAgICBzaGFwZTogc2hhcGUgPyB7CiAgICAgICAgICAuLi5zaGFwZSwKICAgICAgICAgIGJvZHk6IGJvZHlVVUlECiAgICAgICAgfSA6IG51bGwsCiAgICAgICAgdHlwZTogJ3JheWhpdCcsCiAgICAgICAgLi4ucmVzdAogICAgICB9KTsKICAgIH07CiAgICBzdGF0ZS53b3JsZC5hZGRFdmVudExpc3RlbmVyKCdwcmVTdGVwJywgc3RhdGUucmF5c1t1dWlkXSk7CiAgfTsKCiAgY29uc3QgYWRkUmF5Y2FzdFZlaGljbGUgPSAoc3RhdGUsIGRhdGEpID0+IHsKICAgIGNvbnN0IFtjaGFzc2lzQm9keSwgd2hlZWxzLCB3aGVlbEluZm9zLCBpbmRleEZvcndhcmRBeGlzLCBpbmRleFJpZ2h0QXhpcywgaW5kZXhVcEF4aXNdID0gZGF0YS5wcm9wczsKICAgIGNvbnN0IHZlaGljbGUgPSBuZXcgUmF5Y2FzdFZlaGljbGUoewogICAgICBjaGFzc2lzQm9keTogc3RhdGUuYm9kaWVzW2NoYXNzaXNCb2R5XSwKICAgICAgaW5kZXhGb3J3YXJkQXhpcywKICAgICAgaW5kZXhSaWdodEF4aXMsCiAgICAgIGluZGV4VXBBeGlzCiAgICB9KTsKICAgIHZlaGljbGUud29ybGQgPSBzdGF0ZS53b3JsZDsKICAgIGZvciAobGV0IGkgPSAwOyBpIDwgd2hlZWxJbmZvcy5sZW5ndGg7IGkrKykgewogICAgICBjb25zdCB7CiAgICAgICAgYXhsZUxvY2FsLAogICAgICAgIGNoYXNzaXNDb25uZWN0aW9uUG9pbnRMb2NhbCwKICAgICAgICBkaXJlY3Rpb25Mb2NhbCwKICAgICAgICAuLi5yZXN0CiAgICAgIH0gPSB3aGVlbEluZm9zW2ldOwogICAgICB2ZWhpY2xlLmFkZFdoZWVsKHsKICAgICAgICBheGxlTG9jYWw6IHRyaXBsZXRUb1ZlYzMoYXhsZUxvY2FsKSwKICAgICAgICBjaGFzc2lzQ29ubmVjdGlvblBvaW50TG9jYWw6IHRyaXBsZXRUb1ZlYzMoY2hhc3Npc0Nvbm5lY3Rpb25Qb2ludExvY2FsKSwKICAgICAgICBkaXJlY3Rpb25Mb2NhbDogdHJpcGxldFRvVmVjMyhkaXJlY3Rpb25Mb2NhbCksCiAgICAgICAgLi4ucmVzdAogICAgICB9KTsKICAgIH0KICAgIGNvbnN0IHByZVN0ZXAgPSAoKSA9PiB7CiAgICAgIHZlaGljbGUudXBkYXRlVmVoaWNsZShzdGF0ZS53b3JsZC5kdCk7CiAgICB9OwogICAgY29uc3QgcG9zdFN0ZXAgPSAoKSA9PiB7CiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdmVoaWNsZS53aGVlbEluZm9zLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgdmVoaWNsZS51cGRhdGVXaGVlbFRyYW5zZm9ybShpKTsKICAgICAgICBjb25zdCB0ID0gdmVoaWNsZS53aGVlbEluZm9zW2ldLndvcmxkVHJhbnNmb3JtOwogICAgICAgIGNvbnN0IHdoZWVsQm9keSA9IHN0YXRlLmJvZGllc1t3aGVlbHNbaV1dOwogICAgICAgIHdoZWVsQm9keS5wb3NpdGlvbi5jb3B5KHQucG9zaXRpb24pOwogICAgICAgIHdoZWVsQm9keS5xdWF0ZXJuaW9uLmNvcHkodC5xdWF0ZXJuaW9uKTsKICAgICAgfQogICAgfTsKICAgIHN0YXRlLnZlaGljbGVzW2RhdGEudXVpZF0gPSB7CiAgICAgIHBvc3RTdGVwLAogICAgICBwcmVTdGVwLAogICAgICB2ZWhpY2xlCiAgICB9OwogICAgc3RhdGUud29ybGQuYWRkRXZlbnRMaXN0ZW5lcigncHJlU3RlcCcsIHByZVN0ZXApOwogICAgc3RhdGUud29ybGQuYWRkRXZlbnRMaXN0ZW5lcigncG9zdFN0ZXAnLCBwb3N0U3RlcCk7CiAgfTsKCiAgY29uc3QgYWRkU3ByaW5nID0gKHN0YXRlLCBfcmVmKSA9PiB7CiAgICBsZXQgewogICAgICBwcm9wczogW2JvZHlBLCBib2R5QiwgewogICAgICAgIGRhbXBpbmcsCiAgICAgICAgbG9jYWxBbmNob3JBLAogICAgICAgIGxvY2FsQW5jaG9yQiwKICAgICAgICByZXN0TGVuZ3RoLAogICAgICAgIHN0aWZmbmVzcywKICAgICAgICB3b3JsZEFuY2hvckEsCiAgICAgICAgd29ybGRBbmNob3JCCiAgICAgIH1dLAogICAgICB1dWlkCiAgICB9ID0gX3JlZjsKICAgIGNvbnN0IHNwcmluZyA9IG5ldyBTcHJpbmcoc3RhdGUuYm9kaWVzW2JvZHlBXSwgc3RhdGUuYm9kaWVzW2JvZHlCXSwgewogICAgICBkYW1waW5nLAogICAgICBsb2NhbEFuY2hvckE6IHRyaXBsZXRUb1ZlYzMobG9jYWxBbmNob3JBKSwKICAgICAgbG9jYWxBbmNob3JCOiB0cmlwbGV0VG9WZWMzKGxvY2FsQW5jaG9yQiksCiAgICAgIHJlc3RMZW5ndGgsCiAgICAgIHN0aWZmbmVzcywKICAgICAgd29ybGRBbmNob3JBOiB0cmlwbGV0VG9WZWMzKHdvcmxkQW5jaG9yQSksCiAgICAgIHdvcmxkQW5jaG9yQjogdHJpcGxldFRvVmVjMyh3b3JsZEFuY2hvckIpCiAgICB9KTsKICAgIHNwcmluZy51dWlkID0gdXVpZDsKICAgIGNvbnN0IHBvc3RTdGVwU3ByaW5nID0gKCkgPT4gc3ByaW5nLmFwcGx5Rm9yY2UoKTsKICAgIHN0YXRlLnNwcmluZ3NbdXVpZF0gPSBwb3N0U3RlcFNwcmluZzsKICAgIHN0YXRlLnNwcmluZ0luc3RhbmNlc1t1dWlkXSA9IHNwcmluZzsKCiAgICAvLyBDb21wdXRlIHRoZSBmb3JjZSBhZnRlciBlYWNoIHN0ZXAKICAgIHN0YXRlLndvcmxkLmFkZEV2ZW50TGlzdGVuZXIoJ3Bvc3RTdGVwJywgc3RhdGUuc3ByaW5nc1t1dWlkXSk7CiAgfTsKCiAgZnVuY3Rpb24gZW1pdEJlZ2luQ29udGFjdChfcmVmKSB7CiAgICBsZXQgewogICAgICBib2R5QSwKICAgICAgYm9keUIKICAgIH0gPSBfcmVmOwogICAgaWYgKCEoYm9keUEgIT0gbnVsbCAmJiBib2R5QS51dWlkKSB8fCAhKGJvZHlCICE9IG51bGwgJiYgYm9keUIudXVpZCkpIHJldHVybjsKICAgIHNlbGYucG9zdE1lc3NhZ2UoewogICAgICBib2R5QTogYm9keUEudXVpZCwKICAgICAgYm9keUI6IGJvZHlCLnV1aWQsCiAgICAgIG9wOiAnZXZlbnQnLAogICAgICB0eXBlOiAnY29sbGlkZUJlZ2luJwogICAgfSk7CiAgfQogIGZ1bmN0aW9uIGVtaXRFbmRDb250YWN0KF9yZWYyKSB7CiAgICBsZXQgewogICAgICBib2R5QSwKICAgICAgYm9keUIKICAgIH0gPSBfcmVmMjsKICAgIGlmICghKGJvZHlBICE9IG51bGwgJiYgYm9keUEudXVpZCkgfHwgIShib2R5QiAhPSBudWxsICYmIGJvZHlCLnV1aWQpKSByZXR1cm47CiAgICBzZWxmLnBvc3RNZXNzYWdlKHsKICAgICAgYm9keUE6IGJvZHlBLnV1aWQsCiAgICAgIGJvZHlCOiBib2R5Qi51dWlkLAogICAgICBvcDogJ2V2ZW50JywKICAgICAgdHlwZTogJ2NvbGxpZGVFbmQnCiAgICB9KTsKICB9CiAgY29uc3QgaW5pdCA9ICh3b3JsZCwgX3JlZjMpID0+IHsKICAgIGxldCB7CiAgICAgIGFsbG93U2xlZXAsCiAgICAgIGF4aXNJbmRleCA9IDAsCiAgICAgIGJyb2FkcGhhc2UsCiAgICAgIGRlZmF1bHRDb250YWN0TWF0ZXJpYWwsCiAgICAgIGZyaWN0aW9uR3Jhdml0eSwKICAgICAgZ3Jhdml0eSwKICAgICAgaXRlcmF0aW9ucywKICAgICAgcXVhdE5vcm1hbGl6ZUZhc3QsCiAgICAgIHF1YXROb3JtYWxpemVTa2lwLAogICAgICBzb2x2ZXIsCiAgICAgIHRvbGVyYW5jZQogICAgfSA9IF9yZWYzOwogICAgd29ybGQuYWxsb3dTbGVlcCA9IGFsbG93U2xlZXA7CiAgICB3b3JsZC5ncmF2aXR5LnNldCguLi5ncmF2aXR5KTsKICAgIHdvcmxkLmZyaWN0aW9uR3Jhdml0eSA9IGZyaWN0aW9uR3Jhdml0eSA/IG5ldyBWZWMzKC4uLmZyaWN0aW9uR3Jhdml0eSkgOiB1bmRlZmluZWQ7CiAgICB3b3JsZC5xdWF0Tm9ybWFsaXplRmFzdCA9IHF1YXROb3JtYWxpemVGYXN0OwogICAgd29ybGQucXVhdE5vcm1hbGl6ZVNraXAgPSBxdWF0Tm9ybWFsaXplU2tpcDsKICAgIGlmIChzb2x2ZXIgPT09ICdTcGxpdCcpIHsKICAgICAgd29ybGQuc29sdmVyID0gbmV3IFNwbGl0U29sdmVyKG5ldyBHU1NvbHZlcigpKTsKICAgIH0KICAgIGlmICh3b3JsZC5zb2x2ZXIgaW5zdGFuY2VvZiBHU1NvbHZlcikgewogICAgICB3b3JsZC5zb2x2ZXIudG9sZXJhbmNlID0gdG9sZXJhbmNlOwogICAgICB3b3JsZC5zb2x2ZXIuaXRlcmF0aW9ucyA9IGl0ZXJhdGlvbnM7CiAgICB9CiAgICB3b3JsZC5icm9hZHBoYXNlID0gYnJvYWRwaGFzZSA9PT0gJ1NBUCcgPyBuZXcgU0FQQnJvYWRwaGFzZSh3b3JsZCkgOiBuZXcgTmFpdmVCcm9hZHBoYXNlKCk7CiAgICBpZiAod29ybGQuYnJvYWRwaGFzZSBpbnN0YW5jZW9mIFNBUEJyb2FkcGhhc2UpIHsKICAgICAgd29ybGQuYnJvYWRwaGFzZS5heGlzSW5kZXggPSBheGlzSW5kZXg7CiAgICB9CiAgICB3b3JsZC5hZGRFdmVudExpc3RlbmVyKCdiZWdpbkNvbnRhY3QnLCBlbWl0QmVnaW5Db250YWN0KTsKICAgIHdvcmxkLmFkZEV2ZW50TGlzdGVuZXIoJ2VuZENvbnRhY3QnLCBlbWl0RW5kQ29udGFjdCk7CiAgICBPYmplY3QuYXNzaWduKHdvcmxkLmRlZmF1bHRDb250YWN0TWF0ZXJpYWwsIGRlZmF1bHRDb250YWN0TWF0ZXJpYWwpOwogIH07CgogIGNvbnN0IGlzUW9yViA9IHYgPT4gdiBpbnN0YW5jZW9mIFF1YXRlcm5pb24gfHwgdiBpbnN0YW5jZW9mIFZlYzM7CiAgY29uc3Qgc3RlcCA9IChzdGF0ZSwgX3JlZikgPT4gewogICAgbGV0IHsKICAgICAgcG9zaXRpb25zLAogICAgICBwcm9wczogewogICAgICAgIG1heFN1YlN0ZXBzLAogICAgICAgIHN0ZXBTaXplLAogICAgICAgIHRpbWVTaW5jZUxhc3RDYWxsZWQKICAgICAgfSwKICAgICAgcXVhdGVybmlvbnMKICAgIH0gPSBfcmVmOwogICAgc3RhdGUud29ybGQuc3RlcChzdGVwU2l6ZSwgdGltZVNpbmNlTGFzdENhbGxlZCwgbWF4U3ViU3RlcHMpOwogICAgZm9yIChsZXQgaSA9IDA7IGkgPCBzdGF0ZS53b3JsZC5ib2RpZXMubGVuZ3RoOyBpICs9IDEpIHsKICAgICAgY29uc3QgcCA9IHN0YXRlLndvcmxkLmJvZGllc1tpXS5wb3NpdGlvbjsKICAgICAgY29uc3QgcSA9IHN0YXRlLndvcmxkLmJvZGllc1tpXS5xdWF0ZXJuaW9uOwogICAgICBwb3NpdGlvbnNbMyAqIGkgKyAwXSA9IHAueDsKICAgICAgcG9zaXRpb25zWzMgKiBpICsgMV0gPSBwLnk7CiAgICAgIHBvc2l0aW9uc1szICogaSArIDJdID0gcC56OwogICAgICBxdWF0ZXJuaW9uc1s0ICogaSArIDBdID0gcS54OwogICAgICBxdWF0ZXJuaW9uc1s0ICogaSArIDFdID0gcS55OwogICAgICBxdWF0ZXJuaW9uc1s0ICogaSArIDJdID0gcS56OwogICAgICBxdWF0ZXJuaW9uc1s0ICogaSArIDNdID0gcS53OwogICAgfQogICAgY29uc3Qgb2JzZXJ2YXRpb25zID0gW107CiAgICBmb3IgKGNvbnN0IGlkIG9mIE9iamVjdC5rZXlzKHN0YXRlLnN1YnNjcmlwdGlvbnMpKSB7CiAgICAgIGNvbnN0IFt1dWlkLCB0eXBlLCB0YXJnZXQgPSAnYm9kaWVzJ10gPSBzdGF0ZS5zdWJzY3JpcHRpb25zW2lkXTsKICAgICAgY29uc3QgewogICAgICAgIGJvZGllcywKICAgICAgICB2ZWhpY2xlcwogICAgICB9ID0gc3RhdGU7CiAgICAgIGNvbnN0IHZhbHVlID0gdGFyZ2V0ID09PSAndmVoaWNsZXMnID8KICAgICAgLy8gQHRzLWV4cGVjdC1lcnJvciBUT0RPOiBEaWZmZXJlbnRpYXRlIHRoZXNlICJ0eXBlcyIKICAgICAgdmVoaWNsZXNbdXVpZF0udmVoaWNsZVt0eXBlXSA6CiAgICAgIC8vIEB0cy1leHBlY3QtZXJyb3IgVE9ETzogRGlmZmVyZW50aWF0ZSB0aGVzZSAidHlwZXMiCiAgICAgIGJvZGllc1t1dWlkXVt0eXBlXTsKICAgICAgY29uc3Qgc2VyaWFsaXphYmxlVmFsdWUgPSBpc1FvclYodmFsdWUpID8gdmFsdWUudG9BcnJheSgpIDogdmFsdWU7CiAgICAgIG9ic2VydmF0aW9ucy5wdXNoKFtOdW1iZXIoaWQpLCBzZXJpYWxpemFibGVWYWx1ZSwKICAgICAgLy8gQHRzLWV4cGVjdC1lcnJvciBUT0RPOiBEaWZmZXJlbnRpYXRlIHRoZXNlICJ0eXBlcyIKICAgICAgdHlwZV0pOwogICAgfQogICAgY29uc3QgbWVzc2FnZSA9IHsKICAgICAgYWN0aXZlOiBzdGF0ZS53b3JsZC5oYXNBY3RpdmVCb2RpZXMsCiAgICAgIG9ic2VydmF0aW9ucywKICAgICAgb3A6ICdmcmFtZScsCiAgICAgIHBvc2l0aW9ucywKICAgICAgcXVhdGVybmlvbnMKICAgIH07CiAgICBpZiAoc3RhdGUuYm9kaWVzTmVlZFN5bmNpbmcpIHsKICAgICAgbWVzc2FnZS5ib2RpZXMgPSBzdGF0ZS53b3JsZC5ib2RpZXMucmVkdWNlKChib2RpZXMsIGJvZHkpID0+IHsKICAgICAgICBpZiAoYm9keS51dWlkKSBib2RpZXMucHVzaChib2R5LnV1aWQpOwogICAgICAgIHJldHVybiBib2RpZXM7CiAgICAgIH0sIFtdKTsKICAgICAgc3RhdGUuYm9kaWVzTmVlZFN5bmNpbmcgPSBmYWxzZTsKICAgIH0KICAgIHNlbGYucG9zdE1lc3NhZ2UobWVzc2FnZSwgW3Bvc2l0aW9ucy5idWZmZXIsIHF1YXRlcm5pb25zLmJ1ZmZlcl0pOwogIH07CgogIGNvbnN0IHN0YXRlID0gewogICAgYm9kaWVzOiB7fSwKICAgIGJvZGllc05lZWRTeW5jaW5nOiBmYWxzZSwKICAgIGNvbnN0cmFpbnRzOiB7fSwKICAgIG1hdGVyaWFsczoge30sCiAgICByYXlzOiB7fSwKICAgIHNwcmluZ0luc3RhbmNlczoge30sCiAgICBzcHJpbmdzOiB7fSwKICAgIHN1YnNjcmlwdGlvbnM6IHt9LAogICAgdmVoaWNsZXM6IHt9LAogICAgd29ybGQ6IG5ldyBXb3JsZCgpCiAgfTsKCiAgLy8vIDxyZWZlcmVuY2Ugbm8tZGVmYXVsdC1saWI9InRydWUiLz4KICBjb25zdCBpc0hpbmdlQ29uc3RyYWludCA9IGMgPT4gYyBpbnN0YW5jZW9mIEhpbmdlQ29uc3RyYWludDsKICBmdW5jdGlvbiBzeW5jQm9kaWVzKCkgewogICAgc3RhdGUuYm9kaWVzTmVlZFN5bmNpbmcgPSB0cnVlOwogICAgc3RhdGUuYm9kaWVzID0gc3RhdGUud29ybGQuYm9kaWVzLnJlZHVjZSgoYm9kaWVzLCBib2R5KSA9PiBib2R5LnV1aWQgPyB7CiAgICAgIC4uLmJvZGllcywKICAgICAgW2JvZHkudXVpZF06IGJvZHkKICAgIH0gOiBib2RpZXMsIHt9KTsKICB9CiAgY29uc3QgYnJvYWRwaGFzZXMgPSB7CiAgICBOYWl2ZUJyb2FkcGhhc2UsCiAgICBTQVBCcm9hZHBoYXNlCiAgfTsKICBjb25zdCBjcmVhdGVNYXRlcmlhbCA9IGNyZWF0ZU1hdGVyaWFsRmFjdG9yeShzdGF0ZS5tYXRlcmlhbHMpOwogIHNlbGYub25tZXNzYWdlID0gX3JlZiA9PiB7CiAgICBsZXQgewogICAgICBkYXRhCiAgICB9ID0gX3JlZjsKICAgIHN3aXRjaCAoZGF0YS5vcCkgewogICAgICBjYXNlICdpbml0JzoKICAgICAgICB7CiAgICAgICAgICBpbml0KHN0YXRlLndvcmxkLCBkYXRhLnByb3BzKTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgY2FzZSAnc3RlcCc6CiAgICAgICAgewogICAgICAgICAgc3RlcChzdGF0ZSwgZGF0YSk7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgIGNhc2UgJ2FkZEJvZGllcyc6CiAgICAgICAgewogICAgICAgICAgYWRkQm9kaWVzKHN0YXRlLCBjcmVhdGVNYXRlcmlhbCwgZGF0YSk7CiAgICAgICAgICBzeW5jQm9kaWVzKCk7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgIGNhc2UgJ3JlbW92ZUJvZGllcyc6CiAgICAgICAgewogICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBkYXRhLnV1aWQubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgc3RhdGUud29ybGQucmVtb3ZlQm9keShzdGF0ZS5ib2RpZXNbZGF0YS51dWlkW2ldXSk7CiAgICAgICAgICAgIGNvbnN0IGtleSA9IE9iamVjdC5rZXlzKHN0YXRlLnN1YnNjcmlwdGlvbnMpLmZpbmQoayA9PiBzdGF0ZS5zdWJzY3JpcHRpb25zW2tdWzBdID09PSBkYXRhLnV1aWRbaV0pOwogICAgICAgICAgICBpZiAoa2V5KSB7CiAgICAgICAgICAgICAgZGVsZXRlIHN0YXRlLnN1YnNjcmlwdGlvbnNba2V5XTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgc3luY0JvZGllcygpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICBjYXNlICdzdWJzY3JpYmUnOgogICAgICAgIHsKICAgICAgICAgIGNvbnN0IHsKICAgICAgICAgICAgaWQsCiAgICAgICAgICAgIHRhcmdldCwKICAgICAgICAgICAgdHlwZQogICAgICAgICAgfSA9IGRhdGEucHJvcHM7CiAgICAgICAgICBzdGF0ZS5zdWJzY3JpcHRpb25zW2lkXSA9IFtkYXRhLnV1aWQsIHR5cGUsIHRhcmdldF07CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgIGNhc2UgJ3Vuc3Vic2NyaWJlJzoKICAgICAgICB7CiAgICAgICAgICBkZWxldGUgc3RhdGUuc3Vic2NyaXB0aW9uc1tkYXRhLnByb3BzXTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgY2FzZSAnc2V0UG9zaXRpb24nOgogICAgICAgIHN0YXRlLmJvZGllc1tkYXRhLnV1aWRdLnBvc2l0aW9uLnNldChkYXRhLnByb3BzWzBdLCBkYXRhLnByb3BzWzFdLCBkYXRhLnByb3BzWzJdKTsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAnc2V0UXVhdGVybmlvbic6CiAgICAgICAgc3RhdGUuYm9kaWVzW2RhdGEudXVpZF0ucXVhdGVybmlvbi5zZXQoZGF0YS5wcm9wc1swXSwgZGF0YS5wcm9wc1sxXSwgZGF0YS5wcm9wc1syXSwgZGF0YS5wcm9wc1szXSk7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgJ3NldFJvdGF0aW9uJzoKICAgICAgICBzdGF0ZS5ib2RpZXNbZGF0YS51dWlkXS5xdWF0ZXJuaW9uLnNldEZyb21FdWxlcihkYXRhLnByb3BzWzBdLCBkYXRhLnByb3BzWzFdLCBkYXRhLnByb3BzWzJdKTsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAnc2V0VmVsb2NpdHknOgogICAgICAgIHN0YXRlLmJvZGllc1tkYXRhLnV1aWRdLnZlbG9jaXR5LnNldChkYXRhLnByb3BzWzBdLCBkYXRhLnByb3BzWzFdLCBkYXRhLnByb3BzWzJdKTsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAnc2V0QW5ndWxhclZlbG9jaXR5JzoKICAgICAgICBzdGF0ZS5ib2RpZXNbZGF0YS51dWlkXS5hbmd1bGFyVmVsb2NpdHkuc2V0KGRhdGEucHJvcHNbMF0sIGRhdGEucHJvcHNbMV0sIGRhdGEucHJvcHNbMl0pOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlICdzZXRMaW5lYXJGYWN0b3InOgogICAgICAgIHN0YXRlLmJvZGllc1tkYXRhLnV1aWRdLmxpbmVhckZhY3Rvci5zZXQoZGF0YS5wcm9wc1swXSwgZGF0YS5wcm9wc1sxXSwgZGF0YS5wcm9wc1syXSk7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgJ3NldEFuZ3VsYXJGYWN0b3InOgogICAgICAgIHN0YXRlLmJvZGllc1tkYXRhLnV1aWRdLmFuZ3VsYXJGYWN0b3Iuc2V0KGRhdGEucHJvcHNbMF0sIGRhdGEucHJvcHNbMV0sIGRhdGEucHJvcHNbMl0pOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlICdzZXRNYXNzJzoKICAgICAgICBzdGF0ZS5ib2RpZXNbZGF0YS51dWlkXS5tYXNzID0gZGF0YS5wcm9wczsKICAgICAgICBzdGF0ZS5ib2RpZXNbZGF0YS51dWlkXS51cGRhdGVNYXNzUHJvcGVydGllcygpOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlICdzZXRNYXRlcmlhbCc6CiAgICAgICAgc3RhdGUuYm9kaWVzW2RhdGEudXVpZF0ubWF0ZXJpYWwgPSBkYXRhLnByb3BzID8gY3JlYXRlTWF0ZXJpYWwoZGF0YS5wcm9wcykgOiBudWxsOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlICdzZXRMaW5lYXJEYW1waW5nJzoKICAgICAgICBzdGF0ZS5ib2RpZXNbZGF0YS51dWlkXS5saW5lYXJEYW1waW5nID0gZGF0YS5wcm9wczsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAnc2V0QW5ndWxhckRhbXBpbmcnOgogICAgICAgIHN0YXRlLmJvZGllc1tkYXRhLnV1aWRdLmFuZ3VsYXJEYW1waW5nID0gZGF0YS5wcm9wczsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAnc2V0QWxsb3dTbGVlcCc6CiAgICAgICAgc3RhdGUuYm9kaWVzW2RhdGEudXVpZF0uYWxsb3dTbGVlcCA9IGRhdGEucHJvcHM7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgJ3NldFNsZWVwU3BlZWRMaW1pdCc6CiAgICAgICAgc3RhdGUuYm9kaWVzW2RhdGEudXVpZF0uc2xlZXBTcGVlZExpbWl0ID0gZGF0YS5wcm9wczsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAnc2V0U2xlZXBUaW1lTGltaXQnOgogICAgICAgIHN0YXRlLmJvZGllc1tkYXRhLnV1aWRdLnNsZWVwVGltZUxpbWl0ID0gZGF0YS5wcm9wczsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAnc2V0Q29sbGlzaW9uRmlsdGVyR3JvdXAnOgogICAgICAgIHN0YXRlLmJvZGllc1tkYXRhLnV1aWRdLmNvbGxpc2lvbkZpbHRlckdyb3VwID0gZGF0YS5wcm9wczsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAnc2V0Q29sbGlzaW9uRmlsdGVyTWFzayc6CiAgICAgICAgc3RhdGUuYm9kaWVzW2RhdGEudXVpZF0uY29sbGlzaW9uRmlsdGVyTWFzayA9IGRhdGEucHJvcHM7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgJ3NldENvbGxpc2lvblJlc3BvbnNlJzoKICAgICAgICBzdGF0ZS5ib2RpZXNbZGF0YS51dWlkXS5jb2xsaXNpb25SZXNwb25zZSA9IGRhdGEucHJvcHM7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgJ3NldEZpeGVkUm90YXRpb24nOgogICAgICAgIHN0YXRlLmJvZGllc1tkYXRhLnV1aWRdLmZpeGVkUm90YXRpb24gPSBkYXRhLnByb3BzOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlICdzZXRGcmljdGlvbkdyYXZpdHknOgogICAgICAgIHN0YXRlLndvcmxkLmZyaWN0aW9uR3Jhdml0eSA9IGRhdGEucHJvcHMgPyBuZXcgVmVjMyguLi5kYXRhLnByb3BzKSA6IHVuZGVmaW5lZDsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAnc2V0SXNUcmlnZ2VyJzoKICAgICAgICBzdGF0ZS5ib2RpZXNbZGF0YS51dWlkXS5pc1RyaWdnZXIgPSBkYXRhLnByb3BzOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlICdzZXRHcmF2aXR5JzoKICAgICAgICBzdGF0ZS53b3JsZC5ncmF2aXR5LnNldChkYXRhLnByb3BzWzBdLCBkYXRhLnByb3BzWzFdLCBkYXRhLnByb3BzWzJdKTsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAnc2V0VG9sZXJhbmNlJzoKICAgICAgICBpZiAoc3RhdGUud29ybGQuc29sdmVyIGluc3RhbmNlb2YgR1NTb2x2ZXIpIHsKICAgICAgICAgIHN0YXRlLndvcmxkLnNvbHZlci50b2xlcmFuY2UgPSBkYXRhLnByb3BzOwogICAgICAgIH0KICAgICAgICBicmVhazsKICAgICAgY2FzZSAnc2V0SXRlcmF0aW9ucyc6CiAgICAgICAgaWYgKHN0YXRlLndvcmxkLnNvbHZlciBpbnN0YW5jZW9mIEdTU29sdmVyKSB7CiAgICAgICAgICBzdGF0ZS53b3JsZC5zb2x2ZXIuaXRlcmF0aW9ucyA9IGRhdGEucHJvcHM7CiAgICAgICAgfQogICAgICAgIGJyZWFrOwogICAgICBjYXNlICdzZXRCcm9hZHBoYXNlJzoKICAgICAgICBzdGF0ZS53b3JsZC5icm9hZHBoYXNlID0gbmV3IChicm9hZHBoYXNlc1tgJHtkYXRhLnByb3BzfUJyb2FkcGhhc2VgXSB8fCBOYWl2ZUJyb2FkcGhhc2UpKHN0YXRlLndvcmxkKTsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAnc2V0QXhpc0luZGV4JzoKICAgICAgICBpZiAoc3RhdGUud29ybGQuYnJvYWRwaGFzZSBpbnN0YW5jZW9mIFNBUEJyb2FkcGhhc2UpIHsKICAgICAgICAgIHN0YXRlLndvcmxkLmJyb2FkcGhhc2UuYXhpc0luZGV4ID0gZGF0YS5wcm9wcyA9PT0gdW5kZWZpbmVkIHx8IGRhdGEucHJvcHMgPT09IG51bGwgPyAwIDogZGF0YS5wcm9wczsKICAgICAgICB9CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgJ2FwcGx5Rm9yY2UnOgogICAgICAgIHN0YXRlLmJvZGllc1tkYXRhLnV1aWRdLmFwcGx5Rm9yY2UobmV3IFZlYzMoLi4uZGF0YS5wcm9wc1swXSksIG5ldyBWZWMzKC4uLmRhdGEucHJvcHNbMV0pKTsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAnYXBwbHlJbXB1bHNlJzoKICAgICAgICBzdGF0ZS5ib2RpZXNbZGF0YS51dWlkXS5hcHBseUltcHVsc2UobmV3IFZlYzMoLi4uZGF0YS5wcm9wc1swXSksIG5ldyBWZWMzKC4uLmRhdGEucHJvcHNbMV0pKTsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAnYXBwbHlMb2NhbEZvcmNlJzoKICAgICAgICBzdGF0ZS5ib2RpZXNbZGF0YS51dWlkXS5hcHBseUxvY2FsRm9yY2UobmV3IFZlYzMoLi4uZGF0YS5wcm9wc1swXSksIG5ldyBWZWMzKC4uLmRhdGEucHJvcHNbMV0pKTsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAnYXBwbHlMb2NhbEltcHVsc2UnOgogICAgICAgIHN0YXRlLmJvZGllc1tkYXRhLnV1aWRdLmFwcGx5TG9jYWxJbXB1bHNlKG5ldyBWZWMzKC4uLmRhdGEucHJvcHNbMF0pLCBuZXcgVmVjMyguLi5kYXRhLnByb3BzWzFdKSk7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgJ2FwcGx5VG9ycXVlJzoKICAgICAgICBzdGF0ZS5ib2RpZXNbZGF0YS51dWlkXS5hcHBseVRvcnF1ZShuZXcgVmVjMyguLi5kYXRhLnByb3BzWzBdKSk7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgJ2FkZENvbnN0cmFpbnQnOgogICAgICAgIHsKICAgICAgICAgIGFkZENvbnN0cmFpbnQoc3RhdGUsIGRhdGEpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICBjYXNlICdyZW1vdmVDb25zdHJhaW50JzoKICAgICAgICBzdGF0ZS53b3JsZC5jb25zdHJhaW50cy5maWx0ZXIoX3JlZjIgPT4gewogICAgICAgICAgbGV0IHsKICAgICAgICAgICAgdXVpZAogICAgICAgICAgfSA9IF9yZWYyOwogICAgICAgICAgcmV0dXJuIHV1aWQgPT09IGRhdGEudXVpZDsKICAgICAgICB9KS5tYXAoYyA9PiBzdGF0ZS53b3JsZC5yZW1vdmVDb25zdHJhaW50KGMpKTsKICAgICAgICBpZiAoc3RhdGUuY29uc3RyYWludHNbZGF0YS51dWlkXSkgewogICAgICAgICAgc3RhdGUud29ybGQucmVtb3ZlRXZlbnRMaXN0ZW5lcigncG9zdFN0ZXAnLCBzdGF0ZS5jb25zdHJhaW50c1tkYXRhLnV1aWRdKTsKICAgICAgICAgIGRlbGV0ZSBzdGF0ZS5jb25zdHJhaW50c1tkYXRhLnV1aWRdOwogICAgICAgIH0KICAgICAgICBicmVhazsKICAgICAgY2FzZSAnZW5hYmxlQ29uc3RyYWludCc6CiAgICAgICAgc3RhdGUud29ybGQuY29uc3RyYWludHMuZmlsdGVyKGMgPT4gYy51dWlkID09PSBkYXRhLnV1aWQpLm1hcChjID0+IGMuZW5hYmxlKCkpOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlICdkaXNhYmxlQ29uc3RyYWludCc6CiAgICAgICAgc3RhdGUud29ybGQuY29uc3RyYWludHMuZmlsdGVyKGMgPT4gYy51dWlkID09PSBkYXRhLnV1aWQpLm1hcChjID0+IGMuZGlzYWJsZSgpKTsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAnZW5hYmxlQ29uc3RyYWludE1vdG9yJzoKICAgICAgICBzdGF0ZS53b3JsZC5jb25zdHJhaW50cy5maWx0ZXIoYyA9PiBjLnV1aWQgPT09IGRhdGEudXVpZCkuZmlsdGVyKGlzSGluZ2VDb25zdHJhaW50KS5tYXAoYyA9PiBjLmVuYWJsZU1vdG9yKCkpOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlICdkaXNhYmxlQ29uc3RyYWludE1vdG9yJzoKICAgICAgICBzdGF0ZS53b3JsZC5jb25zdHJhaW50cy5maWx0ZXIoYyA9PiBjLnV1aWQgPT09IGRhdGEudXVpZCkuZmlsdGVyKGlzSGluZ2VDb25zdHJhaW50KS5tYXAoYyA9PiBjLmRpc2FibGVNb3RvcigpKTsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAnc2V0Q29uc3RyYWludE1vdG9yU3BlZWQnOgogICAgICAgIHN0YXRlLndvcmxkLmNvbnN0cmFpbnRzLmZpbHRlcihjID0+IGMudXVpZCA9PT0gZGF0YS51dWlkKS5maWx0ZXIoaXNIaW5nZUNvbnN0cmFpbnQpLm1hcChjID0+IGMuc2V0TW90b3JTcGVlZChkYXRhLnByb3BzKSk7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgJ3NldENvbnN0cmFpbnRNb3Rvck1heEZvcmNlJzoKICAgICAgICBzdGF0ZS53b3JsZC5jb25zdHJhaW50cy5maWx0ZXIoYyA9PiBjLnV1aWQgPT09IGRhdGEudXVpZCkuZmlsdGVyKGlzSGluZ2VDb25zdHJhaW50KS5tYXAoYyA9PiBjLnNldE1vdG9yTWF4Rm9yY2UoZGF0YS5wcm9wcykpOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlICdhZGRTcHJpbmcnOgogICAgICAgIHsKICAgICAgICAgIGFkZFNwcmluZyhzdGF0ZSwgZGF0YSk7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgIGNhc2UgJ3NldFNwcmluZ1N0aWZmbmVzcyc6CiAgICAgICAgewogICAgICAgICAgc3RhdGUuc3ByaW5nSW5zdGFuY2VzW2RhdGEudXVpZF0uc3RpZmZuZXNzID0gZGF0YS5wcm9wczsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgY2FzZSAnc2V0U3ByaW5nUmVzdExlbmd0aCc6CiAgICAgICAgewogICAgICAgICAgc3RhdGUuc3ByaW5nSW5zdGFuY2VzW2RhdGEudXVpZF0ucmVzdExlbmd0aCA9IGRhdGEucHJvcHM7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgIGNhc2UgJ3NldFNwcmluZ0RhbXBpbmcnOgogICAgICAgIHsKICAgICAgICAgIHN0YXRlLnNwcmluZ0luc3RhbmNlc1tkYXRhLnV1aWRdLmRhbXBpbmcgPSBkYXRhLnByb3BzOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICBjYXNlICdyZW1vdmVTcHJpbmcnOgogICAgICAgIHsKICAgICAgICAgIHN0YXRlLndvcmxkLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ3Bvc3RTdGVwJywgc3RhdGUuc3ByaW5nc1tkYXRhLnV1aWRdKTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgY2FzZSAnYWRkUmF5JzoKICAgICAgICB7CiAgICAgICAgICBhZGRSYXkoc3RhdGUsIGRhdGEpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICBjYXNlICdyZW1vdmVSYXknOgogICAgICAgIHsKICAgICAgICAgIHN0YXRlLndvcmxkLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ3ByZVN0ZXAnLCBzdGF0ZS5yYXlzW2RhdGEudXVpZF0pOwogICAgICAgICAgZGVsZXRlIHN0YXRlLnJheXNbZGF0YS51dWlkXTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgY2FzZSAnYWRkUmF5Y2FzdFZlaGljbGUnOgogICAgICAgIHsKICAgICAgICAgIGFkZFJheWNhc3RWZWhpY2xlKHN0YXRlLCBkYXRhKTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgY2FzZSAncmVtb3ZlUmF5Y2FzdFZlaGljbGUnOgogICAgICAgIHsKICAgICAgICAgIHN0YXRlLndvcmxkLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ3ByZVN0ZXAnLCBzdGF0ZS52ZWhpY2xlc1tkYXRhLnV1aWRdLnByZVN0ZXApOwogICAgICAgICAgc3RhdGUud29ybGQucmVtb3ZlRXZlbnRMaXN0ZW5lcigncG9zdFN0ZXAnLCBzdGF0ZS52ZWhpY2xlc1tkYXRhLnV1aWRdLnBvc3RTdGVwKTsKICAgICAgICAgIHN0YXRlLnZlaGljbGVzW2RhdGEudXVpZF0udmVoaWNsZS53b3JsZCA9IG51bGw7CiAgICAgICAgICBkZWxldGUgc3RhdGUudmVoaWNsZXNbZGF0YS51dWlkXTsKICAgICAgICAgIGNvbnN0IGtleSA9IE9iamVjdC5rZXlzKHN0YXRlLnN1YnNjcmlwdGlvbnMpLmZpbmQoayA9PiBzdGF0ZS5zdWJzY3JpcHRpb25zW2tdWzBdID09PSBkYXRhLnV1aWQpOwogICAgICAgICAgaWYgKGtleSkgewogICAgICAgICAgICBkZWxldGUgc3RhdGUuc3Vic2NyaXB0aW9uc1trZXldOwogICAgICAgICAgfQogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICBjYXNlICdzZXRSYXljYXN0VmVoaWNsZVN0ZWVyaW5nVmFsdWUnOgogICAgICAgIHsKICAgICAgICAgIGNvbnN0IFt2YWx1ZSwgd2hlZWxJbmRleF0gPSBkYXRhLnByb3BzOwogICAgICAgICAgc3RhdGUudmVoaWNsZXNbZGF0YS51dWlkXS52ZWhpY2xlLnNldFN0ZWVyaW5nVmFsdWUodmFsdWUsIHdoZWVsSW5kZXgpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICBjYXNlICdhcHBseVJheWNhc3RWZWhpY2xlRW5naW5lRm9yY2UnOgogICAgICAgIHsKICAgICAgICAgIGNvbnN0IFt2YWx1ZSwgd2hlZWxJbmRleF0gPSBkYXRhLnByb3BzOwogICAgICAgICAgc3RhdGUudmVoaWNsZXNbZGF0YS51dWlkXS52ZWhpY2xlLmFwcGx5RW5naW5lRm9yY2UodmFsdWUsIHdoZWVsSW5kZXgpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICBjYXNlICdzZXRSYXljYXN0VmVoaWNsZUJyYWtlJzoKICAgICAgICB7CiAgICAgICAgICBjb25zdCBbYnJha2UsIHdoZWVsSW5kZXhdID0gZGF0YS5wcm9wczsKICAgICAgICAgIHN0YXRlLnZlaGljbGVzW2RhdGEudXVpZF0udmVoaWNsZS5zZXRCcmFrZShicmFrZSwgd2hlZWxJbmRleCk7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgIGNhc2UgJ2FkZENvbnRhY3RNYXRlcmlhbCc6CiAgICAgICAgewogICAgICAgICAgYWRkQ29udGFjdE1hdGVyaWFsKHN0YXRlLndvcmxkLCBjcmVhdGVNYXRlcmlhbCwgZGF0YS5wcm9wcywgZGF0YS51dWlkKTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgY2FzZSAncmVtb3ZlQ29udGFjdE1hdGVyaWFsJzoKICAgICAgICB7CiAgICAgICAgICByZW1vdmVDb250YWN0TWF0ZXJpYWwoc3RhdGUud29ybGQsIGRhdGEudXVpZCk7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgIGNhc2UgJ3dha2VVcCc6CiAgICAgICAgewogICAgICAgICAgc3RhdGUuYm9kaWVzW2RhdGEudXVpZF0ud2FrZVVwKCk7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgIGNhc2UgJ3NsZWVwJzoKICAgICAgICB7CiAgICAgICAgICBzdGF0ZS5ib2RpZXNbZGF0YS51dWlkXS5zbGVlcCgpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgfQogIH07Cgp9KSgpOwoK");class CannonWorkerAPI extends EventEmitter$1{constructor(_){let{allowSleep:K=!1,axisIndex:te=0,broadphase:ne="Naive",defaultContactMaterial:ie={contactEquationStiffness:1e6},frictionGravity:oe=null,gravity:se=[0,-9.81,0],iterations:ae=5,quatNormalizeFast:ge=!1,quatNormalizeSkip:ce=0,size:de=1e3,solver:Ie="GS",tolerance:fe=.001}=_;super();Cu(this,"messageQueue",[]);Cu(this,"worker",null);this.config={allowSleep:K,axisIndex:te,broadphase:ne,defaultContactMaterial:ie,frictionGravity:oe,gravity:se,iterations:ae,quatNormalizeFast:ge,quatNormalizeSkip:ce,size:de,solver:Ie,tolerance:fe},this.buffers={positions:new Float32Array(de*3),quaternions:new Float32Array(de*4)}}get axisIndex(){return this.config.axisIndex}set axisIndex(_){this.config.axisIndex=_,this.postMessage({op:"setAxisIndex",props:_})}get broadphase(){return this.config.broadphase}set broadphase(_){this.config.broadphase=_,this.postMessage({op:"setBroadphase",props:_})}get frictionGravity(){return this.config.frictionGravity}set frictionGravity(_){this.config.frictionGravity=_,this.postMessage({op:"setFrictionGravity",props:_})}get gravity(){return this.config.gravity}set gravity(_){this.config.gravity=_,this.postMessage({op:"setGravity",props:_})}get iterations(){return this.config.iterations}set iterations(_){this.config.iterations=_,this.postMessage({op:"setIterations",props:_})}get tolerance(){return this.config.tolerance}set tolerance(_){this.config.tolerance=_,this.postMessage({op:"setTolerance",props:_})}addBodies(_){let{props:K,type:te,uuid:ne}=_;this.postMessage({op:"addBodies",props:K,type:te,uuid:ne})}addConstraint(_){let{props:[K,te,ne],type:ie,uuid:oe}=_;this.postMessage({op:"addConstraint",props:[K,te,ne],type:ie,uuid:oe})}addContactMaterial(_){let{props:K,uuid:te}=_;this.postMessage({op:"addContactMaterial",props:K,uuid:te})}addRay(_){let{props:K,uuid:te}=_;this.postMessage({op:"addRay",props:K,uuid:te})}addRaycastVehicle(_){let{props:[K,te,ne,ie,oe,se],uuid:ae}=_;this.postMessage({op:"addRaycastVehicle",props:[K,te,ne,ie,oe,se],uuid:ae})}addSpring(_){let{props:[K,te,ne],uuid:ie}=_;this.postMessage({op:"addSpring",props:[K,te,ne],uuid:ie})}applyForce(_){let{props:K,uuid:te}=_;this.postMessage({op:"applyForce",props:K,uuid:te})}applyImpulse(_){let{props:K,uuid:te}=_;this.postMessage({op:"applyImpulse",props:K,uuid:te})}applyLocalForce(_){let{props:K,uuid:te}=_;this.postMessage({op:"applyLocalForce",props:K,uuid:te})}applyLocalImpulse(_){let{props:K,uuid:te}=_;this.postMessage({op:"applyLocalImpulse",props:K,uuid:te})}applyRaycastVehicleEngineForce(_){let{props:K,uuid:te}=_;this.postMessage({op:"applyRaycastVehicleEngineForce",props:K,uuid:te})}applyTorque(_){let{props:K,uuid:te}=_;this.postMessage({op:"applyTorque",props:K,uuid:te})}connect(){this.worker=new WorkerFactory,this.worker.onmessage=_=>{if(_.data.op==="frame"){this.buffers.positions=_.data.positions,this.buffers.quaternions=_.data.quaternions,this.emit(_.data.op,_.data);return}this.emit(_.data.type,_.data)};for(const _ of this.messageQueue)this.worker.postMessage(_);this.messageQueue.length=0}disableConstraint(_){let{uuid:K}=_;this.postMessage({op:"disableConstraint",uuid:K})}disableConstraintMotor(_){let{uuid:K}=_;this.postMessage({op:"disableConstraintMotor",uuid:K})}disconnect(){this.worker&&(this.worker.onmessage=null)}enableConstraint(_){let{uuid:K}=_;this.postMessage({op:"enableConstraint",uuid:K})}enableConstraintMotor(_){let{uuid:K}=_;this.postMessage({op:"enableConstraintMotor",uuid:K})}init(){const{allowSleep:_,axisIndex:K,broadphase:te,defaultContactMaterial:ne,frictionGravity:ie,gravity:oe,iterations:se,quatNormalizeFast:ae,quatNormalizeSkip:ge,solver:ce,tolerance:de}=this.config;this.postMessage({op:"init",props:{allowSleep:_,axisIndex:K,broadphase:te,defaultContactMaterial:ne,frictionGravity:ie,gravity:oe,iterations:se,quatNormalizeFast:ae,quatNormalizeSkip:ge,solver:ce,tolerance:de}})}removeBodies(_){let{uuid:K}=_;this.postMessage({op:"removeBodies",uuid:K})}removeConstraint(_){let{uuid:K}=_;this.postMessage({op:"removeConstraint",uuid:K})}removeContactMaterial(_){let{uuid:K}=_;this.postMessage({op:"removeContactMaterial",uuid:K})}removeRay(_){let{uuid:K}=_;this.postMessage({op:"removeRay",uuid:K})}removeRaycastVehicle(_){let{uuid:K}=_;this.postMessage({op:"removeRaycastVehicle",uuid:K})}removeSpring(_){let{uuid:K}=_;this.postMessage({op:"removeSpring",uuid:K})}setAllowSleep(_){let{props:K,uuid:te}=_;this.postMessage({op:"setAllowSleep",props:K,uuid:te})}setAngularDamping(_){let{props:K,uuid:te}=_;this.postMessage({op:"setAngularDamping",props:K,uuid:te})}setAngularFactor(_){let{props:K,uuid:te}=_;this.postMessage({op:"setAngularFactor",props:K,uuid:te})}setAngularVelocity(_){let{props:K,uuid:te}=_;this.postMessage({op:"setAngularVelocity",props:K,uuid:te})}setCollisionFilterGroup(_){let{props:K,uuid:te}=_;this.postMessage({op:"setCollisionFilterGroup",props:K,uuid:te})}setCollisionFilterMask(_){let{props:K,uuid:te}=_;this.postMessage({op:"setCollisionFilterMask",props:K,uuid:te})}setCollisionResponse(_){let{props:K,uuid:te}=_;this.postMessage({op:"setCollisionResponse",props:K,uuid:te})}setConstraintMotorMaxForce(_){let{props:K,uuid:te}=_;this.postMessage({op:"setConstraintMotorMaxForce",props:K,uuid:te})}setConstraintMotorSpeed(_){let{props:K,uuid:te}=_;this.postMessage({op:"setConstraintMotorSpeed",props:K,uuid:te})}setFixedRotation(_){let{props:K,uuid:te}=_;this.postMessage({op:"setFixedRotation",props:K,uuid:te})}setIsTrigger(_){let{props:K,uuid:te}=_;this.postMessage({op:"setIsTrigger",props:K,uuid:te})}setLinearDamping(_){let{props:K,uuid:te}=_;this.postMessage({op:"setLinearDamping",props:K,uuid:te})}setLinearFactor(_){let{props:K,uuid:te}=_;this.postMessage({op:"setLinearFactor",props:K,uuid:te})}setMass(_){let{props:K,uuid:te}=_;this.postMessage({op:"setMass",props:K,uuid:te})}setMaterial(_){let{props:K,uuid:te}=_;this.postMessage({op:"setMaterial",props:K,uuid:te})}setPosition(_){let{props:K,uuid:te}=_;this.postMessage({op:"setPosition",props:K,uuid:te})}setQuaternion(_){let{props:[K,te,ne,ie],uuid:oe}=_;this.postMessage({op:"setQuaternion",props:[K,te,ne,ie],uuid:oe})}setRaycastVehicleBrake(_){let{props:K,uuid:te}=_;this.postMessage({op:"setRaycastVehicleBrake",props:K,uuid:te})}setRaycastVehicleSteeringValue(_){let{props:K,uuid:te}=_;this.postMessage({op:"setRaycastVehicleSteeringValue",props:K,uuid:te})}setRotation(_){let{props:K,uuid:te}=_;this.postMessage({op:"setRotation",props:K,uuid:te})}setSleepSpeedLimit(_){let{props:K,uuid:te}=_;this.postMessage({op:"setSleepSpeedLimit",props:K,uuid:te})}setSleepTimeLimit(_){let{props:K,uuid:te}=_;this.postMessage({op:"setSleepTimeLimit",props:K,uuid:te})}setSpringDamping(_){let{props:K,uuid:te}=_;this.postMessage({op:"setSpringDamping",props:K,uuid:te})}setSpringRestLength(_){let{props:K,uuid:te}=_;this.postMessage({op:"setSpringRestLength",props:K,uuid:te})}setSpringStiffness(_){let{props:K,uuid:te}=_;this.postMessage({op:"setSpringStiffness",props:K,uuid:te})}setUserData(_){let{props:K,uuid:te}=_;this.postMessage({op:"setUserData",props:K,uuid:te})}setVelocity(_){let{props:K,uuid:te}=_;this.postMessage({op:"setVelocity",props:K,uuid:te})}sleep(_){let{uuid:K}=_;this.postMessage({op:"sleep",uuid:K})}step(_){var K;const{buffers:{positions:te,quaternions:ne}}=this;!te.byteLength&&!ne.byteLength||(K=this.worker)==null||K.postMessage({op:"step",positions:te,props:_,quaternions:ne},[te.buffer,ne.buffer])}subscribe(_){let{props:{id:K,target:te,type:ne},uuid:ie}=_;this.postMessage({op:"subscribe",props:{id:K,target:te,type:ne},uuid:ie})}terminate(){var _;(_=this.worker)==null||_.terminate(),this.worker=null}unsubscribe(_){let{props:K}=_;this.postMessage({op:"unsubscribe",props:K})}wakeUp(_){let{uuid:K}=_;this.postMessage({op:"wakeUp",uuid:K})}postMessage(_){if(this.worker)return this.worker.postMessage(_);this.messageQueue.push(_)}}class Mat3$1{constructor(Z){Z===void 0&&(Z=[0,0,0,0,0,0,0,0,0]),this.elements=Z}identity(){const Z=this.elements;Z[0]=1,Z[1]=0,Z[2]=0,Z[3]=0,Z[4]=1,Z[5]=0,Z[6]=0,Z[7]=0,Z[8]=1}setZero(){const Z=this.elements;Z[0]=0,Z[1]=0,Z[2]=0,Z[3]=0,Z[4]=0,Z[5]=0,Z[6]=0,Z[7]=0,Z[8]=0}setTrace(Z){const _=this.elements;_[0]=Z.x,_[4]=Z.y,_[8]=Z.z}getTrace(Z){Z===void 0&&(Z=new Vec3$1);const _=this.elements;return Z.x=_[0],Z.y=_[4],Z.z=_[8],Z}vmult(Z,_){_===void 0&&(_=new Vec3$1);const K=this.elements,te=Z.x,ne=Z.y,ie=Z.z;return _.x=K[0]*te+K[1]*ne+K[2]*ie,_.y=K[3]*te+K[4]*ne+K[5]*ie,_.z=K[6]*te+K[7]*ne+K[8]*ie,_}smult(Z){for(let _=0;_<this.elements.length;_++)this.elements[_]*=Z}mmult(Z,_){_===void 0&&(_=new Mat3$1);const K=this.elements,te=Z.elements,ne=_.elements,ie=K[0],oe=K[1],se=K[2],ae=K[3],ge=K[4],ce=K[5],de=K[6],Ie=K[7],fe=K[8],be=te[0],Ae=te[1],ye=te[2],ve=te[3],Be=te[4],Re=te[5],Ve=te[6],Ee=te[7],Ze=te[8];return ne[0]=ie*be+oe*ve+se*Ve,ne[1]=ie*Ae+oe*Be+se*Ee,ne[2]=ie*ye+oe*Re+se*Ze,ne[3]=ae*be+ge*ve+ce*Ve,ne[4]=ae*Ae+ge*Be+ce*Ee,ne[5]=ae*ye+ge*Re+ce*Ze,ne[6]=de*be+Ie*ve+fe*Ve,ne[7]=de*Ae+Ie*Be+fe*Ee,ne[8]=de*ye+Ie*Re+fe*Ze,_}scale(Z,_){_===void 0&&(_=new Mat3$1);const K=this.elements,te=_.elements;for(let ne=0;ne!==3;ne++)te[3*ne+0]=Z.x*K[3*ne+0],te[3*ne+1]=Z.y*K[3*ne+1],te[3*ne+2]=Z.z*K[3*ne+2];return _}solve(Z,_){_===void 0&&(_=new Vec3$1);const K=3,te=4,ne=[];let ie,oe;for(ie=0;ie<K*te;ie++)ne.push(0);for(ie=0;ie<3;ie++)for(oe=0;oe<3;oe++)ne[ie+te*oe]=this.elements[ie+3*oe];ne[3+4*0]=Z.x,ne[3+4*1]=Z.y,ne[3+4*2]=Z.z;let se=3;const ae=se;let ge;const ce=4;let de;do{if(ie=ae-se,ne[ie+te*ie]===0){for(oe=ie+1;oe<ae;oe++)if(ne[ie+te*oe]!==0){ge=ce;do de=ce-ge,ne[de+te*ie]+=ne[de+te*oe];while(--ge);break}}if(ne[ie+te*ie]!==0)for(oe=ie+1;oe<ae;oe++){const Ie=ne[ie+te*oe]/ne[ie+te*ie];ge=ce;do de=ce-ge,ne[de+te*oe]=de<=ie?0:ne[de+te*oe]-ne[de+te*ie]*Ie;while(--ge)}}while(--se);if(_.z=ne[2*te+3]/ne[2*te+2],_.y=(ne[1*te+3]-ne[1*te+2]*_.z)/ne[1*te+1],_.x=(ne[0*te+3]-ne[0*te+2]*_.z-ne[0*te+1]*_.y)/ne[0*te+0],isNaN(_.x)||isNaN(_.y)||isNaN(_.z)||_.x===1/0||_.y===1/0||_.z===1/0)throw`Could not solve equation! Got x=[${_.toString()}], b=[${Z.toString()}], A=[${this.toString()}]`;return _}e(Z,_,K){if(K===void 0)return this.elements[_+3*Z];this.elements[_+3*Z]=K}copy(Z){for(let _=0;_<Z.elements.length;_++)this.elements[_]=Z.elements[_];return this}toString(){let Z="";const _=",";for(let K=0;K<9;K++)Z+=this.elements[K]+_;return Z}reverse(Z){Z===void 0&&(Z=new Mat3$1);const _=3,K=6,te=reverse_eqns$1;let ne,ie;for(ne=0;ne<3;ne++)for(ie=0;ie<3;ie++)te[ne+K*ie]=this.elements[ne+3*ie];te[3+6*0]=1,te[3+6*1]=0,te[3+6*2]=0,te[4+6*0]=0,te[4+6*1]=1,te[4+6*2]=0,te[5+6*0]=0,te[5+6*1]=0,te[5+6*2]=1;let oe=3;const se=oe;let ae;const ge=K;let ce;do{if(ne=se-oe,te[ne+K*ne]===0){for(ie=ne+1;ie<se;ie++)if(te[ne+K*ie]!==0){ae=ge;do ce=ge-ae,te[ce+K*ne]+=te[ce+K*ie];while(--ae);break}}if(te[ne+K*ne]!==0)for(ie=ne+1;ie<se;ie++){const de=te[ne+K*ie]/te[ne+K*ne];ae=ge;do ce=ge-ae,te[ce+K*ie]=ce<=ne?0:te[ce+K*ie]-te[ce+K*ne]*de;while(--ae)}}while(--oe);ne=2;do{ie=ne-1;do{const de=te[ne+K*ie]/te[ne+K*ne];ae=K;do ce=K-ae,te[ce+K*ie]=te[ce+K*ie]-te[ce+K*ne]*de;while(--ae)}while(ie--)}while(--ne);ne=2;do{const de=1/te[ne+K*ne];ae=K;do ce=K-ae,te[ce+K*ne]=te[ce+K*ne]*de;while(--ae)}while(ne--);ne=2;do{ie=2;do{if(ce=te[_+ie+K*ne],isNaN(ce)||ce===1/0)throw`Could not reverse! A=[${this.toString()}]`;Z.e(ne,ie,ce)}while(ie--)}while(ne--);return Z}setRotationFromQuaternion(Z){const _=Z.x,K=Z.y,te=Z.z,ne=Z.w,ie=_+_,oe=K+K,se=te+te,ae=_*ie,ge=_*oe,ce=_*se,de=K*oe,Ie=K*se,fe=te*se,be=ne*ie,Ae=ne*oe,ye=ne*se,ve=this.elements;return ve[3*0+0]=1-(de+fe),ve[3*0+1]=ge-ye,ve[3*0+2]=ce+Ae,ve[3*1+0]=ge+ye,ve[3*1+1]=1-(ae+fe),ve[3*1+2]=Ie-be,ve[3*2+0]=ce-Ae,ve[3*2+1]=Ie+be,ve[3*2+2]=1-(ae+de),this}transpose(Z){Z===void 0&&(Z=new Mat3$1);const _=this.elements,K=Z.elements;let te;return K[0]=_[0],K[4]=_[4],K[8]=_[8],te=_[1],K[1]=_[3],K[3]=te,te=_[2],K[2]=_[6],K[6]=te,te=_[5],K[5]=_[7],K[7]=te,Z}}const reverse_eqns$1=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];class Vec3$1{constructor(Z,_,K){Z===void 0&&(Z=0),_===void 0&&(_=0),K===void 0&&(K=0),this.x=Z,this.y=_,this.z=K}cross(Z,_){_===void 0&&(_=new Vec3$1);const K=Z.x,te=Z.y,ne=Z.z,ie=this.x,oe=this.y,se=this.z;return _.x=oe*ne-se*te,_.y=se*K-ie*ne,_.z=ie*te-oe*K,_}set(Z,_,K){return this.x=Z,this.y=_,this.z=K,this}setZero(){this.x=this.y=this.z=0}vadd(Z,_){if(_)_.x=Z.x+this.x,_.y=Z.y+this.y,_.z=Z.z+this.z;else return new Vec3$1(this.x+Z.x,this.y+Z.y,this.z+Z.z)}vsub(Z,_){if(_)_.x=this.x-Z.x,_.y=this.y-Z.y,_.z=this.z-Z.z;else return new Vec3$1(this.x-Z.x,this.y-Z.y,this.z-Z.z)}crossmat(){return new Mat3$1([0,-this.z,this.y,this.z,0,-this.x,-this.y,this.x,0])}normalize(){const Z=this.x,_=this.y,K=this.z,te=Math.sqrt(Z*Z+_*_+K*K);if(te>0){const ne=1/te;this.x*=ne,this.y*=ne,this.z*=ne}else this.x=0,this.y=0,this.z=0;return te}unit(Z){Z===void 0&&(Z=new Vec3$1);const _=this.x,K=this.y,te=this.z;let ne=Math.sqrt(_*_+K*K+te*te);return ne>0?(ne=1/ne,Z.x=_*ne,Z.y=K*ne,Z.z=te*ne):(Z.x=1,Z.y=0,Z.z=0),Z}length(){const Z=this.x,_=this.y,K=this.z;return Math.sqrt(Z*Z+_*_+K*K)}lengthSquared(){return this.dot(this)}distanceTo(Z){const _=this.x,K=this.y,te=this.z,ne=Z.x,ie=Z.y,oe=Z.z;return Math.sqrt((ne-_)*(ne-_)+(ie-K)*(ie-K)+(oe-te)*(oe-te))}distanceSquared(Z){const _=this.x,K=this.y,te=this.z,ne=Z.x,ie=Z.y,oe=Z.z;return(ne-_)*(ne-_)+(ie-K)*(ie-K)+(oe-te)*(oe-te)}scale(Z,_){_===void 0&&(_=new Vec3$1);const K=this.x,te=this.y,ne=this.z;return _.x=Z*K,_.y=Z*te,_.z=Z*ne,_}vmul(Z,_){return _===void 0&&(_=new Vec3$1),_.x=Z.x*this.x,_.y=Z.y*this.y,_.z=Z.z*this.z,_}addScaledVector(Z,_,K){return K===void 0&&(K=new Vec3$1),K.x=this.x+Z*_.x,K.y=this.y+Z*_.y,K.z=this.z+Z*_.z,K}dot(Z){return this.x*Z.x+this.y*Z.y+this.z*Z.z}isZero(){return this.x===0&&this.y===0&&this.z===0}negate(Z){return Z===void 0&&(Z=new Vec3$1),Z.x=-this.x,Z.y=-this.y,Z.z=-this.z,Z}tangents(Z,_){const K=this.length();if(K>0){const te=Vec3_tangents_n$1,ne=1/K;te.set(this.x*ne,this.y*ne,this.z*ne);const ie=Vec3_tangents_randVec$1;Math.abs(te.x)<.9?(ie.set(1,0,0),te.cross(ie,Z)):(ie.set(0,1,0),te.cross(ie,Z)),te.cross(Z,_)}else Z.set(1,0,0),_.set(0,1,0)}toString(){return`${this.x},${this.y},${this.z}`}toArray(){return[this.x,this.y,this.z]}copy(Z){return this.x=Z.x,this.y=Z.y,this.z=Z.z,this}lerp(Z,_,K){const te=this.x,ne=this.y,ie=this.z;K.x=te+(Z.x-te)*_,K.y=ne+(Z.y-ne)*_,K.z=ie+(Z.z-ie)*_}almostEquals(Z,_){return _===void 0&&(_=1e-6),!(Math.abs(this.x-Z.x)>_||Math.abs(this.y-Z.y)>_||Math.abs(this.z-Z.z)>_)}almostZero(Z){return Z===void 0&&(Z=1e-6),!(Math.abs(this.x)>Z||Math.abs(this.y)>Z||Math.abs(this.z)>Z)}isAntiparallelTo(Z,_){return this.negate(antip_neg$1),antip_neg$1.almostEquals(Z,_)}clone(){return new Vec3$1(this.x,this.y,this.z)}}Vec3$1.ZERO=new Vec3$1(0,0,0);Vec3$1.UNIT_X=new Vec3$1(1,0,0);Vec3$1.UNIT_Y=new Vec3$1(0,1,0);Vec3$1.UNIT_Z=new Vec3$1(0,0,1);const Vec3_tangents_n$1=new Vec3$1,Vec3_tangents_randVec$1=new Vec3$1,antip_neg$1=new Vec3$1;class AABB$1{constructor(Z){Z===void 0&&(Z={}),this.lowerBound=new Vec3$1,this.upperBound=new Vec3$1,Z.lowerBound&&this.lowerBound.copy(Z.lowerBound),Z.upperBound&&this.upperBound.copy(Z.upperBound)}setFromPoints(Z,_,K,te){const ne=this.lowerBound,ie=this.upperBound,oe=K;ne.copy(Z[0]),oe&&oe.vmult(ne,ne),ie.copy(ne);for(let se=1;se<Z.length;se++){let ae=Z[se];oe&&(oe.vmult(ae,tmp$1$1),ae=tmp$1$1),ae.x>ie.x&&(ie.x=ae.x),ae.x<ne.x&&(ne.x=ae.x),ae.y>ie.y&&(ie.y=ae.y),ae.y<ne.y&&(ne.y=ae.y),ae.z>ie.z&&(ie.z=ae.z),ae.z<ne.z&&(ne.z=ae.z)}return _&&(_.vadd(ne,ne),_.vadd(ie,ie)),te&&(ne.x-=te,ne.y-=te,ne.z-=te,ie.x+=te,ie.y+=te,ie.z+=te),this}copy(Z){return this.lowerBound.copy(Z.lowerBound),this.upperBound.copy(Z.upperBound),this}clone(){return new AABB$1().copy(this)}extend(Z){this.lowerBound.x=Math.min(this.lowerBound.x,Z.lowerBound.x),this.upperBound.x=Math.max(this.upperBound.x,Z.upperBound.x),this.lowerBound.y=Math.min(this.lowerBound.y,Z.lowerBound.y),this.upperBound.y=Math.max(this.upperBound.y,Z.upperBound.y),this.lowerBound.z=Math.min(this.lowerBound.z,Z.lowerBound.z),this.upperBound.z=Math.max(this.upperBound.z,Z.upperBound.z)}overlaps(Z){const _=this.lowerBound,K=this.upperBound,te=Z.lowerBound,ne=Z.upperBound,ie=te.x<=K.x&&K.x<=ne.x||_.x<=ne.x&&ne.x<=K.x,oe=te.y<=K.y&&K.y<=ne.y||_.y<=ne.y&&ne.y<=K.y,se=te.z<=K.z&&K.z<=ne.z||_.z<=ne.z&&ne.z<=K.z;return ie&&oe&&se}volume(){const Z=this.lowerBound,_=this.upperBound;return(_.x-Z.x)*(_.y-Z.y)*(_.z-Z.z)}contains(Z){const _=this.lowerBound,K=this.upperBound,te=Z.lowerBound,ne=Z.upperBound;return _.x<=te.x&&K.x>=ne.x&&_.y<=te.y&&K.y>=ne.y&&_.z<=te.z&&K.z>=ne.z}getCorners(Z,_,K,te,ne,ie,oe,se){const ae=this.lowerBound,ge=this.upperBound;Z.copy(ae),_.set(ge.x,ae.y,ae.z),K.set(ge.x,ge.y,ae.z),te.set(ae.x,ge.y,ge.z),ne.set(ge.x,ae.y,ge.z),ie.set(ae.x,ge.y,ae.z),oe.set(ae.x,ae.y,ge.z),se.copy(ge)}toLocalFrame(Z,_){const K=transformIntoFrame_corners$1,te=K[0],ne=K[1],ie=K[2],oe=K[3],se=K[4],ae=K[5],ge=K[6],ce=K[7];this.getCorners(te,ne,ie,oe,se,ae,ge,ce);for(let de=0;de!==8;de++){const Ie=K[de];Z.pointToLocal(Ie,Ie)}return _.setFromPoints(K)}toWorldFrame(Z,_){const K=transformIntoFrame_corners$1,te=K[0],ne=K[1],ie=K[2],oe=K[3],se=K[4],ae=K[5],ge=K[6],ce=K[7];this.getCorners(te,ne,ie,oe,se,ae,ge,ce);for(let de=0;de!==8;de++){const Ie=K[de];Z.pointToWorld(Ie,Ie)}return _.setFromPoints(K)}overlapsRay(Z){const{direction:_,from:K}=Z,te=1/_.x,ne=1/_.y,ie=1/_.z,oe=(this.lowerBound.x-K.x)*te,se=(this.upperBound.x-K.x)*te,ae=(this.lowerBound.y-K.y)*ne,ge=(this.upperBound.y-K.y)*ne,ce=(this.lowerBound.z-K.z)*ie,de=(this.upperBound.z-K.z)*ie,Ie=Math.max(Math.max(Math.min(oe,se),Math.min(ae,ge)),Math.min(ce,de)),fe=Math.min(Math.min(Math.max(oe,se),Math.max(ae,ge)),Math.max(ce,de));return!(fe<0||Ie>fe)}}const tmp$1$1=new Vec3$1,transformIntoFrame_corners$1=[new Vec3$1,new Vec3$1,new Vec3$1,new Vec3$1,new Vec3$1,new Vec3$1,new Vec3$1,new Vec3$1];class Quaternion$1{constructor(Z,_,K,te){Z===void 0&&(Z=0),_===void 0&&(_=0),K===void 0&&(K=0),te===void 0&&(te=1),this.x=Z,this.y=_,this.z=K,this.w=te}set(Z,_,K,te){return this.x=Z,this.y=_,this.z=K,this.w=te,this}toString(){return`${this.x},${this.y},${this.z},${this.w}`}toArray(){return[this.x,this.y,this.z,this.w]}setFromAxisAngle(Z,_){const K=Math.sin(_*.5);return this.x=Z.x*K,this.y=Z.y*K,this.z=Z.z*K,this.w=Math.cos(_*.5),this}toAxisAngle(Z){Z===void 0&&(Z=new Vec3$1),this.normalize();const _=2*Math.acos(this.w),K=Math.sqrt(1-this.w*this.w);return K<.001?(Z.x=this.x,Z.y=this.y,Z.z=this.z):(Z.x=this.x/K,Z.y=this.y/K,Z.z=this.z/K),[Z,_]}setFromVectors(Z,_){if(Z.isAntiparallelTo(_)){const K=sfv_t1$1,te=sfv_t2$1;Z.tangents(K,te),this.setFromAxisAngle(K,Math.PI)}else{const K=Z.cross(_);this.x=K.x,this.y=K.y,this.z=K.z,this.w=Math.sqrt(Z.length()**2*_.length()**2)+Z.dot(_),this.normalize()}return this}mult(Z,_){_===void 0&&(_=new Quaternion$1);const K=this.x,te=this.y,ne=this.z,ie=this.w,oe=Z.x,se=Z.y,ae=Z.z,ge=Z.w;return _.x=K*ge+ie*oe+te*ae-ne*se,_.y=te*ge+ie*se+ne*oe-K*ae,_.z=ne*ge+ie*ae+K*se-te*oe,_.w=ie*ge-K*oe-te*se-ne*ae,_}inverse(Z){Z===void 0&&(Z=new Quaternion$1);const _=this.x,K=this.y,te=this.z,ne=this.w;this.conjugate(Z);const ie=1/(_*_+K*K+te*te+ne*ne);return Z.x*=ie,Z.y*=ie,Z.z*=ie,Z.w*=ie,Z}conjugate(Z){return Z===void 0&&(Z=new Quaternion$1),Z.x=-this.x,Z.y=-this.y,Z.z=-this.z,Z.w=this.w,Z}normalize(){let Z=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);return Z===0?(this.x=0,this.y=0,this.z=0,this.w=0):(Z=1/Z,this.x*=Z,this.y*=Z,this.z*=Z,this.w*=Z),this}normalizeFast(){const Z=(3-(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w))/2;return Z===0?(this.x=0,this.y=0,this.z=0,this.w=0):(this.x*=Z,this.y*=Z,this.z*=Z,this.w*=Z),this}vmult(Z,_){_===void 0&&(_=new Vec3$1);const K=Z.x,te=Z.y,ne=Z.z,ie=this.x,oe=this.y,se=this.z,ae=this.w,ge=ae*K+oe*ne-se*te,ce=ae*te+se*K-ie*ne,de=ae*ne+ie*te-oe*K,Ie=-ie*K-oe*te-se*ne;return _.x=ge*ae+Ie*-ie+ce*-se-de*-oe,_.y=ce*ae+Ie*-oe+de*-ie-ge*-se,_.z=de*ae+Ie*-se+ge*-oe-ce*-ie,_}copy(Z){return this.x=Z.x,this.y=Z.y,this.z=Z.z,this.w=Z.w,this}toEuler(Z,_){_===void 0&&(_="YZX");let K,te,ne;const ie=this.x,oe=this.y,se=this.z,ae=this.w;switch(_){case"YZX":const ge=ie*oe+se*ae;if(ge>.499&&(K=2*Math.atan2(ie,ae),te=Math.PI/2,ne=0),ge<-.499&&(K=-2*Math.atan2(ie,ae),te=-Math.PI/2,ne=0),K===void 0){const ce=ie*ie,de=oe*oe,Ie=se*se;K=Math.atan2(2*oe*ae-2*ie*se,1-2*de-2*Ie),te=Math.asin(2*ge),ne=Math.atan2(2*ie*ae-2*oe*se,1-2*ce-2*Ie)}break;default:throw new Error(`Euler order ${_} not supported yet.`)}Z.y=K,Z.z=te,Z.x=ne}setFromEuler(Z,_,K,te){te===void 0&&(te="XYZ");const ne=Math.cos(Z/2),ie=Math.cos(_/2),oe=Math.cos(K/2),se=Math.sin(Z/2),ae=Math.sin(_/2),ge=Math.sin(K/2);return te==="XYZ"?(this.x=se*ie*oe+ne*ae*ge,this.y=ne*ae*oe-se*ie*ge,this.z=ne*ie*ge+se*ae*oe,this.w=ne*ie*oe-se*ae*ge):te==="YXZ"?(this.x=se*ie*oe+ne*ae*ge,this.y=ne*ae*oe-se*ie*ge,this.z=ne*ie*ge-se*ae*oe,this.w=ne*ie*oe+se*ae*ge):te==="ZXY"?(this.x=se*ie*oe-ne*ae*ge,this.y=ne*ae*oe+se*ie*ge,this.z=ne*ie*ge+se*ae*oe,this.w=ne*ie*oe-se*ae*ge):te==="ZYX"?(this.x=se*ie*oe-ne*ae*ge,this.y=ne*ae*oe+se*ie*ge,this.z=ne*ie*ge-se*ae*oe,this.w=ne*ie*oe+se*ae*ge):te==="YZX"?(this.x=se*ie*oe+ne*ae*ge,this.y=ne*ae*oe+se*ie*ge,this.z=ne*ie*ge-se*ae*oe,this.w=ne*ie*oe-se*ae*ge):te==="XZY"&&(this.x=se*ie*oe-ne*ae*ge,this.y=ne*ae*oe-se*ie*ge,this.z=ne*ie*ge+se*ae*oe,this.w=ne*ie*oe+se*ae*ge),this}clone(){return new Quaternion$1(this.x,this.y,this.z,this.w)}slerp(Z,_,K){K===void 0&&(K=new Quaternion$1);const te=this.x,ne=this.y,ie=this.z,oe=this.w;let se=Z.x,ae=Z.y,ge=Z.z,ce=Z.w,de,Ie,fe,be,Ae;return Ie=te*se+ne*ae+ie*ge+oe*ce,Ie<0&&(Ie=-Ie,se=-se,ae=-ae,ge=-ge,ce=-ce),1-Ie>1e-6?(de=Math.acos(Ie),fe=Math.sin(de),be=Math.sin((1-_)*de)/fe,Ae=Math.sin(_*de)/fe):(be=1-_,Ae=_),K.x=be*te+Ae*se,K.y=be*ne+Ae*ae,K.z=be*ie+Ae*ge,K.w=be*oe+Ae*ce,K}integrate(Z,_,K,te){te===void 0&&(te=new Quaternion$1);const ne=Z.x*K.x,ie=Z.y*K.y,oe=Z.z*K.z,se=this.x,ae=this.y,ge=this.z,ce=this.w,de=_*.5;return te.x+=de*(ne*ce+ie*ge-oe*ae),te.y+=de*(ie*ce+oe*se-ne*ge),te.z+=de*(oe*ce+ne*ae-ie*se),te.w+=de*(-ne*se-ie*ae-oe*ge),te}}const sfv_t1$1=new Vec3$1,sfv_t2$1=new Vec3$1,SHAPE_TYPES$1={SPHERE:1,PLANE:2,BOX:4,COMPOUND:8,CONVEXPOLYHEDRON:16,HEIGHTFIELD:32,PARTICLE:64,CYLINDER:128,TRIMESH:256};class Shape$1{constructor(Z){Z===void 0&&(Z={}),this.id=Shape$1.idCounter++,this.type=Z.type||0,this.boundingSphereRadius=0,this.collisionResponse=Z.collisionResponse?Z.collisionResponse:!0,this.collisionFilterGroup=Z.collisionFilterGroup!==void 0?Z.collisionFilterGroup:1,this.collisionFilterMask=Z.collisionFilterMask!==void 0?Z.collisionFilterMask:-1,this.material=Z.material?Z.material:null,this.body=null}updateBoundingSphereRadius(){throw`computeBoundingSphereRadius() not implemented for shape type ${this.type}`}volume(){throw`volume() not implemented for shape type ${this.type}`}calculateLocalInertia(Z,_){throw`calculateLocalInertia() not implemented for shape type ${this.type}`}calculateWorldAABB(Z,_,K,te){throw`calculateWorldAABB() not implemented for shape type ${this.type}`}}Shape$1.idCounter=0;Shape$1.types=SHAPE_TYPES$1;class Transform$1{constructor(Z){Z===void 0&&(Z={}),this.position=new Vec3$1,this.quaternion=new Quaternion$1,Z.position&&this.position.copy(Z.position),Z.quaternion&&this.quaternion.copy(Z.quaternion)}pointToLocal(Z,_){return Transform$1.pointToLocalFrame(this.position,this.quaternion,Z,_)}pointToWorld(Z,_){return Transform$1.pointToWorldFrame(this.position,this.quaternion,Z,_)}vectorToWorldFrame(Z,_){return _===void 0&&(_=new Vec3$1),this.quaternion.vmult(Z,_),_}static pointToLocalFrame(Z,_,K,te){return te===void 0&&(te=new Vec3$1),K.vsub(Z,te),_.conjugate(tmpQuat$1$1),tmpQuat$1$1.vmult(te,te),te}static pointToWorldFrame(Z,_,K,te){return te===void 0&&(te=new Vec3$1),_.vmult(K,te),te.vadd(Z,te),te}static vectorToWorldFrame(Z,_,K){return K===void 0&&(K=new Vec3$1),Z.vmult(_,K),K}static vectorToLocalFrame(Z,_,K,te){return te===void 0&&(te=new Vec3$1),_.w*=-1,_.vmult(K,te),_.w*=-1,te}}const tmpQuat$1$1=new Quaternion$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1,new Vec3$1,new Vec3$1,new Vec3$1,new Vec3$1,new Vec3$1,new Vec3$1,new Vec3$1;new Vec3$1;new Quaternion$1;new AABB$1;new Mat3$1;new Mat3$1;new Mat3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Quaternion$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;class RaycastResult$1{constructor(){this.rayFromWorld=new Vec3$1,this.rayToWorld=new Vec3$1,this.hitNormalWorld=new Vec3$1,this.hitPointWorld=new Vec3$1,this.hasHit=!1,this.shape=null,this.body=null,this.hitFaceIndex=-1,this.distance=-1,this.shouldStop=!1}reset(){this.rayFromWorld.setZero(),this.rayToWorld.setZero(),this.hitNormalWorld.setZero(),this.hitPointWorld.setZero(),this.hasHit=!1,this.shape=null,this.body=null,this.hitFaceIndex=-1,this.distance=-1,this.shouldStop=!1}abort(){this.shouldStop=!0}set(Z,_,K,te,ne,ie,oe){this.rayFromWorld.copy(Z),this.rayToWorld.copy(_),this.hitNormalWorld.copy(K),this.hitPointWorld.copy(te),this.shape=ne,this.body=ie,this.distance=oe}}let _Shape$types$SPHERE$1,_Shape$types$PLANE$1,_Shape$types$BOX$1,_Shape$types$CYLINDER$1,_Shape$types$CONVEXPO$1,_Shape$types$HEIGHTFI$1,_Shape$types$TRIMESH$1;const RAY_MODES$1={CLOSEST:1,ANY:2,ALL:4};_Shape$types$SPHERE$1=Shape$1.types.SPHERE;_Shape$types$PLANE$1=Shape$1.types.PLANE;_Shape$types$BOX$1=Shape$1.types.BOX;_Shape$types$CYLINDER$1=Shape$1.types.CYLINDER;_Shape$types$CONVEXPO$1=Shape$1.types.CONVEXPOLYHEDRON;_Shape$types$HEIGHTFI$1=Shape$1.types.HEIGHTFIELD;_Shape$types$TRIMESH$1=Shape$1.types.TRIMESH;class Ray$1{get[_Shape$types$SPHERE$1](){return this._intersectSphere}get[_Shape$types$PLANE$1](){return this._intersectPlane}get[_Shape$types$BOX$1](){return this._intersectBox}get[_Shape$types$CYLINDER$1](){return this._intersectConvex}get[_Shape$types$CONVEXPO$1](){return this._intersectConvex}get[_Shape$types$HEIGHTFI$1](){return this._intersectHeightfield}get[_Shape$types$TRIMESH$1](){return this._intersectTrimesh}constructor(Z,_){Z===void 0&&(Z=new Vec3$1),_===void 0&&(_=new Vec3$1),this.from=Z.clone(),this.to=_.clone(),this.direction=new Vec3$1,this.precision=1e-4,this.checkCollisionResponse=!0,this.skipBackfaces=!1,this.collisionFilterMask=-1,this.collisionFilterGroup=-1,this.mode=Ray$1.ANY,this.result=new RaycastResult$1,this.hasHit=!1,this.callback=K=>{}}intersectWorld(Z,_){return this.mode=_.mode||Ray$1.ANY,this.result=_.result||new RaycastResult$1,this.skipBackfaces=!!_.skipBackfaces,this.collisionFilterMask=typeof _.collisionFilterMask<"u"?_.collisionFilterMask:-1,this.collisionFilterGroup=typeof _.collisionFilterGroup<"u"?_.collisionFilterGroup:-1,this.checkCollisionResponse=typeof _.checkCollisionResponse<"u"?_.checkCollisionResponse:!0,_.from&&this.from.copy(_.from),_.to&&this.to.copy(_.to),this.callback=_.callback||(()=>{}),this.hasHit=!1,this.result.reset(),this.updateDirection(),this.getAABB(tmpAABB$1$1),tmpArray$1.length=0,Z.broadphase.aabbQuery(Z,tmpAABB$1$1,tmpArray$1),this.intersectBodies(tmpArray$1),this.hasHit}intersectBody(Z,_){_&&(this.result=_,this.updateDirection());const K=this.checkCollisionResponse;if(K&&!Z.collisionResponse||!(this.collisionFilterGroup&Z.collisionFilterMask)||!(Z.collisionFilterGroup&this.collisionFilterMask))return;const te=intersectBody_xi$1,ne=intersectBody_qi$1;for(let ie=0,oe=Z.shapes.length;ie<oe;ie++){const se=Z.shapes[ie];if(!(K&&!se.collisionResponse)&&(Z.quaternion.mult(Z.shapeOrientations[ie],ne),Z.quaternion.vmult(Z.shapeOffsets[ie],te),te.vadd(Z.position,te),this.intersectShape(se,ne,te,Z),this.result.shouldStop))break}}intersectBodies(Z,_){_&&(this.result=_,this.updateDirection());for(let K=0,te=Z.length;!this.result.shouldStop&&K<te;K++)this.intersectBody(Z[K])}updateDirection(){this.to.vsub(this.from,this.direction),this.direction.normalize()}intersectShape(Z,_,K,te){const ne=this.from;if(distanceFromIntersection$1(ne,this.direction,K)>Z.boundingSphereRadius)return;const oe=this[Z.type];oe&&oe.call(this,Z,_,K,te,Z)}_intersectBox(Z,_,K,te,ne){return this._intersectConvex(Z.convexPolyhedronRepresentation,_,K,te,ne)}_intersectPlane(Z,_,K,te,ne){const ie=this.from,oe=this.to,se=this.direction,ae=new Vec3$1(0,0,1);_.vmult(ae,ae);const ge=new Vec3$1;ie.vsub(K,ge);const ce=ge.dot(ae);oe.vsub(K,ge);const de=ge.dot(ae);if(ce*de>0||ie.distanceTo(oe)<ce)return;const Ie=ae.dot(se);if(Math.abs(Ie)<this.precision)return;const fe=new Vec3$1,be=new Vec3$1,Ae=new Vec3$1;ie.vsub(K,fe);const ye=-ae.dot(fe)/Ie;se.scale(ye,be),ie.vadd(be,Ae),this.reportIntersection(ae,Ae,ne,te,-1)}getAABB(Z){const{lowerBound:_,upperBound:K}=Z,te=this.to,ne=this.from;_.x=Math.min(te.x,ne.x),_.y=Math.min(te.y,ne.y),_.z=Math.min(te.z,ne.z),K.x=Math.max(te.x,ne.x),K.y=Math.max(te.y,ne.y),K.z=Math.max(te.z,ne.z)}_intersectHeightfield(Z,_,K,te,ne){Z.data,Z.elementSize;const ie=intersectHeightfield_localRay$1;ie.from.copy(this.from),ie.to.copy(this.to),Transform$1.pointToLocalFrame(K,_,ie.from,ie.from),Transform$1.pointToLocalFrame(K,_,ie.to,ie.to),ie.updateDirection();const oe=intersectHeightfield_index$1;let se,ae,ge,ce;se=ae=0,ge=ce=Z.data.length-1;const de=new AABB$1;ie.getAABB(de),Z.getIndexOfPosition(de.lowerBound.x,de.lowerBound.y,oe,!0),se=Math.max(se,oe[0]),ae=Math.max(ae,oe[1]),Z.getIndexOfPosition(de.upperBound.x,de.upperBound.y,oe,!0),ge=Math.min(ge,oe[0]+1),ce=Math.min(ce,oe[1]+1);for(let Ie=se;Ie<ge;Ie++)for(let fe=ae;fe<ce;fe++){if(this.result.shouldStop)return;if(Z.getAabbAtIndex(Ie,fe,de),!!de.overlapsRay(ie)){if(Z.getConvexTrianglePillar(Ie,fe,!1),Transform$1.pointToWorldFrame(K,_,Z.pillarOffset,worldPillarOffset$1),this._intersectConvex(Z.pillarConvex,_,worldPillarOffset$1,te,ne,intersectConvexOptions$1),this.result.shouldStop)return;Z.getConvexTrianglePillar(Ie,fe,!0),Transform$1.pointToWorldFrame(K,_,Z.pillarOffset,worldPillarOffset$1),this._intersectConvex(Z.pillarConvex,_,worldPillarOffset$1,te,ne,intersectConvexOptions$1)}}}_intersectSphere(Z,_,K,te,ne){const ie=this.from,oe=this.to,se=Z.radius,ae=(oe.x-ie.x)**2+(oe.y-ie.y)**2+(oe.z-ie.z)**2,ge=2*((oe.x-ie.x)*(ie.x-K.x)+(oe.y-ie.y)*(ie.y-K.y)+(oe.z-ie.z)*(ie.z-K.z)),ce=(ie.x-K.x)**2+(ie.y-K.y)**2+(ie.z-K.z)**2-se**2,de=ge**2-4*ae*ce,Ie=Ray_intersectSphere_intersectionPoint$1,fe=Ray_intersectSphere_normal$1;if(!(de<0))if(de===0)ie.lerp(oe,de,Ie),Ie.vsub(K,fe),fe.normalize(),this.reportIntersection(fe,Ie,ne,te,-1);else{const be=(-ge-Math.sqrt(de))/(2*ae),Ae=(-ge+Math.sqrt(de))/(2*ae);if(be>=0&&be<=1&&(ie.lerp(oe,be,Ie),Ie.vsub(K,fe),fe.normalize(),this.reportIntersection(fe,Ie,ne,te,-1)),this.result.shouldStop)return;Ae>=0&&Ae<=1&&(ie.lerp(oe,Ae,Ie),Ie.vsub(K,fe),fe.normalize(),this.reportIntersection(fe,Ie,ne,te,-1))}}_intersectConvex(Z,_,K,te,ne,ie){const oe=intersectConvex_normal$1,se=intersectConvex_vector$1,ae=ie&&ie.faceList||null,ge=Z.faces,ce=Z.vertices,de=Z.faceNormals,Ie=this.direction,fe=this.from,be=this.to,Ae=fe.distanceTo(be),ye=ae?ae.length:ge.length,ve=this.result;for(let Be=0;!ve.shouldStop&&Be<ye;Be++){const Re=ae?ae[Be]:Be,Ve=ge[Re],Ee=de[Re],Ze=_,_e=K;se.copy(ce[Ve[0]]),Ze.vmult(se,se),se.vadd(_e,se),se.vsub(fe,se),Ze.vmult(Ee,oe);const Fe=Ie.dot(oe);if(Math.abs(Fe)<this.precision)continue;const Te=oe.dot(se)/Fe;if(!(Te<0)){Ie.scale(Te,intersectPoint$1),intersectPoint$1.vadd(fe,intersectPoint$1),a$1.copy(ce[Ve[0]]),Ze.vmult(a$1,a$1),_e.vadd(a$1,a$1);for(let ke=1;!ve.shouldStop&&ke<Ve.length-1;ke++){b$1.copy(ce[Ve[ke]]),c$1.copy(ce[Ve[ke+1]]),Ze.vmult(b$1,b$1),Ze.vmult(c$1,c$1),_e.vadd(b$1,b$1),_e.vadd(c$1,c$1);const Le=intersectPoint$1.distanceTo(fe);!(Ray$1.pointInTriangle(intersectPoint$1,a$1,b$1,c$1)||Ray$1.pointInTriangle(intersectPoint$1,b$1,a$1,c$1))||Le>Ae||this.reportIntersection(oe,intersectPoint$1,ne,te,Re)}}}}_intersectTrimesh(Z,_,K,te,ne,ie){const oe=intersectTrimesh_normal$1,se=intersectTrimesh_triangles$1,ae=intersectTrimesh_treeTransform$1,ge=intersectConvex_vector$1,ce=intersectTrimesh_localDirection$1,de=intersectTrimesh_localFrom$1,Ie=intersectTrimesh_localTo$1,fe=intersectTrimesh_worldIntersectPoint$1,be=intersectTrimesh_worldNormal$1,Ae=Z.indices;Z.vertices;const ye=this.from,ve=this.to,Be=this.direction;ae.position.copy(K),ae.quaternion.copy(_),Transform$1.vectorToLocalFrame(K,_,Be,ce),Transform$1.pointToLocalFrame(K,_,ye,de),Transform$1.pointToLocalFrame(K,_,ve,Ie),Ie.x*=Z.scale.x,Ie.y*=Z.scale.y,Ie.z*=Z.scale.z,de.x*=Z.scale.x,de.y*=Z.scale.y,de.z*=Z.scale.z,Ie.vsub(de,ce),ce.normalize();const Re=de.distanceSquared(Ie);Z.tree.rayQuery(this,ae,se);for(let Ve=0,Ee=se.length;!this.result.shouldStop&&Ve!==Ee;Ve++){const Ze=se[Ve];Z.getNormal(Ze,oe),Z.getVertex(Ae[Ze*3],a$1),a$1.vsub(de,ge);const _e=ce.dot(oe),Fe=oe.dot(ge)/_e;if(Fe<0)continue;ce.scale(Fe,intersectPoint$1),intersectPoint$1.vadd(de,intersectPoint$1),Z.getVertex(Ae[Ze*3+1],b$1),Z.getVertex(Ae[Ze*3+2],c$1);const Te=intersectPoint$1.distanceSquared(de);!(Ray$1.pointInTriangle(intersectPoint$1,b$1,a$1,c$1)||Ray$1.pointInTriangle(intersectPoint$1,a$1,b$1,c$1))||Te>Re||(Transform$1.vectorToWorldFrame(_,oe,be),Transform$1.pointToWorldFrame(K,_,intersectPoint$1,fe),this.reportIntersection(be,fe,ne,te,Ze))}se.length=0}reportIntersection(Z,_,K,te,ne){const ie=this.from,oe=this.to,se=ie.distanceTo(_),ae=this.result;if(!(this.skipBackfaces&&Z.dot(this.direction)>0))switch(ae.hitFaceIndex=typeof ne<"u"?ne:-1,this.mode){case Ray$1.ALL:this.hasHit=!0,ae.set(ie,oe,Z,_,K,te,se),ae.hasHit=!0,this.callback(ae);break;case Ray$1.CLOSEST:(se<ae.distance||!ae.hasHit)&&(this.hasHit=!0,ae.hasHit=!0,ae.set(ie,oe,Z,_,K,te,se));break;case Ray$1.ANY:this.hasHit=!0,ae.hasHit=!0,ae.set(ie,oe,Z,_,K,te,se),ae.shouldStop=!0;break}}static pointInTriangle(Z,_,K,te){te.vsub(_,v0$1),K.vsub(_,v1$1),Z.vsub(_,v2$1);const ne=v0$1.dot(v0$1),ie=v0$1.dot(v1$1),oe=v0$1.dot(v2$1),se=v1$1.dot(v1$1),ae=v1$1.dot(v2$1);let ge,ce;return(ge=se*oe-ie*ae)>=0&&(ce=ne*ae-ie*oe)>=0&&ge+ce<ne*se-ie*ie}}Ray$1.CLOSEST=RAY_MODES$1.CLOSEST;Ray$1.ANY=RAY_MODES$1.ANY;Ray$1.ALL=RAY_MODES$1.ALL;const tmpAABB$1$1=new AABB$1,tmpArray$1=[],v1$1=new Vec3$1,v2$1=new Vec3$1,intersectBody_xi$1=new Vec3$1,intersectBody_qi$1=new Quaternion$1,intersectPoint$1=new Vec3$1,a$1=new Vec3$1,b$1=new Vec3$1,c$1=new Vec3$1;new Vec3$1;new RaycastResult$1;const intersectConvexOptions$1={faceList:[0]},worldPillarOffset$1=new Vec3$1,intersectHeightfield_localRay$1=new Ray$1,intersectHeightfield_index$1=[],Ray_intersectSphere_intersectionPoint$1=new Vec3$1,Ray_intersectSphere_normal$1=new Vec3$1,intersectConvex_normal$1=new Vec3$1;new Vec3$1;new Vec3$1;const intersectConvex_vector$1=new Vec3$1,intersectTrimesh_normal$1=new Vec3$1,intersectTrimesh_localDirection$1=new Vec3$1,intersectTrimesh_localFrom$1=new Vec3$1,intersectTrimesh_localTo$1=new Vec3$1,intersectTrimesh_worldNormal$1=new Vec3$1,intersectTrimesh_worldIntersectPoint$1=new Vec3$1;new AABB$1;const intersectTrimesh_triangles$1=[],intersectTrimesh_treeTransform$1=new Transform$1,v0$1=new Vec3$1,intersect$1=new Vec3$1;function distanceFromIntersection$1(X,Z,_){_.vsub(X,v0$1);const K=v0$1.dot(Z);return Z.scale(K,intersect$1),intersect$1.vadd(X,intersect$1),_.distanceTo(intersect$1)}new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Ray$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1(1,0,0),new Vec3$1(0,1,0),new Vec3$1(0,0,1);new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new AABB$1;new Vec3$1;new AABB$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new AABB$1;new Vec3$1;new Transform$1;new AABB$1;Shape$1.types.SPHERE,Shape$1.types.SPHERE|Shape$1.types.PLANE,Shape$1.types.BOX|Shape$1.types.BOX,Shape$1.types.SPHERE|Shape$1.types.BOX,Shape$1.types.PLANE|Shape$1.types.BOX,Shape$1.types.CONVEXPOLYHEDRON,Shape$1.types.SPHERE|Shape$1.types.CONVEXPOLYHEDRON,Shape$1.types.PLANE|Shape$1.types.CONVEXPOLYHEDRON,Shape$1.types.BOX|Shape$1.types.CONVEXPOLYHEDRON,Shape$1.types.SPHERE|Shape$1.types.HEIGHTFIELD,Shape$1.types.BOX|Shape$1.types.HEIGHTFIELD,Shape$1.types.CONVEXPOLYHEDRON|Shape$1.types.HEIGHTFIELD,Shape$1.types.PARTICLE|Shape$1.types.SPHERE,Shape$1.types.PLANE|Shape$1.types.PARTICLE,Shape$1.types.BOX|Shape$1.types.PARTICLE,Shape$1.types.PARTICLE|Shape$1.types.CONVEXPOLYHEDRON,Shape$1.types.CYLINDER,Shape$1.types.SPHERE|Shape$1.types.CYLINDER,Shape$1.types.PLANE|Shape$1.types.CYLINDER,Shape$1.types.BOX|Shape$1.types.CYLINDER,Shape$1.types.CONVEXPOLYHEDRON|Shape$1.types.CYLINDER,Shape$1.types.HEIGHTFIELD|Shape$1.types.CYLINDER,Shape$1.types.PARTICLE|Shape$1.types.CYLINDER,Shape$1.types.SPHERE|Shape$1.types.TRIMESH,Shape$1.types.PLANE|Shape$1.types.TRIMESH;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Quaternion$1;new Quaternion$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new AABB$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1,new Vec3$1,new Vec3$1,new Vec3$1,new Vec3$1,new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Quaternion$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new AABB$1;new Ray$1;const performance$1=globalThis.performance||{};if(!performance$1.now){let X=Date.now();performance$1.timing&&performance$1.timing.navigationStart&&(X=performance$1.timing.navigationStart),performance$1.now=()=>Date.now()-X}new Vec3$1;class Mat3{constructor(Z){Z===void 0&&(Z=[0,0,0,0,0,0,0,0,0]),this.elements=Z}identity(){const Z=this.elements;Z[0]=1,Z[1]=0,Z[2]=0,Z[3]=0,Z[4]=1,Z[5]=0,Z[6]=0,Z[7]=0,Z[8]=1}setZero(){const Z=this.elements;Z[0]=0,Z[1]=0,Z[2]=0,Z[3]=0,Z[4]=0,Z[5]=0,Z[6]=0,Z[7]=0,Z[8]=0}setTrace(Z){const _=this.elements;_[0]=Z.x,_[4]=Z.y,_[8]=Z.z}getTrace(Z){Z===void 0&&(Z=new Vec3);const _=this.elements;return Z.x=_[0],Z.y=_[4],Z.z=_[8],Z}vmult(Z,_){_===void 0&&(_=new Vec3);const K=this.elements,te=Z.x,ne=Z.y,ie=Z.z;return _.x=K[0]*te+K[1]*ne+K[2]*ie,_.y=K[3]*te+K[4]*ne+K[5]*ie,_.z=K[6]*te+K[7]*ne+K[8]*ie,_}smult(Z){for(let _=0;_<this.elements.length;_++)this.elements[_]*=Z}mmult(Z,_){_===void 0&&(_=new Mat3);const K=this.elements,te=Z.elements,ne=_.elements,ie=K[0],oe=K[1],se=K[2],ae=K[3],ge=K[4],ce=K[5],de=K[6],Ie=K[7],fe=K[8],be=te[0],Ae=te[1],ye=te[2],ve=te[3],Be=te[4],Re=te[5],Ve=te[6],Ee=te[7],Ze=te[8];return ne[0]=ie*be+oe*ve+se*Ve,ne[1]=ie*Ae+oe*Be+se*Ee,ne[2]=ie*ye+oe*Re+se*Ze,ne[3]=ae*be+ge*ve+ce*Ve,ne[4]=ae*Ae+ge*Be+ce*Ee,ne[5]=ae*ye+ge*Re+ce*Ze,ne[6]=de*be+Ie*ve+fe*Ve,ne[7]=de*Ae+Ie*Be+fe*Ee,ne[8]=de*ye+Ie*Re+fe*Ze,_}scale(Z,_){_===void 0&&(_=new Mat3);const K=this.elements,te=_.elements;for(let ne=0;ne!==3;ne++)te[3*ne+0]=Z.x*K[3*ne+0],te[3*ne+1]=Z.y*K[3*ne+1],te[3*ne+2]=Z.z*K[3*ne+2];return _}solve(Z,_){_===void 0&&(_=new Vec3);const K=3,te=4,ne=[];let ie,oe;for(ie=0;ie<K*te;ie++)ne.push(0);for(ie=0;ie<3;ie++)for(oe=0;oe<3;oe++)ne[ie+te*oe]=this.elements[ie+3*oe];ne[3+4*0]=Z.x,ne[3+4*1]=Z.y,ne[3+4*2]=Z.z;let se=3;const ae=se;let ge;const ce=4;let de;do{if(ie=ae-se,ne[ie+te*ie]===0){for(oe=ie+1;oe<ae;oe++)if(ne[ie+te*oe]!==0){ge=ce;do de=ce-ge,ne[de+te*ie]+=ne[de+te*oe];while(--ge);break}}if(ne[ie+te*ie]!==0)for(oe=ie+1;oe<ae;oe++){const Ie=ne[ie+te*oe]/ne[ie+te*ie];ge=ce;do de=ce-ge,ne[de+te*oe]=de<=ie?0:ne[de+te*oe]-ne[de+te*ie]*Ie;while(--ge)}}while(--se);if(_.z=ne[2*te+3]/ne[2*te+2],_.y=(ne[1*te+3]-ne[1*te+2]*_.z)/ne[1*te+1],_.x=(ne[0*te+3]-ne[0*te+2]*_.z-ne[0*te+1]*_.y)/ne[0*te+0],isNaN(_.x)||isNaN(_.y)||isNaN(_.z)||_.x===1/0||_.y===1/0||_.z===1/0)throw`Could not solve equation! Got x=[${_.toString()}], b=[${Z.toString()}], A=[${this.toString()}]`;return _}e(Z,_,K){if(K===void 0)return this.elements[_+3*Z];this.elements[_+3*Z]=K}copy(Z){for(let _=0;_<Z.elements.length;_++)this.elements[_]=Z.elements[_];return this}toString(){let Z="";const _=",";for(let K=0;K<9;K++)Z+=this.elements[K]+_;return Z}reverse(Z){Z===void 0&&(Z=new Mat3);const _=3,K=6,te=reverse_eqns;let ne,ie;for(ne=0;ne<3;ne++)for(ie=0;ie<3;ie++)te[ne+K*ie]=this.elements[ne+3*ie];te[3+6*0]=1,te[3+6*1]=0,te[3+6*2]=0,te[4+6*0]=0,te[4+6*1]=1,te[4+6*2]=0,te[5+6*0]=0,te[5+6*1]=0,te[5+6*2]=1;let oe=3;const se=oe;let ae;const ge=K;let ce;do{if(ne=se-oe,te[ne+K*ne]===0){for(ie=ne+1;ie<se;ie++)if(te[ne+K*ie]!==0){ae=ge;do ce=ge-ae,te[ce+K*ne]+=te[ce+K*ie];while(--ae);break}}if(te[ne+K*ne]!==0)for(ie=ne+1;ie<se;ie++){const de=te[ne+K*ie]/te[ne+K*ne];ae=ge;do ce=ge-ae,te[ce+K*ie]=ce<=ne?0:te[ce+K*ie]-te[ce+K*ne]*de;while(--ae)}}while(--oe);ne=2;do{ie=ne-1;do{const de=te[ne+K*ie]/te[ne+K*ne];ae=K;do ce=K-ae,te[ce+K*ie]=te[ce+K*ie]-te[ce+K*ne]*de;while(--ae)}while(ie--)}while(--ne);ne=2;do{const de=1/te[ne+K*ne];ae=K;do ce=K-ae,te[ce+K*ne]=te[ce+K*ne]*de;while(--ae)}while(ne--);ne=2;do{ie=2;do{if(ce=te[_+ie+K*ne],isNaN(ce)||ce===1/0)throw`Could not reverse! A=[${this.toString()}]`;Z.e(ne,ie,ce)}while(ie--)}while(ne--);return Z}setRotationFromQuaternion(Z){const _=Z.x,K=Z.y,te=Z.z,ne=Z.w,ie=_+_,oe=K+K,se=te+te,ae=_*ie,ge=_*oe,ce=_*se,de=K*oe,Ie=K*se,fe=te*se,be=ne*ie,Ae=ne*oe,ye=ne*se,ve=this.elements;return ve[3*0+0]=1-(de+fe),ve[3*0+1]=ge-ye,ve[3*0+2]=ce+Ae,ve[3*1+0]=ge+ye,ve[3*1+1]=1-(ae+fe),ve[3*1+2]=Ie-be,ve[3*2+0]=ce-Ae,ve[3*2+1]=Ie+be,ve[3*2+2]=1-(ae+de),this}transpose(Z){Z===void 0&&(Z=new Mat3);const _=this.elements,K=Z.elements;let te;return K[0]=_[0],K[4]=_[4],K[8]=_[8],te=_[1],K[1]=_[3],K[3]=te,te=_[2],K[2]=_[6],K[6]=te,te=_[5],K[5]=_[7],K[7]=te,Z}}const reverse_eqns=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];class Vec3{constructor(Z,_,K){Z===void 0&&(Z=0),_===void 0&&(_=0),K===void 0&&(K=0),this.x=Z,this.y=_,this.z=K}cross(Z,_){_===void 0&&(_=new Vec3);const K=Z.x,te=Z.y,ne=Z.z,ie=this.x,oe=this.y,se=this.z;return _.x=oe*ne-se*te,_.y=se*K-ie*ne,_.z=ie*te-oe*K,_}set(Z,_,K){return this.x=Z,this.y=_,this.z=K,this}setZero(){this.x=this.y=this.z=0}vadd(Z,_){if(_)_.x=Z.x+this.x,_.y=Z.y+this.y,_.z=Z.z+this.z;else return new Vec3(this.x+Z.x,this.y+Z.y,this.z+Z.z)}vsub(Z,_){if(_)_.x=this.x-Z.x,_.y=this.y-Z.y,_.z=this.z-Z.z;else return new Vec3(this.x-Z.x,this.y-Z.y,this.z-Z.z)}crossmat(){return new Mat3([0,-this.z,this.y,this.z,0,-this.x,-this.y,this.x,0])}normalize(){const Z=this.x,_=this.y,K=this.z,te=Math.sqrt(Z*Z+_*_+K*K);if(te>0){const ne=1/te;this.x*=ne,this.y*=ne,this.z*=ne}else this.x=0,this.y=0,this.z=0;return te}unit(Z){Z===void 0&&(Z=new Vec3);const _=this.x,K=this.y,te=this.z;let ne=Math.sqrt(_*_+K*K+te*te);return ne>0?(ne=1/ne,Z.x=_*ne,Z.y=K*ne,Z.z=te*ne):(Z.x=1,Z.y=0,Z.z=0),Z}length(){const Z=this.x,_=this.y,K=this.z;return Math.sqrt(Z*Z+_*_+K*K)}lengthSquared(){return this.dot(this)}distanceTo(Z){const _=this.x,K=this.y,te=this.z,ne=Z.x,ie=Z.y,oe=Z.z;return Math.sqrt((ne-_)*(ne-_)+(ie-K)*(ie-K)+(oe-te)*(oe-te))}distanceSquared(Z){const _=this.x,K=this.y,te=this.z,ne=Z.x,ie=Z.y,oe=Z.z;return(ne-_)*(ne-_)+(ie-K)*(ie-K)+(oe-te)*(oe-te)}scale(Z,_){_===void 0&&(_=new Vec3);const K=this.x,te=this.y,ne=this.z;return _.x=Z*K,_.y=Z*te,_.z=Z*ne,_}vmul(Z,_){return _===void 0&&(_=new Vec3),_.x=Z.x*this.x,_.y=Z.y*this.y,_.z=Z.z*this.z,_}addScaledVector(Z,_,K){return K===void 0&&(K=new Vec3),K.x=this.x+Z*_.x,K.y=this.y+Z*_.y,K.z=this.z+Z*_.z,K}dot(Z){return this.x*Z.x+this.y*Z.y+this.z*Z.z}isZero(){return this.x===0&&this.y===0&&this.z===0}negate(Z){return Z===void 0&&(Z=new Vec3),Z.x=-this.x,Z.y=-this.y,Z.z=-this.z,Z}tangents(Z,_){const K=this.length();if(K>0){const te=Vec3_tangents_n,ne=1/K;te.set(this.x*ne,this.y*ne,this.z*ne);const ie=Vec3_tangents_randVec;Math.abs(te.x)<.9?(ie.set(1,0,0),te.cross(ie,Z)):(ie.set(0,1,0),te.cross(ie,Z)),te.cross(Z,_)}else Z.set(1,0,0),_.set(0,1,0)}toString(){return`${this.x},${this.y},${this.z}`}toArray(){return[this.x,this.y,this.z]}copy(Z){return this.x=Z.x,this.y=Z.y,this.z=Z.z,this}lerp(Z,_,K){const te=this.x,ne=this.y,ie=this.z;K.x=te+(Z.x-te)*_,K.y=ne+(Z.y-ne)*_,K.z=ie+(Z.z-ie)*_}almostEquals(Z,_){return _===void 0&&(_=1e-6),!(Math.abs(this.x-Z.x)>_||Math.abs(this.y-Z.y)>_||Math.abs(this.z-Z.z)>_)}almostZero(Z){return Z===void 0&&(Z=1e-6),!(Math.abs(this.x)>Z||Math.abs(this.y)>Z||Math.abs(this.z)>Z)}isAntiparallelTo(Z,_){return this.negate(antip_neg),antip_neg.almostEquals(Z,_)}clone(){return new Vec3(this.x,this.y,this.z)}}Vec3.ZERO=new Vec3(0,0,0);Vec3.UNIT_X=new Vec3(1,0,0);Vec3.UNIT_Y=new Vec3(0,1,0);Vec3.UNIT_Z=new Vec3(0,0,1);const Vec3_tangents_n=new Vec3,Vec3_tangents_randVec=new Vec3,antip_neg=new Vec3;class AABB{constructor(Z){Z===void 0&&(Z={}),this.lowerBound=new Vec3,this.upperBound=new Vec3,Z.lowerBound&&this.lowerBound.copy(Z.lowerBound),Z.upperBound&&this.upperBound.copy(Z.upperBound)}setFromPoints(Z,_,K,te){const ne=this.lowerBound,ie=this.upperBound,oe=K;ne.copy(Z[0]),oe&&oe.vmult(ne,ne),ie.copy(ne);for(let se=1;se<Z.length;se++){let ae=Z[se];oe&&(oe.vmult(ae,tmp$1),ae=tmp$1),ae.x>ie.x&&(ie.x=ae.x),ae.x<ne.x&&(ne.x=ae.x),ae.y>ie.y&&(ie.y=ae.y),ae.y<ne.y&&(ne.y=ae.y),ae.z>ie.z&&(ie.z=ae.z),ae.z<ne.z&&(ne.z=ae.z)}return _&&(_.vadd(ne,ne),_.vadd(ie,ie)),te&&(ne.x-=te,ne.y-=te,ne.z-=te,ie.x+=te,ie.y+=te,ie.z+=te),this}copy(Z){return this.lowerBound.copy(Z.lowerBound),this.upperBound.copy(Z.upperBound),this}clone(){return new AABB().copy(this)}extend(Z){this.lowerBound.x=Math.min(this.lowerBound.x,Z.lowerBound.x),this.upperBound.x=Math.max(this.upperBound.x,Z.upperBound.x),this.lowerBound.y=Math.min(this.lowerBound.y,Z.lowerBound.y),this.upperBound.y=Math.max(this.upperBound.y,Z.upperBound.y),this.lowerBound.z=Math.min(this.lowerBound.z,Z.lowerBound.z),this.upperBound.z=Math.max(this.upperBound.z,Z.upperBound.z)}overlaps(Z){const _=this.lowerBound,K=this.upperBound,te=Z.lowerBound,ne=Z.upperBound,ie=te.x<=K.x&&K.x<=ne.x||_.x<=ne.x&&ne.x<=K.x,oe=te.y<=K.y&&K.y<=ne.y||_.y<=ne.y&&ne.y<=K.y,se=te.z<=K.z&&K.z<=ne.z||_.z<=ne.z&&ne.z<=K.z;return ie&&oe&&se}volume(){const Z=this.lowerBound,_=this.upperBound;return(_.x-Z.x)*(_.y-Z.y)*(_.z-Z.z)}contains(Z){const _=this.lowerBound,K=this.upperBound,te=Z.lowerBound,ne=Z.upperBound;return _.x<=te.x&&K.x>=ne.x&&_.y<=te.y&&K.y>=ne.y&&_.z<=te.z&&K.z>=ne.z}getCorners(Z,_,K,te,ne,ie,oe,se){const ae=this.lowerBound,ge=this.upperBound;Z.copy(ae),_.set(ge.x,ae.y,ae.z),K.set(ge.x,ge.y,ae.z),te.set(ae.x,ge.y,ge.z),ne.set(ge.x,ae.y,ge.z),ie.set(ae.x,ge.y,ae.z),oe.set(ae.x,ae.y,ge.z),se.copy(ge)}toLocalFrame(Z,_){const K=transformIntoFrame_corners,te=K[0],ne=K[1],ie=K[2],oe=K[3],se=K[4],ae=K[5],ge=K[6],ce=K[7];this.getCorners(te,ne,ie,oe,se,ae,ge,ce);for(let de=0;de!==8;de++){const Ie=K[de];Z.pointToLocal(Ie,Ie)}return _.setFromPoints(K)}toWorldFrame(Z,_){const K=transformIntoFrame_corners,te=K[0],ne=K[1],ie=K[2],oe=K[3],se=K[4],ae=K[5],ge=K[6],ce=K[7];this.getCorners(te,ne,ie,oe,se,ae,ge,ce);for(let de=0;de!==8;de++){const Ie=K[de];Z.pointToWorld(Ie,Ie)}return _.setFromPoints(K)}overlapsRay(Z){const{direction:_,from:K}=Z,te=1/_.x,ne=1/_.y,ie=1/_.z,oe=(this.lowerBound.x-K.x)*te,se=(this.upperBound.x-K.x)*te,ae=(this.lowerBound.y-K.y)*ne,ge=(this.upperBound.y-K.y)*ne,ce=(this.lowerBound.z-K.z)*ie,de=(this.upperBound.z-K.z)*ie,Ie=Math.max(Math.max(Math.min(oe,se),Math.min(ae,ge)),Math.min(ce,de)),fe=Math.min(Math.min(Math.max(oe,se),Math.max(ae,ge)),Math.max(ce,de));return!(fe<0||Ie>fe)}}const tmp$1=new Vec3,transformIntoFrame_corners=[new Vec3,new Vec3,new Vec3,new Vec3,new Vec3,new Vec3,new Vec3,new Vec3];class Quaternion{constructor(Z,_,K,te){Z===void 0&&(Z=0),_===void 0&&(_=0),K===void 0&&(K=0),te===void 0&&(te=1),this.x=Z,this.y=_,this.z=K,this.w=te}set(Z,_,K,te){return this.x=Z,this.y=_,this.z=K,this.w=te,this}toString(){return`${this.x},${this.y},${this.z},${this.w}`}toArray(){return[this.x,this.y,this.z,this.w]}setFromAxisAngle(Z,_){const K=Math.sin(_*.5);return this.x=Z.x*K,this.y=Z.y*K,this.z=Z.z*K,this.w=Math.cos(_*.5),this}toAxisAngle(Z){Z===void 0&&(Z=new Vec3),this.normalize();const _=2*Math.acos(this.w),K=Math.sqrt(1-this.w*this.w);return K<.001?(Z.x=this.x,Z.y=this.y,Z.z=this.z):(Z.x=this.x/K,Z.y=this.y/K,Z.z=this.z/K),[Z,_]}setFromVectors(Z,_){if(Z.isAntiparallelTo(_)){const K=sfv_t1,te=sfv_t2;Z.tangents(K,te),this.setFromAxisAngle(K,Math.PI)}else{const K=Z.cross(_);this.x=K.x,this.y=K.y,this.z=K.z,this.w=Math.sqrt(Z.length()**2*_.length()**2)+Z.dot(_),this.normalize()}return this}mult(Z,_){_===void 0&&(_=new Quaternion);const K=this.x,te=this.y,ne=this.z,ie=this.w,oe=Z.x,se=Z.y,ae=Z.z,ge=Z.w;return _.x=K*ge+ie*oe+te*ae-ne*se,_.y=te*ge+ie*se+ne*oe-K*ae,_.z=ne*ge+ie*ae+K*se-te*oe,_.w=ie*ge-K*oe-te*se-ne*ae,_}inverse(Z){Z===void 0&&(Z=new Quaternion);const _=this.x,K=this.y,te=this.z,ne=this.w;this.conjugate(Z);const ie=1/(_*_+K*K+te*te+ne*ne);return Z.x*=ie,Z.y*=ie,Z.z*=ie,Z.w*=ie,Z}conjugate(Z){return Z===void 0&&(Z=new Quaternion),Z.x=-this.x,Z.y=-this.y,Z.z=-this.z,Z.w=this.w,Z}normalize(){let Z=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);return Z===0?(this.x=0,this.y=0,this.z=0,this.w=0):(Z=1/Z,this.x*=Z,this.y*=Z,this.z*=Z,this.w*=Z),this}normalizeFast(){const Z=(3-(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w))/2;return Z===0?(this.x=0,this.y=0,this.z=0,this.w=0):(this.x*=Z,this.y*=Z,this.z*=Z,this.w*=Z),this}vmult(Z,_){_===void 0&&(_=new Vec3);const K=Z.x,te=Z.y,ne=Z.z,ie=this.x,oe=this.y,se=this.z,ae=this.w,ge=ae*K+oe*ne-se*te,ce=ae*te+se*K-ie*ne,de=ae*ne+ie*te-oe*K,Ie=-ie*K-oe*te-se*ne;return _.x=ge*ae+Ie*-ie+ce*-se-de*-oe,_.y=ce*ae+Ie*-oe+de*-ie-ge*-se,_.z=de*ae+Ie*-se+ge*-oe-ce*-ie,_}copy(Z){return this.x=Z.x,this.y=Z.y,this.z=Z.z,this.w=Z.w,this}toEuler(Z,_){_===void 0&&(_="YZX");let K,te,ne;const ie=this.x,oe=this.y,se=this.z,ae=this.w;switch(_){case"YZX":const ge=ie*oe+se*ae;if(ge>.499&&(K=2*Math.atan2(ie,ae),te=Math.PI/2,ne=0),ge<-.499&&(K=-2*Math.atan2(ie,ae),te=-Math.PI/2,ne=0),K===void 0){const ce=ie*ie,de=oe*oe,Ie=se*se;K=Math.atan2(2*oe*ae-2*ie*se,1-2*de-2*Ie),te=Math.asin(2*ge),ne=Math.atan2(2*ie*ae-2*oe*se,1-2*ce-2*Ie)}break;default:throw new Error(`Euler order ${_} not supported yet.`)}Z.y=K,Z.z=te,Z.x=ne}setFromEuler(Z,_,K,te){te===void 0&&(te="XYZ");const ne=Math.cos(Z/2),ie=Math.cos(_/2),oe=Math.cos(K/2),se=Math.sin(Z/2),ae=Math.sin(_/2),ge=Math.sin(K/2);return te==="XYZ"?(this.x=se*ie*oe+ne*ae*ge,this.y=ne*ae*oe-se*ie*ge,this.z=ne*ie*ge+se*ae*oe,this.w=ne*ie*oe-se*ae*ge):te==="YXZ"?(this.x=se*ie*oe+ne*ae*ge,this.y=ne*ae*oe-se*ie*ge,this.z=ne*ie*ge-se*ae*oe,this.w=ne*ie*oe+se*ae*ge):te==="ZXY"?(this.x=se*ie*oe-ne*ae*ge,this.y=ne*ae*oe+se*ie*ge,this.z=ne*ie*ge+se*ae*oe,this.w=ne*ie*oe-se*ae*ge):te==="ZYX"?(this.x=se*ie*oe-ne*ae*ge,this.y=ne*ae*oe+se*ie*ge,this.z=ne*ie*ge-se*ae*oe,this.w=ne*ie*oe+se*ae*ge):te==="YZX"?(this.x=se*ie*oe+ne*ae*ge,this.y=ne*ae*oe+se*ie*ge,this.z=ne*ie*ge-se*ae*oe,this.w=ne*ie*oe-se*ae*ge):te==="XZY"&&(this.x=se*ie*oe-ne*ae*ge,this.y=ne*ae*oe-se*ie*ge,this.z=ne*ie*ge+se*ae*oe,this.w=ne*ie*oe+se*ae*ge),this}clone(){return new Quaternion(this.x,this.y,this.z,this.w)}slerp(Z,_,K){K===void 0&&(K=new Quaternion);const te=this.x,ne=this.y,ie=this.z,oe=this.w;let se=Z.x,ae=Z.y,ge=Z.z,ce=Z.w,de,Ie,fe,be,Ae;return Ie=te*se+ne*ae+ie*ge+oe*ce,Ie<0&&(Ie=-Ie,se=-se,ae=-ae,ge=-ge,ce=-ce),1-Ie>1e-6?(de=Math.acos(Ie),fe=Math.sin(de),be=Math.sin((1-_)*de)/fe,Ae=Math.sin(_*de)/fe):(be=1-_,Ae=_),K.x=be*te+Ae*se,K.y=be*ne+Ae*ae,K.z=be*ie+Ae*ge,K.w=be*oe+Ae*ce,K}integrate(Z,_,K,te){te===void 0&&(te=new Quaternion);const ne=Z.x*K.x,ie=Z.y*K.y,oe=Z.z*K.z,se=this.x,ae=this.y,ge=this.z,ce=this.w,de=_*.5;return te.x+=de*(ne*ce+ie*ge-oe*ae),te.y+=de*(ie*ce+oe*se-ne*ge),te.z+=de*(oe*ce+ne*ae-ie*se),te.w+=de*(-ne*se-ie*ae-oe*ge),te}}const sfv_t1=new Vec3,sfv_t2=new Vec3,SHAPE_TYPES={SPHERE:1,PLANE:2,BOX:4,COMPOUND:8,CONVEXPOLYHEDRON:16,HEIGHTFIELD:32,PARTICLE:64,CYLINDER:128,TRIMESH:256};class Shape{constructor(Z){Z===void 0&&(Z={}),this.id=Shape.idCounter++,this.type=Z.type||0,this.boundingSphereRadius=0,this.collisionResponse=Z.collisionResponse?Z.collisionResponse:!0,this.collisionFilterGroup=Z.collisionFilterGroup!==void 0?Z.collisionFilterGroup:1,this.collisionFilterMask=Z.collisionFilterMask!==void 0?Z.collisionFilterMask:-1,this.material=Z.material?Z.material:null,this.body=null}updateBoundingSphereRadius(){throw`computeBoundingSphereRadius() not implemented for shape type ${this.type}`}volume(){throw`volume() not implemented for shape type ${this.type}`}calculateLocalInertia(Z,_){throw`calculateLocalInertia() not implemented for shape type ${this.type}`}calculateWorldAABB(Z,_,K,te){throw`calculateWorldAABB() not implemented for shape type ${this.type}`}}Shape.idCounter=0;Shape.types=SHAPE_TYPES;class Transform{constructor(Z){Z===void 0&&(Z={}),this.position=new Vec3,this.quaternion=new Quaternion,Z.position&&this.position.copy(Z.position),Z.quaternion&&this.quaternion.copy(Z.quaternion)}pointToLocal(Z,_){return Transform.pointToLocalFrame(this.position,this.quaternion,Z,_)}pointToWorld(Z,_){return Transform.pointToWorldFrame(this.position,this.quaternion,Z,_)}vectorToWorldFrame(Z,_){return _===void 0&&(_=new Vec3),this.quaternion.vmult(Z,_),_}static pointToLocalFrame(Z,_,K,te){return te===void 0&&(te=new Vec3),K.vsub(Z,te),_.conjugate(tmpQuat$1),tmpQuat$1.vmult(te,te),te}static pointToWorldFrame(Z,_,K,te){return te===void 0&&(te=new Vec3),_.vmult(K,te),te.vadd(Z,te),te}static vectorToWorldFrame(Z,_,K){return K===void 0&&(K=new Vec3),Z.vmult(_,K),K}static vectorToLocalFrame(Z,_,K,te){return te===void 0&&(te=new Vec3),_.w*=-1,_.vmult(K,te),_.w*=-1,te}}const tmpQuat$1=new Quaternion;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3,new Vec3,new Vec3,new Vec3,new Vec3,new Vec3,new Vec3,new Vec3;new Vec3;new Quaternion;new AABB;new Mat3;new Mat3;new Mat3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Quaternion;new Vec3;new Vec3;new Vec3;new Vec3;class RaycastResult{constructor(){this.rayFromWorld=new Vec3,this.rayToWorld=new Vec3,this.hitNormalWorld=new Vec3,this.hitPointWorld=new Vec3,this.hasHit=!1,this.shape=null,this.body=null,this.hitFaceIndex=-1,this.distance=-1,this.shouldStop=!1}reset(){this.rayFromWorld.setZero(),this.rayToWorld.setZero(),this.hitNormalWorld.setZero(),this.hitPointWorld.setZero(),this.hasHit=!1,this.shape=null,this.body=null,this.hitFaceIndex=-1,this.distance=-1,this.shouldStop=!1}abort(){this.shouldStop=!0}set(Z,_,K,te,ne,ie,oe){this.rayFromWorld.copy(Z),this.rayToWorld.copy(_),this.hitNormalWorld.copy(K),this.hitPointWorld.copy(te),this.shape=ne,this.body=ie,this.distance=oe}}let _Shape$types$SPHERE,_Shape$types$PLANE,_Shape$types$BOX,_Shape$types$CYLINDER,_Shape$types$CONVEXPO,_Shape$types$HEIGHTFI,_Shape$types$TRIMESH;const RAY_MODES={CLOSEST:1,ANY:2,ALL:4};_Shape$types$SPHERE=Shape.types.SPHERE;_Shape$types$PLANE=Shape.types.PLANE;_Shape$types$BOX=Shape.types.BOX;_Shape$types$CYLINDER=Shape.types.CYLINDER;_Shape$types$CONVEXPO=Shape.types.CONVEXPOLYHEDRON;_Shape$types$HEIGHTFI=Shape.types.HEIGHTFIELD;_Shape$types$TRIMESH=Shape.types.TRIMESH;class Ray{get[_Shape$types$SPHERE](){return this._intersectSphere}get[_Shape$types$PLANE](){return this._intersectPlane}get[_Shape$types$BOX](){return this._intersectBox}get[_Shape$types$CYLINDER](){return this._intersectConvex}get[_Shape$types$CONVEXPO](){return this._intersectConvex}get[_Shape$types$HEIGHTFI](){return this._intersectHeightfield}get[_Shape$types$TRIMESH](){return this._intersectTrimesh}constructor(Z,_){Z===void 0&&(Z=new Vec3),_===void 0&&(_=new Vec3),this.from=Z.clone(),this.to=_.clone(),this.direction=new Vec3,this.precision=1e-4,this.checkCollisionResponse=!0,this.skipBackfaces=!1,this.collisionFilterMask=-1,this.collisionFilterGroup=-1,this.mode=Ray.ANY,this.result=new RaycastResult,this.hasHit=!1,this.callback=K=>{}}intersectWorld(Z,_){return this.mode=_.mode||Ray.ANY,this.result=_.result||new RaycastResult,this.skipBackfaces=!!_.skipBackfaces,this.collisionFilterMask=typeof _.collisionFilterMask<"u"?_.collisionFilterMask:-1,this.collisionFilterGroup=typeof _.collisionFilterGroup<"u"?_.collisionFilterGroup:-1,this.checkCollisionResponse=typeof _.checkCollisionResponse<"u"?_.checkCollisionResponse:!0,_.from&&this.from.copy(_.from),_.to&&this.to.copy(_.to),this.callback=_.callback||(()=>{}),this.hasHit=!1,this.result.reset(),this.updateDirection(),this.getAABB(tmpAABB$1),tmpArray.length=0,Z.broadphase.aabbQuery(Z,tmpAABB$1,tmpArray),this.intersectBodies(tmpArray),this.hasHit}intersectBody(Z,_){_&&(this.result=_,this.updateDirection());const K=this.checkCollisionResponse;if(K&&!Z.collisionResponse||!(this.collisionFilterGroup&Z.collisionFilterMask)||!(Z.collisionFilterGroup&this.collisionFilterMask))return;const te=intersectBody_xi,ne=intersectBody_qi;for(let ie=0,oe=Z.shapes.length;ie<oe;ie++){const se=Z.shapes[ie];if(!(K&&!se.collisionResponse)&&(Z.quaternion.mult(Z.shapeOrientations[ie],ne),Z.quaternion.vmult(Z.shapeOffsets[ie],te),te.vadd(Z.position,te),this.intersectShape(se,ne,te,Z),this.result.shouldStop))break}}intersectBodies(Z,_){_&&(this.result=_,this.updateDirection());for(let K=0,te=Z.length;!this.result.shouldStop&&K<te;K++)this.intersectBody(Z[K])}updateDirection(){this.to.vsub(this.from,this.direction),this.direction.normalize()}intersectShape(Z,_,K,te){const ne=this.from;if(distanceFromIntersection(ne,this.direction,K)>Z.boundingSphereRadius)return;const oe=this[Z.type];oe&&oe.call(this,Z,_,K,te,Z)}_intersectBox(Z,_,K,te,ne){return this._intersectConvex(Z.convexPolyhedronRepresentation,_,K,te,ne)}_intersectPlane(Z,_,K,te,ne){const ie=this.from,oe=this.to,se=this.direction,ae=new Vec3(0,0,1);_.vmult(ae,ae);const ge=new Vec3;ie.vsub(K,ge);const ce=ge.dot(ae);oe.vsub(K,ge);const de=ge.dot(ae);if(ce*de>0||ie.distanceTo(oe)<ce)return;const Ie=ae.dot(se);if(Math.abs(Ie)<this.precision)return;const fe=new Vec3,be=new Vec3,Ae=new Vec3;ie.vsub(K,fe);const ye=-ae.dot(fe)/Ie;se.scale(ye,be),ie.vadd(be,Ae),this.reportIntersection(ae,Ae,ne,te,-1)}getAABB(Z){const{lowerBound:_,upperBound:K}=Z,te=this.to,ne=this.from;_.x=Math.min(te.x,ne.x),_.y=Math.min(te.y,ne.y),_.z=Math.min(te.z,ne.z),K.x=Math.max(te.x,ne.x),K.y=Math.max(te.y,ne.y),K.z=Math.max(te.z,ne.z)}_intersectHeightfield(Z,_,K,te,ne){Z.data,Z.elementSize;const ie=intersectHeightfield_localRay;ie.from.copy(this.from),ie.to.copy(this.to),Transform.pointToLocalFrame(K,_,ie.from,ie.from),Transform.pointToLocalFrame(K,_,ie.to,ie.to),ie.updateDirection();const oe=intersectHeightfield_index;let se,ae,ge,ce;se=ae=0,ge=ce=Z.data.length-1;const de=new AABB;ie.getAABB(de),Z.getIndexOfPosition(de.lowerBound.x,de.lowerBound.y,oe,!0),se=Math.max(se,oe[0]),ae=Math.max(ae,oe[1]),Z.getIndexOfPosition(de.upperBound.x,de.upperBound.y,oe,!0),ge=Math.min(ge,oe[0]+1),ce=Math.min(ce,oe[1]+1);for(let Ie=se;Ie<ge;Ie++)for(let fe=ae;fe<ce;fe++){if(this.result.shouldStop)return;if(Z.getAabbAtIndex(Ie,fe,de),!!de.overlapsRay(ie)){if(Z.getConvexTrianglePillar(Ie,fe,!1),Transform.pointToWorldFrame(K,_,Z.pillarOffset,worldPillarOffset),this._intersectConvex(Z.pillarConvex,_,worldPillarOffset,te,ne,intersectConvexOptions),this.result.shouldStop)return;Z.getConvexTrianglePillar(Ie,fe,!0),Transform.pointToWorldFrame(K,_,Z.pillarOffset,worldPillarOffset),this._intersectConvex(Z.pillarConvex,_,worldPillarOffset,te,ne,intersectConvexOptions)}}}_intersectSphere(Z,_,K,te,ne){const ie=this.from,oe=this.to,se=Z.radius,ae=(oe.x-ie.x)**2+(oe.y-ie.y)**2+(oe.z-ie.z)**2,ge=2*((oe.x-ie.x)*(ie.x-K.x)+(oe.y-ie.y)*(ie.y-K.y)+(oe.z-ie.z)*(ie.z-K.z)),ce=(ie.x-K.x)**2+(ie.y-K.y)**2+(ie.z-K.z)**2-se**2,de=ge**2-4*ae*ce,Ie=Ray_intersectSphere_intersectionPoint,fe=Ray_intersectSphere_normal;if(!(de<0))if(de===0)ie.lerp(oe,de,Ie),Ie.vsub(K,fe),fe.normalize(),this.reportIntersection(fe,Ie,ne,te,-1);else{const be=(-ge-Math.sqrt(de))/(2*ae),Ae=(-ge+Math.sqrt(de))/(2*ae);if(be>=0&&be<=1&&(ie.lerp(oe,be,Ie),Ie.vsub(K,fe),fe.normalize(),this.reportIntersection(fe,Ie,ne,te,-1)),this.result.shouldStop)return;Ae>=0&&Ae<=1&&(ie.lerp(oe,Ae,Ie),Ie.vsub(K,fe),fe.normalize(),this.reportIntersection(fe,Ie,ne,te,-1))}}_intersectConvex(Z,_,K,te,ne,ie){const oe=intersectConvex_normal,se=intersectConvex_vector,ae=ie&&ie.faceList||null,ge=Z.faces,ce=Z.vertices,de=Z.faceNormals,Ie=this.direction,fe=this.from,be=this.to,Ae=fe.distanceTo(be),ye=ae?ae.length:ge.length,ve=this.result;for(let Be=0;!ve.shouldStop&&Be<ye;Be++){const Re=ae?ae[Be]:Be,Ve=ge[Re],Ee=de[Re],Ze=_,_e=K;se.copy(ce[Ve[0]]),Ze.vmult(se,se),se.vadd(_e,se),se.vsub(fe,se),Ze.vmult(Ee,oe);const Fe=Ie.dot(oe);if(Math.abs(Fe)<this.precision)continue;const Te=oe.dot(se)/Fe;if(!(Te<0)){Ie.scale(Te,intersectPoint),intersectPoint.vadd(fe,intersectPoint),a.copy(ce[Ve[0]]),Ze.vmult(a,a),_e.vadd(a,a);for(let ke=1;!ve.shouldStop&&ke<Ve.length-1;ke++){b.copy(ce[Ve[ke]]),c.copy(ce[Ve[ke+1]]),Ze.vmult(b,b),Ze.vmult(c,c),_e.vadd(b,b),_e.vadd(c,c);const Le=intersectPoint.distanceTo(fe);!(Ray.pointInTriangle(intersectPoint,a,b,c)||Ray.pointInTriangle(intersectPoint,b,a,c))||Le>Ae||this.reportIntersection(oe,intersectPoint,ne,te,Re)}}}}_intersectTrimesh(Z,_,K,te,ne,ie){const oe=intersectTrimesh_normal,se=intersectTrimesh_triangles,ae=intersectTrimesh_treeTransform,ge=intersectConvex_vector,ce=intersectTrimesh_localDirection,de=intersectTrimesh_localFrom,Ie=intersectTrimesh_localTo,fe=intersectTrimesh_worldIntersectPoint,be=intersectTrimesh_worldNormal,Ae=Z.indices;Z.vertices;const ye=this.from,ve=this.to,Be=this.direction;ae.position.copy(K),ae.quaternion.copy(_),Transform.vectorToLocalFrame(K,_,Be,ce),Transform.pointToLocalFrame(K,_,ye,de),Transform.pointToLocalFrame(K,_,ve,Ie),Ie.x*=Z.scale.x,Ie.y*=Z.scale.y,Ie.z*=Z.scale.z,de.x*=Z.scale.x,de.y*=Z.scale.y,de.z*=Z.scale.z,Ie.vsub(de,ce),ce.normalize();const Re=de.distanceSquared(Ie);Z.tree.rayQuery(this,ae,se);for(let Ve=0,Ee=se.length;!this.result.shouldStop&&Ve!==Ee;Ve++){const Ze=se[Ve];Z.getNormal(Ze,oe),Z.getVertex(Ae[Ze*3],a),a.vsub(de,ge);const _e=ce.dot(oe),Fe=oe.dot(ge)/_e;if(Fe<0)continue;ce.scale(Fe,intersectPoint),intersectPoint.vadd(de,intersectPoint),Z.getVertex(Ae[Ze*3+1],b),Z.getVertex(Ae[Ze*3+2],c);const Te=intersectPoint.distanceSquared(de);!(Ray.pointInTriangle(intersectPoint,b,a,c)||Ray.pointInTriangle(intersectPoint,a,b,c))||Te>Re||(Transform.vectorToWorldFrame(_,oe,be),Transform.pointToWorldFrame(K,_,intersectPoint,fe),this.reportIntersection(be,fe,ne,te,Ze))}se.length=0}reportIntersection(Z,_,K,te,ne){const ie=this.from,oe=this.to,se=ie.distanceTo(_),ae=this.result;if(!(this.skipBackfaces&&Z.dot(this.direction)>0))switch(ae.hitFaceIndex=typeof ne<"u"?ne:-1,this.mode){case Ray.ALL:this.hasHit=!0,ae.set(ie,oe,Z,_,K,te,se),ae.hasHit=!0,this.callback(ae);break;case Ray.CLOSEST:(se<ae.distance||!ae.hasHit)&&(this.hasHit=!0,ae.hasHit=!0,ae.set(ie,oe,Z,_,K,te,se));break;case Ray.ANY:this.hasHit=!0,ae.hasHit=!0,ae.set(ie,oe,Z,_,K,te,se),ae.shouldStop=!0;break}}static pointInTriangle(Z,_,K,te){te.vsub(_,v0),K.vsub(_,v1),Z.vsub(_,v2);const ne=v0.dot(v0),ie=v0.dot(v1),oe=v0.dot(v2),se=v1.dot(v1),ae=v1.dot(v2);let ge,ce;return(ge=se*oe-ie*ae)>=0&&(ce=ne*ae-ie*oe)>=0&&ge+ce<ne*se-ie*ie}}Ray.CLOSEST=RAY_MODES.CLOSEST;Ray.ANY=RAY_MODES.ANY;Ray.ALL=RAY_MODES.ALL;const tmpAABB$1=new AABB,tmpArray=[],v1=new Vec3,v2=new Vec3,intersectBody_xi=new Vec3,intersectBody_qi=new Quaternion,intersectPoint=new Vec3,a=new Vec3,b=new Vec3,c=new Vec3;new Vec3;new RaycastResult;const intersectConvexOptions={faceList:[0]},worldPillarOffset=new Vec3,intersectHeightfield_localRay=new Ray,intersectHeightfield_index=[],Ray_intersectSphere_intersectionPoint=new Vec3,Ray_intersectSphere_normal=new Vec3,intersectConvex_normal=new Vec3;new Vec3;new Vec3;const intersectConvex_vector=new Vec3,intersectTrimesh_normal=new Vec3,intersectTrimesh_localDirection=new Vec3,intersectTrimesh_localFrom=new Vec3,intersectTrimesh_localTo=new Vec3,intersectTrimesh_worldNormal=new Vec3,intersectTrimesh_worldIntersectPoint=new Vec3;new AABB;const intersectTrimesh_triangles=[],intersectTrimesh_treeTransform=new Transform,v0=new Vec3,intersect=new Vec3;function distanceFromIntersection(X,Z,_){_.vsub(X,v0);const K=v0.dot(Z);return Z.scale(K,intersect),intersect.vadd(X,intersect),_.distanceTo(intersect)}new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Ray;new Vec3;new Vec3;new Vec3;new Vec3(1,0,0),new Vec3(0,1,0),new Vec3(0,0,1);new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new AABB;new Vec3;new AABB;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new AABB;new Vec3;new Transform;new AABB;Shape.types.SPHERE,Shape.types.SPHERE|Shape.types.PLANE,Shape.types.BOX|Shape.types.BOX,Shape.types.SPHERE|Shape.types.BOX,Shape.types.PLANE|Shape.types.BOX,Shape.types.CONVEXPOLYHEDRON,Shape.types.SPHERE|Shape.types.CONVEXPOLYHEDRON,Shape.types.PLANE|Shape.types.CONVEXPOLYHEDRON,Shape.types.BOX|Shape.types.CONVEXPOLYHEDRON,Shape.types.SPHERE|Shape.types.HEIGHTFIELD,Shape.types.BOX|Shape.types.HEIGHTFIELD,Shape.types.CONVEXPOLYHEDRON|Shape.types.HEIGHTFIELD,Shape.types.PARTICLE|Shape.types.SPHERE,Shape.types.PLANE|Shape.types.PARTICLE,Shape.types.BOX|Shape.types.PARTICLE,Shape.types.PARTICLE|Shape.types.CONVEXPOLYHEDRON,Shape.types.CYLINDER,Shape.types.SPHERE|Shape.types.CYLINDER,Shape.types.PLANE|Shape.types.CYLINDER,Shape.types.BOX|Shape.types.CYLINDER,Shape.types.CONVEXPOLYHEDRON|Shape.types.CYLINDER,Shape.types.HEIGHTFIELD|Shape.types.CYLINDER,Shape.types.PARTICLE|Shape.types.CYLINDER,Shape.types.SPHERE|Shape.types.TRIMESH,Shape.types.PLANE|Shape.types.TRIMESH;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Quaternion;new Quaternion;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new AABB;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3,new Vec3,new Vec3,new Vec3,new Vec3,new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Quaternion;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new AABB;new Ray;const performance$2=globalThis.performance||{};if(!performance$2.now){let X=Date.now();performance$2.timing&&performance$2.timing.navigationStart&&(X=performance$2.timing.navigationStart),performance$2.now=()=>Date.now()-X}new Vec3;const debugContext=reactExports.createContext(null),useDebugContext=()=>reactExports.useContext(debugContext),physicsContext=reactExports.createContext(null),usePhysicsContext=()=>{const X=reactExports.useContext(physicsContext);if(!X)throw new Error("Physics context not found. @react-three/cannon & components can only be used within a Physics provider");return X};new Vector3(1,1,1);new Vector3;new Matrix4;const temp=new Object3D;function useForwardedRef(X){const Z=reactExports.useRef(null);return X&&typeof X!="function"?X:Z}function capitalize(X){return X.charAt(0).toUpperCase()+X.slice(1)}function getUUID(X,Z){const _=Z===void 0?"":`/${Z}`;return typeof X=="function"?null:X&&X.current&&`${X.current.uuid}${_}`}const e=new Euler,q$1=new Quaternion$2,quaternionToRotation=X=>Z=>X(e.setFromQuaternion(q$1.fromArray(Z)).toArray());let incrementingId=0;function subscribe(X,Z,_,K,te,ne){return ne===void 0&&(ne="bodies"),ie=>{const oe=incrementingId++;_[oe]={[K]:ie};const se=getUUID(X,te);return se&&Z.subscribe({props:{id:oe,target:ne,type:K},uuid:se}),()=>{delete _[oe],Z.unsubscribe({props:oe})}}}function prepare(X,Z){let{position:_=[0,0,0],rotation:K=[0,0,0],userData:te={}}=Z;X.userData=te,X.position.set(..._),X.rotation.set(...K),X.updateMatrix()}function setupCollision(X,Z,_){let{onCollide:K,onCollideBegin:te,onCollideEnd:ne}=Z;X[_]={collide:K,collideBegin:te,collideEnd:ne}}function useBody(X,Z,_,K,te){K===void 0&&(K=null),te===void 0&&(te=[]);const ne=useForwardedRef(K),{events:ie,refs:oe,scaleOverrides:se,subscriptions:ae,worker:ge}=usePhysicsContext(),ce=useDebugContext();reactExports.useLayoutEffect(()=>{ne.current||(ne.current=new Object3D);const Ie=ne.current,fe=ge,be=Ie instanceof InstancedMesh?(Ie.instanceMatrix.setUsage(DynamicDrawUsage),Ie.count):1,Ae=Ie instanceof InstancedMesh?new Array(be).fill(0).map((ve,Be)=>`${Ie.uuid}/${Be}`):[Ie.uuid],ye=Ie instanceof InstancedMesh?Ae.map((ve,Be)=>{const Re=Z(Be);return prepare(temp,Re),Ie.setMatrixAt(Be,temp.matrix),Ie.instanceMatrix.needsUpdate=!0,oe[ve]=Ie,ce==null||ce.add(ve,Re,X),setupCollision(ie,Re,ve),{...Re,args:_(Re.args)}}):Ae.map((ve,Be)=>{const Re=Z(Be);return prepare(Ie,Re),oe[ve]=Ie,ce==null||ce.add(ve,Re,X),setupCollision(ie,Re,ve),{...Re,args:_(Re.args)}});return fe.addBodies({props:ye.map(ve=>{let{onCollide:Be,onCollideBegin:Re,onCollideEnd:Ve,...Ee}=ve;return{onCollide:!!Be,...Ee}}),type:X,uuid:Ae}),()=>{Ae.forEach(ve=>{delete oe[ve],ce==null||ce.remove(ve),delete ie[ve]}),fe.removeBodies({uuid:Ae})}},te);const de=reactExports.useMemo(()=>{const Ie=(Be,Re)=>{const Ve=`set${capitalize(Be)}`;return{set:Ee=>{const Ze=getUUID(ne,Re);Ze&&ge[Ve]({props:Ee,uuid:Ze})},subscribe:subscribe(ne,ge,ae,Be,Re)}},fe=Be=>({copy:Ve=>{let{w:Ee,x:Ze,y:_e,z:Fe}=Ve;const Te=getUUID(ne,Be);Te&&ge.setQuaternion({props:[Ze,_e,Fe,Ee],uuid:Te})},set:(Ve,Ee,Ze,_e)=>{const Fe=getUUID(ne,Be);Fe&&ge.setQuaternion({props:[Ve,Ee,Ze,_e],uuid:Fe})},subscribe:subscribe(ne,ge,ae,"quaternion",Be)}),be=Be=>({copy:Re=>{let{x:Ve,y:Ee,z:Ze}=Re;const _e=getUUID(ne,Be);_e&&ge.setRotation({props:[Ve,Ee,Ze],uuid:_e})},set:(Re,Ve,Ee)=>{const Ze=getUUID(ne,Be);Ze&&ge.setRotation({props:[Re,Ve,Ee],uuid:Ze})},subscribe:Re=>{const Ve=incrementingId++,Ee="bodies",Ze="quaternion",_e=getUUID(ne,Be);return ae[Ve]={[Ze]:quaternionToRotation(Re)},_e&&ge.subscribe({props:{id:Ve,target:Ee,type:Ze},uuid:_e}),()=>{delete ae[Ve],ge.unsubscribe({props:Ve})}}}),Ae=(Be,Re)=>{const Ve=`set${capitalize(Be)}`;return{copy:Ee=>{let{x:Ze,y:_e,z:Fe}=Ee;const Te=getUUID(ne,Re);Te&&ge[Ve]({props:[Ze,_e,Fe],uuid:Te})},set:(Ee,Ze,_e)=>{const Fe=getUUID(ne,Re);Fe&&ge[Ve]({props:[Ee,Ze,_e],uuid:Fe})},subscribe:subscribe(ne,ge,ae,Be,Re)}};function ye(Be){return{allowSleep:Ie("allowSleep",Be),angularDamping:Ie("angularDamping",Be),angularFactor:Ae("angularFactor",Be),angularVelocity:Ae("angularVelocity",Be),applyForce(Re,Ve){const Ee=getUUID(ne,Be);Ee&&ge.applyForce({props:[Re,Ve],uuid:Ee})},applyImpulse(Re,Ve){const Ee=getUUID(ne,Be);Ee&&ge.applyImpulse({props:[Re,Ve],uuid:Ee})},applyLocalForce(Re,Ve){const Ee=getUUID(ne,Be);Ee&&ge.applyLocalForce({props:[Re,Ve],uuid:Ee})},applyLocalImpulse(Re,Ve){const Ee=getUUID(ne,Be);Ee&&ge.applyLocalImpulse({props:[Re,Ve],uuid:Ee})},applyTorque(Re){const Ve=getUUID(ne,Be);Ve&&ge.applyTorque({props:[Re],uuid:Ve})},collisionFilterGroup:Ie("collisionFilterGroup",Be),collisionFilterMask:Ie("collisionFilterMask",Be),collisionResponse:Ie("collisionResponse",Be),fixedRotation:Ie("fixedRotation",Be),isTrigger:Ie("isTrigger",Be),linearDamping:Ie("linearDamping",Be),linearFactor:Ae("linearFactor",Be),mass:Ie("mass",Be),material:Ie("material",Be),position:Ae("position",Be),quaternion:fe(Be),rotation:be(Be),scaleOverride(Re){const Ve=getUUID(ne,Be);Ve&&(se[Ve]=new Vector3(...Re))},sleep(){const Re=getUUID(ne,Be);Re&&ge.sleep({uuid:Re})},sleepSpeedLimit:Ie("sleepSpeedLimit",Be),sleepTimeLimit:Ie("sleepTimeLimit",Be),userData:Ie("userData",Be),velocity:Ae("velocity",Be),wakeUp(){const Re=getUUID(ne,Be);Re&&ge.wakeUp({uuid:Re})}}}const ve={};return{...ye(void 0),at:Be=>ve[Be]||(ve[Be]=ye(Be))}},[]);return[ne,de]}function usePlane(X,Z,_){return useBody("Plane",X,()=>[],Z,_)}function useBox(X,Z,_){const K=[1,1,1];return useBody("Box",X,function(te){return te===void 0&&(te=K),te},Z,_)}const v=new Vector3,s=new Vector3(1,1,1),q=new Quaternion$2,m=new Matrix4;function apply(X,Z,_,K,te){return K===void 0&&(K=s),X!==void 0?(m.compose(v.fromArray(Z,X*3),q.fromArray(_,X*4),K),te&&(te.matrixAutoUpdate=!1,te.matrix.copy(m)),m):m.identity()}const unique=()=>{const X=[];return Z=>X.includes(Z)?!1:!!X.push(Z)};function PhysicsProvider(X){let{allowSleep:Z=!1,axisIndex:_=0,broadphase:K="Naive",children:te,defaultContactMaterial:ne={contactEquationStiffness:1e6},frictionGravity:ie=null,gravity:oe=[0,-9.81,0],isPaused:se=!1,iterations:ae=5,maxSubSteps:ge=10,quatNormalizeFast:ce=!1,quatNormalizeSkip:de=0,shouldInvalidate:Ie=!0,size:fe=1e3,solver:be="GS",stepSize:Ae=1/60,tolerance:ye=.001}=X;const{invalidate:ve}=useThree(),[{bodies:Be,events:Re,refs:Ve,scaleOverrides:Ee,subscriptions:Ze,worker:_e}]=reactExports.useState(()=>({bodies:{},events:{},refs:{},scaleOverrides:{},subscriptions:{},worker:new CannonWorkerAPI({allowSleep:Z,axisIndex:_,broadphase:K,defaultContactMaterial:ne,frictionGravity:ie,gravity:oe,iterations:ae,quatNormalizeFast:ce,quatNormalizeSkip:de,size:fe,solver:be,tolerance:ye})}));let Fe=0;const Te=reactExports.useCallback((at,ze)=>{se||(Fe+=ze,_e.step({maxSubSteps:ge,stepSize:Ae,timeSinceLastCalled:Fe}),Fe=0)},[se,ge,Ae]),ke=at=>{var ze;let{body:qe,contact:{bi:Pe,bj:Ye,...$e},target:ut,...ot}=at;const gt=(ze=Re[ut])==null?void 0:ze.collide;gt&&gt({body:Ve[qe],contact:{bi:Ve[Pe],bj:Ve[Ye],...$e},target:Ve[ut],...ot})},Le=at=>{var ze,qe;let{bodyA:Pe,bodyB:Ye}=at;const $e=(ze=Re[Pe])==null?void 0:ze.collideBegin;$e&&$e({body:Ve[Ye],op:"event",target:Ve[Pe],type:"collideBegin"});const ut=(qe=Re[Ye])==null?void 0:qe.collideBegin;ut&&ut({body:Ve[Pe],op:"event",target:Ve[Ye],type:"collideBegin"})},Ke=at=>{var ze,qe;let{bodyA:Pe,bodyB:Ye}=at;const $e=(ze=Re[Pe])==null?void 0:ze.collideEnd;$e&&$e({body:Ve[Ye],op:"event",target:Ve[Pe],type:"collideEnd"});const ut=(qe=Re[Ye])==null?void 0:qe.collideEnd;ut&&ut({body:Ve[Pe],op:"event",target:Ve[Ye],type:"collideEnd"})},Ue=at=>{let{active:ze,bodies:qe=[],observations:Pe,positions:Ye,quaternions:$e}=at;for(let ut=0;ut<qe.length;ut++)Be[qe[ut]]=ut;if(Pe.forEach(ut=>{let[ot,gt,ht]=ut;const bt=(Ze[ot]||{})[ht];bt&&bt(gt)}),!!ze){for(const ut of Object.values(Ve).filter(unique()))if(ut instanceof InstancedMesh)for(let ot=0;ot<ut.count;ot++){const gt=`${ut.uuid}/${ot}`,ht=Be[gt];ht!==void 0&&(ut.setMatrixAt(ot,apply(ht,Ye,$e,Ee[gt])),ut.instanceMatrix.needsUpdate=!0)}else{const ot=Ee[ut.uuid]||ut.scale;apply(Be[ut.uuid],Ye,$e,ot,ut)}Ie&&ve()}},rt=at=>{var ze;let{body:qe,ray:{uuid:Pe,...Ye},...$e}=at;const ut=(ze=Re[Pe])==null?void 0:ze.rayhit;ut&&ut({body:qe?Ve[qe]:null,ray:{uuid:Pe,...Ye},...$e})};useFrame(Te),reactExports.useEffect(()=>(_e.connect(),_e.init(),_e.on("collide",ke),_e.on("collideBegin",Le),_e.on("collideEnd",Ke),_e.on("frame",Ue),_e.on("rayhit",rt),()=>{_e.terminate(),_e.removeAllListeners()}),[]),reactExports.useEffect(()=>{_e.axisIndex=_},[_]),reactExports.useEffect(()=>{_e.broadphase=K},[K]),reactExports.useEffect(()=>{_e.gravity=oe},[oe]),reactExports.useEffect(()=>{_e.iterations=ae},[ae]),reactExports.useEffect(()=>{_e.tolerance=ye},[ye]);const tt=reactExports.useMemo(()=>({bodies:Be,events:Re,refs:Ve,scaleOverrides:Ee,subscriptions:Ze,worker:_e}),[Be,Re,Ve,Ze,_e]);return jsxRuntimeExports.jsx(physicsContext.Provider,{value:tt,children:te})}function Floor({...X}){const[Z,_]=reactExports.useState(1);reactExports.useEffect(()=>{const Ie=fe=>{setTimeout(()=>{_(fe.detail)},100)};return window.addEventListener("avatar-type-change",Ie),()=>{window.removeEventListener("avatar-type-change",Ie)}},[]);const K={1:"#4a4a4a",2:"#3b4a3b",3:"#3b424a",4:"#4a463b"},te={1:{metalness:.2,roughness:.8,envMapIntensity:1},2:{metalness:.3,roughness:.7,envMapIntensity:1.2},3:{metalness:.25,roughness:.75,envMapIntensity:1.1},4:{metalness:.35,roughness:.65,envMapIntensity:1.3}},[ne]=usePlane(()=>({rotation:[-Math.PI/2,0,0],position:[0,-.05,0],...X})),[ie,oe,se,ae,ge]=useTexture(["/textures/floorTextures/Poliigon_WoodVeneerOak_7760_BaseColor.jpg","/textures/floorTextures/Poliigon_WoodVeneerOak_7760_Displacement.jpg","/textures/floorTextures/Poliigon_WoodVeneerOak_7760_Metallic.jpg","/textures/floorTextures/Poliigon_WoodVeneerOak_7760_Normal.png","/textures/floorTextures/Poliigon_WoodVeneerOak_7760_Roughness.jpg"]),ce=K[Z]||K[1],de=te[Z]||te[1];return jsxRuntimeExports.jsxs("mesh",{ref:ne,receiveShadow:!0,children:[jsxRuntimeExports.jsx("planeGeometry",{args:[10,10]}),jsxRuntimeExports.jsx("meshStandardMaterial",{color:ce,map:ie,displacementMap:oe,displacementScale:.1,normalMap:ae,roughnessMap:ge,metalnessMap:se,metalness:de.metalness,roughness:de.roughness,envMapIntensity:de.envMapIntensity})]})}function Wall({name:X,initialPosition:Z=[0,0,0],initialSize:_=[1,1,1],...K}){const[te,ne]=reactExports.useState(1),ie=useControls(X||"Wall",{position:{value:Z,label:"Position"},size:{value:_,label:"Size"},visible:{value:!0,label:"Visible"}});reactExports.useEffect(()=>{const be=Ae=>{setTimeout(()=>{ne(Ae.detail)},100)};return window.addEventListener("avatar-type-change",be),()=>{window.removeEventListener("avatar-type-change",be)}},[]);const oe={1:"#e0e0e0",2:"#c8e6c9",3:"#bbdefb",4:"#ffecb3"},[se,ae,ge,ce,de]=useTexture(["/textures/walltextures/Poliigon_BrickWallReclaimed_8320_BaseColor.jpg","/textures/walltextures/Poliigon_BrickWallReclaimed_8320_Displacement.jpg","/textures/walltextures/Poliigon_BrickWallReclaimed_8320_Metallic.jpg","/textures/walltextures/Poliigon_BrickWallReclaimed_8320_Normal.png","/textures/walltextures/Poliigon_BrickWallReclaimed_8320_Roughness.jpg"]),[Ie]=useBox(()=>({type:"Static",args:ie.size,position:ie.position,material:{friction:.5},...K}));if(!ie.visible)return null;const fe=oe[te]||oe[1];return jsxRuntimeExports.jsxs("mesh",{ref:Ie,receiveShadow:!0,children:[jsxRuntimeExports.jsx("boxGeometry",{args:ie.size}),jsxRuntimeExports.jsx("meshStandardMaterial",{color:fe,map:se,displacementMap:ae,displacementScale:.1,normalMap:ce,roughnessMap:de,metalnessMap:ge,metalness:te>1?.3:.1,roughness:te>1?.6:.8,envMapIntensity:te>1?1.2:.8})]})}function Tv(){const{scene:X}=useGLTF("./models/Tv.glb"),Z=reactExports.useRef(),_=reactExports.useRef(),K=reactExports.useRef(),{position:te,rotation:ne,scale:ie}=useControls("TV",{position:{value:[3,2,-4.8],step:.1},rotation:{value:[0,Math.PI*1.5,0],step:.01},scale:{value:1.2,min:.1,max:5,step:.1}});useControls("TV Screen Debug",{visible:{value:!0,onChange:se=>{K.current&&(K.current.visible=se)}},rotateUV:{value:Math.PI/2,min:0,max:Math.PI*2,step:.1,onChange:se=>{K.current&&K.current.map&&(K.current.map.rotation=se,K.current.map.needsUpdate=!0)}},flipX:{value:!0,onChange:se=>{K.current&&K.current.map&&(K.current.map.repeat.x=se?-1:1,K.current.map.offset.x=se?1:0,K.current.map.needsUpdate=!0)}},flipY:{value:!0,onChange:se=>{K.current&&K.current.map&&(K.current.map.repeat.y=se?-1:1,K.current.map.needsUpdate=!0)}},offsetX:{value:0,min:-1,max:1,step:.1,onChange:se=>{K.current&&K.current.map&&(K.current.map.offset.x=se,K.current.map.needsUpdate=!0)}},offsetY:{value:1,min:-1,max:1,step:.1,onChange:se=>{K.current&&K.current.map&&(K.current.map.offset.y=se,K.current.map.needsUpdate=!0)}}});const[oe]=useBox(()=>({type:"Static",args:[1.5,.5,.1],position:[0,.5,-2],material:{friction:.5}}));return reactExports.useEffect(()=>{const se=setTimeout(()=>{const ae=X.getObjectByName("Ekran");if(!ae){console.error('Could not find TV screen mesh named "Ekran"');return}const ge=document.createElement("video");ge.src="/videos/logo_film.mp4",ge.crossOrigin="anonymous",ge.loop=!0,ge.muted=!0,ge.playsInline=!0,ge.preload="auto";const ce=new VideoTexture(ge);ce.minFilter=LinearFilter,ce.magFilter=LinearFilter,ce.format=RGBFormat,ce.generateMipmaps=!1,ce.repeat.x=-1,ce.offset.x=1,ce.wrapS=RepeatWrapping;const de=new MeshBasicMaterial({map:ce,side:DoubleSide,toneMapped:!1});ae.material=de,K.current=de;const Ie=()=>{ge.play().catch(fe=>{})};ge.readyState>=3?Ie():ge.addEventListener("loadeddata",Ie,{once:!0}),_.current=ge},5e3);return()=>{var ae;clearTimeout(se),_.current&&(_.current.pause(),_.current.src="",_.current.load(),_.current.remove(),K.current&&((ae=K.current.map)==null||ae.dispose(),K.current.dispose()))}},[X]),reactExports.useEffect(()=>{const se=()=>{var ae,ge;document.hidden?(ae=_.current)==null||ae.pause():(ge=_.current)==null||ge.play().catch(console.error)};return document.addEventListener("visibilitychange",se),()=>{document.removeEventListener("visibilitychange",se)}},[]),jsxRuntimeExports.jsxs("group",{ref:Z,position:te,rotation:new Euler(ne[0],ne[1],ne[2]),scale:ie,children:[jsxRuntimeExports.jsx("primitive",{object:X}),jsxRuntimeExports.jsx("mesh",{ref:oe,castShadow:!0,receiveShadow:!0})]})}useGLTF.preload("./models/Tv.glb");function Zegar(){const{scene:X}=useGLTF("./models/Zegar.glb",{draco:!0,meshOptimizer:!0}),Z=reactExports.useRef(),_=reactExports.useRef(),K=reactExports.useRef(),te=reactExports.useCallback(()=>{try{Z.current=X.getObjectByName("sekundy"),_.current=X.getObjectByName("Minuty"),K.current=X.getObjectByName("Godziny"),Z.current&&(Z.current.visible=!0,Z.current.renderOrder=1)}catch(ae){console.error("Error initializing clock hands:",ae)}},[X]);reactExports.useEffect(()=>(te(),()=>{Z.current=null,_.current=null,K.current=null}),[te]);const ne=reactExports.useCallback(()=>{const ae=new Date,ge=ae.getSeconds(),ce=ae.getMinutes(),de=ae.getHours(),Ie=ge/60*360,fe=(ce+ge/60)/60*360,be=(de%12+ce/60)/12*360,Ae=ye=>ye*(-Math.PI/180);Z.current&&(Z.current.rotation.x=Ae(Ie),Z.current.visible=!0),_.current&&(_.current.rotation.x=Ae(fe)),K.current&&(K.current.rotation.x=Ae(be))},[]);useFrame(ne);const{position:ie,rotationY:oe,scale:se}=useControls("Zegar",{position:{value:[-2,2,-5],step:.1},rotationY:{value:272,min:0,max:360,step:1},scale:{value:2.4,min:.1,max:5,step:.1}});return jsxRuntimeExports.jsx(reactExports.Suspense,{fallback:null,children:jsxRuntimeExports.jsx("primitive",{object:X,position:ie,rotation:[0,MathUtils.degToRad(oe),0],scale:se,castShadow:!0,receiveShadow:!0})})}useGLTF.preload("./models/Zegar.glb",{draco:!0,meshOptimizer:!0});function ReceptionDesk({currentAction:X,position:Z,rotation:_,scale:K}){const[te,ne]=reactExports.useState(1),{scene:ie}=useGLTF("./models/resize_reception.glb",{draco:!0,meshOptimizer:!0});reactExports.useEffect(()=>{const se=ae=>{setTimeout(()=>{ne(ae.detail)},100)};return window.addEventListener("avatar-type-change",se),()=>{window.removeEventListener("avatar-type-change",se)}},[]);const oe=reactExports.useMemo(()=>{const se=SkeletonUtils.clone(ie),ae={1:new Color$1("#FFFFFF"),2:new Color$1("#FFD700"),3:new Color$1("#C0C0C0"),4:new Color$1("#CD7F32")},ge=ae[te]||ae[1];return se.traverse(ce=>{ce.isMesh&&ce.name==="Cube008"&&ce.material&&(ce.material=ce.material.clone(),ce.material.color.copy(ge),te>1?(ce.material.metalness=.8,ce.material.roughness=.2):(ce.material.metalness=0,ce.material.roughness=.5))}),se},[ie,te]);return jsxRuntimeExports.jsx("group",{position:Z,rotation:_,scale:K,children:jsxRuntimeExports.jsx("primitive",{object:oe,position:[0,0,.7]})})}useGLTF.preload("./models/resize_reception.glb",{draco:!0,meshOptimizer:!0});function Vase({currentAction:X}){const{position:Z,rotation:_,scale:K}=useControls("Vase",{position:{value:[1.2,.95,.7],step:.1},rotation:{value:[0,Math.PI/4,0],step:.01},scale:{value:.4,min:.1,max:5,step:.1}}),{scene:te}=useGLTF("./models/vase1.glb",{draco:!0,meshOptimizer:!0}),ne=reactExports.useMemo(()=>SkeletonUtils.clone(te),[te]),[ie]=useBox(()=>({type:"Static",args:[.3,.5,.3],position:[1.5,.25,1.5],material:{friction:.5}}));return jsxRuntimeExports.jsxs("group",{children:[jsxRuntimeExports.jsx("primitive",{object:ne,position:Z,scale:K,rotation:_}),jsxRuntimeExports.jsx("mesh",{ref:ie,castShadow:!0,receiveShadow:!0})]})}useGLTF.preload("./models/vase1.glb",{draco:!0,meshOptimizer:!0});function Chair({currentAction:X}){const{position:Z,rotation:_,scale:K}=useControls("Chair",{position:{value:[3.1,0,-.7],step:.1},rotation:{value:[0,-Math.PI/4.5,0],step:.01},scale:{value:1,min:.1,max:5,step:.1}}),{scene:te}=useGLTF("./models/resized_chair.glb",{draco:!0,meshOptimizer:!0}),ne=reactExports.useMemo(()=>SkeletonUtils.clone(te),[te]),[ie]=useBox(()=>({type:"Static",args:[.5,1,.5],position:Z,material:{friction:.5}}));return reactExports.useEffect(()=>{ie.current&&ie.current.position.set(...Z)},[Z,ie]),jsxRuntimeExports.jsxs("group",{children:[jsxRuntimeExports.jsx("primitive",{object:ne,position:Z,scale:K,rotation:_}),jsxRuntimeExports.jsx("mesh",{ref:ie,castShadow:!0,receiveShadow:!0})]})}useGLTF.preload("./models/resized_chair.glb",{draco:!0,meshOptimizer:!0});function CoffeeTable(){const{position:X,rotation:Z,scale:_}=useControls("Coffee Table",{position:{value:[2.4,0,.4],step:.1},rotation:{value:[0,Math.PI/2,0],step:.01},scale:{value:1.2,min:.1,max:2,step:.1}}),{scene:K}=useGLTF("./models/coffee_table.glb",{draco:!0,meshOptimizer:!0}),te=reactExports.useMemo(()=>SkeletonUtils.clone(K),[K]),[ne]=useBox(()=>({type:"Static",args:[1.5,.5,1.5],position:[0,.25,0],material:{friction:.5}}));return jsxRuntimeExports.jsxs("group",{children:[jsxRuntimeExports.jsx("primitive",{object:te,position:X,rotation:Z,scale:_}),jsxRuntimeExports.jsx("mesh",{ref:ne,castShadow:!0,receiveShadow:!0})]})}useGLTF.preload("./models/coffee_table.glb",{draco:!0,meshOptimizer:!0});function LoadingSpinner({progress:X}){const[Z,_]=reactExports.useState(0);return reactExports.useEffect(()=>{const K=setInterval(()=>{_(te=>te>=X?te:Math.min(te+1,X))},50);return()=>clearInterval(K)},[X]),jsxRuntimeExports.jsxs("div",{className:"loading-container",children:[jsxRuntimeExports.jsx("div",{className:"spinner"}),jsxRuntimeExports.jsx("div",{className:"progress-bar",children:jsxRuntimeExports.jsx("div",{className:"progress-fill",style:{width:`${Z}%`}})}),jsxRuntimeExports.jsxs("div",{className:"progress-text",children:[Z,"%"]})]})}function ChairOffice(X){const{position:Z,rotation:_,scale:K}=useControls("ChairOffice",{position:{value:[3,.07,-1],step:.1},rotation:{value:[0,-Math.PI/2.2,0],step:.01},scale:{value:.3,min:.1,max:2,step:.1}}),{scene:te}=useGLTF("/models/office_chair.glb",{draco:!0,meshOptimizer:!0}),ne=reactExports.useMemo(()=>SkeletonUtils.clone(te),[te]),[ie]=useBox(()=>({type:"Static",args:[.6,1.2,.6],position:Z,rotation:_,material:{friction:.2}}));return jsxRuntimeExports.jsxs("group",{...X,children:[jsxRuntimeExports.jsx("primitive",{object:ne,position:Z,scale:K,rotation:_,castShadow:!0,receiveShadow:!0}),jsxRuntimeExports.jsx("mesh",{ref:ie,visible:!1})]})}useGLTF.preload("/models/office_chair.glb",{draco:!0,meshOptimizer:!0});function Ceiling(){const[X,Z]=reactExports.useState(1);reactExports.useEffect(()=>{const Ie=fe=>{setTimeout(()=>{Z(fe.detail)},100)};return window.addEventListener("avatar-type-change",Ie),()=>{window.removeEventListener("avatar-type-change",Ie)}},[]);const _={1:"#606060",2:"#7AACFF",3:"#C5FF7A",4:"#F76155"},[K,te,ne,ie,oe,se,ae]=useTexture(["/textures/ceilingTextures/brown_planks_03_ao_1k.jpg","/textures/ceilingTextures/brown_planks_03_rough_1k.jpg","/textures/ceilingTextures/brown_planks_03_ao_1k.jpg","/textures/ceilingTextures/brown_planks_03_arm_1k.jpg","/textures/ceilingTextures/brown_planks_03_disp_1k.png","/textures/ceilingTextures/brown_planks_03_nor_dx_1k.jpg","/textures/ceilingTextures/brown_planks_03_nor_gl_1k.jpg"]),ge={1:{metalness:.8,roughness:.8,envMapIntensity:.3,aoMapIntensity:.3,displacementScale:-.1},2:{metalness:.8,roughness:.6,envMapIntensity:1.2,aoMapIntensity:.8,displacementScale:-.1},3:{metalness:.15,roughness:.65,envMapIntensity:1.1,aoMapIntensity:.9,displacementScale:-.1},4:{metalness:.25,roughness:.55,envMapIntensity:1.3,aoMapIntensity:.7,displacementScale:-.1}},ce=_[X]||_[1],de=ge[X]||ge[1];return jsxRuntimeExports.jsxs("group",{position:[0,4.02,0],children:[jsxRuntimeExports.jsxs("mesh",{receiveShadow:!0,children:[jsxRuntimeExports.jsx("boxGeometry",{args:[10,.2,10]}),jsxRuntimeExports.jsx("meshStandardMaterial",{color:ce,map:K,roughnessMap:te,aoMap:ne,metalnessMap:ie,displacementMap:oe,normalMap:se,metalness:de.metalness,roughness:de.roughness,envMapIntensity:de.envMapIntensity,aoMapIntensity:de.aoMapIntensity,displacementScale:de.displacementScale})]}),jsxRuntimeExports.jsx("group",{position:[0,-.1,0],children:reactExports.useMemo(()=>{const Ie=[];for(let ye=-2/2;ye<=2/2;ye++)for(let ve=-2/2;ve<=2/2;ve++)Ie.push(jsxRuntimeExports.jsxs("mesh",{position:[ye*2,0,ve*2],children:[jsxRuntimeExports.jsx("boxGeometry",{args:[3.5,.1,1.2]}),jsxRuntimeExports.jsx("meshStandardMaterial",{color:"#ffffff",emissive:"#ffffff",emissiveIntensity:1.5,metalness:1,roughness:.8,envMapIntensity:de.envMapIntensity})]},`light-${ye}-${ve}`));return Ie},[X,ce,de])})]})}const LABELS$1={1:"TRANSFORMACJA ENERGETYCZNA FIRM",2:"HUB ENERGETYCZNY I WODOROWY",3:"POPRAWA EFEKTYWNOŚCI OZE",4:"CZYSTE POWIETRZE"};function Sign({activeScene:X}){const{position:Z,scale:_,color:K}=useControls("Sign",{position:{value:[0,3.5,-4.8],step:.1},scale:{value:1,min:.5,max:3},color:{value:"#ffffff"}});return React.useLayoutEffect(()=>{},[X]),jsxRuntimeExports.jsx(Text,{position:Z,rotation:[Math.PI,Math.PI,Math.PI],fontSize:.4,color:K,anchorX:"center",anchorY:"middle",scale:_,children:LABELS$1[X]||`Scena ${X}`},`text-${X}`)}function PlantOne(X){const{position:Z,rotation:_,scale:K}=useControls("PlantOne",{position:{value:[-2.1,.01,-.2],step:.1},rotation:{value:[0,-Math.PI/4,0],step:.01},scale:{value:.02,min:1e-4,max:2,step:.1}}),{scene:te}=useGLTF("/plants/plants_one.glb",{draco:!0,meshOptimizer:!0}),ne=reactExports.useMemo(()=>SkeletonUtils.clone(te),[te]),[ie]=useBox(()=>({type:"Static",args:[.5,1,.5],position:[1.5,.5,-1.8],material:{friction:.3}}));return jsxRuntimeExports.jsxs("group",{...X,children:[jsxRuntimeExports.jsx("primitive",{object:ne,position:Z,scale:K,rotation:_,castShadow:!0,receiveShadow:!0}),jsxRuntimeExports.jsx("mesh",{ref:ie,visible:!1})]})}useGLTF.preload("/plants/plants_one.glb",{draco:!0,meshOptimizer:!0});function RollUpDisplay(X){const{position:Z,rotation:_,scale:K}=useControls("RollUpDisplay",{position:{value:[-5,0,4],step:.1},rotation:{value:[0,-Math.PI/1.7,0],step:.01},scale:{value:5,min:.1,max:10,step:.1}}),{scene:te}=useGLTF("/models/roll-up_display.glb",{draco:!0,meshOptimizer:!0}),ne=reactExports.useMemo(()=>SkeletonUtils.clone(te),[te]),[ie]=useBox(()=>({type:"Static",args:[1,2,.1],position:[1.5,1,2.5],material:{friction:.1}}));return jsxRuntimeExports.jsxs("group",{...X,children:[jsxRuntimeExports.jsx("primitive",{object:ne,position:Z,scale:K,rotation:_,castShadow:!0,receiveShadow:!0}),jsxRuntimeExports.jsx("mesh",{ref:ie,visible:!1})]})}useGLTF.preload("/models/roll-up_display.glb",{draco:!0,meshOptimizer:!0});function OfficeCabinet(X){const{position:Z,rotation:_,scale:K}=useControls("OfficeCabinet",{position:{value:[2.4,1.17,-.5],step:.1},rotation:{value:[0,Math.PI,0],step:.01},scale:{value:.2,min:0,max:2,step:.1}}),{scene:te}=useGLTF("/models/file_cabinet.glb",{draco:!0,meshOptimizer:!0}),ne=reactExports.useMemo(()=>SkeletonUtils.clone(te),[te]),[ie]=useBox(()=>({type:"Static",args:[1,1,1],position:Z,rotation:_,material:{friction:.5}}));return jsxRuntimeExports.jsxs("group",{...X,children:[jsxRuntimeExports.jsx("primitive",{object:ne,position:Z,scale:K,rotation:_,castShadow:!0,receiveShadow:!0}),jsxRuntimeExports.jsx("mesh",{ref:ie,visible:!1})]})}useGLTF.preload("/models/file_cabinet.glb");const MobileNotification=()=>jsxRuntimeExports.jsx("div",{className:"mobile-notification",style:{position:"fixed",top:0,left:0,width:"100%",height:"100%",display:"flex",justifyContent:"center",alignItems:"center",backgroundColor:"rgba(0, 0, 0, 0.9)",zIndex:9999,color:"white",textAlign:"center"},children:jsxRuntimeExports.jsxs("div",{className:"notification-content",style:{padding:"30px",backgroundColor:"rgba(33, 150, 243, 0.8)",borderRadius:"10px",maxWidth:"80%"},children:[jsxRuntimeExports.jsx("h2",{style:{marginBottom:"15px",fontSize:"24px"},children:"Trwają prace nad wersją mobilną"}),jsxRuntimeExports.jsx("p",{style:{marginBottom:"10px",fontSize:"16px"},children:"Aplikacja jest obecnie dostępna na laptopach oraz wszystkich większych ekranach."}),jsxRuntimeExports.jsx("p",{style:{fontSize:"16px"},children:"Zapraszamy do korzystania z wersji pełnoekranowej."})]})}),AVATAR_IDS={1:"fe2da934-6aa4-11ef-8fba-42010a7be011",2:"881e4aac-50d5-11ef-9461-42010a7be011",3:"9ff38f44-437d-11ef-9187-42010a7be011",4:"2734589a-ef8f-11ef-9966-42010a7be016"},LABELS={1:"ENERGY TRANSFORMATION OF COMPANIES",2:"ENERGY AND HYDROGEN HUB",3:"IMPROVEMENT OF RENEWABLE ENERGY EFFICIENCY",4:"CLEAN AIR"};class Scene3DErrorBoundary extends reactExports.Component{constructor(Z){super(Z),this.state={hasError:!1,errorDetails:null}}static getDerivedStateFromError(Z){return{hasError:!0}}componentDidCatch(Z,_){console.error("3D Scene Error:",Z,_),this.setState({errorDetails:Z.message})}render(){return this.state.hasError?jsxRuntimeExports.jsxs("div",{className:"error-container",children:[jsxRuntimeExports.jsx("h2",{children:"Error loading 3D scene"}),jsxRuntimeExports.jsx("p",{children:this.state.errorDetails}),jsxRuntimeExports.jsx("button",{onClick:()=>window.location.reload(),children:"Reload Application"})]}):this.props.children}}const Scene=({activeScene:X,isAvatarLoaded:Z,onAvatarLoaded:_,currentAction:K,selectedAvatar:te,isLoading:ne,forceUpdate:ie,avatars:oe,visibleAvatar:se,onAvatarReady:ae})=>jsxRuntimeExports.jsx(Canvas$1,{shadows:!0,style:{background:"#646464"},camera:{position:[0,1,3],fov:75,rotation:[0,Math.PI,0]},onCreated:({gl:ge,camera:ce})=>{ge.domElement.style.touchAction="none",ce.lookAt(0,0,0)},children:jsxRuntimeExports.jsxs(PhysicsProvider,{gravity:[0,-9.81,0],children:[jsxRuntimeExports.jsx(Leva,{hidden:!0}),jsxRuntimeExports.jsx(Environment,{preset:"night",background:!0,blur:.5,resolution:512,backgroundIntensity:1.5,environmentIntensity:1.5}),jsxRuntimeExports.jsxs(PresentationControls,{global:!0,position:[0,-.5,0],rotation:[0,0,0],polar:[-.2,.2],azimuth:[-.3,.3],config:{mass:2,tension:400},snap:{mass:3,tension:200},speed:1.5,zoom:1,children:[jsxRuntimeExports.jsx("ambientLight",{intensity:2,color:"#ffffff"}),jsxRuntimeExports.jsx("directionalLight",{position:[15,15,15],intensity:2,castShadow:!0,"shadow-mapSize":[4096,4096],"shadow-camera-far":100,"shadow-camera-left":-30,"shadow-camera-right":30,"shadow-camera-top":30,"shadow-camera-bottom":-30}),jsxRuntimeExports.jsx("pointLight",{position:[-15,10,-15],intensity:1.2,color:"#ffeedd",decay:.5}),jsxRuntimeExports.jsx("hemisphereLight",{intensity:.5,color:"#ffffff",groundColor:"#404040"}),jsxRuntimeExports.jsx("directionalLight",{position:[-15,15,-15],intensity:1,color:"#ffffff"}),jsxRuntimeExports.jsx(reactExports.Suspense,{fallback:null,children:jsxRuntimeExports.jsxs("group",{position:[0,-1,0],children:[!ne&&oe&&jsxRuntimeExports.jsx(jsxRuntimeExports.Fragment,{children:Object.entries(oe).map(([ge,ce])=>jsxRuntimeExports.jsxs("group",{visible:Number(ge)===se,children:[React.cloneElement(ce,{visible:Number(ge)===se,onReady:ae}),Number(ge)===1&&jsxRuntimeExports.jsx(OfficeCabinet,{position:[2,0,0]})]},ge))}),jsxRuntimeExports.jsx(ReceptionDesk,{currentAction:K,position:[0,0,0],rotation:[0,Math.PI*0,0],scale:1.1}),jsxRuntimeExports.jsx(Floor,{}),jsxRuntimeExports.jsx(Ceiling,{}),X===1&&jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(Tv,{}),jsxRuntimeExports.jsx(Zegar,{}),jsxRuntimeExports.jsx(ChairOffice,{}),jsxRuntimeExports.jsx(RollUpDisplay,{position:[2.2,0,1.5],rotation:[0,-Math.PI/3,0],scale:.9})]}),X===2&&jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(Chair,{}),jsxRuntimeExports.jsx(CoffeeTable,{})]}),X===3&&jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(Vase,{}),jsxRuntimeExports.jsx(Zegar,{}),jsxRuntimeExports.jsx(PlantOne,{})]}),X===4&&jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(Tv,{}),jsxRuntimeExports.jsx(CoffeeTable,{})]}),jsxRuntimeExports.jsx(Sign,{position:[0,3.5,-4.9],scale:1.2,activeScene:X}),jsxRuntimeExports.jsx(Wall,{name:"Left Wall",initialPosition:[-5,2,0],initialSize:[.2,4,10]}),jsxRuntimeExports.jsx(Wall,{name:"Right Wall",initialPosition:[5,2,0],initialSize:[.2,4,10]}),jsxRuntimeExports.jsx(Wall,{name:"Back Wall",initialPosition:[0,2,-5],initialSize:[10,4,.2]}),jsxRuntimeExports.jsx(Wall,{name:"Front Wall",initialPosition:[0,2,5],initialSize:[10,4,.2]})]})})]})]})});function AvatarButtons({selectedAvatar:X,isLoading:Z,handleAvatarChange:_,setActiveScene:K}){const te=ne=>{_(ne),K(ne)};return[1,2,3,4].map(ne=>jsxRuntimeExports.jsx("button",{onClick:()=>te(ne),style:{padding:"12px 24px",margin:"0 8px",backgroundColor:X===ne?"#2196F3":"#666",color:"white",border:"none",borderRadius:"4px",cursor:"pointer",fontSize:"16px",transition:"all 0.3s ease",opacity:Z?X===ne?1:.3:1,pointerEvents:Z?"none":"auto"},children:Z&&X===ne?"Loading...":LABELS[ne]},ne))}const App=()=>{const[X,Z]=reactExports.useState(""),[_,K]=reactExports.useState(1),[te,ne]=reactExports.useState(!1),[ie,oe]=reactExports.useState(1),[se,ae]=reactExports.useState(!1),[ge,ce]=reactExports.useState(0),[de,Ie]=reactExports.useState({}),[fe,be]=reactExports.useState(!0),[Ae,ye]=reactExports.useState(1),[ve,Be]=reactExports.useState(!1),[Re,Ve]=reactExports.useState(!1);reactExports.useEffect(()=>{const Fe=()=>{Ve(window.innerWidth<1e3)};return Fe(),window.addEventListener("resize",Fe),()=>window.removeEventListener("resize",Fe)},[]);const Ee=reactExports.useCallback(Fe=>{ne(!1),Be(!1),oe(Fe),ye(Fe),K(Fe),de[Fe]&&setTimeout(()=>{ne(!0)},500)},[de]);reactExports.useCallback(Fe=>{ce(Le=>Le+1);const ke={"ENERGY TRANSFORMATION":1,"ENERGY AND HYDROGEN HUB":2,"IMPROVEMENT OF RENEWABLE ENERGY EFFICIENCY":3,"CLEAN AIR":4}[Fe]||1;oe(ke),ye(ke)},[]),reactExports.useEffect(()=>{(async()=>{try{Ie({1:jsxRuntimeExports.jsx(ConvaiAvatar,{onLoad:()=>Ze(1)}),2:jsxRuntimeExports.jsx(ConvaiAvatar2,{onLoad:()=>Ze(2)}),3:jsxRuntimeExports.jsx(ConvaiAvatar3,{onLoad:()=>Ze(3)}),4:jsxRuntimeExports.jsx(ConvaiAvatar4,{onLoad:()=>Ze(4)})}),be(!1)}catch(Te){console.error("Error loading avatars:",Te)}})()},[]);const Ze=Fe=>{Fe===ie&&ne(!0)},_e=reactExports.useCallback(Fe=>{console.log("Avatar ready state:",Fe),Be(Fe)},[]);return jsxRuntimeExports.jsxs("div",{className:"app-container",style:{height:"100vh",width:"100vw",position:"fixed",top:0,left:0},children:[Re&&jsxRuntimeExports.jsx(MobileNotification,{}),jsxRuntimeExports.jsxs("div",{className:"scene-container",children:[jsxRuntimeExports.jsx("div",{style:{position:"absolute",bottom:"20px",left:"50%",transform:"translateX(-50%)",zIndex:1e3,display:"flex",gap:"10px",padding:"10px",backgroundColor:"rgba(0,0,0,0.5)",borderRadius:"8px",backdropFilter:"blur(4px)"},children:jsxRuntimeExports.jsx(AvatarButtons,{selectedAvatar:ie,isLoading:se,handleAvatarChange:Ee,setActiveScene:K})}),!te&&jsxRuntimeExports.jsx("div",{className:"loading-overlay",children:jsxRuntimeExports.jsx(LoadingSpinner,{progress:100})}),jsxRuntimeExports.jsx(Scene3DErrorBoundary,{children:jsxRuntimeExports.jsx(Scene,{activeScene:_,isAvatarLoaded:te,onAvatarLoaded:()=>ne(!0),currentAction:X,selectedAvatar:ie,isLoading:se,forceUpdate:ge,avatars:de,visibleAvatar:Ae,onAvatarReady:_e},`scene-${ge}`)}),te&&ve&&jsxRuntimeExports.jsx(ChatInterface,{characterId:AVATAR_IDS[ie],setActiveScene:K,isAvatarReady:ve}),jsxRuntimeExports.jsx(SceneButtons,{setActiveScene:K})]})]})};function SceneButtons({setActiveScene:X}){return jsxRuntimeExports.jsxs("div",{className:"scene-buttons",children:[jsxRuntimeExports.jsx("button",{onClick:()=>X(1),children:"Energy Transformation"}),jsxRuntimeExports.jsx("button",{onClick:()=>X(2),children:"Energy Hub"}),jsxRuntimeExports.jsx("button",{onClick:()=>X(3),children:"IMPROVEMENT OF RENEWABLE ENERGY EFFICIENCY"}),jsxRuntimeExports.jsx("button",{onClick:()=>{const Z="TEST "+Math.floor(Math.random()*1e3);X(Z)},children:"Test Random Text"})]})}ReactDOM.createRoot(document.getElementById("root")).render(jsxRuntimeExports.jsx(React.StrictMode,{children:jsxRuntimeExports.jsx(App,{})}));
